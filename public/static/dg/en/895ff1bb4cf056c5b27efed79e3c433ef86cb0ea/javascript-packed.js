/*!
 * jQuery JavaScript Library v1.6.2
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Thu Jun 30 14:16:56 2011 -0400
 */
(function(ba,K){var ar=ba.document,bs=ba.navigator,bj=ba.location;var b=(function(){var bE=function(bZ,b0){return new bE.fn.init(bZ,b0,bC)},bU=ba.jQuery,bG=ba.$,bC,bY=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,bM=/\S/,bI=/^\s+/,bD=/\s+$/,bH=/\d/,bz=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,bN=/^[\],:{}\s]*$/,bW=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,bP=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,bJ=/(?:^|:|,)(?:\s*\[)+/g,bx=/(webkit)[ \/]([\w.]+)/,bR=/(opera)(?:.*version)?[ \/]([\w.]+)/,bQ=/(msie) ([\w.]+)/,bS=/(mozilla)(?:.*? rv:([\w.]+))?/,bA=/-([a-z])/ig,bT=function(bZ,b0){return b0.toUpperCase()},bX=bs.userAgent,bV,bB,bt,bL=Object.prototype.toString,bF=Object.prototype.hasOwnProperty,by=Array.prototype.push,bK=Array.prototype.slice,bO=String.prototype.trim,bu=Array.prototype.indexOf,bw={};bE.fn=bE.prototype={constructor:bE,init:function(bZ,b3,b2){var b1,b4,b0,b5;if(!bZ){return this}if(bZ.nodeType){this.context=this[0]=bZ;this.length=1;return this}if(bZ==="body"&&!b3&&ar.body){this.context=ar;this[0]=ar.body;this.selector=bZ;this.length=1;return this}if(typeof bZ==="string"){if(bZ.charAt(0)==="<"&&bZ.charAt(bZ.length-1)===">"&&bZ.length>=3){b1=[null,bZ,null]}else{b1=bY.exec(bZ)}if(b1&&(b1[1]||!b3)){if(b1[1]){b3=b3 instanceof bE?b3[0]:b3;b5=(b3?b3.ownerDocument||b3:ar);b0=bz.exec(bZ);if(b0){if(bE.isPlainObject(b3)){bZ=[ar.createElement(b0[1])];bE.fn.attr.call(bZ,b3,true)}else{bZ=[b5.createElement(b0[1])]}}else{b0=bE.buildFragment([b1[1]],[b5]);bZ=(b0.cacheable?bE.clone(b0.fragment):b0.fragment).childNodes}return bE.merge(this,bZ)}else{b4=ar.getElementById(b1[2]);if(b4&&b4.parentNode){if(b4.id!==b1[2]){return b2.find(bZ)}this.length=1;this[0]=b4}this.context=ar;this.selector=bZ;return this}}else{if(!b3||b3.jquery){return(b3||b2).find(bZ)}else{return this.constructor(b3).find(bZ)}}}else{if(bE.isFunction(bZ)){return b2.ready(bZ)}}if(bZ.selector!==K){this.selector=bZ.selector;this.context=bZ.context}return bE.makeArray(bZ,this)},selector:"",jquery:"1.6.2",length:0,size:function(){return this.length},toArray:function(){return bK.call(this,0)},get:function(bZ){return bZ==null?this.toArray():(bZ<0?this[this.length+bZ]:this[bZ])},pushStack:function(b0,b2,bZ){var b1=this.constructor();if(bE.isArray(b0)){by.apply(b1,b0)}else{bE.merge(b1,b0)}b1.prevObject=this;b1.context=this.context;if(b2==="find"){b1.selector=this.selector+(this.selector?" ":"")+bZ}else{if(b2){b1.selector=this.selector+"."+b2+"("+bZ+")"}}return b1},each:function(b0,bZ){return bE.each(this,b0,bZ)},ready:function(bZ){bE.bindReady();bB.done(bZ);return this},eq:function(bZ){return bZ===-1?this.slice(bZ):this.slice(bZ,+bZ+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(bK.apply(this,arguments),"slice",bK.call(arguments).join(","))},map:function(bZ){return this.pushStack(bE.map(this,function(b1,b0){return bZ.call(b1,b0,b1)}))},end:function(){return this.prevObject||this.constructor(null)},push:by,sort:[].sort,splice:[].splice};bE.fn.init.prototype=bE.fn;bE.extend=bE.fn.extend=function(){var b8,b1,bZ,b0,b5,b6,b4=arguments[0]||{},b3=1,b2=arguments.length,b7=false;if(typeof b4==="boolean"){b7=b4;b4=arguments[1]||{};b3=2}if(typeof b4!=="object"&&!bE.isFunction(b4)){b4={}}if(b2===b3){b4=this;--b3}for(;b3<b2;b3++){if((b8=arguments[b3])!=null){for(b1 in b8){bZ=b4[b1];b0=b8[b1];if(b4===b0){continue}if(b7&&b0&&(bE.isPlainObject(b0)||(b5=bE.isArray(b0)))){if(b5){b5=false;b6=bZ&&bE.isArray(bZ)?bZ:[]}else{b6=bZ&&bE.isPlainObject(bZ)?bZ:{}}b4[b1]=bE.extend(b7,b6,b0)}else{if(b0!==K){b4[b1]=b0}}}}}return b4};bE.extend({noConflict:function(bZ){if(ba.$===bE){ba.$=bG}if(bZ&&ba.jQuery===bE){ba.jQuery=bU}return bE},isReady:false,readyWait:1,holdReady:function(bZ){if(bZ){bE.readyWait++}else{bE.ready(true)}},ready:function(bZ){if((bZ===true&&!--bE.readyWait)||(bZ!==true&&!bE.isReady)){if(!ar.body){return setTimeout(bE.ready,1)}bE.isReady=true;if(bZ!==true&&--bE.readyWait>0){return}bB.resolveWith(ar,[bE]);if(bE.fn.trigger){bE(ar).trigger("ready").unbind("ready")}}},bindReady:function(){if(bB){return}bB=bE._Deferred();if(ar.readyState==="complete"){return setTimeout(bE.ready,1)}if(ar.addEventListener){ar.addEventListener("DOMContentLoaded",bt,false);ba.addEventListener("load",bE.ready,false)}else{if(ar.attachEvent){ar.attachEvent("onreadystatechange",bt);ba.attachEvent("onload",bE.ready);var bZ=false;try{bZ=ba.frameElement==null}catch(b0){}if(ar.documentElement.doScroll&&bZ){bv()}}}},isFunction:function(bZ){return bE.type(bZ)==="function"},isArray:Array.isArray||function(bZ){return bE.type(bZ)==="array"},isWindow:function(bZ){return bZ&&typeof bZ==="object"&&"setInterval" in bZ},isNaN:function(bZ){return bZ==null||!bH.test(bZ)||isNaN(bZ)},type:function(bZ){return bZ==null?String(bZ):bw[bL.call(bZ)]||"object"},isPlainObject:function(b0){if(!b0||bE.type(b0)!=="object"||b0.nodeType||bE.isWindow(b0)){return false}if(b0.constructor&&!bF.call(b0,"constructor")&&!bF.call(b0.constructor.prototype,"isPrototypeOf")){return false}var bZ;for(bZ in b0){}return bZ===K||bF.call(b0,bZ)},isEmptyObject:function(b0){for(var bZ in b0){return false}return true},error:function(bZ){throw bZ},parseJSON:function(bZ){if(typeof bZ!=="string"||!bZ){return null}bZ=bE.trim(bZ);if(ba.JSON&&ba.JSON.parse){return ba.JSON.parse(bZ)}if(bN.test(bZ.replace(bW,"@").replace(bP,"]").replace(bJ,""))){return(new Function("return "+bZ))()}bE.error("Invalid JSON: "+bZ)},parseXML:function(b1,bZ,b0){if(ba.DOMParser){b0=new DOMParser();bZ=b0.parseFromString(b1,"text/xml")}else{bZ=new ActiveXObject("Microsoft.XMLDOM");bZ.async="false";bZ.loadXML(b1)}b0=bZ.documentElement;if(!b0||!b0.nodeName||b0.nodeName==="parsererror"){bE.error("Invalid XML: "+b1)}return bZ},noop:function(){},globalEval:function(bZ){if(bZ&&bM.test(bZ)){(ba.execScript||function(b0){ba["eval"].call(ba,b0)})(bZ)}},camelCase:function(bZ){return bZ.replace(bA,bT)},nodeName:function(b0,bZ){return b0.nodeName&&b0.nodeName.toUpperCase()===bZ.toUpperCase()},each:function(b2,b5,b1){var b0,b3=0,b4=b2.length,bZ=b4===K||bE.isFunction(b2);if(b1){if(bZ){for(b0 in b2){if(b5.apply(b2[b0],b1)===false){break}}}else{for(;b3<b4;){if(b5.apply(b2[b3++],b1)===false){break}}}}else{if(bZ){for(b0 in b2){if(b5.call(b2[b0],b0,b2[b0])===false){break}}}else{for(;b3<b4;){if(b5.call(b2[b3],b3,b2[b3++])===false){break}}}}return b2},trim:bO?function(bZ){return bZ==null?"":bO.call(bZ)}:function(bZ){return bZ==null?"":bZ.toString().replace(bI,"").replace(bD,"")},makeArray:function(b2,b0){var bZ=b0||[];if(b2!=null){var b1=bE.type(b2);if(b2.length==null||b1==="string"||b1==="function"||b1==="regexp"||bE.isWindow(b2)){by.call(bZ,b2)}else{bE.merge(bZ,b2)}}return bZ},inArray:function(b1,b2){if(bu){return bu.call(b2,b1)}for(var bZ=0,b0=b2.length;bZ<b0;bZ++){if(b2[bZ]===b1){return bZ}}return -1},merge:function(b3,b1){var b2=b3.length,b0=0;if(typeof b1.length==="number"){for(var bZ=b1.length;b0<bZ;b0++){b3[b2++]=b1[b0]}}else{while(b1[b0]!==K){b3[b2++]=b1[b0++]}}b3.length=b2;return b3},grep:function(b0,b5,bZ){var b1=[],b4;bZ=!!bZ;for(var b2=0,b3=b0.length;b2<b3;b2++){b4=!!b5(b0[b2],b2);if(bZ!==b4){b1.push(b0[b2])}}return b1},map:function(bZ,b6,b7){var b4,b5,b3=[],b1=0,b0=bZ.length,b2=bZ instanceof bE||b0!==K&&typeof b0==="number"&&((b0>0&&bZ[0]&&bZ[b0-1])||b0===0||bE.isArray(bZ));if(b2){for(;b1<b0;b1++){b4=b6(bZ[b1],b1,b7);if(b4!=null){b3[b3.length]=b4}}}else{for(b5 in bZ){b4=b6(bZ[b5],b5,b7);if(b4!=null){b3[b3.length]=b4}}}return b3.concat.apply([],b3)},guid:1,proxy:function(b3,b2){if(typeof b2==="string"){var b1=b3[b2];b2=b3;b3=b1}if(!bE.isFunction(b3)){return K}var bZ=bK.call(arguments,2),b0=function(){return b3.apply(b2,bZ.concat(bK.call(arguments)))};b0.guid=b3.guid=b3.guid||b0.guid||bE.guid++;return b0},access:function(bZ,b7,b5,b1,b4,b6){var b0=bZ.length;if(typeof b7==="object"){for(var b2 in b7){bE.access(bZ,b2,b7[b2],b1,b4,b5)}return bZ}if(b5!==K){b1=!b6&&b1&&bE.isFunction(b5);for(var b3=0;b3<b0;b3++){b4(bZ[b3],b7,b1?b5.call(bZ[b3],b3,b4(bZ[b3],b7)):b5,b6)}return bZ}return b0?b4(bZ[0],b7):K},now:function(){return(new Date()).getTime()},uaMatch:function(b0){b0=b0.toLowerCase();var bZ=bx.exec(b0)||bR.exec(b0)||bQ.exec(b0)||b0.indexOf("compatible")<0&&bS.exec(b0)||[];return{browser:bZ[1]||"",version:bZ[2]||"0"}},sub:function(){function bZ(b2,b3){return new bZ.fn.init(b2,b3)}bE.extend(true,bZ,this);bZ.superclass=this;bZ.fn=bZ.prototype=this();bZ.fn.constructor=bZ;bZ.sub=this.sub;bZ.fn.init=function b1(b2,b3){if(b3&&b3 instanceof bE&&!(b3 instanceof bZ)){b3=bZ(b3)}return bE.fn.init.call(this,b2,b3,b0)};bZ.fn.init.prototype=bZ.fn;var b0=bZ(ar);return bZ},browser:{}});bE.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(b0,bZ){bw["[object "+bZ+"]"]=bZ.toLowerCase()});bV=bE.uaMatch(bX);if(bV.browser){bE.browser[bV.browser]=true;bE.browser.version=bV.version}if(bE.browser.webkit){bE.browser.safari=true}if(bM.test("\xA0")){bI=/^[\s\xA0]+/;bD=/[\s\xA0]+$/}bC=bE(ar);if(ar.addEventListener){bt=function(){ar.removeEventListener("DOMContentLoaded",bt,false);bE.ready()}}else{if(ar.attachEvent){bt=function(){if(ar.readyState==="complete"){ar.detachEvent("onreadystatechange",bt);bE.ready()}}}}function bv(){if(bE.isReady){return}try{ar.documentElement.doScroll("left")}catch(bZ){setTimeout(bv,1);return}bE.ready()}return bE})();var a="done fail isResolved isRejected promise then always pipe".split(" "),aG=[].slice;b.extend({_Deferred:function(){var bw=[],bx,bu,bv,bt={done:function(){if(!bv){var bz=arguments,bA,bD,bC,bB,by;if(bx){by=bx;bx=0}for(bA=0,bD=bz.length;bA<bD;bA++){bC=bz[bA];bB=b.type(bC);if(bB==="array"){bt.done.apply(bt,bC)}else{if(bB==="function"){bw.push(bC)}}}if(by){bt.resolveWith(by[0],by[1])}}return this},resolveWith:function(bz,by){if(!bv&&!bx&&!bu){by=by||[];bu=1;try{while(bw[0]){bw.shift().apply(bz,by)}}finally{bx=[bz,by];bu=0}}return this},resolve:function(){bt.resolveWith(this,arguments);return this},isResolved:function(){return !!(bu||bx)},cancel:function(){bv=1;bw=[];return this}};return bt},Deferred:function(bu){var bt=b._Deferred(),bw=b._Deferred(),bv;b.extend(bt,{then:function(by,bx){bt.done(by).fail(bx);return this},always:function(){return bt.done.apply(bt,arguments).fail.apply(this,arguments)},fail:bw.done,rejectWith:bw.resolveWith,reject:bw.resolve,isRejected:bw.isResolved,pipe:function(by,bx){return b.Deferred(function(bz){b.each({done:[by,"resolve"],fail:[bx,"reject"]},function(bB,bE){var bA=bE[0],bD=bE[1],bC;if(b.isFunction(bA)){bt[bB](function(){bC=bA.apply(this,arguments);if(bC&&b.isFunction(bC.promise)){bC.promise().then(bz.resolve,bz.reject)}else{bz[bD](bC)}})}else{bt[bB](bz[bD])}})}).promise()},promise:function(by){if(by==null){if(bv){return bv}bv=by={}}var bx=a.length;while(bx--){by[a[bx]]=bt[a[bx]]}return by}});bt.done(bw.cancel).fail(bt.cancel);delete bt.cancel;if(bu){bu.call(bt,bt)}return bt},when:function(bz){var bu=arguments,bv=0,by=bu.length,bx=by,bt=by<=1&&bz&&b.isFunction(bz.promise)?bz:b.Deferred();function bw(bA){return function(bB){bu[bA]=arguments.length>1?aG.call(arguments,0):bB;if(!(--bx)){bt.resolveWith(bt,aG.call(bu,0))}}}if(by>1){for(;bv<by;bv++){if(bu[bv]&&b.isFunction(bu[bv].promise)){bu[bv].promise().then(bw(bv),bt.reject)}else{--bx}}if(!bx){bt.resolveWith(bt,bu)}}else{if(bt!==bz){bt.resolveWith(bt,by?[bz]:[])}}return bt.promise()}});b.support=(function(){var bD=ar.createElement("div"),bK=ar.documentElement,bw,bL,bE,bu,bC,bx,bA,bt,bB,bF,bz,bJ,bH,bv,by,bG,bM;bD.setAttribute("className","t");bD.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";bw=bD.getElementsByTagName("*");bL=bD.getElementsByTagName("a")[0];if(!bw||!bw.length||!bL){return{}}bE=ar.createElement("select");bu=bE.appendChild(ar.createElement("option"));bC=bD.getElementsByTagName("input")[0];bA={leadingWhitespace:(bD.firstChild.nodeType===3),tbody:!bD.getElementsByTagName("tbody").length,htmlSerialize:!!bD.getElementsByTagName("link").length,style:/top/.test(bL.getAttribute("style")),hrefNormalized:(bL.getAttribute("href")==="/a"),opacity:/^0.55$/.test(bL.style.opacity),cssFloat:!!bL.style.cssFloat,checkOn:(bC.value==="on"),optSelected:bu.selected,getSetAttribute:bD.className!=="t",submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};bC.checked=true;bA.noCloneChecked=bC.cloneNode(true).checked;bE.disabled=true;bA.optDisabled=!bu.disabled;try{delete bD.test}catch(bI){bA.deleteExpando=false}if(!bD.addEventListener&&bD.attachEvent&&bD.fireEvent){bD.attachEvent("onclick",function(){bA.noCloneEvent=false});bD.cloneNode(true).fireEvent("onclick")}bC=ar.createElement("input");bC.value="t";bC.setAttribute("type","radio");bA.radioValue=bC.value==="t";bC.setAttribute("checked","checked");bD.appendChild(bC);bt=ar.createDocumentFragment();bt.appendChild(bD.firstChild);bA.checkClone=bt.cloneNode(true).cloneNode(true).lastChild.checked;bD.innerHTML="";bD.style.width=bD.style.paddingLeft="1px";bB=ar.getElementsByTagName("body")[0];bz=ar.createElement(bB?"div":"body");bJ={visibility:"hidden",width:0,height:0,border:0,margin:0};if(bB){b.extend(bJ,{position:"absolute",left:-1000,top:-1000})}for(bG in bJ){bz.style[bG]=bJ[bG]}bz.appendChild(bD);bF=bB||bK;bF.insertBefore(bz,bF.firstChild);bA.appendChecked=bC.checked;bA.boxModel=bD.offsetWidth===2;if("zoom" in bD.style){bD.style.display="inline";bD.style.zoom=1;bA.inlineBlockNeedsLayout=(bD.offsetWidth===2);bD.style.display="";bD.innerHTML="<div style='width:4px;'></div>";bA.shrinkWrapBlocks=(bD.offsetWidth!==2)}bD.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";bH=bD.getElementsByTagName("td");bM=(bH[0].offsetHeight===0);bH[0].style.display="";bH[1].style.display="none";bA.reliableHiddenOffsets=bM&&(bH[0].offsetHeight===0);bD.innerHTML="";if(ar.defaultView&&ar.defaultView.getComputedStyle){bx=ar.createElement("div");bx.style.width="0";bx.style.marginRight="0";bD.appendChild(bx);bA.reliableMarginRight=(parseInt((ar.defaultView.getComputedStyle(bx,null)||{marginRight:0}).marginRight,10)||0)===0}bz.innerHTML="";bF.removeChild(bz);if(bD.attachEvent){for(bG in {submit:1,change:1,focusin:1}){by="on"+bG;bM=(by in bD);if(!bM){bD.setAttribute(by,"return;");bM=(typeof bD[by]==="function")}bA[bG+"Bubbles"]=bM}}bz=bt=bE=bu=bB=bx=bD=bC=null;return bA})();b.boxModel=b.support.boxModel;var aN=/^(?:\{.*\}|\[.*\])$/,ax=/([a-z])([A-Z])/g;b.extend({cache:{},uuid:0,expando:"jQuery"+(b.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(bt){bt=bt.nodeType?b.cache[bt[b.expando]]:bt[b.expando];return !!bt&&!U(bt)},data:function(bw,bu,by,bx){if(!b.acceptData(bw)){return}var bB=b.expando,bA=typeof bu==="string",bz,bC=bw.nodeType,bt=bC?b.cache:bw,bv=bC?bw[b.expando]:bw[b.expando]&&b.expando;if((!bv||(bx&&bv&&!bt[bv][bB]))&&bA&&by===K){return}if(!bv){if(bC){bw[b.expando]=bv=++b.uuid}else{bv=b.expando}}if(!bt[bv]){bt[bv]={};if(!bC){bt[bv].toJSON=b.noop}}if(typeof bu==="object"||typeof bu==="function"){if(bx){bt[bv][bB]=b.extend(bt[bv][bB],bu)}else{bt[bv]=b.extend(bt[bv],bu)}}bz=bt[bv];if(bx){if(!bz[bB]){bz[bB]={}}bz=bz[bB]}if(by!==K){bz[b.camelCase(bu)]=by}if(bu==="events"&&!bz[bu]){return bz[bB]&&bz[bB].events}return bA?bz[b.camelCase(bu)]||bz[bu]:bz},removeData:function(bx,bv,by){if(!b.acceptData(bx)){return}var bA=b.expando,bB=bx.nodeType,bu=bB?b.cache:bx,bw=bB?bx[b.expando]:b.expando;if(!bu[bw]){return}if(bv){var bz=by?bu[bw][bA]:bu[bw];if(bz){delete bz[bv];if(!U(bz)){return}}}if(by){delete bu[bw][bA];if(!U(bu[bw])){return}}var bt=bu[bw][bA];if(b.support.deleteExpando||bu!=ba){delete bu[bw]}else{bu[bw]=null}if(bt){bu[bw]={};if(!bB){bu[bw].toJSON=b.noop}bu[bw][bA]=bt}else{if(bB){if(b.support.deleteExpando){delete bx[b.expando]}else{if(bx.removeAttribute){bx.removeAttribute(b.expando)}else{bx[b.expando]=null}}}}},_data:function(bu,bt,bv){return b.data(bu,bt,bv,true)},acceptData:function(bu){if(bu.nodeName){var bt=b.noData[bu.nodeName.toLowerCase()];if(bt){return !(bt===true||bu.getAttribute("classid")!==bt)}}return true}});b.fn.extend({data:function(bx,bz){var by=null;if(typeof bx==="undefined"){if(this.length){by=b.data(this[0]);if(this[0].nodeType===1){var bt=this[0].attributes,bv;for(var bw=0,bu=bt.length;bw<bu;bw++){bv=bt[bw].name;if(bv.indexOf("data-")===0){bv=b.camelCase(bv.substring(5));a3(this[0],bv,by[bv])}}}}return by}else{if(typeof bx==="object"){return this.each(function(){b.data(this,bx)})}}var bA=bx.split(".");bA[1]=bA[1]?"."+bA[1]:"";if(bz===K){by=this.triggerHandler("getData"+bA[1]+"!",[bA[0]]);if(by===K&&this.length){by=b.data(this[0],bx);by=a3(this[0],bx,by)}return by===K&&bA[1]?this.data(bA[0]):by}else{return this.each(function(){var bC=b(this),bB=[bA[0],bz];bC.triggerHandler("setData"+bA[1]+"!",bB);b.data(this,bx,bz);bC.triggerHandler("changeData"+bA[1]+"!",bB)})}},removeData:function(bt){return this.each(function(){b.removeData(this,bt)})}});function a3(bv,bu,bw){if(bw===K&&bv.nodeType===1){var bt="data-"+bu.replace(ax,"$1-$2").toLowerCase();bw=bv.getAttribute(bt);if(typeof bw==="string"){try{bw=bw==="true"?true:bw==="false"?false:bw==="null"?null:!b.isNaN(bw)?parseFloat(bw):aN.test(bw)?b.parseJSON(bw):bw}catch(bx){}b.data(bv,bu,bw)}else{bw=K}}return bw}function U(bu){for(var bt in bu){if(bt!=="toJSON"){return false}}return true}function bf(bx,bw,bz){var bv=bw+"defer",bu=bw+"queue",bt=bw+"mark",by=b.data(bx,bv,K,true);if(by&&(bz==="queue"||!b.data(bx,bu,K,true))&&(bz==="mark"||!b.data(bx,bt,K,true))){setTimeout(function(){if(!b.data(bx,bu,K,true)&&!b.data(bx,bt,K,true)){b.removeData(bx,bv,true);by.resolve()}},0)}}b.extend({_mark:function(bu,bt){if(bu){bt=(bt||"fx")+"mark";b.data(bu,bt,(b.data(bu,bt,K,true)||0)+1,true)}},_unmark:function(bx,bw,bu){if(bx!==true){bu=bw;bw=bx;bx=false}if(bw){bu=bu||"fx";var bt=bu+"mark",bv=bx?0:((b.data(bw,bt,K,true)||1)-1);if(bv){b.data(bw,bt,bv,true)}else{b.removeData(bw,bt,true);bf(bw,bu,"mark")}}},queue:function(bu,bt,bw){if(bu){bt=(bt||"fx")+"queue";var bv=b.data(bu,bt,K,true);if(bw){if(!bv||b.isArray(bw)){bv=b.data(bu,bt,b.makeArray(bw),true)}else{bv.push(bw)}}return bv||[]}},dequeue:function(bw,bv){bv=bv||"fx";var bt=b.queue(bw,bv),bu=bt.shift(),bx;if(bu==="inprogress"){bu=bt.shift()}if(bu){if(bv==="fx"){bt.unshift("inprogress")}bu.call(bw,function(){b.dequeue(bw,bv)})}if(!bt.length){b.removeData(bw,bv+"queue",true);bf(bw,bv,"queue")}}});b.fn.extend({queue:function(bt,bu){if(typeof bt!=="string"){bu=bt;bt="fx"}if(bu===K){return b.queue(this[0],bt)}return this.each(function(){var bv=b.queue(this,bt,bu);if(bt==="fx"&&bv[0]!=="inprogress"){b.dequeue(this,bt)}})},dequeue:function(bt){return this.each(function(){b.dequeue(this,bt)})},delay:function(bu,bt){bu=b.fx?b.fx.speeds[bu]||bu:bu;bt=bt||"fx";return this.queue(bt,function(){var bv=this;setTimeout(function(){b.dequeue(bv,bt)},bu)})},clearQueue:function(bt){return this.queue(bt||"fx",[])},promise:function(bC,bv){if(typeof bC!=="string"){bv=bC;bC=K}bC=bC||"fx";var bt=b.Deferred(),bu=this,bx=bu.length,bA=1,by=bC+"defer",bz=bC+"queue",bB=bC+"mark",bw;function bD(){if(!(--bA)){bt.resolveWith(bu,[bu])}}while(bx--){if((bw=b.data(bu[bx],by,K,true)||(b.data(bu[bx],bz,K,true)||b.data(bu[bx],bB,K,true))&&b.data(bu[bx],by,b._Deferred(),true))){bA++;bw.done(bD)}}bD();return bt.promise()}});var aL=/[\n\t\r]/g,ad=/\s+/,aP=/\r/g,g=/^(?:button|input)$/i,D=/^(?:button|input|object|select|textarea)$/i,l=/^a(?:rea)?$/i,al=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,a6=/\:|^on/,a1,aV;b.fn.extend({attr:function(bt,bu){return b.access(this,bt,bu,true,b.attr)},removeAttr:function(bt){return this.each(function(){b.removeAttr(this,bt)})},prop:function(bt,bu){return b.access(this,bt,bu,true,b.prop)},removeProp:function(bt){bt=b.propFix[bt]||bt;return this.each(function(){try{this[bt]=K;delete this[bt]}catch(bu){}})},addClass:function(bx){var bz,bv,bu,bw,by,bA,bt;if(b.isFunction(bx)){return this.each(function(bB){b(this).addClass(bx.call(this,bB,this.className))})}if(bx&&typeof bx==="string"){bz=bx.split(ad);for(bv=0,bu=this.length;bv<bu;bv++){bw=this[bv];if(bw.nodeType===1){if(!bw.className&&bz.length===1){bw.className=bx}else{by=" "+bw.className+" ";for(bA=0,bt=bz.length;bA<bt;bA++){if(!~by.indexOf(" "+bz[bA]+" ")){by+=bz[bA]+" "}}bw.className=b.trim(by)}}}}return this},removeClass:function(by){var bz,bv,bu,bx,bw,bA,bt;if(b.isFunction(by)){return this.each(function(bB){b(this).removeClass(by.call(this,bB,this.className))})}if((by&&typeof by==="string")||by===K){bz=(by||"").split(ad);for(bv=0,bu=this.length;bv<bu;bv++){bx=this[bv];if(bx.nodeType===1&&bx.className){if(by){bw=(" "+bx.className+" ").replace(aL," ");for(bA=0,bt=bz.length;bA<bt;bA++){bw=bw.replace(" "+bz[bA]+" "," ")}bx.className=b.trim(bw)}else{bx.className=""}}}}return this},toggleClass:function(bw,bu){var bv=typeof bw,bt=typeof bu==="boolean";if(b.isFunction(bw)){return this.each(function(bx){b(this).toggleClass(bw.call(this,bx,this.className,bu),bu)})}return this.each(function(){if(bv==="string"){var bz,by=0,bx=b(this),bA=bu,bB=bw.split(ad);while((bz=bB[by++])){bA=bt?bA:!bx.hasClass(bz);bx[bA?"addClass":"removeClass"](bz)}}else{if(bv==="undefined"||bv==="boolean"){if(this.className){b._data(this,"__className__",this.className)}this.className=this.className||bw===false?"":b._data(this,"__className__")||""}}})},hasClass:function(bt){var bw=" "+bt+" ";for(var bv=0,bu=this.length;bv<bu;bv++){if((" "+this[bv].className+" ").replace(aL," ").indexOf(bw)>-1){return true}}return false},val:function(bw){var bt,bu,bv=this[0];if(!arguments.length){if(bv){bt=b.valHooks[bv.nodeName.toLowerCase()]||b.valHooks[bv.type];if(bt&&"get" in bt&&(bu=bt.get(bv,"value"))!==K){return bu}bu=bv.value;return typeof bu==="string"?bu.replace(aP,""):bu==null?"":bu}return K}var bx=b.isFunction(bw);return this.each(function(bz){var by=b(this),bA;if(this.nodeType!==1){return}if(bx){bA=bw.call(this,bz,by.val())}else{bA=bw}if(bA==null){bA=""}else{if(typeof bA==="number"){bA+=""}else{if(b.isArray(bA)){bA=b.map(bA,function(bB){return bB==null?"":bB+""})}}}bt=b.valHooks[this.nodeName.toLowerCase()]||b.valHooks[this.type];if(!bt||!("set" in bt)||bt.set(this,bA,"value")===K){this.value=bA}})}});b.extend({valHooks:{option:{get:function(bt){var bu=bt.attributes.value;return !bu||bu.specified?bt.value:bt.text}},select:{get:function(bt){var bz,bx=bt.selectedIndex,bA=[],bB=bt.options,bw=bt.type==="select-one";if(bx<0){return null}for(var bu=bw?bx:0,by=bw?bx+1:bB.length;bu<by;bu++){var bv=bB[bu];if(bv.selected&&(b.support.optDisabled?!bv.disabled:bv.getAttribute("disabled")===null)&&(!bv.parentNode.disabled||!b.nodeName(bv.parentNode,"optgroup"))){bz=b(bv).val();if(bw){return bz}bA.push(bz)}}if(bw&&!bA.length&&bB.length){return b(bB[bx]).val()}return bA},set:function(bu,bv){var bt=b.makeArray(bv);b(bu).find("option").each(function(){this.selected=b.inArray(b(this).val(),bt)>=0});if(!bt.length){bu.selectedIndex=-1}return bt}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attrFix:{tabindex:"tabIndex"},attr:function(bz,bw,bA,by){var bu=bz.nodeType;if(!bz||bu===3||bu===8||bu===2){return K}if(by&&bw in b.attrFn){return b(bz)[bw](bA)}if(!("getAttribute" in bz)){return b.prop(bz,bw,bA)}var bv,bt,bx=bu!==1||!b.isXMLDoc(bz);if(bx){bw=b.attrFix[bw]||bw;bt=b.attrHooks[bw];if(!bt){if(al.test(bw)){bt=aV}else{if(a1&&bw!=="className"&&(b.nodeName(bz,"form")||a6.test(bw))){bt=a1}}}}if(bA!==K){if(bA===null){b.removeAttr(bz,bw);return K}else{if(bt&&"set" in bt&&bx&&(bv=bt.set(bz,bA,bw))!==K){return bv}else{bz.setAttribute(bw,""+bA);return bA}}}else{if(bt&&"get" in bt&&bx&&(bv=bt.get(bz,bw))!==null){return bv}else{bv=bz.getAttribute(bw);return bv===null?K:bv}}},removeAttr:function(bu,bt){var bv;if(bu.nodeType===1){bt=b.attrFix[bt]||bt;if(b.support.getSetAttribute){bu.removeAttribute(bt)}else{b.attr(bu,bt,"");bu.removeAttributeNode(bu.getAttributeNode(bt))}if(al.test(bt)&&(bv=b.propFix[bt]||bt) in bu){bu[bv]=false}}},attrHooks:{type:{set:function(bt,bu){if(g.test(bt.nodeName)&&bt.parentNode){b.error("type property can't be changed")}else{if(!b.support.radioValue&&bu==="radio"&&b.nodeName(bt,"input")){var bv=bt.value;bt.setAttribute("type",bu);if(bv){bt.value=bv}return bu}}}},tabIndex:{get:function(bu){var bt=bu.getAttributeNode("tabIndex");return bt&&bt.specified?parseInt(bt.value,10):D.test(bu.nodeName)||l.test(bu.nodeName)&&bu.href?0:K}},value:{get:function(bu,bt){if(a1&&b.nodeName(bu,"button")){return a1.get(bu,bt)}return bt in bu?bu.value:null},set:function(bu,bv,bt){if(a1&&b.nodeName(bu,"button")){return a1.set(bu,bv,bt)}bu.value=bv}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(by,bw,bz){var bu=by.nodeType;if(!by||bu===3||bu===8||bu===2){return K}var bv,bt,bx=bu!==1||!b.isXMLDoc(by);if(bx){bw=b.propFix[bw]||bw;bt=b.propHooks[bw]}if(bz!==K){if(bt&&"set" in bt&&(bv=bt.set(by,bz,bw))!==K){return bv}else{return(by[bw]=bz)}}else{if(bt&&"get" in bt&&(bv=bt.get(by,bw))!==K){return bv}else{return by[bw]}}},propHooks:{}});aV={get:function(bu,bt){return b.prop(bu,bt)?bt.toLowerCase():K},set:function(bu,bw,bt){var bv;if(bw===false){b.removeAttr(bu,bt)}else{bv=b.propFix[bt]||bt;if(bv in bu){bu[bv]=true}bu.setAttribute(bt,bt.toLowerCase())}return bt}};if(!b.support.getSetAttribute){b.attrFix=b.propFix;a1=b.attrHooks.name=b.attrHooks.title=b.valHooks.button={get:function(bv,bu){var bt;bt=bv.getAttributeNode(bu);return bt&&bt.nodeValue!==""?bt.nodeValue:K},set:function(bv,bw,bu){var bt=bv.getAttributeNode(bu);if(bt){bt.nodeValue=bw;return bw}}};b.each(["width","height"],function(bu,bt){b.attrHooks[bt]=b.extend(b.attrHooks[bt],{set:function(bv,bw){if(bw===""){bv.setAttribute(bt,"auto");return bw}}})})}if(!b.support.hrefNormalized){b.each(["href","src","width","height"],function(bu,bt){b.attrHooks[bt]=b.extend(b.attrHooks[bt],{get:function(bw){var bv=bw.getAttribute(bt,2);return bv===null?K:bv}})})}if(!b.support.style){b.attrHooks.style={get:function(bt){return bt.style.cssText.toLowerCase()||K},set:function(bt,bu){return(bt.style.cssText=""+bu)}}}if(!b.support.optSelected){b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(bu){var bt=bu.parentNode;if(bt){bt.selectedIndex;if(bt.parentNode){bt.parentNode.selectedIndex}}}})}if(!b.support.checkOn){b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(bt){return bt.getAttribute("value")===null?"on":bt.value}}})}b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(bt,bu){if(b.isArray(bu)){return(bt.checked=b.inArray(b(bt).val(),bu)>=0)}}})});var aX=/\.(.*)$/,bc=/^(?:textarea|input|select)$/i,O=/\./g,bg=/ /g,aD=/[^\w\s.|`]/g,G=function(bt){return bt.replace(aD,"\\$&")};b.event={add:function(bw,bA,bF,by){if(bw.nodeType===3||bw.nodeType===8){return}if(bF===false){bF=bi}else{if(!bF){return}}var bu,bE;if(bF.handler){bu=bF;bF=bu.handler}if(!bF.guid){bF.guid=b.guid++}var bB=b._data(bw);if(!bB){return}var bG=bB.events,bz=bB.handle;if(!bG){bB.events=bG={}}if(!bz){bB.handle=bz=function(bH){return typeof b!=="undefined"&&(!bH||b.event.triggered!==bH.type)?b.event.handle.apply(bz.elem,arguments):K}}bz.elem=bw;bA=bA.split(" ");var bD,bx=0,bt;while((bD=bA[bx++])){bE=bu?b.extend({},bu):{handler:bF,data:by};if(bD.indexOf(".")>-1){bt=bD.split(".");bD=bt.shift();bE.namespace=bt.slice(0).sort().join(".")}else{bt=[];bE.namespace=""}bE.type=bD;if(!bE.guid){bE.guid=bF.guid}var bv=bG[bD],bC=b.event.special[bD]||{};if(!bv){bv=bG[bD]=[];if(!bC.setup||bC.setup.call(bw,by,bt,bz)===false){if(bw.addEventListener){bw.addEventListener(bD,bz,false)}else{if(bw.attachEvent){bw.attachEvent("on"+bD,bz)}}}}if(bC.add){bC.add.call(bw,bE);if(!bE.handler.guid){bE.handler.guid=bF.guid}}bv.push(bE);b.event.global[bD]=true}bw=null},global:{},remove:function(bI,bD,bv,bz){if(bI.nodeType===3||bI.nodeType===8){return}if(bv===false){bv=bi}var bL,by,bA,bF,bG=0,bw,bB,bE,bx,bC,bt,bK,bH=b.hasData(bI)&&b._data(bI),bu=bH&&bH.events;if(!bH||!bu){return}if(bD&&bD.type){bv=bD.handler;bD=bD.type}if(!bD||typeof bD==="string"&&bD.charAt(0)==="."){bD=bD||"";for(by in bu){b.event.remove(bI,by+bD)}return}bD=bD.split(" ");while((by=bD[bG++])){bK=by;bt=null;bw=by.indexOf(".")<0;bB=[];if(!bw){bB=by.split(".");by=bB.shift();bE=new RegExp("(^|\\.)"+b.map(bB.slice(0).sort(),G).join("\\.(?:.*\\.)?")+"(\\.|$)")}bC=bu[by];if(!bC){continue}if(!bv){for(bF=0;bF<bC.length;bF++){bt=bC[bF];if(bw||bE.test(bt.namespace)){b.event.remove(bI,bK,bt.handler,bF);bC.splice(bF--,1)}}continue}bx=b.event.special[by]||{};for(bF=bz||0;bF<bC.length;bF++){bt=bC[bF];if(bv.guid===bt.guid){if(bw||bE.test(bt.namespace)){if(bz==null){bC.splice(bF--,1)}if(bx.remove){bx.remove.call(bI,bt)}}if(bz!=null){break}}}if(bC.length===0||bz!=null&&bC.length===1){if(!bx.teardown||bx.teardown.call(bI,bB)===false){b.removeEvent(bI,by,bH.handle)}bL=null;delete bu[by]}}if(b.isEmptyObject(bu)){var bJ=bH.handle;if(bJ){bJ.elem=null}delete bH.events;delete bH.handle;if(b.isEmptyObject(bH)){b.removeData(bI,K,true)}}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(bt,bA,by,bF){var bD=bt.type||bt,bv=[],bu;if(bD.indexOf("!")>=0){bD=bD.slice(0,-1);bu=true}if(bD.indexOf(".")>=0){bv=bD.split(".");bD=bv.shift();bv.sort()}if((!by||b.event.customEvent[bD])&&!b.event.global[bD]){return}bt=typeof bt==="object"?bt[b.expando]?bt:new b.Event(bD,bt):new b.Event(bD);bt.type=bD;bt.exclusive=bu;bt.namespace=bv.join(".");bt.namespace_re=new RegExp("(^|\\.)"+bv.join("\\.(?:.*\\.)?")+"(\\.|$)");if(bF||!by){bt.preventDefault();bt.stopPropagation()}if(!by){b.each(b.cache,function(){var bH=b.expando,bG=this[bH];if(bG&&bG.events&&bG.events[bD]){b.event.trigger(bt,bA,bG.handle.elem)}});return}if(by.nodeType===3||by.nodeType===8){return}bt.result=K;bt.target=by;bA=bA!=null?b.makeArray(bA):[];bA.unshift(bt);var bE=by,bw=bD.indexOf(":")<0?"on"+bD:"";do{var bB=b._data(bE,"handle");bt.currentTarget=bE;if(bB){bB.apply(bE,bA)}if(bw&&b.acceptData(bE)&&bE[bw]&&bE[bw].apply(bE,bA)===false){bt.result=false;bt.preventDefault()}bE=bE.parentNode||bE.ownerDocument||bE===bt.target.ownerDocument&&ba}while(bE&&!bt.isPropagationStopped());if(!bt.isDefaultPrevented()){var bx,bC=b.event.special[bD]||{};if((!bC._default||bC._default.call(by.ownerDocument,bt)===false)&&!(bD==="click"&&b.nodeName(by,"a"))&&b.acceptData(by)){try{if(bw&&by[bD]){bx=by[bw];if(bx){by[bw]=null}b.event.triggered=bD;by[bD]()}}catch(bz){}if(bx){by[bw]=bx}b.event.triggered=K}}return bt.result},handle:function(bA){bA=b.event.fix(bA||ba.event);var bu=((b._data(this,"events")||{})[bA.type]||[]).slice(0),bz=!bA.exclusive&&!bA.namespace,bx=Array.prototype.slice.call(arguments,0);bx[0]=bA;bA.currentTarget=this;for(var bw=0,bt=bu.length;bw<bt;bw++){var by=bu[bw];if(bz||bA.namespace_re.test(by.namespace)){bA.handler=by.handler;bA.data=by.data;bA.handleObj=by;var bv=by.handler.apply(this,bx);if(bv!==K){bA.result=bv;if(bv===false){bA.preventDefault();bA.stopPropagation()}}if(bA.isImmediatePropagationStopped()){break}}}return bA.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(bx){if(bx[b.expando]){return bx}var bu=bx;bx=b.Event(bu);for(var bv=this.props.length,bz;bv;){bz=this.props[--bv];bx[bz]=bu[bz]}if(!bx.target){bx.target=bx.srcElement||ar}if(bx.target.nodeType===3){bx.target=bx.target.parentNode}if(!bx.relatedTarget&&bx.fromElement){bx.relatedTarget=bx.fromElement===bx.target?bx.toElement:bx.fromElement}if(bx.pageX==null&&bx.clientX!=null){var bw=bx.target.ownerDocument||ar,by=bw.documentElement,bt=bw.body;bx.pageX=bx.clientX+(by&&by.scrollLeft||bt&&bt.scrollLeft||0)-(by&&by.clientLeft||bt&&bt.clientLeft||0);bx.pageY=bx.clientY+(by&&by.scrollTop||bt&&bt.scrollTop||0)-(by&&by.clientTop||bt&&bt.clientTop||0)}if(bx.which==null&&(bx.charCode!=null||bx.keyCode!=null)){bx.which=bx.charCode!=null?bx.charCode:bx.keyCode}if(!bx.metaKey&&bx.ctrlKey){bx.metaKey=bx.ctrlKey}if(!bx.which&&bx.button!==K){bx.which=(bx.button&1?1:(bx.button&2?3:(bx.button&4?2:0)))}return bx},guid:100000000,proxy:b.proxy,special:{ready:{setup:b.bindReady,teardown:b.noop},live:{add:function(bt){b.event.add(this,p(bt.origType,bt.selector),b.extend({},bt,{handler:aj,guid:bt.handler.guid}))},remove:function(bt){b.event.remove(this,p(bt.origType,bt.selector),bt)}},beforeunload:{setup:function(bv,bu,bt){if(b.isWindow(this)){this.onbeforeunload=bt}},teardown:function(bu,bt){if(this.onbeforeunload===bt){this.onbeforeunload=null}}}}};b.removeEvent=ar.removeEventListener?function(bu,bt,bv){if(bu.removeEventListener){bu.removeEventListener(bt,bv,false)}}:function(bu,bt,bv){if(bu.detachEvent){bu.detachEvent("on"+bt,bv)}};b.Event=function(bu,bt){if(!this.preventDefault){return new b.Event(bu,bt)}if(bu&&bu.type){this.originalEvent=bu;this.type=bu.type;this.isDefaultPrevented=(bu.defaultPrevented||bu.returnValue===false||bu.getPreventDefault&&bu.getPreventDefault())?i:bi}else{this.type=bu}if(bt){b.extend(this,bt)}this.timeStamp=b.now();this[b.expando]=true};function bi(){return false}function i(){return true}b.Event.prototype={preventDefault:function(){this.isDefaultPrevented=i;var bt=this.originalEvent;if(!bt){return}if(bt.preventDefault){bt.preventDefault()}else{bt.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=i;var bt=this.originalEvent;if(!bt){return}if(bt.stopPropagation){bt.stopPropagation()}bt.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i;this.stopPropagation()},isDefaultPrevented:bi,isPropagationStopped:bi,isImmediatePropagationStopped:bi};var ac=function(bv){var bw=bv.relatedTarget,bt=false,bu=bv.type;bv.type=bv.data;if(bw!==this){if(bw){bt=b.contains(this,bw)}if(!bt){b.event.handle.apply(this,arguments);bv.type=bu}}},aS=function(bt){bt.type=bt.data;b.event.handle.apply(this,arguments)};b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(bu,bt){b.event.special[bu]={setup:function(bv){b.event.add(this,bt,bv&&bv.selector?aS:ac,bu)},teardown:function(bv){b.event.remove(this,bt,bv&&bv.selector?aS:ac)}}});if(!b.support.submitBubbles){b.event.special.submit={setup:function(bu,bt){if(!b.nodeName(this,"form")){b.event.add(this,"click.specialSubmit",function(bx){var bw=bx.target,bv=bw.type;if((bv==="submit"||bv==="image")&&b(bw).closest("form").length){aU("submit",this,arguments)}});b.event.add(this,"keypress.specialSubmit",function(bx){var bw=bx.target,bv=bw.type;if((bv==="text"||bv==="password")&&b(bw).closest("form").length&&bx.keyCode===13){aU("submit",this,arguments)}})}else{return false}},teardown:function(bt){b.event.remove(this,".specialSubmit")}}}if(!b.support.changeBubbles){var bl,k=function(bu){var bt=bu.type,bv=bu.value;if(bt==="radio"||bt==="checkbox"){bv=bu.checked}else{if(bt==="select-multiple"){bv=bu.selectedIndex>-1?b.map(bu.options,function(bw){return bw.selected}).join("-"):""}else{if(b.nodeName(bu,"select")){bv=bu.selectedIndex}}}return bv},aa=function aa(bv){var bt=bv.target,bu,bw;if(!bc.test(bt.nodeName)||bt.readOnly){return}bu=b._data(bt,"_change_data");bw=k(bt);if(bv.type!=="focusout"||bt.type!=="radio"){b._data(bt,"_change_data",bw)}if(bu===K||bw===bu){return}if(bu!=null||bw){bv.type="change";bv.liveFired=K;b.event.trigger(bv,arguments[1],bt)}};b.event.special.change={filters:{focusout:aa,beforedeactivate:aa,click:function(bv){var bu=bv.target,bt=b.nodeName(bu,"input")?bu.type:"";if(bt==="radio"||bt==="checkbox"||b.nodeName(bu,"select")){aa.call(this,bv)}},keydown:function(bv){var bu=bv.target,bt=b.nodeName(bu,"input")?bu.type:"";if((bv.keyCode===13&&!b.nodeName(bu,"textarea"))||(bv.keyCode===32&&(bt==="checkbox"||bt==="radio"))||bt==="select-multiple"){aa.call(this,bv)}},beforeactivate:function(bu){var bt=bu.target;b._data(bt,"_change_data",k(bt))}},setup:function(bv,bu){if(this.type==="file"){return false}for(var bt in bl){b.event.add(this,bt+".specialChange",bl[bt])}return bc.test(this.nodeName)},teardown:function(bt){b.event.remove(this,".specialChange");return bc.test(this.nodeName)}};bl=b.event.special.change.filters;bl.focus=bl.beforeactivate}function aU(bu,bw,bt){var bv=b.extend({},bt[0]);bv.type=bu;bv.originalEvent={};bv.liveFired=K;b.event.handle.call(bw,bv);if(bv.isDefaultPrevented()){bt[0].preventDefault()}}if(!b.support.focusinBubbles){b.each({focus:"focusin",blur:"focusout"},function(bw,bt){var bu=0;b.event.special[bt]={setup:function(){if(bu++===0){ar.addEventListener(bw,bv,true)}},teardown:function(){if(--bu===0){ar.removeEventListener(bw,bv,true)}}};function bv(bx){var by=b.event.fix(bx);by.type=bt;by.originalEvent={};b.event.trigger(by,null,by.target);if(by.isDefaultPrevented()){bx.preventDefault()}}})}b.each(["bind","one"],function(bu,bt){b.fn[bt]=function(bA,bB,bz){var by;if(typeof bA==="object"){for(var bx in bA){this[bt](bx,bB,bA[bx],bz)}return this}if(arguments.length===2||bB===false){bz=bB;bB=K}if(bt==="one"){by=function(bC){b(this).unbind(bC,by);return bz.apply(this,arguments)};by.guid=bz.guid||b.guid++}else{by=bz}if(bA==="unload"&&bt!=="one"){this.one(bA,bB,bz)}else{for(var bw=0,bv=this.length;bw<bv;bw++){b.event.add(this[bw],bA,by,bB)}}return this}});b.fn.extend({unbind:function(bx,bw){if(typeof bx==="object"&&!bx.preventDefault){for(var bv in bx){this.unbind(bv,bx[bv])}}else{for(var bu=0,bt=this.length;bu<bt;bu++){b.event.remove(this[bu],bx,bw)}}return this},delegate:function(bt,bu,bw,bv){return this.live(bu,bw,bv,bt)},undelegate:function(bt,bu,bv){if(arguments.length===0){return this.unbind("live")}else{return this.die(bu,null,bv,bt)}},trigger:function(bt,bu){return this.each(function(){b.event.trigger(bt,bu,this)})},triggerHandler:function(bt,bu){if(this[0]){return b.event.trigger(bt,bu,this[0],true)}},toggle:function(bw){var bu=arguments,bt=bw.guid||b.guid++,bv=0,bx=function(by){var bz=(b.data(this,"lastToggle"+bw.guid)||0)%bv;b.data(this,"lastToggle"+bw.guid,bz+1);by.preventDefault();return bu[bz].apply(this,arguments)||false};bx.guid=bt;while(bv<bu.length){bu[bv++].guid=bt}return this.click(bx)},hover:function(bt,bu){return this.mouseenter(bt).mouseleave(bu||bt)}});var aQ={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};b.each(["live","die"],function(bu,bt){b.fn[bt]=function(bE,bB,bG,bx){var bF,bC=0,bD,bw,bI,bz=bx||this.selector,bv=bx?this:b(this.context);if(typeof bE==="object"&&!bE.preventDefault){for(var bH in bE){bv[bt](bH,bB,bE[bH],bz)}return this}if(bt==="die"&&!bE&&bx&&bx.charAt(0)==="."){bv.unbind(bx);return this}if(bB===false||b.isFunction(bB)){bG=bB||bi;bB=K}bE=(bE||"").split(" ");while((bF=bE[bC++])!=null){bD=aX.exec(bF);bw="";if(bD){bw=bD[0];bF=bF.replace(aX,"")}if(bF==="hover"){bE.push("mouseenter"+bw,"mouseleave"+bw);continue}bI=bF;if(aQ[bF]){bE.push(aQ[bF]+bw);bF=bF+bw}else{bF=(aQ[bF]||bF)+bw}if(bt==="live"){for(var bA=0,by=bv.length;bA<by;bA++){b.event.add(bv[bA],"live."+p(bF,bz),{data:bB,selector:bz,handler:bG,origType:bF,origHandler:bG,preType:bI})}}else{bv.unbind("live."+p(bF,bz),bG)}}return this}});function aj(bE){var bB,bw,bK,by,bt,bG,bD,bF,bC,bJ,bA,bz,bI,bH=[],bx=[],bu=b._data(this,"events");if(bE.liveFired===this||!bu||!bu.live||bE.target.disabled||bE.button&&bE.type==="click"){return}if(bE.namespace){bz=new RegExp("(^|\\.)"+bE.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")}bE.liveFired=this;var bv=bu.live.slice(0);for(bD=0;bD<bv.length;bD++){bt=bv[bD];if(bt.origType.replace(aX,"")===bE.type){bx.push(bt.selector)}else{bv.splice(bD--,1)}}by=b(bE.target).closest(bx,bE.currentTarget);for(bF=0,bC=by.length;bF<bC;bF++){bA=by[bF];for(bD=0;bD<bv.length;bD++){bt=bv[bD];if(bA.selector===bt.selector&&(!bz||bz.test(bt.namespace))&&!bA.elem.disabled){bG=bA.elem;bK=null;if(bt.preType==="mouseenter"||bt.preType==="mouseleave"){bE.type=bt.preType;bK=b(bE.relatedTarget).closest(bt.selector)[0];if(bK&&b.contains(bG,bK)){bK=bG}}if(!bK||bK!==bG){bH.push({elem:bG,handleObj:bt,level:bA.level})}}}}for(bF=0,bC=bH.length;bF<bC;bF++){by=bH[bF];if(bw&&by.level>bw){break}bE.currentTarget=by.elem;bE.data=by.handleObj.data;bE.handleObj=by.handleObj;bI=by.handleObj.origHandler.apply(by.elem,arguments);if(bI===false||bE.isPropagationStopped()){bw=by.level;if(bI===false){bB=false}if(bE.isImmediatePropagationStopped()){break}}}return bB}function p(bu,bt){return(bu&&bu!=="*"?bu+".":"")+bt.replace(O,"`").replace(bg,"&")}b.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error").split(" "),function(bu,bt){b.fn[bt]=function(bw,bv){if(bv==null){bv=bw;bw=null}return arguments.length>0?this.bind(bt,bw,bv):this.trigger(bt)};if(b.attrFn){b.attrFn[bt]=true}});
/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var bD=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,bE=0,bH=Object.prototype.toString,by=false,bx=true,bF=/\\/g,bL=/\W/;[0,0].sort(function(){bx=false;return 0});var bv=function(bR,bM,bU,bV){bU=bU||[];bM=bM||ar;var bX=bM;if(bM.nodeType!==1&&bM.nodeType!==9){return[]}if(!bR||typeof bR!=="string"){return bU}var bO,bZ,b2,bN,bY,b1,b0,bT,bQ=true,bP=bv.isXML(bM),bS=[],bW=bR;do{bD.exec("");bO=bD.exec(bW);if(bO){bW=bO[3];bS.push(bO[1]);if(bO[2]){bN=bO[3];break}}}while(bO);if(bS.length>1&&bz.exec(bR)){if(bS.length===2&&bA.relative[bS[0]]){bZ=bI(bS[0]+bS[1],bM)}else{bZ=bA.relative[bS[0]]?[bM]:bv(bS.shift(),bM);while(bS.length){bR=bS.shift();if(bA.relative[bR]){bR+=bS.shift()}bZ=bI(bR,bZ)}}}else{if(!bV&&bS.length>1&&bM.nodeType===9&&!bP&&bA.match.ID.test(bS[0])&&!bA.match.ID.test(bS[bS.length-1])){bY=bv.find(bS.shift(),bM,bP);bM=bY.expr?bv.filter(bY.expr,bY.set)[0]:bY.set[0]}if(bM){bY=bV?{expr:bS.pop(),set:bB(bV)}:bv.find(bS.pop(),bS.length===1&&(bS[0]==="~"||bS[0]==="+")&&bM.parentNode?bM.parentNode:bM,bP);bZ=bY.expr?bv.filter(bY.expr,bY.set):bY.set;if(bS.length>0){b2=bB(bZ)}else{bQ=false}while(bS.length){b1=bS.pop();b0=b1;if(!bA.relative[b1]){b1=""}else{b0=bS.pop()}if(b0==null){b0=bM}bA.relative[b1](b2,b0,bP)}}else{b2=bS=[]}}if(!b2){b2=bZ}if(!b2){bv.error(b1||bR)}if(bH.call(b2)==="[object Array]"){if(!bQ){bU.push.apply(bU,b2)}else{if(bM&&bM.nodeType===1){for(bT=0;b2[bT]!=null;bT++){if(b2[bT]&&(b2[bT]===true||b2[bT].nodeType===1&&bv.contains(bM,b2[bT]))){bU.push(bZ[bT])}}}else{for(bT=0;b2[bT]!=null;bT++){if(b2[bT]&&b2[bT].nodeType===1){bU.push(bZ[bT])}}}}}else{bB(b2,bU)}if(bN){bv(bN,bX,bU,bV);bv.uniqueSort(bU)}return bU};bv.uniqueSort=function(bN){if(bG){by=bx;bN.sort(bG);if(by){for(var bM=1;bM<bN.length;bM++){if(bN[bM]===bN[bM-1]){bN.splice(bM--,1)}}}}return bN};bv.matches=function(bM,bN){return bv(bM,null,null,bN)};bv.matchesSelector=function(bM,bN){return bv(bN,null,null,[bM]).length>0};bv.find=function(bT,bM,bU){var bS;if(!bT){return[]}for(var bP=0,bO=bA.order.length;bP<bO;bP++){var bQ,bR=bA.order[bP];if((bQ=bA.leftMatch[bR].exec(bT))){var bN=bQ[1];bQ.splice(1,1);if(bN.substr(bN.length-1)!=="\\"){bQ[1]=(bQ[1]||"").replace(bF,"");bS=bA.find[bR](bQ,bM,bU);if(bS!=null){bT=bT.replace(bA.match[bR],"");break}}}}if(!bS){bS=typeof bM.getElementsByTagName!=="undefined"?bM.getElementsByTagName("*"):[]}return{set:bS,expr:bT}};bv.filter=function(bX,bW,b0,bQ){var bS,bM,bO=bX,b2=[],bU=bW,bT=bW&&bW[0]&&bv.isXML(bW[0]);while(bX&&bW.length){for(var bV in bA.filter){if((bS=bA.leftMatch[bV].exec(bX))!=null&&bS[2]){var b1,bZ,bN=bA.filter[bV],bP=bS[1];bM=false;bS.splice(1,1);if(bP.substr(bP.length-1)==="\\"){continue}if(bU===b2){b2=[]}if(bA.preFilter[bV]){bS=bA.preFilter[bV](bS,bU,b0,b2,bQ,bT);if(!bS){bM=b1=true}else{if(bS===true){continue}}}if(bS){for(var bR=0;(bZ=bU[bR])!=null;bR++){if(bZ){b1=bN(bZ,bS,bR,bU);var bY=bQ^!!b1;if(b0&&b1!=null){if(bY){bM=true}else{bU[bR]=false}}else{if(bY){b2.push(bZ);bM=true}}}}}if(b1!==K){if(!b0){bU=b2}bX=bX.replace(bA.match[bV],"");if(!bM){return[]}break}}}if(bX===bO){if(bM==null){bv.error(bX)}else{break}}bO=bX}return bU};bv.error=function(bM){throw"Syntax error, unrecognized expression: "+bM};var bA=bv.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(bM){return bM.getAttribute("href")},type:function(bM){return bM.getAttribute("type")}},relative:{"+":function(bS,bN){var bP=typeof bN==="string",bR=bP&&!bL.test(bN),bT=bP&&!bR;if(bR){bN=bN.toLowerCase()}for(var bO=0,bM=bS.length,bQ;bO<bM;bO++){if((bQ=bS[bO])){while((bQ=bQ.previousSibling)&&bQ.nodeType!==1){}bS[bO]=bT||bQ&&bQ.nodeName.toLowerCase()===bN?bQ||false:bQ===bN}}if(bT){bv.filter(bN,bS,true)}},">":function(bS,bN){var bR,bQ=typeof bN==="string",bO=0,bM=bS.length;if(bQ&&!bL.test(bN)){bN=bN.toLowerCase();for(;bO<bM;bO++){bR=bS[bO];if(bR){var bP=bR.parentNode;bS[bO]=bP.nodeName.toLowerCase()===bN?bP:false}}}else{for(;bO<bM;bO++){bR=bS[bO];if(bR){bS[bO]=bQ?bR.parentNode:bR.parentNode===bN}}if(bQ){bv.filter(bN,bS,true)}}},"":function(bP,bN,bR){var bQ,bO=bE++,bM=bJ;if(typeof bN==="string"&&!bL.test(bN)){bN=bN.toLowerCase();bQ=bN;bM=bt}bM("parentNode",bN,bO,bP,bQ,bR)},"~":function(bP,bN,bR){var bQ,bO=bE++,bM=bJ;if(typeof bN==="string"&&!bL.test(bN)){bN=bN.toLowerCase();bQ=bN;bM=bt}bM("previousSibling",bN,bO,bP,bQ,bR)}},find:{ID:function(bN,bO,bP){if(typeof bO.getElementById!=="undefined"&&!bP){var bM=bO.getElementById(bN[1]);return bM&&bM.parentNode?[bM]:[]}},NAME:function(bO,bR){if(typeof bR.getElementsByName!=="undefined"){var bN=[],bQ=bR.getElementsByName(bO[1]);for(var bP=0,bM=bQ.length;bP<bM;bP++){if(bQ[bP].getAttribute("name")===bO[1]){bN.push(bQ[bP])}}return bN.length===0?null:bN}},TAG:function(bM,bN){if(typeof bN.getElementsByTagName!=="undefined"){return bN.getElementsByTagName(bM[1])}}},preFilter:{CLASS:function(bP,bN,bO,bM,bS,bT){bP=" "+bP[1].replace(bF,"")+" ";if(bT){return bP}for(var bQ=0,bR;(bR=bN[bQ])!=null;bQ++){if(bR){if(bS^(bR.className&&(" "+bR.className+" ").replace(/[\t\n\r]/g," ").indexOf(bP)>=0)){if(!bO){bM.push(bR)}}else{if(bO){bN[bQ]=false}}}}return false},ID:function(bM){return bM[1].replace(bF,"")},TAG:function(bN,bM){return bN[1].replace(bF,"").toLowerCase()},CHILD:function(bM){if(bM[1]==="nth"){if(!bM[2]){bv.error(bM[0])}bM[2]=bM[2].replace(/^\+|\s*/g,"");var bN=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(bM[2]==="even"&&"2n"||bM[2]==="odd"&&"2n+1"||!/\D/.test(bM[2])&&"0n+"+bM[2]||bM[2]);bM[2]=(bN[1]+(bN[2]||1))-0;bM[3]=bN[3]-0}else{if(bM[2]){bv.error(bM[0])}}bM[0]=bE++;return bM},ATTR:function(bQ,bN,bO,bM,bR,bS){var bP=bQ[1]=bQ[1].replace(bF,"");if(!bS&&bA.attrMap[bP]){bQ[1]=bA.attrMap[bP]}bQ[4]=(bQ[4]||bQ[5]||"").replace(bF,"");if(bQ[2]==="~="){bQ[4]=" "+bQ[4]+" "}return bQ},PSEUDO:function(bQ,bN,bO,bM,bR){if(bQ[1]==="not"){if((bD.exec(bQ[3])||"").length>1||/^\w/.test(bQ[3])){bQ[3]=bv(bQ[3],null,null,bN)}else{var bP=bv.filter(bQ[3],bN,bO,true^bR);if(!bO){bM.push.apply(bM,bP)}return false}}else{if(bA.match.POS.test(bQ[0])||bA.match.CHILD.test(bQ[0])){return true}}return bQ},POS:function(bM){bM.unshift(true);return bM}},filters:{enabled:function(bM){return bM.disabled===false&&bM.type!=="hidden"},disabled:function(bM){return bM.disabled===true},checked:function(bM){return bM.checked===true},selected:function(bM){if(bM.parentNode){bM.parentNode.selectedIndex}return bM.selected===true},parent:function(bM){return !!bM.firstChild},empty:function(bM){return !bM.firstChild},has:function(bO,bN,bM){return !!bv(bM[3],bO).length},header:function(bM){return(/h\d/i).test(bM.nodeName)},text:function(bO){var bM=bO.getAttribute("type"),bN=bO.type;return bO.nodeName.toLowerCase()==="input"&&"text"===bN&&(bM===bN||bM===null)},radio:function(bM){return bM.nodeName.toLowerCase()==="input"&&"radio"===bM.type},checkbox:function(bM){return bM.nodeName.toLowerCase()==="input"&&"checkbox"===bM.type},file:function(bM){return bM.nodeName.toLowerCase()==="input"&&"file"===bM.type},password:function(bM){return bM.nodeName.toLowerCase()==="input"&&"password"===bM.type},submit:function(bN){var bM=bN.nodeName.toLowerCase();return(bM==="input"||bM==="button")&&"submit"===bN.type},image:function(bM){return bM.nodeName.toLowerCase()==="input"&&"image"===bM.type},reset:function(bN){var bM=bN.nodeName.toLowerCase();return(bM==="input"||bM==="button")&&"reset"===bN.type},button:function(bN){var bM=bN.nodeName.toLowerCase();return bM==="input"&&"button"===bN.type||bM==="button"},input:function(bM){return(/input|select|textarea|button/i).test(bM.nodeName)},focus:function(bM){return bM===bM.ownerDocument.activeElement}},setFilters:{first:function(bN,bM){return bM===0},last:function(bO,bN,bM,bP){return bN===bP.length-1},even:function(bN,bM){return bM%2===0},odd:function(bN,bM){return bM%2===1},lt:function(bO,bN,bM){return bN<bM[3]-0},gt:function(bO,bN,bM){return bN>bM[3]-0},nth:function(bO,bN,bM){return bM[3]-0===bN},eq:function(bO,bN,bM){return bM[3]-0===bN}},filter:{PSEUDO:function(bO,bT,bS,bU){var bM=bT[1],bN=bA.filters[bM];if(bN){return bN(bO,bS,bT,bU)}else{if(bM==="contains"){return(bO.textContent||bO.innerText||bv.getText([bO])||"").indexOf(bT[3])>=0}else{if(bM==="not"){var bP=bT[3];for(var bR=0,bQ=bP.length;bR<bQ;bR++){if(bP[bR]===bO){return false}}return true}else{bv.error(bM)}}}},CHILD:function(bM,bP){var bS=bP[1],bN=bM;switch(bS){case"only":case"first":while((bN=bN.previousSibling)){if(bN.nodeType===1){return false}}if(bS==="first"){return true}bN=bM;case"last":while((bN=bN.nextSibling)){if(bN.nodeType===1){return false}}return true;case"nth":var bO=bP[2],bV=bP[3];if(bO===1&&bV===0){return true}var bR=bP[0],bU=bM.parentNode;if(bU&&(bU.sizcache!==bR||!bM.nodeIndex)){var bQ=0;for(bN=bU.firstChild;bN;bN=bN.nextSibling){if(bN.nodeType===1){bN.nodeIndex=++bQ}}bU.sizcache=bR}var bT=bM.nodeIndex-bV;if(bO===0){return bT===0}else{return(bT%bO===0&&bT/bO>=0)}}},ID:function(bN,bM){return bN.nodeType===1&&bN.getAttribute("id")===bM},TAG:function(bN,bM){return(bM==="*"&&bN.nodeType===1)||bN.nodeName.toLowerCase()===bM},CLASS:function(bN,bM){return(" "+(bN.className||bN.getAttribute("class"))+" ").indexOf(bM)>-1},ATTR:function(bR,bP){var bO=bP[1],bM=bA.attrHandle[bO]?bA.attrHandle[bO](bR):bR[bO]!=null?bR[bO]:bR.getAttribute(bO),bS=bM+"",bQ=bP[2],bN=bP[4];return bM==null?bQ==="!=":bQ==="="?bS===bN:bQ==="*="?bS.indexOf(bN)>=0:bQ==="~="?(" "+bS+" ").indexOf(bN)>=0:!bN?bS&&bM!==false:bQ==="!="?bS!==bN:bQ==="^="?bS.indexOf(bN)===0:bQ==="$="?bS.substr(bS.length-bN.length)===bN:bQ==="|="?bS===bN||bS.substr(0,bN.length+1)===bN+"-":false},POS:function(bQ,bN,bO,bR){var bM=bN[2],bP=bA.setFilters[bM];if(bP){return bP(bQ,bO,bN,bR)}}}};var bz=bA.match.POS,bu=function(bN,bM){return"\\"+(bM-0+1)};for(var bw in bA.match){bA.match[bw]=new RegExp(bA.match[bw].source+(/(?![^\[]*\])(?![^\(]*\))/.source));bA.leftMatch[bw]=new RegExp(/(^(?:.|\r|\n)*?)/.source+bA.match[bw].source.replace(/\\(\d+)/g,bu))}var bB=function(bN,bM){bN=Array.prototype.slice.call(bN,0);if(bM){bM.push.apply(bM,bN);return bM}return bN};try{Array.prototype.slice.call(ar.documentElement.childNodes,0)[0].nodeType}catch(bK){bB=function(bQ,bP){var bO=0,bN=bP||[];if(bH.call(bQ)==="[object Array]"){Array.prototype.push.apply(bN,bQ)}else{if(typeof bQ.length==="number"){for(var bM=bQ.length;bO<bM;bO++){bN.push(bQ[bO])}}else{for(;bQ[bO];bO++){bN.push(bQ[bO])}}}return bN}}var bG,bC;if(ar.documentElement.compareDocumentPosition){bG=function(bN,bM){if(bN===bM){by=true;return 0}if(!bN.compareDocumentPosition||!bM.compareDocumentPosition){return bN.compareDocumentPosition?-1:1}return bN.compareDocumentPosition(bM)&4?-1:1}}else{bG=function(bU,bT){if(bU===bT){by=true;return 0}else{if(bU.sourceIndex&&bT.sourceIndex){return bU.sourceIndex-bT.sourceIndex}}var bR,bN,bO=[],bM=[],bQ=bU.parentNode,bS=bT.parentNode,bV=bQ;if(bQ===bS){return bC(bU,bT)}else{if(!bQ){return -1}else{if(!bS){return 1}}}while(bV){bO.unshift(bV);bV=bV.parentNode}bV=bS;while(bV){bM.unshift(bV);bV=bV.parentNode}bR=bO.length;bN=bM.length;for(var bP=0;bP<bR&&bP<bN;bP++){if(bO[bP]!==bM[bP]){return bC(bO[bP],bM[bP])}}return bP===bR?bC(bU,bM[bP],-1):bC(bO[bP],bT,1)};bC=function(bN,bM,bO){if(bN===bM){return bO}var bP=bN.nextSibling;while(bP){if(bP===bM){return -1}bP=bP.nextSibling}return 1}}bv.getText=function(bM){var bN="",bP;for(var bO=0;bM[bO];bO++){bP=bM[bO];if(bP.nodeType===3||bP.nodeType===4){bN+=bP.nodeValue}else{if(bP.nodeType!==8){bN+=bv.getText(bP.childNodes)}}}return bN};(function(){var bN=ar.createElement("div"),bO="script"+(new Date()).getTime(),bM=ar.documentElement;bN.innerHTML="<a name='"+bO+"'/>";bM.insertBefore(bN,bM.firstChild);if(ar.getElementById(bO)){bA.find.ID=function(bQ,bR,bS){if(typeof bR.getElementById!=="undefined"&&!bS){var bP=bR.getElementById(bQ[1]);return bP?bP.id===bQ[1]||typeof bP.getAttributeNode!=="undefined"&&bP.getAttributeNode("id").nodeValue===bQ[1]?[bP]:K:[]}};bA.filter.ID=function(bR,bP){var bQ=typeof bR.getAttributeNode!=="undefined"&&bR.getAttributeNode("id");return bR.nodeType===1&&bQ&&bQ.nodeValue===bP}}bM.removeChild(bN);bM=bN=null})();(function(){var bM=ar.createElement("div");bM.appendChild(ar.createComment(""));if(bM.getElementsByTagName("*").length>0){bA.find.TAG=function(bN,bR){var bQ=bR.getElementsByTagName(bN[1]);if(bN[1]==="*"){var bP=[];for(var bO=0;bQ[bO];bO++){if(bQ[bO].nodeType===1){bP.push(bQ[bO])}}bQ=bP}return bQ}}bM.innerHTML="<a href='#'></a>";if(bM.firstChild&&typeof bM.firstChild.getAttribute!=="undefined"&&bM.firstChild.getAttribute("href")!=="#"){bA.attrHandle.href=function(bN){return bN.getAttribute("href",2)}}bM=null})();if(ar.querySelectorAll){(function(){var bM=bv,bP=ar.createElement("div"),bO="__sizzle__";bP.innerHTML="<p class='TEST'></p>";if(bP.querySelectorAll&&bP.querySelectorAll(".TEST").length===0){return}bv=function(b0,bR,bV,bZ){bR=bR||ar;if(!bZ&&!bv.isXML(bR)){var bY=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b0);if(bY&&(bR.nodeType===1||bR.nodeType===9)){if(bY[1]){return bB(bR.getElementsByTagName(b0),bV)}else{if(bY[2]&&bA.find.CLASS&&bR.getElementsByClassName){return bB(bR.getElementsByClassName(bY[2]),bV)}}}if(bR.nodeType===9){if(b0==="body"&&bR.body){return bB([bR.body],bV)}else{if(bY&&bY[3]){var bU=bR.getElementById(bY[3]);if(bU&&bU.parentNode){if(bU.id===bY[3]){return bB([bU],bV)}}else{return bB([],bV)}}}try{return bB(bR.querySelectorAll(b0),bV)}catch(bW){}}else{if(bR.nodeType===1&&bR.nodeName.toLowerCase()!=="object"){var bS=bR,bT=bR.getAttribute("id"),bQ=bT||bO,b2=bR.parentNode,b1=/^\s*[+~]/.test(b0);if(!bT){bR.setAttribute("id",bQ)}else{bQ=bQ.replace(/'/g,"\\$&")}if(b1&&b2){bR=bR.parentNode}try{if(!b1||b2){return bB(bR.querySelectorAll("[id='"+bQ+"'] "+b0),bV)}}catch(bX){}finally{if(!bT){bS.removeAttribute("id")}}}}}return bM(b0,bR,bV,bZ)};for(var bN in bM){bv[bN]=bM[bN]}bP=null})()}(function(){var bM=ar.documentElement,bO=bM.matchesSelector||bM.mozMatchesSelector||bM.webkitMatchesSelector||bM.msMatchesSelector;if(bO){var bQ=!bO.call(ar.createElement("div"),"div"),bN=false;try{bO.call(ar.documentElement,"[test!='']:sizzle")}catch(bP){bN=true}bv.matchesSelector=function(bS,bU){bU=bU.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!bv.isXML(bS)){try{if(bN||!bA.match.PSEUDO.test(bU)&&!/!=/.test(bU)){var bR=bO.call(bS,bU);if(bR||!bQ||bS.document&&bS.document.nodeType!==11){return bR}}}catch(bT){}}return bv(bU,null,null,[bS]).length>0}}})();(function(){var bM=ar.createElement("div");bM.innerHTML="<div class='test e'></div><div class='test'></div>";if(!bM.getElementsByClassName||bM.getElementsByClassName("e").length===0){return}bM.lastChild.className="e";if(bM.getElementsByClassName("e").length===1){return}bA.order.splice(1,0,"CLASS");bA.find.CLASS=function(bN,bO,bP){if(typeof bO.getElementsByClassName!=="undefined"&&!bP){return bO.getElementsByClassName(bN[1])}};bM=null})();function bt(bN,bS,bR,bV,bT,bU){for(var bP=0,bO=bV.length;bP<bO;bP++){var bM=bV[bP];if(bM){var bQ=false;bM=bM[bN];while(bM){if(bM.sizcache===bR){bQ=bV[bM.sizset];break}if(bM.nodeType===1&&!bU){bM.sizcache=bR;bM.sizset=bP}if(bM.nodeName.toLowerCase()===bS){bQ=bM;break}bM=bM[bN]}bV[bP]=bQ}}}function bJ(bN,bS,bR,bV,bT,bU){for(var bP=0,bO=bV.length;bP<bO;bP++){var bM=bV[bP];if(bM){var bQ=false;bM=bM[bN];while(bM){if(bM.sizcache===bR){bQ=bV[bM.sizset];break}if(bM.nodeType===1){if(!bU){bM.sizcache=bR;bM.sizset=bP}if(typeof bS!=="string"){if(bM===bS){bQ=true;break}}else{if(bv.filter(bS,[bM]).length>0){bQ=bM;break}}}bM=bM[bN]}bV[bP]=bQ}}}if(ar.documentElement.contains){bv.contains=function(bN,bM){return bN!==bM&&(bN.contains?bN.contains(bM):true)}}else{if(ar.documentElement.compareDocumentPosition){bv.contains=function(bN,bM){return !!(bN.compareDocumentPosition(bM)&16)}}else{bv.contains=function(){return false}}}bv.isXML=function(bM){var bN=(bM?bM.ownerDocument||bM:0).documentElement;return bN?bN.nodeName!=="HTML":false};var bI=function(bM,bT){var bR,bP=[],bQ="",bO=bT.nodeType?[bT]:bT;while((bR=bA.match.PSEUDO.exec(bM))){bQ+=bR[0];bM=bM.replace(bA.match.PSEUDO,"")}bM=bA.relative[bM]?bM+"*":bM;for(var bS=0,bN=bO.length;bS<bN;bS++){bv(bM,bO[bS],bP)}return bv.filter(bQ,bP)};b.find=bv;b.expr=bv.selectors;b.expr[":"]=b.expr.filters;b.unique=bv.uniqueSort;b.text=bv.getText;b.isXMLDoc=bv.isXML;b.contains=bv.contains})();var Z=/Until$/,an=/^(?:parents|prevUntil|prevAll)/,a8=/,/,bo=/^.[^:#\[\.,]*$/,Q=Array.prototype.slice,H=b.expr.match.POS,av={children:true,contents:true,next:true,prev:true};b.fn.extend({find:function(bt){var bv=this,bx,bu;if(typeof bt!=="string"){return b(bt).filter(function(){for(bx=0,bu=bv.length;bx<bu;bx++){if(b.contains(bv[bx],this)){return true}}})}var bw=this.pushStack("","find",bt),bz,bA,by;for(bx=0,bu=this.length;bx<bu;bx++){bz=bw.length;b.find(bt,this[bx],bw);if(bx>0){for(bA=bz;bA<bw.length;bA++){for(by=0;by<bz;by++){if(bw[by]===bw[bA]){bw.splice(bA--,1);break}}}}}return bw},has:function(bu){var bt=b(bu);return this.filter(function(){for(var bw=0,bv=bt.length;bw<bv;bw++){if(b.contains(this,bt[bw])){return true}}})},not:function(bt){return this.pushStack(aC(this,bt,false),"not",bt)},filter:function(bt){return this.pushStack(aC(this,bt,true),"filter",bt)},is:function(bt){return !!bt&&(typeof bt==="string"?b.filter(bt,this).length>0:this.filter(bt).length>0)},closest:function(bD,bu){var bA=[],bx,bv,bC=this[0];if(b.isArray(bD)){var bz,bw,by={},bt=1;if(bC&&bD.length){for(bx=0,bv=bD.length;bx<bv;bx++){bw=bD[bx];if(!by[bw]){by[bw]=H.test(bw)?b(bw,bu||this.context):bw}}while(bC&&bC.ownerDocument&&bC!==bu){for(bw in by){bz=by[bw];if(bz.jquery?bz.index(bC)>-1:b(bC).is(bz)){bA.push({selector:bw,elem:bC,level:bt})}}bC=bC.parentNode;bt++}}return bA}var bB=H.test(bD)||typeof bD!=="string"?b(bD,bu||this.context):0;for(bx=0,bv=this.length;bx<bv;bx++){bC=this[bx];while(bC){if(bB?bB.index(bC)>-1:b.find.matchesSelector(bC,bD)){bA.push(bC);break}else{bC=bC.parentNode;if(!bC||!bC.ownerDocument||bC===bu||bC.nodeType===11){break}}}}bA=bA.length>1?b.unique(bA):bA;return this.pushStack(bA,"closest",bD)},index:function(bt){if(!bt||typeof bt==="string"){return b.inArray(this[0],bt?b(bt):this.parent().children())}return b.inArray(bt.jquery?bt[0]:bt,this)},add:function(bt,bu){var bw=typeof bt==="string"?b(bt,bu):b.makeArray(bt&&bt.nodeType?[bt]:bt),bv=b.merge(this.get(),bw);return this.pushStack(C(bw[0])||C(bv[0])?bv:b.unique(bv))},andSelf:function(){return this.add(this.prevObject)}});function C(bt){return !bt||!bt.parentNode||bt.parentNode.nodeType===11}b.each({parent:function(bu){var bt=bu.parentNode;return bt&&bt.nodeType!==11?bt:null},parents:function(bt){return b.dir(bt,"parentNode")},parentsUntil:function(bu,bt,bv){return b.dir(bu,"parentNode",bv)},next:function(bt){return b.nth(bt,2,"nextSibling")},prev:function(bt){return b.nth(bt,2,"previousSibling")},nextAll:function(bt){return b.dir(bt,"nextSibling")},prevAll:function(bt){return b.dir(bt,"previousSibling")},nextUntil:function(bu,bt,bv){return b.dir(bu,"nextSibling",bv)},prevUntil:function(bu,bt,bv){return b.dir(bu,"previousSibling",bv)},siblings:function(bt){return b.sibling(bt.parentNode.firstChild,bt)},children:function(bt){return b.sibling(bt.firstChild)},contents:function(bt){return b.nodeName(bt,"iframe")?bt.contentDocument||bt.contentWindow.document:b.makeArray(bt.childNodes)}},function(bt,bu){b.fn[bt]=function(by,bv){var bx=b.map(this,bu,by),bw=Q.call(arguments);if(!Z.test(bt)){bv=by}if(bv&&typeof bv==="string"){bx=b.filter(bv,bx)}bx=this.length>1&&!av[bt]?b.unique(bx):bx;if((this.length>1||a8.test(bv))&&an.test(bt)){bx=bx.reverse()}return this.pushStack(bx,bt,bw.join(","))}});b.extend({filter:function(bv,bt,bu){if(bu){bv=":not("+bv+")"}return bt.length===1?b.find.matchesSelector(bt[0],bv)?[bt[0]]:[]:b.find.matches(bv,bt)},dir:function(bv,bu,bx){var bt=[],bw=bv[bu];while(bw&&bw.nodeType!==9&&(bx===K||bw.nodeType!==1||!b(bw).is(bx))){if(bw.nodeType===1){bt.push(bw)}bw=bw[bu]}return bt},nth:function(bx,bt,bv,bw){bt=bt||1;var bu=0;for(;bx;bx=bx[bv]){if(bx.nodeType===1&&++bu===bt){break}}return bx},sibling:function(bv,bu){var bt=[];for(;bv;bv=bv.nextSibling){if(bv.nodeType===1&&bv!==bu){bt.push(bv)}}return bt}});function aC(bw,bv,bt){bv=bv||0;if(b.isFunction(bv)){return b.grep(bw,function(by,bx){var bz=!!bv.call(by,bx,by);return bz===bt})}else{if(bv.nodeType){return b.grep(bw,function(by,bx){return(by===bv)===bt})}else{if(typeof bv==="string"){var bu=b.grep(bw,function(bx){return bx.nodeType===1});if(bo.test(bv)){return b.filter(bv,bu,!bt)}else{bv=b.filter(bv,bu)}}}}return b.grep(bw,function(by,bx){return(b.inArray(by,bv)>=0)===bt})}var ae=/ jQuery\d+="(?:\d+|null)"/g,ao=/^\s+/,T=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,d=/<([\w:]+)/,w=/<tbody/i,W=/<|&#?\w+;/,P=/<(?:script|object|embed|option|style)/i,n=/checked\s*(?:[^=]|=\s*.checked.)/i,bk=/\/(java|ecma)script/i,aK=/^\s*<!(?:\[CDATA\[|\-\-)/,au={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};au.optgroup=au.option;au.tbody=au.tfoot=au.colgroup=au.caption=au.thead;au.th=au.td;if(!b.support.htmlSerialize){au._default=[1,"div<div>","</div>"]}b.fn.extend({text:function(bt){if(b.isFunction(bt)){return this.each(function(bv){var bu=b(this);bu.text(bt.call(this,bv,bu.text()))})}if(typeof bt!=="object"&&bt!==K){return this.empty().append((this[0]&&this[0].ownerDocument||ar).createTextNode(bt))}return b.text(this)},wrapAll:function(bt){if(b.isFunction(bt)){return this.each(function(bv){b(this).wrapAll(bt.call(this,bv))})}if(this[0]){var bu=b(bt,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){bu.insertBefore(this[0])}bu.map(function(){var bv=this;while(bv.firstChild&&bv.firstChild.nodeType===1){bv=bv.firstChild}return bv}).append(this)}return this},wrapInner:function(bt){if(b.isFunction(bt)){return this.each(function(bu){b(this).wrapInner(bt.call(this,bu))})}return this.each(function(){var bu=b(this),bv=bu.contents();if(bv.length){bv.wrapAll(bt)}else{bu.append(bt)}})},wrap:function(bt){return this.each(function(){b(this).wrapAll(bt)})},unwrap:function(){return this.parent().each(function(){if(!b.nodeName(this,"body")){b(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(bt){if(this.nodeType===1){this.appendChild(bt)}})},prepend:function(){return this.domManip(arguments,true,function(bt){if(this.nodeType===1){this.insertBefore(bt,this.firstChild)}})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(bu){this.parentNode.insertBefore(bu,this)})}else{if(arguments.length){var bt=b(arguments[0]);bt.push.apply(bt,this.toArray());return this.pushStack(bt,"before",arguments)}}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(bu){this.parentNode.insertBefore(bu,this.nextSibling)})}else{if(arguments.length){var bt=this.pushStack(this,"after",arguments);bt.push.apply(bt,b(arguments[0]).toArray());return bt}}},remove:function(bt,bw){for(var bu=0,bv;(bv=this[bu])!=null;bu++){if(!bt||b.filter(bt,[bv]).length){if(!bw&&bv.nodeType===1){b.cleanData(bv.getElementsByTagName("*"));b.cleanData([bv])}if(bv.parentNode){bv.parentNode.removeChild(bv)}}}return this},empty:function(){for(var bt=0,bu;(bu=this[bt])!=null;bt++){if(bu.nodeType===1){b.cleanData(bu.getElementsByTagName("*"))}while(bu.firstChild){bu.removeChild(bu.firstChild)}}return this},clone:function(bu,bt){bu=bu==null?false:bu;bt=bt==null?bu:bt;return this.map(function(){return b.clone(this,bu,bt)})},html:function(bv){if(bv===K){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(ae,""):null}else{if(typeof bv==="string"&&!P.test(bv)&&(b.support.leadingWhitespace||!ao.test(bv))&&!au[(d.exec(bv)||["",""])[1].toLowerCase()]){bv=bv.replace(T,"<$1></$2>");try{for(var bu=0,bt=this.length;bu<bt;bu++){if(this[bu].nodeType===1){b.cleanData(this[bu].getElementsByTagName("*"));this[bu].innerHTML=bv}}}catch(bw){this.empty().append(bv)}}else{if(b.isFunction(bv)){this.each(function(by){var bx=b(this);bx.html(bv.call(this,by,bx.html()))})}else{this.empty().append(bv)}}}return this},replaceWith:function(bt){if(this[0]&&this[0].parentNode){if(b.isFunction(bt)){return this.each(function(bw){var bv=b(this),bu=bv.html();bv.replaceWith(bt.call(this,bw,bu))})}if(typeof bt!=="string"){bt=b(bt).detach()}return this.each(function(){var bv=this.nextSibling,bu=this.parentNode;b(this).remove();if(bv){b(bv).before(bt)}else{b(bu).append(bt)}})}else{return this.length?this.pushStack(b(b.isFunction(bt)?bt():bt),"replaceWith",bt):this}},detach:function(bt){return this.remove(bt,true)},domManip:function(bA,bE,bD){var bw,bx,bz,bC,bB=bA[0],bu=[];if(!b.support.checkClone&&arguments.length===3&&typeof bB==="string"&&n.test(bB)){return this.each(function(){b(this).domManip(bA,bE,bD,true)})}if(b.isFunction(bB)){return this.each(function(bG){var bF=b(this);bA[0]=bB.call(this,bG,bE?bF.html():K);bF.domManip(bA,bE,bD)})}if(this[0]){bC=bB&&bB.parentNode;if(b.support.parentNode&&bC&&bC.nodeType===11&&bC.childNodes.length===this.length){bw={fragment:bC}}else{bw=b.buildFragment(bA,this,bu)}bz=bw.fragment;if(bz.childNodes.length===1){bx=bz=bz.firstChild}else{bx=bz.firstChild}if(bx){bE=bE&&b.nodeName(bx,"tr");for(var bv=0,bt=this.length,by=bt-1;bv<bt;bv++){bD.call(bE?a9(this[bv],bx):this[bv],bw.cacheable||(bt>1&&bv<by)?b.clone(bz,true,true):bz)}}if(bu.length){b.each(bu,bn)}}return this}});function a9(bt,bu){return b.nodeName(bt,"table")?(bt.getElementsByTagName("tbody")[0]||bt.appendChild(bt.ownerDocument.createElement("tbody"))):bt}function t(bt,bA){if(bA.nodeType!==1||!b.hasData(bt)){return}var bz=b.expando,bw=b.data(bt),bx=b.data(bA,bw);if((bw=bw[bz])){var bB=bw.events;bx=bx[bz]=b.extend({},bw);if(bB){delete bx.handle;bx.events={};for(var by in bB){for(var bv=0,bu=bB[by].length;bv<bu;bv++){b.event.add(bA,by+(bB[by][bv].namespace?".":"")+bB[by][bv].namespace,bB[by][bv],bB[by][bv].data)}}}}}function af(bu,bt){var bv;if(bt.nodeType!==1){return}if(bt.clearAttributes){bt.clearAttributes()}if(bt.mergeAttributes){bt.mergeAttributes(bu)}bv=bt.nodeName.toLowerCase();if(bv==="object"){bt.outerHTML=bu.outerHTML}else{if(bv==="input"&&(bu.type==="checkbox"||bu.type==="radio")){if(bu.checked){bt.defaultChecked=bt.checked=bu.checked}if(bt.value!==bu.value){bt.value=bu.value}}else{if(bv==="option"){bt.selected=bu.defaultSelected}else{if(bv==="input"||bv==="textarea"){bt.defaultValue=bu.defaultValue}}}}bt.removeAttribute(b.expando)}b.buildFragment=function(by,bw,bu){var bx,bt,bv,bz;if(bw&&bw[0]){bz=bw[0].ownerDocument||bw[0]}if(!bz.createDocumentFragment){bz=ar}if(by.length===1&&typeof by[0]==="string"&&by[0].length<512&&bz===ar&&by[0].charAt(0)==="<"&&!P.test(by[0])&&(b.support.checkClone||!n.test(by[0]))){bt=true;bv=b.fragments[by[0]];if(bv&&bv!==1){bx=bv}}if(!bx){bx=bz.createDocumentFragment();b.clean(by,bz,bx,bu)}if(bt){b.fragments[by[0]]=bv?bx:1}return{fragment:bx,cacheable:bt}};b.fragments={};b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(bt,bu){b.fn[bt]=function(bv){var by=[],bB=b(bv),bA=this.length===1&&this[0].parentNode;if(bA&&bA.nodeType===11&&bA.childNodes.length===1&&bB.length===1){bB[bu](this[0]);return this}else{for(var bz=0,bw=bB.length;bz<bw;bz++){var bx=(bz>0?this.clone(true):this).get();b(bB[bz])[bu](bx);by=by.concat(bx)}return this.pushStack(by,bt,bB.selector)}}});function bd(bt){if("getElementsByTagName" in bt){return bt.getElementsByTagName("*")}else{if("querySelectorAll" in bt){return bt.querySelectorAll("*")}else{return[]}}}function aw(bt){if(bt.type==="checkbox"||bt.type==="radio"){bt.defaultChecked=bt.checked}}function E(bt){if(b.nodeName(bt,"input")){aw(bt)}else{if("getElementsByTagName" in bt){b.grep(bt.getElementsByTagName("input"),aw)}}}b.extend({clone:function(bx,bz,bv){var by=bx.cloneNode(true),bt,bu,bw;if((!b.support.noCloneEvent||!b.support.noCloneChecked)&&(bx.nodeType===1||bx.nodeType===11)&&!b.isXMLDoc(bx)){af(bx,by);bt=bd(bx);bu=bd(by);for(bw=0;bt[bw];++bw){af(bt[bw],bu[bw])}}if(bz){t(bx,by);if(bv){bt=bd(bx);bu=bd(by);for(bw=0;bt[bw];++bw){t(bt[bw],bu[bw])}}}bt=bu=null;return by},clean:function(bv,bx,bG,bz){var bE;bx=bx||ar;if(typeof bx.createElement==="undefined"){bx=bx.ownerDocument||bx[0]&&bx[0].ownerDocument||ar}var bH=[],bA;for(var bD=0,by;(by=bv[bD])!=null;bD++){if(typeof by==="number"){by+=""}if(!by){continue}if(typeof by==="string"){if(!W.test(by)){by=bx.createTextNode(by)}else{by=by.replace(T,"<$1></$2>");var bJ=(d.exec(by)||["",""])[1].toLowerCase(),bw=au[bJ]||au._default,bC=bw[0],bu=bx.createElement("div");bu.innerHTML=bw[1]+by+bw[2];while(bC--){bu=bu.lastChild}if(!b.support.tbody){var bt=w.test(by),bB=bJ==="table"&&!bt?bu.firstChild&&bu.firstChild.childNodes:bw[1]==="<table>"&&!bt?bu.childNodes:[];for(bA=bB.length-1;bA>=0;--bA){if(b.nodeName(bB[bA],"tbody")&&!bB[bA].childNodes.length){bB[bA].parentNode.removeChild(bB[bA])}}}if(!b.support.leadingWhitespace&&ao.test(by)){bu.insertBefore(bx.createTextNode(ao.exec(by)[0]),bu.firstChild)}by=bu.childNodes}}var bF;if(!b.support.appendChecked){if(by[0]&&typeof(bF=by.length)==="number"){for(bA=0;bA<bF;bA++){E(by[bA])}}else{E(by)}}if(by.nodeType){bH.push(by)}else{bH=b.merge(bH,by)}}if(bG){bE=function(bK){return !bK.type||bk.test(bK.type)};for(bD=0;bH[bD];bD++){if(bz&&b.nodeName(bH[bD],"script")&&(!bH[bD].type||bH[bD].type.toLowerCase()==="text/javascript")){bz.push(bH[bD].parentNode?bH[bD].parentNode.removeChild(bH[bD]):bH[bD])}else{if(bH[bD].nodeType===1){var bI=b.grep(bH[bD].getElementsByTagName("script"),bE);bH.splice.apply(bH,[bD+1,0].concat(bI))}bG.appendChild(bH[bD])}}}return bH},cleanData:function(bu){var bx,bv,bt=b.cache,bC=b.expando,bA=b.event.special,bz=b.support.deleteExpando;for(var by=0,bw;(bw=bu[by])!=null;by++){if(bw.nodeName&&b.noData[bw.nodeName.toLowerCase()]){continue}bv=bw[b.expando];if(bv){bx=bt[bv]&&bt[bv][bC];if(bx&&bx.events){for(var bB in bx.events){if(bA[bB]){b.event.remove(bw,bB)}else{b.removeEvent(bw,bB,bx.handle)}}if(bx.handle){bx.handle.elem=null}}if(bz){delete bw[b.expando]}else{if(bw.removeAttribute){bw.removeAttribute(b.expando)}}delete bt[bv]}}}});function bn(bt,bu){if(bu.src){b.ajax({url:bu.src,async:false,dataType:"script"})}else{b.globalEval((bu.text||bu.textContent||bu.innerHTML||"").replace(aK,"/*$0*/"))}if(bu.parentNode){bu.parentNode.removeChild(bu)}}var ai=/alpha\([^)]*\)/i,aq=/opacity=([^)]*)/,z=/([A-Z]|^ms)/g,bb=/^-?\d+(?:px)?$/i,bm=/^-?\d/,I=/^[+\-]=/,ah=/[^+\-\.\de]+/g,a5={position:"absolute",visibility:"hidden",display:"block"},ak=["Left","Right"],aZ=["Top","Bottom"],X,aF,aT;b.fn.css=function(bt,bu){if(arguments.length===2&&bu===K){return this}return b.access(this,bt,bu,true,function(bw,bv,bx){return bx!==K?b.style(bw,bv,bx):b.css(bw,bv)})};b.extend({cssHooks:{opacity:{get:function(bv,bu){if(bu){var bt=X(bv,"opacity","opacity");return bt===""?"1":bt}else{return bv.style.opacity}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(bv,bu,bB,bw){if(!bv||bv.nodeType===3||bv.nodeType===8||!bv.style){return}var bz,bA,bx=b.camelCase(bu),bt=bv.style,bC=b.cssHooks[bx];bu=b.cssProps[bx]||bx;if(bB!==K){bA=typeof bB;if(bA==="number"&&isNaN(bB)||bB==null){return}if(bA==="string"&&I.test(bB)){bB=+bB.replace(ah,"")+parseFloat(b.css(bv,bu));bA="number"}if(bA==="number"&&!b.cssNumber[bx]){bB+="px"}if(!bC||!("set" in bC)||(bB=bC.set(bv,bB))!==K){try{bt[bu]=bB}catch(by){}}}else{if(bC&&"get" in bC&&(bz=bC.get(bv,false,bw))!==K){return bz}return bt[bu]}},css:function(bx,bw,bu){var bv,bt;bw=b.camelCase(bw);bt=b.cssHooks[bw];bw=b.cssProps[bw]||bw;if(bw==="cssFloat"){bw="float"}if(bt&&"get" in bt&&(bv=bt.get(bx,true,bu))!==K){return bv}else{if(X){return X(bx,bw)}}},swap:function(bw,bv,bx){var bt={};for(var bu in bv){bt[bu]=bw.style[bu];bw.style[bu]=bv[bu]}bx.call(bw);for(bu in bv){bw.style[bu]=bt[bu]}}});b.curCSS=b.css;b.each(["height","width"],function(bu,bt){b.cssHooks[bt]={get:function(bx,bw,bv){var by;if(bw){if(bx.offsetWidth!==0){return o(bx,bt,bv)}else{b.swap(bx,a5,function(){by=o(bx,bt,bv)})}return by}},set:function(bv,bw){if(bb.test(bw)){bw=parseFloat(bw);if(bw>=0){return bw+"px"}}else{return bw}}}});if(!b.support.opacity){b.cssHooks.opacity={get:function(bu,bt){return aq.test((bt&&bu.currentStyle?bu.currentStyle.filter:bu.style.filter)||"")?(parseFloat(RegExp.$1)/100)+"":bt?"1":""},set:function(bx,by){var bw=bx.style,bu=bx.currentStyle;bw.zoom=1;var bt=b.isNaN(by)?"":"alpha(opacity="+by*100+")",bv=bu&&bu.filter||bw.filter||"";bw.filter=ai.test(bv)?bv.replace(ai,bt):bv+" "+bt}}}b(function(){if(!b.support.reliableMarginRight){b.cssHooks.marginRight={get:function(bv,bu){var bt;b.swap(bv,{display:"inline-block"},function(){if(bu){bt=X(bv,"margin-right","marginRight")}else{bt=bv.style.marginRight}});return bt}}}});if(ar.defaultView&&ar.defaultView.getComputedStyle){aF=function(bx,bv){var bu,bw,bt;bv=bv.replace(z,"-$1").toLowerCase();if(!(bw=bx.ownerDocument.defaultView)){return K}if((bt=bw.getComputedStyle(bx,null))){bu=bt.getPropertyValue(bv);if(bu===""&&!b.contains(bx.ownerDocument.documentElement,bx)){bu=b.style(bx,bv)}}return bu}}if(ar.documentElement.currentStyle){aT=function(bx,bv){var by,bu=bx.currentStyle&&bx.currentStyle[bv],bt=bx.runtimeStyle&&bx.runtimeStyle[bv],bw=bx.style;if(!bb.test(bu)&&bm.test(bu)){by=bw.left;if(bt){bx.runtimeStyle.left=bx.currentStyle.left}bw.left=bv==="fontSize"?"1em":(bu||0);bu=bw.pixelLeft+"px";bw.left=by;if(bt){bx.runtimeStyle.left=bt}}return bu===""?"auto":bu}}X=aF||aT;function o(bv,bu,bt){var bx=bu==="width"?bv.offsetWidth:bv.offsetHeight,bw=bu==="width"?ak:aZ;if(bx>0){if(bt!=="border"){b.each(bw,function(){if(!bt){bx-=parseFloat(b.css(bv,"padding"+this))||0}if(bt==="margin"){bx+=parseFloat(b.css(bv,bt+this))||0}else{bx-=parseFloat(b.css(bv,"border"+this+"Width"))||0}})}return bx+"px"}bx=X(bv,bu,bu);if(bx<0||bx==null){bx=bv.style[bu]||0}bx=parseFloat(bx)||0;if(bt){b.each(bw,function(){bx+=parseFloat(b.css(bv,"padding"+this))||0;if(bt!=="padding"){bx+=parseFloat(b.css(bv,"border"+this+"Width"))||0}if(bt==="margin"){bx+=parseFloat(b.css(bv,bt+this))||0}})}return bx+"px"}if(b.expr&&b.expr.filters){b.expr.filters.hidden=function(bv){var bu=bv.offsetWidth,bt=bv.offsetHeight;return(bu===0&&bt===0)||(!b.support.reliableHiddenOffsets&&(bv.style.display||b.css(bv,"display"))==="none")};b.expr.filters.visible=function(bt){return !b.expr.filters.hidden(bt)}}var j=/%20/g,am=/\[\]$/,br=/\r?\n/g,bp=/#.*$/,aA=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,aW=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,aJ=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/,aM=/^(?:GET|HEAD)$/,c=/^\/\//,M=/\?/,a4=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,q=/^(?:select|textarea)/i,h=/\s+/,bq=/([?&])_=[^&]*/,J=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,A=b.fn.load,Y={},r={},aB,s;try{aB=bj.href}catch(at){aB=ar.createElement("a");aB.href="";aB=aB.href}s=J.exec(aB.toLowerCase())||[];function f(bt){return function(bx,bz){if(typeof bx!=="string"){bz=bx;bx="*"}if(b.isFunction(bz)){var bw=bx.toLowerCase().split(h),bv=0,by=bw.length,bu,bA,bB;for(;bv<by;bv++){bu=bw[bv];bB=/^\+/.test(bu);if(bB){bu=bu.substr(1)||"*"}bA=bt[bu]=bt[bu]||[];bA[bB?"unshift":"push"](bz)}}}}function aR(bu,bD,by,bC,bA,bw){bA=bA||bD.dataTypes[0];bw=bw||{};bw[bA]=true;var bz=bu[bA],bv=0,bt=bz?bz.length:0,bx=(bu===Y),bB;for(;bv<bt&&(bx||!bB);bv++){bB=bz[bv](bD,by,bC);if(typeof bB==="string"){if(!bx||bw[bB]){bB=K}else{bD.dataTypes.unshift(bB);bB=aR(bu,bD,by,bC,bB,bw)}}}if((bx||!bB)&&!bw["*"]){bB=aR(bu,bD,by,bC,"*",bw)}return bB}b.fn.extend({load:function(bv,by,bz){if(typeof bv!=="string"&&A){return A.apply(this,arguments)}else{if(!this.length){return this}}var bx=bv.indexOf(" ");if(bx>=0){var bt=bv.slice(bx,bv.length);bv=bv.slice(0,bx)}var bw="GET";if(by){if(b.isFunction(by)){bz=by;by=K}else{if(typeof by==="object"){by=b.param(by,b.ajaxSettings.traditional);bw="POST"}}}var bu=this;b.ajax({url:bv,type:bw,dataType:"html",data:by,complete:function(bB,bA,bC){bC=bB.responseText;if(bB.isResolved()){bB.done(function(bD){bC=bD});bu.html(bt?b("<div>").append(bC.replace(a4,"")).find(bt):bC)}if(bz){bu.each(bz,[bC,bA,bB])}}});return this},serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?b.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||q.test(this.nodeName)||aW.test(this.type))}).map(function(bt,bu){var bv=b(this).val();return bv==null?null:b.isArray(bv)?b.map(bv,function(bx,bw){return{name:bu.name,value:bx.replace(br,"\r\n")}}):{name:bu.name,value:bv.replace(br,"\r\n")}}).get()}});b.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(bt,bu){b.fn[bu]=function(bv){return this.bind(bu,bv)}});b.each(["get","post"],function(bt,bu){b[bu]=function(bv,bx,by,bw){if(b.isFunction(bx)){bw=bw||by;by=bx;bx=K}return b.ajax({type:bu,url:bv,data:bx,success:by,dataType:bw})}});b.extend({getScript:function(bt,bu){return b.get(bt,K,bu,"script")},getJSON:function(bt,bu,bv){return b.get(bt,bu,bv,"json")},ajaxSetup:function(bv,bt){if(!bt){bt=bv;bv=b.extend(true,b.ajaxSettings,bt)}else{b.extend(true,bv,b.ajaxSettings,bt)}for(var bu in {context:1,url:1}){if(bu in bt){bv[bu]=bt[bu]}else{if(bu in b.ajaxSettings){bv[bu]=b.ajaxSettings[bu]}}}return bv},ajaxSettings:{url:aB,isLocal:aJ.test(s[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":ba.String,"text html":true,"text json":b.parseJSON,"text xml":b.parseXML}},ajaxPrefilter:f(Y),ajaxTransport:f(r),ajax:function(bx,bv){if(typeof bx==="object"){bv=bx;bx=K}bv=bv||{};var bB=b.ajaxSetup({},bv),bQ=bB.context||bB,bE=bQ!==bB&&(bQ.nodeType||bQ instanceof b)?b(bQ):b.event,bP=b.Deferred(),bL=b._Deferred(),bz=bB.statusCode||{},bA,bF={},bM={},bO,bw,bJ,bC,bG,by=0,bu,bI,bH={readyState:0,setRequestHeader:function(bS,bT){if(!by){var bR=bS.toLowerCase();bS=bM[bR]=bM[bR]||bS;bF[bS]=bT}return this},getAllResponseHeaders:function(){return by===2?bO:null},getResponseHeader:function(bS){var bR;if(by===2){if(!bw){bw={};while((bR=aA.exec(bO))){bw[bR[1].toLowerCase()]=bR[2]}}bR=bw[bS.toLowerCase()]}return bR===K?null:bR},overrideMimeType:function(bR){if(!by){bB.mimeType=bR}return this},abort:function(bR){bR=bR||"abort";if(bJ){bJ.abort(bR)}bD(0,bR);return this}};function bD(bW,bU,bX,bT){if(by===2){return}by=2;if(bC){clearTimeout(bC)}bJ=K;bO=bT||"";bH.readyState=bW?4:0;var bR,b1,b0,bV=bX?bh(bB,bH,bX):K,bS,bZ;if(bW>=200&&bW<300||bW===304){if(bB.ifModified){if((bS=bH.getResponseHeader("Last-Modified"))){b.lastModified[bA]=bS}if((bZ=bH.getResponseHeader("Etag"))){b.etag[bA]=bZ}}if(bW===304){bU="notmodified";bR=true}else{try{b1=F(bB,bV);bU="success";bR=true}catch(bY){bU="parsererror";b0=bY}}}else{b0=bU;if(!bU||bW){bU="error";if(bW<0){bW=0}}}bH.status=bW;bH.statusText=bU;if(bR){bP.resolveWith(bQ,[b1,bU,bH])}else{bP.rejectWith(bQ,[bH,bU,b0])}bH.statusCode(bz);bz=K;if(bu){bE.trigger("ajax"+(bR?"Success":"Error"),[bH,bB,bR?b1:b0])}bL.resolveWith(bQ,[bH,bU]);if(bu){bE.trigger("ajaxComplete",[bH,bB]);if(!(--b.active)){b.event.trigger("ajaxStop")}}}bP.promise(bH);bH.success=bH.done;bH.error=bH.fail;bH.complete=bL.done;bH.statusCode=function(bS){if(bS){var bR;if(by<2){for(bR in bS){bz[bR]=[bz[bR],bS[bR]]}}else{bR=bS[bH.status];bH.then(bR,bR)}}return this};bB.url=((bx||bB.url)+"").replace(bp,"").replace(c,s[1]+"//");bB.dataTypes=b.trim(bB.dataType||"*").toLowerCase().split(h);if(bB.crossDomain==null){bG=J.exec(bB.url.toLowerCase());bB.crossDomain=!!(bG&&(bG[1]!=s[1]||bG[2]!=s[2]||(bG[3]||(bG[1]==="http:"?80:443))!=(s[3]||(s[1]==="http:"?80:443))))}if(bB.data&&bB.processData&&typeof bB.data!=="string"){bB.data=b.param(bB.data,bB.traditional)}aR(Y,bB,bv,bH);if(by===2){return false}bu=bB.global;bB.type=bB.type.toUpperCase();bB.hasContent=!aM.test(bB.type);if(bu&&b.active++===0){b.event.trigger("ajaxStart")}if(!bB.hasContent){if(bB.data){bB.url+=(M.test(bB.url)?"&":"?")+bB.data}bA=bB.url;if(bB.cache===false){var bt=b.now(),bN=bB.url.replace(bq,"$1_="+bt);bB.url=bN+((bN===bB.url)?(M.test(bB.url)?"&":"?")+"_="+bt:"")}}if(bB.data&&bB.hasContent&&bB.contentType!==false||bv.contentType){bH.setRequestHeader("Content-Type",bB.contentType)}if(bB.ifModified){bA=bA||bB.url;if(b.lastModified[bA]){bH.setRequestHeader("If-Modified-Since",b.lastModified[bA])}if(b.etag[bA]){bH.setRequestHeader("If-None-Match",b.etag[bA])}}bH.setRequestHeader("Accept",bB.dataTypes[0]&&bB.accepts[bB.dataTypes[0]]?bB.accepts[bB.dataTypes[0]]+(bB.dataTypes[0]!=="*"?", */*; q=0.01":""):bB.accepts["*"]);for(bI in bB.headers){bH.setRequestHeader(bI,bB.headers[bI])}if(bB.beforeSend&&(bB.beforeSend.call(bQ,bH,bB)===false||by===2)){bH.abort();return false}for(bI in {success:1,error:1,complete:1}){bH[bI](bB[bI])}bJ=aR(r,bB,bv,bH);if(!bJ){bD(-1,"No Transport")}else{bH.readyState=1;if(bu){bE.trigger("ajaxSend",[bH,bB])}if(bB.async&&bB.timeout>0){bC=setTimeout(function(){bH.abort("timeout")},bB.timeout)}try{by=1;bJ.send(bF,bD)}catch(bK){if(status<2){bD(-1,bK)}else{b.error(bK)}}}return bH},param:function(bt,bv){var bu=[],bx=function(by,bz){bz=b.isFunction(bz)?bz():bz;bu[bu.length]=encodeURIComponent(by)+"="+encodeURIComponent(bz)};if(bv===K){bv=b.ajaxSettings.traditional}if(b.isArray(bt)||(bt.jquery&&!b.isPlainObject(bt))){b.each(bt,function(){bx(this.name,this.value)})}else{for(var bw in bt){v(bw,bt[bw],bv,bx)}}return bu.join("&").replace(j,"+")}});function v(bv,bx,bu,bw){if(b.isArray(bx)){b.each(bx,function(bz,by){if(bu||am.test(bv)){bw(bv,by)}else{v(bv+"["+(typeof by==="object"||b.isArray(by)?bz:"")+"]",by,bu,bw)}})}else{if(!bu&&bx!=null&&typeof bx==="object"){for(var bt in bx){v(bv+"["+bt+"]",bx[bt],bu,bw)}}else{bw(bv,bx)}}}b.extend({active:0,lastModified:{},etag:{}});function bh(bC,bB,by){var bu=bC.contents,bA=bC.dataTypes,bv=bC.responseFields,bx,bz,bw,bt;for(bz in bv){if(bz in by){bB[bv[bz]]=by[bz]}}while(bA[0]==="*"){bA.shift();if(bx===K){bx=bC.mimeType||bB.getResponseHeader("content-type")}}if(bx){for(bz in bu){if(bu[bz]&&bu[bz].test(bx)){bA.unshift(bz);break}}}if(bA[0] in by){bw=bA[0]}else{for(bz in by){if(!bA[0]||bC.converters[bz+" "+bA[0]]){bw=bz;break}if(!bt){bt=bz}}bw=bw||bt}if(bw){if(bw!==bA[0]){bA.unshift(bw)}return by[bw]}}function F(bG,by){if(bG.dataFilter){by=bG.dataFilter(by,bG.dataType)}var bC=bG.dataTypes,bF={},bz,bD,bv=bC.length,bA,bB=bC[0],bw,bx,bE,bu,bt;for(bz=1;bz<bv;bz++){if(bz===1){for(bD in bG.converters){if(typeof bD==="string"){bF[bD.toLowerCase()]=bG.converters[bD]}}}bw=bB;bB=bC[bz];if(bB==="*"){bB=bw}else{if(bw!=="*"&&bw!==bB){bx=bw+" "+bB;bE=bF[bx]||bF["* "+bB];if(!bE){bt=K;for(bu in bF){bA=bu.split(" ");if(bA[0]===bw||bA[0]==="*"){bt=bF[bA[1]+" "+bB];if(bt){bu=bF[bu];if(bu===true){bE=bt}else{if(bt===true){bE=bu}}break}}}}if(!(bE||bt)){b.error("No conversion from "+bx.replace(" "," to "))}if(bE!==true){by=bE?bE(by):bt(bu(by))}}}}return by}var az=b.now(),u=/(\=)\?(&|$)|\?\?/i;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return b.expando+"_"+(az++)}});b.ajaxPrefilter("json jsonp",function(bC,bz,bB){var bw=bC.contentType==="application/x-www-form-urlencoded"&&(typeof bC.data==="string");if(bC.dataTypes[0]==="jsonp"||bC.jsonp!==false&&(u.test(bC.url)||bw&&u.test(bC.data))){var bA,bv=bC.jsonpCallback=b.isFunction(bC.jsonpCallback)?bC.jsonpCallback():bC.jsonpCallback,by=ba[bv],bt=bC.url,bx=bC.data,bu="$1"+bv+"$2";if(bC.jsonp!==false){bt=bt.replace(u,bu);if(bC.url===bt){if(bw){bx=bx.replace(u,bu)}if(bC.data===bx){bt+=(/\?/.test(bt)?"&":"?")+bC.jsonp+"="+bv}}}bC.url=bt;bC.data=bx;ba[bv]=function(bD){bA=[bD]};bB.always(function(){ba[bv]=by;if(bA&&b.isFunction(by)){ba[bv](bA[0])}});bC.converters["script json"]=function(){if(!bA){b.error(bv+" was not called")}return bA[0]};bC.dataTypes[0]="json";return"script"}});b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(bt){b.globalEval(bt);return bt}}});b.ajaxPrefilter("script",function(bt){if(bt.cache===K){bt.cache=false}if(bt.crossDomain){bt.type="GET";bt.global=false}});b.ajaxTransport("script",function(bv){if(bv.crossDomain){var bt,bu=ar.head||ar.getElementsByTagName("head")[0]||ar.documentElement;return{send:function(bw,bx){bt=ar.createElement("script");bt.async="async";if(bv.scriptCharset){bt.charset=bv.scriptCharset}bt.src=bv.url;bt.onload=bt.onreadystatechange=function(bz,by){if(by||!bt.readyState||/loaded|complete/.test(bt.readyState)){bt.onload=bt.onreadystatechange=null;if(bu&&bt.parentNode){bu.removeChild(bt)}bt=K;if(!by){bx(200,"success")}}};bu.insertBefore(bt,bu.firstChild)},abort:function(){if(bt){bt.onload(0,1)}}}}});var B=ba.ActiveXObject?function(){for(var bt in N){N[bt](0,1)}}:false,y=0,N;function aI(){try{return new ba.XMLHttpRequest()}catch(bt){}}function ag(){try{return new ba.ActiveXObject("Microsoft.XMLHTTP")}catch(bt){}}b.ajaxSettings.xhr=ba.ActiveXObject?function(){return !this.isLocal&&aI()||ag()}:aI;(function(bt){b.extend(b.support,{ajax:!!bt,cors:!!bt&&("withCredentials" in bt)})})(b.ajaxSettings.xhr());if(b.support.ajax){b.ajaxTransport(function(bt){if(!bt.crossDomain||b.support.cors){var bu;return{send:function(bA,bv){var bz=bt.xhr(),by,bx;if(bt.username){bz.open(bt.type,bt.url,bt.async,bt.username,bt.password)}else{bz.open(bt.type,bt.url,bt.async)}if(bt.xhrFields){for(bx in bt.xhrFields){bz[bx]=bt.xhrFields[bx]}}if(bt.mimeType&&bz.overrideMimeType){bz.overrideMimeType(bt.mimeType)}if(!bt.crossDomain&&!bA["X-Requested-With"]){bA["X-Requested-With"]="XMLHttpRequest"}try{for(bx in bA){bz.setRequestHeader(bx,bA[bx])}}catch(bw){}bz.send((bt.hasContent&&bt.data)||null);bu=function(bJ,bD){var bE,bC,bB,bH,bG;try{if(bu&&(bD||bz.readyState===4)){bu=K;if(by){bz.onreadystatechange=b.noop;if(B){delete N[by]}}if(bD){if(bz.readyState!==4){bz.abort()}}else{bE=bz.status;bB=bz.getAllResponseHeaders();bH={};bG=bz.responseXML;if(bG&&bG.documentElement){bH.xml=bG}bH.text=bz.responseText;try{bC=bz.statusText}catch(bI){bC=""}if(!bE&&bt.isLocal&&!bt.crossDomain){bE=bH.text?200:404}else{if(bE===1223){bE=204}}}}}catch(bF){if(!bD){bv(-1,bF)}}if(bH){bv(bE,bC,bH,bB)}};if(!bt.async||bz.readyState===4){bu()}else{by=++y;if(B){if(!N){N={};b(ba).unload(B)}N[by]=bu}bz.onreadystatechange=bu}},abort:function(){if(bu){bu(0,1)}}}}})}var R={},a7,m,ay=/^(?:toggle|show|hide)$/,aO=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,a0,aE=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],a2,S=ba.webkitRequestAnimationFrame||ba.mozRequestAnimationFrame||ba.oRequestAnimationFrame;b.fn.extend({show:function(bw,bz,by){var bv,bx;if(bw||bw===0){return this.animate(aY("show",3),bw,bz,by)}else{for(var bu=0,bt=this.length;bu<bt;bu++){bv=this[bu];if(bv.style){bx=bv.style.display;if(!b._data(bv,"olddisplay")&&bx==="none"){bx=bv.style.display=""}if(bx===""&&b.css(bv,"display")==="none"){b._data(bv,"olddisplay",x(bv.nodeName))}}}for(bu=0;bu<bt;bu++){bv=this[bu];if(bv.style){bx=bv.style.display;if(bx===""||bx==="none"){bv.style.display=b._data(bv,"olddisplay")||""}}}return this}},hide:function(bv,by,bx){if(bv||bv===0){return this.animate(aY("hide",3),bv,by,bx)}else{for(var bu=0,bt=this.length;bu<bt;bu++){if(this[bu].style){var bw=b.css(this[bu],"display");if(bw!=="none"&&!b._data(this[bu],"olddisplay")){b._data(this[bu],"olddisplay",bw)}}}for(bu=0;bu<bt;bu++){if(this[bu].style){this[bu].style.display="none"}}return this}},_toggle:b.fn.toggle,toggle:function(bv,bu,bw){var bt=typeof bv==="boolean";if(b.isFunction(bv)&&b.isFunction(bu)){this._toggle.apply(this,arguments)}else{if(bv==null||bt){this.each(function(){var bx=bt?bv:b(this).is(":hidden");b(this)[bx?"show":"hide"]()})}else{this.animate(aY("toggle",3),bv,bu,bw)}}return this},fadeTo:function(bt,bw,bv,bu){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:bw},bt,bv,bu)},animate:function(bx,bu,bw,bv){var bt=b.speed(bu,bw,bv);if(b.isEmptyObject(bx)){return this.each(bt.complete,[false])}bx=b.extend({},bx);return this[bt.queue===false?"each":"queue"](function(){if(bt.queue===false){b._mark(this)}var bB=b.extend({},bt),bI=this.nodeType===1,bF=bI&&b(this).is(":hidden"),by,bC,bA,bH,bG,bE,bz,bD,bJ;bB.animatedProperties={};for(bA in bx){by=b.camelCase(bA);if(bA!==by){bx[by]=bx[bA];delete bx[bA]}bC=bx[by];if(b.isArray(bC)){bB.animatedProperties[by]=bC[1];bC=bx[by]=bC[0]}else{bB.animatedProperties[by]=bB.specialEasing&&bB.specialEasing[by]||bB.easing||"swing"}if(bC==="hide"&&bF||bC==="show"&&!bF){return bB.complete.call(this)}if(bI&&(by==="height"||by==="width")){bB.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(b.css(this,"display")==="inline"&&b.css(this,"float")==="none"){if(!b.support.inlineBlockNeedsLayout){this.style.display="inline-block"}else{bH=x(this.nodeName);if(bH==="inline"){this.style.display="inline-block"}else{this.style.display="inline";this.style.zoom=1}}}}}if(bB.overflow!=null){this.style.overflow="hidden"}for(bA in bx){bG=new b.fx(this,bB,bA);bC=bx[bA];if(ay.test(bC)){bG[bC==="toggle"?bF?"show":"hide":bC]()}else{bE=aO.exec(bC);bz=bG.cur();if(bE){bD=parseFloat(bE[2]);bJ=bE[3]||(b.cssNumber[bA]?"":"px");if(bJ!=="px"){b.style(this,bA,(bD||1)+bJ);bz=((bD||1)/bG.cur())*bz;b.style(this,bA,bz+bJ)}if(bE[1]){bD=((bE[1]==="-="?-1:1)*bD)+bz}bG.custom(bz,bD,bJ)}else{bG.custom(bz,bC,"")}}}return true})},stop:function(bu,bt){if(bu){this.queue([])}this.each(function(){var bw=b.timers,bv=bw.length;if(!bt){b._unmark(true,this)}while(bv--){if(bw[bv].elem===this){if(bt){bw[bv](true)}bw.splice(bv,1)}}});if(!bt){this.dequeue()}return this}});function be(){setTimeout(ap,0);return(a2=b.now())}function ap(){a2=K}function aY(bu,bt){var bv={};b.each(aE.concat.apply([],aE.slice(0,bt)),function(){bv[this]=bu});return bv}b.each({slideDown:aY("show",1),slideUp:aY("hide",1),slideToggle:aY("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(bt,bu){b.fn[bt]=function(bv,bx,bw){return this.animate(bu,bv,bx,bw)}});b.extend({speed:function(bv,bw,bu){var bt=bv&&typeof bv==="object"?b.extend({},bv):{complete:bu||!bu&&bw||b.isFunction(bv)&&bv,duration:bv,easing:bu&&bw||bw&&!b.isFunction(bw)&&bw};bt.duration=b.fx.off?0:typeof bt.duration==="number"?bt.duration:bt.duration in b.fx.speeds?b.fx.speeds[bt.duration]:b.fx.speeds._default;bt.old=bt.complete;bt.complete=function(bx){if(b.isFunction(bt.old)){bt.old.call(this)}if(bt.queue!==false){b.dequeue(this)}else{if(bx!==false){b._unmark(this)}}};return bt},easing:{linear:function(bv,bw,bt,bu){return bt+bu*bv},swing:function(bv,bw,bt,bu){return((-Math.cos(bv*Math.PI)/2)+0.5)*bu+bt}},timers:[],fx:function(bu,bt,bv){this.options=bt;this.elem=bu;this.prop=bv;bt.orig=bt.orig||{}}});b.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(b.fx.step[this.prop]||b.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var bt,bu=b.css(this.elem,this.prop);return isNaN(bt=parseFloat(bu))?!bu||bu==="auto"?0:bu:bt},custom:function(bz,by,bw){var bt=this,bv=b.fx,bx;this.startTime=a2||be();this.start=bz;this.end=by;this.unit=bw||this.unit||(b.cssNumber[this.prop]?"":"px");this.now=this.start;this.pos=this.state=0;function bu(bA){return bt.step(bA)}bu.elem=this.elem;if(bu()&&b.timers.push(bu)&&!a0){if(S){a0=true;bx=function(){if(a0){S(bx);bv.tick()}};S(bx)}else{a0=setInterval(bv.tick,bv.interval)}}},show:function(){this.options.orig[this.prop]=b.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());b(this.elem).show()},hide:function(){this.options.orig[this.prop]=b.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(bx){var bw=a2||be(),bt=true,by=this.elem,bu=this.options,bv,bA;if(bx||bw>=bu.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();bu.animatedProperties[this.prop]=true;for(bv in bu.animatedProperties){if(bu.animatedProperties[bv]!==true){bt=false}}if(bt){if(bu.overflow!=null&&!b.support.shrinkWrapBlocks){b.each(["","X","Y"],function(bB,bC){by.style["overflow"+bC]=bu.overflow[bB]})}if(bu.hide){b(by).hide()}if(bu.hide||bu.show){for(var bz in bu.animatedProperties){b.style(by,bz,bu.orig[bz])}}bu.complete.call(by)}return false}else{if(bu.duration==Infinity){this.now=bw}else{bA=bw-this.startTime;this.state=bA/bu.duration;this.pos=b.easing[bu.animatedProperties[this.prop]](this.state,bA,0,1,bu.duration);this.now=this.start+((this.end-this.start)*this.pos)}this.update()}return true}};b.extend(b.fx,{tick:function(){for(var bu=b.timers,bt=0;bt<bu.length;++bt){if(!bu[bt]()){bu.splice(bt--,1)}}if(!bu.length){b.fx.stop()}},interval:13,stop:function(){clearInterval(a0);a0=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(bt){b.style(bt.elem,"opacity",bt.now)},_default:function(bt){if(bt.elem.style&&bt.elem.style[bt.prop]!=null){bt.elem.style[bt.prop]=(bt.prop==="width"||bt.prop==="height"?Math.max(0,bt.now):bt.now)+bt.unit}else{bt.elem[bt.prop]=bt.now}}}});if(b.expr&&b.expr.filters){b.expr.filters.animated=function(bt){return b.grep(b.timers,function(bu){return bt===bu.elem}).length}}function x(bw){if(!R[bw]){var bt=ar.body,bu=b("<"+bw+">").appendTo(bt),bv=bu.css("display");bu.remove();if(bv==="none"||bv===""){if(!a7){a7=ar.createElement("iframe");a7.frameBorder=a7.width=a7.height=0}bt.appendChild(a7);if(!m||!a7.createElement){m=(a7.contentWindow||a7.contentDocument).document;m.write((ar.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");m.close()}bu=m.createElement(bw);m.body.appendChild(bu);bv=b.css(bu,"display");bt.removeChild(a7)}R[bw]=bv}return R[bw]}var V=/^t(?:able|d|h)$/i,ab=/^(?:body|html)$/i;if("getBoundingClientRect" in ar.documentElement){b.fn.offset=function(bG){var bw=this[0],bz;if(bG){return this.each(function(bH){b.offset.setOffset(this,bG,bH)})}if(!bw||!bw.ownerDocument){return null}if(bw===bw.ownerDocument.body){return b.offset.bodyOffset(bw)}try{bz=bw.getBoundingClientRect()}catch(bD){}var bF=bw.ownerDocument,bu=bF.documentElement;if(!bz||!b.contains(bu,bw)){return bz?{top:bz.top,left:bz.left}:{top:0,left:0}}var bA=bF.body,bB=aH(bF),by=bu.clientTop||bA.clientTop||0,bC=bu.clientLeft||bA.clientLeft||0,bt=bB.pageYOffset||b.support.boxModel&&bu.scrollTop||bA.scrollTop,bx=bB.pageXOffset||b.support.boxModel&&bu.scrollLeft||bA.scrollLeft,bE=bz.top+bt-by,bv=bz.left+bx-bC;return{top:bE,left:bv}}}else{b.fn.offset=function(bE){var by=this[0];if(bE){return this.each(function(bF){b.offset.setOffset(this,bE,bF)})}if(!by||!by.ownerDocument){return null}if(by===by.ownerDocument.body){return b.offset.bodyOffset(by)}b.offset.initialize();var bB,bv=by.offsetParent,bu=by,bD=by.ownerDocument,bw=bD.documentElement,bz=bD.body,bA=bD.defaultView,bt=bA?bA.getComputedStyle(by,null):by.currentStyle,bC=by.offsetTop,bx=by.offsetLeft;while((by=by.parentNode)&&by!==bz&&by!==bw){if(b.offset.supportsFixedPosition&&bt.position==="fixed"){break}bB=bA?bA.getComputedStyle(by,null):by.currentStyle;bC-=by.scrollTop;bx-=by.scrollLeft;if(by===bv){bC+=by.offsetTop;bx+=by.offsetLeft;if(b.offset.doesNotAddBorder&&!(b.offset.doesAddBorderForTableAndCells&&V.test(by.nodeName))){bC+=parseFloat(bB.borderTopWidth)||0;bx+=parseFloat(bB.borderLeftWidth)||0}bu=bv;bv=by.offsetParent}if(b.offset.subtractsBorderForOverflowNotVisible&&bB.overflow!=="visible"){bC+=parseFloat(bB.borderTopWidth)||0;bx+=parseFloat(bB.borderLeftWidth)||0}bt=bB}if(bt.position==="relative"||bt.position==="static"){bC+=bz.offsetTop;bx+=bz.offsetLeft}if(b.offset.supportsFixedPosition&&bt.position==="fixed"){bC+=Math.max(bw.scrollTop,bz.scrollTop);bx+=Math.max(bw.scrollLeft,bz.scrollLeft)}return{top:bC,left:bx}}}b.offset={initialize:function(){var bt=ar.body,bu=ar.createElement("div"),bx,bz,by,bA,bv=parseFloat(b.css(bt,"marginTop"))||0,bw="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";b.extend(bu.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});bu.innerHTML=bw;bt.insertBefore(bu,bt.firstChild);bx=bu.firstChild;bz=bx.firstChild;bA=bx.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(bz.offsetTop!==5);this.doesAddBorderForTableAndCells=(bA.offsetTop===5);bz.style.position="fixed";bz.style.top="20px";this.supportsFixedPosition=(bz.offsetTop===20||bz.offsetTop===15);bz.style.position=bz.style.top="";bx.style.overflow="hidden";bx.style.position="relative";this.subtractsBorderForOverflowNotVisible=(bz.offsetTop===-5);this.doesNotIncludeMarginInBodyOffset=(bt.offsetTop!==bv);bt.removeChild(bu);b.offset.initialize=b.noop},bodyOffset:function(bt){var bv=bt.offsetTop,bu=bt.offsetLeft;b.offset.initialize();if(b.offset.doesNotIncludeMarginInBodyOffset){bv+=parseFloat(b.css(bt,"marginTop"))||0;bu+=parseFloat(b.css(bt,"marginLeft"))||0}return{top:bv,left:bu}},setOffset:function(bw,bF,bz){var bA=b.css(bw,"position");if(bA==="static"){bw.style.position="relative"}var by=b(bw),bu=by.offset(),bt=b.css(bw,"top"),bD=b.css(bw,"left"),bE=(bA==="absolute"||bA==="fixed")&&b.inArray("auto",[bt,bD])>-1,bC={},bB={},bv,bx;if(bE){bB=by.position();bv=bB.top;bx=bB.left}else{bv=parseFloat(bt)||0;bx=parseFloat(bD)||0}if(b.isFunction(bF)){bF=bF.call(bw,bz,bu)}if(bF.top!=null){bC.top=(bF.top-bu.top)+bv}if(bF.left!=null){bC.left=(bF.left-bu.left)+bx}if("using" in bF){bF.using.call(bw,bC)}else{by.css(bC)}}};b.fn.extend({position:function(){if(!this[0]){return null}var bv=this[0],bu=this.offsetParent(),bw=this.offset(),bt=ab.test(bu[0].nodeName)?{top:0,left:0}:bu.offset();bw.top-=parseFloat(b.css(bv,"marginTop"))||0;bw.left-=parseFloat(b.css(bv,"marginLeft"))||0;bt.top+=parseFloat(b.css(bu[0],"borderTopWidth"))||0;bt.left+=parseFloat(b.css(bu[0],"borderLeftWidth"))||0;return{top:bw.top-bt.top,left:bw.left-bt.left}},offsetParent:function(){return this.map(function(){var bt=this.offsetParent||ar.body;while(bt&&(!ab.test(bt.nodeName)&&b.css(bt,"position")==="static")){bt=bt.offsetParent}return bt})}});b.each(["Left","Top"],function(bu,bt){var bv="scroll"+bt;b.fn[bv]=function(by){var bw,bx;if(by===K){bw=this[0];if(!bw){return null}bx=aH(bw);return bx?("pageXOffset" in bx)?bx[bu?"pageYOffset":"pageXOffset"]:b.support.boxModel&&bx.document.documentElement[bv]||bx.document.body[bv]:bw[bv]}return this.each(function(){bx=aH(this);if(bx){bx.scrollTo(!bu?by:b(bx).scrollLeft(),bu?by:b(bx).scrollTop())}else{this[bv]=by}})}});function aH(bt){return b.isWindow(bt)?bt:bt.nodeType===9?bt.defaultView||bt.parentWindow:false}b.each(["Height","Width"],function(bu,bt){var bv=bt.toLowerCase();b.fn["inner"+bt]=function(){var bw=this[0];return bw&&bw.style?parseFloat(b.css(bw,bv,"padding")):null};b.fn["outer"+bt]=function(bx){var bw=this[0];return bw&&bw.style?parseFloat(b.css(bw,bv,bx?"margin":"border")):null};b.fn[bv]=function(bx){var by=this[0];if(!by){return bx==null?null:this}if(b.isFunction(bx)){return this.each(function(bC){var bB=b(this);bB[bv](bx.call(this,bC,bB[bv]()))})}if(b.isWindow(by)){var bz=by.document.documentElement["client"+bt];return by.document.compatMode==="CSS1Compat"&&bz||by.document.body["client"+bt]||bz}else{if(by.nodeType===9){return Math.max(by.documentElement["client"+bt],by.body["scroll"+bt],by.documentElement["scroll"+bt],by.body["offset"+bt],by.documentElement["offset"+bt])}else{if(bx===K){var bA=b.css(by,bv),bw=parseFloat(bA);return b.isNaN(bw)?bA:bw}else{return this.css(bv,typeof bx==="string"?bx:bx+"px")}}}}});ba.jQuery=ba.$=b})(window);jQuery.Buffer=function(){var b=function(c){if(c){this.assign(c)}this._bufferedCommandList=[];this._bufferedCommands={}};b._buffers=[];b._pool=[];b.bufferForElement=function(c){if(c._jquery_buffer){return c._jquery_buffer}return this.bufferFromPool().assign(c)};b.bufferFromPool=function(){var c=null;if(this._pool.length===0){c=new b()}else{c=this._pool.pop()}b._buffers.push(c);if(!this.flushingScheduled){this.scheduleFlushing()}return c};b.returnToPool=function(c){c.unassign();this._pool.push(c)};b.scheduleFlushing=function(){this.flushingScheduled=true};b.flush=function(){var f=this._buffers,d,c=f.length;for(d=0;d<c;d++){f[d].flush();this.returnToPool(f[d])}this._buffers=[];this.flushingScheduled=false};b.prototype.assign=function(c){if(this._el){this.unassign()}this._el=c;this._el._jquery_buffer=this;return this};b.prototype.unassign=function(){if(!this._el){return}this._el._jquery_buffer=undefined;this._el=undefined;return this};b.prototype.flush=function(){var g=this._bufferedCommandList,f=g.length,d,h;for(d=0;d<f;d++){h=g[d];this[h](this._bufferedCommands[h]);delete this._bufferedCommands[h]}this._bufferedCommandList.length=0;this.unassign()};b.prototype.$=function(c,d){if(!d){d=this._el}if(c===""||c===undefined){c=d;d=undefined}return jQuery(c,d)};b.prototype.bufferedCommand=function(c){if(!this._bufferedCommands[c]){this._bufferedCommands[c]={};this._bufferedCommandList.push(c)}return this._bufferedCommands[c]};b.prototype.hasBufferedCommand=function(c){return !!this._bufferedCommands[c]};b.prototype.html=function(d){var c=this.bufferedCommand("flushContent");if(d===undefined){return c.text||c.html||this.$().html()}c.text=undefined;c.html=d};b.prototype.text=function(d){var c=this.bufferedCommand("flushContent");if(d===undefined){return c.text||c.html||this.$().text()}c.text=d;c.html=undefined};b.prototype.flushContent=function(c){if(c.text!==undefined){this.$().text(c.text)}else{if(c.html!==undefined){this.$().html(c.html)}}};b.prototype.attr=function(g,h){if(typeof g==="object"){for(var d in g){this.attr(d,g[d])}return}if(g==="class"){if(h===undefined){return this.setClass().join(" ")}else{if(typeof h==="string"||jQuery.isArray(h)){var c=this.bufferedCommand("flushClassNames");c.classNames=this._hashFromClassNames(h);return}else{return this.setClass(h)}}}else{if(g==="html"){return this.html(h)}else{if(g==="text"){return this.text(h)}else{if(g==="style"){return this.resetStyles(h)}}}}var f=this.bufferedCommand("flushAttributes");if(!f.attr){f.attr={}}f.attr[g]=h};b.prototype.flushAttributes=function(g){var c=g.attr,h=this.$(),d;for(var f in c){if(!c.hasOwnProperty(f)){continue}d=c[f];if(d!==null){h.attr(f,d)}else{h.removeAttr(f)}}};b.prototype._STYLE_REGEX=/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g;b.prototype._camelizeStyleName=function(c){var d=c.match(/^-(webkit|moz|o)-/),f=c.camelize();if(d){return f.substr(0,1).toUpperCase()+f.substr(1)}else{return f}};b.prototype._dasherizeStyleName=function(c){var d=SC.String.dasherize(c);if(d.match(/^(webkit|moz|ms|o)-/)){d="-"+d}return d};b.prototype._loadStyles=function(c){if(!c){c=this.$().attr("style")}if(c&&(c=c.toString()).length>0){if(SC.browser.isIE){c=c.toLowerCase()}var g={};var f=this._STYLE_REGEX,d;f.lastIndex=0;while(d=f.exec(c)){g[this._camelizeStyleName(d[1])]=d[2]}return g}else{return{}}};b.prototype.resetStyles=function(d){var c=this.bufferedCommand("flushStyles");c._styles=this._loadStyles(d||" ")};b.prototype.styles=function(){var c=this.bufferedCommand("flushStyles");if(!c._styles){c._styles=this._loadStyles()}return c._styles};b.prototype.css=function(f,g){if(typeof f==="object"){for(var c in f){this.css(c,f[c])}return}var d=this.bufferedCommand("flushStyles");if(!d._styles){d._styles=this._loadStyles()}d._styles[f]=g};b.prototype.flushStyles=function(f){var h=f._styles;var j="";var d,i,g=[],c=0;for(d in h){if(!h.hasOwnProperty(d)){continue}i=h[d];if(i===null){continue}if(typeof i==="number"&&d!=="zIndex"&&d!=="fontWeight"&&d!=="opacity"){i+="px"}g[c++]=this._dasherizeStyleName(d)+": "+i}this.$().attr("style",g.join("; "))};b.prototype._hashFromClassNames=function(g){if(typeof g==="string"){g=g.split(" ")}var d,c=g.length,f={};for(d=0;d<c;d++){f[g[d]]=true}return f};b.prototype.setClass=function(h,c){var g=this.bufferedCommand("flushClassNames"),f;if(h===undefined){if(!g.classNames){g.classNames=this._hashFromClassNames(this._el.className)}var i=g.classNames,d=[];for(f in i){if(f&&i[f]){d.push(f)}}return d}if(typeof h==="object"){if(!g.classNames){g.classNames=this._hashFromClassNames(this._el.className)}for(f in h){g.classNames[f]=h[f]}return}if(!g.classNames){g.classNames=this._hashFromClassNames(this._el.className)}g.classNames[h]=c||false};b.prototype.hasClass=function(d){var c=this.bufferedCommand("flushClassNames");if(!c.classNames){c.classNames=this._hashFromClassNames(this._el.className)}return !!c.classNames[d]};b.prototype.addClass=function(g){if(!g){return}var f=this.bufferedCommand("flushClassNames");if(!f.classNames){f.classNames=this._hashFromClassNames(this._el.className)}if(typeof g==="string"){g=g.split(" ")}var d,c=g.length;for(d=0;d<c;d++){f.classNames[jQuery.trim(g[d])]=true}};b.prototype.removeClass=function(d){var c=this.bufferedCommand("flushClassNames");if(d===undefined){c.classNames={}}else{if(!c.classNames){c.classNames=this._hashFromClassNames(this._el.className)}c.classNames[d]=false}};b.prototype.resetClassNames=function(d){var c=this.bufferedCommand("flushClassNames");c.classNames={}};b.prototype.flushClassNames=function(f){var g=[];var h=f.classNames,d;for(d in h){if(h[d]){g.push(d)}}this.$().attr("class",g.join(" "))};function a(d){for(var c in d){if(typeof d[c]==="function"){d[c].displayName=c}}}a(b);a(b.prototype);return b}();(function(){jQuery.buffer=jQuery.bufferedJQuery=jQuery.sub();jQuery.bufferedJQuery.fn.extend({html:function(d){if(d===undefined){if(this.length<1){return undefined}return jQuery.Buffer.bufferForElement(this[0]).html()}var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.html(d)}return this},text:function(d){if(d===undefined){if(this.length<1){return undefined}return jQuery.Buffer.bufferForElement(this[0]).text()}var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.text(d)}return this},attr:function(d,f){var b;if(typeof f==="undefined"&&typeof d==="string"){if(this.length<1){return false}b=jQuery.Buffer.bufferForElement(this[0]);return b.attr(d)}var a=this.length,c;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.attr(d,f)}return this},hasClass:function(a){if(this.length<1){return false}return jQuery.Buffer.bufferForElement(this[0]).hasClass(a)},setClass:function(f,c){var a=this.length,d,b;for(d=0;d<a;d++){b=jQuery.Buffer.bufferForElement(this[d]);b.setClass(f,c)}return this},addClass:function(d){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.addClass(d)}return this},removeClass:function(d){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.removeClass(d)}return this},resetClassNames:function(){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.resetClassNames()}return this},css:function(d,f){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.css(d,f)}return this},styles:function(){if(this.length<1){return null}return jQuery.Buffer.bufferForElement(this[0]).styles()},resetStyles:function(){if(this.length<1){return null}jQuery.Buffer.bufferForElement(this[0]).resetStyles();return this}})})();jQuery.Buffer._flush=function(){jQuery.Buffer.flush()};jQuery.Buffer.scheduleFlushing=function(){SC.RunLoop.currentRunLoop.invokeOnce(jQuery.Buffer._flush);this.flushingScheduled=true};if(!window.require){window.require=function require(){}}if(!window.sc_require){window.sc_require=require}if(!window.sc_resource){window.sc_resource=function sc_resource(){}}sc_require("license");window.YES=true;window.NO=false;if(typeof console==="undefined"){window.console={};console.log=console.info=console.warn=console.error=function(){}}window.SC=window.SC||{};window.SproutCore=window.SproutCore||SC;SC=window.SC;SC.VERSION="1.9.1";SC._baseMixin=function(c){var g=Array.prototype.slice.call(arguments,1),a,f=g[0]||{},h=1,d=g.length,j,b,i;if(d===1){f=this||{};h=0}for(;h<d;h++){if(!(j=g[h])){continue}for(i in j){if(!j.hasOwnProperty(i)){continue}b=j[i];if(f===b){continue}if(b!==undefined&&(c||(f[i]===undefined))){f[i]=b}}if(j.hasOwnProperty("toString")){f.toString=j.toString}}return f};SC.mixin=function(){var a=Array.prototype.slice.call(arguments);a.unshift(true);return SC._baseMixin.apply(this,a)};SC.supplement=function(){var a=Array.prototype.slice.call(arguments);a.unshift(false);return SC._baseMixin.apply(this,a)};SC.extend=SC.mixin;SC.mixin({T_ERROR:"error",T_OBJECT:"object",T_NULL:"null",T_CLASS:"class",T_HASH:"hash",T_FUNCTION:"function",T_UNDEFINED:"undefined",T_NUMBER:"number",T_BOOL:"boolean",T_ARRAY:"array",T_STRING:"string",T_DATE:"date",T_REGEXP:"regexp",typeOf:function(a){if(a===undefined){return SC.T_UNDEFINED}if(a===null){return SC.T_NULL}var b=jQuery.type(a);if(b==="function"){return a.isClass?SC.T_CLASS:SC.T_FUNCTION}else{if(b==="object"){if(SC.Error&&(a instanceof SC.Error)){return SC.T_ERROR}else{if(a instanceof SC.Object){return SC.T_OBJECT}else{return SC.T_HASH}}}}return b},none:function(a){return a==null},empty:function(a){return a===null||a===undefined||a===""},isArray:function(a){if(!a||a.setInterval){return false}if(Array.isArray&&Array.isArray(a)){return true}if(a.objectAt){return true}if(a.length!==undefined&&jQuery.type(a)==="object"){return true}return false},makeArray:function(a){return SC.isArray(a)?a:SC.A(a)},A:function(c){if(c===null||c===undefined){return[]}if(c.slice instanceof Function){if(typeof(c)==="string"){return[c]}else{return c.slice()}}if(c.toArray){return c.toArray()}if(!SC.isArray(c)){return[c]}var b=[],a=c.length;while(--a>=0){b[a]=c[a]}return b},guidKey:"SproutCore"+(SC.VERSION+Math.random()).replace(/\D/g,""),_guidPrefixes:{number:"nu",string:"st"},_guidCaches:{number:{},string:{}},_numberGuids:[],_stringGuids:{},_keyCache:{},guidFor:function(f){var b,c,d=typeof f;if(f===undefined){return"(undefined)"}if(f===null){return"(null)"}if(d===SC.T_NUMBER||d===SC.T_STRING){b=this._guidCaches[d];c=b[f];if(!c){c="st"+(jQuery.uuid++);b[f]=c}return c}else{if(d===SC.T_BOOL){return(f)?"(true)":"(false)"}}var a=this.guidKey;if(f[a]){return f[a]}if(f===Object){return"(Object)"}if(f===Array){return"(Array)"}return SC.generateGuid(f,"sc")},keyFor:function(d,c){var b,a=this._keyCache[d];if(!a){a=this._keyCache[d]={}}b=a[c];if(!b){b=a[c]=d+"_"+c}return b},generateGuid:function(c,b){var a=(b+(jQuery.uuid++));if(c){c[this.guidKey]=a}return a},hashFor:function(){var a=arguments.length,c="",g,d,b;for(b=0;b<a;++b){g=arguments[b];c+=(g&&(d=g.hash)&&(typeof d===SC.T_FUNCTION))?d.call(g):this.guidFor(g)}return c===""?null:c},isEqual:function(d,c){return this.hashFor(d)===this.hashFor(c)},compare:function(t,q){if(t===q){return 0}var k=SC.typeOf(t);var h=SC.typeOf(q);var b=SC.ORDER_DEFINITION_MAPPING;if(!b){var d=SC.ORDER_DEFINITION;b=SC.ORDER_DEFINITION_MAPPING={};var s,o;for(s=0,o=d.length;s<o;++s){b[d[s]]=s}delete SC.ORDER_DEFINITION}var u=b[k];var c=b[h];if(u<c){return -1}if(u>c){return 1}switch(k){case SC.T_BOOL:case SC.T_NUMBER:if(t<q){return -1}if(t>q){return 1}return 0;case SC.T_STRING:var m=t.localeCompare(q);if(m<0){return -1}if(m>0){return 1}return 0;case SC.T_ARRAY:var p=t.length;var n=q.length;var f=Math.min(p,n);var a=0;var j=0;var g=arguments.callee;while(a===0&&j<f){a=g(t[j],q[j]);j++}if(a!==0){return a}if(p<n){return -1}if(p>n){return 1}return 0;case SC.T_OBJECT:if(t.constructor.isComparable===YES){return t.constructor.compare(t,q)}return 0;default:return 0}},K:function(){return this},EMPTY_ARRAY:[],EMPTY_HASH:{},EMPTY_RANGE:{start:0,length:0},beget:function(c){if(c===null||c===undefined){return null}var a=SC.K;a.prototype=c;var b=new a();a.prototype=null;if(typeof c.didBeget==="function"){b=c.didBeget(b)}return b},copy:function(d,b){var c=d,a;if(d){if(d.isCopyable){return d.copy(b)}if(d.clone){return d.clone()}}switch(jQuery.type(d)){case"array":c=d.slice();if(b){a=c.length;while(a--){c[a]=SC.copy(c[a],true)}}break;case"object":c={};for(var f in d){c[f]=b?SC.copy(d[f],true):d[f]}}return c},merge:function(){var c={},b=arguments.length,a;for(a=0;a<b;a++){SC.mixin(c,arguments[a])}return c},keys:function(c){var a=[];for(var b in c){a.push(b)}return a},inspect:function(d){var a,b=[];for(var c in d){a=d[c];if(a==="toString"){continue}if(SC.typeOf(a)===SC.T_FUNCTION){a="function() { ... }"}b.push(c+": "+a)}return"{"+b.join(" , ")+"}"},tupleForPropertyPath:function(f,a){if(typeof f==="object"&&(f instanceof Array)){return f}var c;var b=f.indexOf("*");if(b<0){b=f.lastIndexOf(".")}c=(b>=0)?f.slice(b+1):f;var d=this.objectForPropertyPath(f,a,b);return(d&&c)?[d,c]:null},objectForPropertyPath:function(g,c,d){var h,b,f,a;if(!c){c=window}if(SC.typeOf(g)===SC.T_STRING){if(d===undefined){d=g.length}h=0;while((c)&&(h<d)){b=g.indexOf(".",h);if((b<0)||(b>d)){b=d}f=g.slice(h,b);c=c.get?c.get(f):c[f];h=b+1}if(h<d){c=undefined}}else{h=0;a=g.length;f=null;while((h<a)&&c){f=g[h++];if(f){c=(c.get)?c.get(f):c[f]}}if(h<a){c=undefined}}return c},requiredObjectForPropertyPath:function(c,a,b){var d=SC.objectForPropertyPath(c,a,b);if(!d){throw c+" could not be found"}return d}});SC.clone=SC.copy;SC.$A=SC.A;SC.didLoad=SC.K;SC.ORDER_DEFINITION=[SC.T_ERROR,SC.T_UNDEFINED,SC.T_NULL,SC.T_BOOL,SC.T_NUMBER,SC.T_STRING,SC.T_ARRAY,SC.T_HASH,SC.T_OBJECT,SC.T_FUNCTION,SC.T_CLASS];SC.Function={property:function(b,c){b.dependentKeys=SC.$A(c);var a=SC.guidFor(b);b.cacheKey="__cache__"+a;b.lastSetValueKey="__lastValue__"+a;b.isProperty=true;return b},cacheable:function(a,b){a.isProperty=true;if(!a.dependentKeys){a.dependentKeys=[]}a.isCacheable=(b===undefined)?true:b;return a},idempotent:function(a,b){a.isProperty=true;if(!a.dependentKeys){this.dependentKeys=[]}a.isVolatile=(b===undefined)?true:b;return a},enhance:function(a){a.isEnhancement=true;return a},observes:function(c,a){var g=a.length,b=null,f=null;while(--g>=0){var d=a[g];if((d.indexOf(".")<0)&&(d.indexOf("*")<0)){if(!b){b=c.localPropertyPaths=[]}b.push(d)}else{if(!f){f=c.propertyPaths=[]}f.push(d)}}return c}};sc_require("system/function");SC.mixin(Function.prototype,{property:function(){return SC.Function.property(this,arguments)},cacheable:function(a){return SC.Function.cacheable(this,a)},idempotent:function(a){return SC.Function.idempotent(this,a)},enhance:function(){return SC.Function.enhance(this)},observes:function(a){return SC.Function.observes(this,arguments)}});SC.ObserverSet={add:function(k,a,c){var b=SC.guidFor(k),g=SC.guidFor(a),j=this._members,d=this.members,h=j[b],i,f;if(!h){h=j[b]={}}i=h[g];if(i===undefined){h[g]=d.length;f=[k,a,c];d.push(f)}else{}},remove:function(h,i){var f=SC.guidFor(h),b=SC.guidFor(i);var d=this._members[f],a=this.members;if(!d){return false}var c=d[b];if(c===undefined){return false}if(c!==a.length-1){var g=(a[c]=a[a.length-1]);this._members[SC.guidFor(g[0])][SC.guidFor(g[1])]=c}a.pop();delete this._members[f][b];return true},invokeMethods:function(){var b=this.members,d;for(var c=0,a=b.length;c<a;c++){d=b[c];d[1].call(d[0])}},clone:function(){var c=SC.ObserverSet.create(),d=this.members;c._members=SC.clone(this._members);var f=c.members;for(var b=0,a=d.length;b<a;b++){f[b]=SC.clone(d[b]);f[b].length=3}return c},create:function(){return new SC.ObserverSet.constructor()},getMembers:function(){return this.members.slice(0)},constructor:function(){this._members={};this.members=[]}};SC.ObserverSet.constructor.prototype=SC.ObserverSet;SC.ObserverSet.slice=SC.ObserverSet.clone;SC.ObserverSet.copy=SC.ObserverSet.clone;SC._ChainObserver=function(b,a){this.property=b;this.root=a||this};SC._ChainObserver.createChain=function(g,n,h,a,b){var d=n.split("."),k=new SC._ChainObserver(d[0]),j=k;for(var f=1,c=d.length;f<c;f++){j=j.next=new SC._ChainObserver(d[f],k)}var m=k.tails=[j];k.objectDidChange(g);m.forEach(function(i){i.target=h;i.method=a;i.context=b});k.tails=null;return k};SC._ChainObserver.prototype={isChainObserver:true,object:null,property:null,next:null,root:null,target:null,method:null,tail:function(){if(this._tail){return this._tail}var a=this;while(a.next){a=a.next}this._tail=a;return a},objectDidChange:function(a){if(a===this.object){return}if(this.object){if(this.property==="@each"&&this.object._removeContentObserver){this.object._removeContentObserver(this)}else{if(this.object.removeObserver){this.object.removeObserver(this.property,this,this.propertyDidChange)}}}this.object=a;if(this.property==="@each"&&this.next){if(this.object&&this.object._addContentObserver){this.object._addContentObserver(this)}}else{if(this.object&&this.object.addObserver){this.object.addObserver(this.property,this,this.propertyDidChange)}this.propertyDidChange()}},propertyDidChange:function(){var b=this.object;var f=this.property;var d=(b&&b.get)?b.get(f):null;if(this.next){this.next.objectDidChange(d)}var g=this.target,h=this.method,c=this.context;if(g&&h){var a=b?b.propertyRevision:null;if(c){h.call(g,b,f,d,c,a)}else{h.call(g,b,f,d,a)}}},destroyChain:function(){var a=this.object;if(a){if(this.property==="@each"&&this.next&&a._removeContentObserver){a._removeContentObserver(this)}if(a.removeObserver){a.removeObserver(this.property,this,this.propertyDidChange)}}if(this.next){this.next.destroyChain()}this.next=this.target=this.method=this.object=this.context=null;return null}};sc_require("ext/function");sc_require("private/observer_set");sc_require("private/chain_observer");SC.LOG_OBSERVERS=NO;SC.OBSERVES_HANDLER_ADD=0;SC.OBSERVES_HANDLER_REMOVE=1;SC.Observable={isObservable:YES,automaticallyNotifiesObserversFor:function(a){return YES},get:function(c){var b=this[c],a;if(b===undefined){return this.unknownProperty(c)}else{if(b&&b.isProperty){if(b.isCacheable){a=this._kvo_cache;if(!a){a=this._kvo_cache={}}return(a[b.cacheKey]!==undefined)?a[b.cacheKey]:(a[b.cacheKey]=b.call(this,c))}else{return b.call(this,c)}}else{return b}}},set:function(j,h){var b=this[j],k=this.automaticallyNotifiesObserversFor(j),g=h,d,a,i,f;if(h===undefined&&SC.typeOf(j)===SC.T_HASH){var c=j;for(j in c){if(!c.hasOwnProperty(j)){continue}this.set(j,c[j])}return this}if(!k&&this._kvo_cacheable&&(a=this._kvo_cache)){d=this._kvo_cachedep;if(!d||(d=d[j])===undefined){d=this._kvo_computeCachedDependentsFor(j)}if(d){i=d.length;while(--i>=0){f=d[i];a[f.cacheKey]=a[f.lastSetValueKey]=undefined}}}if(b&&b.isProperty){a=this._kvo_cache;if(b.isVolatile||!a||(a[b.lastSetValueKey]!==h)){if(!a){a=this._kvo_cache={}}a[b.lastSetValueKey]=h;if(k){this.propertyWillChange(j)}g=b.call(this,j,h);if(b.isCacheable){a[b.cacheKey]=g}if(k){this.propertyDidChange(j,g,YES)}}}else{if(b===undefined){if(k){this.propertyWillChange(j)}this.unknownProperty(j,h);if(k){this.propertyDidChange(j,g)}}else{if(this[j]!==h){if(k){this.propertyWillChange(j)}g=this[j]=h;if(k){this.propertyDidChange(j,g)}}}}return this},unknownProperty:function(a,b){if(!(b===undefined)){this[a]=b}return b},beginPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;return this},endPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;var b=this._kvo_changeLevel,a=this._kvo_changes;if((b<=0)&&a&&(a.length>0)&&!SC.Observers.isObservingSuspended){this._notifyPropertyObservers()}return this},propertyWillChange:function(a){return this},propertyDidChange:function(o,m,c){this._kvo_revision=(this._kvo_revision||0)+1;var b=this._kvo_changeLevel||0,i,n,j,d,g=SC.LOG_OBSERVERS&&(this.LOG_OBSERVING!==NO);var k=this._kvo_property_chains;if(k){var h=k[o];if(h){this.beginPropertyChanges();h=SC.clone(h);h.forEach(function(p){p.notifyPropertyDidChange()});this.endPropertyChanges()}}var a=this._kvo_cache;if(a){if(!c){d=this[o];if(d&&d.isProperty){a[d.cacheKey]=a[d.lastSetValueKey]=undefined}}if(this._kvo_cacheable){i=this._kvo_cachedep;if(!i||(i=i[o])===undefined){i=this._kvo_computeCachedDependentsFor(o)}if(i){n=i.length;while(--n>=0){j=i[n];a[j.cacheKey]=a[j.lastSetValueKey]=undefined}}}}var f=SC.Observers.isObservingSuspended;if((b>0)||f){var l=this._kvo_changes;if(!l){l=this._kvo_changes=SC.CoreSet.create()}l.add(o);if(f){if(g){SC.Logger.log("%@%@: will not notify observers because observing is suspended".fmt(SC.KVO_SPACES,this))}SC.Observers.objectHasPendingChanges(this)}}else{this._notifyPropertyObservers(o)}return this},registerDependentKey:function(i,c){var f=this._kvo_dependents,j=this._kvo_chain_dependents,b=this[i],k,h,a,g,d;if(typeof c==="object"&&(c instanceof Array)){k=c;a=0}else{k=arguments;a=1}h=k.length;if(!f){this._kvo_dependents=f={}}while(--h>=a){g=k[h];if(g.indexOf(".")>=0){SC._PropertyChain.createChain(g,this,i).activate(this)}else{d=f[g];if(!d){d=f[g]=[]}d.push(i)}}},registerDependentKeyWithChain:function(c,a){var d=this._chainsFor(c),b;d.add(a)},removeDependentKeyWithChain:function(c,a){var d=this._chainsFor(c),b;d.remove(a);if(d.get("length")===0){delete this._kvo_property_chains[c]}},_chainsFor:function(a){this._kvo_property_chains=this._kvo_property_chains||{};var b=this._kvo_property_chains[a]||SC.CoreSet.create();this._kvo_property_chains[a]=b;return b},_kvo_addCachedDependents:function(b,g,i,c){var a=g.length,f,d,h;while(--a>=0){d=g[a];c.add(d);f=this[d];if(f&&(f instanceof Function)&&f.isProperty){if(f.isCacheable){b.push(f)}if((h=i[d])&&h.length>0){this._kvo_addCachedDependents(b,h,i,c)}}}},_kvo_computeCachedDependentsFor:function(c){var d=this._kvo_cachedep,g=this._kvo_dependents,f=g?g[c]:null,a,b;if(!d){d=this._kvo_cachedep={}}if(!f||f.length===0){return d[c]=null}a=d[c]=[];b=SC._TMP_SEEN_SET=(SC._TMP_SEEN_SET||SC.CoreSet.create());b.add(c);this._kvo_addCachedDependents(a,f,g,b);b.clear();if(a.length===0){a=d[c]=null}return a},_kvo_for:function(c,b){var a=this[c];if(!this._kvo_cloned){this._kvo_cloned={}}if(!a){a=this[c]=(b===undefined)?[]:b.create();this._kvo_cloned[c]=YES}else{if(!this._kvo_cloned[c]){a=this[c]=a.copy();this._kvo_cloned[c]=YES}}return a},addObserver:function(c,g,i,b){var d,a,f,h;if(i===undefined){i=g;g=this}if(!g){g=this}if(typeof i==="string"){i=g[i]}if(!i){throw"You must pass a method to addObserver()"}c=c.toString();if(c.indexOf(".")>=0){a=SC._ChainObserver.createChain(this,c,g,i,b);a.masterTarget=g;a.masterMethod=i;this._kvo_for(SC.keyFor("_kvo_chains",c)).push(a)}else{if((this[c]===undefined)&&(c.indexOf("@")===0)){this.get(c)}if(g===this){g=null}d=SC.keyFor("_kvo_observers",c);this._kvo_for(d,SC.ObserverSet).add(g,i,b);this._kvo_for("_kvo_observed_keys",SC.CoreSet).add(c)}if(this.didAddObserver){this.didAddObserver(c,g,i)}return this},removeObserver:function(c,g,i){var d,f,b,h,a;if(i===undefined){i=g;g=this}if(!g){g=this}if(typeof i==="string"){i=g[i]}if(!i){throw"You must pass a method to removeObserver()"}c=c.toString();if(c.indexOf(".")>=0){d=SC.keyFor("_kvo_chains",c);if(f=this[d]){f=this._kvo_for(d);a=f.length;while(--a>=0){b=f[a];if(b&&(b.masterTarget===g)&&(b.masterMethod===i)){f[a]=b.destroyChain()}}}}else{if(g===this){g=null}d=SC.keyFor("_kvo_observers",c);if(h=this[d]){h=this._kvo_for(d);h.remove(g,i);if(h.getMembers().length===0){this._kvo_for("_kvo_observed_keys",SC.CoreSet).remove(c)}}}if(this.didRemoveObserver){this.didRemoveObserver(c,g,i)}return this},hasObserverFor:function(b){SC.Observers.flush(this);var d=this[SC.keyFor("_kvo_observers",b)],c=this[SC.keyFor("_kvo_local",b)],a;if(c&&c.length>0){return YES}if(d&&d.getMembers().length>0){return YES}return NO},initObservable:function(){if(this._observableInited){return}this._observableInited=YES;var g,n,l,k,i,f,m,h,c,o,b,j,d,a;if(n=this._observers){h=n.length;for(g=0;g<h;g++){l=n[g];i=this[l];f=i.propertyPaths;m=(f)?f.length:0;for(c=0;c<m;c++){o=f[c];this.addObservesHandler(i,o)}}}this.bindings=[];if(n=this._bindings){for(g=0,a=n.length;g<a;g++){l=n[g];k=this[l];d=l.slice(0,-7);this[l]=this.bind(d,k)}}if(n=this._properties){for(g=0,a=n.length;g<a;g++){l=n[g];if(k=this[l]){if(k.isCacheable){this._kvo_cacheable=YES}if(k.dependentKeys&&(k.dependentKeys.length>0)){this.registerDependentKey(l,k.dependentKeys)}}}}delete this._observers;delete this._bindings;delete this._properties},addObservesHandler:function(a,b){this._configureObservesHandler(SC.OBSERVES_HANDLER_ADD,a,b);return this},removeObservesHandler:function(a,b){this._configureObservesHandler(SC.OBSERVES_HANDLER_REMOVE,a,b);return this},_configureObservesHandler:function(d,b,f){var c,a;switch(d){case SC.OBSERVES_HANDLER_ADD:d="addObserver";break;case SC.OBSERVES_HANDLER_REMOVE:d="removeObserver";break;default:throw"invalid action provided: "+d}c=f.indexOf(".");if(c<0){this[d](f,this,b)}else{if(f.indexOf("*")===0){this[d](f.slice(1),this,b)}else{a=null;if(c===0){a=this;f=f.slice(1)}else{if(c===4&&f.slice(0,5)==="this."){a=this;f=f.slice(5)}else{if(c<0&&f.length===4&&f==="this"){a=this;f=""}else{if(c>0&&f[0]===f.charAt(0).toLowerCase()){a=this}}}}SC.Observers[d](f,this,b,a)}}},observersForKey:function(a){SC.Observers.flush(this);var b=this[SC.keyFor("_kvo_observers",a)];return b?b.getMembers():[]},_notifyPropertyObservers:function(u){if(!this._observableInited){this.initObservable()}SC.Observers.flush(this);var h=SC.LOG_OBSERVERS&&!(this.LOG_OBSERVING===NO),p,s,n,d,o,m,r,q,k,a,g,t,c,j,f,b,i,l;if(h){i=SC.KVO_SPACES=(SC.KVO_SPACES||"")+"  ";SC.Logger.log('%@%@: notifying observers after change to key "%@"'.fmt(i,this,u))}d=this["_kvo_observers_*"];this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;while(((s=this._kvo_changes)&&(s.length>0))||u){r=++this.propertyRevision;if(!s){s=SC.CoreSet.create()}this._kvo_changes=null;if(u==="*"){s.add("*");s.addEach(this._kvo_for("_kvo_observed_keys",SC.CoreSet))}else{if(u){s.add(u)}}if(n=this._kvo_dependents){for(o=0;o<s.length;o++){u=s[o];m=n[u];if(m&&(j=m.length)){if(h){SC.Logger.log("%@...including dependent keys for %@: %@".fmt(i,u,m))}l=this._kvo_cache;if(!l){l=this._kvo_cache={}}while(--j>=0){s.add(u=m[j]);if(f=this[u]){this[f.cacheKey]=undefined;l[f.cacheKey]=l[f.lastSetValueKey]=undefined}}}}}while(s.length>0){u=s.pop();p=this[SC.keyFor("_kvo_observers",u)];if(p){q=SC.clone(p.getMembers());k=q.length;for(g=0;g<k;g++){a=q[g];if(a[3]===r){continue}if(!a[1]){SC.Logger.log(a)}t=a[0]||this;c=a[1];b=a[2];a[3]=r;if(h){SC.Logger.log('%@...firing observer on %@ for key "%@"'.fmt(i,t,u))}if(b!==undefined){c.call(t,this,u,null,b,r)}else{c.call(t,this,u,null,r)}}}q=this[SC.keyFor("_kvo_local",u)];if(q){k=q.length;for(g=0;g<k;g++){a=q[g];c=this[a];if(c){if(h){SC.Logger.log('%@...firing local observer %@.%@ for key "%@"'.fmt(i,this,a,u))}c.call(this,this,u,null,r)}}}if(d&&u!=="*"){q=SC.clone(d.getMembers());k=q.length;for(g=0;g<k;g++){a=q[g];t=a[0]||this;c=a[1];b=a[2];if(h){SC.Logger.log('%@...firing * observer on %@ for key "%@"'.fmt(i,t,u))}if(b!==undefined){c.call(t,this,u,null,b,r)}else{c.call(t,this,u,null,r)}}}if(this.propertyObserver){if(h){SC.Logger.log('%@...firing %@.propertyObserver for key "%@"'.fmt(i,this,u))}this.propertyObserver(this,u,null,r)}}if(s){s.destroy()}u=null}this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;if(h){SC.KVO_SPACES=i.slice(0,-2)}return YES},bind:function(a,c,f){var d,b;if(f!==undefined){c=[c,f]}b=typeof c;if(b==="string"||(b==="object"&&(c instanceof Array))){d=this[a+"BindingDefault"]||SC.Binding;d=d.beget().from(c)}else{d=c.beget()}d=d.to(a,this).connect();this.bindings.push(d);return d},didChangeFor:function(a){var b,g,f,k,d,c,i,j,h;a=SC.hashFor(a);b=this._kvo_didChange_valueCache;if(!b){b=this._kvo_didChange_valueCache={}}g=this._kvo_didChange_revisionCache;if(!g){g=this._kvo_didChange_revisionCache={}}f=b[a]||{};k=g[a]||{};d=false;c=this._kvo_revision||0;i=arguments.length;while(--i>=1){j=arguments[i];if(k[j]!=c){h=this.get(j);if(f[j]!==h){d=true;f[j]=h}}k[j]=c}b[a]=f;g[a]=k;return d},setIfChanged:function(a,b){if(b===undefined&&SC.typeOf(a)===SC.T_HASH){var c=a;for(a in c){if(!c.hasOwnProperty(a)){continue}this.setIfChanged(a,c[a])}return this}return(this.get(a)!==b)?this.set(a,b):this},getPath:function(b){var a=SC.tupleForPropertyPath(b,this);if(a===null||a[0]===null){return undefined}return SC.get(a[0],a[1])},setPath:function(c,b){if(c.indexOf(".")>=0){var a=SC.tupleForPropertyPath(c,this);if(!a||!a[0]){return null}a[0].set(a[1],b)}else{this.set(c,b)}return this},setPathIfChanged:function(c,b){if(c.indexOf(".")>=0){var a=SC.tupleForPropertyPath(c,this);if(!a||!a[0]){return null}if(a[0].get(a[1])!==b){a[0].set(a[1],b)}}else{this.setIfChanged(c,b)}return this},getEach:function(){var d=SC.A(arguments),c=[],a,b;for(a=0,b=d.length;a<b;a++){c[c.length]=this.getPath(d[a])}return c},incrementProperty:function(b,a){if(!a){a=1}this.set(b,(this.get(b)||0)+a);return this.get(b)},decrementProperty:function(b,a){if(!a){a=1}this.set(b,(this.get(b)||0)-a);return this.get(b)},toggleProperty:function(a,b,c){if(b===undefined){b=true}if(c===undefined){c=false}b=(this.get(a)==b)?c:b;this.set(a,b);return this.get(a)},notifyPropertyChange:function(a,b){this.propertyWillChange(a);this.propertyDidChange(a,b);return this},allPropertiesDidChange:function(){this._kvo_cache=null;this._notifyPropertyObservers("*");return this},addProbe:function(a){this.addObserver(a,SC.logChange)},removeProbe:function(a){this.removeObserver(a,SC.logChange)},logProperty:function(){var b=SC.$A(arguments),d,c,a;for(a=0,c=b.length;a<c;a++){d=b[a];SC.Logger.log("%@:%@: ".fmt(SC.guidFor(this),d),this.get(d))}},propertyRevision:1};SC.logChange=function logChange(c,a,b){SC.Logger.log("CHANGE: %@[%@] => %@".fmt(c,a,c.get(a)))};SC.mixin(SC,{get:function(a,b){if(!a){return undefined}if(b===undefined){return this[a]}if(a.get){return a.get(b)}return a[b]},getPath:function(a,b){if(b===undefined){b=a;a=window}return SC.objectForPropertyPath(b,a)}});SC.mixin(Array.prototype,SC.Observable);SC.Enumerator=function(a){this.enumerable=a;this.reset();return this};SC.Enumerator.prototype={nextObject:function(){var c=this._index;var a=this._length;if(c>=a){return undefined}var b=this.enumerable.nextObject(c,this._previousObject,this._context);this._previousObject=b;this._index=c+1;if(c>=a){this._context=SC.Enumerator._pushContext(this._context)}return b},reset:function(){var b=this.enumerable;if(!b){throw SC.$error("Enumerator has been destroyed")}this._length=b.get?b.get("length"):b.length;var a=this._length;this._index=0;this._previousObject=null;this._context=(a>0)?SC.Enumerator._popContext():null},destroy:function(){this.enumerable=this._length=this._index=this._previousObject=this._context=null}};SC.Enumerator.create=function(a){return new SC.Enumerator(a)};SC.Enumerator._popContext=function(){var a=this._contextCache?this._contextCache.pop():null;return a||{}};SC.Enumerator._pushContext=function(b){this._contextCache=this._contextCache||[];var a=this._contextCache;a.push(b);return null};sc_require("core");sc_require("ext/function");sc_require("system/enumerator");SC.Enumerable={isEnumerable:YES,nextObject:function(a,c,b){return this.objectAt?this.objectAt(a):this[a]},firstObject:function(){if(this.get("length")===0){return undefined}if(this.objectAt){return this.objectAt(0)}var b=SC.Enumerator._popContext(),a;a=this.nextObject(0,null,b);b=SC.Enumerator._pushContext(b);return a}.property().cacheable(),lastObject:function(){var a=this.get("length");if(a===0){return undefined}if(this.objectAt){return this.objectAt(a-1)}}.property().cacheable(),enumerator:function(){return SC.Enumerator.create(this)},forEach:function(h,g){if(typeof h!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(g===undefined){g=null}var f=null;var c=SC.Enumerator._popContext();for(var a=0;a<b;a++){var d=this.nextObject(a,f,c);h.call(g,d,a,this);f=d}f=null;c=SC.Enumerator._pushContext(c);return this},getEach:function(a){return this.map(function(b){return b?(b.get?b.get(a):b[a]):null},this)},setEach:function(a,b){this.forEach(function(c){if(c){if(c.set){c.set(a,b)}else{c[a]=b}}},this);return this},map:function(i,h){if(typeof i!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(h===undefined){h=null}var c=[];var g=null;var d=SC.Enumerator._popContext();for(var a=0;a<b;a++){var f=this.nextObject(a,g,d);c[a]=i.call(h,f,a,this);g=f}g=null;d=SC.Enumerator._pushContext(d);return c},mapProperty:function(a){return this.map(function(b){return b?(b.get?b.get(a):b[a]):null})},filter:function(i,h){if(typeof i!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(h===undefined){h=null}var c=[];var g=null;var d=SC.Enumerator._popContext();for(var a=0;a<b;a++){var f=this.nextObject(a,g,d);if(i.call(h,f,a,this)){c.push(f)}g=f}g=null;d=SC.Enumerator._pushContext(d);return c},sortProperty:function(b){var c=(typeof b===SC.T_STRING)?arguments:b,a=c.length,d;if(this instanceof Array){d=this}else{d=[];this.forEach(function(f){d.push(f)})}if(!d){return[]}return d.sort(function(h,g){var f,j,l,k,i=0;for(f=0;i===0&&f<a;f++){j=c[f];l=h?(h.get?h.get(j):h[j]):null;k=g?(g.get?g.get(j):g[j]):null;i=SC.compare(l,k)}return i})},filterProperty:function(k,g){var d=this.get?this.get("length"):this.length;var f=[];var j=null;var b=SC.Enumerator._popContext();for(var h=0;h<d;h++){var c=this.nextObject(h,j,b);var i=c?(c.get?c.get(k):c[k]):null;var a=(g===undefined)?!!i:SC.isEqual(i,g);if(a){f.push(c)}j=c}j=null;b=SC.Enumerator._pushContext(b);return f},find:function(i,d){var c=this.get?this.get("length"):this.length;if(d===undefined){d=null}var h=null,b,j=NO,f=null;var a=SC.Enumerator._popContext();for(var g=0;g<c&&!j;g++){b=this.nextObject(g,h,a);if(j=i.call(d,b,g,this)){f=b}h=b}b=h=null;a=SC.Enumerator._pushContext(a);return f},findProperty:function(j,g){var c=this.get?this.get("length"):this.length;var k=NO,d=null,i=null,b,h;var a=SC.Enumerator._popContext();for(var f=0;f<c&&!k;f++){b=this.nextObject(f,i,a);h=b?(b.get?b.get(j):b[j]):null;k=(g===undefined)?!!h:SC.isEqual(h,g);if(k){d=b}i=b}i=b=null;a=SC.Enumerator._pushContext(a);return d},every:function(i,h){if(typeof i!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(h===undefined){h=null}var c=YES;var g=null;var d=SC.Enumerator._popContext();for(var a=0;c&&(a<b);a++){var f=this.nextObject(a,g,d);if(!i.call(h,f,a,this)){c=NO}g=f}g=null;d=SC.Enumerator._pushContext(d);return c},everyProperty:function(j,f){var c=this.get?this.get("length"):this.length;var d=YES;var i=null;var a=SC.Enumerator._popContext();for(var g=0;d&&(g<c);g++){var b=this.nextObject(g,i,a);var h=b?(b.get?b.get(j):b[j]):null;d=(f===undefined)?!!h:SC.isEqual(h,f);i=b}i=null;a=SC.Enumerator._pushContext(a);return d},some:function(i,h){if(typeof i!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(h===undefined){h=null}var c=NO;var g=null;var d=SC.Enumerator._popContext();for(var a=0;(!c)&&(a<b);a++){var f=this.nextObject(a,g,d);if(i.call(h,f,a,this)){c=YES}g=f}g=null;d=SC.Enumerator._pushContext(d);return c},someProperty:function(j,f){var c=this.get?this.get("length"):this.length;var d=NO;var i=null;var a=SC.Enumerator._popContext();for(var g=0;!d&&(g<c);g++){var b=this.nextObject(g,i,a);var h=b?(b.get?b.get(j):b[j]):null;d=(f===undefined)?!!h:SC.isEqual(h,f);i=b}i=null;a=SC.Enumerator._pushContext(a);return d},reduce:function(h,i,j){if(typeof h!=="function"){throw new TypeError()}var c=this.get?this.get("length"):this.length;if(c===0&&i===undefined){throw new TypeError()}var d=i;var g=null;var a=SC.Enumerator._popContext();for(var f=0;f<c;f++){var b=this.nextObject(f,g,a);if(b!==null){if(d===undefined){d=b}else{d=h.call(null,d,b,f,this,j)}}g=b}g=null;a=SC.Enumerator._pushContext(a);if(d===undefined){throw new TypeError()}return d},invoke:function(i){var f=this.get?this.get("length"):this.length;if(f<=0){return[]}var j;var h=[];var c=arguments.length;if(c>1){for(j=1;j<c;j++){h.push(arguments[j])}}var g=[];var k=null;var b=SC.Enumerator._popContext();for(j=0;j<f;j++){var d=this.nextObject(j,k,b);var a=d?d[i]:null;if(a){g[j]=a.apply(d,h)}k=d}k=null;b=SC.Enumerator._pushContext(b);return g},invokeWhile:function(d,j){var g=this.get?this.get("length"):this.length;if(g<=0){return null}var k;var i=[];var c=arguments.length;if(c>2){for(k=2;k<c;k++){i.push(arguments[k])}}var h=d;var l=null;var b=SC.Enumerator._popContext();for(k=0;(h===d)&&(k<g);k++){var f=this.nextObject(k,l,b);var a=f?f[j]:null;if(a){h=a.apply(f,i)}l=f}l=null;b=SC.Enumerator._pushContext(b);return h},toArray:function(){var a=[];this.forEach(function(b){a.push(b)},this);return a},groupBy:function(j){var c=this.get?this.get("length"):this.length,d=[],i=null,a=SC.Enumerator._popContext(),f=[],k=[],g,b,h;for(g=0;g<c;g++){b=this.nextObject(g,i,a);h=b?(b.get?b.get(j):b[j]):null;if(SC.none(f[h])){f[h]=[];k.push(h)}f[h].push(b);i=b}i=null;a=SC.Enumerator._pushContext(a);for(g=0,c=k.length;g<c;g++){d.push(f[k[g]])}return d}};SC._buildReducerFor=function(a,b){return function(d,f){var g=this[a];if(SC.typeOf(g)!==SC.T_FUNCTION){return this.unknownProperty?this.unknownProperty(d,f):null}else{var c=SC.Enumerable.reduce.call(this,g,null,b);return c}}.property("[]")};SC.Reducers={"[]":function(a,b){return this}.property(),enumerableContentDidChange:function(c,a,b){if(!SC.none(c)){if(c===0){this.notifyPropertyChange("firstObject")}if(!SC.none(a)&&c+a===this.get("length")-1){this.notifyPropertyChange("lastObject")}}this.notifyPropertyChange("[]")},reducedProperty:function(j,h,g){if(!j||typeof j!==SC.T_STRING||j.charAt(0)!=="@"){return undefined}var d=j.match(/^@([^(]*)(\(([^)]*)\))?$/);if(!d||d.length<2){return undefined}var i=d[1];var k=d[3];i="reduce"+i.slice(0,1).toUpperCase()+i.slice(1);var a=this[i];if(SC.typeOf(a)!==SC.T_FUNCTION){return undefined}if(g===NO){return SC.Enumerable.reduce.call(this,a,null,k)}var c=SC._buildReducerFor(i,k);var b=this.constructor.prototype;if(b){b[j]=c;var f=b._properties||[];f.push(j);b._properties=f;this.registerDependentKey(j,"[]")}return SC.Enumerable.reduce.call(this,a,null,k)},reduceMax:function(a,d,b,f,c){if(c&&d){d=d.get?d.get(c):d[c]}if(a===null){return d}return(d>a)?d:a},reduceMaxObject:function(b,f,c,g,d){var a=b,h=f;if(d){if(f){h=f.get?f.get(d):f[d]}if(b){a=b.get?b.get(d):b[d]}}if(a===null){return f}return(h>a)?f:b},reduceMin:function(a,d,b,f,c){if(c&&d){d=d.get?d.get(c):d[c]}if(a===null){return d}return(d<a)?d:a},reduceMinObject:function(b,f,c,g,d){var a=b,h=f;if(d){if(f){h=f.get?f.get(d):f[d]}if(b){a=b.get?b.get(d):b[d]}}if(a===null){return f}return(h<a)?f:b},reduceAverage:function(b,g,d,h,f){if(f&&g){g=g.get?g.get(f):g[f]}var c=(b||0)+g;var a=h.get?h.get("length"):h.length;if(d>=a-1){c=c/a}return c},reduceSum:function(a,d,b,f,c){if(c&&d){d=d.get?d.get(c):d[c]}return(a===null)?d:a+d}};SC.mixin(SC.Enumerable,SC.Reducers);SC.mixin(Array.prototype,SC.Reducers);Array.prototype.isEnumerable=YES;(function(){var a={nextObject:SC.Enumerable.nextObject,enumerator:SC.Enumerable.enumerator,firstObject:SC.Enumerable.firstObject,lastObject:SC.Enumerable.lastObject,sortProperty:SC.Enumerable.sortProperty,mapProperty:function(h){var f=this.length;var g=[];for(var d=0;d<f;d++){var i=this[d];g[d]=i?(i.get?i.get(h):i[h]):null}return g},filterProperty:function(i,k){var g=this.length;var h=[];for(var f=0;f<g;f++){var j=this[f];var l=j?(j.get?j.get(i):j[i]):null;var d=(k===undefined)?!!l:SC.isEqual(l,k);if(d){h.push(j)}}return h},groupBy:function(i){var f=this.length,h=[],k=[],g=[],d,j,l;for(d=0;d<f;d++){j=this[d];l=j?(j.get?j.get(i):j[i]):null;if(SC.none(k[l])){k[l]=[];g.push(l)}k[l].push(j)}for(d=0,f=g.length;d<f;d++){h.push(k[g[d]])}return h},find:function(k,j){if(typeof k!=="function"){throw new TypeError()}var f=this.length;if(j===undefined){j=null}var h,g=null,i=NO;for(var d=0;d<f&&!i;d++){h=this[d];if(i=k.call(j,h,d,this)){g=h}}h=null;return g},findProperty:function(h,k){var f=this.length;var i,l,j=NO,g=null;for(var d=0;d<f&&!j;d++){l=(i=this[d])?(i.get?i.get(h):i[h]):null;j=(k===undefined)?!!l:SC.isEqual(l,k);if(j){g=i}}i=null;return g},everyProperty:function(h,j){var f=this.length;var g=YES;for(var d=0;g&&(d<f);d++){var i=this[d];var k=i?(i.get?i.get(h):i[h]):null;g=(j===undefined)?!!k:SC.isEqual(k,j)}return g},someProperty:function(h,j){var f=this.length;var g=NO;for(var d=0;!g&&(d<f);d++){var i=this[d];var k=i?(i.get?i.get(h):i[h]):null;g=(j===undefined)?!!k:SC.isEqual(k,j)}return g},invoke:function(g){var f=this.length;if(f<=0){return[]}var d;var i=[];var k=arguments.length;if(k>1){for(d=1;d<k;d++){i.push(arguments[d])}}var h=[];for(d=0;d<f;d++){var j=this[d];var l=j?j[g]:null;if(l){h[d]=l.apply(j,i)}}return h},invokeWhile:function(g,l){var i=this.length;if(i<=0){return null}var m;var k=[];var f=arguments.length;if(f>2){for(m=2;m<f;m++){k.push(arguments[m])}}var j=g;for(m=0;(j===g)&&(m<i);m++){var h=this[m];var d=h?h[l]:null;if(d){j=d.apply(h,k)}}return j},toArray:function(){var f=this.length;if(f<=0){return[]}var g=[];for(var d=0;d<f;d++){var h=this[d];g.push(h)}return g},getEach:function(h){var g=[];var f=this.length;for(var d=0;d<f;d++){var i=this[d];g[d]=i?(i.get?i.get(h):i[h]):null}return g},setEach:function(g,h){var f=this.length;for(var d=0;d<f;d++){var i=this[d];if(i){if(i.set){i.set(g,h)}else{i[g]=h}}}return this}};var c={forEach:function(j,h){if(typeof j!=="function"){throw new TypeError()}if(h===undefined){h=null}for(var f=0,d=this.length;f<d;f++){var g=this[f];j.call(h,g,f,this)}return this},map:function(k,j){if(typeof k!=="function"){throw new TypeError()}if(j===undefined){j=null}var f=[];for(var g=0,d=this.length;g<d;g++){var h=this[g];f[g]=k.call(j,h,g,this)}return f},filter:function(k,j){if(typeof k!=="function"){throw new TypeError()}if(j===undefined){j=null}var f=[];for(var g=0,d=this.length;g<d;g++){var h=this[g];if(k.call(j,h,g,this)){f.push(h)}}return f},every:function(j,i){if(typeof j!=="function"){throw new TypeError()}var f=this.length;if(i===undefined){i=null}var g=YES;for(var d=0;g&&(d<f);d++){var h=this[d];if(!j.call(i,h,d,this)){g=NO}}return g},some:function(j,i){if(typeof j!=="function"){throw new TypeError()}var f=this.length;if(i===undefined){i=null}var g=NO;for(var d=0;(!g)&&(d<f);d++){var h=this[d];if(j.call(i,h,d,this)){g=YES}}return g},reduce:function(k,g,j){if(typeof k!=="function"){throw new TypeError()}var f=this.length;if(f===0&&g===undefined){throw new TypeError()}var h=g;for(var d=0;d<f;d++){var i=this[d];if(i!==null){if(h===undefined){h=i}else{h=k.call(null,h,i,d,this,j)}}}if(h===undefined){throw new TypeError()}return h}};for(var b in c){if(!c.hasOwnProperty(b)){continue}if(!Array.prototype[b]||((typeof Prototype==="object")&&Prototype.Version.match(/^1\.6/))){Array.prototype[b]=c[b]}}SC.mixin(Array.prototype,a)})();SC.RangeObserver={isRangeObserver:YES,toString:function(){var a=this.indexes?this.indexes.toString():"SC.IndexSet<..>";return a.replace("IndexSet","RangeObserver(%@)".fmt(SC.guidFor(this)))},create:function(d,g,f,h,c,a){var b=SC.beget(this);b.source=d;b.indexes=g?g.frozenCopy():null;b.target=f;b.method=(typeof h==="string")?f[h]:h;b.context=c;b.isDeep=a||false;b.beginObserving();return b},extend:function(d){var c=SC.beget(this),b=arguments;for(var f=0,a=b.length;f<a;f++){SC.mixin(c,b[f])}return c},destroy:function(a){this.endObserving();return this},update:function(a,b){if(this.indexes&&this.indexes.isEqual(b)){return this}this.indexes=b?b.frozenCopy():null;this.endObserving().beginObserving();return this},beginObserving:function(){if(!this.isDeep){return this}var c=this.observing=this.observing||SC.CoreSet.create();var a=this._beginObservingForEach,b=this.source;if(!a){a=this._beginObservingForEach=function(d){var f=b.objectAt(d);if(f&&f.addObserver){c.push(f);f._kvo_needsRangeObserver=true}}}this.indexes.forEach(a);this.isObserving=false;SC.Observers.addPendingRangeObserver(this);return this},setupPending:function(b){var f=this.observing;if(this.isObserving||!f||(f.get("length")===0)){return true}if(f.contains(b)){this.isObserving=true;var c=this._setupPendingForEach;if(!c){var d=this.source,g=this.objectPropertyDidChange,a=this;c=this._setupPendingForEach=function(h){var k=d.objectAt(h),i=SC.guidFor(k),j;if(k&&k.addObserver){f.push(k);k.addObserver("*",a,g);j=a[i];if(j==null){a[i]=h}else{if(j.isIndexSet){j.add(h)}else{a[i]=SC.IndexSet.create(j).add(h)}}}}}this.indexes.forEach(c);return true}else{return false}},endObserving:function(){if(!this.isDeep){return this}var f=this.observing;if(this.isObserving){var b=this.objectPropertyDidChange,c=this.source,a,g,d;if(f){g=f.length;for(a=0;a<g;a++){d=f[a];d.removeObserver("*",this,b);this[SC.guidFor(d)]=null}f.length=0}this.isObserving=false}if(f){f.clear()}return this},rangeDidChange:function(b){var a=this.indexes;if(!b||!a||a.intersects(b)){this.endObserving();this.method.call(this.target,this.source,null,"[]",b,this.context);this.beginObserving()}return this},objectPropertyDidChange:function(d,g,h,a){var f=this.context,i=this.method,c=SC.guidFor(d),b=this[c];if(b&&!b.isIndexSet){b=this[c]=SC.IndexSet.create(b).freeze()}i.call(this.target,this.source,d,g,b,f||a,a)}};sc_require("ext/function");sc_require("mixins/observable");sc_require("mixins/enumerable");sc_require("system/range_observer");SC.OUT_OF_RANGE_EXCEPTION="Index out of range";SC.CoreArray={isSCArray:YES,replace:function(a,c,b){throw"replace() must be implemented to support SC.Array"},indexOf:function(d,c){var b,a=this.get("length");if(c===undefined){c=0}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b<a;b++){if(this.objectAt(b,YES)===d){return b}}return -1},lastIndexOf:function(d,c){var b,a=this.get("length");if(c===undefined){c=a-1}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b>=0;b--){if(this.objectAt(b)===d){return b}}return -1},objectAt:function(a){if(a<0){return undefined}if(a>=this.get("length")){return undefined}return this.get(a)},"[]":function(a,b){if(b!==undefined){this.replace(0,this.get("length"),b)}return this}.property(),insertAt:function(a,b){if(a>this.get("length")){throw SC.OUT_OF_RANGE_EXCEPTION}this.replace(a,0,[b]);return this},removeAt:function(d,a){var c=0,b=[];if(typeof d===SC.T_NUMBER){if((d<0)||(d>=this.get("length"))){throw SC.OUT_OF_RANGE_EXCEPTION}if(a===undefined){this.replace(d,1,b);return this}else{d=SC.IndexSet.create(d,a)}}this.beginPropertyChanges();d.forEachRange(function(g,f){g-=c;c+=f;this.replace(g,f,b)},this);this.endPropertyChanges();return this},removeObject:function(b){var c=this.get("length")||0;while(--c>=0){var a=this.objectAt(c);if(a==b){this.removeAt(c)}}return this},removeObjects:function(a){this.beginPropertyChanges();a.forEach(function(b){this.removeObject(b)},this);this.endPropertyChanges();return this},slice:function(b,d){var a=[];var c=this.get("length");if(SC.none(b)){b=0}if(SC.none(d)||(d>c)){d=c}while(b<d){a[a.length]=this.objectAt(b++)}return a},pushObject:function(a){this.insertAt(this.get("length"),a);return a},pushObjects:function(a){this.beginPropertyChanges();a.forEach(function(b){this.pushObject(b)},this);this.endPropertyChanges();return this},popObject:function(){var a=this.get("length");if(a===0){return null}var b=this.objectAt(a-1);this.removeAt(a-1);return b},shiftObject:function(){if(this.get("length")===0){return null}var a=this.objectAt(0);this.removeAt(0);return a},unshiftObject:function(a){this.insertAt(0,a);return a},unshiftObjects:function(a){this.beginPropertyChanges();a.forEach(function(b){this.unshiftObject(b)},this);this.endPropertyChanges();return this},isEqual:function(a){if(!a){return false}if(a==this){return true}var b=a.get("length");if(b!=this.get("length")){return false}while(--b>=0){if(!SC.isEqual(a.objectAt(b),this.objectAt(b))){return false}}return true},compact:function(){return this.without(null)},without:function(b){if(this.indexOf(b)<0){return this}var a=[];this.forEach(function(c){if(c!==b){a[a.length]=c}});return a},uniq:function(){var a=[];this.forEach(function(b){if(a.indexOf(b)<0){a[a.length]=b}});return a},flatten:function(){var a=[];this.forEach(function(b){if(b&&b.isEnumerable){a=a.pushObjects(b.flatten())}else{a.pushObject(b)}});return a},max:function(){return Math.max.apply(Math,this)},min:function(){return Math.min.apply(Math,this)},rangeObserverClass:SC.RangeObserver,contains:function(a){return this.indexOf(a)>=0},addRangeObserver:function(d,g,i,f){var a=this._array_rangeObservers;if(!a){a=this._array_rangeObservers=SC.CoreSet.create()}if(this._array_oldLength===undefined){this._array_oldLength=this.get("length")}var h=this.rangeObserverClass;var b=NO;var c=h.create(this,d,g,i,f,b);a.add(c);if(!this._array_isNotifyingRangeObservers){this._array_isNotifyingRangeObservers=YES;this.addObserver("[]",this,this._array_notifyRangeObservers)}return c},updateRangeObserver:function(b,a){return b.update(this,a)},removeRangeObserver:function(c){var b=c.destroy(this);var a=this._array_rangeObservers;if(a){a.remove(c)}return b},addArrayObservers:function(a){this._modifyObserverSet("add",a)},removeArrayObservers:function(a){this._modifyObserverSet("remove",a)},_modifyObserverSet:function(i,c){var f,b;var h=c.target||this;var a=c.willChange||"arrayWillChange";var g=c.didChange||"arrayDidChange";var d=c.context;if(typeof a==="string"){a=h[a]}if(typeof g==="string"){g=h[g]}f=this._kvo_for("_kvo_array_will_change",SC.ObserverSet);b=this._kvo_for("_kvo_array_did_change",SC.ObserverSet);f[i](h,a,d);b[i](h,g,d)},arrayContentWillChange:function(b,j,a){this._teardownContentObservers(b,j);var g,d,i,k;var h,c;var f=this._kvo_array_will_change;if(f){d=f.members;i=d.length;for(k=0;k<i;k++){g=d[k];h=g[0];c=g[1];c.call(h,b,j,a,this)}}},arrayContentDidChange:function(b,o,a){var d=this._array_rangeObservers,i,c,m;this.beginPropertyChanges();this.notifyPropertyChange("length");if(d&&d.length>0){m=this._array_rangeChanges;if(!m){m=this._array_rangeChanges=SC.IndexSet.create()}if(o===a){c=o}else{c=this.get("length")-b;if(o>a){c+=(o-a)}}m.add(b,c)}this._setupContentObservers(b,a);var h,g,l,n;var j,f;var k=this._kvo_array_did_change;if(k){if(b===undefined){b=0;o=this.get("length");a=0}g=k.members;l=g.length;for(n=0;n<l;n++){h=g[n];j=h[0];f=h[1];f.call(j,b,o,a,this)}}this.notifyPropertyChange("[]");this.endPropertyChanges();return this},_setupContentObservers:function(g,f){var c=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet);var d;var b;if(c.get("length")>0){d=this.slice(g,g+f);var a=this;c.forEach(function(h){b=SC.keyFor("_kvo_content_observers",h);a._kvo_for(b).forEach(function(i){d.forEach(function(j){a._resumeChainObservingForItemWithChainObserver(j,i)})})})}},_teardownContentObservers:function(f,a){var c=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet);var d;var b;if(c.get("length")>0){d=this.slice(f,f+a);c.forEach(function(g){b=SC.keyFor("_kvo_content_observers",g);d.forEach(function(h){h._kvo_for(b).forEach(function(i){i.destroyChain()})})})}},teardownEnumerablePropertyChains:function(b){var a=this._kvo_enumerable_property_chains;if(a){a.forEach(function(h){var d,c=b.get("length"),j=SC.guidFor(h),g,i,f="_kvo_enumerable_property_clones";h.notifyPropertyDidChange();for(d=0;d<c;d++){i=b.objectAt(d);g=i[f][j];g.deactivate();delete i[f][j]}},this)}return this},setupEnumerablePropertyChains:function(b){var a=this._kvo_enumerable_property_chains;if(a){a.forEach(function(f){var d,c=b.get("length");f.notifyPropertyDidChange();c=b.get("length");for(d=0;d<c;d++){this._clonePropertyChainToItem(f,b.objectAt(d))}},this)}return this},registerDependentKeyWithChain:function(f,c){var b="_kvo_enumerable_property_chains",g,d,h,a;g=this._kvo_for(b,SC.CoreSet);g.add(c);this.forEach(function(i){this._clonePropertyChainToItem(c,i)},this)},_clonePropertyChainToItem:function(c,d){var f=SC.clone(c),b="_kvo_enumerable_property_clones",a;f.object=d;a=d[b]=d[b]||{};a[SC.guidFor(c)]=f;f.activate(d)},removeDependentKeyWithChain:function(g,d){var b="_kvo_enumerable_property_chains",c="_kvo_enumerable_property_clones",h,f,i,a;this.forEach(function(j){j.removeDependentKeyWithChain(g,d);a=j[c];i=a[SC.guidFor(d)];i.deactivate(j)},this)},_resumeChainObservingForItemWithChainObserver:function(d,a){var b=SC.clone(a.next);var c=b.property;b.object=d;d.addObserver(c,b,b.propertyDidChange);if(a.root.tails){a.root.tails.pushObject(b.tail())}b.propertyDidChange();d._kvo_for(SC.keyFor("_kvo_content_observers",c)).push(b)},_addContentObserver:function(a){var b=a.next.property;this._kvo_for("_kvo_content_observed_keys",SC.CoreSet).push(b);var c=SC.keyFor("_kvo_content_observers",b);this._kvo_for(c).push(a);this._setupContentObservers(0,a.object.get("length"))},_removeContentObserver:function(a){var f,c;var d=this._kvo_content_observed_keys;var b=a.next.property;if(d.contains(b)){c=SC.keyFor("_kvo_content_observers",b);f=this._kvo_for(c);f.removeObject(a);this._teardownContentObservers(0,a.object.get("length"));if(f.length===0){this._kvo_for("_kvo_content_observed_keys").remove(b)}}},_array_notifyRangeObservers:function(){var c=this._array_rangeObservers,d=this._array_rangeChanges,b=c?c.length:0,a,f;if(b>0&&d&&d.length>0){for(a=0;a<b;a++){c[a].rangeDidChange(d)}d.clear()}}};SC.Array=SC.mixin({},SC.Enumerable,SC.CoreArray);sc_require("mixins/array");SC.supplement(Array.prototype,SC.CoreArray);SC.mixin(Array.prototype,{replace:function(b,f,d){if(this.isFrozen){throw SC.FROZEN_ERROR}var c;var a=d?(d.get?d.get("length"):d.length):0;this.arrayContentWillChange(b,f,a);if(a===0){this.splice(b,f)}else{c=[b,f].concat(d);this.splice.apply(this,c)}this.beginPropertyChanges();this.arrayContentDidChange(b,f,a);this.enumerableContentDidChange(b,f,a-f);this.endPropertyChanges();return this},unknownProperty:function(b,c){var a=this.reducedProperty(b,c);if((c!==undefined)&&a===undefined){a=this[b]=c}return a}});if(Array.prototype.indexOf===SC.CoreArray.indexOf){Array.prototype.indexOf=function(d,c){var b,a=this.length;if(c===undefined){c=0}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b<a;b++){if(this[b]===d){return b}}return -1}}if(Array.prototype.lastIndexOf===SC.CoreArray.lastIndexOf){Array.prototype.lastIndexOf=function(d,c){var b,a=this.length;if(c===undefined){c=a-1}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b>=0;b--){if(this[b]===d){return b}}return -1}}if(!Date.now){Date.now=function(){return new Date().getTime()}}SC.String={_scs_valueForKey:function(f,h,c){var a,g,d,b=f.indexOf(":");if(b>-1){a=f.substr(b+1);f=f.substr(0,b)}g=h[f];d=h[f+"Formatter"];if(d){g=d(g,a)}else{if(a){throw"String.fmt was given a formatting string, but key `"+f+"` has no formatter! String: "+c}}return g},fmt:function(b,a){var c=0,d=undefined,f;if(a){d=a[0]}return b.replace(/%\{(.*?)\}/g,function(g,h){f=YES;if(!d){throw"Cannot use named parameters with `fmt` without a data hash. String: '"+b+"'"}return SC.String._scs_valueForKey(h,d,b)}).replace(/%@([0-9]+)?/g,function(h,g){if(f){throw"Invalid attempt to use both named parameters and indexed parameters. String: '"+b+"'"}g=g?parseInt(g,10)-1:c++;if(a[g]!==undefined){return a[g]}else{return""}})},w:function(g){var d=[],f=g.split(" "),b=f.length,c,a=0;for(a=0;a<b;++a){c=f[a];if(c.length!==0){d.push(c)}}return d}};sc_require("system/string");SC.mixin(String.prototype,{fmt:function(){return SC.String.fmt(this,arguments)},w:function(){return SC.String.w(this)}});SC.Comparable={isComparable:YES,compare:function(d,c){throw"%@.compare() is not implemented".fmt(this.toString())}};SC.Copyable={isCopyable:YES,copy:function(a){var b=SC._object_className(this.constructor);throw"%@.copy() is not implemented".fmt(b)},frozenCopy:function(){var a=this.get?this.get("isFrozen"):this.isFrozen;if(a===YES){return this}else{if(a===undefined){throw"%@ does not support freezing".fmt(this)}else{return this.copy().freeze()}}}};SC.mixin(Array.prototype,SC.Copyable);Array.prototype.copy=function(b){var c=this.slice(),a;if(b){a=c.length;while(a--){c[a]=SC.copy(c[a],true)}}return c};SC.FROZEN_ERROR=new Error("Cannot modify a frozen object");SC.Freezable={isFreezable:YES,isFrozen:NO,freeze:function(){if(this.set){this.set("isFrozen",YES)}else{this.isFrozen=YES}return this}};SC.mixin(Array.prototype,SC.Freezable);sc_require("mixins/enumerable");sc_require("mixins/observable");sc_require("mixins/freezable");sc_require("mixins/copyable");SC.Set=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,{create:function(c){var d,b,f=SC.Set._pool,g=this.isObservable,a;if(!g&&c===undefined&&f.length>0){return f.pop()}else{d=SC.beget(this);if(g){d.initObservable()}if(c&&c.isEnumerable&&c.get("length")>0){d.isObservable=NO;if(c.isSCArray){a=c.get("length");for(b=0;b<a;b++){d.add(c.objectAt(b))}}else{if(c.isSet){a=c.length;for(b=0;b<a;b++){d.add(c[b])}}else{c.forEach(function(h){d.add(h)},this)}}d.isObservable=g}}return d},isSet:YES,length:0,firstObject:function(){return(this.length>0)?this[0]:undefined}.property(),clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}this.length=0;return this},contains:function(b){if(b===null){return NO}var a=this[SC.hashFor(b)];return(!SC.none(a)&&(a<this.length)&&(this[a]===b))},isEqual:function(a){if(!a||!a.isSet||(a.get("length")!==this.get("length"))){return NO}var b=this.get("length");while(--b>=0){if(!a.contains(this[b])){return NO}}return YES},addSetObserver:function(a){if(!this.setObservers){this.setObservers=SC.CoreSet.create()}this.setObservers.add(a)},removeSetObserver:function(a){if(!this.setObservers){return}this.setObservers.remove(a)},add:function(f){if(this.isFrozen){throw SC.FROZEN_ERROR}if(SC.none(f)){return this}var c,d=((c=f.hash)&&(typeof c==="function"))?c.call(f):SC.guidFor(f),b=this[d],a=this.length;if((b>=a)||(this[b]!==f)){this[a]=f;this[d]=a;this.length=a+1;if(this.setObservers){this.didAddItem(f)}}if(this.isObservable){this.enumerableContentDidChange()}return this},addEach:function(c){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!c||!c.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)}var a,b=this.isObservable;if(b){this.beginPropertyChanges()}if(c.isSCArray){a=c.get("length");while(--a>=0){this.add(c.objectAt(a))}}else{if(c.isSet){a=c.length;while(--a>=0){this.add(c[a])}}else{c.forEach(function(d){this.add(d)},this)}}if(b){this.endPropertyChanges()}return this},remove:function(g){if(this.isFrozen){throw SC.FROZEN_ERROR}if(g===null||g===undefined){return this}var c,d=(g&&(c=g.hash)&&(typeof c===SC.T_FUNCTION))?c.call(g):SC.guidFor(g),b=this[d],a=this.length,f;if((b===null||b===undefined)||(b>=a)||(this[b]!==g)){return this}delete this[d];if(b<(a-1)){f=this[b]=this[a-1];d=(f&&(c=f.hash)&&(typeof c===SC.T_FUNCTION))?c.call(f):SC.guidFor(f);this[d]=b}this.length=a-1;if(this.isObservable){this.enumerableContentDidChange()}if(this.setObservers){this.didRemoveItem(g)}return this},pop:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}var a=(this.length>0)?this[this.length-1]:null;this.remove(a);return a},removeEach:function(c){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!c||!c.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)}var a,b=this.isObservable;if(b){this.beginPropertyChanges()}if(c.isSCArray){a=c.get("length");while(--a>=0){this.remove(c.objectAt(a))}}else{if(c.isSet){a=c.length;while(--a>=0){this.remove(c[a])}}else{c.forEach(function(d){this.remove(d)},this)}}if(b){this.endPropertyChanges()}return this},copy:function(){return this.constructor.create(this)},destroy:function(){this.isFrozen=NO;if(!this.isObservable){SC.Set._pool.push(this.clear())}return this},forEach:function(c,d){var b=this.length;if(!d){d=this}for(var a=0;a<b;a++){c.call(d,this[a],a,this)}return this},toString:function(){var b=this.length,a,c=[];for(a=0;a<b;a++){c[a]=this[a]}return"SC.Set<%@>".fmt(c.join(","))},didAddItem:function(c){var d=this.setObservers;if(!d){return}var b=d.length,a;for(a=0;a<b;a++){d[a].didAddItem(this,c)}},didRemoveItem:function(c){var d=this.setObservers;if(!d){return}var b=d.length,a;for(a=0;a<b;a++){d[a].didRemoveItem(this,c)}},_pool:[],isObservable:YES});SC.Set.constructor=SC.Set;SC.Set.clone=SC.Set.copy;SC.Set.push=SC.Set.unshift=SC.Set.add;SC.Set.shift=SC.Set.pop;SC.Set.addObject=SC.Set.add;SC.Set.removeObject=SC.Set.remove;SC.Set._pool=[];SC.CoreSet=SC.beget(SC.Set);SC.CoreSet.isObservable=NO;SC.CoreSet.constructor=SC.CoreSet;sc_require("mixins/observable");sc_require("system/set");SC.Observers={queue:[],addObserver:function(c,d,f,b){var a;if(typeof c==="string"){a=SC.tupleForPropertyPath(c,b)}else{a=c}if(a&&a[0].addObserver){a[0].addObserver(a[1],d,f)}else{this.queue.push([c,d,f,b])}},removeObserver:function(g,h,i,d){var c,b,a,f;a=SC.tupleForPropertyPath(g,d);if(a){a[0].removeObserver(a[1],h,i)}c=this.queue.length;b=this.queue,newQueue=undefined;while(--c>=0){f=b[c];if(f[0]!==g||f[1]!==h||f[2]!==i||f[3]!==d){if(!newQueue){newQueue=[]}newQueue.push(f)}}this.queue=newQueue||this.queue},addPendingRangeObserver:function(a){var b=this.rangeObservers;if(!b){b=this.rangeObservers=SC.CoreSet.create()}b.add(a);return this},_TMP_OUT:[],flush:function(b){var h=this.queue,d,a=h.length;if(h&&a>0){var l=(this.queue=[]);for(d=0;d<a;d++){var m=h[d];if(!m){continue}var j=SC.tupleForPropertyPath(m[0],m[3]);if(j&&j[0].addObserver){j[0].addObserver(j[1],m[1],m[2])}else{l.push(m)}}}if(b._kvo_needsRangeObserver){var k=this.rangeObservers,g=k?k.get("length"):0,c=this._TMP_OUT,f;for(d=0;d<g;d++){f=k[d];if(f.setupPending(b)){c.push(f)}}if(c.length>0){k.removeEach(c)}c.length=0;b._kvo_needsRangeObserver=false}},isObservingSuspended:0,_pending:SC.CoreSet.create(),objectHasPendingChanges:function(a){this._pending.add(a)},suspendPropertyObserving:function(){this.isObservingSuspended++},resumePropertyObserving:function(){var c;if(--this.isObservingSuspended<=0){c=this._pending;this._pending=SC.CoreSet.create();var b,a=c.length;for(b=0;b<a;b++){c[b]._notifyPropertyObservers()}c.clear();c=null}}};sc_require("core");sc_require("mixins/observable");sc_require("private/observer_queue");sc_require("mixins/array");sc_require("system/set");SC.BENCHMARK_OBJECTS=NO;SC._detect_base=function _detect_base(c,b,a){return function d(){var g=b[a],f;if(!g){throw new Error("No '"+a+"' method was found on the superclass")}if(c.isEnhancement){f=Array.prototype.slice.call(arguments,1)}else{f=arguments}return g.apply(this,f)}};SC._object_extend=function _object_extend(h,g,o){if(!g){throw"SC.Object.extend expects a non-null value.  Did you forget to 'sc_require' something?  Or were you passing a Protocol to extend() as if it were a mixin?"}h._kvo_cloned=null;var y,n,u,f,i=h.concatenatedProperties,l=SC.K,c,b;n=(i)?i.length:0;var a=(n>0)?{}:null;while(--n>=0){y=i[n];c=h[y];b=g[y];if(c){if(!(c instanceof Array)){c=SC.$A(c)}a[y]=(b)?c.concat(b):b}else{if(!(b instanceof Array)){b=SC.$A(b)}a[y]=b}}var x=h._bindings,m=NO,v=h._observers,w=NO,j=h._properties,d=NO,r,k,p,q;var t=h.outlets,s=NO;if(g.outlets){t=(t||SC.EMPTY_ARRAY).concat(g.outlets);s=YES}for(y in g){if(y==="_kvo_cloned"){continue}if(!g.hasOwnProperty(y)){continue}q=(a.hasOwnProperty(y)?a[y]:null)||g[y];if(y.length>7&&y.slice(-7)==="Binding"){if(!m){x=(x||SC.EMPTY_ARRAY).slice();m=YES}if(x===null){x=(h._bindings||SC.EMPTY_ARRAY).slice()}x[x.length]=y}else{if(q&&(q instanceof Function)){if(!q.superclass&&(q!==(f=h[y]))){q.superclass=f||l;q.base=o?SC._detect_base(q,o,y):f||l}if(q.propertyPaths){if(!w){v=(v||SC.EMPTY_ARRAY).slice();w=YES}v[v.length]=y}if(r=q.localPropertyPaths){k=r.length;while(--k>=0){p=h._kvo_for(SC.keyFor("_kvo_local",r[k]),SC.CoreSet);p.add(y);h._kvo_for("_kvo_observed_keys",SC.CoreSet).add(r[k])}}if(q.dependentKeys){if(!d){j=(j||SC.EMPTY_ARRAY).slice();d=YES}j[j.length]=y}if(q.autoconfiguredOutlet){if(!s){t=(t||SC.EMPTY_ARRAY).slice();s=YES}t[t.length]=y}if(q.isEnhancement){q=SC._enhance(h[y]||l,q)}}}h[y]=q}if(g.hasOwnProperty("toString")){y="toString";q=(a.hasOwnProperty(y)?a[y]:null)||g[y];if(!q.superclass&&(q!==(f=h[y]))){q.superclass=q.base=f||l}h[y]=q}h._bindings=x||[];h._observers=v||[];h._properties=j||[];h.outlets=t||[];return h};SC._enhance=function(b,a){return function(){var d=Array.prototype.slice.call(arguments,0),c=this;d.unshift(function(){return b.apply(c,arguments)});return a.apply(this,d)}};SC.Object=function(a){this.__sc_super__=SC.Object.prototype;return this._object_init(a)};SC.mixin(SC.Object,{mixin:function(b){var a=arguments.length,c;for(c=0;c<a;c++){SC.mixin(this,arguments[c])}return this},superclass:null,extend:function(f){var d=SC.BENCHMARK_OBJECTS;if(d){SC.Benchmark.start("SC.Object.extend")}var h,c=function(i){this.__sc_super__=c.prototype;return this._object_init(i)};for(h in this){if(!this.hasOwnProperty(h)){continue}c[h]=this[h]}if(this.hasOwnProperty("toString")){c.toString=this.toString}c.superclass=this;c.__sc_super__=this.prototype;SC.generateGuid(c,"sc");c.subclasses=SC.Set.create();this.subclasses.add(c);var g=(c.prototype=SC.beget(this.prototype)),b,a=arguments.length;for(b=0;b<a;b++){SC._object_extend(g,arguments[b],c.__sc_super__)}g.constructor=c;if(d){SC.Benchmark.end("SC.Object.extend")}return c},reopen:function(b){var a;a=SC._object_extend(this.prototype,b,this.__sc_super__);if(this.subclasses){this.subclasses.forEach(function(d,c){var f,g;for(f in b){if(!b.hasOwnProperty(f)){continue}g=b[f];if(d.prototype.hasOwnProperty(f)){delete b[f]}if(g&&(g instanceof Function)&&(g.isEnhancement)){delete b[f]}}d.reopen(b)},this)}return a},create:function(){var b=this,a=new b(arguments);if(SC.ObjectDesigner){SC.ObjectDesigner.didCreateObject(a,SC.$A(arguments))}return a},isClass:YES,subclasses:SC.Set.create(),toString:function(){return SC._object_className(this)},subclassOf:function(b){if(this===b){return NO}var a=this;while(a=a.superclass){if(a===b){return YES}}return NO},hasSubclass:function(a){return(a&&a.subclassOf)?a.subclassOf(this):NO},kindOf:function(a){return(this===a)||this.subclassOf(a)},design:function(){if(this.isDesign){return this}var a=this.extend.apply(this,arguments);a.isDesign=YES;if(SC.ObjectDesigner){SC.ObjectDesigner.didLoadDesign(a,this,SC.A(arguments))}return a}});SC.Object.prototype={_kvo_enabled:YES,_object_init:function(c){var b,a=(c)?c.length:0;for(b=0;b<a;b++){SC._object_extend(this,c[b],this.__sc_super__)}SC.generateGuid(this,"sc");this.init();var d=this.initMixin;a=(d)?d.length:0;for(b=0;b<a;b++){d[b].call(this)}return this},mixin:function(){var b,a=arguments.length,c;for(b=0;b<a;b++){SC._object_extend(this,arguments[b])}this._observableInited=NO;this.initObservable();for(b=0;b<a;b++){c=arguments[b].initMixin;if(c){c.call(this)}}return this},init:function(){this.initObservable();return this},isDestroyed:NO,destroy:function(){if(this.get("isDestroyed")){return this}this.set("isDestroyed",YES);var b,c=this.destroyMixin,a=(c)?c.length:0;for(b=0;b<a;b++){c[b].call(this)}this.bindings.invoke("disconnect");this.bindings=null;return this},isObject:true,respondsTo:function(a){return !!(this[a] instanceof Function)},tryToPerform:function(b,c,a){return this.respondsTo(b)&&(this[b](c,a)!==NO)},superclass:function(b){var a=arguments.callee.caller;if(!a){throw"superclass cannot determine the caller method"}return a.superclass?a.superclass.apply(this,arguments):null},instanceOf:function(a){return this.constructor===a},kindOf:function(a){return this.constructor.kindOf(a)},toString:function(){if(!this._object_toString){var a=SC._object_className(this.constructor),b=a+":"+SC.guidFor(this);if(a){this._object_toString=b}else{return b}}return this._object_toString},awake:function(){var d=this.outlets,b,a,c;for(b=0,a=d.length;b<a;++b){c=d[b];this.get(c)}this.bindings.invoke("sync")},invokeOnce:function(a){SC.RunLoop.currentRunLoop.invokeOnce(this,a);return this},invokeLast:function(a){SC.RunLoop.currentRunLoop.invokeLast(this,a);return this},invokeNext:function(a){SC.RunLoop.currentRunLoop.invokeNext(this,a);return this},concatenatedProperties:["concatenatedProperties","initMixin","destroyMixin"]};SC.Object.prototype.constructor=SC.Object;SC.mixin(SC.Object.prototype,SC.Observable);function findClassNames(){if(SC._object_foundObjectClassNames){return}SC._object_foundObjectClassNames=true;var b=[],c=false;var a=function(d,f,j){var l,i,h;j--;if(b.indexOf(f)>=0){return}b.push(f);for(var g in f){if(g=="__scope__"){continue}if(g=="superclass"){continue}if(g=="__SC__"){g="SC"}if(!g.match(/^[A-Z0-9]/)){continue}if(g=="SC"){if(c){continue}c=true}l=(d)?[d,g].join("."):g;i=f[g];try{h=SC.typeOf(i)}catch(k){break}switch(h){case SC.T_CLASS:if(!i._object_className){i._object_className=l}if(j>=0){a(l,i,j)}break;case SC.T_OBJECT:if(j>=0){a(l,i,j)}break;case SC.T_HASH:if(((d)||(l==="SC"))&&(j>=0)){a(l,i,j)}break;default:break}}};window.__SC__=SC;a(null,window,2)}SC.instanceOf=function(a,b){return !!(a&&a.constructor===b)};SC.kindOf=function(a,b){if(a&&!a.isClass){a=a.constructor}return !!(a&&a.kindOf&&a.kindOf(b))};SC._object_className=function(b){if(SC.isReady===NO){return""}if(!b._object_className){findClassNames()}if(b._object_className){return b._object_className}var a=b;while(a&&!a._object_className){a=a.superclass}return(a&&a._object_className)?a._object_className:"Anonymous"};sc_require("system/object");SC._PropertyChain=SC.Object.extend({object:null,property:null,target:null,toInvalidate:null,nextProperty:null,activate:function(b){var a=this.get("object"),c=this.get("property"),d;if(a&&a!==b){this.deactivate()}this.set("object",b);if(b&&c!=="@each"){b.registerDependentKeyWithChain(c,this)}if(this.next){d=b?b.get(c):undefined;this.next.activate(d)}return this},deactivate:function(){var a=this.get("object"),b=this.get("property");if(a){a.removeDependentKeyWithChain(b,this)}if(this.next){this.next.deactivate()}return this},notifyPropertyDidChange:function(){var d=this.get("target"),c=this.get("toInvalidate"),b,a;d.propertyDidChange(c);if(this.next){b=this.get("object");a=b.get(this.get("property"));this.next.activate(a)}}});SC._PropertyChain.createChain=function(j,h,f){var g=j.split(".");var a=g.length,d=1;var b=SC._PropertyChain.create({property:g[0],target:h,toInvalidate:f,nextProperty:g[1]});b.set("length",a);var c=b;while(--a>=1){c=c.next=SC._PropertyChain.create({property:g[d],target:h,toInvalidate:f,nextProperty:g[++d]});c.set("length",a)}return b};sc_require("ext/function");sc_require("system/object");SC.LOG_BINDINGS=NO;SC.BENCHMARK_BINDING_NOTIFICATIONS=NO;SC.BENCHMARK_BINDING_SETUP=NO;SC.MULTIPLE_PLACEHOLDER="@@MULT@@";SC.NULL_PLACEHOLDER="@@NULL@@";SC.EMPTY_PLACEHOLDER="@@EMPTY@@";SC.Binding={beget:function(b){var a=SC.beget(this);a.parentBinding=this;if(b!==undefined){a=a.from(b)}return a},builder:function(){var b=this,a=function(c){return b.beget().from(c)};a.beget=function(){return b.beget()};return a},from:function(b,a){if(!b){return this}var c=(this===SC.Binding)?this.beget():this;c._fromPropertyPath=b;c._fromRoot=a;c._fromTuple=null;return c},to:function(b,a){var c=(this===SC.Binding)?this.beget():this;c._toPropertyPath=b;c._toRoot=a;c._toTuple=null;return c},connect:function(){if(this.isConnected){return this}this.isConnected=YES;this._connectionPending=YES;this._syncOnConnect=YES;SC.Binding._connectQueue.add(this);if(!SC.RunLoop.isRunLoopInProgress()){this._scheduleSync()}return this},_connect:function(){if(!this._connectionPending){return}this._connectionPending=NO;var c,a,b=SC.BENCHMARK_BINDING_SETUP;if(b){SC.Benchmark.start("SC.Binding.connect()")}c=this._fromPropertyPath;a=this._fromRoot;if(typeof c==="string"){if(c.indexOf(".")===0){c=c.slice(1);if(!a){a=this._toRoot}}else{if(c.indexOf("*")===0){c=[this._fromRoot||this._toRoot,c.slice(1)];a=null}}}this._fromObserverData=[c,this,this.fromPropertyDidChange,a];SC.Observers.addObserver.apply(SC.Observers,this._fromObserverData);if(!this._oneWay){c=this._toPropertyPath;a=this._toRoot;this._toObserverData=[c,this,this.toPropertyDidChange,a];SC.Observers.addObserver.apply(SC.Observers,this._toObserverData)}if(b){SC.Benchmark.end("SC.Binding.connect()")}if(this._syncOnConnect){this._syncOnConnect=NO;if(b){SC.Benchmark.start("SC.Binding.connect().sync")}this.sync();if(b){SC.Benchmark.end("SC.Binding.connect().sync")}}},disconnect:function(){if(!this.isConnected){return this}if(this._connectionPending){this._connectionPending=NO}else{SC.Observers.removeObserver.apply(SC.Observers,this._fromObserverData);if(!this._oneWay){SC.Observers.removeObserver.apply(SC.Observers,this._toObserverData)}}this.isConnected=NO;return this},fromPropertyDidChange:function(c,b){var a=c?c.get(b):null;if(a!==this._bindingValue||b==="[]"){this._setBindingValue(c,b);this._changePending=YES;SC.Binding._changeQueue.add(this);this._scheduleSync()}},toPropertyDidChange:function(c,b){if(this._oneWay){return}var a=c.get(b);if(a!==this._transformedBindingValue){this._setBindingValue(c,b);this._changePending=YES;SC.Binding._changeQueue.add(this);this._scheduleSync()}},_scheduleSync:function(){if(SC.RunLoop.isRunLoopInProgress()||SC.Binding._syncScheduled){return}SC.Binding._syncScheduled=YES;setTimeout(function(){SC.run();SC.Binding._syncScheduled=NO},1)},_setBindingValue:function(b,a){this._bindingSource=b;this._bindingKey=a},_computeBindingValue:function(){var h=this._bindingSource,f=this._bindingKey,c,b;this._bindingValue=c=(h?h.getPath(f):null);var g=this._transforms;if(g){var a=g.length,d;for(b=0;b<a;b++){d=g[b];c=d(c,this)}}if(this._noError&&SC.typeOf(c)===SC.T_ERROR){c=null}this._transformedBindingValue=c},_connectQueue:SC.CoreSet.create(),_alternateConnectQueue:SC.CoreSet.create(),_changeQueue:SC.CoreSet.create(),_alternateChangeQueue:SC.CoreSet.create(),_changePending:NO,flushPendingChanges:function(){if(this._isFlushing){return NO}this._isFlushing=YES;SC.Observers.suspendPropertyObserving();var b=NO,c=SC.LOG_BINDINGS,a,d;while((a=this._connectQueue).length>0){this._connectQueue=this._alternateConnectQueue;this._alternateConnectQueue=a;while(d=a.pop()){d._connect()}}while((a=this._changeQueue).length>0){if(c){SC.Logger.log("Begin: Trigger changed bindings")}b=YES;this._changeQueue=this._alternateChangeQueue;this._alternateChangeQueue=a;while(d=a.pop()){d.applyBindingValue()}if(c){SC.Logger.log("End: Trigger changed bindings")}}this._isFlushing=NO;SC.Observers.resumePropertyObserving();return b},applyBindingValue:function(){this._changePending=NO;this._computeBindingTargets();this._computeBindingValue();var a=this._bindingValue,b=this._transformedBindingValue,c=SC.BENCHMARK_BINDING_NOTIFICATIONS,d=SC.LOG_BINDINGS;if(!this._oneWay&&this._fromTarget){if(d){SC.Logger.log("%@: %@ -> %@".fmt(this,a,b))}if(c){SC.Benchmark.start(this.toString()+"->")}this._fromTarget.setPathIfChanged(this._fromPropertyKey,a);if(c){SC.Benchmark.end(this.toString()+"->")}}if(this._toTarget){if(d){SC.Logger.log("%@: %@ <- %@".fmt(this,a,b))}if(c){SC.Benchmark.start(this.toString()+"<-")}this._toTarget.setPathIfChanged(this._toPropertyKey,b);if(c){SC.Benchmark.start(this.toString()+"<-")}}},sync:function(){if(!this.isConnected){return this}if(this._connectionPending){this._syncOnConnect=YES}else{this._computeBindingTargets();var c=this._fromTarget,b=this._fromPropertyKey;if(!c||!b){return this}if(!c.isObservable){SC.Logger.warn("Cannot bind '%@' to property '%@' on non-observable '%@'".fmt(this._toPropertyPath,b,c));return this}var a=c.getPath(b);if(a!==this._bindingValue||b==="[]"){this._setBindingValue(c,b);this._changePending=YES;SC.Binding._changeQueue.add(this)}}return this},_syncOnConnect:NO,_computeBindingTargets:function(){if(!this._fromTarget){var c,b,a;c=this._fromPropertyPath;b=this._fromRoot;if(typeof c==="string"){if(c.indexOf(".")===0){c=c.slice(1);if(!b){b=this._toRoot}}else{if(c.indexOf("*")===0){c=[b||this._toRoot,c.slice(1)];b=null}}}a=SC.tupleForPropertyPath(c,b);if(a){this._fromTarget=a[0];this._fromPropertyKey=a[1]}}if(!this._toTarget){c=this._toPropertyPath;b=this._toRoot;a=SC.tupleForPropertyPath(c,b);if(a){this._toTarget=a[0];this._toPropertyKey=a[1]}}},oneWay:function(c,a){if((a===undefined)&&(SC.typeOf(c)===SC.T_BOOL)){a=c;c=null}var b=this.from(c);if(b===SC.Binding){b=b.beget()}b._oneWay=(a===undefined)?YES:a;return b},transform:function(b){var c=(this===SC.Binding)?this.beget():this;var a=c._transforms;if(a&&(a===c.parentBinding._transform)){a=c._transforms=a.slice()}if(!a){a=c._transforms=[]}a.push(b);return c},resetTransforms:function(){var a=(this===SC.Binding)?this.beget():this;a._transforms=null;return a},noError:function(c,a){if((a===undefined)&&(SC.typeOf(c)===SC.T_BOOL)){a=c;c=null}var b=this.from(c);if(b===SC.Binding){b=b.beget()}b._noError=(a===undefined)?YES:a;return b},single:function(b,a){if(a===undefined){a=SC.MULTIPLE_PLACEHOLDER}return this.from(b).transform(function(f,d){if(f&&f.isEnumerable){var c=f.get("length");f=(c>1)?a:(c<=0)?null:f.firstObject()}return f})},notEmpty:function(b,a){if(a===undefined){a=SC.EMPTY_PLACEHOLDER}return this.from(b).transform(function(d,c){if(SC.none(d)||(d==="")||(SC.isArray(d)&&(d.get?d.get("length"):d.length)===0)){d=a}return d})},notNull:function(b,a){if(a===undefined){a=SC.EMPTY_PLACEHOLDER}return this.from(b).transform(function(d,c){if(SC.none(d)){d=a}return d})},multiple:function(a){return this.from(a).transform(function(b){if(!SC.isArray(b)){b=(b==null)?[]:[b]}return b})},bool:function(a){return this.from(a).transform(function(b){var c=SC.typeOf(b);if(c===SC.T_ERROR){return b}return(c==SC.T_ARRAY)?(b.length>0):(b==="")?NO:!!b})},and:function(b,a){var c=SC.Object.create({valueABinding:b,valueBBinding:a,and:function(){return(this.get("valueA")&&this.get("valueB"))}.property("valueA","valueB").cacheable()});return this.from("and",c).oneWay()},or:function(b,a){var c=SC.Object.create({valueABinding:b,valueBBinding:a,or:function(){return(this.get("valueA")||this.get("valueB"))}.property("valueA","valueB").cacheable()});return this.from("or",c).oneWay()},not:function(a){return this.from(a).transform(function(b){var c=SC.typeOf(b);if(c===SC.T_ERROR){return b}return !((c==SC.T_ARRAY)?(b.length>0):(b==="")?NO:!!b)})},isNull:function(a){return this.from(a).transform(function(b){var c=SC.typeOf(b);return(c===SC.T_ERROR)?b:SC.none(b)})},toString:function(){var c=this._fromRoot?"<%@>:%@".fmt(this._fromRoot,this._fromPropertyPath):this._fromPropertyPath;var b=this._toRoot?"<%@>:%@".fmt(this._toRoot,this._toPropertyPath):this._toPropertyPath;var a=this._oneWay?"[oneWay]":"";return"SC.Binding%@(%@ -> %@)%@".fmt(SC.guidFor(this),c,b,a)}};SC.binding=function(b,a){return SC.Binding.from(b,a)};sc_require("ext/function");SC.Error=SC.Object.extend({code:-1,message:"",errorValue:null,errorObject:function(){return this}.property().cacheable(),label:null,toString:function(){return"SC.Error:%@:%@ (%@)".fmt(SC.guidFor(this),this.get("message"),this.get("code"))},isError:YES});SC.Error.desc=function(d,a,f,c){var b={message:d};if(a!==undefined){b.label=a}if(c!==undefined){b.code=c}if(f!==undefined){b.errorValue=f}return this.create(b)};SC.$error=function(b,a,d,f){return SC.Error.desc(b,a,d,f)};SC.ok=function(a){return(a!==false)&&!(a&&a.isError)};SC.$ok=SC.ok;SC.val=function(a){if(a&&a.isError){return a.get?a.get("errorValue"):null}else{return a}};SC.$val=SC.val;SC.Error.HAS_MULTIPLE_VALUES=-100;sc_require("mixins/enumerable");sc_require("mixins/observable");sc_require("mixins/freezable");sc_require("mixins/copyable");SC.IndexSet=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,SC.Copyable,{_sc_sliceContent:function(f){if(f.length<1000){return f.slice()}var d=0,a=[],b=f[0];while(b!==0){a[d]=b;d=(b<0)?(0-b):b;b=f[d]}a[d]=0;this._hint(0,d,a);return a},create:function(c,b){var a=SC.beget(this);a.initObservable();a.registerDependentKey("min","[]");if(c&&c.isIndexSet){a._content=this._sc_sliceContent(c._content);a.max=c.max;a.length=c.length;a.source=c.source}else{a._content=[0];if(c!==undefined){a.add(c,b)}}return a},isIndexSet:YES,HINT_SIZE:256,length:0,max:0,min:function(){var a=this._content,b=a[0];return(b===0)?-1:(b>0)?0:Math.abs(b)}.property("[]").cacheable(),firstObject:function(){return(this.get("length")>0)?this.get("min"):undefined}.property(),rangeStartForIndex:function(c){var g=this._content,a=this.get("max"),b,f,d;if(c>=a){return a}if(Math.abs(g[c])>c){return c}d=c-(c%SC.IndexSet.HINT_SIZE);b=g[d];if(b<0||b>c){b=d}f=g[b];if(f===undefined){f=this.rangeStartForIndex(b)}else{f=Math.abs(f)}while(f<c){b=f;f=Math.abs(g[b])}return b},isEqual:function(c){if(c===this){return YES}if(!c||!c.isIndexSet||(c.max!==this.max)||(c.length!==this.length)){return NO}var f=this._content,b=c._content,d=0,a=f[d];do{if(b[d]!==a){return NO}d=Math.abs(a);a=f[d]}while(d!==0);return YES},indexBefore:function(b){if(b===0){return -1}b--;var c=this._content,a=this.get("max"),d=this.rangeStartForIndex(b);if(!c){return null}while((d===a)||(c[d]<0)){if(d===0){return -1}b=d-1;d=this.rangeStartForIndex(b)}return b},indexAfter:function(b){var d=this._content,a=this.get("max"),f,c;if(!d||(b>=a)){return -1}b++;f=this.rangeStartForIndex(b);c=d[f];while(c<0){if(c===0){return -1}b=f=Math.abs(c);c=d[f]}return b},contains:function(h,c){var b,g,a,f,d;if(c===undefined){if(h===null||h===undefined){return NO}if(typeof h===SC.T_NUMBER){c=1}else{if(h&&h.isIndexSet){if(h===this){return YES}b=h._content;g=0;a=b[g];while(a!==0){if((a>0)&&!this.contains(g,a-g)){return NO}g=Math.abs(a);a=b[g]}return YES}else{c=h.length;h=h.start}}}f=this.rangeStartForIndex(h);d=this._content[f];return(d>0)&&(f<=h)&&(d>=(h+c))},intersects:function(g,c){var b,f,a,d;if(c===undefined){if(typeof g===SC.T_NUMBER){c=1}else{if(g&&g.isIndexSet){if(g===this){return YES}b=g._content;f=0;a=b[f];while(a!==0){if((a>0)&&this.intersects(f,a-f)){return YES}f=Math.abs(a);a=b[f]}return NO}else{c=g.length;g=g.start}}}f=this.rangeStartForIndex(g);b=this._content;a=b[f];d=g+c;while(f<d){if(a===0){return NO}if((a>0)&&(a>g)){return YES}f=Math.abs(a);a=b[f]}return NO},without:function(b,a){if(b===this){return SC.IndexSet.create()}return this.clone().remove(b,a)},replace:function(c,a){if(a===undefined){if(typeof c===SC.T_NUMBER){a=1}else{if(c&&c.isIndexSet){this._content=this._sc_sliceContent(c._content);this.beginPropertyChanges().set("max",c.max).set("length",c.length).set("source",c.source).enumerableContentDidChange();this.endPropertyChanges();return this}else{a=c.length;c=c.start}}}var b=this.length;this._content.length=1;this._content[0]=0;this.length=this.max=0;return this.add(c,a)},add:function(a,b){if(this.isFrozen){throw SC.FROZEN_ERROR}var f,j,d;if(a&&a.isIndexSet){f=a._content;if(!f){return this}j=0;d=f[0];while(d!==0){if(d>0){this.add(j,d-j)}j=d<0?0-d:d;d=f[j]}return this}else{if(b===undefined){if(a===null||a===undefined){return this}else{if(typeof a===SC.T_NUMBER){b=1}else{b=a.length;a=a.start}}}else{if(b===null){b=1}}}if(b<=0){return this}var g=this.get("max"),c=g,i,h;f=this._content;if(a===g){if(a>0){j=this.rangeStartForIndex(a-1);d=f[j];if(d>0){delete f[g];f[j]=g=a+b;a=j}else{f[g]=g=a+b}}else{f[a]=g=b}f[g]=0;this.set("max",g);this.set("length",this.length+b);b=g-a}else{if(a>g){f[g]=0-a;f[a]=a+b;f[a+b]=0;this.set("max",a+b);this.set("length",this.length+b);b=a+b-g;a=g}else{j=this.rangeStartForIndex(a);d=f[j];g=a+b;i=0;if((a>0)&&(j===a)&&(d<=0)){j=this.rangeStartForIndex(a-1);d=f[j]}if(d<0){f[j]=0-a;if(Math.abs(d)>g){f[a]=0-g;f[g]=d}else{f[a]=d}}else{a=j;if(d>g){g=d}}j=a;while(j<g){h=f[j];if(h===0){f[g]=0;d=g;i+=g-j}else{d=Math.abs(h);if(d>g){f[g]=h;d=g}if(h<0){i+=d-j}}delete f[j];j=d}if((j=f[g])>0){delete f[g];g=j}f[a]=g;if(g>c){this.set("max",g)}this.set("length",this.get("length")+i);b=g-a}}this._hint(a,b);if(i!==0){this.enumerableContentDidChange()}return this},remove:function(a,b){if(this.isFrozen){throw SC.FROZEN_ERROR}if(b===undefined){if(a===null||a===undefined){return this}else{if(typeof a===SC.T_NUMBER){b=1}else{if(a.isIndexSet){a.forEachRange(this.remove,this);return this}else{b=a.length;a=a.start}}}}if(b<=0){return this}var g=this.get("max"),c=g,f=this._content,k,d,j,h,i;if(a>=g){return this}k=this.rangeStartForIndex(a);d=f[k];i=a+b;j=0;if((a>0)&&(k===a)&&(d>0)){k=this.rangeStartForIndex(a-1);d=f[k]}if(d>0){f[k]=a;if(d>i){f[a]=i;f[i]=d}else{f[a]=d}}else{a=k;d=Math.abs(d);if(d>i){i=d}}k=a;while(k<i){h=f[k];if(h===0){f[i]=0;d=i}else{d=Math.abs(h);if(d>i){f[i]=h;d=i}if(h>0){j+=d-k}}delete f[k];k=d}if((k=f[i])<0){delete f[i];i=Math.abs(k)}if(f[i]===0){delete f[i];f[a]=0;this.set("max",a)}else{f[a]=0-i}this.set("length",this.get("length")-j);b=i-a;this._hint(a,b);if(j!==0){this.enumerableContentDidChange()}return this},_hint:function(h,d,c){if(c===undefined){c=this._content}var b=SC.IndexSet.HINT_SIZE,a=Math.abs(c[h]),g=h-(h%b)+b,f=h+d;while(g<f){while((a!==0)&&(a<=g)){h=a;a=Math.abs(c[h])}if(a===0){delete c[g]}else{if(g!==h){c[g]=h}}g+=b}},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}var a=this.length;this._content.length=1;this._content[0]=0;this.set("length",0).set("max",0);if(a>0){this.enumerableContentDidChange()}},addEach:function(b){if(this.isFrozen){throw SC.FROZEN_ERROR}this.beginPropertyChanges();var a=b.get("length");if(b.isSCArray){while(--a>=0){this.add(b.objectAt(a))}}else{if(b.isEnumerable){b.forEach(function(c){this.add(c)},this)}}this.endPropertyChanges();return this},removeEach:function(b){if(this.isFrozen){throw SC.FROZEN_ERROR}this.beginPropertyChanges();var a=b.get("length");if(b.isSCArray){while(--a>=0){this.remove(b.objectAt(a))}}else{if(b.isEnumerable){b.forEach(function(c){this.remove(c)},this)}}this.endPropertyChanges();return this},clone:function(){return SC.IndexSet.create(this)},inspect:function(){var f=this._content,b=f.length,a=0,c=[],d;for(a=0;a<b;a++){d=f[a];if(d!==undefined){c.push("%@:%@".fmt(a,d))}}return"SC.IndexSet<%@>".fmt(c.join(" , "))},forEachRange:function(g,d){var b=this._content,f=0,a=b[f],c=this.source;if(d===undefined){d=null}while(a!==0){if(a>0){g.call(d,f,a-f,this,c)}f=Math.abs(a);a=b[f]}return this},forEachIn:function(b,c,k,g){var h=this._content,j=0,i=0,d=b+c,a=this.source,f=h[j];if(g===undefined){g=null}while(f!==0){if(j<b){j=b}while((j<f)&&(j<d)){k.call(g,j++,i++,this,a)}if(j>=d){j=f=0}else{j=Math.abs(f);f=h[j]}}return this},lengthIn:function(h,d){var a=0;if(d===undefined){if(h===null||h===undefined){return 0}else{if(typeof h===SC.T_NUMBER){d=1}else{if(h.isIndexSet){h.forEachRange(function(j,i){a+=this.lengthIn(j,i)},this);return a}else{d=h.length;h=h.start}}}}if(this.get("length")===0){return 0}var c=this._content,g=0,b=c[g],f=h+d;while(g<f&&b!==0){if(b>0){a+=(b>f)?f-g:b-g}g=Math.abs(b);b=c[g]}return a},source:null,indexOf:function(d,c){var g=this.source;if(!g){throw"%@.indexOf() requires source".fmt(this)}var b=g.get("length"),f=this._content,h=f[0]<0?Math.abs(f[0]):0,a;while(h>=0&&h<b){a=g.indexOf(d,h);if(a<0){return -1}if(this.contains(a)){return a}h=a+1}return -1},lastIndexOf:function(d,c){var f=this.source;if(!f){throw"%@.lastIndexOf() requires source".fmt(this)}var b=f.get("length"),g=this.max-1,a;if(g>=b){g=b-1}while(g>=0){a=f.lastIndexOf(d,g);if(a<0){return -1}if(this.contains(a)){return a}g=a+1}return -1},forEachObject:function(h,f){var d=this.source;if(!d){throw"%@.forEachObject() requires source".fmt(this)}var c=this._content,g=0,a=0,b=c[g];if(f===undefined){f=null}while(b!==0){while(g<b){h.call(f,d.objectAt(g),g,d,this);g++}g=Math.abs(b);b=c[g]}return this},addObject:function(c,d){var f=this.source;if(!f){throw"%@.addObject() requires source".fmt(this)}var b=f.get("length"),g=0,a;while(g>=0&&g<b){a=f.indexOf(c,g);if(a>=0){this.add(a);if(d){return this}g=a++}else{return this}}return this},addObjects:function(b,a){b.forEach(function(c){this.addObject(c,a)},this);return this},removeObject:function(c,d){var f=this.source;if(!f){throw"%@.removeObject() requires source".fmt(this)}var b=f.get("length"),g=0,a;while(g>=0&&g<b){a=f.indexOf(c,g);if(a>=0){this.remove(a);if(d){return this}g=a+1}else{return this}}return this},removeObjects:function(b,a){b.forEach(function(c){this.removeObject(c,a)},this);return this},LOG_OBSERVING:NO,forEach:function(h,f){var c=this._content,g=0,a=0,d=this.source,b=c[g];if(f===undefined){f=null}while(b!==0){while(g<b){h.call(f,g++,a++,this,d)}g=Math.abs(b);b=c[g]}return this},nextObject:function(g,b,c){var f=this._content,d=c.next,a=this.get("max");if(b===null){b=d=0}else{if(b>=a){delete c.next;return null}else{b++}}if(b===d){do{b=Math.abs(d);d=f[b]}while(d<0);c.next=d}return b},toString:function(){var a=[];this.forEachRange(function(c,b){a.push(b===1?c:"%@..%@".fmt(c,c+b-1))},this);return"SC.IndexSet<%@>".fmt(a.join(","))},max:0});SC.IndexSet.slice=SC.IndexSet.copy=SC.IndexSet.clone;SC.IndexSet.EMPTY=SC.IndexSet.create().freeze();SC.json={encode:function(a){return JSON.stringify(a)},decode:function(a){return JSON.parse(a)}};if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());sc_require("ext/function");SC.LOGGER_LOG_DELIMITER=", ";SC.LOGGER_LOG_ERROR="ERROR: ";SC.LOGGER_LOG_INFO="INFO:  ";SC.LOGGER_LOG_WARN="WARN:  ";SC.LOGGER_LOG_DEBUG="DEBUG: ";SC.LOGGER_LOG_GROUP_HEADER="** %@";SC.LOGGER_LOG_GROUP_INDENTATION="    ";SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX="%@:  ";SC.LOGGER_LEVEL_DEBUG="debug";SC.LOGGER_LEVEL_INFO="info";SC.LOGGER_LEVEL_WARN="warn";SC.LOGGER_LEVEL_ERROR="error";SC.LOGGER_LEVEL_NONE="none";SC.Logger=SC.Object.create({messagePrefix:null,outputMessagePrefix:null,recordedMessagePrefix:null,logOutputLevel:null,logRecordingLevel:SC.LOGGER_LEVEL_NONE,recordedLogMessages:null,recordedLogMessagesMaximumLength:500,recordedLogMessagesPruningMinimumLength:100,debugEnabled:NO,exists:function(){return !SC.none(this.get("reporter"))}.property("reporter").cacheable(),fallBackOnAlert:NO,reporter:console,debug:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_DEBUG,YES,a,arguments)},debugWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_DEBUG,NO,null,arguments)},debugGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_DEBUG,a,arguments)},debugGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_DEBUG)},info:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_INFO,YES,a,arguments)},infoWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_INFO,NO,null,arguments)},infoGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_INFO,a,arguments)},infoGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_INFO)},warn:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_WARN,YES,a,arguments)},warnWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_WARN,NO,null,arguments)},warnGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_WARN,a,arguments)},warnGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_WARN)},error:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_ERROR,YES,a,arguments)},errorWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_ERROR,NO,null,arguments)},errorGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_ERROR,a,arguments)},errorGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_ERROR)},outputRecordedLogMessages:function(o){if(!this.get("exists")){return}var s=this.get("reporter"),l=this.get("recordedLogMessages"),a=0,d=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX,r,p,b,c,h,k,f,g,u,n,m,q,t;if(l){for(r=0,p=l.length;r<p;++r){b=l[r];c=b.type;if(o){h=d.fmt(b.timestamp.toUTCString())}k=b.message;if(k){f=b.originalArguments;this._outputMessage(c,h,a,k,f)}else{n=b.indentation;u=b.title;m=n-a;if(s.group){if(Math.abs(m)>1){for(q=0,t=(m-1);q<t;++q){if(m>0){s.group()}else{s.groupEnd()}}}if(m>0){g=h?h:"";g+=u;s.group(g)}else{s.groupEnd()}}else{if(m>0){this._outputGroup(c,h,n-1,u)}}a=n}}}},stringifyRecordedLogMessages:function(){var k="",g=this.get("recordedLogMessages"),n=0,j=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX,d=this._LOG_FALLBACK_PREFIX_MAPPING,c=SC.LOGGER_LOG_GROUP_HEADER,f,a,p,m,s,r,h,q,o,l,b;if(g){for(f=0,a=g.length;f<a;++f){p=g[f];m=p.type;h=j.fmt(p.timestamp.toUTCString());h+=d[m]||"";s=p.message;if(s){r=p.originalArguments;q=h+this._indentation(n);q+=r?this._argumentsToString(r):s}else{l=p.indentation;o=p.title;b=l-n;if(b>0){q=h+this._indentation(n)+c.fmt(o)}n=l}k+=q+"\n"}}return k},log:function(){var a=this.get("reporter"),c=arguments[0],d=this.get("messagePrefix"),f=this.get("outputMessagePrefix"),b=NO;if(c&&SC.typeOf(c)===SC.T_STRING){if(d||f){if(d){c=d+c}if(f){c=f+c}arguments[0]=c}}if(this.get("exists")){if(typeof a.log==="function"){a.log.apply(a,arguments);b=YES}else{if(a.log){a.log(this._argumentsToArray(arguments));b=YES}}}if(!b&&this.get("fallBackOnAlert")){if(this.get("exists")&&(typeof a.alert==="function")){a.alert(arguments);b=YES}else{alert(arguments);b=YES}}return b},group:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.group==="function")){a.group(b)}},groupEnd:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.groupEnd==="function")){a.groupEnd()}},dir:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.dir==="function")){a.dir.apply(a,arguments)}else{this.log.apply(this,arguments)}},dirxml:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.dirxml==="function")){a.dirxml.apply(a,arguments)}else{this.log.apply(this,arguments)}},profile:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.profile==="function")){a.profile(b);return YES}return NO},profileEnd:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.profileEnd==="function")){a.profileEnd(b);return YES}return NO},time:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.time==="function")){a.time(b);return YES}return NO},timeEnd:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.timeEnd==="function")){a.timeEnd(b);return YES}return NO},trace:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.trace==="function")){a.trace();return YES}return NO},init:function(){arguments.callee.base.apply(this,arguments);if(!this.get("logOutputLevel")){if(SC.buildMode==="debug"){this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG)}else{this.set("logOutputLevel",SC.LOGGER_LEVEL_INFO)}}this.debugEnabledDidChange()},debugEnabledDidChange:function(){if(this.get("debugEnabled")){this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG)}}.observes("debugEnabled"),_handleMessage:function(m,o,q,p){var a=this._shouldOutputType(m),d=this._shouldRecordType(m),f,g,k,l,b,n,j,c,h;if(!(a||d)){return}f=(p&&p.length>1);if(o&&(SC.none(q)||(typeof q!=="string"))){o=NO}if(o){if(f){l=[];for(g=1,k=p.length;g<k;++g){l.push(p[g])}q=q.fmt.apply(q,l)}}j=this.get("messagePrefix");if(j){q=j+q}if(a){c=this.get("outputMessagePrefix");l=o?null:p;this._outputMessage(m,null,this._outputIndentationLevel,(c?c+q:q),l)}if(d){h=this.get("recordedMessagePrefix");n={type:m,message:q?(h?h+q:q):YES,timestamp:new Date()};if(!o&&f){n.originalArguments=p}this._addRecordedMessageEntry(n)}},_handleGroup:function(m,o,r){var a=this._shouldOutputType(m),f=this._shouldRecordType(m),g,h,k,l,q,d,c,j,b,n,p;if(!(a||f)){return}g=(r&&r.length>1);if(o&&g){l=[];for(h=1,k=r.length;h<k;++h){l.push(r[h])}o=o.fmt.apply(o,l)}if(a){this._outputGroup(m,null,this._outputIndentationLevel,o);this._outputIndentationLevel++}if(f){n=++this._recordingIndentationLevel;p={type:m,indentation:n,beginGroup:YES,title:o,timestamp:new Date()};this._addRecordedMessageEntry(p)}},_handleGroupEnd:function(d){var h=this._shouldOutputType(d),c=this._shouldRecordType(d),a,g,b,f;if(!(h||c)){return}if(h){this._outputIndentationLevel--;if(this.get("exists")){a=this.get("reporter");g=a.groupEnd;if(g){g.call(a)}}}if(c){b=--this._recordingIndentationLevel;f={type:d,indentation:b,timestamp:new Date()};this._addRecordedMessageEntry(f)}},_shouldOutputType:function(a){var c=this._LOG_LEVEL_MAPPING,d=c[a]||0,b=c[this.get("logOutputLevel")]||0;return(d<=b)},_shouldRecordType:function(a){var c=this._LOG_LEVEL_MAPPING,d=c[a]||0,b=c[this.get("logRecordingLevel")]||0;return(d<=b)},_outputMessage:function(i,h,j,m,l){if(!this.get("exists")){return}var d=this.get("reporter"),b,a,c,f,g,k;a=!d.group;c=d[i];if(c){if(!l){b=h?h:"";if(a){b+=this._indentation(j)}b+=m;d[i](b)}else{g=this._argumentsToArray(l);f="";if(h){f=h}if(a){f+=this._indentation(j)}if(f){g.splice(0,0,f)}if(c.apply){c.apply(d,g)}else{d[i](g)}}}else{if(d.log){f="";if(h){f=h}f+=this._LOG_FALLBACK_PREFIX_MAPPING[i]||"";if(a){f+=this._indentation(j)}if(!l){d.log(f+m)}else{g=this._argumentsToArray(l);if(f){g.splice(0,0,f)}d.log(g)}}}},_outputGroup:function(d,g,c,h){if(!this.get("exists")){return}var b=this.get("reporter"),f=b.group,a;if(f){a=g?g:"";a+=h;f.call(b,a)}else{if(b.log){a="";if(g){a=g}a+=this._LOG_FALLBACK_PREFIX_MAPPING[d]||"";a+=this._indentation(c);a+=SC.LOGGER_LOG_GROUP_HEADER.fmt(h);b.log(a)}}},_addRecordedMessageEntry:function(c){var b=this.get("recordedLogMessages"),a;if(!b){b=[];this.set("recordedLogMessages",b)}b.push(c);a=b.length;if(a>this.get("recordedLogMessagesMaximumLength")){b.splice(0,(a-this.get("recordedLogMessagesPruningMinimumLength")))}b.enumerableContentDidChange()},_argumentsToArray:function(c){var b=[],d,a;if(c){for(d=0,a=c.length;d<a;++d){b[d]=c[d]}}return b},_argumentsToString:function(){var c="",b=SC.LOGGER_LOG_DELIMITER,d,a;for(d=0,a=(arguments.length-1);d<a;++d){c+=arguments[d]+b}c+=arguments[a];return c},_indentation:function(d){if(!d||d<0){d=0}var b="",a=SC.LOGGER_LOG_GROUP_INDENTATION,c;for(c=0;c<d;++c){b+=a}return b},_outputIndentationLevel:0,_recordingIndentationLevel:0,_LOG_LEVEL_MAPPING:{debug:4,info:3,warn:2,error:1,none:0},_LOG_FALLBACK_PREFIX_MAPPING:{debug:SC.LOGGER_LOG_DEBUG,info:SC.LOGGER_LOG_INFO,warn:SC.LOGGER_LOG_WARN,error:SC.LOGGER_LOG_ERROR}});SC.debug=SC.Logger.debug;SC.info=SC.Logger.info;SC.warn=SC.Logger.warn;SC.error=SC.Logger.error;sc_require("ext/function");sc_require("private/observer_set");SC.RunLoop=SC.Object.extend({beginRunLoop:function(){this._start=new Date().getTime();if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.beginRunLoop at %@".fmt(this._start))}this._runLoopInProgress=YES;this._flushinvokeNextQueue();return this},isRunLoopInProgress:function(){return this._runLoopInProgress}.property(),endRunLoop:function(){if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.endRunLoop ~ flushing application queues")}this.flushAllPending();this._start=null;if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.endRunLoop ~ End")}SC.RunLoop.lastRunLoopEnd=Date.now();this._runLoopInProgress=NO;return this},flushAllPending:function(){var a;do{a=this.flushApplicationQueues();if(!a){a=this._flushinvokeLastQueue()}}while(a)},invokeOnce:function(b,c){if(c===undefined){c=b;b=this}var a;if(typeof c==="string"){c=b[c]}if(!this._invokeQueue){this._invokeQueue=SC.ObserverSet.create()}if(c){this._invokeQueue.add(b,c,undefined,a)}return this},invokeLast:function(b,c){if(c===undefined){c=b;b=this}var a;if(typeof c==="string"){c=b[c]}if(!this._invokeLastQueue){this._invokeLastQueue=SC.ObserverSet.create()}this._invokeLastQueue.add(b,c,undefined,a);return this},invokeNext:function(a,b){if(b===undefined){b=a;a=this}if(typeof b==="string"){b=a[b]}if(!this._invokeNextQueue){this._invokeNextQueue=SC.ObserverSet.create()}this._invokeNextQueue.add(a,b);return this},flushApplicationQueues:function(){var b=NO,a=this._invokeQueue;if(a&&a.getMembers().length){this._invokeQueue=null;b=YES;a.invokeMethods()}return SC.Binding.flushPendingChanges()||b},_flushinvokeLastQueue:function(){var a=this._invokeLastQueue,b=NO;if(a&&a.getMembers().length){this._invokeLastQueue=null;b=YES;if(b){a.invokeMethods()}}return b},_flushinvokeNextQueue:function(){var a=this._invokeNextQueue,b=NO;if(a&&a.getMembers().length){this._invokeNextQueue=null;b=YES;if(b){a.invokeMethods()}}return b}});SC.RunLoop.currentRunLoop=null;SC.RunLoop.runLoopClass=SC.RunLoop;SC.RunLoop.begin=function(){var a=this.currentRunLoop;if(!a){a=this.currentRunLoop=this.runLoopClass.create()}a.beginRunLoop();return this};SC.RunLoop.end=function(){var a=this.currentRunLoop;if(!a){throw"SC.RunLoop.end() called outside of a runloop!"}a.endRunLoop();return this};SC.RunLoop.kill=function(){this.currentRunLoop=this.runLoopClass.create();return this};SC.RunLoop.isRunLoopInProgress=function(){if(this.currentRunLoop){return this.currentRunLoop.get("isRunLoopInProgress")}return NO};SC.run=function(g,f,b){var a=SC.RunLoop.isRunLoopInProgress();if(SC.ExceptionHandler&&SC.ExceptionHandler.enabled){try{if(b||!a){SC.RunLoop.begin()}if(g){g.call(f)}if(b||!a){SC.RunLoop.end()}}catch(d){var c=SC.ExceptionHandler.handleException(d);if(!c&&!SC.browser.isIE){throw d}}}else{if(b||!a){SC.RunLoop.begin()}if(g){g.call(f)}if(b||!a){SC.RunLoop.end()}}};SC.RunLoop.wrapFunction=function(b){var a=function(){var c=SC.RunLoop.isRunLoopInProgress();if(!c){SC.RunLoop.begin()}var d=arguments.callee.wrapped.apply(this,arguments);if(!c){SC.RunLoop.end()}return d};a.wrapped=b;return a};SC.DROP_ON=1;SC.DROP_BEFORE=2;SC.DROP_AFTER=4;SC.DROP_ANY=7;SC.ALIGN_LEFT="left";SC.ALIGN_RIGHT="right";SC.ALIGN_CENTER="center";SC.ALIGN_TOP="top";SC.ALIGN_MIDDLE="middle";SC.ALIGN_BOTTOM="bottom";SC.ALIGN_TOP_LEFT="top-left";SC.ALIGN_TOP_RIGHT="top-right";SC.ALIGN_BOTTOM_LEFT="bottom-left";SC.ALIGN_BOTTOM_RIGHT="bottom-right";SC.mixin({data:$.data,removeData:$.removeData,STRINGS:{},stringsFor:function(b,a){SC.mixin(SC.STRINGS,a);return this}});SC.Controller=SC.Object.extend({isEditable:YES,destroyContentOnReplace:NO,contentObjectDidChanged:function(){var b,a;if(!this.get("destroyContentOnReplace")){return}b=this._oldContent;a=this.get("content");if(b&&a!==b&&b.destroy){b.destroy()}this._oldContent=a}.observes("content")});SC.SelectionSupport={hasSelectionSupport:YES,allowsSelection:YES,allowsMultipleSelection:YES,allowsEmptySelection:YES,firstSelectableObject:function(){return this.get("firstObject")}.property(),selection:function(d,g){var c=this._scsel_selection,h=c?c.get("length"):0,f,b=this.get("arrangedObjects"),a;if((g===undefined)||!this.get("allowsSelection")){g=c}a=(g&&g.isEnumerable)?g.get("length"):0;if((a>1)&&!this.get("allowsMultipleSelection")){if(h>1){g=SC.SelectionSet.create().addObject(c.get("firstObject")).freeze();a=1}else{g=c;a=h}}if((a===0)&&!this.get("allowsEmptySelection")&&b&&b.get("length")!==0){if(h===0){g=this.get("firstSelectableObject");if(g){g=SC.SelectionSet.create().addObject(g).freeze()}else{g=SC.SelectionSet.EMPTY}a=g.get("length")}else{g=c;a=h}}if(a===0){g=SC.SelectionSet.EMPTY}if(g!==c){g=g.frozenCopy()}this._scsel_selection=g;return g}.property("arrangedObjects","allowsEmptySelection","allowsMultipleSelection","allowsSelection").cacheable(),hasSelection:function(){var a=this.get("selection");return !!a&&(a.get("length")>0)}.property("selection").cacheable(),selectObjects:function(b,c){if(!b||b.get("length")===0){if(!c){this.set("selection",SC.SelectionSet.EMPTY)}return this}var a=this.get("selection");if(c&&a){a=a.copy()}else{a=SC.SelectionSet.create()}a.addObjects(b).freeze();this.set("selection",a);return this},selectObject:function(a,b){if(a===null){if(!b){this.set("selection",null)}return this}else{return this.selectObjects([a],b)}},deselectObjects:function(b){if(!b||b.get("length")===0){return this}var a=this.get("selection");if(!a||a.get("length")===0){return this}a=a.copy().removeObjects(b).freeze();this.set("selection",a.freeze());return this},deselectObject:function(a){if(!a){return this}else{return this.deselectObjects([a])}},updateSelectionAfterContentChange:function(){var a=this.get("arrangedObjects");var b=this.get("selection");var d=this.get("allowsEmptySelection");var c;if(!b){return this}c=b.indexSetForSource(a);if((c&&(c.get("length")!==b.get("length")))||(!c&&(b.get("length")>0))){b=b.copy().constrain(a).freeze();this.set("selection",b)}if((b.get("length")===0)&&a&&(a.get("length")>0)&&!d){this.selectObject(this.get("firstSelectableObject"),NO)}return this}};sc_require("controllers/controller");sc_require("mixins/selection_support");SC.ArrayController=SC.Controller.extend(SC.Array,SC.SelectionSupport,{content:null,isEditable:YES,orderBy:null,allowsSingleContent:YES,destroyOnRemoval:NO,arrangedObjects:function(){return this}.property().cacheable(),canRemoveContent:function(){var b=this.get("content"),a;a=!!b&&this.get("isEditable")&&this.get("hasContent");if(a){return !b.isEnumerable||(SC.typeOf(b.removeObject)===SC.T_FUNCTION)}else{return NO}}.property("content","isEditable","hasContent"),canReorderContent:function(){var b=this.get("content"),a;a=!!b&&this.get("isEditable")&&!this.get("orderBy");return a&&!!b.isSCArray}.property("content","isEditable","orderBy"),canAddContent:function(){var b=this.get("content"),a;a=b&&this.get("isEditable")&&b.isEnumerable;if(a){return(SC.typeOf(b.addObject)===SC.T_FUNCTION)||(SC.typeOf(b.pushObject)===SC.T_FUNCTION)}else{return NO}}.property("content","isEditable"),hasContent:function(){var a=this.get("content");return !!a&&(!!a.isEnumerable||!!this.get("allowsSingleContent"))}.property("content","allowSingleContent"),status:function(){var b=this.get("content"),a=b?b.get("status"):null;return a?a:SC.Record.READY}.property().cacheable(),addObject:function(a){if(!this.get("canAddContent")){throw"%@ cannot add content".fmt(this)}var b=this.get("content");if(b.isSCArray){b.pushObject(a)}else{if(b.addObject){b.addObject(a)}else{throw"%@.content does not support addObject".fmt(this)}}return this},removeObject:function(a){if(!this.get("canRemoveContent")){throw"%@ cannot remove content".fmt(this)}var b=this.get("content");if(b.isEnumerable){b.removeObject(a)}else{this.set("content",null)}if(this.get("destroyOnRemoval")&&a.destroy){a.destroy()}return this},length:function(){var a=this._scac_observableContent();return a?a.get("length"):0}.property().cacheable(),objectAt:function(a){var b=this._scac_observableContent();return b?b.objectAt(a):undefined},replace:function(h,g,d){if(!d||d.get("length")===0){if(!this.get("canRemoveContent")){throw"%@ cannot remove objects from the current content".fmt(this)}}else{if(!this.get("canReorderContent")){throw"%@ cannot add or reorder the current content".fmt(this)}}var c=this.get("content");var b=[],a,f;if(this.get("destroyOnRemoval")){for(a=0;a<g;a++){b.push(c.objectAt(a+h))}}if(c){c.replace(h,g,d)}for(a=0,f=b.length;a<f;a++){b[a].destroy()}b=null;return this},indexOf:function(b,a){var c=this._scac_observableContent();return c?c.indexOf(b,a):-1},init:function(){arguments.callee.base.apply(this,arguments);this._scac_contentDidChange()},_scac_cached:NO,_scac_observableContent:function(){var c=this._scac_cached;if(c){return c}var g=this.get("content"),f,b,a;if(SC.none(g)){return(this._scac_cached=[])}if(!g.isEnumerable){c=this.get("allowsSingleContent")?[g]:[];return(this._scac_cached=c)}var h=this.get("orderBy");if(!h){if(g.isSCArray){return(this._scac_cached=g)}else{throw"%@.orderBy is required for unordered content".fmt(this)}}var d=SC.typeOf(h);if(d===SC.T_STRING){h=[h]}else{if(d===SC.T_FUNCTION){f=h}else{if(d!==SC.T_ARRAY){throw"%@.orderBy must be Array, String, or Function".fmt(this)}}}f=f||function(q,p){var m,r,o,j,s;for(var n=0,k=h.get("length");n<k&&!m;n++){r=h.objectAt(n);if(r.search(/(ASC|DESC)/)===0){o=r.match(/^(ASC )?(DESC )?(.*)$/);r=o[3]}else{o=r.match(/^(\S*)\s*(DESC)?(?:ASC)?$/);r=o[1]}a=o[2]?-1:1;if(q){j=q.isObservable?q.get(r):q[r]}if(p){s=p.isObservable?p.get(r):p[r]}m=SC.compare(j,s)*a}return m};return(this._scac_cached=g.toArray().sort(f))},propertyWillChange:function(a){if(a==="content"){this.arrayContentWillChange(0,this.get("length"),0)}else{return arguments.callee.base.apply(this,arguments)}},_scac_arrayContentWillChange:function(d,c,a){this.arrayContentWillChange(d,c,a);if(this._kvo_enumerable_property_chains){var b=this.slice(d,d+c);this.teardownEnumerablePropertyChains(b)}},_scac_arrayContentDidChange:function(d,c,a){this._scac_cached=NO;this.arrayContentDidChange(d,c,a);if(this._kvo_enumerable_property_chains){var b=this.slice(d,d+a);this.setupEnumerablePropertyChains(b)}this.updateSelectionAfterContentChange()},_scac_contentDidChange:function(){this._scac_cached=NO;var i=this.get("content"),d=!!this.get("orderBy"),j=this._scac_content,a=this._scac_length||0,h=this._scac_arrayContentDidChange,c=this._scac_arrayContentWillChange,b=this._scac_contentStatusDidChange,g=this._scac_enumerableDidChange,f;if(i===j){return this}if(j){if(j.isSCArray){j.removeArrayObservers({target:this,didChange:h,willChange:c})}else{if(j.isEnumerable){j.removeObserver("[]",this,g)}}j.removeObserver("status",this,b);this.teardownEnumerablePropertyChains(j)}this._scac_cached=NO;this._scac_content=i;if(i){if(i.isSCArray){i.addArrayObservers({target:this,didChange:h,willChange:c});f=i.get("length")}else{if(i.isEnumerable){i.addObserver("[]",this,g);f=i.get("length")}else{f=1}}i.addObserver("status",this,b);this.setupEnumerablePropertyChains(i)}else{f=SC.none(i)?0:1}this._scac_length=f;this._scac_contentStatusDidChange();this.arrayContentDidChange(0,0,f);this.updateSelectionAfterContentChange()}.observes("content"),_scac_enumerableDidChange:function(){var a=this.get("content"),c=a?a.get("length"):0,b=this._scac_length;this._scac_length=c;this.beginPropertyChanges();this._scac_cached=NO;this.arrayContentDidChange(0,b,c);this.enumerableContentDidChange(0,b-1);this.endPropertyChanges();this.updateSelectionAfterContentChange()}.observes("orderBy"),_scac_contentStatusDidChange:function(){this.notifyPropertyChange("status")}});sc_require("controllers/controller");SC.ObjectController=SC.Controller.extend({content:null,allowsMultipleContent:NO,hasContent:function(){return !SC.none(this.get("observableContent"))}.property("observableContent"),isEditable:YES,observableContent:function(){var b=this.get("content"),a,c;if(b&&b.isEnumerable){a=b.get("length");c=this.get("allowsMultipleContent");if(a===1){b=b.firstObject()}else{if(a===0||!c){b=null}}if(b&&!c&&b.isEnumerable){b=null}}return b}.property("content","allowsMultipleContent").cacheable(),destroy:function(){var a=this.get("observableContent");if(a&&SC.typeOf(a.destroy)===SC.T_FUNCTION){a.destroy()}this.set("content",null);return this},contentPropertyDidChange:function(b,a){if(a==="*"){this.allPropertiesDidChange()}else{this.notifyPropertyChange(a)}},unknownProperty:function(b,d){if(b==="content"){if(d!==undefined){this.content=d}return this.content}var c=this.get("observableContent"),g,f,a;if(c===null||c===undefined){return undefined}if(d===undefined){if(c.isEnumerable){d=c.getEach(b);g=d.get("length");if(g>0){a=YES;f=d.objectAt(0);while((--g>0)&&a){if(f!==d.objectAt(g)){a=NO}}if(a){d=f}}else{d=undefined}}else{d=(c.isObservable)?c.get(b):c[b]}}else{if(!this.get("isEditable")){throw"%@.%@ is not editable".fmt(this,b)}if(c.isEnumerable){c.setEach(b,d)}else{if(c.isObservable){c.set(b,d)}else{c[b]=d}}}return d},init:function(){arguments.callee.base.apply(this,arguments);if(this.get("content")){this._scoc_contentDidChange()}if(this.get("observableContent")){this._scoc_observableContentDidChange()}},_scoc_contentDidChange:function(){var b=this._scoc_content,c=this.get("content");if(b!==c){this._scoc_content=c;var a=this._scoc_enumerableContentDidChange;if(b&&b.isEnumerable){b.removeObserver("[]",this,a)}if(c&&c.isEnumerable){c.addObserver("[]",this,a)}}}.observes("content"),_scoc_observableContentDidChange:function(){var b=this._scoc_observableContent,d=this.get("observableContent"),a=this.contentPropertyDidChange,c=this._scoc_enumerableContentDidChange;if(b===d){return this}this._scoc_observableContent=d;if(b){if(b.isEnumerable){b.removeObserver("[]",this,c)}else{if(b.isObservable){b.removeObserver("*",this,a)}}}if(d){if(d.isEnumerable){d.addObserver("[]",this,c)}else{if(d.isObservable){d.addObserver("*",this,a)}}}if((b&&b.isEnumerable)||(d&&d.isEnumerable)){this._scoc_enumerableContentDidChange()}else{this.contentPropertyDidChange(d,"*")}}.observes("observableContent"),_scoc_enumerableContentDidChange:function(){var b=this.get("observableContent"),c=this._scoc_observableContentItems,a=this.contentPropertyDidChange;if(c){c.forEach(function(d){if(d.isObservable){d.removeObserver("*",this,a)}},this);c.clear()}if(b&&b.isEnumerable){if(!c){c=SC.Set.create()}b.forEach(function(d){if(c.contains(d)){return}c.add(d);if(d.isObservable){d.addObserver("*",this,a)}},this)}else{c=null}this._scoc_observableContentItems=c;this.contentPropertyDidChange(b,"*");return this}});SC.mixin(Function.prototype,{invokeLater:function(g,a){if(a===undefined){a=1}var d=this;if(arguments.length>2){var b=SC.$A(arguments).slice(2,arguments.length);b.unshift(g);var c=d;d=function(){return c.apply(this,b.slice(1))}}return SC.Timer.schedule({target:g,action:d,interval:a})}});SC.mixin(SC.Object.prototype,{invokeLater:function(d,a){var c,b;if(SC.typeOf(d)===SC.T_STRING){d=this[d]}if(a===undefined){a=1}if(arguments.length>2){b=SC.$A(arguments).slice(2);c=function(){return d.apply(this,b)}}else{c=d}return SC.Timer.schedule({target:this,action:c,interval:a})},invokeOnceLater:function(j,c){var d,h,b,g=this._sc_invokeOnceLaterTimers,i,a;if(SC.typeOf(j)===SC.T_STRING){j=this[j]}if(c===undefined){c=1}if(!g){g=this._sc_invokeOnceLaterTimers={}}b=SC.guidFor(j);i=g[b];if(i){i.invalidate()}if(arguments.length>2){d=SC.$A(arguments).slice(2)}else{d=arguments}h=function(){delete g[b];return j.apply(this,d)};a=SC.Timer.schedule({target:this,action:h,interval:c});g[b]=a;return a},invokeWith:function(b,c,d){if(d===undefined){d=c;c=this}if(!c){c=this}if(SC.typeOf(d)===SC.T_STRING){d=c[d]}var a=this.getPath(b);d.call(c,a,this);return this}});SC.RunLoop=SC.RunLoop.extend({startTime:function(){if(!this._start){this._start=Date.now()}return this._start}.property(),endRunLoop:function(){this.fireExpiredTimers();var a=arguments.callee.base.apply(this,arguments);this.scheduleNextTimeout();return a},scheduleTimer:function(b,a){this._timerQueue=b.removeFromTimerQueue(this._timerQueue);this._timerQueue=b.scheduleInTimerQueue(this._timerQueue,a);return this},cancelTimer:function(a){this._timerQueue=a.removeFromTimerQueue(this._timerQueue);return this},TIMER_ARRAY:[],fireExpiredTimers:function(){if(!this._timerQueue||this._firing){return NO}var d=this.get("startTime"),f=this.TIMER_ARRAY,c,b,a;this._firing=YES;this._timerQueue=this._timerQueue.collectExpiredTimers(f,d);b=f.length;for(c=0;c<b;c++){f[c].fire()}a=f.length>0;f.length=0;this._firing=NO;return a},scheduleNextTimeout:function(){var d=this._timerQueue;var b=NO;if(!d){if(this._timeout){clearTimeout(this._timeout)}}else{var c=d._timerQueueRunTime;if(this._timeoutAt!==c){if(this._timeout){clearTimeout(this._timeout)}var a=Math.max(0,c-Date.now());this._timeout=setTimeout(this._timeoutDidFire,a);this._timeoutAt=c}b=YES}return b},_timeoutDidFire:function(){var a=SC.RunLoop.currentRunLoop;a._timeout=a._timeoutAt=null;SC.run()}});SC.RunLoop.currentRunLoop=SC.RunLoop.create();SC.RunLoop.runLoopClass=SC.RunLoop;SC.Locale=SC.Object.extend({init:function(){if(!this.language){SC.Locale._assignLocales()}if(!this.hasStrings){var c=this._deprecatedLanguageCodes||[];c.push(this.language);var b=c.length;var a=null;while(!a&&--b>=0){a=String[c[b]]}if(a){this.hasStrings=YES;this.strings=a}}},hasStrings:NO,strings:{},metrics:{},toString:function(){if(!this.language){SC.Locale._assignLocales()}return"SC.Locale["+this.language+"]"+SC.guidFor(this)},locWithDefault:function(b,c){var a=this.strings[b];if(SC.typeOf(a)===SC.T_STRING){return a}else{if(SC.typeOf(c)===SC.T_STRING){return c}}return b},locMetric:function(b){var a=this.metrics[b];if(SC.typeOf(a)===SC.T_NUMBER){return a}else{if(a===undefined){SC.warn('No localized metric found for key "'+b+'"');return undefined}else{SC.warn('Unexpected metric type for key "'+b+'"');return undefined}}},locLayout:function(c,b){var f,h,g,n,m,a=SC.Locale.layoutKeys,l=this.metrics,k=SC.typeOf,d=SC.T_NUMBER,j={};if(b){SC.mixin(j,b)}for(f=0,h=a.length;f<h;++f){g=a[f];n=c+"."+g;m=l[n];if(k(m)===d){if(b&&b[g]){throw"locLayout():  There is a localized value for the key '"+n+"' but a value for '"+g+"' was also specified in the non-localized hash"}j[g]=m}}return j}});SC.Locale.mixin({useAutodetectedLanguage:NO,preferredLanguage:null,layoutKeys:["left","top","right","bottom","width","height","minWidth","minHeight","centerX","centerY"],createCurrentLocale:function(){var c=(String.useAutodetectedLanguage!==undefined)?String.useAutodetectedLanguage:this.useAutodetectedLanguage;var b=(String.preferredLanguage!==undefined)?String.preferredLanguage:this.preferredLanguage;var d=((c)?SC.browser.language:null)||b||SC.browser.language||"en";d=SC.Locale.normalizeLanguage(d);var a=this.localeClassFor(d);if(d!=this.currentLanguage){this.currentLanguage=d;this.currentLocale=a.create()}return this.currentLocale},localeClassFor:function(c){c=SC.Locale.normalizeLanguage(c);var b,a=this.locales[c];if(!a&&((b=c.split("-")[0])!==c)&&(a=this.locales[b])){a=this.locales[c]=a.extend()}if(!a){a=this.locales[c]=this.locales.en.extend()}return a},define:function(b,c){var a;if(c===undefined&&(SC.typeOf(b)!==SC.T_STRING)){a=this;c=b}else{a=SC.Locale.localeClassFor(b)}SC.mixin(a.prototype,c);return a},options:function(){return this.prototype},addStrings:function(b){var a=this.prototype.strings;if(a){if(!this.prototype.hasOwnProperty("strings")){a=this.prototype.strings=SC.clone(a)}}else{a=this.prototype.strings={}}if(b){this.prototype.strings=SC.mixin(a,b)}this.prototype.hasStrings=YES;return this},addMetrics:function(b){var a=this.prototype.metrics;if(a){if(!this.prototype.hasOwnProperty(a)){a=this.prototype.metrics=SC.clone(a)}}else{a=this.prototype.metrics={}}if(b){this.prototype.metrics=SC.mixin(a,b)}return this},_map:{english:"en",french:"fr",german:"de",japanese:"ja",jp:"ja",spanish:"es"},normalizeLanguage:function(a){if(!a){return"en"}return SC.Locale._map[a.toLowerCase()]||a},_assignLocales:function(){for(var a in this.locales){this.locales[a].prototype.language=a}},toString:function(){if(!this.prototype.language){SC.Locale._assignLocales()}return"SC.Locale["+this.prototype.language+"]"},extend:function(){var a=SC.Object.extend.apply(this,arguments);a.addStrings=SC.Locale.addStrings;a.define=SC.Locale.define;a.options=SC.Locale.options;a.toString=SC.Locale.toString;return a}});SC.Locale.locales={en:SC.Locale.extend({_deprecatedLanguageCodes:["English"]}),fr:SC.Locale.extend({_deprecatedLanguageCodes:["French"]}),de:SC.Locale.extend({_deprecatedLanguageCodes:["German"]}),ja:SC.Locale.extend({_deprecatedLanguageCodes:["Japanese","jp"]}),es:SC.Locale.extend({_deprecatedLanguageCodes:["Spanish"]})};SC.stringsFor=function(c,b){var a=SC.Locale.localeClassFor(c);a.addStrings(b);return this};SC.metricsFor=function(c,b){var a=SC.Locale.localeClassFor(c);a.addMetrics(b);return this};sc_require("system/locale");SC.STRING_TITLEIZE_REGEXP=(/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g);SC.STRING_DECAMELIZE_REGEXP=(/([a-z])([A-Z])/g);SC.STRING_DASHERIZE_REGEXP=(/[ _]/g);SC.STRING_DASHERIZE_CACHE={};SC.STRING_TRIM_LEFT_REGEXP=(/^\s+/g);SC.STRING_TRIM_RIGHT_REGEXP=(/\s+$/g);SC.mixin(SC.String,{capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},camelize:function(d){var b=d.replace(SC.STRING_TITLEIZE_REGEXP,function(g,h,f){return f?f.toUpperCase():""});var c=b.charAt(0),a=c.toLowerCase();return c!==a?a+b.slice(1):b},decamelize:function(a){return a.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase()},dasherize:function(c){var a=SC.STRING_DASHERIZE_CACHE,b=a[c];if(b){return b}else{b=SC.String.decamelize(c).replace(SC.STRING_DASHERIZE_REGEXP,"-");a[c]=b}return b},loc:function(d){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()}var b=SC.Locale.currentLocale.locWithDefault(d);if(SC.typeOf(b)!==SC.T_STRING){b=d}var a=SC.$A(arguments);a.shift();if(a.length>0&&a[0]&&a[0].isSCArray){a=a[0]}try{return SC.String.fmt(b,a)}catch(c){SC.error("Error processing string with key: "+d);SC.error("Localized String: "+b);SC.error("Error: "+c)}},locMetric:function(b){var a=SC.Locale,c=a.currentLocale;if(!c){a.createCurrentLocale();c=a.currentLocale}return c.locMetric(b)},locLayout:function(b,c){var a=SC.Locale,d=a.currentLocale;if(!d){a.createCurrentLocale();d=a.currentLocale}return d.locLayout(b,c)},locWithDefault:function(d,c){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()}var b=SC.Locale.currentLocale.locWithDefault(d,c);if(SC.typeOf(b)!==SC.T_STRING){b=d}var a=SC.$A(arguments);a.shift();a.shift();return SC.String.fmt(b,a)},trim:jQuery.trim,trimLeft:function(a){return a.replace(SC.STRING_TRIM_LEFT_REGEXP,"")},trimRight:function(a){return a.replace(SC.STRING_TRIM_RIGHT_REGEXP,"")},mult:function(d,c){if(SC.typeOf(c)!==SC.T_NUMBER||c<1){return null}var a="";for(var b=0;b<c;b+=1){a+=d}return a}});if(String.prototype.trim){SC.supplement(String.prototype,{trim:function(){return SC.String.trim(this,arguments)},trimLeft:function(){return SC.String.trimLeft(this,arguments)},trimRight:function(){return SC.String.trimRight(this,arguments)}})}SC.mixin(String.prototype,{loc:function(){return SC.String.loc(this.toString(),SC.$A(arguments))},locMetric:function(){return SC.String.locMetric(this.toString())},locLayout:function(a){return SC.String.locLayout(this.toString(),a)}});sc_require("system/string");SC.supplement(String.prototype,{capitalize:function(){return SC.String.capitalize(this,arguments)},camelize:function(){return SC.String.camelize(this,arguments)},decamelize:function(){return SC.String.decamelize(this,arguments)},dasherize:function(){return SC.String.dasherize(this,arguments)},loc:function(){var a=SC.$A(arguments);a.unshift(this);return SC.String.loc.apply(SC.String,a)},locWithDefault:function(b){var a=SC.$A(arguments);a.unshift(this);return SC.String.locWithDefault.apply(SC.String,a)},mult:function(a){return SC.String.mult(this,a)}});SC.ActionSupport={target:null,action:null,actionContext:null,fireAction:function(b){var c=this.get("target")||null,a=this.getPath("pane.rootResponder");if(b===undefined){b=this.get("action")}if(b&&a){return a.sendAction(b,c,this,this.get("pane"),this.get("actionContext"),this)}return false}};SC.DelegateSupport={delegateFor:function(c){var b=1,a=arguments.length,d;while(b<a){d=arguments[b];if(d&&d[c]!==undefined){return d}b++}return(this[c]!==undefined)?this:null},invokeDelegateMethod:function(c,a,b){b=SC.A(arguments);b=b.slice(2,b.length);if(!c||!c[a]){c=this}var d=c[a];return d?d.apply(c,b):null},getDelegateProperty:function(d,f){var b=1,a=arguments.length,c;while(b<a){c=arguments[b++];if(c&&c[d]!=undefined){return c.get?c.get(d):c[d]}}return(this[d]!=undefined)?this.get(d):undefined}};SC.Responder=SC.Object.extend({isResponder:YES,pane:null,responderContext:null,nextResponder:null,isFirstResponder:NO,hasFirstResponder:NO,acceptsFirstResponder:YES,becomingFirstResponder:NO,becomeFirstResponder:function(){var a=this.get("pane")||this.get("responderContext")||this.pane();if(a&&this.get("acceptsFirstResponder")){if(a.get("firstResponder")!==this){a.makeFirstResponder(this)}}return this},resignFirstResponder:function(a){var b=this.get("pane")||this.get("responderContext");if(b&&(b.get("firstResponder")===this)){b.makeFirstResponder(null,a)}return YES},willLoseFirstResponder:function(a){},didBecomeFirstResponder:function(a){}});sc_require("system/responder");SC.ResponderContext={isResponderContext:YES,trace:NO,defaultResponder:null,nextResponder:function(){return this.get("defaultResponder")}.property("defaultResponder").cacheable(),firstResponder:null,nextResponderFor:function(a){var b=a.get("nextResponder");if(typeof b===SC.T_STRING){b=SC.objectForPropertyPath(b,this)}else{if(!b&&(a!==this)){b=this}}return b},responderNameFor:function(a){if(!a){return"(No Responder)"}else{if(a._scrc_name){return a._scrc_name}}var b=this.NAMESPACE;this._findResponderNamesFor(this,3,b?[this.NAMESPACE]:[]);return a._scrc_name||a.toString()},_findResponderNamesFor:function(a,f,d){var b,c;for(b in a){if(b==="nextResponder"){continue}c=a[b];if(c&&c.isResponder){if(c._scrc_name){continue}d.push(b);c._scrc_name=d.join(".");if(f>0){this._findResponderNamesFor(c,f-1,d)}d.pop()}}},makeFirstResponder:function(b,a){var g=this.get("firstResponder"),d=this.get("nextResponder"),f=this.get("trace"),c;if(this._locked){if(f){SC.Logger.log("%@: AFTER ACTION: makeFirstResponder => %@".fmt(this,this.responderNameFor(b)))}this._pendingResponder=b;return}if(f){SC.Logger.log("%@: makeFirstResponder => %@".fmt(this,this.responderNameFor(b)))}if(b){b.set("becomingFirstResponder",YES)}this._locked=YES;this._pendingResponder=null;c=b?b:null;while(c){if(c.get("hasFirstResponder")){break}c=(c===d)?null:this.nextResponderFor(c)}if(!c){c=d}this._notifyWillLoseFirstResponder(g,g,c,a);if(g){g.set("isFirstResponder",NO)}this.beginPropertyChanges();this.set("firstResponder",b);if(b){b.set("isFirstResponder",YES)}this._notifyDidBecomeFirstResponder(b,b,c);this.endPropertyChanges();this._locked=NO;if(this._pendingResponder){this.makeFirstResponder(this._pendingResponder);this._pendingResponder=null}if(b){b.set("becomingFirstResponder",NO)}return this},_notifyWillLoseFirstResponder:function(c,f,b,a){if(!f||f===b){return}f.willLoseFirstResponder(c,a);f.set("hasFirstResponder",NO);var d=this.nextResponderFor(f);if(d){this._notifyWillLoseFirstResponder(c,d,b)}},_notifyDidBecomeFirstResponder:function(b,d,a){if(!d||d===a){return}var c=this.nextResponderFor(d);if(c){this._notifyDidBecomeFirstResponder(b,c,a)}d.set("hasFirstResponder",YES);d.didBecomeFirstResponder(b)},resetFirstResponder:function(){var a=this.get("firstResponder");if(!a){return}a.willLoseFirstResponder();a.didBecomeFirstResponder()},sendAction:function(h,d,c){var a=this.get("firstResponder"),f=this.get("nextResponder"),g=this.get("trace"),i=NO,b;this._locked=YES;if(g){SC.Logger.log("%@: begin action '%@' (%@, %@)".fmt(this,h,d,c))}if(!i&&!a&&this.tryToPerform){i=this.tryToPerform(h,d,c)}while(!i&&a){if(a.tryToPerform){i=a.tryToPerform(h,d,c)}if(!i){a=(a===f)?null:this.nextResponderFor(a)}}if(g){if(!i){SC.Logger.log("%@:  action '%@' NOT HANDLED".fmt(this,h))}else{SC.Logger.log("%@: action '%@' handled by %@".fmt(this,h,this.responderNameFor(a)))}}this._locked=NO;if(b=this._pendingResponder){this._pendingResponder=null;this.makeFirstResponder(b)}return a}};SC.bodyOverflowArbitrator=SC.Object.create({requestHidden:function(b,a){this._makeRequest(b,-1-9*!!a)},requestVisible:function(b,a){this._makeRequest(b,1+9*!!a)},withdrawRequest:function(b){if(!b){return}var a=SC.guidFor(b);if(this._requests[a]){delete this._requests[a]}this.setOverflow()},setOverflow:function(){var a=this._decideOverflow();if(a!==undefined){document.body.style.overflow=a?"auto":"hidden"}},_makeRequest:function(c,b){if(!c){return}var a=SC.guidFor(c);this._requests[a]=b;this.setOverflow()},_requests:{},_decideOverflow:function(){var a,f,c,g,b=this._requests,h;for(var d in b){if((h=b[d])<0){a=YES}if(h<-1){c=YES}if(h>0){f=YES}if(h>1){g=YES}}if(g){return YES}if(f&&c){return NO}if(f){return YES}if(a){return NO}return undefined}});SC.mixin(SC.browser,{compare:function(c,a){var g,h,f;if(typeof c==="number"||typeof a==="number"){SC.warn("SC.browser.compare(): Versions compared against Numbers may not provide accurate results.  Use a String of decimal separated Numbers instead.");c=String(c);a=String(a)}g=function(i){return Number(i.match(/^[0-9]+/))};h=SC.A(c.split(".")).map(g);f=SC.A(a.split(".")).map(g);for(var d=0;d<f.length;d++){var b=h[d]-f[d];if(isNaN(b)){return 0}if(b!==0){return b}}return 0},compareVersion:function(){SC.warn("SC.browser.compareVersion() has been deprecated.  Please use SC.browser.compare() instead.  Example: SC.browser.compareVersion(16,0,912) < 0 becomes SC.browser.compare(SC.browser.engineVersion, '16.0.912').");if(this._versionSplit===undefined){var d=function(f){return Number(f.match(/^[0-9]+/))};this._versionSplit=SC.A(this.version.split(".")).map(d)}var c=SC.A(arguments).map(Number);for(var b=0;b<c.length;b++){var a=this._versionSplit[b]-c[b];if(isNaN(a)){return 0}if(a!==0){return a}}return 0}});SC.Builder=function(a){return SC.Builder.create(a)};SC.Builder.create=function create(c){var b=SC.mixin(SC.beget(this.fn),c||{});if(c.hasOwnProperty("toString")){b.toString=c.toString}var a=function(){var d=SC.beget(b);d.defaultClass=this;d.constructor=a;return d.init.apply(d,arguments)};a.fn=a.prototype=b;a.extend=SC.Builder.create;a.mixin=SC.Builder.mixin;return a};SC.Builder.mixin=function(){var b=arguments.length,a;for(a=0;a<b;a++){SC.mixin(this,arguments[a])}return this};SC.Builder.fn={init:function(a){if(a!==undefined){if(SC.typeOf(a)===SC.T_ARRAY){var b=a.length;while(--b>=0){this[b]=a.objectAt?a.objectAt(b):a[b]}this.length=a.length}else{this[0]=a;this.length=1}}return this},size:function(){return this.length},pushStack:function(){var a=this.constructor.apply(this,arguments);a.prevObject=this;return a},end:function(){return this.prevObject||this.constructor()},toString:function(){return"%@$(%@)".fmt(this.defaultClass.toString(),SC.A(this).invoke("toString").join(","))},mixin:SC.Builder.mixin};(function(){var a=SC.Enumerable,c=SC.Builder.fn,b,d;for(b in a){if(!a.hasOwnProperty(b)){continue}d=Array.prototype[b]||a[b];c[b]=d}})();sc_require("system/builder");SC.$=SC.CoreQuery=jQuery;SC.mixin(SC.$.fn,{isCoreQuery:YES,toString:function(){var c=[],b=this.length,a=0;for(a=0;a<b;a++){c[a]="%@: %@".fmt(a,this[a]?this[a].toString():"(null)")}return"<$:%@>(%@)".fmt(SC.guidFor(this),c.join(" , "))},isVisible:function(){return Array.prototype.every.call(this,function(a){return SC.$.isVisible(a)})},view:function(){return this.map(function(){var b=null,a=SC.viewKey,d=this,c;while(!b&&d&&(d!==document)){if(d.nodeType===1&&(c=d.getAttribute("id"))){b=SC.View.views[c]}d=d.parentNode}d=null;return b})},within:function(a){if(this.filter(a).length){return true}return !!this.has(a).length}});(function(){var c={},g={find:function(i,h){return(h!==undefined)?SC.Enumerable.find.call(this,i,h):c.find.call(this,i)},filter:function(i,h){return(h!==undefined)?this.pushStack(SC.Enumerable.filter.call(this,i,h)):c.filter.call(this,i)},filterProperty:function(h,i){return this.pushStack(SC.Enumerable.filterProperty.call(this,h,i))},indexOf:SC.$.index,map:function(i,h){return(h!==undefined)?SC.Enumerable.map.call(this,i,h):c.map.call(this,i)}};var d=SC.$.fn,a=SC.Enumerable,f;for(var b in a){if(a.hasOwnProperty(b)){f=a[b];if(b in g){c[b]=d[b];f=g[b]}d[b]=f}}})();SC.mixin(SC.$,{isVisible:function(a){var b=SC.$;return("hidden"!=a.type)&&(b.css(a,"display")!="none")&&(b.css(a,"visibility")!="hidden")}});sc_require("system/core_query");SC.Event=function(d){var c,b;if(d){this.originalEvent=d;var h=SC.Event._props,g;b=h.length;c=b;while(--c>=0){g=h[c];this[g]=d[g]}}this.timeStamp=this.timeStamp||Date.now();if(!this.target){this.target=this.srcElement||document}if(this.target.nodeType===3){this.target=this.target.parentNode}if(!this.relatedTarget&&this.fromElement){this.relatedTarget=(this.fromElement===this.target)?this.toElement:this.fromElement}if(SC.none(this.pageX)&&!SC.none(this.clientX)){var i=document.documentElement,a=document.body;this.pageX=this.clientX+(i&&i.scrollLeft||a&&a.scrollLeft||0)-(i.clientLeft||0);this.pageY=this.clientY+(i&&i.scrollTop||a&&a.scrollTop||0)-(i.clientTop||0)}if(!this.which&&((this.charCode||d.charCode===0)?this.charCode:this.keyCode)){this.which=this.charCode||this.keyCode}if(!this.metaKey&&this.ctrlKey){this.metaKey=this.ctrlKey}if(!this.which&&this.button){this.which=((this.button&1)?1:((this.button&2)?3:((this.button&4)?2:0)))}if(this.type==="mousewheel"||this.type==="DOMMouseScroll"||this.type==="MozMousePixelScroll"){var f=SC.Event.MOUSE_WHEEL_MULTIPLIER;if(SC.browser.isWebkit&&d.wheelDelta!==undefined){this.wheelDelta=0-(d.wheelDeltaY||d.wheelDeltaX);this.wheelDeltaY=0-(d.wheelDeltaY||0);this.wheelDeltaX=0-(d.wheelDeltaX||0)}else{if(!SC.none(d.detail)&&SC.browser.isMozilla){if(d.axis&&(d.axis===d.HORIZONTAL_AXIS)){this.wheelDeltaX=d.detail;this.wheelDeltaY=this.wheelDelta=0}else{this.wheelDeltaY=this.wheelDelta=d.detail;this.wheelDeltaX=0}}else{this.wheelDelta=this.wheelDeltaY=SC.browser.isIE||SC.browser.isOpera?0-d.wheelDelta:d.wheelDelta;this.wheelDeltaX=0}}this.wheelDelta*=f;this.wheelDeltaX*=f;this.wheelDeltaY*=f}return this};SC.mixin(SC.Event,{MOUSE_WHEEL_MULTIPLIER:function(){var b=1,a=SC.browser.engineVersion;if(SC.browser.name===SC.BROWSER.safari){b=0.4;if(SC.browser.compare(a,"533.17")>0&&SC.browser.compare(a,"534")<0){b=0.004}else{if(SC.browser.compare(a,"533")<0){b=40}}}else{if(SC.browser.name===SC.BROWSER.ie){b=0.3}else{if(SC.browser.name===SC.BROWSER.chrome){b=0.4}}}return b}(),MOUSE_WHEEL_DELTA_LIMIT:1000,_MOUSE_WHEEL_LIMIT_INVALIDATED:NO,create:function(a){return new SC.Event(a)},add:function(g,f,h,i,d,a){if(g&&g.isCoreQuery){if(g.length>0){g.forEach(function(j){this.add(j,f,h,i,d)},this);return this}else{g=g[0]}}if(!g){return this}if(!a){a=NO}if(g.nodeType===3||g.nodeType===8){return SC.Event}if(SC.browser.name===SC.BROWSER.ie&&g.setInterval){g=window}if(SC.typeOf(h)===SC.T_FUNCTION){d=i;i=h;h=null}else{if(h&&SC.typeOf(i)===SC.T_STRING){i=h[i]}}var c=SC.data(g,"sc_events")||SC.data(g,"sc_events",{}),b=c[f];if(!b){b=c[f]={};this._addEventListener(g,f,a)}b[SC.hashFor(h,i)]=[h,i,d];SC.Event._global[f]=YES;g=c=b=null;return this},remove:function(g,f,h,i){if(g&&g.isCoreQuery){if(g.length>0){g.forEach(function(j){this.remove(j,f,h,i)},this);return this}else{g=g[0]}}if(!g){return this}if(g.nodeType===3||g.nodeType===8){return SC.Event}var a,d,c=SC.data(g,"sc_events");if(!c){return this}if(f===undefined){for(f in c){this.remove(g,f)}}else{if(a=c[f]){var b=NO;if(h||i){if(SC.typeOf(h)===SC.T_FUNCTION){i=h;h=null}else{if(SC.typeOf(i)===SC.T_STRING){i=h[i]}}delete a[SC.hashFor(h,i)];d=null;for(d in a){break}if(d===null){b=YES}}else{b=YES}if(b){delete c[f];this._removeEventListener(g,f)}d=null;for(d in c){break}if(!d){SC.removeData(g,"sc_events");delete this._elements[SC.guidFor(g)]}}}g=c=a=null;return this},NO_BUBBLE:["blur","focus","change"],simulateEvent:function(d,c,b){var a=SC.Event.create({type:c,target:d,preventDefault:function(){this.cancelled=YES},stopPropagation:function(){this.bubbles=NO},allowDefault:function(){this.hasCustomEventHandling=YES},timeStamp:Date.now(),bubbles:(this.NO_BUBBLE.indexOf(c)<0),cancelled:NO,normalized:YES});if(b){SC.mixin(a,b)}return a},trigger:function(c,b,i,j){if(c&&c.isCoreQuery){if(c.length>0){c.forEach(function(m){this.trigger(m,b,i,j)},this);return this}else{c=c[0]}}if(!c){return this}if(c.nodeType===3||c.nodeType===8){return undefined}i=SC.A(i);var h,k=SC.typeOf(c[b]||null)===SC.T_FUNCTION,a,g,d,l;a=i[0];if(!a||!a.preventDefault){a=this.simulateEvent(c,b);i.unshift(a)}a.type=b;g=c;do{h=SC.Event.handle.apply(g,i);g=(g===document)?null:(g.parentNode||document)}while(!h&&a.bubbles&&g);g=null;d=c["on"+b];l=SC.$.nodeName(c,"a")&&b==="click";if((!k||l)&&d&&d.apply(c,i)===NO){h=NO}if(k&&j!==NO&&h!==NO&&!l){this.triggered=YES;try{c[b]()}catch(f){}}this.triggered=NO;return h},handle:function(b){if((typeof SC==="undefined")||SC.Event.triggered){return YES}var c,h,f,j,d,i,k,l,a,g;i=SC.A(arguments);i[0]=b=SC.Event.normalizeEvent(b||window.event);d=(SC.data(this,"sc_events")||{})[b.type];if(!d){return NO}for(k in d){l=d[k];a=l[1];b.handler=a;b.data=b.context=l[2];g=l[0]||this;h=a.apply(g,i);if(c!==NO){c=h}if(h===NO){b.preventDefault();b.stopPropagation()}}return c},unload:function(){var a,b=this._elements;for(a in b){this.remove(b[a])}for(a in b){delete b[a]}delete this._elements},special:{ready:{setup:function(){SC._bindReady();return},teardown:function(){return}},mouseenter:{setup:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.add(this,"mouseover",SC.Event.special.mouseenter.handler);return YES},teardown:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.remove(this,"mouseover",SC.Event.special.mouseenter.handler);return YES},handler:function(a){if(SC.Event._withinElement(a,this)){return YES}a.type="mouseenter";return SC.Event.handle.apply(this,arguments)}},mouseleave:{setup:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.add(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},teardown:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.remove(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},handler:function(a){if(SC.Event._withinElement(a,this)){return YES}a.type="mouseleave";return SC.Event.handle.apply(this,arguments)}}},KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,_withinElement:function(d,c){var b=d.relatedTarget;while(b&&b!==c){try{b=b.parentNode}catch(a){b=c}}return b===c},_addEventListener:function(f,d,a){var g,c=this.special[d];if(!a){a=NO}if(!c||c.setup.call(f)===NO){var b=SC.guidFor(f);this._elements[b]=f;g=SC.data(f,"listener")||SC.data(f,"listener",function(){return SC.Event.handle.apply(SC.Event._elements[b],arguments)});if(f.addEventListener){f.addEventListener(d,g,a)}else{if(f.attachEvent){f.attachEvent("on"+d,g)}}}f=c=g=null},_removeEventListener:function(c,b){var d,a=SC.Event.special[b];if(!a||(a.teardown.call(c)===NO)){d=SC.data(c,"listener");if(d){if(c.removeEventListener){c.removeEventListener(b,d,NO)}else{if(c.detachEvent){c.detachEvent("on"+b,d)}}}}c=a=d=null},_elements:{},normalizeEvent:function(a){if(a===window.event){return SC.Event.create(a)}else{return a.normalized?a:SC.Event.create(a)}},_global:{},_props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view which touches targetTouches changedTouches animationName elapsedTime dataTransfer".split(" ")});SC.Event.prototype={hasCustomEventHandling:NO,touchesForView:function(a){if(this.touchContext){return this.touchContext.touchesForView(a)}},touchesForResponder:function(a){if(this.touchContext){return this.touchContext.touchesForView(a)}},averagedTouchesForView:function(a){if(this.touchContext){return this.touchContext.averagedTouchesForView(a)}return null},allowDefault:function(){this.hasCustomEventHandling=YES;return this},preventDefault:function(){var a=this.originalEvent;if(a){if(a.preventDefault){a.preventDefault()}a.returnValue=NO}this.hasCustomEventHandling=YES;return this},stopPropagation:function(){var a=this.originalEvent;if(a){if(a.stopPropagation){a.stopPropagation()}a.cancelBubble=YES}this.hasCustomEventHandling=YES;return this},stop:function(){return this.preventDefault().stopPropagation()},normalized:YES,getCharString:function(){if(SC.browser.name===SC.BROWSER.ie&&SC.browser.compare(SC.browser.version,"9.0")<0){if(this.keyCode==8||this.keyCode==9||(this.keyCode>=37&&this.keyCode<=40)){return String.fromCharCode(0)}else{return(this.keyCode>0)?String.fromCharCode(this.keyCode):null}}else{return(this.charCode>0)?String.fromCharCode(this.charCode):null}},commandCodes:function(){var f=this.keyCode,b=null,c=null,a="",d;if(f&&f!==this.charCode){b=SC.FUNCTION_KEYS[f];if(!b&&(this.altKey||this.ctrlKey||this.metaKey)){b=SC.PRINTABLE_KEYS[f]}if(b){if(this.altKey){a+="alt_"}if(this.ctrlKey||this.metaKey){a+="ctrl_"}if(this.shiftKey){a+="shift_"}}}if(!b){f=this.which;c=b=String.fromCharCode(f);d=b.toLowerCase();if(this.metaKey){a="meta_";b=d}else{b=null}}if(b){b=a+b}return[b,c]}};SC.Event.observe=SC.Event.add;SC.Event.stopObserving=SC.Event.remove;SC.Event.fire=SC.Event.trigger;if(SC.browser.name===SC.BROWSER.ie){SC.Event.add(window,"unload",SC.Event.prototype,SC.Event.unload)}SC.MODIFIER_KEYS={16:"shift",17:"ctrl",18:"alt"};SC.FUNCTION_KEYS={8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"};SC.PRINTABLE_KEYS={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'};SC.SYSTEM_CURSOR="default";SC.AUTO_CURSOR=SC.DEFAULT_CURSOR="auto";SC.CROSSHAIR_CURSOR="crosshair";SC.HAND_CURSOR=SC.POINTER_CURSOR="pointer";SC.MOVE_CURSOR="move";SC.E_RESIZE_CURSOR="e-resize";SC.NE_RESIZE_CURSOR="ne-resize";SC.NW_RESIZE_CURSOR="nw-resize";SC.N_RESIZE_CURSOR="n-resize";SC.SE_RESIZE_CURSOR="se-resize";SC.SW_RESIZE_CURSOR="sw-resize";SC.S_RESIZE_CURSOR="s-resize";SC.W_RESIZE_CURSOR="w-resize";SC.IBEAM_CURSOR=SC.TEXT_CURSOR="text";SC.WAIT_CURSOR="wait";SC.HELP_CURSOR="help";SC.Cursor=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("cursorStyle")||SC.DEFAULT_CURSOR,c=this.constructor.sharedStyleSheet(),b=SC.guidFor(this);if(c.insertRule){c.insertRule("."+b+" {cursor: "+a+";}",c.cssRules?c.cssRules.length:0)}else{if(c.addRule){c.addRule("."+b,"cursor: "+a)}}this.cursorStyle=a;this.className=b;return this},className:null,cursorStyle:SC.DEFAULT_CURSOR,cursorStyleDidChange:function(){var d,g,c,f,h,b,a;d=this.get("cursorStyle")||SC.DEFAULT_CURSOR;g=this._rule;if(g){g.style.cursor=d;return}c="."+this.get("className");f=this.constructor.sharedStyleSheet();h=(f.cssRules?f.cssRules:f.rules)||[];for(b=0,a=h.length;b<a;++b){g=h[b];if(g.selectorText===c){this._rule=g;g.style.cursor=d;break}}}.observes("cursorStyle")});SC.Cursor.sharedStyleSheet=function(){var b,a=this._styleSheet;if(!a){a=document.createElement("style");a.type="text/css";b=document.getElementsByTagName("head")[0];if(!b){b=document.documentElement}b.appendChild(a);a=document.styleSheets[document.styleSheets.length-1];this._styleSheet=a}return a};SC.Theme={isTheme:YES,classNames:SC.CoreSet.create(),_extend_class_names:function(b){if(b){if(SC.typeOf(b)===SC.T_HASH&&!b.isSet){for(var a in b){if(b[a]){this.classNames.add(a)}else{this.classNames.remove(a)}}}else{if(typeof b==="string"){this.classNames.addEach(b.split(" "))}else{this.classNames.addEach(b)}}}},_extend_self:function(b){if(b.classNames){this._extend_class_names(b.classNames)}var a,c,d;for(a in b){if(a==="classNames"){continue}if(!b.hasOwnProperty(a)){continue}c=b[a];if(c instanceof Function&&!c.base&&(c!==(d=this[a]))){c.base=d}this[a]=c}},create:function(){var c=SC.beget(this);c.baseTheme=this;if(this.themes===SC.Theme.themes){c.themes={}}else{c.themes=SC.beget(this.themes)}c._privateThemes={};c._specializedThemes={};c.classNames=SC.clone(this.classNames);var f=arguments,b=f.length,a,d;for(a=0;a<b;a++){c._extend_self(f[a])}if(c.name){c.classNames.add(c.name)}return c},subtheme:function(a){var b=this.create({name:a});this.addTheme(b);return b},invisibleSubtheme:function(a){var b=this.create({name:a});this._privateThemes[a]=b;return b},themes:{},find:function(a){if(this===SC.Theme){return this.themes[a]}var b;b=this._privateThemes[a];if(b){return b}b=this._specializedThemes[a];if(b){return b}b=this.themes[a];if(b&&!this._specializedThemes[a]){return(this._specializedThemes[a]=b.create({classNames:this.classNames}))}b=SC.Theme.themes[a];if(b){return b}return null},addTheme:function(a){this.themes[a.name]=a}};SC.BaseTheme=SC.Theme.create({name:""});SC.Theme.themes["sc-base"]=SC.BaseTheme;SC.defaultTheme="sc-base";sc_require("mixins/delegate_support");SC.CoreView=SC.Responder.extend(SC.DelegateSupport);sc_require("system/browser");sc_require("system/event");sc_require("system/cursor");sc_require("system/responder");sc_require("system/theme");sc_require("system/string");sc_require("views/view/base");SC.CONTEXT_MENU_ENABLED=YES;SC.TABBING_ONLY_INSIDE_DOCUMENT=NO;SC.FROM_THEME="__FROM_THEME__";SC.EMPTY_CHILD_VIEWS_ARRAY=[];SC.EMPTY_CHILD_VIEWS_ARRAY.needsClone=YES;SC.CoreView.reopen({concatenatedProperties:["outlets","displayProperties","classNames","renderMixin","didCreateLayerMixin","willDestroyLayerMixin","classNameBindings","attributeBindings"],ariaRole:null,ariaHidden:null,pane:function(){var a=this;while(a&&!a.isPane){a=a.get("parentView")}return a}.property("parentView").cacheable(),page:null,parentView:null,isVisible:YES,isVisibleBindingDefault:SC.Binding.bool(),isVisibleInWindow:YES,childViews:SC.EMPTY_CHILD_VIEWS_ARRAY,layer:function(a,c){if(c!==undefined){this._view_layer=c}else{c=this._view_layer;if(!c){var b=this.get("parentView");if(b){b=b.get("layer")}this._view_layer=c=this.findLayerInParentLayer(b)}}return c}.property("isVisibleInWindow").cacheable(),$:function(b){var a=this.get("layer");if(!a){return SC.$()}else{if(b===undefined){return SC.$(a)}else{return SC.$(b,a)}}},containerLayer:function(){return this.get("layer")}.property("layer").cacheable(),layerId:function(a,b){if(b){this._layerId=b}if(this._layerId){return this._layerId}return SC.guidFor(this)}.property().cacheable(),findLayerInParentLayer:function(a){var b="#"+this.get("layerId");return jQuery(b,a)[0]||jQuery(b)[0]},isDescendantOf:function(a){var b=this.get("parentView");if(this===a){return YES}else{if(b){return b.isDescendantOf(a)}else{return NO}}},displayDidChange:function(){this.set("layerNeedsUpdate",YES);return this},_sc_isVisibleDidChange:function(){this.displayDidChange()}.observes("isVisible"),layerNeedsUpdate:NO,_view_layerNeedsUpdateDidChange:function(){if(this.get("layerNeedsUpdate")){this.invokeOnce(this.updateLayerIfNeeded)}}.observes("layerNeedsUpdate"),updateLayerIfNeeded:function(b){var c=this.get("layerNeedsUpdate"),a=c&&(b||this.get("isVisibleInWindow"));if(a){if(this.get("layer")){this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);this.updateLayer();this.endPropertyChanges()}}return this},updateLayer:function(g){var c,b,a,d;var f=g||this.renderContext(this.get("layer"));this._renderLayerSettings(f,NO);d=!this.update;if(d){this.render(f,NO)}else{this.update(f.$())}if(c=this.renderMixin){a=c.length;for(b=0;b<a;++b){c[b].call(this,f,NO)}}f.update();if(f._innerHTMLReplaced){var h=this.get("pane");if(h&&h.get("isPaneAttached")){this._notifyDidAppendToDocument()}}if(this.useStaticLayout){this.viewDidResize()}if(this.didUpdateLayer){this.didUpdateLayer()}if(this.designer&&this.designer.viewDidUpdateLayer){this.designer.viewDidUpdateLayer()}return this},parentViewDidResize:function(){if(!this.get("hasLayout")){this.notifyPropertyChange("frame")}this.viewDidResize()},viewDidResize:function(){},renderContext:function(a){return SC.RenderContext(a)},createLayer:function(){if(this.get("layer")){return this}var a=this.renderContext(this.get("tagName"));this.renderToContext(a);this.set("layer",a.element());this._notifyDidCreateLayer();return this},_notifyDidCreateLayer:function(){this.notifyPropertyChange("layer");if(this.get("useStaticLayout")){this.viewDidResize()}if(this.didCreateLayer){this.didCreateLayer()}var c=this.didCreateLayerMixin,b,a,d=this.get("childViews"),f;if(c){b=c.length;for(a=0;a<b;++a){c[a].call(this)}}b=d.length;for(a=0;a<b;++a){f=d[a];if(!f){continue}f.notifyPropertyChange("layer");if(this.get("useStaticLayout")){if(!f.get("isFixedLayout")){f.viewDidResize()}}f._notifyDidCreateLayer()}},destroyLayer:function(){var a=this.get("layer");if(a){this._notifyWillDestroyLayer();if(a.parentNode){a.parentNode.removeChild(a)}a=null}return this},replaceLayer:function(){this.destroyLayer();this.set("layerLocationNeedsUpdate",YES);this.invokeOnce(this.updateLayerLocationIfNeeded)},parentViewDidChange:function(){this.parentViewDidResize();this.updateLayerLocation()},layerLocationNeedsUpdate:NO,updateLayerLocationIfNeeded:function(a){if(this.get("layerLocationNeedsUpdate")){this.updateLayerLocation()}return this},updateLayerLocation:function(){var f=this.get("layer"),d=this.get("parentView"),b=d?d.get("containerLayer"):null;if(f&&f.parentNode&&f.parentNode!==b){f.parentNode.removeChild(f)}if(!d){if(f&&f.parentNode){f.parentNode.removeChild(f)}}else{if(!b){if(f){if(f.parentNode){f.parentNode.removeChild(f)}this.destroyLayer()}}else{if(!f){this.createLayer();f=this.get("layer");if(!f){return}}var g=d.get("childViews"),c=g.objectAt(g.indexOf(this)+1),a=(c)?c.get("layer"):null;if(c&&(!a||a.parentNode!==b)){c.updateLayerLocationIfNeeded();a=c.get("layer")||null}if((f.parentNode!==b)||(f.nextSibling!==a)){b.insertBefore(f,a)}}}b=d=f=a=null;this.set("layerLocationNeedsUpdate",NO);return this},_notifyWillDestroyLayer:function(){if(this.willDestroyLayer){this.willDestroyLayer()}var c=this.willDestroyLayerMixin,b,a,d=this.get("childViews");if(c){b=c.length;for(a=0;a<b;++a){c[a].call(this)}}b=d.length;for(a=0;a<b;++a){d[a]._notifyWillDestroyLayer()}this.set("layer",null)},renderToContext:function(f,g){var d,c,b,a;this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);if(SC.none(g)){g=YES}this._renderLayerSettings(f,g);d=!this.update;if(d){this.render(f,g)}else{if(g){this.render(f)}else{this.update(f.$())}}if(g&&!this._didRenderChildViews){this.renderChildViews(f,g)}this._didRenderChildViews=NO;if(c=this.renderMixin){a=c.length;for(b=0;b<a;++b){c[b].call(this,f,g)}}this.endPropertyChanges()},_renderLayerSettings:function(a,b){a.resetClassNames();a.resetStyles();this.applyAttributesToContext(a)},applyAttributesToContext:function(a){if(!this.get("layer")){this._applyClassNameBindings();this._applyAttributeBindings(a)}a.addClass(this.get("classNames"));if(this.get("isTextSelectable")){a.addClass("allow-select")}if(!this.get("isVisible")){a.addClass("sc-hidden")}if(this.get("isFirstResponder")){a.addClass("focus")}a.id(this.get("layerId"));a.attr("role",this.get("ariaRole"));var b=this.get("ariaHidden");if(b!==null){if(b===NO){a.removeAttr("aria-hidden")}else{a.attr("aria-hidden",b)}}},_applyClassNameBindings:function(){var a=this.get("classNameBindings"),b=this.get("classNames"),c;if(!a){return}a.forEach(function(g){var f;var d=function(){var i=this._classStringForProperty(g);var h=this.$();if(f){h.removeClass(f);b.removeObject(f)}if(i){h.addClass(i);b.push(i);f=i}else{f=null}};this.addObserver(g.split(":")[0],this,d);c=this._classStringForProperty(g);if(c){b.push(c);f=c}},this)},_applyAttributeBindings:function(a){var f=this.get("attributeBindings"),c,d,b;if(!f){return}f.forEach(function(h){var g=function(){d=this.$();var i=d.attr(h);c=this.get(h);b=typeof c;if((b==="string"||b==="number")&&c!==i){d.attr(h,c)}else{if(c&&b==="boolean"){d.attr(h,h)}else{if(c===NO){d.removeAttr(h)}}}};this.addObserver(h,this,g);c=this.get(h);b=typeof c;if(b==="string"||b==="number"){a.attr(h,c)}else{if(c&&b==="boolean"){a.attr(h,h)}}},this)},_classStringForProperty:function(c){var a=c.split(":"),b=a[1];c=a[0];var d=SC.getPath(this,c);if(d===YES){if(b){return b}return SC.String.dasherize(c.split(".").get("lastObject"))}else{if(d!==NO&&d!==undefined&&d!==null){return d}else{return null}}},prepareContext:function(a,b){if(b!==false){b=YES}if(b){this.renderToContext(a)}else{this.updateLayer(a)}},renderChildViews:function(f,g){var d=this.get("childViews"),b=d.length,a,c;for(a=0;a<b;++a){c=d[a];if(!c){continue}f=f.begin(c.get("tagName"));c.renderToContext(f,g);f=f.end()}this._didRenderChildViews=YES;return f},render:function(){},_notifyDidAppendToDocument:function(){if(!this.get("hasLayout")){this.notifyPropertyChange("frame")}if(this.didAppendToDocument){this.didAppendToDocument()}var c=0,d,a,b=this.get("childViews");for(c=0,a=b.length;c<a;c++){d=b[c];if(d._notifyDidAppendToDocument){d._notifyDidAppendToDocument()}}},childViewsObserver:function(){var c=this.get("childViews"),b,a,d;for(b=0,a=c.length;b<a;b++){d=c[b];if(d._notifyDidAppendToDocument){d._notifyDidAppendToDocument()}}}.observes("childViews"),attributeBindings:null,tagName:"div",classNames:[],classNameBindings:null,toolTip:null,displayToolTip:function(){var a=this.get("toolTip");return(a&&this.get("localize"))?SC.String.loc(a):(a||"")}.property("toolTip","localize").cacheable(),isTextSelectable:NO,displayProperties:["ariaHidden"],nextResponder:function(){return this.get("parentView")}.property("parentView").cacheable(),acceptsFirstResponder:NO,init:function(){var f=this.get("parentView"),h,b,d,g;arguments.callee.base.apply(this,arguments);SC.View.views[this.get("layerId")]=this;this.classNames=this.get("classNames").slice();this.childViews=this.get("childViews").slice();this.createChildViews();g=this.get("displayProperties");for(var c=0,a=g.length;c<a;c++){this.addObserver(g[c],this,this.displayDidChange)}},awake:function(){arguments.callee.base.apply(this,arguments);var c=this.get("childViews"),b=c.length,a;for(a=0;a<b;++a){if(!c[a]){continue}c[a].awake()}},frame:function(){return this.computeFrameWithParentFrame(null)}.property("useStaticLayout").cacheable(),computeFrameWithParentFrame:function(){var a,b=this.get("parentView"),c;if(a=this.get("layer")){c=SC.offset(a);if(b){c=b.convertFrameFromView(c,null)}c.width=a.offsetWidth;c.height=a.offsetHeight;return c}if(this.get("hasLayout")){return null}else{return{x:0,y:0,width:0,height:0}}},clippingFrame:function(){var g=this.get("frame"),a=g,c,d,b;if(!g){return null}c=this.get("parentView");if(c){d=c.get("clippingFrame");if(!d){return{x:0,y:0,width:g.width,height:g.height}}b=c.convertFrameToView(g,null);b.x+=c.get("horizontalScrollOffset")||0;b.y+=c.get("verticalScrollOffset")||0;d=c.convertFrameToView(d,null);a=SC.intersectRects(d,b);a=this.convertFrameFromView(a,null,true)}else{a.x-=g.x;a.y-=g.y}return a}.property("parentView","frame","horizontalScrollOffset","verticalScrollOffset").cacheable(),_sc_view_clippingFrameDidChange:function(){var d=this.get("childViews"),b=d.length,a,c;for(a=0;a<b;++a){c=d[a];c.notifyPropertyChange("clippingFrame");c._sc_view_clippingFrameDidChange()}},removeChild:function(b){b.set("parentView",null);var c=this.get("childViews"),a=c.indexOf(b);if(a>=0){c.removeAt(a)}return this},removeAllChildren:function(){var b=this.get("childViews"),a;while(a=b.objectAt(b.get("length")-1)){this.removeChild(a)}return this},removeFromParent:function(){var a=this.get("parentView");if(a){a.removeChild(this)}return this},destroy:function(){if(this.get("isDestroyed")){return this}this._destroy();return arguments.callee.base.apply(this,arguments)},_destroy:function(){this.destroyLayer();var c=this.get("childViews"),b=c.length,a;if(b){c=c.slice();for(a=0;a<b;++a){c[a].destroy()}}delete SC.View.views[this.get("layerId")];delete this._CQ;delete this.page;if(this.get("parentView")){this.removeFromParent()}this.set("owner",null);return this},createChildViews:function(){var g=this.get("childViews"),b=g.length,a,f,d,c;this.beginPropertyChanges();for(a=0;a<b;++a){if(f=(c=g[a])){if(typeof f===SC.T_STRING){c=this[f]}else{f=null}if(!c){SC.Logger.error("No view with name "+f+" has been found in "+this.toString());continue}c=this.createChildView(c);if(f){this[f]=c}}g[a]=c}this.endPropertyChanges();return this},createChildView:function(a,b){if(!a.isClass){b=a}else{if(!b){b={}}else{b=SC.clone(b)}}b.owner=b.parentView=this;if(a.isClass&&a.prototype.hasVisibility){b.isVisibleInWindow=this.get("isVisibleInWindow")}if(!b.page){b.page=this.page}if(a.isClass){a=a.create(b)}return a},isView:YES,selectStart:function(a){return this.get("isTextSelectable")},contextMenu:function(a){if(this.get("isContextMenuEnabled")){return YES}}});SC.CoreView.mixin({isViewClass:YES,design:function(){if(this.isDesign){return this}var a=this.extend.apply(this,arguments);a.isDesign=YES;if(SC.ViewDesigner){SC.ViewDesigner.didLoadDesign(a,this,SC.A(arguments))}return a},extend:function(){var a=arguments[arguments.length-1];if(a&&!SC.none(a.theme)){a.themeName=a.theme;delete a.theme}return SC.Object.extend.apply(this,arguments)},layout:function(a){this.prototype.layout=a;return this},classNames:function(a){a=(this.prototype.classNames||[]).concat(a);this.prototype.classNames=a;return this},tagName:function(a){this.prototype.tagName=a;return this},childView:function(a){var b=this.prototype.childViews||[];if(b===this.superclass.prototype.childViews){b=b.slice()}b.push(a);this.prototype.childViews=b;return this},bind:function(b,d){var c=this.prototype,a=this.superclass.prototype;var f=c._bindings;if(!f||f===a._bindings){f=c._bindings=(f||[]).slice()}b=b+"Binding";c[b]=d;f.push(b);return this},prop:function(a,b){this.prototype[a]=b;return this},localization:function(b,a){if(a){b.rootElement=SC.$(a)[0]}return b},viewFor:function(d,c){var b=SC.$A(arguments);if(SC.none(d)){b.shift()}else{b[0]={rootElement:SC.$(d)[0]}}var a=this.create.apply(this,arguments);b=b[0]=null;return a},create:function(){var b=arguments[arguments.length-1];if(b&&b.theme){b.themeName=b.theme;delete b.theme}var c=this,a=new c(arguments);if(SC.ViewDesigner){SC.ViewDesigner.didCreateView(a,SC.$A(arguments))}return a},loc:function(f){var b=f.childViews;delete f.childViews;this.applyLocalizedAttributes(f);if(SC.ViewDesigner){SC.ViewDesigner.didLoadLocalization(this,SC.$A(arguments))}var d=this.prototype.childViews,a=d.length,c;while(--a>=0){c=d[a];f=b[a];if(f&&c&&typeof c===SC.T_STRING){SC.String.loc(c,f)}}return this},applyLocalizedAttributes:function(a){SC.mixin(this.prototype,a)},views:{}});SC.outlet=function(b,a){return function(c){return(this[c]=SC.objectForPropertyPath(b,(a!==undefined)?a:this))}.property()};SC.CoreView.unload=function(){var a=SC.View.views;if(a){for(var b in a){if(!a.hasOwnProperty(b)){continue}delete a[b]}}};SC.View=SC.CoreView.extend({classNames:["sc-view"],displayProperties:["isFirstResponder"]});if(SC.browser.isIE){SC.Event.add(window,"unload",SC.View,SC.View.unload)}sc_require("views/view");sc_require("views/view/layout_style");SC.ANIMATABLE_PROPERTIES={top:YES,left:YES,bottom:YES,right:YES,width:YES,height:YES,centerX:YES,centerY:YES,opacity:YES,scale:YES,rotate:YES,rotateX:YES,rotateY:YES,rotateZ:YES};SC.View.reopen({didCreateLayerMixin:function(){if(SC.platform.supportsCSSTransitions){this.resetAnimation()}},animate:function(p,l,d,o){var g,q;if(typeof p===SC.T_STRING){g={};g[p]=l;q=d}else{g=p;q=l;o=d}var c=SC.typeOf(q);if(c===SC.T_NUMBER){q={duration:q}}else{if(c!==SC.T_HASH){throw"Must provide options hash or duration!"}}if(o){q.callback=o}else{if(q.callback){o=q.callback}}if(q.duration===0){var j=this.adjust(g);if(o){this.layoutStyleCalculator.invokeOnceLater("runAnimationCallback",1,o,null,NO)}return j}var a=q.timing;if(a){if(typeof a!==SC.T_STRING){q.timing="cubic-bezier("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}}else{q.timing="linear"}var h=SC.clone(this.get("layout")),i=NO,k,n,b,f,m;if(!h.animate){h.animate={}}for(m in g){if(!g.hasOwnProperty(m)||!SC.ANIMATABLE_PROPERTIES[m]){continue}k=g[m];n=h[m];f=h.animate[m];if(SC.none(k)){throw"Can only animate to an actual value!"}if(n!==k||(f&&f.duration!==q.duration)){i=YES;h.animate[m]=q;h[m]=k}}if(i){this.set("layout",h)}else{if(o){this.layoutStyleCalculator.invokeOnceLater("runAnimationCallback",1,o,null,NO)}}return this},resetAnimation:function(){var c=this.get("layout"),f=c.animate,d=NO,b;if(!f){return}var a;for(b in f){d=YES;delete f[b]}if(d){this.set("layout",c);this.notifyPropertyChange("layout")}return this},transitionDidEnd:function(a){this.get("layoutStyleCalculator").transitionDidEnd(a)}});sc_require("ext/string");sc_require("views/view");sc_require("views/view/animation");SC.CSS_TRANSFORM_MAP={rotate:function(a){return null},rotateX:function(a){if(SC.typeOf(a)===SC.T_NUMBER){a+="deg"}return"rotateX("+a+")"},rotateY:function(a){if(SC.typeOf(a)===SC.T_NUMBER){a+="deg"}return"rotateY("+a+")"},rotateZ:function(a){if(SC.typeOf(a)===SC.T_NUMBER){a+="deg"}return"rotateZ("+a+")"},scale:function(a){if(SC.typeOf(a)===SC.T_ARRAY){a=a.join(", ")}return"scale("+a+")"}};SC.View.reopen({layoutStyleCalculator:null,layoutStyle:function(){var a={layout:this.get("layout"),turbo:this.get("hasAcceleratedLayer"),staticLayout:this.get("useStaticLayout")};var b=this.get("layoutStyleCalculator");b.set(a);return b.calculate()}.property().cacheable()});SC.View.LayoutStyleCalculator=SC.Object.extend({_layoutDidUpdate:function(){var h=this.get("layout");if(!h){return}this.dims=SC._VIEW_DEFAULT_DIMS;this.loc=this.dims.length;var o=(this.right=h.right);this.hasRight=(o!=null);var c=(this.left=h.left);this.hasLeft=(c!=null);var k=(this.top=h.top);this.hasTop=(k!=null);var a=(this.bottom=h.bottom);this.hasBottom=(a!=null);var b=(this.width=h.width);this.hasWidth=(b!=null);var p=(this.height=h.height);this.hasHeight=(p!=null);this.minWidth=((h.minWidth===undefined)?null:h.minWidth);var n=(this.maxWidth=(h.maxWidth===undefined)?null:h.maxWidth);this.hasMaxWidth=(n!=null);this.minHeight=(h.minHeight===undefined)?null:h.minHeight;var m=(this.maxHeight=(h.maxHeight===undefined)?null:h.maxHeight);this.hasMaxHeight=(m!=null);var g=(this.centerX=h.centerX);this.hasCenterX=(g!=null);var f=(this.centerY=h.centerY);this.hasCenterY=(f!=null);var d=(this.borderTop=((h.borderTop!==undefined)?h.borderTop:h.border)||0);var l=(this.borderRight=((h.borderRight!==undefined)?h.borderRight:h.border)||0);var j=(this.borderBottom=((h.borderBottom!==undefined)?h.borderBottom:h.border)||0);var i=(this.borderLeft=((h.borderLeft!==undefined)?h.borderLeft:h.border)||0);this.zIndex=(h.zIndex!=null)?h.zIndex.toString():null;this.opacity=(h.opacity!=null)?h.opacity.toString():null;this.backgroundPosition=(h.backgroundPosition!=null)?h.backgroundPosition:null;this.ret={marginTop:null,marginLeft:null}}.observes("layout"),_invalidAutoValue:function(b){var a=SC.Error.desc("%@.layout() you cannot use %@:auto if staticLayout is disabled".fmt(this.get("view"),b),"%@".fmt(this.get("view")),-1);SC.Logger.error(a.toString());throw a},_handleMistakes:function(){var c=this.get("layout");if(!this.staticLayout){if(this.width===SC.LAYOUT_AUTO){this._invalidAutoValue("width")}if(this.height===SC.LAYOUT_AUTO){this._invalidAutoValue("height")}}if(SC.platform.supportsCSSTransforms){var d=c.animate,a,b;if(d){for(b in d){if(SC.CSS_TRANSFORM_MAP[b]){if(this._pendingAnimations&&this._pendingAnimations["-"+SC.platform.cssPrefix+"-transform"]){throw"Animations of transforms must be executed simultaneously!"}if(a&&d[b].duration!==a){SC.Logger.warn("Can't animate transforms with different durations! Using first duration specified.");d[b].duration=a}a=d[b].duration}}}}},_calculatePosition:function(o){var h=null,a=this.get("turbo"),s=this.ret;var d,l,k,c,j,n,b,g,f,m,r,i,p,q;if(o==="x"){d="left";l="right";k="width";c="maxWidth";j="marginLeft";m="borderLeft";i="borderRight";n=this.hasLeft;b=this.hasRight;g=this.hasWidth;f=this.hasMaxWidth}else{d="top";l="bottom";k="height";c="maxHeight";j="marginTop";m="borderTop";i="borderBottom";n=this.hasTop;b=this.hasBottom;g=this.hasHeight;f=this.hasMaxHeight}s[d]=this._cssNumber(this[d]);s[l]=this._cssNumber(this[l]);r=this._cssNumber(this[m]);p=this._cssNumber(this[i]);s[m+"Width"]=r||null;s[i+"Width"]=p||null;q=this[k];if(q>=1){q-=(r+p)}s[k]=this._cssNumber(q);if(n){if(a){h=s[d];s[d]=0}if(b&&g){s[l]=null}}else{if(!b||(b&&!g&&!f)){s[d]=0}}if(!g&&!b){s[l]=0}return h},_calculateCenter:function(o){var j=this.ret,r,a,c,p,g,h,m,n,f;if(o==="x"){r="width";a="centerX";c="left";p="right";g="marginLeft";h="borderLeft";n="borderRight"}else{r="height";a="centerY";c="top";p="bottom";g="marginTop";h="borderTop";n="borderBottom"}j[c]="50%";m=this._cssNumber(this[h]);f=this._cssNumber(this[n]);j[h+"Width"]=m||null;j[n+"Width"]=f||null;var l=this[r],k=this[a],b=this[c];var i=SC.isPercentage(l),d=SC.isPercentage(k,YES);if(l>1){l-=(m+f)}if((i&&d)||(!i&&!d)){var q=k-l/2;j[g]=(i)?Math.floor(q*100)+"%":Math.floor(q)}else{SC.Logger.warn("You have to set "+r+" and "+a+" using both percentages or pixels");j[g]="50%"}j[r]=this._cssNumber(l)||0;j[p]=null},_calculateTransforms:function(f,i){if(SC.platform.supportsCSSTransforms){var h=this.get("layout");var b=SC.platform.domCSSPrefix+"Transform";var d=[];if(this.turbo){d.push("translateX("+(f||0)+"px)","translateY("+(i||0)+"px)");if(SC.platform.supportsCSS3DTransforms){d.push("translateZ(0px)")}}var g=SC.CSS_TRANSFORM_MAP;for(var a in g){var c=h[a];if(c!=null){d.push(g[a](c))}}this.ret[b]=d.length>0?d.join(" "):null}},_calculateAnimations:function(f,c){var d=this.layout,i=d.animate,h;if(!i){return}if(this.getPath("view.isAnimatable")){return}var g=[],b;this._animatedTransforms=[];if(!this._pendingAnimations){this._pendingAnimations={}}var j="-"+SC.platform.cssPrefix+"-transform";if(SC.platform.supportsCSSTransitions){for(h in i){b=i[h];var k=SC.CSS_TRANSFORM_MAP[h];var a=(h==="top"&&c!=null)||(h==="left"&&f!=null);if(SC.platform.supportsCSSTransforms&&(a||k)){this._animatedTransforms.push(h);h=j}b.css=h+" "+b.duration+"s "+b.timing;if(!this._pendingAnimations[h]){this._pendingAnimations[h]=b;g.push(b.css)}}this.ret[SC.platform.domCSSPrefix+"Transition"]=g.join(", ")}else{for(h in i){this._pendingAnimations[h]=i[h]}}delete d.animate},_cssNumber:function(a){if(a==null){return null}else{if(a===SC.LAYOUT_AUTO){return SC.LAYOUT_AUTO}else{if(SC.isPercentage(a)){return(a*100)+"%"}else{return Math.floor(a)}}}},calculate:function(){var d=this.get("layout"),b=null,m=this.get("staticLayout"),c=null,f=null,a=this.get("turbo"),h=this.ret,k=this.dims,g=this.loc,i=this.get("view"),l,j;this._handleMistakes(d);if(m&&d===SC.View.prototype.layout){return{}}if(this.hasLeft||this.hasRight||!this.hasCenterX){f=this._calculatePosition("x")}else{this._calculateCenter("x")}if(this.hasTop||this.hasBottom||!this.hasCenterY){c=this._calculatePosition("y")}else{this._calculateCenter("y")}h.minWidth=this.minWidth;h.maxWidth=this.maxWidth;h.minHeight=this.minHeight;h.maxHeight=this.maxHeight;h.zIndex=this.zIndex;h.opacity=this.opacity;h.backgroundPosition=this.backgroundPosition;this._calculateTransforms(f,c);this._calculateAnimations(f,c);for(l in h){j=h[l];if(typeof j===SC.T_NUMBER){h[l]=(j+"px")}}return h},willRenderAnimations:function(){if(SC.platform.supportsCSSTransitions){var i=this.get("view"),g=i.get("layer"),a=g?g.style:null,b=i.get("layoutStyle"),m=this._activeAnimations,c,f=this._pendingAnimations,d,o=this._animatedTransforms,h=o?o.length:0,l,p=[],n,k,j;if(f){if(!m){m={}}for(l in f){if(!f.hasOwnProperty(l)){continue}d=f[l];c=m[l];j=NO;if(b[l]!==(a?a[l]:null)){j=YES}if(c&&(c.duration!==d.duration||c.timing!==d.timing)){j=YES}if(j&&c){if(n=c.callback){if(h>0){this.runAnimationCallback(n,null,YES);this._animatedTransforms=null}else{this.runAnimationCallback(n,null,YES)}}this.removeAnimationFromLayout(l,YES)}m[l]=d;p.push(l)}if(!this._groupedAnimations){this._groupedAnimations={}}this._groupedAnimations[l]=p;this._activeAnimations=m;this._pendingAnimations=null}}},didRenderAnimations:function(){if(!SC.platform.supportsCSSTransitions){var a,b;for(a in this._pendingAnimations){b=this._pendingAnimations[a].callback;if(b){this.invokeOnceLater("runAnimationCallback",1,b,null,NO)}this.removeAnimationFromLayout(a,NO,YES)}this._activeAnimations=this._pendingAnimations=null}},runAnimationCallback:function(d,b,c){var a=this.get("view");if(d){if(SC.typeOf(d)!==SC.T_HASH){d={action:d}}d.source=a;if(!d.target){d.target=this}}SC.View.runCallback(d,{event:b,view:a,isCancelled:c})},transitionDidEnd:function(c){var f=c.originalEvent.propertyName,d,j,b;j=this._activeAnimations?this._activeAnimations[f]:null;if(j){if(j.callback){this.invokeOnceLater("runAnimationCallback",1,j.callback,c,NO)}this.removeAnimationFromLayout(f,YES);var h;d=this._groupedAnimations&&this._groupedAnimations[f];if(d){for(var g=0,a=d.length;g<a;g++){h=d[g];delete this._activeAnimations[h]}delete this._groupedAnimations[f]}}},removeAnimationFromLayout:function(c,i,b){if(i){var f=this.getPath("view.layer"),h=[],d;for(d in this._activeAnimations){if(d!==c){h.push(this._activeAnimations[d].css)}}if(f){f.style[SC.platform.domCSSPrefix+"Transition"]=h.join(", ")}}var g=this.getPath("view.layout"),a;if(c==="-"+SC.platform.cssPrefix+"-transform"&&this._animatedTransforms&&this._animatedTransforms.length>0){for(a=0;a<this._animatedTransforms.length;a++){delete g["animate"+SC.String.capitalize(this._animatedTransforms[a])]}this._animatedTransforms=null}delete g["animate"+SC.String.capitalize(c)]}});SC.CoreView.runCallback=function(h){var b=SC.$A(arguments).slice(1),a=SC.typeOf(h.action);if(a==SC.T_FUNCTION){h.action.apply(h.target,b)}else{if(a===SC.T_STRING){if(h.action.indexOf(".")>=0){var g=h.action.split(".");var d=g.pop();var f=SC.objectForPropertyPath(g,window);var c=f.get?f.get(d):f[d];if(c&&SC.typeOf(c)==SC.T_FUNCTION){c.apply(f,b)}else{throw"SC.runCallback could not find a function at %@".fmt(h.action)}}}}};SC.View.runCallback=SC.CoreView.runCallback;sc_require("views/view");sc_require("views/view/layout_style");SC.LAYOUT_HORIZONTAL="sc-layout-horizontal";SC.LAYOUT_VERTICAL="sc-layout-vertical";SC._VIEW_DEFAULT_DIMS=["marginTop","marginLeft"];SC.FULL_WIDTH={left:0,right:0};SC.FULL_HEIGHT={top:0,bottom:0};SC.ANCHOR_CENTER={centerX:0,centerY:0};SC.LAYOUT_AUTO="auto";SC.View.reopen({hasLayout:YES,concatenatedProperties:["layoutProperties"],backgroundColor:null,displayProperties:["backgroundColor"],useStaticLayout:NO,init:function(a){a();this.layoutStyleCalculator=SC.View.LayoutStyleCalculator.create({view:this});this._previousLayout=this.get("layout")}.enhance(),propertyDidChange:function(b,d,c){var a=false;if(typeof this.layout==="function"&&this._kvo_dependents){var f=this._kvo_dependents[b];if(f&&f.indexOf("layout")!=-1){a=true}}if(b==="layout"||a){this.layoutDidChange()}arguments.callee.base.apply(this,arguments)},adjust:function(a,d){var b=this.get("layout"),c=NO,g,f;if(a===undefined){return this}if(SC.typeOf(a)===SC.T_STRING){g=b[a];if(d===undefined||g==d){return this}b=SC.clone(b);if(d===null){delete b[a]}else{b[a]=d}c=YES}else{f=a;for(a in f){if(!f.hasOwnProperty(a)){continue}d=f[a];g=b[a];if(d===undefined||g==d){continue}if(!c){b=SC.clone(b)}if(d===null){delete b[a]}else{b[a]=d}c=YES}}if(c){this.set("layout",b)}return this},layout:{top:0,left:0,bottom:0,right:0},isFixedLayout:function(){return this.get("isFixedPosition")&&this.get("isFixedSize")}.property("isFixedPosition","isFixedSize").cacheable(),isFixedPosition:function(){var b=this.get("layout"),a;a=(((b.left!==undefined)&&(b.top!==undefined))&&((b.left!==SC.LAYOUT_AUTO)&&(b.top!==SC.LAYOUT_AUTO)));if(a){a=(!SC.isPercentage(b.top)&&!SC.isPercentage(b.left))}return a}.property("layout").cacheable(),isFixedSize:function(){var b=this.get("layout"),a;a=(((b.width!==undefined)&&(b.height!==undefined))&&((b.width!==SC.LAYOUT_AUTO)&&(b.height!==SC.LAYOUT_AUTO)));if(a){a=(!SC.isPercentage(b.width)&&!SC.isPercentage(b.height))}return a}.property("layout").cacheable(),convertFrameToView:function(j,d){var c=0,b=0,h=0,g=0,a=this,i;while(a){i=a.get("frame");c+=i.x;b+=i.y;c-=a.get("horizontalScrollOffset")||0;b-=a.get("verticalScrollOffset")||0;a=a.get("layoutView")}if(d){a=d;while(a){i=a.get("frame");h+=i.x;g+=i.y;h-=a.get("horizontalScrollOffset")||0;g-=a.get("verticalScrollOffset")||0;a=a.get("layoutView")}}c=j.x+c-h;b=j.y+b-g;return{x:c,y:b,width:j.width,height:j.height}},convertFrameFromView:function(b,a,k){var j=0,h=0,g=0,d=0,i=this,c;while(i&&(c=i.get("frame"))){j+=c.x;h+=c.y;if(k){j-=i.get("horizontalScrollOffset")||0;h-=i.get("verticalScrollOffset")||0}i=i.get("parentView")}if(a){i=a;while(i){c=i.get("frame");g+=c.x;d+=c.y;if(k){g-=i.get("horizontalScrollOffset")||0;d-=i.get("verticalScrollOffset")||0}i=i.get("parentView")}}j=b.x-j+g;h=b.y-h+d;return{x:j,y:h,width:b.width,height:b.height}},scrollToVisible:function(){var a=this.get("parentView");while(a&&!a.get("isScrollable")){a=a.get("parentView")}if(a){a.scrollToVisible();return a.scrollToVisible(this)}else{return NO}},_adjustForBorder:function(f,c){var g=((c.borderTop!==undefined)?c.borderTop:c.border)||0,d=((c.borderLeft!==undefined)?c.borderLeft:c.border)||0,b=((c.borderBottom!==undefined)?c.borderBottom:c.border)||0,a=((c.borderRight!==undefined)?c.borderRight:c.border)||0;f.x+=d;f.y+=g;f.width-=(d+a);f.height-=(g+b);return f},computeFrameWithParentFrame:function(n,h){var p,q=this.get("layout");if(this.get("useStaticLayout")){p=n();return p?this._adjustForBorder(p,q):null}else{p={}}var o,t,m=SC.LAYOUT_AUTO,l=this.get("parentView"),i,c,a=q.right,b=q.left,s=q.top,g=q.bottom,r=q.width,d=q.height,k=q.centerX,j=q.centerY;if(r===m){o=SC.Error.desc(("%@.layout() cannot use width:auto if staticLayout is disabled").fmt(this),"%@".fmt(this),-1);SC.Logger.error(o.toString());throw o}if(d===m){o=SC.Error.desc(("%@.layout() cannot use height:auto if staticLayout is disabled").fmt(this),"%@".fmt(this),-1);SC.Logger.error(o.toString());throw o}if(!h){h=this.computeParentDimensions(q)}i=h.height;c=h.width;if(!SC.none(b)){if(SC.isPercentage(b)){p.x=c*b}else{p.x=b}if(r!==undefined){if(r===m){p.width=m}else{if(SC.isPercentage(r)){p.width=c*r}else{p.width=r}}}else{p.width=c-p.x;if(a&&SC.isPercentage(a)){p.width=p.width-(a*c)}else{p.width=p.width-(a||0)}}}else{if(!SC.none(a)){if(SC.none(r)){if(SC.isPercentage(a)){p.width=c-(c*a)}else{p.width=c-a}p.x=0}else{if(r===m){p.width=m}else{if(SC.isPercentage(r)){p.width=c*r}else{p.width=(r||0)}}if(SC.isPercentage(r)){p.x=c-(a*c)-p.width}else{p.x=c-a-p.width}}}else{if(!SC.none(k)){if(r===m){p.width=m}else{if(SC.isPercentage(r)){p.width=r*c}else{p.width=(r||0)}}if(SC.isPercentage(k)){p.x=(c-p.width)/2+(k*c)}else{p.x=(c-p.width)/2+k}}else{p.x=0;if(SC.none(r)){p.width=c}else{if(r===m){p.width=m}if(SC.isPercentage(r)){p.width=r*c}else{p.width=(r||0)}}}}}if(!SC.none(s)){if(SC.isPercentage(s)){p.y=s*i}else{p.y=s}if(d!==undefined){if(d===m){p.height=m}else{if(SC.isPercentage(d)){p.height=d*i}else{p.height=d}}}else{if(g&&SC.isPercentage(g)){p.height=i-p.y-(g*i)}else{p.height=i-p.y-(g||0)}}}else{if(!SC.none(g)){if(SC.none(d)){if(SC.isPercentage(g)){p.height=i-(g*i)}else{p.height=i-g}p.y=0}else{if(d===m){p.height=m}if(d&&SC.isPercentage(d)){p.height=d*i}else{p.height=(d||0)}if(SC.isPercentage(g)){p.y=i-(g*i)-p.height}else{p.y=i-g-p.height}}}else{if(!SC.none(j)){if(d===m){p.height=m}if(d&&SC.isPercentage(d)){p.height=d*i}else{p.height=(d||0)}if(SC.isPercentage(j)){p.y=(i-p.height)/2+(j*i)}else{p.y=(i-p.height)/2+j}}else{p.y=0;if(SC.none(d)){p.height=i}else{if(d===m){p.height=m}if(SC.isPercentage(d)){p.height=d*i}else{p.height=d||0}}}}}p.x=Math.floor(p.x);p.y=Math.floor(p.y);if(p.height!==m){p.height=Math.floor(p.height)}if(p.width!==m){p.width=Math.floor(p.width)}if(p.height===m||p.width===m){t=this.get("layer");if(p.height===m){p.height=t?t.clientHeight:0}if(p.width===m){p.width=t?t.clientWidth:0}}p=this._adjustForBorder(p,q);if(l&&l.isScrollContainer){l=l.get("parentView");p.x-=l.get("horizontalScrollOffset");p.y-=l.get("verticalScrollOffset")}if(!SC.none(q.maxHeight)&&(p.height>q.maxHeight)){p.height=q.maxHeight}if(!SC.none(q.minHeight)&&(p.height<q.minHeight)){p.height=q.minHeight}if(!SC.none(q.maxWidth)&&(p.width>q.maxWidth)){p.width=q.maxWidth}if(!SC.none(q.minWidth)&&(p.width<q.minWidth)){p.width=q.minWidth}if(p.height<0){p.height=0}if(p.width<0){p.width=0}return p}.enhance(),computeParentDimensions:function(g){var b,c=this.get("parentView"),a=(c)?c.get("frame"):null;if(a){b={width:a.width,height:a.height}}else{var d=g||{};b={width:(d.left||0)+(d.width||0)+(d.right||0),height:(d.top||0)+(d.height||0)+(d.bottom||0)}}return b},borderFrame:function(){var d=this.get("layout"),g=this.get("frame"),a=d.border,f=((d.topBorder!==undefined)?d.topBorder:d.border)||0,c=((d.rightBorder!==undefined)?d.rightBorder:d.border)||0,h=((d.bottomBorder!==undefined)?d.bottomBorder:d.border)||0,b=((d.leftBorder!==undefined)?d.leftBorder:d.border)||0;return{x:g.x-b,y:g.y-f,width:g.width+b+c,height:g.height+f+h}}.property("frame").cacheable(),parentViewDidResize:function(){var b,a;a=this.useStaticLayout||!this.get("isFixedSize");b=!this.get("isFixedPosition");if(a){this.viewDidResize()}else{if(b){this._viewFrameDidChange()}}},viewDidResize:function(){this._viewFrameDidChange();var d=this.childViews,b,a,c;for(a=0;a<(b=d.length);++a){c=d[a];c.tryToPerform("parentViewDidResize")}},_viewFrameDidChange:function(){this.notifyPropertyChange("frame");this._sc_view_clippingFrameDidChange()},beginLiveResize:function(){if(this.willBeginLiveResize){this.willBeginLiveResize()}var d=this.get("childViews"),b=d.length,a,c;for(a=0;a<b;++a){c=d[a];if(c.beginLiveResize){c.beginLiveResize()}}return this},endLiveResize:function(){var d=this.get("childViews"),b=d.length,a,c;for(a=b-1;a>=0;--a){c=d[a];if(c.endLiveResize){c.endLiveResize()}}if(this.didEndLiveResize){this.didEndLiveResize()}return this},layoutView:function(){return this.get("parentView")}.property("parentView").cacheable(),layoutDidChange:function(){var h=this._previousLayout,g=this.get("layout"),j=YES,d,c,a,b;if(!SC.none(g.rotate)){if(SC.none(g.rotateX)){g.rotateX=g.rotate;SC.Logger.warn("Please set rotateX instead of rotate")}}if(!SC.none(g.rotateX)){g.rotate=g.rotateX}else{delete g.rotate}var i=g.animations;if(i){if(!SC.none(i.rotate)){if(SC.none(i.rotateX)){i.rotateX=i.rotate;SC.Logger.warn("Please animate rotateX instead of rotate")}}if(!SC.none(i.rotateX)){i.rotate=i.rotateX}else{delete i.rotate}}if(h&&h!==g){d=h.width;if(d!==undefined){a=g.width;if(d===a){c=h.height;if(h!==undefined){b=g.height;if(c===b){j=NO}}}}}this.beginPropertyChanges();this.notifyPropertyChange("hasAcceleratedLayer");this.notifyPropertyChange("layoutStyle");if(j){this.viewDidResize()}else{this._viewFrameDidChange()}this.endPropertyChanges();var f=this.get("layoutView");if(f){f.set("childViewsNeedLayout",YES);f.layoutDidChangeFor(this);if(f.get("childViewsNeedLayout")){f.invokeOnce(f.layoutChildViewsIfNeeded)}}this._previousLayout=g;return this},childViewsNeedLayout:NO,layoutDidChangeFor:function(b){var a=this._needLayoutViews;if(!a){a=this._needLayoutViews=SC.CoreSet.create()}a.add(b)},layoutChildViewsIfNeeded:function(a){if(!a){a=this.get("isVisibleInWindow")}if(a&&this.get("childViewsNeedLayout")){this.set("childViewsNeedLayout",NO);this.layoutChildViews()}return this},layoutChildViews:function(){var c=this._needLayoutViews,a=c?c.length:0,b;for(b=0;b<a;++b){c[b].updateLayout()}c.clear()},updateLayout:function(){var b=this.get("layer"),a;if(b){a=this.renderContext(b);this.renderLayout(a,NO);a.update();if(this.useStaticLayout){this.viewDidResize()}}b=null;return this},renderLayout:function(a,b){this.get("layoutStyleCalculator").willRenderAnimations();a.addStyle(this.get("layoutStyle"));this.get("layoutStyleCalculator").didRenderAnimations()},_renderLayerSettings:function(b,a,c){b(a,c);this.renderLayout(a,c)}.enhance(),applyAttributesToContext:function(b,a){b(a);if(this.get("useStaticLayout")){a.addClass("sc-static-layout")}if(this.get("backgroundColor")){a.css("backgroundColor",this.get("backgroundColor"))}}.enhance()});SC.View.mixin({convertLayoutToAnchoredLayout:function(g,n){var i={top:0,left:0,width:n.width,height:n.height},d=n.width,l=n.height,m=g.right,a=g.left,k=g.top,h=g.bottom,j=g.width,f=g.height,c=g.centerX,b=g.centerY;if(!SC.none(a)){if(SC.isPercentage(a)){i.left=a*d}else{i.left=a}if(j!==undefined){if(j===SC.LAYOUT_AUTO){i.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(j)){i.width=j*d}else{i.width=j}}}else{if(m&&SC.isPercentage(m)){i.width=d-i.left-(m*d)}else{i.width=d-i.left-(m||0)}}}else{if(!SC.none(m)){if(SC.none(j)){i.left=0;if(m&&SC.isPercentage(m)){i.width=d-(m*d)}else{i.width=d-(m||0)}}else{if(j===SC.LAYOUT_AUTO){i.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(j)){i.width=j*d}else{i.width=j}if(SC.isPercentage(m)){i.left=d-(i.width+m)}else{i.left=d-(i.width+m)}}}}else{if(!SC.none(c)){if(j&&SC.isPercentage(j)){i.width=(j*d)}else{i.width=(j||0)}i.left=((d-i.width)/2);if(SC.isPercentage(c)){i.left=i.left+c*d}else{i.left=i.left+c}}else{if(!SC.none(j)){i.left=0;if(j===SC.LAYOUT_AUTO){i.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(j)){i.width=j*d}else{i.width=j}}}else{i.left=0;i.width=0}}}}if(g.minWidth!==undefined){i.minWidth=g.minWidth}if(g.maxWidth!==undefined){i.maxWidth=g.maxWidth}if(!SC.none(k)){if(SC.isPercentage(k)){i.top=k*l}else{i.top=k}if(f!==undefined){if(f===SC.LAYOUT_AUTO){i.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(f)){i.height=f*l}else{i.height=f}}}else{i.height=l-i.top;if(h&&SC.isPercentage(h)){i.height=i.height-(h*l)}else{i.height=i.height-(h||0)}}}else{if(!SC.none(h)){if(SC.none(f)){i.top=0;if(h&&SC.isPercentage(h)){i.height=l-(h*l)}else{i.height=l-(h||0)}}else{if(f===SC.LAYOUT_AUTO){i.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(f)){i.height=f*l}else{i.height=f}i.top=l-i.height;if(SC.isPercentage(h)){i.top=i.top-(h*l)}else{i.top=i.top-h}}}}else{if(!SC.none(b)){if(f&&SC.isPercentage(f)){i.height=(f*l)}else{i.height=(f||0)}i.top=((l-i.height)/2);if(SC.isPercentage(b)){i.top=i.top+b*l}else{i.top=i.top+b}}else{if(!SC.none(f)){i.top=0;if(f===SC.LAYOUT_AUTO){i.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(f)){i.height=f*l}else{i.height=f}}}else{i.top=0;i.height=0}}}}if(i.top){i.top=Math.floor(i.top)}if(i.bottom){i.bottom=Math.floor(i.bottom)}if(i.left){i.left=Math.floor(i.left)}if(i.right){i.right=Math.floor(i.right)}if(i.width!==SC.LAYOUT_AUTO){i.width=Math.floor(i.width)}if(i.height!==SC.LAYOUT_AUTO){i.height=Math.floor(i.height)}if(g.minHeight!==undefined){i.minHeight=g.minHeight}if(g.maxHeight!==undefined){i.maxHeight=g.maxHeight}return i},convertLayoutToCustomLayout:function(b,a,c){}});sc_require("views/view");sc_require("views/view/layout");sc_require("views/view/layout_style");SC.View.reopen({wantsAcceleratedLayer:NO,hasAcceleratedLayer:function(){if(this.get("wantsAcceleratedLayer")&&SC.platform.supportsAcceleratedLayers){var c=this.get("layout"),d=c.animate,b=SC.LAYOUT_AUTO,a;if(d&&(d.top||d.left)){for(a in d){if(SC.CSS_TRANSFORM_MAP[a]&&((d.top&&d.top.duration!==d[a].duration)||(d.left&&d.left.duration!==d[a].duration))){return NO}}}return this.get("isFixedLayout")}return NO}.property("wantsAcceleratedLayer").cacheable()});sc_require("views/view");SC.View.reopen({cursor:function(a,c){var b;if(c){this._setCursor=c}if(this._setCursor!==undefined){return this._setCursor}b=this.get("parentView");if(this.get("shouldInheritCursor")&&b){return b.get("cursor")}return null}.property("parentView","shouldInheritCursor").cacheable(),applyAttributesToContext:function(b,a){var c=this.get("cursor");if(c){a.addClass(c.get("className"))}b(a)}.enhance(),shouldInheritCursor:YES});sc_require("views/view");SC.View.reopen({isEnabled:YES,isEnabledBindingDefault:SC.Binding.oneWay().bool(),isEnabledInPane:function(){var a=this.get("isEnabled"),b;if(a&&(b=this.get("parentView"))){a=b.get("isEnabledInPane")}return a}.property("parentView","isEnabled"),_sc_view_isEnabledDidChange:function(){if(!this.get("isEnabled")&&this.get("isFirstResponder")){this.resignFirstResponder()}}.observes("isEnabled"),applyAttributesToContext:function(b,a){var c=this.get("isEnabled");b(a);a.setClass("disabled",!c);a.attr("aria-disabled",!c?"true":null)}.enhance()});sc_require("views/view");SC.View.reopen({isKeyResponder:NO,willLoseKeyResponderTo:function(a){},willBecomeKeyResponderFrom:function(a){},didLoseKeyResponderTo:function(a){},didBecomeKeyResponderFrom:function(a){},interpretKeyEvents:function(b){var a=b.commandCodes(),d=a[0],f=a[1],h;if(!d&&!f){return null}if(d){var i=SC.MODIFIED_KEY_BINDINGS[d]||SC.BASE_KEY_BINDINGS[d.match(/[^_]+$/)[0]];if(i){var g=this,c=this.get("pane"),j=null;while(g&&!(j=g.tryToPerform(i,b))){g=(g===c)?null:g.get("nextResponder")}return j}}if(f&&this.respondsTo("insertText")){h=this.insertText(f,b);return h?(h===YES?this:h):null}return null},insertText:function(a){return NO},performKeyEquivalent:function(g,d){var f=NO,h=this.get("childViews"),b=h.length,a=-1,c;while(!f&&(++a<b)){c=h[a];f=c.tryToPerform("performKeyEquivalent",g,d)}return f},firstKeyView:null,_getFirstKeyView:function(){var a=this.get("firstKeyView");if(a){return a}var b=this.get("childViews");if(b){return b[0]}},lastKeyView:null,_getLastKeyView:function(){var d=this.get("lastKeyView");if(d){return d}var a,b=this.get("firstKeyView");if(b){while(a=b._getNextKeyView()){b=a}return b}else{var c=this.get("childViews");if(c){return c[c.length-1]}}},nextKeyView:undefined,_getNextKeyView:function(){var b=this.get("parentView"),a=this.get("nextKeyView");if(b&&b.get("lastKeyView")===this){return null}if(a!==undefined){return a}if(b){var c=b.get("childViews");return c[c.indexOf(this)+1]}},nextValidKeyView:function(){var b=this,a;while(a!==this){a=null;if(b.get("isVisibleInWindow")){a=b._getFirstKeyView()}if(!a){a=b._getNextKeyView()}if(!a){while(b=b.get("parentView")){if(a=b._getNextKeyView()){break}}}if(!a){if(!SC.TABBING_ONLY_INSIDE_DOCUMENT){break}else{a=this.get("pane")}}if(a.get("isVisibleInWindow")&&a.get("acceptsFirstResponder")){return a}b=a}return null}.property("nextKeyView"),previousKeyView:undefined,_getPreviousKeyView:function(){var b=this.get("parentView"),a=this.get("previousKeyView");if(b&&b.get("firstKeyView")===this){return null}if(a!==undefined){return a}if(b){var c=b.get("childViews");return c[c.indexOf(this)-1]}},previousValidKeyView:function(){var b=this,a;while(a!==this){if(b.get("parentView")){a=b._getPreviousKeyView()}else{if(!SC.TABBING_ONLY_INSIDE_DOCUMENT){break}else{a=b}}if(a){do{b=a;a=a._getLastKeyView()}while(a&&a.get("isVisibleInWindow"));if(!a){a=b}}else{a=b.get("parentView")}if(a.get("isVisibleInWindow")&&a.get("acceptsFirstResponder")){return a}b=a}return null}.property("previousKeyView")});sc_require("views/view");SC.View.reopen({_lastLayerId:null,layerIdDidChange:function(){var a=this.get("layer"),b=this.get("layerId"),c=this._lastLayerId;if(b!==c){if(c&&SC.View.views[c]===this){delete SC.View.views[c]}this._lastLayerId=b;SC.View.views[b]=this;if(a){a.id=b}}}.observes("layerId"),parentViewDidChange:function(){this.recomputeIsVisibleInWindow();this.resetBuildState();this.set("layerLocationNeedsUpdate",YES);this.invokeOnce(this.updateLayerLocationIfNeeded);this._invalidatePaneCacheForSelfAndAllChildViews();return this},_invalidatePaneCacheForSelfAndAllChildViews:function(){var d,c=this.get("childViews"),b=c.length,a;this.notifyPropertyChange("pane");for(a=0;a<b;++a){d=c[a];if(d._invalidatePaneCacheForSelfAndAllChildViews){d._invalidatePaneCacheForSelfAndAllChildViews()}}},insertBefore:function(b,d){b.beginPropertyChanges();if(b.get("parentView")){b.removeFromParent()}if(this.willAddChild){this.willAddChild(b,d)}if(b.willAddToParent){b.willAddToParent(this,d)}b.set("parentView",this);var a,c=this.get("childViews");if(c.needsClone){this.set(c=[])}a=(d)?c.indexOf(d):c.length;if(a<0){a=c.length}c.insertAt(a,b);if(b.parentViewDidChange){b.parentViewDidChange()}if(b.layoutDidChange){b.layoutDidChange()}b.endPropertyChanges();this.invokeLast(function(){var f=b.get("pane");if(f&&f.get("isPaneAttached")){b._notifyDidAppendToDocument()}});if(this.didAddChild){this.didAddChild(b,d)}if(b.didAddToParent){b.didAddToParent(this,d)}return this},removeChild:function(b,a){if(!a){return this}if(a.parentView!==this){throw"%@.removeChild(%@) must belong to parent".fmt(this,a)}if(a.willRemoveFromParent){a.willRemoveFromParent()}if(this.willRemoveChild){this.willRemoveChild(a)}b(a);if(a.parentViewDidChange){a.parentViewDidChange()}if(this.didRemoveChild){this.didRemoveChild(a)}if(a.didRemoveFromParent){a.didRemoveFromParent(this)}return this}.enhance(),replaceChild:function(a,b){a.beginPropertyChanges();b.beginPropertyChanges();this.beginPropertyChanges();this.insertBefore(a,b).removeChild(b);this.endPropertyChanges();b.endPropertyChanges();a.endPropertyChanges();return this},replaceAllChildren:function(c){var b=c.get("length"),a;this.beginPropertyChanges();this.destroyLayer().removeAllChildren();for(a=0;a<b;a++){this.appendChild(c.objectAt(a))}this.replaceLayer();this.endPropertyChanges();return this},appendChild:function(a){return this.insertBefore(a,null)},buildInChild:function(a){a.willBuildInToView(this);this.appendChild(a);a.buildInToView(this)},buildOutChild:function(a){a.buildOutFromView(this)},buildInDidFinishFor:function(a){},buildOutDidFinishFor:function(a){this.removeChild(a)},isBuildingIn:NO,isBuildingOut:NO,buildIn:function(){this.buildInDidFinish()},buildOut:function(){this.buildOutDidFinish()},resetBuild:function(){},buildOutDidCancel:function(){},buildInDidCancel:function(){},buildInDidFinish:function(){this.isBuildingIn=NO;this._buildingInTo.buildInDidFinishFor(this);this._buildingInTo=null},buildOutDidFinish:function(){this.isBuildingOut=NO;this._buildingOutFrom.buildOutDidFinishFor(this);this._buildingOutFrom=null},resetBuildState:function(){if(this.isBuildingIn){this.buildInDidCancel();this.isBuildingIn=NO}if(this.isBuildingOut){this.buildOutDidCancel();this.isBuildingOut=NO}this.buildingInTo=null;this.buildingOutFrom=null;this.resetBuild()},willBuildInToView:function(a){if(this.isBuildingOut){this.buildOutDidCancel()}},buildInToView:function(a){if(this.isBuildingIn){return}this._buildingInTo=a;this.isBuildingOut=NO;this.isBuildingIn=YES;this.buildIn()},buildOutFromView:function(a){if(this.isBuildingOut){return}if(this.isBuildingIn){this.buildInDidCancel()}this.isBuildingOut=YES;this.isBuildingIn=NO;this._buildingOutFrom=a;this.buildOut()}});sc_require("views/view");SC.View.reopen({init:function(a){a();this._lastTheme=this.get("theme")}.enhance(),themeName:null,baseThemeName:null,theme:function(){var b=this.get("baseTheme"),a=this.get("themeName");if(a){var c;if(b){c=b.find(a);if(c){return c}}c=SC.Theme.find(a);if(c){return c}return b.invisibleSubtheme(a)}return b}.property("baseTheme","themeName").cacheable(),_sc_view_themeDidChange:function(){if(this._lastTheme===this.get("theme")){return}this._lastTheme=this.get("theme");var c=this.childViews,b=c.length,a;for(a=0;a<b;a++){c[a].notifyPropertyChange("baseTheme")}if(this.get("layer")){this.replaceLayer()}}.observes("theme"),baseTheme:function(){var b;var a=this.get("baseThemeName");if(a){return SC.Theme.find(a)}else{b=this.get("parentView");var c=b&&b.get("theme");return c||SC.Theme.find(SC.defaultTheme)}}.property("baseThemeName","parentView").cacheable(),renderDelegate:function(c,d){if(d){this._setRenderDelegate=d}if(this._setRenderDelegate){return this._setRenderDelegate}var a=this.get("renderDelegateName"),b;if(a){b=this.get("theme")[a];if(!b){throw'%@: Unable to locate render delegate "%@" in theme.'.fmt(this,a)}return b}return null}.property("renderDelegateName","theme"),renderDelegateName:null,renderDelegateProxy:function(){return SC.View._RenderDelegateProxy.createForView(this)}.property("renderDelegate").cacheable(),render:function(b,c){var a=this.get("renderDelegate");if(a){if(c){a.render(this.get("renderDelegateProxy"),b)}else{a.update(this.get("renderDelegateProxy"),b.$())}}},applyAttributesToContext:function(g,f){var h=this.get("theme");var c=h.classNames,b,a=c.length;for(b=0;b<a;b++){f.addClass(c[b])}g(f);var d=this.get("renderDelegate");if(d&&d.className){f.addClass(d.className)}}.enhance(),invokeRenderDelegateMethod:function(c,b){var a=this.get("renderDelegate");if(!a){return undefined}if(SC.typeOf(a[c])!==SC.T_FUNCTION){return undefined}b=SC.$A(arguments);b.shift();b.unshift(this.get("renderDelegateProxy"));return a[c].apply(a,b)}});SC.View._RenderDelegateProxy={isViewRenderDelegateProxy:YES,createForView:function(c){var d=SC.beget(this);var g=c.get("displayProperties"),f={};for(var b=0,a=g.length;b<a;b++){f[g[b]]=YES}f.theme=YES;d._displayPropertiesLookup=f;d.renderState={};d._view=c;return d},get:function(b){if(this[b]!==undefined){return this[b]}var a="display"+b.capitalize();if(this._displayPropertiesLookup[a]){return this._view.get(a)}else{if(this._displayPropertiesLookup[b]){return this._view.get(b)}}return undefined},didChangeFor:function(d){var b=arguments.length,a;for(a=1;a<b;a++){var f=arguments[a],c="display"+f.capitalize();if(this._displayPropertiesLookup[c]){if(this._view.didChangeFor(d,c)){return YES}}else{if(this._displayPropertiesLookup[f]){if(this._view.didChangeFor(d,f)){return YES}}}}return NO}};SC.propertyFromRenderDelegate=function(a,b){return function(g,h){if(h!==undefined){this["_set_rd_"+g]=h}var d=this["_set_rd_"+g];if(d!==undefined){return d}var c=this.get("renderDelegate");if(c&&c.get){var f=this.get("renderDelegateProxy");d=c.getPropertyFor(f,a)}if(d!==undefined){return d}return b}.property("renderDelegate").cacheable()};sc_require("views/view");SC.View.reopen({acceptsMultitouch:NO,hasTouch:NO,touchBoundary:{left:25,right:25,top:25,bottom:25},_touchBoundaryFrame:function(){var b=this.get("touchBoundary"),a;a=this.get("parentView").convertFrameToView(this.get("frame"),null);a.x-=b.left;a.y-=b.top;a.width+=b.left+b.right;a.height+=b.top+b.bottom;return a}.property("touchBoundary","clippingFrame").cacheable(),touchIsInBoundary:function(a){return SC.pointInRect({x:a.pageX,y:a.pageY},this.get("_touchBoundaryFrame"))}});sc_require("views/view");SC.View.reopen({hasVisibility:YES,isVisibleInWindow:NO,isContextMenuEnabled:function(){return SC.CONTEXT_MENU_ENABLED}.property(),recomputeIsVisibleInWindow:function(d){var g=this.get("isVisibleInWindow"),i=this.get("isVisible"),f;if(i){if(d===undefined){f=this.get("parentView");d=f?f.get("isVisibleInWindow"):NO}i=i&&d}if(g!==i){this.set("isVisibleInWindow",i);var h=this.get("childViews"),b=h.length,a,c;for(a=0;a<b;a++){c=h[a];if(c.recomputeIsVisibleInWindow){c.recomputeIsVisibleInWindow(i)}}if(i){if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)}}else{if(this.get("isFirstResponder")){this.resignFirstResponder()}}}this.updateLayerIfNeeded(YES);return this},_sc_isVisibleDidChange:function(){this.displayDidChange();this.recomputeIsVisibleInWindow()}.observes("isVisible")});sc_require("views/view");sc_require("views/view/acceleration");sc_require("views/view/cursor");sc_require("views/view/enabled");sc_require("views/view/keyboard");sc_require("views/view/layout");sc_require("views/view/manipulation");sc_require("views/view/theming");sc_require("views/view/touch");sc_require("views/view/visibility");sc_require("mixins/responder_context");SC.MIXED_STATE="__MIXED__";SC.Pane=SC.View.extend(SC.ResponderContext,{isPane:YES,page:null,rootResponder:null,sendEvent:function(c,a,d){var b;if(!d){d=this.get("firstResponder")}while(d){if(c==="touchStart"){if(a.touchResponder===d){d=null;break}if(!d.get("hasTouch")||d.get("acceptsMultitouch")){if(d.tryToPerform("touchStart",a)){break}}}else{if(c==="touchEnd"&&!d.get("acceptsMultitouch")){if(!d.get("hasTouch")){if(d.tryToPerform("touchEnd",a)){break}}}else{if(d.tryToPerform(c,a)){break}}}d=(d===this)?null:d.get("nextResponder")}if(!d&&(d=this.get("defaultResponder"))){if(typeof d===SC.T_STRING){d=SC.objectForPropertyPath(d)}if(!d){d=null}else{d=d.tryToPerform(c,a)?d:null}}else{if(!d&&!(d=this.get("defaultResponder"))){d=this.tryToPerform(c,a)?this:null}}return a.mouseHandler||d},nextResponder:function(){return null}.property().cacheable(),firstResponder:null,acceptsKeyPane:YES,isKeyPane:NO,becomeKeyPane:function(){if(this.get("isKeyPane")){return this}if(this.rootResponder){this.rootResponder.makeKeyPane(this)}return this},resignKeyPane:function(){if(!this.get("isKeyPane")){return this}if(this.rootResponder){this.rootResponder.makeKeyPane(null)}return this},makeFirstResponder:function(c,b,a){if(!b){b=this}var f=this.get("firstResponder"),d=this.get("isKeyPane");if(f===b){return this}if(SC.platform.touch&&b&&b.kindOf(SC.TextFieldView)&&!b.get("focused")){return this}if(d){if(f){f.tryToPerform("willLoseKeyResponderTo",b)}if(b){b.tryToPerform("willBecomeKeyResponderFrom",f)}}if(f){f.beginPropertyChanges();f.set("isKeyResponder",NO)}if(b){b.beginPropertyChanges();b.set("isKeyResponder",d)}c(b,a);if(f){f.endPropertyChanges()}if(b){b.endPropertyChanges()}if(d){if(b){b.tryToPerform("didBecomeKeyResponderFrom",f)}if(f){f.tryToPerform("didLoseKeyResponderTo",b)}}return this}.enhance(),willLoseKeyPaneTo:function(a){this._forwardKeyChange(this.get("isKeyPane"),"willLoseKeyResponderTo",a,NO);return this},willBecomeKeyPaneFrom:function(a){this._forwardKeyChange(!this.get("isKeyPane"),"willBecomeKeyResponderFrom",a,YES);return this},didBecomeKeyResponderFrom:function(a){},didLoseKeyPaneTo:function(b){var a=this.get("isKeyPane");this.set("isKeyPane",NO);this._forwardKeyChange(a,"didLoseKeyResponderTo",b);return this},didBecomeKeyPaneFrom:function(b){var a=this.get("isKeyPane");this.set("isKeyPane",YES);this._forwardKeyChange(!a,"didBecomeKeyResponderFrom",b,YES);return this},isMainPane:NO,focusFrom:function(a){},blurTo:function(a){},blurMainTo:function(a){this.set("isMainPane",NO)},focusMainFrom:function(a){this.set("isMainPane",YES)},append:function(){return this.appendTo(document.body)},remove:function(){if(!this.get("isVisibleInWindow")){return this}if(!this.get("isPaneAttached")){return this}var b=this.get("layer");if(b&&b.parentNode){b.parentNode.removeChild(b)}b=null;this._removeIntercept();this.resignKeyPane();var a=this.rootResponder;if(this.get("isMainPane")){a.makeMainPane(null)}a.panes.remove(this);this.rootResponder=null;this.set("isPaneAttached",NO);this.parentViewDidChange();return this},insert:function(b){var a=this.get("layer");if(!a){a=this.createLayer().get("layer")}b(a);if(!this.get("isPaneAttached")){this.paneDidAttach()}return this},appendTo:function(a){return this.insert(function(b){jQuery(a).append(b)})},paneDidAttach:function(){var a=(this.rootResponder=SC.RootResponder.responder);a.panes.add(this);this.set("isPaneAttached",YES);this.recomputeDependentProperties();this._notifyDidAppendToDocument();this._addIntercept();return this},recomputeDependentProperties:function(){},isPaneAttached:NO,wantsTouchIntercept:NO,hasTouchIntercept:function(){return this.get("wantsTouchIntercept")&&SC.platform.touch}.property("wantsTouchIntercept").cacheable(),zIndex:0,touchZ:99,_addIntercept:function(){if(this.get("hasTouchIntercept")){var b=document.createElement("div");var a=b.style;a.position="absolute";a.left="0px";a.top="0px";a.right="0px";a.bottom="0px";a.webkitTransform="translateZ(0px)";a.zIndex=this.get("zIndex")+this.get("touchZ");b.className="touch-intercept";b.id="touch-intercept-"+SC.guidFor(this);this._touchIntercept=b;document.body.appendChild(b)}},_removeIntercept:function(){if(this._touchIntercept){document.body.removeChild(this._touchIntercept);this._touchIntercept=null}},hideTouchIntercept:function(){if(this._touchIntercept){this._touchIntercept.style.display="none"}},showTouchIntercept:function(){if(this._touchIntercept){this._touchIntercept.style.display="block"}},recomputeIsVisibleInWindow:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}var d=this.get("isVisibleInWindow"),g=this.get("isVisible")&&this.get("isPaneAttached");if(d!==g){this.set("isVisibleInWindow",g);var f=this.get("childViews"),b=f.length,a,c;for(a=0;a<b;a++){c=f[a];if(c.recomputeIsVisibleInWindow){c.recomputeIsVisibleInWindow(g)}}if(g){if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)}}else{if(this.get("isKeyPane")){this.resignKeyPane()}}}this.updateLayerIfNeeded(YES);return this},updateLayerLocation:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}return this},init:function(){if(this.hasTouchIntercept===YES){SC.Logger.warn("Do not set hasTouchIntercept directly. Use wantsTouchIntercept instead.");this.hasTouchIntercept=SC.platform.touch}var a=!!this.get("layer");arguments.callee.base.apply(this,arguments);if(a){this.paneDidAttach()}},classNames:["sc-pane"]});sc_require("panes/pane");SC.Pane.reopen({performKeyEquivalent:function(c,a){var b=arguments.callee.base.apply(this,arguments);if(!b){var d=this.get("defaultResponder");if(d){if(d.performKeyEquivalent){b=d.performKeyEquivalent(c,a)}if(!b&&d.tryToPerform){b=d.tryToPerform(c,a)}}}return b},keyDown:function(a){var b;if(a.keyCode===9&&!this.get("firstResponder")){if(a.shiftKey){b=this.get("previousValidKeyView")}else{b=this.get("nextValidKeyView")}if(b){this.makeFirstResponder(b);return YES}else{if(!SC.TABBING_ONLY_INSIDE_DOCUMENT){a.allowDefault()}}}return NO},_forwardKeyChange:function(d,b,h,g){var c,a,f;if(d&&(a=this.get("firstResponder"))){f=(h)?h.get("firstResponder"):null;c=this.get("firstResponder");if(c&&c[b]){c[b](f)}if((g!==undefined)&&a){a.set("isKeyResponder",g)}}}});sc_require("panes/pane");SC.Pane.reopen({currentWindowSize:null,computeParentDimensions:function(c){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}var d={x:0,y:0,width:1000,height:1000},b=this.get("layout");if(document&&document.body){d.width=document.body.clientWidth;d.height=document.body.clientHeight;if(SC.browser.name===SC.BROWSER.ie&&SC.browser.compareVersion(SC.browser.version,"7")===0){var a=SC.platform.get("scrollbarSize");if(document.body.scrollWidth>d.width){d.width-=a}if(document.body.scrollHeight>d.height){d.height-=a}}}if(b.minHeight||b.minWidth){if(b.minHeight){d.height=Math.max(d.height,b.minHeight)}if(b.minWidth){d.width=Math.max(d.width,b.minWidth)}}return d},frame:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}return this.computeFrameWithParentFrame(null)}.property(),windowSizeDidChange:function(b,a){this.set("currentWindowSize",a);this.setBodyOverflowIfNeeded();this.parentViewDidResize();return this},setBodyOverflowIfNeeded:function(f){var d=this.get("layout"),b=this.get("currentWindowSize");if(!d||!b||!b.width||!b.height){return}var a=d.minWidth,c=d.minHeight;if(f===true||a||c){if((c&&b.height<c)||(a&&b.width<a)){SC.bodyOverflowArbitrator.requestVisible(this)}else{SC.bodyOverflowArbitrator.requestHidden(this)}}},paneLayoutDidChange:function(){this.invokeOnce(this.updateLayout);this.setBodyOverflowIfNeeded()}.observes("layout"),recomputeDependentProperties:function(a){this.set("currentWindowSize",this.rootResponder.computeWindowSize());a()}.enhance()});sc_require("panes/pane");SC.Pane.reopen({prependTo:function(a){return this.insert(function(b){jQuery(a).prepend(b)})},removeFromParent:function(){throw SC.Error.desc("SC.Pane cannot be removed from its parent, since it's the root. Did you mean remove()?")}});sc_require("panes/pane");SC.Pane.reopen({recomputeDependentProperties:function(a){this.recomputeIsVisibleInWindow();a()}.enhance()});SC.Application=SC.Responder.extend(SC.ResponderContext,{});SC.Color=SC.Object.extend(SC.Copyable,{original:null,a:1,r:0,g:0,b:0,hue:function(c,d){var f=SC.Color.clampToDeviceGamut,a=SC.Color.rgbToHsl(f(this.get("r")),f(this.get("g")),f(this.get("b"))),b;if(d!==undefined){a[0]=(d%360+360)%360;b=SC.Color.hslToRgb(a[0],a[1],a[2]);this.beginPropertyChanges();this.set("r",b[0]);this.set("g",b[1]);this.set("b",b[2]);this.endPropertyChanges()}return a[0]}.property("r","g","b").cacheable(),saturation:function(c,d){var f=SC.Color.clampToDeviceGamut,a=SC.Color.rgbToHsl(f(this.get("r")),f(this.get("g")),f(this.get("b"))),b;if(d!==undefined){a[1]=SC.Color.clamp(d,0,1);b=SC.Color.hslToRgb(a[0],a[1],a[2]);this.beginPropertyChanges();this.set("r",b[0]);this.set("g",b[1]);this.set("b",b[2]);this.endPropertyChanges()}return a[1]}.property("r","g","b").cacheable(),luminosity:function(c,d){var f=SC.Color.clampToDeviceGamut,a=SC.Color.rgbToHsl(f(this.get("r")),f(this.get("g")),f(this.get("b"))),b;if(d!==undefined){a[2]=SC.Color.clamp(d,0,1);b=SC.Color.hslToRgb(a[0],a[1],a[2]);this.beginPropertyChanges();this.set("r",b[0]);this.set("g",b[1]);this.set("b",b[2]);this.endPropertyChanges()}return a[2]}.property("r","g","b").cacheable(),isEqualTo:function(a){return this.get("r")===a.get("r")&&this.get("g")===a.get("g")&&this.get("b")===a.get("b")&&this.get("a")===a.get("a")},toArgb:function(){var a=SC.Color.clampToDeviceGamut;return"#"+[a(255*this.get("a")),a(this.get("r")),a(this.get("g")),a(this.get("b"))].map(function(b){b=b.toString(16);return b.length===1?"0"+b:b}).join("")},toHex:function(){var a=SC.Color.clampToDeviceGamut;return"#"+[a(this.get("r")),a(this.get("g")),a(this.get("b"))].map(function(b){b=b.toString(16);return b.length===1?"0"+b:b}).join("")},toRgb:function(){var a=SC.Color.clampToDeviceGamut;return"rgb("+a(this.get("r"))+","+a(this.get("g"))+","+a(this.get("b"))+")"},toRgba:function(){var a=SC.Color.clampToDeviceGamut;return"rgba("+a(this.get("r"))+","+a(this.get("g"))+","+a(this.get("b"))+","+this.get("a")+")"},toHsl:function(){var a=Math.round;return"hsl("+a(this.get("hue"))+","+a(this.get("saturation")*100)+"%,"+a(this.get("luminosity")*100)+"%)"},toHsla:function(){var a=Math.round;return"hsla("+a(this.get("hue"))+","+a(this.get("saturation")*100)+"%,"+a(this.get("luminosity")*100)+"%,"+this.get("a")+")"},cssText:function(){var a=SC.Color.supportsRgba||SC.Color.supportsArgb;return(this.a===1||!a)?this.toHex():SC.Color.supportsRgba?this.toRgba():this.toArgb()}.property("r","g","b","a").cacheable(),copy:function(){return SC.Color.create({original:this.get("original"),r:this.get("r"),g:this.get("g"),b:this.get("b"),a:this.get("a")})},sub:function(a){return SC.Color.create({r:this.get("r")-a.get("r"),g:this.get("g")-a.get("g"),b:this.get("b")-a.get("b"),a:this.get("a")-a.get("a")})},add:function(a){return SC.Color.create({r:this.get("r")+a.get("r"),g:this.get("g")+a.get("g"),b:this.get("b")+a.get("b"),a:this.get("a")+a.get("a")})},mult:function(b){var a=Math.round;return SC.Color.create({r:a(this.get("r")*b),g:a(this.get("g")*b),b:a(this.get("b")*b),a:this.get("a")*b})}});SC.Color.mixin({supportsRgba:(function(){var c=document.getElementsByTagName("script")[0].style,b=c.cssText,a;c.cssText="background-color:rgba(5,2,1,.5)";a=c.backgroundColor.indexOf("rgba")!==-1;c.cssText=b;return a}()),supportsArgb:(function(){var c=document.getElementsByTagName("script")[0].style,b=c.cssText,a;c.cssText='filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#55000000", endColorstr="#55000000");';a=c.backgroundColor.indexOf("#55000000")!==-1;c.cssText=b;return a}()),clamp:function(c,b,a){return Math.max(Math.min(c,a),b)},clampInt:function(c,b,a){return Math.round(SC.Color.clamp(c,b,a))},clampToDeviceGamut:function(a){return SC.Color.clampInt(a,0,255)},hsvToRgb:function(k,y,w){k/=360;var a,m,u,j=Math.floor(k*6),n=k*6-j,d=w*(1-y),c=w*(1-(y*n)),x=w*(1-(y*(1-n))),o=[[w,x,d],[c,w,d],[d,w,x],[d,c,w],[x,d,w],[w,d,c]],l=SC.Color.clampToDeviceGamut;j=j%6;a=l(o[j][0]*255);m=l(o[j][1]*255);u=l(o[j][2]*255);return[a,m,u]},rgbToHsv:function(a,i,k){a/=255;i/=255;k/=255;var l=Math.max(a,i,k),c=Math.min(a,i,k),j=l-c,f,n=l===0?0:j/l,m=l;if(l===c){f=0}else{switch(l){case a:f=(i-k)/j+(i<k?6:0);break;case i:f=(k-a)/j+2;break;case k:f=(a-i)/j+4;break}f/=6}f*=360;return[f,n,m]},hslToRgb:function(g,f,b){g/=360;var d,c,a=SC.Color.hueToRgb,i=SC.Color.clampToDeviceGamut;c=b<=0.5?b*(f+1):b+f-b*f;d=b*2-c;return[i(a(d,c,g+1/3)*255),i(a(d,c,g)*255),i(a(d,c,g-1/3)*255)]},hueToRgb:function(b,a,c){if(c<0){c++}if(c>1){c--}if(c<1/6){return b+(a-b)*c*6}if(c<1/2){return a}if(c<2/3){return b+(a-b)*(2/3-c)*6}return b},rgbToHsl:function(a,j,m){a/=255;j/=255;m/=255;var n=Math.max(a,j,m),f=Math.min(a,j,m),i,o,c=(n+f)/2,k=n-f;if(n===f){i=o=0}else{o=c>0.5?k/(2-n-f):k/(n+f);switch(n){case a:i=(j-m)/k+(j<m?6:0);break;case j:i=(m-a)/k+2;break;case m:i=(a-j)/k+4;break}i/=6}i*=360;return[i,o,c]},PARSE_RGBA:/^rgba\(\s*([\d]+%?)\s*,\s*([\d]+%?)\s*,\s*([\d]+%?)\s*,\s*([.\d]+)\s*\)$/,PARSE_RGB:/^rgb\(\s*([\d]+%?)\s*,\s*([\d]+%?)\s*,\s*([\d]+%?)\s*\)$/,PARSE_HSLA:/^hsla\(\s*(-?[\d]+)\s*\s*,\s*([\d]+)%\s*,\s*([\d]+)%\s*,\s*([.\d]+)\s*\)$/,PARSE_HSL:/^hsl\(\s*(-?[\d]+)\s*,\s*([\d]+)%\s*,\s*([\d]+)%\s*\)$/,PARSE_HEX:/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,PARSE_ARGB:/^#[0-9a-fA-F]{8}$/,KEYWORDS:{aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},from:function(h){var l=SC.Color,k=h,j,i,c,d=1,f=function(b){var a=parseInt(b,10);return b.slice(-1)==="%"?l.clampInt(a*2.55,0,255):l.clampInt(a,0,255)};if(l.KEYWORDS.hasOwnProperty(h)){h=l.KEYWORDS[h]}if(l.PARSE_RGB.test(h)){h=h.match(l.PARSE_RGB);j=f(h[1]);i=f(h[2]);c=f(h[3])}else{if(l.PARSE_RGBA.test(h)){h=h.match(l.PARSE_RGBA);j=f(h[1]);i=f(h[2]);c=f(h[3]);d=parseFloat(h[4],10)}else{if(l.PARSE_HEX.test(h)){if(h.length===4){h="#"+h.charAt(1)+h.charAt(1)+h.charAt(2)+h.charAt(2)+h.charAt(3)+h.charAt(3)}j=parseInt(h.slice(1,3),16);i=parseInt(h.slice(3,5),16);c=parseInt(h.slice(5,7),16)}else{if(l.PARSE_ARGB.test(h)){j=parseInt(h.slice(3,5),16);i=parseInt(h.slice(5,7),16);c=parseInt(h.slice(7,9),16);d=parseInt(h.slice(1,3),16)/255}else{if(l.PARSE_HSL.test(h)){h=h.match(l.PARSE_HSL);h=l.hslToRgb(((parseInt(h[1],10)%360+360)%360),l.clamp(parseInt(h[2],10)/100,0,1),l.clamp(parseInt(h[3],10)/100,0,1));j=h[0];i=h[1];c=h[2]}else{if(l.PARSE_HSLA.test(h)){h=h.match(l.PARSE_HSLA);d=parseFloat(h[4],10);h=l.hslToRgb(((parseInt(h[1],10)%360+360)%360),l.clamp(parseInt(h[2],10)/100,0,1),l.clamp(parseInt(h[3],10)/100,0,1));j=h[0];i=h[1];c=h[2]}else{if(h==="transparent"){j=i=c=0;d=0}else{return NO}}}}}}}return SC.Color.create({original:k,r:l.clampInt(j,0,255),g:l.clampInt(i,0,255),b:l.clampInt(c,0,255),a:l.clamp(d,0,1)})}});SC.BENCHMARK_LOG_READY=YES;sc_require("system/event");SC.mixin({isReady:NO,suppressOnReady:SC.suppressOnReady?YES:NO,suppressMain:SC.suppressMain?YES:NO,ready:function(b,c){var a=SC._readyQueue;if(c===undefined){c=b;b=null}else{if(SC.typeOf(c)===SC.T_STRING){c=b[c]}}if(SC.isReady){jQuery(document).ready(function(){c.call(b)})}else{if(!a){SC._readyQueue=[]}SC._readyQueue.push(function(){c.call(b)})}return this},onReady:{done:function(){if(SC.isReady){return}SC.isReady=true;SC.RunLoop.begin();SC.Locale.createCurrentLocale();var d=SC.Locale.currentLanguage.toLowerCase();jQuery("body").addClass(d);jQuery("html").attr("lang",d);jQuery("#loading").remove();var c=SC._readyQueue,b,a;if(c){for(b=0,a=c.length;b<a;b++){c[b].call()}SC._readyQueue=null}if(window.main&&!SC.suppressMain&&(SC.mode===SC.APP_MODE)){window.main()}SC.RunLoop.end()}}});if(!SC.suppressOnReady){jQuery.event.special.ready._default=SC.onReady.done}SC.APP_MODE="APP_MODE";SC.TEST_MODE="TEST_MODE";SC.mode=SC.APP_MODE;SC.platform=SC.Object.create({scrollbarSize:function(){var a=document.createElement("DIV"),d;a.innerHTML="<div style='height:1px;'></div>";a.style.cssText="position:absolute;width:100px;height:100px;overflow-y:visible;";d=a.childNodes[0];document.body.appendChild(a);var b=d.innerWidth||d.clientWidth;a.style.overflowY="scroll";var c=d.innerWidth||d.clientWidth;document.body.removeChild(a);return b-c}.property().cacheable(),touch:"ontouchstart" in window||SC.browser.name===SC.BROWSER.android,bounceOnScroll:SC.browser.os===SC.OS.ios,pinchToZoom:SC.browser.os===SC.OS.ios,input:{placeholder:("placeholder" in document.createElement("input"))},input:function(d){var f={},c=d.length,g=document.createElement("input"),b,a;for(a=0;a<c;a++){b=d[a];f[b]=!!(b in g)}return f}(["autocomplete","readonly","list","size","required","multiple","maxlength","pattern","min","max","step","placeholder"]),standalone:!!navigator.standalone,cssPrefix:null,domCSSPrefix:null,simulateTouchEvents:function(){if(this.touch){return}SC.Logger.log("Simulating touch events");SC.platform.touch=YES;SC.platform.bounceOnScroll=YES;document.body.className=document.body.className+" touch";this._simtouch_counter=1;this.removeEvents(["click","dblclick","mouseout","mouseover","mousewheel"]);this.replaceEvent("mousemove",this._simtouch_mousemove);this.replaceEvent("mousedown",this._simtouch_mousedown);this.replaceEvent("mouseup",this._simtouch_mouseup);SC.platform.windowSizeDeterminesOrientation=YES;SC.device.orientationHandlingShouldChange()},removeEvents:function(d){var b,a=d.length,c;for(b=0;b<a;b++){c=d[b];SC.Event.remove(document,c,SC.RootResponder.responder,SC.RootResponder.responder[c])}},replaceEvent:function(a,b){SC.Event.remove(document,a,SC.RootResponder.responder,SC.RootResponder.responder[a]);SC.Event.add(document,a,this,b)},_simtouch_mousemove:function(a){if(!this._mousedown){if(a.altKey&&this._pinchCenter===null){this._pinchCenter={pageX:a.pageX,pageY:a.pageY,screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY}}else{if(!a.altKey&&this._pinchCenter!==null){this._pinchCenter=null}}return NO}var b=this.manufactureTouchEvent(a,"touchmove");return SC.RootResponder.responder.touchmove(b)},_simtouch_mousedown:function(a){this._mousedown=YES;var b=this.manufactureTouchEvent(a,"touchstart");return SC.RootResponder.responder.touchstart(b)},_simtouch_mouseup:function(a){var c=this.manufactureTouchEvent(a,"touchend"),b=SC.RootResponder.responder.touchend(c);this._mousedown=NO;this._simtouch_counter++;return b},manufactureTouchEvent:function(l,k){var c,m,g=this._simtouch_counter;c={type:k,target:l.target,identifier:g,pageX:l.pageX,pageY:l.pageY,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY};l.touches=[c];if(l.altKey&&this._pinchCenter!==null){var i=this._pinchCenter.pageX+this._pinchCenter.pageX-l.pageX,h=this._pinchCenter.pageY+this._pinchCenter.pageY-l.pageY,f=this._pinchCenter.screenX+this._pinchCenter.screenX-l.screenX,d=this._pinchCenter.screenY+this._pinchCenter.screenY-l.screenY,b=this._pinchCenter.clientX+this._pinchCenter.clientX-l.clientX,a=this._pinchCenter.clientY+this._pinchCenter.clientY-l.clientY,j=this._simtouch_counter+1;m={type:k,target:l.target,identifier:j,pageX:i,pageY:h,screenX:f,screenY:d,clientX:b,clientY:a};l.touches=[c,m]}l.changedTouches=l.touches;return l},supportsCSSTransitions:NO,supportsCSSTransforms:NO,understandsCSS3DTransforms:NO,supportsCSS3DTransforms:NO,supportsAcceleratedLayers:NO,supportsHashChange:function(){return("onhashchange" in window)&&(document.documentMode===undefined||document.documentMode>7)}(),supportsHistory:function(){return !!(window.history&&window.history.pushState)}(),supportsCanvas:function(){return !!document.createElement("canvas").getContext}(),supportsOrientationChange:("onorientationchange" in window),windowSizeDeterminesOrientation:SC.browser.os===SC.OS.ios||!("onorientationchange" in window)});(function(){var a=navigator.userAgent.toLowerCase();if((/webkit/).test(a)){SC.platform.cssPrefix="webkit";SC.platform.domCSSPrefix="Webkit"}else{if((/opera/).test(a)){SC.platform.cssPrefix="opera";SC.platform.domCSSPrefix="O"}else{if((/msie/).test(a)&&!(/opera/).test(a)){SC.platform.cssPrefix="ms";SC.platform.domCSSPrefix="ms"}else{if((/mozilla/).test(a)&&!(/(compatible|webkit)/).test(a)){SC.platform.cssPrefix="moz";SC.platform.domCSSPrefix="Moz"}}}}})();(function(){var b=document.createElement("div");var a=["-moz-","-moz-","-o-","-ms-","-webkit-"],h=["moz","Moz","o","ms","webkit"];var f="",d=null,j,c;for(d=0,c=a.length;d<c;d++){j=a[d];f+=j+"transition:all 1s linear;";f+=j+"transform: translate(1px, 1px);";f+=j+"perspective: 500px;"}b.style.cssText=f;var k;for(d=0,c=h.length;d<c;d++){k=h[d];if(b.style[k+"TransitionProperty"]!==undefined){SC.platform.supportsCSSTransitions=YES}if(b.style[k+"Transform"]!==undefined){SC.platform.supportsCSSTransforms=YES}if(b.style[k+"Perspective"]!==undefined||b.style[k+"PerspectiveProperty"]!==undefined){SC.platform.understandsCSS3DTransforms=YES;SC.platform.supportsCSS3DTransforms=YES}}try{if(window.media&&window.media.matchMedium){if(!window.media.matchMedium("(-webkit-transform-3d)")){SC.platform.supportsCSS3DTransforms=NO}}else{if(window.styleMedia&&window.styleMedia.matchMedium){if(!window.styleMedia.matchMedium("(-webkit-transform-3d)")){SC.platform.supportsCSS3DTransforms=NO}}}}catch(g){SC.platform.supportsCSS3DTransforms=NO}if(SC.platform.supportsCSSTransforms&&SC.platform.cssPrefix==="webkit"){SC.platform.supportsAcceleratedLayers=YES}})();sc_require("system/ready");sc_require("system/platform");SC.CAPTURE_BACKSPACE_KEY=NO;SC.RootResponder=SC.Object.extend({panes:null,init:function(){arguments.callee.base.apply(this,arguments);this.panes=SC.Set.create();if(SC.platform.supportsCSSTransitions){this[SC.platform.cssPrefix+"TransitionEnd"]=this.transitionEnd;this["transitionend"]=this.transitionEnd}},mainPane:null,makeMainPane:function(b){var a=this.get("mainPane");if(a===b){return this}this.beginPropertyChanges();if(this.get("keyPane")===a){this.makeKeyPane(b)}this.set("mainPane",b);if(a){a.blurMainTo(b)}if(b){b.focusMainFrom(a)}this.endPropertyChanges();return this},menuPane:null,makeMenuPane:function(b){if(b&&!b.get("acceptsMenuPane")){return this}else{var a=this.get("menuPane");if(a===b){return this}this.set("menuPane",b)}return this},keyPane:null,previousKeyPanes:[],makeKeyPane:function(g){var f,a,d;if(g){if(!g.get("acceptsKeyPane")){return this}else{a=this.get("keyPane");if(a===g){return this}else{if(a){d=this.get("previousKeyPanes");d.push(a)}f=g}}}else{a=this.get("keyPane");d=this.get("previousKeyPanes");f=null;var c;while(d.length>0){c=d.pop();if(c.get("isPaneAttached")&&c.get("acceptsKeyPane")){f=c;break}}}if(!f){var b=this.get("mainPane");if(b&&b.get("acceptsKeyPane")){f=b}}if(a){a.willLoseKeyPaneTo(f)}if(f){f.willBecomeKeyPaneFrom(a)}this.set("keyPane",f);if(f){f.didBecomeKeyPaneFrom(a)}if(a){a.didLoseKeyPaneTo(f)}return this},currentWindowSize:null,computeWindowSize:function(){var c,b,a;if(!this._bod||!this._docElement){b=document.body;a=document.documentElement;this._bod=b;this._docElement=a}else{b=this._bod;a=this._docElement}if(window.innerHeight){c={width:window.innerWidth,height:window.innerHeight}}else{if(a&&a.clientHeight){c={width:a.clientWidth,height:a.clientHeight}}else{if(b){c={width:b.clientWidth,height:b.clientHeight}}}}return c},resize:function(){this._resize();return YES},_resize:function(){var a=this.computeWindowSize(),b=this.get("currentWindowSize");this.set("currentWindowSize",a);if(!SC.rectsEqual(a,b)){SC.device.windowSizeDidChange(a);if(this.panes){SC.run(function(){this.panes.invoke("windowSizeDidChange",b,a)},this)}}},hasFocus:NO,focus:function(b){if(!this.get("hasFocus")){SC.$("body").addClass("sc-focus").removeClass("sc-blur");if(!SC.TABBING_ONLY_INSIDE_DOCUMENT&&!SC.browser.isIE8OrLower){var a=SC.RootResponder.responder.get("keyPane");if(a){var c=a.get("nextValidKeyView");if(c){a.makeFirstResponder(c)}}}SC.run(function(){this.set("hasFocus",YES)},this)}return YES},focusin:function(a){if(this._focusTimeout){clearTimeout(this._focusTimeout)}this.focus(a)},focusout:function(a){var b=this;this._focusTimeout=setTimeout(function(){b.blur(a)},300)},blur:function(a){if(this.get("hasFocus")){SC.$("body").addClass("sc-blur").removeClass("sc-focus");SC.run(function(){this.set("hasFocus",NO)},this)}return YES},dragDidStart:function(a){this._mouseDownView=a;this._drag=a},defaultResponder:null,sendAction:function(d,f,c,g,b,a){f=this.targetForAction(d,f,c,g,a);if(f&&f.isResponderContext){return !!f.sendAction(d,c,b,a)}else{return f&&f.tryToPerform(d,c)}},_responderFor:function(d,b,a){var c=d?d.get("defaultResponder"):null;if(d){d=a||d.get("firstResponder")||d;do{if(d.respondsTo(b)){return d}}while((d=d.get("nextResponder")))}if(typeof c===SC.T_STRING){c=SC.objectForPropertyPath(c)}if(!c){return null}else{if(c.isResponderContext){return c}else{if(c.respondsTo(b)){return c}else{return null}}}},targetForAction:function(c,g,f,h,a){if(!c||(SC.typeOf(c)!==SC.T_STRING)){return null}if(g){if(SC.typeOf(g)===SC.T_STRING){g=SC.objectForPropertyPath(g)||SC.objectForPropertyPath(g,f)}if(g&&!g.isResponderContext){if(g.respondsTo&&!g.respondsTo(c)){g=null}else{if(SC.typeOf(g[c])!==SC.T_FUNCTION){g=null}}}return g}if(h){g=this._responderFor(h,c,a);if(g){return g}}var b=this.get("keyPane"),d=this.get("mainPane");if(b&&(b!==h)){g=this._responderFor(b,c)}if(!g&&d&&(d!==b)){g=this._responderFor(d,c)}if(!g&&(g=this.get("defaultResponder"))){if(SC.typeOf(g)===SC.T_STRING){g=SC.objectForPropertyPath(g);if(g){this.set("defaultResponder",g)}}if(g&&!g.isResponderContext){if(g.respondsTo&&!g.respondsTo(c)){g=null}else{if(SC.typeOf(g[c])!==SC.T_FUNCTION){g=null}}}}return g},targetViewForEvent:function(a){return a.target?SC.$(a.target).view()[0]:null},sendEvent:function(c,a,d){var f,b;SC.run(function(){if(d){f=d.get("pane")}else{f=this.get("menuPane")||this.get("keyPane")||this.get("mainPane")}b=(f)?f.sendEvent(c,a,d):null},this);return b},listenFor:function(d,c,b,a){b=b?b:this;d.forEach(function(f){var g=b[f];if(g){SC.Event.add(c,f,b,g,null,a)}},this);c=null;return b},setup:function(){this.listenFor(["touchstart","touchmove","touchend","touchcancel"],document);this.listenFor(["keydown","keyup","beforedeactivate","mousedown","mouseup","click","dblclick","mousemove","selectstart","contextmenu"],document).listenFor(["resize"],window);if(SC.browser.isIE8OrLower){this.listenFor(["focusin","focusout"],document)}else{this.listenFor(["focus","blur"],window)}this.listenFor(["webkitAnimationStart","webkitAnimationIteration","webkitAnimationEnd"],document);if(SC.platform.supportsCSSTransitions){this.listenFor(["transitionend",SC.platform.cssPrefix+"TransitionEnd"],document)}if(this.keypress){if(SC.CAPTURE_BACKSPACE_KEY&&SC.browser.isMozilla){var b=this;document.onkeypress=function(f){f=SC.Event.normalizeEvent(f);return b.keypress.call(b,f)}}else{SC.Event.add(document,"keypress",this,this.keypress)}}["drag","selectstart"].forEach(function(g){var h=this[g];if(h){if(SC.browser.isIE){var f=this;document.body["on"+g]=function(i){return h.call(f,SC.Event.normalizeEvent(event||window.event))};SC.Event.add(window,"unload",this,function(){document.body["on"+g]=null})}else{SC.Event.add(document,g,this,h)}}},this);var a="mousewheel";if(SC.browser.isMozilla){if(SC.browser.compare(SC.browser.engineVersion,"1.9.1")<0){a="DOMMouseScroll"}else{a="MozMousePixelScroll"}}SC.Event.add(document,a,this,this.mousewheel);this.set("currentWindowSize",this.computeWindowSize());if(SC.browser.os===SC.OS.ios&&SC.browser.name===SC.BROWSER.safari){if(SC.platform&&!SC.platform.touch){SC.platform.simulateTouchEvents()}var c=SC.RunLoop.prototype.endRunLoop,d;d=function(){if(c){c.apply(this,arguments)}var j=SC.RootResponder.responder._touches,i,f,k,g,m,n=NO;if(j){for(i in j){if(j[i]._rescuedElement){continue}k=f=j[i].target;while(f&&(f=f.parentNode)&&!n){n=(f===document.body)}if(!n&&k){if(k.parentNode&&k.cloneNode){var l=k.cloneNode(true);k.parentNode.replaceChild(l,k);k.swapNode=l}var h=SC.touchHoldingPen;if(!h){h=SC.touchHoldingPen=document.createElement("div");h.style.display="none";document.body.appendChild(h)}h.appendChild(k);j[i]._rescuedElement=k}}}};SC.RunLoop.prototype.endRunLoop=d}},_touchedViews:{},_touches:{},touchesForView:function(a){if(this._touchedViews[SC.guidFor(a)]){return this._touchedViews[SC.guidFor(a)].touches}},averagedTouchesForView:function(j,h){var n=this.touchesForView(j),b=j._scrr_averagedTouches||(j._scrr_averagedTouches={});if((!n||n.length===0)&&!h){b.x=0;b.y=0;b.d=0;b.touchCount=0}else{var f=this._averagedTouches_touches||(this._averagedTouches_touches=[]);f.length=0;if(n){var d,g=n.length;for(d=0;d<g;d++){f.push(n[d])}}if(h){f.push(h)}var k,c,a=0,p=0,o,m,l=0;g=f.length;for(k=0;k<g;k++){c=f[k];a+=c.pageX;p+=c.pageY}a/=g;p/=g;for(k=0;k<g;k++){c=f[k];o=Math.abs(c.pageX-a);m=Math.abs(c.pageY-p);l+=Math.pow(o*o+m*m,0.5)}l/=g;b.x=a;b.y=p;b.d=l;b.touchCount=g}return b},assignTouch:function(b,a){if(b.hasEnded){throw"Attempt to assign a touch that is already finished."}if(b.view===a){return}if(b.view){this.unassignTouch(b)}if(!this._touchedViews[SC.guidFor(a)]){this._touchedViews[SC.guidFor(a)]={view:a,touches:SC.CoreSet.create([]),touchCount:0};a.set("hasTouch",YES)}b.view=a;this._touchedViews[SC.guidFor(a)].touches.add(b);this._touchedViews[SC.guidFor(a)].touchCount++},unassignTouch:function(c){var a,b;if(!c.view){return}a=c.view;b=this._touchedViews[SC.guidFor(a)];b.touches.remove(c);b.touchCount--;if(b.touchCount<1){a.set("hasTouch",NO);b.view=null;delete this._touchedViews[SC.guidFor(a)]}c.view=undefined},_flushQueuedTouchResponder:function(){if(this._queuedTouchResponder){var a=this._queuedTouchResponder;this._queuedTouchResponder=null;this.makeTouchResponder.apply(this,a)}},makeTouchResponder:function(f,d,c,k){if(this._isMakingTouchResponder){this._queuedTouchResponder=[f,d,c,k];return}this._isMakingTouchResponder=YES;var h=f.touchResponders,b;if(f.touchResponder===d){this._isMakingTouchResponder=NO;this._flushQueuedTouchResponder();return}var a;if(d){a=d.get("pane")}else{a=this.get("keyPane")||this.get("mainPane")}if(h.indexOf(d)<0){if(k){try{d=(a)?a.sendEvent("touchStart",f,d):null}catch(g){SC.Logger.error("Error in touchStart: "+g);d=null}}else{if(d&&((d.get?d.get("acceptsMultitouch"):d.acceptsMultitouch)||!d.hasTouch)){if(!d.touchStart(f)){d=null}}else{}}}if(!c||(h.indexOf(d)>-1&&h[h.length-1]!==d)){this.unassignTouch(f);var i=h.length-1,j=h[i];while(j&&j!==d){b=this.touchesForView(j);if((j.get?j.get("acceptsMultitouch"):j.acceptsMultitouch)||!b){if(j.touchCancelled){j.touchCancelled(f)}}i--;j=h[i];h.pop();f.touchResponder=h[i];f.nextTouchResponder=h[i-1]}}if(d){this.assignTouch(f,d);if(d!==f.touchResponder){h.push(d);f.touchResponder=d;f.nextTouchResponder=h[h.length-2]}}this._isMakingTouchResponder=NO;this._flushQueuedTouchResponder()},captureTouch:function(i,f,h){if(!f){f=this}var g=i.targetView,c=g,d=[],b,a;if(g.get("touchPriority")){this.makeTouchResponder(i,g,h,YES);return}if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("  -- Received one touch on %@".fmt(g.toString()))}while(c&&(c!==f)){d.unshift(c);c=c.get("nextResponder")}for(a=d.length,b=0;b<a;b++){c=d[b];if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("  -- Checking %@ for captureTouch response".fmt(c.toString()))}if(c.tryToPerform("captureTouch",i)){if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("   -- Making %@ touch responder because it returns YES to captureTouch".fmt(c.toString()))}this.makeTouchResponder(i,c,h,YES);return}}if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("   -- Didn't find a view that returned YES to captureTouch, so we're calling touchStart")}this.makeTouchResponder(i,g,h,YES)},endMissingTouches:function(f){var b,a=f.length,d={},c=[];for(b=0;b<a;b++){d[f[b].identifier]=YES}for(b in this._touches){var g=this._touches[b].identifier;if(!d[g]){c.push(this._touches[b])}}for(b=0,a=c.length;b<a;b++){this.endTouch(c[b]);this.finishTouch(c[b])}},_touchCount:0,endTouch:function(b,h,c){if(!h){h="touchEnd"}var a,g,d,f;this.unassignTouch(b);if(b.touchResponder){f=b.touchResponder;g=b.touchResponders;a=g.length-1;d=g[a];while(d){if(d[h]){d[h](b,c)}if(b.touchResponder!==f){break}a--;d=g[a];h="touchCancelled"}}},finishTouch:function(b){var a;this.unassignTouch(b);if(a=b._rescuedElement){if(a.swapNode&&a.swapNode.parentNode){a.swapNode.parentNode.replaceChild(a,a.swapNode)}else{if(a.parentNode===SC.touchHoldingPen){SC.touchHoldingPen.removeChild(a)}}delete b._rescuedElement;a.swapNode=null;a=null}b.touchResponders=null;b.touchResponder=null;b.nextTouchResponder=null;b.hasEnded=YES;if(this._touches[b.identifier]){delete this._touches[b.identifier]}},touchstart:function(a){if(this.ignoreTouchHandle(a)){return YES}var b=NO;SC.run(function(){this.endMissingTouches(a.touches);var f,i=a.changedTouches,d=i.length,h,g,j,c;a.touchContext=this;for(f=0;f<d;f++){j=i[f];c=SC.Touch.create(j,this);if(!c.targetView){continue}if(c.hidesTouchIntercept){b=YES}c.timeStamp=a.timeStamp;this._touches[j.identifier]=c;c.event=a;this.captureTouch(c,this);c.event=null}},this);if(b){return YES}return a.hasCustomEventHandling},touchmove:function(a){if(this.ignoreTouchHandle(a)){return YES}SC.run(function(){var c=a.changedTouches,b,o,m,g=c.length,l,k,j,n,h={},f,i,d=NO;if(this._drag){b=SC.Touch.create(a.changedTouches[0],this);this._drag.tryToPerform("mouseDragged",b)}for(m=0;m<g;m++){b=c[m];o=this._touches[b.identifier];if(!o){continue}if(o.hidesTouchIntercept){d=YES}o.pageX=b.pageX;o.pageY=b.pageY;o.clientX=b.clientX;o.clientY=b.clientY;o.screenX=b.screenX;o.screenY=b.screenY;o.timeStamp=a.timeStamp;o.event=a;if(o.touchResponder){l=o.touchResponder;i=SC.guidFor(l);if(!h[i]){h[i]={view:l,touches:[]}}h[i].touches.push(o)}}if(d){a.allowDefault();return YES}for(m in h){l=h[m].view;k=h[m].touches;a.viewChangedTouches=k;j=this.touchesForView(l);n=j.firstObject();a.pageX=n.pageX;a.pageY=n.pageY;a.clientX=n.clientX;a.clientY=n.clientY;a.screenX=n.screenX;a.screenY=n.screenY;a.touchContext=this;l.tryToPerform("touchesDragged",a,j)}c=a.changedTouches;g=c.length;for(m=0;m<g;m++){b=c[m];o=this._touches[b.identifier];if(o){o.event=null}}},this);return a.hasCustomEventHandling},touchend:function(a){var b=NO;if(this.ignoreTouchHandle(a)){return YES}SC.run(function(){var i=a.changedTouches,h,o,m,j=i.length,k,c,g=a.isCancel?"touchCancelled":"touchEnd",l,n,d,f;for(m=0;m<j;m++){h=i[m];h.type="touchend";o=this._touches[h.identifier];if(!o){continue}o.timeStamp=a.timeStamp;o.pageX=h.pageX;o.pageY=h.pageY;o.clientX=h.clientX;o.clientY=h.clientY;o.screenX=h.screenX;o.screenY=h.screenY;o.type="touchend";o.event=a;if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("-- Received touch end")}if(o.hidesTouchIntercept){o.unhideTouchIntercept();b=YES}if(this._drag){this._drag.tryToPerform("mouseUp",h);this._drag=null}this.endTouch(o,g,a);this.finishTouch(o)}},this);if(b){return YES}return a.hasCustomEventHandling},touchcancel:function(a){a.isCancel=YES;this.touchend(a)},ignoreTouchHandle:function(b){if(SC.browser.isMobileSafari){var a=b.target.tagName;if(a==="INPUT"||a==="TEXTAREA"||a==="A"||a==="SELECT"){b.allowDefault();return YES}}return NO},attemptKeyEquivalent:function(b){var d=null;var c=b.commandCodes()[0];if(!c){return NO}var g=this.get("menuPane"),a=this.get("keyPane"),f=this.get("mainPane");if(g){d=g.performKeyEquivalent(c,b);if(d){return d}}if(a){d=a.performKeyEquivalent(c,b);if(d||a.get("isModal")){return d}}if(!d&&f&&(f!==a)){d=f.performKeyEquivalent(c,b);if(d||f.get("isModal")){return d}}return d},_lastModifiers:null,_handleModifierChanges:function(b){var a;a=this._lastModifiers=(this._lastModifiers||{alt:false,ctrl:false,shift:false});var c=false;if(b.altKey!==a.alt){a.alt=b.altKey;c=true}if(b.ctrlKey!==a.ctrl){a.ctrl=b.ctrlKey;c=true}if(b.shiftKey!==a.shift){a.shift=b.shiftKey;c=true}b.modifiers=a;return(c)?(this.sendEvent("flagsChanged",b)?b.hasCustomEventHandling:YES):YES},_isFunctionOrNonPrintableKey:function(a){return !!(a.altKey||a.ctrlKey||a.metaKey||((a.charCode!==a.which)&&SC.FUNCTION_KEYS[a.which]))},_isModifierKey:function(a){return !!SC.MODIFIER_KEYS[a.charCode]},keydown:function(a){if(SC.none(a)){return YES}var f=a.keyCode;if(SC.browser.isMozilla&&a.keyCode===9){this.keydownCounter=1}if(f===229){this._IMEInputON=YES;return this.sendEvent("keyDown",a)}if(f===27&&this._drag){this._drag.cancelDrag();this._drag=null;this._mouseDownView=null;return YES}if(SC.browser.isMozilla&&(a.which===8)){return true}var b=this._handleModifierChanges(a),d=a.target||a.srcElement,c=(a.which===8)&&!SC.allowsBackspaceToPreviousPage&&(d===document.body);if(this._isModifierKey(a)){return(c?NO:b)}b=YES;if(this._isFunctionOrNonPrintableKey(a)){if(f>=37&&f<=40&&SC.browser.isMozilla){return YES}b=this.sendEvent("keyDown",a);if(!b){b=!this.attemptKeyEquivalent(a)}else{b=a.hasCustomEventHandling;if(b){c=NO}}}return c?NO:b},keypress:function(b){var c,f=b.keyCode,g=SC.browser.isMozilla;if(g&&b.keyCode===9){this.keydownCounter++;if(this.keydownCounter==2){return YES}}if(g&&(b.which===8)){b.which=f;c=this.sendEvent("keyDown",b);return c?(SC.allowsBackspaceToPreviousPage||b.hasCustomEventHandling):YES}else{var d=(f>=37&&f<=40&&g),a=b.charCode;if((a!==undefined&&a===0&&b.keyCode!==9)&&!d){return YES}if(d){b.which=f}if(d||!this._isFunctionOrNonPrintableKey(b)){return this.sendEvent("keyDown",b)?b.hasCustomEventHandling:YES}}},keyup:function(a){if(this._ffevt){this._ffevt=null}var b=this._handleModifierChanges(a);if(this._isModifierKey(a)){return b}if(this._IMEInputON&&a.keyCode===13){a.isIMEInput=YES;this.sendEvent("keyDown",a);this._IMEInputON=NO}return this.sendEvent("keyUp",a)?a.hasCustomEventHandling:YES},beforedeactivate:function(c){var b=c.toElement;if(b&&b.tagName&&b.tagName!=="IFRAME"){var a=SC.$(b).view()[0];if(a&&a.get("blocksIEDeactivate")){return NO}}return YES},mousedown:function(f){var d;if(SC.platform.touch){f.allowDefault();this._lastMouseDownCustomHandling=YES;return YES}this._clickCount+=1;if(!this._lastMouseUpAt||((Date.now()-this._lastMouseUpAt)>250)){this._clickCount=1}else{var c=this._lastMouseDownX-f.clientX,a=this._lastMouseDownY-f.clientY,h=Math.sqrt(c*c+a*a);if(h>8){this._clickCount=1}}f.clickCount=this._clickCount;this._lastMouseDownX=f.clientX;this._lastMouseDownY=f.clientY;var b=this.targetViewForEvent(f);if(b){d=b.getPath("pane.firstResponder")}if(d&&d.get("blurOnMouseDown")&&d!==b){d.resignFirstResponder(f)}b=this._mouseDownView=this.sendEvent("mouseDown",f,b);if(b&&b.respondsTo("mouseDragged")){this._mouseCanDrag=YES}var g=b?f.hasCustomEventHandling:YES;this._lastMouseDownCustomHandling=g;return g},mouseup:function(b){var g=NO;if(SC.platform.touch){b.allowDefault();this._lastMouseUpCustomHandling=YES;return YES}if(this._drag){this._drag.tryToPerform("mouseUp",b);this._drag=null}var f=null,a=this._mouseDownView,d=this.targetViewForEvent(b);b.clickCount=this._clickCount;if(a){f=this.sendEvent("mouseUp",b,a);if(!f&&(this._clickCount===2)){f=this.sendEvent("doubleClick",b,a);g=YES}if(!f){f=this.sendEvent("click",b,a);g=YES}}if(!f&&!g){if(this._clickCount===2){f=this.sendEvent("doubleClick",b,d)}if(!f){f=this.sendEvent("click",b,d)}}this._mouseCanDrag=NO;this._mouseDownView=null;this._lastMouseUpAt=Date.now();var c=f?b.hasCustomEventHandling:YES;this._lastMouseUpCustomHandling=c;return c},click:function(a){if(!this._lastMouseUpCustomHandling||!this._lastMouseDownCustomHandling){a.preventDefault();a.stopPropagation();return NO}return YES},dblclick:function(a){if(SC.browser.isIE8OrLower){this._clickCount=2;this.mouseup(a)}},mousewheel:function(b){var a=this.targetViewForEvent(b),c=this.sendEvent("mouseWheel",b,a);return(c)?b.hasCustomEventHandling:YES},_lastHovered:null,mousemove:function(a){if(SC.platform.touch){a.allowDefault();return YES}if(SC.browser.isIE){if(this._lastMoveX===a.clientX&&this._lastMoveY===a.clientY){return}}this._lastMoveX=a.clientX;this._lastMoveY=a.clientY;SC.run(function(){if(this._drag){if(SC.browser.isIE){if(this._lastMouseDownX!==a.clientX||this._lastMouseDownY!==a.clientY){this._drag.tryToPerform("mouseDragged",a)}}else{this._drag.tryToPerform("mouseDragged",a)}}else{var d=this._lastHovered||[],f=[],h,g,b,c=this.targetViewForEvent(a);while(c&&(c!==this)){f.push(c);c=c.get("nextResponder")}for(g=0,b=d.length;g<b;g++){c=d[g];h=c.respondsTo("mouseExited");if(h&&f.indexOf(c)===-1){c.tryToPerform("mouseExited",a)}}for(g=0,b=f.length;g<b;g++){c=f[g];if(d.indexOf(c)!==-1){c.tryToPerform("mouseMoved",a)}else{c.tryToPerform("mouseEntered",a)}}this._lastHovered=f;if(this._mouseDownView){if(SC.browser.isIE){if(this._lastMouseDownX!==a.clientX&&this._lastMouseDownY!==a.clientY){this._mouseDownView.tryToPerform("mouseDragged",a)}}else{this._mouseDownView.tryToPerform("mouseDragged",a)}}}},this)},_mouseCanDrag:YES,selectstart:function(b){var c=this.targetViewForEvent(b),a=this.sendEvent("selectStart",b,c);if(c&&c.respondsTo("mouseDragged")){return(a!==null?YES:NO)&&!this._mouseCanDrag}else{return(a!==null?YES:NO)}},drag:function(){return false},contextmenu:function(b){var a=this.targetViewForEvent(b);return this.sendEvent("contextMenu",b,a)},webkitAnimationStart:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("animationDidStart",b,a)}catch(c){SC.Logger.warn("Exception during animationDidStart: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES},webkitAnimationIteration:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("animationDidIterate",b,a)}catch(c){SC.Logger.warn("Exception during animationDidIterate: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES},webkitAnimationEnd:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("animationDidEnd",b,a)}catch(c){SC.Logger.warn("Exception during animationDidEnd: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES},transitionEnd:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("transitionDidEnd",b,a)}catch(c){SC.Logger.warn("Exception during transitionDidEnd: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES}});SC.Touch=function(d,a){this.touchContext=a;this.identifier=d.identifier;var c=d.target,b;if(c&&SC.$(c).hasClass("touch-intercept")){d.target.style.webkitTransform="translate3d(0px,-5000px,0px)";c=document.elementFromPoint(d.pageX,d.pageY);if(c){b=SC.$(c).view()[0]}this.hidesTouchIntercept=NO;if(c.tagName==="INPUT"){this.hidesTouchIntercept=d.target}else{d.target.style.webkitTransform="translate3d(0px,0px,0px)"}}else{b=d.target?SC.$(d.target).view()[0]:null}this.targetView=b;this.target=c;this.hasEnded=NO;this.type=d.type;this.clickCount=1;this.view=undefined;this.touchResponder=this.nextTouchResponder=undefined;this.touchResponders=[];this.startX=this.pageX=d.pageX;this.startY=this.pageY=d.pageY;this.clientX=d.clientX;this.clientY=d.clientY;this.screenX=d.screenX;this.screenY=d.screenY};SC.Touch.prototype={unhideTouchIntercept:function(){var a=this.hidesTouchIntercept;if(a){setTimeout(function(){a.style.webkitTransform="translate3d(0px,0px,0px)"},500)}},allowDefault:function(){if(this.event){this.event.hasCustomEventHandling=YES}},preventDefault:function(){if(this.event){this.event.preventDefault()}},stopPropagation:function(){if(this.event){this.event.stopPropagation()}},stop:function(){if(this.event){this.event.stop()}},end:function(){this.touchContext.endTouch(this)},makeTouchResponder:function(b,c,a){this.touchContext.makeTouchResponder(this,b,c,a)},captureTouch:function(a,b){this.touchContext.captureTouch(this,a,b)},touchesForView:function(a){return this.touchContext.touchesForView(a)},touchesForResponder:function(a){return this.touchContext.touchesForView(a)},averagedTouchesForView:function(a,b){return this.touchContext.averagedTouchesForView(a,(b?this:null))}};SC.mixin(SC.Touch,{create:function(b,a){return new SC.Touch(b,a)}});SC.ready(SC.RootResponder,SC.RootResponder.ready=function(){var a;a=SC.RootResponder.responder=SC.RootResponder.create();a.setup()});sc_require("system/core_query");sc_require("system/ready");sc_require("system/root_responder");sc_require("system/platform");SC.PORTRAIT_ORIENTATION="portrait";SC.LANDSCAPE_ORIENTATION="landscape";SC.NO_ORIENTATION="desktop";SC.device=SC.Object.create({orientation:SC.NO_ORIENTATION,isOffline:NO,mouseLocation:function(){var a=SC.RootResponder.responder,c=a._lastMoveX,b=a._lastMoveY;if(SC.empty(c)||SC.empty(b)){return null}return{x:c,y:b}}.property(),init:function(){arguments.callee.base.apply(this,arguments);if(navigator&&navigator.onLine===false){this.set("isOffline",YES)}},setup:function(){var a=SC.RootResponder.responder;a.listenFor(["online","offline"],window,this);this.orientationHandlingShouldChange()},orientationHandlingShouldChange:function(){if(SC.platform.windowSizeDeterminesOrientation){SC.Event.remove(window,"orientationchange",this,this.orientationchange);this.windowSizeDidChange(SC.RootResponder.responder.get("currentWindowSize"))}else{if(SC.platform.supportsOrientationChange){SC.Event.add(window,"orientationchange",this,this.orientationchange);this.orientationchange()}}},windowSizeDidChange:function(a){if(SC.platform.windowSizeDeterminesOrientation){if(!SC.browser.iOS){SC.run(function(){if(SC.platform.touch){if(a.height>=a.width){SC.device.set("orientation",SC.PORTRAIT_ORIENTATION)}else{SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}}else{SC.device.set("orientation",SC.NO_ORIENTATION)}})}else{SC.run(function(){if(a.width===window.screen.width){SC.device.set("orientation",SC.PORTRAIT_ORIENTATION)}else{SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}})}return YES}return NO},orientationchange:function(a){SC.run(function(){if(window.orientation===0||window.orientation===180){SC.device.set("orientation",SC.PORTRAIT_ORIENTATION)}else{SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}})},orientationObserver:function(){var a=SC.$(document.body),b=this.get("orientation");if(b===SC.PORTRAIT_ORIENTATION){a.addClass("portrait")}else{a.removeClass("portrait")}if(b===SC.LANDSCAPE_ORIENTATION){a.addClass("landscape")}else{a.removeClass("landscape")}}.observes("orientation"),online:function(a){this.set("isOffline",NO)},offline:function(a){this.set("isOffline",YES)}});SC.ready(function(){SC.device.setup()});SC.MODIFIED_KEY_BINDINGS={"ctrl_.":"cancel",shift_tab:"insertBacktab",shift_left:"moveLeftAndModifySelection",shift_right:"moveRightAndModifySelection",shift_up:"moveUpAndModifySelection",shift_down:"moveDownAndModifySelection",alt_left:"moveLeftAndModifySelection",alt_right:"moveRightAndModifySelection",alt_up:"moveUpAndModifySelection",alt_down:"moveDownAndModifySelection",ctrl_a:"selectAll"};SC.BASE_KEY_BINDINGS={escape:"cancel",backspace:"deleteBackward","delete":"deleteForward","return":"insertNewline",tab:"insertTab",left:"moveLeft",right:"moveRight",up:"moveUp",down:"moveDown",home:"moveToBeginningOfDocument",end:"moveToEndOfDocument",pagedown:"pageDown",pageup:"pageUp"};SC.Page=SC.Object.extend({owner:null,get:function(a){var b=this[a];if(b&&b.isClass){this[a]=b=b.create({page:this});if(!this.get("inDesignMode")){b.awake()}return b}else{return arguments.callee.base.apply(this,arguments)}},awake:function(){var b,a;for(a in this){if(!this.hasOwnProperty(a)){continue}b=this[a];if(b&&b.isViewClass){this[a]=b=b.create({page:this})}}return this},getIfConfigured:function(b){var a=this[b];return(a&&a.isViewClass)?null:this.get(b)},loc:function(c){var a,b;for(b in c){if(!c.hasOwnProperty(b)){continue}a=this[b];if(!a||!a.isViewClass){continue}a.loc(c[b])}return this}});SC.Page.design=SC.Page.create;SC.Page.localization=function(a){return a};sc_require("system/builder");SC.MODE_REPLACE="replace";SC.MODE_APPEND="append";SC.MODE_PREPEND="prepend";SC.NON_PIXEL_PROPERTIES=["zIndex","fontWeight","opacity"];SC.COMBO_STYLES={WebkitTransition:["WebkitTransitionProperty","WebkitTransitionDuration","WebkitTransitionDelay","WebkitTransitionTimingFunction"]};SC.RenderContext=SC.Builder.create({SELF_CLOSING:SC.CoreSet.create().addEach(["area","base","basefront","br","hr","input","img","link","meta"]),init:function(f,d){var b,a;if(d){this.prevObject=d;this.strings=d.strings;this.offset=d.length+d.offset}if(!this.strings){this.strings=[]}if(f===undefined){f="div";a=YES}else{if(f==="div"||f==="label"||f==="a"){a=YES}else{if(SC.typeOf(f)===SC.T_STRING){f=f.toLowerCase();a=YES}}}if(a){this._tagName=f;this._needsTag=YES;this.needsContent=YES;var g=this;while(g){g.length++;g=g.prevObject}this.strings.push(null);this._selfClosing=this.SELF_CLOSING.contains(f)}else{this._elem=f;this._needsTag=NO;this.length=0;this.needsContent=NO}return this},strings:null,offset:0,length:0,updateMode:SC.MODE_REPLACE,needsContent:NO,get:function(b){var a=this.strings||[];return(b===undefined)?a.slice(this.offset,this.length):a[b+this.offset]},push:function(d){var b=this.strings,a=arguments.length;if(!b){this.strings=b=[]}if(a>1){b.push.apply(b,arguments)}else{b.push(d)}var f=this;while(f){f.length+=a;f=f.prevObject}this.needsContent=YES;return this},text:function(c){var b=arguments.length,a=0;for(a=0;a<b;a++){this.push(SC.RenderContext.escapeHTML(arguments[a]))}return this},join:function(b){if(this._needsTag){this.end()}var a=this.strings;return a?a.join(b||""):""},begin:function(a){return SC.RenderContext(a,this)},element:function(){return this._elem?this._elem:SC.$(this.join())[0]},remove:function(a){if(!a){return}var b,c=this._elem;if(!c||!c.removeChild){return}b=document.getElementById(a);if(b){b=c.removeChild(b);b=null}},update:function(){var c=this._elem,h=this.updateMode,f,d,a,g,b;this._innerHTMLReplaced=NO;if(!c){return}f=this.$();if(this.length>0){this._innerHTMLReplaced=YES;if(h===SC.MODE_REPLACE){f.html(this.join())}else{a=c.cloneNode(false);a.innerHTML=this.join();g=a.firstChild;while(g){b=g.nextSibling;c.insertBefore(g,b);g=b}g=b=a=null}}if(this._idDidChange&&(d=this._id)){f.attr("id",d)}jQuery.Buffer.flush();c=this._elem=null;return this.prevObject||this},_DEFAULT_ATTRS:{},end:function(){var o="",b="",d,m,k,i,l=this._attrs,f=this._classNames,a=this._id,n=this._styles,j,h;o="<"+this._tagName;if(l||f||n||a){if(!l){l=this._DEFAULT_ATTRS}if(a){l.id=a}if(f){l["class"]=f.join(" ")}if(n){for(k in n){if(!n.hasOwnProperty(k)){continue}i=n[k];if(i===null){continue}if(typeof i===SC.T_NUMBER&&!SC.NON_PIXEL_PROPERTIES.contains(k)){i+="px"}b=b+this._dasherizeStyleName(k)+": "+i+"; "}l.style=b}o=o+" ";for(k in l){if(!l.hasOwnProperty(k)){continue}i=l[k];if(i===null){continue}o=o+k+'="'+i+'" '}if(l===this._DEFAULT_ATTRS){delete l.style;delete l["class"];delete l.id}}j=this.strings;h=(this._selfClosing===NO)?NO:(this.length===1);o=o+(h?" />":">");j[this.offset]=o;if(!h){j.push("</"+this._tagName+">");var g=this;while(g){g.length++;g=g.prevObject}}this._elem=null;return this.prevObject||this},tag:function(a,b){return this.begin(a,b).end()},tagName:function(a){if(a===undefined){if(!this._tagName&&this._elem){this._tagName=this._elem.tagName}return this._tagName}else{this._tagName=a;this._tagNameDidChange=YES;return this}},id:function(a){if(a===undefined){if(!this._id&&this._elem){this._id=this._elem.id}return this._id}else{this._id=a;this._idDidChange=YES;return this}},classNames:function(b,a){if(this._elem){if(b){this.$().resetClassNames().addClass(b);return this}else{return this.$().attr("class").split(" ")}}if(b===undefined){if(this._cloneClassNames){this._classNames=(this._classNames||[]).slice();this._cloneClassNames=NO}if(!this._classNames){this._classNames=[]}return this._classNames}else{this._classNames=b;this._cloneClassNames=a||NO;this._classNamesDidChange=YES;return this}},hasClass:function(a){if(this._elem){return this.$().hasClass(a)}return this.classNames().indexOf(a)>=0},addClass:function(g){if(g===undefined||g===null){SC.Logger.warn("You are adding an undefined or empty class"+this.toString());return this}if(this._elem){if(SC.typeOf(g)===SC.T_STRING){this.$().addClass(g)}else{var c,b=g.length;for(c=0;c<b;c++){this.$().addClass(g[c])}}return this}var h=this.classNames();if(SC.typeOf(g)===SC.T_STRING){if(h.indexOf(g)<0){h.push(g);this._classNamesDidChange=YES}}else{var d;for(var f=0,a=g.length;f<a;f++){d=g[f];if(h.indexOf(d)<0){h.push(d);this._classNamesDidChange=YES}}}return this},removeClass:function(b){if(this._elem){this.$().removeClass(b);return this}var c=this._classNames,a;if(c&&(a=c.indexOf(b))>=0){if(this._cloneClassNames){c=this._classNames=c.slice();this._cloneClassNames=NO}c[a]=null;this._classNamesDidChange=YES}return this},resetClassNames:function(){if(this._elem){this.$().resetClassNames();return this}this._classNames=[];this._classNamesDidChange=YES;return this},setClass:function(d,c){if(this._elem){this.$().setClass(d,c);return this}var g,a,b,f;if(c!==undefined){return c?this.addClass(d):this.removeClass(d)}else{g=this._classNames;if(!g){g=this._classNames=[]}if(this._cloneClassNames){g=this._classNames=g.slice();this._cloneClassNames=NO}f=NO;for(b in d){if(!d.hasOwnProperty(b)){continue}a=g.indexOf(b);if(d[b]){if(a<0){g.push(b);f=YES}}else{if(a>=0){g[a]=null;f=YES}}}if(f){this._classNamesDidChange=YES}}return this},_STYLE_REGEX:/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,styles:function(d,f){if(this._elem){if(d){this.$().resetStyles().css(d)}return this.$().styles()}var a,c,b;if(d===undefined){if(!this._styles&&this._elem){a=this.$().attr("style");if(a&&(a=a.toString()).length>0){if(SC.browser.name===SC.BROWSER.ie){a=a.toLowerCase()}d={};c=this._STYLE_REGEX;c.lastIndex=0;while(b=c.exec(a)){d[this._camelizeStyleName(b[1])]=b[2]}this._styles=d;this._cloneStyles=NO}else{this._styles={}}}else{if(!this._styles){this._styles={}}else{if(this._cloneStyles){this._styles=SC.clone(this._styles);this._cloneStyles=NO}}}return this._styles}else{this._styles=d;this._cloneStyles=f||NO;this._stylesDidChange=YES;return this}},_deleteComboStyles:function(f,d){var h=SC.COMBO_STYLES[d],g=NO,c;if(h){for(var a=0,b=h.length;a<b;a++){c=h[a];if(f[c]){delete f[c];g=YES}}}return g},resetStyles:function(){this.styles({});return this},addStyle:function(a,f){if(this._elem){this.$().css(a,f);return this}var b,d=NO,c=this.styles();if(typeof a===SC.T_STRING){if(f===undefined){return c[a]}else{d=this._deleteComboStyles(c,a);if(c[a]!==f){c[a]=f;d=YES}if(d){this._stylesDidChange=YES}}}else{for(b in a){if(!a.hasOwnProperty(b)){continue}d=d||this._deleteComboStyles(c,b);f=a[b];if(c[b]!==f){c[b]=f;d=YES}}if(d){this._stylesDidChange=YES}}return this},removeStyle:function(a){if(this._elem){this.$().css(a,null);return this}if(!this._styles){return this}var b=this.styles();if(b[a]){b[a]=null;this._stylesDidChange=YES}},attr:function(a,f){if(this._elem){this.$().attr(a,f);return this}var c,b=this._attrs,d=NO;if(!b){this._attrs=b={}}if(typeof a===SC.T_STRING){if(f===undefined){return b[a]}else{if(b[a]!==f){b[a]=f;this._attrsDidChange=YES}}}else{for(c in a){if(!a.hasOwnProperty(c)){continue}f=a[c];if(b[c]!==f){b[c]=f;d=YES}}if(d){this._attrsDidChange=YES}}return this},removeAttr:function(a){if(this._elem){this.$().removeAttr(a);return this}},$:function(c){var a,b=this._elem;a=!b?SC.$.buffer([]):(c===undefined)?SC.$.buffer(b):SC.$.buffer(c,b);b=null;return a},_camelizeStyleName:function(a){var b=a.match(/^-(webkit|moz|o)-/),c=SC.String.camelize(a);if(b){return c.substr(0,1).toUpperCase()+c.substr(1)}else{return c}},_dasherizeStyleName:function(a){var b=SC.String.dasherize(a);if(b.match(/^(webkit|moz|ms|o)-/)){b="-"+b}return b}});SC.RenderContext.fn.html=SC.RenderContext.fn.push;SC.RenderContext.fn.css=SC.RenderContext.fn.addStyle;(function(){var b=/[&<>]/g,a=function(c){switch(c){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;"}};SC.RenderContext.escapeHTML=function(c){if(!c){return""}if(SC.typeOf(c)===SC.T_NUMBER){c=c.toString()}return c.replace(b,a)}})();(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelRequestAnimationFrame=window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(i,f){var d=new Date().getTime();var g=Math.max(0,16-(d-b));var h=window.setTimeout(function(){i(d+g)},g);b=d+g;return h}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());SC.SelectionSet=SC.Object.extend(SC.Enumerable,SC.Freezable,SC.Copyable,{isSelectionSet:YES,length:function(){var a=0,b=this._sets,c=this._objects;if(c){a+=c.get("length")}if(b){b.forEach(function(d){a+=d.get("length")})}return a}.property().cacheable(),sources:function(){var c=[],d=this._sets,b=d?d.length:0,a,g,f;for(a=0;a<b;a++){g=d[a];if(g&&g.get("length")>0&&g.source){c.push(g.source)}}return c}.property().cacheable(),indexSetForSource:function(f){if(!f||!f.isSCArray){return null}var b=this._indexSetCache,d=this._objects,c,a;if(!b){b=this._indexSetCache={}}c=b[SC.guidFor(f)];if(c&&c._sourceRevision&&(c._sourceRevision!==f.propertyRevision)){c=null}if(!c){c=this._indexSetForSource(f,NO);if(c&&c.get("length")===0){c=null}if(d){if(c){c=c.copy()}d.forEach(function(g){if((a=f.indexOf(g))>=0){if(!c){c=SC.IndexSet.create()}c.add(a)}},this)}if(c){c=b[SC.guidFor(f)]=c.frozenCopy();c._sourceRevision=f.propertyRevision}}return c},_indexSetForSource:function(g,h){if(h===undefined){h=YES}var d=SC.guidFor(g),c=this[d],f=this._sets,a=f?f.length:0,b=null;if(c>=a){c=null}if(SC.none(c)){if(h&&!this.isFrozen){this.propertyWillChange("sources");if(!f){f=this._sets=[]}b=f[a]=SC.IndexSet.create();b.source=g;this[d]=a;this.propertyDidChange("sources")}}else{b=f?f[c]:null}return b},add:function(a,b,d){if(this.isFrozen){throw SC.FROZEN_ERROR}var h,g,k,j,c,f,i,l;if(b===undefined&&d===undefined){if(!a){throw"Must pass params to SC.SelectionSet.add()"}if(a.isIndexSet){return this.add(a.source,a)}if(a.isSelectionSet){h=a._sets;l=a._objects;g=h?h.length:0;this.beginPropertyChanges();for(k=0;k<g;k++){j=h[k];if(j&&j.get("length")>0){this.add(j.source,j)}}if(l){this.addObjects(l)}this.endPropertyChanges();return this}}j=this._indexSetForSource(a,YES);c=this.get("length");i=j.get("length");f=c-i;j.add(b,d);this._indexSetCache=null;f+=j.get("length");if(f!==c){this.propertyDidChange("length");this.enumerableContentDidChange();if(i===0){this.notifyPropertyChange("sources")}}return this},remove:function(a,b,d){if(this.isFrozen){throw SC.FROZEN_ERROR}var h,g,k,j,c,f,i,l;if(b===undefined&&d===undefined){if(!a){throw"Must pass params to SC.SelectionSet.remove()"}if(a.isIndexSet){return this.remove(a.source,a)}if(a.isSelectionSet){h=a._sets;l=a._objects;g=h?h.length:0;this.beginPropertyChanges();for(k=0;k<g;k++){j=h[k];if(j&&j.get("length")>0){this.remove(j.source,j)}}if(l){this.removeObjects(l)}this.endPropertyChanges();return this}}j=this._indexSetForSource(a,YES);c=this.get("length");f=c-j.get("length");if(j&&(l=this._objects)){if(d!==undefined){b=SC.IndexSet.create(b,d);d=undefined}l.forEach(function(m){k=a.indexOf(m);if(b.contains(k)){l.remove(m);f--}},this)}j.remove(b,d);i=j.get("length");f+=i;this._indexSetCache=null;if(f!==c){this.propertyDidChange("length");this.enumerableContentDidChange();if(i===0){this.notifyPropertyChange("sources")}}return this},contains:function(b,d,a){if(d===undefined&&a===undefined){return this.containsObject(b)}var c=this.indexSetForSource(b);if(!c){return NO}return c.contains(d,a)},intersects:function(b,d,a){var c=this.indexSetForSource(b,NO);if(!c){return NO}return c.intersects(d,a)},_TMP_ARY:[],addObject:function(b){var c=this._TMP_ARY,a;c[0]=b;a=this.addObjects(c);c.length=0;return a},addObjects:function(a){var d=this._objects,b,c;if(!d){d=this._objects=SC.CoreSet.create()}b=d.get("length");d.addEach(a);c=d.get("length");this._indexSetCache=null;if(c!==b){this.propertyDidChange("length");this.enumerableContentDidChange()}return this},removeObject:function(b){var c=this._TMP_ARY,a;c[0]=b;a=this.removeObjects(c);c.length=0;return a},removeObjects:function(b){var f=this._objects,c,d,a;if(!f){return this}c=f.get("length");f.removeEach(b);d=f.get("length");if(a=this._sets){a.forEach(function(g){c+=g.get("length");g.removeObjects(b);d+=g.get("length")},this)}this._indexSetCache=null;if(d!==c){this.propertyDidChange("length");this.enumerableContentDidChange()}return this},containsObject:function(c){var f=this._objects;if(f&&f.contains(c)){return YES}var d=this._sets,b=d?d.length:0,a,g;for(a=0;a<b;a++){g=d[a];if(g&&g.indexOf(c)>=0){return YES}}return NO},constrain:function(f){var h,b,a,d;this.beginPropertyChanges();this.get("sources").forEach(function(i){if(i===f){return}var j=this._indexSetForSource(f,NO);if(j){this.remove(f,j)}},this);h=this._indexSetForSource(f,NO);if(h&&((a=h.get("max"))>(b=f.get("length")))){this.remove(f,b,a-b)}if(d=this._objects){var c,g;for(c=d.length-1;c>=0;c--){g=d[c];if(f.indexOf(g)<0){this.removeObject(g)}}}this.endPropertyChanges();return this},isEqual:function(h){var g,d,b,a,c,f;if(!h||!h.isSelectionSet){return NO}if(h===this){return YES}if((this._sets===h._sets)&&(this._objects===h._objects)){return YES}if(this.get("length")!==h.get("length")){return NO}g=this._objects;d=h._objects;if(g||d){if((g?g.get("length"):0)!==(d?d.get("length"):0)){return NO}if(g&&!g.isEqual(d)){return NO}}c=this.get("sources");a=c.get("length");for(b=0;b<a;b++){f=c.objectAt(b);g=this._indexSetForSource(f,NO);d=this._indexSetForSource(f,NO);if(!!d!==!!g){return NO}if(g&&!g.isEqual(d)){return NO}}return YES},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}if(this._sets){this._sets.length=0}if(this._objects){this._objects=null}this._indexSetCache=null;this.propertyDidChange("length");this.enumerableContentDidChange();this.notifyPropertyChange("sources");return this},copy:function(){var c=this.constructor.create(),d=this._sets,b=d?d.length:0,a,f;if(d&&b>0){d=c._sets=d.slice();for(a=0;a<b;a++){if(!(f=d[a])){continue}f=d[a]=f.copy();c[SC.guidFor(f.source)]=a}}if(this._objects){c._objects=this._objects.copy()}return c},freeze:function(){if(this.get("isFrozen")){return this}var a=this._sets,b=a?a.length:0,c;while(--b>=0){c=a[b];if(c){c.freeze()}}if(this._objects){this._objects.freeze()}this.set("isFrozen",YES);return this},toString:function(){var a=this._sets||[];a=a.map(function(b){return b.toString().replace("SC.IndexSet",SC.guidFor(b.source))},this);if(this._objects){a.push(this._objects.toString())}return"SC.SelectionSet:%@<%@>".fmt(SC.guidFor(this),a.join(","))},firstObject:function(){var b=this._sets,c=this._objects;if(b&&b.get("length")>0){var f=b?b[0]:null,d=f?f.source:null,a=f?f.firstObject():-1;if(d&&a>=0){return d.objectAt(a)}}return c?c.firstObject():undefined}.property(),nextObject:function(c,f,b){var d,a;if(c===0){d=b.objects=[];this.forEach(function(g){d.push(g)},this);b.max=d.length}d=b.objects;a=d[c];if(c+1>=b.max){b.objects=b.max=null}return a},forEach:function(h,f){var c=this._sets,d=this._objects,b=c?c.length:0,g,a;for(a=0;a<b;a++){g=c[a];if(g){g.forEachObject(h,f)}}if(d){d.forEach(h,f)}return this}});SC.SelectionSet.prototype.clone=SC.SelectionSet.prototype.copy;SC.SelectionSet.EMPTY=SC.SelectionSet.create().freeze();sc_require("mixins/delegate_support");SC.SparseArray=SC.Object.extend(SC.Observable,SC.Enumerable,SC.Array,SC.DelegateSupport,{_requestingLength:0,_requestingIndex:0,length:function(){var a=this.delegate;if(a&&SC.none(this._length)&&a.sparseArrayDidRequestLength){this._requestingLength++;a.sparseArrayDidRequestLength(this);this._requestingLength--}return this._length||0}.property().cacheable(),provideLength:function(b){var a;if(SC.none(b)){this._sa_content=null}if(b!==this._length){a=this._length;this._length=b;if(this._requestingLength<=0){this.arrayContentDidChange(0,a||0,b||0)}}return this},rangeWindowSize:1,requestedRangeIndex:null,init:function(){arguments.callee.base.apply(this,arguments);this.requestedRangeIndex=[];this._TMP_PROVIDE_ARRAY=[];this._TMP_PROVIDE_RANGE={length:1};this._TMP_RANGE={}},objectAt:function(a,d){var c=this._sa_content,b;if(!c){c=this._sa_content=[]}if((b=c[a])===undefined){if(!d){this.requestIndex(a)}b=c[a]}return b},definedIndexes:function(d){var c=SC.IndexSet.create(),f=this._sa_content,b,a;if(!f){return c.freeze()}if(d){d.forEach(function(g){if(f[g]!==undefined){c.add(g)}})}else{a=f.length;for(b=0;b<a;b++){if(f[b]!==undefined){c.add(b)}}}return c.freeze()},_TMP_RANGE:{},requestIndex:function(b){var c=this.delegate;if(!c){return this}var a=this.get("rangeWindowSize"),f=b;if(a>1){f=f-Math.floor(f%a)}if(a<1){a=1}this._requestingIndex++;if(c.sparseArrayDidRequestRange){var d=this._TMP_RANGE;if(this.wasRangeRequested(f)===-1){d.start=f;d.length=a;this.requestedRangeIndex.push(f);c.sparseArrayDidRequestRange(this,d)}}else{if(c.sparseArrayDidRequestIndex){while(--a>=0){c.sparseArrayDidRequestIndex(this,f+a)}}}this._requestingIndex--;return this},wasRangeRequested:function(c){var b,a;for(b=0,a=this.requestedRangeIndex.length;b<a;b++){if(this.requestedRangeIndex[b]===c){return b}}return -1},rangeRequestCompleted:function(b){var a=this.wasRangeRequested(b);if(a>=0){this.requestedRangeIndex.removeAt(a,1);return YES}return NO},provideObjectsInRange:function(b,f){var c=this._sa_content;if(!c){c=this._sa_content=[]}var d=b.start,a=b.length;while(--a>=0){c[d+a]=f.objectAt(a)}if(this._requestingIndex<=0){this.arrayContentDidChange(b.start,b.length,b.length)}return this},provideObjectAtIndex:function(c,b){var d=this._TMP_PROVIDE_ARRAY,a=this._TMP_PROVIDE_RANGE;d[0]=b;a.start=c;return this.provideObjectsInRange(a,d)},objectsDidChangeInRange:function(a){var b=this._sa_content;if(b){if(a.start===0&&SC.maxRange(a)>=b.length){this._sa_content=null}else{var d=a.start,c=Math.min(d+a.length,b.length);while(--c>=d){b[c]=undefined}}}this.arrayContentDidChange(a.start,a.length,a.length);return this},indexOf:function(d){var f,b,a=this.delegate;if(a&&a.sparseArrayDidRequestIndexOf){b=a.sparseArrayDidRequestIndexOf(this,d)}if(SC.none(b)){f=this._sa_content;if(!f){f=this._sa_content=[]}b=f.indexOf(d)}return b},replace:function(b,h,f){f=f||[];var c=this.delegate;if(c){if(!c.sparseArrayShouldReplace||!c.sparseArrayShouldReplace(this,b,h,f)){return this}}var d=this._sa_content;if(!d){d=this._sa_content=[]}d.replace(b,h,f);var a=f?(f.get?f.get("length"):f.length):0;var g=a-h;this.arrayContentWillChange(b,h,a);if(!SC.none(this._length)){this.propertyWillChange("length");this._length+=g;this.propertyDidChange("length")}this.beginPropertyChanges();this.arrayContentDidChange(b,h,a);this.enumerableContentDidChange(b,h,g);this.endPropertyChanges();return this},reset:function(){var a;this._sa_content=null;a=this._length;this._length=null;this.arrayContentDidChange(0,a,0);this.invokeDelegateMethod(this.delegate,"sparseArrayDidReset",this);return this}});SC.SparseArray.array=function(a){return this.create({_length:a||0})};SC.Timer=SC.Object.extend({target:null,action:null,isPooled:NO,interval:0,startTime:null,repeats:NO,until:null,isPaused:NO,isScheduled:NO,isValid:YES,lastFireTime:0,fireTime:function(){if(!this.get("isValid")){return -1}var f=this.get("startTime");if(!f||f===0){return -1}var a=this.get("interval"),c=this.get("lastFireTime");if(c<f){c=f}var b;if(this.get("repeats")){if(a===0){b=c}else{b=f+(Math.floor((c-f)/a)+1)*a}}else{b=f+a}var d=this.get("until");if(d&&d>0&&b>d){b=d}return b}.property("interval","startTime","repeats","until","isValid","lastFireTime").cacheable(),schedule:function(){if(!this.get("isValid")){return this}this.beginPropertyChanges();if(!this.startTime){this.set("startTime",SC.RunLoop.currentRunLoop.get("startTime"))}var a=this.get("fireTime"),b=this.get("lastFireTime");if(a>=b){this.set("isScheduled",YES);SC.RunLoop.currentRunLoop.scheduleTimer(this,a)}this.endPropertyChanges();return this},invalidate:function(){this.beginPropertyChanges();this.set("isValid",NO);var a=SC.RunLoop.currentRunLoop;if(a){a.cancelTimer(this)}this.action=this.target=null;this.endPropertyChanges();if(this.get("isPooled")){SC.Timer.returnTimerToPool(this)}return this},fire:function(){var b=Date.now();this.set("lastFireTime",b);var a=this.get("fireTime");if(!this.get("isPaused")){this.performAction()}if(a>b){this.schedule()}else{this.invalidate()}},performAction:function(){var a=SC.typeOf(this.action);if(a==SC.T_FUNCTION){this.action.call((this.target||this),this)}else{if(a===SC.T_STRING){if(this.action.indexOf(".")>=0){var f=this.action.split(".");var c=f.pop();var d=SC.objectForPropertyPath(f,window);var b=d.get?d.get(c):d[c];if(b&&SC.typeOf(b)==SC.T_FUNCTION){b.call(d,this)}else{throw"%@: Timer could not find a function at %@".fmt(this,this.action)}}else{SC.RootResponder.responder.sendAction(this.action,this.target,this)}}}},init:function(){arguments.callee.base.apply(this,arguments);if(this.startTime instanceof Date){this.startTime=this.startTime.getTime()}if(this.until instanceof Date){this.until=this.until.getTime()}},RESET_DEFAULTS:{target:null,action:null,isPooled:NO,isPaused:NO,isScheduled:NO,isValid:YES,interval:0,repeats:NO,until:null,startTime:null,lastFireTime:0},reset:function(b){if(!b){b=SC.EMPTY_HASH}this.propertyWillChange("fireTime");var c=this.RESET_DEFAULTS;for(var a in c){if(!c.hasOwnProperty(a)){continue}this[a]=SC.none(b[a])?c[a]:b[a]}this.propertyDidChange("fireTime");return this},removeFromTimerQueue:function(c){var b=this._timerQueuePrevious,a=this._timerQueueNext;if(!b&&!a&&c!==this){return c}if(b){b._timerQueueNext=a}if(a){a._timerQueuePrevious=b}this._timerQueuePrevious=this._timerQueueNext=null;return(c===this)?a:c},scheduleInTimerQueue:function(c,b){this._timerQueueRunTime=b;var a=c;var d=null;while(a&&a._timerQueueRunTime<b){d=a;a=a._timerQueueNext}if(d){d._timerQueueNext=this;this._timerQueuePrevious=d}if(a){a._timerQueuePrevious=this;this._timerQueueNext=a}return(a===c)?this:c},collectExpiredTimers:function(c,a){if(this._timerQueueRunTime>a){return this}c.push(this);var b=this._timerQueueNext;this._timerQueueNext=null;if(b){b._timerQueuePrevious=null}return b?b.collectExpiredTimers(c,a):null}});SC.Timer.schedule=function(a){var b;if(!a||SC.none(a.isPooled)||a.isPooled){b=this.timerFromPool(a)}else{b=this.create(a)}return b.schedule()};SC.Timer.timerFromPool=function(a){var b=this._timerPool;if(!b){b=this._timerPool=[]}var c=b.pop();if(!c){c=this.create()}return c.reset(a)};SC.Timer.returnTimerToPool=function(a){if(!this._timerPool){this._timerPool=[]}this._timerPool.push(a);return this};sc_require("system/browser");SC.mixin({normalizeURL:function(a){if(a.slice(0,1)=="/"){a=window.location.protocol+"//"+window.location.host+a}else{if((a.slice(0,5)=="http:")||(a.slice(0,6)=="https:")){}else{a=window.location.href+"/"+a}}return a},isPercentage:function(a){return(a<1&&a>0)},minX:function(a){return a.x||0},maxX:function(a){return(a.x||0)+(a.width||0)},midX:function(a){return(a.x||0)+((a.width||0)/2)},minY:function(a){return a.y||0},maxY:function(a){return(a.y||0)+(a.height||0)},midY:function(a){return(a.y||0)+((a.height||0)/2)},centerX:function(b,a){return(a.width-b.width)/2},centerY:function(b,a){return(a.height-b.height)/2},offset:function(d,c){var f,b,h,a;c=c||"document";if(c==="parent"){a=jQuery(d).position()}else{a=jQuery(d).offset();if(SC.browser.isMobileSafari){f=navigator.userAgent;b=f.indexOf("Mobile/");h=f.substring(b+7,b+9);if(parseInt(SC.browser.mobileSafari,0)<=532||(h<="8A")){a.left-=window.pageXOffset;a.top-=window.pageYOffset}}if(c==="viewport"){if(SC.browser.isIE8OrLower){a.left-=$(window).scrollLeft();a.top-=$(window).scrollTop()}else{a.left-=window.pageXOffset;a.top-=window.pageYOffset}}}try{a.x=a.left;a.y=a.top}catch(g){a={x:a.left,y:a.top}}delete a.left;delete a.top;return a},viewportOffset:function(b){var a=SC.offset(b,"viewport");return{x:a.left,y:a.top}}});SC.mixin({ZERO_POINT:{x:0,y:0},pointInRect:function(a,b){return(a.x>=SC.minX(b))&&(a.y>=SC.minY(b))&&(a.x<=SC.maxX(b))&&(a.y<=SC.maxY(b))},rectsEqual:function(b,a,c){if(!b||!a){return(b==a)}if(!c&&c!==0){c=0.1}if((b.y!=a.y)&&(Math.abs(b.y-a.y)>c)){return NO}if((b.x!=a.x)&&(Math.abs(b.x-a.x)>c)){return NO}if((b.width!=a.width)&&(Math.abs(b.width-a.width)>c)){return NO}if((b.height!=a.height)&&(Math.abs(b.height-a.height)>c)){return NO}return YES},intersectRects:function(b,a){var c={x:Math.max(SC.minX(b),SC.minX(a)),y:Math.max(SC.minY(b),SC.minY(a)),width:Math.min(SC.maxX(b),SC.maxX(a)),height:Math.min(SC.maxY(b),SC.maxY(a))};c.width=Math.max(0,c.width-c.x);c.height=Math.max(0,c.height-c.y);return c},unionRects:function(b,a){var c={x:Math.min(SC.minX(b),SC.minX(a)),y:Math.min(SC.minY(b),SC.minY(a)),width:Math.max(SC.maxX(b),SC.maxX(a)),height:Math.max(SC.maxY(b),SC.maxY(a))};c.width=Math.max(0,c.width-c.x);c.height=Math.max(0,c.height-c.y);return c},cloneRect:function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}},stringFromRect:function(a){if(!a){return"(null)"}else{return"{x:"+a.x+", y:"+a.y+", width:"+a.width+", height:"+a.height+"}"}}});sc_require("panes/pane");sc_require("panes/keyboard");sc_require("panes/layout");sc_require("panes/manipulation");sc_require("panes/visibility");SC.MainPane=SC.Pane.extend({layout:{top:0,left:0,bottom:0,right:0,minHeight:200,minWidth:200},init:function(){var c={x:0,y:0,width:1000,height:1000},a=this.get("layout"),b=false;if(document&&document.body){c.width=document.body.clientWidth;c.height=document.body.clientHeight;if(a.minHeight||a.minWidth){if((a.minHeight&&c.height<a.minHeight)||(a.minWidth&&c.width<a.minWidth)){SC.bodyOverflowArbitrator.requestVisible(this)}else{SC.bodyOverflowArbitrator.requestHidden(this)}}}arguments.callee.base.apply(this,arguments)},paneDidAttach:function(){var b=arguments.callee.base.apply(this,arguments),a=this.rootResponder;a.makeMainPane(this);if(!a.get("keyRootView")){a.makeKeyPane(this)}return b},acceptsKeyPane:YES,classNames:["sc-main"]});SC.routes=SC.Object.create({wantsHistory:NO,usesHistory:null,baseURI:document.baseURI,_didSetup:NO,_location:null,_firstRoute:null,_extractParametersAndRoute:function(d,b){var a={},k=d.route||"",g,c,f,j,h,l;g=(k.indexOf("?")<0&&k.indexOf("&")>=0)?"&":"?";c=k.split(g);k=c.shift();a=this.deparam(c.join("&"),b||false);for(l in d){if(d.hasOwnProperty(l)&&l!=="route"){a[l]=""+d[l]}}a.params=g+$.param(a);a.route=k;return a},location:function(a,b){this._skipRoute=NO;return this._extractLocation(a,b)}.property(),informLocation:function(a,b){this._skipRoute=YES;var c=this.location.lastSetValueKey;if(c&&this._kvo_cache){this._kvo_cache[c]=b}return this._extractLocation(a,b)}.property(),_extractLocation:function(c,d){var a,b;if(d!==undefined){if(d===null){d=""}if(typeof(d)==="object"){a=this._extractParametersAndRoute(d);d=a.route+a.params}if(!SC.empty(d)||(this._location&&this._location!==d)){b=encodeURI(d);if(this.usesHistory){if(b.length>0){b="/"+b}window.history.pushState(null,null,this.get("baseURI")+b)}else{window.location.hash=b}}this._location=d}return this._location},ping:function(){var a;if(!this._didSetup){this._didSetup=YES;if(this.get("wantsHistory")&&SC.platform.supportsHistory){this.usesHistory=YES;this.popState();SC.Event.add(window,"popstate",this,this.popState)}else{this.usesHistory=NO;if(SC.platform.supportsHashChange){this.hashChange();SC.Event.add(window,"hashchange",this,this.hashChange)}else{a=this;this._invokeHashChange=function(){a.hashChange();setTimeout(a._invokeHashChange,100)};this._invokeHashChange()}}}},hashChange:function(a){var b=window.location.hash;b=(b&&b.length>0)?b.slice(1,b.length):"";if(!SC.browser.isMozilla){b=decodeURI(b)}if(this.get("location")!==b&&!this._skipRoute){SC.run(function(){this.set("location",b)},this)}this._skipRoute=false},popState:function(a){var b=this.get("baseURI"),c=document.location.href;if(c.slice(0,b.length)===b){c=c.slice(b.length+1,c.length);if(this.get("location")!==c&&!this._skipRoute){SC.run(function(){this.set("location",c)},this)}}this._skipRoute=false},add:function(a,b,c){if(!this._didSetup){this.invokeLast(this.ping)}if(c===undefined&&SC.typeOf(b)===SC.T_FUNCTION){c=b;b=null}else{if(SC.typeOf(c)===SC.T_STRING){c=b[c]}}if(!this._firstRoute){this._firstRoute=this._Route.create()}this._firstRoute.add(a.split("/"),b,c);return this},locationDidChange:function(){this.trigger()}.observes("location"),trigger:function(){var a=this._firstRoute,b=this.get("location"),d,c;if(a){d=this._extractParametersAndRoute({route:b});b=d.route;delete d.route;delete d.params;c=a.routeForParts(b.split("/"),d);if(c&&c.method){c.method.call(c.target||this,d)}}},deparam:function(l,h){var k={},b={"true":!0,"false":!1,"null":null},g=l.replace(/\+/g," ").split("&"),m=g.length,o,d,q,c,p,j,r,n,f=decodeURIComponent,a=Object.prototype.toString;for(o=0;o<m;++o){d=g[o].split("="),q=f(d[0]),p=k,r=q.split("]["),n=q.length-1;if(/\[/.test(r[0])&&/\]$/.test(r[n])){r[n]=r[n].replace(/\]$/,"");r=r.shift().split("[").concat(r);n=r.length-1}else{n=0}if(d.length===2){c=f(d[1]);if(h){c=c&&!isNaN(c)?+c:c==="undefined"?undefined:b[c]!==undefined?b[c]:c}if(n){for(j=0;j<n;++j){q=r[j]===""?p.length:r[j];p=p[q]=j<n?p[q]||(r[j+1]&&isNaN(r[j+1])?{}:[]):c}}else{if(a.apply(k[q])==="[object Array]"){k[q].push(c)}else{if(k[q]!==undefined){k[q]=[k[q],c]}else{k[q]=c}}}}else{if(q){k[q]=h?undefined:""}}}return k},_Route:SC.Object.extend({target:null,method:null,staticRoutes:null,dynamicRoutes:null,wildcardRoutes:null,add:function(c,b,f){var a,d;c=SC.clone(c);if(!c||c.length===0){this.target=b;this.method=f}else{a=c.shift();switch(a.slice(0,1)){case":":a=a.slice(1,a.length);if(!this.dynamicRoutes){this.dynamicRoutes={}}if(!this.dynamicRoutes[a]){this.dynamicRoutes[a]=this.constructor.create()}d=this.dynamicRoutes[a];break;case"*":a=a.slice(1,a.length);if(!this.wildcardRoutes){this.wildcardRoutes={}}d=this.wildcardRoutes[a]=this.constructor.create();break;default:if(!this.staticRoutes){this.staticRoutes={}}if(!this.staticRoutes[a]){this.staticRoutes[a]=this.constructor.create()}d=this.staticRoutes[a]}if(d){d.add(c,b,f)}}},routeForParts:function(d,f){var b,c,a;d=SC.clone(d);if(!d||d.length===0){return this.method?this:null}else{b=d.shift();if(this.staticRoutes&&this.staticRoutes[b]){return this.staticRoutes[b].routeForParts(d,f)}else{for(c in this.dynamicRoutes){a=this.dynamicRoutes[c].routeForParts(d,f);if(a){f[c]=b;return a}}for(c in this.wildcardRoutes){d.unshift(b);f[c]=d.join("/");return this.wildcardRoutes[c].routeForParts(null,f)}return null}}}})});SC.SCANNER_OUT_OF_BOUNDS_ERROR=new Error("Out of bounds.");SC.SCANNER_INT_ERROR=new Error("Not an int.");SC.SCANNER_SKIP_ERROR=new Error("Did not find the string to skip.");SC.SCANNER_SCAN_ARRAY_ERROR=new Error("Did not find any string of the given array to scan.");SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR=new Error("Can't compare the dates of two DateTimes that don't have the same timezone.");SC.DATETIME_ISO8601="%Y-%m-%dT%H:%M:%S%Z";SC.Scanner=SC.Object.extend({string:null,scanLocation:0,scan:function(a){if(this.scanLocation+a>this.length){throw SC.SCANNER_OUT_OF_BOUNDS_ERROR}var b=this.string.substr(this.scanLocation,a);this.scanLocation+=a;return b},scanInt:function(c,f){if(f===undefined){f=c}var d=this.scan(f);var b=new RegExp("^\\d{"+c+","+f+"}");var a=d.match(b);if(!a){throw SC.SCANNER_INT_ERROR}if(a[0].length<f){this.scanLocation+=a[0].length-f}return parseInt(a[0],10)},skipString:function(a){if(this.scan(a.length)!==a){throw SC.SCANNER_SKIP_ERROR}return YES},scanArray:function(c){for(var b=0,a=c.length;b<a;b++){if(this.scan(c[b].length)===c[b]){return b}this.scanLocation-=c[b].length}throw SC.SCANNER_SCAN_ARRAY_ERROR}});SC.DateTime=SC.Object.extend(SC.Freezable,SC.Copyable,{_ms:0,timezone:0,isFrozen:YES,adjust:function(b,a){var c;b=b?SC.clone(b):{};c=(b.timezone!==undefined)?b.timezone:(this.timezone!==undefined)?this.timezone:0;return this.constructor._adjust(b,this._ms,c,a)._createFromCurrentState()},advance:function(a){return this.constructor._advance(a,this._ms,this.timezone)._createFromCurrentState()},unknownProperty:function(a){return this.constructor._get(a,this._ms,this.timezone)},toFormattedString:function(a){return this.constructor._toFormattedString(a,this._ms,this.timezone)},toISO8601:function(){return this.constructor._toFormattedString(SC.DATETIME_ISO8601,this._ms,this.timezone)},toString:function(){return"UTC: "+new Date(this._ms).toUTCString()+", timezone: "+this.timezone},isEqual:function(a){return this.constructor.compare(this,a)===0},copy:function(){return this},toTimezone:function(a){if(a===undefined){a=0}return this.advance({timezone:a-this.timezone})}});SC.DateTime.mixin(SC.Comparable,{recordFormat:SC.DATETIME_ISO8601,dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],_englishDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AMPMNames:["AM","PM"],_date:new Date(),_tz:0,timezone:new Date().getTimezoneOffset(),_dt_cache:{},_dt_cache_index:-1,_DT_CACHE_MAX_LENGTH:1000,_setCalcState:function(a,c){var b={milliseconds:this._date.getTime(),timezone:this._tz};if(a!==undefined){this._date.setTime(a)}if(c!==undefined){this._tz=c}return b},_setCalcStateFromHash:function(c,b){var d=(b!==undefined)?b:this._tz;var a=this._toMilliseconds(c,this._ms,d);return this._setCalcState(a,d)},_get:function(w,b,o){var n,t,i,p,f,k,l,g,q,a;var c,j;var s=this._date;var r,h=null;r=this._setCalcState(b,o);if(w==="milliseconds"){h=s.getTime()}else{if(w==="timezone"){h=this._tz}}if(h===null){q=w.slice(0,4);a=w.slice(4);if(q==="last"||q==="next"){c=this._get("dayOfWeek",b,o);j=this._englishDayNames.indexOf(a);if(j>=0){var u=j-c;if(q==="last"&&u>=0){u-=7}if(q==="next"&&u<0){u+=7}this._advance({day:u},b,o);h=this._createFromCurrentState()}}}if(h===null){if(o!==undefined){this._setCalcState(s.getTime()-(o*60000),0)}switch(w){case"year":h=s.getUTCFullYear();break;case"month":h=s.getUTCMonth()+1;break;case"day":h=s.getUTCDate();break;case"dayOfWeek":h=s.getUTCDay();break;case"hour":h=s.getUTCHours();break;case"minute":h=s.getUTCMinutes();break;case"second":h=s.getUTCSeconds();break;case"millisecond":h=s.getUTCMilliseconds();break}if((h===null)&&(w==="isLeapYear")){f=this._get("year");h=(f%4===0&&f%100!==0)||f%400===0}if((h===null)&&(w==="daysInMonth")){switch(this._get("month")){case 4:case 6:case 9:case 11:h=30;break;case 2:h=this._get("isLeapYear")?29:28;break;default:h=31;break}}if((h===null)&&(w==="dayOfYear")){n=s.getTime();i=this._get("day");this._setCalcStateFromHash({day:1});for(p=this._get("month")-1;p>0;p--){this._setCalcStateFromHash({month:p});i+=this._get("daysInMonth")}s.setTime(n);h=i}if((h===null)&&(w.slice(0,4)==="week")){k=w.length===4?1:parseInt(w.slice("4"),10);l=this._get("dayOfWeek");g=this._get("dayOfYear")-1;if(k===0){h=parseInt((g-l+7)/7,10)}else{h=parseInt((g-(l-1+7)%7+7)/7,10)}}}this._setCalcState(r.milliseconds,r.timezone);return h},_adjust:function(c,g,f,a){var d=c?SC.clone(c):{};var b=this._toMilliseconds(c,g,f,a);this._setCalcState(b,f);return this},_advance:function(a,g,d){var c=a?SC.clone(a):{};var f;for(var b in c){c[b]+=this._get(b,g,d)}f=(c.timezone!==undefined)?c.timezone:d;return this._adjust(c,g,f,NO)},_toMilliseconds:function(k,c,i,g){var a=k?SC.clone(k):{};var j=this._date;var h=j.getTime();var b,f;if(!SC.none(c)){j.setTime(c)}f=(i!==undefined)?i:(this.timezone!==undefined)?this.timezone:0;j.setTime(j.getTime()-(f*60000));if(g===undefined||g===YES){if(!SC.none(a.hour)&&SC.none(a.minute)){a.minute=0}if(!(SC.none(a.hour)&&SC.none(a.minute))&&SC.none(a.second)){a.second=0}if(!(SC.none(a.hour)&&SC.none(a.minute)&&SC.none(a.second))&&SC.none(a.millisecond)){a.millisecond=0}}if(SC.none(a.year)){a.year=j.getUTCFullYear()}if(SC.none(a.month)){a.month=j.getUTCMonth()+1}if(SC.none(a.day)){a.day=j.getUTCDate()}if(SC.none(a.hour)){a.hour=j.getUTCHours()}if(SC.none(a.minute)){a.minute=j.getUTCMinutes()}if(SC.none(a.second)){a.second=j.getUTCSeconds()}if(SC.none(a.millisecond)){a.millisecond=j.getUTCMilliseconds()}b=Date.UTC(a.year,a.month-1,a.day,a.hour,a.minute,a.second,a.millisecond);j.setTime(b+(f*60000));b=j.getTime();j.setTime(h);return b},create:function(){var j=arguments.length===0?{}:arguments[0];var d;if(SC.typeOf(j)===SC.T_NUMBER){j={milliseconds:j}}d=(j.timezone!==undefined)?j.timezone:this.timezone;if(d===undefined){d=0}if(!SC.none(j.milliseconds)){var i="nu"+j.milliseconds+d,a=this._dt_cache;var f=a[i];if(!f){var g,h=this._dt_cache_index,b=this;f=a[i]=new b([{_ms:j.milliseconds,timezone:d}]);h=this._dt_cache_index=(h+1)%this._DT_CACHE_MAX_LENGTH;g=a[h];if(g!==undefined&&a[g]){delete a[g]}a[h]=i}return f}else{var c=new Date();return this.create({milliseconds:this._toMilliseconds(j,c.getTime(),d,j.resetCascadingly),timezone:d})}},_createFromCurrentState:function(){return this.create({milliseconds:this._date.getTime(),timezone:this._tz})},parse:function(o,c){var p=new RegExp("(?:%([aAbBcdDhHiIjmMpsSUWwxXyYZ%])|(.))","g");var n,j,a={},b={},i=SC.Scanner.create({string:o});if(SC.none(c)){c=SC.DATETIME_ISO8601}try{while((j=p.exec(c))!==null){switch(j[1]){case"a":b.dayOfWeek=i.scanArray(this.abbreviatedDayNames);break;case"A":b.dayOfWeek=i.scanArray(this.dayNames);break;case"b":a.month=i.scanArray(this.abbreviatedMonthNames)+1;break;case"B":a.month=i.scanArray(this.monthNames)+1;break;case"c":throw"%c is not implemented";case"d":case"D":a.day=i.scanInt(1,2);break;case"h":case"H":a.hour=i.scanInt(1,2);break;case"i":case"I":a.hour=i.scanInt(1,2);break;case"j":throw"%j is not implemented";case"m":a.month=i.scanInt(1,2);break;case"M":a.minute=i.scanInt(1,2);break;case"p":a.meridian=i.scanArray(this.AMPMNames);break;case"S":a.second=i.scanInt(1,2);break;case"s":a.millisecond=i.scanInt(1,3);break;case"U":throw"%U is not implemented";case"W":throw"%W is not implemented";case"w":throw"%w is not implemented";case"x":throw"%x is not implemented";case"X":throw"%X is not implemented";case"y":a.year=i.scanInt(2);a.year+=(a.year>70?1900:2000);break;case"Y":a.year=i.scanInt(4);break;case"Z":var g=i.scan(1);if(g==="Z"){a.timezone=0}else{if(g==="+"||g==="-"){var k=i.scanInt(2);if(i.scan(1)!==":"){i.scan(-1)}var f=i.scanInt(2);a.timezone=(g==="+"?-1:1)*(k*60+f)}}break;case"%":i.skipString("%");break;default:i.skipString(j[0]);break}}}catch(l){SC.Logger.log("SC.DateTime.createFromString "+l.toString());return null}if(!SC.none(a.meridian)&&!SC.none(a.hour)){if((a.meridian===1&&a.hour!==12)||(a.meridian===0&&a.hour===12)){a.hour=(a.hour+12)%24}delete a.meridian}n=this.create(a);if(!SC.none(b.dayOfWeek)&&n.get("dayOfWeek")!==b.dayOfWeek){return null}return n},_pad:function(b,a){var c=""+b;if(a===undefined){a=2}while(c.length<a){c="0"+c}return c},__toFormattedString:function(b,f,c){var a,d;switch(b[1]){case"a":return this.abbreviatedDayNames[this._get("dayOfWeek")];case"A":return this.dayNames[this._get("dayOfWeek")];case"b":return this.abbreviatedMonthNames[this._get("month")-1];case"B":return this.monthNames[this._get("month")-1];case"c":return this._date.toString();case"d":return this._pad(this._get("day"));case"D":return this._get("day");case"h":return this._get("hour");case"H":return this._pad(this._get("hour"));case"i":a=this._get("hour");return(a===12||a===0)?12:(a+12)%12;case"I":a=this._get("hour");return this._pad((a===12||a===0)?12:(a+12)%12);case"j":return this._pad(this._get("dayOfYear"),3);case"m":return this._pad(this._get("month"));case"M":return this._pad(this._get("minute"));case"p":return this._get("hour")>11?this.AMPMNames[1]:this.AMPMNames[0];case"S":return this._pad(this._get("second"));case"s":return this._pad(this._get("millisecond"),3);case"u":return this._pad(this._get("utc"));case"U":return this._pad(this._get("week0"));case"W":return this._pad(this._get("week1"));case"w":return this._get("dayOfWeek");case"x":return this._date.toDateString();case"X":return this._date.toTimeString();case"y":return this._pad(this._get("year")%100);case"Y":return this._get("year");case"Z":d=-1*c;return(d>=0?"+":"-")+this._pad(parseInt(Math.abs(d)/60,10))+":"+this._pad(Math.abs(d)%60);case"%":return"%"}},_toFormattedString:function(c,f,b){var a=this;var d=(b!==undefined)?b:(this.timezone!==undefined)?this.timezone:0;this._setCalcState(f-(b*60000),0);return c.replace(/\%([aAbBcdDhHiIjmMpsSUWwxXyYZ\%])/g,function(){var g=a.__toFormattedString.call(a,arguments,f,b);return g})},compare:function(d,c){var g=d.get("milliseconds");var f=c.get("milliseconds");return g<f?-1:g===f?0:1},compareDate:function(d,c){if(d.get("timezone")!==c.get("timezone")){throw SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR}var g=d.adjust({hour:0}).get("milliseconds");var f=c.adjust({hour:0}).get("milliseconds");return g<f?-1:g===f?0:1}});SC.Binding.dateTime=function(a){return this.transform(function(b,c){return b?b.toFormattedString(a):null})};SC.stringsFor("English",{"_SC.DateTime.dayNames":"Sunday Monday Tuesday Wednesday Thursday Friday Saturday","_SC.DateTime.abbreviatedDayNames":"Sun Mon Tue Wed Thu Fri Sat","_SC.DateTime.monthNames":"January February March April May June July August September October November December","_SC.DateTime.abbreviatedMonthNames":"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec","_SC.DateTime.AMPMNames":"AM PM"});SC.DateTime.mixin({_setup:function(){SC.DateTime.dayNames=SC.String.w(SC.String.loc("_SC.DateTime.dayNames"));SC.DateTime.abbreviatedDayNames=SC.String.w(SC.String.loc("_SC.DateTime.abbreviatedDayNames"));SC.DateTime.monthNames=SC.String.w(SC.String.loc("_SC.DateTime.monthNames"));SC.DateTime.abbreviatedMonthNames=SC.String.w(SC.String.loc("_SC.DateTime.abbreviatedMonthNames"));SC.DateTime.AMPMNames=SC.String.w(SC.String.loc("_SC.DateTime.AMPMNames"))}});jQuery(document).ready(function(){SC.DateTime._setup()});SC.Response=SC.Object.extend({isResponse:YES,isError:NO,errorValue:function(){return this}.property().cacheable(),errorObject:null,request:null,originalRequest:function(){var a=this.get("request");while(a.get("source")){a=a.get("source")}return a}.property("request").cacheable(),type:function(){return this.getPath("request.type")}.property("request").cacheable(),address:function(){return this.getPath("request.address")}.property("request").cacheable(),isJSON:function(){return this.getPath("request.isJSON")||NO}.property("request").cacheable(),isXML:function(){return this.getPath("request.isXML")||NO}.property("request").cacheable(),listeners:function(){return this.getPath("request.listeners")}.property("request").cacheable(),status:-100,headers:null,body:function(){var a=this.get("encodedBody");if(a&&this.get("isJSON")){try{a=SC.json.decode(a)}catch(b){return SC.Error.create({message:b.name+": "+b.message,label:"Response",errorValue:this})}}return a}.property("encodedBody").cacheable(),response:function(){return this.get("body")}.property("body").cacheable(),isCancelled:NO,timedOut:null,timeoutTimer:null,fire:function(){var a=this.get("request"),c=a?a.get("source"):null;if(c&&c.willSend){c.willSend(a,this)}a.freeze();if(!this.get("isCancelled")){this.invokeTransport()}var b=a.get("timeout");if(b){var d=SC.Timer.schedule({target:this,action:"timeoutReached",interval:b,repeats:NO});this.set("timeoutTimer",d)}if(!this.get("isCancelled")&&c&&c.didSend){c.didSend(a,this)}},invokeTransport:function(){this.receive(function(a){this.set("status",200)},this)},receive:function(f,a){if(!this.get("timedOut")){var d=this.get("timeoutTimer");if(d){d.invalidate()}this.set("timedOut",NO)}var b=this.get("request");var c=b?b.get("source"):null;SC.run(function(){if(c&&c.willReceive){c.willReceive(b,this)}f.call(a,!this.get("isCancelled"));if(!this.get("isCancelled")&&c&&c.didReceive){c.didReceive(b,this)}if(!this.get("isCancelled")){this.notify()}},this);SC.Request.manager.transportDidClose(this);return this},cancel:function(){if(!this.get("isCancelled")){this.set("isCancelled",YES);this.cancelTransport();SC.Request.manager.transportDidClose(this)}},timeoutReached:function(){if(this.get("timedOut")===null){this.set("timedOut",YES);this.cancelTransport();this.receive(function(b){if(!b){return}var a=SC.$error("HTTP Request timed out","Request",0);a.set("errorValue",this);this.set("isError",YES);this.set("errorObject",a);this.set("status",0)},this);return YES}return NO},cancelTransport:function(){},_notifyListeners:function(j,b){var k=j[b],h,g,a;if(!k){return NO}var d=NO;var f=k.length;for(var c=0;c<f;c++){var l=k[c];h=(l.args||[]).copy();h.unshift(this);g=l.target;a=l.action;if(SC.typeOf(a)===SC.T_STRING){a=g[a]}d=a.apply(g,h)}return d},notify:function(){var b=this.get("listeners"),a=this.get("status"),c=Math.floor(a/100)*100,d=NO;if(!b){return this}d=this._notifyListeners(b,a);if(!d&&c!==a){d=this._notifyListeners(b,c)}if(!d&&a!==0){d=this._notifyListeners(b,0)}return this},toString:function(){var a=arguments.callee.base.apply(this,arguments);return"%@<%@ %@, status=%@".fmt(a,this.get("type"),this.get("address"),this.get("status"))}});SC.XHRResponse=SC.Response.extend({headers:function(){var c=this.get("rawRequest"),b=c?c.getAllResponseHeaders():null,a={};if(!b){return a}b.split("\n").forEach(function(h){var d=h.indexOf(":"),f,g;if(d>=0){f=h.slice(0,d);g=h.slice(d+1).trim();a[f]=g}},this);return a}.property("status").cacheable(),header:function(a){var b=this.get("rawRequest");return b?b.getResponseHeader(a):null},encodedBody:function(){var a=this.get("rawRequest");if(!a){return null}if(this.get("isXML")){return a.responseXML}return a.responseText}.property("status").cacheable(),cancelTransport:function(){var a=this.get("rawRequest");if(a){a.abort()}this.set("rawRequest",null)},invokeTransport:function(){var d,o,b,h,j=this.get("request"),f,a,g,c;h=this.createRequest();this.set("rawRequest",h);g=!!j.get("isAsynchronous");if(g){if(window.XMLHttpRequestProgressEvent){o=j.get("listeners");if(o){for(var p in o){if(isNaN(parseInt(p,10))){b=o[p];for(var l=0,m=b.length;l<m;l++){d=b[l];var n=p.split(".");if(SC.none(n[1])){SC.Event.add(h,n[0],d.target,d.action,d.args)}else{SC.Event.add(h[n[0]],n[1],d.target,d.action,d.args)}}}}}SC.Event.add(h,"loadend",this,this.finishRequest)}else{if(window.XMLHttpRequest){SC.Event.add(h,"readystatechange",this,this.finishRequest)}else{f=this;a=function(){if(!f){return null}var i=f.finishRequest();if(i){f=null}return i};h.onreadystatechange=a}}}h.open(this.get("type"),this.get("address"),g);c=this.getPath("request.headers");for(var k in c){h.setRequestHeader(k,c[k])}h.send(this.getPath("request.encodedBody"));if(!g){this.finishRequest()}return h},createRequest:function(){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{try{a=new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(b){}try{if(!a){a=new ActiveXObject("MSXML2.XMLHTTP")}}catch(b){}}return a},finishRequest:function(p){var c,m,a,f=this.get("rawRequest"),j=f.readyState,g,n,d,b;if(j===4&&!this.get("timedOut")){this.receive(function(i){if(!i){return}d=-1;try{d=f.status||0}catch(r){}if((d<200)||(d>=300)){try{b=f.statusText||""}catch(q){b=""}n=SC.$error(b||"HTTP Request failed","Request",d);n.set("errorValue",this);this.set("isError",YES);this.set("errorObject",n)}this.set("status",d)},this);if(window.XMLHttpRequestProgressEvent){SC.Event.remove(f,"loadend",this,this.finishRequest);g=this.get("request");m=g.get("listeners");if(m){for(var o in m){if(isNaN(parseInt(o,10))){a=m[o];for(var h=0,k=a.length;h<k;h++){c=a[h];var l=o.split(".");if(SC.none(l[1])){SC.Event.remove(f,l[0],c.target,c.action,c.args)}else{SC.Event.remove(f[l[0]],l[1],c.target,c.action,c.args)}}}}}}else{if(window.XMLHttpRequest){SC.Event.remove(f,"readystatechange",this,this.finishRequest)}else{f.onreadystatechange=null}}return YES}return NO}});sc_require("system/response");SC.Request=SC.Object.extend(SC.Copyable,SC.Freezable,{isAsynchronous:YES,isJSON:NO,isXML:NO,attachIdentifyingHeaders:YES,headers:function(){var a=this._headers;if(!a){a=this._headers={}}return a}.property().cacheable(),responseClass:SC.XHRResponse,source:null,address:null,type:"GET",timeout:null,body:null,encodedBody:function(){var a=this.get("body");if(a&&this.get("isJSON")){a=SC.json.encode(a)}return a}.property("isJSON","isXML","body").cacheable(),willSend:function(b,a){},didSend:function(b,a){},willReceive:function(b,a){},didReceive:function(b,a){},concatenatedProperties:"COPY_KEYS",COPY_KEYS:["attachIdentifyingHeaders","isAsynchronous","isJSON","isXML","address","type","timeout","body","responseClass","willSend","didSend","willReceive","didReceive"],copy:function(){var a={},d=this.COPY_KEYS,g=d.length,b,c,f;while(--g>=0){b=d[g];if(this.hasOwnProperty(b)){a[b]=this.get(b)}}if(this.hasOwnProperty("listeners")){a.listeners=SC.copy(this.get("listeners"))}if(this.hasOwnProperty("_headers")){a._headers=SC.copy(this._headers)}a.source=this.get("source")||this;return this.constructor.create(a)},header:function(a,b){var d,c;if(SC.typeOf(a)===SC.T_STRING){c=this._headers;if(arguments.length===1){return c?c[a]:null}else{this.propertyWillChange("headers");if(!c){c=this._headers={}}c[a]=b;this.propertyDidChange("headers");return this}}else{if(b===undefined){c=a;this.beginPropertyChanges();for(d in c){if(!c.hasOwnProperty(d)){continue}this.header(d,c[d])}this.endPropertyChanges();return this}}return this},clearHeaders:function(){this.propertyWillChange("headers");this._headers={};this.propertyDidChange("headers")},async:function(a){if(a===undefined){a=YES}return this.set("isAsynchronous",a)},timeoutAfter:function(a){return this.set("timeout",a)},json:function(a){if(a===undefined){a=YES}if(a){this.set("isXML",NO)}return this.set("isJSON",a)},xml:function(a){if(a===undefined){a=YES}if(a){this.set("isJSON",NO)}return this.set("isXML",a)},_prep:function(){var a=!!this.header("Content-Type");if(this.get("attachIdentifyingHeaders")){this.header("X-Requested-With","XMLHttpRequest");this.header("X-SproutCore-Version",SC.VERSION)}if(!a&&!!this.get("body")){if(this.get("isJSON")){this.header("Content-Type","application/json")}else{if(this.get("isXML")){this.header("Content-Type","text/xml")}}}return this},send:function(a){var b=this.get("timeout");if(b&&!this.get("isAsynchronous")){throw"Timeout values cannot be used with synchronous requests"}else{if(b===0){throw"The timeout value must either not be specified or must be greater than 0"}}if(a){this.set("body",a)}return SC.Request.manager.sendRequest(this.copy()._prep())},resend:function(){var a=this.get("source")?this:this.copy()._prep();return SC.Request.manager.sendRequest(a)},notify:function(f,d,c){var a;if(SC.typeOf(f)!==SC.T_NUMBER&&SC.typeOf(f)!==SC.T_STRING){a=SC.A(arguments).slice(2);c=d;d=f;f=0}else{a=SC.A(arguments).slice(3)}var b=this.get("listeners");if(!b){this.set("listeners",b={})}if(!b[f]){b[f]=[]}b[f].push({target:d,action:c,args:a});return this}});SC.Request.mixin({getUrl:function(a){return this.create().set("address",a).set("type","GET")},postUrl:function(b,a){var c=this.create().set("address",b).set("type","POST");if(a){c.set("body",a)}return c},deleteUrl:function(a){return this.create().set("address",a).set("type","DELETE")},putUrl:function(b,a){var c=this.create().set("address",b).set("type","PUT");if(a){c.set("body",a)}return c},patchUrl:function(b,a){var c=this.create().set("address",b).set("type","PATCH");if(a){c.set("body",a)}return c}});SC.Request.manager=SC.Object.create({maxRequests:6,inflight:[],pending:[],sendRequest:function(b){if(!b){return null}var a=b.get("responseClass").create({request:b});this.get("pending").pushObject(a);this.fireRequestIfNeeded();return a},cancel:function(b){var d=this.get("pending"),c=this.get("inflight"),a;if(d.indexOf(b)>=0){this.propertyWillChange("pending");d.removeObject(b);this.propertyDidChange("pending");return YES}else{if(c.indexOf(b)>=0){b.cancel();c.removeObject(b);this.fireRequestIfNeeded();return YES}}return NO},cancelAll:function(){if(this.get("pending").length||this.get("inflight").length){this.set("pending",[]);this.get("inflight").forEach(function(a){a.cancel()});this.set("inflight",[]);return YES}return NO},fireRequestIfNeeded:function(){var d=this.get("pending"),c=this.get("inflight"),a=this.get("maxRequests"),b;if((d.length>0)&&(c.length<a)){b=d.shiftObject();c.pushObject(b);b.fire()}},transportDidClose:function(a){this.get("inflight").removeObject(a);this.fireRequestIfNeeded()}});SC.FOCUS_ALL_CONTROLS=NO;SC.ready(function(){var a=SC.SAFARI_FOCUS_BEHAVIOR;if(a!==null&&a!==undefined){SC.FOCUS_ALL_CONTROLS=SC.SAFARI_FOCUS_BEHAVIOR}});SC.TreeItemContent={isTreeItemContent:YES,treeItemChildren:null,treeItemIsExpanded:YES,treeItemIsGrouped:NO,treeItemDisclosureState:function(b,a){return this.get("treeItemIsExpanded")?SC.BRANCH_OPEN:SC.BRANCH_CLOSED},treeItemCollapse:function(b,a){this.setIfChanged("treeItemIsExpanded",NO)},treeItemExpand:function(b,a){this.setIfChanged("treeItemIsExpanded",YES)},treeItemBranchIndexes:function(f,c){var d=this.get("treeItemChildren"),b,h,a,g;if(!d){return null}b=SC.IndexSet.create();h=d.get("length");for(a=0;a<h;a++){if(!(g=d.objectAt(a))){continue}if(!g.get("treeItemChildren")){continue}if(g.treeItemDisclosureState(this,a)!==SC.LEAF_NODE){b.add(a)}}return b.get("length")>0?b:null}};SC.BRANCH_OPEN=17;SC.BRANCH_CLOSED=18;SC.LEAF_NODE=32;SC.CollectionContent={isCollectionContent:YES,contentIndexIsSelected:function(b,c,a){var d=b.get("selection");return d?d.contains(c,a):NO},contentIndexIsEnabled:function(b,c,a){return b.get("isEnabled")},contentGroupIndexes:function(a,b){return null},contentIndexIsGroup:function(b,c,a){return NO},contentIndexOutlineLevel:function(b,c,a){return -1},contentIndexDisclosureState:function(b,c,a){return SC.LEAF_NODE},contentIndexExpand:function(b,c,a){SC.Logger.log("contentIndexExpand(%@, %@, %@)".fmt(b,c,a))},contentIndexCollapse:function(b,c,a){SC.Logger.log("contentIndexCollapse(%@, %@, %@)".fmt(b,c,a))}};sc_require("mixins/tree_item_content");sc_require("mixins/collection_content");SC.TreeItemObserver=SC.Object.extend(SC.Array,SC.CollectionContent,{item:null,delegate:null,parentObserver:null,parentItem:function(){var a=this.get("parentObserver");return a?a.get("item"):null}.property("parentObserver").cacheable(),index:null,outlineLevel:0,children:null,disclosureState:SC.BRANCH_OPEN,branchIndexes:function(){var f=this.get("item"),b,g,a,d,c;if(!f){return SC.IndexSet.EMPTY}else{if(f.isTreeItemContent){g=this.get("parentItem");a=this.get("index");return f.treeItemBranchIndexes(g,a)}else{d=this.get("children");if(!d){return null}c=SC.IndexSet.create();b=d.get("length");g=f;for(a=0;a<b;a++){if(!(f=d.objectAt(a))){continue}if(!this._computeChildren(f,g,a)){continue}if(this._computeDisclosureState(f,g,a)!==SC.LEAF_NODE){c.add(a)}}return c.get("length")>0?c:null}}}.property("children").cacheable(),isHeaderVisible:function(){return !!this.get("parentObserver")}.property("parentObserver").cacheable(),length:0,objectAt:function(g,c){var h=this.get("length"),j=this.get("item"),a=this._objectAtCache,i=g,f=0,d,b;if(g>=h){return undefined}if(this.get("isHeaderVisible")){if(g===0){return j}else{i--}}j=null;if(!a){a=this._objectAtCache=[]}if((j=a[g])!==undefined){return j}b=this.get("children");if(!b){return undefined}if(d=this.get("branchIndexes")){d.forEach(function(m){if(j||(m>i)){return}var l=this.branchObserverAt(m),k;if(!l){return}k=l.get("length");if(m+k>i){j=l.objectAt(i-m,c);i=-1}else{i-=k-1}},this)}if(i>=0){j=b.objectAt(i,c)}a[g]=j;return j},replace:function(a,b,k,d){var j=a,h=null,f,g,i;if(d===undefined){d=SC.DROP_BEFORE}if(this.get("isHeaderVisible")){j--}if(j<0){throw"Tree Item cannot replace itself"}if(f=this.get("branchIndexes")){f.forEach(function(l){if(h||(l>=j)){return}if(!(h=this.branchObserverAt(l))){return}g=h.get("length");if((l+g===j)&&d===SC.DROP_AFTER){j-=l}else{if(l+g>j){j-=l}else{j-=g-1;h=null}}},this)}if(h){h.replace(j,b,k,d);return this}i=j+b;if(b>1&&f){f.forEachIn(j,f.get("max")-j,function(l){if(l>i){return}if(!(h=this.branchObserverAt(l))){return}g=h.get("length");i-=g-1},this)}b=i-j;var c=this.get("children");if(!c){throw"cannot replace() tree item with no children"}if((b<0)||(i>c.get("length"))){throw"replace() range must lie within a single tree item"}c.replace(j,b,k,d);return this},observerContentDidChange:function(b,c,j){this.invalidateBranchObserversAt(b);this._objectAtCache=this._outlineLevelCache=null;this._disclosureStateCache=null;this._contentGroupIndexes=NO;this.notifyPropertyChange("branchIndexes");var d=this.get("length"),f=this._computeLength(),h=this.get("parentObserver"),g;if(d!==f){this.set("length",f)}if(!this._notifyParent){return this}if(h){g=SC.IndexSet.create(this.get("index"));h._childrenRangeDidChange(h.get("children"),null,"[]",g)}else{if(d===f){c=this.expandChildIndex(b+c);b=this.expandChildIndex(b);c=c-b;j=0}else{b=this.expandChildIndex(b);c=f-b;j=f-d}var i=c;var a=j+i;this.arrayContentDidChange(b,i,a)}},expandChildIndex:function(c){var b=c;if(this.get("isHeaderVisible")){c++}var a=this.get("branchIndexes");if(!a||a.get("length")===0){return b}a.forEachIn(0,c,function(d){b+=this.branchObserverAt(d).get("length")-1},this);return b},_contentGroupIndexes:NO,contentGroupIndexes:function(a,f){if(f!==this){return null}var c=this._contentGroupIndexes;if(c!==NO){return c}if(this.get("parentObserver")){return null}var d=this.get("item"),h,b,i,g;if(d&&d.isTreeItemContent){h=d.get("treeItemIsGrouped")}else{h=!!this.delegate.get("treeItemIsGrouped")}if(h){c=SC.IndexSet.create();b=this.get("branchIndexes");if(b){i=b.min();g=0;b.forEach(function(k){c.add(k+g,1);var j=this.branchObserverAt(k);if(j){g+=j.get("length")-1;i+=g}},this)}}else{c=null}this._contentGroupIndexes=c;return c},contentIndexIsGroup:function(b,d,a){var c=this.contentGroupIndexes(b,d);return c?c.contains(a):NO},contentIndexOutlineLevel:function(k,h,f){if(h!==this){return -1}var a=this._outlineLevelCache;if(a&&(a[f]!==undefined)){return a[f]}if(!a){a=this._outlineLevelCache=[]}var g=this.get("length"),l=f,d=0,i=null,c,b,j;if(f>=g){return -1}if(this.get("isHeaderVisible")){if(f===0){return a[0]=this.get("outlineLevel")-1}else{l--}}if(c=this.get("branchIndexes")){c.forEach(function(o){if((i!==null)||(o>l)){return}var n=this.branchObserverAt(o),m;if(!n){return}m=n.get("length");if(o+m>l){i=n.contentIndexOutlineLevel(k,n,l-o);l=-1}else{l-=m-1}},this)}if(l>=0){i=this.get("outlineLevel")}a[f]=i;return i},contentIndexDisclosureState:function(k,h,f){if(h!==this){return -1}var a=this._disclosureStateCache;if(a&&(a[f]!==undefined)){return a[f]}if(!a){a=this._disclosureStateCache=[]}var g=this.get("length"),l=f,d=0,i=null,c,b,j;if(f>=g){return SC.LEAF_NODE}if(this.get("isHeaderVisible")){if(f===0){return a[0]=this.get("disclosureState")}else{l--}}if(c=this.get("branchIndexes")){c.forEach(function(o){if((i!==null)||(o>l)){return}var n=this.branchObserverAt(o),m;if(!n){return}m=n.get("length");if(o+m>l){i=n.contentIndexDisclosureState(k,n,l-o);l=-1}else{l-=m-1}},this)}if(l>=0){i=SC.LEAF_NODE}a[f]=i;return i},contentIndexExpand:function(b,g,a){var c,h=a,d,f;if(g!==this){return}if(this.get("isHeaderVisible")){if(a===0){this._expand(this.get("item"));return}else{h--}}if(c=this.get("branchIndexes")){c.forEach(function(l){if(l>=h){return}var k=this.branchObserverAt(l),j;if(!k){return}j=k.get("length");if(l+j>h){k.contentIndexExpand(b,k,h-l);h=-1}else{h-=j-1}},this)}if(h>=0){d=this.get("children");f=d?d.objectAt(h):null;if(f){this._expand(f,this.get("item"),h)}}},contentIndexCollapse:function(b,g,a){var c,d,f,h=a;if(g!==this){return}if(this.get("isHeaderVisible")){if(a===0){this._collapse(this.get("item"));return}else{h--}}if(c=this.get("branchIndexes")){c.forEach(function(l){if(l>=h){return}var k=this.branchObserverAt(l),j;if(!k){return}j=k.get("length");if(l+j>h){k.contentIndexCollapse(b,k,h-l);h=-1}else{h-=j-1}},this)}if(h>=0){d=this.get("children");f=d?d.objectAt(h):null;if(f){this._collapse(f,this.get("item"),h)}}},branchObserverAt:function(d){var h=this._branchObserversByIndex,c=this._branchObserverIndexes,f,i,b,k,a,g,j;if(!h){h=this._branchObserversByIndex=[]}if(!c){c=this._branchObserverIndexes=SC.IndexSet.create()}if(f=h[d]){return f}a=this.get("children");k=a?a.objectAt(d):null;if(!k){return null}h[d]=f=SC.TreeItemObserver.create({item:k,delegate:this.get("delegate"),parentObserver:this,index:d,outlineLevel:this.get("outlineLevel")+1});c.add(d);return f},invalidateBranchObserversAt:function(c){var b=this._branchObserversByIndex,a=this._branchObserverIndexes;if(!b||b.length<=c){return this}if(c<0){c=0}a.forEachIn(c,a.get("max")-c,function(f){var d=b[f];if(d){d.destroy()}},this);b.length=c;return this},init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("item");if(!a){throw"SC.TreeItemObserver.item cannot be null"}a.addObserver("*",this,this._itemPropertyDidChange);this._itemPropertyDidChange(a,"*");this._notifyParent=YES},destroy:function(){this.invalidateBranchObserversAt(0);this._objectAtCache=null;this._notifyParent=NO;var c=this.get("item");if(c){c.removeObserver("*",this,this._itemPropertyDidChange)}var a=this._children,b=this._childrenRangeObserver;if(a&&b){a.removeRangeObserver(b)}this.set("length",0);arguments.callee.base.apply(this,arguments)},_itemPropertyDidChange:function(g,b){var a=this.get("children"),f=this.get("disclosureState"),d=this.get("item"),c;this.beginPropertyChanges();c=this._computeDisclosureState(d);if(f!==c){this.set("disclosureState",c)}c=this._computeChildren(d);if(a!==c){this.set("children",c)}this.endPropertyChanges()},_childrenDidChange:function(){var c=this.get("disclosureState"),d=c===SC.BRANCH_OPEN?this.get("children"):null,b=this._children,a=this._childrenRangeObserver;if(b===d){return this}if(a){b.removeRangeObserver(a)}if(d){this._childrenRangeObserver=d.addRangeObserver(null,this,this._childrenRangeDidChange)}else{this._childrenRangeObserver=null}this._children=d;this._childrenRangeDidChange(d,null,"[]",null)}.observes("children","disclosureState"),_childrenRangeDidChange:function(g,j,i,d){var a=this.get("children"),f=a?a.get("length"):0,c=d?d.get("min"):0,h=d?d.get("max"):f,b=this._childrenLen||0;this._childrenLen=f;this.observerContentDidChange(c,h-c,f-b)},_computeDisclosureState:function(d,f,b){var c,a;if(!d||!this._computeChildren(d)){return SC.LEAF_NODE}else{if(d.isTreeItemContent){if(f===undefined){f=this.get("parentItem")}if(b===undefined){b=this.get("index")}return d.treeItemDisclosureState(f,b)}else{c=this._treeItemIsExpandedKey;if(!c){a=this.get("delegate");c=a?a.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=c}return d.get(c)?SC.BRANCH_OPEN:SC.BRANCH_CLOSED}}},_collapse:function(d,f,b){var c,a;if(!d||!this._computeChildren(d)){return this}else{if(d.isTreeItemContent){if(f===undefined){f=this.get("parentItem")}if(b===undefined){b=this.get("index")}d.treeItemCollapse(f,b)}else{c=this._treeItemIsExpandedKey;if(!c){a=this.get("delegate");c=a?a.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=c}d.setIfChanged(c,NO)}}return this},_expand:function(d,f,b){var c,a;if(!d||!this._computeChildren(d)){return this}else{if(d.isTreeItemContent){if(f===undefined){f=this.get("parentItem")}if(b===undefined){b=this.get("index")}d.treeItemExpand(f,b)}else{c=this._treeItemIsExpandedKey;if(!c){a=this.get("delegate");c=a?a.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=c}d.setIfChanged(c,YES)}}return this},_computeChildren:function(c){var a,b;if(!c){return null}else{if(c.isTreeItemContent){return c.get("treeItemChildren")}else{b=this._treeItemChildrenKey;if(!b){a=this.get("delegate");b=a?a.get("treeItemChildrenKey"):"treeItemChildren";this._treeItemChildrenKey=b}return c.get(b)}}},_computeLength:function(){var b=this.get("isHeaderVisible")?1:0,d=this.get("disclosureState"),c=this.get("children"),a;if((d===SC.BRANCH_OPEN)&&c){b+=c.get("length");if(a=this.get("branchIndexes")){a.forEach(function(f){var g=this.branchObserverAt(f);b+=g.get("length")-1},this)}}return b}});sc_require("private/tree_item_observer");SC.TreeController=SC.ObjectController.extend(SC.SelectionSupport,{treeItemIsGrouped:NO,treeItemIsExpandedKey:"treeItemIsExpanded",treeItemChildrenKey:"treeItemChildren",arrangedObjects:function(){var a,b=this.get("content");if(b){a=SC.TreeItemObserver.create({item:b,delegate:this});a.bind("allowsSelection",this,"allowsSelection");a.bind("allowsMultipleSelection",this,"allowsMultipleSelection");a.bind("allowsEmptySelection",this,"allowsEmptySelection")}else{a=null}this._sctc_arrangedObjects=a;return a}.property().cacheable(),_sctc_invalidateArrangedObjects:function(){this.propertyWillChange("arrangedObjects");var a=this._sctc_arrangedObjects;if(a){a.destroy()}this._sctc_arrangedObjects=null;this.propertyDidChange("arrangedObjects")}.observes("content","treeItemIsExpandedKey","treeItemChildrenKey","treeItemIsGrouped"),_sctc_arrangedObjectsContentDidChange:function(){this.updateSelectionAfterContentChange()}.observes("*arrangedObjects.[]"),canSelectGroups:NO,firstSelectableObject:function(){var d=this.get("arrangedObjects"),c,b,a=0;if(!d){return null}if(this.get("canSelectGroups")){return d.get("firstObject")}c=d.contentGroupIndexes(null,d);b=d.get("length");while(c.contains(a)&&(a<b)){a++}return a>=b?null:d.objectAt(a)}.property()});SC.InlineTextFieldDelegate={editor:null,acquireEditor:function(a){var b=this.editor;if(b){if(b.get("isEditing")&&!b.commitEditing()&&!b.discardEditing()){return null}this.releaseEditor(b)}var c=a.exampleEditor?a.exampleEditor:SC.InlineTextFieldView,d=a.get("pane");b=this.editor=d.createChildView(c,{inlineEditorDelegate:this});d.appendChild(b);return b},releaseEditor:function(a){a.removeFromParent();this.editor=null;return YES}};SC.STRING_TITLEIZE_REGEXP=(/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g);SC.STRING_HUMANIZE_REGEXP=(/[\-_]/g);SC.STRING_REGEXP_ESCAPED_REGEXP=(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g);SC.STRING_DASHERIZE_CACHE={top:"top",left:"left",right:"right",bottom:"bottom",width:"width",height:"height",minWidth:"min-width",maxWidth:"max-width"};SC.INFLECTION_CONSTANTS={PLURAL:[[/(quiz)$/i,"$1zes"],[/^(ox)$/i,"$1en"],[/([m|l])ouse$/i,"$1ice"],[/(matr|vert|ind)ix|ex$/i,"$1ices"],[/(x|ch|ss|sh)$/i,"$1es"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(hive)$/i,"$1s"],[/(?:([^f])fe|([lr])f)$/i,"$1$2ves"],[/sis$/i,"ses"],[/([ti])um$/i,"$1a"],[/(buffal|tomat)o$/i,"$1oes"],[/(bu)s$/i,"$1ses"],[/(alias|status)$/i,"$1es"],[/(octop|vir)us$/i,"$1i"],[/(ax|test)is$/i,"$1es"],[/s$/i,"s"],[/$/,"s"]],SINGULAR:[[/(quiz)zes$/i,"$1"],[/(matr)ices$/i,"$1ix"],[/(vert|ind)ices$/i,"$1ex"],[/^(ox)en/i,"$1"],[/(alias|status)es$/i,"$1"],[/(octop|vir)i$/i,"$1us"],[/(cris|ax|test)es$/i,"$1is"],[/(shoe)s$/i,"$1"],[/(o)es$/i,"$1"],[/(bus)es$/i,"$1"],[/([m|l])ice$/i,"$1ouse"],[/(x|ch|ss|sh)es$/i,"$1"],[/(m)ovies$/i,"$1ovie"],[/(s)eries$/i,"$1eries"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/([lr])ves$/i,"$1f"],[/(tive)s$/i,"$1"],[/(hive)s$/i,"$1"],[/([^f])ves$/i,"$1fe"],[/(^analy)ses$/i,"$1sis"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"],[/([ti])a$/i,"$1um"],[/(n)ews$/i,"$1ews"],[/s$/i,""]],IRREGULAR:[["move","moves"],["sex","sexes"],["child","children"],["man","men"],["person","people"]],UNCOUNTABLE:["sheep","fish","series","species","money","rice","information","info","equipment"]};SC.mixin(SC.String,{capitalizeEach:function(a){return a.replace(SC.STRING_TITLEIZE_REGEXP,function(c,b,d){return(d)?(b+d.toUpperCase()):b}).capitalize()},titleize:function(b){var a=b.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2");return a.replace(SC.STRING_TITLEIZE_REGEXP,function(c,f,d){return d?" "+d.toUpperCase():" "}).capitalize()},classify:function(d){var a=d.replace(SC.STRING_TITLEIZE_REGEXP,function(f,h,g){return g?g.toUpperCase():""});var c=a.charAt(0),b=c.toUpperCase();return c!==b?b+a.slice(1):a},humanize:function(a){return SC.String.decamelize(a).replace(SC.STRING_HUMANIZE_REGEXP," ")},escapeForRegExp:function(a){return a.replace(SC.STRING_REGEXP_ESCAPED_REGEXP,"\\$1")},removeDiacritics:function(h){var a=SC.diacriticMappingTable;if(!a){SC.diacriticMappingTable={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"P","":"P","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"`","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"p","":"p","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z"};a=SC.diacriticMappingTable}var d,f,b="",g=h.length;for(var c=0;c<=g;++c){d=h.charAt(c);f=a[d];b+=f||d}return b},pluralize:function(h){var l,f,b=h.split(/\s/).pop(),i=h.replace(b,""),a=b.charAt(0).match(/[A-Z]/)?true:false;b=b.toLowerCase();for(l=0,f=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;l<f;l++){var g=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[l];if(b==g){return h.toString()}}for(l=0,f=SC.INFLECTION_CONSTANTS.IRREGULAR.length;l<f;l++){var c=SC.INFLECTION_CONSTANTS.IRREGULAR[l][0],k=SC.INFLECTION_CONSTANTS.IRREGULAR[l][1];if((b==c)||(b==k)){if(a){k=k.capitalize()}return i+k}}for(l=0,f=SC.INFLECTION_CONSTANTS.PLURAL.length;l<f;l++){var j=SC.INFLECTION_CONSTANTS.PLURAL[l][0],d=SC.INFLECTION_CONSTANTS.PLURAL[l][1];if(j.test(b)){return h.replace(j,d)}}},singularize:function(h){var l,f,b=h.split(/\s/).pop(),i=h.replace(b,""),a=b.charAt(0).match(/[A-Z]/)?true:false;b=b.toLowerCase();for(l=0,f=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;l<f;l++){var g=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[l];if(b==g){return h.toString()}}for(l=0,f=SC.INFLECTION_CONSTANTS.IRREGULAR.length;l<f;l++){var c=SC.INFLECTION_CONSTANTS.IRREGULAR[l][0],k=SC.INFLECTION_CONSTANTS.IRREGULAR[l][1];if((b==c)||(b==k)){if(a){c=c.capitalize()}return i+c}}for(l=0,f=SC.INFLECTION_CONSTANTS.SINGULAR.length;l<f;l++){var j=SC.INFLECTION_CONSTANTS.SINGULAR[l][0],d=SC.INFLECTION_CONSTANTS.SINGULAR[l][1];if(j.test(b)){return h.replace(j,d)}}}});SC.String.strip=SC.String.trim;sc_require("system/string");SC.supplement(String.prototype,{capitalizeEach:function(){return SC.String.capitalizeEach(this,arguments)},titleize:function(a){return SC.String.titleize(this,arguments)},classify:function(a){return SC.String.classify(this,arguments)},humanize:function(a){return SC.String.humanize(this,arguments)},escapeForRegExp:function(a){return SC.String.escapeForRegExp(this,arguments)},removeDiacritics:function(a){return SC.String.removeDiacritics(this,arguments)},trim:function(a){return SC.String.trim(this,arguments)},trimLeft:function(a){return SC.String.trimLeft(this,arguments)},trimRight:function(a){return SC.String.trimRight(this,arguments)},pluralize:function(a){return SC.String.pluralize(this,arguments)},singularize:function(a){return SC.String.singularize(this,arguments)}});SC.Gesture=SC.Object.extend({name:"gesture",touchIsInGesture:function(b,a){return NO},touchStart:function(a){},touchesDragged:function(a,b){},touchEnd:function(a){},start:function(){if(!this.get("isActive")){this.set("isActive",YES);var b=SC.$A(arguments);b.unshift(this);var a=this.name+"Start";if(this.view[a]){this.view[a].apply(this.view,b)}}},end:function(){if(this.get("isActive")){this.set("isActive",NO);var b=SC.$A(arguments);b.unshift(this);var a=this.name+"End";if(this.view[a]){this.view[a].apply(this.view,b)}}},change:function(){if(this.get("isActive")){var b=SC.$A(arguments);b.unshift(this);var a=this.name+"Changed";if(this.view[a]){this.view[a].apply(this.view,b)}}},cancel:function(){if(this.get("isActive")){this.set("isActive",NO);var b=SC.$A(arguments);b.unshift(this);var a=this.name+"Cancelled";if(this.view[a]){this.view[a].apply(this.view,b)}}},trigger:function(){var b=SC.$A(arguments);b.unshift(this);var a=this.name;if(this.view[a]){this.view[a].apply(this.view,b)}},take:function(a){a.isTaken=YES;if(SC.none(a.touchResponder)||a.touchResponder!==this){a.makeTouchResponder(this,YES)}},release:function(a){a.isTaken=NO;if(a.nextTouchResponder){a.makeTouchResponder(a.nextTouchResponder)}},discardTouch:function(a){a.isTaken=YES;a.makeTouchResponder(null)},statusForTouch:function(c){var b=SC.guidFor(c.view)+this.name;var a=c[b];if(!a){a=c[b]={}}return a},unassignedTouchDidStart:function(a){if(a.isTaken){return}if(this.touchIsInGesture(a,this.statusForTouch(a))){this.take(a)}},unassignedTouchesDidChange:function(a,b){b.forEach(function(c){if(c.isTaken){return}if(this.touchIsInGesture(c,this.statusForTouch(c))){this.take(c)}},this)},unassignedTouchDidEnd:function(a){},interestedInTouch:function(b){var a=this.statusForTouch(b);if(a.isInterested){return}a.isInterested=YES;b.isInteresting++},uninterestedInTouch:function(b){var a=this.statusForTouch(b);if(!a.isInterested){return}a.isInterested=NO;b.isInteresting--}});sc_require("system/gesture");SC.PinchGesture=SC.Gesture.extend({name:"pinch",acceptsMultitouch:YES,scale:1,unassignedTouchesDidChange:function(a,b){if(b.length==2){this.take(b[0]);this.take(b[1])}},touchStart:function(b){var a=b.touchesForResponder(this);if(!a||a.length===0){return YES}else{if(a.length==1){this.start([a[0],b]);return YES}else{return NO}}},touchesDragged:function(a,c){var d=c.firstObject(),b=d.averagedTouchesForView(this);if(b.touchCount==2){if(!this._startDistance){this._startDistance=b.d}this.scale=b.d/this._startDistance;this.change(c,this.scale)}},touchEnd:function(b){this._startDistance=null;var a=b.touchesForResponder(this);this.trigger(a,this.scale);this.end(a,this.scale);if(a){a.forEach(function(c){this.release(c)},this)}}});sc_require("system/gesture");SC.SWIPE_HORIZONTAL="X";SC.SWIPE_VERTICAL="Y";SC.SWIPE_ANY="XY";SC.SWIPE_LEFT="LEFT";SC.SWIPE_RIGHT="RIGHT";SC.SWIPE_UP="UP";SC.SWIPE_DOWN="DOWN";SC.SwipeGesture=SC.Gesture.extend({name:"swipe",acceptsMultitouch:YES,direction:SC.SWIPE_HORIZONTAL,currentDirection:null,startDistance:5,swipeDistance:40,tolerance:0.5,touchIsInGesture:function(j,h){if(!h.flunked){var k=this.get("direction"),f=this.get("currentDirection"),a=this.get("startDistance"),i=j.pageX-j.startX,g=j.pageY-j.startY,c=Math.abs(i),b=Math.abs(g);if(Math.abs(i)>a||Math.abs(g)>a){if(!f){if(k==SC.SWIPE_ANY){if(c>b){f=SC.SWIPE_HORIZONTAL}else{if(b>c){f=SC.SWIPE_VERTICAL}else{return NO}}}else{f=k}this.set("currentDirection",f)}var m=(f==SC.SWIPE_HORIZONTAL)?i:g,l=(f==SC.SWIPE_HORIZONTAL)?g:i;if(Math.abs(m)*this.get("tolerance")>Math.abs(l)){return YES}}}return NO},touchStart:function(f){var b=this.get("currentDirection"),c=f["page"+b]-f["start"+b],a;if(c<0){a=(b===SC.SWIPE_HORIZONTAL)?SC.SWIPE_LEFT:SC.SWIPE_UP}else{a=(b===SC.SWIPE_HORIZONTAL)?SC.SWIPE_RIGHT:SC.SWIPE_DOWN}this.start(f,a,c);return YES},touchesDragged:function(k,f){var c=f.firstObject();var g=this.get("currentDirection"),a=(g===SC.SWIPE_HORIZONTAL?"Y":"X"),j=c["page"+g]-c["start"+g],h=c["page"+a]-c["start"+a],i;if(j<0){i=(g===SC.SWIPE_HORIZONTAL)?SC.SWIPE_LEFT:SC.SWIPE_UP}else{i=(g===SC.SWIPE_HORIZONTAL)?SC.SWIPE_RIGHT:SC.SWIPE_DOWN}if(Math.abs(j)<this.get("startDistance")||Math.abs(j)*this.get("tolerance")<Math.abs(h)){this.release(c);var b=c.touchesForResponder(this);if(!b||b.length===0){this.cancel(c,i,j)}}else{this.change(c,i,j)}},touchEnd:function(i){var g=this.get("currentDirection"),f=(g===SC.SWIPE_HORIZONTAL?"Y":"X"),h=i["page"+g]-i["start"+g],b=i["page"+f]-i["start"+f],a;if(h<0){a=(g===SC.SWIPE_HORIZONTAL)?SC.SWIPE_LEFT:SC.SWIPE_UP}else{a=(g===SC.SWIPE_HORIZONTAL)?SC.SWIPE_RIGHT:SC.SWIPE_DOWN}if(Math.abs(h)>this.get("swipeDistance")||Math.abs(h)*this.get("tolerance")<Math.abs(b)){this.trigger(i,a)}this.end(i,a,h);this.set("currentDirection",null);var c=i.touchesForResponder(this);if(c){c.forEach(function(d){this.release(d)},this)}},cancel:function(){arguments.callee.base.apply(this,arguments);this.set("currentDirection",null)}});sc_require("system/gesture");SC.TapGesture=SC.Gesture.extend({name:"tap",acceptsMultitouch:NO,_tapCount:null,_candidateTouch:null,_eventTimer:null,tapWiggle:10,tapDelay:200,touchIsInGesture:function(b,a){return !b.tapFlunked},touchStart:function(a){if(this._eventTimer){this._eventTimer.invalidate()}if(this._candidateTouch&&this._candidateTouch.touch.identifier!==a.identifier){this._cancelTap(a);return NO}this._candidateTouch={startTime:Date.now(),touch:a};this.start(a);return YES},touchesDragged:function(a,c){var f=c[0];var b=(c.length>1||!this._candidateTouch||f.identifier!==this._candidateTouch.touch.identifier);var d=this._calculateDragDistance(f)>this.get("tapWiggle");if(b||d){this._cancelTap(f)}},touchEnd:function(a){if(this._calculateDragDistance(a)>this.get("tapWiggle")||Date.now()-this._candidateTouch.startTime>this.get("tapDelay")){this._cancelTap(a)}else{this._addTap(a)}},_addTap:function(b){var a=this;if(this._eventTimer){this._eventTimer.invalidate()}this._tapCount=(this._tapCount||0)+1;this._candidateTouch=null;this._eventTimer=SC.Timer.schedule({target:a,action:function(){this._triggerTap(b)},interval:this.get("tapDelay")});this.change(b,this._tapCount);this.trigger(b,this._tapCount)},_cancelTap:function(a){a.tapFlunked=YES;this.release(a);this.cancel(a,this._tapCount);if(this._eventTimer){this._eventTimer.invalidate()}this._tapCount=null;this._candidateTouch=null;this._eventTimer=null},_triggerTap:function(a){this.end(a,this._tapCount);this._tapCount=null;this._candidateTouch=null;this._eventTimer=null},_calculateDragDistance:function(a){return Math.sqrt(Math.pow(a.pageX-a.startX,2)+Math.pow(a.pageY-a.startY,2))}});SC.AutoMixin={autoMixins:[],createChildView:function(b,c){if(!c){c={}}c.owner=c.parentView=this;c.isVisibleInWindow=this.get("isVisibleInWindow");if(!c.page){c.page=this.page}var a=this.get("autoMixins");a.push(c);b=b.create.apply(b,a);return b}};SC.mixin({_copy_computed_props:["maxWidth","maxHeight","paddingLeft","paddingRight","paddingTop","paddingBottom","fontFamily","fontSize","fontStyle","fontWeight","fontVariant","lineHeight","whiteSpace","letterSpacing","wordWrap"],stringFromLayout:function(f){var d=["maxHeight","maxWidth","minHeight","minWidth","centerY","centerX","width","height","bottom","right","top","left","zIndex","opacity","border","borderLeft","borderRight","borderTop","borderBottom"],a=[],c,b=d.length;while(--b>=0){c=d[b];if(f.hasOwnProperty(c)){a.push(c+":"+f[c])}}return"{"+a.join(", ")+"}"},heightForString:function(i,c,b,a,h){var f=this._heightCalcElement,g,j;if(!h){i=SC.RenderContext.escapeHTML(i)}g=(a&&SC.typeOf(a)===SC.T_ARRAY)?a.join(" "):"";if(!c){c=100}if(!f){f=this._heightCalcElement=document.createElement("div");document.body.insertBefore(f,null)}b=b+"; width: "+c+"px; left: "+(-1*c)+"px; position: absolute";var d=SC.$(f);d.attr("style",b);if(g!==""){d.attr("class",g)}f.innerHTML=i;j=f.clientHeight;f=null;return j},prepareStringMeasurement:function(p,a){var l=this._metricsCalculationElement,j,q,c,d;j=SC.A(a).join(" ");if(!l){var o=document.createElement("div");o.style.cssText="position:absolute; left:-10010px; top:-10px;width:10000px; height:0px; overflow:hidden;visibility:hidden;";l=this._metricsCalculationElement=document.createElement("div");o.appendChild(l);document.body.insertBefore(o,null)}d=SC.$(l);if(SC.typeOf(p)!=SC.T_STRING){var h=null;if(document.defaultView&&document.defaultView.getComputedStyle){h=document.defaultView.getComputedStyle(p,null)}else{h=p.currentStyle}var n=this._copy_computed_props;for(var k=0;k<n.length;k++){var b=n[k],g=h[b];l.style[b]=g}var m=l.style;if(m.font===""){var f="";if(m.fontStyle){f+=m.fontStyle+" "}if(m.fontVariant){f+=m.fontVariant+" "}if(m.fontWeight){f+=m.fontWeight+" "}if(m.fontSize){f+=m.fontSize}else{f+="10px"}if(m.lineHeight){f+="/"+m.lineHeight}f+=" ";if(m.fontFamily){f+=m.fontFamily}else{m+="sans-serif"}l.style.font=f}SC.mixin(l.style,{left:"0px",top:"0px",position:"absolute",bottom:"auto",right:"auto",width:"auto",height:"auto"});h=null}else{c=p;d.attr("style",c+"; position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;")}l.className=j;l=null},teardownStringMeasurement:function(){var a=this._metricsCalculationElement;a.innerHTML="";a.className="";a.setAttribute("style","");a=null},measureString:function(c,b){var d=this._metricsCalculationElement,f=0;if(!d){throw"measureString requires a string measurement environment to be set up. Did you mean metricsForString?"}if(b){d.innerHTML=c}else{if(typeof d.innerText!="undefined"){d.innerText=c}else{d.textContent=c}}if(SC.browser.isIE){f=1}var a={width:d.clientWidth+f,height:d.clientHeight};if(SC.browser.isMozilla){a.width+=1}d=null;return a},metricsForString:function(c,d,f,b){SC.prepareStringMeasurement(d,f);var a=SC.measureString(c,b);SC.teardownStringMeasurement();return a}});sc_require("system/utils/string_measurement");SC.AutoResize={shouldAutoResize:YES,shouldMeasureSize:YES,shouldCacheSizes:NO,shouldResizeWidth:YES,shouldResizeHeight:NO,measuredSize:{width:0,height:0},maxWidth:null,maxHeight:null,shouldAutoFitText:NO,autoFitDiscreteFontSizes:NO,minFontSize:12,maxFontSize:20,calculatedFontSize:20,fontPropertyDidChange:function(){if(this.get("shouldAutoFitText")){this.invokeLast(this.fitTextToFrame)}}.observes("shouldAutoFitText","minFontSize","maxFontSize","measuredSize"),measuredSizeDidChange:function(){var c=this.get("measuredSize"),b=c.width,i=c.height,h,a,d=this.get("autoResizePadding")||0,g=this.get("maxWidth"),f=this.get("maxHeight");if(SC.typeOf(d)===SC.T_NUMBER){h=a=d}else{h=d.height;a=d.width}i+=h;b+=a;if(this.get("shouldAutoResize")){if(this.get("shouldResizeWidth")){if(g&&b>g){b=g}this.set("calculatedWidth",b);this.adjust("width",b)}if(this.get("shouldResizeHeight")){if(f&&i>f){i=f}this.set("calculatedHeight",i);this.adjust("height",i)}}}.observes("shouldAutoResize","measuredSize","autoResizePadding","maxWidth","minWidth","shouldResizeWidth","shouldResizeHeight"),initMixin:function(){},batchResizeId:null,scheduleMeasurement:function(){var a=this.get("batchResizeId");if(!this.get("shouldMeasureSize")||!this.get("isVisibleInWindow")||(this.get("autoResizeText")===this._lastMeasuredText&&a===this._lastMeasuredId)){return}SC.AutoResizeManager.scheduleMeasurementForView(this,a)}.observes("isVisibleInWindow","shouldMeasureSize","autoResizeText","batchResizeId"),_lastMeasuredText:null,_cachedMetrics:function(c,d){if(!this.get("shouldCacheSizes")){return}var b=SC.cacheSlotFor(this.get("batchResizeId")||this),a=this.get("autoResizeText");if(d){b[a]=d}else{d=b[a]}return d}.property("shouldCacheSizes","autoResizeText","batchResizeId").cacheable(),measureSize:function(d){var i,f=this.get("autoResizeLayer"),c=this.get("autoResizeText"),b=!this.get("escapeHTML"),h=this.get("batchResizeId"),a=this.get("_cachedMetrics"),g=this.get("maxFontSize");if(!f){return}if(a){i=a}else{if(SC.none(c)||c===""){i={width:0,height:0}}else{if(d){i=SC.measureString(c,b)}else{this.prepareLayerForStringMeasurement(f);i=SC.metricsForString(c,f,this.get("classNames"),b)}}}this.set("measuredSize",i);if(this.get("shouldCacheSizes")){this.setIfChanged("_cachedMetrics",i)}this._lastMeasuredText=c;this._lastMeasuredId=h;return i},prepareLayerForStringMeasurement:function(a){var b=this.get("maxFontSize");if(this.get("shouldAutoFitText")&&this.get("calculatedFontSize")!==b){a.style.fontSize=b+"px"}},viewDidResize:function(a){a();this.fontPropertyDidChange()}.enhance(),fitTextToFrame:function(){var r=this.get("autoResizeLayer");if(!r){return}var c=this.get("maxFontSize"),d=this.get("minFontSize");this.prepareLayerForStringMeasurement(r);var f=this.get("frame"),g=this.get("autoResizePadding")||0,k=f.width-1,h=f.height-1,q=this.get("measuredSize"),a=q.width,s=q.height;if(SC.typeOf(g)===SC.T_NUMBER){k-=g;h-=g}else{k-=g.width;h-=g.height}if(a<=k&&s<=h){return}if(this.get("autoFitDiscreteFontSizes")){i=d}else{var b=k/a,j=h/s,m=Math.floor(c*Math.min(b,j)),i,p=this.get("classNames"),o=!this.get("escapeHTML"),l=this.get("autoResizeText"),n;m=i=Math.min(c,Math.max(d,m));r.style.fontSize=m+"px";n=SC.metricsForString(l,r,p,o);if(n.width>k||n.height>h){for(m=m-1;m>=d;m--){r.style.fontSize=m+"px";n=SC.metricsForString(l,r,p,o);i=m;if(n.width<=k&&n.height<=h){break}}}else{if(n.width<k||n.height<h){for(m=m+1;m<=c;m++){r.style.fontSize=m+"px";n=SC.metricsForString(l,r,p,o);if(n.width<=k&&n.height<=h){i=m}if(n.width>=k||n.height>=h){break}}}}}r.style.fontSize=i+"px";this.set("calculatedFontSize",i)},applyAttributesToContext:function(b,a){b(a);if(this.get("shouldAutoFitText")){a.css("font-size",this.get("calculatedFontSize")+"px")}}.enhance(),didCreateLayer:function(a){a();this.scheduleMeasurement()}.enhance()};SC.AutoResizeManager={measurementQueue:SC.CoreSet.create(),scheduleMeasurementForView:function(a){this.measurementQueue.add(a);SC.RunLoop.currentRunLoop.invokeLast(this.doBatchResize)},cancelMeasurementForView:function(a,b){this.measurementQueue.remove(a)},doBatchResize:function(){if(this!==SC.AutoResizeManager){return SC.AutoResizeManager.doBatchResize()}var b,d,g,h=this.measurementQueue,j,c,f,a;while((a=h.get("length"))>0){j=NO;b=h[a-1].get("batchResizeId");for(f=a-1;f>=0;--f){d=h[f];if(d.get("batchResizeId")!==b){continue}if(d.get("isVisibleInWindow")&&d.get("shouldMeasureSize")&&(g=d.get("autoResizeLayer"))){c=d.get("autoResizeText");if(!SC.none(c)&&c!==""&&!d.get("_cachedMetrics")&&!j){d.prepareLayerForStringMeasurement(g);SC.prepareStringMeasurement(g,d.get("classNames"));j=YES}d.measureSize(YES)}h.remove(d);if(!b){break}}if(j){SC.teardownStringMeasurement()}}}};if(SC.Button){SC.Button.initMixin=function(){throw"SC.Button is deprecated as a mixin and is now a subclass of SC.TemplateView. Subclass SC.ButtonView instead."}}SC.ContentDisplay={concatenatedProperties:"contentDisplayProperties",displayProperties:["content"],contentDisplayProperties:[],initMixin:function(){this._display_contentDidChange()},destroyMixin:function(){if(!this._display_content){return}this._display_stopObservingContent(this._display_content);this._display_content=null},_display_beginObservingContent:function(a){var b=this._display_contentPropertyDidChange;if(SC.isArray(a)){a.invoke("addObserver","*",this,b)}else{if(a.addObserver){a.addObserver("*",this,b)}}},_display_stopObservingContent:function(a){var b=this._display_contentPropertyDidChange;if(SC.isArray(a)){a.invoke("removeObserver","*",this,b)}else{if(a.removeObserver){a.removeObserver("*",this,b)}}},_display_contentDidChange:function(d,a,c){if((c=this.get("content"))===this._display_content){return}var b=this._display_content;if(b){this._display_stopObservingContent(b)}b=this._display_content=c;if(b){this._display_beginObservingContent(b)}this.displayDidChange()}.observes("content","contentDisplayProperties"),_display_contentPropertyDidChange:function(f,c,d,b){if(c==="*"){this.displayDidChange()}else{var a=this.get("contentDisplayProperties");if(a&&a.indexOf(c)>=0){this.displayDidChange()}}}};SC.ContentValueSupport={hasContentValueSupport:YES,initMixin:function(){this._control_contentKeysDidChange()},value:null,content:null,contentKeys:null,_default_contentKeys:{contentValueKey:"value"},contentValueKey:null,contentPropertyDidChange:function(c,b){var a=this.get("contentKeys");if(a){var d;for(d in a){if(b==="*"||b===this.getDelegateProperty(d,this,this.get("displayDelegate"),a)){return this.updatePropertyFromContent(a[d],b,d,c)}}}else{return this.updatePropertyFromContent("value",b,"contentValueKey",c)}},updatePropertyFromContent:function(g,c,f,d){var a,b;if(f===undefined){f="content"+g.capitalize()+"Key"}if(this[f]){f=this.get(f)}else{if((a=this.get("displayDelegate"))&&(b=a[f])){f=a.get?a.get(f):b}else{return this}}if(c==="*"||c===f){if(d===undefined){d=this.get("content")}if(d){b=d.get?d.get(f):d[f]}else{b=null}this.setIfChanged(g,b)}return this},updateContentWithValueObserver:function(d,a){var g=this._reverseContentKeys;if(!a||a==="*"){for(a in g){this.updateContentWithValueObserver(this,a)}}var c=this.get(a);var b=this.get("content"),f=this.getDelegateProperty(g[a],this,this.displayDelegate);if(!f||!b){return this}if(typeof b.setIfChanged===SC.T_FUNCTION){b.setIfChanged(f,c)}else{if(b[f]!==c){b[f]=c}}},_control_content:null,_old_contentValueKeys:null,_old_contentKeys:null,_control_contentDidChange:function(j,m){var k=this.get("content"),b=this.get("contentKeys"),a,c=this._control_content,n=this._old_contentValueKeys,l=SC.typeOf(n),h=this.contentPropertyDidChange;if(c&&c.removeObserver&&n){if(l===SC.T_STRING){c.removeObserver(n,this,h);n=null}else{var d,g=n.get("length");for(d=0;d<g;d++){a=n[d];c.removeObserver(a,this,h)}n.clear()}}if(k&&k.addObserver){if(b){if(!n){n=SC.CoreSet.create()}for(a in b){a=this.getDelegateProperty(a,this,this.get("displayDelegate"));if(a){k.addObserver(a,this,h);n.add(a)}}}else{a=this.getDelegateProperty("contentValueKey",this,this.get("displayDelegate"));if(a){k.addObserver(a,this,h);if(n){n.add(a)}else{n=a}}}}this._control_content=k;this._old_contentValueKeys=n;m=(!m||m==="content")?"*":this.get(m);if(m){this.contentPropertyDidChange(k,m)}}.observes("content"),_old_contentKeys:null,_control_contentKeysDidChange:function(){var d,c={},a=this.get("contentKeys")||this._default_contentKeys,i,b=this._old_contentKeys,h=this._control_contentDidChange,g=this.updateContentWithValueObserver;for(d in b){i=b[d];this.removeObserver(i,this,g);this.removeObserver(d,this,h)}for(d in a){i=a[d];c[i]=d;this.addObserver(i,this,g);this.addObserver(d,this,h)}this._reverseContentKeys=c;this._old_contentKeys=a;this._control_contentDidChange()}.observes("contentKeys")};sc_require("mixins/content_value_support");sc_require("system/string");SC.AUTO_CONTROL_SIZE="__AUTO__";SC.JUMBO_CONTROL_SIZE="sc-jumbo-size";SC.HUGE_CONTROL_SIZE="sc-huge-size";SC.LARGE_CONTROL_SIZE="sc-large-size";SC.REGULAR_CONTROL_SIZE="sc-regular-size";SC.SMALL_CONTROL_SIZE="sc-small-size";SC.TINY_CONTROL_SIZE="sc-tiny-size";SC.Control=SC.mixin(SC.clone(SC.ContentValueSupport),{isControl:YES,isSelected:NO,isSelectedBindingDefault:SC.Binding.oneWay().bool(),isActive:NO,isActiveBindingDefault:SC.Binding.oneWay().bool(),fieldKey:null,fieldLabel:null,errorLabel:function(){var a,d,c,b;if(a=this.get("fieldLabel")){return a}d=this.get("fieldKey")||this.constructor.toString();c=d?SC.String.capitalize(SC.String.humanize(d)):"";b=SC.String.locWithDefault("FieldKey."+d,c);return SC.String.locWithDefault("ErrorLabel."+d,b)}.property("fieldLabel","fieldKey").cacheable(),controlSize:SC.REGULAR_CONTROL_SIZE,displayProperties:["isEnabled","isSelected","isActive","controlSize"],_CONTROL_TMP_CLASSNAMES:{},renderMixin:function(b,h){var d=this.get("isSelected"),c=!this.get("isEnabled"),f=this._CONTROL_TMP_CLASSNAMES;f.mixed=d===SC.MIXED_STATE;f.sel=d&&(d!==SC.MIXED_STATE);f.active=this.get("isActive");var g=this.get("controlSize");if(!g){g=SC.REGULAR_CONTROL_SIZE}if(h){b.setClass(f);if(!this.get("renderDelegate")){b.addClass(g)}}else{b.$().setClass(f);if(!this.get("renderDelegate")){b.$().addClass(g)}}if(!h&&this.$input){var a=this.$input();if(a.attr("type")!=="radio"){this.$input().attr("disabled",c)}}}});SC.Editable={isEditable:NO,isEditing:NO,beginEditing:function(){if(!this.get("isEditable")){return NO}if(this.get("isEditing")){return YES}this.beginPropertyChanges();this.set("isEditing",YES);this.becomeFirstResponder();this.endPropertyChanges();return YES},discardEditing:function(){return !this.get("isEditing")},commitEditing:function(){if(!this.get("isEditing")){return YES}this.set("isEditing",NO);this.resignFirstResponder();return YES}};SC.ALIGN_JUSTIFY="justify";SC.FlowedLayout={isFlowedLayout:YES,layoutDirection:SC.LAYOUT_HORIZONTAL,autoResize:YES,shouldResizeWidth:YES,shouldResizeHeight:YES,align:SC.ALIGN_LEFT,canWrap:YES,defaultFlowSpacing:{left:0,bottom:0,top:0,right:0},flowPadding:{left:0,bottom:0,right:0,top:0},_scfl_validFlowPadding:function(){var b=this.get("flowPadding")||{},a={};a.left=b.left||0;a.top=b.top||0;a.bottom=b.bottom||0;a.right=b.right||0;return a}.property("flowPadding").cacheable(),concatenatedProperties:["childMixins"],initMixin:function(){this._scfl_tileOnce()},_scfl_childViewsDidChange:function(a){this._scfl_tileOnce()}.observes("childViews"),_scfl_layoutPropertyDidChange:function(a){this._scfl_tileOnce()}.observes("layoutDirection","align","flowPadding","canWrap","defaultFlowSpacing","isVisibleInWindow"),layoutDidChangeFor:function(h){var b=h._scfl_lastLayout,a=h.get("layout"),d=h.get("frame");if(!b){return arguments.callee.base.apply(this,arguments)}var g=YES;if(b.left&&b.left!==a.left){g=NO}else{if(b.top&&b.top!==a.top){g=NO}else{if(!h.get("fillWidth")&&b.width&&b.width!==a.width){g=NO}else{if(!b.width&&!h.get("fillWidth")&&d.width!==h._scfl_lastFrame.width){g=NO}else{if(!h.get("fillHeight")&&b.height&&b.height!==a.height){g=NO}else{if(!b.height&&!h.get("fillHeight")&&d.height!==h._scfl_lastFrame.height){g=NO}}}}}}if(g){return arguments.callee.base.apply(this,arguments)}this._scfl_tileOnce();arguments.callee.base.apply(this,arguments)},observeChildLayout:function(a){if(a._scfl_isBeingObserved){return}a._scfl_isBeingObserved=YES;a.addObserver("flowSpacing",this,"_scfl_tileOnce");a.addObserver("isVisible",this,"_scfl_tileOnce");a.addObserver("useAbsoluteLayout",this,"_scfl_tileOnce");a.addObserver("calculatedWidth",this,"_scfl_tileOnce");a.addObserver("calculatedHeight",this,"_scfl_tileOnce");a.addObserver("startsNewRow",this,"_scfl_tileOnce");a.addObserver("isSpacer",this,"_scfl_tileOnce");a.addObserver("maxSpacerLength",this,"_scfl_tileOnce");a.addObserver("fillWidth",this,"_scfl_tileOnce");a.addObserver("fillHeight",this,"_scfl_tileOnce")},unobserveChildLayout:function(a){a._scfl_isBeingObserved=NO;a.removeObserver("flowSpacing",this,"_scfl_tileOnce");a.removeObserver("isVisible",this,"_scfl_tileOnce");a.removeObserver("useAbsoluteLayout",this,"_scfl_tileOnce");a.removeObserver("calculatedWidth",this,"_scfl_tileOnce");a.removeObserver("calculatedHeight",this,"_scfl_tileOnce");a.removeObserver("startsNewRow",this,"_scfl_tileOnce");a.removeObserver("isSpacer",this,"_scfl_tileOnce");a.removeObserver("maxSpacerLength",this,"_scfl_tileOnce");a.removeObserver("fillWidth",this,"_scfl_tileOnce");a.removeObserver("fillHeight",this,"_scfl_tileOnce")},shouldIncludeChildInFlow:function(a,b){return b.get("isVisible")&&!b.get("useAbsoluteLayout")},flowSpacingForChild:function(a,b){var c=b.get("flowSpacing");if(SC.none(c)){c=this.get("defaultFlowSpacing")}if(SC.none(c)){c=0}if(SC.typeOf(c)===SC.T_NUMBER){c={left:c,right:c,bottom:c,top:c}}else{c.left=c.left||0;c.right=c.right||0;c.top=c.top||0;c.bottom=c.bottom||0}return c},flowSizeForChild:function(a,d){var c=d.get("calculatedWidth"),h=d.get("calculatedHeight"),j=this.get("layoutDirection"),g={},i=d.get("frame"),b=d.get("layout");d._scfl_lastFrame=i;if(c){g.width=c}else{g.width=b.width||i.width}if(h){g.height=h}else{g.height=b.height||i.height}if(d.get("isSpacer")){g.maxSpacerLength=d.get("maxSpacerLength");if(j===SC.LAYOUT_HORIZONTAL){g.width=b.minWidth||0}else{g.height=b.minHeight||0}}if(j===SC.LAYOUT_HORIZONTAL&&d.get("fillHeight")){g.height=b.minHeight||0}else{if(j===SC.LAYOUT_VERTICAL&&d.get("fillWidth")){g.width=b.minWidth||0}}return g},clippingFrame:function(){return{left:0,top:0,width:this.get("calculatedWidth"),height:this.get("calculatedHeight")}}.property("calculatedWidth","calculatedHeight"),_scfl_maxCollapsedRowLength:0,_scfl_totalCollapsedRowSize:0,_scfl_calculatedSizeDidChange:function(){if(this.get("autoResize")){if(this.get("layoutDirection")==SC.LAYOUT_VERTICAL){if(this.get("shouldResizeHeight")){this.adjust("minHeight",this.get("_scfl_maximumCollapsedRowLength"))}if(this.get("shouldResizeWidth")){this.adjust("minWidth",this.get("_scfl_totalCollapsedRowSize"))}}else{if(this.get("shouldResizeWidth")){this.adjust("minWidth",this.get("_scfl_maximumCollapsedRowLength"))}if(this.get("shouldResizeHeight")){this.adjust("minHeight",this.get("_scfl_totalCollapsedRowSize"))}}}}.observes("autoResize","shouldResizeWidth","_scfl_maximumCollapsedRowLength","_scfl_totalCollapsedRowSize","shouldResizeHeight"),_scfl_createPlan:function(){var f=this.get("layoutDirection"),a=this.get("_scfl_validFlowPadding"),d=this.get("frame");var c=(f===SC.LAYOUT_VERTICAL);var b={rows:undefined,maximumCollapsedRowLength:0,totalCollapsedRowSize:0,isVertical:f===SC.LAYOUT_VERTICAL,isHorizontal:f===SC.LAYOUT_HORIZONTAL,flowPadding:a,planStartPadding:a[c?"left":"top"],planEndPadding:a[c?"right":"bottom"],rowStartPadding:a[c?"top":"left"],rowEndPadding:a[c?"bottom":"right"],maximumRowLength:undefined,fitToPlanSize:undefined,align:this.get("align")};if(c){b.maximumRowLength=d.height-b.rowStartPadding-b.rowEndPadding;b.fitToPlanSize=d.width-b.planStartPadding-b.planEndPadding}else{b.maximumRowLength=d.width-b.rowStartPadding-b.rowEndPadding;b.fitToPlanSize=d.height-b.planStartPadding-b.planEndPadding}return b},_scfl_distributeChildrenIntoRows:function(d){var b=this.get("childViews"),a,h,c=b.length,f=d.isVertical,j=[],g;g=-1;h=0;while(h<c&&h!==g){g=h;var i={plan:d,rowLength:undefined,rowSize:undefined,shouldExpand:undefined,items:undefined,position:undefined};h=this._scfl_distributeChildrenIntoRow(b,h,i);j.push(i)}d.rows=j},_scfl_distributeChildrenIntoRow:function(f,n,j){var p,u=f.length,b=j.plan,h,a,d,q=[],l=0,m=b.isVertical,k,g,c,o=this.get("canWrap"),i=NO,r=0,t=j.plan.maximumRowLength;for(p=n;p<u;p++){h=f[p];i=i||(q.length>0&&h.get("startsNewRow"));if(!this.shouldIncludeChildInFlow(p,h)){continue}a=this.flowSizeForChild(p,h);d=this.flowSpacingForChild(p,h);a.width+=d.left+d.right;a.height+=d.top+d.bottom;g=a[m?"height":"width"];if(!SC.none(a.maxSpacerLength)){c=a.maxSpacerLength+(m?d.top+d.bottom:d.left+d.right)}k=a[m?"width":"height"];if((i||(o&&l+g>t))&&q.length>0){break}var v={child:h,itemLength:g,maxSpacerLength:c,itemSize:k,spacing:d,position:undefined,fillRow:m?h.get("fillWidth"):h.get("fillHeight"),isSpacer:h.get("isSpacer"),left:undefined,top:undefined,width:undefined,height:undefined};q.push(v);l+=g;r=Math.max(g,r)}j.rowLength=l;var s=o?r:j.rowLength;j.plan.maximumCollapsedRowLength=Math.max(s,j.plan.maximumCollapsedRowLength);j.items=q;return p},_scfl_positionChildrenInRows:function(d){var c=d.rows,b=c.length,a;for(a=0;a<b;a++){this._scfl_positionChildrenInRow(c[a])}},_scfl_positionChildrenInRow:function(n){var h=n.items,f=h.length,k,m,d,l=0,a=0,c,g=n.plan.align,j=YES,b=0,i=NO;for(k=0;k<f;k++){m=h[k];if(m.isSpacer){a+=m.child.get("spaceUnits")||1}}if(g===SC.ALIGN_JUSTIFY){a+=f-1}c=Math.max(0,n.plan.maximumRowLength-n.rowLength)/a;while(c>0){for(k=0;k<f;k++){m=h[k];if(m.isSpacer){m.itemLength+=c*(m.child.get("spaceUnits")||1);if(m.itemLength>m.maxSpacerLength){b+=m.itemLength-m.maxSpacerLength;m.itemLength=m.maxSpacerLength}else{i=YES}}}if(!i){break}c=Math.round(b/a);b=0}d=0;if(a===0&&(g===SC.ALIGN_RIGHT||g===SC.ALIGN_BOTTOM)){d=n.plan.maximumRowLength-n.rowLength}else{if(a===0&&(g===SC.ALIGN_CENTER||g===SC.ALIGN_MIDDLE)){d=(n.plan.maximumRowLength/2)-(n.rowLength/2)}}d+=n.plan.rowStartPadding;for(k=0;k<f;k++){m=h[k];if(!m.fillRow){j=NO}l=Math.max(m.itemSize,l);m.position=d;d+=m.itemLength;if(g===SC.ALIGN_JUSTIFY&&k<f-1){d+=c}}n.shouldExpand=f>0?j:NO;n.rowLength=d-n.plan.rowStartPadding;n.rowSize=l;n.plan.totalCollapsedRowSize+=n.rowSize},_scfl_positionRows:function(d){var j=d.rows,c=j.length,g,i,b,a=0,h=0,f;for(g=0;g<c;g++){if(j[g].shouldExpand){a++}h+=j[g].rowSize}f=d.fitToPlanSize-h;b=d.planStartPadding;for(g=0;g<c;g++){i=j[g];if(i.shouldExpand&&f>0){i.rowSize+=f/a;a--}i.position=b;b+=i.rowSize}},_scfl_applyPlan:function(i){var o=i.rows,b,c,n,f=0,k=0,h,a,d,m,g,l,j=i.isVertical;c=o.length;for(b=0;b<c;b++){n=o[b];f=Math.max(f,n.rowLength);k+=n.rowSize;h=n.items;d=h.length;for(a=0;a<d;a++){m=h[a];m.child.beginPropertyChanges();l=m.fillRow?n.rowSize:m.itemSize;g={left:m.spacing.left+(j?n.position:m.position),top:m.spacing.top+(j?m.position:n.position),width:j?l:m.itemLength,height:j?m.itemLength:l};g.width-=m.spacing.left+m.spacing.right;g.height-=m.spacing.top+m.spacing.bottom;this.applyPlanToView(m.child,g);m.child._scfl_lastLayout=g;m.child.endPropertyChanges()}}k+=i.planStartPadding+i.planEndPadding;f+=i.rowStartPadding+i.rowEndPadding;this.beginPropertyChanges();this.set("calculatedHeight",j?f:k);this.set("calculatedWidth",j?k:f);this.set("_scfl_maximumCollapsedRowLength",i.maximumCollapsedRowLength);this.set("_scfl_totalCollapsedRowSize",i.totalCollapsedRowSize);this.endPropertyChanges()},applyPlanToView:function(a,b){a.adjust(b)},_scfl_tileOnce:function(){this.invokeLast(this._scfl_tile)},_scfl_tile:function(){if(!this.get("isVisibleInWindow")){return}var g=this._scfl_createPlan();this._scfl_distributeChildrenIntoRows(g);this._scfl_positionChildrenInRows(g);this._scfl_positionRows(g);this._scfl_applyPlan(g);this.setIfChanged("numberOfRows",g.rows.length);var d=this._scfl_isObserving||SC.CoreSet.create(),c=SC.CoreSet.create();var f=this.get("childViews"),b=f.length,a,h;for(a=0;a<b;a++){h=f[a];if(!d.contains(h)){this.observeChildLayout(h)}else{d.remove(h)}c.add(h)}b=d.length;for(a=0;a<b;a++){this.unobserveChildLayout(d[a])}},_scfl_frameDidChange:function(){var b=this.get("frame"),a=this._scfl_lastFrameSize||{};this._scfl_lastFrameSize=SC.clone(b);if(a.width==b.width&&a.height==b.height){return}this._scfl_tileOnce()}.observes("frame"),destroyMixin:function(){var c=this._scfl_isObserving;if(!c){return}var b=c.length,a;for(a=0;a<b;a++){this.unobserveChildLayout(c[a])}},reorder:function(b){if(!SC.typeOf(b)===SC.T_ARRAY){b=arguments}var c=b.length,d=this.childViews,a;this.beginPropertyChanges();while(c-->0){a=b[c];if(SC.typeOf(a)===SC.T_STRING){a=this.get(a)}d.removeObject(a);d.unshiftObject(a)}this.endPropertyChanges();this._scfl_childViewsDidChange();return this}};SC.Gesturable={concatenatedProperties:["gestures"],gestures:[],initMixin:function(){this.createGestures()},createGestures:function(){var f=this.get("gestures"),b,a=f.length,c,d=[];for(b=0;b<a;b++){if(SC.typeOf(f[b])===SC.T_STRING){c=this.get(f[b])}else{c=f[b]}if(!c){throw"Could not find gesture named '"+f[b]+"' on view."}if(c.isClass){c=c.create({view:this})}if(SC.typeOf(f[b])===SC.T_STRING){this[f[b]]=c}d.push(c)}this.set("gestures",d)},touchStart:function(a){this.gestureTouchStart(a)},touchesDragged:function(a,b){this.gestureTouchesDragged(a,b)},touchEnd:function(a){this.gestureTouchEnd(a)},gestureTouchStart:function(f){f.isInteresting=0;var d=this.get("gestures"),b,a=d.length,c;for(b=0;b<a;b++){c=d[b];c.unassignedTouchDidStart(f)}},gestureTouchesDragged:function(c,f){var h=this.get("gestures"),b,a=h.length,d;for(b=0;b<a;b++){d=h[b];d.unassignedTouchesDidChange(c,f)}},gestureTouchEnd:function(f){var d=this.get("gestures"),b,a=d.length,c;for(b=0;b<a;b++){c=d[b];c.unassignedTouchDidEnd(f)}}};SC.InlineEditable={isInlineEditable:YES,isEditable:YES,exampleEditor:SC.InlineTextFieldView,isEditing:NO,inlineEditorDelegate:SC.InlineTextFieldDelegate,_editor:null,beginEditing:function(){var a;a=this.delegateFor("inlineEditorShouldBeginEditing",this.inlineEditorDelegate);if(a&&!a.inlineEditorShouldBeginEditing(this,this.get("value"))){return NO}this._editor=this.invokeDelegateMethod(this.inlineEditorDelegate,"acquireEditor",this);if(this._editor){return this._editor.beginEditing(this)}else{return NO}},commitEditing:function(){return this._editor?this._editor.commitEditing():NO},discardEditing:function(){return this._editor?this._editor.discardEditing():NO},inlineEditorShouldBeginEditing:function(){return !this.get("isEditing")&&this.get("isEditable")},inlineEditorWillBeginEditing:function(b,c,a){b.set("value",this.get("value"))},inlineEditorDidBeginEditing:function(b,c,a){this.set("isEditing",YES)},inlineEditorWillCommmitEditing:function(b,c,a){if(this.inlineEditorWillEndEditing){this.inlineEditorWillEndEditing(b,c)}},inlineEditorDidCommitEditing:function(b,c,a){a.setIfChanged("value",c);if(this.inlineEditorDidEndEditing){this.inlineEditorDidEndEditing(b,c)}this._endEditing()},inlineEditorWillDiscardEditing:function(b,a){if(this.inlineEditorWillEndEditing){this.inlineEditorWillEndEditing(b,this.get("value"))}},inlineEditorDidDiscardEditing:function(b,a){if(this.inlineEditorDidEndEditing){this.inlineEditorDidEndEditing(b,this.get("value"))}this._endEditing()},_endEditing:function(){if(this._editor){this.invokeDelegateMethod(this.inlineEditorDelegate,"releaseEditor",this._editor);this._editor=null}this.set("isEditing",NO)}};SC.InlineEditor={isInlineEditor:YES,isEditing:NO,inlineEditorDelegate:null,_target:null,beginEditing:function(b){if(this.get("isEditing")||!b||!b.isInlineEditable){return NO}var a,c;c=this._target=b;a=this.delegateFor("inlineEditorWillBeginEditing",this.inlineEditorDelegate,c);if(a){a.inlineEditorWillBeginEditing(this,this.get("value"),c)}this.set("isEditing",YES);this.invokeLast(this._callDidBegin);this._didBeginInvoked=YES;return YES},_callDidBegin:function(){if(!this.get("isEditing")){return NO}this._didBeginInvoked=NO;var b=this._target,a;a=this.delegateFor("inlineEditorDidBeginEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorDidBeginEditing(this,this.get("value"),b)}},commitEditing:function(){if(!this.get("isEditing")){return NO}if(this._didBeginInvoked){this._callDidBegin()}var a,b=this._target;a=this.delegateFor("inlineEditorShouldCommitEditing",this.inlineEditorDelegate,b);if(a&&!a.inlineEditorShouldCommitEditing(this,this.get("value"),b)){return NO}a=this.delegateFor("inlineEditorWillCommitEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorWillCommitEditing(this,this.get("value"),b)}this._endEditing();a=this.delegateFor("inlineEditorDidCommitEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorDidCommitEditing(this,this.get("value"),b)}return YES},discardEditing:function(){if(!this.get("isEditing")){return NO}if(this._didBeginInvoked){this._callDidBegin()}var a,b=this._target;a=this.delegateFor("inlineEditorShouldDiscardEditing",this.inlineEditorDelegate,b);if(a&&!a.inlineEditorShouldDiscardEditing(this,b)){return NO}a=this.delegateFor("inlineEditorWillDiscardEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorWillDiscardEditing(this,b)}this._endEditing();a=this.delegateFor("inlineEditorDidDiscardEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorDidDiscardEditing(this,b)}return YES},_endEditing:function(){this.set("isEditing",NO);this._target=null}};SC.InlineEditorDelegate={acquireEditor:function(a){},releaseEditor:function(a){},inlineEditorShouldBeginEditing:function(a,b){},inlineEditorWillBeginEditing:function(b,c,a){},inlineEditorDidBeginEditing:function(b,c,a){},inlineEditorShouldCommitEditing:function(b,c,a){},inlineEditorWillCommitEditing:function(b,c,a){},inlineEditorDidCommitEditing:function(b,c,a){},inlineEditorShouldDiscardEditing:function(b,a){},inlineEditorWillDiscardEditing:function(b,a){},inlineEditorDidDiscardEditing:function(b,a){},inlineEditorWillEndEditing:function(b,c,a){},inlineEditorDidEndEditing:function(b,c,a){}};SC.SCALE_NONE="none";SC.FILL="fill";SC.FILL_PROPORTIONALLY="fillProportionally";SC.BEST_FIT="fitBest";SC.BEST_FIT_DOWN_ONLY="fitBestDown";SC.InnerFrame={align:SC.ALIGN_CENTER,innerFrameForSize:function(a,c,i,b){var f=this.get("align"),d=this.get("scale"),h,g,j;j={x:0,y:0,width:i,height:b};if(d===SC.FILL){return j}h=i/a;g=b/c;switch(d){case SC.FILL_PROPORTIONALLY:d=h>g?h:g;break;case SC.BEST_FIT:d=h<g?h:g;break;case SC.BEST_FIT_DOWN_ONLY:if((a>i)||(c>b)){d=h<g?h:g}else{d=1}break;case SC.SCALE_NONE:d=1;break;default:if(isNaN(window.parseFloat(d))||(window.parseFloat(d)<=0)){SC.Logger.warn("SC.InnerFrame: The scale '%@' was not understood.  Scale must be one of SC.FILL, SC.FILL_PROPORTIONALLY, SC.BEST_FIT, SC.BEST_FIT_DOWN_ONLY or a positive number greater than 0.00.".fmt(d));return j}}a*=d;c*=d;j.width=Math.round(a);j.height=Math.round(c);switch(f){case SC.ALIGN_LEFT:j.x=0;j.y=(b/2)-(c/2);break;case SC.ALIGN_RIGHT:j.x=i-a;j.y=(b/2)-(c/2);break;case SC.ALIGN_TOP:j.x=(i/2)-(a/2);j.y=0;break;case SC.ALIGN_BOTTOM:j.x=(i/2)-(a/2);j.y=b-c;break;case SC.ALIGN_TOP_LEFT:j.x=0;j.y=0;break;case SC.ALIGN_TOP_RIGHT:j.x=i-a;j.y=0;break;case SC.ALIGN_BOTTOM_LEFT:j.x=0;j.y=b-c;break;case SC.ALIGN_BOTTOM_RIGHT:j.x=i-a;j.y=b-c;break;default:if(f!==SC.ALIGN_CENTER&&f!==SC.ALIGN_MIDDLE){SC.Logger.warn("SC.InnerFrame: The align '%@' was not understood.  Align must be one of SC.ALIGN_CENTER/SC.ALIGN_MIDDLE, SC.ALIGN_LEFT, SC.ALIGN_RIGHT, SC.ALIGN_TOP, SC.ALIGN_BOTTOM, SC.ALIGN_TOP_LEFT, SC.ALIGN_TOP_RIGHT, SC.ALIGN_BOTTOM_LEFT or SC.ALIGN_BOTTOM_RIGHT.".fmt(f))}j.x=(i/2)-(a/2);j.y=(b/2)-(c/2)}return j},scale:SC.FILL};SC.StaticLayout={hasStaticLayout:YES};SC.Validatable={initMixin:function(){this._validatable_validatorDidChange()},validator:null,errorLabel:null,isValid:function(){return SC.typeOf(this.get("value"))!==SC.T_ERROR}.property("value"),ownerForm:null,performValidate:function(c){var a=SC.VALIDATE_OK;if(this._validator){var b=this.get("ownerForm");if(c){a=this._validator.validatePartial(b,this);if((a==SC.VALIDATE_NO_CHANGE)&&(this._validator.validateChange(b,this)==SC.VALIDATE_OK)){a=SC.VALIDATE_OK}}else{a=this._validator.validateChange(b,this)}}return a},performValidateSubmit:function(){return this._validator?this._validator.validateSubmit(this.get("ownerForm"),this):SC.VALIDATE_OK},performValidateKeyDown:function(a){var b=a.getCharString();if(!b){return YES}return this._validator?this._validator.validateKeyDown(this.get("ownerForm"),this,b):YES},validatorObject:function(){return this._validator}.property(),validateSubmit:function(){return this.performValidateSubmit()},objectForFieldValue:function(b,a){return this._validator?this._validator.objectForFieldValue(b,this.get("ownerForm"),this):b},fieldValueForObject:function(a){return this._validator?this._validator.fieldValueForObject(a,this.get("ownerForm"),this):a},_validatable_displayObserver:function(){this.displayDidChange()}.observes("isValid"),renderMixin:function(a){a.setClass("invalid",!this.get("isValid"))},_validatable_validatorDidChange:function(){var a=this.get("ownerForm");var b=SC.Validator.findFor(a,this,this.get("validator"));if(b!=this._validator){this.propertyWillChange("validatorObject");if(this._validator){this._validator.detachFrom(a,this)}this._validator=b;if(this._validator){this._validator.attachTo(a,this)}this.propertyDidChange("validatorObject")}}.observes("validator","ownerForm")};SC.RenderDelegate={create:function(){var c=SC.beget(this);var b,a=arguments.length;for(b=0;b<a;b++){c.mixin(arguments[b])}return c},reopen:function(b){var c,a;for(c in b){a=b[c];if(!b.hasOwnProperty(c)){continue}if(typeof a==="function"&&a!==this[c]){a.base=this[c]||SC.K}if(a&&a.isEnhancement&&a!==this[c]){a=SC._enhance(this[c]||SC.K,a)}this[c]=a}},get:function(a){return this[a]},getPropertyFor:function(b,a){if(this[a+"For"]){return this[a+"For"](b,a)}return this[a]},className:undefined,render:function(b,a){},update:function(b,a){}};SC.RenderDelegate.extend=SC.RenderDelegate.create;SC.RenderDelegate.mixin=SC.RenderDelegate.reopen;sc_require("render_delegates/render_delegate");SC.BaseTheme.canvasImageRenderDelegate=SC.RenderDelegate.create({className:"canvasImage",render:function(d,b){var c=d.get("width")||0,a=d.get("height")||0;b.attr("width",c);b.attr("height",a)},update:function(a,f){var h=f[0],j=a.get("image"),d=a.get("frame"),m=d.width,k=d.height,l=a.get("innerFrame"),n=a.get("backgroundColor"),p=a.get("renderState"),b;var o=![l.x,l.y,l.width,l.height].isEqual(p._lastInnerFrameValues),i=![h.width,h.height].isEqual(p._lastElemSizeValues),g=a.didChangeFor("canvasImageRenderDelegate","backgroundColor"),c=a.didChangeFor("canvasImageRenderDelegate","image")||(j&&j.complete)!==p._lastImageComplete;if(i||o||g||c){if(h&&h.getContext){h.height=k;h.width=m;b=h.getContext("2d");b.clearRect(0,0,m,k);if(n){b.fillStyle=n;b.fillRect(0,0,m,k)}if(j&&j.complete){b.drawImage(j,Math.floor(l.x),Math.floor(l.y),Math.floor(l.width),Math.floor(l.height))}}p._lastInnerFrameValues=[l.x,l.y,l.width,l.height];p._lastElemSizeValues=[h.width,h.height];p._lastImageComplete=j&&j.complete}}});sc_require("render_delegates/render_delegate");SC.BaseTheme.containerRenderDelegate=SC.RenderDelegate.create({render:function(b,a){},update:function(){}});sc_require("render_delegates/render_delegate");SC.RenderDelegate.reopen({sizes:[SC.TINY_CONTROL_SIZE,SC.SMALL_CONTROL_SIZE,SC.REGULAR_CONTROL_SIZE,SC.LARGE_CONTROL_SIZE,SC.HUGE_CONTROL_SIZE,SC.JUMBO_CONTROL_SIZE],sizeFor:function(g){var f=g.get("controlSize"),c,b,a;if(f){if(!this[f]){this[f]={}}c=this[f];if(!c.name){c.name=f}return c}var d=g.get("frame");if(!d){c=this["sc-regular-size"];if(!c){c=this["sc-regular-size"]={}}if(!c.name){c.name="sc-regular-size"}return c}for(b=0;b<a;b++){key=sizes[b];c=this[key];if(!c){continue}if((c.width===undefined&&c.height===undefined&&c.minHeight===undefined&&c.minWidth===undefined&&c.maxHeight===undefined&&c.maxWidth===undefined)||(c.width!==undefined&&d.width!==c.width)||(c.minWidth!==undefined&&d.width<c.minWidth)||(c.maxWidth!==undefined&&d.width>c.maxWidth)||(c.height!==undefined&&d.height!==c.height)||(c.minHeight!==undefined&&d.height<c.minHeight)||(c.maxHeight!==undefined&&d.height<c.maxHeight)){continue}if(!c.name){c.name=key}return c}c=this["sc-regular-size"];if(!c){c=this["sc-regular-size"]={}}if(!c.name){c.name="sc-regular-size"}return c},addSizeClassName:function(c,b){var a=this.sizeFor(c);if(a){b.addClass(a.name)}},updateSizeClassName:function(c,a){var b=this.sizeFor(c);if(b){a.addClass(b.name)}},getPropertyFor:function(c,a){var b=this.sizeFor(c);if(b){if(b[a+"For"]){return b[a+"For"](c,a)}else{if(b[a]!==undefined){return b[a]}}}if(this[a+"For"]){return this[a+"For"]}return this[a]}});sc_require("render_delegates/render_delegate");SC.BaseTheme.imageRenderDelegate=SC.RenderDelegate.create({className:"image",render:function(g,c){var f=g.get("image"),b=g.get("imageValue"),d=g.get("type")||SC.IMAGE_TYPE_URL,a=g.get("toolTip");c=c.begin("img");c.attr("src",f.src);if(b&&d===SC.IMAGE_TYPE_CSS_CLASS){c.addClass(b);this._last_class=b}if(a){c.attr("title",a);c.attr("alt",a)}c.addStyle(this.imageStyles(g));c=c.end()},update:function(f,a){var d=f.get("image"),c=f.get("imageValue"),b=f.get("toolTip");a=a.find("img");a.attr("src",d.src);if(c!==this._last_class){a.setClass(this._last_class,NO)}if(c){a.addClass(c);this._last_class=c}if(b){a.attr("title",b);a.attr("alt",b)}a.css(this.imageStyles(f))},imageStyles:function(b){var a=b.get("innerFrame");return{position:"absolute",left:Math.round(a.x),top:Math.round(a.y),width:Math.round(a.width),height:Math.round(a.height)}}});sc_require("render_delegates/render_delegate");SC.BaseTheme.labelRenderDelegate=SC.RenderDelegate.create({className:"label",render:function(d,c){this.addSizeClassName(d,c);var a=d.get("toolTip");if(a){c.attr("title",a)}c.addStyle({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});c.setClass("ellipsis",d.get("needsEllipsis")||NO);c.setClass("icon",d.get("icon")||NO);var b=this.htmlForTitleAndIcon(d);c.push(b);d.get("renderState")._lastHTMLForTitleAndIcon=b},update:function(d,a){this.updateSizeClassName(d,a);a.css({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});var b=d.get("toolTip");if(b){a.attr("title",b)}else{a.removeAttr("title")}a.setClass("ellipsis",d.get("needsEllipsis")||NO);var c=this.htmlForTitleAndIcon(d);if(d.get("renderState")._lastHTMLForTitleAndIcon!==c){a.html(c);d.get("renderState")._lastHTMLForTitleAndIcon=c}},htmlForTitleAndIcon:function(g){var f=g.get("title"),d=g.get("hint"),a=g.get("hintEnabled"),c=g.get("escapeHTML"),b=g.get("icon")||"";if(f&&c){f=SC.RenderContext.escapeHTML(f)}if(a&&d&&!f){if(c){d=SC.RenderContext.escapeHTML(d)}f="<span class='sc-hint'>"+d+"</span>"}if(b){if(b.indexOf("/")>=0){b='<img src="'+b+'" alt="" class="icon" />'}else{b='<img src="'+SC.BLANK_IMAGE_URL+'" alt="" class="icon '+b+'" />'}}return b+(SC.none(f)?"":f)}});sc_require("core");SC.Benchmark={verbose:NO,enabled:YES,events:{},stats:{},globalStartTime:null,addEvent:function(a,b){if(!b){b=new Date().getTime()}this.events[a]=b},start:function(b,a,f,d){if(!this.enabled){return}var g=(f||Date.now()),c;if(a){c=this._subStatFor(b,a)}else{c=this._statFor(b)}if(d&&c._starts.length>0){c._starts.push("ignore")}else{c._starts.push(g)}c._times.push({start:g,_subStats:{}});return b},end:function(c,b,g){var f;if(!this.enabled){return}if(b){f=this._subStatFor(c,b)}else{f=this._statFor(c)}var h=f._starts.pop();if(!h){SC.Logger.log('SC.Benchmark "%@" ended without a matching start.  No information was saved.'.fmt(c));return}if(h=="ignore"){return}var a=(g||Date.now());var d=a-h;f._times[f._times.length-1].end=a;f._times[f._times.length-1].dur=d;f.amt+=d;f.runs++;if(this.verbose){this.log(c)}},setGlobalStartTime:function(a){this.globalStartTime=a},bench:function(f,d,a){if(!d){d="bench%@".fmt(this._benchCount++)}if(!a){a=1}var b;while(--a>=0){var c=SC.Benchmark.start(d);b=f();SC.Benchmark.end(c)}return b},install:function(a,d,b){a["b__"+d]=a[d];var c=a["b__"+d];a[d]=function(){var g="%@(%@)".fmt(d,$A(arguments).join(", "));SC.Benchmark.start(g,b);var f=c.apply(this,arguments);SC.Benchmark.end(g);return f}},restore:function(a,b){a[b]=a["b__"+b]},report:function(c){if(c){return this._genReport(c)}var b=[];for(var a in this.stats){if(!this.stats.hasOwnProperty(a)){continue}b.push(this._genReport(a))}return b.join("\n")},timelineReport:function(a){a=(a)?"SproutCore Application":a;var b=[a,"User-Agent: %@".fmt(navigator.userAgent),"Report Generated: %@ (%@)".fmt(new Date().toString(),Date.now()),""];var d=this._compileChartData(true);for(var c=0;c<d.length;c++){if(d[c][4]){b.push(this._timelineGenSubReport(d[c]))}else{b.push(this._timelineGenReport(d[c]))}}return b.join("\n")},getTimelineChartContent:function(){var m=this._compileChartData(false);var h=m.length;if(h===0){return}var c=this.globalStartTime?this.globalStartTime:m[0][1];var d=m[h-1][2]-c;var o=25+h*30;var r=Math.ceil(d/200)+1;var s=r*50;var n=10,u=300;var p="<div class = 'sc-benchmark-timeline-chart' style = 'position:relative;'>";p+="<div class = 'sc-benchmark-top'></div>";for(var q=0;q<r;q++){p+="<div class = 'sc-benchmark-tick' style = '";p+="left: "+(n+q*50)+"px; ";p+="height: "+o+"px;";p+="'></div>";p+="<div class = 'sc-benchmark-tick-label' style = '";p+="left: "+(n+q*50)+"px; ";p+="'>"+(q*200)+"ms</div>"}for(q=0;q<h;q++){p+="<div class = 'sc-benchmark-row ";p+=(q%2===0)?"even":"odd";p+="' style = '";p+="top: "+(50+(q*30))+"px; ";p+="'></div>";var k=document.createElement("div");var g=m[q][1];var f=m[q][2];var a=m[q][3];p+="<div class = 'sc-benchmark-bar' style = '";p+="left:"+(n+((g-c)/4))+"px; width: "+((a/4))+"px;";p+="top: "+(28+(q*30))+"px;";p+="' title = 'start: "+(g-c)+" ms, end: "+(f-c)+" ms, duration: "+a+" ms'";p+=">";p+="&nbsp;"+m[q][0]+" <span class='sc-benchmark-emphasis'>";p+=a+"ms (start: "+(g-c)+"ms)";p+="</span>";p+="</div>"}var b=this.events,l=0;for(q in b){var j=b[q]-c;p+="<div class = 'sc-benchmark-event idx"+(l%10)+"' style = '";p+="left: "+(n+j/4)+"px; height: "+o+"px; top: 20px;";p+="' title = '"+q+": "+j+"'></div>";l++}p+="</div>";return{html:p,totalCapturedTime:d,pointsCaptured:h,width:s+n+u,height:o}},getTimelineChartView:function(){var a=SC.ScrollView.create({contentView:SC.StaticContentView.extend({}),reload:function(){var b=SC.Benchmark.getTimelineChartContent();this.contentView.set("content",b.html);this.contentView.adjust({width:b.width,height:b.height});this.chartContent=b;SC.RunLoop.invokeLater(SC.Benchmark,function(){this.contentView.notifyPropertyChange("frame")})}});a.reload();return a},timelineChart:function(a){SC.RunLoop.begin();var c=0;this.hideChart();var b=this.getTimelineChartView();var f=b.chartContent.pointsCaptured,d=b.chartContent.totalCapturedTime;this._benchmarkChart=SC.Pane.create({classNames:["sc-benchmark-pane"],layout:{left:20,right:20,bottom:20,top:20},childViews:["title","exit"],exit:SC.ButtonView.extend({layout:{right:20,top:20,width:100,height:30},title:"Hide Chart",target:this,action:"hideChart"}),title:SC.LabelView.extend({classNames:["sc-benchmark-title"],layout:{left:20,top:23,right:200,height:30},value:((a)?a:"SproutCore Application")+(" - Total Captured Time: "+d+" ms - Points Captured: "+f),fontWeight:"bold"})}).append();b.set("layout",{left:20,top:60,bottom:20,right:20});this._benchmarkChart.appendChild(b);SC.RunLoop.end()},hideChart:function(){if(this._benchmarkChart){this._benchmarkChart.remove();this._benchmarkChart=null}return YES},tryToPerform:function(b,a){if(this[b]){return this[b](a)}return NO},log:function(d){var c=this.report(d).split("\n"),b=c.length,a;for(a=0;a<b;a++){SC.Logger.log(c[a])}},startProfile:function(a){if(!this.enabled){return}SC.Logger.profile(a)},endProfile:function(a){if(!this.enabled){return}SC.Logger.profileEnd(a)},loadPreloadEvents:function(){var g=SC.benchmarkPreloadEvents,f=[],b,a,c;if(typeof webkitPerformnce!=="undefined"){SC.mixin(g,webkitPerformane.timing)}if(!this.globalStartTime){var d=["navigation","navigationStart","headStart"];a=d.length;for(b=0;b<a;b++){if(g[d[b]]){this.globalStartTime=g[d[b]];break}}}this.javascriptStartTime=g.headStart;SC.mixin(this.events,g);this._hasLoadedPreloadEvents=true},_loadBenchmarksFromEvents:function(){if(!this._hasLoadedPreloadEvents){this.loadPreloadEvents()}var b=this.events;for(var a in b){if(a.substr(-3)!=="End"){continue}var c=a.substr(0,a.length-3);if(!b[c+"Start"]){continue}SC.Benchmark.start(c,undefined,b[c+"Start"]);SC.Benchmark.end(c,undefined,b[c+"End"]);delete b[c+"Start"];delete b[c+"End"]}},_compileChartData:function(h){this._loadBenchmarksFromEvents();var m=[],a;for(var n in this.stats){var f=this.stats[n];for(var g=0;g<f._times.length;g++){var o=f._times[g];a=(f._times.length>1)?(g+1)+" - "+n:n;m.push([a,o.start,o.end,o.dur,false]);if(h){var b=o._subStats;for(var c in b){var l=b[c];for(var d=0;d<l._times.length;d++){var p=l._times[d];a=(l._times.length>1)?(d+1)+" - "+c:c;m.push([a,p.start,p.end,p.dur,true])}}}}}m.sort(function(j,i){if(j[1]<i[1]){return -1}else{if(j[1]==i[1]){if(j[3]&&!i[3]){return -1}if(!j[3]&&i[3]){return 1}return 0}}return 1});return m},_genReport:function(a){var b=this._statFor(a);var d=(b.runs>0)?(Math.floor(b.amt*1000/b.runs)/1000):0;var c=b._times[b._times.length-1];return"BENCH %@ msec: %@ (%@x); latest: %@".fmt(d,(b.name||a),b.runs,c.end-c.start)},_timelineGenReport:function(a){if(this.globalStartTime){return"BENCH start: %@ msec, duration: %@ msec,  %@".fmt((a[1]-this.globalStartTime),a[3],a[0])}else{return"BENCH duration: %@ msec, %@".fmt(a[3],a[0])}},_timelineGenSubReport:function(a){if(this.globalStartTime){return"   CHECKPOINT BENCH start: %@ msec, duration: %@ msec,  %@".fmt((a[1]-this.globalStartTime),a[3],a[0])}else{return"   CHECKPOINT BENCH duration: %@ msec, %@".fmt(a[3],a[0])}},_subStatFor:function(d,c){var f=this.stats[c]._times.length;if(f===0){return}var a=this.stats[c]._times[this.stats[c]._times.length-1]._subStats;var b=a[d];if(!b){a[d]={runs:0,amt:0,name:d,_starts:[],_times:[]};b=a[d]}return b},_statFor:function(b){var a=this.stats[b];if(!a){a=this.stats[b]={runs:0,amt:0,name:b,_starts:[],_times:[]};a=this.stats[b]}return a},reset:function(){this.stats={}},_bench:function(b,a){SC.Benchmark.bench(b,a,1)},_benchCount:1};SC.Benchmark=SC.Benchmark;SC.Cookie=SC.Object.extend({name:null,value:"",expires:null,path:null,domain:null,secure:NO,isCookie:YES,destroy:function(){this.set("expires",-1);this.write();arguments.callee.base.apply(this,arguments)},write:function(){var d=this.get("name"),g=this.get("value"),a=this.get("expires"),i=this.get("path"),f=this.get("domain"),h=this.get("secure"),b="",c;if(a){if(typeof a===SC.T_NUMBER){c=new Date();c.setTime(c.getTime()+(a*24*60*60*1000))}else{if(SC.DateTime&&a.get&&a.get("milliseconds")){c=new Date(a.get("milliseconds"))}else{if(a.toUTCString&&a.toUTCString.apply){c=a}}}if(c){b="; expires="+c.toUTCString()}}if(!SC.none(i)){b+="; path="+i}if(!SC.none(f)){b+="; domain="+f}if(h===YES){b+="; secure"}document.cookie=d+"="+encodeURIComponent(g)+b;return this}});SC.Cookie.mixin({find:function(a){if(document.cookie&&document.cookie!==""){var d=document.cookie.split(";");for(var c=0;c<d.length;c++){var b=SC.String.trim(String(d[c]));if(b.substring(0,a.length+1)===(a+"=")){return SC.Cookie.create({name:a,value:decodeURIComponent(b.substring(a.length+1))})}}}return null}});SC.CookieMonster={nomNomNom:function(b){var a=SC.kindOf(b,SC.Cookie);if(a){SC.Logger.log("YUM!");return b.destroy()}SC.Logger.error("Y U PASS ME NO COOKIE? %@",b);return NO}};SC.mixin(SC.$.fn,{setClass:function(d,c){if(SC.none(d)){return this}var f=SC.typeOf(d)!==SC.T_STRING,a=this._fixupClass,b;this.each(function(){if(this.nodeType!==1){return}var i=this.className.split(/\s+/),h=NO;if(f){for(var g in d){if(d.hasOwnProperty(g)){h=a(i,g,d[g])||h}}}else{h=a(i,d,c)}if(h){this.className=i.join(" ")}});return this},_fixupClass:function(d,a,c){var b=d.indexOf(a);if(c){if(b<0){d.push(a);return YES}}else{if(b>=0){d[b]=null;return YES}}return NO}});SC.ExceptionHandler={enabled:(SC.buildMode!=="debug"),handleException:function(a){if(this.isShowingErrorDialog){return NO}this._displayErrorDialog(a);return NO},_displayErrorDialog:function(b){var a=this._errorDialogHTMLForException(b),c=document.createElement("div");c.style.cssText="left: 0px; right: 0px; top: 0px; bottom: 0px; position: absolute; background-color: white; background-color: rgba(255,255,255,0.6); z-index:100;";c.innerHTML=a;document.body.appendChild(c);this.isShowingErrorDialog=YES},_errorDialogHTMLForException:function(b){var a;a=['<div id="sc-error-dialog" style="position: absolute; width: 500px; left: 50%; top: 50%; margin-left: -250px; background-color: white; border: 1px solid black; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; padding: 10px">',"An error has occurred which prevents the application from running:","<br><br>",b.message,'<div id="sc-error-dialog-reload-button" onclick="window.location.reload();" style="float: right; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; border: 1px solid black; padding: 3px; clear: both; margin-top: 20px; cursor: pointer;">',"Reload","</div>","</div>"];return a.join("")},isShowingErrorDialog:NO};SC.IMAGE_ABORTED_ERROR=SC.$error("SC.Image.AbortedError","Image",-100);SC.IMAGE_FAILED_ERROR=SC.$error("SC.Image.FailedError","Image",-101);SC.imageQueue=SC.Object.create({loadLimit:4,activeRequests:0,loadImage:function(a,f,g,d){var b=SC.typeOf(f);if(SC.none(g)&&SC.typeOf(f)===SC.T_FUNCTION){f=null;g=f}if(SC.typeOf(g)===SC.T_STRING){g=f[g]}if(SC.none(d)){d=SC.none(f)&&SC.none(g)}var c=this._imageEntryFor(a);if(c.status===this.IMAGE_LOADED){if(g){g.call(f||c.image,c.url,c.image)}}else{if(f||g){this._addCallback(c,f,g)}c.retainCount++;this._scheduleImageEntry(c,d)}},releaseImage:function(a,d,f){var c=this._imageEntryFor(a,NO);if(!c){return this}if(--c.retainCount<=0){this._deleteEntry(c)}else{if(d||f){var b=SC.typeOf(d);if(SC.none(f)&&SC.typeOf(d)===SC.T_FUNCTION){d=null;f=d}if(SC.typeOf(f)===SC.T_STRING){f=d[f]}this._removeCallback(c,d,f)}}},reloadImage:function(a){var b=this._imageEntryFor(a,NO);if(b&&b.status===this.IMAGE_LOADED){b.status=this.IMAGE_WAITING}},loadNextImage:function(){var c=null,a;if(this.get("activeRequests")>=this.get("loadLimit")){return}a=this._foregroundQueue;while(a.length>0&&!c){c=a.shift()}if(!c){a=this._backgroundQueue;while(a.length>0&&!c){c=a.shift()}}this.set("isLoading",!!c);if(c){var b=c.image;if(!b){return}$(b).bind("abort",this._imageDidAbort);$(b).bind("error",this._imageDidError);$(b).bind("load",this._imageDidLoad);b.src=c.url;this._loading.push(c);this.incrementProperty("activeRequests");this.loadNextImage()}},_imageEntryFor:function(c,a){if(a===undefined){a=YES}var d=this._images[c];if(!d&&a){var b=new Image();d=this._images[c]={url:c,status:this.IMAGE_WAITING,callbacks:[],retainCount:0,image:b};b.entry=d}else{if(d&&d.image===null){d.image=new Image();d.image.entry=d}}return d},_deleteEntry:function(a){this._unscheduleImageEntry(a);delete this._images[a.url]},_addCallback:function(c,d,f){var b=c.callbacks;var a=b.find(function(g){return g[0]===d&&g[1]===f},this);if(!a){b.push([d,f])}b=null;return this},_removeCallback:function(b,c,d){var a=b.callbacks;a.forEach(function(g,f){if(g[0]===c&&g[1]===d){a[f]=null}},this);a=null;return this},_scheduleImageEntry:function(d,c){var b=this._backgroundQueue;var f=this._foregroundQueue;if(d.status===this.IMAGE_LOADED){return this}if((d.status===this.IMAGE_QUEUED)&&!c&&d.isBackground){b[b.indexOf(d)]=null;d.status=this.IMAGE_WAITING}if(d.status!==this.IMAGE_QUEUED){var a=(c)?b:f;a.push(d);d.status=this.IMAGE_QUEUED;d.isBackground=c}if(!this.isLoading){this.invokeLater(this.loadNextImage,100)}this.set("isLoading",YES);return this},_unscheduleImageEntry:function(b){if(b.status!==this.IMAGE_QUEUED){return this}var a=b.isBackground?this._backgroundQueue:this._foregroundQueue;a[a.indexOf(b)]=null;if(this._loading.indexOf(b)>=0){if(a.image){a.image.abort()}this.imageStatusDidChange(b,this.ABORTED)}return this},_imageDidAbort:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ABORTED)},this)},_imageDidError:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ERROR)},this)},_imageDidLoad:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.LOADED)},this)},imageStatusDidChange:function(c,a){if(!c){return}var b=c.url;var d;switch(a){case this.LOADED:d=c.image;break;case this.ABORTED:d=SC.IMAGE_ABORTED_ERROR;break;case this.ERROR:d=SC.IMAGE_FAILED_ERROR;break;default:d=SC.IMAGE_FAILED_ERROR;break}c.callbacks.forEach(function(g){var h=g[0],i=g[1];i.call(h,b,d)},this);c.callbacks=[];c.status=(a===this.LOADED)?this.IMAGE_LOADED:this.IMAGE_WAITING;var f=c.image;if(f){f.onload=f.onerror=f.onabort=null;if(a!==this.LOADED){c.image=null}}this._loading[this._loading.indexOf(c)]=null;if(this._loading.length>this.loadLimit*2){this._loading=this._loading.compact()}this.decrementProperty("activeRequests");this.loadNextImage()},init:function(){arguments.callee.base.apply(this,arguments);this._images={};this._loading=[];this._foregroundQueue=[];this._backgroundQueue=[]},IMAGE_LOADED:"loaded",IMAGE_QUEUED:"queued",IMAGE_WAITING:"waiting",ABORTED:"aborted",ERROR:"error",LOADED:"loaded"});SC.Math=SC.Object.create({near:function(c,b,a){if(!a){a=0.00001}return Math.abs(c-b)<=a},round:function(d,a){if(!a){a=0}var b=Math.pow(10,a);if(a<0){var c=b.toString();b=c.substring(0,c.indexOf("1")+1)}d=d.valueOf();return Math.round(d*b)/b}});SC.Task=SC.Object.extend({run:function(a){}});sc_require("tasks/task");SC.LOG_MODULE_LOADING=YES;SC.Module=SC.Object.create({isModuleReady:function(a){var b=SC.MODULE_INFO[a];return b?!!b.isReady:NO},loadModule:function(b,h,a){var c=SC.MODULE_INFO[b],i,g,j=SC.A(arguments).slice(3),d=SC.LOG_MODULE_LOADING,k,f;if(a===undefined&&SC.typeOf(h)===SC.T_FUNCTION){a=h;h=null}if(d){SC.debug("SC.Module: Attempting to load '%@'",b)}if(!c){throw"SC.Module: could not find module '%@'".fmt(b)}c.isPrefetching=NO;if(c.isLoaded&&!c.isWaitingForRunLoop){if(d){SC.debug("SC.Module: Module '%@' already loaded.",b)}if(!this._dependenciesMetForModule(b)){this._addCallbackForModule(b,h,a,j);this._loadDependenciesForModule(b);return NO}if(c.source){if(d){SC.debug("SC.Module: Evaluating JavaScript for module '%@'.",b)}this._evaluateStringLoadedModule(c);this._addCallbackForModule(b,h,a,j);this.invokeLast(function(){c.isReady=YES;this._moduleDidBecomeReady(b)});return NO}if(a){if(SC.isReady){SC.Module._invokeCallback(b,h,a,j)}else{SC.ready(SC.Module,function(){SC.Module._invokeCallback(b,h,a,j)})}}return YES}else{if(c.isWaitingForRunLoop){this._addCallbackForModule(b,h,a,j)}else{if(d){SC.debug("SC.Module: Module '%@' is not loaded, loading now.",b)}this._addCallbackForModule(b,h,a,j);if(!c.isLoading){this._loadDependenciesForModule(b);this._loadCSSForModule(b);this._loadJavaScriptForModule(b);c.isLoading=YES}return NO}}},_addCallbackForModule:function(b,f,g,a){var c=SC.MODULE_INFO[b];var d=c.callbacks||[];if(g){d.push(function(){SC.Module._invokeCallback(b,f,g,a)})}c.callbacks=d},prefetchModule:function(a){var b=SC.MODULE_INFO[a];if(b.isLoading||b.isLoaded){return}if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Prefetching module '%@'.",a)}this._loadDependenciesForModule(a);this._loadCSSForModule(a);this._loadJavaScriptForModule(a);b.isLoading=YES;b.isPrefetching=YES},_executeLazilyInstantiatedModule:function(b,c,i){var h=SC.LAZY_INSTANTIATION[b];var g;var a;var j,d;if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Module '%@' is marked for lazy instantiation, instantiating it now",b)}d=h.length;for(j=0;j<d;j++){try{h[j]()}catch(f){SC.Logger.error("SC.Module: Failed to lazily instatiate entry for  '%@'".fmt(b))}}delete SC.LAZY_INSTANTIATION[b];g=this._targetForTargetName(c);a=this._methodForMethodNameInTarget(i,g);if(!a){throw"SC.Module: could not find callback for lazily instantiated module '%@'".fmt(b)}},_evaluateStringLoadedModule:function(b){var a=b.source;jQuery.globalEval(a);delete b.source;if(b.cssSource){var c=document.createElement("style");c.setAttribute("type","text/css");if(c.styleSheet){c.styleSheet.cssText=b.cssSource}else{var d=document.createTextNode(b.cssSource);c.appendChild(d)}document.getElementsByTagName("head")[0].appendChild(c)}b.isReady=YES},_loadCSSForModule:function(d){var g=document.getElementsByTagName("head")[0];var f=SC.MODULE_INFO[d];var i=f.styles||[];var b=i.length;var c;var h;var a;if(!g){g=document.documentElement}b=i.length;for(a=0;a<b;a++){c=i[a];if(c.length>0){if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Loading CSS file in '%@' -> '%@'",d,c)}h=document.createElement("link");h.setAttribute("href",c);h.setAttribute("rel","stylesheet");h.setAttribute("type","text/css");g.appendChild(h)}}h=null},_loadJavaScriptForModule:function(b){var c=SC.MODULE_INFO[b];var d;var a;var f=c.dependencies;var g=YES;if(f&&f.length>0){g=this._dependenciesMetForModule(b)}if(c.isPrefetched){a=c.stringURL}else{if(g){a=c.scriptURL}else{a=c.stringURL}}if(a.length>0){if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Loading JavaScript file in '%@' -> '%@'",b,a)}d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",a);if(SC.browser.isIE){d.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){SC.run(function(){SC.Module._moduleDidLoad(b)})}}}else{d.onload=function(){SC.run(function(){SC.Module._moduleDidLoad(b)})}}document.body.appendChild(d)}},_dependenciesMetForModule:function(c){var f=SC.MODULE_INFO[c].dependencies||[];var b,a=f.length;var g;var d;for(b=0;b<a;b++){g=f[b];d=SC.MODULE_INFO[g];if(!d){throw"SC.loadModule: Unable to find dependency %@ for module %@.".fmt(g,c)}if(!d.isReady){return NO}}return YES},_loadDependenciesForModule:function(a){var b=SC.MODULE_INFO[a];var f=SC.LOG_MODULE_LOADING;var j=b.dependencies||[];var g=YES;var h=j.length;var k;var d;var c;var i;for(k=0;k<h;k++){d=j[k];c=SC.MODULE_INFO[d];if(!c){throw"SC.Module: could not find required module '%@' for module '%@'".fmt(d,a)}else{if(c.isLoading){g=NO;i=c.dependents;if(!i){c.dependents=i=[]}i.push(a)}else{if(c.isReady){continue}else{g=NO;i=c.dependents;if(!i){c.dependents=i=[]}i.push(a);if(f){SC.debug("SC.Module: '%@' depends on '%@', loading dependency",a,d)}SC.Module.loadModule(d)}}}}},_invokeCallback:function(c,d,a,b){var h;var g;g=this._targetForTargetName(d);h=this._methodForMethodNameInTarget(a,g);if(!h){if(SC.LAZY_INSTANTIATION[c]){this._executeLazilyInstantiatedModule(c,d,a);g=this._targetForTargetName(d);h=this._methodForMethodNameInTarget(a,g)}else{throw"SC.Module: could not find callback for '%@'".fmt(c)}}if(!b){b=[]}b.unshift(c);var f=!!SC.RunLoop.currentRunLoop;if(f){SC.run(function(){h.apply(g,b)})}else{h.apply(g,b)}},_invokeCallbacksForModule:function(c){var f=SC.MODULE_INFO[c],d;if(!f){return}if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Module '%@' has completed loading, invoking callbacks.",c)}d=f.callbacks||[];for(var b=0,a=d.length;b<a;++b){d[b]()}},_evaluateAndInvokeCallbacks:function(a){var d=SC.MODULE_INFO;var b=d[a];var c=SC.LOG_MODULE_LOADING;if(c){SC.debug("SC.Module: Evaluating and invoking callbacks for '%@'.",a)}if(b.source){this._evaluateStringLoadedModule(b)}b.isWaitingForRunLoop=YES;this.invokeLast(function(){b.isReady=YES;this._moduleDidBecomeReady(a)})},_moduleDidBecomeReady:function(a){var c=SC.MODULE_INFO;var b=c[a];var d=SC.LOG_MODULE_LOADING;b.isWaitingForRunLoop=NO;if(SC.isReady){SC.Module._invokeCallbacksForModule(a);delete b.callbacks}else{SC.ready(SC,function(){SC.Module._invokeCallbacksForModule(a);delete b.callbacks})}var h=b.dependents||[];var f,j;for(var i=0,g=h.length;i<g;i++){f=h[i];j=c[f];if(j.isLoaded&&this._dependenciesMetForModule(f)){if(d){SC.debug("SC.Module: Now that %@ has loaded, all dependencies for a dependent %@ are met.",a,f)}this._evaluateAndInvokeCallbacks(f)}}},_moduleDidLoad:function(b){var c=SC.MODULE_INFO[b];var f=SC.LOG_MODULE_LOADING;var d;var g,a;if(f){SC.debug("SC.Module: Module '%@' finished loading.",b)}if(!c){if(f){SC.debug("SC._moduleDidLoad() called for unknown module '@'.",b)}c=SC.MODULE_INFO[b]={isLoaded:YES,isReady:YES};return}if(c.isLoaded){if(f){SC.debug("SC._moduleDidLoad() called more than once for module '%@'. Skipping.",b)}return}delete c.isLoading;c.isLoaded=YES;if(!c.isPrefetching){d=this._dependenciesMetForModule(b);if(d){this._evaluateAndInvokeCallbacks(b)}else{if(f){SC.debug("SC.Module: Dependencies for '%@' not met yet, waiting to evaluate.",b)}}}else{delete c.isPrefetching;if(f){SC.debug("SC.Module: Module '%@' was prefetched, not evaluating until needed.",b)}}},_targetForTargetName:function(a){if(SC.typeOf(a)===SC.T_STRING){return SC.objectForPropertyPath(a)}return a},_methodForMethodNameInTarget:function(a,b){if(SC.typeOf(a)===SC.T_STRING){return SC.objectForPropertyPath(a,b)}return a},methodsForSuspend:"loadModule _moduleDidLoad prefetchModule _moduleDidBecomeReady".w(),suspend:function(){this._suspendCount=(this._suspendCount||0)+1;if(this._suspendCount!==1){return}var a=this.get("methodsForSuspend"),f,d,c,b;for(b=0;c=a[b];b++){if(!this[f="__replacement_"+c+"__"]){(this[f]=function(){(this._bufferedCalls||(this._bufferedCalls=[])).push({method:arguments.callee.methodName,arguments:arguments})}).methodName=c}if(!this[d="__saved_"+c+"__"]){this[d]=this[c]}this[c]=this[f]}},resume:function(){this._suspendCount=(this._suspendCount||0)-1;if(this._suspendCount<0){SC.warn("SC.Module.resume() was called without SC.Module having been in a suspended state. Call aborted.");this._suspendCount=0;return}if(this._suspendCount>0){return}var a=this.get("methodsForSuspend"),d=this._bufferedCalls,c,b,g,f;for(b=0;(c=a[b]);b++){this[c]=this["__saved_"+c+"__"]}for(b=0;f=d&&d[b];b++){this[f.method].apply(this,f.arguments)}if(d){d.length=0}}});SC.ready(function(){var d=SC.MODULE_INFO;var b;var c;var a;for(b in d){c=d[b];if(c.isPrefetched){a=SC.Module.PrefetchModuleTask.create({prefetchedModuleName:b});SC.backgroundTaskQueue.push(a)}}});SC.Module.PrefetchModuleTask=SC.Task.extend({prefetchedModuleName:null,run:function(){SC.Module.prefetchModule(this.prefetchedModuleName)}});sc_require("tasks/task");SC.TaskQueue=SC.Task.extend({init:function(){var a=this;this._doIdleEntry=function(){a._idleEntry()};this._suspendCount=0;this._tasks=[]},runWhenIdle:NO,runLimit:50,interval:50,isRunning:NO,minimumIdleDuration:500,_tasks:null,hasTasks:function(){return this._tasks.length>0}.property("taskCount").cacheable(),taskCount:function(){return this._tasks.length}.property().cacheable(),push:function(a){this._tasks.push(a);this.notifyPropertyChange("taskCount")},next:function(){if(this._tasks.length<1){return null}var a=this._tasks.shift();this.notifyPropertyChange("taskCount");return a},suspend:function(){this._suspendCount++},resume:function(){this._suspendCount--;if(this._suspendCount<=0){this._setupIdle()}},_taskCountDidChange:function(){this._setupIdle()}.observes("taskCount"),_runWhenIdleDidChange:function(){this._setupIdle()}.observes("runWhenIdle"),_setupIdle:function(){if(!this._suspendCount&&this.get("runWhenIdle")&&!this._idleIsScheduled&&this.get("taskCount")>0){setTimeout(this._doIdleEntry,this.get("interval"));this._idleIsScheduled=YES}},_idleEntry:function(){this._idleIsScheduled=NO;var a=SC.RunLoop.lastRunLoopEnd;if(!this.get("runWhenIdle")&&!this._suspendCount){return}if(Date.now()-a>this.get("minimumIdleDuration")){SC.run(this.run,this);SC.RunLoop.lastRunLoopEnd=a}this._setupIdle()},run:function(a){this.set("isRunning",YES);if(!a){a=this.get("runLimit")}var b,c=Date.now();while(b=this.next()){b.run(this);if(Date.now()-c>a){break}}this.set("isRunning",NO)}});SC.backgroundTaskQueue=SC.TaskQueue.create({runWhenIdle:YES});SC.TextSelection=SC.Object.extend(SC.Copyable,SC.Freezable,{start:-1,end:-1,length:function(){var b=this.get("start");var a=this.get("end");if((b)===-1||(a===-1)){return -1}else{return a-b}}.property("start","end").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);this.freeze()},copy:function(){return SC.TextSelection.create({start:this.get("start"),end:this.get("end")})},toString:function(){var a=this.get("length");if(a&&a>0){if(a===1){return"[%@ character selected: {%@, %@}]".fmt(a,this.get("start"),this.get("end"))}else{return"[%@ characters selected: {%@, %@}]".fmt(a,this.get("start"),this.get("end"))}}else{return"[no text selected; caret at %@]".fmt(this.get("start"))}}});SC.UserDefaults=SC.Object.extend({ready:NO,userDomain:null,appDomain:null,_defaults:null,_safari3DB:null,defaults:function(a){this._defaults=a;this.allPropertiesDidChange()},readDefault:function(i){var a,d,b,j,h,k,g;i=this._normalizeKeyName(i);b=this._userKeyName(i);if(this._written){d=this._written[b]}a=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(a){j=document.body;try{j.load("SC.UserDefaults")}catch(c){SC.Logger.error("Couldn't load userDefaults in IE7: "+c.description)}}else{if(this.HTML5DB_noLocalStorage){g=this._safari3DB}else{j=window.localStorage;if(!j&&window.globalStorage){j=window.globalStorage[window.location.hostname]}}}if(j||g){h=["SC.UserDefaults",b].join("-at-");if(a){d=j.getAttribute(h.replace(/\W/gi,""))}else{if(g){d=this.dataHash[h]}else{d=j[h]}}if(!SC.none(d)){try{d=SC.json.decode(d)}catch(f){}}}k=this.delegate;if(k&&k.userDefaultsNeedsDefault){d=k.userDefaultsNeedsDefault(this,i,b)}if(SC.none(d)&&this._defaults){d=this._defaults[b]||this._defaults[i]}return d},writeDefault:function(k,i){var b,f,c,l,j,m,h;k=this._normalizeKeyName(k);f=this._userKeyName(k);c=this._written;if(!c){c=this._written={}}c[f]=i;b=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(b){l=document.body}else{if(this.HTML5DB_noLocalStorage){h=this._safari3DB}else{l=window.localStorage;if(!l&&window.globalStorage){l=window.globalStorage[window.location.hostname]}}}j=["SC.UserDefaults",f].join("-at-");if(l||h){var a=SC.json.encode(i);if(b){l.setAttribute(j.replace(/\W/gi,""),a);l.save("SC.UserDefaults")}else{if(h){var d=this;h.transaction(function(n){n.executeSql("delete from SCLocalStorage where key = ?",[j],function(){n.executeSql("insert into SCLocalStorage(key, value) VALUES ('"+j+"', '"+a+"');",[],d._nullDataHandler,d.killTransaction)})});this.dataHash[j]=a}else{try{l[j]=a}catch(g){SC.Logger.error("Failed using localStorage. "+g)}}}}m=this.delegate;if(m&&m.userDefaultsDidChange){m.userDefaultsDidChange(this,k,i,f)}return this},resetDefault:function(j){var b,a,f,c,k,i,h;b=this._normalizeKeyName(j);f=this._userKeyName(b);this.propertyWillChange(j);this.propertyWillChange(b);c=this._written;if(c){delete c[f]}a=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(a){k=document.body}else{if(this.HTML5DB_noLocalStorage){h=this._safari3DB}else{k=window.localStorage;if(!k&&window.globalStorage){k=window.globalStorage[window.location.hostname]}}}i=["SC.UserDefaults",f].join("-at-");if(k){if(a){k.setAttribute(i.replace(/\W/gi,""),null);k.save("SC.UserDefaults")}else{if(h){var d=this;h.transaction(function(l){l.executeSql("delete from SCLocalStorage where key = ?",[i],null)});delete this.dataHash[i]}else{try{delete k[i]}catch(g){SC.Logger.warn("Deleting local storage encountered a problem. "+g)}}}}this.propertyDidChange(j);this.propertyDidChange(b);return this},unknownProperty:function(a,b){if(b===undefined){return this.readDefault(a)}else{this.writeDefault(a,b);return b}},_normalizeKeyName:function(a){if(a.indexOf(":")<0){var b=this.get("appDomain")||"app";a=[b,a].join(":")}return a},_userKeyName:function(b){var a=this.get("userDomain")||"(anonymous)";return[a,b].join("-at-")},_domainDidChange:function(){var a=NO;if(this.get("userDomain")!==this._scud_userDomain){this._scud_userDomain=this.get("userDomain");a=YES}if(this.get("appDomain")!==this._scud_appDomain){this._scud_appDomain=this.get("appDomain");a=YES}if(a){this.allPropertiesDidChange()}}.observes("userDomain","appDomain"),init:function(){arguments.callee.base.apply(this,arguments);var a;jQuery.readyWait++;if(SC.userDefaults&&SC.userDefaults.get("dataHash")){var g=SC.userDefaults.get("dataHash");if(g){this.dataHash=SC.userDefaults.get("dataHash")}}this._scud_userDomain=this.get("userDomain");this._scud_appDomain=this.get("appDomain");a=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(a){document.body.addBehavior("#default#userData")}this.HTML5DB_noLocalStorage=SC.browser.isWebkit&&SC.browser.compare(SC.browser.engineVersion,"523")>0&&SC.browser.compare(SC.browser.engineVersion,"528")<0;if(this.HTML5DB_noLocalStorage){var b;try{if(!window.openDatabase){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}else{var h="scdb",f="1.0",i="SproutCore database",j=65536;b=openDatabase(h,f,i,j)}}catch(d){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}if(b){var c=this;b.transaction(function(k){k.executeSql("CREATE TABLE IF NOT EXISTS SCLocalStorage(key TEXT NOT NULL PRIMARY KEY, value TEXT NOT NULL);",[],c._nullDataHandler,c.killTransaction)});b.transaction(function(k){k.parent=c;k.executeSql("SELECT * from SCLocalStorage;",[],function(q,n){var o={},p;for(var m=0,l=n.rows.length;m<l;m++){p=n.rows.item(m);o[p.key]=p.value}q.parent.dataHash=o;SC.run(function(){jQuery.ready(true)})},c.killTransaction)});this._safari3DB=b}}else{jQuery.ready(true)}},_killTransaction:function(b,a){return true},_nullDataHandler:function(b,a){}});SC.userDefaults=SC.UserDefaults.create();SC.mixin({convertHsvToHex:function(d,c,a){var b=SC.Color.hsvToRgb(d,c,a);return SC.Color.create({r:b[0],g:b[1],b:b[2]}).toHex()},convertHexToHsv:function(b){var a=SC.Color.from(b);return a&&SC.Color.rgbToHsv(a.r,a.g,a.b)},PARSE_COLOR_RGBRE:/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,PARSE_COLOR_HEXRE:/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,expandColor:function(b){var c,f,d,a;c=this.parseColor(b);if(c){f=parseInt(c.slice(1,3),16);d=parseInt(c.slice(3,5),16);a=parseInt(c.slice(5,7),16);return[f,d,a]}},parseColor:function(d){var f=0,a="#",c,b;if(c=this.PARSE_COLOR_RGBRE.exec(d)){for(f=1;f<=3;f++){b=Math.max(0,Math.min(255,parseInt(c[f],0)));a+=this.toColorPart(b)}return a}if(c=this.PARSE_COLOR_HEXRE.exec(d)){if(c[1].length==3){for(f=0;f<3;f++){a+=c[1].charAt(f)+c[1].charAt(f)}return a}return"#"+c[1]}return false},toColorPart:function(a){if(a>255){a=255}var b=a.toString(16);if(a<16){return"0"+b}return b}});SC.mixin({_downloadFrames:0,download:function(d){var a=document.createElement("iframe"),c="DownloadFrame_"+this._downloadFrames;SC.$(a).attr("id",c);a.style.border="10px";a.style.width="0px";a.style.height="0px";a.style.position="absolute";a.style.top="-10000px";a.style.left="-10000px";if(!SC.browser.isSafari){SC.$(a).attr("src",d)}document.getElementsByTagName("body")[0].appendChild(a);if(SC.browser.isSafari){SC.$(a).attr("src",d)}this._downloadFrames=this._downloadFrames+1;if(!SC.browser.isSafari){var b=function(){document.body.removeChild(document.getElementById(c));c=null};b.invokeLater(null,2000)}a=null},getStyle:function(a,b){var c="";if(document.defaultView&&document.defaultView.getComputedStyle){c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b)}else{if(a.currentStyle){b=b.replace(/\-(\w)/g,function(d,f){return f.toUpperCase()});c=a.currentStyle[b]}}return c},uniJapaneseConvert:function(f){var a,c="",b,d;for(b=0,d=f.length;b<d;b++){a=f.charCodeAt(b);a=((a>=65281&&a<=65392)?a-65248:a);a=(a===12540?45:a);c=c+String.fromCharCode(a)}return c},pointInElement:function(b,h,c,g){var i,d,a,f;h=jQuery(h);c=c||"border";i=SC.offset(h,g);if(c==="padding"){d=h.innerWidth();a=h.innerHeight();i.x+=window.parseInt(h.css("border-left-width").replace("px",""));i.y+=window.parseInt(h.css("border-top-width").replace("px",""))}else{d=h.outerWidth(c==="margin");a=h.outerHeight(c==="margin");if(c==="margin"){i.x-=window.parseInt(h.css("margin-left").replace("px",""));i.y-=window.parseInt(h.css("margin-top").replace("px",""))}}f={x:i.x,y:i.y,width:d,height:a};return SC.pointInRect(b,f)},switchScale:function(){$("head meta[name=viewport]").remove();if(window.innerWidth===window.screen.width){$("head").prepend('<meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5, user-scalable=0" />')}else{$("head").prepend('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0" />')}}});SC.mixin({ZERO_RANGE:{start:0,length:0},RANGE_NOT_FOUND:{start:0,length:-1},valueInRange:function(b,a){return(b>=0)&&(b>=a.start)&&(b<(a.start+a.length))},minRange:function(a){return a.start},maxRange:function(a){return(a.length<0)?-1:(a.start+a.length)},unionRanges:function(c,b){if((c==null)||(c.length<0)){return b}if((b==null)||(b.length<0)){return c}var d=Math.min(c.start,b.start),a=Math.max(SC.maxRange(c),SC.maxRange(b));return{start:d,length:a-d}},intersectRanges:function(c,b){if((c==null)||(b==null)){return SC.RANGE_NOT_FOUND}if((c.length<0)||(b.length<0)){return SC.RANGE_NOT_FOUND}var d=Math.max(SC.minRange(c),SC.minRange(b)),a=Math.min(SC.maxRange(c),SC.maxRange(b));if(a<d){return SC.RANGE_NOT_FOUND}return{start:d,length:a-d}},subtractRanges:function(c,b){if((c==null)||(b==null)){return SC.RANGE_NOT_FOUND}if((c.length<0)||(b.length<0)){return SC.RANGE_NOT_FOUND}var a=Math.max(SC.minRange(c),SC.minRange(b)),d=Math.min(SC.maxRange(c),SC.maxRange(b));if(a<d){return SC.RANGE_NOT_FOUND}return{start:d,length:a-d}},cloneRange:function(a){return{start:a.start,length:a.length}},rangesEqual:function(b,a){if(b===a){return true}if(b==null){return a.length<0}if(a==null){return b.length<0}return(b.start==a.start)&&(b.length==a.length)}});SC.mixin({bestStringMetricsForMaxWidth:function(a,y,o,A,x){if(!y){SC.warn("When calling bestMetricsForWidth, the second argument, maxWidth, is required. There's no reason to call this without a maxWidth.");return undefined}y=Math.ceil(parseFloat(y));var B=arguments.callee,j=SC.typeOf(o||(o=""))!==SC.T_STRING,n=j?o.style.maxWidth:undefined,p=(!j||o.cacheableForMetrics)?SC.cacheSlotFor(o,A,x,a):undefined,s=j?(B._applyMaxToEl||(B._applyMaxToEl=function(l,i){l.style.maxWidth=i+"px";return l})):(B._applyMaxToStr||(B._applyMaxToStr=function(l,i){return l.replace(/max-width:[^;]*;/g,"")+" max-width:"+i+"px"})),v=j?(B._removeMaxFromEl||(B._removeMaxFromEl=function(i){i.style.maxWidth="none";return i})):(B._removeMaxFromStr||(B._removeMaxFromStr=function(i){return i.replace(/max-width:[^;]*;/g,"")+" max-width:none"})),q=false;if(p){p.list||(p.list=[{width:Infinity,height:0}]);for(var w=1,u=p.list.length,D,b,E;w<u&&!E;w++){D=p.list[w];b=p.list[w-1];if(!D||!D.width){continue}if(y>=D.width){if((b&&b.width)||(y<=D.maxWidth)){return D}E=D}}}var r=s(o,y),t=SC.metricsForString(a,r,A,x),z=t.height,d=p?p.parent.height||(p.parent.height=SC.metricsForString("W",r,A).height):SC.metricsForString("W",r,A).height,c=Math.round(z/d);if(q){c--;z=c*d}if(z>d){var h=q?Math.ceil(t.width*2.5):t.width,m=q?t.width:Math.floor(t.width/2.5),C,g=new Date()*1,k=0;while(h-m>1||(t.height>z&&!q)||(t.height<z&&q)){k++;C=(h+m)/2;r=s(r,C);t=SC.metricsForString(a,r,A,x);if(t.height>z){m=C}else{h=C}}t.width=Math.ceil(C);t.height=z;t.maxWidth=y;t.lineHeight=d;t.lines=c;t.searchPerformed=true;t.searchTime=new Date()*1-g;t.searchCount=k}else{if(q){t=SC.metricsForString(a,r=v(r),A,x)}t.maxWidth=y;t.lineHeight=d;t.lines=c;t.searchPerformed=false}t.browserCorrection=0;if(SC.browser.isIE){t.browserCorrection=1}if(SC.browser.isMozilla){t.browserCorrection=1}t.width=Math.min(y,t.width+t.browserCorrection);if(p){var f=p.list[c];if(f&&f.maxWidth<y){f.maxWidth=y}if(!f){f=p.list[c]=t}}if(j){r.style.maxWidth=n}E=q?E:t;return E},cacheSlotFor:function(){var f=arguments.callee.caller,g=f.cache||(f.cache={});if(!arguments[0]){return g}var b=(arguments[0] instanceof Array||arguments[0].callee)?arguments[0]:arguments,d=b.length,a,c;for(c=0;c<d;c++){if(typeof(a=b[c])==="object"){a=SC.guidFor(a)}g=g[a]||(g[a]={parent:g})}return g},cachedVersionOf:function(){var a=function(c){var b=function(){var d=SC.cacheSlotFor(arguments);return d.result||(d.result=arguments.callee.func.apply(this,arguments))};b.func=c;return b};return a(a)}()});sc_require("tasks/task");SC.didPreloadBundle=function(){};SC.PreloadBundleTask=SC.Task.extend({bundle:null,target:"SC",action:"preloaded",run:function(a){var b;if(b=this.get("bundle")){var c=Date.now();SC.Module.loadModule(this.get("bundle"),this.get("target"),this.get("action"))}}});sc_require("system/string");SC.VALIDATE_OK=YES;SC.VALIDATE_NO_CHANGE=NO;SC.Validator=SC.Object.extend({fieldValueForObject:function(b,c,a){return b},objectForFieldValue:function(c,b,a){return c},validate:function(a,b){return true},validateError:function(a,b){return SC.$error(SC.String.loc("Invalid.General(%@)",b.get("fieldValue")),b.get("fieldKey"))},validateChange:function(b,c,a){return this.validate(b,c)?SC.VALIDATE_OK:this.validateError(b,c)},validateSubmit:function(a,b){return this.validate(a,b)?SC.VALIDATE_OK:this.validateError(a,b)},validatePartial:function(a,b){if(!b.get("isValid")){return this.validate(a,b)?SC.VALIDATE_OK:this.validateError(a,b)}else{return SC.VALIDATE_NO_CHANGE}},validateKeyDown:function(b,c,a){return true},attachTo:function(a,b){},detachFrom:function(a,b){}});SC.Validator.mixin({OK:true,NO_CHANGE:false,findFor:function(f,h,g){var c;if(!g){return}if(g instanceof SC.Validator){c=g}else{if(g.isClass){c=g.create()}else{if(SC.typeOf(g)===SC.T_STRING){var b=null;var a=g.match(/^(.+)\[(.*)\]/);if(a){g=a[1];b=a[2]}g=SC.String.classify(g);var d=SC.Validator[g];if(SC.none(d)){throw"validator %@ not found for %@".fmt(g,h)}else{if(b){if(!f){throw"named validator (%@) could not be found for field %@ because the field does not belong to a form".fmt(b,h)}if(!f._validatorHash){f._validatorHash={}}c=(b)?f._validatorHash[b]:null;if(!c){c=d.create()}if(b){f._validatorHash[b]=c}}else{c=d.create()}}}}}return c},fieldValueForObject:function(a,b,c){if(this.prototype&&this.prototype.fieldValueForObject){return this.prototype.fieldValueForObject(a,b,c)}else{return null}},objectForFieldValue:function(b,a,c){if(this.prototype&&this.prototype.objectForFieldValue){return this.prototype.objectForFieldValue(b,a,c)}else{return null}}});sc_require("validators/validator");SC.Validator.CreditCard=SC.Validator.extend({fieldValueForObject:function(a,b,c){if(typeof(a)=="string"&&a.length==16){a=[a.slice(0,4),a.slice(4,8),a.slice(8,12),a.slice(12,16)].join(" ")}return a},objectForFieldValue:function(b,a,c){return b.replace(/[\s-\.\:]/g,"")},validate:function(a,b){return this.checkNumber(b.get("fieldValue"))},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.CreditCard(%@)",a),a)},validateKeyDown:function(b,c,a){return !!a.match(/[0-9\- ]/)},checkNumber:function(k){if(!k||k.length===0){return YES}k=k.replace(/[^0-9]/g,"");var a="0123456789";var h=k.length;var g=parseInt(k,0);var m=k.toString();m=m.replace(/^\s+|\s+$/g,"");var l=0;var o=true;var b=false;var n;var d;for(var c=0;c<h;c++){n=""+m.substring(c,c+1);if(a.indexOf(n)=="-1"){o=false}}if(!o){b=false}if((h===0)&&(b)){b=false}else{if(h>=15){for(var f=h;f>0;f--){d=parseInt(g,0)%10;d=parseInt(d,0);l+=d;f--;g=g/10;d=parseInt(g,0)%10;d=d*2;switch(d){case 10:d=1;break;case 12:d=3;break;case 14:d=5;break;case 16:d=7;break;case 18:d=9;break;default:d=d}g=g/10;l+=d}if((l%10)===0){b=true}else{b=false}}}return b}});sc_require("validators/validator");SC.Validator.Date=SC.Validator.extend({format:"%b %d, %Y %i:%M:%S %p",fieldValueForObject:function(a,b,f){var d=this.get("format"),c;if(SC.typeOf(a)===SC.T_NUMBER){c=SC.DateTime.create(a)}else{if(a instanceof Date){c=a.getTime()}}if(c){a=c.toFormattedString(d)}return a},objectForFieldValue:function(c,a,f){var d=this.get("format"),b;if(c){b=SC.DateTime.parse(c,d);c=b?b._ms:null}return c}});sc_require("validators/validator");SC.Validator.DateTime=SC.Validator.extend({format:"%d/%m/%Y",fieldValueForObject:function(a,b,c){if(SC.kindOf(a,SC.DateTime)){a=a.toFormattedString(this.get("format"))}else{a=null}return a},objectForFieldValue:function(b,a,c){if(b){b=SC.DateTime.parse(b,this.get("format"))}return b}});sc_require("validators/validator");SC.Validator.Email=SC.Validator.extend({validate:function(a,b){return(b.get("fieldValue")||"").match(/.+@.+\...+/)},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Email(%@)",a),a)}});SC.Validator.EmailOrEmpty=SC.Validator.Email.extend({validate:function(a,c){var b=c.get("fieldValue");return(b&&b.length>0)?b.match(/.+@.+\...+/):true}});sc_require("validators/validator");SC.Validator.NotEmpty=SC.Validator.extend({validate:function(a,c){var b=c.get("fieldValue");if(SC.none(b)){return NO}if(!SC.none(b.length)){return b.length>0}return YES},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.NotEmpty(%@)",SC.String.capitalize(a)),c.get("errorLabel"))}});sc_require("validators/validator");sc_require("system/utils/misc");SC.Validator.Number=SC.Validator.extend({places:0,fieldValueForObject:function(a,b,c){switch(SC.typeOf(a)){case SC.T_NUMBER:a=a.toFixed(this.get("places"));break;case SC.T_NULL:case SC.T_UNDEFINED:a="";break}return a},objectForFieldValue:function(c,b,d){var a;c=c.replace(/,/g,"");switch(SC.typeOf(c)){case SC.T_STRING:if(c.length===0){c=null}else{if(this.get("places")>0){c=parseFloat(c)}else{if(c.length===1&&c.match(/-/)){c=null}else{a=parseInt(c,0);if(isNaN(a)){c=SC.uniJapaneseConvert(c);c=parseInt(c,0);if(isNaN(c)){c=""}}else{c=a}}}}break;case SC.T_NULL:case SC.T_UNDEFINED:c=null;break}return c},validate:function(a,c){var b=c.get("fieldValue");return(b==="")||!(isNaN(b)||isNaN(parseFloat(b)))},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Number(%@)",a),a)},validateKeyDown:function(b,c,a){if(!a){a=""}var d=c.$input().val();if(!d){d=""}d+=a;if(this.get("places")===0){if(a.length===0){return true}else{return d.match(/^[\-{0,1}]?[0-9,\0]*/)[0]===d}}else{if(a.length===0){return true}else{return d.match(/^[\-{0,1}]?[0-9,\0]*\.?[0-9\0]+/)===d}}}});sc_require("validators/validator");SC.Validator.Password=SC.Validator.extend({attachTo:function(a,b){arguments.callee.base.apply(this,arguments);if(!this.fields){this.fields=[]}this.fields.push(b)},validate:function(f){if(!this.fields||this.fields.length===0){return true}var d=false;var b=false;var a=true;var c=this.fields[0].get("fieldValue");this.fields.forEach(function(h){var g=h.get("fieldValue");if(g!=c){a=false}if(!g||g.length===0){d=true}if(g&&g.length>0){b=true}});if(f){return(b===false)?false:a}else{return(d===true)?true:a}},updateFields:function(c,b){if(!this.fields||this.fields.length===0){return true}var a=SC.String.loc("Invalid.Password");var d=this._field;this.fields.forEach(function(g){var h=(b)?null:((g==d)?a:"");c.setErrorFor(g,h)});return(b)?SC.VALIDATE_OK:a},validateChange:function(b,c,a){return this.updateFields(b,this.validate(false))},validateSubmit:function(a,b){return this.updateFields(a,this.validate(true))},validatePartial:function(b,c){var a=!this._field.get("isValid");if(a){return this.updateFields(b,this.validate(false))}else{return SC.VALIDATE_NO_CHANGE}}});sc_require("validators/validator");SC.Validator.PositiveInteger=SC.Validator.extend({defaultValue:null,fieldValueForObject:function(a,b,c){switch(SC.typeOf(a)){case SC.T_NUMBER:a=a.toFixed(0);break;case SC.T_NULL:case SC.T_UNDEFINED:a=this.get("defaultValue");break}return a},objectForFieldValue:function(b,a,c){b=b.replace(/,/g,"");switch(SC.typeOf(b)){case SC.T_STRING:if(b.length===0){b=this.get("defaultValue")}else{b=parseInt(b,0)}break;case SC.T_NULL:case SC.T_UNDEFINED:b=this.get("defaultValue");break}if(isNaN(b)){return this.get("defaultValue")}return b},validate:function(a,c){var b=c.get("fieldValue");return(b==="")||!isNaN(b)},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Number(%@)",a),a)},validateKeyDown:function(b,c,a){var d=c.$input().val();if(!d){d=""}d+=a;if(a.length===0){return true}else{return d.match(/^[0-9\0]*/)[0]===d}}});SC.ContainerView=SC.View.extend({classNames:["sc-container-view"],renderDelegateName:"containerRenderDelegate",nowShowing:null,contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(a){this.removeAllChildren();if(a){this.appendChild(a)}},createChildViews:function(){var a=this.get("contentView");if(a){a=this.contentView=this.createChildView(a);this.childViews=[a]}},awake:function(){arguments.callee.base.apply(this,arguments);var a=this.get("nowShowing");if(a&&a.length>0){this.nowShowingDidChange()}},nowShowingDidChange:function(){var c=this.get("nowShowing");if(c===SC.CONTENT_SET_DIRECTLY){return}var a=(this._instantiatedLastView===YES)?this.get("contentView"):null;this._instantiatedLastView=NO;if(SC.typeOf(c)===SC.T_STRING&&c.length>0){if(c.indexOf(".")>0){c=SC.objectForPropertyPath(c)}else{var b=this.getPath(c);c=SC.kindOf(b,SC.CoreView)?b:SC.objectForPropertyPath(c,this.get("page"))}}if(SC.typeOf(c)===SC.T_CLASS){if(c.kindOf(SC.CoreView)){c=this.createChildView(c);this._instantiatedLastView=YES}else{c=null}}if(c&&!(c instanceof SC.CoreView)){c=null}this.set("contentView",c);if(a){a.destroy()}}.observes("nowShowing"),contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView")});sc_require("mixins/validatable");SC.FieldView=SC.View.extend(SC.Control,SC.Validatable,{fieldValue:function(){var a=this.get("value");if(SC.typeOf(a)===SC.T_ERROR){a=a.get("errorValue")}return this.fieldValueForObject(a)}.property("value","validator").cacheable(),$input:function(){var a=this._inputElementTagName();return this.$(a).andSelf().filter(a)},_inputElementTagName:function(){return"input"},setFieldValue:function(b){if(SC.none(b)){b=""}var a=this.$input();if(a.val()!==b){a.val(b)}return this},getFieldValue:function(){return this.$input().val()},_field_fieldValueDidChange:function(a){SC.run(function(){this.fieldValueDidChange(NO)},this)},fieldValueDidChange:function(a){var c=this.getFieldValue();var b=this.objectForFieldValue(c,a);this.setIfChanged("value",b)},_field_valueDidChange:function(){this.setFieldValue(this.get("fieldValue"))}.observes("fieldValue"),didCreateLayer:function(){this.setFieldValue(this.get("fieldValue"));this._addChangeEvent()},willDestroyLayer:function(){SC.Event.remove(this.$input(),"change",this,this._field_fieldValueDidChange)},mouseDown:function(a){this._field_isMouseDown=YES;a.allowDefault();return YES},mouseExited:function(a){if(this._field_isMouseDown){this.set("isActive",NO)}a.allowDefault();return YES},mouseEntered:function(a){this.set("isActive",this._field_isMouseDown);a.allowDefault();return YES},mouseUp:function(a){if(this._field_isMouseDown){this.set("isActive",NO)}this._field_isMouseDown=NO;a.allowDefault();return YES},keyDown:function(b){if(b.which===9||b.keyCode===9){var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES}if(this.performValidateKeyDown(b)){this._isKeyDown=YES;b.allowDefault()}else{b.stop()}return YES},acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),_addChangeEvent:function(){SC.Event.add(this.$input(),"change",this,this._field_fieldValueDidChange)},_field_setFieldValue:function(b){this.propertyWillChange("fieldValue");if(this.fieldValueForObject){b=this.fieldValueForObject(b)}var a=this.setFieldValue(b);this.propertyDidChange("fieldValue");return a},_field_getFieldValue:function(){var a=this.getFieldValue();if(this.objectForFieldValue){a=this.objectForFieldValue(a)}return a}});SC.IMAGE_STATE_NONE="none";SC.IMAGE_STATE_LOADING="loading";SC.IMAGE_STATE_LOADED="loaded";SC.IMAGE_STATE_FAILED="failed";SC.IMAGE_TYPE_NONE="NONE";SC.IMAGE_TYPE_URL="URL";SC.IMAGE_TYPE_CSS_CLASS="CSS_CLASS";SC.BLANK_IMAGE_DATAURL="data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw==";SC.BLANK_IMAGE_URL=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"8")<0?"/static/sproutcore/foundation/en/10d3bc350f4f17581da3a45c0875ecac95f83355/source/resources/blank.gif":SC.BLANK_IMAGE_DATAURL;SC.BLANK_IMAGE=new Image();SC.BLANK_IMAGE.src=SC.BLANK_IMAGE_URL;SC.BLANK_IMAGE.width=SC.BLANK_IMAGE.height=1;SC.ImageView=SC.View.extend(SC.Control,SC.InnerFrame,{classNames:"sc-image-view",displayProperties:["frame","image","innerFrame","toolTip","imageValue","type"],renderDelegateName:function(){return(this.get("useCanvas")?"canvasImage":"image")+"RenderDelegate"}.property("useCanvas").cacheable(),tagName:function(){return this.get("useCanvas")?"canvas":"div"}.property("useCanvas").cacheable(),canLoadInBackground:NO,image:SC.BLANK_IMAGE,imageValue:function(){var a=this.get("value");return a&&a.isEnumerable?a.firstObject():a}.property("value").cacheable(),innerFrame:function(){var c=this.get("image"),b=c.width,a=c.height,d=this.get("frame");if(SC.none(d)){return{x:0,y:0,width:0,height:0}}return this.innerFrameForSize(b,a,d.width,d.height)}.property("align","image","scale","frame").cacheable(),localize:YES,status:SC.IMAGE_STATE_NONE,type:function(){var a=this.get("imageValue");if(SC.ImageView.valueIsUrl(a)){return SC.IMAGE_TYPE_URL}else{if(!SC.none(a)){return SC.IMAGE_TYPE_CSS_CLASS}}return SC.IMAGE_TYPE_NONE}.property("imageValue").cacheable(),useCanvas:function(){return SC.platform.supportsCanvas&&!this.get("useStaticLayout")&&this.get("type")!==SC.IMAGE_TYPE_CSS_CLASS}.property("useStaticLayout","type").cacheable(),useImageQueue:YES,value:null,viewDidResize:function(){var b=this.get("layer"),c,a;if(b){c=b.offsetWidth;a=b.offsetHeight;if(this._cachedWidth!==c||this._cachedHeight!==a){this.notifyPropertyChange("frame");this._cachedWidth=c;this._cachedHeight=a}}},init:function(){arguments.callee.base.apply(this,arguments);this._image_valueDidChange();if(this.get("useImageCache")!==undefined){SC.Logger.warn("%@ has useImageCache set, please set useImageQueue instead".fmt(this));this.set("useImageQueue",this.get("useImageCache"))}},layerDidChange:function(){if(this.get("useCanvas")){this.set("layerNeedsUpdate",YES)}}.observes("layer"),_image_valueDidChange:function(){var b=this.get("imageValue"),a=this.get("type");if(b!==this._iv_value){this._iv_value=b;this.set("image",SC.BLANK_IMAGE);if(a!==SC.IMAGE_TYPE_CSS_CLASS){this.set("status",SC.IMAGE_STATE_LOADING);if(!this._loadImageUsingCache()){this._loadImage()}}}}.observes("imageValue"),_loadImageUsingCache:function(){var c=this.get("imageValue"),b=this.get("type");if(b===SC.IMAGE_TYPE_URL&&this.get("useImageQueue")){var a=this.get("isVisibleInWindow")||this.get("canLoadInBackground");SC.imageQueue.loadImage(c,this,this._loadImageUsingCacheDidComplete,a);return YES}return NO},_loadImageUsingCacheDidComplete:function(a,c){var b=this.get("imageValue");if(b===a){if(SC.ok(c)){this.didLoad(c)}else{this.didError(c)}}},_loadImage:function(){var d=this.get("imageValue"),b=this.get("type"),c=this,g,a;if(b===SC.IMAGE_TYPE_URL){g=new Image();var f=function(){SC.run(function(){c._loadImageDidComplete(d,SC.$error("SC.Image.FailedError","Image",-101))})};var h=function(){SC.run(function(){c._loadImageDidComplete(d,g)})};a=$(g);a.bind("error",f);a.bind("abort",f);a.bind("load",h);g.src=d;return YES}return NO},_loadImageDidComplete:function(a,c){var b=this.get("imageValue");if(b===a){if(SC.ok(c)){this.didLoad(c)}else{this.didError(c)}}},didLoad:function(a){this.set("status",SC.IMAGE_STATE_LOADED);if(!a){a=SC.BLANK_IMAGE}this.set("image",a)},didError:function(a){this.set("status",SC.IMAGE_STATE_FAILED);this.set("image",SC.BLANK_IMAGE)}});SC.ImageView.valueIsUrl=function(a){return a&&SC.typeOf(a)===SC.T_STRING?a.indexOf("/")>=0:NO};sc_require("views/field");sc_require("system/text_selection");sc_require("mixins/static_layout");sc_require("mixins/editable");SC.TextFieldView=SC.FieldView.extend(SC.StaticLayout,SC.Editable,{classNames:["sc-text-field-view"],isTextField:YES,applyImmediately:YES,commitOnBlur:YES,isPassword:NO,isTextArea:NO,focused:NO,hint:"",type:"text",isBrowserFocusable:YES,autoCorrect:YES,autoCapitalize:YES,formattedHint:function(){var a=this.get("hint");return typeof(a)==="string"&&this.get("localize")?SC.String.loc(a):a}.property("hint","localize").cacheable(),hintOnFocus:YES,localize:YES,isEditing:NO,defaultTabbingEnabled:YES,isContextMenuEnabled:YES,continuouslyUpdatesValue:null,allowsErrorAsValue:YES,leftAccessoryView:null,rightAccessoryView:null,spellCheckEnabled:YES,maxLength:5096,shouldRenderBorder:YES,supportsAutoResize:YES,autoResizeLayer:function(){return this.$input()[0]}.property("layer").cacheable(),autoResizeText:function(){return this.get("value")}.property("value").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",20),_hintON:YES,init:function(){var a=this.get("value");this._hintON=((!a||a&&a.length===0)&&!this.get("hintOnFocus"))?YES:NO;var b=this.get("continouslyUpdatesValue");if(b!==null&&b!==undefined){this.set("applyImmediately",b)}return arguments.callee.base.apply(this,arguments)},isEditable:YES,selection:function(l,j){var d=this.$input()[0],f,a,c;if(j===undefined){if(d){a=null;c=null;if(!d.value){a=c=0}else{try{if("selectionStart" in d){a=d.selectionStart}if("selectionEnd" in d){c=d.selectionEnd}}catch(g){return null}if(a===null||c===null){var k=document.selection;if(k){var i=k.type;if(i&&(i==="None"||i==="Text")){f=k.createRange();if(!this.get("isTextArea")){var b=f.text.length;a=Math.abs(f.moveStart("character",0-(d.value.length+1)));c=a+b}else{var h=f.duplicate();h.moveToElementText(d);h.setEndPoint("EndToStart",f);a=h.text.length;c=a+f.text.length}}}}}return SC.TextSelection.create({start:a,end:c})}else{return null}}else{if(!j||!j.kindOf||!j.kindOf(SC.TextSelection)){throw"When setting the selection, you must specify an SC.TextSelection instance."}if(d){if(d.setSelectionRange){d.setSelectionRange(j.get("start"),j.get("end"))}else{f=d.createTextRange();a=j.get("start");f.move("character",a);f.moveEnd("character",j.get("end")-a);f.select()}}return j}}.property("fieldValue").cacheable(),displayProperties:["isBrowserFocusable","formattedHint","fieldValue","isEditing","isEditable","leftAccessoryView","rightAccessoryView","isTextArea"],createChildViews:function(){arguments.callee.base.apply(this,arguments);this.accessoryViewObserver()},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),accessoryViewObserver:function(){var g,j=["leftAccessoryView","rightAccessoryView"],a=j.length,b,f,d,h;for(b=0;b<a;b++){f=j[b];d=this["_"+f];h=this.get(f);if(!(d&&h&&(d===h))){if(d){g=d.get("classNames");g=g.without("sc-text-field-accessory-view");d.set("classNames",g);this.removeChild(d);d=null;this["_"+f]=null}if(h){if(h.isClass){h=h.create({layoutView:this})}g=h.get("classNames");var c="sc-text-field-accessory-view";if(g.indexOf(c)<0){g=SC.clone(g);g.push(c);h.set("classNames",g)}this.appendChild(h);this["_"+f]=h}}}}.observes("leftAccessoryView","rightAccessoryView"),layoutChildViewsIfNeeded:function(a){if(!a){a=this.get("isVisibleInWindow")}if(a&&this.get("childViewsNeedLayout")){var b=this.get("rightAccessoryView");if(b&&b.get){var c=b.get("layout");if(c){c.left=null;if(!c.right){c.right=0}b.adjust({layout:c})}}}arguments.callee.base.apply(this,arguments)},render:function(f,g){arguments.callee.base.apply(this,arguments);var a,d,c,b;a=this.get("fieldValue");if(SC.none(a)){a=""}a=String(a);f.setClass("not-empty",a.length>0);d=this._getAccessoryViewWidths();c=d.left;b=d.right;if(c){c+="px"}if(b){b+="px"}this._renderField(f,g,a,c,b)},_forceRenderFirstTime:NO,_renderFieldLikeFirstTime:function(){this.set("_forceRenderFirstTime",YES)}.observes("isTextArea"),_renderField:function(g,l,x,j,r){var s=this.get("formattedHint"),b=this.get("hintOnFocus"),o="",k=this.get("maxLength"),v=this.get("isTextArea"),C=this.get("isEnabled"),p=this.get("isEditable"),t=this.get("autoCorrect"),D=this.get("autoCapitalize"),m=this.get("isBrowserFocusable"),G="",f="",d="",F,y,h,B,c,n,i,a,w,u;g.setClass("text-area",v);a=SC.browser.isWebkit&&SC.browser.compare(SC.browser.engineVersion,"532")<0;g.setClass("oldWebKitFieldPadding",a);if(l||this._forceRenderFirstTime){this._forceRenderFirstTime=NO;w=C?(p?"":'readonly="readonly"'):'disabled="disabled"';F=this.get("layerId");G=this.get("spellCheckEnabled")?' spellcheck="true"':' spellcheck="false"';if(t!=null){d=" autocorrect="+(!t?'"off"':'"true"')}if(t!=null){f=" autocapitalize="+(!D?'"off"':'"true"')}if(m){u='tabindex="-1"'}if(SC.platform.input.placeholder&&!b){o=' placeholder="'+s+'"'}if(this.get("shouldRenderBorder")){g.push('<div class="border"></div>')}y="";if(j||r){y='style="';if(j){y+="left:"+j+";"}if(r){y+="right:"+r+";"}y+='"'}g.push('<div class="padding" '+y+">");x=this.get("escapeHTML")?SC.RenderContext.escapeHTML(x):x;if(this._hintON&&!SC.platform.input.placeholder&&(!x||(x&&x.length===0))){x=s;g.setClass("sc-hint",YES)}if(b){var z='<div aria-hidden="true" class="hint '+(v?"":"ellipsis")+'%@">'+s+"</div>";g.push(z.fmt(x?" sc-hidden":""))}i="field";if(v){g.push('<textarea aria-label="'+s+'" aria-multiline="true" class="'+i+'" name="'+F+'" '+w+o+G+d+u+f+' maxlength="'+k+'">'+x+"</textarea></div>")}else{h=this.get("type");if(this.get("isPassword")){h="password"}g.push('<input aria-label="'+s+'" class="'+i+'" type="'+h+'" name="'+F+'" '+w+' value="'+x+'"'+o+G+u+' maxlength="'+k+'" '+d+" "+f+"/></div>")}}else{var q=this.$input(),A=q[0],E=this.get("value");if(b){this.$(".hint")[0].innerHTML=s}else{if(!b){A.placeholder=s}}if(SC.browser.name===SC.BROWSER.ie&&SC.browser.version<=8&&!v){q.css("line-height",this.get("frame").height+"px")}if(!E||(E&&E.length===0)){if(this.get("isPassword")){A.type="password"}if(!SC.platform.input.placeholder&&this._hintON){if(!this.get("isFirstResponder")){g.setClass("sc-hint",YES);q.val(s)}else{g.setClass("sc-hint",NO);q.val("")}}}if(t!=null){q.attr("autoCorrect",!t?"off":"true")}else{q.attr("autoCorrect",null)}if(D!=null){q.attr("autoCapitalize",!D?"off":"true")}else{q.attr("autoCapitalize",null)}if(!b&&SC.platform.input.placeholder){q.attr("placeholder",s)}if(m){q.removeAttr("tabindex")}else{q.attr("tabindex","-1")}c=q[0];if(c){if(!C){c.disabled="true";c.readOnly=null}else{if(!p){c.disabled=null;c.readOnly="true"}else{c.disabled=null;c.readOnly=null}}n=c.parentNode.style;if(j){if(n.left!==j){n.left=j}}else{n.left=null}if(r){if(n.right!==r){n.right=r}}else{n.right=null}}}},_getAccessoryViewWidths:function(){var c={},l=["left","right"],d=l.length,g,h,m,k,a,j,f,b;for(g=0;g<d;g++){h=l[g];m=this["_"+h+"AccessoryView"];if(m&&m.isObservable){b=m.get("frame");if(b){a=b.width;if(a){j=m.get("layout");if(j){f=j[h];a+=f}c[h]=a}}}}return c},didCreateLayer:function(){arguments.callee.base.apply(this,arguments);if(!SC.platform.input.placeholder){this.invokeLast(this._setInitialPlaceHolderIE)}if(this.get("isTextArea")){this.invokeLast(this._addTextAreaEvents)}else{this._addTextAreaEvents();if(SC.browser.isMozilla){var a=this.$input();SC.Event.add(a,"keypress",this,this._firefox_dispatch_keypress)}}if(this.get("hintOnFocus")||(SC.browser.name===SC.BROWSER.ie&&SC.browser.version<=8&&!this.get("isTextArea"))){this.invokeLast(this._fixupTextLayout)}},_fixupTextLayout:function(){var a=this.get("frame").height;if(SC.browser.name===SC.BROWSER.ie&&SC.browser.version<=8&&!this.get("isTextArea")){this.$input().css("line-height",a+"px")}if(this.get("hintOnFocus")&&!this.get("isTextArea")){this.$(".hint").css("line-height",this.$(".hint").outerHeight()+"px")}},_setInitialPlaceHolderIE:function(){if(!SC.platform.input.placeholder&&this._hintON){var a=this.$input(),b=a.val();if(!b||(b&&b.length===0)){a.val(this.get("formattedHint"))}}},_addTextAreaEvents:function(){var a=this.$input();SC.Event.add(a,"focus",this,this._textField_fieldDidFocus);SC.Event.add(a,"blur",this,this._textField_fieldDidBlur);SC.Event.add(a,"select",this,this._textField_selectionDidChange);SC.Event.add(a,"input",this,this._textField_inputDidChange)},willDestroyLayer:function(){arguments.callee.base.apply(this,arguments);var a=this.$input();SC.Event.remove(a,"focus",this,this._textField_fieldDidFocus);SC.Event.remove(a,"blur",this,this._textField_fieldDidBlur);SC.Event.remove(a,"select",this,this._textField_selectionDidChange);SC.Event.remove(a,"keypress",this,this._firefox_dispatch_keypress);SC.Event.remove(a,"input",this,this._textField_inputDidChange)},_textField_fieldDidFocus:function(a){SC.run(function(){this.set("focused",YES);this.fieldDidFocus(a);var b=this.get("value");if(!SC.platform.input.placeholder&&((!b)||(b&&b.length===0))){this._hintON=NO}},this)},_textField_fieldDidBlur:function(a){SC.run(function(){this.set("focused",NO);this.fieldDidBlur(this._origEvent||a);var b=this.get("value");if(!SC.platform.input.placeholder&&!this.get("hintOnFocus")&&((!b)||(b&&b.length===0))){this._hintON=YES}},this)},fieldDidFocus:function(a){this.becomeFirstResponder();this.beginEditing(a);if(this._didHideInterceptForPane){this._didHideInterceptForPane.showTouchIntercept();this._didHideInterceptForPane=null}var b=this.get("pane");if(b&&b.get("hasTouchIntercept")){b.hideTouchIntercept();this._didHideInterceptForPane=this.get("pane")}},fieldDidBlur:function(a){this.resignFirstResponder(a);if(this.get("commitOnBlur")){this.commitEditing(a)}var b=this._didHideInterceptForPane;if(b){b.showTouchIntercept();b=null}},_field_fieldValueDidChange:function(a){if(this.get("focused")){SC.run(function(){this.fieldValueDidChange(NO)},this)}this.updateHintOnFocus()},_textField_inputDidChange:function(){var a=SC.empty(this._fieldValueDidChangeTimer)||!this._fieldValueDidChangeTimer.get("isValid");if(this.get("applyImmediately")&&a){this.invokeLater(this.fieldValueDidChange,10)}},updateHintOnFocus:function(){var a=this.get("hintOnFocus");if(!a){return}if(this.getFieldValue()){this.$(".hint").addClass("sc-hidden")}else{this.$(".hint").removeClass("sc-hidden")}}.observes("value"),_topOffsetForFirefoxCursorFix:3,_firefox_dispatch_keypress:function(a){var d=this.get("selection"),f=this.get("value"),c=f?f.length:0,b;if(!d||((d.get("length")===0&&(d.get("start")===0)||d.get("end")===c))){b=SC.RootResponder.responder;if(a.keyCode===9){return}b.keypress.call(b,a);a.stopPropagation()}},_textField_selectionDidChange:function(){this.notifyPropertyChange("selection")},didBecomeKeyResponderFrom:function(a){if(this.get("isVisibleInWindow")){var b=this.$input()[0];try{if(b){b.focus()}}catch(c){}if(!this._txtFieldMouseDown){this.invokeLast(this._selectRootElement)}}},_selectRootElement:function(){var b=this.$input()[0],a;if(b){a=SC.browser.os===SC.OS.mac&&SC.browser.compare(SC.browser.osVersion,"10.7")===0;if(!(SC.browser.name===SC.BROWSER.safari&&a&&SC.buildLocale==="ko-kr")){b.select()}}else{this._textField_selectionDidChange()}},didLoseKeyResponderTo:function(a){var b=this.$input()[0];if(b){b.blur()}this.invokeLater("scrollToOriginIfNeeded",100)},scrollToOriginIfNeeded:function(){var b=this.get("pane");if(!b){return}var a=b.get("firstResponder");if(!a||!a.get("isTextField")){document.body.scrollTop=document.body.scrollLeft=0}},keyDown:function(a){return this.interpretKeyEvents(a)||NO},insertText:function(c,a){var g=a.which,d=a.keyCode,b=false;if(!SC.platform.input.maxlength&&this.get("isTextArea")){var f=this.get("value");if(f&&((!SC.browser.isMozilla&&g>47)||(SC.browser.isMozilla&&((g>32&&g<43)||g>47)&&!(d>36&&d<41)))&&(f.length>=this.get("maxLength"))){b=true}}if((this.performValidateKeyDown(a)||SC.platform.touch)&&!b){this._isKeyDown=YES;a.allowDefault()}else{a.stop()}if(this.get("applyImmediately")){this._fieldValueDidChangeTimer=this.invokeLater(this.fieldValueDidChange,10)}return YES},insertTab:function(b){if(!this.get("defaultTabbingEnabled")){return NO}var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},keyUp:function(a){if(SC.browser.isMozilla&&a.keyCode===SC.Event.KEY_RETURN){this.fieldValueDidChange()}this.notifyPropertyChange("selection");this._isKeyDown=NO;a.allowDefault();return YES},mouseDown:function(a){var b=this.get("fieldValue");this._txtFieldMouseDown=YES;this.becomeFirstResponder();if(!this.get("isEnabled")){a.stop();return YES}else{return arguments.callee.base.apply(this,arguments)}},mouseUp:function(a){this._txtFieldMouseDown=NO;this.notifyPropertyChange("selection");if(!this.get("isEnabled")){a.stop();return YES}return arguments.callee.base.apply(this,arguments)},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},mouseWheel:function(a){if(this.get("isTextArea")){a.allowDefault();return YES}else{return NO}},selectStart:function(a){return YES},_inputElementTagName:function(){if(this.get("isTextArea")){return"textarea"}else{return"input"}},_valueObserver:function(){var b=this.get("value"),a;if(b&&b.length>0){this._hintON=NO;a=this.get("maxLength");if(!SC.platform.input.maxlength&&b.length>a){this.set("value",b.substr(0,a))}}else{if(!this.get("hintOnFocus")){this._hintON=YES}}}.observes("value")});sc_require("views/text_field");sc_require("system/utils/misc");sc_require("delegates/inline_text_field");sc_require("mixins/inline_editor");SC.InlineTextFieldView=SC.TextFieldView.extend(SC.InlineEditor,{classNames:["inline-editor"],_topOffsetForFirefoxCursorFix:0,blurOnMouseDown:YES,_updateViewStyle:function(b){var c="",a=SC.getStyle(b,"font-size");if(a&&a.length>0){c=c+"font-size: "+a+" !important; "}a=SC.getStyle(b,"font-family");if(a&&a.length>0){c=c+"font-family: "+a+" !important; "}a=SC.getStyle(b,"font-weight");if(a&&a.length>0){c=c+"font-weight: "+a+" !important; "}a=SC.getStyle(b,"z-index");if(a&&a.length>0){c=c+"z-index: "+a+" !important; "}a=SC.getStyle(b,"line-height");if(a&&a.length>0){c=c+"line-height: "+a+" !important; "}a=SC.getStyle(b,"text-align");if(a&&a.length>0){c=c+"text-align: "+a+" !important; "}a=SC.getStyle(b,"top-margin");if(a&&a.length>0){c=c+"top-margin: "+a+" !important; "}a=SC.getStyle(b,"bottom-margin");if(a&&a.length>0){c=c+"bottom-margin: "+a+" !important; "}a=SC.getStyle(b,"left-margin");if(a&&a.length>0){c=c+"left-margin: "+a+" !important; "}a=SC.getStyle(b,"right-margin");if(a&&a.length>0){c=c+"right-margin: "+a+" !important; "}return c},_updateViewPaddingStyle:function(b){var c="",a=SC.getStyle(b,"padding-top");if(a&&a.length>0){c=c+"top: "+a+" !important; "}a=SC.getStyle(b,"padding-bottom");if(a&&a.length>0){c=c+"bottom: "+a+" !important; "}a=SC.getStyle(b,"padding-left");if(a&&a.length>0){c=c+"left: "+a+" !important; "}a=SC.getStyle(b,"padding-right");if(a&&a.length>0){c=c+"right: "+a+" !important; "}return c},updateStyle:function(d){if(d.length){d=d[0]}var a=document.getElementById("sc-inline-text-field-style"),c=this._updateViewStyle(d),f=this._updateViewPaddingStyle(d),g=".inline-editor input{"+c+"}.inline-editor textarea{"+c+"}.inline-editor .padding{"+f+"}";if(!a){var b=document.getElementsByTagName("head")[0];a=document.createElement("style");a.type="text/css";a.media="screen";a.id="sc-inline-text-field-style";b.appendChild(a)}if(a.styleSheet){a.styleSheet.cssText=g}else{a.innerHTML=g}},positionOverTargetView:function(k,d,c,b,f){var h;if(!c){c=k.get("pane")}if(!f){f=k.$()[0]}if(!b){var i=k.get("frame");b=SC.offset(f);b.height=i.height;b.width=i.width}var j={},a=c.$()[0],g=k.get("layout");j.height=b.height;j.width=b.width;h=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(d&&g.left){j.left=b.x-g.left-a.offsetLeft-1;if(h){j.left--}}else{j.left=b.x-a.offsetLeft-1;if(h){j.left--}}if(d&&g.top){j.top=b.y-g.top-a.offsetTop;if(h){j.top=j.top-2}}else{j.top=b.y-a.offsetTop;if(h){j.top=j.top-2}}this.set("layout",j)},multiline:NO,isTextArea:function(){return this.get("multiline")}.property("multiline").cacheable(),beginEditing:function(b,a){if(!b(a)){return NO}var d=a.get("pane"),c=this.get("exampleElement");this.beginPropertyChanges();if(c){if(c.length){c=c[0]}}else{c=a.$()[0]}this.updateStyle(c);this.positionOverTargetView(a,this.get("isCollection"),d,this.get("exampleFrame"),c);this._previousFirstResponder=d?d.get("firstResponder"):null;this.becomeFirstResponder();this.endPropertyChanges();return YES}.enhance(),blurEditor:function(a){if(!this.get("isEditing")){return YES}return this.commitOnBlur?this.commitEditing():this.discardEditing()},_endEditing:function(b){var a=b();if(this.get("isFirstResponder")){var c=this.get("pane");if(c&&this._previousFirstResponder){c.makeFirstResponder(this._previousFirstResponder)}else{this.resignFirstResponder()}}this._previousFirstResponder=null;return a}.enhance(),mouseDown:function(a){arguments.callee.base.call(this,a);return this.get("isEditing")},touchStart:function(a){this.mouseDown(a)},keyDown:function(a){var b=this.interpretKeyEvents(a);this.fieldValueDidChange(true);return !b?NO:b},insertText:null,_scitf_blurInput:function(){var a=this.$input()[0];if(a){a.blur()}a=null},willRemoveFromParent:function(){return this._scitf_blurInput()},willLoseFirstResponder:function(b,a){if(b!==this){return}this._previousFirstResponder=null;this._origEvent=a;this._scitf_blurInput();return this.blurEditor(a)},cancel:function(){this.discardEditing();return YES},fieldValueDidChange:function(a){arguments.callee.base.call(this,a)},insertNewline:function(a){if(this.get("isTextArea")){a.allowDefault();return arguments.callee.base.call(this,a)}else{if(this.get("value")!=this.$input().val()){this.set("value",this.$input().val())}this.commitEditing();return YES}},insertTab:function(a){var c=this.target;this.resignFirstResponder();this.commitEditing();if(c){var b=c.get("nextValidKeyView");if(b&&b.beginEditing){b.beginEditing()}}return YES},insertBacktab:function(a){var c=this.target;this.resignFirstResponder();this.commitEditing();if(c){var b=c.get("previousValidKeyView");if(b&&b.beginEditing){b.beginEditing()}}return YES},deleteForward:function(a){a.allowDefault();return YES},deleteBackward:function(a){a.allowDefault();return YES}});SC.mixin(SC.InlineTextFieldView,{inlineEditorDelegate:SC.InlineTextFieldDelegate,label:null,editor:null,beginEditing:function(c){var a,d,b,f,g;if(SC.typeOf(c)===SC.T_HASH){b=c;if(!b.delegate||!b.exampleElement||!b.frame){SC.error("Delegate, exampleElement, and frame options are required.");return NO}c=b.delegate;f=b.value}else{f=c.get("value")}g=SC.beget(c);g.mixin({inlineEditorWillBeginEditing:function(){if(c.inlineEditorWillBeginEditing){c.inlineEditorWillBeginEditing.apply(c,arguments)}},inlineEditorDidBeginEditing:function(){if(c.inlineEditorDidBeginEditing){c.inlineEditorDidBeginEditing.apply(c,arguments)}},inlineEditorWillCommitEditing:function(i,j,h){if(c.inlineEditorWillCommitEditing){c.inlineEditorWillCommitEditing(i,j,h)}if(c.inlineEditorWillEndEditing){c.inlineEditorWillEndEditing(i,j)}},inlineEditorDidCommitEditing:function(i,j,h){if(c.inlineEditorDidCommitEditing){c.inlineEditorDidCommitEditing(i,j,h)}if(c.inlineEditorDidEndEditing){c.inlineEditorDidEndEditing(i,j)}SC.InlineTextFieldView._endEditing()},inlineEditorWillDiscardEditing:function(i,h){if(c.inlineEditorWillDiscardEditing){c.inlineEditorWillDiscardEditing(i,h)}if(c.inlineEditorWillEndEditing){c.inlineEditorWillEndEditing(i,this.get("value"))}},inlineEditorDidDiscardEditing:function(i,h){if(c.inlineEditorDidDiscardEditing){c.inlineEditorDidDiscardEditing(i,h)}if(c.inlineEditorDidEndEditing){c.inlineEditorDidEndEditing(i,this.get("value"))}SC.InlineTextFieldView._endEditing()}});if(c.inlineEditorShouldBeginEditing&&!c.inlineEditorShouldBeginEditing(c,f)){return NO}this.editor=d=this.inlineEditorDelegate.acquireEditor(c);d.set("value",f);if(b){d.set("exampleElement",b.exampleElement);d.set("exampleFrame",b.frame);d.set("multiline",b.multiline);d.set("escapeHTML",b.escapeHTML);d.set("isCollection",b.isCollection);d.set("commitOnBLur",b.commitOnBlur);d.set("validator",b.validator)}if(d){return d.beginEditing(g)}else{return NO}},commitEditing:function(){return this.inlineEditorDelegate.editor?this.inlineEditorDelegate.editor.commitEditing():NO},discardEditing:function(){return this.inlineEditorDelegate.editor?this.inlineEditorDelegate.editor.discardEditing():NO},_endEditing:function(){this.inlineEditorDelegate.releaseEditor(this.editor);this.editor=null}});sc_require("mixins/inline_editable");sc_require("mixins/inline_editor_delegate");sc_require("delegates/inline_text_field");SC.REGULAR_WEIGHT="normal";SC.BOLD_WEIGHT="bold";SC.LabelView=SC.View.extend(SC.Control,SC.InlineEditable,{classNames:["sc-label-view"],displayProperties:["displayTitle","textAlign","fontWeight","icon","escapeHTML","needsEllipsis","hint","toolTip"],inlineEditorDelegate:SC.InlineTextFieldDelegate,isEditable:NO,exampleEditor:SC.InlineTextFieldView,fontWeight:null,escapeHTML:YES,escapeHTMLBindingDefault:SC.Binding.oneWay().bool(),localize:NO,localizeBindingDefault:SC.Binding.oneWay().bool(),formatter:null,value:"",hint:null,hintEnabled:function(){return this.get("isEditable")}.property("isEditable").cacheable(),icon:null,textAlign:null,supportsAutoResize:YES,autoResizeLayer:function(){return this.get("layer")}.property("layer").cacheable(),autoResizeText:function(){return this.get("displayTitle")}.property("displayTitle").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",10),renderDelegateName:"labelRenderDelegate",displayTitle:function(){var h,f;h=this.get("value");f=this.getDelegateProperty("formatter",this.displayDelegate);if(f){var g=(SC.typeOf(f)===SC.T_FUNCTION)?f(h,this):f.fieldValueForObject(h,this);if(!SC.none(g)){h=g}}if(SC.typeOf(h)===SC.T_ARRAY){var d=[];for(var b=0,c=h.get("length");b<c;b++){var a=h.objectAt(b);if(!SC.none(a)&&a.toString){a=a.toString()}d.push(a)}h=d.join(",")}if(!SC.none(h)&&h.toString){h=h.toString()}if(h&&this.getDelegateProperty("localize",this.displayDelegate)){h=SC.String.loc(h)}return h}.property("value","localize","formatter").cacheable(),hintValue:function(){var a=this.get("hint");return a}.property("hint").cacheable(),doubleClick:function(a){return this.beginEditing()},inlineEditorDidBeginEditing:function(b,c,d,a){this._oldOpacity=this.get("layout").opacity||1;this.adjust("opacity",0);b(c,d,a)}.enhance(),inlineEditorDidEndEditing:function(){this.adjust("opacity",this._oldOpacity);this._oldOpacity=null}});SC.allowsBackspaceToPreviousPage=NO;SC.HORIZONTAL_ORIENTATION="horizontal";SC.VERTICAL_ORIENTATION="vertical";SC.BORDER_BEZEL="sc-bezel-border";SC.BORDER_BLACK="sc-black-border";SC.BORDER_GRAY="sc-gray-border";SC.BORDER_TOP="sc-top-border";SC.BORDER_BOTTOM="sc-bottom-border";SC.BORDER_NONE=null;SC.Border={borderTop:0,borderRight:0,borderBottom:0,borderLeft:0,borderStyle:SC.BORDER_GRAY,hasBorder:YES,displayProperties:["borderStyle"],_BORDER_REGEXP:(/-border$/),initMixin:function(){this._sc_border_borderStyleDidChange();this._sc_border_borderDimensionsDidChange()},renderMixin:function(a,c){var b=this.get("borderStyle");if(b){if(this._BORDER_REGEXP.exec(b)){a.addClass(b)}else{a.addStyle("border","1px "+b+" solid")}}},_sc_border_borderStyleDidChange:function(){var a=this.get("borderStyle"),b=SC.Border.dimensions[a];if(b){this.beginPropertyChanges();this.set("borderTop",b);this.set("borderRight",b);this.set("borderBottom",b);this.set("borderLeft",b);this.endPropertyChanges()}},_sc_border_borderDimensionsDidChange:function(){var d=this.get("borderTop"),a=this.get("borderRight"),b=this.get("borderBottom"),c=this.get("borderLeft");this.adjust({borderTop:d,borderRight:a,borderBottom:b,borderLeft:c})}.observes("borderTop","borderRight","borderBottom","borderLeft")};SC.mixin(SC.Border,{dimensions:{"sc-bezel-border":1,"sc-black-border":1,"sc-gray-border":1,"sc-top-border":1,"sc-bottom-border":1}});SC.CollectionFastPath={initMixin:function(){this._indexMap={};this._viewMap={}},poolForExampleView:function(a){var b="_pool_"+SC.guidFor(a);if(!this[b]){this[b]=[]}return this[b]},createItemViewFromExampleView:function(c,b){var a=this.createItemView(c,null,b);if(a.isPoolable){a.owningPool=this.poolForExampleView(c)}a.createdFromExampleView=c;return a},configureItemView:function(b,a){b.beginPropertyChanges();b.setIfChanged("content",a.content);b.setIfChanged("contentIndex",a.contentIndex);b.setIfChanged("parentView",a.parentView);b.setIfChanged("layerId",a.layerId);b.setIfChanged("isEnabled",a.isEnabled);b.setIfChanged("isSelected",a.isSelected);b.setIfChanged("outlineLevel",a.outlineLevel);b.setIfChanged("layout",a.layout);b.setIfChanged("disclosureState",a.disclosureState);b.setIfChanged("isVisibleInWindow",a.isVisibleInWindow);b.setIfChanged("isGroupView",a.isGroupView);b.setIfChanged("page",this.page);b.endPropertyChanges()},wakePooledView:function(b,a){this.configureItemView(b,a);if(b.awakeFromPool){b.awakeFromPool(b.owningPool,this)}},allocateItemView:function(d,b){var a;if(d.prototype.isPoolable){var c=this.poolForExampleView(d);if(c.length>0){a=c.pop();this.wakePooledView(a,b)}}if(!a){a=this.createItemViewFromExampleView(d,b)}return a},releaseItemView:function(b){if(!b.isPoolable){b.destroy();return}var a=b.owningPool;a.push(b);if(b.hibernateInPool){b.hibernateInPool(a,this)}},contentIndexIsGroup:function(a,d,c){var f=this.get("contentDelegate");var b=this.get("_contentGroupIndexes"),g=NO;g=b&&b.contains(c);if(g){g=f.contentIndexIsGroup(this,this.get("content"),c)}return g},exampleViewForItem:function(g,d){var b=this.get("contentDelegate"),c=this.get("_contentGroupIndexes"),f,a,h=this.contentIndexIsGroup(this,this.get("content"),d);if(h){f=this.get("contentGroupExampleViewKey");if(f&&g){a=g.get(f)}if(!a){a=this.get("groupExampleView")||this.get("exampleView")}}else{f=this.get("contentExampleViewKey");if(f&&g){a=g.get(f)}if(!a){a=this.get("exampleView")}}return a},setAttributesForItem:function(g,d,c){var b=this.get("contentDelegate"),h=this.contentIndexIsGroup(this,this.get("content"),d),a=this.exampleViewForItem(g,d),f=this.get("content");c.createdFromExampleView=a;c.parentView=this.get("containerView")||this;c.contentIndex=d;c.owner=c.displayDelegate=this;c.content=g;c.page=this.page;c.layerId=this.layerIdFor(d);c.isEnabled=b.contentIndexIsEnabled(this,f,d);c.isSelected=b.contentIndexIsSelected(this,f,d);c.outlineLevel=b.contentIndexOutlineLevel(this,f,d);c.disclosureState=b.contentIndexDisclosureState(this,f,d);c.isVisibleInWindow=this.get("isVisibleInWindow");c.isGroupView=h;c.layout=this.layoutForContentIndex(d);if(!c.layout){c.layout=a.prototype.layout}},mappedViewsForItem:function(a,b){if(!b){b=this._viewMap}return b[SC.guidFor(a)]},mappedViewForItem:function(c,b,d){if(!d){d=this._viewMap}var a=d[SC.guidFor(c)];if(!a){return undefined}return a[b]},mapView:function(f,c,b,h){if(!h){h=this._viewMap}var d=SC.guidFor(f),a=h[d];if(!a){a=h[d]={_length:0}}a[c]=b;a._length++},unmapView:function(f,c,h){if(!h){h=this._viewMap}var d=SC.guidFor(f),a=h[d];if(!a){return}if(a[c]){var b=a[c];delete a[c];a._length--;if(a._length<=0){delete h[d]}}},itemViewForContentIndex:function(b){var d=this.get("content");if(!d){return}var c=d.objectAt(b);var f=this.exampleViewForItem(c,b),a=this._indexMap[b];if(a&&a.createdFromExampleView!==f){this.removeItemView(a);this.unmapView(c,b);a=null}if(!a){a=this.addItemView(f,c,b)}return a},nearestMappedViewIndexForItem:function(f,c,g){var b=this.mappedViewsForItem(f,g);if(!b){return null}var d=null,i=-1,h=0;for(var a in b){a=parseInt(a,10);if(isNaN(a)){continue}h=Math.abs(c-a);if(i<0||h<i){i=h;d=a}}return d},remapItemViews:function(b){var k=this._viewMap,a=(this._viewMap={}),j=(this._indexMap={}),l=[],i=this.get("content"),o;if(!i){return}var g=this._itemsToAdd;b.forEach(function(p){o=i.objectAt(p);var r=this.mappedViewsForItem(o,k);if(r){if(r[p]){var q=r[p];this.unmapView(o,p,k);this.mapView(o,p,q,a);j[p]=q}else{l.push(p)}}else{g.push(p)}},this);for(var n=0,h=l.length;n<h;n++){var m=l[n];o=i.objectAt(m);var f=this.nearestMappedViewIndexForItem(o,m,k),c;if(!SC.none(f)){c=this.mappedViewForItem(o,f,k);var d=this.exampleViewForItem(o,m);if(d===c.createdFromExampleView){this.unmapView(o,f,k);this.mapView(o,m,c,a);j[m]=c}else{g.push(m)}}else{g.push(m)}}return k},reloadIfNeeded:function(g,b){var d=this.get("content"),f;if(!g||!g.isIndexSet){g=this.get("nowShowing")}if(!b){f=this._invalidIndexes;if(!f||!this.get("isVisibleInWindow")){return this}this._invalidIndexes=NO;if(f.isIndexSet&&f.contains(g)){f=YES}if(this.willReload){this.willReload(f===YES?null:f)}}var h=this._itemsToAdd||(this._itemsToAdd=[]);var a=this.remapItemViews(g);this.processRemovals(a);if(f){this.processUpdates(f===YES?g:f)}this.processAdds();if(!b){this.clearDOMPools()}h.length=0;if(!b){var c=this.computeLayout();if(c){this.adjust(c)}if(this.didReload){this.didReload(f===YES?null:f)}}return this},processRemovals:function(c){var g=this.get("content");for(var d in c){var b=c[d];for(var f in b){f=parseInt(f,10);if(isNaN(f)){continue}var a=b[f];if(this._indexMap[f]===a){delete this._indexMap[f]}a._isInCollection=NO;this.removeItemView(a)}}},processUpdates:function(f){var b=this._itemsToUpdate,d=this.get("content"),c,a;f.forEach(function(g){c=d.objectAt(g);if(a=this.mappedViewForItem(c,g)){if(!a._isInCollection){return}var h=this.exampleViewForItem(c,g);this.updateItemView(a,h,c,g)}},this)},processAdds:function(){var g=this.get("content");var h=this._itemsToAdd,b,a=h.length,f,d;for(b=0;b<a;b++){f=h[b];d=g.objectAt(f);var i=this.exampleViewForItem(d,f);var c=this.addItemView(i,d,f)}},clearDOMPools:function(){var a=this._domPools||(this._domPools={});for(var b in a){this.clearDOMPool(a[b])}},domPoolSize:10,clearDOMPool:function(c){var b,a=c.length,d;for(b=this.domPoolSize;b<a;b++){d=c[b];this.removeChild(d);this.releaseItemView(d)}c.length=Math.min(c.length,this.domPoolSize)},domPoolForExampleView:function(d){var c=this._domPools||(this._domPools={}),a=SC.guidFor(d);var b=c[a];if(!b){b=c[a]=[]}return b},itemFromDOMPool:function(c){var b=this.domPoolForExampleView(c);if(b.length<1){return null}var a=b.shift();if(a.wakeFromDOMPool){a.wakeFromDOMPool()}return a},sendToDOMPool:function(a){var b=this.domPoolForExampleView(a.createdFromExampleView);b.push(a);var c=a.get("frame");a.adjust({top:-c.height});a.set("layerId",SC.guidFor(a));if(a.sleepInDOMPool){a.sleepInDOMPool()}},addItemView:function(f,d,c){var a,b=this._TMP_ATTRS||(this._TMP_ATTRS={});this.setAttributesForItem(d,c,b);if(a=this.itemFromDOMPool(f)){this.configureItemView(a,b);a._isInCollection=YES;this.mapView(d,c,a);this._indexMap[c]=a;return a}a=this.allocateItemView(f,b);this.appendChild(a);a._isInCollection=YES;this.mapView(d,c,a);this._indexMap[c]=a;return a},removeItemView:function(a){if(a.get("layerIsCacheable")){this.sendToDOMPool(a)}else{this.removeChild(a)}a._isInCollection=NO},updateItemView:function(d,f,c,b){if(!d.get("layerIsCacheable")||d.createdFromExampleView!==f){this.unmapView(d,b);delete this._indexMap[b];this.removeItemView(d,c,b);var g=this.addItemView(f,c,b)}else{var a=this._TMP_ATTRS||(this._TMP_ATTRS={});this.setAttributesForItem(c,b,a);this.configureItemView(d,a)}},_lastTopUpdate:0,_lastLeftUpdate:0,_tolerance:100,touchScrollDidChange:function(h,g){if(Date.now()-this._lastTouchScrollTime<25){return}var i=this.get("clippingFrame");var f=this._inScrollClippingFrame||(this._inScrollClippingFrame={x:0,y:0,width:0,height:0});f.x=i.x;f.y=i.y;f.width=i.width;f.height=i.height;f.x=h;f.y=g;var d=this.contentIndexesInRect(f);if(!d){return}var b=this.get("length"),a=d.get("max"),c=d.get("min");if(a>b||c<0){d=d.copy();d.remove(b,a-b).remove(c,0-c).freeze()}if(this._lastNowShowing){if(d.contains(this._lastNowShowing)&&this._lastNowShowing.contains(d)){return}}this._lastNowShowing=d;this.reloadIfNeeded(d,YES);this._lastTouchScrollTime=Date.now()}};SC.CollectionGroup={classNames:["sc-collection-group"]};SC.CollectionRowDelegate={isCollectionRowDelegate:YES,itemHeight:24,rowSpacing:0,rowPadding:0,rowHeight:function(b,c){var a=this.get("rowPadding");var d=this.get("itemHeight");if(c!==undefined){this.set("itemHeight",c-a*2);return c}return d+a*2}.property("itemHeight","rowPadding"),customRowHeightIndexes:null,contentIndexRowHeight:function(a,b,c){return this.get("rowHeight")}};SC.CollectionViewDelegate={isCollectionViewDelegate:YES,collectionViewSelectionForProposedSelection:function(a,b){return b},collectionViewShouldSelectIndexes:function(a,b,c){return b},collectionViewShouldDeselectIndexes:function(a,b){return b},collectionViewShouldDeleteIndexes:function(a,b){return b},collectionViewDeleteContent:function(a,c,b){if(!c){return NO}if(SC.typeOf(c.destroyAt)===SC.T_FUNCTION){c.destroyAt(b);a.selectPreviousItem(NO,1);return YES}else{if(SC.typeOf(c.removeAt)===SC.T_FUNCTION){c.removeAt(b);a.selectPreviousItem(NO,1);return YES}else{return NO}}},collectionViewShouldBeginDrag:function(a){return YES},collectionViewDragDataTypes:function(a){return[]},collectionViewDragDataForType:function(a,c,b){return null},collectionViewComputeDragOperations:function(a,b,c){return c},collectionViewValidateDragOperation:function(b,d,f,c,a){return(a&SC.DROP_ON)?SC.DRAG_NONE:f},collectionViewPerformDragOperation:function(b,d,f,c,a){return SC.DRAG_NONE},collectionViewDragViewFor:function(a,b){return null},ghostActsLikeCursor:NO};SC.NavigationBuilder={isNavigationBuilder:YES,navigationTransitions:NO,initMixin:function(){var b=SC.Animatable;if(b&&!this.isAnimatable){this.mixin(b)}else{if(!b){SC.Logger.error("SC.NavigationView and SC.NavigationBuilder require SC.Animatable to perform animations, but it is not present. Please ensure your app or framework references it.")}}var a=this.get("navigationTransitions");if(!a&&SC.Animatable){a={left:{duration:0.25,timing:SC.Animatable.TRANSITION_EASE_IN_OUT,action:"navigationBuildDidFinish"},transform:{duration:0.25,timing:SC.Animatable.TRANSITION_EASE_IN_OUT,action:"navigationBuildDidFinish"}}}if(SC.Animatable){SC.mixin(this.transitions,a)}},metrics:function(){var a=this.computeFrameWithParentFrame();return a},transform:function(a){if(SC.platform.supportsCSS3DTransforms){this.adjust("transform","translate3d("+a+"px,0px,0px)")}else{this.adjust("transform","translate("+a+"px,0px)")}},buildInNavigation:function(){var a=this.metrics();this.disableAnimation();this.transform(this.get("buildDirection")===SC.TO_LEFT?a.width:-a.width);this.enableAnimation();this.invokeLater("transform",10,0)},buildOutNavigation:function(){var a=this.metrics();this.transform(this.get("buildDirection")===SC.TO_LEFT?-a.width:a.width)},buildIn:function(){this.buildInNavigation()},buildOut:function(){this.buildOutNavigation()},resetBuild:function(){this.transform(0)},navigationBuildDidFinish:function(){if(this.isBuildingIn){this.buildInDidFinish()}else{if(this.isBuildingOut){this.buildOutDidFinish()}}}};SC.Scrollable={isScrollable:true,verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("innerFrame").height}.property("innerFrame"),horizontalPageScroll:function(){return this.get("innerFrame").width}.property("innerFrame"),hasVerticalScroller:function(){return this.get("scrollFrame").height>this.get("innerFrame").height}.property("scrollFrame"),hasHorizontalScroller:function(){return this.get("scrollFrame").width>this.get("innerFrame").width}.property("scrollFrame"),scrollBy:function(a){var b=this.get("scrollFrame");var c=this.get("innerFrame");if(!this.get("hasVerticalScroller")){a.y=0}if(b.height<=c.height){a.y=0}if(!this.get("hasHorizontalScroller")){a.x=0}if(b.width<=c.width){a.x=0}var d={x:b.x-(a.x||0),y:b.y-(a.y||0)};this.set("scrollFrame",d);d=this.get("scrollFrame");return{x:d.x-b.x,y:d.y-b.y}},scrollTo:function(a,b){this.set("scrollFrame",{x:0-a,y:0-b})},scrollToVisible:function(b){var g=this.get("innerFrame");var d=this.get("scrollFrame");var a=this.convertFrameFromView(b.get("frame"),b);a.x-=(g.x+d.x);a.y-=(g.y+d.y);var c={x:0-d.x,y:0-d.y,width:g.width,height:g.height};c.y-=Math.max(0,SC.minY(c)-SC.minY(a));c.x-=Math.max(0,SC.minX(c)-SC.minX(a));c.y+=Math.max(0,SC.maxY(a)-SC.maxY(c));c.x+=Math.max(0,SC.maxX(a)-SC.maxX(c));this.scrollTo(c.x,c.y)},scrollDownLine:function(a){if(a===undefined){a=1}return this.scrollBy({y:this.get("verticalLineScroll")*a}).y},scrollUpLine:function(a){if(a===undefined){a=1}return 0-this.scrollBy({y:0-this.get("verticalLineScroll")*a}).y},scrollRightLine:function(a){if(a===undefined){a=1}return this.scrollTo({y:this.get("horizontalLineScroll")*a}).x},scrollLeftLine:function(a){if(a===undefined){a=1}return 0-this.scrollTo({y:0-this.get("horizontalLineScroll")*a}).x},scrollDownPage:function(a){if(a===undefined){a=1}return this.scrollBy({y:this.get("verticalPageScroll")*a}).y},scrollUpPage:function(a){if(a===undefined){a=1}return 0-this.scrollBy({y:0-this.get("verticalPageScroll")*a}).y},scrollRightPage:function(a){if(a===undefined){a=1}return this.scrollTo({y:this.get("horizontalPageScroll")*a}).x},scrollLeftPage:function(a){if(a===undefined){a=1}return 0-this.scrollTo({y:0-this.get("horizontalPageScroll")*a}).x}};SC.ModalPane=SC.Pane.extend({classNames:"sc-modal",_openPaneCount:0,paneWillAppend:function(f){var d;this._openPaneCount++;if(!this.get("isVisibleInWindow")){this.append()}var c=SC.RootResponder.responder.panes;for(var b=0,a=c.length;b<a;b++){d=c[b];if(d!==f){this._hideShowTextfields(d,NO)}}return this},paneDidRemove:function(f){var d;this._openPaneCount--;var c=SC.RootResponder.responder.panes;for(var b=0,a=c.length;b<a;b++){d=c[b];if(d!==f){this._hideShowTextfields(d,YES)}}if(this._openPaneCount<=0){this._openPaneCount=0;if(this.get("isVisibleInWindow")){this.remove()}}},_hideShowTextfields:function(c,b){var a;for(a in SC.View.views){a=SC.View.views[a];if(a!==c&&a.get("pane")===c&&a.get("isTextField")){if(b){if(a._scmp_isBrowserFocusable!==undefined){b=a._scmp_isBrowserFocusable;delete a._scmp_isBrowserFocusable}}else{a._scmp_isBrowserFocusable=a.get("isBrowserFocusable")}a.set("isBrowserFocusable",b)}}},mouseDown:function(b){var a=this.get("owner");if(a&&a.modalPaneDidClick){a.modalPaneDidClick(b)}},touchStart:function(a){this.mouseDown(a)}});sc_require("panes/modal");SC.PanelPane=SC.Pane.extend({isPanelPane:YES,classNames:["sc-panel"],acceptsKeyPane:YES,ariaRole:"dialog",ariaLabel:null,ariaLabelledBy:null,ariaDescribedBy:null,isModal:YES,modalPane:SC.ModalPane.extend({classNames:"for-sc-panel"}),contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(a){this.removeAllChildren();if(a){this.appendChild(a)}},createChildViews:function(){var a=this.contentView;if(a){a=this.contentView=this.createChildView(a);this.childViews=[a]}},contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView"),renderDelegateName:"panelRenderDelegate",_modalPane:function(){var a=this.get("modalPane");if(a&&a.isClass){a=a.create({owner:this});this.set("modalPane",a)}return a},appendTo:function(a){var b;if(!this.get("isVisibleInWindow")&&this.get("isModal")&&(b=this._modalPane())){this._isShowingModal=YES;b.paneWillAppend(this)}return arguments.callee.base.apply(this,arguments)},remove:function(){var b,a=arguments.callee.base.apply(this,arguments);if(this._isShowingModal){this._isShowingModal=NO;if(b=this._modalPane()){b.paneDidRemove(this)}}return a},destroy:function(){var a=this.get("modalPane");if(a&&!a.isClass){a.destroy()}arguments.callee.base.apply(this,arguments)},_isModalDidChange:function(){var b,a=this.get("isModal");if(a){if(!this._isShowingModal&&this.get("isVisibleInWindow")&&(b=this._modalPane())){this._isShowingModal=YES;b.paneWillAppend(this)}}else{if(this._isShowingModal&&(b=this._modalPane())){this._isShowingModal=NO;b.paneDidRemove(this)}}}.observes("isModal"),paneDidAttach:function(){var a=arguments.callee.base.apply(this,arguments);this.becomeKeyPane();return a},displayProperties:["ariaLabel","ariaLabelledBy","ariaDescribedBy"]});SC.TOGGLE_BEHAVIOR="toggle";SC.PUSH_BEHAVIOR="push";SC.TOGGLE_ON_BEHAVIOR="on";SC.TOGGLE_OFF_BEHAVIOR="off";SC.HOLD_BEHAVIOR="hold";SC.ButtonView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),classNames:["sc-button-view"],themeName:"square",value:null,toggleOnValue:YES,toggleOffValue:NO,localize:NO,localizeBindingDefault:SC.Binding.bool(),title:"",tooltip:"",contentTitleKey:null,icon:null,contentIconKey:null,needsEllipsis:YES,displayTitle:function(){var a=this.get("title");return(a&&this.get("localize"))?SC.String.loc(a):(a||"")}.property("title","localize").cacheable(),keyEquivalent:null,buttonBehavior:SC.PUSH_BEHAVIOR,holdInterval:100,isDefault:NO,isDefaultBindingDefault:SC.Binding.oneWay().bool(),isCancel:NO,isCancelBindingDefault:SC.Binding.oneWay().bool(),action:null,target:null,supportFocusRing:NO,supportsAutoResize:YES,autoResizeLayer:function(){var a=this.invokeRenderDelegateMethod("getRenderedAutoResizeLayer",this.$());return a||this.get("layer")}.property("layer").cacheable(),autoResizeText:function(){return this.get("displayTitle")}.property("displayTitle").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",10),_labelMinWidthIE7:0,triggerActionAfterDelay:function(a){if(!this.get("isEnabled")){return NO}this.set("isActive",YES);this.invokeLater("triggerAction",200,a);return YES},triggerAction:function(a){this._action(a,YES);this.didTriggerAction();this.set("isActive",NO)},didTriggerAction:function(){},init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("keyEquivalent");if(a){this._defaultKeyEquivalent=a}if(!SC.none(this.get("value"))){this._button_valueDidChange()}},ariaRole:"button",displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","escapeHTML","needsEllipsis","tooltip","supportFocusRing","buttonBehavior"],renderDelegateName:"buttonRenderDelegate",contentKeys:{contentValueKey:"value",contentTitleKey:"title",contentIconKey:"icon"},_button_displayObserver:function(){this.displayDidChange()}.observes("title","icon","value"),performKeyEquivalent:function(c,b){if(!this.get("isVisibleInWindow")){return NO}if(!this.get("isEnabled")){return NO}var a=this.get("keyEquivalent");if(a){if(a===c){return this.triggerAction(b)}}else{if((this.get("isDefault")&&(c==="return"))||(this.get("isCancel")&&(c==="escape"))){return this.triggerAction(b)}}return NO},computeIsSelectedForValue:function(d){var b=this.get("toggleOnValue"),c,a;if(SC.typeOf(d)===SC.T_ARRAY){if(d.length===1){c=(d[0]==b)}else{c=null;d.find(function(f){a=(f==b);if(c===null){c=a}else{if(a!==c){c=SC.MIXED_STATE}}return c===SC.MIXED_STATE})}}else{if(d===SC.MIXED_STATE){c=SC.MIXED_STATE}else{c=(d===b)}}return c},_button_valueDidChange:function(){var b=this.get("value"),a=this.computeIsSelectedForValue(b);this.set("isSelected",a)}.observes("value"),_button_isSelectedDidChange:function(){var c=this.get("isSelected"),b=this.computeIsSelectedForValue(this.get("value"));if((c!==SC.MIXED_STATE)&&(b!==c)){var a=(c)?"toggleOnValue":"toggleOffValue";this.set("value",this.get(a))}}.observes("isSelected"),_defaultKeyEquivalent:null,_isDefaultOrCancelDidChange:function(){var b=!!this.get("isDefault"),a=!b&&this.get("isCancel");if(b){this.set("keyEquivalent","return")}else{if(a){this.set("keyEquivalent","escape")}else{this.set("keyEquivalent",this._defaultKeyEquivalent)}}}.observes("isDefault","isCancel"),mouseDown:function(a){var b=this.get("buttonBehavior");if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;if(b===SC.HOLD_BEHAVIOR){this._action(a)}else{if(!this._isFocused&&(b!==SC.PUSH_BEHAVIOR)){this._isFocused=YES;this.becomeFirstResponder()}}return YES},mouseExited:function(a){if(this._isMouseDown){this.set("isActive",NO)}return YES},mouseEntered:function(a){if(this._isMouseDown){this.set("isActive",YES)}return YES},mouseUp:function(b){if(this._isMouseDown){this.set("isActive",NO)}this._isMouseDown=false;if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){var a=this.$().within(b.target);if(a&&this.get("isEnabled")){this._action(b)}}return YES},touchStart:function(b){var a=this.get("buttonBehavior");if(!this.get("isEnabled")){return YES}this.set("isActive",YES);if(a===SC.HOLD_BEHAVIOR){this._action(b)}else{if(!this._isFocused&&(a!==SC.PUSH_BEHAVIOR)){this._isFocused=YES;this.becomeFirstResponder()}}b.preventDefault();return YES},touchesDragged:function(a,b){if(!this.touchIsInBoundary(a)){if(!this._touch_exited){this.set("isActive",NO)}this._touch_exited=YES}else{if(this._touch_exited){this.set("isActive",YES)}this._touch_exited=NO}a.preventDefault();return YES},touchEnd:function(a){this._touch_exited=NO;this.set("isActive",NO);if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){if(this.touchIsInBoundary(a)&&this.get("isEnabled")){this._action()}}a.preventDefault();return YES},keyDown:function(b){if(!this.get("isEnabled")){return YES}if(b.which===9||b.keyCode===9){var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES}if(b.which===13||b.which===32){this.triggerActionAfterDelay(b);return YES}b.allowDefault();return NO},_action:function(a,c){switch(this.get("buttonBehavior")){case SC.TOGGLE_BEHAVIOR:var b=this.get("isSelected");if(b){this.set("value",this.get("toggleOffValue"))}else{this.set("value",this.get("toggleOnValue"))}break;case SC.TOGGLE_ON_BEHAVIOR:this.set("value",this.get("toggleOnValue"));break;case SC.TOGGLE_OFF_BEHAVIOR:this.set("value",this.get("toggleOffValue"));break;case SC.HOLD_BEHAVIOR:this._runHoldAction(a,c);break;default:this._runAction(a)}},_runAction:function(a){var c=this.get("action"),d=this.get("target")||null,b;if(c){if(c&&(SC.typeOf(c)===SC.T_FUNCTION)){this.action(a);return}else{b=this.getPath("pane.rootResponder");if(b){b.sendAction(c,d,this,this.get("pane"),null,this)}}}},_runHoldAction:function(a,b){if(this.get("isActive")){this._runAction();if(!b){SC.RunLoop.begin();this.invokeLater("_runHoldAction",this.get("holdInterval"),a);SC.RunLoop.end()}}},didBecomeKeyResponderFrom:function(a){if(!this._isFocused){this._isFocused=YES;this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$().focus()}}},willLoseKeyResponderTo:function(a){if(this._isFocused){this._isFocused=NO}},didAppendToDocument:function(){if(SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0&&this.get("useStaticLayout")){var f=this.get("layout"),d=this.$(),a=0;if(d&&d[0]&&(a=d[0].clientWidth)&&a!==0&&this._labelMinWidthIE7===0){var c=this.$(".sc-button-label"),i=parseInt(c.css("paddingRight"),0),b=parseInt(c.css("paddingLeft"),0),h=parseInt(c.css("marginRight"),0),g=parseInt(c.css("marginLeft"),0);if(h=="auto"){SC.Logger.log(h+","+g+","+i+","+b)}if(!i&&isNaN(i)){i=0}if(!b&&isNaN(b)){b=0}if(!h&&isNaN(h)){h=0}if(!g&&isNaN(g)){g=0}this._labelMinWidthIE7=a-(i+b)-(h+g);c.css("minWidth",this._labelMinWidthIE7+"px")}else{this.invokeLater(this.didAppendToDocument,1)}}}});SC.ButtonView.CLICK_AND_HOLD_DELAY=SC.browser.isIE?600:300;SC.REGULAR_BUTTON_HEIGHT=24;sc_require("panes/panel");sc_require("views/button");SC.BUTTON1_STATUS="button1";SC.BUTTON2_STATUS="button2";SC.BUTTON3_STATUS="button3";SC.AlertPane=SC.PanelPane.extend({classNames:["sc-alert"],ariaRole:"alertdialog",delegate:null,icon:"sc-icon-alert-48",message:"",ariaLabel:function(){return this.get("message")}.property("message").cacheable(),description:"",displayDescription:function(){var a=this.get("description");if(!a||a.length===0){return a}a=SC.RenderContext.escapeHTML(a);return'<p class="description">'+a.split("\n").join('</p><p class="description">')+"</p>"}.property("description").cacheable(),caption:"",displayCaption:function(){var a=this.get("caption");if(!a||a.length===0){return a}a=SC.RenderContext.escapeHTML(a);return'<p class="caption">'+a.split("\n").join('</p><p class="caption">')+"</p>"}.property("caption").cacheable(),button1:SC.outlet("contentView.childViews.1.childViews.1"),button2:SC.outlet("contentView.childViews.1.childViews.0"),button3:SC.outlet("contentView.childViews.2.childViews.0"),buttonThreeWrapper:SC.outlet("contentView.childViews.2"),layout:{top:0.3,centerX:0,width:500},contentView:SC.View.extend({useStaticLayout:YES,layout:{left:0,right:0,top:0,height:"auto"},childViews:[SC.View.extend(SC.StaticLayout,{classNames:["info"],render:function(a,c){var b=this.get("pane");if(b.get("icon")=="blank"){a.addClass("plain")}a.push('<img src="'+SC.BLANK_IMAGE_URL+'" class="icon '+b.get("icon")+'" />');a.begin("h1").attr("class","header").text(b.get("message")||"").end();a.push(b.get("displayDescription")||"");a.push(b.get("displayCaption")||"");a.push('<div class="separator"></div>')}}),SC.View.extend({layout:{bottom:13,height:24,right:18,width:466},childViews:["cancelButton","okButton"],classNames:["text-align-right"],cancelButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON2_STATUS,localize:YES,layout:{right:5,height:"auto",width:"auto",bottom:0},isCancel:YES,action:"dismiss",isVisible:NO}),okButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON1_STATUS,localize:YES,layout:{left:0,height:"auto",width:"auto",bottom:0},isDefault:YES,action:"dismiss",isVisible:NO})}),SC.View.extend({layout:{bottom:13,height:24,left:18,width:150},childViews:[SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON3_STATUS,localize:YES,layout:{left:0,height:"auto",width:"auto",bottom:0},action:"dismiss",isVisible:NO})]})]}),dismiss:function(b){var a=this.delegate,c,d,f;if(a&&a.alertPaneDidDismiss){a.alertPaneDidDismiss(this,b.get("actionKey"))}if(d=(b&&b.get("customAction"))){if(SC.typeOf(d)===SC.T_FUNCTION){d.call(d)}else{c=this.getPath("pane.rootResponder");if(c){f=b.get("customTarget");c.sendAction(d,f||a,this,this,null,this)}}}this.remove()},alertInfoDidChange:function(){var a=this.getPath("contentView.childViews.0");if(a){a.displayDidChange()}}.observes("icon","message","displayDescription","displayCaption")});SC.AlertPane.mixin({show:function(g){g=SC.AlertPane._argumentsCall.apply(this,arguments);var a=this.create(g),k=0,h=g.buttons,f,i,b,d,c;if(h){h.forEach(function(l){k++;if(!l){return}f=a.get("button%@".fmt(k));i=l.title;b=l.action;d=l.target;c=g.themeName||"capsule";f.set("title".fmt(k),i);if(b){f.set("customAction".fmt(k),b)}if(d){f.set("customTarget".fmt(k),d)}f.set("isVisible",!!i);f.set("themeName",c)})}else{f=a.get("button1");f.set("title","OK");f.set("isVisible",YES)}var j=a.append();a.adjust("height",a.childViews[0].$().height());a.updateLayout();return j},warn:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="sc-icon-alert-48";return this.show(a)},info:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="sc-icon-info-48";return this.show(a)},error:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="sc-icon-error-48";return this.show(a)},plain:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="blank";return this.show(a)},_argumentsCall:function(b){var a=b;if(SC.typeOf(b)!==SC.T_HASH){var c=this._normalizeArguments(arguments);a={message:c[0],description:c[1],caption:c[2],delegate:c[7],icon:(c[6]||"sc-icon-alert-48"),themeName:"capsule"};if(SC.typeOf(c[3])===SC.T_STRING||SC.typeOf(c[4])===SC.T_STRING||SC.typeOf(c[5])===SC.T_STRING){a.buttons=[{title:c[3]},{title:c[4]},{title:c[5]}]}}return a},_normalizeArguments:function(b){b=SC.A(b);var a=b.length,c=b[a-1];if(SC.typeOf(c)!==SC.T_STRING){b[a-1]=null}else{c=null}b[7]=c;return b}});sc_require("panes/panel");SC.PalettePane=SC.PanelPane.extend({classNames:["sc-palette"],isModal:NO,modalPane:SC.ModalPane,isAnchored:NO,_mouseOffsetX:null,_mouseOffsetY:null,mouseDown:function(a){var b=this.get("frame");this._mouseOffsetX=b?(b.x-a.pageX):0;this._mouseOffsetY=b?(b.y-a.pageY):0;return YES},mouseDragged:function(a){if(!this.isAnchored){this.set("layout",{width:this.layout.width,height:this.layout.height,left:this._mouseOffsetX+a.pageX,top:this._mouseOffsetY+a.pageY});this.updateLayout()}return YES},touchStart:function(a){return this.mouseDown(a)},touchesDragged:function(a){return this.mouseDragged(a)}});sc_require("panes/palette");SC.PICKER_MENU="menu";SC.PICKER_FIXED="fixed";SC.PICKER_POINTER="pointer";SC.PICKER_MENU_POINTER="menu-pointer";SC.POINTER_LAYOUT=["perfectRight","perfectLeft","perfectTop","perfectBottom"];SC.PickerPane=SC.PalettePane.extend({classNames:["sc-picker"],isAnchored:YES,isModal:YES,pointerPos:"perfectRight",pointerPosX:0,pointerPosY:0,anchorElement:null,anchorCached:null,preferType:null,preferMatrix:null,pointerOffset:null,extraRightOffset:0,removeTarget:null,removeAction:null,repositionOnWindowResize:YES,_anchorView:null,_anchorHTMLElement:null,popup:function(c,b,d,a){if(c){if(c.isView){this._anchorView=c;this._setupScrollObservers(c)}else{this._anchorHTMLElement=c}}this.beginPropertyChanges();if(b){this.set("preferType",b)}if(d){this.set("preferMatrix",d)}if(a){this.set("pointerOffset",a)}this.endPropertyChanges();this.positionPane();this._hideOverflow();return this.append()},positionPane:function(g){g=g&&this.get("anchorCached");var b=g?this.get("anchorCached"):this.get("anchorElement"),c=this.get("preferType"),d=this.get("preferMatrix"),f=this.get("layout"),a;if(b){if(!g){b=this.computeAnchorRect(b);this.set("anchorCached",b)}if(b.x===0&&b.y===0){return}a=SC.cloneRect(b);if(c){switch(c){case SC.PICKER_MENU:case SC.PICKER_FIXED:if(!d||d.length!==3){this.set("preferMatrix",[1,4,3])}a.x+=((this.preferMatrix[2]===0)?a.width:0)+this.preferMatrix[0];a.y+=((this.preferMatrix[2]===3)?a.height:0)+this.preferMatrix[1];break;default:a.y+=a.height;break}}else{a.y+=a.height}a=this.fitPositionToScreen(a,this.get("frame"),b);this.adjust({width:a.width,height:a.height,left:a.x,top:a.y})}else{this.adjust({width:f.width,height:f.height,centerX:0,centerY:0})}this.updateLayout();return this},computeAnchorRect:function(c){var f,b,d,a=SC.RootResponder.responder.computeWindowSize();if(c.getBoundingClientRect){f=c.getBoundingClientRect();b={x:f.left,y:f.top,width:f.width,height:f.height};if(b.width===undefined||b.height===undefined){d=SC.$(c);b.width=d.outerWidth();b.height=d.outerHeight()}}else{b=SC.offset(c);d=SC.$(c);b.width=d.outerWidth();b.height=d.outerHeight()}b.height=(a.height-b.y)<b.height?(a.height-b.y):b.height;if(!SC.browser.isIE&&window.scrollX>0||window.scrollY>0){b.x+=window.scrollX;b.y+=window.scrollY}else{if(SC.browser.isIE&&(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)){b.x+=document.documentElement.scrollLeft;b.y+=document.documentElement.scrollTop}}return b},fitPositionToScreen:function(i,c,b){var a=SC.RootResponder.responder.computeWindowSize(),h={x:0,y:0,width:a.width,height:a.height};var d=SC.RootResponder.responder.mainPane;if(d){var f=d.layout.minWidth,g=d.layout.minHeight;if(f&&h.width<f){h.width=d.layout.minWidth}if(g&&h.height<g){h.height=d.layout.minHeight}}c.x=i.x;c.y=i.y;if(this.preferType){switch(this.preferType){case SC.PICKER_MENU:c=this.fitPositionToScreenMenu(h,c,this.get("isSubMenu"));break;case SC.PICKER_MENU_POINTER:this.setupPointer(b);c=this.fitPositionToScreenMenuPointer(h,c,b);break;case SC.PICKER_POINTER:this.setupPointer(b);c=this.fitPositionToScreenPointer(h,c,b);break;case SC.PICKER_FIXED:break;default:break}}else{c=this.fitPositionToScreenDefault(h,c,b)}this.displayDidChange();return c},fitPositionToScreenDefault:function(c,d,b){if(SC.maxX(d)>c.width){var g=Math.max(SC.maxX(b),d.width);d.x=Math.min(g,c.width)-d.width}if(SC.minX(d)<0){d.x=SC.minX(Math.max(b,0));if(SC.maxX(d)>c.width){d.x=Math.max(0,c.width-d.width)}}if(SC.maxY(d)>c.height){g=Math.max((b.y-d.height),0);if(g>c.height){d.y=Math.max(0,c.height-d.height)}else{d.y=g}}if(SC.minY(d)<0){g=Math.min(SC.maxY(b),(c.height-b.height));d.y=Math.max(g,0)}return d},fitPositionToScreenMenu:function(c,b,a){if(a){b.x-=this.get("submenuOffsetX");b.y-=Math.floor(this.get("menuHeightPadding")/2)}if((b.x+b.width)>(c.width-20)){if(a){b.x=b.x-(b.width*2)}else{b.x=c.width-b.width-20}}if(b.x<7){b.x=7}if(b.y<7){b.height+=b.y;b.y=7}if(b.height+b.y+35>=c.height){if(b.height+50>=c.height){b.y=SC.MenuPane.VERTICAL_OFFSET;b.height=c.height-(SC.MenuPane.VERTICAL_OFFSET*2)}else{b.y+=(c.height-(b.height+b.y+35))}}return b},fitPositionToScreenMenuPointer:function(c,d,b){d=this.fitPositionToScreenPointer(c,d,b);if(d.height+d.y+35>=c.height){d.height=c.height-d.y-(SC.MenuPane.VERTICAL_OFFSET*2)}return d},fitPositionToScreenPointer:function(p,n,o){var j=[this.pointerOffset[0],this.pointerOffset[1],this.pointerOffset[2],this.pointerOffset[3]];var g=[[o.x+o.width+j[0],o.y+parseInt(o.height/2,0)-40],[o.x-n.width+j[1],o.y+parseInt(o.height/2,0)-40],[o.x+parseInt((o.width/2)-(n.width/2),0),o.y-n.height+j[2]],[o.x+parseInt((o.width/2)-(n.width/2),0),o.y+o.height+j[3]]];var c=[[o.x+o.width+n.width+j[0],o.y+parseInt(o.height/2,0)+n.height-24],[o.x+j[1],o.y+parseInt(o.height/2,0)+n.height-24],[o.x+parseInt((o.width/2)-(n.width/2),0)+n.width,o.y+j[2]],[o.x+parseInt((o.width/2)-(n.width/2),0)+n.width,o.y+o.height+n.height+j[3]]];var h=[[g[0][1]>0?0:0-g[0][1],c[0][0]<p.width?0:c[0][0]-p.width,c[0][1]<p.height?0:c[0][1]-p.height,g[0][0]>0?0:0-g[0][0]],[g[1][1]>0?0:0-g[1][1],c[1][0]<p.width?0:c[1][0]-p.width,c[1][1]<p.height?0:c[1][1]-p.height,g[1][0]>0?0:0-g[1][0]],[g[2][1]>0?0:0-g[2][1],c[2][0]<p.width?0:c[2][0]-p.width,c[2][1]<p.height?0:c[2][1]-p.height,g[2][0]>0?0:0-g[2][0]],[g[3][1]>0?0:0-g[3][1],c[3][0]<p.width?0:c[3][0]-p.width,c[3][1]<p.height?0:c[3][1]-p.height,g[3][0]>0?0:0-g[3][0]]];var d=this.preferMatrix;if(d[4]===-1){n.x=o.x+parseInt(o.width/2,0);n.y=o.y+parseInt(o.height/2,0)-parseInt(n.height/2,0);this.set("pointerPos",SC.POINTER_LAYOUT[0]+" fallback");this.set("pointerPosY",parseInt(n.height/2,0)-40)}else{n.x=g[d[4]][0];n.y=g[d[4]][1];this.set("pointerPos",SC.POINTER_LAYOUT[d[4]]);this.set("pointerPosY",0)}this.set("pointerPosX",0);for(var k=0,b,l=SC.POINTER_LAYOUT.length;k<l;k++){b=d[k];if(h[b][0]===0&&h[b][1]===0&&h[b][2]===0&&h[b][3]===0){if(d[4]!==b){n.x=g[b][0];n.y=g[b][1];this.set("pointerPosY",0);this.set("pointerPos",SC.POINTER_LAYOUT[b])}k=SC.POINTER_LAYOUT.length}else{if((b===0||b===1)&&h[b][0]===0&&h[b][1]===0&&h[b][2]<n.height-91&&h[b][3]===0){if(d[4]!==b){n.x=g[b][0];this.set("pointerPos",SC.POINTER_LAYOUT[b])}n.y=g[b][1]-h[b][2];this.set("pointerPosY",h[b][2]);k=SC.POINTER_LAYOUT.length}else{if((b===0||b===1)&&h[b][0]===0&&h[b][1]===0&&h[b][2]<=n.height-51&&h[b][3]===0){if(d[4]!==b){n.x=g[b][0]}n.y=g[b][1]-(n.height-51);this.set("pointerPosY",(n.height-53));this.set("pointerPos",SC.POINTER_LAYOUT[b]+" extra-low");k=SC.POINTER_LAYOUT.length}else{if((b===2||b===3)&&h[b][0]===0&&h[b][1]<=parseInt(n.width/2,0)-this.get("extraRightOffset")&&h[b][2]===0&&h[b][3]===0){if(d[4]!==b){n.y=g[b][1]}n.x=g[b][0]-(parseInt(n.width/2,0)-this.get("extraRightOffset"));this.set("pointerPos",SC.POINTER_LAYOUT[b]+" extra-right");k=SC.POINTER_LAYOUT.length}else{if((b===2||b===3)&&h[b][0]===0&&h[b][1]===0&&h[b][2]===0&&h[b][3]<=parseInt(n.width/2,0)-this.get("extraRightOffset")){if(d[4]!==b){n.y=g[b][1]}n.x=g[b][0]+(parseInt(n.width/2,0)-this.get("extraRightOffset"));this.set("pointerPos",SC.POINTER_LAYOUT[b]+" extra-left");k=SC.POINTER_LAYOUT.length}}}}}}return n},setupPointer:function(g){var h=this.pointerOffset,f=SC.PickerPane;if(!h||h.length!==4){if(this.get("preferType")==SC.PICKER_MENU_POINTER){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("pointerOffset",f.TINY_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",f.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.SMALL_CONTROL_SIZE:this.set("pointerOffset",f.SMALL_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",f.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.REGULAR_CONTROL_SIZE:this.set("pointerOffset",f.REGULAR_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",f.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.LARGE_CONTROL_SIZE:this.set("pointerOffset",f.LARGE_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",f.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.HUGE_CONTROL_SIZE:this.set("pointerOffset",f.HUGE_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",f.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET);break}}else{var d=(g.width<16)?((g.width<4)?9:6):0,b=(g.height<16)?((g.height<4)?9:6):0,c=f.PICKER_POINTER_OFFSET;var i=[c[0]+d,c[1]-d,c[2]-b,c[3]+b];this.set("pointerOffset",i);this.set("extraRightOffset",f.PICKER_EXTRA_RIGHT_OFFSET)}}if(!this.preferMatrix||this.preferMatrix.length!==5){this.set("preferMatrix",this.get("preferType")===SC.PICKER_MENU_POINTER?[3,2,1,0,3]:[0,1,2,3,2])}},displayProperties:["preferType","pointerPos","pointerPosY"],renderDelegateName:"pickerRenderDelegate",modalPaneDidClick:function(a){var d=this.get("frame"),g=this.get("removeTarget")||null,c=this.get("removeAction"),b=this.get("rootResponder");if(!this.clickInside(d,a)){if(c){b.sendAction(c,g,this,this,null,this)}else{this.remove()}return YES}return NO},mouseDown:function(a){return this.modalPaneDidClick(a)},clickInside:function(b,a){return SC.pointInRect({x:a.pageX,y:a.pageY},b)},windowSizeDidChange:function(b,a){if(this.repositionOnWindowResize){this.positionPane()}},remove:function(){if(this.get("isVisibleInWindow")&&this.get("isPaneAttached")){this._withdrawOverflowRequest()}this._removeScrollObservers();return arguments.callee.base.apply(this,arguments)},anchorElement:function(a,b){var c;if(b===undefined){c=this._anchorView;return c?c.get("layer"):this._anchorHTMLElement}else{if(!b){throw"You must set 'anchorElement' to either a view or a DOM element"}else{if(b.isView){this._anchorView=b;this._anchorHTMLElement=null}else{this._anchorView=null;this._anchorHTMLElement=b}}}}.property("layer").cacheable(),_hideOverflow:function(){var b=SC.$(document.body),a=SC.$(".sc-main"),d=parseInt(a.css("minWidth"),0),f=parseInt(a.css("minHeight"),0),c=SC.RootResponder.responder.get("currentWindowSize");if(c.width>=d&&c.height>=f){SC.bodyOverflowArbitrator.requestHidden(this)}},_withdrawOverflowRequest:function(){SC.bodyOverflowArbitrator.withdrawRequest(this)},_getScrollViewOfView:function(b){var a=b;while(YES){if(!a){return null}if(a.isScrollable){return a}a=a.get("parentView")}},_setupScrollObservers:function(b){var a=this._getScrollViewOfView(b);if(a){a.addObserver("horizontalScrollOffset",this,this._scrollOffsetDidChange);a.addObserver("verticalScrollOffset",this,this._scrollOffsetDidChange);this._scrollView=a}},_removeScrollObservers:function(){var a=this._scrollView;if(a){a.removeObserver("horizontalScrollOffset",this,this._scrollOffsetDidChange);a.removeObserver("verticalScrollOffset",this,this._scrollOffsetDidChange)}},_scrollOffsetDidChange:function(){this.positionPane()}});SC.PickerPane.PICKER_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.PICKER_EXTRA_RIGHT_OFFSET=20;SC.PickerPane.TINY_PICKER_MENU_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;SC.PickerPane.SMALL_PICKER_MENU_POINTER_OFFSET=[9,-9,-8,8];SC.PickerPane.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET=11;SC.PickerPane.REGULAR_PICKER_MENU_POINTER_OFFSET=[9,-9,-12,12];SC.PickerPane.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;SC.PickerPane.LARGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-16,16];SC.PickerPane.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=17;SC.PickerPane.HUGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;SC.SeparatorView=SC.View.extend({classNames:["sc-separator-view"],tagName:"span",layoutDirection:SC.LAYOUT_HORIZONTAL,render:function(a,b){if(b){a.push("<span></span>")}a.addClass(this.get("layoutDirection"))}});sc_require("views/button");sc_require("views/separator");SC.MenuItemView=SC.View.extend(SC.ContentDisplay,{classNames:["sc-menu-item"],displayProperties:["title","isEnabled","isSeparator","isChecked"],ariaRole:"menuitem",escapeHTML:YES,acceptsFirstResponder:YES,blocksIEDeactivate:YES,isContextMenuEnabled:NO,content:null,isSeparator:function(){return this.getContentProperty("itemSeparatorKey")===YES}.property("content").cacheable(),isEnabled:function(){return this.getContentProperty("itemIsEnabledKey")!==NO&&this.getContentProperty("itemSeparatorKey")!==YES}.property("content.isEnabled").cacheable(),isChecked:function(){return this.getContentProperty("itemCheckboxKey")}.property(),subMenu:function(){var c=this.get("content"),b,a;if(!c){return null}a=this.get("parentMenu");b=c.get(a.itemSubMenuKey);if(b){if(SC.kindOf(b,SC.MenuPane)){b.set("isModal",NO);b.set("isSubMenu",YES);b.set("parentMenu",a);return b}else{return SC.MenuPane.create({layout:{width:200},items:b,isModal:NO,isSubMenu:YES,parentMenu:a,controlSize:a.get("controlSize"),exampleView:a.get("exampleView")})}}return null}.property("content").cacheable(),hasSubMenu:function(){return !!this.get("subMenu")}.property("subMenu").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);this.contentDidChange()},render:function(b,i){var c=this.get("content"),a,g,f=this.get("parentMenu"),d=this.get("itemWidth")||f.layout.width,h=this.get("itemHeight")||SC.DEFAULT_MENU_ITEM_HEIGHT;this.set("itemWidth",d);this.set("itemHeight",h);if(this.get("isSeparator")){b.attr("role","separator")}else{if(this.get("isChecked")){b.attr("role","menuitemcheckbox");b.attr("aria-checked",true)}}b=b.begin("a").addClass("menu-item");if(this.get("isSeparator")){b.push('<span class="separator"></span>');b.addClass("disabled")}else{g=c.get(f.itemIconKey);if(g){this.renderImage(b,g);b.addClass("has-icon")}g=this.get("title");if(SC.typeOf(g)!==SC.T_STRING){g=g.toString()}this.renderLabel(b,g);if(this.get("isChecked")){b.push('<div class="checkbox"></div>')}if(this.get("hasSubMenu")){this.renderBranch(b)}g=this.getContentProperty("itemShortCutKey");if(g){this.renderShortcut(b,g)}}b=b.end()},renderImage:function(b,d){var a,c;if(d&&SC.ImageView.valueIsUrl(d)){a=d;c=""}else{c=d;a=SC.BLANK_IMAGE_URL}b.begin("img").addClass("image").addClass(c).attr("src",a).end()},renderLabel:function(b,a){if(this.get("escapeHTML")){a=SC.RenderContext.escapeHTML(a)}b.push("<span class='value ellipsis'>"+a+"</span>")},renderBranch:function(a){a.push('<span class="has-branch"></span>')},renderShortcut:function(b,a){b.push('<span class = "shortcut">'+a+"</span>")},showSubMenu:function(){var a=this.get("subMenu");if(a){a.set("mouseHasEntered",NO);a.popup(this,[0,0,0])}this._subMenuTimer=null},title:function(){var b=this.getContentProperty("itemTitleKey"),a=this.getPath("parentMenu.localize");if(a&&b){b=SC.String.loc(b)}return b||""}.property("content.title").cacheable(),getContentProperty:function(b){var a=this.get("content"),c=this.get("parentMenu");if(a){return a.get(c.get(b))}},mouseUp:function(b){var a;a=this.getPath("parentMenu.rootMenu.targetMenuItem");if(a){a.performAction()}return YES},performAction:function(){if(!this.get("isEnabled")){this.getPath("parentMenu.rootMenu").remove();return YES}if(this.get("hasSubMenu")){return NO}var b=this.getContentProperty("itemDisableMenuFlashKey"),a;if(b){this.sendAction()}else{this._flashCounter=0;a=this.getPath("parentMenu.rootMenu");a._isFlashing=YES;this.invokeLater(this.flashHighlight,25);this.invokeLater(this.sendAction,150)}return YES},sendAction:function(){var c=this.getContentProperty("itemActionKey"),d=this.getContentProperty("itemTargetKey"),b=this.getPath("parentMenu.rootMenu"),a;this.getPath("parentMenu.rootMenu").remove();b._isFlashing=NO;c=(c===undefined)?b.get("action"):c;d=(d===undefined)?b.get("target"):d;b.set("selectedItem",this.get("content"));if(SC.typeOf(c)===SC.T_FUNCTION){c.apply(d,[b])}else{a=this.getPath("pane.rootResponder")||SC.RootResponder.responder;if(a){a.sendAction(c,d,b)}}},flashHighlight:function(){var a=this._flashCounter,b=this.$();if(a%2===0){b.addClass("focus")}else{b.removeClass("focus")}if(a<=2){this.invokeLater(this.flashHighlight,50);this._flashCounter++}},mouseDown:function(a){return YES},mouseEntered:function(a){var c=this.get("parentMenu"),b=c.get("rootMenu");if(b._isFlashing){return}c.set("mouseHasEntered",YES);this.set("mouseHasEntered",YES);c.set("currentMenuItem",this);if(this.get("isEnabled")){this.becomeFirstResponder()}if(this.get("hasSubMenu")){this._subMenuTimer=this.invokeLater(this.showSubMenu,100)}return YES},mouseExited:function(a){var b,c;if(this.get("hasSubMenu")){c=this._subMenuTimer;if(c){c.invalidate()}else{this.invokeLater(this.checkMouseLocation,100)}}else{b=this.get("parentMenu");if(b.get("currentMenuItem")===this){b.set("currentMenuItem",null)}}return YES},touchStart:function(a){this.mouseEntered(a);return YES},touchEnd:function(a){return this.mouseUp(a)},touchEntered:function(a){return this.mouseEntered(a)},touchExited:function(a){return this.mouseExited(a)},checkMouseLocation:function(){var b=this.get("subMenu"),c=this.get("parentMenu"),a,d;if(!b.get("mouseHasEntered")){a=c.get("currentMenuItem");if(a===this||a===null){d=c.get("previousMenuItem");if(d){d.resignFirstResponder()}this.resignFirstResponder();b.remove()}}},moveUp:function(b,a){var c=this.get("parentMenu");if(c){c.moveUp(this)}return YES},moveDown:function(b,a){var c=this.get("parentMenu");if(c){c.moveDown(this)}return YES},moveRight:function(b,a){this.showSubMenu();return YES},insertText:function(b,a){var c=this.get("parentMenu");if(c){c.insertText(b,a)}},keyDown:function(a){return this.interpretKeyEvents(a)},keyUp:function(a){return YES},cancel:function(a){this.getPath("parentMenu.rootMenu").remove();return YES},didBecomeFirstResponder:function(a){if(a!==this){return}var b=this.get("parentMenu");if(b){b.set("currentSelectedMenuItem",this)}},willLoseFirstResponder:function(a){if(a!==this){return}var b=this.get("parentMenu");if(b){b.set("currentSelectedMenuItem",null);b.set("previousSelectedMenuItem",this)}},insertNewline:function(b,a){this.mouseUp(a)},closeParent:function(){this.$().removeClass("focus");var a=this.get("parentMenu");if(a){a.remove()}},clickInside:function(b,a){return SC.pointInRect({x:a.pageX,y:a.pageY},b)},contentDidChange:function(){var b=this.get("content"),a=this._content;if(b===a){return}var c=this.contentPropertyDidChange;if(a&&a.removeObserver){a.removeObserver("*",this,c)}this._content=b;if(b&&b.addObserver){b.addObserver("*",this,c)}this.contentPropertyDidChange(b,"*")}.observes("content"),contentPropertyDidChange:function(h,k){var b=this.get("parentMenu");if(!b){return}var a=SC.MenuItemView._contentPropertyToMenuItemPropertyMapping,j=SC.keys(a),f,g,d,c;if(k==="*"){for(f=0,g=j.length;f<g;++f){d=j[f];c=a[d];this.notifyPropertyChange(c)}}else{for(f=0,g=j.length;f<g;++f){d=j[f];if(b.get(d)===k){c=a[d];this.notifyPropertyChange(c)}}}}});SC.MenuItemView._contentPropertyToMenuItemPropertyMapping={itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemSeparatorKey:"isSeparator",itemSubMenuKey:"subMenu"};sc_require("panes/picker");sc_require("views/menu_item");SC.MenuPane=SC.PickerPane.extend({classNames:["sc-menu"],ariaRole:"menu",items:[],controlSize:SC.REGULAR_CONTROL_SIZE,itemHeight:SC.propertyFromRenderDelegate("itemHeight",20),itemSeparatorHeight:SC.propertyFromRenderDelegate("itemSeparatorHeight",9),menuHeight:0,menuHeightPadding:SC.propertyFromRenderDelegate("menuHeightPadding",6),submenuOffsetX:SC.propertyFromRenderDelegate("submenuOffsetX",2),selectedItem:null,exampleView:SC.MenuItemView,anchor:null,isSubMenu:NO,localize:YES,acceptsMenuPane:YES,isContextMenuEnabled:NO,popup:function(b,c){var a;this.beginPropertyChanges();if(b){if(b.isView){this._anchorView=b;this._setupScrollObservers(b)}else{this._anchorHTMLElement=b}}if(c){this.set("preferMatrix",c)}this.adjust("height",this.get("menuHeight"));this.positionPane();this.set("defaultResponder",this);this.endPropertyChanges();this._hideOverflow();this.append()},remove:function(){var a=this.get("parentMenu");this.set("currentMenuItem",null);this.closeOpenMenus();this.resignMenuPane();if(a){a.becomeMenuPane()}return arguments.callee.base.apply(this,arguments)},itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemValueKey:"value",itemIconKey:"icon",itemHeightKey:"height",itemSubMenuKey:"subMenu",itemSeparatorKey:"isSeparator",itemTargetKey:"target",itemActionKey:"action",itemCheckboxKey:"checkbox",itemShortCutKey:"shortcut",itemKeyEquivalentKey:"keyEquivalent",itemDisableMenuFlashKey:"disableMenuFlash",itemLayerIdKey:"layerId",itemExampleViewKey:"exampleView",menuItemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemSeparatorKey","itemActionKey","itemCheckboxKey","itemShortCutKey","itemHeightKey","itemSubMenuKey","itemKeyEquivalentKey","itemTargetKey","itemLayerIdKey"],preferType:SC.PICKER_MENU,isModal:YES,_menuView:null,init:function(){return arguments.callee.base.apply(this,arguments)},displayProperties:["controlSize"],renderDelegateName:"menuRenderDelegate",createChildViews:function(){var b,a,c;b=this._menuScrollView=this.createChildView(SC.MenuScrollView,{borderStyle:SC.BORDER_NONE,controlSize:this.get("controlSize")});a=this._menuView=SC.View.create({parentViewDidResize:function(){this.notifyPropertyChange("frame")},viewDidResize:function(){}});c=this.get("menuItemViews");a.set("layout",{top:0,left:0,height:this.get("menuHeight")});a.replaceAllChildren(c);b.set("contentView",a);this.childViews=[b];return this},paneDidAttach:function(){var a=(this.rootResponder=SC.RootResponder.responder);a.panes.add(this);this.set("currentWindowSize",a.computeWindowSize());this.set("isPaneAttached",YES);this.parentViewDidChange();this._notifyDidAppendToDocument();this.becomeMenuPane();return this},becomeMenuPane:function(){if(this.rootResponder){this.rootResponder.makeMenuPane(this)}return this},resignMenuPane:function(){if(this.rootResponder){this.rootResponder.makeMenuPane(null)}return this},menuItemViews:function(){return this.createMenuItemViews()}.property("displayItems").cacheable(),createMenuItemViews:function(){var j=[],r=this.get("displayItems"),a=this.get("exampleView"),u,d,m,l,f,q,o,h,b,k,s,c,g,n,i,p,w,v,t;if(!r){return j}o=this.get("itemHeightKey");h=this.get("itemSeparatorKey");l=this.get("itemExampleViewKey");b=this.get("itemHeight");g=this.get("itemKeyEquivalentKey");k=this.get("itemSeparatorHeight");w=this.get("itemLayerIdKey");c=Math.floor(this.get("menuHeightPadding")/2);s=c;i=this.menuItemKeys.map(SC._menu_fetchKeys,this);t=r.get("length");for(p=0;p<t;p++){u=r[p];q=u.get(o);if(!q){q=u.get(h)?k:b}v={layout:{height:q,top:s},contentDisplayProperties:i,content:u,parentMenu:this};if(u.get(w)){v.layerId=u.get(w)}f=u.get(l);if(f){d=f}else{d=a}m=this._menuView.createChildView(d,v);j[p]=m;s+=q;n=u.get(g);if(n){if(SC.typeOf(n)===SC.T_ARRAY){n.forEach(function(x){this._keyEquivalents[x]=m},this)}else{this._keyEquivalents[n]=m}}}this.set("menuHeight",s+c);return j},menuItemViewForContentIndex:function(a){var b=this.get("menuItemViews");if(!b){return undefined}return b.objectAt(a)},_keyEquivalents:{},rootMenu:function(){if(this.get("isSubMenu")){return this.getPath("parentMenu.rootMenu")}return this}.property("isSubMenu").cacheable(),windowSizeDidChange:function(b,a){this.remove();return arguments.callee.base.apply(this,arguments)},displayItems:function(){var d=this.get("items"),c=this.get("localize"),i=this.get("itemHeight"),b,f=[],a,g,h;if(!d){return null}b=d.get("length");for(a=0;a<b;a++){g=d.objectAt(a);if(!g){continue}h=SC.typeOf(g);if(h===SC.T_STRING){g=SC.Object.create({title:g,value:g,isEnabled:YES})}else{if(h===SC.T_HASH){g=SC.Object.create(g)}else{if(h===SC.T_ARRAY){g=this.convertArrayMenuItemToObject(g)}}}g.contentIndex=a;f.push(g)}return f}.property("items").cacheable(),_sc_menu_itemsDidChange:function(){var a=this.get("menuItemViews");this._menuView.replaceAllChildren(a);this._menuView.adjust("height",this.get("menuHeight"))}.observes("items"),convertArrayMenuItemToObject:function(g){SC.Logger.warn("Support for Array-based menu items has been deprecated.  Please update your menus to use a hash.");var f,c=SC._menu_fetchKeys,b=SC._menu_fetchItem,i,d=SC.Object.create(),a,h;f=this.menuItemKeys.map(c,this);d[f[0]]=g[0];d[f[1]]=g[1];d[f[2]]=g[2];d[f[3]]=g[3];d[f[4]]=g[4];d[f[5]]=g[5];d[f[6]]=g[6];d[f[7]]=g[7];d[f[8]]=g[8];d[f[9]]=g[9];d[f[10]]=g[10];d[f[11]]=g[11];d[f[12]]=g[12];return d},currentMenuItem:function(a,b){if(b!==undefined){if(this._currentMenuItem!==null){this.set("previousMenuItem",this._currentMenuItem)}this._currentMenuItem=b;this.setPath("rootMenu.targetMenuItem",b);return b}return this._currentMenuItem}.property().cacheable(),_sc_menu_currentMenuItemDidChange:function(){var a=this.get("currentMenuItem"),b=this.get("previousMenuItem");if(b){if(b.get("hasSubMenu")&&a===null){}else{b.resignFirstResponder();this.closeOpenMenusFor(b)}}if(a&&a.get("isEnabled")){a.scrollToVisible()}}.observes("currentMenuItem"),closeOpenMenusFor:function(a){if(!a){return}var b=a.get("parentMenu");while(b&&a){b=a.get("subMenu");if(b){b.remove();a.resignFirstResponder();a=b.get("previousMenuItem")}}},closeOpenMenus:function(){this.closeOpenMenusFor(this.get("previousMenuItem"))},mouseDown:function(a){this.modalPaneDidClick(a);return YES},mouseEntered:function(a){this.set("mouseHasEntered",YES)},keyUp:function(a){var b=this.interpretKeyEvents(a);return !b?NO:b},moveUp:function(){var c=this.get("currentMenuItem"),d=this.get("menuItemViews"),b,f,a;if(!c){a=d.get("length")-1}else{b=c.getPath("content.contentIndex");if(b===0){return YES}a=b-1}while(a>=0){if(d[a].get("isEnabled")){this.set("currentMenuItem",d[a]);d[a].becomeFirstResponder();break}a--}return YES},moveDown:function(){var d=this.get("currentMenuItem"),f=this.get("menuItemViews"),b=f.get("length"),c,g,a;if(!d){a=0}else{c=d.getPath("content.contentIndex");if(c===b){return YES}a=c+1}while(a<b){if(f[a].get("isEnabled")){this.set("currentMenuItem",f[a]);f[a].becomeFirstResponder();break}a++}return YES},moveToBeginningOfDocument:function(){var c=this.get("menuItemViews"),b=c.get("length"),a=0;while(a<b){if(c[a].get("isEnabled")){this.set("currentMenuItem",c[a]);c[a].becomeFirstResponder();break}++a}return YES},moveToEndOfDocument:function(){var c=this.get("menuItemViews"),b=c.get("length"),a=b-1;while(a>=0){if(c[a].get("isEnabled")){this.set("currentMenuItem",c[a]);c[a].becomeFirstResponder();break}--a}return YES},pageDown:function(){var c=this.get("currentMenuItem"),i,f=this.get("menuItemViews"),b=f.get("length"),a=0,h,d=0,g;if(this._menuScrollView&&this._menuScrollView.verticalScrollerView2){if(c){a=c.getPath("content.contentIndex")}h=a;g=this._menuScrollView.get("verticalPageScroll");for(a;a<b;a++){i=f[a];d+=i.get("layout").height;if(d>g){break}else{if(i.get("isEnabled")){h=a}}}i=f[h];this.set("currentMenuItem",i);i.becomeFirstResponder()}else{this.moveToEndOfDocument()}return YES},pageUp:function(){var c=this.get("currentMenuItem"),i,f=this.get("menuItemViews"),b=f.get("length"),a=b-1,h,d=0,g;if(this._menuScrollView&&this._menuScrollView.verticalScrollerView){if(c){a=c.getPath("content.contentIndex")}h=a;g=this._menuScrollView.get("verticalPageScroll");for(a;a>=0;a--){i=f[a];d+=i.get("layout").height;if(d>g){break}else{if(i.get("isEnabled")){h=a}}}i=f[h];this.set("currentMenuItem",i);i.becomeFirstResponder()}else{this.moveToBeginningOfDocument()}return YES},insertText:function(b,a){var d=this._timer,c=this._keyBuffer;if(d){d.invalidate()}d=this._timer=SC.Timer.schedule({target:this,action:"clearKeyBuffer",interval:500,isPooled:NO});c=c||"";c+=b.toUpperCase();this.selectMenuItemForString(c);this._keyBuffer=c;return YES},performKeyEquivalent:function(d,a,b){if(!b&&!this.get("isVisibleInWindow")){return NO}var c=this._keyEquivalents[d];if(c){c.performAction(YES);return YES}if(d==="escape"||d==="return"){this.remove();return YES}return NO},selectMenuItemForString:function(c){var d=this.get("menuItemViews"),g,h,b,a,f;if(!d){return}f=c.length;a=d.get("length");for(b=0;b<a;b++){g=d.objectAt(b);h=g.get("title");if(!h){continue}h=h.replace(/ /g,"").substr(0,f).toUpperCase();if(h===c){this.set("currentMenuItem",g);g.becomeFirstResponder();break}}},clearKeyBuffer:function(){this._keyBuffer=""},modalPaneDidClick:function(a){this.remove();return YES}});SC._menu_fetchKeys=function(a){return this.get(a)};SC._menu_fetchItem=function(a){if(!a){return null}return this.get?this.get(a):this[a]};SC.MenuPane.VERTICAL_OFFSET=23;sc_require("panes/panel");SC.SheetPane=SC.PanelPane.extend({classNames:["sc-sheet"],modalPane:SC.ModalPane,transitionDuration:200,_state:"NO_VIEW",init:function(){arguments.callee.base.apply(this,arguments);if(SC.Animatable){SC.SheetPane.ANIMATABLE_AVAILABLE=YES;this.mixin(SC.Animatable);if(!this.transitions){this.transitions={}}if(!this.transitions.top){this.transitions.top={duration:this.transitionDuration===200?0.3:this.transitionDuration/1000,action:"_complete",target:this}}}},append:function(){var a=this.get("layout");if(!a.height||!a.top){a=SC.View.convertLayoutToAnchoredLayout(a,this.computeParentDimensions())}a.top=-1*a.height;if(this.disableAnimation){this.disableAnimation()}this.adjust(a);this.updateLayout();if(this.enableAnimation){this.enableAnimation()}return arguments.callee.base.apply(this,arguments)},remove:function(){var b=this,a=arguments;this.invokeLater(function(){a.callee.base.apply(b,a)},this.transitionDuration);this.slideUp();return this},paneDidAttach:function(){var a=arguments.callee.base.apply(this,arguments);this.slideDown();return a},slideDown:function(){this._state=SC.SheetPane.ANIMATING;this._direction=SC.SheetPane.SLIDE_DOWN;if(SC.SheetPane.ANIMATABLE_AVAILABLE){this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_OUT;this.adjust("top",0)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");this.tick()}},slideUp:function(){this._state=SC.SheetPane.ANIMATING;this._direction=SC.SheetPane.SLIDE_UP;if(SC.SheetPane.ANIMATABLE_AVAILABLE){var a=this.get("layout");this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_IN;this.adjust("top",-1*a.height)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");this.tick()}},_complete:function(){var a=this._direction;if(a===SC.SheetPane.SLIDE_DOWN){if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",0)}this.adjust({centerX:0,left:null});if(SC.browser.isMozilla){this.parentViewDidChange()}}else{var b=this.get("layout");if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",-1*b.height)}}this._state=SC.SheetPane.READY;this.updateLayout()},blurTo:function(a){this.setFirstResponder("")},tick:function(){this._timer=null;var b=Date.now();var f=(b-this._start)/(this._end-this._start),h=this,a=this._direction,c=this.get("layout"),d,g;if(f<0){f=0}if(f>=1){this._complete();return this}g=Math.floor(c.height*f);if(a==SC.SheetPane.SLIDE_DOWN){h.adjust("top",0-(c.height-g))}else{if(a==SC.SheetPane.SLIDE_UP){h.adjust("top",0-g)}}this._timer=this.invokeLater(this.tick,20);h.updateLayout();return this}});SC.SheetPane.mixin({ANIMATABLE_AVAILABLE:NO,NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",SLIDE_DOWN:"SLIDEDOWN",SLIDE_UP:"SLIDEUP"});SC.BaseTheme.buttonRenderDelegate=SC.RenderDelegate.create({className:"button","sc-small-size":{height:18,autoResizePadding:{width:15,height:0}},"sc-regular-size":{height:24,autoResizePadding:{width:20,height:0}},"sc-huge-size":{height:30,autoResizePadding:{width:30,height:0}},"sc-jumbo-size":{height:44,autoResizePadding:{width:50,height:0}},render:function(a,g){this.addSizeClassName(a,g);var f,b=a.get("toolTip"),h=a.get("isSelected")||NO,k=a.get("isActive")||NO,i=a.get("isDefault")||NO,j=a.get("isCancel")||NO,d=(a.get("buttonBehavior")===SC.TOGGLE_BEHAVIOR),c=SC.guidFor(a)+"-label";g.setClass({icon:!!a.get("icon"),def:i,cancel:j&&!i,active:k,sel:h});if(b){g.attr("title",b);g.attr("alt",b)}this.includeSlices(a,g,SC.THREE_SLICE);if(a.get("isSegment")){g.attr("aria-selected",h.toString())}else{if(d){g.attr("aria-pressed",k.toString())}}g.attr("aria-labelledby",c);g=g.begin("label").addClass("sc-button-label").id(c);a.get("theme").labelRenderDelegate.render(a,g);g=g.end();if(a.get("supportFocusRing")){g=g.begin("div").addClass("focus-ring");this.includeSlices(a,g,SC.THREE_SLICE);g=g.end()}},update:function(f,a){var d=(f.get("buttonBehavior")===SC.TOGGLE_BEHAVIOR);this.updateSizeClassName(f,a);if(f.get("isActive")){a.addClass("active")}var c=f.get("isDefault"),b=f.get("isCancel");if(f.get("isSegment")){a.attr("aria-selected",f.get("isSelected").toString())}else{if(d){a.attr("aria-pressed",f.get("isActive").toString())}}a.attr("title",f.get("toolTip"));a.setClass("icon",!!f.get("icon"));a.setClass("def",!!c);a.setClass("cancel",!!b&&!c);f.get("theme").labelRenderDelegate.update(f,a.find("label"))},getRenderedAutoResizeLayer:function(a,b){return b.find(".sc-button-label")[0]}});SC.BaseTheme.checkboxRenderDelegate=SC.RenderDelegate.create({className:"checkbox",render:function(a,c){this.addSizeClassName(a,c);var f=a.get("theme"),g,b;b=SC.guidFor(a)+"-label";var d=a.get("isSelected")||NO;var j=a.get("isActive");var i=!a.get("isEnabled");var h;if(d===SC.MIXED_STATE){h="mixed"}else{if(d){h="true"}else{h="false"}}c.attr("role","checkbox");c.attr("aria-checked",h);c.attr("aria-labelledby",b);c.setClass({sel:d,active:j,disabled:i});c.push('<span class = "button"></span>');c=c.begin("span").addClass("label").id(b);f.labelRenderDelegate.render(a,c);c=c.end()},update:function(h,c){this.updateSizeClassName(h,c);var g=h.get("theme");var d=h.get("isSelected");var f=h.get("isActive");var b=!h.get("isEnabled");var a;if(d===SC.MIXED_STATE){a="mixed"}else{if(d){a="true"}else{a="false"}}c.attr("aria-checked",a);g.labelRenderDelegate.update(h,c.find("span.label"));c.setClass({sel:d,active:f,disabled:b})}});SC.BaseTheme.collectionRenderDelegate=SC.RenderDelegate.create({className:"collection",render:function(b,a){a.setClass("focus",b.get("hasFirstResponder"));a.setClass("disabled",!b.get("isEnabled"));a.setClass("active",b.get("isActive"))},update:function(b,a){a.setClass("focus",b.get("hasFirstResponder"));a.setClass("disabled",!b.get("isEnabled"));a.setClass("active",b.get("isActive"))}});SC.BaseTheme.disclosureRenderDelegate=SC.RenderDelegate.create({className:"disclosure",render:function(h,a){this.addSizeClassName(h,a);var g=h.get("theme"),d=h.get("value"),b=["sc-button-label","sc-disclosure-label"];var f=SC.guidFor(h)+"-label";a.attr("aria-expanded",d);a.attr("aria-labelledby",f);if(h.get("isSelected")){a.addClass("sel")}var c="";c+=h.get("isSelected")?"open":"closed";if(h.get("isActive")){c+=" active"}a.push('<img src = "'+SC.BLANK_IMAGE_URL+'" class = "disclosure button '+c+'" />');a=a.begin("span").addClass(b).id(f);g.labelRenderDelegate.render(h,a);a=a.end()},update:function(d,a){this.updateSizeClassName(d,a);var c=d.get("theme"),b=d.get("value");a.attr("aria-expanded",b);if(d.get("isSelected")){a.addClass("sel")}a.find("img").setClass({open:d.get("isSelected"),closed:!d.get("isSelected"),active:d.get("isActive")});c.labelRenderDelegate.update(d,a.find("span.sc-disclosure-label"))}});SC.THREE_SLICE=["left","middle","right"];SC.NINE_SLICE=["top-left","top","top-right","left","middle","right","bottom-left","bottom","bottom-right"];SC.RenderDelegate.reopen({includeSlices:function(f,c,d){for(var b=0,a=d.length;b<a;b++){c.push('<div class="'+d[b]+'"></div>')}}});SC.BaseTheme.imageButtonRenderDelegate=SC.RenderDelegate.create({className:"image-button",render:function(d,b){var c=d.get("image"),a=d.get("toolTip");this.addSizeClassName(d,b);b.addClass("no-min-width");if(a){b.attr("title",a);b.attr("alt",a)}if(c){b.push("<div class='img "+c+"'></div>")}else{b.push("<div class='img'></div>")}},update:function(d,b){var c,a;this.updateSizeClassName(d,b);if(d.didChangeFor("imageButtonRenderDelegate","toolTip")){a=d.get("toolTip");b.attr("title",a);b.attr("alt",a)}c=d.get("image");if(c&&d.didChangeFor("imageButtonRenderDelegate","image")){b.children()[0].className="img "+c}}});SC.BaseTheme.MASTER_DETAIL_DIVIDER_WIDTH=1;SC.BaseTheme.masterDetailRenderDelegate=SC.RenderDelegate.create({className:"master-detail",dividerWidth:1,render:function(b,a){a.setClass("round-toolbars",SC.platform.touch)},update:function(b,a){a.setClass("round-toolbars",SC.platform.touch)}});SC.BaseTheme.panelRenderDelegate=SC.RenderDelegate.create({className:"panel",render:function(f,b){b=b.begin("div").addClass("panel-background");this.includeSlices(f,b,SC.NINE_SLICE);b=b.end();var a=f.get("ariaLabel"),c=f.get("ariaLabelledBy"),d=f.get("ariaDescribedBy");if(a){b.attr("aria-label",a)}if(c){b.attr("aria-labelledby",c)}if(d){b.attr("aria-describedby",d)}},update:function(f,c){var a=f.get("ariaLabel"),b=f.get("ariaLabelledBy"),d=f.get("ariaDescribedBy");if(a){c.attr("aria-label",a)}if(b){c.attr("aria-labelledby",b)}if(d){c.attr("aria-describedby",d)}}});sc_require("render_delegates/panel");SC.BaseTheme.pickerRenderDelegate=SC.RenderDelegate.create({className:"picker",render:function(g,c){var a=g.get("theme").panelRenderDelegate;a.render(g,c);var b=g.get("preferType");var f=g.get("pointerPos");var d=g.get("pointerPosY");if(b==SC.PICKER_POINTER||b==SC.PICKER_MENU_POINTER){c.push('<div class="sc-pointer '+f+'" style="margin-top: '+d+'px"></div>');c.addClass(f)}},update:function(h,g){var a=h.get("theme").panelRenderDelegate;a.update(h,g);var b=h.get("preferType");var f=h.get("pointerPos");var d=h.get("pointerPosY");if(b==SC.PICKER_POINTER||b==SC.PICKER_MENU_POINTER){var c=g.find(".sc-pointer");c.attr("class","sc-pointer "+f);c.attr("style","margin-top: "+d+"px");g.addClass(f)}}});sc_require("render_delegates/picker");SC.BaseTheme.menuRenderDelegate=SC.BaseTheme.pickerRenderDelegate.create({className:"menu",render:function(c,b,a){this.addSizeClassName(b,a);c(b,a)}.enhance(),update:function(c,b,a){this.updateSizeClassName(b,a);c(b,a)}.enhance(),itemHeight:20,itemSeparatorHeight:9,menuHeightPadding:6,menuWidthPadding:50,minimumMenuWidth:50,submenuOffsetX:2,verticalOffset:23,"sc-tiny-size":{itemHeight:10,itemSeparatorHeight:2,menuHeightPadding:2,submenuOffsetX:0},"sc-small-size":{itemHeight:16,itemSeparatorHeight:7,menuHeightPadding:4,submenuOffsetX:2},"sc-large-size":{itemHeight:60,itemSeparatorHeight:20,menuHeightPadding:0,submenuOffsetX:4},"sc-huge-size":{itemHeight:20,itemSeparatorHeight:9,menuHeightPadding:0,submenuOffsetX:0}});SC.BaseTheme.popupButtonRenderDelegate=SC.BaseTheme.buttonRenderDelegate.create({render:function(b,a){a.attr("aria-haspopup","true");arguments.callee.base.apply(this,arguments)},update:function(b,a){arguments.callee.base.apply(this,arguments)}});SC.BaseTheme.PROGRESS_OFFSET=0.5;SC.BaseTheme.PROGRESS_OFFSET_RANGE=42;SC.BaseTheme.progressRenderDelegate=SC.RenderDelegate.create({className:"progress",render:function(i,c){this.addSizeClassName(i,c);var a=i.get("isIndeterminate"),h=i.get("theme"),b=i.get("maximum"),f=i.get("minimum"),d=i.get("ariaValue");var g;if(a){g=1}else{g=i.get("value")}c.attr("aria-valuemax",b);c.attr("aria-valuemin",f);c.attr("aria-valuenow",d);c.attr("aria-valuetext",d);c.setClass({indeterminate:a,running:i.get("isRunning")&&a,disabled:!i.get("isEnabled"),"sc-empty":(g<=0),"sc-complete":(g>=1&&!a)});c=c.begin("div").addClass("track");this.includeSlices(i,c,SC.THREE_SLICE);c=c.end();c=c.begin("div").addClass("content");c.css("width",(g*100)+"%");this.includeSlices(i,c,SC.THREE_SLICE);c=c.end()},update:function(a,b){this.updateSizeClassName(a,b);var f=a.get("theme"),j,k=a.get("maximum"),g=a.get("minimum"),c=a.get("ariaValue"),d=a.get("isIndeterminate"),l=a.get("isRunning"),i=a.get("isEnabled"),h=a.get("isVisibleInWindow");b.attr("aria-valuemax",k);b.attr("aria-valuemin",g);b.attr("aria-valuenow",c);b.attr("aria-valuetext",c);if(d){j=1}else{j=a.get("value")}b.setClass({indeterminate:d,running:l&&d,disabled:!i,"sc-empty":(j<=0),"sc-complete":(j>=1&&!d)});b.find(".content").css("width",(j*100)+"%");if(!SC.platform.supportsCSSTransitions){if(!this._queue[b[0].id]){this._queue[b[0].id]={offset:0,element:SC.$(b).find(".content .middle"),shouldAnimate:false}}if(d&&l&&h){this._queue[b[0].id].shouldAnimate=true;this.animate(a)}else{if(!d){this._queue[b[0].id].element.css("background-position","")}else{this._queue[b[0].id].shouldAnimate=false}}}},_queue:{},_animating:false,animate:function(b){var a=this;if(this._animating){return}function c(){var i,f,g,d=a._queue,k=0,h;var j;for(j in d){if(d.hasOwnProperty(j)){h=d[j];if(h.shouldAnimate){a._animating=true;k++;f=h.offset||0;i=(f+SC.BaseTheme.PROGRESS_OFFSET)%SC.BaseTheme.PROGRESS_OFFSET_RANGE;g=Math.round(i);if(g>Math.round(f)){h.element.css("background-position",g+"px 0px")}h.offset=i}}}if(k===0){a._animating=false}else{window.requestAnimationFrame(c)}}c()}});SC.BaseTheme.radioRenderDelegate=SC.RenderDelegate.create({className:"radio",render:function(g,b){this.addSizeClassName(g,b);var f=g.get("theme");var a=g.get("isSelected"),c=g.get("width"),d=SC.guidFor(g)+"-label";b.setClass({active:g.get("isActive"),mixed:g.get("isMixed"),sel:g.get("isSelected"),disabled:!g.get("isEnabled")});b.attr("role","radio");b.attr("aria-checked",a);b.attr("aria-labelledby",d);b.attr("aria-disabled",g.get("isEnabled")?"false":"true");if(c){b.css("width",c)}b.push('<span class = "button"></span>');b=b.begin("span").addClass("sc-button-label").id(d);f.labelRenderDelegate.render(g,b);b=b.end()},update:function(g,a){this.updateSizeClassName(g,a);var f=g.get("theme");var b=g.get("isSelected"),c=g.get("width"),d=g.get("value");a.setClass({active:g.get("isActive"),mixed:g.get("isMixed"),sel:g.get("isSelected"),disabled:!g.get("isEnabled")});a.attr("aria-disabled",g.get("isEnabled")?"false":"true");a.attr("aria-checked",b);a.css("width",c?c:null);f.labelRenderDelegate.update(g,a.find(".sc-button-label"))}});SC.BaseTheme.radioGroupRenderDelegate=SC.RenderDelegate.create({className:"radio-group",render:function(i,f){this.addSizeClassName(i,f);var h=i.get("theme"),d=SC.guidFor(this),c=i.get("items"),b,a=c.length,g;f.addClass(i.get("layoutDirection"));f.attr("role","radiogroup");f.attr("aria-disabled",i.get("isEnabled")?"false":"true");for(b=0;b<a;b++){g=c[b];f=f.begin("div").addClass("radio-"+b).attr("index",b).addClass(h.classNames).addClass(h.radioRenderDelegate.className).addClass("sc-radio-button");h.radioRenderDelegate.render(g,f);f=f.end()}i.get("renderState").radioCount=b},update:function(a,d){this.updateSizeClassName(a,d);var f=a.get("theme"),b=SC.guidFor(this),h=a.get("items"),i,g=h.length,j;d.addClass(a.get("layoutDirection"));d.attr("aria-disabled",a.get("isEnabled")?"false":"true");if(a.get("renderState").radioCount!==g){var c=SC.RenderContext(d[0]);this.render(a,c);c.update();return}for(i=0;i<g;i++){j=h[i];f.radioRenderDelegate.update(j,d.find(".radio-"+i))}},updateRadioAtIndex:function(d,a,b){var c=d.get("items")[b];d.get("theme").radioRenderDelegate.update(c,a.find(".radio-"+b))},indexForEvent:function(d,b,a){var c=$(a.target).closest(".sc-radio-button").attr("index");if(isNaN(c)){return undefined}return parseInt(c,0)}});SC.BaseTheme.segmentRenderDelegate=SC.RenderDelegate.create({className:"segment",render:function(f,b){var c=f.get("theme"),d,a;a={"sc-first-segment":f.get("isFirstSegment"),"sc-middle-segment":f.get("isMiddleSegment"),"sc-last-segment":f.get("isLastSegment"),"sc-overflow-segment":f.get("isOverflowSegment"),vertical:f.get("layoutDirection")!==SC.LAYOUT_HORIZONTAL};if(!SC.none(f.get("index"))){a["sc-segment-"+f.get("index")]=YES}b.setClass(a);d=c.buttonRenderDelegate;d.render(f,b)},update:function(f,a){var c=f.get("theme"),d,b={};b={"sc-first-segment":f.get("isFirstSegment"),"sc-middle-segment":f.get("isMiddleSegment"),"sc-last-segment":f.get("isLastSegment"),"sc-overflow-segment":f.get("isOverflowSegment")||NO,vertical:f.get("layoutDirection")!==SC.LAYOUT_HORIZONTAL};if(!SC.none(f.get("index"))){b["sc-segment-"+f.get("index")]=YES}a.setClass(b);d=c.buttonRenderDelegate;d.update(f,a)}});SC.BaseTheme.segmentedRenderDelegate=SC.RenderDelegate.create({className:"segmented",render:function(b,a){this.addSizeClassName(b,a);a.addStyle("text-align",b.get("align"))},update:function(b,a){this.updateSizeClassName(b,a);a.css("text-align",b.get("align"))}});SC.BaseTheme.sliderRenderDelegate=SC.RenderDelegate.create({className:"slider",render:function(g,c){this.addSizeClassName(g,c);var b=SC.BLANK_IMAGE_URL,a=g.get("maximum"),f=g.get("minimum"),d=g.get("ariaValue");c.attr("aria-valuemax",a);c.attr("aria-valuemin",f);c.attr("aria-valuenow",d);if(f!==0||a!==100){c.attr("aria-valuetext",d)}c.attr("aria-orientation","horizontal");c=c.begin("span").addClass("track");this.includeSlices(g,c,SC.THREE_SLICE);c.push('<img src="'+b+'" class="sc-handle" style="left: '+g.get("value")+'%" /></span>');c=c.end();g.get("renderState")._cachedHandle=null},update:function(i,b){this.updateSizeClassName(i,b);var a=i.get("maximum"),d=i.get("minimum"),c=i.get("ariaValue");b.attr("aria-valuemax",a);b.attr("aria-valuemin",d);b.attr("aria-valuenow",c);if(d!==0||a!==100){b.attr("aria-valuetext",c)}b.attr("aria-orientation","horizontal");if(i.didChangeFor("sliderRenderDelegate","value")){var g=i.get("renderState")._cachedHandle;if(!g){g=i.get("renderState")._cachedHandle=b.find(".sc-handle")}var h=i.get("frame"),f=i.get("value");g.css("left",f+"%")}}});SC.BaseTheme.SourceList=SC.BaseTheme.subtheme("source-list");SC.BaseTheme.toolbarRenderDelegate=SC.RenderDelegate.create({className:"toolbar",render:function(b,a){},update:function(){}});SC.BaseTheme.wellRenderDelegate=SC.RenderDelegate.create({className:"well",render:function(b,a){this.includeSlices(b,a,SC.NINE_SLICE)},update:function(){}});SC.BaseTheme.workspaceRenderDelegate=SC.RenderDelegate.create({className:"workspace",render:function(){},update:function(){}});SC.DRAG_LINK=4;SC.DRAG_COPY=1;SC.DRAG_MOVE=2;SC.DRAG_NONE=0;SC.DRAG_ANY=15;SC.DRAG_DATA=8;SC.DRAG_AUTOSCROLL_ZONE_THICKNESS=20;SC.View.reopen({init:function(a){a();if(this.get("isDropTarget")){SC.Drag.addDropTarget(this)}if(this.get("isScrollable")){SC.Drag.addScrollableView(this)}}.enhance(),destroy:function(a){if(this.get("isDropTarget")){SC.Drag.removeDropTarget(this)}if(this.get("isScrollable")){SC.Drag.removeScrollableView(this)}return a()}.enhance()});SC.Drag=SC.Object.extend({source:null,ghostView:null,ghostActsLikeCursor:NO,dragView:null,ghost:YES,sourceIsDraggable:YES,slideBack:YES,ghostOffset:{x:0,y:0},location:{},dataTypes:function(){if(this.dataSource){return this.dataSource.get("dragDataTypes")||[]}var d=this.data;if(d){var a=[];for(var b in d){if(d.hasOwnProperty(b)){a.push(b)}}return a}var c=this.get("source");if(c&&c.dragDataTypes){return c.get("dragDataTypes")||[]}return[]}.property().cacheable(),hasDataType:function(a){return(this.get("dataTypes").indexOf(a)>=0)},dataForType:function(a){if(this.dataSource){return this.dataSource.dragDataForType(this,a)}else{if(this.data){return this.data[a]}else{var b=this.get("source");if(b&&SC.typeOf(b.dragDataForType)===SC.T_FUNCTION){return b.dragDataForType(this,a)}else{return null}}}},dataSource:null,data:null,allowedDragOperations:SC.DRAG_ANY,_dragInProgress:YES,_dragViewWasVisible:null,startDrag:function(){if(this.get("sourceIsDraggable")){this._createGhostView()}var i=this.event;var f={x:i.pageX,y:i.pageY};this.set("location",f);if(this.get("sourceIsDraggable")){var b=this._getDragView();var j=b.get("parentView");var h=j?j.convertFrameToView(b.get("frame"),null):b.get("frame");if(this.get("ghost")){this._dragViewWasVisible=b.get("isVisible");b.set("isVisible",NO)}if(this.ghostActsLikeCursor){this.ghostOffset={x:14,y:14}}else{this.ghostOffset={x:(f.x-h.x),y:(f.y-h.y)}}if(!this._ghostViewHidden){this._positionGhostView(i)}if(i.makeTouchResponder){var k=this;SC.Timer.schedule({target:i,action:function(){if(!i.hasEnded){i.makeTouchResponder(k,YES)}},interval:1})}else{this.ghostView.rootResponder.dragDidStart(this,i)}}var a=this.source;if(a&&a.dragDidBegin){a.dragDidBegin(this,f)}var c=this._dropTargets();for(var g=0,d=c.length;g<d;g++){c[g].tryToPerform("dragStarted",this,i)}},cancelDrag:function(){var b=this._lastTarget,c=this.get("location");if(b&&b.dragExited){b.dragExited(this,this._lastMouseDraggedEvent)}if(this.get("sourceIsDraggable")){this._destroyGhostView();if(this.get("ghost")){if(this._dragViewWasVisible){this._getDragView().set("isVisible",YES)}this._dragViewWasVisible=null}}var a=this.source;if(a&&a.dragDidEnd){a.dragDidEnd(this,c,SC.DRAG_NONE)}this._lastTarget=null;this._dragInProgress=NO},touchStart:function(a){return YES},mouseDragged:function(a){var b=this._autoscroll(a);var g=this.get("location");if(!b&&(a.pageX===g.x)&&(a.pageY===g.y)){return}g={x:a.pageX,y:a.pageY};this.set("location",g);this._lastMouseDraggedEvent=a;var d=this.source;var c=this._lastTarget;var f=this._findDropTarget(a);var h=SC.DRAG_NONE;while(f&&(f!==c)&&(h===SC.DRAG_NONE)){if(f&&d&&d.dragSourceOperationMaskFor){h=d.dragSourceOperationMaskFor(this,f)}else{h=SC.DRAG_ANY}if((h!==SC.DRAG_NONE)&&f&&f.computeDragOperations){h=h&f.computeDragOperations(this,a,h)}else{h=SC.DRAG_NONE}this.allowedDragOperations=h;if(h===SC.DRAG_NONE){f=this._findNextDropTarget(f)}}if(f!==c){if(c&&c.dragExited){c.dragExited(this,a)}if(f){if(f.dragEntered){f.dragEntered(this,a)}if(f.dragUpdated){f.dragUpdated(this,a)}}this._lastTarget=f}else{if(f&&f.dragUpdated){f.dragUpdated(this,a)}}if(d&&d.dragDidMove){d.dragDidMove(this,g)}if(this.get("sourceIsDraggable")&&!this._ghostViewHidden){this._positionGhostView(a)}},touchesDragged:function(a){this.mouseDragged(a)},mouseUp:function(l){var g={x:l.pageX,y:l.pageY},h=this._lastTarget,d=this.allowedDragOperations;this.set("location",g);try{if(h&&h.acceptDragOperation&&h.acceptDragOperation(this,d)){d=h.performDragOperation?h.performDragOperation(this,d):SC.DRAG_NONE}else{d=SC.DRAG_NONE}}catch(i){SC.Logger.error("Exception in SC.Drag.mouseUp(acceptDragOperation|performDragOperation): %@".fmt(i))}try{if(h&&h.dragExited){h.dragExited(this,l)}}catch(j){SC.Logger.error("Exception in SC.Drag.mouseUp(target.dragExited): %@".fmt(j))}var c=this._dropTargets();for(var k=0,f=c.length;k<f;k++){try{c[k].tryToPerform("dragEnded",this,l)}catch(b){SC.Logger.error("Exception in SC.Drag.mouseUp(dragEnded on %@): %@".fmt(c[k],b))}}if(this.get("sourceIsDraggable")){this._destroyGhostView();if(this.get("ghost")){if(this._dragViewWasVisible){this._getDragView().set("isVisible",YES)}this._dragViewWasVisible=null}}var a=this.source;if(a&&a.dragDidEnd){a.dragDidEnd(this,g,d)}this._lastTarget=null;this._dragInProgress=NO},touchEnd:function(a){this.mouseUp(a)},_getDragView:function(){if(!this.dragView){if(!this.source||!this.source.isView){throw"Source can't be used as dragView, because it's not a view."}this.dragView=this.source}return this.dragView},_createGhostView:function(){var c=this,b=this._getDragView(),d=b.get("frame"),a;a=this.ghostView=SC.Pane.create({classNames:["sc-ghost-view"],layout:{top:d.y,left:d.x,width:d.width,height:d.height},owner:this,didCreateLayer:function(){if(b){var f=b.get("layer");if(f){f=f.cloneNode(true);f.style.top="0px";f.style.left="0px";this.get("layer").appendChild(f)}}}});a.append()},_positionGhostView:function(a){var c=this.get("location");c.x-=this.ghostOffset.x;c.y-=this.ghostOffset.y;var b=this.ghostView;if(b){b.adjust({top:c.y,left:c.x});b.invokeOnce("updateLayout")}},_ghostViewHidden:NO,hideGhostView:function(){if(this.ghostView&&!this._ghostViewHidden){this.ghostView.remove();this._ghostViewHidden=YES}},unhideGhostView:function(){if(this._ghostViewHidden){this._ghostViewHidden=NO;this._createGhostView()}},_destroyGhostView:function(){if(this.ghostView){this.ghostView.remove();this.ghostView=null;this._ghostViewHidden=NO}},_dropTargets:function(){if(this._cachedDropTargets){return this._cachedDropTargets}var b=[];var d=SC.Drag._dropTargets;for(var c in d){if(d.hasOwnProperty(c)){b.push(d[c])}}var g={};var f=SC.Drag._dropTargets;var a=function(h){if(!h){return 0}var j=SC.guidFor(h);var i=g[j];if(!i){i=1;while(h=h.get("parentView")){if(f[SC.guidFor(h)]!==undefined){i=i+1}if(h.isPane&&h.isMainPane){i=i+10000}}g[j]=i}return i};b.sort(function(i,h){if(i===h){return 0}i=a(i);h=a(h);return(i>h)?-1:1});this._cachedDropTargets=b;return b},_findDropTarget:function(c){var h={x:c.pageX,y:c.pageY};var f,g;var d=this._dropTargets();for(var b=0,a=d.length;b<a;b++){f=d[b];if(!f.get("isVisibleInWindow")){continue}g=f.convertFrameToView(f.get("clippingFrame"),null);if(SC.pointInRect(h,g)){return f}}return null},_findNextDropTarget:function(a){var b=SC.Drag._dropTargets;while(a=a.get("parentView")){if(b[SC.guidFor(a)]){return a}}return null},_autoscroll:function(m){if(!m){m=this._lastAutoscrollEvent}if(!this._dragInProgress){return NO}var h=m?{x:m.pageX,y:m.pageY}:this.get("location"),i=this._findScrollableView(h),n=null,l,c,d,j,b,a,g;while(i&&!n){l=i.get("canScrollVertical")?1:0;c=i.get("canScrollHorizontal")?1:0;if(l||c){a=i.get("containerView");if(a){g=i.convertFrameToView(a.get("frame"),null)}else{l=c=0}}if(l){j=SC.maxY(g);d=j-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(h.y>=d&&h.y<=j){l=1}else{d=SC.minY(g);j=d+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(h.y>=d&&h.y<=j){l=-1}else{l=0}}}if(c){j=SC.maxX(g);d=j-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(h.x>=d&&h.x<=j){c=1}else{d=SC.minX(g);j=d+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(h.x>=d&&h.x<=j){c=-1}else{c=0}}}if(l||c){n=i}else{i=this._findNextScrollableView(i)}}if(n&&(this._lastScrollableView===n)){if((Date.now()-this._hotzoneStartTime)>100){this._horizontalScrollAmount*=1.05;this._verticalScrollAmount*=1.05}}else{this._lastScrollableView=n;this._horizontalScrollAmount=15;this._verticalScrollAmount=15;this._hotzoneStartTime=(n)?Date.now():null;c=l=0}if(n&&(c||l)){var k={x:c*this._horizontalScrollAmount,y:l*this._verticalScrollAmount};n.scrollBy(k)}if(n){if(m){this._lastAutoscrollEvent={pageX:m.pageX,pageY:m.pageY}}this.invokeLater(this._autoscroll,100,null);return YES}else{this._lastAutoscrollEvent=null;return NO}},_scrollableViews:function(){if(this._cachedScrollableView){return this._cachedScrollableView}var a=[];var c=SC.Drag._scrollableViews;for(var b in c){if(c.hasOwnProperty(b)){a.push(c[b])}}a=a.sort(function(g,d){var f=g;while(f=f.get("parentView")){if(d===f){return -1}}return 1});this._cachedScrollableView=a;return a},_findScrollableView:function(g){var c=this._scrollableViews(),b=c?c.length:0,d,f,a;for(a=0;a<b;a++){d=c[a];if(!d.get("isVisibleInWindow")){continue}f=d.convertFrameToView(d.get("clippingFrame"),null);if(SC.pointInRect(g,f)){return d}}return null},_findNextScrollableView:function(a){var b=SC.Drag._scrollableViews;while(a=a.get("parentView")){if(b[SC.guidFor(a)]){return a}}return null}});SC.Drag.mixin({start:function(b){var a=this.create(b);a.startDrag();return a},_dropTargets:{},_scrollableViews:{},addDropTarget:function(a){this._dropTargets[SC.guidFor(a)]=a},removeDropTarget:function(a){delete this._dropTargets[SC.guidFor(a)]},addScrollableView:function(a){this._scrollableViews[SC.guidFor(a)]=a},removeScrollableView:function(a){delete this._scrollableViews[SC.guidFor(a)]}});SC.UndoManager=SC.Object.extend({undoActionName:function(){return this.undoStack?this.undoStack.name:null}.property("undoStack"),redoActionName:function(){return this.redoStack?this.redoStack.name:null}.property("redoStack"),canUndo:function(){return this.undoStack!=null}.property("undoStack"),canRedo:function(){return this.redoStack!=null}.property("redoStack"),undo:function(){this._undoOrRedo("undoStack","isUndoing")},redo:function(){this._undoOrRedo("redoStack","isRedoing")},isUndoing:NO,isRedoing:NO,groupingLevel:0,registerUndo:function(b,a){this.beginUndoGroup(a);this._activeGroup.actions.push(b);this.endUndoGroup(a)},beginUndoGroup:function(b){if(this._activeGroup){this.groupingLevel++}else{var a=this.isUndoing?"redoStack":"undoStack";this._activeGroup={name:b,actions:[],prev:this.get(a)};this.set(a,this._activeGroup);this.groupingLevel=1}},endUndoGroup:function(a){if(!this._activeGroup){raise("endUndoGroup() called outside group.")}if(this.groupingLevel>1){this.groupingLevel--}else{this._activeGroup=null;this.groupingLevel=0}this.propertyDidChange(this.isUndoing?"redoStack":"undoStack")},setActionName:function(a){if(!this._activeGroup){raise("setActionName() called outside group.")}this._activeGroup.name=a},_activeGroup:null,undoStack:null,redoStack:null,_undoOrRedo:function(a,c){if(this._activeGroup){return false}if(this.get(a)==null){return true}this.set(c,true);var f=this.get(a);this.set(a,f.prev);var b;var d=f.actions.length>1;if(d){this.beginUndoGroup(f.name)}while(b=f.actions.pop()){b()}if(d){this.endUndoGroup(f.name)}this.set(c,false)}});SC.CheckboxView=SC.ButtonView.extend(SC.StaticLayout,{classNames:["sc-checkbox-view","sc-checkbox-control"],ariaRole:"checkbox",themeName:null,renderDelegateName:"checkboxRenderDelegate",needsEllipsis:NO,acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),_toggleValue:function(){var a=this.get("value")===this.get("toggleOnValue");this.set("value",a?this.get("toggleOffValue"):this.get("toggleOnValue"))},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;if(a&&this.get("acceptsFirstResponder")){a.allowDefault()}return YES},mouseUp:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",NO);this._isMouseDown=NO;if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){if(this.$().within(a.target)){this._toggleValue();this._action(a)}}return YES},keyDown:function(b){if(!this.get("isEnabled")){return YES}if(b.which===9||b.keyCode===9){var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES}if(b.which===13||b.which===32){this._toggleValue();if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){if(this.$().within(b.target)){this._action(b)}}return YES}b.allowDefault();return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)}});SC.LIST_ITEM_ACTION_CANCEL="sc-list-item-cancel-action";SC.LIST_ITEM_ACTION_REFRESH="sc-list-item-cancel-refresh";SC.LIST_ITEM_ACTION_EJECT="sc-list-item-cancel-eject";SC.ListItemView=SC.View.extend(SC.InlineEditable,SC.Control,{classNames:["sc-list-item-view"],displayProperties:["disclosureState","escapeHTML","isDropTarget"],content:null,contentIndex:null,hasContentIcon:NO,hasContentRightIcon:NO,hasContentBranch:NO,contentCheckboxKey:null,icon:null,isDropTarget:NO,contentIconKey:null,rightIcon:null,contentRightIconKey:null,contentValueKey:null,escapeHTML:YES,contentUnreadCountKey:null,contentIsBranchKey:null,outlineIndent:16,outlineLevel:0,disclosureState:SC.LEAF_NODE,validator:null,contentKeys:{contentValueKey:"title",contentCheckboxKey:"checkbox",contentIconKey:"icon",contentRightIconKey:"rightIcon",contentUnreadCountKey:"count",contentIsBranchKey:"branch"},contentPropertyDidChange:function(){if(this.get("contentIsEditable")!==this.contentIsEditable()){this.notifyPropertyChange("contentIsEditable")}this.displayDidChange()},contentIsEditable:function(){var a=this.get("content");return a&&(a.get?a.get("isEditable")!==NO:NO)}.property("content").cacheable(),inlineEditorDelegate:SC.InlineTextFieldDelegate,$label:function(){return this.$("label")},_isInsideElementWithClassName:function(f,a){var c=this.get("layer");if(!c){return NO}var d=SC.$(a.target);var b=NO;while(!b&&d.length>0&&(d[0]!==c)){if(d.hasClass(f)){b=YES}d=d.parent()}d=c=null;return b},_isInsideCheckbox:function(b){var a=this.displayDelegate;var c=this.getDelegateProperty("contentCheckboxKey",a);return c&&this._isInsideElementWithClassName("sc-checkbox-view",b)},_isInsideDisclosure:function(a){if(this.get("disclosureState")===SC.LEAF_NODE){return NO}return this._isInsideElementWithClassName("sc-disclosure-view",a)},_isInsideRightIcon:function(c){var b=this.displayDelegate;var a=this.getDelegateProperty("hasContentRightIcon",b)||!SC.none(this.rightIcon);return a&&this._isInsideElementWithClassName("right-icon",c)},mouseDown:function(a){if(!this.get("contentIsEditable")){return NO}if(this._isInsideCheckbox(a)){this._addCheckboxActiveState();this._isMouseDownOnCheckbox=YES;this._isMouseInsideCheckbox=YES;return YES}else{if(this._isInsideDisclosure(a)){this._addDisclosureActiveState();this._isMouseDownOnDisclosure=YES;this._isMouseInsideDisclosure=YES;return YES}else{if(this._isInsideRightIcon(a)){this._addRightIconActiveState();this._isMouseDownOnRightIcon=YES;this._isMouseInsideRightIcon=YES;return YES}}}return NO},mouseUp:function(i){var c=NO,j,d,b,a,h,g;if(this._isMouseDownOnCheckbox){if(this._isInsideCheckbox(i)){j=this.displayDelegate;d=this.getDelegateProperty("contentCheckboxKey",j);b=this.get("content");if(b&&b.get){var f=b.get(d);f=(f===SC.MIXED_STATE)?YES:!f;b.set(d,f);this.displayDidChange()}}this._removeCheckboxActiveState();c=YES}else{if(this._isMouseDownOnDisclosure){if(this._isInsideDisclosure(i)){a=this.get("disclosureState");h=this.get("contentIndex");g=(!SC.none(h))?SC.IndexSet.create(h):null;j=this.get("displayDelegate");if(a===SC.BRANCH_OPEN){if(g&&j&&j.collapse){j.collapse(g)}else{this.set("disclosureState",SC.BRANCH_CLOSED)}this.displayDidChange()}else{if(a===SC.BRANCH_CLOSED){if(g&&j&&j.expand){j.expand(g)}else{this.set("disclosureState",SC.BRANCH_OPEN)}this.displayDidChange()}}}this._removeDisclosureActiveState();c=YES}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();c=YES}}}this._isMouseInsideCheckbox=this._isMouseDownOnCheckbox=NO;this._isMouseDownOnDisclosure=this._isMouseInsideDisclosure=NO;this._isMouseInsideRightIcon=this._isMouseDownOnRightIcon=NO;return c},mouseMoved:function(a){if(this._isMouseDownOnCheckbox&&this._isInsideCheckbox(a)){this._addCheckboxActiveState();this._isMouseInsideCheckbox=YES}else{if(this._isMouseDownOnCheckbox){this._removeCheckboxActiveState();this._isMouseInsideCheckbox=NO}else{if(this._isMouseDownOnDisclosure&&this._isInsideDisclosure(a)){this._addDisclosureActiveState();this._isMouseInsideDisclosure=YES}else{if(this._isMouseDownOnDisclosure){this._removeDisclosureActiveState();this._isMouseInsideDisclosure=NO}else{if(this._isMouseDownOnRightIcon&&this._isInsideRightIcon(a)){this._addRightIconActiveState();this._isMouseInsideRightIcon=YES}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();this._isMouseInsideRightIcon=NO}}}}}}return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},touchEntered:function(a){return this.mouseEntered(a)},touchExited:function(a){return this.mouseExited(a)},_addCheckboxActiveState:function(){if(this.get("isEnabled")){if(this._checkboxRenderDelegate){var a=this._checkboxRenderSource;a.set("isActive",YES);this._checkboxRenderDelegate.update(a,this.$(".sc-checkbox-view"))}else{this.$(".sc-checkbox-view").addClass("active")}}},_removeCheckboxActiveState:function(){if(this._checkboxRenderer){var a=this._checkboxRenderSource;a.set("isActive",NO);this._checkboxRenderDelegate.update(a,this.$(".sc-checkbox-view"))}else{this.$(".sc-checkbox-view").removeClass("active")}},_addDisclosureActiveState:function(){if(this.get("isEnabled")){if(this._disclosureRenderDelegate){var a=this._disclosureRenderSource;a.set("isActive",YES);this._disclosureRenderDelegate.update(a,this.$(".sc-disclosure-view"))}else{this.$(".sc-disclosure-view").addClass("active")}}},_removeDisclosureActiveState:function(){if(this._disclosureRenderer){var a=this._disclosureRenderSource;a.set("isActive",NO);this._disclosureRenderDelegate.update(a,this.$(".sc-disclosure-view"))}else{this.$(".sc-disclosure-view").addClass("active")}},_addRightIconActiveState:function(){this.$("img.right-icon").setClass("active",YES)},_removeRightIconActiveState:function(){this.$("img.right-icon").removeClass("active")},contentHitTest:function(b){var a=this.displayDelegate;var c=this.getDelegateProperty("contentValueKey",a);if(!c){return NO}var f=this.$label()[0];if(!f){return NO}var g=b.target,d=this.get("layer");while(g&&(g!==d)&&(g!==window)){if(g===f){return YES}g=g.parentNode}return NO},beginEditing:function(d,c){var g=this.$label(),f=this.get("parentView");if(c&&this.scrollToVisible()){var b=this.get("owner"),a=this.get("contentIndex");this.invokeLast(function(){var h=b.itemViewForContentIndex(a);if(h&&h.beginEditing){h.beginEditing(NO)}});return YES}else{if(!f||!g||g.get("length")===0){return NO}else{return d()}}}.enhance(),inlineEditorWillBeginEditing:function(d,p,o){var q=this.get("content"),j=this.get("displayDelegate"),i=this.getDelegateProperty("contentValueKey",j),k=this.get("parentView"),a=this.$label(),g=this.get("validator"),s,l,h,b,m,c,n,t,r,u;l=(i&&q)?(q.get?q.get(i):q[i]):q;s=this.computeFrameWithParentFrame(null);c=this._oldLineHeight=a.css("lineHeight");b=a.css("fontSize");m=this.$().css("top");if(m){m=parseInt(m.substring(0,m.length-2),0)}else{m=0}t=0;if(b&&c){r=b*1.5;if(r<c){a.css({lineHeight:"1.5"});t=(c-r)/2}else{oldLineHeight=null}}a=a[0];h=SC.offset(a);s.x=h.x;s.y=h.y+m+t;s.height=a.offsetHeight;s.width=a.offsetWidth;n=this.get("escapeHTML");d.set({value:l,exampleFrame:s,exampleElement:a,multiline:NO,isCollection:YES,validator:g,escapeHTML:n})},inlineEditorShouldBeginEditing:function(a){return YES},inlineEditorDidBeginEditing:function(b,d,f,a){b(d,f,a);var c=this.$label();this._oldOpacity=c.css("opacity");c.css("opacity",0);if(this._oldLineHeight){c.css({lineHeight:this._oldLineHeight})}}.enhance(),inlineEditorDidCommitEditing:function(d,g,c){var f=this.get("content");var a=this.displayDelegate;var b=this.getDelegateProperty("contentValueKey",a);if(b&&f){if(f.set){f.set(b,g)}else{f[b]=g}}else{this.set("content",g)}this.displayDidChange();this._endEditing()},_endEditing:function(a){this.$label().css("opacity",this._oldOpacity);a()}.enhance(),render:function(c,a){var g=this.get("content"),n=this.displayDelegate,b=this.get("outlineLevel"),f=this.get("outlineIndent"),m,k,j,o=[];o.push((this.get("contentIndex")%2===0)?"even":"odd");c.setClass("disabled",!this.get("isEnabled"));c.setClass("drop-target",this.get("isDropTarget"));j=c.begin("div").addClass("sc-outline");if(b>=0&&f>0){j.addStyle("left",f*(b+1))}k=this.get("disclosureState");if(k!==SC.LEAF_NODE){this.renderDisclosure(j,k);o.push("has-disclosure")}m=this.getDelegateProperty("contentCheckboxKey",n);if(m){k=g?(g.get?g.get(m):g[m]):NO;if(k!==null){this.renderCheckbox(j,k);o.push("has-checkbox")}}if(this.getDelegateProperty("hasContentIcon",n)){m=this.getDelegateProperty("contentIconKey",n);k=(m&&g)?(g.get?g.get(m):g[m]):null;if(k){this.renderIcon(j,k);o.push("has-icon")}}else{if(this.get("icon")){k=this.get("icon");this.renderIcon(j,k);o.push("has-icon")}}m=this.getDelegateProperty("contentValueKey",n);k=(m&&g)?(g.get?g.get(m):g[m]):g;if(k&&SC.typeOf(k)!==SC.T_STRING){k=k.toString()}if(this.get("escapeHTML")){k=SC.RenderContext.escapeHTML(k)}this.renderLabel(j,k);if(this.getDelegateProperty("hasContentRightIcon",n)){m=this.getDelegateProperty("contentRightIconKey",n);k=(m&&g)?(g.get?g.get(m):g[m]):null;this.renderRightIcon(j,k);o.push("has-right-icon")}m=this.getDelegateProperty("contentUnreadCountKey",n);k=(m&&g)?(g.get?g.get(m):g[m]):null;if(!SC.none(k)&&(k!==0)){this.renderCount(j,k);var d=["zero","one","two","three","four","five"];var l=k.toString().length;var i=d.length;var h=(l<i)?d[l]:d[i-1];o.push("has-count "+h+"-digit")}m=this.getDelegateProperty("listItemActionProperty",n);k=(m&&g)?(g.get?g.get(m):g[m]):null;if(k){this.renderAction(j,k);o.push("has-action")}if(this.getDelegateProperty("hasContentBranch",n)){m=this.getDelegateProperty("contentIsBranchKey",n);k=(m&&g)?(g.get?g.get(m):g[m]):NO;this.renderBranch(j,k);o.push("has-branch")}c.addClass(o);c=j.end()},renderDisclosure:function(a,d){var c=this.get("theme").disclosureRenderDelegate;a=a.begin("div").addClass("sc-disclosure-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(c.get("className"));var b=this._disclosureRenderSource;if(!b){this._disclosureRenderSource=b=SC.Object.create({renderState:{},theme:this.get("theme")})}b.set("isSelected",d===SC.BRANCH_OPEN).set("isEnabled",this.get("isEnabled")).set("title","");c.render(b,a);a=a.end();this._disclosureRenderDelegate=c},renderCheckbox:function(a,d){var c=this.get("theme").checkboxRenderDelegate;a=a.begin("div").addClass("sc-checkbox-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(c.get("className"));var b=this._checkboxRenderSource;if(!b){b=this._checkboxRenderSource=SC.Object.create({renderState:{},theme:this.get("theme")})}b.set("isSelected",d&&(d!==SC.MIXED_STATE)).set("isEnabled",this.get("isEnabled")&&this.get("contentIsEditable")).set("isActive",this._checkboxIsActive).set("title","");c.render(b,a);a=a.end();this._checkboxRenderDelegate=c},renderIcon:function(c,f){var b=null,d=null,a=[];if(f&&SC.ImageView.valueIsUrl(f)){b=f;d=""}else{d=f;b=SC.BLANK_IMAGE_URL}a.push(d,"icon");c.begin("img").addClass(a).attr("src",b).end()},renderLabel:function(b,a){b.push("<label>",a||"","</label>")},renderRightIcon:function(c,f){var b=null,d=null,a=[];if(f&&SC.ImageView.valueIsUrl(f)){b=f;d=""}else{d=f;b=SC.BLANK_IMAGE_URL}a.push("right-icon",d);c.begin("img").addClass(a).attr("src",b).end()},renderCount:function(a,b){a.push('<span class="count"><span class="inner">',b.toString(),"</span></span>")},renderAction:function(a,b){a.push('<img src="',SC.BLANK_IMAGE_URL,'" class="action" />')},renderBranch:function(c,b){var a=[];a.push("branch",b?"branch-visible":"branch-hidden");c.begin("span").addClass(a).push("&nbsp;").end()}});SC.ListItemView._deprecatedRenderWarningHasBeenIssued=false;sc_require("mixins/collection_view_delegate");sc_require("views/list_item");SC.DRAG_REORDER=16;SC.BENCHMARK_RELOAD=NO;SC.CollectionView=SC.View.extend(SC.CollectionViewDelegate,SC.CollectionContent,{classNames:["sc-collection-view"],displayProperties:["hasFirstResponder","isEnabled","isActive"],renderDelegateName:"collectionRenderDelegate",ACTION_DELAY:200,useFastPath:NO,content:null,contentBindingDefault:SC.Binding.multiple(),length:0,nowShowing:function(){return this.computeNowShowing()}.property("length","clippingFrame").cacheable(),selection:null,isSelectable:YES,isSelectableBindingDefault:SC.Binding.bool(),isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),isEditable:YES,isEditableBindingDefault:SC.Binding.bool(),canReorderContent:NO,canReorderContentBindingDefault:SC.Binding.bool(),canDeleteContent:NO,canDeleteContentBindingDefault:SC.Binding.bool(),canEditContent:NO,canEditContentBindingDefault:SC.Binding.bool(),isDropTarget:NO,useToggleSelection:NO,actOnSelect:NO,selectOnMouseDown:YES,exampleView:SC.ListItemView,contentExampleViewKey:null,groupExampleView:null,contentGroupExampleViewKey:null,action:null,target:null,contentValueKey:null,acceptsFirstResponder:NO,isActive:NO,calculatedHeight:0,calculatedWidth:0,computeLayout:function(){return null},layoutForContentIndex:function(a){return null},allContentIndexes:function(){return SC.IndexSet.create(0,this.get("length")).freeze()}.property("length").cacheable(),contentIndexesInRect:function(a){return null},computeNowShowing:function(){var c=this.contentIndexesInRect(this.get("clippingFrame"));if(!c){c=this.get("allContentIndexes")}else{var b=this.get("length"),a=c.get("max");if(a>b){c=c.copy().remove(b,a-b).freeze()}}return c},showInsertionPoint:function(a,b){},hideInsertionPoint:function(){},delegate:null,selectionDelegate:function(){var a=this.get("delegate"),b=this.get("content");return this.delegateFor("isCollectionViewDelegate",a,b)}.property("delegate","content").cacheable(),contentDelegate:function(){var a=this.get("delegate"),b=this.get("content");return this.delegateFor("isCollectionContent",a,b)}.property("delegate","content").cacheable(),_contentGroupIndexes:function(){return this.get("contentDelegate").contentGroupIndexes(this,this.get("content"))}.property("contentDelegate","content").cacheable(),contentRangeDidChange:function(d,b,c,a){if(!b&&(c==="[]")){this.notifyPropertyChange("_contentGroupIndexes");this.reload(a)}else{this.contentPropertyDidChange(b,c,a)}},contentPropertyDidChange:function(c,b,a){},updateContentRangeObserver:function(){var d=this.get("nowShowing"),a=this._cv_contentRangeObserver,c=this.get("content");if(!c){return}if(a){c.updateRangeObserver(a,d)}else{var b=this.contentRangeDidChange;a=c.addRangeObserver(d,this,b,null);this._cv_contentRangeObserver=a}},removeContentRangeObserver:function(){var b=this.get("content"),a=this._cv_contentRangeObserver;if(a){if(b){b.removeRangeObserver(a)}this._cv_contentRangeObserver=null}},contentLengthDidChange:function(){var a=this.get("content");this.set("length",a?a.get("length"):0);this.computeLayout()},_cv_contentDidChange:function(){var b=this.get("content"),a=this.contentLengthDidChange;if(b===this._content){return}this.removeContentRangeObserver();if(this._content){this._content.removeObserver("length",this,a)}this._content=b;if(b){b.addObserver("length",this,a)}this.contentLengthDidChange();this.contentRangeDidChange(b,null,"[]",null)}.observes("content"),_invalidIndexes:NO,reload:function(a){var b=this._invalidIndexes;if(a&&b!==YES){if(b){b.add(a)}else{b=this._invalidIndexes=a.clone()}}else{this._invalidIndexes=YES}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadIfNeeded)}return this},reloadIfNeeded:function(){var y=this._invalidIndexes;if(!y||!this.get("isVisibleInWindow")){return this}this._invalidIndexes=NO;var v=this.get("content"),w,x,o,A=this.computeLayout(),z=SC.BENCHMARK_RELOAD,c=this.get("nowShowing"),B=this._sc_itemViews,p=this.get("containerView")||this,a,s,u,t,m,q,j,r,f,n,l,C,d,b,h,k,g;if(y.isIndexSet&&y.contains(c)){y=YES}if(this.willReload){this.willReload(y===YES?null:y)}a=this.get("exampleView");u=a?a.isReusableInCollections:NO;s=this.get("groupExampleView");t=s?s.isReusableInCollections:NO;if(y.isIndexSet){if(z){SC.Benchmark.start(z="%@#reloadIfNeeded (Partial)".fmt(this),YES)}q=[];j=[];r=[];y.forEach(function(i){o=B?B[i]:null;if(c.contains(i)){if(o&&o.parentView===p){j.push(i)}else{r.push(i)}}else{if(o&&o.parentView===p){q.push(i)}}},this);for(w=0,x=q.length;w<x;++w){n=q[w];o=B?B[n]:null;delete B[n];h=this.get("contentDelegate");k=this.get("_contentGroupIndexes");g=k&&k.contains(n);if(g){g=h.contentIndexIsGroup(this,v,n)}m=g?t:u;if(m){b=g?this._GROUP_VIEW_POOL:this._VIEW_POOL;b.push(o);o.destroyLayer()}C=o.get("layer");if(C&&C.parentNode){C.parentNode.removeChild(C)}p.removeChild(o);if(!m){o.destroy()}}for(w=0,x=j.length;w<x;++w){n=j[w];o=B?B[n]:null;l=this.itemViewForContentIndex(n,YES);o.destroyLayer();p.replaceChild(l,o)}for(w=0,x=r.length;w<x;++w){n=r[w];l=this.itemViewForContentIndex(n,YES);p.insertBefore(l,null)}if(z){SC.Benchmark.end(z)}}else{if(z){SC.Benchmark.start(z="%@#reloadIfNeeded (Full)".fmt(this),YES)}if(B){B.length=0}f=p.get("childViews");if(f){f=f.copy()}p.beginPropertyChanges();if(this.willRemoveAllChildren){this.willRemoveAllChildren()}p.destroyLayer().removeAllChildren();if(f){for(w=0,x=f.length;w<x;++w){l=f[w];g=l.get("isGroupView");m=g?t:u;if(m){b=g?this._GROUP_VIEW_POOL:this._VIEW_POOL;b.push(l);l.destroyLayer()}else{l.destroy()}}}f=[];c.forEach(function(i){f.push(this.itemViewForContentIndex(i,YES))},this);p.set("childViews",f);p.replaceLayer();p.endPropertyChanges();if(z){SC.Benchmark.end(z)}}if(A){this.adjust(A)}if(this.didReload){this.didReload(y===YES?null:y)}return this},_TMP_ATTRS:{},_COLLECTION_CLASS_NAMES:["sc-collection-item"],_GROUP_COLLECTION_CLASS_NAMES:["sc-collection-item","sc-group-item"],_VIEW_POOL:null,_GROUP_VIEW_POOL:null,itemViewForContentIndex:function(m,a){var w;var v=this._sc_itemViews;if(!v){v=this._sc_itemViews=[]}else{if(!a&&(w=v[m])){return w}}var o=this.get("content"),q=o.objectAt(m),i=this.get("contentDelegate"),k=this.get("_contentGroupIndexes"),j=NO,x,l,r,g,s,d,b,c,u,h,f,p,t;j=k&&k.contains(m);if(j){j=i.contentIndexIsGroup(this,o,m)}if(j){x=this.get("contentGroupExampleViewKey");if(x&&q){l=q.get(x)}if(!l){l=this.get("groupExampleView")||this.get("exampleView")}s="_GROUP_VIEW_POOL"}else{x=this.get("contentExampleViewKey");if(x&&q){l=q.get(x)}if(!l){l=this.get("exampleView")}s="_VIEW_POOL"}c=this.get("containerView")||this;g=this.layerIdFor(m);u=i.contentIndexIsEnabled(this,o,m);h=i.contentIndexIsSelected(this,o,m);f=i.contentIndexOutlineLevel(this,o,m);p=i.contentIndexDisclosureState(this,o,m);t=this.isVisibleInWindow;r=this.layoutForContentIndex(m);if(l&&l.isReusableInCollections){d=this[s];if(!d){d=this[s]=[]}if(d.length>0){w=d.pop();b=w.prepareForReuse;if(b){b.call(w)}w.beginPropertyChanges();w.set("contentIndex",m);w.set("layerId",g);w.set("isEnabled",u);w.set("isSelected",h);w.set("outlineLevel",f);w.set("disclosureState",p);w.set("isVisibleInWindow",t);w.set("parentView",c);SC.View.views[g]=w;if(r){w.set("layout",r)}else{w.set("layout",l.prototype.layout)}w.set("content",q);w.endPropertyChanges()}}if(!w){var n=this._TMP_ATTRS;n.contentIndex=m;n.content=q;n.owner=n.displayDelegate=this;n.parentView=c;n.page=this.page;n.layerId=g;n.isEnabled=u;n.isSelected=h;n.outlineLevel=f;n.disclosureState=p;n.isGroupView=j;n.isVisibleInWindow=t;if(j){n.classNames=this._GROUP_COLLECTION_CLASS_NAMES}else{n.classNames=this._COLLECTION_CLASS_NAMES}if(r){n.layout=r}else{delete n.layout}w=this.createItemView(l,m,n)}v[m]=w;return w},itemViewForContentObject:function(a){return this.itemViewForContentIndex(this.get("content").indexOf(a))},_TMP_LAYERID:[],createItemView:function(c,a,b){return c.create(b)},layerIdFor:function(a){var b=this._TMP_LAYERID;b[0]=SC.guidFor(this);b[1]=a;return b.join("-")},contentIndexForLayerId:function(c){if(!c||!(c=c.toString())){return null}var b=this._baseLayerId;if(!b){b=this._baseLayerId=SC.guidFor(this)+"-"}if((c.length<=b.length)||(c.indexOf(b)!==0)){return null}var a=Number(c.slice(c.lastIndexOf("-")+1));return isNaN(a)?null:a},itemViewForEvent:function(k){var d=this.getPath("pane.rootResponder");if(!d){return null}var c=SC.guidFor(this)+"-",a=c.length,f=k.target,h=this.get("layer"),g=null,b,j,i;while(f&&f!==document&&f!==h){b=f?SC.$(f).attr("id"):null;if(b&&(g=this.contentIndexForLayerId(b))!==null){break}f=f.parentNode}if(g===null||(f===h)){f=h=null;return null}if(g>=this.get("length")){throw"layout for item view %@ was found when item view does not exist (%@)".fmt(b,this)}return this.itemViewForContentIndex(g)},expand:function(b){if(!b){return this}var a=this.get("contentDelegate"),c=this.get("content");b.forEach(function(d){var f=a.contentIndexDisclosureState(this,c,d);if(f===SC.BRANCH_CLOSED){a.contentIndexExpand(this,c,d)}},this);return this},collapse:function(b){if(!b){return this}var a=this.get("contentDelegate"),c=this.get("content");b.forEach(function(d){var f=a.contentIndexDisclosureState(this,c,d);if(f===SC.BRANCH_OPEN){a.contentIndexCollapse(this,c,d)}},this);return this},_cv_selectionDidChange:function(){var c=this.get("selection"),b=this._cv_selection,a=this._cv_selectionContentDidChange;if(c===b){return}if(b){b.removeObserver("[]",this,a)}if(c){c.addObserver("[]",this,a)}this._cv_selection=c;this._cv_selectionContentDidChange()}.observes("selection"),_cv_selectionContentDidChange:function(){var c=this.get("selection"),b=this._cv_selindexes,a=this.get("content"),d;this._cv_selindexes=c?c.frozenCopy():null;if(b){b=b.indexSetForSource(a)}if(c){c=c.indexSetForSource(a)}if(c&&b){d=c.without(b).add(b.without(c))}else{d=c||b}if(d&&d.get("length")>0){this.reloadSelectionIndexes(d)}},_invalidSelection:NO,reloadSelectionIndexes:function(a){var b=this._invalidSelection;if(a&&(b!==YES)){if(b){b.add(a)}else{b=this._invalidSelection=a.copy()}}else{this._invalidSelection=YES}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)}return this},reloadSelectionIndexesIfNeeded:function(){var f=this._invalidSelection;if(!f||!this.get("isVisibleInWindow")){return this}var d=this.get("nowShowing"),b=this._invalidIndexes,a=this.get("content"),c=this.get("selection");this._invalidSelection=NO;if(b===YES||!d){return this}if(f===YES){f=d}if(b&&b.isIndexSet){f=f.without(b)}f.forEach(function(g){if(!d.contains(g)){return}var h=this.itemViewForContentIndex(g,NO);if(h){h.set("isSelected",c?c.contains(a,g):NO)}},this);return this},select:function(c,g){var d=this.get("content"),a=this.get("selectionDelegate"),b=this.get("_contentGroupIndexes"),f;if(!this.get("isSelectable")||!this.get("isEnabled")){return this}if(SC.typeOf(c)===SC.T_NUMBER){c=SC.IndexSet.create(c,1)}if(c&&c.get("length")>0){if(b&&b.get("length")>0){c=c.copy().remove(b)}c=a.collectionViewShouldSelectIndexes(this,c,g);if(!c||c.get("length")===0){return this}}else{c=null}if(g&&(f=this.get("selection"))){f=f.copy()}else{f=SC.SelectionSet.create()}if(c&&c.get("length")>0){if(c.get("length")===1){f.addObject(d.objectAt(c.get("firstObject")))}else{f.add(d,c)}}f=a.collectionViewSelectionForProposedSelection(this,f);if(!f){f=SC.SelectionSet.create()}this._selectionAnchor=null;this.set("selection",f.freeze());return this},deselect:function(b){var d=this.get("selection"),c=this.get("content"),a=this.get("selectionDelegate");if(!this.get("isSelectable")||!this.get("isEnabled")){return this}if(!d||d.get("length")===0){return this}if(SC.typeOf(b)===SC.T_NUMBER){b=SC.IndexSet.create(b,1)}b=a.collectionViewShouldDeselectIndexes(this,b);if(!b||b.get("length")===0){return this}d=d.copy().remove(c,b);d=a.collectionViewSelectionForProposedSelection(this,d);if(!d){d=SC.SelectionSet.create()}this.set("selection",d.freeze());return this},_findNextSelectableItemFromIndex:function(i,a){var c=this.get("length"),d=SC.IndexSet.create(),f=this.get("content"),j=this.get("selectionDelegate"),h=this.get("_contentGroupIndexes"),g,b;if(!h&&(j.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return i}while(i<c){if(!h||!h.contains(i)){d.add(i);g=j.collectionViewShouldSelectIndexes(this,d);if(g&&g.get("length")>=1){return i}d.remove(i)}i++}if(a===undefined){b=this.get("selection");a=b?b.get("max"):-1}return a},_findPreviousSelectableItemFromIndex:function(b,i){var c=SC.IndexSet.create(),g=this.get("content"),a=this.get("selectionDelegate"),f=this.get("_contentGroupIndexes"),d;if(SC.none(b)){b=-1}if(!f&&(a.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return b}while(b>=0){if(!f||!f.contains(b)){c.add(b);d=a.collectionViewShouldSelectIndexes(this,c);if(d&&d.get("length")>=1){return b}c.remove(b)}b--}if(i===undefined){var h=this.get("selection");i=h?h.get("min"):-1}if(SC.none(i)){i=-1}return i},selectPreviousItem:function(i,b){if(SC.none(b)){b=1}if(SC.none(i)){i=false}var g=this.get("selection"),f=this.get("content");if(g){g=g.indexSetForSource(f)}var h=g?g.get("min"):-1,a=g?g.get("max")-1:-1,d=this._selectionAnchor;if(SC.none(d)){d=h}if(i){if(a>d){a=a-b}else{h=this._findPreviousSelectableItemFromIndex(h-b)}if(SC.none(h)||(h<0)){h=0}if(!f.objectAt(h)){h=g?g.get("min"):-1}if(a<h){a=h}}else{h=this._findPreviousSelectableItemFromIndex(h-b);if(SC.none(h)||(h<0)){h=0}if(!f.objectAt(h)){h=g?g.get("min"):-1}a=h;d=null}var c=h;g=SC.IndexSet.create(h,a+1-h);this.scrollToContentIndex(c);this.select(g);this._selectionAnchor=d;return this},selectNextItem:function(i,j){if(SC.none(j)){j=1}if(SC.none(i)){i=false}var b=this.get("selection"),h=this.get("content");if(b){b=b.indexSetForSource(h)}var a=b?b.get("min"):-1,d=b?b.get("max")-1:-1,f=this._selectionAnchor,c=this.get("length");if(SC.none(f)){f=a}if(i){if(a<f){a=a+j}else{d=this._findNextSelectableItemFromIndex(d+j,d)}if(d>=c){d=c-1}if(!h.objectAt(d)){d=b?b.get("max")-1:-1}if(a>d){a=d}}else{d=this._findNextSelectableItemFromIndex(d+j,d);if(d>=c){d=c-1}if(!h.objectAt(d)){d=b?b.get("max")-1:-1}a=d;f=null}var g=d;b=SC.IndexSet.create(a,d-a+1);this.scrollToContentIndex(g);this.select(b);this._selectionAnchor=f;return this},deleteSelection:function(){if(!this.get("canDeleteContent")){return NO}var d=this.get("selection"),c=this.get("content"),a=this.get("selectionDelegate"),b=d&&c?d.indexSetForSource(c):null;if(!c||!b||b.get("length")===0){return NO}b=a.collectionViewShouldDeleteIndexes(this,b);if(!b||b.get("length")===0){return NO}a.collectionViewDeleteContent(this,this.get("content"),b);return YES},scrollToContentIndex:function(b){var a=this.itemViewForContentIndex(b);if(a){this.scrollToItemView(a)}return this},scrollToItemView:function(a){if(a){a.scrollToVisible()}return this},keyDown:function(a){var b=this.interpretKeyEvents(a);return !b?NO:b},keyUp:function(){return true},insertText:function(b,a){if(b===" "){var c=this.get("selection");if(c&&c.get("length")>0){this.invokeLater(this._cv_action,0,null,a)}return YES}else{return NO}},selectAll:function(a){var b=this.get("content"),c=b?SC.IndexSet.create(0,b.get("length")):null;this.select(c,NO);return YES},deselectAll:function(){var a=this.get("content"),b=a?SC.IndexSet.create(0,a.get("length")):null;this.deselect(b,NO);return YES},deleteBackward:function(a){return this.deleteSelection()},deleteForward:function(a){return this.deleteSelection()},moveDown:function(b,a){this.selectNextItem(false,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveUp:function(b,a){this.selectPreviousItem(false,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveLeft:function(l){if(l.ctrlKey||l.metaKey){return NO}if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(false,1);this._cv_performSelectAction(null,l,this.ACTION_DELAY)}else{var c=this.get("selection"),j=this.get("content"),h=c?c.indexSetForSource(j):null;if(h){var m=undefined,g=false,i=undefined;if(h.get("length")===1){i=h.get("firstObject");m=this.get("contentDelegate");var b=m.contentIndexDisclosureState(this,j,i);if(b!==SC.BRANCH_OPEN){g=true}}if(g){var a=m.contentIndexOutlineLevel(this,j,i)-1;if(a>=0){var f=-1;while(f<0){var d=this._findPreviousSelectableItemFromIndex(i-1);if(d<0){return false}i=d;var k=m.contentIndexOutlineLevel(this,j,i);if(k===a){f=d}}if(f!==-1){this.select(i)}}}else{this.collapse(h)}}}return true},moveRight:function(a){if(a.ctrlKey||a.metaKey){return NO}if((this.get("itemsPerRow")||1)>1){this.selectNextItem(false,1);this._cv_performSelectAction(null,a,this.ACTION_DELAY)}else{var d=this.get("selection"),c=this.get("content"),b=d?d.indexSetForSource(c):null;if(b){this.expand(b)}}return true},moveDownAndModifySelection:function(b,a){this.selectNextItem(true,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveUpAndModifySelection:function(b,a){this.selectPreviousItem(true,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveLeftAndModifySelection:function(b,a){if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(true,1);this._cv_performSelectAction(null,a,this.ACTION_DELAY)}return true},moveRightAndModifySelection:function(b,a){if((this.get("itemsPerRow")||1)>1){this.selectNextItem(true,1);this._cv_performSelectAction(null,a,this.ACTION_DELAY)}return true},insertNewline:function(d,c){var b=this.get("isEditable")&&this.get("canEditContent"),h,g,i,a,f;if(b){h=this.get("selection");g=this.get("content");if(h&&h.get("length")===1){i=h.indexSetForSource(g);a=i?i.get("min"):-1;b=a>=0}}if(b){f=this.itemViewForContentIndex(a);b=f&&SC.typeOf(f.beginEditing)===SC.T_FUNCTION}if(b){this.scrollToContentIndex(a);f=this.itemViewForContentIndex(a);f.beginEditing()}else{this.invokeLater(this._cv_action,0,f,null)}return YES},insertTab:function(b){var a=this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},insertBacktab:function(b){var a=this.get("previousValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},mouseDown:function(k){var h=this.get("content");if(!h){return this.get("isSelectable")}var i=this.itemViewForEvent(k),f=i?i.get("contentIndex"):-1,c,d,b,a,l,g=NO,j=h.get("allowsMultipleSelection");if(!this.get("isEnabled")){return f>-1}if(!this.get("isSelectable")){return NO}this.becomeFirstResponder();if(this.get("useToggleSelection")){if(this.get("selectOnMouseDown")){if(!i){return}b=this.get("selection");a=b&&b.containsObject(i.get("content"));if(a){this.deselect(f)}else{if(!j){this.select(f,NO);g=YES}else{this.select(f,YES);g=YES}}if(g&&this.get("actOnSelect")){this._cv_performSelectAction(i,k)}}return YES}if(!i){if(this.get("allowDeselectAll")){this.select(null,false)}return YES}b=this.get("selection");if(b){b=b.indexSetForSource(h)}c=this.mouseDownInfo={event:k,itemView:i,contentIndex:f,at:Date.now()};a=b?b.contains(f):NO;c.modifierKeyPressed=l=k.ctrlKey||k.metaKey;if(l&&a){c.shouldDeselect=f>=0}else{if(k.shiftKey&&b&&b.get("length")>0&&j){b=this._findSelectionExtendedByShift(b,f);d=this._selectionAnchor;this.select(b);this._selectionAnchor=d}else{if(!l&&a){c.shouldReselect=f>=0}else{if((k.shiftKey||l)&&!j){this.select(null,false)}if(this.get("selectOnMouseDown")){this.select(f,l)}else{c.shouldSelect=f>=0}}}}c.previousContentIndex=f;return YES},mouseUp:function(j){var k=this.itemViewForEvent(j),d=this.mouseDownInfo,g=this.get("content"),f=k?k.get("contentIndex"):-1,c,a,b,h,l,i=g.get("allowsMultipleSelection");if(!this.get("isEnabled")){return f>-1}if(!this.get("isSelectable")){return NO}if(this.get("useToggleSelection")){if(!k||this.get("selectOnMouseDown")){return NO}c=this.get("selection");a=c&&c.containsObject(k.get("content"));if(a){this.deselect(f)}else{if(!i){this.select(f,NO)}else{this.select(f,YES)}}}else{if(d){l=d.contentIndex;f=(k)?k.get("contentIndex"):-1;if(d.shouldSelect){this.select(l,d.modifierKeyPressed)}if(d.shouldDeselect){this.deselect(l)}if(d.shouldReselect){b=this.get("isEditable")&&this.get("canEditContent");if(b){c=this.get("selection");b=c&&(c.get("length")===1)}if(b){h=this.itemViewForContentIndex(l);b=h&&(!h.contentHitTest||h.contentHitTest(j));b=(b&&h.beginEditing)?h.beginEditing():NO}if(!b){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()}this._cv_reselectTimer=this.invokeLater(this.select,300,l,false)}}this._cleanupMouseDown()}}this._cv_performSelectAction(k,j,0,j.clickCount);return NO},_cleanupMouseDown:function(){var b=this.mouseDownInfo,a;if(b){for(a in b){if(!b.hasOwnProperty(a)){continue}delete b[a]}}this.mouseDownInfo=null},mouseMoved:function(c){var a=this.itemViewForEvent(c),b=this._lastHoveredItem;if(a!==b){if(b&&b.mouseExited){b.mouseExited(c)}if(a&&a.mouseEntered){a.mouseEntered(c)}}this._lastHoveredItem=a;if(a&&a.mouseMoved){a.mouseMoved(c)}return YES},mouseExited:function(b){var a=this._lastHoveredItem;this._lastHoveredItem=null;if(a&&a.mouseExited){a.mouseExited(b)}return YES},touchStart:function(d,a){var b=this.itemViewForEvent(d),c=b?b.get("contentIndex"):-1;if(!this.get("isEnabled")){return c>-1}this.becomeFirstResponder();this._touchSelectedView=b;if(!this.get("useToggleSelection")){if(b&&!b.get("isSelected")){b.set("isSelected",YES)}}return YES},touchesDragged:function(a,b){b.forEach(function(c){if(Math.abs(c.pageX-c.startX)>5||Math.abs(c.pageY-c.startY)>5){c.makeTouchResponder(c.nextTouchResponder)}},this)},touchEnd:function(f){var b=this._touchSelectedView,d=b?b.get("contentIndex"):-1,a=NO,c;if(!this.get("isEnabled")){return d>-1}if(b){b.set("isSelected",NO)}if(d>-1){if(this.get("useToggleSelection")){c=this.get("selection");a=c&&c.containsObject(b.get("content"))}if(a){this.deselect(d)}else{this.select(d,NO);this._cv_performSelectAction(b,f,0)}}this._touchSelectedView=null},touchCancelled:function(a){if(this._touchSelectedView){this._touchSelectedView.set("isSelected",NO);this._touchSelectedView=null}},_findSelectionExtendedByShift:function(f,i){if(!f||f.get("length")===0){return SC.IndexSet.create(i)}var d=this.get("content"),h=d.get("length")-1,c=f.get("min"),a=f.get("max")-1,g=this.mouseDownInfo,b=this._selectionAnchor;if(SC.none(b)){b=-1}if(i<c){c=i;if(b<0){this._selectionAnchor=b=a}}else{if(i>a){a=i;if(b<0){this._selectionAnchor=b=c}}else{if(i>=c&&i<=a){if(b<0){this._selectionAnchor=b=c}if(i===b){c=a=i}else{if(i>b){c=b;a=i}else{if(i<b){c=i;a=b}}}}}}return SC.IndexSet.create(c,a-c+1)},reorderDataType:function(){return"SC.CollectionView.Reorder."+SC.guidFor(this)}.property().cacheable(),dragContent:null,proposedInsertionIndex:null,proposedDropOperation:null,mouseDragged:function(i){var j=this.get("selectionDelegate"),f=this.get("content"),a=this.get("selection"),c=this.mouseDownInfo,g=this.get("_contentGroupIndexes"),d,b,h;if(!c||c.contentIndex<0){return YES}if((Date.now()-c.at)<123){return YES}if(j.collectionViewShouldBeginDrag(this)){if(!this.get("selectOnMouseDown")){d=SC.IndexSet.create(c.contentIndex)}else{d=a?a.indexSetForSource(f):null}if(d&&g&&g.get("length")>0){d=d.copy().remove(g);if(d.get("length")===0){d=null}else{d.freeze()}}if(!d){return YES}else{d=d.frozenCopy()}d={content:f,indexes:d};this.set("dragContent",d);b=this.get("dragDataTypes");if(b&&b.get("length")>0){h=j.collectionViewDragViewFor(this,d.indexes);if(!h){h=this._cv_dragViewFor(d.indexes)}h.createLayer();SC.Drag.start({event:c.event,source:this,dragView:h,ghost:NO,ghostActsLikeCursor:j.ghostActsLikeCursor,slideBack:YES,dataSource:this});this._cleanupMouseDown();this._lastInsertionIndex=null}else{this.set("dragContent",null)}return YES}},_cv_dragViewFor:function(g){var c=this.get("nowShowing").without(g),d=this.get("layer").cloneNode(false),b=SC.View.create({layer:d,parentView:this}),a=0,f;c=this.get("nowShowing").without(c);SC.$(d).css("backgroundColor","transparent").css("border","none").css("top",0).css("left",0);c.forEach(function(k){var l=this.itemViewForContentIndex(k),h,j;if(l){h=l.get("isSelected");l.set("isSelected",NO);l.updateLayerIfNeeded();j=l.get("layer");if(j){j=j.cloneNode(true)}l.set("isSelected",h);l.updateLayerIfNeeded()}if(j){d.appendChild(j);f=l.get("layout");if(f.height+f.top>a){a=f.height+f.top}}j=null},this);b.set("layout",{height:a});d=null;return b},dragDataTypes:function(){var a=this.get("selectionDelegate"),b=a.collectionViewDragDataTypes(this),c;if(this.get("canReorderContent")){b=b?b.copy():[];c=this.get("reorderDataType");if(b.indexOf(c)<0){b.push(c)}}return b?b:[]}.property(),dragDataForType:function(c,b){if(this.get("canReorderContent")){if(b===this.get("reorderDataType")){return this.get("dragContent")}}var a=this.get("selectionDelegate");return a.collectionViewDragDataForType(this,c,b)},computeDragOperations:function(c,b){var d=SC.DRAG_NONE,a=this.get("selectionDelegate");if(this.get("canReorderContent")){if(c.get("dataTypes").indexOf(this.get("reorderDataType"))>=0){d=SC.DRAG_REORDER}}d=a.collectionViewComputeDragOperations(this,c,d);if(d&SC.DRAG_REORDER){d=SC.DRAG_MOVE}return d},_computeDropOperationState:function(c,m,f){var h=this.convertFrameFromView(c.get("location"),null),l=SC.DROP_BEFORE,n=this.get("selectionDelegate"),d=this.get("canReorderContent"),o,i,a,j,g,b;var k=this.insertionIndexForLocation(h,SC.DROP_ON);if(SC.typeOf(k)===SC.T_ARRAY){l=k[1];k=k[0]}if(l===SC.DROP_ON){this.set("proposedInsertionIndex",k);this.set("proposedDropOperation",l);b=n.collectionViewValidateDragOperation(this,c,f,k,l);k=this.get("proposedInsertionIndex");l=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;if(b!==SC.DRAG_NONE){return[k,l,b]}else{l=SC.DROP_BEFORE;k=this.insertionIndexForLocation(h,SC.DROP_BEFORE);if(SC.typeOf(k)===SC.T_ARRAY){l=k[1];k=k[0]}}}if((k>=0)&&d&&(l!==SC.DROP_ON)){o=c.dataForType(this.get("reorderDataType"));if(o){i=this.get("content");if(l===SC.DROP_BEFORE){a=o.indexes.contains(k-1);j=o.indexes.contains(k)}else{a=o.indexes.contains(k);j=o.indexes.contains(k-1)}if(a&&j){if(SC.none(this._lastInsertionIndex)){if(l===SC.DROP_BEFORE){while((k>=0)&&o.indexes.contains(k)){k--}}else{g=i?i.get("length"):0;while((k<g)&&o.indexes.contains(k)){k++}}}else{k=this._lastInsertionIndex}}if(k>=0){f=SC.DRAG_REORDER}}}this.set("proposedInsertionIndex",k);this.set("proposedDropOperation",l);f=n.collectionViewValidateDragOperation(this,c,f,k,l);k=this.get("proposedInsertionIndex");l=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;return[k,l,f]},dragUpdated:function(g,b){var i=g.get("allowedDragOperations"),h=this._computeDropOperationState(g,b,i),a=h[0],c=h[1],f=h[2];if(f!==SC.DRAG_NONE){if((this._lastInsertionIndex!==a)||(this._lastDropOperation!==c)){var d=this.itemViewForContentIndex(a);this.showInsertionPoint(d,c)}this._lastInsertionIndex=a;this._lastDropOperation=c}else{this.hideInsertionPoint();this._lastInsertionIndex=this._lastDropOperation=null}return(f&SC.DRAG_REORDER)?SC.DRAG_MOVE:f},dragExited:function(){this.hideInsertionPoint();this._lastInsertionIndex=this._lastDropOperation=null},acceptDragOperation:function(a,b){return YES},performDragOperation:function(f,h){var a=this._computeDropOperationState(f,null,h),l=a[0],k=a[1],i=a[2],m=this.get("selectionDelegate"),c,n,d,j,b,g;if(i&SC.DRAG_REORDER){h=(h&SC.DRAG_MOVE)?SC.DRAG_REORDER:SC.DRAG_NONE}else{h=h&i}if(h===SC.DRAG_NONE){return h}c=m.collectionViewPerformDragOperation(this,f,h,l,k);if((c===SC.DRAG_NONE)&&(h&SC.DRAG_REORDER)){d=f.dataForType(this.get("reorderDataType"));if(!d){return SC.DRAG_NONE}j=this.get("content");g=d.indexes;if(g.get("length")===1){if(((k===SC.DROP_BEFORE)||(k===SC.DROP_AFTER))&&(g.get("min")===l)){return SC.DRAG_MOVE}}j.beginPropertyChanges();n=[];b=0;d.indexes.forEach(function(o){n.push(j.objectAt(o-b));j.removeAt(o-b);b++;if(o<l){l--}},this);if(k===SC.DROP_AFTER){l++}j.replace(l,0,n,k);this.select(SC.IndexSet.create(l,n.length));j.endPropertyChanges();h=SC.DRAG_MOVE}return h},collectionViewShouldBeginDrag:function(a){return this.get("canReorderContent")},insertionIndexForLocation:function(a,b){return -1},_cv_isVisibleInWindowDidChange:function(){if(this.get("isVisibleInWindow")){if(this._invalidIndexes){this.invokeOnce(this.reloadIfNeeded)}if(this._invalidSelection){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)}}}.observes("isVisibleInWindow"),collectionViewShouldSelectItem:function(a,b){return this.get("isSelectable")},_TMP_DIFF1:SC.IndexSet.create(),_TMP_DIFF2:SC.IndexSet.create(),_cv_nowShowingDidChange:function(){var b=this.get("nowShowing"),a=this._sccv_lastNowShowing,d,f,c;if(a!==b){if(a&&b){f=this._TMP_DIFF1.add(a).remove(b);c=this._TMP_DIFF2.add(b).remove(a);d=f.add(c)}else{d=a||b}}if(d&&d.get("length")>0){this._sccv_lastNowShowing=b?b.frozenCopy():null;this.updateContentRangeObserver();this.reload(d)}if(f){f.clear()}if(c){c.clear()}}.observes("nowShowing"),init:function(){arguments.callee.base.apply(this,arguments);if(this.useFastPath){this.mixin(SC.CollectionFastPath)}if(this.get("canReorderContent")){this._cv_canReorderContentDidChange()}this._sccv_lastNowShowing=this.get("nowShowing").clone();if(this.content){this._cv_contentDidChange()}if(this.selection){this._cv_selectionDidChange()}},_cv_canReorderContentDidChange:function(){if(this.get("canReorderContent")){if(!this.get("isDropTarget")){this.set("isDropTarget",YES)}SC.Drag.addDropTarget(this)}}.observes("canReorderContent"),_cv_performSelectAction:function(b,d,c,a){var f;if(c===undefined){c=0}if(a===undefined){a=1}if((a>1)||this.get("actOnSelect")){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()}f=this.get("selection");f=f?f.toArray():[];if(this._cv_actionTimer){this._cv_actionTimer.invalidate()}this._cv_actionTimer=this.invokeLater(this._cv_action,c,b,d,f)}},_cv_action:function(b,a,c){var d=this.get("action");var f=this.get("target")||null;this._cv_actionTimer=null;if(d){if(SC.typeOf(d)===SC.T_FUNCTION){return this.action(b,a)}var g=this.get("pane");if(g){g.rootResponder.sendAction(d,f,this,g,c)}}else{if(!b){return}else{if(SC.typeOf(b._action)==SC.T_FUNCTION){return b._action(a)}else{if(SC.typeOf(b.action)==SC.T_FUNCTION){return b.action(a)}}}}}});SC.DateFieldView=SC.TextFieldView.extend({value:null,showDate:YES,showTime:NO,formatTime:"%I:%M %p",formatDate:"%d/%m/%Y",formatDateTime:"%d/%m/%Y %I:%M %p",_dtConstants:["%a","%b","%d","%H","%I","%j","%m","%M","%p","%S","%U","%W","%y","%Y"],_wtConstants:[3,3,2,2,2,3,2,2,2,2,2,2,2,4],activeSelection:0,format:function(){var a=this.get("showTime");var b=this.get("showDate");if(a===YES&&b===YES){return this.get("formatDateTime")}if(a===YES){return this.get("formatTime")}return this.get("formatDate")}.property("showTime","showDate").cacheable(),validator:function(){return SC.Validator.DateTime.extend({format:this.get("format")})}.property("format").cacheable(),tabsSelections:function(){var g=[];var d=this.get("format");var j=this.get("_dtConstants");var b=this.get("_wtConstants");if(SC.empty(d)){throw"The format string is empty, and must be a valid string."}var h,k,c,f=0,a=0,i=0;while(f<d.length&&d.indexOf("%",f)!==-1){h=d.indexOf("%",f);k=d.substring(h,h+2);f=h+2;c=j.indexOf(k);if(c===-1){throw"SC.DateFieldView: The format's key '%@' is not supported.".fmt(k)}a=a+h-i;g.push(SC.Object.create({key:k,textSelection:SC.TextSelection.create({start:a,end:a+b[c]})}));a=a+b[c];i=f}h=k=c=null;return g}.property("format").cacheable(),updateTextSelectionObserver:function(){var a=this.get("activeSelection");var b=this.get("tabsSelections");if(this.get("isEditing")){this.selection(null,b[a].get("textSelection"))}}.observes("activeSelection","value"),updateValue:function(b,c){var f=(c===0)?-1:1;var d=this.get("value"),a;switch(b){case"%a":case"%d":case"%j":this.set("value",d.advance({day:f}));break;case"%b":case"%m":this.set("value",d.advance({month:f}));break;case"%H":case"%I":this.set("value",d.advance({hour:f}));break;case"%M":this.set("value",d.advance({minute:f}));break;case"%p":a=d.get("hour")>=12?-12:12;this.set("value",d.advance({hour:a}));break;case"%S":this.set("value",d.advance({second:f}));break;case"%U":this.set("value",d.advance({week1:f}));break;case"%W":this.set("value",d.advance({week0:f}));break;case"%y":case"%Y":this.set("value",d.advance({year:f}));break}},_selectRootElement:function(){},keyDown:function(a){if(this.interpretKeyEvents(a)){a.stop();return YES}return arguments.callee.base.apply(this,arguments)},ctrl_a:function(){return YES},moveUp:function(b){var a=this.get("activeSelection");var c=this.get("tabsSelections");this.updateValue(c[a].get("key"),1);return YES},moveDown:function(b){var a=this.get("activeSelection");var c=this.get("tabsSelections");this.updateValue(c[a].get("key"),0);return YES},insertText:function(a){return YES},moveRight:function(a){var c=this.get("tabsSelections");var b=this.get("activeSelection")+1;if(b===c.length){b=0}this.set("activeSelection",b);return YES},moveLeft:function(a){var c=this.get("tabsSelections");var b=this.get("activeSelection")-1;if(b===-1){b=c.length-1}this.set("activeSelection",b);return YES},insertTab:function(a){var c=this.get("tabsSelections");var b=this.get("activeSelection")+1;if(b<c.length){this.set("activeSelection",b);return YES}return NO},insertBacktab:function(a){var b=this.get("activeSelection")-1;if(b!==-1){this.set("activeSelection",b);return YES}return NO},mouseUp:function(b){var c=arguments.callee.base.apply(this,arguments);var f=this.get("selection");if(SC.none(f)){this.set("activeSelection",0)}else{var j=f.get("start");var h=this.get("tabsSelections");var a=h.length,g;for(var d=0;d<a;d++){g=h[d].get("textSelection");if(j>=g.get("start")&&j<=g.get("end")){this.set("activeSelection",d)}}}return c},deleteBackward:function(a){return YES},deleteForward:function(a){return YES}});SC.DisclosureView=SC.ButtonView.extend({classNames:["sc-disclosure-view"],renderDelegateName:"disclosureRenderDelegate",buttonBehavior:SC.TOGGLE_BEHAVIOR,toggleOnValue:YES,toggleOffValue:NO,valueBindingDefault:SC.Binding.bool(),keyDown:function(a){if(a.which===37||a.which===38){this.set("value",this.get("toggleOffValue"));return YES}if(a.which===39||a.which===40){this.set("value",this.get("toggleOnValue"));return YES}arguments.callee.base.apply(this,arguments)}});sc_require("views/collection");sc_require("mixins/collection_row_delegate");SC.ListView=SC.CollectionView.extend(SC.CollectionRowDelegate,{classNames:["sc-list-view"],acceptsFirstResponder:YES,showAlternatingRows:NO,render:function(a,b){a.setClass("alternating",this.get("showAlternatingRows"));return arguments.callee.base.apply(this,arguments)},rowDelegate:function(){var a=this.delegate,b=this.get("content");return this.delegateFor("isCollectionRowDelegate",a,b)}.property("delegate","content").cacheable(),_sclv_rowDelegateDidChange:function(){var d=this._sclv_rowDelegate,b=this.get("rowDelegate"),c=this._sclv_rowHeightDidChange,a=this._sclv_customRowHeightIndexesDidChange;if(d===b){return this}this._sclv_rowDelegate=b;if(d){d.removeObserver("rowHeight",this,c);d.removeObserver("customRowHeightIndexes",this,a)}if(!b){throw"Internal Inconsistancy: ListView must always have CollectionRowDelegate"}b.addObserver("rowHeight",this,c);b.addObserver("customRowHeightIndexes",this,a);this._sclv_rowHeightDidChange()._sclv_customRowHeightIndexesDidChange();return this}.observes("rowDelegate"),_sclv_rowHeightDidChange:function(){var b=this.get("rowDelegate"),a=b.get("rowHeight"),c;if(a===this._sclv_rowHeight){return this}this._sclv_rowHeight=a;c=SC.IndexSet.create(0,this.get("length"));this.rowHeightDidChangeForIndexes(c);return this},_sclv_customRowHeightIndexesDidChange:function(){var a=this.get("rowDelegate"),b=a.get("customRowHeightIndexes"),d=this._sclv_customRowHeightIndexes,c=this._sclv_customRowHeightIndexesContentDidChange;if((b===d)||(d&&d.isEqual(b))){return this}if(d&&this._sclv_isObservingCustomRowHeightIndexes){d.removeObserver("[]",this,c)}if(this._sclv_isObservingCustomRowHeightIndexes=b&&!b.get("isFrozen")){b.addObserver("[]",this,c)}this._sclv_customRowHeightIndexesContentDidChange();return this},_sclv_customRowHeightIndexesContentDidChange:function(){var a=this.get("rowDelegate"),b=a.get("customRowHeightIndexes"),c=this._sclv_customRowHeightIndexes,d;if(b&&c){d=b.copy().add(c)}else{d=b||c}this._sclv_customRowHeightIndexes=b?b.frozenCopy():null;this.rowHeightDidChangeForIndexes(d);return this},rowOffsetForContentIndex:function(i){if(i===0){return 0}var k=this.get("rowDelegate"),a=k.get("rowHeight"),g,f,c,b,j,h,d;f=i*a;g=this.get("rowSpacing");if(g){f+=i*g}if(k.customRowHeightIndexes&&(c=k.get("customRowHeightIndexes"))){b=this._sclv_offsetCache;if(!b){b=[];j=h=0;c.forEach(function(l){j+=this.rowHeightForContentIndex(l)-a;b[l+1]=j;h=l},this);this._sclv_max=h+1;this._sclv_offsetCache=b}j=b[i];if(j===undefined){j=b[i]=b[i-1];if(j===undefined){h=this._sclv_max;if(i<h){h=c.indexBefore(i)+1}j=b[i]=b[h]||0}}f+=j}return f},rowHeightForContentIndex:function(a){var b=this.get("rowDelegate"),f,c,g,d;if(b.customRowHeightIndexes&&(d=b.get("customRowHeightIndexes"))){c=this._sclv_heightCache;if(!c){c=[];g=this.get("content");d.forEach(function(h){c[h]=b.contentIndexRowHeight(this,g,h)},this);this._sclv_heightCache=c}f=c[a];if(f===undefined){f=b.get("rowHeight")}}else{f=b.get("rowHeight")}return f},rowHeightDidChangeForIndexes:function(b){var a=this.get("length");this._sclv_heightCache=this._sclv_offsetCache=null;if(b&&b.isIndexSet){b=b.get("min")}this.reload(SC.IndexSet.create(b,a-b));return this},_sclv_lengthDidChange:function(){this.adjust(this.computeLayout())}.observes("length"),computeLayout:function(){var a=this._sclv_layout;if(!a){a=this._sclv_layout={}}a.minHeight=this.rowOffsetForContentIndex(this.get("length"));this.set("calculatedHeight",a.minHeight);return a},layoutForContentIndex:function(b){var a=this.get("rowDelegate");return{top:this.rowOffsetForContentIndex(b),height:this.rowHeightForContentIndex(b)-a.get("rowPadding")*2,left:0,right:0}},contentIndexesInRect:function(i){var a=this.get("rowDelegate").get("rowHeight"),h=SC.minY(i),b=SC.maxY(i),j=i.height||0,g=this.get("length"),f,c,d;c=(h-(h%a))/a;f=this.rowOffsetForContentIndex(c);while(c>0&&f>h){c--;f-=this.rowHeightForContentIndex(c)}f+=this.rowHeightForContentIndex(c);while(c<g&&f<=h){c++;f+=this.rowHeightForContentIndex(c)}if(c<0){c=0}if(c>=g){c=g}d=c+((j-(j%a))/a);if(d>g){d=g}f=this.rowOffsetForContentIndex(d);while(d>=c&&f>=b){d--;f-=this.rowHeightForContentIndex(d)}f+=this.rowHeightForContentIndex(d);while(d<g&&f<b){d++;f+=this.rowHeightForContentIndex(d)}d++;if(d<c){d=c}if(d>g){d=g}return SC.IndexSet.create(c,d-c)},insertionPointView:SC.View.extend({classNames:"sc-list-insertion-point",render:function(a,b){if(b){a.push('<div class="anchor"></div>')}}}),showInsertionPoint:function(h,g){var i=this._insertionPointView;if(!i){i=this._insertionPointView=this.get("insertionPointView").create()}var d=h.get("contentIndex"),f=this.get("length"),c=SC.clone(h.get("layout")),a=h.get("outlineLevel"),b=h.get("outlineIndent")||0,j;if((d>=f)&&d>0){j=this.itemViewForContentIndex(f-1);if(j.get("isGroupView")){a=1;b=j.get("outlineIndent")}}if(SC.none(a)){a=-1}if(g&SC.DROP_ON){if(h!==this._lastDropOnView){this.hideInsertionPoint();h.set("isDropTarget",YES);this._lastDropOnView=h}}else{if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}if(g&SC.DROP_AFTER){c.top+=c.height}c.height=2;c.right=0;c.left=((a+1)*b)+12;delete c.width;i.set("layout",c);this.appendChild(i)}},hideInsertionPoint:function(){if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}var a=this._insertionPointView;if(a){a.removeFromParent().destroy()}this._insertionPointView=null},insertionIndexForLocation:function(h,l){var b={x:h.x,y:h.y,width:1,height:1},g=this.contentIndexesInRect(b),i=g.get("min"),j=this.get("length"),c,m,n,f,p,d,o,k,a;if(SC.none(i)||i<0){if((j===0)||(h.y<=this.rowOffsetForContentIndex(0))){i=0}else{if(h.y>=this.rowOffsetForContentIndex(j)){i=j}}}c=this.rowOffsetForContentIndex(i);m=c+this.rowHeightForContentIndex(i);if(l==SC.DROP_ON){if(this.get("isEditable")){n=Math.min(Math.floor((m-c)*0.2),5)}else{n=0}if(h.y>=(c+n)||h.y<=(m+n)){return[i,SC.DROP_ON]}}if(i>0){k=this.itemViewForContentIndex(i-1);o=(k?k.get("outlineIndent"):0)||0;d=k?k.get("outlineLevel"):0;if(i<j){k=this.itemViewForContentIndex(i);f=k?k.get("outlineLevel"):0;p=(k?k.get("outlineIndent"):0)||0;p*=f}else{f=k.get("isGroupView")?1:0;p=o*f}o*=d;if((f!==d)&&(p!==o)){if(o>p){i--;l=SC.DROP_AFTER}}}if(l===SC.DROP_BEFORE){k=(i<j)?this.itemViewForContentIndex(i):null;if(!k||k.get("isGroupView")){if(i>0){k=this.itemViewForContentIndex(i-1);if(!k.get("isGroupView")||(k.get("disclosureState")===SC.BRANCH_OPEN)){i=i-1;l=SC.DROP_AFTER}else{i=-1}}else{i=-1}}if(i<0){l=SC.DRAG_NONE}}return[i,l]},mouseWheel:function(a){var b=SC.InlineTextFieldView.editor;if(b&&b.get("isEditing")){if(b.get("delegate").get("displayDelegate")===this){SC.InlineTextFieldView.commitEditing()}}return NO},init:function(){arguments.callee.base.apply(this,arguments);this._sclv_rowDelegateDidChange()}});sc_require("views/list");SC.GridView=SC.ListView.extend({classNames:["sc-grid-view"],layout:{left:0,right:0,top:0,bottom:0},rowHeight:48,columnWidth:64,exampleView:SC.LabelView,insertionOrientation:SC.HORIZONTAL_ORIENTATION,itemsPerRow:function(){var b=this.get("frame"),a=this.get("columnWidth")||0;return(a<=0)?1:Math.floor(b.width/a)}.property("frame","columnWidth").cacheable(),contentIndexesInRect:function(f){var d=this.get("rowHeight")||48,b=this.get("itemsPerRow"),c=Math.floor(SC.minY(f)/d)*b,a=Math.ceil(SC.maxY(f)/d)*b;return SC.IndexSet.create(c,a-c)},layoutForContentIndex:function(h){var d=this.get("rowHeight")||48,a=this.get("frame").width,b=this.get("itemsPerRow"),f=Math.floor(a/b),g=Math.floor(h/b),c=h-(b*g);return{left:c*f,top:g*d,height:d,width:f}},computeLayout:function(){var f=this.get("content"),d=(f)?f.get("length"):0,c=this.get("rowHeight")||48,a=this.get("itemsPerRow"),g=Math.ceil(d/a);var b=this._cachedLayoutHash;if(!b){b=this._cachedLayoutHash={}}b.minHeight=g*c;this.calculatedHeight=b.minHeight;return b},insertionPointClass:SC.View.extend({classNames:["grid-insertion-point"],render:function(a,b){if(b){a.push('<span class="anchor"></span>')}}}),showInsertionPoint:function(c,g){if(!c){return}if(g&SC.DROP_ON){if(c!==this._lastDropOnView){this.hideInsertionPoint();c.set("isDropTarget",YES);this._lastDropOnView=c}}else{if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}if(!this._insertionPointView){this._insertionPointView=this.insertionPointClass.create()}var b=this._insertionPointView;var a=c.get("frame");var d={height:a.height-6,x:a.x,y:a.y+6,width:0};if(!SC.rectsEqual(b.get("frame"),d)){b.set("frame",d)}if(b.parentNode!==c.parentNode){c.parentNode.appendChild(b)}}},hideInsertionPoint:function(){if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}var a=this._insertionPointView;if(a){a.removeFromParent().destroy()}this._insertionPointView=null},insertionIndexForLocation:function(d,k){var g=this.get("frame"),h=this.get("clippingFrame"),l=this.get("itemsPerRow"),a=Math.floor(g.width/l),n=Math.floor((d.y-g.y-h.y)/this.get("rowHeight"));var j=SC.DROP_BEFORE,c=(d.x-g.x-h.x),b=Math.floor(c/a),m=(c/a)-b;if(k===SC.DROP_ON){if(m>0.8){b++}if((m>=0.2)&&(m<=0.8)){j=SC.DROP_ON}}else{if(m>0.45){b++}}var i=(n*l)+b;return[i,j]},_gv_frameDidChange:function(){var f=this.get("frame"),c;c=f.width;if(this._lastFrameWidth&&c!==this._lastFrameWidth){this.notifyPropertyChange("itemsPerRow");var a,b,d=this.get("nowShowing");d.forEach(function(g){b=this.itemViewForContentIndex(g);b.adjust(this.layoutForContentIndex(g))},this)}this._lastFrameWidth=c}.observes("frame")});SC.ImageButtonView=SC.ButtonView.extend({classNames:["sc-image-button-view"],themeName:null,renderDelegateName:"imageButtonRenderDelegate",displayProperties:["image"],image:null});SC.ANCHOR_TOP={top:0};SC.ANCHOR_LEFT={left:0};SC.ANCHOR_TOP_LEFT={top:0,left:0};SC.ANCHOR_BOTTOM={bottom:0};SC.ANCHOR_RIGHT={right:0};SC.ANCHOR_BOTTOM_RIGHT={bottom:0,right:0};SC.ToolbarView=SC.View.extend({classNames:["sc-toolbar-view"],ariaRole:"toolbar",renderDelegateName:"toolbarRenderDelegate",anchorLocation:null,layout:{left:0,height:32,right:0},init:function(){if(this.anchorLocation){this.layout=SC.merge(this.layout,this.anchorLocation)}arguments.callee.base.apply(this,arguments)}});sc_require("views/toolbar");SC.WorkspaceView=SC.View.extend({classNames:["sc-workspace-view"],displayProperties:["hasTopToolbar","hasBottomToolbar"],renderDelegateName:"workspaceRenderDelegate",topToolbar:SC.ToolbarView.extend(),bottomToolbar:null,contentView:SC.View.extend(),autoResizeToolbars:NO,defaultToolbarSize:44,largeToolbarSize:44,smallToolbarSize:30,toolbarSize:function(){if(!this.get("autoResizeToolbars")){return this.get("defaultToolbarSize")}if(this.get("orientation")===SC.HORIZONTAL_ORIENTATION){return this.get("smallToolbarSize")}return this.get("largeToolbarSize")}.property("autoHideMaster","orientation"),orientation:function(){var a=this.get("frame");if(a.width>a.height){return SC.HORIZONTAL_ORIENTATION}else{return SC.VERTICAL_ORIENTATION}}.property("frame").cacheable(),masterIsHidden:NO,masterIsHiddenDidChange:function(){var a,b=this.get("masterIsHidden");if(a=this.get("topToolbar")){a.set("masterIsHidden",b)}if(a=this.get("bottomToolbar")){a.set("masterIsHidden",b)}}.observes("masterIsHidden"),_scmd_tilePropertyDidChange:function(){this.invokeOnce("_scws_tile")}.observes("toolbarSize"),createChildViews:function(){arguments.callee.base.apply(this,arguments);var a=this.get("topToolbar");if(a){a=this.topToolbar=this.activeTopToolbar=this.createChildView(a);this.appendChild(a)}var c=this.get("bottomToolbar");if(c){c=this.bottomToolbar=this.activeBottomToolbar=this.createChildView(c);this.appendChild(c)}var b=this.get("contentView");b=this.contentView=this.activeContentView=this.createChildView(b);this.appendChild(b);this.invokeOnce("_scws_tile")},_scws_tile:function(){var b=0,f=0,a=this.get("topToolbar"),g=this.get("bottomToolbar"),d=this.get("contentView"),c=this.get("toolbarSize");if(a){a.set("layout",{left:0,right:0,top:0,height:c});b+=c}if(g){g.set("layout",{left:0,right:0,bottom:0,height:c});f+=c}this.contentView.set("layout",{left:0,right:0,top:b,bottom:f})},hasTopToolbar:function(){if(this.get("topToolbar")){return YES}return NO}.property("topToolbar").cacheable(),hasBottomToolbar:function(){if(this.get("bottomToolbar")){return YES}return NO}.property("bottomToolbar").cacheable(),childDidChange:function(){this._scws_tile()},activeTopToolbar:null,activeBottomToolbar:null,activeContentView:null,topToolbarDidChange:function(){var b=this.activeTopToolbar,a=this.get("topToolbar");if(b){this.removeChild(b)}if(a){this.appendChild(a)}this.activeTopToolbar=a;this.invokeLast("childDidChange")}.observes("topToolbar"),bottomToolbarDidChange:function(){var b=this.activeBottomToolbar,a=this.get("bottomToolbar");if(b){this.removeChild(b)}if(a){this.appendChild(a)}this.activeBottomToolbar=a;this.invokeLast("childDidChange")}.observes("bottomToolbar"),contentViewDidChange:function(){var b=this.activeContentView,a=this.get("contentView");if(b){this.removeChild(b)}if(a){this.appendChild(a)}this.activeContentView=a;this.invokeLast("childDidChange")}.observes("contentView")});sc_require("views/workspace");sc_require("views/toolbar");SC.MasterDetailView=SC.View.extend({classNames:["sc-master-detail-view"],renderDelegateName:"masterDetailRenderDelegate",masterView:SC.WorkspaceView.extend({topToolbar:SC.ToolbarView.extend({}),contentView:SC.View.extend({backgroundColor:"white"})}),detailView:SC.WorkspaceView.extend({topToolbar:SC.ToolbarView.extend({childViews:["showHidePicker"],showHidePicker:SC.ButtonView.extend({layout:{left:7,centerY:0,height:30,width:100},controlSize:SC.AUTO_CONTROL_SIZE,title:"Picker",action:"toggleMasterPicker",isVisible:NO,isVisibleBinding:".parentView.masterIsHidden"})})}),autoHideMaster:function(){if(SC.platform.touch){return YES}return NO}.property().cacheable(),masterWidth:250,dividerWidth:SC.propertyFromRenderDelegate("dividerWidth",1),masterIsHidden:function(){if(!this.get("autoHideMaster")){return NO}if(this.get("orientation")===SC.HORIZONTAL_ORIENTATION){return NO}return YES}.property("autoHideMaster","orientation"),orientation:SC.VERTICAL_ORIENTATION,_scmd_frameDidChange:function(){var b=this.get("frame"),a;if(b.width>b.height){a=SC.HORIZONTAL_ORIENTATION}else{a=SC.VERTICAL_ORIENTATION}this.setIfChanged("orientation",a)}.observes("frame"),init:function(){arguments.callee.base.apply(this,arguments);this._scmd_frameDidChange();this._scmd_masterIsHiddenDidChange()},toggleMasterPicker:function(a){if(!this.get("masterIsHidden")){return}if(this._picker&&this._picker.get("isVisibleInWindow")){this.hideMasterPicker()}else{this.showMasterPicker(a)}},showMasterPicker:function(b){if(this._picker&&this._picker.get("isVisibleInWindow")){return}if(!this._picker){var a=this.get("pickerPane");this._picker=a.create({})}this._picker.set("contentView",this.get("masterView"));this._picker.set("extraRightOffset",this.get("pointerDistanceFromEdge"));this.showPicker(this._picker,b)},hideMasterPicker:function(){if(this._picker&&this._picker.get("isVisibleInWindow")){this.hidePicker(this._picker)}},showPicker:function(b,a){b.popup(a,SC.PICKER_POINTER,[3,0,1,2,3],[9,-9,-18,18])},hidePicker:function(a){a.remove()},pickerPane:SC.PickerPane.extend({layout:{width:250,height:480},themeName:"popover"}),_picker:null,pointerDistanceFromEdge:46,_scmd_masterIsHiddenDidChange:function(){var a=this.get("masterIsHidden");this.get("masterView").set("masterIsHidden",a);this.get("detailView").set("masterIsHidden",a)}.observes("masterIsHidden"),_scmd_orientationDidChange:function(){this.invokeOnce("_scmd_tile")}.observes("orientation"),_scmd_retileProperties:function(){this.invokeOnce("_scmd_tile")}.observes("masterIsHidden","masterWidth"),createChildViews:function(){var b=this.get("masterView");b=this.masterView=this.createChildView(b);var a=this.get("detailView");a=this.detailView=this.createChildView(a);this.appendChild(a);this.invokeOnce("_scmd_tile")},_masterIsDrawn:NO,_scmd_tile:function(){var b=!this.get("masterIsHidden");var f=this.get("masterWidth"),d=this.get("masterView"),c=this.get("detailView");if(b){this.hideMasterPicker();if(!this._masterIsDrawn){if(this._picker){this._picker.set("contentView",null)}this.appendChild(d);this._masterIsDrawn=YES}d.set("layout",{left:0,top:0,bottom:0,width:f});var a=this.get("dividerWidth");c.set("layout",{left:f+a,right:0,top:0,bottom:0})}else{if(this._masterIsDrawn){this.removeChild(d);this._masterIsDrawn=NO}c.set("layout",{left:0,right:0,top:0,bottom:0})}}});SC.ScrollerView=SC.View.extend({classNames:["sc-scroller-view"],displayProperties:["thumbPosition","thumbLength","isEnabled","controlsHidden"],ariaRole:"scrollbar",shouldScrollToClick:NO,_touchScrollValue:NO,value:function(a,c){var b=this.get("minimum");if(c!==undefined){this._scs_value=c}c=this._scs_value||b;return Math.max(Math.min(c,this.get("maximum")),b)}.property("maximum","minimum").cacheable(),displayValue:function(){var a;if(this.get("_touchScrollValue")){a=this.get("_touchScrollValue")}else{a=this.get("value")}return a}.property("value","_touchScrollValue").cacheable(),proportion:0,maximum:100,minimum:0,isEnabled:function(a,b){if(b!==undefined){this._scsv_isEnabled=b}if(this._scsv_isEnabled!==undefined){return this._scsv_isEnabled}return this.get("proportion")<1}.property("proportion").cacheable(),_scsv_isEnabled:undefined,layoutDirection:SC.LAYOUT_VERTICAL,hasButtons:YES,scrollbarThickness:14,capLength:18,capOverlap:14,buttonLength:41,buttonOverlap:11,minimumThumbLength:20,render:function(c,a){var j="vertical",b={},l="",q=this.get("parentView"),i=this.get("layoutDirection"),f,n,h,g,o,m,k,d,p;switch(i){case SC.LAYOUT_VERTICAL:b["sc-vertical"]=YES;break;case SC.LAYOUT_HORIZONTAL:b["sc-horizontal"]=YES;j="horizontal";break}b.disabled=!this.get("isEnabled");b["controls-hidden"]=this.get("controlsHidden");c.setClass(b);n=this.get("thumbLength");f=this.get("thumbPosition");if(a){c.push('<div class="track"></div>','<div class="cap"></div>');this.renderButtons(c,this.get("hasButtons"));this.renderThumb(c,i,n,f);c.attr("aria-orientation",j);c.attr("aria-valuemax",this.get("maximum"));c.attr("aria-valuemin",this.get("minimum"));c.attr("aria-valuenow",this.get("value"));c.attr("aria-controls",q.getPath("contentView.layerId"))}else{if(this.get("controlsHidden")){return}g=this.$(".thumb");this.adjustThumb(g,f,n);c.attr("aria-valuenow",this.get("value"))}},renderThumb:function(d,f,b,c){var a;if(f===SC.LAYOUT_HORIZONTAL){a="width: "+b+"px; left: "+c+"px;"}else{a="height: "+b+"px; top: "+c+"px;"}d.push('<div class="thumb" style="%@">'.fmt(a),'<div class="thumb-center"></div>','<div class="thumb-top"></div>','<div class="thumb-bottom"></div></div>')},renderButtons:function(b,a){if(a){b.push('<div class="button-bottom"></div><div class="button-top"></div>')}else{b.push('<div class="endcap"></div>')}},touchScrollDidStart:function(a){this.set("_touchScrollValue",a)},touchScrollDidEnd:function(a){this.set("_touchScrollValue",NO)},touchScrollDidChange:function(a){this.set("_touchScrollValue",a)},adjustThumb:function(b,a,c){this.adjustThumbPosition(b,a);this.adjustThumbSize(b,c)},adjustThumbPosition:function(b,a){if(this._thumbPosition===a){return}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:b.css("top",a);break;case SC.LAYOUT_HORIZONTAL:b.css("left",a);break}this._thumbPosition=a},adjustThumbSize:function(a,b){if(this._thumbSize===b){return}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:a.css("height",Math.max(b,this.get("minimumThumbLength")));break;case SC.LAYOUT_HORIZONTAL:a.css("width",Math.max(b,this.get("minimumThumbLength")));break}this._thumbSize=b},trackLength:function(){var a=this.get("scrollerLength");a-=this.capLength-this.capOverlap;a-=this.buttonLength-this.buttonOverlap;return a}.property("scrollerLength").cacheable(),scrollerLength:function(){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:return this.get("frame").height;case SC.LAYOUT_HORIZONTAL:return this.get("frame").width}return 0}.property("frame").cacheable(),thumbLength:function(){var a;a=Math.floor(this.get("trackLength")*this.get("proportion"));a=isNaN(a)?0:a;return Math.max(a,this.get("minimumThumbLength"))}.property("trackLength","proportion").cacheable(),thumbPosition:function(){var h=this.get("displayValue"),c=this.get("maximum"),b=this.get("trackLength"),d=this.get("thumbLength"),g=this.get("capLength"),f=this.get("capOverlap"),a;a=(h/c)*(b-d);a+=g-f;return Math.floor(isNaN(a)?0:a)}.property("displayValue","maximum","trackLength","thumbLength").cacheable(),controlsHidden:function(){return this.get("proportion")>=1}.property("proportion").cacheable(),valueForPosition:function(h){var b=this.get("maximum"),a=this.get("trackLength"),c=this.get("thumbLength"),g=this.get("capLength"),d=this.get("capOverlap"),f;f=h-(g-d);f=f/(a-c);f=f*b;return f},mouseDown:function(k){if(!this.get("isEnabled")){return NO}this._altIsDown=k.altKey;this._shiftIsDown=k.shiftKey;var f=k.target,c=this.get("thumbPosition"),j,d,h,g=this.get("scrollerLength");if(f.className.indexOf("thumb")>=0){d=this.convertFrameFromView({x:k.pageX,y:k.pageY});d.x-=c;d.y-=c;this._thumbDragging=YES;this._thumbOffset=d;this._mouseDownLocation={x:k.pageX,y:k.pageY};this._thumbPositionAtDragStart=this.get("thumbPosition");this._valueAtDragStart=this.get("value")}else{if(f.className.indexOf("button-top")>=0){this.decrementProperty("value",(this._altIsDown?g:30));this.makeButtonActive(".button-top");this.startMouseDownTimer("scrollUp");this._isScrollingUp=YES}else{if(f.className.indexOf("button-bottom")>=0){this.incrementProperty("value",(this._altIsDown?g:30));this.makeButtonActive(".button-bottom");this.startMouseDownTimer("scrollDown");this._isScrollingDown=YES}else{var m=this.get("shouldScrollToClick");if(k.altKey){m=!m}var a=this.get("trackLength"),i=this.get("thumbLength"),b=this.convertFrameFromView({x:k.pageX,y:k.pageY}),l;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:this._mouseDownLocation=l=b.y;break;case SC.LAYOUT_HORIZONTAL:this._mouseDownLocation=l=b.x;break}if(m){this.set("value",this.valueForPosition(l-(i/2)));c=this.get("thumbPosition");this._thumbDragging=YES;this._thumbOffset={x:b.x-c,y:b.y-c};this._mouseDownLocation={x:k.pageX,y:k.pageY};this._thumbPositionAtDragStart=c;this._valueAtDragStart=this.get("value")}else{if(l<c){this.decrementProperty("value",g);this.startMouseDownTimer("page")}else{this.incrementProperty("value",g);this.startMouseDownTimer("page")}}}}}return YES},mouseUp:function(a){var c=this._scs_buttonActive,b=NO,d;if(c){c.removeClass("active");b=YES}d=this._mouseDownTimer;if(d){d.invalidate();this._mouseDownTimer=null}this._thumbDragging=NO;this._isScrollingDown=NO;this._isScrollingUp=NO;return b},mouseDragged:function(n){var l,b,m,c,j=n.target,f=this._thumbPositionAtDragStart,h=this._isScrollingUp,p=this._isScrollingDown,d=this._scs_buttonActive,a;if(this._thumbDragging){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:m=(n.pageY-this._mouseDownLocation.y);break;case SC.LAYOUT_HORIZONTAL:m=(n.pageX-this._mouseDownLocation.x);break}if(n.altKey){if(!this._altIsDown||(this._shiftIsDown!==n.shiftKey)){f=this._thumbPositionAtDragStart=f+m;m=0;this._mouseDownLocation={x:n.pageX,y:n.pageY};this._valueAtDragStart=this.get("value")}if(n.shiftKey){m=-m}this.set("value",Math.round(this._valueAtDragStart+m*2))}else{c=f+m;b=this.get("trackLength")-this.get("thumbLength");this.set("value",Math.round((c/b)*this.get("maximum")))}}else{if(h||p){var o=NO,g=NO;var k=this.$(".button-top")[0].getBoundingClientRect();var i=this.$(".button-bottom")[0].getBoundingClientRect();switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:if(n.clientY<k.bottom){o=YES}else{g=YES}break;case SC.LAYOUT_HORIZONTAL:if(n.clientX<k.right){o=YES}else{g=YES}break}if((o||g)&&o!==h){if(d){d.removeClass("active")}this._mouseDownTimerAction=o?"scrollUp":"scrollDown";if(o){this.makeButtonActive(".button-top")}else{if(g){this.makeButtonActive(".button-bottom")}}this._isScrollingUp=o;this._isScrollingDown=g}}}this._altIsDown=n.altKey;this._shiftIsDown=n.shiftKey;return YES},startMouseDownTimer:function(b,a){var c;this._mouseDownTimerAction=b;this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:a?0:300})},mouseDownTimerDidFire:function(){var d=this.get("scrollerLength"),a=SC.device.get("mouseLocation"),c=this.get("thumbPosition"),b=this.get("thumbLength"),f=50;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:a=this.convertFrameFromView(a).y;break;case SC.LAYOUT_HORIZONTAL:a=this.convertFrameFromView(a).x;break}switch(this._mouseDownTimerAction){case"scrollDown":this.incrementProperty("value",this._altIsDown?d:30);break;case"scrollUp":this.decrementProperty("value",this._altIsDown?d:30);break;case"page":f=150;if(a<c){this.decrementProperty("value",d)}else{if(a>c+b){this.incrementProperty("value",d)}}}this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:f})},makeButtonActive:function(a){this._scs_buttonActive=this.$(a).addClass("active")}});SC.TouchScrollerView=SC.ScrollerView.extend({classNames:["sc-touch-scroller-view"],scrollbarThickness:12,capLength:5,capOverlap:0,hasButtons:NO,buttonOverlap:36,adjustThumb:function(d,b,g){var c=this.$(".thumb-inner");var a=this.get("scrollerLength")-this.capLength,f=this.get("minimum")+this.capLength;if(b+g>a){b=Math.min(a-20,b);g=a-b}if(b<f){g-=f-b;b=f}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:if(this._thumbPosition!==b){d.css("-webkit-transform","translate3d(0px,"+b+"px,0px)")}if(this._thumbSize!==g){c.css("-webkit-transform","translate3d(0px,"+Math.round(g-1044)+"px,0px)")}break;case SC.LAYOUT_HORIZONTAL:if(this._thumbPosition!==b){d.css("-webkit-transform","translate3d("+b+"px,0px,0px)")}if(this._thumbSize!==g){c.css("-webkit-transform","translate3d("+Math.round(g-1044)+"px,0px,0px)")}break}this._thumbPosition=b;this._thumbSize=g},render:function(c,a){var b=[],f,k,h,g,l,j,i,d,m;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:b.push("sc-vertical");break;case SC.LAYOUT_HORIZONTAL:b.push("sc-horizontal");break}if(!this.get("isEnabled")){b.push("disabled")}if(this.get("controlsHidden")){b.push("controls-hidden")}c.addClass(b);k=this.get("thumbLength");f=this.get("thumbPosition");if(a){c.push('<div class="track"></div><div class="cap"></div>');this.renderButtons(c,this.get("hasButtons"));this.renderThumb(c,this.get("layoutDirection"),k)}else{if(this.get("controlsHidden")){return}g=this.$(".thumb");this.adjustThumb(g,f,k)}},renderThumb:function(b,c,a){a-=1044;c=(c===SC.LAYOUT_HORIZONTAL?"X":"Y");b.push('<div class="thumb"><div class="thumb-top"></div><div class="thumb-clip">'+'<div class="thumb-inner" style="-webkit-transform: translate%@(%@px);">'.fmt(c,a)+'<div class="thumb-center"></div><div class="thumb-bottom"></div></div></div></div>')}});sc_require("views/scroller");SC.NORMAL_SCROLL_DECELERATION=0.95;SC.FAST_SCROLL_DECELERATION=0.85;SC.ScrollView=SC.View.extend({classNames:["sc-scroll-view"],isScrollable:YES,contentView:null,horizontalAlign:SC.ALIGN_LEFT,verticalAlign:SC.ALIGN_TOP,horizontalScrollOffset:function(b,d){if(d!==undefined){var c=this.minimumHorizontalScrollOffset(),a=this.get("maximumHorizontalScrollOffset");this._scroll_horizontalScrollOffset=Math.max(c,Math.min(a,d))}return this._scroll_horizontalScrollOffset||0}.property().cacheable(),verticalScrollOffset:function(b,d){if(d!==undefined){var c=this.get("minimumVerticalScrollOffset"),a=this.get("maximumVerticalScrollOffset");this._scroll_verticalScrollOffset=Math.max(c,Math.min(a,d))}return this._scroll_verticalScrollOffset||0}.property().cacheable(),maximumScrollOffset:function(b,a,c){if(b>=a){return b-a}if(c===SC.ALIGN_LEFT||c===SC.ALIGN_TOP){return 0}else{if(c===SC.ALIGN_MIDDLE||c===SC.ALIGN_CENTER){return 0-Math.round((a-b)/2)}else{return 0-(a-b)}}},minimumScrollOffset:function(b,a,c){if(b>a){return 0}if(c===SC.ALIGN_LEFT||c===SC.ALIGN_TOP){return 0}else{if(c===SC.ALIGN_MIDDLE||c===SC.ALIGN_CENTER){return 0-Math.round((a-b)/2)}else{return 0-(a-b)}}},maximumHorizontalScrollOffset:function(){var c=this.get("contentView");var b=c?c.get("frame").width:0,a=c?c.get("calculatedWidth"):0;if(a){b=c.calculatedWidth}b*=this._scale;var d=this.get("containerView").get("frame").width;if(!this.get("canScrollHorizontal")){b=Math.min(b,d)}return this.maximumScrollOffset(b,d,this.get("horizontalAlign"))}.property(),maximumVerticalScrollOffset:function(){var a=this.get("contentView"),c=(a&&a.get("frame"))?a.get("frame").height:0,b=a?a.get("calculatedHeight"):0;if(b){c=b}c*=this._scale;var d=this.get("containerView").get("frame").height;if(!this.get("canScrollVertical")){c=Math.min(c,d)}return this.maximumScrollOffset(c,d,this.get("verticalAlign"))}.property(),minimumHorizontalScrollOffset:function(){var c=this.get("contentView");var b=c?c.get("frame").width:0,a=c?c.get("calculatedWidth"):0;if(a){b=a}b*=this._scale;var d=this.get("containerView").get("frame").width;if(!this.get("canScrollHorizontal")){b=Math.min(b,d)}return this.minimumScrollOffset(b,d,this.get("horizontalAlign"))}.property(),minimumVerticalScrollOffset:function(){var a=this.get("contentView");var c=(a&&a.get("frame"))?a.get("frame").height:0,b=a?a.get("calculatedHeight"):0;if(b){c=a.calculatedHeight}c*=this._scale;var d=this.get("containerView").get("frame").height;if(!this.get("canScrollVertical")){c=Math.min(c,d)}return this.minimumScrollOffset(c,d,this.get("verticalAlign"))}.property(),verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("frame").height}.property("frame"),horizontalPageScroll:function(){return this.get("frame").width}.property("frame"),hasHorizontalScroller:YES,horizontalScrollerView:SC.ScrollerView,horizontalTouchScrollerView:SC.TouchScrollerView,isHorizontalScrollerVisible:YES,canScrollHorizontal:function(){return !!(this.get("hasHorizontalScroller")&&this.get("horizontalScrollerView")&&this.get("isHorizontalScrollerVisible"))}.property("isHorizontalScrollerVisible").cacheable(),autohidesHorizontalScroller:YES,hasVerticalScroller:YES,verticalScrollerView:SC.ScrollerView,verticalTouchScrollerView:SC.TouchScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:function(){return !!(this.get("hasVerticalScroller")&&this.get("verticalScrollerView")&&this.get("isVerticalScrollerVisible"))}.property("isVerticalScrollerVisible").cacheable(),autohidesVerticalScroller:YES,verticalScrollerBottom:0,verticalOverlay:function(){if(SC.platform.touch){return YES}return NO}.property().cacheable(),horizontalOverlay:function(){if(SC.platform.touch){return YES}return NO}.property().cacheable(),verticalScrollerLayout:null,horizontalScrollerLayout:null,containerView:SC.ContainerView.extend({}),scrollTo:function(a,b){if(b===undefined&&SC.typeOf(a)===SC.T_HASH){b=a.y;a=a.x}if(!SC.none(a)){this.set("horizontalScrollOffset",a)}if(!SC.none(b)){this.set("verticalScrollOffset",b)}return this},scrollBy:function(a,b){if(b===undefined&&SC.typeOf(a)===SC.T_HASH){b=a.y;a=a.x}a=(a)?this.get("horizontalScrollOffset")+a:null;b=(b)?this.get("verticalScrollOffset")+b:null;return this.scrollTo(a,b)},scrollToVisible:function(b){if(arguments.length===0){return arguments.callee.base.apply(this,arguments)}var c=this.get("contentView");if(!c){return NO}var a=b.get("frame");if(!a){return NO}a=c.convertFrameFromView(a,b.get("parentView"));return this.scrollToRect(a)},scrollToRect:function(b){var a=SC.cloneRect(this.get("containerView").get("frame"));a.x=this.get("horizontalScrollOffset");a.y=this.get("verticalScrollOffset");var d=a.x,c=a.y;a.y-=Math.max(0,SC.minY(a)-SC.minY(b));a.x-=Math.max(0,SC.minX(a)-SC.minX(b));a.y+=Math.max(0,SC.maxY(b)-SC.maxY(a));a.x+=Math.max(0,SC.maxX(b)-SC.maxX(a));if((d!==a.x)||(c!==a.y)){this.scrollTo(a.x,a.y);return YES}else{return NO}},scrollDownLine:function(a){if(a===undefined){a=1}return this.scrollBy(null,this.get("verticalLineScroll")*a)},scrollUpLine:function(a){if(a===undefined){a=1}return this.scrollBy(null,0-this.get("verticalLineScroll")*a)},scrollRightLine:function(a){if(a===undefined){a=1}return this.scrollTo(this.get("horizontalLineScroll")*a,null)},scrollLeftLine:function(a){if(a===undefined){a=1}return this.scrollTo(0-this.get("horizontalLineScroll")*a,null)},scrollDownPage:function(a){if(a===undefined){a=1}return this.scrollBy(null,this.get("verticalPageScroll")*a)},scrollUpPage:function(a){if(a===undefined){a=1}return this.scrollBy(null,0-(this.get("verticalPageScroll")*a))},scrollRightPage:function(a){if(a===undefined){a=1}return this.scrollBy(this.get("horizontalPageScroll")*a,null)},scrollLeftPage:function(a){if(a===undefined){a=1}return this.scrollBy(0-(this.get("horizontalPageScroll")*a),null)},tile:function(){var c=this.get("hasHorizontalScroller")?this.get("horizontalScrollerView"):null;var i=c&&this.get("isHorizontalScrollerVisible");var k=this.get("hasVerticalScroller")?this.get("verticalScrollerView"):null;var g=k&&this.get("isVerticalScrollerVisible");var f=this.get("containerView");var n={left:0,top:0};var m,h,b,o,d,a;var j=((i)?c.get("scrollbarThickness"):0);var l=(g)?k.get("scrollbarThickness"):0;if(i){a=this.get("horizontalScrollerLayout");h={left:(a?a.left:0),bottom:(a?a.bottom:0),right:(a?a.right+l-1:l-1),height:j};c.set("layout",h);o=this.get("horizontalOverlay");n.bottom=o?0:(h.bottom+j)}else{n.bottom=0}if(c){c.set("isVisible",i)}if(g){j=j+this.get("verticalScrollerBottom");d=this.get("verticalScrollerLayout");h={top:(d?d.top:0),bottom:(d?d.bottom+j:j),right:(d?d.right:0),width:l};k.set("layout",h);b=this.get("verticalOverlay");n.right=b?0:(h.right+l)}else{n.right=0}if(k){k.set("isVisible",g)}f.adjust(n)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible"),_scroll_wheelDeltaX:0,_scroll_wheelDeltaY:0,mouseWheel:function(a){var c=this.get("horizontalScrollOffset"),g=this.get("maximumHorizontalScrollOffset"),f=this.get("maximumVerticalScrollOffset"),b=NO,d=this.get("verticalScrollOffset");b=((this.get("canScrollHorizontal")&&(a.wheelDeltaX<0&&c>0)||(a.wheelDeltaX>0&&c<g))||(this.get("canScrollVertical")&&(a.wheelDeltaY<0&&d>0)||(a.wheelDeltaY>0&&d<f)));if(b){this._scroll_wheelDeltaX+=a.wheelDeltaX;this._scroll_wheelDeltaY+=a.wheelDeltaY;this.invokeLater(this._scroll_mouseWheel,10)}return b},_scroll_mouseWheel:function(){this.scrollBy(this._scroll_wheelDeltaX,this._scroll_wheelDeltaY);if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY>0){this._scroll_wheelDeltaY=Math.floor(this._scroll_wheelDeltaY*0.95);this._scroll_wheelDeltaY=Math.max(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)}else{if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY<0){this._scroll_wheelDeltaY=Math.ceil(this._scroll_wheelDeltaY*0.95);this._scroll_wheelDeltaY=Math.min(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)}else{this._scroll_wheelDeltaY=0;this._scroll_wheelDeltaX=0}}},canScale:NO,_scale:1,scale:function(a,b){if(b!==undefined){this._scale=Math.min(Math.max(this.get("minimumScale"),b),this.get("maximumScale"))}return this._scale}.property().cacheable(),minimumScale:0.25,maximumScale:2,autoScaleRange:NO,_scale_css:"",updateScale:function(b){var a=this.get("contentView");if(!a){return}if(a.isScalable){this.get("contentView").applyScale(b);this._scale_css=""}else{this._scale_css="scale3d("+b+", "+b+", 1)"}},acceptsMultitouch:YES,decelerationRate:SC.NORMAL_SCROLL_DECELERATION,alwaysBounceHorizontal:NO,alwaysBounceVertical:YES,delaysContentTouches:YES,_touchScrollDidChange:function(){if(this.get("contentView").touchScrollDidChange){this.get("contentView").touchScrollDidChange(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset)}if(this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidChange){this.verticalScrollerView.touchScrollDidChange(this._scroll_verticalScrollOffset)}if(this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidChange){this.horizontalScrollerView.touchScrollDidChange(this._scroll_horizontalScrollOffset)}},_touchScrollDidStart:function(){if(this.get("contentView").touchScrollDidStart){this.get("contentView").touchScrollDidStart(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset)}if(this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidStart){this.verticalScrollerView.touchScrollDidStart(this._touch_verticalScrollOffset)}if(this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidStart){this.horizontalScrollerView.touchScrollDidStart(this._touch_horizontalScrollOffset)}},_touchScrollDidEnd:function(){if(this.get("contentView").touchScrollDidEnd){this.get("contentView").touchScrollDidEnd(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset)}if(this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidEnd){this.verticalScrollerView.touchScrollDidEnd(this._touch_verticalScrollOffset)}if(this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidEnd){this.horizontalScrollerView.touchScrollDidEnd(this._touch_horizontalScrollOffset)}},_applyCSSTransforms:function(b){var a="";this.updateScale(this._scale);a+="translate3d("+-this._scroll_horizontalScrollOffset+"px, "+-Math.round(this._scroll_verticalScrollOffset)+"px,0) ";a+=this._scale_css;if(b){var c=b.style;c.webkitTransform=a;c.webkitTransformOrigin="top left"}},captureTouch:function(a){return YES},touchGeneration:0,touchStart:function(b){var a=++this.touchGeneration;if(!this.tracking&&this.get("delaysContentTouches")){this.invokeLater(this.beginTouchesInContent,150,a)}else{if(!this.tracking){this.invokeLater(this.beginTouchesInContent,1,a)}}this.beginTouchTracking(b,YES);return YES},beginTouchesInContent:function(b){if(b!==this.touchGeneration){return}var c=this.touch,a;if(c&&this.tracking&&!this.dragging&&!c.touch.scrollHasEnded&&!c.touch.hasEnded){c.touch.captureTouch(this,YES);if(!c.touch.touchResponder){c.touch.makeTouchResponder(this)}else{if(c.needsScrollEnd){this._touchScrollDidEnd()}}}},beginTouchTracking:function(g,r){var q=g.averagedTouchesForView(this,r);var k=this._scroll_verticalScrollOffset||0,a=this._scroll_horizontalScrollOffset||0,m=a,l=k,f=NO,p=0,s=0,o,j;if(this.touch&&this.touch.timeout){clearTimeout(this.touch.timeout);this.touch.timeout=null;m=this.touch.startClipOffset.x;l=this.touch.startClipOffset.y;f=YES}j=this.get("contentView");if(j){o=j.get("frame");p=o.width;s=o.height}if(j.calculatedWidth&&j.calculatedWidth!==0){p=j.calculatedWidth}if(j.calculatedHeight&&j.calculatedHeight!==0){s=j.calculatedHeight}var h=this.get("containerView").get("frame"),i=h.width,n=h.height;var b=this.convertFrameToView(this.get("frame"),null),d=(a+(q.x-b.x))/this._scale,c=(k+(q.y-b.y))/this._scale;this.touch={startTime:g.timeStamp,notCalculated:YES,enableScrolling:{x:p*this._scale>i||this.get("alwaysBounceHorizontal"),y:s*this._scale>n||this.get("alwaysBounceVertical")},scrolling:{x:NO,y:NO},enableBouncing:SC.platform.bounceOnScroll,startClipOffset:{x:m,y:l},lastScrollOffset:{x:a,y:k},startTouchOffset:{x:q.x,y:q.y},scrollVelocity:{x:0,y:0},startTouchOffsetInContent:{x:d,y:c},containerSize:{width:i,height:n},contentSize:{width:p,height:s},startScale:this._scale,startDistance:q.d,canScale:this.get("canScale")&&SC.platform.pinchToZoom,minimumScale:this.get("minimumScale"),maximumScale:this.get("maximumScale"),globalFrame:b,layer:j.get("layer"),resistanceCoefficient:0.998,resistanceAsymptote:320,decelerationFromEdge:0.05,accelerationToEdge:0.1,scrollTolerance:{x:15,y:15},scaleTolerance:5,secondaryScrollTolerance:30,scrollLock:500,decelerationRate:this.get("decelerationRate"),lastEventTime:g.timeStamp,touch:(r?g:(this.touch?this.touch.touch:null)),needsScrollEnd:f};if(!this.tracking){this.tracking=YES;this.dragging=NO}},_adjustForEdgeResistance:function(g,d,b,c,a){var f;if(g<d){f=g-d}else{if(g>b){f=b-g}else{return g}}f=Math.pow(c,Math.abs(f))*a;if(g<d){f=f-a}else{f=-f+a}return Math.min(Math.max(d,g),b)+f},touchesDragged:function(a,c){var b=a.averagedTouchesForView(this);this.updateTouchScroll(b.x,b.y,b.d,a.timeStamp)},updateTouchScroll:function(l,k,f,i){var h=this.touch,a=l-h.globalFrame.x,n=k-h.globalFrame.y,w,o,x,p,D,B,c=h.scrolling,s=this.get("horizontalAlign"),m=this.get("verticalAlign");var d=((this._scroll_horizontalScrollOffset||0)+a)/this._scale,b=((this._scroll_verticalScrollOffset||0)+n)/this._scale;var A=d-h.startTouchOffsetInContent.x,z=b-h.startTouchOffsetInContent.y;var j=h.dragging;if(!c.x&&Math.abs(A)>h.scrollTolerance.x&&h.enableScrolling.x){j=YES;c.x=YES;h.scrollTolerance.y=h.secondaryScrollTolerance;h.startTouchOffset.x=l;A=0}if(!c.y&&Math.abs(z)>h.scrollTolerance.y&&h.enableScrolling.y){j=YES;c.y=YES;h.scrollTolerance.x=h.secondaryScrollTolerance;h.startTouchOffset.y=k;z=0}if(j&&!h.dragging){h.dragging=YES;this.dragging=YES;this._touchScrollDidStart()}if(!c.x&&!c.y&&!h.canScale){return}if(c.x&&!c.y){if(A>h.scrollLock&&!c.y){h.enableScrolling.y=NO}}if(c.y&&!c.x){if(z>h.scrollLock&&!c.x){h.enableScrolling.x=NO}}if(h.canScale){var r=h.startDistance,y=f-r;if(Math.abs(y)>h.scaleTolerance){c.y=YES;c.x=YES;var C=h.startScale*(f/Math.max(r,50));var t=this._adjustForEdgeResistance(C,h.minimumScale,h.maximumScale,h.resistanceCoefficient,h.resistanceAsymptote);this.dragging=YES;this._scale=t;var v=d*this._scale,u=b*this._scale}}D=this.minimumScrollOffset(h.contentSize.width*this._scale,h.containerSize.width,s);B=this.minimumScrollOffset(h.contentSize.height*this._scale,h.containerSize.height,m);p=this.maximumScrollOffset(h.contentSize.width*this._scale,h.containerSize.width,s);o=this.maximumScrollOffset(h.contentSize.height*this._scale,h.containerSize.height,m);x=h.startTouchOffsetInContent.x*this._scale-a;w=h.startTouchOffsetInContent.y*this._scale-n;if(h.enableBouncing){x=this._adjustForEdgeResistance(x,D,p,h.resistanceCoefficient,h.resistanceAsymptote);w=this._adjustForEdgeResistance(w,B,o,h.resistanceCoefficient,h.resistanceAsymptote)}else{x=Math.max(D,Math.min(p,x));w=Math.max(B,Math.min(o,w))}if(c.x){this._scroll_horizontalScrollOffset=x}if(c.y){this._scroll_verticalScrollOffset=w}this._applyCSSTransforms(h.layer);this._touchScrollDidChange();if(i-h.lastEventTime>=1||h.notCalculated){h.notCalculated=NO;var g=this._scroll_horizontalScrollOffset;var q=this._scroll_verticalScrollOffset;h.scrollVelocity.x=((g-h.lastScrollOffset.x)/Math.max(1,i-h.lastEventTime));h.scrollVelocity.y=((q-h.lastScrollOffset.y)/Math.max(1,i-h.lastEventTime));h.lastScrollOffset.x=g;h.lastScrollOffset.y=q;h.lastEventTime=i}},touchEnd:function(c){var a=this.touch,b=c.averagedTouchesForView(this);c.scrollHasEnded=YES;if(b.touchCount>0){this.beginTouchTracking(c,NO)}else{if(this.dragging){a.dragging=NO;a.lastEventTime=c.timeStamp;this.startDecelerationAnimation()}else{if(a.needsScrollEnd){this._touchScrollDidEnd()}c.captureTouch(this,YES);if(c.touchResponder&&c.touchResponder!==this){c.end()}else{if(!c.touchResponder||c.touchResponder===this){if(c.nextTouchResponder){c.makeTouchResponder(c.nextTouchResponder)}}else{}}this.touch=null}this.tracking=NO;this.dragging=NO}},touchCancelled:function(c){var a=this.touch,b=c.averagedTouchesForView(this);if(!this.touch||!this.touch.timeout){this.beginPropertyChanges();this.set("scale",this._scale);this.set("verticalScrollOffset",this._scroll_verticalScrollOffset);this.set("horizontalScrollOffset",this._scroll_horizontalScrollOffset);this.endPropertyChanges();this.tracking=NO;if(this.dragging){this._touchScrollDidEnd()}this.dragging=NO;this.touch=null}},startDecelerationAnimation:function(a){var b=this.touch;b.decelerationVelocity={x:b.scrollVelocity.x*10,y:b.scrollVelocity.y*10};this.decelerateAnimation()},bouncyBounce:function(c,f,d,g,h,b,a){if(f<d){if(c<0){c=c+((d-f)*h)}else{c=Math.min((d-f)*b+a,d-f-0.01)}}else{if(f>g){if(c>0){c=c-((f-g)*h)}else{c=-Math.min((f-g)*b+a,f-g-0.01)}}}return c},decelerateAnimation:function(){var c=this.touch,z=this._scale,o=c.contentSize,p=c.containerSize,n=this.get("horizontalAlign"),f=this.get("verticalAlign"),y=this.minimumScrollOffset(o.width*this._scale,p.width,n),x=this.minimumScrollOffset(o.height*this._scale,p.height,f),j=this.maximumScrollOffset(o.width*this._scale,p.width,n),i=this.maximumScrollOffset(o.height*this._scale,p.height,f),a=Date.now(),g=Math.max(a-c.lastEventTime,1),u=this._scroll_horizontalScrollOffset+c.decelerationVelocity.x*(g/10),r=this._scroll_verticalScrollOffset+c.decelerationVelocity.y*(g/10);var s=c.decelerationFromEdge,v=c.accelerationToEdge;var m=!c.enableBouncing,l=!c.enableBouncing;if(u>=y&&u<=j){m=YES}if(r>=x&&r<=i){l=YES}u/=this._scale;r/=this._scale;var k=0;k=this.bouncyBounce(k,z,c.minimumScale,c.maximumScale,s,v,0);this._scale=z=z+k;u*=this._scale;r*=this._scale;y=this.minimumScrollOffset(o.width*this._scale,p.width,n);x=this.minimumScrollOffset(o.height*this._scale,p.height,f);j=this.maximumScrollOffset(o.width*this._scale,p.width,n);i=this.maximumScrollOffset(o.height*this._scale,p.height,f);if(m&&(u<y||u>j)){u=Math.max(y,Math.min(u,j));c.decelerationVelocity.x=0}if(l&&(r<x||r>i)){r=Math.max(x,Math.min(r,i));c.decelerationVelocity.y=0}this._scroll_horizontalScrollOffset=u;this._scroll_verticalScrollOffset=r;this._applyCSSTransforms(c.layer);this._touchScrollDidChange();var w=c.decelerationRate,b=Math.pow(w,(g/10));c.decelerationVelocity.y*=b;c.decelerationVelocity.x*=b;c.decelerationVelocity.x=this.bouncyBounce(c.decelerationVelocity.x,u,y,j,s,v,0.3);c.decelerationVelocity.y=this.bouncyBounce(c.decelerationVelocity.y,r,x,i,s,v,0.3);var q=Math.abs(c.decelerationVelocity.x),d=Math.abs(c.decelerationVelocity.y);if(d<0.05&&q<0.05&&Math.abs(k)<0.05){c.timeout=null;this.touch=null;this._touchScrollDidEnd();this.beginPropertyChanges();this.set("scale",this._scale);this.set("verticalScrollOffset",this._scroll_verticalScrollOffset);this.set("horizontalScrollOffset",this._scroll_horizontalScrollOffset);this.endPropertyChanges();return}var h=this;c.lastEventTime=Date.now();this.touch.timeout=setTimeout(function(){SC.run(h.decelerateAnimation(),h)},30)},createChildViews:function(){var b=[],a;if(SC.none(a=this.containerView)){a=SC.ContainerView}b.push(this.containerView=this.createChildView(a,{contentView:this.contentView,isScrollContainer:YES}));this.contentView=this.containerView.get("contentView");a=SC.platform.touch?this.get("horizontalTouchScrollerView"):this.get("horizontalScrollerView");if(a){if(this.get("hasHorizontalScroller")){a=this.horizontalScrollerView=this.createChildView(a,{layoutDirection:SC.LAYOUT_HORIZONTAL,valueBinding:"*owner.horizontalScrollOffset"});b.push(a)}else{this.horizontalScrollerView=null}}a=SC.platform.touch?this.get("verticalTouchScrollerView"):this.get("verticalScrollerView");if(a){if(this.get("hasVerticalScroller")){a=this.verticalScrollerView=this.createChildView(a,{layoutDirection:SC.LAYOUT_VERTICAL,valueBinding:"*owner.verticalScrollOffset"});b.push(a)}else{this.verticalScrollerView=null}}this.childViews=b;this.contentViewDidChange();this.tile()},init:function(){arguments.callee.base.apply(this,arguments);this._scroll_contentView=this.get("contentView");var a=this._scroll_contentView;if(a){a.addObserver("frame",this,this.contentViewFrameDidChange);a.addObserver("calculatedWidth",this,this.contentViewFrameDidChange);a.addObserver("calculatedHeight",this,this.contentViewFrameDidChange)}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewDidChange:function(){var d=this.get("contentView"),a=this._scroll_contentView,b=this.contentViewFrameDidChange,c=this.contentViewLayerDidChange;if(d!==a){if(a){a.removeObserver("calculatedWidth",this,this.contentViewFrameDidChange);a.removeObserver("calculatedHeight",this,this.contentViewFrameDidChange);a.removeObserver("frame",this,b);a.removeObserver("layer",this,c)}this._scroll_contentView=d;if(d){d.addObserver("frame",this,b);d.addObserver("calculatedWidth",this,this.contentViewFrameDidChange);d.addObserver("calculatedHeight",this,this.contentViewFrameDidChange);d.addObserver("layer",this,c)}this.containerView.set("contentView",d);this.contentViewFrameDidChange()}}.observes("contentView"),render:function(a,b){this.invokeLast(this.adjustElementScroll);if(b){a.push('<div class="corner"></div>')}return arguments.callee.base.apply(this,arguments)},oldMaxHOffset:0,oldMaxVOffset:0,contentViewFrameDidChange:function(b){var p=this.get("contentView"),m=(p)?p.get("frame"):null,i=this._scale,c=0,r=0,k,j,n,s,o;if(!p||!m){return}c=p.get("calculatedWidth")||m.width||0;r=p.get("calculatedHeight")||m.height||0;c*=i;r*=i;if(!b&&(c===this._scroll_contentWidth)&&(r===this._scroll_contentHeight)){return}this._scroll_contentWidth=c;this._scroll_contentHeight=r;k=this.getPath("containerView.frame");j=k.width;n=k.height;if(this.get("hasHorizontalScroller")&&(p=this.get("horizontalScrollerView"))){if(this.get("autohidesHorizontalScroller")){this.set("isHorizontalScrollerVisible",c>j)}p.setIfChanged("maximum",c-j);p.setIfChanged("proportion",j/c)}if(this.get("hasVerticalScroller")&&(p=this.get("verticalScrollerView"))){if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",r>n)}p.setIfChanged("maximum",r-n);p.setIfChanged("proportion",n/r)}if(!this.get("isVerticalScrollerVisible")&&(this.get("verticalScrollOffset")!==0)&&this.get("autohidesVerticalScroller")){this.set("verticalScrollOffset",0)}if(!this.get("isHorizontalScrollerVisible")&&(this.get("horizontalScrollOffset")!==0)&&this.get("autohidesHorizontalScroller")){this.set("horizontalScrollOffset",0)}var q=this.get("maximumVerticalScrollOffset"),l=this.get("verticalScrollOffset"),h=this.get("maximumHorizontalScrollOffset"),a=this.get("horizontalScrollOffset"),g=q<l,d=h<a;if(g||d){this.forceDimensionsRecalculation(d,g,l,a)}this.notifyPropertyChange("maximumVerticalScrollOffset");this.notifyPropertyChange("maximumHorizontalScrollOffset")},frameDidChange:function(){this.contentViewFrameDidChange(YES)}.observes("frame"),contentViewLayerDidChange:function(){if(this._verticalScrollOffset!==0){this._verticalScrollOffset=-1}if(this._horizontalScrollOffset!==0){this._horizontalScrollOffset=-1}this.invokeLast(this.adjustElementScroll)},_scroll_horizontalScrollOffsetDidChange:function(){this._sc_view_clippingFrameDidChange();this.invokeLast(this.adjustElementScroll)}.observes("horizontalScrollOffset"),_scroll_verticalScrollOffsetDidChange:function(){this._sc_view_clippingFrameDidChange();this.invokeLast(this.adjustElementScroll)}.observes("verticalScrollOffset"),adjustElementScroll:function(){var a=this.get("containerView"),d=this.get("contentView"),c=this.get("verticalScrollOffset"),b=this.get("horizontalScrollOffset");if(d){if(SC.platform.touch){this._applyCSSTransforms(d.get("layer"))}if(d._viewFrameDidChange){d._viewFrameDidChange()}}if(a&&!SC.platform.touch){a=a.$()[0];if(a){if(c!==this._verticalScrollOffset){a.scrollTop=c;this._verticalScrollOffset=c}if(b!==this._horizontalScrollOffset){a.scrollLeft=b;this._horizontalScrollOffset=b}}}},forceDimensionsRecalculation:function(b,c,f,a){var g=a;var d=f;this.scrollTo(0,0);if(b&&c){this.scrollTo(this.get("maximumHorizontalScrollOffset"),this.get("maximumVerticalScrollOffset"))}if(b&&!c){this.scrollTo(this.get("maximumHorizontalScrollOffset"),d)}if(!b&&c){this.scrollTo(g,this.get("maximumVerticalScrollOffset"))}},_scroll_verticalScrollOffset:0,_scroll_horizontalScrollOffset:0});sc_require("views/scroll");SC.MenuScrollerView=SC.ScrollerView.extend({classNames:["sc-menu-scroller-view"],scrollDown:NO,value:function(a,c){if(c!==undefined){this._value=c}else{var b=this._value||0;return Math.min(b,this.get("maximum"))}}.property("maximum").cacheable(),maximum:0,isEnabled:YES,layoutDirection:SC.LAYOUT_VERTICAL,verticalLineScroll:20,ownerScrollValueKey:function(){return"verticalScrollOffset"}.property("layoutDirection").cacheable(),init:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.TINY_SCROLLER_THICKNESS);break;case SC.SMALL_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS);break;case SC.REGULAR_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS);break;case SC.LARGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS);break;case SC.HUGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS);break}return arguments.callee.base.apply(this,arguments)},render:function(a,c){a.addClass("sc-vertical");a.addClass(this.get("controlSize"));if(c){var b=this.get("scrollDown")?"arrowDown":"arrowUp";a.push('<span class="scrollArrow '+b+'">&nbsp;</span>')}a.setClass("disabled",!this.get("isEnabled"))},didCreateLayer:function(){},willDestroyLayer:function(){var a=this._sc_scroller_scrollDidChange;SC.Event.remove(this.$(),"scroll",this,a)},mouseEntered:function(a){this.set("isMouseOver",YES);this._invokeScrollOnMouseOver()},mouseExited:function(a){this.set("isMouseOver",NO)},_sc_scroller_valueDidChange:function(){}.observes("value"),_sc_scroller_armScrollTimer:function(){if(!this._sc_scrollTimer){SC.RunLoop.begin();var a=this._sc_scroller_scrollDidChange;this._sc_scrollTimer=this.invokeLater(a,50);SC.RunLoop.end()}},_sc_scroller_scrollDidChange:function(){var b=Date.now(),d=this._sc_lastScroll,c=this.get("layer"),a=0;if(d&&(b-d)<50){return this._sc_scroller_armScrollTimer()}this._sc_scrollTimer=null;this._sc_lastScroll=b;SC.RunLoop.begin();if(!this.get("isEnabled")){return}this._sc_scrollValue=a=c.scrollTop;this.set("value",a);SC.RunLoop.end()},_scrollMenu:function(){var b=this.get("value"),a;if(this.get("scrollDown")){a=b+this.verticalLineScroll;if(a<=this.get("maximum")){this.set("value",a)}}else{a=b-this.verticalLineScroll;if(a>=0){this.set("value",a)}else{if(b<=this.verticalLineScroll&&b>0){this.set("value",0)}}}return YES},_invokeScrollOnMouseOver:function(){this._scrollMenu();if(this.get("isMouseOver")){this.invokeLater(this._invokeScrollOnMouseOver,50)}}});SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS=18;SC.MenuScrollerView.TINY_SCROLLER_THICKNESS=10;SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS=14;SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS=23;SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS=26;SC.MenuScrollView=SC.ScrollView.extend({classNames:["sc-menu-scroll-view"],maximumHorizontalScrollOffset:0,hasHorizontalScroller:NO,horizontalScrollerView:SC.MenuScrollerView,isHorizontalScrollerVisible:NO,canScrollHorizontal:NO,autohidesHorizontalScroller:NO,hasVerticalScroller:YES,verticalScrollerView:SC.MenuScrollerView,verticalScrollerView2:SC.MenuScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:YES,autohidesVerticalScroller:YES,verticalScrollerBottom:0,controlSize:SC.REGULAR_CONTROL_SIZE,containerView:SC.ContainerView,scrollToVisible:function(b){if(arguments.length===0){return arguments.callee.base.apply(this,arguments)}var f=this.get("contentView");if(!f){return NO}var a=b.get("frame");if(!a){return NO}a=f.convertFrameFromView(a,b.get("parentView"));var c=this.get("verticalScrollerView2");if(c&&c.get("isVisible")){a.height+=c.get("frame").height}var d=this.get("verticalScrollerView");if(d&&d.get("isVisible")){a.top-=d.get("frame").height}return this.scrollToRect(a)},tile:function(){var h,t,i,b,r,j,c;h=this.get("hasVerticalScroller");t=h?this.get("verticalScrollerView"):null;i=h?this.get("verticalScrollerView2"):null;b=t&&this.get("isVerticalScrollerVisible");r=this.get("containerView");j={left:0,top:0};if(b){c=0;var a=t.get("scrollerThickness")||i.get("scrollerThickness");var k=this.get("contentView"),p,q=(k)?k.get("frame"):null,l=(q)?q.height:0,s=this.containerView.$()[0],m=this.get("verticalScrollOffset"),g={height:0,top:0,right:0,left:0},o={height:a,top:0,right:0,left:0},d={height:a,bottom:0,right:0,left:0},n={height:0,bottom:0,right:0,left:0};if(s){c=s.offsetHeight}if(m===0){j.top=0;j.bottom=a;t.set("layout",g);i.set("layout",d)}else{if(m>=(l-c-a)){j.top=a;j.bottom=0;t.set("layout",o);i.set("layout",n)}else{j.top=a;j.bottom=a;t.set("layout",o);i.set("layout",d)}}}if(t){t.set("isVisible",b);i.set("isVisible",b)}r.set("layout",j)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible","verticalScrollOffset"),createChildViews:function(){var c=[],b,a,d=this.get("controlSize");if(SC.none(b=this.containerView)){b=SC.ContainerView}c.push(this.containerView=this.createChildView(b,{contentView:this.contentView}));this.contentView=this.containerView.get("contentView");if((b=this.verticalScrollerView)&&(a=this.verticalScrollerView2)){if(this.get("hasVerticalScroller")){b=this.verticalScrollerView=this.createChildView(b,{layout:{top:0,left:0,right:0},controlSize:d,valueBinding:"*owner.verticalScrollOffset"});c.push(b);a=this.verticalScrollerView2=this.createChildView(a,{scrollDown:YES,layout:{bottom:0,left:0,right:0},controlSize:d,valueBinding:"*owner.verticalScrollOffset"});c.push(a)}else{this.verticalScrollerView=null;this.verticalScrollerView2=null}}this.childViews=c;this.contentViewFrameDidChange();this.tile()},init:function(){arguments.callee.base.apply(this,arguments);this._scroll_contentView=this.get("contentView");var a=this._scroll_contentView;if(a){a.addObserver("frame",this,this.contentViewFrameDidChange)}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewFrameDidChange:function(){var c=this.get("contentView"),b,i=(c)?c.get("frame"):null,g=(i)?i.width:0,a=(i)?i.height:0,j=this.get("frame"),d,h;this._scroll_contentWidth=g;this._scroll_contentHeight=a;if(this.get("hasVerticalScroller")&&(c=this.get("verticalScrollerView"))&&(b=this.get("verticalScrollerView2"))){a-=1;if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",a>j.height)}a-=this.get("verticalScrollerBottom");d=0;h=this.containerView.$()[0];if(h){d=h.offsetHeight}a=a-d;c.setIfChanged("maximum",a);b.setIfChanged("maximum",a)}},_scroll_horizontalScrollOffsetDidChange:function(){},_scroll_verticalScrollOffsetDidChange:function(){var b=this.get("verticalScrollOffset");var a=this.get("contentView");if(a){a.$().css("top",(0-b)+"px")}}.observes("verticalScrollOffset")});sc_require("views/workspace");SC.TO_LEFT="TOLEFT";SC.TO_RIGHT="TORIGHT";SC.NavigationView=SC.WorkspaceView.extend({_views:null,_current:null,navigationContentView:SC.View,init:function(){arguments.callee.base.apply(this,arguments);this._views=[]},createChildViews:function(){arguments.callee.base.apply(this,arguments);var a=this.get("navigationContentView");if(a.isClass){a=this.createChildView(a)}this._defaultContent=this.navigationContentView=a;this.contentView.appendChild(a)},changeNavigationContent:function(a){var c=null,b=null;if(a){c=a.get("topToolbar");b=a.get("bottomToolbar")}if(c&&c.isClass){a.set("topToolbar",c=c.create())}if(b&&b.isClass){a.set("bottomToolbar",b=b.create())}this.beginPropertyChanges();this._current=a;this.set("navigationContentView",a?a:this._defaultContent);this.set("topToolbar",c);this.set("bottomToolbar",b);this.endPropertyChanges()},push:function(a){this._currentDirection=this._current?SC.TO_LEFT:null;if(this._current){this._views.push(this._current)}this.changeNavigationContent(a)},pop:function(){this._currentDirection=SC.TO_RIGHT;var a=this._views.pop();this.changeNavigationContent(a)},popToView:function(b){this._currentDirection=SC.TO_RIGHT;var d=this._views,a=d.length-1,c=d[a];while(c&&c!==b){this._views.pop();a--;c=d[a]}this.changeNavigationContent(c)},topToolbarDidChange:function(){var b=this.activeTopToolbar,a=this.get("topToolbar");if(b){if(this._currentDirection!==null){b.set("buildDirection",this._currentDirection);this.buildOutChild(b)}else{this.removeChild(b)}}if(a){if(this._currentDirection!==null){a.set("buildDirection",this._currentDirection);this.buildInChild(a)}else{this.appendChild(a)}}this.activeTopToolbar=a;this.invokeOnce("childDidChange")}.observes("topToolbar"),bottomToolbarDidChange:function(){var b=this.activeBottomToolbar,a=this.get("bottomToolbar");if(b){if(this._currentDirection!==null){b.set("buildDirection",this._currentDirection);this.buildOutChild(b)}else{this.removeChild(b)}}if(a){if(this._currentDirection!==null){a.set("buildDirection",this._currentDirection);this.buildInChild(a)}else{this.appendChild(a)}}this.activeBottomToolbar=a;this.invokeOnce("childDidChange")}.observes("topToolbar"),contentViewDidChange:function(){var b=this.activeNavigationContentView,a=this.get("navigationContentView");if(!a.isNavigationBuilder){a.mixin(SC.NavigationBuilder)}this._pendingBuildOut=b;this._pendingBuildIn=a;this.activeNavigationContentView=a;this.invokeOnce("childDidChange")}.observes("navigationContentView"),childDidChange:function(){var a=this._pendingBuildIn,b=this._pendingBuildOut;if(b){if(this._currentDirection!==null){b.set("buildDirection",this._currentDirection);this.contentView.buildOutChild(b)}else{this.contentView.removeChild(b)}}this._scws_tile();if(a){if(this._currentDirection!==null){a.set("buildDirection",this._currentDirection);this.contentView.buildInChild(a)}else{this.contentView.appendChild(a)}}}});sc_require("views/toolbar");SC.NavigationBarView=SC.ToolbarView.extend(SC.Gesturable,{init:function(){arguments.callee.base.apply(this,arguments);if(!SC.Animatable){SC.Logger.error("NavigationBarView requires SC.Animatable. Please make your app or framework require the animation framework. CRASH.")}},mixinAnimatable:function(){this.mixin(SC.Animatable);this.transitions=this.navigationTransitions},navigationTransitions:{opacity:{duration:0.25,action:"didFinishTransition"}},style:{opacity:1},gestures:["swipeGesture"],swipeGesture:SC.SwipeGesture,swipe:function(d,i,g){var f=(g===SC.SWIPE_LEFT)?"isSwipeLeft":"isSwipeRight",c=this.get("childViews"),h,b,a=c.get("length");for(b=0;b<a;b++){h=c[b];if(h.get(f)){i.makeTouchResponder(h);i.end();return}}},resetBuild:function(){if(!this.isAnimatable){this.mixinAnimatable()}},didFinishTransition:function(){if(this.isBuildingIn){this.buildInDidFinish()}else{if(this.isBuildingOut){this.buildOutDidFinish()}}},preBuildIn:function(){this.disableAnimation();this.adjust("opacity",0).updateLayout();this.enableAnimation();var c=this.get("childViews"),d,b,a=c.get("length");for(b=0;b<a;b++){d=c[b];if(d.disableNavigationTransition){continue}if(!d._nv_mixedIn){this.mixinNavigationChild(d)}d.disableAnimation();d.transform(this.buildDirection===SC.TO_LEFT?100:-100);d.enableAnimation()}},buildIn:function(){this.preBuildIn();this.invokeLater("startBuildIn",10)},startBuildIn:function(){this.adjust("opacity",1);var c=this.get("childViews"),d,b,a=c.get("length");for(b=0;b<a;b++){d=c[b];if(d.disableNavigationTransition){continue}d.transform(0)}},buildOut:function(){this.adjust("opacity",0);var c=this.get("childViews"),d,b,a=c.get("length");for(b=0;b<a;b++){d=c[b];if(d.disableNavigationTransition){continue}if(!d._nv_mixedIn){this.mixinNavigationChild(d)}d.transform(this.buildDirection===SC.TO_LEFT?-100:100)}},mixinNavigationChild:function(a){if(a.isAnimatable){return}a.mixin(SC.Animatable);a.mixin({transitions:{transform:{timing:SC.Animatable.TRANSITION_EASE_IN_OUT,duration:0.25}},naturalLayout:a.get("layout"),transform:function(b){if(SC.platform.supportsCSS3DTransforms){this.adjust("transform","translate3d("+b+"px,0px,0px)")}else{this.adjust("transform","translate("+b+"px,0px)")}}});a._nv_mixedIn=YES}});sc_require("views/button");SC.PopupButtonView=SC.ButtonView.extend({classNames:["sc-popup-button"],renderDelegateName:"popupButtonRenderDelegate",preferMatrix:null,menu:null,shouldLoadInBackground:NO,init:function(){arguments.callee.base.apply(this,arguments);this._setupMenu();if(this.get("shouldLoadInBackground")){SC.backgroundTaskQueue.push(SC.PopupButtonMenuLoader.create({popupButton:this}))}},_setupMenu:function(){var a=this.get("instantiatedMenu");if(this.isActiveBinding){this.isActiveBinding.disconnect()}this.isActiveBinding=null;if(a&&!a.isClass){this.isActiveBinding=this.bind("isActive",a,"isVisibleInWindow")}},_popup_menuDidChange:function(){this._setupMenu()}.observes("menu"),isActive:NO,_instantiateMenu:function(){var a=this.get("menu");if(!a||!a.isClass){return}this.menu=a.create();this._setupMenu()},instantiatedMenu:function(){var a=this.get("menu");if(a&&a.isClass){this._instantiateMenu();a=this.get("menu")}return a}.property("menu").cacheable(),action:function(a){var b=this.get("instantiatedMenu");if(!b){return NO}b.popup(this,this.get("preferMatrix"));return YES},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this._isMouseDown=YES;this._action();this._menuRenderedTimestamp=0;var b=this;setTimeout(function(){SC.run(function(){b._menuRenderedTimestamp=Date.now()})},1);this.becomeFirstResponder();return YES},mouseUp:function(b){var d=new Date().getTime(),c=this._menuRenderedTimestamp,f=this.get("instantiatedMenu"),g=SC.platform.touch,a;if(c===0){c=Date.now()}if(f){a=f.getPath("rootMenu.targetMenuItem");if(a){if(!a.performAction()){f.remove()}}else{if(!g&&(d-c>SC.ButtonView.CLICK_AND_HOLD_DELAY)){f.remove()}}}this._isMouseDown=NO;arguments.callee.base.apply(this,arguments);return YES},mouseExited:function(a){return YES},performKeyEquivalent:function(b,a){if(!this.get("isEnabled")){return NO}var c=this.get("instantiatedMenu");return(!!c&&c.performKeyEquivalent(b,a,YES))}});SC.PopupButtonMenuLoader=SC.Task.extend({popupButton:null,run:function(){if(this.popupButton){this.popupButton._instantiateMenu()}}});SC.ProgressView=SC.View.extend(SC.Control,{classNames:["sc-progress-view"],displayProperties:["displayValue","ariaValue","minimum","maximum","isEnabled","isIndeterminate","isRunning","isVisibleInWindow"],renderDelegateName:"progressRenderDelegate",value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),displayValue:function(){var b=this.get("minimum")||0,c=this.get("maximum")||1,a=this.get("value")||0;a=(a-b)/(c-b);if(a>1){a=1}if(isNaN(a)){a=0}if(a<b){a=0}if(a>c){a=1}return a}.property("value","maximum","minimum").cacheable(),ariaRole:"progressbar",ariaValue:function(){return this.get("value")}.property("value").cacheable(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),contentMaximumKey:null,isIndeterminate:NO,isIndeterminateBindingDefault:SC.Binding.bool(),isRunning:NO,isRunningBindingDefault:SC.Binding.bool(),contentIsIndeterminateKey:null,contentPropertyDidChange:function(c,a){var b=this.get("content");this.beginPropertyChanges().updatePropertyFromContent("value",a,"contentValueKey",b).updatePropertyFromContent("minimum",a,"contentMinimumKey",b).updatePropertyFromContent("maximum",a,"contentMaximumKey",b).updatePropertyFromContent("isIndeterminate",a,"contentIsIndeterminateKey",b).endPropertyChanges()},didCreateLayer:function(){if(this.get("isIndeterminate")&&this.get("isRunning")&&this.get("isVisibleInWindow")){this.displayDidChange()}}});SC.RadioView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),classNames:["sc-radio-view"],ariaRole:"radiogroup",displayProperties:["displayItems","isEnabled","layoutDirection"],renderDelegateName:"radioGroupRenderDelegate",itemAriaLabeledByKey:null,itemAriaLabelKey:null,value:null,layoutDirection:SC.LAYOUT_VERTICAL,escapeHTML:YES,items:[],itemTitleKey:null,itemWidthKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemsDidChange:function(){if(this._items){this._items.removeObserver("[]",this,this.itemContentDidChange)}this._items=this.get("items");if(this._items){this._items.addObserver("[]",this,this.itemContentDidChange)}this.itemContentDidChange()}.observes("items"),itemContentDidChange:function(){this._renderAsFirstTime=YES;this.notifyPropertyChange("displayItems")},displayItems:function(){var l=this.get("items"),q=this.get("value"),i=SC.isArray(q),g=this.get("localize"),d=this.get("itemTitleKey"),f=this.get("itemValueKey"),p=this.get("itemWidthKey"),c=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL,k=this.get("itemIsEnabledKey"),x=this.get("itemIconKey"),h=this.get("itemAriaLabeledByKey"),z=this.get("itemAriaLabelKey"),w=this._displayItems||[],r=(l)?l.get("length"):0,u,y,m,n,j,v,t,o,b,a,s;for(j=0;j<r;j++){u=l.objectAt(j);if(SC.typeOf(u)===SC.T_ARRAY){y=u[0];n=u[1]}else{if(u){if(d){y=u.get?u.get(d):u[d]}else{y=(u.toString)?u.toString():null}if(p&&c){m=u.get?u.get(p):u[p]}if(f){n=u.get?u.get(f):u[f]}else{n=u}if(k){v=u.get?u.get(k):u[k]}else{v=YES}if(x){t=u.get?u.get(x):u[x]}else{t=null}if(h){a=u.get?u.get(h):u[h]}else{a=null}if(z){s=u.get?u.get(z):u[z]}else{s=null}}else{y=n=t=null;v=NO}}v=v&&this.get("isEnabled");if(u){o=(i)?(q.indexOf(n)>=0):(q===n)}else{o=NO}if(g){y=SC.String.loc(y)}w.push(SC.Object.create({title:y,icon:t,width:m,value:n,isEnabled:v,isSelected:(i&&q.indexOf(n)>=0&&q.length===1)||(q===n),isMixed:(i&&q.indexOf(n)>=0),isActive:this._activeRadioButton===j,theme:this.get("theme"),renderState:{}}))}return w}.property("isEnabled","value","items","itemTitleKey","itemWidthKey","itemValueKey","itemIsEnabledKey","localize","itemIconKey","itemAriaLabeledByKey","itemAriaLabelKey").cacheable(),mouseDown:function(a){if(!this.get("isEnabled")){return YES}var d=this.get("renderDelegate"),c=this.get("renderDelegateProxy"),g=this.$(),b=d.indexForEvent(c,g,a);this._activeRadioButton=b;if(b!==undefined){var f=this.get("displayItems")[b];if(f.get("isEnabled")){f.set("isActive",YES);d.updateRadioAtIndex(c,g,b)}}a.allowDefault();return YES},mouseUp:function(a){if(!this.get("isEnabled")){return YES}var d=this.get("renderDelegate"),c=this.get("renderDelegateProxy"),g=this.$(),h=this.get("displayItems"),b=d.indexForEvent(c,g,a);if(this._activeRadioButton!==undefined&&b!==this._activeRadioButton){h[this._activeRadioButton].set("isActive",NO);d.updateRadioAtIndex(c,g,this._activeRadioButton)}this._activeRadioButton=undefined;if(b!==undefined){var f=this.get("displayItems")[b];if(f.get("isEnabled")){f.set("isActive",NO);d.updateRadioAtIndex(c,g,b);this.set("value",f.value)}}a.allowDefault();return YES},keyDown:function(k){if(!this.get("isEnabled")){return YES}if(k.which===9||k.keyCode===9){var j=k.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(j){j.becomeFirstResponder()}else{k.allowDefault()}return YES}if(k.which>=37&&k.which<=40){var h=this.get("renderDelegate"),g=this.get("renderDelegateProxy"),c=this.$(),f=this.get("displayItems"),b=this.get("value");for(var d=0,a=f.length;d<a;d++){if(b===f[d].value){break}}if(k.which===37||k.which===38){if(d<=0){d=f.length-1}else{d--}}if(k.which===39||k.which===40){if(d>=f.length-1){d=0}else{d++}}h.updateRadioAtIndex(g,c,d);this.set("value",f[d].value)}k.allowDefault();return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)}});SC.SceneView=SC.ContainerView.extend({scenes:["master","detail"],nowShowing:null,transitionDuration:200,_state:"NO_VIEW",replaceContent:function(a){if(a&&this._state===this.READY){this.animateScene(a)}else{this.replaceScene(a)}return this},replaceScene:function(c){var d=this._targetView,f=this.STANDARD_LAYOUT,b=this.get("scenes"),a=b?b.indexOf(this.get("nowShowing")):-1;this._targetView=c;this._targetIndex=a;if(this._timer){this._timer.invalidate()}this._leftView=this._rightView=this._start=this._end=null;this._timer=null;this.removeAllChildren();if(d){d.set("layout",f)}if(c){c.set("layout",f)}if(c){this.appendChild(c)}this._state=c?this.READY:this.NO_VIEW},animateScene:function(b){var c=this._targetView,g=this._targetIndex,a=this.get("scenes"),f=a?a.indexOf(this.get("nowShowing")):-1,d;if(g<0||f<0||g===f){return this.replaceScene(b)}this._targetView=b;this._targetIndex=f;if(f>g){this._leftView=c;this._rightView=b;this._target=-1}else{this._leftView=b;this._rightView=c;this._target=1}this.removeAllChildren();if(c){this.appendChild(c)}if(b){this.appendChild(b)}this._start=Date.now();this._end=this._start+this.get("transitionDuration");this._state=this.ANIMATING;this.tick()},tick:function(){this._timer=null;var a=Date.now(),d=(a-this._start)/(this._end-this._start),h=this._target,g=this._leftView,b=this._rightView,c,f;if(d<0){d=0}if(!this.get("isVisibleInWindow")||(d>=1)){return this.replaceScene(this._targetView)}c=SC.clone(this.get("frame"));f=Math.floor(c.width*d);if(h>0){c.left=0-(c.width-f);g.set("layout",c);c=SC.clone(c);c.left=f;b.set("layout",c)}else{c.left=0-f;g.set("layout",c);c=SC.clone(c);c.left=c.width-f;b.set("layout",c)}this._timer=this.invokeLater(this.tick,20);return this},NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",STANDARD_LAYOUT:{top:0,left:0,bottom:0,right:0}});SC.SegmentView=SC.View.extend(SC.Control,{ariaRole:"button",isSegment:YES,classNames:["sc-segment-view"],toolTip:null,isEnabled:YES,isActive:NO,isSelected:NO,layoutDirection:SC.LAYOUT_HORIZONTAL,controlSize:null,supportFocusRing:NO,displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","width","isSegment","isFirstSegment","isMiddleSegment","isLastSegment","isOverflowSegment","index","layoutDirection"],renderDelegateName:"segmentRenderDelegate",useStaticLayout:YES,title:"",value:null,icon:null,localize:NO,keyEquivalent:null,escapeHTML:YES,needsEllipsis:YES,displayTitle:function(){var a=this.get("title");if(this.get("localize")){a=SC.String.loc(a)}return a}.property("title","localize").cacheable(),width:null,localItem:null,widthDidChange:function(){this.adjust("width",this.get("width"))}.observes("width"),updateItem:function(d,c){var h=d.get("itemKeys"),g,a=d.get("viewKeys"),f,b;for(b=h.get("length")-1;b>=0;b--){g=d.get(h.objectAt(b));f=a.objectAt(b);if(!SC.none(c.get(g))){this.set(f,c.get(g))}}this.set("localItem",c)}});sc_require("views/segment");SC.SegmentedView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled").cacheable(),ariaRole:"group",classNames:["sc-segmented-view"],theme:"square",value:null,isEnabled:YES,allowsEmptySelection:NO,allowsMultipleSelection:NO,selectSegmentWhenTriggeringAction:NO,localize:YES,align:SC.ALIGN_CENTER,layoutDirection:SC.LAYOUT_HORIZONTAL,items:null,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemActionKey:null,itemTargetKey:null,itemLayerIdKey:null,itemKeyEquivalentKey:null,shouldHandleOverflow:YES,overflowTitle:"&raquo;",overflowToolTip:"More&hellip;",overflowIcon:null,segmentViewClass:SC.SegmentView,itemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemWidthKey","itemToolTipKey","itemKeyEquivalentKey","itemLayerIdKey"],viewKeys:["title","value","isEnabled","icon","width","toolTip","keyEquivalent","layerId"],init:function(){arguments.callee.base.apply(this,arguments);var d=this.get("overflowTitle"),a=this.get("overflowToolTip"),b=this.get("overflowIcon"),c;c=this.get("segmentViewClass").create({controlSize:this.get("controlSize"),localize:this.get("localize"),title:d,toolTip:a,icon:b,isLastSegment:YES,isOverflowSegment:YES,layoutDirection:this.get("layoutDirection"),isVisible:this.get("shouldHandleOverflow")});this.set("overflowView",c);this.appendChild(c);this.itemsDidChange()},shouldHandleOverflowDidChange:function(){if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}else{this.get("overflowView").set("isVisible",NO)}}.observes("shouldHandleOverflow"),itemsDidChange:function(){var n=this.get("items")||[],s,c,k,p=this.get("childViews"),l,d=p.lastObject(),q=this.get("value"),b,r=this.get("itemKeys"),a,o=this.get("viewKeys"),g,m=this.get("segmentViewClass"),h,f;if(p.get("length")-1>n.get("length")){for(h=p.get("length")-2;h>=n.get("length");h--){l=p.objectAt(h);c=l.get("localItem");if(c instanceof SC.Object){for(f=r.get("length")-1;f>=0;f--){a=this.get(r.objectAt(f));if(a){c.removeObserver(a,this,this.itemContentDidChange)}}}if(SC.isArray(q)){q.removeObject(c)}else{if(q===c){q=null}}this.removeChild(l)}this.set("value",q)}else{if(p.get("length")-1<n.get("length")){for(h=p.get("length")-1;h<n.get("length");h++){l=m.create({controlSize:this.get("controlSize"),localize:this.get("localize"),layoutDirection:this.get("layoutDirection")});this.insertBefore(l,d)}}}p=this.get("childViews");for(h=0;h<n.get("length");h++){c=n.objectAt(h);l=p.objectAt(h);k=l.get("localItem");if(k instanceof SC.Object&&!n.contains(k)){for(f=r.get("length")-1;f>=0;f--){a=this.get(r.objectAt(f));if(a){k.removeObserver(a,this,this.itemContentDidChange)}}}if(SC.none(c)){continue}if(SC.typeOf(c)===SC.T_STRING){c=SC.Object.create({title:c.humanize().titleize(),value:c});this.set("itemTitleKey","title");this.set("itemValueKey","value")}else{if(SC.typeOf(c)===SC.T_HASH){c=SC.Object.create(c)}else{if(c instanceof SC.Object){for(f=r.get("length")-1;f>=0;f--){a=this.get(r.objectAt(f));if(a){c.removeObserver(a,this,this.itemContentDidChange);c.addObserver(a,this,this.itemContentDidChange,h)}}}else{SC.Logger.error("SC.SegmentedView items may be Strings, Objects (ie. Hashes) or SC.Objects only")}}}b=NO;if(SC.isArray(q)?q.indexOf(c.get(this.get("itemValueKey")))>=0:q===c.get(this.get("itemValueKey"))){b=YES}l.set("isSelected",b);l.set("index",h);l.set("isFirstSegment",h===0);l.set("isMiddleSegment",h<n.get("length")-1&&h>0);l.set("isLastSegment",h===n.get("length")-1);l.updateItem(this,c)}if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}}.observes("*items.[]"),itemContentDidChange:function(f,d,b,c){var a=this.get("items"),g=this.get("childViews"),h;h=g.objectAt(c);if(h){h.updateItem(this,f)}else{SC.Logger.warn("Item content change was observed on item without matching segment child view.")}if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}},viewDidResize:function(){var b=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL,a=b?this.$().width():this.$().height();if(this.get("shouldHandleOverflow")&&(this.isOverflowing||a<=this.cachedMinimumDim)){this.adjustOverflow()}},isVisibleInWindowDidChange:function(){if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}}.observes("isVisibleInWindow"),remeasure:function(){if(!this.get("shouldHandleOverflow")){return}var a=this.get("renderDelegate"),d=this.get("childViews"),c;if(this.get("isVisibleInWindow")){c=d.lastObject();c.set("isVisible",YES);for(var b=d.get("length")-1;b>=0;b--){d.objectAt(b).set("isVisible",YES)}this.cachedDims=this.segmentDimensions();this.cachedOverflowDim=this.overflowSegmentDim();this.adjustOverflow()}},adjustOverflow:function(){if(!this.get("shouldHandleOverflow")){return}var g=this.get("childViews"),f,j=this.get("value"),b=g.lastObject(),h=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL,l=h?this.$().width():this.$().height(),d=0,k,a,c;this.isOverflowing=NO;b.set("isSelected",NO);this.overflowItems=[];a=this.cachedDims.length;for(c=0;c<a;c++){f=g.objectAt(c);d+=this.cachedDims[c];k=(c===a-1)?d:d+this.cachedOverflowDim;if(k>l){this.overflowItems.pushObject(f.get("localItem"));this.isOverflowing=YES;f.set("isVisible",NO);if(c===0){b.set("isFirstSegment",YES)}if(SC.isArray(j)?j.indexOf(f.get("value"))>=0:j===f.get("value")){b.set("isSelected",YES)}}else{f.set("isVisible",YES);if(c===0){b.set("isFirstSegment",NO)}}}if(this.isOverflowing){b.set("isVisible",YES)}else{b.set("isVisible",NO)}this.cachedMinimumDim=d+this.cachedOverflowDim},segmentDimensions:function(){var b=this.get("childViews"),a,g,j=[],h=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL;for(var c=0,d=b.length;c<d-1;c++){a=b[c];g=a.get("frame");j[c]=h?g.width:g.height}return j},overflowSegmentDim:function(){var b=this.get("childViews"),a,c,d=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL;a=b.length&&b[b.length-1];if(a){c=a.get("frame");return d?c.width:c.height}return 0},indexForClientPosition:function(b,j){var d=this.get("childViews"),h,f,c,g,a;a={x:b,y:j};for(f=0,h=d.length;f<h;f++){c=d[f];g=c.get("layer").getBoundingClientRect();g={x:g.left,y:g.top,width:(g.right-g.left),height:(g.bottom-g.top)};if(SC.pointInRect(a,g)){return f}}return -1},displayProperties:["align"],renderDelegateName:"segmentedRenderDelegate",displayItemIndexForEvent:function(b){var c=this.get("renderDelegate");var a=b.clientX;var g=b.clientY;if(a===0&&g===0){var d=b.target;if(d){var f=SC.offset(d);a=f.x+Math.round(d.offsetWidth/2);g=f.y+Math.round(d.offsetHeight/2)}}if(c&&c.indexForClientPosition){return c.indexForClientPosition(this,a,g)}return this.indexForClientPosition(b.clientX,b.clientY)},keyDown:function(c){var h,j,d,f,g,b;if(c.which===9||c.keyCode===9){var a=c.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{c.allowDefault()}return YES}if(!this.get("allowsMultipleSelection")){h=this.get("childViews");f=h.get("length");g=this.get("value");b=SC.isArray(g);if(c.which===39||c.which===40){if(g){for(d=0;d<f-2;d++){j=h.objectAt(d);if(b?(g.indexOf(j.get("value"))>=0):(j.get("value")===g)){this.triggerItemAtIndex(d+1)}}}else{this.triggerItemAtIndex(0)}return YES}else{if(c.which===37||c.which===38){if(g){for(d=1;d<f-1;d++){j=h.objectAt(d);if(b?(g.indexOf(j.get("value"))>=0):(j.get("value")===g)){this.triggerItemAtIndex(d-1)}}}else{this.triggerItemAtIndex(f-2)}return YES}}}return NO},mouseDown:function(a){var c=this.get("childViews"),f,d=c.get("length")-1,b;if(!this.get("isEnabled")){return YES}b=this.displayItemIndexForEvent(a);if(b>=0){f=c.objectAt(b);if(f.get("isEnabled")){f.set("isActive",YES)}this.activeChildView=f;if(b===d){this.showOverflowMenu()}else{this._isMouseDown=YES}}return YES},mouseUp:function(a){var c,b;b=this.displayItemIndexForEvent(a);if(this._isMouseDown&&(b>=0)){this.triggerItemAtIndex(b);c=this.activeChildView;if(c){c.set("isActive",NO);this.activeChildView=null}}this._isMouseDown=NO;return YES},mouseMoved:function(a){var d=this.get("childViews"),f=d.get("length")-1,c,g,b;if(this._isMouseDown){b=this.displayItemIndexForEvent(a);c=this.activeChildView;g=d.objectAt(b);if(g&&g!==c){if(c){c.set("isActive",NO)}if(g.get("isEnabled")){g.set("isActive",YES)}this.activeChildView=g;if(b===f){this.showOverflowMenu();this._isMouseDown=NO}}}return YES},mouseEntered:function(a){var c=this.get("childViews"),f,d=c.get("length")-1,b;if(this._isMouseDown){b=this.displayItemIndexForEvent(a);if(b===d){this.showOverflowMenu();this._isMouseDown=NO}else{if(b>=0){f=c.objectAt(b);if(f.get("isEnabled")){f.set("isActive",YES)}this.activeChildView=f}}}return YES},mouseExited:function(a){var b;if(this._isMouseDown){b=this.activeChildView;if(b){b.set("isActive",NO)}this.activeChildView=null}return YES},touchStart:function(f){var b=this.get("childViews"),d,c=b.get("length")-1,a;if(!this.get("isEnabled")){return YES}a=this.displayItemIndexForEvent(f);if(a>=0){d=b.objectAt(a);d.set("isActive",YES);this.activeChildView=d;if(a===c){this.showOverflowMenu()}else{this._isTouching=YES}}return YES},touchEnd:function(c){var b,a;a=this.displayItemIndexForEvent(c);if(this._isTouching&&(a>=0)){this.triggerItemAtIndex(a);b=this.activeChildView;b.set("isActive",NO);this.activeChildView=null;this._isTouching=NO}return YES},touchesDragged:function(a,f){var i=this.touchIsInBoundary(a),d=this.get("childViews"),g=d.get("length")-1,c,h,b;if(i){if(!this._isTouching){this._touchDidEnter(a)}b=this.displayItemIndexForEvent(a);c=this.activeChildView;h=d[b];if(h&&h!==c){if(c){c.set("isActive",NO)}h.set("isActive",YES);this.activeChildView=h;if(b===g){this.showOverflowMenu();this._isMouseDown=NO}}}else{if(this._isTouching){this._touchDidExit(a)}}this._isTouching=i;return YES},_touchDidExit:function(a){var b;if(this.isTouching){b=this.activeChildView;b.set("isActive",NO);this.activeChildView=null}return YES},_touchDidEnter:function(a){var c=this.get("childViews"),f,d=c.get("length")-1,b;b=this.displayItemIndexForEvent(a);if(b===d){this.showOverflowMenu();this._isTouching=NO}else{if(b>=0){f=c.objectAt(b);f.set("isActive",YES);this.activeChildView=f}}return YES},triggerItemAtIndex:function(j){var l=this.get("childViews"),h,b,m,c,i,g;h=l.objectAt(j);if(!h.get("isEnabled")){return this}i=this.get("allowsEmptySelection");g=this.get("allowsMultipleSelection");b=h.get("value");m=c=this.get("value");if(SC.empty(m)){m=[]}else{if(!SC.isArray(m)){m=[m]}}if(!g){if(i&&(m.get("length")===1)&&(m.objectAt(0)===b)){m=[]}else{m=[b]}}else{if(m.indexOf(b)>=0){if(m.get("length")>1||(m.objectAt(0)!==b)||i){m=m.without(b)}}else{m=m.concat([b])}}switch(m.get("length")){case 0:m=null;break;case 1:m=m.objectAt(0);break;default:break}var o=this.get("itemActionKey"),a=this.get("itemTargetKey"),f,k=null,d=this.getPath("pane.rootResponder"),n;if(o&&(n=this.get("items").objectAt(j))){f=n.get?n.get(o):n[o];if(a){k=n.get?n.get(a):n[a]}if(d){d.sendAction(f,k,this,this.get("pane"),m)}}if(c!==undefined&&(!f||this.get("selectSegmentWhenTriggeringAction"))){this.set("value",m)}f=this.get("action");if(f&&d){d.sendAction(f,this.get("target"),this,this.get("pane"),m)}},selectOverflowItem:function(b){var a=b.get("selectedItem");this.triggerItemAtIndex(a.get("index"));b.removeObserver("selectedItem",this,"selectOverflowItem");this.activeChildView.set("isActive",NO);this.activeChildView=null},showOverflowMenu:function(){var g=this.get("childViews"),b=g.get("length")-1,p=this.overflowItems,l,k,f,j;l=p.get("length");k=g.get("length")-1-l;j=this.get("value");f=SC.isArray(j);for(var c=0;c<l;c++){var o=p.objectAt(c),m=this.get("itemValueKey");if(f?j.indexOf(o.get(m))>=0:j===o.get(m)){o.set("isChecked",YES)}else{o.set("isChecked",NO)}o.set("index",k+c)}var n=this;var a=SC.MenuPane.create({layout:{width:200},items:p,itemTitleKey:this.get("itemTitleKey"),itemIconKey:this.get("itemIconKey"),itemIsEnabledKey:this.get("itemIsEnabledKey"),itemKeyEquivalentKey:this.get("itemKeyEquivalentKey"),itemCheckboxKey:"isChecked",modalPaneDidClick:function(){arguments.callee.base.apply(this,arguments);this.removeObserver("selectedItem",n,"selectOverflowItem");n.activeChildView.set("isActive",NO);n.activeChildView=null}});var d=this.get("layer");var h=d.childNodes[d.childNodes.length-1];a.popup(h);a.addObserver("selectedItem",this,"selectOverflowItem")},valueDidChange:function(){var d=this.get("value"),c,g=this.get("childViews"),h=Infinity,f=g.lastObject(),j,a;if(this.overflowItems){c=this.overflowItems.get("length");h=g.get("length")-1-c;f.set("isSelected",NO)}for(var b=g.get("length")-2;b>=0;b--){j=g.objectAt(b);if(SC.isArray(d)?d.indexOf(j.get("value"))>=0:d===j.get("value")){j.set("isSelected",YES);if(b>=h){f.set("isSelected",YES)}}else{j.set("isSelected",NO)}}}.observes("value")});sc_require("views/button");SC.SelectView=SC.ButtonView.extend({acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),escapeHTML:YES,escapeHTMLBindingDefault:SC.Binding.oneWay().bool(),items:[],itemsBindingDefault:SC.Binding.multiple(),itemTitleKey:null,itemSortKey:null,itemValueKey:null,itemIconKey:null,itemSeparatorKey:"separator",itemIsEnabledKey:"isEnabled",localize:YES,disableSort:YES,classNames:["sc-select-view"],menu:null,_itemList:[],_itemIdx:null,value:null,checkboxEnabled:YES,showCheckbox:YES,emptyName:null,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","items","escapeHTML","emptyName"],preferMatrix:null,CUSTOM_MENU_ITEM_HEIGHT:20,isActiveBinding:"*menu.isVisibleInWindow",isDefaultPosition:NO,lastMenuWidth:null,exampleView:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,menuItemPadding:35,isContextMenuEnabled:NO,supportFocusRing:YES,leftAlign:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:return SC.SelectView.TINY_OFFSET_X;case SC.SMALL_CONTROL_SIZE:return SC.SelectView.SMALL_OFFSET_X;case SC.REGULAR_CONTROL_SIZE:return SC.SelectView.REGULAR_OFFSET_X;case SC.LARGE_CONTROL_SIZE:return SC.SelectView.LARGE_OFFSET_X;case SC.HUGE_CONTROL_SIZE:return SC.SelectView.HUGE_OFFSET_X}return 0}.property("controlSize"),sortObjects:function(b){if(!this.get("disableSort")){var a=this.get("itemSortKey")||this.get("itemTitleKey");b=b.sort(function(d,c){if(a){d=d.get?d.get(a):d[a];c=c.get?c.get(a):c[a]}return(d<c)?-1:((d>c)?1:0)})}return b},render:function(b,h){arguments.callee.base.apply(this,arguments);var r,d,m,s,u,z,i,g,x,j,p,a,o,f,l,y,t,q,v,n,k,w,c;m=this.get("items")||[];m=this.sortObjects(m);s=m.length;u=this.get("itemTitleKey");z=this.get("itemIconKey");i=this.get("itemValueKey");g=this.get("itemSeparatorKey");x=this.get("showCheckbox");k=this.get("itemIsEnabledKey");r=this.get("escapeHTML");j=this.get("value");p=this.get("localize");o=[];f=YES;l=0;w=this.get("emptyName");if(!SC.none(w)){w=p?SC.String.loc(w):w;w=r?SC.RenderContext.escapeHTML(w):w;v=SC.Object.create({separator:NO,title:w,icon:null,value:null,isEnabled:YES,checkbox:NO,target:this,action:"displaySelectedItem"});if(SC.none(j)){this.set("title",w)}o.push(v)}m.forEach(function(A){if(A||A===0){a=g?(A.get?A.get(g):A[g]):NO;if(!a){y=u?(A.get?A.get(u):A[u]):A.toString();y=p?SC.String.loc(y):y;y=r?SC.RenderContext.escapeHTML(y):y;t=z?(A.get?A.get(z):A[z]):null;if(SC.none(A[z])){t=null}q=i?(A.get?A.get(i):A[i]):A;if(!SC.none(j)&&!SC.none(q)){c=false;if(SC.kindOf(j,SC.Record)&&SC.kindOf(q,SC.Record)){c=j.get("storeKey")===q.get("storeKey")}if(j===q||c){this.set("title",y);this.set("icon",t)}}if(q===this.get("value")){this.set("_itemIdx",l);f=!x?NO:YES}else{f=NO}n=(A.get?A.get(k):A[k]);if(NO!==n){n=YES}if(SC.none(this._defaultVal)&&n){this._defaultVal=q;this._defaultTitle=y;this._defaultIcon=t}}v=SC.Object.create({separator:a,title:y,icon:t,value:q,isEnabled:n,checkbox:f,target:this,action:"displaySelectedItem"});o.push(v)}l+=1;this.set("_itemList",o)},this);if(h){this.invokeLast(function(){var A=this.get("value");if(SC.none(A)){if(SC.none(w)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);this.set("icon",this._defaultIcon)}else{this.set("title",w)}}})}this.changeSelectPreferMatrix(this.get("_itemIdx"))},_action:function(m){var j,a,k,l,r,o,z,f,y,c,n,t,p,w,g,h,b,x,i,s;j=this.$(".sc-button-label")[0];var A=SC.SelectView.MENU_WIDTH_OFFSET;if(!this.get("isDefaultPosition")){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:A+=SC.SelectView.TINY_POPUP_MENU_WIDTH_OFFSET;break;case SC.SMALL_CONTROL_SIZE:A+=SC.SelectView.SMALL_POPUP_MENU_WIDTH_OFFSET;break;case SC.REGULAR_CONTROL_SIZE:A+=SC.SelectView.REGULAR_POPUP_MENU_WIDTH_OFFSET;break;case SC.LARGE_CONTROL_SIZE:A+=SC.SelectView.LARGE_POPUP_MENU_WIDTH_OFFSET;break;case SC.HUGE_CONTROL_SIZE:A+=SC.SelectView.HUGE_POPUP_MENU_WIDTH_OFFSET;break}}a=this.get("layer").offsetWidth+A;a=this.get("layer").offsetWidth;k=j.scrollWidth;l=this.get("lastMenuWidth");if(k){r=j.offsetWidth;if(k&&r){a=a+k-r}}if(!l||(a>l)){l=a}o=this.get("_itemList");var u=this.get("customViewClassName");var q=this.get("customViewMenuOffsetWidth");var d="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button sc-scroll-view sc-menu-scroll-view sc-container-view menuContainer sc-button-view sc-menu-item sc-regular-size";d=u?(d+" "+u):d;SC.prepareStringMeasurement("",d);for(n=0,x=o.length;n<x;++n){y=o.objectAt(n);z=SC.measureString(y.title).width;if(!f||(z>f)){f=z}}SC.teardownStringMeasurement();l=(f+this.menuItemPadding>l)?f+this.menuItemPadding:l;var v=SC.RootResponder.responder.get("currentWindowSize").width;if(l>v){l=(v-25)}this.set("lastMenuWidth",l);t=this.get("value");p=this.get("_itemList");w=this.get("controlSize");g=this.get("menuPaneHeightPadding");s=this.get("escapeHTML");h=this.get("exampleView")||SC.MenuItemView.extend({escapeHTML:s});b=SC.MenuPane.create({classNames:["select-button"],items:p,exampleView:h,isEnabled:YES,menuHeightPadding:g,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:l},controlSize:w,itemWidth:l});if(!b){return NO}b.popup(this,this.preferMatrix);this.set("menu",b);i=this._itemIdx;if(!SC.empty(i)&&i>-1){h=b.menuItemViewForContentIndex(i);if(h){h.becomeFirstResponder()}}this.set("isActive",YES);return YES},displaySelectedItem:function(a){var b=a.get("selectedItem");this.set("value",b.get("value"));this.set("title",b.get("title"));this.set("_itemIdx",b.get("contentIndex"))},changeSelectPreferMatrix:function(){var c=0,h=0;switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:c=SC.SelectView.TINY_OFFSET_Y;h=SC.MenuPane.TINY_MENU_ITEM_HEIGHT;break;case SC.SMALL_CONTROL_SIZE:c=SC.SelectView.SMALL_OFFSET_Y;h=SC.MenuPane.SMALL_MENU_ITEM_HEIGHT;break;case SC.REGULAR_CONTROL_SIZE:c=SC.SelectView.REGULAR_OFFSET_Y;h=SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT;break;case SC.LARGE_CONTROL_SIZE:c=SC.SelectView.LARGE_OFFSET_Y;h=SC.MenuPane.LARGE_MENU_ITEM_HEIGHT;break;case SC.HUGE_CONTROL_SIZE:c=SC.SelectView.HUGE_OFFSET_Y;h=SC.MenuPane.HUGE_MENU_ITEM_HEIGHT;break}var f=c,b=this.get("_itemIdx"),a=this.get("leftAlign"),g,d;if(this.get("isDefaultPosition")){g=[1,0,3];this.set("preferMatrix",g)}else{if(b){f=b*h+c}d=[a,-f,2];this.set("preferMatrix",d)}},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;this.becomeFirstResponder();this._action();return YES},mouseUp:function(b){var d=this.get("menu"),a,c;if(d){a=d.getPath("rootMenu.targetMenuItem");if(a&&d.get("mouseHasEntered")){if(!a.performAction()){d.remove()}}else{if(b.timeStamp-this._mouseDownTimestamp>400){d.remove()}}}this._isMouseDown=NO;this.set("isActive",NO);return YES},mouseExited:function(){return YES},keyDown:function(a){if(this.interpretKeyEvents(a)){return YES}else{return arguments.callee.base.apply(this,arguments)}},interpretKeyEvents:function(a){if(a){if((a.keyCode===38||a.keyCode===40)){this._action()}else{if(a.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)},_button_isSelectedDidChange:function(){}.observes("isSelected")});SC.SelectView.TINY_OFFSET_X=0;SC.SelectView.TINY_OFFSET_Y=0;SC.SelectView.TINY_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectView.SMALL_OFFSET_X=-18;SC.SelectView.SMALL_OFFSET_Y=3;SC.SelectView.SMALL_POPUP_MENU_WIDTH_OFFSET=7;SC.SelectView.REGULAR_OFFSET_X=-17;SC.SelectView.REGULAR_OFFSET_Y=0;SC.SelectView.REGULAR_POPUP_MENU_WIDTH_OFFSET=4;SC.SelectView.LARGE_OFFSET_X=-17;SC.SelectView.LARGE_OFFSET_Y=6;SC.SelectView.LARGE_POPUP_MENU_WIDTH_OFFSET=3;SC.SelectView.HUGE_OFFSET_X=0;SC.SelectView.HUGE_OFFSET_Y=0;SC.SelectView.HUGE_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectView.MENU_WIDTH_OFFSET=-2;sc_require("views/button");SC.SelectButtonView=SC.ButtonView.extend({init:function(){arguments.callee.base.apply(this,arguments)},escapeHTML:YES,objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,iconKey:null,isEnabledKey:"isEnabled",localize:YES,disableSort:YES,classNames:["select-button"],menu:null,itemList:[],itemIdx:null,value:null,checkboxEnabled:YES,separatorPosition:null,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","objects","objects.[]"],preferMatrix:null,SELECT_BUTTON_SPRITE_WIDTH:28,isActiveBinding:"*menu.isVisibleInWindow",isDefaultPosition:NO,lastMenuWidth:null,customView:null,customViewClassName:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,supportFocusRing:YES,isContextMenuEnabled:NO,leftAlign:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:return SC.SelectButtonView.TINY_OFFSET_X;case SC.SMALL_CONTROL_SIZE:return SC.SelectButtonView.SMALL_OFFSET_X;case SC.REGULAR_CONTROL_SIZE:return SC.SelectButtonView.REGULAR_OFFSET_X;case SC.LARGE_CONTROL_SIZE:return SC.SelectButtonView.LARGE_OFFSET_X;case SC.HUGE_CONTROL_SIZE:return SC.SelectButtonView.HUGE_OFFSET_X}return 0}.property("controlSize"),sortObjects:function(b){if(!this.get("disableSort")){var a=this.get("sortKey")||this.get("nameKey");b=b.sort(function(d,c){if(a){d=d.get?d.get(a):d[a];c=c.get?c.get(a):c[a]}return(d<c)?-1:((d>c)?1:0)})}return b},render:function(b,f){arguments.callee.base.apply(this,arguments);var c,a,o,q,u,g,s,h,m,t,l,d,j,v,p,n,r,k,i;c=this.layout.width;if(f&&c){this.adjust({width:c-this.SELECT_BUTTON_SPRITE_WIDTH})}a=this.get("objects");a=this.sortObjects(a);o=a.length;q=this.get("nameKey");u=this.get("iconKey");g=this.get("valueKey");i=this.get("isEnabledKey");s=this.get("checkboxEnabled");h=this.get("value");m=this.get("localize");t=this.get("separatorPosition");l=[];d=YES;j=0;a.forEach(function(w){if(w){v=q?(w.get?w.get(q):w[q]):w.toString();v=m?SC.String.loc(v):v;p=u?(w.get?w.get(u):w[u]):null;if(SC.none(w[u])){p=null}n=(g)?(w.get?w.get(g):w[g]):w;if(!SC.none(h)&&!SC.none(n)){if(this._equals(h,n)){this.set("title",v);this.set("icon",p)}}if(this._equals(n,this.get("value"))){if(t>0&&t<o&&j>=o-t){j++}this.set("itemIdx",j);d=!s?NO:YES}else{d=NO}k=(i)?(w.get?w.get(i):w[i]):w;if(NO!==k){k=YES}if(j===0){this._defaultVal=n;this._defaultTitle=v;this._defaultIcon=p}var x=SC.Object.create({title:v,icon:p,value:n,isEnabled:k,checkbox:d,target:this,action:"displaySelectedItem"});l.push(x)}j+=1;if(t&&j===(o-t)){var y=SC.Object.create({separator:YES});l.push(y)}this.set("itemList",l)},this);if(f){b.attr("aria-haspopup","true");this.invokeLast(function(){var w=this.get("value");if(SC.none(w)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);this.set("icon",this._defaultIcon)}})}this.changeSelectButtonPreferMatrix(this.itemIdx)},_equals:function(b,a){var c=YES;if(b&&SC.typeOf(b)===SC.T_HASH&&a&&SC.typeOf(a)===SC.T_HASH){for(var d in b){if(b[d]!==a[d]){c=NO}}}else{c=(b===a)}return c},_action:function(p){var j,a,m,n,u,r,B,f,A,c,q,v,s,y,g,h,o,b,z,i,l,C,k;j=this.$(".sc-button-label")[0];C=SC.SelectButtonView.MENU_WIDTH_OFFSET;if(!this.get("isDefaultPosition")){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:C+=SC.SelectButtonView.TINY_POPUP_MENU_WIDTH_OFFSET;break;case SC.SMALL_CONTROL_SIZE:C+=SC.SelectButtonView.SMALL_POPUP_MENU_WIDTH_OFFSET;break;case SC.REGULAR_CONTROL_SIZE:C+=SC.SelectButtonView.REGULAR_POPUP_MENU_WIDTH_OFFSET;break;case SC.LARGE_CONTROL_SIZE:C+=SC.SelectButtonView.LARGE_POPUP_MENU_WIDTH_OFFSET;break;case SC.HUGE_CONTROL_SIZE:C+=SC.SelectButtonView.HUGE_POPUP_MENU_WIDTH_OFFSET;break}}a=this.get("layer").offsetWidth+C;m=j.scrollWidth;n=this.get("lastMenuWidth");if(m){u=j.offsetWidth;if(m&&u){a=a+m-u}}if(!n||(a>n)){n=a}r=this.get("itemList");var w=this.get("customViewClassName"),t=this.get("customViewMenuOffsetWidth"),d="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button menu sc-scroll-view sc-menu-scroll-view sc-container-view sc-menu-item menu-item value sc-regular-size";d=w?(d+" "+w):d;i=(this.get("customView")||SC.MenuItemView).create();l=i.get("escapeHTML");k=document.body;for(q=0,z=r.length;q<z;++q){A=r.objectAt(q);c=document.createElement("div");c.style.cssText="top:-10000px; left: -10000px;  position: absolute;";c.className=d;c.innerHTML=l?SC.RenderContext.escapeHTML(A.title):A.title;k.appendChild(c);B=c.offsetWidth+t;if(!f||(B>f)){f=B}k.removeChild(c)}f=(f>n)?f:n;var x=SC.RootResponder.responder.get("currentWindowSize").width;if(f>x){f=(x-25)}this.set("lastMenuWidth",n);v=this.get("value");s=this.get("itemList");y=this.get("controlSize");h=this.get("customView");o=h?h:SC.MenuItemView;b=SC.MenuPane.create({classNames:["select-button"],items:s,exampleView:o,isEnabled:YES,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:f},controlSize:y,itemWidth:n,performKeyEquivalent:function(E,D){switch(E){case"tab":case"shift_tab":return YES;default:return arguments.callee.base.apply(this,arguments)}}});if(!b){return NO}b.popup(this,this.preferMatrix);this.set("menu",b);h=b.menuItemViewForContentIndex(this.get("itemIdx"));b.set("currentMenuItem",h);if(h){h.becomeFirstResponder()}this.set("isActive",YES);return YES},displaySelectedItem:function(a){var b=this.getPath("menu.selectedItem");if(!b){return NO}this.set("value",b.get("value"));this.set("title",b.get("title"));this.set("itemIdx",b.get("contentIndex"));return YES},changeSelectButtonPreferMatrix:function(){var b=0,i=0,d=0,f=0,j,g;switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:b=SC.SelectButtonView.TINY_OFFSET_Y;i=SC.MenuPane.TINY_MENU_ITEM_HEIGHT;d=SC.MenuPane.TINY_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.SMALL_CONTROL_SIZE:b=SC.SelectButtonView.SMALL_OFFSET_Y;i=SC.MenuPane.SMALL_MENU_ITEM_HEIGHT;d=SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.REGULAR_CONTROL_SIZE:b=SC.SelectButtonView.REGULAR_OFFSET_Y;i=SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT;d=SC.MenuPane.REGULAR_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.LARGE_CONTROL_SIZE:b=SC.SelectButtonView.LARGE_OFFSET_Y;i=SC.MenuPane.LARGE_MENU_ITEM_HEIGHT;d=SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.HUGE_CONTROL_SIZE:b=SC.SelectButtonView.HUGE_OFFSET_Y;i=SC.MenuPane.HUGE_MENU_ITEM_HEIGHT;d=SC.MenuPane.HUGE_MENU_ITEM_SEPARATOR_HEIGHT;break}var h=b,a=this.get("itemIdx"),l=this.get("leftAlign"),k,c;if(this.get("isDefaultPosition")){k=[1,0,3];this.set("preferMatrix",k)}else{if(a){h=a*i+b;j=this.get("separatorPosition");g=this.get("objects").length;if(j>0&&j<g&&a>=g-j){f=i-d;h-=f}}c=[l,-h,2];this.set("preferMatrix",c)}},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;this.becomeFirstResponder();this._action();this._menuRenderedTimestamp=0;var b=this;setTimeout(function(){SC.run(function(){b._menuRenderedTimestamp=Date.now()})},1);return YES},_recordMouseDownTimestamp:function(){this._menuRenderedTimestamp=new Date().getTime()},mouseUp:function(b){var d=new Date().getTime(),c=this._menuRenderedTimestamp,f=this.get("menu"),g=SC.platform.touch,a;if(c===0){c=Date.now()}if(f){a=f.getPath("rootMenu.targetMenuItem");if(a&&a.get("mouseHasEntered")){if(!a.performAction()){f.remove()}}else{if(!g&&(d-c>SC.ButtonView.CLICK_AND_HOLD_DELAY)){if(!f.get("mouseHasEntered")&&!this.get("isDefaultPosition")){a=f.get("currentMenuItem");if(a&&!a.performAction()){f.remove()}}else{f.remove()}}}}this._isMouseDown=NO;this.set("isActive",NO);return YES},mouseExited:function(){return YES},keyDown:function(a){if(this.interpretKeyEvents(a)){return YES}else{return arguments.callee.base.apply(this,arguments)}},interpretKeyEvents:function(a){if(a){if((a.keyCode===38||a.keyCode===40)){this._action()}else{if(a.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),insertTab:function(b){var a=this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},insertBacktab:function(b){var a=this.get("previousValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},_button_isSelectedDidChange:function(){}.observes("isSelected"),didAppendToDocument:function(){}});SC.SelectButtonView.TINY_OFFSET_X=0;SC.SelectButtonView.TINY_OFFSET_Y=0;SC.SelectButtonView.TINY_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectButtonView.SMALL_OFFSET_X=-18;SC.SelectButtonView.SMALL_OFFSET_Y=3;SC.SelectButtonView.SMALL_POPUP_MENU_WIDTH_OFFSET=7;SC.SelectButtonView.REGULAR_OFFSET_X=-17;SC.SelectButtonView.REGULAR_OFFSET_Y=3;SC.SelectButtonView.REGULAR_POPUP_MENU_WIDTH_OFFSET=4;SC.SelectButtonView.LARGE_OFFSET_X=-17;SC.SelectButtonView.LARGE_OFFSET_Y=6;SC.SelectButtonView.LARGE_POPUP_MENU_WIDTH_OFFSET=3;SC.SelectButtonView.HUGE_OFFSET_X=0;SC.SelectButtonView.HUGE_OFFSET_Y=0;SC.SelectButtonView.HUGE_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectButtonView.MENU_WIDTH_OFFSET=-2;SC.MenuPane.TINY_MENU_ITEM_HEIGHT=10;SC.MenuPane.TINY_MENU_ITEM_SEPARATOR_HEIGHT=2;SC.MenuPane.TINY_MENU_HEIGHT_PADDING=2;SC.MenuPane.TINY_SUBMENU_OFFSET_X=0;SC.MenuPane.SMALL_MENU_ITEM_HEIGHT=16;SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT=7;SC.MenuPane.SMALL_MENU_HEIGHT_PADDING=4;SC.MenuPane.SMALL_SUBMENU_OFFSET_X=2;SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT=22;SC.MenuPane.REGULAR_MENU_ITEM_SEPARATOR_HEIGHT=9;SC.MenuPane.REGULAR_MENU_HEIGHT_PADDING=6;SC.MenuPane.REGULAR_SUBMENU_OFFSET_X=2;SC.MenuPane.LARGE_MENU_ITEM_HEIGHT=31;SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT=20;SC.MenuPane.LARGE_MENU_HEIGHT_PADDING=0;SC.MenuPane.LARGE_SUBMENU_OFFSET_X=4;SC.MenuPane.HUGE_MENU_ITEM_HEIGHT=20;SC.MenuPane.HUGE_MENU_ITEM_SEPARATOR_HEIGHT=9;SC.MenuPane.HUGE_MENU_HEIGHT_PADDING=0;SC.MenuPane.HUGE_SUBMENU_OFFSET_X=0;SC.SelectFieldView=SC.FieldView.extend({displayProperties:["objects","nameKey","valueKey","isEnabled"],acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),tagName:"select",classNames:["sc-select-field-view"],objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,emptyName:null,localize:NO,cpDidChange:YES,disableSort:NO,validateMenuItem:function(b,a){return YES},sortObjects:function(b){if(!this.get("disableSort")){var a=this.get("sortKey")||this.get("nameKey");if(a){b=b.sortProperty(a)}else{b=b.sort(function(d,c){if(a){d=d.get?d.get(a):d[a];c=c.get?c.get(a):c[a]}return(d<c)?-1:((d>c)?1:0)})}}return b},render:function(c,a){if(a||this.get("cpDidChange")){this.set("cpDidChange",NO);var g=this.get("nameKey");var k=this.get("valueKey");var j=this.get("objects");var b=this.get("value");var d,h;if(!this.get("isEnabled")){c.attr("disabled","disabled")}var i=this.get("localize");if(!k&&b){b=SC.guidFor(b)}if((b===null)||(b==="")){b="***"}if(j){j=this.sortObjects(j);if(!a){h=this.$input()[0];if(!h){return}h.innerHTML=""}var f=this.get("emptyName");if(f){if(i){f=SC.String.loc(f)}if(a){c.push('<option value="***">'+f+"</option>",'<option disabled="disabled"></option>')}else{d=document.createElement("option");d.value="***";d.innerHTML=f;h.appendChild(d);d=document.createElement("option");d.disabled="disabled";h.appendChild(d)}}j.forEach(function(o,n){if(o){var m=g?(o.get?o.get(g):o[g]):o.toString();if(i){m=SC.String.loc(m)}var p=(k)?(o.get?o.get(k):o[k]):o;if(!f&&n===0&&b==="***"){this.set("value",p)}if(p!==null&&p!==undefined){p=(SC.guidFor(p))?SC.guidFor(p):p.toString()}var l=(this.validateMenuItem&&this.validateMenuItem(p,m))?"":'disabled="disabled" ';if(a){c.push("<option "+l+'value="'+p+'">'+m+"</option>")}else{d=document.createElement("option");d.value=p;d.innerHTML=m;if(l.length>0){d.disable="disabled"}h.appendChild(d)}}else{if(a){c.push('<option disabled="disabled"></option>')}else{d=document.createElement("option");d.disabled="disabled";h.appendChild(d)}}},this);this.setFieldValue(b)}else{this.set("value",null)}}else{this.$().prop("disabled",!this.get("isEnabled"))}},_objectsObserver:function(){this.set("cpDidChange",YES)}.observes("objects"),_objectArrayObserver:function(){this.set("cpDidChange",YES);this.propertyDidChange("objects")}.observes("*objects.[]"),_nameKeyObserver:function(){this.set("cpDidChange",YES)}.observes("nameKey"),_valueKeyObserver:function(){this.set("cpDidChange",YES)}.observes("valueKey"),_isEnabledObserver:function(){this.set("cpDidChange",YES)}.observes("isEnabled"),$input:function(){return this.$()},mouseDown:function(a){if(!this.get("isEnabled")){a.stop();return YES}else{return arguments.callee.base.apply(this,arguments)}},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},keyDown:function(a){if((a.which===SC.Event.KEY_RETURN)||(a.which===SC.Event.KEY_ESC)){return NO}this.invokeLater("_field_fieldValueDidChange");return arguments.callee.base.apply(this,arguments)},getFieldValue:function(){var g=arguments.callee.base.apply(this,arguments);var c=this.get("valueKey");var f=this.get("objects");var d=null;var a;if(g=="***"){g=null}else{if(g&&f){var h=(SC.typeOf(f.length)===SC.T_FUNCTION)?f.length():f.length;while(!d&&(--h>=0)){a=f.objectAt?f.objectAt(h):f[h];if(a===null||a===undefined){continue}if(c){a=(a.get)?a.get(c):a[c]}var b=(a!==null&&a!==undefined)?(SC.guidFor(a)?SC.guidFor(a):a.toString()):null;if(g==b){d=a}}}}return(c||d)?d:g},setFieldValue:function(a){if(SC.none(a)){a="***"}else{a=((a!==null&&a!==undefined)?(SC.guidFor(a)?SC.guidFor(a):a.toString()):null)}this.$input().val(a);return this},fieldDidFocus:function(){var a=this.get("isFocused");if(!a){this.set("isFocused",true)}},fieldDidBlur:function(){var a=this.get("isFocused");if(a){this.set("isFocused",false)}},_isFocusedObserver:function(){this.$().setClass("focus",this.get("isFocused"))}.observes("isFocused"),didCreateLayer:function(){var a=this.$input();if(this.get("isEnabled")===false){this.$()[0].disabled=true}SC.Event.add(a,"blur",this,this.fieldDidBlur);SC.Event.add(a,"focus",this,this.fieldDidFocus);SC.Event.add(a,"change",this,this._field_fieldValueDidChange)},willDestroyLayer:function(){var a=this.$input();SC.Event.remove(a,"focus",this,this.fieldDidFocus);SC.Event.remove(a,"blur",this,this.fieldDidBlur);SC.Event.remove(a,"change",this,this._field_fieldValueDidChange)}});SC.SliderView=SC.View.extend(SC.Control,{classNames:"sc-slider-view",ariaRole:"slider",value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),contentMaximumKey:null,step:0.1,displayProperties:["displayValue","ariaValue","minimum","maximum","step","frame"],ariaValue:function(){return this.get("value")}.property("value").cacheable(),renderDelegateName:"sliderRenderDelegate",displayValue:function(){var b=this.get("minimum"),a=this.get("maximum"),d=this.get("value"),c=this.get("step");d=Math.min(Math.max(d,b),a);if(!SC.none(c)&&c!==0){d=Math.round(d/c)*c}if(d!==0){d=Math.floor((d-b)/(a-b)*100)}return d}.property("value","minimum","maximum","step").cacheable(),_isMouseDown:NO,mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;return this._triggerHandle(a,YES)},mouseDragged:function(a){return this._isMouseDown?this._triggerHandle(a):YES},mouseUp:function(a){if(this._isMouseDown){this.set("isActive",NO)}var b=this._isMouseDown?this._triggerHandle(a):YES;this._isMouseDown=NO;return b},mouseWheel:function(b){if(!this.get("isEnabled")){return YES}var d=this.get("minimum"),a=this.get("maximum"),f=this.get("step"),c=this.get("value")+((b.wheelDeltaX+b.wheelDeltaY)*f),g=Math.round(c/f)*f;if(c<d){this.setIfChanged("value",d)}else{if(c>a){this.setIfChanged("value",a)}else{this.setIfChanged("value",c)}}return YES},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},touchesDragged:function(a){return this.mouseDragged(a)},_triggerHandle:function(j,f){var a=this.get("frame").width,c=this.get("minimum"),g=this.get("maximum"),b=this.get("step"),i=this.get("value"),d;if(f){d=this.convertFrameFromView({x:j.pageX}).x;this._evtDiff=j.pageX-d}else{d=j.pageX-this._evtDiff}d=Math.max(0,Math.min(d/a,1));if(f){var h=this.get("value");h=(h-c)/(g-c);if(Math.abs(h*a-d*a)<16){this._offset=h-d}else{this._offset=0}}d=Math.max(0,Math.min(d+this._offset,1));d=c+((g-c)*d);if(b!==0){d=Math.round(d/b)*b}if(Math.abs(i-d)>=0.01){this.set("value",d)}return YES},acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),keyDown:function(i){if(i.which===9||i.keyCode===9){var g=i.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(g){g.becomeFirstResponder()}else{i.allowDefault()}return YES}if(i.which>=33&&i.which<=40){var d=this.get("minimum"),h=this.get("maximum"),b=this.get("step"),j=h-d,a=0,c,f=this.get("value");if(i.which===37||i.which===38||i.which===34){if(b===0){if(j<100){a=f-1}else{c=Math.abs(j/100);if(c<2){c=2}a=f-c}}else{a=f-b}}if(i.which===39||i.which===40||i.which===33){if(b===0){if(j<100){a=f+2}else{c=Math.abs(j/100);if(c<2){c=2}a=f+c}}else{a=f+b}}if(i.which===36){a=h}if(i.which===35){a=d}if(a>=d&&a<=h){this.set("value",a)}}else{i.allowDefault();return NO}return YES},contentKeys:{contentValueKey:"value",contentMinimumKey:"minimum",contentMaximumKey:"maximum",contentIsIndeterminateKey:"isIndeterminate"}});sc_require("mixins/collection_group");sc_require("views/disclosure");SC.SourceListGroupView=SC.View.extend(SC.Control,SC.CollectionGroup,{classNames:["sc-source-list-group"],content:null,isGroupVisible:YES,hasGroupTitle:YES,groupTitleKey:null,groupVisibleKey:null,render:function(a,b){a.push('<div role="button" class="sc-source-list-label sc-disclosure-view sc-button-view button disclosure no-disclosure">','<img src="'+SC.BLANK_IMAGE_URL+'" class="button" />','<span class="label"></span></div>')},createChildViews:function(){},contentPropertyDidChange:function(g,c){var f=this.get("content");var i=this.outlet("labelView");if(f===null){i.setIfChanged("isVisible",NO);this.setIfChanged("hasGroupTitle",NO);return}else{i.setIfChanged("isVisible",YES);this.setIfChanged("hasGroupTitle",YES)}var b=this.getDelegateProperty("groupTitleKey",this.displayDelegate);if((c=="*")||(b&&(c==b))){var h=(f&&f.get&&b)?f.get(b):f;if(h!=this._title){this._title=h;if(h){h=h.capitalize()}i.set("title",h)}}var d=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);if((c=="*")||(d&&(c==d))){if(d){i.removeClassName("no-disclosure");var a=(f&&f.get)?!!f.get(d):YES;if(a!=this.get("isGroupVisible")){this.set("isGroupVisible",a);i.set("value",a)}}else{i.addClassName("no-disclosure")}}},disclosureValueDidChange:function(c){if(c==this.get("isGroupVisible")){return}var b=this.get("content");var a=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);if(b&&b.set&&a){b.set(a,c)}this.set("isGroupVisible",c);if(this.owner&&this.owner.updateChildren){this.owner.updateChildren(true)}},labelView:SC.DisclosureView.extend({value:YES,_valueObserver:function(){if(this.owner){this.owner.disclosureValueDidChange(this.get("value"))}}.observes("value")})});sc_require("views/list");sc_require("views/source_list_group");SC.SourceListView=SC.ListView.extend({theme:"source-list",classNames:["sc-source-list"],rowHeight:32,selectOnMouseDown:NO,actOnSelect:YES});SC.SplitDividerView=SC.View.extend({classNames:["sc-split-divider-view"],mouseDown:function(a){var b=this.get("splitView");return(b)?b.mouseDownInThumbView(a,this):arguments.callee.base.apply(this,arguments)},doubleClick:function(a){var b=this.get("splitView");return(b)?b.doubleClickInThumbView(a,this):arguments.callee.base.apply(this,arguments)},touchStart:function(a){return this.mouseDown(a)}});sc_require("views/split_divider");SC.RESIZE_BOTH="resize-both";SC.RESIZE_TOP_LEFT="resize-top-left";SC.RESIZE_BOTTOM_RIGHT="resize-bottom-right";SC.SplitView=SC.View.extend({classNames:["sc-split-view"],displayProperties:["layoutDirection"],delegate:null,layoutDirection:SC.LAYOUT_HORIZONTAL,canCollapseViews:YES,autoresizeBehavior:SC.RESIZE_BOTTOM_RIGHT,defaultThickness:0.5,topLeftMinThickness:null,topLeftMaxThickness:null,bottomRightMinThickness:null,bottomRightMaxThickness:null,dividerThickness:null,isSplitView:YES,topLeftView:SC.View,dividerView:SC.SplitDividerView,bottomRightView:SC.View,topLeftThickness:function(){var a=this.get("topLeftView");return a?this.thicknessForView(a):0}.property("topLeftView").cacheable(),bottomRightThickness:function(){var a=this.get("bottomRightView");return a?this.thicknessForView(a):0}.property("bottomRightView").cacheable(),thumbViewCursor:null,canCollapseView:function(a){return this.invokeDelegateMethod(this.delegate,"splitViewCanCollapse",this,a)},thicknessForView:function(a){var c=this.get("layoutDirection"),b=a.get("frame");return(c===SC.LAYOUT_HORIZONTAL)?b.width:b.height},createChildViews:function(){var f=[],c=["topLeftView","dividerView","bottomRightView"],b=c.length,a,d;for(d=0;d<b;++d){if(a=this.get(c[d])){a=this[c[d]]=this.createChildView(a,{layoutView:this,rootElementPath:[d]});f.push(a)}}this.set("childViews",f);return this},updateChildLayout:function(){var b=this.get("topLeftView"),c=this.get("bottomRightView"),j=this.get("dividerView"),f=this.get("autoresizeBehavior"),k=this.get("layoutDirection"),a=this.get("frame"),d=this._desiredTopLeftThickness,l=this.get("dividerThickness"),i=(k===SC.LAYOUT_HORIZONTAL)?a.width:a.height,m=i-l-d,h,g;l=(!SC.none(l))?l:7;g=b.get("isCollapsed")||NO;b.setIfChanged("isVisible",!g);h=SC.clone(b.get("layout"));if(k===SC.LAYOUT_HORIZONTAL){h.top=0;h.left=0;h.bottom=0;switch(f){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:h.right=m+l;delete h.width;break;case SC.RESIZE_BOTTOM_RIGHT:delete h.right;delete h.height;h.width=d;break}}else{h.top=0;h.left=0;h.right=0;switch(f){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:h.bottom=m+l;delete h.height;break;case SC.RESIZE_BOTTOM_RIGHT:h.height=d;delete h.bottom;delete h.width;break}}b.set("layout",h);if(j){h=SC.clone(j.get("layout"));if(k===SC.LAYOUT_HORIZONTAL){h.width=l;h.top=0;h.bottom=0;delete h.height;switch(f){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:h.right=m;delete h.left;delete h.centerX;delete h.centerY;break;case SC.RESIZE_BOTTOM_RIGHT:h.left=d;delete h.right;delete h.centerX;delete h.centerY;break}}else{h.height=l;h.left=0;h.right=0;delete h.width;switch(f){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:h.bottom=m;delete h.top;delete h.centerX;delete h.centerY;break;case SC.RESIZE_BOTTOM_RIGHT:h.top=d;delete h.bottom;delete h.centerX;delete h.centerY;break}}j.set("layout",h)}g=c.get("isCollapsed")||NO;c.setIfChanged("isVisible",!g);h=SC.clone(c.get("layout"));if(k===SC.LAYOUT_HORIZONTAL){h.top=0;h.bottom=0;h.right=0;switch(f){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_BOTTOM_RIGHT:h.left=d+l;delete h.width;break;case SC.RESIZE_TOP_LEFT:h.width=m;delete h.left;break}}else{h.left=0;h.right=0;h.bottom=0;switch(f){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_BOTTOM_RIGHT:h.top=d+l;delete h.height;break;case SC.RESIZE_TOP_LEFT:delete h.top;h.height=m;break}}c.set("layout",h);this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")},renderLayout:function(b,a){if(a||this._recalculateDivider){var g=this.get("layoutDirection"),c=this.get("frame"),f=this.$(),j=this.get("defaultThickness"),d=this.get("autoresizeBehavior"),i=this.get("dividerThickness"),h;if(!this.get("thumbViewCursor")){this.set("thumbViewCursor",SC.Cursor.create())}i=!SC.none(i)?i:7;if(this._recalculateDivider===undefined&&j<1){this._recalculateDivider=YES}else{if(this._recalculateDivider){this._recalculateDivider=NO}}if(f[0]){h=(g===SC.LAYOUT_HORIZONTAL)?f[0].offsetWidth:f[0].offsetHeight}else{h=(g===SC.LAYOUT_HORIZONTAL)?c.width:c.height}if(SC.none(j)||(j>0&&j<1)){j=Math.floor((h-(i))*(j||0.5))}if(d===SC.RESIZE_BOTTOM_RIGHT){this._desiredTopLeftThickness=j}else{this._desiredTopLeftThickness=h-i-j}this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");this._updateTopLeftThickness(0);this._setCursorStyle();this.updateChildLayout()}arguments.callee.base.apply(this,arguments)},render:function(a,b){arguments.callee.base.apply(this,arguments);if(this._inLiveResize){this._setCursorStyle()}if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){a.addClass("sc-horizontal")}else{a.addClass("sc-vertical")}},mouseDownInThumbView:function(a,c){var b=this.getPath("pane.rootResponder");if(!b){return NO}b.dragDidStart(this);this._mouseDownX=a.pageX;this._mouseDownY=a.pageY;this._thumbView=c;this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");this.beginLiveResize();this._inLiveResize=YES;return YES},mouseDragged:function(a){var b=(this._layoutDirection===SC.LAYOUT_HORIZONTAL)?a.pageX-this._mouseDownX:a.pageY-this._mouseDownY;this._updateTopLeftThickness(b);return YES},mouseUp:function(a){if(this._inLiveResize===YES){this._thumbView=null;this._inLiveResize=NO;this.endLiveResize();return YES}this._setCursorStyle();return NO},touchesDragged:function(a){return this.mouseDragged(a)},touchEnd:function(a){return this.mouseUp(a)},doubleClickInThumbView:function(b,d){var a=this._topLeftView,c=a.get("isCollapsed")||NO;if(!c&&!this.canCollapseView(a)){a=this._bottomRightView;c=a.get("isCollapsed")||NO;if(!c&&!this.canCollapseView(a)){return NO}}if(!c){this._uncollapsedThickness=this.thicknessForView(a);if(a===this._topLeftView){this._updateTopLeftThickness(this.topLeftThickness()*-1)}else{this._updateBottomRightThickness(this.bottomRightThickness()*-1)}if(!a.get("isCollapsed")){this._uncollapsedThickness=null}}else{if(a===this._topLeftView){this._updateTopLeftThickness(this._uncollapsedThickness)}else{this._updateBottomRightThickness(this._uncollapsedThickness)}a._uncollapsedThickness=null}this._setCursorStyle();return true},_updateTopLeftThickness:function(f){var a=this._topLeftView,c=this._bottomRightView,g=this.thicknessForView(a),h=this.thicknessForView(c),k=this._dividerThickness,j=0,b=this._topLeftViewThickness+f,n=this._layoutDirection,p=this.canCollapseView(c),m=b,l=this.get("topLeftMaxThickness"),d=this.get("topLeftMinThickness"),o,i,q;if(!a.get("isCollapsed")){j+=g}if(!c.get("isCollapsed")){j+=h}if(!SC.none(l)){m=Math.min(l,m)}if(!SC.none(d)){m=Math.max(d,m)}l=this.get("bottomRightMaxThickness");d=this.get("bottomRightMinThickness");o=j-m;if(!SC.none(l)){o=Math.min(l,o)}if(!SC.none(d)){o=Math.max(d,o)}m=j-o;m=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,a,m);m=Math.min(m,j);m=Math.max(0,m);i=a.get("collapseAtThickness");if(!i){i=0}q=c.get("collapseAtThickness");q=SC.none(q)?j:(j-q);if((b<=i)&&this.canCollapseView(a)){l=c.get("maxThickness");if(!l||(k+j)<=l){m=0}}else{if(b>=q&&this.canCollapseView(c)){l=a.get("maxThickness");if(!l||(k+j)<=l){m=j}}}if(m!=this.thicknessForView(a)){this._desiredTopLeftThickness=m;a.set("isCollapsed",m===0);c.set("isCollapsed",m>=j);this.updateChildLayout();this.displayDidChange()}},_updateBottomRightThickness:function(f){var a=this._topLeftView,c=this._bottomRightView,g=this.thicknessForView(a),h=this.thicknessForView(c),k=this._dividerThickness,j=0,b=this._topLeftViewThickness+f,n=this._layoutDirection,p=this.canCollapseView(c),m=b,l=this.get("topLeftMaxThickness"),d=this.get("topLeftMinThickness"),o,i,q;if(!a.get("isCollapsed")){j+=g}if(!c.get("isCollapsed")){j+=h}if(!SC.none(l)){m=Math.min(l,m)}if(!SC.none(d)){m=Math.max(d,m)}l=this.get("bottomRightMaxThickness");d=this.get("bottomRightMinThickness");o=j-m;if(!SC.none(l)){o=Math.min(l,o)}if(!SC.none(d)){o=Math.max(d,o)}m=j-o;m=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,a,m);m=Math.min(m,j);m=Math.max(0,m);i=a.get("collapseAtThickness");if(!i){i=0}q=c.get("collapseAtThickness");q=SC.none(q)?j:(j-q);if((b<=i)&&this.canCollapseView(a)){l=c.get("maxThickness");if(!l||(k+j)<=l){m=0}}else{if(b>=q&&this.canCollapseView(c)){l=a.get("maxThickness");if(!l||(k+j)<=l){m=j}}}if(m!=this.thicknessForView(a)){this._desiredTopLeftThickness=m;a.set("isCollapsed",m===0);c.set("isCollapsed",m>=j);this.updateChildLayout();this.displayDidChange()}},_setCursorStyle:function(){var f=this._topLeftView,g=this._bottomRightView,b=this.get("thumbViewCursor"),c=this.thicknessForView(f),d=this.thicknessForView(g),a=this.get("dividerView");this._layoutDirection=this.get("layoutDirection");if(f.get("isCollapsed")||c===this.get("topLeftMinThickness")||d==this.get("bottomRightMaxThickness")){b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"s-resize")}else{if(g.get("isCollapsed")||c===this.get("topLeftMaxThickness")||d==this.get("bottomRightMinThickness")){b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"w-resize":"n-resize")}else{if(SC.browser.isIE){b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"n-resize")}else{b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"ew-resize":"ns-resize")}}}a.set("cursor",b);if(this._inLiveResize){this.set("cursor",b)}}.observes("layoutDirection"),splitViewCanCollapse:function(b,a){if(b.get("canCollapseViews")===NO){return NO}if(a.get("canCollapse")===NO){return NO}return YES},splitViewConstrainThickness:function(c,a,b){return b},_forceSplitCalculation:function(){this.updateLayout()}.observes("*pane.isPaneAttached"),viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")}.observes("layout")});SC.mixin(SC.View.prototype,{splitView:function(){var a=this;while(a&&!a.isSplitView){a=a.get("parentView")}return a}.property("parentView").cacheable()});sc_require("views/collection");SC.StackedView=SC.CollectionView.extend({classNames:["sc-stacked-view"],layout:{top:0,left:0,right:0,height:1},computeNowShowing:function(a){return this.get("allContentIndexes")},updateHeight:function(a){if(a){this._updateHeight()}else{this.invokeLast(this._updateHeight)}return this},_updateHeight:function(){var f=this.get("childViews"),b=f.get("length"),c,d,a;if(b===0){a=1}else{c=f.objectAt(b-1);d=c?c.get("layer"):null;a=d?(d.offsetTop+d.offsetHeight):1;d=null}this.adjust("height",a)},didReload:function(a){return this.updateHeight()},didCreateLayer:function(){return this.updateHeight()}});SC.StaticContentView=SC.View.extend(SC.StaticLayout,{classNames:["sc-static-content-view"],displayProperties:["content"],content:null,contentLayoutDidChange:function(){this._viewFrameDidChange()},useStaticLayout:YES,frame:function(){var a=this.get("layer"),b;if(!a){return{x:0,y:0,width:0,height:0}}if(a.getBoundingClientRect&&!SC.browser.isIE8OrLower){b=a.getBoundingClientRect();return{x:0,y:0,width:b.width,height:b.height}}else{return{x:0,y:0,width:a.clientWidth,height:a.clientHeight}}}.property("content").cacheable(),parentViewDidResize:function(){this.contentLayoutDidChange()},didUpdateLayer:function(){this.contentLayoutDidChange()},render:function(a,c){var b=this.get("content");a.push(b||"")},touchStart:function(a){a.allowDefault();return YES},touchEnd:function(a){a.allowDefault();return YES}});sc_require("views/segmented");SC.TOP_LOCATION="top";SC.TOP_TOOLBAR_LOCATION="top-toolbar";SC.BOTTOM_LOCATION="bottom";SC.TabView=SC.View.extend({classNames:["sc-tab-view"],displayProperties:["nowShowing"],nowShowing:null,items:[],isEnabled:YES,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemToolTipKey:null,tabHeight:SC.REGULAR_BUTTON_HEIGHT,tabLocation:SC.TOP_LOCATION,userDefaultKey:null,_tab_nowShowingDidChange:function(){var a=this.get("nowShowing");this.get("containerView").set("nowShowing",a);this.get("segmentedView").set("value",a);return this}.observes("nowShowing"),_tab_saveUserDefault:function(){var a=this.get("nowShowing");var b=this.get("userDefaultKey");if(b){SC.userDefaults.set([b,"nowShowing"].join(":"),a)}}.observes("nowShowing"),_tab_itemsDidChange:function(){this.get("segmentedView").set("items",this.get("items"));return this}.observes("items"),init:function(){arguments.callee.base.apply(this,arguments);this._tab_nowShowingDidChange()._tab_itemsDidChange()},awake:function(){arguments.callee.base.apply(this,arguments);var a=this.get("userDefaultKey");if(a){a=[a,"nowShowing"].join(":");var b=SC.userDefaults.get(a);if(!SC.none(b)){this.set("nowShowing",b)}}},createChildViews:function(){var f=[],d,c,b=this.get("tabLocation"),a=this.get("tabHeight"),g=this.get("controlSize");if(b===SC.TOP_LOCATION){c={top:a/2+1,left:0,right:0,bottom:0,border:1}}else{if(b===SC.TOP_TOOLBAR_LOCATION){c={top:a+1,left:0,right:0,bottom:0,border:1}}else{c={top:0,left:0,right:0,bottom:(a/2)-1,border:1}}}d=this.containerView.extend({layout:c,ariaRole:"tabpanel"});this.containerView=this.createChildView(d);c=(b===SC.TOP_LOCATION||b===SC.TOP_TOOLBAR_LOCATION)?{height:a,left:0,right:0,top:0}:{height:a,left:0,right:0,bottom:0};this.segmentedView=this.get("segmentedView").extend({layout:c,controlSize:g,_sc_tab_segmented_valueDidChange:function(){var h=this.get("parentView");if(h){h.set("nowShowing",this.get("value"))}}.observes("value"),init:function(){var h=this.get("parentView");if(h){SC._TAB_ITEM_KEYS.forEach(function(i){this[i]=h.get(i)},this)}return arguments.callee.base.apply(this,arguments)}});this.segmentedView=this.createChildView(this.segmentedView);f.push(this.segmentedView);f.push(this.containerView);this.set("childViews",f);return this},containerView:SC.ContainerView.extend({renderDelegateName:"wellRenderDelegate"}),segmentedView:SC.SegmentedView});SC._TAB_ITEM_KEYS=["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemWidthKey","itemToolTipKey","itemActionKey","itemTargetKey"];SC.ThumbView=SC.View.extend({classNames:["sc-thumb-view"],isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),prepareContext:function(a,c){var b=this.get("splitView");if(b){this.set("cursor",b.get("thumbViewCursor"))}return arguments.callee.base.apply(this,arguments)},mouseDown:function(a){if(!this.get("isEnabled")){return NO}var b=this.get("splitView");return(b)?b.mouseDownInThumbView(a,this):arguments.callee.base.apply(this,arguments)},touchStart:function(a){return this.mouseDown(a)}});SC.WebView=SC.View.extend(SC.Control,{classNames:"sc-web-view",displayProperties:["value","shouldAutoResize"],shouldAutoResize:NO,render:function(a,d){var c=this.get("value")||"",b;if(d){a.push('<iframe src="'+c+'" style="position: absolute; width: 100%; height: 100%; border: 0px; margin: 0px; padding: 0px;"></iframe>')}else{if(c!==this._lastSrc){b=this.$("iframe");b.attr("src","javascript:;");b.attr("src",c)}}this._lastSrc=c},didCreateLayer:function(){var a=this.$("iframe");SC.Event.add(a,"load",this,this.iframeDidLoad)},willDestroyLayer:function(){var a=this.$("iframe");SC.Event.remove(a,"load",this,this.iframeDidLoad)},iframeDidLoad:function(){if(this.get("shouldAutoResize")===YES){var a;var c=this.$("iframe")[0];if(c&&c.contentWindow){a=c.contentWindow;if(a&&a.document&&a.document.documentElement){var b=a.document.documentElement;if(!SC.browser.isIE){this.$().width(b.scrollWidth);this.$().height(b.scrollHeight)}else{this.$().width(b.scrollWidth+12);this.$().height(b.scrollHeight+5)}}}}}});SC.WELL_CONTAINER_PADDING=15;SC.WellView=SC.ContainerView.extend({classNames:"sc-well-view",contentLayout:{top:SC.WELL_CONTAINER_PADDING,bottom:SC.WELL_CONTAINER_PADDING,left:SC.WELL_CONTAINER_PADDING,right:SC.WELL_CONTAINER_PADDING},renderDelegateName:"wellRenderDelegate",createChildViews:function(){var a=this.get("contentView");if(a){a=this.contentView=this.createChildView(a);a.set("layout",this.contentLayout);this.childViews=[a]}},contentViewDidChange:function(){var a=this.get("contentView");a.set("layout",this.contentLayout);this.replaceContent(a)}.observes("contentView")});SC.MIXED_STATE="__MIXED__";SC.DataSource=SC.Object.extend({fetch:function(a,b){return NO},retrieveRecords:function(a,c,b){return this._handleEach(a,c,this.retrieveRecord,b)},commitRecords:function(c,b,h,g,i){var f,a,d;if(b.length>0){d=this.createRecords.call(this,c,b,i)}if(h.length>0){f=this.updateRecords.call(this,c,h,i);d=SC.none(d)?f:(d===f)?d:SC.MIXED_STATE}if(g.length>0){a=this.destroyRecords.call(this,c,g,i);d=SC.none(d)?a:(d===a)?d:SC.MIXED_STATE}return d||NO},cancel:function(a,b){return NO},updateRecords:function(a,b,c){return this._handleEach(a,b,this.updateRecord,null,c)},createRecords:function(a,b,c){return this._handleEach(a,b,this.createRecord,null,c)},destroyRecords:function(a,b,c){return this._handleEach(a,b,this.destroyRecord,null,c)},_handleEach:function(i,f,c,a,b){var g=f.length,j,h,k,d;for(j=0;j<g;j++){d=a?a[j]:b;k=c.call(this,i,f[j],d);if(h===undefined){h=k}else{if(h===YES){h=(k===YES)?YES:SC.MIXED_STATE}else{if(h===NO){h=(k===NO)?NO:SC.MIXED_STATE}}}}return !SC.none(h)?h:null},updateRecord:function(a,b,c){return NO},retrieveRecord:function(a,b,c){return NO},createRecord:function(a,b,c){return NO},destroyRecord:function(a,b,c){return NO}});sc_require("data_sources/data_source");SC.CascadeDataSource=SC.DataSource.extend({dataSources:null,from:function(a){var b=this.get("dataSources");if(!b){this.set("dataSources",b=[])}b.push(a);return this},fetch:function(c,h){var f=this.get("dataSources"),b=f?f.length:0,d=NO,i,g,a;for(a=0;(d!==YES)&&a<b;a++){g=f.objectAt(a);i=g.fetch?g.fetch.apply(g,arguments):NO;d=this._handleResponse(d,i)}return d},retrieveRecords:function(i,d,b){var c=this.get("dataSources"),f=c?c.length:0,g=NO,j,a,h;for(h=0;(g!==YES)&&h<f;h++){a=c.objectAt(h);j=a.retrieveRecords.apply(a,arguments);g=this._handleResponse(g,j)}return g},commitRecords:function(k,c,i,f,d){var b=this.get("dataSources"),g=b?b.length:0,h=NO,l,a,j;for(j=0;(h!==YES)&&j<g;j++){a=b.objectAt(j);l=a.commitRecords.apply(a,arguments);h=this._handleResponse(h,l)}return h},cancel:function(c,g){var f=this.get("dataSources"),b=f?f.length:0,d=NO,i,h,a;for(a=0;(d!==YES)&&a<b;a++){h=f.objectAt(a);i=h.cancel.apply(h,arguments);d=this._handleResponse(d,i)}return d},init:function(){arguments.callee.base.apply(this,arguments);var b=this.get("dataSources"),a=b?b.get("length"):0,c;while(--a>=0){c=b[a];if(SC.typeOf(c)===SC.T_STRING){b[a]=this.get(c)}}},_handleResponse:function(b,a){if(a===YES){return YES}else{if(b===NO){return(a===NO)?NO:SC.MIXED_STATE}else{return SC.MIXED_STATE}}}});sc_require("core");sc_require("models/record");SC.Query=SC.Object.extend(SC.Copyable,SC.Freezable,{isQuery:YES,conditions:null,orderBy:null,recordType:null,recordTypes:null,expandedRecordTypes:function(){var b=SC.CoreSet.create(),a,c;if(a=this.get("recordType")){this._scq_expandRecordType(a,b)}else{if(a=this.get("recordTypes")){a.forEach(function(d){this._scq_expandRecordType(d,b)},this)}else{this._scq_expandRecordType(SC.Record,b)}}c=SC.Query._scq_queriesWithExpandedRecordTypes;if(!c){c=SC.Query._scq_queriesWithExpandedRecordTypes=SC.CoreSet.create()}c.add(this);return b.freeze()}.property("recordType","recordTypes").cacheable(),_scq_expandRecordType:function(b,a){if(a.contains(b)){return}a.add(b);if(SC.typeOf(b)===SC.T_STRING){b=SC.objectForPropertyPath(b)}b.subclasses.forEach(function(c){this._scq_expandRecordType(c,a)},this)},parameters:null,location:"local",scope:null,isRemote:function(){return this.get("location")===SC.Query.REMOTE}.property("location").cacheable(),isLocal:function(){return this.get("location")===SC.Query.LOCAL}.property("location").cacheable(),isEditable:NO,contains:function(a,d){var f,b=YES;if(f=this.get("recordTypes")){b=f.find(function(g){return SC.kindOf(a,g)})}else{if(f=this.get("recordType")){b=SC.kindOf(a,f)}}if(!b){return NO}var c=this.get("scope");if(c&&!c.contains(a)){return NO}if(!this._isReady){this.parse()}if(!this._isReady){return NO}if(d===undefined){d=this.parameters||this}return this._tokenTree.evaluate(a,d)},containsRecordTypes:function(a){var b=this.get("recordType");if(b){return !!a.find(function(c){return SC.kindOf(c,b)})}else{if(b=this.get("recordTypes")){return !!b.find(function(c){return !!a.find(function(d){return SC.kindOf(d,c)})})}else{return YES}}},compare:function(b,a){var k=0,f,c,g,d,h;if(b===a){return 0}function j(n,m){var l=n.get("storeKey"),i=m.get("storeKey");if(l<i){return -1}if(l>i){return 1}return 0}if(!this._isReady){this.parse()}if(!this._isReady){return j(b,a)}c=this._order;if((typeof c==="function")&&!c.isClass){k=c.call(null,b,a)}else{g=c?c.length:0;for(d=0;k===0&&(d<g);d++){f=c[d].propertyName;h=/\./.test(f)?"getPath":"get";if(SC.Query.comparisons[f]){k=SC.Query.comparisons[f](b[h](f),a[h](f))}else{k=SC.compare(b[h](f),a[h](f))}if((k!==0)&&c[d].descending){k=(-1)*k}}}if(k!==0){return k}return j(b,a)},_isReady:NO,parse:function(){var c=this.get("conditions"),d=this.get("queryLanguage"),b,a;b=this._tokenList=this.tokenizeString(c,d);a=this._tokenTree=this.buildTokenTree(b,d);this._order=this.buildOrder(this.get("orderBy"));this._isReady=!!a&&!a.error;if(a&&a.error){throw a.error}return this._isReady},queryWithScope:function(c){var b=SC.keyFor("__query__",SC.guidFor(this)),a=c[b];if(!a){c[b]=a=this.copy();a.set("scope",c);a.freeze()}return a},copyKeys:["conditions","orderBy","recordType","recordTypes","parameters","location","scope"],concatenatedProperties:["copyKeys"],copy:function(){var d={},c=this.get("copyKeys"),g=c?c.length:0,b,f,a;while(--g>=0){b=c[g];f=this.get(b);if(f!==undefined){d[b]=f}}a=this.constructor.create(d);d=null;return a},queryLanguage:{UNKNOWN:{firstCharacter:/[^\s'"\w\d\(\)\{\}]/,notAllowed:/[\-\s'"\w\d\(\)\{\}]/},PROPERTY:{firstCharacter:/[a-zA-Z_]/,notAllowed:/[^a-zA-Z_0-9\.]/,evalType:"PRIMITIVE",evaluate:function(f,b){var g=this.tokenValue.split(".");var a=g.length;if(a<2){return f.get(this.tokenValue)}var c=f;for(var d=0;d<a;d++){if(!c){return}if(c.get){c=c.get(g[d])}else{c=c[g[d]]}}return c}},NUMBER:{firstCharacter:/[\d\-]/,notAllowed:/[^\d\-\.]/,format:/^-?\d+$|^-?\d+\.\d+$/,evalType:"PRIMITIVE",evaluate:function(b,a){return parseFloat(this.tokenValue)}},STRING:{firstCharacter:/['"]/,delimited:true,evalType:"PRIMITIVE",evaluate:function(b,a){return this.tokenValue}},PARAMETER:{firstCharacter:/\{/,lastCharacter:"}",delimited:true,evalType:"PRIMITIVE",evaluate:function(b,a){return a[this.tokenValue]}},"%@":{rememberCount:true,reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return a[this.tokenValue]}},OPEN_PAREN:{firstCharacter:/\(/,singleCharacter:true},CLOSE_PAREN:{firstCharacter:/\)/,singleCharacter:true},AND:{reservedWord:true,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return d&&b}},OR:{reservedWord:true,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return d||b}},NOT:{reservedWord:true,rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(c,a){var b=this.rightSide.evaluate(c,a);return !b}},"=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.isEqual(d,b)}},"!=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return !SC.isEqual(d,b)}},"<":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)==-1}},"<=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)!=1}},">":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)==1}},">=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)!=-1}},BEGINS_WITH:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var b=this.leftSide.evaluate(c,a);var d=this.rightSide.evaluate(c,a);return(b&&b.indexOf(d)===0)}},ENDS_WITH:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(d,b){var c=this.leftSide.evaluate(d,b);var a=this.rightSide.evaluate(d,b);return(c&&c.length>=a.length&&c.lastIndexOf(a)===(c.length-a.length))}},CONTAINS:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(f,a){var d=this.leftSide.evaluate(f,a)||[];var h=this.rightSide.evaluate(f,a);var c=SC.typeOf(d);if(c===SC.T_STRING){return(d.indexOf(h)!==-1)}else{if(c===SC.T_ARRAY||d.toArray){if(c!==SC.T_ARRAY){d=d.toArray()}var g=false;var b=0;while(g===false&&b<d.length){if(h==d[b]){g=true}b++}return g}}}},ANY:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(d,a){var g=this.leftSide.evaluate(d,a);var b=this.rightSide.evaluate(d,a);var f=false;var c=0;while(f===false&&c<b.length){if(g==b[c]){f=true}c++}return f}},MATCHES:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return b.test(d)}},TYPE_IS:{reservedWord:true,rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(d,a){var c=SC.Store.recordTypeFor(d.storeKey);var b=this.rightSide.evaluate(d,a);var f=SC.objectForPropertyPath(b);return c==f}},"null":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return null}},"undefined":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return undefined}},"false":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return false}},"true":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return true}},YES:{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return true}},NO:{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return false}}},tokenizeString:function(v,q){var k=[],s=null,h=null,g=null,u=null,a=null,j=null,d=null,w=null,r=false,b=false,m=false,n=false,o={};function f(t,c){h=q[t];if(h.format&&!h.format.test(c)){t="UNKNOWN"}if(h.delimited){n=true}if(!h.delimited){for(var i in q){if(q[i].reservedWord&&i==c){t=i}}}h=q[t];if(h&&h.rememberCount){if(!o[t]){o[t]=0}c=o[t];o[t]+=1}k.push({tokenType:t,tokenValue:c});a=null;j=null;d=null}if(!v){return[]}var l=v.length;for(var p=0;p<l;p++){r=(p===l-1);s=v.charAt(p);n=false;if(a){h=q[a];b=h.delimited?s===w:h.notAllowed.test(s);if(!b){d+=s}if(b||r){f(a,d)}if(r&&!b){n=true}}if(!a&&!n){for(g in q){h=q[g];if(h.firstCharacter&&h.firstCharacter.test(s)){a=g}}if(a){h=q[a];d=s;if(h.delimited){d="";if(h.lastCharacter){w=h.lastCharacter}else{w=s}}if(h.singleCharacter||r){f(a,d)}}}}return k},buildTokenTree:function(m,a){var p=m.slice();var r=0;var t=[];var c=false;var q=[];if(!m||m.length===0){return{evaluate:function(){return true}}}function s(i){var w=i;if(w<0){return false}var l=a[p[w].tokenType];if(!l){q.push("logic for token '"+p[w].tokenType+"' is not defined");return false}p[w].evaluate=l.evaluate;return l}function b(w,i){var x=i;var l=s(x);if(!l){return false}if(w=="left"){return l.leftType}if(w=="right"){return l.rightType}}function o(i){var w=i;var l=s(w);if(!l){return false}else{return l.evalType}}function g(i){p.splice(i,1);if(i<=r){r--}}function u(i){var l=i||r;if(l>0){return true}else{return false}}function k(i){var l=i;if(l<0){return true}return(b("left",l)&&!p[l].leftSide)||(b("right",l)&&!p[l].rightSide)}function j(l,w){var i=(w<l)?"left":"right";if(l<0||w<0){return false}if(!b(i,l)){return false}if(!o(w)){return false}if(b(i,l)==o(w)){return true}else{return false}}function n(i){var l=i;if(!k(l)){return false}if(!u(l)){return false}if(j(l,l-1)){return true}else{return false}}function d(i){var l=i;if(k(l)){return false}if(!u(l)){return false}if(!k(l-1)){return false}if(j(l-1,l)){return true}else{return false}}function h(i){var l=i;if(l<1){return false}p[l].leftSide=p[l-1];g(l-1)}function v(i){var l=i;if(l<1){return false}p[l-1].rightSide=p[l];g(l)}function f(i){g(i);g(t.pop())}for(r=0;r<p.length;r++){c=false;if(p[r].tokenType=="UNKNOWN"){q.push("found unknown token: "+p[r].tokenValue)}if(p[r].tokenType=="OPEN_PAREN"){t.push(r)}if(p[r].tokenType=="CLOSE_PAREN"){f(r)}if(n(r)){h(r)}if(d(r)){v(r);c=true}if(c){r--}}if(p.length==1){p=p[0]}else{q.push("string did not resolve to a single tree")}if(q.length>0){return{error:q.join(",\n"),tree:p}}else{return p}},buildOrder:function(a){if(!a){return[]}else{if(SC.typeOf(a)===SC.T_FUNCTION){return a}else{var d=a.split(",");for(var b=0;b<d.length;b++){var c=d[b];c=c.replace(/^\s+|\s+$/,"");c=c.replace(/\s+/,",");c=c.split(",");d[b]={propertyName:c[0]};if(c[1]&&c[1]=="DESC"){d[b].descending=true}}return d}}}});SC.Query.mixin({LOCAL:"local",REMOTE:"remote",storeKeyFor:function(a){return a?a.get("storeKey"):null},containsRecords:function(h,f,d){var g=[];for(var b=0,a=f.get("length");b<a;b++){var c=f.objectAt(b);if(c&&h.contains(c)){g.push(c.get("storeKey"))}}g=SC.Query.orderStoreKeys(g,h,d);return g},orderStoreKeys:function(c,d,a){if(c){var b=c.sort(function(g,f){return SC.Query.compareStoreKeys(d,a,g,f)})}return c},compareStoreKeys:function(g,c,f,d){var b=c.materializeRecord(f),a=c.materializeRecord(d);return g.compare(b,a)},build:function(i,c,h,d){var a=null,g,b,j,f;if(c&&c.isQuery){if(c.get("location")===i){return c}else{return c.copy().set("location",i).freeze()}}if(typeof c===SC.T_STRING){g=SC.objectForPropertyPath(c);if(!g){throw"%@ did not resolve to a class".fmt(c)}c=g}else{if(c&&c.isEnumerable){g=[];c.forEach(function(k){if(typeof k===SC.T_STRING){k=SC.objectForPropertyPath(k)}if(!k){throw"cannot resolve record types: %@".fmt(c)}g.push(k)},this);c=g}else{if(!c){c=SC.Record}}}if(d===undefined){d=null}if(h===undefined){h=null}if(!d&&(typeof h!==SC.T_STRING)){a=h;h=null}if(!d&&!a){f=SC.Query._scq_recordTypeCache;if(!f){f=SC.Query._scq_recordTypeCache={}}b=f[i];if(!b){b=f[i]={}}if(c.isEnumerable){j=c.map(function(l){return SC.guidFor(l)});j=j.sort().join(":")}else{j=SC.guidFor(c)}if(h){j=[j,h].join("::")}g=b[j];if(!g){if(c.isEnumerable){a={recordTypes:c.copy()}}else{a={recordType:c}}a.location=i;a.conditions=h;g=b[j]=SC.Query.create(a).freeze()}}else{if(!a){a={}}if(!a.location){a.location=i}if(c&&c.isEnumerable){a.recordTypes=c}else{a.recordType=c}if(h){a.conditions=h}if(d){a.parameters=d}g=SC.Query.create(a).freeze()}return g},local:function(c,a,b){return this.build(SC.Query.LOCAL,c,a,b)},remote:function(c,a,b){return this.build(SC.Query.REMOTE,c,a,b)},_scq_didDefineRecordType:function(){var a=SC.Query._scq_queriesWithExpandedRecordTypes;if(a){a.forEach(function(b){b.notifyPropertyChange("expandedRecordTypes")},this);a.clear()}}});SC.Query.comparisons={};SC.Query.registerComparison=function(a,b){SC.Query.comparisons[a]=b};SC.Query.registerQueryExtension=function(b,a){SC.Query.prototype.queryLanguage[b]=a};SC.Q=SC.Query.from;sc_require("system/query");SC.Record=SC.Object.extend({isRecord:YES,isParentRecord:NO,primaryKey:"guid",id:function(a,b){if(b!==undefined){this.writeAttribute(this.get("primaryKey"),b);return b}else{return SC.Store.idFor(this.storeKey)}}.property("storeKey").cacheable(),status:function(){return this.store.readStatus(this.storeKey)}.property("storeKey").cacheable(),store:null,storeKey:null,isDestroyed:function(){return !!(this.get("status")&SC.Record.DESTROYED)}.property("status").cacheable(),isEditable:function(a,b){if(b!==undefined){this._screc_isEditable=b}if(this.get("status")&SC.Record.READY){return this._screc_isEditable}else{return NO}}.property("status").cacheable(),_screc_isEditable:YES,isLoaded:function(){var b=SC.Record,a=this.get("status");return !((a===b.EMPTY)||(a===b.BUSY_LOADING)||(a===b.ERROR))}.property("status").cacheable(),relationships:null,attributes:function(){var a=this.get("store"),b=this.storeKey;return a.readEditableDataHash(b)}.property(),readOnlyAttributes:function(){var a=this.get("store"),c=this.storeKey,b=a.readDataHash(c);if(b){b=SC.clone(b,YES)}return b}.property(),nestedRecordNamespace:null,isNestedRecord:function(){var c=this.get("store"),d,b=this.get("storeKey"),a=c.parentStoreKeyExists(b);d=a?YES:NO;return d}.property().cacheable(),parentRecord:function(){var a=this.storeKey,b=this.get("store");return b.materializeParentRecord(a)}.property(),refresh:function(f,h){var c=this.get("store"),g,d,b=this.get("storeKey"),a=c.parentStoreKeyExists();d=f||(SC.none(f)&&SC.none(a));if(d){c.refreshRecord(null,null,b,h)}else{if(a){g=c.materializeRecord(a);g.refresh(f,h)}}return this},destroy:function(f){var c=this.get("store"),g,d,b=this.get("storeKey"),a=c.parentStoreKeyExists();d=f||(SC.none(f)&&SC.none(a));if(d){c.destroyRecord(null,null,b);this.notifyPropertyChange("status");this.propagateToAggregates()}else{if(a){g=c.materializeRecord(a);g.destroy(f)}}return this},recordDidChange:function(a){var b=this.get("parentRecord");if(b){b.recordDidChange()}this.get("store").recordDidChange(null,null,this.get("storeKey"),a);this.notifyPropertyChange("status");this.propagateToAggregates();return this},toJSON:function(){return this.get("attributes")},_editLevel:0,beginEditing:function(){this._editLevel++;return this},endEditing:function(a){if(--this._editLevel<=0){this._editLevel=0;this.recordDidChange(a)}return this},readAttribute:function(c){var a=this.get("store"),d=this.storeKey;var b=a.readDataHash(d);return b?b[c]:undefined},writeAttribute:function(c,g,f){var a=this.get("store"),d=this.storeKey,b;b=a.readEditableDataHash(d);if(!b){throw SC.Record.BAD_STATE_ERROR}if(g!==b[c]){if(!f){this.beginEditing()}b[c]=g;if(c===this.get("primaryKey")){SC.Store.replaceIdFor(d,g);this.propertyDidChange("id")}if(!f){this.endEditing(c)}else{a.dataHashDidChange(d,null,undefined,c)}}return this},propagateToAggregates:function(){var n=this.get("storeKey"),d=SC.Store.recordTypeFor(n),g=d.__sc_aggregate_keys,l,h,m,b,c,k;if(!g){g=[];for(m in this){b=this[m];if(b&&b.isRecordAttribute&&b.aggregate===YES){g.push(m)}}d.__sc_aggregate_keys=g}var j=SC.Record,a=j.DIRTY,f=j.READY_NEW,o=j.DESTROYED,p=j.READY_CLEAN,i;i=function(u){var q,r,s,t;if(u){q=this.get("status");if((q&a)||(q&f)||(q&o)){r=u.get("store");s=u.get("storeKey");t=r.peekStatus(s);if(t===p){u.get("store").recordDidChange(u.constructor,null,u.get("storeKey"),null,YES)}}}};for(l=0,h=g.length;l<h;++l){m=g[l];c=this.get(m);k=SC.kindOf(c,SC.ManyArray)?c:[c];k.forEach(i,this)}},storeDidChangeProperties:function(a,b){if(a){this.notifyPropertyChange("status")}else{if(b){this.beginPropertyChanges();b.forEach(function(f){this.notifyPropertyChange(f)},this);this.notifyPropertyChange("status");this.endPropertyChanges()}else{this.allPropertiesDidChange()}var d=this.relationships,c=d?d.length:0;while(--c>=0){d[c].recordPropertyDidChange(b)}}},normalize:function(a){var c=this.primaryKey,b=this.get("id"),g=this.get("store"),f=this.get("storeKey"),j={},s,p,d,r,k,q,m,h,o,i,n;var l=g.readEditableDataHash(f)||{};l[c]=b;r=g.readDataHash(f);for(s in this){p=this[s];if(p){d=p.typeClass;if(d){i=p.get("key")||s;j[i]=YES;m=SC.typeOf(d.call(p))===SC.T_CLASS;h=p.isNestedRecordTransform;if(!m&&!h){k=this.get(s);if(k!==undefined&&(k!==null||a)){n=this[s];if(SC.instanceOf(n,SC.RecordAttribute)){k=n.fromType(this,s,k)}l[i]=k}else{if(!a){j[i]=NO}}}else{if(h){k=this.get(s);if(k&&k.normalize){k.normalize()}}else{if(m){k=r[i];if(k!==undefined){l[i]=k}else{o=p.get("defaultValue");if(SC.typeOf(o)===SC.T_FUNCTION){l[i]=o(this,s,o)}else{l[i]=o}}}}}}}}for(s in l){if(!j[s]){SC.debug("%@:  Deleting key from underlying data hash due to normalization:  %@",this,s);delete l[s]}}return this},unknownProperty:function(b,d){if(d!==undefined){var c=this.get("storeKey"),f=SC.Store.recordTypeFor(c);if(f.ignoreUnknownProperties===YES){this[b]=d;return d}var a=this.get("primaryKey");this.writeAttribute(b,d);if(b===a){SC.Store.replaceIdFor(c,d)}}return this.readAttribute(b)},commitRecord:function(h,f,i){var c=this.get("store"),g,d,b=this.get("storeKey"),a=c.parentStoreKeyExists();d=f||(SC.none(f)&&SC.none(a));if(d){c.commitRecord(undefined,undefined,this.get("storeKey"),h,i)}else{if(a){g=c.materializeRecord(a);g.commitRecord(h,f,i)}}return this},isError:function(){return !!(this.get("status")&SC.Record.ERROR)}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var a=this.get("store");return a.readError(this.get("storeKey"))||SC.Record.GENERIC_ERROR}else{return null}}.property("isError").cacheable(),set:function(a,c){var b=this[a];if(b&&b.isProperty&&b.get&&!b.get("isEditable")){return this}return arguments.callee.base.apply(this,arguments)},toString:function(){var a=this.get("store").readDataHash(this.get("storeKey"));return"%@(%@) %@".fmt(this.constructor.toString(),SC.inspect(a),this.statusString())},statusString:function(){var b=[],a=this.get("status");for(var c in SC.Record){if(c.match(/[A-Z_]$/)&&SC.Record[c]===a){b.push(c)}}return b.join(" ")},registerNestedRecord:function(g,f,h){var c,d=this.get("storeKey"),b,a,i;if(SC.none(h)){h=f}if(g&&g.get&&g.get("isRecord")){a=g}else{i=this._materializeNestedRecordType(g,f);a=this.createNestedRecord(i,g,d,h)}if(a){this.isParentRecord=YES;c=this.get("store");b=a.get("storeKey");c.registerChildToParent(d,b,h)}return a},unregisterNestedRecord:function(d){var b,a,c;c=this.get("store");b=this.getPath(d);a=b.get("storeKey");c.unregisterChildFromParent(a)},_materializeNestedRecordType:function(d,c){var a,f,b;if(SC.typeOf(d)===SC.T_HASH){a=this.get("nestedRecordNamespace");if(d.type&&!SC.none(a)){f=a[d.type]}}if(!f&&c&&this[c]){f=this[c].get("typeClass")}if(!f||!SC.kindOf(f,SC.Record)){throw"SC.Child: Error during transform: Invalid record type."}return f},createNestedRecord:function(b,f,h,j){var i=this.get("store"),a,c,d,g=null;f=f||{};if(SC.none(i)){throw"Error: during the creation of a child record: NO STORE ON PARENT!"}a=f[b.prototype.primaryKey];if(!a){this.generateIdForChild(g)}if(!a){a=h+"."+j}c=i.storeKeyExists(b,a);if(c){i.writeDataHash(c,f);g=i.materializeRecord(c)}else{g=i.createRecord(b,f,a)}return g},_nestedRecordKey:0,generateIdForChild:function(a){}});SC.Record.mixin({ignoreUnknownProperties:NO,CLEAN:1,DIRTY:2,EMPTY:256,ERROR:4096,READY:512,READY_CLEAN:513,READY_DIRTY:514,READY_NEW:515,DESTROYED:1024,DESTROYED_CLEAN:1025,DESTROYED_DIRTY:1026,BUSY:2048,BUSY_LOADING:2052,BUSY_CREATING:2056,BUSY_COMMITTING:2064,BUSY_REFRESH:2080,BUSY_REFRESH_CLEAN:2081,BUSY_REFRESH_DIRTY:2082,BUSY_DESTROYING:2112,BAD_STATE_ERROR:SC.$error("Internal Inconsistency"),RECORD_EXISTS_ERROR:SC.$error("Record Exists"),NOT_FOUND_ERROR:SC.$error("Not found "),BUSY_ERROR:SC.$error("Busy"),GENERIC_ERROR:SC.$error("Generic Error"),_nextChildKey:0,attr:function(a,b){return SC.RecordAttribute.attr(a,b)},fetch:function(b,a){return SC.FetchedAttribute.attr(b,a)},toMany:function(d,b){b=b||{};var c=b.nested||b.isNested;var a;this._throwUnlessRecordTypeDefined(d,"toMany");if(c){a=SC.ChildrenAttribute.attr(d,b)}else{a=SC.ManyAttribute.attr(d,b)}return a},toOne:function(d,b){b=b||{};var c=b.nested||b.isNested;var a;this._throwUnlessRecordTypeDefined(d,"toOne");if(c){a=SC.ChildAttribute.attr(d,b)}else{a=SC.SingleAttribute.attr(d,b)}return a},_throwUnlessRecordTypeDefined:function(b,a){if(!b){throw"Attempted to create "+a+" attribute with undefined recordType. Did you forget to sc_require a dependency?"}},storeKeysById:function(){var b=SC.keyFor("storeKey",SC.guidFor(this)),a=this[b];if(!a){a=this[b]={}}return a},storeKeyFor:function(c){var b=this.storeKeysById(),a=b[c];if(!a){a=SC.Store.generateStoreKey();SC.Store.idsByStoreKey[a]=c;SC.Store.recordTypesByStoreKey[a]=this;b[c]=a}return a},storeKeyExists:function(c){var b=this.storeKeysById(),a=b[c];return a},find:function(a,b){return a.find(this,b)},extend:function(){var a=SC.Object.extend.apply(this,arguments);if(SC.Query){SC.Query._scq_didDefineRecordType(a)}return a}});sc_require("data_sources/data_source");sc_require("models/record");SC.FixturesDataSource=SC.DataSource.extend({simulateRemoteResponse:NO,latency:50,cancel:function(a,b){return NO},fetch:function(a,b){if(b.get("location")!==SC.Query.LOCAL){throw SC.$error("SC.Fixture data source can only fetch local queries")}if(!b.get("recordType")&&!b.get("recordTypes")){throw SC.$error("SC.Fixture data source can only fetch queries with one or more record types")}if(this.get("simulateRemoteResponse")){this.invokeLater(this._fetch,this.get("latency"),a,b)}else{this._fetch(a,b)}},_fetch:function(a,c){var d=c.get("recordType"),b=c.get("recordTypes")||[d];b.forEach(function(f){if(SC.typeOf(f)===SC.T_STRING){f=SC.objectForPropertyPath(f)}if(f){this.loadFixturesFor(a,f)}},this);a.dataSourceDidFetchQuery(c)},retrieveRecords:function(a,c){var d=this.get("latency"),b=this.hasFixturesFor(c);if(!b){return b}if(this.get("simulateRemoteResponse")){this.invokeLater(this._retrieveRecords,d,a,c)}else{this._retrieveRecords(a,c)}return b},_retrieveRecords:function(a,b){b.forEach(function(d){var c=[],h=SC.Store.recordTypeFor(d),g=a.idFor(d),f=this.fixtureForStoreKey(a,d);c.push(d);a.dataSourceDidComplete(d,f,g)},this)},updateRecords:function(a,c,f){var d=this.get("latency"),b=this.hasFixturesFor(c);if(!b){return b}if(this.get("simulateRemoteResponse")){this.invokeLater(this._updateRecords,d,a,c)}else{this._updateRecords(a,c)}return b},_updateRecords:function(a,b){b.forEach(function(c){var d=a.readDataHash(c);this.setFixtureForStoreKey(a,c,d);a.dataSourceDidComplete(c)},this)},createRecords:function(a,b,d){var c=this.get("latency");if(this.get("simulateRemoteResponse")){this.invokeLater(this._createRecords,c,a,b)}else{this._createRecords(a,b)}return YES},_createRecords:function(a,b){b.forEach(function(f){var h=a.idFor(f),g=a.recordTypeFor(f),d=a.readDataHash(f),c=this.fixturesFor(g);if(!h){h=this.generateIdFor(g,d,a,f)}this._invalidateCachesFor(g,f,h);c[h]=d;a.dataSourceDidComplete(f,null,h)},this)},destroyRecords:function(a,c,f){var d=this.get("latency"),b=this.hasFixturesFor(c);if(!b){return b}if(this.get("simulateRemoteResponse")){this.invokeLater(this._destroyRecords,d,a,c)}else{this._destroyRecords(a,c)}return b},_destroyRecords:function(a,b){b.forEach(function(d){var g=a.idFor(d),f=a.recordTypeFor(d),c=this.fixturesFor(f);this._invalidateCachesFor(f,d,g);if(g){delete c[g]}a.dataSourceDidDestroy(d)},this)},loadFixturesFor:function(a,h,c){var b=[],f,d,g;f=this.fixturesFor(h);for(d in f){g=h.storeKeyFor(d);if(a.peekStatus(g)===SC.Record.EMPTY){b.push(f[d])}if(c){c.push(g)}}if(b&&b.length>0){a.loadRecords(h,b)}return this},generateIdFor:function(d,b,a,c){return"@id%@".fmt(SC.Store.generateStoreKey())},fixtureForStoreKey:function(a,c){var f=a.idFor(c),d=a.recordTypeFor(c),b=this.fixturesFor(d);return b?b[f]:null},setFixtureForStoreKey:function(a,d,c){var g=a.idFor(d),f=a.recordTypeFor(d),b=this.fixturesFor(f);this._invalidateCachesFor(f,d,g);b[g]=c;return this},fixturesFor:function(i){if(!this._fixtures){this._fixtures={}}var g=this._fixtures[SC.guidFor(i)];if(g){return g}var f=i?i.FIXTURES:null,b=f?f.length:0,c=i?i.prototype.primaryKey:"guid",a,d,h;this._fixtures[SC.guidFor(i)]=g={};for(a=0;a<b;a++){d=f[a];h=d[c];if(!h){h=this.generateIdFor(i,d)}g[h]=d}return g},fixturesLoadedFor:function(c){if(!this._fixtures){return NO}var a=[],b=this._fixtures[SC.guidFor(c)];return b?YES:NO},reset:function(){this._fixtures=null;return this},hasFixturesFor:function(b){var a=NO;b.forEach(function(d){if(a!==SC.MIXED_STATE){var f=SC.Store.recordTypeFor(d),c=f?f.FIXTURES:null;if(c&&c.length&&c.length>0){if(a===NO){a=YES}}else{if(a===YES){a=SC.MIXED_STATE}}}},this);return a},_invalidateCachesFor:function(d,b,c){var a=this._storeKeyCache;if(a){delete a[SC.guidFor(d)]}return this}});SC.Record.fixtures=SC.FixturesDataSource.create();SC.RelationshipSupport={_srs_inverseDidRelinquishRelationships:function(d,c,a,b){c.forEach(function(f){this._srs_inverseDidRelinquishRelationship(d,f,a,b)},this)},_srs_inverseDidRelinquishRelationship:function(i,h,g,b){var f=i.storeKeyFor(h),c=this.readDataHash(f),a=g.inverse,d=i.prototype;if(!c||!a){return}if(SC.instanceOf(d[a],SC.SingleAttribute)){delete c[a]}else{if(SC.instanceOf(d[a],SC.ManyAttribute)&&SC.typeOf(c[a])===SC.T_ARRAY){c[a].removeObject(b)}}this.pushRetrieve(i,h,c,undefined,true)},_srs_inverseDidAddRelationships:function(d,c,a,b){c.forEach(function(f){this._srs_inverseDidAddRelationship(d,f,a,b)},this)},_srs_inverseDidAddRelationship:function(b,a,j,l){var k=b.storeKeyFor(a),h=this.readDataHash(k),d=this.peekStatus(k),g=b.prototype,i=j.inverse,m=g[i],c=g[g.primaryKey],f=false;m=(m&&m.get&&m.get("key")||m.key)||i;if((d===SC.Record.EMPTY)&&(SC.typeOf(j.lazilyInstantiate)===SC.T_FUNCTION&&j.lazilyInstantiate()||SC.typeOf(j.lazilyInstantiate)!==SC.T_FUNCTION&&j.lazilyInstantiate)){if(!SC.none(c)&&c.typeClass&&SC.typeOf(c.typeClass())===SC.T_CLASS){f=true}h={};h[g.primaryKey]=a}if(!h||!i){return}if(SC.instanceOf(g[i],SC.SingleAttribute)){h[m]=l}else{if(SC.instanceOf(g[i],SC.ManyAttribute)){h[m]=h[m]||[];if(h[m].indexOf(l)<0){h[m].push(l)}}}this.pushRetrieve(b,a,h,undefined,!f)},_srs_pushIterator:function(d,b,j,g){var f=d.prototype,h,c,i,a;if(typeof j==="undefined"){j=d.storeKeyFor(b)}c=this.readDataHash(j)||{};for(i in f){h=f[i];if(h&&h.typeClass&&h.inverse&&h.isMaster){a=h.typeClass();if(SC.typeOf(a)!==SC.T_CLASS){continue}g.apply(this,[a,c,h,h.get&&h.get("key")||i])}}},pushDestroy:function(a,f,d,c){var b;this._srs_pushIterator(f,d,c,function(g,h,j,i){b=[h[i]||null].flatten().compact().uniq();this._srs_inverseDidRelinquishRelationships(g,b,j,d)});return a(f,d,c)}.enhance(),pushRetrieve:function(b,i,h,c,f,g){if(!g){var d,a;this._srs_pushIterator(i,h,f,function(j,k,m,l){d=[k[l]||null].flatten().compact().uniq();a=[c[l]||null].flatten().compact().uniq();this._srs_inverseDidRelinquishRelationships(j,d.filter(function(n){return a.indexOf(n)===-1}),m,h);this._srs_inverseDidAddRelationships(j,a,m,h)})}f=f||i.storeKeyFor(h);return b(i,h,c,f)}.enhance()};sc_require("models/record");SC.RecordAttribute=SC.Object.extend({isRecordAttribute:YES,defaultValue:null,type:String,key:null,isRequired:NO,isEditable:YES,useIsoDate:YES,aggregate:NO,lazilyInstantiate:NO,typeClass:function(){var a=this.get("type");if(SC.typeOf(a)===SC.T_STRING){a=SC.requiredObjectForPropertyPath(a)}return a}.property("type").cacheable(),transform:function(){var a=this.get("typeClass")||String,c=SC.RecordAttribute.transforms,b;while(a&&!(b=c[SC.guidFor(a)])){if(a.superclass.hasOwnProperty("create")){a=a.superclass}else{a=SC.T_FUNCTION}}return b}.property("typeClass").cacheable(),toType:function(f,k,j){var c=this.get("transform"),h=this.get("typeClass"),b;if(c&&c.to){j=c.to(j,this,h,f,k);if(!SC.none(j)&&(b=c.observesChildren)){var d,g=b.length,a={record:f,key:k};for(d=0;d<g;d++){j.addObserver(b[d],this,this._SCRA_childObserver,a)}}}return j},_SCRA_childObserver:function(d,b,c,a){this.call(a.record,a.key,d);a.record.notifyPropertyChange(a.key)},fromType:function(a,c,f){var b=this.get("transform"),d=this.get("typeClass");if(b&&b.from){f=b.from(f,this,d,a,c)}return f},call:function(a,b,c){var d=this.get("key")||b,f;if((c!==undefined)&&this.get("isEditable")){f=this.fromType(a,b,c);a.writeAttribute(d,f)}c=a.readAttribute(d);if(SC.none(c)&&(c=this.get("defaultValue"))){if(typeof c===SC.T_FUNCTION){c=c(a,b,this)}}c=this.toType(a,b,c);return c},apply:function(b,a){return this.call.apply(b,a)},isProperty:YES,isCacheable:YES,dependentKeys:[],init:function(){arguments.callee.base.apply(this,arguments);this.cacheKey="__cache__recattr__"+SC.guidFor(this);this.lastSetValueKey="__lastValue__recattr__"+SC.guidFor(this)}});SC.RecordAttribute.mixin({attr:function(a,b){if(!b){b={}}if(!b.type){b.type=a||String}return this.create(b)},transforms:{},registerTransform:function(a,b){SC.RecordAttribute.transforms[SC.guidFor(a)]=b}});SC.RecordAttribute.registerTransform(Boolean,{to:function(a){return SC.none(a)?null:!!a}});SC.RecordAttribute.registerTransform(Number,{to:function(a){return SC.none(a)?null:Number(a)}});SC.RecordAttribute.registerTransform(String,{to:function(a){if(!(typeof a===SC.T_STRING)&&!SC.none(a)&&a.toString){a=a.toString()}return a}});SC.RecordAttribute.registerTransform(Array,{to:function(a){if(!SC.isArray(a)&&!SC.none(a)){a=[]}return a},observesChildren:["[]"]});SC.RecordAttribute.registerTransform(Object,{to:function(a){if(!(typeof a==="object")&&!SC.none(a)){a={}}return a}});SC.RecordAttribute.registerTransform(SC.Record,{to:function(f,a,d,c){var b=c.get("store");if(SC.none(f)||(f==="")){return null}else{return b.find(d,f)}},from:function(a){return a?a.get("id"):null}});SC.RecordAttribute.registerTransform(SC.T_FUNCTION,{to:function(f,a,d,c){d=d.apply(c);var b=c.get("store");return b.find(d,f)},from:function(a){return a.get("id")}});SC.RecordAttribute.registerTransform(Date,{to:function(j,a){if(SC.none(j)){return j}var c;j=j.toString()||"";if(a.get("useIsoDate")){var f="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",i=j.match(new RegExp(f)),h=0,b=new Date(i[1],0,1),g;if(i[3]){b.setMonth(i[3]-1)}if(i[5]){b.setDate(i[5])}if(i[7]){b.setHours(i[7])}if(i[8]){b.setMinutes(i[8])}if(i[10]){b.setSeconds(i[10])}if(i[12]){b.setMilliseconds(Number("0."+i[12])*1000)}if(i[14]){h=(Number(i[16])*60)+Number(i[17]);h*=((i[15]==="-")?1:-1)}h-=b.getTimezoneOffset();g=(Number(b)+(h*60*1000));c=new Date();c.setTime(Number(g))}else{c=new Date(Date.parse(j))}return c},_dates:{},_zeropad:function(a){return((a<0)?"-":"")+((a<10)?"0":"")+Math.abs(a)},from:function(b){if(SC.none(b)){return null}var a=this._dates[b.getTime()];if(a){return a}var d=this._zeropad,c=0-b.getTimezoneOffset()/60;c=(c===0)?"Z":"%@:00".fmt(d(c));this._dates[b.getTime()]=a="%@-%@-%@T%@:%@:%@%@".fmt(d(b.getFullYear()),d(b.getMonth()+1),d(b.getDate()),d(b.getHours()),d(b.getMinutes()),d(b.getSeconds()),c);return a}});if(SC.DateTime&&!SC.RecordAttribute.transforms[SC.guidFor(SC.DateTime)]){SC.RecordAttribute.registerTransform(SC.DateTime,{to:function(c,a){if(a.get("useUnixTime")){if(SC.typeOf(c)===SC.T_STRING){c=parseInt(c)}if(isNaN(c)||SC.typeOf(c)!==SC.T_NUMBER){c=0}return SC.DateTime.create({milliseconds:c*1000,timezone:0})}if(SC.none(c)||SC.instanceOf(c,SC.DateTime)){return c}if(SC.none(c)||SC.instanceOf(c,Date)){return SC.DateTime.create(c.getTime())}var b=a.get("format");return SC.DateTime.parse(c,b?b:SC.DateTime.recordFormat)},from:function(b,a){if(SC.none(b)){return b}if(a.get("useUnixTime")){return b.get("milliseconds")/1000}var c=a.get("format");return b.toFormattedString(c?c:SC.DateTime.recordFormat)}})}SC.RecordAttribute.registerTransform(SC.Set,{to:function(f,a,d,b,c){return SC.Set.create(f)},from:function(f,a,d,b,c){return f.toArray()},observesChildren:["[]"]});sc_require("models/record");sc_require("models/record_attribute");SC.ChildAttribute=SC.RecordAttribute.extend({isNestedRecordTransform:YES,toType:function(b,d,f){var c=null,a,g=this.get("typeClass");if(!b){throw"SC.Child: Error during transform: Unable to retrieve parent record."}if(!SC.none(f)){c=b.registerNestedRecord(f,d)}return c},fromType:function(b,f,g){var a,c,d;if(b){if(b.readAttribute(f)){b.unregisterNestedRecord(f)}if(SC.none(g)){b.writeAttribute(f,g);d=g}else{d=b.registerNestedRecord(g,f);if(d){a=d.get("storeKey");c=d.get("store");b.writeAttribute(f,c.readDataHash(a))}else{if(g){b.writeAttribute(f,g)}}}}return d},call:function(a,b,c){var d=this.get("key")||b;if(c!==undefined){c=this.fromType(a,b,c)}else{c=a.readAttribute(d);if(SC.none(c)&&(c=this.get("defaultValue"))){if(typeof c===SC.T_FUNCTION){c=this.defaultValue(a,b,this);if(a.attributes()){a.writeAttribute(d,c,true)}}}else{c=this.toType(a,b,c)}}return c}});sc_require("models/record");SC.ChildRecord=SC.Record.extend({});SC.ChildRecord.extend=function(){return SC.Record.extend.apply(this,arguments)};SC.ChildArray=SC.Object.extend(SC.Enumerable,SC.Array,{defaultRecordType:null,record:null,propertyName:null,children:null,store:function(){return this.getPath("record.store")}.property("record").cacheable(),storeKey:function(){return this.getPath("record.storeKey")}.property("record").cacheable(),readOnlyChildren:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableChildren:function(){var a=this.get("store"),d=this.get("storeKey"),c=this.get("propertyName"),b,f;b=a.readEditableProperty(d,c);if(!b){f=a.readEditableDataHash(d);b=f[c]=[]}return b}.property(),length:function(){var a=this.get("readOnlyChildren");return a?a.length:0}.property("readOnlyChildren"),objectAt:function(b){var h=this._records,f=this.get("readOnlyChildren"),i,c,d=this.get("propertyName"),g=this.get("record");var a=f?f.length:0;if(!f){return undefined}if(h&&(c=h[b])){return c}if(!h){this._records=h=[]}if(b>=a){return undefined}i=f.objectAt(b);if(!i){return undefined}h[b]=c=g.registerNestedRecord(i,d,d+"."+b);return c},replace:function(k,a,j){var b=this.get("editableChildren"),h=j?(j.get?j.get("length"):j.length):0,g=this.get("record"),d,f=this.get("propertyName"),i,c;d=this._processRecordsToHashes(j);if(d!==this._prevChildren){this._performRecordPropertyChange(null,false)}b.replace(k,a,d);g.recordDidChange(f);return this},_processRecordsToHashes:function(c){var b,a;c=c||[];c.forEach(function(f,d){if(f.isNestedRecord){b=f.get("store");a=f.storeKey;c[d]=b.readDataHash(a)}});return c},normalize:function(){this.forEach(function(b,a){if(b.normalize){b.normalize()}})},recordPropertyDidChange:function(a){this._performRecordPropertyChange(a,true);return this},_performRecordPropertyChange:function(g,i){if(g&&!g.contains(this.get("propertyName"))){return this}var b=this.get("readOnlyChildren"),a=0,c=0;var d=this._prevChildren,h=this._childrenContentDidChange;i=SC.none(i)?true:i;if(b===d){return this}if(d){d.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:h});a=d.get("length")}if(b){b.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:h});c=b.get("length")}this._prevChildren=b;if(i){this.arrayContentWillChange(0,a,c);this._childrenContentDidChange(0,a,c)}return this},_childrenContentDidChange:function(c,a,b){this._records=null;this.arrayContentDidChange(c,a,b)},init:function(){arguments.callee.base.apply(this,arguments);this.recordPropertyDidChange()}});sc_require("models/record");sc_require("models/record_attribute");sc_require("models/child_attribute");sc_require("system/child_array");SC.ChildrenAttribute=SC.ChildAttribute.extend({toType:function(b,d,f){var h=this.get("key")||d,g=SC.keyFor("__kidsArray__",SC.guidFor(this)),c=b[g],i=this.get("typeClass"),a;if(!c){c=SC.ChildArray.create({record:b,propertyName:h,defaultRecordType:i});b[g]=c;a=b.get("relationships");if(!a){b.set("relationships",a=[])}a.push(c)}return c},fromType:function(b,f,g){var a,c,h=SC.keyFor("__kidsArray__",SC.guidFor(this)),d=b[h];if(b){b.writeAttribute(f,g);if(d){d=d.recordPropertyDidChange()}}return d},call:function(a,c,d){var f=this.get("key")||c,b,g=SC.keyFor("__kid__",SC.guidFor(this));if(d!==undefined){d=this.fromType(a,c,d)}else{d=a.readAttribute(f);if(SC.none(d)&&(d=this.get("defaultValue"))){if(typeof d===SC.T_FUNCTION){d=this.defaultValue(a,c,this);if(a.attributes()){if(d instanceof Array){d=this.toType(a,c,d).replace(0,d.length,d)}else{a.writeAttribute(f,d,true)}}}}else{d=this.toType(a,c,d)}}return d}});sc_require("models/record");sc_require("models/record_attribute");SC.FetchedAttribute=SC.RecordAttribute.extend({paramValueKey:"link",paramOwnerKey:"owner",paramRelKey:"rel",queryKey:null,isEditable:NO,toType:function(d,j,h){var i=d.get("store");if(!i){return null}var b=this.get("paramValueKey"),a=this.get("paramOwnerKey"),g=this.get("paramRelKey"),f=this.get("queryKey")||this.get("typeClass"),c={};if(b){c[b]=h}if(a){c[a]=d}if(g){c[g]=this.get("key")||j}return i.findAll(f,c)},fromType:function(a,b,c){return c}});SC.ManyArray=SC.Object.extend(SC.Enumerable,SC.Array,{recordType:null,record:null,propertyName:null,manyAttribute:null,store:function(){return this.get("record").get("store")}.property("record").cacheable(),storeKey:function(){return this.get("record").get("storeKey")}.property("record").cacheable(),readOnlyStoreIds:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableStoreIds:function(){var a=this.get("store"),d=this.get("storeKey"),c=this.get("propertyName"),b,f;b=a.readEditableProperty(d,c);if(!b){f=a.readEditableDataHash(d);b=f[c]=[]}if(b!==this._prevStoreIds){this.recordPropertyDidChange()}return b}.property(),isEditable:function(){var a=this.manyAttribute;return a?a.get("isEditable"):NO}.property("manyAttribute").cacheable(),inverse:function(){var a=this.manyAttribute;return a?a.get("inverse"):null}.property("manyAttribute").cacheable(),isMaster:function(){var a=this.manyAttribute;return a?a.get("isMaster"):null}.property("manyAttribute").cacheable(),orderBy:function(){var a=this.manyAttribute;return a?a.get("orderBy"):null}.property("manyAttribute").cacheable(),length:function(){var a=this.get("readOnlyStoreIds");return a?a.get("length"):0}.property("readOnlyStoreIds"),objectAt:function(a){var h=this._records,g=this.get("readOnlyStoreIds"),c=this.get("store"),i=this.get("recordType"),f,d,b;if(!g||!c){return undefined}if(h&&(d=h[a])){return d}if(!h){this._records=h=[]}b=g.objectAt(a);if(b){f=c.storeKeyFor(i,b);if(c.readStatus(f)===SC.Record.EMPTY){c.retrieveRecord(i,null,f)}h[a]=d=c.materializeRecord(f)}return d},replace:function(o,d,n){if(!this.get("isEditable")){throw"%@.%@[] is not editable".fmt(this.get("record"),this.get("propertyName"))}var c=this.get("editableStoreIds"),l=n?(n.get?n.get("length"):n.length):0,j=this.get("record"),f=this.get("propertyName"),h,p,a,b,g,m,k;a=[];for(h=0;h<l;h++){a[h]=n.objectAt(h).get("id")}g=this.get("inverse");if(g&&d>0){b=SC.ManyArray._toRemove;if(b){SC.ManyArray._toRemove=null}else{b=[]}for(h=0;h<d;h++){b[h]=this.objectAt(o+h)}}c.replace(o,d,a);if(g){for(h=0;h<d;h++){k=b[h];m=k?k[g]:null;if(m&&m.inverseDidRemoveRecord){m.inverseDidRemoveRecord(k,g,j,f)}}if(b){b.length=0;if(!SC.ManyArray._toRemove){SC.ManyArray._toRemove=b}}for(h=0;h<l;h++){k=n.objectAt(h);m=k?k[g]:null;if(m&&m.inverseDidAddRecord){m.inverseDidAddRecord(k,g,j,f)}}}if(j&&(!g||this.get("isMaster"))){j.recordDidChange(f)}this.enumerableContentDidChange(o,d,l-d);return this},removeInverseRecord:function(c){if(!c){return this}var f=c.get("id"),d=this.get("editableStoreIds"),a=(d&&f)?d.indexOf(f):-1,b;if(a>=0){d.removeAt(a);if(this.get("isMaster")&&(b=this.get("record"))){b.recordDidChange(this.get("propertyName"))}}return this},addInverseRecord:function(d){if(!d){return this}var h=d.get("id"),f=this.get("editableStoreIds"),g=this.get("orderBy"),b=f.get("length"),a,c;if(g){a=this._findInsertionLocation(d,0,b,g)}else{a=b}f.insertAt(a,d.get("id"));if(this.get("isMaster")&&(c=this.get("record"))){c.recordDidChange(this.get("propertyName"))}return this},_findInsertionLocation:function(h,d,c,g){var b=d+Math.floor((c-d)/2),f=this.objectAt(b),a=this._compare(h,f,g);if(a<0){if(b===0){return b}else{return this._findInsertionLocation(h,0,b,g)}}else{if(a>0){if(b>=c){return b}else{return this._findInsertionLocation(h,b,c,g)}}else{return b}}},_compare:function(g,f,j){var i=SC.typeOf(j),h,d,c;if(i===SC.T_FUNCTION){h=j(g,f)}else{if(i===SC.T_STRING){h=SC.compare(g,f)}else{c=j.get("length");h=0;for(d=0;(h===0)&&(d<c);d++){h=SC.compare(g,f)}}}return h},recordPropertyDidChange:function(d){if(d&&!d.contains(this.get("propertyName"))){return this}var h=this.get("readOnlyStoreIds"),a,b;var c=this._prevStoreIds,g=this._storeIdsContentDidChange;if(h===c){return this}if(c){c.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:g});a=c.get("length")}else{a=0}if(h){h.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:g});b=h.get("length")}else{b=0}this.arrayContentWillChange(0,a,b);this._prevStoreIds=h;this._storeIdsContentDidChange(0,a,b)},_storeIdsContentDidChange:function(c,a,b){this._records=null;this.arrayContentDidChange(c,a,b)},unknownProperty:function(b,c){var a;if(SC.typeOf(b)===SC.T_STRING){a=this.reducedProperty(b,c)}return a===undefined?arguments.callee.base.apply(this,arguments):a},init:function(){arguments.callee.base.apply(this,arguments);this.recordPropertyDidChange()}});sc_require("models/record");sc_require("models/record_attribute");sc_require("system/many_array");SC.ManyAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,orderBy:null,toType:function(b,d,g){var f=this.get("typeClass"),i=this.get("key")||d,h=SC.keyFor("__manyArray__",SC.guidFor(this)),c=b[h],a;if(!c){c=SC.ManyArray.create({recordType:f,record:b,propertyName:i,manyAttribute:this});b[h]=c;a=b.get("relationships");if(!a){b.set("relationships",a=[])}a.push(c)}return c},fromType:function(b,f,g){var c=[];if(!SC.isArray(g)){throw"Expects toMany attribute to be an array"}var a=g.get("length");for(var d=0;d<a;d++){c[d]=g.objectAt(d).get("id")}return c},inverseDidRemoveRecord:function(a,b,c,d){var f=a.get(b);if(f){f.removeInverseRecord(c)}},inverseDidAddRecord:function(a,b,c,d){var f=a.get(b);if(f){f.addInverseRecord(c)}}});sc_require("models/record");sc_require("models/record_attribute");SC.SingleAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,call:function(c,j,b){var a=this.get("key")||j,i,h,k,g,f,d;if(b!==undefined&&this.get("isEditable")){if(b&&!SC.kindOf(b,SC.Record)){throw"%@ is not an instance of SC.Record".fmt(b)}i=this.get("inverse");if(i){k=this._scsa_call(c,j)}d=this.fromType(c,j,b);c.writeAttribute(a,d,!this.get("isMaster"));f=b;if(i&&(k!==b)){if(k&&(g=k[i])){g.inverseDidRemoveRecord(k,i,c,j)}if(b&&(g=b[i])){g.inverseDidAddRecord(b,i,c,j)}}}else{f=this._scsa_call(c,j,b)}return f},_scsa_call:SC.RecordAttribute.prototype.call,inverseDidRemoveRecord:function(c,g,h,i){var b=this.get("inverse"),f=this._scsa_call(c,g),d=this.get("isMaster"),a;c.writeAttribute(this.get("key")||g,null,!d);c.notifyPropertyChange(g);if((f!==h)||(i!==b)){if(f&&(a=f[b])){a.inverseDidRemoveRecord(f,b,c,g)}}},inverseDidAddRecord:function(a,i,c,h){var f=this.get("inverse"),j=this._scsa_call(a,i),g=this.get("isMaster"),d,b;b=this.fromType(a,i,c);a.writeAttribute(this.get("key")||i,b,!g);a.notifyPropertyChange(i);if((j!==c)||(h!==f)){if(j&&(d=j[f])){d.inverseDidRemoveRecord(j,f,a,i)}}}});sc_require("models/record");SC.Store=SC.Object.extend({name:null,nestedStores:null,dataSource:null,isNested:NO,commitRecordsAutomatically:NO,from:function(a){this.set("dataSource",a);return this},_getDataSource:function(){var a=this.get("dataSource");if(typeof a===SC.T_STRING){a=SC.requiredObjectForPropertyPath(a);if(a.isClass){a=a.create()}this.set("dataSource",a)}return a},cascade:function(a){var b=SC.A(arguments);a=SC.CascadeDataSource.create({dataSources:b});return this.from(a)},chain:function(b,c){if(!b){b={}}b.parentStore=this;if(c){if(SC.typeOf(c)!=="class"){throw new Error("%@ is not a valid class".fmt(c))}if(!SC.kindOf(c,SC.NestedStore)){throw new Error("%@ is not a type of SC.NestedStore".fmt(c))}}else{c=SC.NestedStore}b.childRecords=this.childRecords?SC.clone(this.childRecords):{};b.parentRecords=this.parentRecords?SC.clone(this.parentRecords):{};var a=c.create(b),d=this.nestedStores;if(!d){d=this.nestedStores=[]}d.push(a);return a},willDestroyNestedStore:function(a){if(this.nestedStores){this.nestedStores.removeObject(a)}return this},hasNestedStore:function(a){while(a&&(a!==this)){a=a.get("parentStore")}return a===this},dataHashes:null,statuses:null,revisions:null,editables:null,changelog:null,recordErrors:null,queryErrors:null,childRecords:null,parentRecords:null,storeKeyEditState:function(b){var c=this.editables,a=this.locks;return(c&&c[b])?SC.Store.EDITABLE:SC.Store.LOCKED},readDataHash:function(a){return this.dataHashes[a]},readEditableDataHash:function(b){var a=this.dataHashes[b];if(!a){return a}var c=this.editables;if(!c){c=this.editables=[]}if(!c[b]){c[b]=1;a=this.dataHashes[b]=SC.clone(a,YES)}return a},readEditableProperty:function(c,a){var f=this.readEditableDataHash(c),d=this.editables[c],b=f[a];if(d===1){d=this.editables[c]={}}if(!d[a]){b=f[a];if(b&&b.isCopyable){b=f[a]=b.copy(YES)}d[a]=YES}return b},writeDataHash:function(c,f,a){if(f){this.dataHashes[c]=f}if(a){this.statuses[c]=a}var d=this.editables;if(!d){d=this.editables=[]}d[c]=1;var b=this;this._propagateToChildren(c,function(g){b.writeDataHash(g,null,a)});return this},removeDataHash:function(b,a){this.dataHashes[b]=null;this.statuses[b]=a||SC.Record.EMPTY;var c=this.editables;if(c){c[b]=0}return this},readStatus:function(a){this.readDataHash(a);return this.statuses[a]||SC.Record.EMPTY},peekStatus:function(a){return this.statuses[a]||SC.Record.EMPTY},writeStatus:function(b,a){return this.writeDataHash(b,null,a)},dataHashDidChange:function(f,b,a,i){if(!b){b=SC.Store.generateStoreKey()}var c,g,h,j;c=SC.typeOf(f)===SC.T_ARRAY;if(c){g=f.length}else{g=1;j=f}var d=this;for(h=0;h<g;h++){if(c){j=f[h]}this.revisions[j]=b;this._notifyRecordPropertyChange(j,a,i);this._propagateToChildren(j,function(k){d.dataHashDidChange(k,null,a,i)})}return this},_notifyRecordPropertyChange:function(n,f,m){var a=this.records,h=this.get("nestedStores"),i=SC.Store,c,b,g,l,k,d,o;g=h?h.length:0;for(l=0;l<g;l++){k=h[l];d=k.peekStatus(n);b=k.storeKeyEditState(n);if(b===i.INHERITED){k._notifyRecordPropertyChange(n,f,m)}else{if(d&SC.Record.BUSY){if(k.get("hasChanges")){throw i.CHAIN_CONFLICT_ERROR}k.reset()}}}var j=this.recordPropertyChanges;if(!j){j=this.recordPropertyChanges={storeKeys:SC.CoreSet.create(),records:SC.CoreSet.create(),hasDataChanges:SC.CoreSet.create(),propertyForStoreKeys:{}}}j.storeKeys.add(n);if(a&&(c=a[n])){j.records.push(n);if(!f){j.hasDataChanges.push(n)}if(m){if(!(o=j.propertyForStoreKeys[n])){o=j.propertyForStoreKeys[n]=SC.CoreSet.create()}if(o!=="*"){o.add(m)}}else{j.propertyForStoreKeys[n]="*"}}this.invokeOnce(this.flush);return this},flush:function(){if(!this.recordPropertyChanges){return this}var j=this.recordPropertyChanges,i=j.storeKeys,m=j.hasDataChanges,a=j.records,g=j.propertyForStoreKeys,d=SC.CoreSet.create(),c,b,f,k,h,l,n;i.forEach(function(o){if(a.contains(o)){f=m.contains(o)?NO:YES;c=this.records[o];n=g?g[o]:null;if(n==="*"){n=null}a.remove(o);if(c){c.storeDidChangeProperties(f,n)}}b=SC.Store.recordTypeFor(o);d.add(b)},this);if(i.get("length")>0){this._notifyRecordArrays(i,d)}i.clear();m.clear();a.clear();this.recordPropertyChanges.propertyForStoreKeys={};return this},reset:function(){this.dataHashes={};this.revisions={};this.statuses={};this.chainedChanges=this.locks=this.editables=null;this.changelog=null;this.recordErrors=null;this.queryErrors=null;var c=this.get("dataSource");if(c&&c.reset){c.reset()}var a=this.records,b;if(a){for(b in a){if(!a.hasOwnProperty(b)){continue}this._notifyRecordPropertyChange(parseInt(b,10),NO)}}this.set("hasChanges",NO)},commitChangesFromNestedStore:function(k,u,d){if(!d){this._verifyLockRevisions(u,k.locks)}var q=u.length,p,g,c,m,f,b,j,a,r,s,h,n,l;b=this.revisions;c=this.dataHashes;m=this.statuses;f=this.editables;j=this.parentRecords?this.parentRecords:this.parentRecords={};a=this.childRecords?this.childRecords:this.childRecords={};if(!f){f=this.editables=[]}r=k.dataHashes;h=k.revisions;s=k.statuses;n=k.parentRecords||{};l=k.childRecords||{};for(p=0;p<q;p++){g=u[p];c[g]=r[g];m[g]=s[g];b[g]=h[g];j[g]=n[g];a[g]=l[g];f[g]=0;this._notifyRecordPropertyChange(g,NO)}var o=this.changelog,t=k.changelog;if(t){if(!o){o=this.changelog=SC.CoreSet.create()}o.addEach(t)}this.changelog=o;if(!this.get("parentStore")){this.flush()}return this},_verifyLockRevisions:function(g,j){var a=g.length,c=this.revisions,f,h,d,b;if(j&&c){for(f=0;f<a;f++){h=g[f];d=j[h]||1;b=c[h]||1;if(d<b){throw SC.Store.CHAIN_CONFLICT_ERROR}}}return this},find:function(b,a){if(SC.typeOf(b)===SC.T_STRING){b=SC.objectForPropertyPath(b)}if((arguments.length===1)&&!(b&&b.get&&b.get("isRecord"))){if(!b){throw new Error("SC.Store#find() must pass recordType or query")}if(!b.isQuery){b=SC.Query.local(b)}return this._findQuery(b,YES,YES)}else{return this._findRecord(b,a)}},findAll:function(c,a,b){SC.Logger.warn("SC.Store#findAll() will be removed in a future version of SproutCore.  Use SC.Store#find() instead");if(!c||!c.isQuery){c=SC.Query.local(c,a,b)}return this._findQuery(c,YES,YES)},_findQuery:function(g,a,f){var b=this._scst_recordArraysByQuery,d=SC.guidFor(g),c,h;if(!b){b=this._scst_recordArraysByQuery={}}c=b[d];if(!c&&a){b[d]=c=SC.RecordArray.create({store:this,query:g});h=this.get("recordArrays");if(!h){this.set("recordArrays",h=SC.Set.create())}h.add(c);if(f){this.refreshQuery(g)}}this.flush();return c},_findRecord:function(c,b){var a;if(c&&c.get&&c.get("isRecord")){a=c.get("storeKey")}else{a=b?c.storeKeyFor(b):null}if(a&&(this.readStatus(a)===SC.Record.EMPTY)){a=this.retrieveRecord(c,b)}return a?this.materializeRecord(a):null},recordArrayWillDestroy:function(b){var a=this._scst_recordArraysByQuery,c=this.get("recordArrays");if(a){delete a[SC.guidFor(b.get("query"))]}if(c){c.remove(b)}return this},refreshQuery:function(d){if(!d){throw new Error("refreshQuery() requires a query")}var a=this._scst_recordArraysByQuery,c=a?a[SC.guidFor(d)]:null,b=this._getDataSource();if(b&&b.fetch){if(c){c.storeWillFetchQuery(d)}b.fetch.call(b,this,d)}return this},_notifyRecordArrays:function(b,a){var c=this.get("recordArrays");if(!c){return this}c.forEach(function(d){if(d){d.storeDidChangeStoreKeys(b,a)}},this);return this},recordsFor:function(g){var d=[],a=g.storeKeysById(),f,c,b;for(f in a){c=a[f];if(this.readStatus(c)!==SC.RECORD_EMPTY){d.push(c)}}if(d.length>0){b=SC.RecordArray.create({store:this,storeKeys:d})}else{b=d}return b},_TMP_REC_ATTRS:{},materializeRecord:function(d){var a=this.records,c,f,b;if(!a){a=this.records={}}c=a[d];if(c){return c}f=SC.Store.recordTypeFor(d);if(!f){return null}b=this._TMP_REC_ATTRS;b.storeKey=d;b.store=this;c=a[d]=f.create(b);return c},createRecord:function(d,g,b){var n,m,o,f,l=SC.Record,i,k,j;g=(g?g:{});if(!b&&(n=d.prototype.primaryKey)){b=g[n];k=d.prototype[n]?d.prototype[n].defaultValue:null;if(!b&&SC.typeOf(k)===SC.T_FUNCTION){b=g[n]=k()}}o=b?d.storeKeyFor(b):SC.Store.generateStoreKey();f=this.readStatus(o);if((f&l.BUSY)||(f&l.READY)||(f===l.DESTROYED_DIRTY)){throw b?l.RECORD_EXISTS_ERROR:l.BAD_STATE_ERROR}else{if(!b&&(f===SC.DESTROYED_CLEAN||f===SC.ERROR)){throw l.BAD_STATE_ERROR}}this.writeDataHash(o,g,l.READY_NEW);SC.Store.replaceRecordTypeFor(o,d);this.dataHashDidChange(o);j=this.materializeRecord(o);m=d.prototype;for(var a in m){var h=m[a];if(h&&h.isRecordAttribute){var c=h.key||a;if(!g.hasOwnProperty(c)){if(g.hasOwnProperty(a)){g[c]=g[a];delete g[a]}else{k=h.defaultValue;if(k){if(SC.typeOf(k)===SC.T_FUNCTION){g[c]=SC.copy(k(j,c),YES)}else{g[c]=SC.copy(k,YES)}}}}else{if(c!==a&&g.hasOwnProperty(a)){delete g[a]}}}}i=this.changelog;if(!i){i=SC.Set.create()}i.add(o);this.changelog=i;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)}if(j){j.propagateToAggregates()}return j},createRecords:function(d,j,a){var h=[],c,b,f,g=j.length,i;f=SC.typeOf(d)===SC.T_ARRAY;if(!f){c=d}for(i=0;i<g;i++){if(f){c=d[i]||SC.Record}b=a?a[i]:undefined;h.push(this.createRecord(c,j[i],b))}return h},unloadRecord:function(h,g,f,c){if(f===undefined){f=h.storeKeyFor(g)}var b=this.readStatus(f),a=SC.Record;c=c||a.EMPTY;if((b===a.BUSY_DESTROYING)||(b&a.DESTROYED)){return this}else{if(b&a.BUSY){throw a.BUSY_ERROR}else{b=c}}this.removeDataHash(f,b);this.dataHashDidChange(f);var d=this;this._propagateToChildren(f,function(i){d.unloadRecord(null,null,i,c)});return this},unloadRecords:function(d,a,h,f){var i,g,j,b,c,k;if(h===undefined){g=SC.typeOf(d)===SC.T_ARRAY;if(!g){c=d}if(a===undefined){i=g?d.length:1;for(j=0;j<i;j++){if(g){c=d[j]}h=this.storeKeysFor(c);this.unloadRecords(undefined,undefined,h,f)}}else{i=a.length;for(j=0;j<i;j++){if(g){c=d[j]||SC.Record}b=a?a[j]:undefined;this.unloadRecord(c,b,undefined,f)}}}else{i=h.length;for(j=0;j<i;j++){k=h?h[j]:undefined;this.unloadRecord(undefined,undefined,k,f)}}return this},destroyRecord:function(h,g,f){if(f===undefined){f=h.storeKeyFor(g)}var b=this.readStatus(f),c,a=SC.Record;if((b===a.BUSY_DESTROYING)||(b&a.DESTROYED)){return this}else{if(b===a.EMPTY){throw a.NOT_FOUND_ERROR}else{if(b&a.BUSY){throw a.BUSY_ERROR}else{if(b===a.READY_NEW){b=a.DESTROYED_CLEAN}else{b=a.DESTROYED_DIRTY}}}}this.writeStatus(f,b);this.dataHashDidChange(f);c=this.changelog;if(!c){c=this.changelog=SC.Set.create()}((b&a.DIRTY)?c.add(f):c.remove(f));this.changelog=c;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)}var d=this;this._propagateToChildren(f,function(i){d.destroyRecord(null,null,i)});return this},destroyRecords:function(d,a,g){var h,f,i,b,c,j;if(g===undefined){h=a.length;f=SC.typeOf(d)===SC.T_ARRAY;if(!f){c=d}for(i=0;i<h;i++){if(f){c=d[i]||SC.Record}b=a?a[i]:undefined;this.destroyRecord(c,b,undefined)}}else{h=g.length;for(i=0;i<h;i++){j=g?g[i]:undefined;this.destroyRecord(undefined,undefined,j)}}return this},registerChildToParent:function(c,h,g){var f,b,d,i,a;b=this.childRecords||{};f=this.parentRecords||{};d=b[h];if(d){i=f[d];delete i[h]}a=f[c]||{};a[h]=g||YES;f[c]=a;b[h]=c;this.writeStatus(h,this.statuses[c]);this.childRecords=b;this.parentRecords=f},unregisterChildFromParent:function(c){var a,b;a=this.childRecords;b=a[c];if(b){delete this.parentRecords[b][c]}this.removeDataHash(c);delete this.records[c];delete a[c]},materializeParentRecord:function(c){var b,a;if(SC.none(c)){return null}a=this.childRecords;b=a?this.childRecords[c]:null;if(SC.none(b)){return null}return this.materializeRecord(b)},parentStoreKeyExists:function(b){if(SC.none(b)){return}var a=this.childRecords||{};return a[b]},_propagateToChildren:function(d,c){if(SC.none(this.parentRecords)){return}var b=this.parentRecords[d]||{};if(SC.none(c)){return}for(var a in b){if(b.hasOwnProperty(a)){c(parseInt(a,10))}}},recordDidChange:function(i,h,g,d,c){if(g===undefined){g=i.storeKeyFor(h)}var b=this.readStatus(g),f,a=SC.Record;if(b&a.BUSY){throw a.BUSY_ERROR}else{if(!(b&a.READY)){throw a.NOT_FOUND_ERROR}else{if(b!=a.READY_NEW){this.writeStatus(g,a.READY_DIRTY)}}}this.dataHashDidChange(g,null,c,d);f=this.changelog;if(!f){f=this.changelog=SC.Set.create()}f.add(g);this.changelog=f;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)}return this},recordsDidChange:function(d,a,g){var h,f,i,b,c,j;if(g===undefined){h=a.length;f=SC.typeOf(d)===SC.T_ARRAY;if(!f){c=d}for(i=0;i<h;i++){if(f){c=d[i]||SC.Record}b=a?a[i]:undefined;j=g?g[i]:undefined;this.recordDidChange(c,b,j)}}else{h=g.length;for(i=0;i<h;i++){j=g?g[i]:undefined;this.recordDidChange(undefined,undefined,j)}}return this},retrieveRecords:function(g,n,b,c,r){var m=this._getDataSource(),i=SC.typeOf(g)===SC.T_ARRAY,l=SC.typeOf(r)===SC.T_ARRAY,p=(!b)?n.length:b.length,s=[],q=SC.Store.generateStoreKey(),h=SC.Record,a,k,f,o,j,d;if(!i){a=g}for(k=0;k<p;k++){if(b){f=b[k]}else{if(i){a=g[k]}f=a.storeKeyFor(n[k])}d=l?r[k]:r;o=this.readStatus(f);if((o==h.EMPTY)||(o==h.ERROR)||(o==h.DESTROYED_CLEAN)){this.writeStatus(f,h.BUSY_LOADING);this.dataHashDidChange(f,q,YES);s.push(f);this._setCallbackForStoreKey(f,d,l,b)}else{if(c){if(o&h.READY){this.writeStatus(f,h.BUSY_REFRESH|(o&3));this.dataHashDidChange(f,q,YES);s.push(f);this._setCallbackForStoreKey(f,d,l,b)}else{if((o==h.BUSY_DESTROYING)||(o==h.BUSY_CREATING)||(o==h.BUSY_COMMITTING)){throw h.BUSY_ERROR}else{if(o==h.DESTROYED_DIRTY){throw h.BAD_STATE_ERROR}}}}}}j=NO;if(m){j=m.retrieveRecords.call(m,this,s,n)}if(!j){p=s.length;q=SC.Store.generateStoreKey();for(k=0;k<p;k++){f=s[k];o=this.readStatus(f);if(o===h.BUSY_LOADING){this.writeStatus(f,h.ERROR);this.dataHashDidChange(f,q,YES)}else{if(o&h.BUSY_REFRESH){this.writeStatus(f,h.READY|(o&3));this.dataHashDidChange(f,q,YES)}}}s.length=0}return s},_TMP_RETRIEVE_ARRAY:[],_callback_queue:{},_setCallbackForStoreKey:function(d,f,b,c){var a=this._callback_queue;if(b){a[d]={callback:f,otherKeys:c}}else{a[d]=f}},_retreiveCallbackForStoreKey:function(c){var a=this._callback_queue,f=a[c],d,b;if(f){if(SC.typeOf(f)===SC.T_FUNCTION){f.call();delete a[c]}else{if(SC.typeOf(f)==SC.T_HASH){f.completed=YES;b=f.storeKeys;b.forEach(function(g){if(!a[g].completed){d=YES}});if(d){f.callback.call();b.forEach(function(g){delete a[g]})}}}}},_cancelCallback:function(b){var a=this._callback_queue;if(a[b]){delete a[b]}},retrieveRecord:function(h,g,b,c,f){var d=this._TMP_RETRIEVE_ARRAY,a;if(b){d[0]=b;b=d;g=null}else{d[0]=g;g=d}a=this.retrieveRecords(h,g,b,c,f);d.length=0;return a[0]},refreshRecord:function(d,c,a,b){return !!this.retrieveRecord(d,c,a,YES,b)},refreshRecords:function(b,c,d,f){var a=this.retrieveRecords(b,c,d,YES,f);return a&&a.length>0},commitRecords:function(g,o,b,r,u){var n=this._getDataSource(),i=SC.typeOf(g)===SC.T_ARRAY,l=SC.typeOf(u)===SC.T_ARRAY,c=[],k=[],m=[],s=SC.Store.generateStoreKey(),h=SC.Record,a,j,f,p,v,t,q,d;if(!g&&!o&&!b){b=this.changelog}q=b?b.get("length"):(o?o.get("length"):0);for(j=0;j<q;j++){if(b){f=b[j]}else{if(i){a=g[j]||SC.Record}else{a=g}f=a.storeKeyFor(o[j])}d=l?u[j]:u;p=this.readStatus(f);if(p==h.ERROR){throw h.NOT_FOUND_ERROR}else{if(p==h.READY_NEW){this.writeStatus(f,h.BUSY_CREATING);this.dataHashDidChange(f,s,YES);c.push(f);this._setCallbackForStoreKey(f,d,l,b)}else{if(p==h.READY_DIRTY){this.writeStatus(f,h.BUSY_COMMITTING);this.dataHashDidChange(f,s,YES);k.push(f);this._setCallbackForStoreKey(f,d,l,b)}else{if(p==h.DESTROYED_DIRTY){this.writeStatus(f,h.BUSY_DESTROYING);this.dataHashDidChange(f,s,YES);m.push(f);this._setCallbackForStoreKey(f,d,l,b)}else{if(p==h.DESTROYED_CLEAN){this.dataHashDidChange(f,s,YES)}}}}}}if(n&&(q>0||r)){t=n.commitRecords.call(n,this,c,k,m,r)}if(t&&!g&&!o){if(b===this.changelog){this.changelog=null}else{this.changelog.removeEach(b)}}return t},commitRecord:function(h,g,b,c,f){var d=this._TMP_RETRIEVE_ARRAY,a;if(g===undefined&&b===undefined){return NO}if(b!==undefined){d[0]=b;b=d;g=null}else{d[0]=g;g=d}a=this.commitRecords(h,g,b,c,f);d.length=0;return a},cancelRecords:function(f,b,j){var a=this._getDataSource(),h=SC.typeOf(f)===SC.T_ARRAY,l=SC.Record,k=[],g,i,m,c,d,n;i=(j===undefined)?b.length:j.length;for(m=0;m<i;m++){if(h){d=f[m]||SC.Record}else{d=f||SC.Record}c=b?b[m]:undefined;if(j===undefined){n=d.storeKeyFor(c)}else{n=j?j[m]:undefined}if(n){g=this.readStatus(n);if((g==l.EMPTY)||(g==l.ERROR)){throw l.NOT_FOUND_ERROR}k.push(n);this._cancelCallback(n)}}if(a){a.cancel.call(a,this,k)}return this},cancelRecord:function(f,d,b){var c=this._TMP_RETRIEVE_ARRAY,a;if(b!==undefined){c[0]=b;b=c;d=null}else{c[0]=d;d=c}a=this.cancelRecords(f,d,b);c.length=0;return this},loadRecord:function(h,d,g){var a=SC.Record,c,b,f;h=h||SC.Record;b=h.prototype.primaryKey;g=g||d[b];c=f=h.storeKeyFor(g);if(this.readStatus(f)&a.BUSY){this.dataSourceDidComplete(f,d,g)}else{this.pushRetrieve(h,g,d,f)}return c},loadRecords:function(d,n,a){var g=SC.typeOf(d)===SC.T_ARRAY,h=n.get("length"),i=[],j=SC.Record,c,b,l,k,f,m;if(!g){c=d||SC.Record;l=c.prototype.primaryKey}for(k=0;k<h;k++){f=n.objectAt(k);if(g){c=d.objectAt(k)||SC.Record;l=c.prototype.primaryKey}b=(a)?a.objectAt(k):f[l];i[k]=this.loadRecord(c,f,b)}return i},readError:function(a){var b=this.recordErrors;return b?b[a]:undefined},readQueryError:function(a){var b=this.queryErrors;return b?b[SC.guidFor(a)]:undefined},dataSourceDidCancel:function(c){var b=this.readStatus(c),a=SC.Record;if(!(b&a.BUSY)){throw a.BAD_STATE_ERROR}switch(b){case a.BUSY_LOADING:b=a.EMPTY;break;case a.BUSY_CREATING:b=a.READY_NEW;break;case a.BUSY_COMMITTING:b=a.READY_DIRTY;break;case a.BUSY_REFRESH_CLEAN:b=a.READY_CLEAN;break;case a.BUSY_REFRESH_DIRTY:b=a.READY_DIRTY;break;case a.BUSY_DESTROYING:b=a.DESTROYED_DIRTY;break;default:throw a.BAD_STATE_ERROR}this.writeStatus(c,b);this.dataHashDidChange(c,null,YES);this._cancelCallback(c);return this},dataSourceDidComplete:function(h,g,f){var c=this.readStatus(h),b=SC.Record,d;if(!(c&b.BUSY)){throw b.BAD_STATE_ERROR}if(c===b.BUSY_DESTROYING){throw b.BAD_STATE_ERROR}else{c=b.READY_CLEAN}this.writeStatus(h,c);if(g){this.writeDataHash(h,g,c)}if(f){SC.Store.replaceIdFor(h,f)}d=g||f?NO:YES;this.dataHashDidChange(h,null,d);var a=this.materializeRecord(h);if(a!=null){a.notifyPropertyChange("status")}this._retreiveCallbackForStoreKey(h);return this},dataSourceDidDestroy:function(d){var c=this.readStatus(d),b=SC.Record;if(!(c&b.BUSY)){throw b.BAD_STATE_ERROR}else{c=b.DESTROYED_CLEAN}this.removeDataHash(d,c);this.dataHashDidChange(d);var a=this.materializeRecord(d);if(a!=null){a.notifyPropertyChange("status")}this._retreiveCallbackForStoreKey(d);return this},dataSourceDidError:function(f,d){var c=this.readStatus(f),g=this.recordErrors,b=SC.Record;if(!(c&b.BUSY)){throw b.BAD_STATE_ERROR}else{c=b.ERROR}if(d&&d.isError){if(!g){g=this.recordErrors=[]}g[f]=d}this.writeStatus(f,c);this.dataHashDidChange(f,null,YES);var a=this.materializeRecord(f);if(a!=null){a.notifyPropertyChange("status")}this._retreiveCallbackForStoreKey(f);return this},pushRetrieve:function(g,f,c,d){var b=SC.Record,a;if(d===undefined){d=g.storeKeyFor(f)}a=this.readStatus(d);if(a==b.EMPTY||a==b.ERROR||a==b.READY_CLEAN||a==b.DESTROYED_CLEAN){a=b.READY_CLEAN;if(c===undefined){this.writeStatus(d,a)}else{this.writeDataHash(d,c,a)}if(f&&this.idFor(d)!==f){SC.Store.replaceIdFor(d,f)}this.dataHashDidChange(d);return d}return NO},pushDestroy:function(f,d,c){var b=SC.Record,a;if(c===undefined){c=f.storeKeyFor(d)}a=this.readStatus(c);if(a==b.EMPTY||a==b.ERROR||a==b.READY_CLEAN||a==b.DESTROYED_CLEAN){a=b.DESTROYED_CLEAN;this.removeDataHash(c,a);this.dataHashDidChange(c);return c}return NO},pushError:function(h,g,c,d){var b=SC.Record,a,f=this.recordErrors;if(d===undefined){d=h.storeKeyFor(g)}a=this.readStatus(d);if(a==b.EMPTY||a==b.ERROR||a==b.READY_CLEAN||a==b.DESTROYED_CLEAN){a=b.ERROR;if(c&&c.isError){if(!f){f=this.recordErrors=[]}f[d]=c}this.writeStatus(d,a);this.dataHashDidChange(d,null,YES);return d}return NO},loadQueryResults:function(c,a){if(c.get("location")===SC.Query.LOCAL){throw new Error("Cannot load query results for a local query")}var b=this._findQuery(c,YES,NO);if(b){b.set("storeKeys",a)}this.dataSourceDidFetchQuery(c);return this},dataSourceDidFetchQuery:function(a){return this._scstore_dataSourceDidFetchQuery(a,YES)},_scstore_dataSourceDidFetchQuery:function(d,a){var c=this._findQuery(d,a,NO),b=this.get("nestedStores"),f=b?b.get("length"):0;if(c){c.storeDidFetchQuery(d)}while(--f>=0){b[f]._scstore_dataSourceDidFetchQuery(d,NO)}return this},dataSourceDidCancelQuery:function(a){return this._scstore_dataSourceDidCancelQuery(a,YES)},_scstore_dataSourceDidCancelQuery:function(d,a){var c=this._findQuery(d,a,NO),b=this.get("nestedStores"),f=b?b.get("length"):0;if(c){c.storeDidCancelQuery(d)}while(--f>=0){b[f]._scstore_dataSourceDidCancelQuery(d,NO)}return this},dataSourceDidErrorQuery:function(b,a){var c=this.queryErrors;if(a&&a.isError){if(!c){c=this.queryErrors={}}c[SC.guidFor(b)]=a}return this._scstore_dataSourceDidErrorQuery(b,YES)},_scstore_dataSourceDidErrorQuery:function(d,a){var c=this._findQuery(d,a,NO),b=this.get("nestedStores"),f=b?b.get("length"):0;if(c){c.storeDidErrorQuery(d)}while(--f>=0){b[f]._scstore_dataSourceDidErrorQuery(d,NO)}return this},init:function(){arguments.callee.base.apply(this,arguments);this.reset()},toString:function(){var b=this.get("name");if(!b){return arguments.callee.base.apply(this,arguments)}else{var a=arguments.callee.base.apply(this,arguments);return"%@ (%@)".fmt(b,a)}},idFor:function(a){return SC.Store.idFor(a)},recordTypeFor:function(a){return SC.Store.recordTypeFor(a)},storeKeyFor:function(b,a){return b.storeKeyFor(a)},storeKeyExists:function(b,a){return b.storeKeyExists(a)},storeKeysFor:function(g){var a=[],f=g&&g.isEnumerable,c,d,b;if(!this.statuses){return a}for(d in SC.Store.recordTypesByStoreKey){c=SC.Store.recordTypesByStoreKey[d];if(f){b=g.contains(c)}else{b=c===g}if(b&&this.statuses[d]){a.push(parseInt(d,10))}}return a},storeKeys:function(){var a=[],b;if(!this.statuses){return a}for(b in this.statuses){if(this.statuses[b]!=SC.Record.EMPTY){a.push(parseInt(b,10))}}return a},statusString:function(a){var b=this.materializeRecord(a);return b.statusString()}});SC.Store.mixin({CHAIN_CONFLICT_ERROR:new Error("Nested Store Conflict"),NO_PARENT_STORE_ERROR:new Error("Parent Store Required"),NESTED_STORE_UNSUPPORTED_ERROR:new Error("Unsupported In Nested Store"),NESTED_STORE_RETRIEVE_DIRTY_ERROR:new Error("Cannot Retrieve Dirty Record in Nested Store"),EDITABLE:"editable",LOCKED:"locked",INHERITED:"inherited",idsByStoreKey:[],recordTypesByStoreKey:{},queriesByStoreKey:[],nextStoreKey:1,generateStoreKey:function(){return this.nextStoreKey++},idFor:function(a){return this.idsByStoreKey[a]},queryFor:function(a){return this.queriesByStoreKey[a]},recordTypeFor:function(a){return this.recordTypesByStoreKey[a]},replaceIdFor:function(c,a){var d=this.idsByStoreKey[c],f,b;if(d!==a){f=this.recordTypeFor(c);if(!f){throw new Error("replaceIdFor: storeKey %@ does not exist".fmt(c))}this.idsByStoreKey[c]=a;b=f.storeKeysById();delete b[d];b[a]=c}return this},replaceRecordTypeFor:function(a,b){this.recordTypesByStoreKey[a]=b;return this}});SC.Store.prototype.nextStoreIndex=1;SC.Store._getDefaultStore=function(){var a=this._store;if(!a){this._store=a=SC.Store.create()}return a};SC.Store.updateRecords=function(g,h,i,c){SC.Logger.warn("SC.Store.updateRecords() is deprecated.  Use loadRecords() instead");var d=this._getDefaultStore(),b=g.length,a,f;if(!i){i=[];for(a=0;a<b;a++){i[a]=g[a].recordType}}f=d.loadRecords(i,g);b=f.length;for(a=0;a<b;a++){f[a]=d.materializeRecord(f[a])}return f};SC.Store.find=function(a,b){return this._getDefaultStore().find(b,a)};SC.Store.findAll=function(a,b){return this._getDefaultStore().findAll(a,b)};sc_require("system/store");SC.NestedStore=SC.Store.extend({hasChanges:NO,parentStore:null,isNested:YES,lockOnRead:YES,locks:null,chainedChanges:null,find:function(a){if(a&&a.isQuery&&a.get("location")!==SC.Query.LOCAL){throw"SC.Store#find() can only accept LOCAL queries in nested stores"}return arguments.callee.base.apply(this,arguments)},commitChanges:function(b){if(this.get("hasChanges")){var a=this.get("parentStore");a.commitChangesFromNestedStore(this,this.chainedChanges,b)}this.reset();return this},discardChanges:function(){var c,g;if((c=this.records)&&(g=this.locks)){var b=this.get("parentStore"),i=b.revisions;var h=this.revisions,f,d,a;for(f in c){if(!c.hasOwnProperty(f)){continue}if(!(d=g[f])){continue}a=i[f];if((a!==d)||(h[f]>a)){this._notifyRecordPropertyChange(parseInt(f,10))}}}this.reset();this.flush();return this},destroy:function(){this.discardChanges();var a=this.get("parentStore");if(a){a.willDestroyNestedStore(this)}arguments.callee.base.apply(this,arguments);return this},reset:function(){var c,d,a;var b=this.get("parentStore");if(!b){throw SC.Store.NO_PARENT_STORE_ERROR}this.dataHashes=SC.beget(b.dataHashes);this.revisions=SC.beget(b.revisions);this.statuses=SC.beget(b.statuses);this.childRecords=b.childRecords?SC.beget(b.childRecords):{};this.parentRecords=b.parentRecords?SC.beget(b.parentRecords):{};this.chainedChanges=this.locks=this.editables=null;this.changelog=null;this.set("hasChanges",NO)},refreshQuery:function(b){var a=this.get("parentStore");if(a){a.refreshQuery(b)}return this},readError:function(b){var a=this.get("parentStore");return a?a.readError(b):null},readQueryError:function(b){var a=this.get("parentStore");return a?a.readQueryError(b):null},storeKeyEditState:function(b){var c=this.editables,a=this.locks;return(c&&c[b])?SC.Store.EDITABLE:(a&&a[b])?SC.Store.LOCKED:SC.Store.INHERITED},_lock:function(k){var l=this.locks,g,i,d,a,m,h,f,j;if(l&&l[k]){return this}if(!l){l=this.locks=[]}i=this.editables;if(i){i[k]=0}var b=this.get("parentStore"),c;while(b&&(c=b.storeKeyEditState(k))===SC.Store.INHERITED){b=b.get("parentStore")}if(b&&c===SC.Store.EDITABLE){d=this.childRecords[k];if(d){this._lock(d);a=this.parentRecords[d];if(a){m=a[k];h=m?SC.tupleForPropertyPath(m,this.dataHashes[d]):null;if(h){f=h[0];j=h[1]}this.dataHashes[k]=f&&j?f[j]:null}}else{this.dataHashes[k]=SC.clone(b.dataHashes[k],YES)}if(!i){i=this.editables=[]}i[k]=1}else{this.dataHashes[k]=b.dataHashes[k]}this.statuses[k]=this.statuses[k];g=this.revisions[k]=this.revisions[k];l[k]=g||1;return this},readDataHash:function(a){if(this.get("lockOnRead")){this._lock(a)}return this.dataHashes[a]},readEditableDataHash:function(a){this._lock(a);return arguments.callee.base.apply(this,arguments)},writeDataHash:function(d,g,b){var c=this.locks,h=NO,a;if(g){this.dataHashes[d]=g}else{this._lock(d);h=YES}if(b){this.statuses[d]=b}else{if(!h){this.statuses[d]=(this.statuses[d]||SC.Record.READY_NEW)}}if(!h){a=this.revisions[d]=this.revisions[d];if(!c){c=this.locks=[]}if(!c[d]){c[d]=a||1}}var f=this.editables;if(!f){f=this.editables=[]}f[d]=1;return this},removeDataHash:function(c,a){var b=this.locks;if(!b){b=this.locks=[]}if(!b[c]){b[c]=this.revisions[c]||1}return arguments.callee.base.apply(this,arguments)},dataHashDidChange:function(d,b,a,i){if(!b){b=SC.Store.generateStoreKey()}var c,f,h,j;c=SC.typeOf(d)===SC.T_ARRAY;if(c){f=d.length}else{f=1;j=d}var g=this.chainedChanges;if(!g){g=this.chainedChanges=SC.Set.create()}for(h=0;h<f;h++){if(c){j=d[h]}this._lock(j);this.revisions[j]=b;g.add(j);this._notifyRecordPropertyChange(j,a,i)}this.setIfChanged("hasChanges",YES);return this},commitChangesFromNestedStore:function(f,g,a){arguments.callee.base.apply(this,arguments);var b=this.get("parentStore"),j=b.revisions,c;var l=this.locks,h=this.chainedChanges,d,k;if(!l){l=this.locks=[]}if(!h){h=this.chainedChanges=SC.Set.create()}d=g.length;for(c=0;c<d;c++){k=g[c];if(!l[k]){l[k]=j[k]||1}h.add(k)}this.setIfChanged("hasChanges",h.get("length")>0);this.flush();return this},queryFor:function(c,a,b){return this.get("parentStore").queryFor(c,a,b)},findAll:function(f,b,d,c,a){if(!a){a=this}return this.get("parentStore").findAll(f,b,d,c,a)},retrieveRecords:function(g,n,b,c){var a=this.get("parentStore"),l,d,q,p=(!b)?n.length:b.length,j=SC.Record,o;if(c){for(l=0;l<p;l++){d=!b?a.storeKeyFor(g,n[l]):b[l];o=this.peekStatus(d);if(o&j.DIRTY){throw SC.Store.NESTED_STORE_RETRIEVE_DIRTY_ERROR}else{var h=this.dataHashes,k=this.revisions,i=this.statuses,m=this.editables,s=this.locks;var f=NO;var r=NO;if(h&&h.hasOwnProperty(d)){delete h[d];f=YES}if(k&&k.hasOwnProperty(d)){delete k[d];f=YES}if(m){delete m[d]}if(s){delete s[d]}if(i&&i.hasOwnProperty(d)){delete i[d];if(!f){r=YES}f=YES}if(f){this._notifyRecordPropertyChange(d,r)}}}}return a.retrieveRecords(g,n,b,c)},commitRecords:function(a,b,c){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},commitRecord:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecords:function(a,b,c){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecord:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidCancel:function(a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidComplete:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidDestroy:function(a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidError:function(b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushRetrieve:function(d,c,a,b){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushDestroy:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushError:function(d,c,a,b){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR}});sc_require("models/record");SC.RecordArray=SC.Object.extend(SC.Enumerable,SC.Array,{store:null,query:null,storeKeys:null,status:SC.Record.EMPTY,isEditable:function(){var a=this.get("query");return a?a.get("isEditable"):YES}.property("query").cacheable(),length:function(){this.flush();var a=this.get("storeKeys");return a?a.get("length"):0}.property("storeKeys").cacheable(),_scra_records:null,objectAt:function(a){this.flush();var g=this._scra_records,f=this.get("storeKeys"),b=this.get("store"),d,c;if(!f||!b){return undefined}if(g&&(c=g[a])){return c}if(!g){this._scra_records=g=[]}d=f.objectAt(a);if(d){if(b.peekStatus(d)===SC.Record.EMPTY){b.retrieveRecord(null,null,d)}g[a]=c=b.materializeRecord(d)}return c},forEach:function(i,d){this.flush();var f=this._scra_records,b=this.get("storeKeys"),g=this.get("store"),c=b?b.get("length"):0,h,j,a;if(!b||!g){return this}if(!f){f=this._scra_records=[]}if(!d){d=this}for(h=0;h<c;h++){a=f[h];if(!a){a=f[h]=g.materializeRecord(b.objectAt(h))}i.call(d,a,h,this)}return this},replace:function(b,h,g){this.flush();var f=this.get("storeKeys"),a=g?(g.get?g.get("length"):g.length):0,c,d;if(!f){throw"Unable to edit an SC.RecordArray that does not have its storeKeys property set."}if(!this.get("isEditable")){throw SC.RecordArray.NOT_EDITABLE}d=[];for(c=0;c<a;c++){d[c]=g.objectAt(c).get("storeKey")}f.replace(b,h,d);return this},contains:function(a){return this.indexOf(a)>=0},indexOf:function(b,a){if(!SC.kindOf(b,SC.Record)){SC.Logger.warn("Using indexOf on %@ with an object that is not an SC.Record".fmt(b));return -1}this.flush();var d=b.get("storeKey"),c=this.get("storeKeys");return c?c.indexOf(d,a):-1},lastIndexOf:function(b,a){if(!SC.kindOf(b,SC.Record)){SC.Logger.warn("Using lastIndexOf on %@ with an object that is not an SC.Record".fmt(b));return -1}this.flush();var d=b.get("storeKey"),c=this.get("storeKeys");return c?c.lastIndexOf(d,a):-1},add:function(a){if(!SC.kindOf(a,SC.Record)){return this}if(this.indexOf(a)<0){this.pushObject(a)}return this},remove:function(a){if(!SC.kindOf(a,SC.Record)){return this}this.removeObject(a);return this},find:function(a,b,c){if(b&&b.isQuery){return this.get("store").find(b.queryWithScope(this))}else{return a.apply(this,SC.$A(arguments).slice(1))}}.enhance(),refresh:function(){this.get("store").refreshQuery(this.get("query"));return this},reload:function(){this.flush(YES);return this},destroy:function(){if(!this.get("isDestroyed")){this.get("store").recordArrayWillDestroy(this)}arguments.callee.base.apply(this,arguments)},storeWillFetchQuery:function(c){var b=this.get("status"),a=SC.Record;if((b===a.EMPTY)||(b===a.ERROR)){b=a.BUSY_LOADING}if(b&a.READY){b=a.BUSY_REFRESH}this.setIfChanged("status",b);return this},storeDidFetchQuery:function(a){this.setIfChanged("status",SC.Record.READY_CLEAN);return this},storeDidCancelQuery:function(c){var b=this.get("status"),a=SC.Record;if(b===a.BUSY_LOADING){b=a.EMPTY}else{if(b===a.BUSY_REFRESH){b=a.READY_CLEAN}}this.setIfChanged("status",b);return this},storeDidErrorQuery:function(a){this.setIfChanged("status",SC.Record.ERROR);return this},storeDidChangeStoreKeys:function(b,a){var c=this.get("query");if(c.get("location")!==SC.Query.LOCAL){return this}if(!c.containsRecordTypes(a)){return this}var d=this._scq_changedStoreKeys;if(!d){d=this._scq_changedStoreKeys=SC.IndexSet.create()}d.addEach(b);this.set("needsFlush",YES);if(this.get("storeKeys")){this.flush()}return this},scheduledFlushCount:0,flush:function(a){if(this._insideFlush){this.set("needsFlush",YES);return this}if(!this.get("needsFlush")&&!a){return this}this.set("needsFlush",NO);var k=this.get("query"),n=this.get("store");if(!n||!k||k.get("location")!==SC.Query.LOCAL){return this}this._insideFlush=YES;var i=this.get("storeKeys"),g=this._scq_changedStoreKeys,h=NO,l=SC.Record,q=[],b=new Date(),d,f,c,r,p,j;var m=i;if(i&&!a){if(g){g.forEach(function(s){if(q.length>0||new Date()-b>SC.RecordArray.QUERY_MATCHING_THRESHOLD){q.push(s);return}f=n.peekStatus(s);if(!(f&l.EMPTY)&&!((f&l.DESTROYED)||(f===l.BUSY_DESTROYING))){d=n.materializeRecord(s);j=!!(d&&k.contains(d))}else{j=NO}if(j){if(i.indexOf(s)<0){if(!h){i=i.copy()}i.pushObject(s)}}else{if(i.indexOf(s)>=0){if(!h){i=i.copy()}i.removeObject(s)}}},this);h=YES}}else{if(p=k.get("scope")){r=p.flush().get("storeKeys")}else{if(c=k.get("expandedRecordTypes")){r=SC.IndexSet.create();c.forEach(function(s){r.addEach(n.storeKeysFor(s))})}}i=[];r.forEach(function(s){if(q.length>0||new Date()-b>SC.RecordArray.QUERY_MATCHING_THRESHOLD){q.push(s);return}f=n.peekStatus(s);if(!(f&l.EMPTY)&&!((f&l.DESTROYED)||(f===l.BUSY_DESTROYING))){d=n.materializeRecord(s);if(d&&k.contains(d)){i.push(s)}}});h=YES}if(q.length>0){var o=this;this.incrementProperty("scheduledFlushCount");window.setTimeout(function(){SC.run(function(){if(!o||o.get("isDestroyed")){return}o.set("needsFlush",YES);o._scq_changedStoreKeys=SC.IndexSet.create().addEach(q);o.flush();o.decrementProperty("scheduledFlushCount")})},1)}if(g){g.clear()}if(h){if(i&&(i===m)){i=i.copy()}i=SC.Query.orderStoreKeys(i,k,n);if(SC.compare(m,i)!==0){this.set("storeKeys",SC.clone(i))}}this._insideFlush=NO;return this},needsFlush:YES,isError:function(){return !!(this.get("status")&SC.Record.ERROR)}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var a=this.get("store");return a.readQueryError(this.get("query"))||SC.Record.GENERIC_ERROR}else{return null}}.property("isError").cacheable(),propertyWillChange:function(b){if(b==="storeKeys"){var c=this.get("storeKeys");var a=c?c.get("length"):0;this.arrayContentWillChange(0,a,0)}return arguments.callee.base.apply(this,arguments)},_storeKeysDidChange:function(){var g=this.get("storeKeys");var d=this._prevStoreKeys,b,c,h=this._storeKeysContentDidChange,a=this._storeKeysStateDidChange;if(g===d){return}if(d){d.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange});b=d.get("length")}else{b=0}this._prevStoreKeys=g;if(g){g.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange});c=g.get("length")}else{c=0}this._storeKeysContentDidChange(0,b,c)}.observes("storeKeys"),addArrayObservers:function(){this.flush();return SC.Array.addArrayObservers.apply(this,arguments)},_storeKeysContentDidChange:function(c,a,b){if(this._scra_records){this._scra_records.length=0}this.arrayContentDidChange(c,a,b)},init:function(){arguments.callee.base.apply(this,arguments);this._storeKeysDidChange()}});SC.RecordArray.mixin({NOT_EDITABLE:SC.Error.desc("SC.RecordArray is not editable"),QUERY_MATCHING_THRESHOLD:100});Function.prototype.handleEvents=function(){this.isEventHandler=YES;this.events=arguments;return this};Function.prototype.stateObserves=function(){this.isStateObserveHandler=YES;this.args=SC.A(arguments);return this};SC.StatechartDelegate={isStatechartDelegate:YES,statechartUpdateLocationForState:function(b,a,c){SC.routes.set("location",a)},statechartAcquireLocationForState:function(a,b){return SC.routes.get("location")},statechartBindStateToRoute:function(b,d,a,c){SC.routes.add(a,d,c)},statechartShouldStateHandleTriggeredRoute:function(a,c,b){return YES},statechartStateCancelledHandlingTriggeredRoute:function(a,c,b){}};SC.StatePathMatcher=SC.Object.extend({state:null,expression:null,tokens:null,init:function(){arguments.callee.base.apply(this,arguments);this._parseExpression()},_parseExpression:function(){var j=this.expression?this.expression.split("."):[],b=j.length,g=0,c,f=null,d,h=[];for(;g<b;g+=1){c=j[g];if(c.indexOf("~")>=0){c=c.split("~");if(c.length>2){throw"Invalid use of '~' at part %@".fmt(g)}d=SC.StatePathMatcher._ExpandToken.create({start:c[0],end:c[1]})}else{if(c==="this"){if(h.length>0){throw"Invalid use of 'this' at part %@".fmt(g)}d=SC.StatePathMatcher._ThisToken.create()}else{d=SC.StatePathMatcher._BasicToken.create({value:c})}}d.owner=this;h.push(d)}this.set("tokens",h);var a=SC.clone(h);this._chain=f=a.pop();while(d=a.pop()){f.nextToken=d;f=d}},lastPart:function(){var c=this.get("tokens"),a=c?c.length:0,b=a>0?c[a-1]:null;return b.get("lastPart")}.property("tokens").cacheable(),match:function(a){this._stack=a.split(".");if(SC.empty(a)||SC.typeOf(a)!==SC.T_STRING){return NO}return this._chain.match()},_pop:function(){this._lastPopped=this._stack.pop();return this._lastPopped}});SC.StatePathMatcher._Token=SC.Object.extend({type:null,owner:null,nextToken:null,lastPart:null,match:function(){return NO}});SC.StatePathMatcher._BasicToken=SC.StatePathMatcher._Token.extend({type:"basic",value:null,lastPart:function(){return this.value}.property("value").cacheable(),match:function(){var a=this.owner._pop(),b=this.nextToken;if(this.value!==a){return NO}return b?b.match():YES}});SC.StatePathMatcher._ExpandToken=SC.StatePathMatcher._Token.extend({type:"expand",start:null,end:null,lastPart:function(){return this.end}.property("end").cacheable(),match:function(){var d=this.start,a=this.end,b,c=this.nextToken;b=this.owner._pop();if(b!==a){return NO}while(b=this.owner._pop()){if(b===d){return c?c.match():YES}}return NO}});SC.StatePathMatcher._ThisToken=SC.StatePathMatcher._Token.extend({type:"this",lastPart:"this",match:function(){var f=this.owner.state,c=f.get("substates"),a=c.length,d=0,b;b=this.owner._lastPopped;if(!b||this.owner._stack.length!==0){return NO}for(;d<a;d+=1){if(c[d].get("name")===b){return YES}}return NO}});SC.Async=SC.Object.extend({func:null,arg1:null,arg2:null,tryToPerform:function(d){var c=this.get("func"),b=this.get("arg1"),a=this.get("arg2"),f=SC.typeOf(c);if(f===SC.T_STRING){d.tryToPerform(c,b,a)}else{if(f===SC.T_FUNCTION){c.apply(d,[b,a])}}}});SC.Async.mixin({perform:function(c,b,a){return SC.Async.create({func:c,arg1:b,arg2:a})}});SC.State=SC.Object.extend({name:null,parentState:null,historyState:null,initialSubstate:null,substatesAreConcurrent:NO,substates:null,statechart:null,stateIsInitialized:NO,currentSubstates:null,enteredSubstates:null,representRoute:null,trace:function(){var a=this.getPath("statechart.statechartTraceKey");return this.getPath("statechart.%@".fmt(a))}.property().cacheable(),owner:function(){var c=this.get("statechart"),b=c?c.get("statechartOwnerKey"):null,a=c?c.get(b):null;return a?a:c}.property().cacheable(),statechartDelegate:function(){return this.getPath("statechart.statechartDelegate")}.property().cacheable(),location:function(b,c){var d=this.get("statechart"),a=this.get("statechartDelegate");if(c!==undefined){a.statechartUpdateLocationForState(d,c,this)}return a.statechartAcquireLocationForState(d,this)}.property().idempotent(),init:function(){arguments.callee.base.apply(this,arguments);this._registeredEventHandlers={};this._registeredStringEventHandlers={};this._registeredRegExpEventHandlers=[];this._registeredStateObserveHandlers={};this._registeredSubstatePaths={};this._registeredSubstates=[];this._isEnteringState=NO;this._isExitingState=NO;var b=this.get("statechart"),c=b?b.get("statechartOwnerKey"):null,a=b?b.get("statechartTraceKey"):null;if(b){b.addObserver(c,this,"_statechartOwnerDidChange");b.addObserver(a,this,"_statechartTraceDidChange")}},destroy:function(){var c=this.get("statechart"),d=c?c.get("statechartOwnerKey"):null,a=c?c.get("statechartTraceKey"):null;if(c){c.removeObserver(d,this,"_statechartOwnerDidChange");c.removeObserver(a,this,"_statechartTraceDidChange")}var b=this.get("substates");if(b){b.forEach(function(f){f.destroy()})}this._teardownAllStateObserveHandlers();this.set("substates",null);this.set("currentSubstates",null);this.set("enteredSubstates",null);this.set("parentState",null);this.set("historyState",null);this.set("initialSubstate",null);this.set("statechart",null);this.notifyPropertyChange("trace");this.notifyPropertyChange("owner");this._registeredEventHandlers=null;this._registeredStringEventHandlers=null;this._registeredRegExpEventHandlers=null;this._registeredStateObserveHandlers=null;this._registeredSubstatePaths=null;this._registeredSubstates=null;arguments.callee.base.apply(this,arguments)},initState:function(){if(this.get("stateIsInitialized")){return}this._registerWithParentStates();this._setupRouteHandling();var m=null,l=null,b=null,n=[],k=NO,j=this.get("initialSubstate"),g=this.get("substatesAreConcurrent"),d=this.get("statechart"),c=0,h=0,f=NO,a=null;this.set("substates",n);if(SC.kindOf(j,SC.HistoryState)&&j.isClass){a=this.createSubstate(j);this.set("initialSubstate",a);if(SC.none(a.get("defaultState"))){this.stateLogError("Initial substate is invalid. History state requires the name of a default state to be set");this.set("initialSubstate",null);a=null}}for(m in this){l=this[m];f=SC.typeOf(l)===SC.T_FUNCTION;if(f&&l.isEventHandler){this._registerEventHandler(m,l);continue}if(f&&l.isStateObserveHandler){this._registerStateObserveHandler(m,l);continue}if(f&&l.statePlugin){l=l.apply(this)}if(SC.kindOf(l,SC.State)&&l.isClass&&this[m]!==this.constructor){b=this._addSubstate(m,l);if(m===j){this.set("initialSubstate",b);k=YES}else{if(a&&a.get("defaultState")===m){a.set("defaultState",b);k=YES}}}}if(!SC.none(j)&&!k){this.stateLogError("Unable to set initial substate %@ since it did not match any of state's %@ substates".fmt(j,this))}if(n.length===0){if(!SC.none(j)){this.stateLogWarning("Unable to make %@ an initial substate since state %@ has no substates".fmt(j,this))}}else{if(n.length>0){b=this._addEmptyInitialSubstateIfNeeded();if(!b&&j&&g){this.set("initialSubstate",null);this.stateLogWarning("Can not use %@ as initial substate since substates are all concurrent for state %@".fmt(j,this))}}}this.notifyPropertyChange("substates");this.set("currentSubstates",[]);this.set("enteredSubstates",[]);this.set("stateIsInitialized",YES)},_setupRouteHandling:function(){var b=this.get("representRoute"),c=this.get("statechart"),a=this.get("statechartDelegate");if(!b){return}if(this.get("isConcurrentState")){this.stateLogError("State %@ cannot handle route '%@' since state is concurrent".fmt(this,b));return}a.statechartBindStateToRoute(c,this,b,this.routeTriggered)},routeTriggered:function(g){if(this._isEnteringState){return}var f=this.get("statechart"),b=this.get("statechartDelegate"),d=this.get("location");var a={state:this,location:d,params:g,handler:this.routeTriggered};var c=this.createStateRouteHandlerContext(a);if(b.statechartShouldStateHandleTriggeredRoute(f,this,c)){if(this.get("trace")&&d){this.stateLogTrace("will handle route '%@'".fmt(d))}this.handleTriggeredRoute(c)}else{b.statechartStateCancelledHandlingTriggeredRoute(f,this,c)}},createStateRouteHandlerContext:function(a){return SC.StateRouteHandlerContext.create(a)},handleTriggeredRoute:function(a){this.gotoState(this,a)},_addEmptyInitialSubstateIfNeeded:function(){var c=this.get("initialSubstate"),b=this.get("substatesAreConcurrent");if(c||b){return null}var a=this.createSubstate(SC.EmptyState);this.set("initialSubstate",a);this.get("substates").push(a);this[a.get("name")]=a;a.initState();this.stateLogWarning("state %@ has no initial substate defined. Will default to using an empty state as initial substate".fmt(this));return a},_addSubstate:function(c,d,a){var b=this.get("substates");a=SC.clone(a)||{};a.name=c;d=this.createSubstate(d,a);b.push(d);this[c]=d;d.initState();return d},addSubstate:function(c,f,b){if(SC.empty(c)){this.stateLogError("Can not add substate. name required");return null}if(this[c]!==undefined){this.stateLogError("Can not add substate '%@'. Already a defined property".fmt(c));return null}if(!this.get("stateIsInitialized")){this.stateLogError("Can not add substate '%@'. this state is not yet initialized".fmt(c));return null}var a=arguments.length;if(a===1){f=SC.State}else{if(a===2&&SC.typeOf(f)===SC.T_HASH){b=f;f=SC.State}}var d=SC.kindOf(f,SC.State)&&f.isClass;if(!d){this.stateLogError("Can not add substate '%@'. must provide a state class".fmt(c));return null}f=this._addSubstate(c,f,b);this._addEmptyInitialSubstateIfNeeded();this.notifyPropertyChange("substates");return f},createSubstate:function(b,a){a=a||{};return b.create({parentState:this,statechart:this.get("statechart")},a)},_registerEventHandler:function(b,f){var d=f.events,g=null,a=d.length,c=0;this._registeredEventHandlers[b]=f;for(;c<a;c+=1){g=d[c];if(SC.typeOf(g)===SC.T_STRING){this._registeredStringEventHandlers[g]={name:b,handler:f};continue}if(g instanceof RegExp){this._registeredRegExpEventHandlers.push({name:b,handler:f,regexp:g});continue}this.stateLogError("Invalid event %@ for event handler %@ in state %@".fmt(g,b,this))}},_registerStateObserveHandler:function(d,g){var f=0,c=g.args,b=c.length,a,h=YES;for(;f<b;f+=1){a=c[f];if(SC.typeOf(a)!==SC.T_STRING||SC.empty(a)){this.stateLogError("Invalid argument %@ for state observe handler %@ in state %@".fmt(a,d,this));h=NO}}if(!h){return}this._registeredStateObserveHandlers[d]=g.args},_registerWithParentStates:function(){var a=this.get("parentState");while(!SC.none(a)){a._registerSubstate(this);a=a.get("parentState")}},_registerSubstate:function(b){var c=b.pathRelativeTo(this);if(SC.none(c)){return}this._registeredSubstates.push(b);var a=this._registeredSubstatePaths;if(a[b.get("name")]===undefined){a[b.get("name")]={}}var d=a[b.get("name")];d[c]=b},pathRelativeTo:function(b){var c=this.get("name"),a=this.get("parentState");while(!SC.none(a)&&a!==b){c="%@.%@".fmt(a.get("name"),c);a=a.get("parentState")}if(a!==b&&b!==this){this.stateLogError("Can not generate relative path from %@ since it not a parent state of %@".fmt(b,this));return null}return c},getSubstate:function(g,i,f){if(!g){return null}var b=SC.typeOf(g);if(b===SC.T_OBJECT){return this._registeredSubstates.indexOf(g)>-1?g:null}if(b!==SC.T_STRING){this.stateLogError("Can not find matching subtype. value must be an object or string: %@".fmt(g));return null}var d=SC.StatePathMatcher.create({state:this,expression:g}),c=[],h;if(d.get("tokens").length===0){return null}var k=this._registeredSubstatePaths[d.get("lastPart")];if(!k){return this._notifySubstateNotFound(i,f,g)}for(h in k){if(d.match(h)){c.push(k[h])}}if(c.length===1){return c[0]}if(c.length>1){var j=[];for(h in k){j.push(h)}if(i){return this._notifySubstateNotFound(i,f,g,j)}var a="Can not find substate matching '%@' in state %@. Ambiguous with the following: %@";this.stateLogError(a.fmt(g,this.get("fullPath"),j.join(", ")))}return this._notifySubstateNotFound(i,f,g)},_notifySubstateNotFound:function(d,c,b,a){return d?d.call(c||this,this,b,a):null},getState:function(a){if(a===this.get("name")){return this}if(SC.kindOf(a,SC.State)){return a}return this.getSubstate(a,this._handleSubstateNotFound)},_handleSubstateNotFound:function(d,c,a){var b=this.get("parentState");if(b){return b.getState(c)}if(a){var f="Can not find state matching '%@'. Ambiguous with the following: %@";this.stateLogError(f.fmt(c,a.join(", ")))}return null},gotoState:function(c,a){var b=this.getState(c);if(!b){var d="can not go to state %@ from state %@. Invalid value.";this.stateLogError(d.fmt(c,this));return}var f=this.findFirstRelativeCurrentState(b);this.get("statechart").gotoState(b,f,false,a)},gotoHistoryState:function(d,a,b){var c=this.getState(d);if(!c){var f="can not go to history state %@ from state %@. Invalid value.";this.stateLogError(f.fmt(d,this));return}var g=this.findFirstRelativeCurrentState(c);this.get("statechart").gotoHistoryState(c,g,a,b)},resumeGotoState:function(){this.get("statechart").resumeGotoState()},stateIsCurrentSubstate:function(a){if(SC.typeOf(a)===SC.T_STRING){a=this.get("statechart").getState(a)}var b=this.get("currentSubstates");return !!b&&b.indexOf(a)>=0},stateIsEnteredSubstate:function(b){if(SC.typeOf(b)===SC.T_STRING){b=this.get("statechart").getState(b)}var a=this.get("enteredSubstates");return !!a&&a.indexOf(b)>=0},isRootState:function(){return this.getPath("statechart.rootState")===this}.property(),isCurrentState:function(){return this.stateIsCurrentSubstate(this)}.property("currentSubstates").cacheable(),isConcurrentState:function(){return this.getPath("parentState.substatesAreConcurrent")}.property(),isEnteredState:function(){return this.stateIsEnteredSubstate(this)}.property("enteredSubstates").cacheable(),hasSubstates:function(){return this.getPath("substates.length")>0}.property("substates"),hasCurrentSubstates:function(){var a=this.get("currentSubstates");return !!a&&a.get("length")>0}.property("currentSubstates").cacheable(),hasEnteredSubstates:function(){var a=this.get("enteredSubstates");return !!a&&a.get("length")>0}.property("enteredSubstates").cacheable(),findFirstRelativeCurrentState:function(b){if(this.get("isCurrentState")){return this}var a=this.get("currentSubstates")||[],d=a.get("length"),c=this.get("parentState");if(d===0){return c?c.findFirstRelativeCurrentState():null}if(d>1){b=this.getSubstate(b);if(b){return b.findFirstRelativeCurrentState()}}return a[0]},reenter:function(){if(this.get("isEnteredState")){this.gotoState(this)}else{SC.Logger.error("Can not re-enter state %@ since it is not an entered state in the statechart".fmt(this))}},tryToHandleEvent:function(a,f,d){var c=this.get("trace"),j=this.get("statechart"),h;if(this._registeredEventHandlers[a]){this.stateLogWarning("state %@ can not handle event '%@' since it is a registered event handler".fmt(this,a));return NO}if(this._registeredStateObserveHandlers[a]){this.stateLogWarning("state %@ can not handle event '%@' since it is a registered state observe handler".fmt(this,a));return NO}if(SC.typeOf(this[a])===SC.T_FUNCTION){if(c){this.stateLogTrace("will handle event '%@'".fmt(a))}j.stateWillTryToHandleEvent(this,a,a);h=(this[a](f,d)!==NO);j.stateDidTryToHandleEvent(this,a,a,h);return h}var k=this._registeredStringEventHandlers[a];if(k){if(c){this.stateLogTrace("%@ will handle event '%@'".fmt(k.name,a))}j.stateWillTryToHandleEvent(this,a,k.name);h=(k.handler.call(this,a,f,d)!==NO);j.stateDidTryToHandleEvent(this,a,k.name,h);return h}var g=this._registeredRegExpEventHandlers.length,b=0;for(;b<g;b+=1){k=this._registeredRegExpEventHandlers[b];if(a.match(k.regexp)){if(c){this.stateLogTrace("%@ will handle event '%@'".fmt(k.name,a))}j.stateWillTryToHandleEvent(this,a,k.name);h=(k.handler.call(this,a,f,d)!==NO);j.stateDidTryToHandleEvent(this,a,k.name,h);return h}}if(SC.typeOf(this["unknownEvent"])===SC.T_FUNCTION){if(c){this.stateLogTrace("unknownEvent will handle event '%@'".fmt(a))}j.stateWillTryToHandleEvent(this,a,"unknownEvent");h=(this.unknownEvent(a,f,d)!==NO);j.stateDidTryToHandleEvent(this,a,"unknownEvent",h);return h}return NO},enterState:function(a){},stateWillBecomeEntered:function(a){this._isEnteringState=YES},stateDidBecomeEntered:function(a){this._setupAllStateObserveHandlers();this._isEnteringState=NO},exitState:function(a){},stateWillBecomeExited:function(a){this._isExitingState=YES;this._teardownAllStateObserveHandlers()},stateDidBecomeExited:function(a){this._isExitingState=NO},_setupAllStateObserveHandlers:function(){this._configureAllStateObserveHandlers("addObserver")},_teardownAllStateObserveHandlers:function(){this._configureAllStateObserveHandlers("removeObserver")},_configureAllStateObserveHandlers:function(b){var h,j,g,a,k,d,c,f;for(h in this._registeredStateObserveHandlers){j=this._registeredStateObserveHandlers[h];for(c=0;c<j.length;c+=1){k=j[c];d=h;a=k.indexOf(".");if(a<0){this[b](k,this,d)}else{if(k.indexOf("*")===0){this[b](k.slice(1),this,d)}else{f=null;if(a===0){f=this;k=k.slice(1)}else{if(a===4&&k.slice(0,5)==="this."){f=this;k=k.slice(5)}else{if(a<0&&k.length===4&&k==="this"){f=this;k=""}}}SC.Observers[b](k,this,d,f)}}}}},performAsync:function(c,b,a){return SC.Async.perform(c,b,a)},respondsToEvent:function(d){if(this._registeredEventHandlers[d]){return false}if(SC.typeOf(this[d])===SC.T_FUNCTION){return true}if(this._registeredStringEventHandlers[d]){return true}if(this._registeredStateObserveHandlers[d]){return false}var a=this._registeredRegExpEventHandlers.length,b=0,c;for(;b<a;b+=1){c=this._registeredRegExpEventHandlers[b];if(d.match(c.regexp)){return true}}return SC.typeOf(this["unknownEvent"])===SC.T_FUNCTION},fullPath:function(){var a=this.getPath("statechart.rootState");if(!a){return this.get("name")}return this.pathRelativeTo(a)}.property("name","parentState").cacheable(),toString:function(){return this.get("fullPath")},_enteredSubstatesDidChange:function(){this.notifyPropertyChange("enteredSubstates")}.observes("*enteredSubstates.[]"),_currentSubstatesDidChange:function(){this.notifyPropertyChange("currentSubstates")}.observes("*currentSubstates.[]"),_statechartTraceDidChange:function(){this.notifyPropertyChange("trace")},_statechartOwnerDidChange:function(){this.notifyPropertyChange("owner")},stateLogTrace:function(b){var a=this.get("statechart");a.statechartLogTrace("%@: %@".fmt(this,b))},stateLogWarning:function(b){var a=this.get("statechart");a.statechartLogWarning(b)},stateLogError:function(b){var a=this.get("statechart");a.statechartLogError(b)}});SC.State.plugin=function(c){var a=SC.A(arguments);a.shift();var b=function(){var d=SC.objectForPropertyPath(c);if(!d){console.error("SC.State.plugin: Unable to determine path %@".fmt(c));return undefined}if(!d.isClass||!d.kindOf(SC.State)){console.error("SC.State.plugin: Unable to extend. %@ must be a class extending from SC.State".fmt(c));return undefined}return d.extend.apply(d,a)};b.statePlugin=YES;return b};SC.State.design=SC.State.extend;sc_require("system/state");SC.EMPTY_STATE_NAME="__EMPTY_STATE__";SC.EmptyState=SC.State.extend({name:SC.EMPTY_STATE_NAME,enterState:function(){var a="No initial substate was defined for state %@. Entering default empty state";this.stateLogWarning(a.fmt(this.get("parentState")))}});sc_require("system/state");SC.HistoryState=SC.Object.extend({isRecursive:NO,defaultState:null,statechart:null,parentState:null,state:function(){var b=this.get("defaultState"),a=this.getPath("parentState.historyState");return !!a?a:b}.property().cacheable(),parentHistoryStateDidChange:function(){this.notifyPropertyChange("state")}.observes("*parentState.historyState")});SC.StateRouteHandlerContext=SC.Object.extend({state:null,location:null,params:null,handler:null,retry:function(){var b=this.get("state"),c=this.get("params"),a=this.get("handler");if(SC.typeOf(a)===SC.T_STRING){a=b[a]}if(SC.typeOf(a)===SC.T_FUNCTION){a.apply(b,[c])}}});sc_require("system/state");sc_require("mixins/statechart_delegate");SC.StatechartManager={isResponderContext:YES,isStatechart:YES,statechartIsInitialized:NO,name:null,rootState:null,rootStateExample:SC.State,initialState:null,statesAreConcurrent:NO,monitorIsActive:NO,monitor:null,statechartTraceKey:"trace",trace:NO,statechartOwnerKey:"owner",owner:null,autoInitStatechart:YES,suppressStatechartWarnings:NO,delegate:null,statechartDelegate:function(){var a=this.get("delegate");return this.delegateFor("isStatechartDelegate",a)}.property("delegate"),initMixin:function(){if(this.get("autoInitStatechart")){this.initStatechart()}},destroyMixin:function(){var b=this.get("rootState"),a=this.get("statechartTraceKey");this.removeObserver(a,this,"_statechartTraceDidChange");b.destroy();this.set("rootState",null)},initStatechart:function(){if(this.get("statechartIsInitialized")){return}this._gotoStateLocked=NO;this._sendEventLocked=NO;this._pendingStateTransitions=[];this._pendingSentEvents=[];this.sendAction=this.sendEvent;if(this.get("monitorIsActive")){this.set("monitor",SC.StatechartMonitor.create({statechart:this}))}var a=this.get("statechartTraceKey");this.addObserver(a,this,"_statechartTraceDidChange");this._statechartTraceDidChange();var d=this.get("allowStatechartTracing"),c=this.get("rootState"),f;if(d){this.statechartLogTrace("BEGIN initialize statechart")}if(!c){c=this._constructRootStateClass()}else{if(SC.typeOf(c)===SC.T_FUNCTION&&c.statePlugin){c=c.apply(this)}}if(!(SC.kindOf(c,SC.State)&&c.isClass)){f="Unable to initialize statechart. Root state must be a state class";this.statechartLogError(f);throw f}c=this.createRootState(c,{statechart:this,name:SC.ROOT_STATE_NAME});this.set("rootState",c);c.initState();if(SC.kindOf(c.get("initialSubstate"),SC.EmptyState)){f="Unable to initialize statechart. Root state must have an initial substate explicilty defined";this.statechartLogError(f);throw f}if(!SC.empty(this.get("initialState"))){var b="initialState";this.set(b,c.get(this.get(b)))}this.set("statechartIsInitialized",YES);this.gotoState(c);if(d){this.statechartLogTrace("END initialize statechart")}},createRootState:function(b,a){if(!a){a={}}b=b.create(a);return b},currentStates:function(){return this.getPath("rootState.currentSubstates")}.property().cacheable(),firstCurrentState:function(){var a=this.get("currentStates");return a?a.objectAt(0):null}.property("currentStates").cacheable(),currentStateCount:function(){return this.getPath("currentStates.length")}.property("currentStates").cacheable(),stateIsCurrentState:function(a){return this.get("rootState").stateIsCurrentSubstate(a)},enteredStates:function(){return this.getPath("rootState.enteredSubstates")}.property().cacheable(),stateIsEntered:function(a){return this.get("rootState").stateIsEnteredSubstate(a)},doesContainState:function(a){return !SC.none(this.getState(a))},getState:function(b){var a=this.get("rootState");return a===b?a:a.getSubstate(b)},gotoState:function(b,l,m,c){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@. statechart has not yet been initialized".fmt(b));return}if(this.get("isDestroyed")){this.statechartLogError("can not go to state %@. statechart is destroyed".fmt(this));return}var j=this._processGotoStateArgs(arguments);b=j.state;l=j.fromCurrentState;m=j.useHistory;c=j.context;var o=null,k=[],n=[],g=this.get("allowStatechartTracing"),a=this.get("rootState"),i=b,f=l,d;b=this.getState(b);if(SC.none(b)){this.statechartLogError("Can not to goto state %@. Not a recognized state in statechart".fmt(i));return}if(this._gotoStateLocked){this._pendingStateTransitions.push({state:b,fromCurrentState:l,useHistory:m,context:c});return}this._gotoStateLocked=YES;if(l){l=this.getState(l);if(SC.none(l)||!l.get("isCurrentState")){d="Can not to goto state %@. %@ is not a recognized current state in statechart";this.statechartLogError(d.fmt(i,f));this._gotoStateLocked=NO;return}}else{l=b.findFirstRelativeCurrentState();if(!l){l=this.get("firstCurrentState")}}if(g){this.statechartLogTrace("BEGIN gotoState: %@".fmt(b));d="starting from current state: %@";d=d.fmt(l?l:"---");this.statechartLogTrace(d);d="current states before: %@";d=d.fmt(this.getPath("currentStates.length")>0?this.get("currentStates"):"---");this.statechartLogTrace(d)}if(!SC.none(l)){k=this._createStateChain(l)}n=this._createStateChain(b);o=this._findPivotState(k,n);if(o){if(g){this.statechartLogTrace("pivot state = %@".fmt(o))}if(o.get("substatesAreConcurrent")&&o!==b){this.statechartLogError("Can not go to state %@ from %@. Pivot state %@ has concurrent substates.".fmt(b,l,o));this._gotoStateLocked=NO;return}}var h=[];this._traverseStatesToExit(k.shift(),k,o,h);if(o!==b){this._traverseStatesToEnter(n.pop(),n,o,m,h)}else{this._traverseStatesToExit(o,[],null,h);this._traverseStatesToEnter(o,null,null,m,h)}this._gotoStateActions=h;this._executeGotoStateActions(b,h,null,c)},gotoStateActive:function(){return this._gotoStateLocked}.property(),gotoStateSuspended:function(){return this._gotoStateLocked&&!!this._gotoStateSuspendedPoint}.property(),resumeGotoState:function(){if(!this.get("gotoStateSuspended")){this.statechartLogError("Can not resume goto state since it has not been suspended");return}var a=this._gotoStateSuspendedPoint;this._executeGotoStateActions(a.gotoState,a.actions,a.marker,a.context)},_executeGotoStateActions:function(h,g,b,c){var f=null,a=g.length,d=null;b=SC.none(b)?0:b;for(;b<a;b+=1){this._currentGotoStateAction=f=g[b];switch(f.action){case SC.EXIT_STATE:d=this._exitState(f.state,c);break;case SC.ENTER_STATE:d=this._enterState(f.state,f.currentState,c);break}if(SC.kindOf(d,SC.Async)){this._gotoStateSuspendedPoint={gotoState:h,actions:g,marker:b+1,context:c};d.tryToPerform(f.state);return}}this.beginPropertyChanges();this.notifyPropertyChange("currentStates");this.notifyPropertyChange("enteredStates");this.endPropertyChanges();if(this.get("allowStatechartTracing")){this.statechartLogTrace("current states after: %@".fmt(this.get("currentStates")));this.statechartLogTrace("END gotoState: %@".fmt(h))}this._cleanupStateTransition()},_cleanupStateTransition:function(){this._currentGotoStateAction=null;this._gotoStateSuspendedPoint=null;this._gotoStateActions=null;this._gotoStateLocked=NO;this._flushPendingStateTransition()},_exitState:function(d,b){var c;if(d.get("currentSubstates").indexOf(d)>=0){c=d.get("parentState");while(c){c.get("currentSubstates").removeObject(d);c=c.get("parentState")}}c=d;while(c){c.get("enteredSubstates").removeObject(d);c=c.get("parentState")}if(this.get("allowStatechartTracing")){this.statechartLogTrace("<-- exiting state: %@".fmt(d))}d.set("currentSubstates",[]);d.stateWillBecomeExited(b);var a=this.exitState(d,b);d.stateDidBecomeExited(b);if(this.get("monitorIsActive")){this.get("monitor").pushExitedState(d)}d._traverseStatesToExit_skipState=NO;return a},exitState:function(b,a){return b.exitState(a)},_enterState:function(d,f,b){var c=d.get("parentState");if(c&&!d.get("isConcurrentState")){c.set("historyState",d)}if(f){c=d;while(c){c.get("currentSubstates").pushObject(d);c=c.get("parentState")}}c=d;while(c){c.get("enteredSubstates").pushObject(d);c=c.get("parentState")}if(this.get("allowStatechartTracing")){this.statechartLogTrace("--> entering state: %@".fmt(d))}d.stateWillBecomeEntered(b);var a=this.enterState(d,b);d.stateDidBecomeEntered(b);if(this.get("monitorIsActive")){this.get("monitor").pushEnteredState(d)}return a},enterState:function(b,a){if(b.enterStateByRoute&&SC.kindOf(a,SC.StateRouteHandlerContext)){return b.enterStateByRoute(a)}else{return b.enterState(a)}},gotoHistoryState:function(g,f,c,d){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@'s history state. Statechart has not yet been initialized".fmt(g));return}var b=this._processGotoStateArgs(arguments);g=b.state;f=b.fromCurrentState;c=b.useHistory;d=b.context;g=this.getState(g);if(!g){this.statechartLogError("Can not to goto state %@'s history state. Not a recognized state in statechart".fmt(g));return}var a=g.get("historyState");if(!c){if(a){this.gotoState(a,f,d)}else{this.gotoState(g,f,d)}}else{this.gotoState(g,f,YES,d)}},sendEvent:function(b,h,g){if(this.get("isDestroyed")){this.statechartLogError("can send event %@. statechart is destroyed".fmt(b));return}var c=NO,m=NO,j=this.get("currentStates").slice(),l={},k=0,f=0,a=null,d=this.get("allowStatechartTracing");if(this._sendEventLocked||this._goStateLocked){this._pendingSentEvents.push({event:b,arg1:h,arg2:g});return}this._sendEventLocked=YES;if(d){this.statechartLogTrace("BEGIN sendEvent: '%@'".fmt(b))}k=j.get("length");for(;f<k;f+=1){m=NO;a=j[f];if(!a.get("isCurrentState")){continue}while(!m&&a){if(!l[a.get("fullPath")]){m=a.tryToHandleEvent(b,h,g);l[a.get("fullPath")]=YES}if(!m){a=a.get("parentState")}else{c=YES}}}this._sendEventLocked=NO;if(d){if(!c){this.statechartLogTrace("No state was able handle event %@".fmt(b))}this.statechartLogTrace("END sendEvent: '%@'".fmt(b))}var n=this._flushPendingSentEvents();return c?this:(n?this:null)},stateWillTryToHandleEvent:function(c,b,a){this._stateHandleEventInfo={state:c,event:b,handler:a}},stateDidTryToHandleEvent:function(c,b,a,d){this._stateHandleEventInfo=null},_createStateChain:function(b){var a=[];while(b){a.push(b);b=b.get("parentState")}return a},_findPivotState:function(c,b){if(c.length===0||b.length===0){return null}var a=c.find(function(f,d){if(b.indexOf(f)>=0){return YES}});return a},_traverseStatesToExit:function(b,l,d,j){if(!b||b===d){return}var f=this.get("allowStatechartTracing");if(b.get("substatesAreConcurrent")){var g=0,h=b.get("currentSubstates"),k=h.length,c=null;for(;g<k;g+=1){c=h[g];if(c._traverseStatesToExit_skipState===YES){continue}var a=this._createStateChain(c);this._traverseStatesToExit(a.shift(),a,b,j)}}j.push({action:SC.EXIT_STATE,state:b});if(b.get("isCurrentState")){b._traverseStatesToExit_skipState=YES}this._traverseStatesToExit(l.shift(),l,d,j)},_traverseStatesToEnter:function(b,f,j,h,d){if(!b){return}var c=this.get("allowStatechartTracing");if(j){if(b!==j){this._traverseStatesToEnter(f.pop(),f,j,h,d)}else{this._traverseStatesToEnter(f.pop(),f,null,h,d)}}else{if(!f||f.length===0){var i={action:SC.ENTER_STATE,state:b,currentState:NO};d.push(i);var g=b.get("initialSubstate"),a=b.get("historyState");if(b.get("substatesAreConcurrent")){this._traverseConcurrentStatesToEnter(b.get("substates"),null,h,d)}else{if(b.get("hasSubstates")&&a&&h){this._traverseStatesToEnter(a,null,null,h,d)}else{if(g){if(SC.kindOf(g,SC.HistoryState)){if(!h){h=g.get("isRecursive")}g=g.get("state")}this._traverseStatesToEnter(g,null,null,h,d)}else{i.currentState=YES}}}}else{if(f.length>0){d.push({action:SC.ENTER_STATE,state:b});var k=f.pop();this._traverseStatesToEnter(k,f,null,h,d);if(b.get("substatesAreConcurrent")){this._traverseConcurrentStatesToEnter(b.get("substates"),k,h,d)}}}}},respondsTo:function(d){var b=this.get("currentStates"),a=b.get("length"),c=0,f=null;for(;c<a;c+=1){f=b.objectAt(c);while(f){if(f.respondsToEvent(d)){return true}f=f.get("parentState")}}return SC.typeOf(this[d])===SC.T_FUNCTION},tryToPerform:function(d,c,b){if(!this.respondsTo(d)){return NO}if(SC.typeOf(this[d])===SC.T_FUNCTION){var a=this[d](c,b);if(a!==NO){return YES}}return !!this.sendEvent(d,c,b)},invokeStateMethod:function(l,k,c){if(l==="unknownEvent"){this.statechartLogError("can not invoke method unkownEvent");return}k=SC.A(arguments);k.shift();var g=k.length,n=g>0?k[g-1]:null,m=SC.typeOf(n)===SC.T_FUNCTION?k.pop():null,f=this.get("currentStates"),d=0,b=null,j={},a,o=undefined,h=0;g=f.get("length");for(;d<g;d+=1){b=f.objectAt(d);while(b){if(j[b.get("fullPath")]){break}j[b.get("fullPath")]=YES;a=b[l];if(SC.typeOf(a)===SC.T_FUNCTION&&!a.isEventHandler){o=a.apply(b,k);if(m){m.call(this,b,o)}h+=1;break}b=b.get("parentState")}}return h===1?o:undefined},_traverseConcurrentStatesToEnter:function(d,c,g,b){var f=0,a=d.length,h=null;for(;f<a;f+=1){h=d[f];if(h!==c){this._traverseStatesToEnter(h,null,null,g,b)}}},_flushPendingStateTransition:function(){if(!this._pendingStateTransitions){this.statechartLogError("Unable to flush pending state transition. _pendingStateTransitions is invalid");return}var a=this._pendingStateTransitions.shift();if(!a){return}this.gotoState(a.state,a.fromCurrentState,a.useHistory,a.context)},_flushPendingSentEvents:function(){var a=this._pendingSentEvents.shift();if(!a){return null}return this.sendEvent(a.event,a.arg1,a.arg2)},_monitorIsActiveDidChange:function(){if(this.get("monitorIsActive")&&SC.none(this.get("monitor"))){this.set("monitor",SC.StatechartMonitor.create())}}.observes("monitorIsActive"),_processGotoStateArgs:function(b){var d={state:null,fromCurrentState:null,useHistory:false,context:null},a=null,c=null;b=SC.$A(b);b=b.filter(function(f){return !(f===undefined)});a=b.length;if(a<1){return d}d.state=b[0];if(a===2){c=b[1];switch(SC.typeOf(c)){case SC.T_BOOL:d.useHistory=c;break;case SC.T_HASH:case SC.T_OBJECT:if(!SC.kindOf(c,SC.State)){d.context=c}break;default:d.fromCurrentState=c}}else{if(a===3){c=b[1];if(SC.typeOf(c)===SC.T_BOOL){d.useHistory=c;d.context=b[2]}else{d.fromCurrentState=c;c=b[2];if(SC.typeOf(c)===SC.T_BOOL){d.useHistory=c}else{d.context=c}}}else{d.fromCurrentState=b[1];d.useHistory=b[2];d.context=b[3]}}return d},_constructRootStateClass:function(){var d="rootStateExample",f=this.get(d),b=this.get("initialState"),c=this.get("statesAreConcurrent"),a=0,j,h,g,i={};if(SC.typeOf(f)===SC.T_FUNCTION&&f.statePlugin){f=f.apply(this)}if(!(SC.kindOf(f,SC.State)&&f.isClass)){this._logStatechartCreationError("Invalid root state example");return null}if(c&&!SC.empty(b)){this._logStatechartCreationError("Can not assign an initial state when states are concurrent")}else{if(c){i.substatesAreConcurrent=YES}else{if(SC.typeOf(b)===SC.T_STRING){i.initialSubstate=b}else{this._logStatechartCreationError("Must either define initial state or assign states as concurrent");return null}}}for(j in this){if(j===d){continue}h=this[j];g=SC.typeOf(h)===SC.T_FUNCTION;if(g&&h.statePlugin){h=h.apply(this)}if(SC.kindOf(h,SC.State)&&h.isClass&&this[j]!==this.constructor){i[j]=h;a+=1}}if(a===0){this._logStatechartCreationError("Must define one or more states");return null}return f.extend(i)},_logStatechartCreationError:function(a){SC.Logger.error("Unable to create statechart for %@: %@.".fmt(this,a))},statechartLogTrace:function(a){SC.Logger.info("%@: %@".fmt(this.get("statechartLogPrefix"),a))},statechartLogError:function(a){SC.Logger.error("ERROR %@: %@".fmt(this.get("statechartLogPrefix"),a))},statechartLogWarning:function(a){if(this.get("suppressStatechartWarnings")){return}SC.Logger.warn("WARN %@: %@".fmt(this.get("statechartLogPrefix"),a))},statechartLogPrefix:function(){var b=SC._object_className(this.constructor),a=this.get("name"),c;if(SC.empty(a)){c="%@<%@>".fmt(b,SC.guidFor(this))}else{c="%@<%@, %@>".fmt(b,a,SC.guidFor(this))}return c}.property().cacheable(),allowStatechartTracing:function(){var a=this.get("statechartTraceKey");return this.get(a)}.property().cacheable(),_statechartTraceDidChange:function(){this.notifyPropertyChange("allowStatechartTracing")},details:function(){var b={initialized:this.get("statechartIsInitialized")};if(this.get("name")){b.name=this.get("name")}if(!this.get("statechartIsInitialized")){return b}b["current-states"]=[];this.get("currentStates").forEach(function(g){b["current-states"].push(g.get("fullPath"))});var a={active:this.get("gotoStateActive"),suspended:this.get("gotoStateSuspended")};if(this._gotoStateActions){a["transition-sequence"]=[];var f=this._gotoStateActions,c=function(h){var g=h.action===SC.ENTER_STATE?"enter":"exit";return"%@ %@".fmt(g,h.state.get("fullPath"))};f.forEach(function(g){a["transition-sequence"].push(c(g))});a["current-transition"]=c(this._currentGotoStateAction)}b["state-transition"]=a;if(this._stateHandleEventInfo){var d=this._stateHandleEventInfo;b["handling-event"]={state:d.state.get("fullPath"),event:d.event,handler:d.handler}}else{b["handling-event"]=false}return b}.property(),toStringWithDetails:function(){var b="",c=this.toString(),a=this.get("details");b+=c+"\n";b+=this._hashToString(a,2);return b},_hashToString:function(d,a){var f="";for(var b in d){var c=d[b];if(c instanceof Array){f+=this._arrayToString(b,c,a)+"\n"}else{if(c instanceof Object){f+="%@%@:\n".fmt(" ".mult(a),b);f+=this._hashToString(c,a+2)}else{f+="%@%@: %@\n".fmt(" ".mult(a),b,c)}}}return f},_arrayToString:function(b,d,a){if(d.length===0){return"%@%@: []".fmt(" ".mult(a),b)}var c="%@%@: [\n".fmt(" ".mult(a),b);d.forEach(function(g,f){c+="%@%@\n".fmt(" ".mult(a+2),g)},this);c+=" ".mult(a)+"]";return c}};SC.mixin(SC.StatechartManager,SC.StatechartDelegate,SC.DelegateSupport);SC.ROOT_STATE_NAME="__ROOT_STATE__";SC.EXIT_STATE=0;SC.ENTER_STATE=1;SC.Statechart=SC.Object.extend(SC.StatechartManager,{autoInitStatechart:NO});SC.Statechart.design=SC.Statechart.extend;var Handlebars={};Handlebars.VERSION="1.0.beta.2";Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(b,c,a){if(a){c.not=a}this.helpers[b]=c};Handlebars.registerPartial=function(a,b){this.partials[a]=b};Handlebars.registerHelper("helperMissing",function(a){if(arguments.length===2){return undefined}else{throw new Error("Could not find property '"+a+"'")}});Handlebars.registerHelper("blockHelperMissing",function(g,d){var a=d.inverse||function(){},k=d.fn;var c="";var h=Object.prototype.toString.call(g);if(h==="[object Function]"){g=g()}if(g===true){return k(this)}else{if(g===false||g==null){return a(this)}else{if(h==="[object Array]"){if(g.length>0){for(var f=0,b=g.length;f<b;f++){c=c+k(g[f])}}else{c=a(this)}return c}else{return k(g)}}}});Handlebars.registerHelper("each",function(g,d){var h=d.fn,a=d.inverse;var c="";if(g&&g.length>0){for(var f=0,b=g.length;f<b;f++){c=c+h(g[f])}}else{c=a(this)}return c});Handlebars.registerHelper("if",function(b,a){if(!b||Handlebars.Utils.isEmpty(b)){return a.inverse(this)}else{return a.fn(this)}});Handlebars.registerHelper("unless",function(c,b){var d=b.fn,a=b.inverse;b.fn=a;b.inverse=d;return Handlebars.helpers["if"].call(this,c,b)});Handlebars.registerHelper("with",function(b,a){return a.fn(b)});Handlebars.registerHelper("log",function(a){Handlebars.log(a)});var handlebars=(function(){var g={trace:function c(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function b(h,k,l,o,n,j,m){var i=j.length-1;switch(n){case 1:return j[i-1];break;case 2:this.$=new o.ProgramNode(j[i-2],j[i]);break;case 3:this.$=new o.ProgramNode(j[i]);break;case 4:this.$=new o.ProgramNode([]);break;case 5:this.$=[j[i]];break;case 6:j[i-1].push(j[i]);this.$=j[i-1];break;case 7:this.$=new o.InverseNode(j[i-2],j[i-1],j[i]);break;case 8:this.$=new o.BlockNode(j[i-2],j[i-1],j[i]);break;case 9:this.$=j[i];break;case 10:this.$=j[i];break;case 11:this.$=new o.ContentNode(j[i]);break;case 12:this.$=new o.CommentNode(j[i]);break;case 13:this.$=new o.MustacheNode(j[i-1][0],j[i-1][1]);break;case 14:this.$=new o.MustacheNode(j[i-1][0],j[i-1][1]);break;case 15:this.$=j[i-1];break;case 16:this.$=new o.MustacheNode(j[i-1][0],j[i-1][1]);break;case 17:this.$=new o.MustacheNode(j[i-1][0],j[i-1][1],true);break;case 18:this.$=new o.PartialNode(j[i-1]);break;case 19:this.$=new o.PartialNode(j[i-2],j[i-1]);break;case 20:break;case 21:this.$=[[j[i-2]].concat(j[i-1]),j[i]];break;case 22:this.$=[[j[i-1]].concat(j[i]),null];break;case 23:this.$=[[j[i-1]],j[i]];break;case 24:this.$=[[j[i]],null];break;case 25:j[i-1].push(j[i]);this.$=j[i-1];break;case 26:this.$=[j[i]];break;case 27:this.$=j[i];break;case 28:this.$=new o.StringNode(j[i]);break;case 29:this.$=new o.IntegerNode(j[i]);break;case 30:this.$=new o.BooleanNode(j[i]);break;case 31:this.$=new o.HashNode(j[i]);break;case 32:j[i-1].push(j[i]);this.$=j[i-1];break;case 33:this.$=[j[i]];break;case 34:this.$=[j[i-2],j[i]];break;case 35:this.$=[j[i-2],new o.StringNode(j[i])];break;case 36:this.$=[j[i-2],new o.IntegerNode(j[i])];break;case 37:this.$=[j[i-2],new o.BooleanNode(j[i])];break;case 38:this.$=new o.IdNode(j[i]);break;case 39:j[i-2].push(j[i]);this.$=j[i-2];break;case 40:this.$=[j[i]];break}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function d(i,h){throw new Error(i)},parse:function f(q){var y=this,m=[0],H=[null],t=[],I=this.table,i="",s=0,F=0,k=0,o=2,v=1;this.lexer.setInput(q);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined"){this.lexer.yylloc={}}var j=this.lexer.yylloc;t.push(j);if(typeof this.yy.parseError==="function"){this.parseError=this.yy.parseError}function x(p){m.length=m.length-2*p;H.length=H.length-p;t.length=t.length-p}function w(){var p;p=y.lexer.lex()||1;if(typeof p!=="number"){p=y.symbols_[p]||p}return p}var E,A,l,D,J,u,C={},z,G,h,n;while(true){l=m[m.length-1];if(this.defaultActions[l]){D=this.defaultActions[l]}else{if(E==null){E=w()}D=I[l]&&I[l][E]}if(typeof D==="undefined"||!D.length||!D[0]){if(!k){n=[];for(z in I[l]){if(this.terminals_[z]&&z>2){n.push("'"+this.terminals_[z]+"'")}}var B="";if(this.lexer.showPosition){B="Parse error on line "+(s+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+n.join(", ")}else{B="Parse error on line "+(s+1)+": Unexpected "+(E==1?"end of input":("'"+(this.terminals_[E]||E)+"'"))}this.parseError(B,{text:this.lexer.match,token:this.terminals_[E]||E,line:this.lexer.yylineno,loc:j,expected:n})}if(k==3){if(E==v){throw new Error(B||"Parsing halted.")}F=this.lexer.yyleng;i=this.lexer.yytext;s=this.lexer.yylineno;j=this.lexer.yylloc;E=w()}while(1){if((o.toString()) in I[l]){break}if(l==0){throw new Error(B||"Parsing halted.")}x(1);l=m[m.length-1]}A=E;E=o;l=m[m.length-1];D=I[l]&&I[l][o];k=3}if(D[0] instanceof Array&&D.length>1){throw new Error("Parse Error: multiple actions possible at state: "+l+", token: "+E)}switch(D[0]){case 1:m.push(E);H.push(this.lexer.yytext);t.push(this.lexer.yylloc);m.push(D[1]);E=null;if(!A){F=this.lexer.yyleng;i=this.lexer.yytext;s=this.lexer.yylineno;j=this.lexer.yylloc;if(k>0){k--}}else{E=A;A=null}break;case 2:G=this.productions_[D[1]][1];C.$=H[H.length-G];C._$={first_line:t[t.length-(G||1)].first_line,last_line:t[t.length-1].last_line,first_column:t[t.length-(G||1)].first_column,last_column:t[t.length-1].last_column};u=this.performAction.call(C,i,F,s,this.yy,D[1],H,t);if(typeof u!=="undefined"){return u}if(G){m=m.slice(0,-1*G*2);H=H.slice(0,-1*G);t=t.slice(0,-1*G)}m.push(this.productions_[D[1]][0]);H.push(C.$);t.push(C._$);h=I[m[m.length-2]][m[m.length-1]];m.push(h);break;case 3:return true}}return true}};var a=(function(){var k=({EOF:1,parseError:function m(p,o){if(this.yy.parseError){this.yy.parseError(p,o)}else{throw new Error(p)}},setInput:function(o){this._input=o;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var p=this._input[0];this.yytext+=p;this.yyleng++;this.match+=p;this.matched+=p;var o=p.match(/\n/);if(o){this.yylineno++}this._input=this._input.slice(1);return p},unput:function(o){this._input=o+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var o=this.matched.substr(0,this.matched.length-this.match.length);return(o.length>20?"...":"")+o.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var o=this.match;if(o.length<20){o+=this._input.substr(0,20-o.length)}return(o.substr(0,20)+(o.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var o=this.pastInput();var p=new Array(o.length+1).join("-");return o+this.upcomingInput()+"\n"+p+"^"},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var s,q,p,o;if(!this._more){this.yytext="";this.match=""}var t=this._currentRules();for(var r=0;r<t.length;r++){q=this._input.match(this.rules[t[r]]);if(q){o=q[0].match(/\n.*/g);if(o){this.yylineno+=o.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:o?o[o.length-1].length-1:this.yylloc.last_column+q[0].length};this.yytext+=q[0];this.match+=q[0];this.matches=q;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(q[0].length);this.matched+=q[0];s=this.performAction.call(this,this.yy,this,t[r],this.conditionStack[this.conditionStack.length-1]);if(s){return s}else{return}}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function h(){var o=this.next();if(typeof o!=="undefined"){return o}else{return this.lex()}},begin:function i(o){this.conditionStack.push(o)},popState:function n(){return this.conditionStack.pop()},_currentRules:function l(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}});k.performAction=function j(s,p,r,o){var q=o;switch(r){case 0:this.begin("mu");if(p.yytext){return 14}break;case 1:return 14;break;case 2:return 24;break;case 3:return 16;break;case 4:return 20;break;case 5:return 19;break;case 6:return 19;break;case 7:return 23;break;case 8:return 23;break;case 9:p.yytext=p.yytext.substr(3,p.yyleng-5);this.begin("INITIAL");return 15;break;case 10:return 22;break;case 11:return 34;break;case 12:return 33;break;case 13:return 33;break;case 14:return 36;break;case 15:break;case 16:this.begin("INITIAL");return 18;break;case 17:this.begin("INITIAL");return 18;break;case 18:p.yytext=p.yytext.substr(1,p.yyleng-2).replace(/\\"/g,'"');return 28;break;case 19:return 30;break;case 20:return 30;break;case 21:return 29;break;case 22:return 33;break;case 23:p.yytext=p.yytext.substr(1,p.yyleng-2);return 33;break;case 24:return"INVALID";break;case 25:return 5;break}};k.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s/.])/,/^\[.*\]/,/^./,/^$/];k.conditions={mu:{rules:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:false},INITIAL:{rules:[0,1,25],inclusive:true}};return k})();g.lexer=a;return g})();Handlebars.Parser=handlebars;Handlebars.parse=function(a){Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(a)};Handlebars.print=function(a){return new Handlebars.PrintVisitor().accept(a)};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(b,a){}};Handlebars.log=function(b,a){Handlebars.logger.log(b,a)};(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(c,b){this.type="program";this.statements=c;if(b){this.inverse=new Handlebars.AST.ProgramNode(b)}};Handlebars.AST.MustacheNode=function(d,c,b){this.type="mustache";this.id=d[0];this.params=d.slice(1);this.hash=c;this.escaped=!b};Handlebars.AST.PartialNode=function(c,b){this.type="partial";this.id=c;this.context=b};var a=function(b,c){if(b.original!==c.original){throw new Handlebars.Exception(b.original+" doesn't match "+c.original)}};Handlebars.AST.BlockNode=function(c,b,d){a(c.id,d);this.type="block";this.mustache=c;this.program=b};Handlebars.AST.InverseNode=function(c,b,d){a(c.id,d);this.type="inverse";this.mustache=c;this.program=b};Handlebars.AST.ContentNode=function(b){this.type="content";this.string=b};Handlebars.AST.HashNode=function(b){this.type="hash";this.pairs=b};Handlebars.AST.IdNode=function(g){this.type="ID";this.original=g.join(".");var d=[],h=0;for(var f=0,b=g.length;f<b;f++){var c=g[f];if(c===".."){h++}else{if(c==="."||c==="this"){this.isScoped=true}else{d.push(c)}}}this.parts=d;this.string=d.join(".");this.depth=h;this.isSimple=(d.length===1)&&(h===0)};Handlebars.AST.StringNode=function(b){this.type="STRING";this.string=b};Handlebars.AST.IntegerNode=function(b){this.type="INTEGER";this.integer=b};Handlebars.AST.BooleanNode=function(b){this.type="BOOLEAN";this.bool=b};Handlebars.AST.CommentNode=function(b){this.type="comment";this.comment=b}})();Handlebars.Exception=function(b){var a=Error.prototype.constructor.apply(this,arguments);for(var c in a){if(a.hasOwnProperty(c)){this[c]=a[c]}}};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(a){this.string=a};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};(function(){var c={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var d=/&(?!\w+;)|[<>"'`]/g;var b=/[&<>"'`]/;var a=function(f){return c[f]||"&amp;"};Handlebars.Utils={escapeExpression:function(f){if(f instanceof Handlebars.SafeString){return f.toString()}else{if(f==null||f===false){return""}}if(!b.test(f)){return f}return f.replace(d,a)},isEmpty:function(f){if(typeof f==="undefined"){return true}else{if(f===null){return true}else{if(f===false){return true}else{if(Object.prototype.toString.call(f)==="[object Array]"&&f.length===0){return true}else{return false}}}}}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};(function(g,f){g.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16};g.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1};g.DISASSEMBLE_MAP={};for(var j in g.OPCODE_MAP){var h=g.OPCODE_MAP[j];g.DISASSEMBLE_MAP[h]=j}g.multiParamSize=function(i){return g.MULTI_PARAM_OPCODES[g.DISASSEMBLE_MAP[i]]};g.prototype={compiler:g,disassemble:function(){var t=this.opcodes,r,n;var q=[],v,m,w;for(var s=0,o=t.length;s<o;s++){r=t[s];if(r==="DECLARE"){m=t[++s];w=t[++s];q.push("DECLARE "+m+" = "+w)}else{v=g.DISASSEMBLE_MAP[r];var u=g.multiParamSize(r);var k=[];for(var p=0;p<u;p++){n=t[++s];if(typeof n==="string"){n='"'+n.replace("\n","\\n")+'"'}k.push(n)}v=v+" "+k.join(" ");q.push(v)}}return q.join("\n")},guid:0,compile:function(i,l){this.children=[];this.depths={list:[]};this.options=l;var m=this.options.knownHelpers;this.options.knownHelpers={helperMissing:true,blockHelperMissing:true,each:true,"if":true,unless:true,"with":true,log:true};if(m){for(var k in m){this.options.knownHelpers[k]=m[k]}}return this.program(i)},accept:function(i){return this[i.type](i)},program:function(n){var m=n.statements,p;this.opcodes=[];for(var o=0,k=m.length;o<k;o++){p=m[o];this[p.type](p)}this.isSimple=k===1;this.depths.list=this.depths.list.sort(function(l,i){return l-i});return this},compileProgram:function(n){var k=new this.compiler().compile(n,this.options);var o=this.guid++;this.usePartial=this.usePartial||k.usePartial;this.children[o]=k;for(var p=0,m=k.depths.list.length;p<m;p++){depth=k.depths.list[p];if(depth<2){continue}else{this.addDepth(depth-1)}}return o},block:function(p){var m=p.mustache;var o,q,k,l;var n=this.setupStackForMustache(m);var i=this.compileProgram(p.program);if(p.program.inverse){l=this.compileProgram(p.program.inverse);this.declare("inverse",l)}this.opcode("invokeProgram",i,n.length,!!m.hash);this.declare("inverse",null);this.opcode("append")},inverse:function(l){var k=this.setupStackForMustache(l.mustache);var i=this.compileProgram(l.program);this.declare("inverse",i);this.opcode("invokeProgram",null,k.length,!!l.mustache.hash);this.opcode("append")},hash:function(o){var n=o.pairs,q,p;this.opcode("push","{}");for(var m=0,k=n.length;m<k;m++){q=n[m];p=q[1];this.accept(p);this.opcode("assignToHash",q[0])}},partial:function(i){var k=i.id;this.usePartial=true;if(i.context){this.ID(i.context)}else{this.opcode("push","depth0")}this.opcode("invokePartial",k.original);this.opcode("append")},content:function(i){this.opcode("appendContent",i.string)},mustache:function(i){var k=this.setupStackForMustache(i);this.opcode("invokeMustache",k.length,i.id.original,!!i.hash);if(i.escaped){this.opcode("appendEscaped")}else{this.opcode("append")}},ID:function(n){this.addDepth(n.depth);this.opcode("getContext",n.depth);this.opcode("lookupWithHelpers",n.parts[0]||null,n.isScoped||false);for(var m=1,k=n.parts.length;m<k;m++){this.opcode("lookup",n.parts[m])}},STRING:function(i){this.opcode("pushString",i.string)},INTEGER:function(i){this.opcode("push",i.integer)},BOOLEAN:function(i){this.opcode("push",i.bool)},comment:function(){},pushParams:function(m){var k=m.length,l;while(k--){l=m[k];if(this.options.stringParams){if(l.depth){this.addDepth(l.depth)}this.opcode("getContext",l.depth||0);this.opcode("pushStringParam",l.string)}else{this[l.type](l)}}},opcode:function(i,m,l,k){this.opcodes.push(g.OPCODE_MAP[i]);if(m!==undefined){this.opcodes.push(m)}if(l!==undefined){this.opcodes.push(l)}if(k!==undefined){this.opcodes.push(k)}},declare:function(i,k){this.opcodes.push("DECLARE");this.opcodes.push(i);this.opcodes.push(k)},addDepth:function(i){if(i===0){return}if(!this.depths[i]){this.depths[i]=true;this.depths.list.push(i)}},setupStackForMustache:function(i){var k=i.params;this.pushParams(k);if(i.hash){this.hash(i.hash)}this.ID(i.id);return k}};f.prototype={nameLookup:function(l,i,k){if(/^[0-9]+$/.test(i)){return l+"["+i+"]"}else{if(f.isValidJavaScriptVariableName(i)){return l+"."+i}else{return l+"['"+i+"']"}}},appendToBuffer:function(i){if(this.environment.isSimple){return"return "+i+";"}else{return"buffer += "+i+";"}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(i,k,m,l){this.environment=i;this.options=k||{};this.name=this.environment.name;this.isChild=!!m;this.context=m||{programs:[],aliases:{self:"this"},registers:{list:[]}};this.preamble();this.stackSlot=0;this.stackVars=[];this.compileChildren(i,k);var o=i.opcodes,n;this.i=0;for(b=o.length;this.i<b;this.i++){n=this.nextOpcode(0);if(n[0]==="DECLARE"){this.i=this.i+2;this[n[1]]=n[2]}else{this.i=this.i+n[1].length;this[n[0]].apply(this,n[1])}}return this.createFunctionContext(l)},nextOpcode:function(r){var o=this.environment.opcodes,m=o[this.i+r],l,p;var q,i;if(m==="DECLARE"){l=o[this.i+1];p=o[this.i+2];return["DECLARE",l,p]}else{l=g.DISASSEMBLE_MAP[m];q=g.multiParamSize(m);i=[];for(var k=0;k<q;k++){i.push(o[this.i+k+1+r])}return[l,i]}},eat:function(i){this.i=this.i+i.length},preamble:function(){var i=[];if(!this.isChild){var k=this.namespace;var l="helpers = helpers || "+k+".helpers;";if(this.environment.usePartial){l=l+" partials = partials || "+k+".partials;"}i.push(l)}else{i.push("")}if(!this.environment.isSimple){i.push(", buffer = "+this.initializeBuffer())}else{i.push("")}this.lastContext=0;this.source=i},createFunctionContext:function(q){var r=this.stackVars;if(!this.isChild){r=r.concat(this.context.registers.list)}if(r.length>0){this.source[1]=this.source[1]+", "+r.join(", ")}if(!this.isChild){var m=[];for(var p in this.context.aliases){this.source[1]=this.source[1]+", "+p+"="+this.context.aliases[p]}}if(this.source[1]){this.source[1]="var "+this.source[1].substring(2)+";"}if(!this.isChild){this.source[1]+="\n"+this.context.programs.join("\n")+"\n"}if(!this.environment.isSimple){this.source.push("return buffer;")}var s=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var o=0,k=this.environment.depths.list.length;o<k;o++){s.push("depth"+this.environment.depths.list[o])}if(q){s.push(this.source.join("\n  "));return Function.apply(this,s)}else{var n="function "+(this.name||"")+"("+s.join(",")+") {\n  "+this.source.join("\n  ")+"}";Handlebars.log(Handlebars.logger.DEBUG,n+"\n\n");return n}},appendContent:function(i){this.source.push(this.appendToBuffer(this.quotedString(i)))},append:function(){var i=this.popStack();this.source.push("if("+i+" || "+i+" === 0) { "+this.appendToBuffer(i)+" }");if(this.environment.isSimple){this.source.push("else { "+this.appendToBuffer("''")+" }")}},appendEscaped:function(){var k=this.nextOpcode(1),i="";this.context.aliases.escapeExpression="this.escapeExpression";if(k[0]==="appendContent"){i=" + "+this.quotedString(k[1][0]);this.eat(k)}this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+i))},getContext:function(i){if(this.lastContext!==i){this.lastContext=i}},lookupWithHelpers:function(l,m){if(l){var i=this.nextStack();this.usingKnownHelper=false;var k;if(!m&&this.options.knownHelpers[l]){k=i+" = "+this.nameLookup("helpers",l,"helper");this.usingKnownHelper=true}else{if(m||this.options.knownHelpersOnly){k=i+" = "+this.nameLookup("depth"+this.lastContext,l,"context")}else{k=i+" = "+this.nameLookup("helpers",l,"helper")+" || "+this.nameLookup("depth"+this.lastContext,l,"context")}}k+=";";this.source.push(k)}else{this.pushStack("depth"+this.lastContext)}},lookup:function(k){var i=this.topStack();this.source.push(i+" = ("+i+" === null || "+i+" === undefined || "+i+" === false ? "+i+" : "+this.nameLookup(i,k,"context")+");")},pushStringParam:function(i){this.pushStack("depth"+this.lastContext);this.pushString(i)},pushString:function(i){this.pushStack(this.quotedString(i))},push:function(i){this.pushStack(i)},invokeMustache:function(l,k,i){this.populateParams(l,this.quotedString(k),"{}",null,i,function(m,o,n){if(!this.usingKnownHelper){this.context.aliases.helperMissing="helpers.helperMissing";this.context.aliases.undef="void 0";this.source.push("else if("+n+"=== undef) { "+m+" = helperMissing.call("+o+"); }");if(m!==n){this.source.push("else { "+m+" = "+n+"; }")}}})},invokeProgram:function(l,m,k){var i=this.programExpression(this.inverse);var n=this.programExpression(l);this.populateParams(m,null,n,i,k,function(o,q,p){if(!this.usingKnownHelper){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";this.source.push("else { "+o+" = blockHelperMissing.call("+q+"); }")}})},populateParams:function(q,l,u,r,y,x){var m=y||this.options.stringParams||r||this.options.data;var k=this.popStack(),w;var o=[],n,p,v;if(m){this.register("tmp1",u);v="tmp1"}else{v="{ hash: {} }"}if(m){var t=(y?this.popStack():"{}");this.source.push("tmp1.hash = "+t+";")}if(this.options.stringParams){this.source.push("tmp1.contexts = [];")}for(var s=0;s<q;s++){n=this.popStack();o.push(n);if(this.options.stringParams){this.source.push("tmp1.contexts.push("+this.popStack()+");")}}if(r){this.source.push("tmp1.fn = tmp1;");this.source.push("tmp1.inverse = "+r+";")}if(this.options.data){this.source.push("tmp1.data = data;")}o.push(v);this.populateCall(o,k,l||k,x)},populateCall:function(m,p,o,i){var l=["depth0"].concat(m).join(", ");var n=["depth0"].concat(o).concat(m).join(", ");var k=this.nextStack();if(this.usingKnownHelper){this.source.push(k+" = "+p+".call("+l+");")}else{this.context.aliases.functionType='"function"';this.source.push("if(typeof "+p+" === functionType) { "+k+" = "+p+".call("+l+"); }")}i.call(this,k,n,p);this.usingKnownHelper=false},invokePartial:function(i){this.pushStack("self.invokePartial("+this.nameLookup("partials",i,"partial")+", '"+i+"', "+this.popStack()+", helpers, partials);")},assignToHash:function(i){var k=this.popStack();var l=this.topStack();this.source.push(l+"['"+i+"'] = "+k+";")},compiler:f,compileChildren:function(k,o){var q=k.children,s,r;for(var p=0,m=q.length;p<m;p++){s=q[p];r=new this.compiler();this.context.programs.push("");var n=this.context.programs.length;s.index=n;s.name="program"+n;this.context.programs[n]=r.compile(s,o,this.context)}},programExpression:function(m){if(m==null){return"self.noop"}var q=this.environment.children[m],p=q.depths.list;var o=[q.index,q.name,"data"];for(var n=0,k=p.length;n<k;n++){depth=p[n];if(depth===1){o.push("depth0")}else{o.push("depth"+(depth-1))}}if(p.length===0){return"self.program("+o.join(", ")+")"}else{o.shift();return"self.programWithDepth("+o.join(", ")+")"}},register:function(i,k){this.useRegister(i);this.source.push(i+" = "+k+";")},useRegister:function(i){if(!this.context.registers[i]){this.context.registers[i]=true;this.context.registers.list.push(i)}},pushStack:function(i){this.source.push(this.nextStack()+" = "+i+";");return"stack"+this.stackSlot},nextStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot)}return"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(i){return'"'+i.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var a=("break case catch continue default delete do else finally for function if in instanceof new return switch this throw try typeof var void while with null true false").split(" ");var d=f.RESERVED_WORDS={};for(var c=0,b=a.length;c<b;c++){d[a[c]]=true}f.isValidJavaScriptVariableName=function(i){if(!f.RESERVED_WORDS[i]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(i)){return true}return false}})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);Handlebars.precompile=function(d,c){c=c||{};var b=Handlebars.parse(d);var a=new Handlebars.Compiler().compile(b,c);return new Handlebars.JavaScriptCompiler().compile(a,c)};Handlebars.compile=function(b,a){a=a||{};var d;function c(){var h=Handlebars.parse(b);var g=new Handlebars.Compiler().compile(h,a);var f=new Handlebars.JavaScriptCompiler().compile(g,a,undefined,true);return Handlebars.template(f)}return function(g,f){if(!d){d=c()}return d.call(this,g,f)}};Handlebars.VM={template:function(a){var b={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(d,f,g){var c=this.programs[d];if(g){return Handlebars.VM.program(f,g)}else{if(c){return c}else{c=this.programs[d]=Handlebars.VM.program(f);return c}}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(d,c){c=c||{};return a.call(b,Handlebars,d,c.helpers,c.partials,c.data)}},programWithDepth:function(b,d,c){var a=Array.prototype.slice.call(arguments,2);return function(g,f){f=f||{};return b.apply(this,[g,f.data||d].concat(a))}},program:function(a,b){return function(d,c){c=c||{};return a(d,c.data||b)}},noop:function(){return""},invokePartial:function(a,b,d,f,c){if(a===undefined){throw new Handlebars.Exception("The partial "+b+" could not be found")}else{if(a instanceof Function){return a(d,{helpers:f,partials:c})}else{if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+b+" could not be compiled when running in vm mode")}else{c[b]=Handlebars.compile(a);return c[b](d,{helpers:f,partials:c})}}}}};Handlebars.template=Handlebars.VM.template;sc_require("handlebars");SC.Handlebars={};SC.Handlebars.Compiler=function(){};SC.Handlebars.Compiler.prototype=SC.beget(Handlebars.Compiler.prototype);SC.Handlebars.Compiler.prototype.compiler=SC.Handlebars.Compiler;SC.Handlebars.JavaScriptCompiler=function(){};SC.Handlebars.JavaScriptCompiler.prototype=SC.beget(Handlebars.JavaScriptCompiler.prototype);SC.Handlebars.JavaScriptCompiler.prototype.compiler=SC.Handlebars.JavaScriptCompiler;SC.Handlebars.JavaScriptCompiler.prototype.nameLookup=function(c,a,b){if(b==="context"){return"SC.get("+c+", "+this.quotedString(a)+")"}else{return Handlebars.JavaScriptCompiler.prototype.nameLookup.call(this,c,a,b)}};SC.Handlebars.Compiler.prototype.mustache=function(a){if(a.params.length||a.hash){return Handlebars.Compiler.prototype.mustache.call(this,a)}else{var b=new Handlebars.AST.IdNode(["bind"]);if(a.escaped){a.hash=a.hash||new Handlebars.AST.HashNode([]);a.hash.pairs.push(["escaped",new Handlebars.AST.StringNode("true")])}a=new Handlebars.AST.MustacheNode([b].concat([a.id]),a.hash,!a.escaped);return Handlebars.Compiler.prototype.mustache.call(this,a)}};SC.Handlebars.compile=function(f){var c=Handlebars.parse(f);var d={data:true,stringParams:true};var b=new SC.Handlebars.Compiler().compile(c,d);var a=new SC.Handlebars.JavaScriptCompiler().compile(b,d,undefined,true);return Handlebars.template(a)};Handlebars.registerHelper("helperMissing",function(c,b){var a;a="%@ Handlebars error: Could not find property '%@' on object %@.";throw a.fmt(b.data.view,c,this)});sc_require("ext/handlebars");(function(){var a=function(m,n,j,b){var f=n.data,k=n.fn,d=n.inverse,l=f.view;if(this.isObservable){var g=l.createChildView(SC._BindableSpan,{preserveContext:j,shouldDisplayFunc:b,displayTemplate:k,inverseTemplate:d,property:m,previousContext:this,tagName:(n.hash.tagName||"span"),isEscaped:n.hash.escaped});var i,h;l.get("childViews").push(g);i=function(){if(g.get("layer")){g.rerender()}else{this.removeObserver(m,h)}};h=function(){this.invokeOnce(i)};this.addObserver(m,h);var c=g.renderContext(g.get("tagName"));g.renderToContext(c);return new Handlebars.SafeString(c.join())}else{return SC.getPath(this,m)}};Handlebars.registerHelper("bind",function(c,b){return a.call(this,c,b,false,function(d){return !SC.none(d)})});Handlebars.registerHelper("boundIf",function(c,b){if(b){return a.call(this,c,b,true,function(d){if(SC.typeOf(d)===SC.T_ARRAY){if(d.length!==0){return true}return false}else{return !!d}})}else{throw"Cannot use boundIf helper without a block."}})})();Handlebars.registerHelper("with",function(b,a){return Handlebars.helpers.bind.call(a.contexts[0],b,a)});Handlebars.registerHelper("if",function(b,a){return Handlebars.helpers.boundIf.call(a.contexts[0],b,a)});Handlebars.registerHelper("unless",function(c,b){var d=b.fn,a=b.inverse;b.fn=a;b.inverse=d;return Handlebars.helpers.boundIf.call(b.contexts[0],c,b)});Handlebars.registerHelper("bindAttr",function(g){var f=g.hash;var b=g.data.view;var d=[];var c=jQuery.uuid++;var i=f["class"];if(i!=null){var a=SC.Handlebars.bindClasses(this,i,b,c);d.push('class="'+a.join(" ")+'"');delete f["class"]}var h=SC.keys(f);h.forEach(function(j){var n=f[j];var m=this.getPath(n);var l,k;l=function l(){var o=this.getPath(n);var q=b.$("[data-handlebars-id='"+c+"']");if(q.length===0){this.removeObserver(n,k);return}var p=q.attr(j);if(o===NO&&p){q.removeAttr(j)}else{if(o===YES&&p!==j){q.attr(j,j)}else{if(p!==o){q.attr(j,o)}}}};k=function(){this.invokeOnce(l)};this.addObserver(n,k);if(m===YES){m=j}if(m!==NO){if(SC.typeOf(m)===SC.T_STRING){m=m.replace(/"/g,"&quot;")}d.push(j+'="'+m+'"')}},this);d.push('data-handlebars-id="'+c+'"');return new Handlebars.SafeString(d.join(" "))});SC.Handlebars.bindClasses=function(b,i,h,a){var g=[],f,j,c;var d=function(k){var l=b.getPath(k);if(l===YES){return SC.String.dasherize(k.split(".").get("lastObject"))}else{if(l!==NO&&l!==undefined&&l!==null){return l}else{return null}}};i.split(" ").forEach(function(n){var m;var l,k;l=function(){f=d(n);c=a?h.$("[data-handlebars-id='"+a+"']"):h.$();if(c.length===0){b.removeObserver(n,k)}else{if(m){c.removeClass(m)}if(f){c.addClass(f);m=f}else{m=null}}};k=function(){this.invokeOnce(l)};b.addObserver(n,k);j=d(n);if(j){g.push(j);m=j}});return g};sc_require("ext/handlebars");Handlebars.registerHelper("collection",function(l,m){var k=m.fn;var g=m.data;var d=m.inverse;var f=m.hash;var h,a;h=l?SC.getPath(this,l)||SC.getPath(l):SC.TemplateCollectionView;var j={};if(f){var c={},i;for(var b in f){if(f.hasOwnProperty(b)){i=b.match(/^item(.)(.*)$/);if(i){c[i[1].toLowerCase()+i[2]]=f[b];delete f[b]}}}j=SC.clone(f);j.itemViewOptions=c}if(k){j.itemViewTemplate=k}if(d){j.inverseTemplate=d}if(h.isClass){a=h.extend(j)}else{a=SC.mixin(h,j)}m.fn=function(){return""};return Handlebars.helpers.view.call(this,a,m)});Handlebars.registerHelper("each",function(b,a){a.hash.contentBinding=SC.Binding.from("*"+b,this).oneWay();a.hash.itemContextProperty="content";return Handlebars.helpers.collection.call(this,null,a)});sc_require("ext/handlebars");Handlebars.registerHelper("loc",function(a){return SC.String.loc(a)});sc_require("ext/handlebars");SC.Handlebars.ViewHelper=SC.Object.create({helper:function(m,n,o){var c=o.inverse;var f=o.data;var k=f.view;var j=o.fn;var d=o.hash;var b;if(n.isClass||n.isObject){b=n;if(!b){throw"Null or undefined object was passed to the #view helper. Did you mean to pass a property path string?"}}else{if(n.charAt(0)==="."){b=SC.objectForPropertyPath(n.slice(1),k)}else{b=SC.getPath(m,n);if(!b){b=SC.getPath(n)}}if(!b){throw"Unable to find view at path '"+n+"'"}}if(d.id){d.layerId=d.id}var l={id:d.id,"class":d["class"],classBinding:d.classBinding};delete d.id;delete d["class"];delete d.classBinding;if(b.isClass){b=b.extend(d)}else{SC.mixin(b,d)}var h=f.view;var i=h.get("childViews");var g=h.createChildView(b);if(j){g.template=j}i.pushObject(g);var a=SC.RenderContext(g.get("tagName"));this.applyAttributes(l,g,a);g.applyAttributesToContext(a);g.render(a,YES);return new Handlebars.SafeString(a.join())},applyAttributes:function(a,g,b){var f=a.id;var d=a["class"];if(d){b.addClass(d.split(" "))}if(f){g.set("layerId",f);b.id(f)}var c=a.classBinding;if(c){SC.Handlebars.bindClasses(g,c,g).forEach(function(h){b.setClass(h,YES)})}}});Handlebars.registerHelper("view",function(b,a){return SC.Handlebars.ViewHelper.helper(this,b,a)});sc_require("handlebars");sc_require("ext/handlebars");sc_require("ext/handlebars/bind");sc_require("ext/handlebars/collection");sc_require("ext/handlebars/localization");sc_require("ext/handlebars/view");SC.TEMPLATES=SC.Object.create();SC.TemplateView=SC.CoreView.extend({acceptsFirstResponder:YES,templateName:null,templates:SC.TEMPLATES,template:function(b,d){if(d!==undefined){return d}var a=this.get("templateName"),c=this.get("templates").get(a);if(!c){return function(){return""}}return c}.property("templateName").cacheable(),context:function(a,b){if(b!==undefined){return b}return this}.property().cacheable(),render:function(b){var f,a,c=this.get("template"),d=this.get("context");this._didRenderChildViews=YES;f={view:this,isRenderData:true};a=c(d,{data:f});b.push(a)},update:function(){},mouseDown:function(){if(this.mouseUp){return YES}return NO}});sc_require("views/template");SC.Button=SC.TemplateView.extend(SC.ActionSupport,{classNames:["sc-button"],mouseDown:function(){this.set("isActive",true);this._isMouseDown=YES},mouseExited:function(){this.set("isActive",false)},mouseEntered:function(){if(this._isMouseDown){this.set("isActive",true)}},rootResponder:function(){var a=this.get("pane");return a.get("rootResponder")}.property("pane").cacheable(),mouseUp:function(a){if(this.get("isActive")){this.fireAction();this.set("isActive",false)}this._isMouseDown=NO},touchStart:function(a){this.mouseDown(a)},touchEnd:function(a){this.mouseUp(a)}});sc_require("views/template");SC.Checkbox=SC.TemplateView.extend({title:null,value:null,displayTitle:function(){var a=this.get("title");return a?SC.String.loc(a):null}.property("title").cacheable(),classNames:["sc-checkbox"],template:SC.Handlebars.compile('<label><input type="checkbox">{{displayTitle}}</label>'),didCreateLayer:function(){var a=this;this.$("input").bind("change",function(){a.domValueDidChange(this)})},domValueDidChange:function(a){this.set("value",$(a).prop("checked"))},value:function(a,b){if(b!==undefined){this.$("input").prop("checked",b)}else{b=this.$("input").prop("checked")}return b}.property()});SC.CheckboxSupport={didCreateLayer:function(){this.$("input").change(jQuery.proxy(function(){SC.RunLoop.begin();this.notifyPropertyChange("value");SC.RunLoop.end()},this))},value:function(a,b){if(b!==undefined){this.$("input").prop("checked",b)}else{b=this.$("input").prop("checked")}return b}.property().idempotent()};sc_require("views/template");SC.TextFieldSupport={$input:function(){return this.$("input")},_value:null,value:function(b,c){var a=this.$input();if(c!==undefined){if(this._value!==c){this._value=c}if(a.val()!==c){a.val(c)}}else{if(a.length>0){c=this._value=a.val()}else{c=this._value}}return c}.property().idempotent(),didCreateLayer:function(){var b=this.$input(),a=this;b.val(this._value);if(SC.browser.isIE){SC.Event.add(b,"focusin",this,this.focusIn);SC.Event.add(b,"focusout",this,this.focusOut)}else{SC.Event.add(b,"focus",this,this.focusIn);SC.Event.add(b,"blur",this,this.focusOut)}},willDestroyLayerMixin:function(){var a=this.$input();if(SC.browser.isIE){SC.Event.remove(a,"focusin",this,this.focusIn);SC.Event.remove(a,"focusout",this,this.focusOut)}else{SC.Event.remove(a,"focus",this,this.focusIn);SC.Event.remove(a,"blur",this,this.focusOut)}},focusIn:function(a){this.becomeFirstResponder();this.tryToPerform("focus",a)},focusOut:function(a){this.resignFirstResponder();this.tryToPerform("blur",a)},touchStart:function(a){a.allowDefault();return YES},touchEnd:function(a){a.allowDefault();return YES},willLoseFirstResponder:function(){this.notifyPropertyChange("value")},domValueDidChange:function(a){this.set("value",a.val())},keyUp:function(a){this.domValueDidChange(this.$input());if(a.keyCode===SC.Event.KEY_RETURN){return this.tryToPerform("insertNewline",a)}else{if(a.keyCode===SC.Event.KEY_ESC){return this.tryToPerform("cancel",a)}}},selectStart:function(){return true}};SC.TextField=SC.TemplateView.extend(SC.TextFieldSupport,{classNames:["sc-text-field"],isMultiline:NO,template:function(){return SC.Handlebars.compile(this.get("isMultiline")?"<textarea></textarea>":'<input type="text">')}.property("isMultiline").cacheable(),$input:function(){var a=this.get("isMultiline")?"textarea":"input";return this.$(a)}});SC.TemplatePane=SC.Object.extend({});SC.TemplatePane.mixin({append:function(a){var b=SC.MainPane.extend({childViews:["contentView"],contentView:SC.TemplateView.design(a),touchStart:function(c){c.allowDefault()},touchesDragged:function(c,d){c.allowDefault()},touchEnd:function(c){c.allowDefault()}});b=b.create().append();b.awake();return b}});sc_require("views/template");SC._BindableSpan=SC.TemplateView.extend({tagName:"span",shouldDisplayFunc:null,preserveContext:NO,displayTemplate:null,inverseTemplate:null,property:null,render:function(d){var i=this.get("isEscaped");var a=this.get("shouldDisplayFunc"),g=this.get("property"),f=this.get("preserveContext"),b=this.get("previousContext");var c=this.get("inverseTemplate"),h=this.get("displayTemplate");var j;if(g===""){j=b}else{j=b.getPath(g)}if(a(j)){this.set("template",h);if(f){this.set("context",b)}else{if(h){this.set("context",j)}else{if(j==null){j=""}else{j=String(j)}if(i){j=Handlebars.Utils.escapeExpression(j)}d.push(j);return}}}else{if(c){this.set("template",c);if(f){this.set("context",b)}else{this.set("context",j)}}else{this.set("template",function(){return""})}}return arguments.callee.base.apply(this,arguments)},rerender:function(){var b,a,f,g;f=this.get("childViews");a=f.get("length");for(b=a-1;b>=0;b--){g=f[b];g.$().remove();g.removeFromParent();g.destroy()}var c=this.renderContext(this.get("tagName"));var d;this.renderToContext(c);d=c.element();this.$().replaceWith(d);this.set("layer",d);this._notifyDidCreateLayer()}});sc_require("views/template");SC.TemplateCollectionView=SC.TemplateView.extend({tagName:"ul",content:null,template:SC.Handlebars.compile(""),emptyView:null,init:function(){var a=arguments.callee.base.apply(this,arguments);this._sctcv_contentDidChange();return a},didCreateLayer:function(){if(this._sctcv_layerCreated){return}this._sctcv_layerCreated=true;var a=this.get("content");if(a){this.arrayContentDidChange(0,0,a.get("length"))}},itemView:"SC.TemplateView",itemViewTemplate:null,itemViewTemplateName:null,inverseTemplate:function(b,d){if(d!==undefined){return d}var a=this.get("inverseTemplateName"),c=this.get("templates").get(a);if(!c){return function(){return""}}return c}.property("inverseTemplateName").cacheable(),inverseTemplateName:null,itemContext:null,itemViewClass:function(){var c=this.get("itemView");var a=this.get("itemViewTemplate");var d=this.get("itemViewTemplateName");var b={};if(SC.typeOf(c)===SC.T_STRING){c=SC.objectForPropertyPath(c)}if(!a&&d){a=this.get("templates").get(d)}if(a){b.template=a}if(c.prototype.tagName===SC.TemplateView.prototype.tagName){b.tagName=this.get("itemTagName")}return c.extend(b)}.property("itemView").cacheable(),_sctcv_contentDidChange:function(){this.$().empty();var c=this._content,a=0;var d=this.get("content"),b=0;if(c){c.removeArrayObservers({target:this,willChange:"arrayContentWillChange",didChange:"arrayContentDidChange"});a=c.get("length")}if(d){d.addArrayObservers({target:this,willChange:"arrayContentWillChange",didChange:"arrayContentDidChange"});b=d.get("length")}this.arrayContentWillChange(0,a,b);this._content=this.get("content");this.arrayContentDidChange(0,a,b)}.observes("content"),arrayContentWillChange:function(i,d,g){var c=this.get("emptyView");if(c){c.$().remove();c.removeFromParent()}var f=this.get("childViews"),h,b,a;a=f.get("length");for(b=i+d-1;b>=i;b--){h=f[b];if(h){h.$().remove();h.removeFromParent();h.destroy()}}},arrayContentDidChange:function(f,m,u){if(!this.get("layer")){return}var n=this.get("content"),g=this.get("itemViewClass"),p=this.get("childViews"),a=[],s,t,i,q,h,r,l,k,o;if(n){var j=n.slice(f,f+u);i=this.get("itemViewOptions")||{};q=this.$();h=q.find("li")[f-1]||null;o=j.get("length");var d={id:i.id,"class":i["class"],classBinding:i.classBinding};s=function(v){arguments.callee.base.apply(this,arguments);SC.Handlebars.ViewHelper.applyAttributes(d,this,v)};i=SC.clone(i);delete i.id;delete i["class"];delete i.classBinding;for(k=0;k<o;k++){r=j.objectAt(k);t=this.createChildView(g.extend(i,{content:r,render:s,tagName:i.tagName||g.prototype.tagName}));var c=t.get("contextProperty");if(c){t.set("context",t.get(c))}l=t.createLayer().$();if(!h){q.append(l)}else{l.insertAfter(h)}h=l;a.push(t)}p.replace(f,0,a)}var b=this.get("inverseTemplate");if(p.get("length")===0&&b){t=this.createChildView(SC.TemplateView.extend({template:b,content:this}));this.set("emptyView",t);t.createLayer().$().appendTo(q);this.childViews=[t]}this.invokeLast("invalidateFrame")},itemTagName:function(){switch(this.get("tagName")){case"dl":return"dt";case"ul":case"ol":return"li";case"table":case"thead":case"tbody":case"tfoot":return"tr";case"select":return"option";default:return SC.TemplateView.prototype.tagName}}.property("tagName"),invalidateFrame:function(){this.notifyPropertyChange("frame")}});
/*!
 * ==========================================================================
 * SproutCore -- JavaScript Application Framework
 * Copyright 2008-2011 Apple Inc. All rights reserved.
 * Copyright 2006-2011, Strobe Inc. and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a 
 * copy of this software and associated documentation files (the "Software"), 
 * to deal in the Software without restriction, including without limitation 
 * the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 * and/or sell copies of the Software, and to permit persons to whom the 
 * Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in 
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
 * DEALINGS IN THE SOFTWARE.
 * 
 * SproutCore and the SproutCore logo are trademarks of Strobe Inc.
 * 
 * For more information about SproutCore, visit http://www.sproutcore.com
 * 
 * ==========================================================================
 */
SC.EmptyTheme=SC.BaseTheme.create({name:"sc-empty"});SC.Theme.addTheme(SC.EmptyTheme);SC.AceTheme=SC.BaseTheme.create({name:"ace",description:"A SproutCore built-in theme by Alex Iskander and contributors. Only supports browsers that implement CSS3."});SC.Theme.addTheme(SC.AceTheme);SC.AceTheme.PointLeft=SC.AceTheme.subtheme("point-left","point-left");SC.AceTheme.PointRight=SC.AceTheme.subtheme("point-right","point-right");SC.AceTheme.Capsule=SC.AceTheme.subtheme("capsule","capsule");SC.AceTheme.Dark=SC.AceTheme.subtheme("dark");SC.defaultTheme="ace";sc_require("theme");SC.AceTheme.Dark.PointLeft=SC.AceTheme.Dark.subtheme("point-left","point-left");SC.AceTheme.Dark.PointRight=SC.AceTheme.Dark.subtheme("point-right","point-right");SC.AceTheme.Dark.PointRight=SC.AceTheme.Dark.subtheme("capsule","capsule");SC.AceTheme.SourceList=SC.AceTheme.subtheme("source-list");sc_require("theme");SC.AceTheme.Popover=SC.AceTheme.Dark.subtheme("popover");SC.AceTheme.addTheme(SC.AceTheme.Popover);SC.AceTheme.SolidPopover=SC.AceTheme.Popover.subtheme("solid");SC.AceTheme.addTheme(SC.AceTheme.SolidPopover.create({name:"solid-popover"}));sc_require("resources/picker/popover/popover");SC.AceTheme.Popover.pickerRenderDelegate=SC.RenderDelegate.create({className:"picker",render:function(f,b){var a=f.get("preferType");var d=f.get("pointerPos");var c=f.get("pointerPosY");if(a==SC.PICKER_POINTER||a==SC.PICKER_MENU_POINTER){b.addClass(d)}},update:function(f,d){var a=f.get("preferType");var c=f.get("pointerPos");var b=f.get("pointerPosY");if(a==SC.PICKER_POINTER||a==SC.PICKER_MENU_POINTER){d.addClass(c)}}});SC.AceTheme.Popover.workspaceRenderDelegate=SC.RenderDelegate.create({className:"workspace",render:function(b,a){a.setClass({"top-toolbar":b.get("hasTopToolbar"),"bottom-toolbar":b.get("hasBottomToolbar")});a=a.begin("div").addClass("popover-background");this.includeSlices(b,a,SC.NINE_SLICE);a.push("<div class = 'sc-pointer'></div>");a=a.end()},update:function(b,a){a.setClass({"top-toolbar":b.get("hasTopToolbar"),"bottom-toolbar":b.get("hasBottomToolbar")})}});SC.SplitChild={isSplitDivider:NO,minimumSize:100,maximumSize:undefined,size:undefined,position:0,positionOffset:SC.propertyFromRenderDelegate("splitPositionOffset",0),sizeOffset:SC.propertyFromRenderDelegate("splitSizeOffset",0),canCollapse:NO,collapseAtSize:undefined,autoResizeStyle:undefined,compensatesForMovement:YES,allowsIndirectAdjustments:YES,_scsvc_positionOrSizeDidChange:function(){this.invokeOnce("splitChildLayoutDidChange")}.observes("position","size"),splitChildLayoutDidChange:function(){var c=this.get("splitView");if(!c){return}var a=this.get("position")+this.get("positionOffset"),b=this.get("size")+this.get("sizeOffset");if(c.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){this.set("layout",{left:a,width:b,top:0,bottom:0})}else{this.set("layout",{top:a,height:b,right:0,left:0})}},splitView:function(){var a=this.get("parentView");while(a&&!a.isSplitView){a=a.get("parentView")}return a}.property("parentView").cacheable(),splitViewLayoutDirection:null,splitViewLayoutDirectionBinding:SC.Binding.oneWay("*splitView.layoutDirection"),splitViewLayoutDirectionDidChange:function(){this.invokeOnce("splitChildLayoutDidChange")}.observes("splitViewLayoutDirection")};SC.MOVES_AUTOMATIC_CHILD="moves-automatic-child";SC.MOVES_CHILD="moves-child";SC.MOVES_PREVIOUS_CHILD="moves-previous-child";SC.MOVES_NEXT_CHILD="moves-next-child";SC.SplitThumb={movesChild:function(){var a=this,d,c=this.get("splitView"),b=this.get("movesSibling");while(a&&a!==c){d=a;a=a.get("parentView")}if(b===SC.MOVES_NEXT_CHILD){return d.nextView}if(b===SC.MOVES_PREVIOUS_CHILD){return d.previousView}if(b===SC.MOVES_AUTOMATIC_CHILD){if(!d.nextView){return d.previousView}if(!d.previousView){return d.nextView}}return d}.property("splitView","movesSibling").cacheable(),movesSibling:SC.MOVES_AUTOMATIC_CHILD,splitView:function(){var a=this;while(a&&!a.isSplitView){a=a.get("parentView")}return a}.property("parentView").cacheable(),splitViewLayoutDirection:null,splitViewLayoutDirectionBinding:SC.Binding.oneWay("*splitView.layoutDirection"),splitCursorStyle:function(){if(this.get("splitViewLayoutDirection")===SC.LAYOUT_HORIZONTAL){return"ew-resize"}else{return"ns-resize"}}.property("splitViewLayoutDirection").cacheable(),splitCursorStyleDidChange:function(){if(this._isDragging){this.get("splitView").set("splitChildCursorStyle",this.get("splitCursorStyle"))}this.$().css("cursor",this.get("splitCursorStyle"))}.observes("splitCursorStyle"),renderMixin:function(a){a.css("cursor",this.get("splitCursorStyle"))},touchStart:function(b){this._isDragging=YES;var a=this.get("splitView");a.beginLiveResize();this._scst_mouseStartPosition=a.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?b.pageX:b.pageY;this._scst_childStartPosition=a.getPositionForChild(this.get("movesChild"));return YES},touchesDragged:function(a){var b=this.get("splitView");var f=b.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?a.pageX:a.pageY;var c=f-this._scst_mouseStartPosition,d=this._scst_childStartPosition;b.adjustPositionForChild(this.get("movesChild"),d+c);return YES},touchEnd:function(f){this._isDragging=NO;var a=this.get("splitView");var d=a.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?f.pageX:f.pageY;var b=d-this._scst_mouseStartPosition,c=this._scst_childStartPosition;a.adjustPositionForChild(this.get("movesChild"),c+b);a.set("splitChildCursorStyle",null);a.endLiveResize();return YES},mouseDown:function(a){var b=this.get("splitView");b.set("splitChildCursorStyle",this.get("splitCursorStyle"));return this.touchStart(a)},mouseDragged:function(a){return this.touchesDragged(a)},mouseUp:function(a){this.get("splitView").set("splitChildCursorStyle",null);return this.touchEnd(a)}};SC.BaseTheme.splitRenderDelegate=SC.RenderDelegate.create({className:"split",render:function(b,a){a.addClass(b.get("layoutDirection"))},update:function(b,a){a.addClass(b.get("layoutDirection"))}});SC.BaseTheme.splitDividerRenderDelegate=SC.RenderDelegate.create({className:"split-divider",dividerSize:1,splitPositionOffset:-5,splitSizeOffset:10,render:function(b,a){this.addSizeClassName(b,a);a.push("<div class='line'></div>")},update:function(b,a){this.updateSizeClassName(b,a)}});sc_require("mixins/split_child");sc_require("mixins/split_thumb");SC.SplitDividerView=SC.View.extend(SC.SplitChild,SC.SplitThumb,{classNames:["sc-split-divider-view"],isSplitDivider:YES,autoResizeStyle:"sc-fixed-size",movesSibling:SC.MOVES_CHILD,size:SC.propertyFromRenderDelegate("dividerSize",10),renderDelegateName:"splitDividerRenderDelegate"});sc_require("views/split_divider");SC.FIXED_SIZE="sc-fixed-size";SC.RESIZE_MANUAL="sc-manual-size";SC.RESIZE_AUTOMATIC="sc-automatic-resize";SC.SplitView=SC.View.extend({classNames:["sc-split-view"],childViews:["topLeftView","bottomRightView"],isSplitView:YES,splitDividerView:SC.SplitDividerView,layoutDirection:SC.LAYOUT_HORIZONTAL,shouldResizeChildrenToFit:YES,splitChildCursorStyle:null,_scsv_splitChildCursorDidChange:function(){this.get("cursor").set("cursorStyle",this.get("splitChildCursorStyle"))}.observes("splitChildCursorStyle"),init:function(){this.cursor=SC.Cursor.create();arguments.callee.base.apply(this,arguments)},displayProperties:["layoutDirection"],renderDelegateName:"splitRenderDelegate",_frameSize:function(){if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){return this.get("frame").width}else{return this.get("frame").height}}.property("frame","layoutDirection").cacheable(),viewDidResize:function(a){this.scheduleTiling();a()}.enhance(),layoutDirectionDidChange:function(){this.scheduleTiling()}.observes("layoutDirection"),adjustPositionForChild:function(b,a){return this.invokeDelegateMethod(this.get("delegate"),"splitViewAdjustPositionForChild",this,b,a)},getPositionForChild:function(a){return this.invokeDelegateMethod(this.get("delegate"),"splitViewGetPositionForChild",this,a)},didAddChild:function(){if(this._scsv_settingUpChildViews){return}this._scsv_settingUpChildViews=YES;this.invokeOnce("_scsv_setupChildViews");this._scsv_settingUpChildViews=NO},didRemoveChild:function(){if(this._scsv_settingUpChildViews){return}this._scsv_settingUpChildViews=YES;this.invokeOnce("_scsv_setupChildViews");this._scsv_settingUpChildViews=NO},createChildViews:function(){arguments.callee.base.apply(this,arguments);if(this._scsv_settingUpChildViews){return}this._scsv_settingUpChildViews=YES;this.invokeOnce("_scsv_setupChildViews");this._scsv_settingUpChildViews=NO},_scsv_setupChildViews:function(){var l=this.get("delegate"),d=this.get("childViews").copy(),h=d.length,k,c,a,f,j=this._scsv_dividers||{},b={},g,i;for(k=0;k<h;k++){c=d[k];if(!c.get("autoResizeStyle")){if(c.get("size")!==undefined){c.set("autoResizeStyle",SC.RESIZE_MANUAL)}else{c.set("autoResizeStyle",SC.RESIZE_AUTOMATIC)}}var m=this.invokeDelegateMethod(l,"splitViewGetSizeForChild",this,c);m=this.invokeDelegateMethod(l,"splitViewConstrainSizeForChild",this,c,m);this.invokeDelegateMethod(l,"splitViewSetSizeForChild",this,c,m);c.previousView=a;c.nextView=undefined;c.viewIndex=k;if(a){a.nextView=c}if(f&&!c.isSplitDivider){i=SC.guidFor(f)+"-"+SC.guidFor(c);g=j[i];if(!g&&!a.isSplitDivider){g=this.invokeDelegateMethod(l,"splitViewDividerBetween",this,f,c)}if(g){g.isSplitDivider=YES;b[i]=g;if(j[i]){delete j[i]}else{this.insertBefore(g,c)}}}a=c;if(!c.isSplitDivider){f=c}}for(i in j){j[i].destroy()}this._scsv_dividers=b;this._scsv_tile()},needsTiling:YES,scheduleTiling:function(){this.set("needsTiling",YES);this.invokeOnce("_scsv_tile")},tileIfNeeded:function(){if(!this.get("needsTiling")){return}this._scsv_tile()},_scsv_tile:function(){var a=this.get("delegate");var c,b=this.get("_frameSize");c=this.invokeDelegateMethod(a,"splitViewLayoutChildren",this);if(this.get("shouldResizeChildrenToFit")&&c!==b){this.invokeDelegateMethod(a,"splitViewResizeChildrenToFit",this,c);c=this.invokeDelegateMethod(a,"splitViewLayoutChildren",this)}if(!this.get("shouldResizeChildrenToFit")){if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){this.adjust("width",c)}else{this.adjust("height",c)}}this.set("needsTiling",NO)},splitViewLayoutChildren:function(f){var c=this.get("delegate");var d=this.get("childViews"),b=d.length,a,h,g=0;for(a=0;a<b;a++){h=d[a];this.invokeDelegateMethod(c,"splitViewSetPositionForChild",this,d[a],g);g+=this.invokeDelegateMethod(c,"splitViewGetSizeForChild",this,d[a])}return g},splitViewResizeChildrenToFit:function(i,d){var m=this.get("delegate");var h=this.get("_frameSize");var f=this.get("childViews"),j=f.length,l,c,a=0,g=0,k;for(l=0;l<j;l++){c=f[l];k=this.invokeDelegateMethod(m,"splitViewGetSizeForChild",this,c);if(this.invokeDelegateMethod(m,"splitViewShouldResizeChildToFit",this,c)){a+=k}else{g+=k}}var b=d;b=this._resizeChildrenForSize(b,h,YES,a);b=this._resizeChildrenForSize(b,h,YES,-1);b=this._resizeChildrenForSize(b,h,NO,g);b=this._resizeChildrenForSize(b,h,NO,-1)},_resizeChildrenForSize:function(d,f,g,i){var m=this.get("delegate");var c=this.get("childViews"),k,h=c.length,b;var j=f-d;for(k=0;k<h;k++){b=c[k];var l=this.invokeDelegateMethod(m,"splitViewGetSizeForChild",this,b),n=l;var a=this.invokeDelegateMethod(m,"splitViewShouldResizeChildToFit",this,b);if(a===g){if(i===-1){n+=j}else{n+=(n/i)*j}n=Math.round(n);n=this.invokeDelegateMethod(m,"splitViewConstrainSizeForChild",this,b,n);this.invokeDelegateMethod(m,"splitViewSetSizeForChild",this,b,n);if(i!==-1){i-=l}}d-=l;d+=n;j=f-d}return d},splitViewShouldResizeChildToFit:function(a,b){return(this.get("shouldResizeChildrenToFit")&&b.get("autoResizeStyle")===SC.RESIZE_AUTOMATIC)},splitViewAdjustPositionForChild:function(d,g,a){var b=this.get("delegate");var f=this._scsv_createPlan();var c=this._scsv_adjustPositionForChildInPlan(f,g,a,g);this._scsv_commitPlan(f);return c},_scsv_createPlan:function(){var c=this.get("delegate"),h=[],g=this.get("childViews"),b,a=g.length,i,f,d;for(b=0;b<a;b++){i=g[b];f=this.invokeDelegateMethod(c,"splitViewGetPositionForChild",this,i);d=this.invokeDelegateMethod(c,"splitViewGetSizeForChild",this,i);h[b]={child:i,originalPosition:f,position:f,originalSize:d,size:d}}return h},_scsv_resetPlanRange:function(c,d,b){for(var a=d;a<=b;a++){c[a].position=c[a].originalPosition;c[a].size=c[a].originalSize}},_scsv_commitPlan:function(g){var d=this.get("delegate"),b=g.length,a,f,c=0;for(a=0;a<b;a++){f=g[a];if(f.size!==f.originalSize){this.invokeDelegateMethod(d,"splitViewSetSizeForChild",this,f.child,f.size)}if(f.position!==f.originalPosition){this.invokeDelegateMethod(d,"splitViewSetPositionForChild",this,f.child,f.position)}c=f.position+f.size}if(!this.get("shouldResizeChildrenToFit")){if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){this.adjust("width",c)}else{this.adjust("height",c)}}},_scsv_adjustPositionForChildInPlan:function(j,d,g,a){var k=this.get("delegate");if(!d.get("allowsIndirectAdjustments")&&a!==d&&a!==d.previousView){return j[d.viewIndex].position}if(d._splitViewIsAdjusting){return j[d.viewIndex].position}d._splitViewIsAdjusting=YES;var h=d.previousView,b=d.nextView,c,l,i,f,m=j[d.viewIndex].size;if(h&&!h._splitViewIsAdjusting){c=j[h.viewIndex].position;l=g-c;l=this._scsv_adjustSizeForChildInPlan(j,h,l,a);g=c+l}else{if(!h){g=0}}if(b&&b._splitViewIsAdjusting){d._splitViewIsAdjusting=NO;j[d.viewIndex].position=g;return g}if(d.get("compensatesForMovement")&&b){i=j[b.viewIndex].position;m=this._scsv_adjustSizeForChildInPlan(j,d,i-g)}else{if(!b&&this.get("shouldResizeChildrenToFit")){i=this.get("_frameSize");m=this._scsv_adjustSizeForChildInPlan(j,d,i-g);g=i-m}}if(b){i=g+m;i=this._scsv_adjustPositionForChildInPlan(j,b,i,a)}if(i&&g!==i-m){g=i-m;if(h&&!h._splitViewIsAdjusting){this._scsv_resetPlanRange(j,0,h.viewIndex);l=g-j[h.viewIndex].position;this._scsv_adjustSizeForChildInPlan(j,h,l,d)}}j[d.viewIndex].position=g;d._splitViewIsAdjusting=NO;return g},_scsv_adjustSizeForChildInPlan:function(g,b,j,a){var h=this.get("delegate");if(a&&!b.get("allowsIndirectAdjustments")&&a!==b&&a!==b.nextView&&a!==b.previousView){return g[b.viewIndex].size}var i=this.invokeDelegateMethod(h,"splitViewConstrainSizeForChild",this,b,j);g[b.viewIndex].size=i;if(j===i){return j}var c=g[b.viewIndex].position,d=c+j-i;var f=this._scsv_adjustPositionForChildInPlan(g,b,d,a);return f+i-c},splitViewDividerBetween:function(c,b,a){if(!this.get("splitDividerView")){return null}return this.get("splitDividerView").create()},splitViewGetPositionForChild:function(a,b){return b.get("position")},splitViewSetPositionForChild:function(b,c,a){c.set("position",a)},splitViewGetSizeForChild:function(b,c){var a=c.get("size");if(SC.none(a)){return 100}return a},splitViewSetSizeForChild:function(b,c,a){c.set("size",a)},splitViewConstrainSizeForChild:function(c,g,a){if(g.get("autoResizeStyle")===SC.FIXED_SIZE){return this.invokeDelegateMethod(this.get("delegate"),"splitViewGetSizeForChild",this,g)}if(g.get("canCollapse")){var b=g.get("collapseAtSize");if(b&&a<b){return 0}}var d=g.get("minimumSize")||0;if(d!==undefined&&d!==null){a=Math.max(d,a)}var f=g.get("maximumSize");if(f!==undefined&&f!==null){a=Math.min(f,a)}return a}});SC.ThumbView=SC.View.extend(SC.SplitThumb,{classNames:["sc-thumb-view"],init:function(){arguments.callee.base.apply(this,arguments);console.warn("SC.ThumbView is deprecated. Please use a normal view and mix in SC.SplitThumb instead.")}});if(!Object.keys){Object.keys=function(c){var a=[],b;for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){a.push(b)}}return a}}if(!Function.prototype.bind){Function.prototype.bind=function(b){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var a=Array.prototype.slice,g=a.call(arguments,1),f=this,c=function(){},d=function(){return f.apply(this instanceof c?this:b||window,g.concat(a.call(arguments)))};c.prototype=this.prototype;d.prototype=new c();return d}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}SC.Record.ignoreUnknownProperties=true;SC.RecordArray.QUERY_MATCHING_THRESHOLD=10000;DG=SC.Application.create((function(){var a=null;var f=false;var c="DG.MemoryDataSource",g=c;var k=function(l,o){l=l.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");o=o||"";var m="[\\?&]"+l+"=([^&]*)";var p=new RegExp(m);var n=p.exec(window.location.href);if(SC.none(n)){return o}else{return decodeURIComponent(n[1])}};var b=function(){var l=k("app");return !SC.empty(l)?l==="dg":window.location.href.indexOf("/dg")>=0};var i=function(){var l=k("app");return !SC.empty(l)?l==="is":window.location.href.indexOf("/is")>=0};var j=function(){var l=k("app");return !SC.empty(l)?l==="srri":window.location.href.indexOf("srri")>=0};var d=function(){return(window.location.href.indexOf("-dev.codap.concord.org")>=0)||(window.location.href.indexOf("localhost:4020")>=0)};var h=function(){return(window.location.href.indexOf("-test.")>=0)};f=k("fix");if(f){a=SC.Store.create().from(SC.Record.fixtures)}else{a=SC.Store.create({commitRecordsAutomatically:YES}).from(g)}a._originalCreateRecord=a.createRecord;a.createRecord=function(o,m,n){var l=this._originalCreateRecord(o,m,n);l.normalize();return l};return{NAMESPACE:"DG",APPNAME:"DG",VERSION:"1.1",BUILD_NUM:"0246",DRUPAL_SUBDOMAIN:"play",IS_DG_BUILD:b(),IS_INQUIRY_SPACE_BUILD:i(),IS_SRRI_BUILD:j(),getVariantString:function(m){var l=m;if(DG.IS_INQUIRY_SPACE_BUILD){l+=".IS_BUILD"}else{if(DG.IS_SRRI_BUILD){l+=".SRRI_BUILD"}}return l},getDrupalSubdomain:function(){var l=DG.DRUPAL_SUBDOMAIN;if(DG.IS_SRRI_BUILD){l+="-srri"}if(h()){l+="-test"}return l+"."},IS_DEV_BUILD:d(),appStore:a,store:null,urlParamGames:k("moreGames"),defaultGameName:k("game"),startingDocName:k("doc"),startingDocOwner:k("owner"),componentMode:k("componentMode","no"),toType:function(l){return({}).toString.call(l).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},copy:function(l){return SC.copy(l,NO)},clone:function(l){return SC.clone(l,YES)},iUser:k("username"),iPassword:k("password"),iSessionID:k("sessionid")}}()));DG.ArchiveUtils={_addLinkSpec:function(a,d,c){if(a&&!SC.empty(d)&&c){if(!a._links_){a._links_={}}var b=a._links_;if(b[d]){if(!SC.isArray(b[d])){b[d]=[b[d]]}b[d].push(c)}else{b[d]=c}}},addLinkID:function(a,c,b,d){var f={type:b,id:d};DG.ArchiveUtils._addLinkSpec(a,c,f)},addLink:function(b,c,a){var d=a&&a.toLink&&a.toLink();DG.ArchiveUtils._addLinkSpec(b,c,d)},getLinkCount:function(a,c){var b=a&&a._links_;if(!b){return 0}if(SC.empty(c)){return DG.ObjectMap.length(b)}var d=b[c];return SC.isArray(d)?d.length:(SC.empty(d)?0:1)},getLinkID:function(a,d,c){var b=a&&a._links_,g=b&&b[d],f=SC.isArray(g)?g[c||0]:g;return f&&f.id}};DG.Browser={init:function(){if((SC.browser.name===SC.BROWSER.firefox)&&(SC.browser.compare(SC.browser.version,"13")<0)){var b;b=function(c){var d=false;try{if((SC.$("embed",c).length>0)||(SC.$("object",c).length>0)){d=true}if(SC.$("iframe",c)>0){d=true}}catch(f){d=true}return d};var a=SC.PickerPane.prototype._hideOverflow;SC.PickerPane.prototype._hideOverflow=function(){if(!b(SC.$(document))){a.call(this,arguments)}}}},isCompatibleBrowser:function(){function a(f,c){var g=f.split("."),d=g.length,j=c.split(".");for(var h=0;h<d;++h){var b=Number(j[h])||0,k=Number(g[h]);if(b>k){return true}if(b<k){return false}}return true}if(DG.IS_DEV_BUILD){return true}switch(SC.browser.name){case SC.BROWSER.ie:return a("9.0",SC.browser.version);case SC.BROWSER.firefox:return a("3.6",SC.browser.version)||a("1.9.2",SC.browser.engineVersion);case SC.BROWSER.chrome:return a("10",SC.browser.version);case SC.BROWSER.safari:return a("4.0",SC.browser.version)||a("530.17",SC.browser.engineVersion)}return true},customCursorStr:function(a,d,c,b){b=b||"auto";return(SC.browser.name===SC.BROWSER.ie?"url("+a+"), "+b:"url("+a+") "+d+" "+c+", "+b)}};DG.Core={classFromClassName:function(b){var d=b.split("."),a,f=d.length,c=window;for(a=0;a<f;++a){c=c&&c[d[a]]}return c||null},isExtendingFromEvent:function(c){var a=(SC.browser.os===SC.OS.mac)||(SC.browser.os===SC.OS.ios),b=a&&c.metaKey&&!c.ctrlKey,d=!a&&c.ctrlKey;return c.shiftKey||b||d}};DG.LOGGER_LEVEL_USER="user";DG.debugForceReload=function(){window.location.reload()};DG.debugLaunchDebugger=function(){eval("debugger")};SC.Logger.logOutputLevel=SC.LOGGER_LEVEL_WARN;DG.Debug=SC.Object.create((function(){return{logServerLevel:SC.LOGGER_LEVEL_INFO,_prevHandleLogMessage:null,_prevExceptionHandler:null,_debugStartTime:0,init:function(){this._debugStartTime=Date.now();this._prevHandleLogMessage=SC.Logger._handleMessage;SC.Logger._handleMessage=this._prevHandleLogMessage;this._prevExceptionHandler=SC.ExceptionHandler.handleException;SC.ExceptionHandler.handleException=this._prevExceptionHandler},logIfNotFinite:function(a,b){if(!isFinite(a)){this.logWarn("DG.Debug.logIfNotFinite: String: %@, Value: %@",b,a)}},logDebug:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_DEBUG,YES,a,arguments)},logDebugRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_DEBUG,NO,null,arguments)},logDebugTimer:function(c,b,d){var a=Date.now();if(c){DG.Debug._debugStartTime=a;a=0}else{a-=DG.Debug._debugStartTime}DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_DEBUG,YES,"[TIME="+(a/1000)+"] "+b,arguments)},logDebugGroupBegin:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_DEBUG,a,arguments)},logDebugGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_DEBUG)},logInfo:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_INFO,YES,a,arguments)},logInfoRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_INFO,NO,null,arguments)},logUser:function(a,b){DG.Debug._handleLogMessage(DG.LOGGER_LEVEL_USER,YES,a,arguments)},logUserRaw:function(a){DG.Debug._handleLogMessage(DG.LOGGER_LEVEL_USER,NO,null,arguments)},logWarn:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_WARN,YES,a,arguments)},logWarnRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_WARN,NO,null,arguments)},logError:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_ERROR,YES,a,arguments)},logErrorRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_ERROR,NO,null,arguments)},assert:function(d,f,b){if(!d){var c=true,a=true;DG.Debug.logErrorRaw("Assertion Failed: "+f+": "+b);if(a){}if(c){SC.AlertPane.error({message:f||"",description:b||"",buttons:[{title:"Reload",action:DG.debugForceReload},{title:"Ignore"}]})}}return d},check:function(a,c,b){return this.assert(!SC.none(a),c,b)},_shouldLogTypeToServer:function(a){var c=SC.Logger._LOG_LEVEL_MAPPING,d=c[a]||0,b=c[this.get("logServerLevel")]||0;return(d<=b)},_handleLogMessage:function(b,a,g,c){var h=(b===DG.LOGGER_LEVEL_USER?SC.LOGGER_LEVEL_INFO:b);this._prevHandleLogMessage.call(SC.Logger,h,a,g,c);if(DG.Debug._shouldLogTypeToServer(h)){var f=(c&&(c.length>0))?c[c.length-1]:undefined,d=typeof f==="object"?f:{};DG.logToServer(DG.Debug._currentMessage,{type:b},d)}},_handleException:function(a){var b=!SC.none(this._prevExceptionHandler);DG.Debug.logErrorRaw("Exception: "+a.message);if(b){this._prevExceptionHandler.call(SC.ExceptionHandler,a)}}}}()));DG.Debug._prevShouldOutputType=SC.Logger._shouldOutputType;SC.Logger._shouldOutputType=function(a){return true};DG.Debug._prevOutputMessage=SC.Logger._outputMessage;SC.Logger._outputMessage=function(b,d,a,c,f){DG.Debug._currentMessage=c;if(DG.Debug._prevShouldOutputType.call(SC.Logger,b)){DG.Debug._prevOutputMessage.call(SC.Logger,b,d,a,c,f)}};DG.Debug.scObjectID=function(a){var c,b="";DG.ObjectMap.findKey(a,function(d,f){if(d.substr(0,10)==="SproutCore"){c=d;b=f;return true}return false});return !SC.empty(b)?b:"{none}"};DG.log=DG.Debug.logDebug;DG.logRaw=DG.Debug.logDebugRaw;DG.logTimer=DG.Debug.logDebugTimer;DG.logGroupBegin=DG.Debug.logDebugGroupBegin;DG.logGroupEnd=DG.Debug.logDebugGroupEnd;DG.logInfo=DG.Debug.logInfo;DG.logInfoRaw=DG.Debug.logInfoRaw;DG.logUser=DG.Debug.logUser;DG.logUserRaw=DG.Debug.logUserRaw;DG.logWarn=DG.Debug.logWarn;DG.logWarnRaw=DG.Debug.logWarnRaw;DG.logError=DG.Debug.logError;DG.logErrorRaw=DG.Debug.logErrorRaw;DG.assert=DG.Debug.assert;DG.check=DG.Debug.check;DG.Destroyable={concatenatedProperties:["autoDestroyProperties"],destroyMixin:function(){var a=this.get("autoDestroyProperties");if(a){a.forEach(function(b){this.destroyProperty(b)}.bind(this))}},destroyProperty:function destroyProperty(b){var a=this.get(b);if(DG.Destroyable.destroyObject(a)){if(b.charAt(0)==="_"){this[b]=null}else{this.set(b,null)}}}};DG.Destroyable.destroyObject=function(a){if(a&&(a instanceof SC.Object)){if(a.willDestroy){a.willDestroy()}a.destroy();return true}return false};if(!Array.prototype.map){Array.prototype.map=function(c,d){var g=this.length;var a=new Array(g);for(var b=0;b<g;b++){if(b in this){a[b]=c.call(d,this[b],b,this)}}return a}}if(!Array.prototype.filter){Array.prototype.filter=function(d,g){var h=this.length;var a=new Array();for(var c=0;c<h;c++){if(c in this){var b=this[c];if(d.call(g,b,c,this)){a.push(b)}}}return a}}if(!Array.prototype.forEach){Array.prototype.forEach=function(b,c){var d=this.length>>>0;for(var a=0;a<d;a++){if(a in this){b.call(c,this[a],a,this)}}}}if(!Array.prototype.reduce){Array.prototype.reduce=function(d,b){var a=this.length;if(!a&&(arguments.length==1)){throw new Error("reduce: empty array, no initial value")}var c=0;if(arguments.length<2){while(true){if(c in this){b=this[c++];break}if(++c>=a){throw new Error("reduce: no values, no initial value")}}}for(;c<a;c++){if(c in this){b=d(b,this[c],c,this)}}return b}}var pv={};pv.version={major:3,minor:3};pv.identity=function(a){return a};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};pv.parent=function(){return this.parent.index};pv.extend=function(b){function a(){}a.prototype=b.prototype||b;return new a()};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(a){var n=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),f,k,h=0,o="";while(f=n.exec(a)){var g=f.index+f[0].length;if(a.charAt(g)!="{"){o+=a.substring(h,g)+"{return ";h=g;for(var b=0;b>=0&&g<a.length;g++){var l=a.charAt(g);switch(l){case'"':case"'":while(++g<a.length&&(k=a.charAt(g))!=l){if(k=="\\"){g++}}break;case"[":case"(":b++;break;case"]":case")":b--;break;case";":case",":if(b==0){b--}break}}o+=pv.parse(a.substring(h,--g))+";}";h=g}n.lastIndex=g}o+=a.substring(h);return o}}pv.css=function(b,a){return window.getComputedStyle?window.getComputedStyle(b,null).getPropertyValue(a):b.currentStyle[a]};pv.error=function(a){(typeof console=="undefined")?alert(a):console.error(a)};pv.listen=function(c,a,b){b=pv.listener(b);return c.addEventListener?c.addEventListener(a,b,false):c.attachEvent("on"+a,b)};pv.listener=function(a){return a.$listener||(a.$listener=function(b){try{pv.event=b;return a.call(this,b)}finally{delete pv.event}})};pv.ancestor=function(b,c){while(c){if(c==b){return true}c=c.parentNode}return false};pv.id=function(){var a=1;return function(){return a++}}();pv.functor=function(a){return typeof a=="function"?a:function(){return a}};pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};for(;pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis"){try{window.eval(pv.parse(pv.$.s.text))}catch(e){pv.error(e)}}}delete pv.$});pv.Format={};pv.Format.re=function(a){return a.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(f,d,b){var a=d-String(b).length;return(a<1)?b:new Array(a+1).join(f)+b};pv.Format.date=function(a){var c=pv.Format.pad;function b(f){return a.replace(/%[a-zA-Z0-9]/g,function(i){switch(i){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][f.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][f.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][f.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][f.getMonth()];case"%c":return f.toLocaleString();case"%C":return c("0",2,Math.floor(f.getFullYear()/100)%100);case"%d":return c("0",2,f.getDate());case"%x":case"%D":return c("0",2,f.getMonth()+1)+"/"+c("0",2,f.getDate())+"/"+c("0",2,f.getFullYear()%100);case"%e":return c(" ",2,f.getDate());case"%H":return c("0",2,f.getHours());case"%I":var g=f.getHours()%12;return g?c("0",2,g):12;case"%m":return c("0",2,f.getMonth()+1);case"%M":return c("0",2,f.getMinutes());case"%n":return"\n";case"%p":return f.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var g=f.getHours()%12;return(g?c("0",2,g):12)+":"+c("0",2,f.getMinutes())+":"+c("0",2,f.getSeconds())+" "+(f.getHours()<12?"AM":"PM");case"%R":return c("0",2,f.getHours())+":"+c("0",2,f.getMinutes());case"%S":return c("0",2,f.getSeconds());case"%Q":return c("0",3,f.getMilliseconds());case"%t":return"\t";case"%u":var d=f.getDay();return d?d:1;case"%w":return f.getDay();case"%y":return c("0",2,f.getFullYear()%100);case"%Y":return f.getFullYear();case"%%":return"%"}return i})}b.format=b;b.parse=function(n){var l=1970,k=0,f=1,h=0,g=0,d=0;var j=[function(){}];var m=pv.Format.re(a).replace(/%[a-zA-Z0-9]/g,function(o){switch(o){case"%b":j.push(function(p){k={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[p]});return"([A-Za-z]+)";case"%h":case"%B":j.push(function(p){k={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[p]});return"([A-Za-z]+)";case"%e":case"%d":j.push(function(p){f=p});return"([0-9]+)";case"%I":case"%H":j.push(function(p){h=p});return"([0-9]+)";case"%m":j.push(function(p){k=p-1});return"([0-9]+)";case"%M":j.push(function(p){g=p});return"([0-9]+)";case"%p":j.push(function(p){if(h==12){if(p=="am"){h=0}}else{if(p=="pm"){h=Number(h)+12}}});return"(am|pm)";case"%S":j.push(function(p){d=p});return"([0-9]+)";case"%y":j.push(function(p){p=Number(p);l=p+(((0<=p)&&(p<69))?2000:(((p>=69)&&(p<100)?1900:0)))});return"([0-9]+)";case"%Y":j.push(function(p){l=p});return"([0-9]+)";case"%%":j.push(function(){});return"%"}return o});var i=n.match(m);if(i){i.forEach(function(o,p){j[p](o)})}return new Date(l,k,f,h,g,d)};return b};pv.Format.time=function(a){var c=pv.Format.pad;function b(g){g=Number(g);switch(a){case"short":if(g>=31536000000){return(g/31536000000).toFixed(1)+" years"}else{if(g>=604800000){return(g/604800000).toFixed(1)+" weeks"}else{if(g>=86400000){return(g/86400000).toFixed(1)+" days"}else{if(g>=3600000){return(g/3600000).toFixed(1)+" hours"}else{if(g>=60000){return(g/60000).toFixed(1)+" minutes"}}}}}return(g/1000).toFixed(1)+" seconds";case"long":var f=[],j=((g%60000)/1000)>>0,d=((g%3600000)/60000)>>0;f.push(c("0",2,j));if(g>=3600000){var i=((g%86400000)/3600000)>>0;f.push(c("0",2,d));if(g>=86400000){f.push(c("0",2,i));f.push(Math.floor(g/86400000).toFixed())}else{f.push(i.toFixed())}}else{f.push(d.toFixed())}return f.reverse().join(":")}}b.format=b;b.parse=function(j){switch(a){case"short":var i=/([0-9,.]+)\s*([a-z]+)/g,d,h=0;while(d=i.exec(j)){var k=parseFloat(d[0].replace(",","")),g=0;switch(d[2].toLowerCase()){case"year":case"years":g=31536000000;break;case"week":case"weeks":g=604800000;break;case"day":case"days":g=86400000;break;case"hour":case"hours":g=3600000;break;case"minute":case"minutes":g=60000;break;case"second":case"seconds":g=1000;break}h+=k*g}return h;case"long":var d=j.replace(",","").split(":").reverse(),h=0;if(d.length){h+=parseFloat(d[0])*1000}if(d.length>1){h+=parseFloat(d[1])*60000}if(d.length>2){h+=parseFloat(d[2])*3600000}if(d.length>3){h+=parseFloat(d[3])*86400000}return h}};return b};pv.Format.number=function(){var h=0,c=Infinity,a=0,k=0,f=0,b=1,g="0",j="0",i=true,d=".",o=",",n="\u2212",l="";function m(p){if(Infinity>f){p=Math.round(p*b)/b}var r=String(Math.abs(p)).split(".");var q=r[0];if(q.length>c){q=q.substring(q.length-c)}if(i&&(q.length<h)){q=new Array(h-q.length+1).join(g)+q}if(q.length>3){q=q.replace(/\B(?=(?:\d{3})+(?!\d))/g,o)}if(!i&&(q.length<a)){q=new Array(a-q.length+1).join(g)+q}r[0]=p<0?n+q+l:q;var t=r[1]||"";if(t.length<k){r[1]=t+new Array(k-t.length+1).join(j)}return r.join(d)}m.format=m;m.parse=function(p){var t=pv.Format.re;var r=String(p).replace(new RegExp("^("+t(g)+")*"),"").replace(new RegExp("("+t(j)+")*$"),"").split(d);var q=r[0].replace(new RegExp(t(o),"g"),"");if(q.length>c){q=q.substring(q.length-c)}var u=r[1]?Number("0."+r[1]):0;if(Infinity>f){u=Math.round(u*b)/b}return Math.round(q)+u};m.integerDigits=function(q,p){if(arguments.length){h=Number(q);c=(arguments.length>1)?Number(p):h;a=h+Math.floor(h/3)*o.length;return this}return[h,c]};m.fractionDigits=function(q,p){if(arguments.length){k=Number(q);f=(arguments.length>1)?Number(p):k;b=Math.pow(10,f);return this}return[k,f]};m.integerPad=function(p){if(arguments.length){g=String(p);i=/\d/.test(g);return this}return g};m.fractionPad=function(p){if(arguments.length){j=String(p);return this}return j};m.decimal=function(p){if(arguments.length){d=String(p);return this}return d};m.group=function(p){if(arguments.length){o=p?String(p):"";a=h+Math.floor(h/3)*o.length;return this}return o};m.negativeAffix=function(p,q){if(arguments.length){n=String(p||"");l=String(q||"");return this}return[n,l]};return m};pv.map=function(c,a){var b={};return a?c.map(function(g,f){b.index=f;return a.call(b,g)}):c.slice()};pv.repeat=function(b,a){if(arguments.length==1){a=2}return pv.blend(pv.range(a).map(function(){return b}))};pv.cross=function(g,f){var o=[];for(var k=0,l=g.length,d=f.length;k<l;k++){for(var h=0,c=g[k];h<d;h++){o.push([c,f[h]])}}return o};pv.blend=function(a){return Array.prototype.concat.apply([],a)};pv.transpose=function(f){var g=f.length,a=pv.max(f,function(h){return h.length});if(a>g){f.length=a;for(var d=g;d<a;d++){f[d]=new Array(g)}for(var d=0;d<g;d++){for(var b=d+1;b<a;b++){var c=f[d][b];f[d][b]=f[b][d];f[b][d]=c}}}else{for(var d=0;d<a;d++){f[d].length=g}for(var d=0;d<g;d++){for(var b=0;b<d;b++){var c=f[d][b];f[d][b]=f[b][d];f[b][d]=c}}}f.length=a;for(var d=0;d<a;d++){f[d].length=g}return f};pv.normalize=function(g,d){var b=pv.map(g,d),c=pv.sum(b);for(var a=0;a<b.length;a++){b[a]/=c}return b};pv.permute=function(g,a,b){if(!b){b=pv.identity}var c=new Array(a.length),d={};a.forEach(function(f,h){d.index=f;c[h]=b.call(d,g[f])});return c};pv.numerate=function(a,b){if(!b){b=pv.identity}var c={},d={};a.forEach(function(f,g){d.index=g;c[b.call(d,f)]=g});return c};pv.uniq=function(h,b){if(!b){b=pv.identity}var c={},a=[],d={},g;h.forEach(function(f,j){d.index=j;g=b.call(d,f);if(!(g in c)){c[g]=a.push(g)}});return a};pv.naturalOrder=function(d,c){return(d<c)?-1:((d>c)?1:0)};pv.reverseOrder=function(c,d){return(d<c)?-1:((d>c)?1:0)};pv.search=function(i,h,g){if(!g){g=pv.identity}var a=0,d=i.length-1;while(a<=d){var b=(a+d)>>1,c=g(i[b]);if(c<h){a=b+1}else{if(c>h){d=b-1}else{return b}}}return -a-1};pv.search.index=function(d,c,b){var a=pv.search(d,c,b);return(a<0)?(-a-1):a};pv.range=function(g,c,d){if(arguments.length==1){c=g;g=0}if(d==undefined){d=1}if((c-g)/d==Infinity){throw new Error("range must be finite")}var f=[],b=0,a;c-=(c-g)*1e-10;if(d<0){while((a=g+d*b++)>c){f.push(a)}}else{while((a=g+d*b++)<c){f.push(a)}}return f};pv.random=function(c,a,b){if(arguments.length==1){a=c;c=0}if(b==undefined){b=1}return b?(Math.floor(Math.random()*(a-c)/b)*b+c):(Math.random()*(a-c)+c)};pv.sum=function(c,a){var b={};return c.reduce(a?function(g,h,f){b.index=f;return g+a.call(b,h)}:function(f,g){return f+g},0)};pv.max=function(b,a){if(a==pv.index){return b.length-1}return Math.max.apply(null,a?pv.map(b,a):b)};pv.max.index=function(j,d){if(!j.length){return -1}if(d==pv.index){return j.length-1}if(!d){d=pv.identity}var b=0,h=-Infinity,g={};for(var c=0;c<j.length;c++){g.index=c;var a=d.call(g,j[c]);if(a>h){h=a;b=c}}return b};pv.min=function(b,a){if(a==pv.index){return 0}return Math.min.apply(null,a?pv.map(b,a):b)};pv.min.index=function(j,g){if(!j.length){return -1}if(g==pv.index){return 0}if(!g){g=pv.identity}var d=0,b=Infinity,h={};for(var c=0;c<j.length;c++){h.index=c;var a=g.call(h,j[c]);if(a<b){b=a;d=c}}return d};pv.mean=function(b,a){return pv.sum(b,a)/b.length};pv.median=function(c,b){if(b==pv.index){return(c.length-1)/2}c=pv.map(c,b).sort(pv.naturalOrder);if(c.length%2){return c[Math.floor(c.length/2)]}var a=c.length/2;return(c[a-1]+c[a])/2};pv.variance=function(k,g){if(k.length<1){return NaN}if(k.length==1){return 0}var a=pv.mean(k,g),c=0,j={};if(!g){g=pv.identity}for(var b=0;b<k.length;b++){j.index=b;var h=g.call(j,k[b])-a;c+=h*h}return c};pv.deviation=function(b,a){return Math.sqrt(pv.variance(b,a)/(b.length-1))};pv.log=function(c,a){return Math.log(c)/Math.log(a)};pv.logSymmetric=function(c,a){return(c==0)?0:((c<0)?-pv.log(-c,a):pv.log(c,a))};pv.logAdjusted=function(c,a){if(!isFinite(c)){return c}var d=c<0;if(c<a){c+=(a-c)/a}return d?-pv.log(c,a):pv.log(c,a)};pv.logFloor=function(c,a){return(c>0)?Math.pow(a,Math.floor(pv.log(c,a))):-Math.pow(a,-Math.floor(-pv.log(-c,a)))};pv.logCeil=function(c,a){return(c>0)?Math.pow(a,Math.ceil(pv.log(c,a))):-Math.pow(a,-Math.ceil(-pv.log(-c,a)))};(function(){var a=Math.PI/180,b=180/Math.PI;pv.radians=function(c){return a*c};pv.degrees=function(c){return b*c}})();pv.keys=function(b){var c=[];for(var a in b){c.push(a)}return c};pv.entries=function(b){var c=[];for(var a in b){c.push({key:a,value:b[a]})}return c};pv.values=function(b){var c=[];for(var a in b){c.push(b[a])}return c};pv.dict=function(d,g){var a={},h={};for(var c=0;c<d.length;c++){if(c in d){var b=d[c];h.index=c;a[b]=g.call(h,b)}}return a};pv.dom=function(a){return new pv.Dom(a)};pv.Dom=function(a){this.$map=a};pv.Dom.prototype.$leaf=function(a){return typeof a!="object"};pv.Dom.prototype.leaf=function(a){if(arguments.length){this.$leaf=a;return this}return this.$leaf};pv.Dom.prototype.root=function(d){var b=this.$leaf,a=c(this.$map);function c(h){var i=new pv.Dom.Node();for(var g=0;g<h.length;g++){var f=h[g];i.appendChild(b(f)?new pv.Dom.Node(f):c(f)).nodeName=g}return i}a.nodeName=d;return a};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(a){this.nodeValue=a;this.childNodes=[]};pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype.removeChild=function(b){var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}this.childNodes.splice(a,1);if(b.previousSibling){b.previousSibling.nextSibling=b.nextSibling}else{this.firstChild=b.nextSibling}if(b.nextSibling){b.nextSibling.previousSibling=b.previousSibling}else{this.lastChild=b.previousSibling}delete b.nextSibling;delete b.previousSibling;delete b.parentNode;return b};pv.Dom.Node.prototype.appendChild=function(a){if(a.parentNode){a.parentNode.removeChild(a)}a.parentNode=this;a.previousSibling=this.lastChild;if(this.lastChild){this.lastChild.nextSibling=a}else{this.firstChild=a}this.lastChild=a;this.childNodes.push(a);return a};pv.Dom.Node.prototype.insertBefore=function(c,b){if(!b){return this.appendChild(c)}var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}if(c.parentNode){c.parentNode.removeChild(c)}c.parentNode=this;c.nextSibling=b;c.previousSibling=b.previousSibling;if(b.previousSibling){b.previousSibling.nextSibling=c}else{if(b==this.lastChild){this.lastChild=c}this.firstChild=c}this.childNodes.splice(a,0,c);return c};pv.Dom.Node.prototype.replaceChild=function(c,b){var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}if(c.parentNode){c.parentNode.removeChild(c)}c.parentNode=this;c.nextSibling=b.nextSibling;c.previousSibling=b.previousSibling;if(b.previousSibling){b.previousSibling.nextSibling=c}else{this.firstChild=c}if(b.nextSibling){b.nextSibling.previousSibling=c}else{this.lastChild=c}this.childNodes[a]=c;return b};pv.Dom.Node.prototype.visitBefore=function(b){function a(g,d){b(g,d);for(var f=g.firstChild;f;f=f.nextSibling){a(f,d+1)}}a(this,0)};pv.Dom.Node.prototype.visitAfter=function(b){function a(g,d){for(var f=g.firstChild;f;f=f.nextSibling){a(f,d+1)}b(g,d)}a(this,0)};pv.Dom.Node.prototype.sort=function(b){if(this.firstChild){this.childNodes.sort(b);var d=this.firstChild=this.childNodes[0],g;delete d.previousSibling;for(var a=1;a<this.childNodes.length;a++){d.sort(b);g=this.childNodes[a];g.previousSibling=d;d=d.nextSibling=g}this.lastChild=d;delete d.nextSibling;d.sort(b)}return this};pv.Dom.Node.prototype.reverse=function(){var a=[];this.visitAfter(function(d){while(d.lastChild){a.push(d.removeChild(d.lastChild))}for(var b;b=a.pop();){d.insertBefore(b,d.firstChild)}});return this};pv.Dom.Node.prototype.nodes=function(){var b=[];function a(c){b.push(c);c.childNodes.forEach(a)}a(this,b);return b};pv.Dom.Node.prototype.toggle=function(a){if(a){return this.toggled?this.visitBefore(function(c){if(c.toggled){c.toggle()}}):this.visitAfter(function(c){if(!c.toggled){c.toggle()}})}var d=this;if(d.toggled){for(var b;b=d.toggled.pop();){d.appendChild(b)}delete d.toggled}else{if(d.lastChild){d.toggled=[];while(d.lastChild){d.toggled.push(d.removeChild(d.lastChild))}}}};pv.nodes=function(b){var a=new pv.Dom.Node();for(var c=0;c<b.length;c++){a.appendChild(new pv.Dom.Node(b[c]))}return a.nodes()};pv.tree=function(a){return new pv.Tree(a)};pv.Tree=function(a){this.array=a};pv.Tree.prototype.keys=function(a){this.k=a;return this};pv.Tree.prototype.value=function(a){this.v=a;return this};pv.Tree.prototype.map=function(){var g={},h={};for(var b=0;b<this.array.length;b++){h.index=b;var f=this.array[b],d=this.k.call(h,f),c=g;for(var a=0;a<d.length-1;a++){c=c[d[a]]||(c[d[a]]={})}c[d[a]]=this.v?this.v.call(h,f):f}return g};pv.nest=function(a){return new pv.Nest(a)};pv.Nest=function(a){this.array=a;this.keys=[]};pv.Nest.prototype.key=function(a){this.keys.push(a);return this};pv.Nest.prototype.sortKeys=function(a){this.keys[this.keys.length-1].order=a||pv.naturalOrder;return this};pv.Nest.prototype.sortValues=function(a){this.order=a||pv.naturalOrder;return this};pv.Nest.prototype.map=function(){var n={},g=[];for(var l,h=0;h<this.array.length;h++){var c=this.array[h];var b=n;for(l=0;l<this.keys.length-1;l++){var f=this.keys[l](c);if(!b[f]){b[f]={}}b=b[f]}f=this.keys[l](c);if(!b[f]){var d=[];g.push(d);b[f]=d}b[f].push(c)}if(this.order){for(var l=0;l<g.length;l++){g[l].sort(this.order)}}return n};pv.Nest.prototype.entries=function(){function a(f){var g=[];for(var d in f){var c=f[d];g.push({key:d,values:(c instanceof Array)?c:a(c)})}return g}function b(g,d){var f=this.keys[d].order;if(f){g.sort(function(i,h){return f(i.key,h.key)})}if(++d<this.keys.length){for(var c=0;c<g.length;c++){b.call(this,g[c].values,d)}}return g}return b.call(this,a(this.map()),0)};pv.Nest.prototype.rollup=function(b){function a(f){for(var c in f){var d=f[c];if(d instanceof Array){f[c]=b(d)}else{a(d)}}return f}return a(this.map())};pv.flatten=function(a){return new pv.Flatten(a)};pv.Flatten=function(a){this.map=a;this.keys=[]};pv.Flatten.prototype.key=function(a,b){this.keys.push({name:a,value:b});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(a){this.keys.length=0;this.$leaf=a;return this};pv.Flatten.prototype.array=function(){var b=[],a=[],g=this.keys,c=this.$leaf;if(c){function f(k,j){if(c(k)){b.push({keys:a.slice(),value:k})}else{for(var h in k){a.push(h);f(k[h],j+1);a.pop()}}}f(this.map,0);return b}function d(k,j){if(j<g.length-1){for(var h in k){a.push(h);d(k[h],j+1);a.pop()}}else{b.push(a.concat(k))}}d(this.map,0);return b.map(function(j){var h={};for(var o=0;o<g.length;o++){var n=g[o],l=j[o];h[n.name]=n.value?n.value.call(null,l):l}return h})};pv.vector=function(a,b){return new pv.Vector(a,b)};pv.Vector=function(a,b){this.x=a;this.y=b};pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x)};pv.Vector.prototype.norm=function(){var a=this.length();return this.times(a?(1/a):1)};pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};pv.Vector.prototype.times=function(a){return new pv.Vector(this.x*a,this.y*a)};pv.Vector.prototype.plus=function(a,b){return(arguments.length==1)?new pv.Vector(this.x+a.x,this.y+a.y):new pv.Vector(this.x+a,this.y+b)};pv.Vector.prototype.minus=function(a,b){return(arguments.length==1)?new pv.Vector(this.x-a.x,this.y-a.y):new pv.Vector(this.x-a,this.y-b)};pv.Vector.prototype.dot=function(a,b){return(arguments.length==1)?this.x*a.x+this.y*a.y:this.x*a+this.y*b};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform();pv.Transform.prototype.translate=function(a,c){var b=new pv.Transform();b.k=this.k;b.x=this.k*a+this.x;b.y=this.k*c+this.y;return b};pv.Transform.prototype.scale=function(b){var a=new pv.Transform();a.k=this.k*b;a.x=this.x;a.y=this.y;return a};pv.Transform.prototype.invert=function(){var b=new pv.Transform(),a=1/this.k;b.k=a;b.x=-this.x*a;b.y=-this.y*a;return b};pv.Transform.prototype.times=function(a){var b=new pv.Transform();b.k=this.k*a.k;b.x=this.k*a.x+this.x;b.y=this.k*a.y+this.y;return b};pv.Scale=function(){};pv.Scale.interpolator=function(b,a){if(typeof b=="number"){return function(c){return c*(a-b)+b}}b=pv.color(b).rgb();a=pv.color(a).rgb();return function(d){var c=b.a*(1-d)+a.a*d;if(c<0.00001){c=0}return(b.a==0)?pv.rgb(a.r,a.g,a.b,c):((a.a==0)?pv.rgb(b.r,b.g,b.b,c):pv.rgb(Math.round(b.r*(1-d)+a.r*d),Math.round(b.g*(1-d)+a.g*d),Math.round(b.b*(1-d)+a.b*d),c))}};pv.Scale.quantitative=function(){var p=[0,1],j=[0,1],a=[0,1],k=[pv.identity],q=Number,b=false,o=pv.identity,m=pv.identity,h=String;function s(d){return new Date(d)}function c(d){var f=pv.search(p,d);if(f<0){f=-f-2}f=Math.max(0,Math.min(k.length-1,f));return k[f]((o(d)-j[f])/(j[f+1]-j[f]))}c.transform=function(f,d){o=function(g){return b?-f(-g):f(g)};m=function(g){return b?-d(-g):d(g)};j=p.map(o);return this};c.domain=function(i,f,d){if(arguments.length){var g;if(i instanceof Array){if(arguments.length<2){f=pv.identity}if(arguments.length<3){d=f}g=i.length&&f(i[0]);p=i.length?[pv.min(i,f),pv.max(i,d)]:[]}else{g=i;p=Array.prototype.slice.call(arguments).map(Number)}if(!p.length){p=[-Infinity,Infinity]}else{if(p.length==1){p=[p[0],p[0]]}}b=(p[0]||p[p.length-1])<0;j=p.map(o);q=(g instanceof Date)?s:Number;return this}return p.map(q)};c.range=function(){if(arguments.length){a=Array.prototype.slice.call(arguments);if(!a.length){a=[-Infinity,Infinity]}else{if(a.length==1){a=[a[0],a[0]]}}k=[];for(var d=0;d<a.length-1;d++){k.push(pv.Scale.interpolator(a[d],a[d+1]))}return this}return a};c.invert=function(f){var d=pv.search(a,f);if(d<0){d=-d-2}d=Math.max(0,Math.min(k.length-1,d));return q(m(j[d]+(f-a[d])/(a[d+1]-a[d])*(j[d+1]-j[d])))};c.ticks=function(r){var f=p[0],u=p[p.length-1],y=u<f,v=y?u:f,z=y?f:u,D=z-v;if(!D||!isFinite(D)){if(q==s){h=pv.Format.date("%x")}return[q(v)]}if(q==s){function x(E,n){switch(n){case 31536000000:E.setMonth(0);case 2592000000:E.setDate(1);case 604800000:if(n==604800000){E.setDate(E.getDate()-E.getDay())}case 86400000:E.setHours(0);case 3600000:E.setMinutes(0);case 60000:E.setSeconds(0);case 1000:E.setMilliseconds(0)}}var w,C,B,i=1;if(D>=3*31536000000){w=31536000000;C="%Y";B=function(n){n.setFullYear(n.getFullYear()+i)}}else{if(D>=3*2592000000){w=2592000000;C="%m/%Y";B=function(n){n.setMonth(n.getMonth()+i)}}else{if(D>=3*604800000){w=604800000;C="%m/%d";B=function(n){n.setDate(n.getDate()+7*i)}}else{if(D>=3*86400000){w=86400000;C="%m/%d";B=function(n){n.setDate(n.getDate()+i)}}else{if(D>=3*3600000){w=3600000;C="%I:%M %p";B=function(n){n.setHours(n.getHours()+i)}}else{if(D>=3*60000){w=60000;C="%I:%M %p";B=function(n){n.setMinutes(n.getMinutes()+i)}}else{if(D>=3*1000){w=1000;C="%I:%M:%S";B=function(n){n.setSeconds(n.getSeconds()+i)}}else{w=1;C="%S.%Qs";B=function(n){n.setTime(n.getTime()+i)}}}}}}}}h=pv.Format.date(C);var l=new Date(v),d=[];x(l,w);var g=D/w;if(g>10){switch(w){case 3600000:i=(g>20)?6:3;l.setHours(Math.floor(l.getHours()/i)*i);break;case 2592000000:i=3;l.setMonth(Math.floor(l.getMonth()/i)*i);break;case 60000:i=(g>30)?15:((g>15)?10:5);l.setMinutes(Math.floor(l.getMinutes()/i)*i);break;case 1000:i=(g>90)?15:((g>60)?10:5);l.setSeconds(Math.floor(l.getSeconds()/i)*i);break;case 1:i=(g>1000)?250:((g>200)?100:((g>100)?50:((g>50)?25:5)));l.setMilliseconds(Math.floor(l.getMilliseconds()/i)*i);break;default:i=pv.logCeil(g/15,10);if(g/i<2){i/=5}else{if(g/i<5){i/=2}}l.setFullYear(Math.floor(l.getFullYear()/i)*i);break}}while(true){B(l);if(l>z){break}d.push(new Date(l))}return y?d.reverse():d}if(!arguments.length){r=10}var i=pv.logFloor(D/r,10),t=r/(D/i);if(t<=0.15){i*=10}else{if(t<=0.35){i*=5}else{if(t<=0.75){i*=2}}}var f=Math.ceil(v/i)*i,u=Math.floor(z/i)*i;h=pv.Format.number().fractionDigits(Math.max(0,-Math.floor(pv.log(i,10)+0.01)));var A=pv.range(f,u+i,i);return y?A.reverse():A};c.tickFormat=function(d){return h(d)};c.nice=function(){if(p.length!=2){return this}var r=p[0],f=p[p.length-1],g=f<r,i=g?f:r,d=g?r:f,l=d-i;if(!l||!isFinite(l)){return this}var n=Math.pow(10,Math.round(Math.log(l)/Math.log(10))-1);p=[Math.floor(i/n)*n,Math.ceil(d/n)*n];if(g){p.reverse()}j=p.map(o);return this};c.by=function(d){function g(){return c(d.apply(this,arguments))}for(var i in c){g[i]=c[i]}return g};c.domain.apply(c,arguments);return c};pv.Scale.linear=function(){var a=pv.Scale.quantitative();a.domain.apply(a,arguments);return a};pv.Scale.log=function(){var g=pv.Scale.quantitative(1,10),a,f,c=function(b){return Math.log(b)/f},d=function(b){return Math.pow(a,b)};g.ticks=function(){var o=g.domain(),p=o[0]<0,l=Math.floor(p?-c(-o[0]):c(o[0])),h=Math.ceil(p?-c(-o[1]):c(o[1])),m=[];if(p){m.push(-d(-l));for(;l++<h;){for(var b=a-1;b>0;b--){m.push(-d(-l)*b)}}}else{for(;l<h;l++){for(var b=1;b<a;b++){m.push(d(l)*b)}}m.push(d(l))}for(l=0;m[l]<o[0];l++){}for(h=m.length;m[h-1]>o[1];h--){}return m.slice(l,h)};g.tickFormat=function(b){return b.toPrecision(1)};g.nice=function(){var b=g.domain();return g.domain(pv.logFloor(b[0],a),pv.logCeil(b[1],a))};g.base=function(b){if(arguments.length){a=Number(b);f=Math.log(a);g.transform(c,d);return this}return a};g.domain.apply(g,arguments);return g.base(10)};pv.Scale.root=function(){var a=pv.Scale.quantitative();a.power=function(d){if(arguments.length){var c=Number(d),f=1/c;a.transform(function(b){return Math.pow(b,f)},function(b){return Math.pow(b,c)});return this}return c};a.domain.apply(a,arguments);return a.power(2)};pv.Scale.ordinal=function(){var g=[],a={},b=[],f=0;function c(d){if(!(d in a)){a[d]=g.push(d)-1}return b[a[d]%b.length]}c.domain=function(l,i){if(arguments.length){l=(l instanceof Array)?((arguments.length>1)?pv.map(l,i):l):Array.prototype.slice.call(arguments);g=[];var d={};for(var h=0;h<l.length;h++){var k=l[h];if(!(k in d)){d[k]=true;g.push(k)}}a=pv.numerate(g);return this}return g};c.range=function(h,d){if(arguments.length){b=(h instanceof Array)?((arguments.length>1)?pv.map(h,d):h):Array.prototype.slice.call(arguments);if(typeof b[0]=="string"){b=b.map(pv.color)}return this}return b};c.split=function(h,d){var i=(d-h)/this.domain().length;b=pv.range(h+i/2,d,i);return this};c.splitFlush=function(h,d){var j=this.domain().length,i=(d-h)/(j-1);b=(j==1)?[(h+d)/2]:pv.range(h,d+i/2,i);return this};c.splitBanded=function(h,d,m){if(arguments.length<3){m=1}if(m<0){var o=this.domain().length,k=-m*o,i=d-h-k,l=i/(o+1);b=pv.range(h+l,d,l-m);b.band=-m}else{var j=(d-h)/(this.domain().length+(1-m));b=pv.range(h+j*(1-m),d,j);b.band=j*m}return this};c.by=function(d){function h(){return c(d.apply(this,arguments))}for(var i in c){h[i]=c[i]}return h};c.domain.apply(c,arguments);return c};pv.Scale.quantile=function(){var h=-1,a=-1,b=[],f=[],g=pv.Scale.linear();function c(d){return g(Math.max(0,Math.min(a,pv.search.index(b,d)-1))/a)}c.quantiles=function(d){if(arguments.length){h=Number(d);if(h<0){b=[f[0]].concat(f);a=f.length-1}else{b=[];b[0]=f[0];for(var j=1;j<=h;j++){b[j]=f[~~(j*(f.length-1)/h)]}a=h-1}return this}return b};c.domain=function(i,d){if(arguments.length){f=(i instanceof Array)?pv.map(i,d):Array.prototype.slice.call(arguments);f.sort(pv.naturalOrder);c.quantiles(h);return this}return f};c.range=function(){if(arguments.length){g.range.apply(g,arguments);return this}return g.range()};c.by=function(d){function i(){return c(d.apply(this,arguments))}for(var j in c){i[j]=c[j]}return i};c.domain.apply(c,arguments);return c};pv.histogram=function(b,a){var c=true;return{bins:function(l){var d=pv.map(b,a),k=[];if(!arguments.length){l=pv.Scale.linear(d).ticks()}for(var h=0;h<l.length-1;h++){var g=k[h]=[];g.x=l[h];g.dx=l[h+1]-l[h];g.y=0}for(var h=0;h<d.length;h++){var f=pv.search.index(l,d[h])-1,g=k[Math.max(0,Math.min(k.length-1,f))];g.y++;g.push(b[h])}if(!c){for(var h=0;h<k.length;h++){k[h].y/=d.length}}return k},frequency:function(d){if(arguments.length){c=Boolean(d);return this}return c}}};pv.color=function(o){if(o.rgb){return o.rgb()}var q=/([a-z]+)\((.*)\)/i.exec(o);if(q){var p=q[2].split(","),n=1;switch(q[1]){case"hsla":case"rgba":n=parseFloat(p[3]);if(!n){return pv.Color.transparent}break}switch(q[1]){case"hsla":case"hsl":var j=parseFloat(p[0]),t=parseFloat(p[1])/100,d=parseFloat(p[2])/100;return(new pv.Color.Hsl(j,t,d,n)).rgb();case"rgba":case"rgb":function i(b){var a=parseFloat(b);return(b[b.length-1]=="%")?Math.round(a*2.55):a}var c=i(p[0]),k=i(p[1]),m=i(p[2]);return pv.rgb(c,k,m,n)}}var f=pv.Color.names[o];if(f){return f}if(o.charAt(0)=="#"){var c,k,m;if(o.length==4){c=o.charAt(1);c+=c;k=o.charAt(2);k+=k;m=o.charAt(3);m+=m}else{if(o.length==7){c=o.substring(1,3);k=o.substring(3,5);m=o.substring(5,7)}}return pv.rgb(parseInt(c,16),parseInt(k,16),parseInt(m,16),1)}return new pv.Color(o,1)};pv.Color=function(a,b){this.color=a;this.opacity=b};pv.Color.prototype.brighter=function(a){return this.rgb().brighter(a)};pv.Color.prototype.darker=function(a){return this.rgb().darker(a)};pv.rgb=function(h,f,c,d){return new pv.Color.Rgb(h,f,c,(arguments.length==4)?d:1)};pv.Color.Rgb=function(h,f,c,d){pv.Color.call(this,d?("rgb("+h+","+f+","+c+")"):"none",d);this.r=h;this.g=f;this.b=c;this.a=d};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(a){return pv.rgb(a,this.g,this.b,this.a)};pv.Color.Rgb.prototype.green=function(a){return pv.rgb(this.r,a,this.b,this.a)};pv.Color.Rgb.prototype.blue=function(a){return pv.rgb(this.r,this.g,a,this.a)};pv.Color.Rgb.prototype.alpha=function(b){return pv.rgb(this.r,this.g,this.b,b)};pv.Color.Rgb.prototype.rgb=function(){return this};pv.Color.Rgb.prototype.brighter=function(c){c=Math.pow(0.7,arguments.length?c:1);var h=this.r,f=this.g,a=this.b,d=30;if(!h&&!f&&!a){return pv.rgb(d,d,d,this.a)}if(h&&(h<d)){h=d}if(f&&(f<d)){f=d}if(a&&(a<d)){a=d}return pv.rgb(Math.min(255,Math.floor(h/c)),Math.min(255,Math.floor(f/c)),Math.min(255,Math.floor(a/c)),this.a)};pv.Color.Rgb.prototype.darker=function(a){a=Math.pow(0.7,arguments.length?a:1);return pv.rgb(Math.max(0,Math.floor(a*this.r)),Math.max(0,Math.floor(a*this.g)),Math.max(0,Math.floor(a*this.b)),this.a)};pv.hsl=function(f,d,c,b){return new pv.Color.Hsl(f,d,c,(arguments.length==4)?b:1)};pv.Color.Hsl=function(f,d,c,b){pv.Color.call(this,"hsl("+f+","+(d*100)+"%,"+(c*100)+"%)",b);this.h=f;this.s=d;this.l=c;this.a=b};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hue=function(a){return pv.hsl(a,this.s,this.l,this.a)};pv.Color.Hsl.prototype.saturation=function(a){return pv.hsl(this.h,a,this.l,this.a)};pv.Color.Hsl.prototype.lightness=function(a){return pv.hsl(this.h,this.s,a,this.a)};pv.Color.Hsl.prototype.alpha=function(b){return pv.hsl(this.h,this.s,this.l,b)};pv.Color.Hsl.prototype.rgb=function(){var g=this.h,f=this.s,a=this.l;g=g%360;if(g<0){g+=360}f=Math.max(0,Math.min(f,1));a=Math.max(0,Math.min(a,1));var c=(a<=0.5)?(a*(1+f)):(a+f-a*f);var d=2*a-c;function b(j){if(j>360){j-=360}else{if(j<0){j+=360}}if(j<60){return d+(c-d)*j/60}if(j<180){return c}if(j<240){return d+(c-d)*(240-j)/60}return d}function i(j){return Math.round(b(j)*255)}return pv.rgb(i(g+120),i(g),i(g-120),this.a)};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};(function(){var b=pv.Color.names;for(var a in b){b[a]=pv.color(b[a])}})();pv.colors=function(){var a=pv.Scale.ordinal();a.range.apply(a,arguments);return a};pv.Colors={};pv.Colors.category10=function(){var a=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");a.domain.apply(a,arguments);return a};pv.Colors.category20=function(){var a=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");a.domain.apply(a,arguments);return a};pv.Colors.category19=function(){var a=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");a.domain.apply(a,arguments);return a};pv.ramp=function(c,a){var b=pv.Scale.linear();b.range.apply(b,arguments);return b};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(a){if(a.length&&a[0].reverse&&(a.type!="line")&&(a.type!="area")){var d=pv.extend(a);for(var c=0,b=a.length-1;b>=0;c++,b--){d[c]=a[b]}a=d}this.removeSiblings(this[a.type](a))};pv.SvgScene.create=function(a){return document.createElementNS(this.svg,a)};pv.SvgScene.expect=function(g,d,a,c){if(g){if(g.tagName=="a"){g=g.firstChild}if(g.tagName!=d){var h=this.create(d);g.parentNode.replaceChild(h,g);g=h}}else{g=this.create(d)}for(var b in a){var f=a[b];if(f==this.implicit.svg[b]){f=null}if(f==null){g.removeAttribute(b)}else{g.setAttribute(b,f)}}for(var b in c){var f=c[b];if(f==this.implicit.css[b]){f=null}if(f==null){g.style.removeProperty(b)}else{g.style[b]=f}}return g};pv.SvgScene.append=function(c,a,b){c.$scene={scenes:a,index:b};c=this.title(c,a[b]);if(!c.parentNode){a.$g.appendChild(c)}return c.nextSibling};pv.SvgScene.title=function(f,j){var h=f.parentNode;if(h&&(h.tagName!="a")){h=null}if(j.title){var c=false;if(!h){h=this.create("a");if(f.parentNode){f.parentNode.replaceChild(h,f)}h.appendChild(f);var k=document.createTextNode(j.title),d=this.create("title");d.appendChild(k);h.appendChild(d);c=true}h.setAttributeNS(this.xlink,"title",j.title);if(!c){for(var b=h.firstChild;b;b=b.nextSibling){if(b.tagName==="title"){var i=b.firstChild,g=document.createTextNode(j.title);if(i){b.replaceChild(g,i)}else{b.appendChild(g)}}}}return h}if(h){h.parentNode.replaceChild(f,h)}return f};pv.SvgScene.dispatch=pv.listener(function(c){var a=c.target.$scene;if(a){var b=c.type;switch(b){case"DOMMouseScroll":b="mousewheel";c.wheel=-480*c.detail;break;case"mousewheel":c.wheel=(window.opera?12:1)*c.wheelDelta;break}if(pv.Mark.dispatch(b,a.scenes,a.index)){c.preventDefault()}}});pv.SvgScene.removeSiblings=function(a){while(a){var b=a.nextSibling;a.parentNode.removeChild(a);a=b}};pv.SvgScene.undefined=function(){};pv.SvgScene.pathBasis=(function(){var c=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];function a(d,i,h,g,f){return{x:d[0]*i.left+d[1]*h.left+d[2]*g.left+d[3]*f.left,y:d[0]*i.top+d[1]*h.top+d[2]*g.top+d[3]*f.top}}var b=function(k,j,i,h){var g=a(c[1],k,j,i,h),f=a(c[2],k,j,i,h),d=a(c[3],k,j,i,h);return"C"+g.x+","+g.y+","+f.x+","+f.y+","+d.x+","+d.y};b.segment=function(l,k,j,i){var h=a(c[0],l,k,j,i),g=a(c[1],l,k,j,i),f=a(c[2],l,k,j,i),d=a(c[3],l,k,j,i);return"M"+h.x+","+h.y+"C"+g.x+","+g.y+","+f.x+","+f.y+","+d.x+","+d.y};return b})();pv.SvgScene.curveBasis=function(b){if(b.length<=2){return""}var f="",h=b[0],g=h,d=h,c=b[1];f+=this.pathBasis(h,g,d,c);for(var a=2;a<b.length;a++){h=g;g=d;d=c;c=b[a];f+=this.pathBasis(h,g,d,c)}f+=this.pathBasis(g,d,c,c);f+=this.pathBasis(d,c,c,c);return f};pv.SvgScene.curveBasisSegments=function(b){if(b.length<=2){return""}var g=[],j=b[0],f=j,d=j,c=b[1],h=this.pathBasis.segment(j,f,d,c);j=f;f=d;d=c;c=b[2];g.push(h+this.pathBasis(j,f,d,c));for(var a=3;a<b.length;a++){j=f;f=d;d=c;c=b[a];g.push(this.pathBasis.segment(j,f,d,c))}g.push(this.pathBasis.segment(f,d,c,c)+this.pathBasis(d,c,c,c));return g};pv.SvgScene.curveHermite=function(h,g){if(g.length<1||(h.length!=g.length&&h.length!=g.length+2)){return""}var j=h.length!=g.length,m="",k=h[0],a=h[1],f=g[0],l=f,c=1;if(j){m+="Q"+(a.left-f.x*2/3)+","+(a.top-f.y*2/3)+","+a.left+","+a.top;k=h[1];c=2}if(g.length>1){l=g[1];a=h[c];c++;m+="C"+(k.left+f.x)+","+(k.top+f.y)+","+(a.left-l.x)+","+(a.top-l.y)+","+a.left+","+a.top;for(var b=2;b<g.length;b++,c++){a=h[c];l=g[b];m+="S"+(a.left-l.x)+","+(a.top-l.y)+","+a.left+","+a.top}}if(j){var d=h[c];m+="Q"+(a.left+l.x*2/3)+","+(a.top+l.y*2/3)+","+d.left+","+d.top}return m};pv.SvgScene.curveHermiteSegments=function(h,g){if(g.length<1||(h.length!=g.length&&h.length!=g.length+2)){return[]}var j=h.length!=g.length,m=[],k=h[0],a=k,f=g[0],l=f,c=1;if(j){a=h[1];m.push("M"+k.left+","+k.top+"Q"+(a.left-l.x*2/3)+","+(a.top-l.y*2/3)+","+a.left+","+a.top);c=2}for(var b=1;b<g.length;b++,c++){k=a;f=l;a=h[c];l=g[b];m.push("M"+k.left+","+k.top+"C"+(k.left+f.x)+","+(k.top+f.y)+","+(a.left-l.x)+","+(a.top-l.y)+","+a.left+","+a.top)}if(j){var d=h[c];m.push("M"+a.left+","+a.top+"Q"+(a.left+l.x*2/3)+","+(a.top+l.y*2/3)+","+d.left+","+d.top)}return m};pv.SvgScene.cardinalTangents=function(g,f){var c=[],b=(1-f)/2,k=g[0],j=g[1],h=g[2];for(var d=3;d<g.length;d++){c.push({x:b*(h.left-k.left),y:b*(h.top-k.top)});k=j;j=h;h=g[d]}c.push({x:b*(h.left-k.left),y:b*(h.top-k.top)});return c};pv.SvgScene.curveCardinal=function(b,a){if(b.length<=2){return""}return this.curveHermite(b,this.cardinalTangents(b,a))};pv.SvgScene.curveCardinalSegments=function(b,a){if(b.length<=2){return""}return this.curveHermiteSegments(b,this.cardinalTangents(b,a))};pv.SvgScene.monotoneTangents=function(n){var l=[],j=[],a=[],q=[],c=0;for(c=0;c<n.length-1;c++){j[c]=(n[c+1].top-n[c].top)/(n[c+1].left-n[c].left)}a[0]=j[0];q[0]=n[1].left-n[0].left;for(c=1;c<n.length-1;c++){a[c]=(j[c-1]+j[c])/2;q[c]=(n[c+1].left-n[c-1].left)/2}a[c]=j[c-1];q[c]=(n[c].left-n[c-1].left);for(c=0;c<n.length-1;c++){if(j[c]==0){a[c]=0;a[c+1]=0}}for(c=0;c<n.length-1;c++){if((Math.abs(a[c])<0.00001)||(Math.abs(a[c+1])<0.00001)){continue}var h=a[c]/j[c],b=a[c+1]/j[c],p=h*h+b*b;if(p>9){var o=3/Math.sqrt(p);a[c]=o*h*j[c];a[c+1]=o*b*j[c]}}var g;for(var f=0;f<n.length;f++){g=1+a[f]*a[f];l.push({x:q[f]/3/g,y:a[f]*q[f]/3/g})}return l};pv.SvgScene.curveMonotone=function(a){if(a.length<=2){return""}return this.curveHermite(a,this.monotoneTangents(a))};pv.SvgScene.curveMonotoneSegments=function(a){if(a.length<=2){return""}return this.curveHermiteSegments(a,this.monotoneTangents(a))};pv.SvgScene.area=function(a){var h=a.$g.firstChild;if(!a.length){return h}var p=a[0];if(p.segmented){return this.areaSegment(a)}if(!p.visible){return h}var m=p.fillStyle,n=p.strokeStyle;if(!m.opacity&&!n.opacity){return h}function o(v,s){var z=[],y=[];for(var r=s;v<=r;v++,s--){var w=a[v],t=a[s],x=w.left+","+w.top,u=(t.left+t.width)+","+(t.top+t.height);if(v<r){var q=a[v+1],d=a[s-1];switch(p.interpolate){case"step-before":x+="V"+q.top;u+="H"+(d.left+d.width);break;case"step-after":x+="H"+q.left;u+="V"+(d.top+d.height);break}}z.push(x);y.push(u)}return z.concat(y).join("L")}function l(u,t){var d=[],w=[],v,s;for(var r=t;u<=r;u++,t--){var q=a[t];d.push(a[u]);w.push({left:q.left+q.width,top:q.top+q.height})}if(p.interpolate=="basis"){v=pv.SvgScene.curveBasis(d);s=pv.SvgScene.curveBasis(w)}else{if(p.interpolate=="cardinal"){v=pv.SvgScene.curveCardinal(d,p.tension);s=pv.SvgScene.curveCardinal(w,p.tension)}else{v=pv.SvgScene.curveMonotone(d);s=pv.SvgScene.curveMonotone(w)}}return d[0].left+","+d[0].top+v+"L"+w[0].left+","+w[0].top+s}var k=[],g,c;for(var f=0;f<a.length;f++){g=a[f];if(!g.width&&!g.height){continue}for(var b=f+1;b<a.length;b++){c=a[b];if(!c.width&&!c.height){break}}if(f&&(p.interpolate!="step-after")){f--}if((b<a.length)&&(p.interpolate!="step-before")){b++}k.push(((b-f>2&&(p.interpolate=="basis"||p.interpolate=="cardinal"||p.interpolate=="monotone"))?l:o)(f,b-1));f=b-1}if(!k.length){return h}h=this.expect(h,"path",{"shape-rendering":p.antialias?null:"crispEdges","pointer-events":p.events,cursor:p.cursor,d:"M"+k.join("ZM")+"Z",fill:m.color,"fill-opacity":m.opacity||null,stroke:n.color,"stroke-opacity":n.opacity||null,"stroke-width":n.opacity?p.lineWidth/this.scale:null});return this.append(h,a,0)};pv.SvgScene.areaSegment=function(a){var t=a.$g.firstChild,l=a[0],q,g;if(l.interpolate=="basis"||l.interpolate=="cardinal"||l.interpolate=="monotone"){var f=[],k=[];for(var r=0,m=a.length;r<m;r++){var v=a[m-r-1];f.push(a[r]);k.push({left:v.left+v.width,top:v.top+v.height})}if(l.interpolate=="basis"){q=this.curveBasisSegments(f);g=this.curveBasisSegments(k)}else{if(l.interpolate=="cardinal"){q=this.curveCardinalSegments(f,l.tension);g=this.curveCardinalSegments(k,l.tension)}else{q=this.curveMonotoneSegments(f);g=this.curveMonotoneSegments(k)}}}for(var r=0,m=a.length-1;r<m;r++){var c=a[r],b=a[r+1];if(!c.visible||!b.visible){continue}var p=c.fillStyle,j=c.strokeStyle;if(!p.opacity&&!j.opacity){continue}var u;if(q){var h=q[r],o="L"+g[m-r-1].substr(1);u=h+o+"Z"}else{var w=c,v=b;switch(c.interpolate){case"step-before":w=b;break;case"step-after":v=c;break}u="M"+c.left+","+w.top+"L"+b.left+","+v.top+"L"+(b.left+b.width)+","+(v.top+v.height)+"L"+(c.left+c.width)+","+(w.top+w.height)+"Z"}t=this.expect(t,"path",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,d:u,fill:p.color,"fill-opacity":p.opacity||null,stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?c.lineWidth/this.scale:null});t=this.append(t,a,r)}return t};pv.SvgScene.bar=function(a){var g=a.$g.firstChild;for(var b=0;b<a.length;b++){var c=a[b];if(!c.visible){continue}var f=c.fillStyle,d=c.strokeStyle;if(!f.opacity&&!d.opacity){continue}if(!isFinite(c.left)||!isFinite(c.top)||!isFinite(c.width)||!isFinite(c.height)){continue}g=this.expect(g,"rect",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,x:c.left,y:c.top,width:Math.max(1e-10,c.width),height:Math.max(1e-10,c.height),fill:f.color,"fill-opacity":f.opacity||null,stroke:d.color,"stroke-opacity":d.opacity||null,"stroke-width":d.opacity?c.lineWidth/this.scale:null});g=this.append(g,a,b)}return g};pv.SvgScene.dot=function(a){var g=a.$g.firstChild;for(var b=0;b<a.length;b++){var n=a[b];if(!n.visible){continue}var k=n.fillStyle,l=n.strokeStyle;if(!k.opacity&&!l.opacity){continue}var f=n.shapeRadius,m=null;switch(n.shape){case"cross":m="M"+-f+","+-f+"L"+f+","+f+"M"+f+","+-f+"L"+-f+","+f;break;case"triangle":var d=f,j=f*1.1547;m="M0,"+d+"L"+j+","+-d+" "+-j+","+-d+"Z";break;case"diamond":f*=Math.SQRT2;m="M0,"+-f+"L"+f+",0 0,"+f+" "+-f+",0Z";break;case"square":m="M"+-f+","+-f+"L"+f+","+-f+" "+f+","+f+" "+-f+","+f+"Z";break;case"tick":m="M0,0L0,"+-n.shapeSize;break;case"bar":m="M0,"+(n.shapeSize/2)+"L0,"+-(n.shapeSize/2);break}var c={"shape-rendering":n.antialias?null:"crispEdges","pointer-events":n.events,cursor:n.cursor,fill:k.color,"fill-opacity":k.opacity||null,stroke:l.color,"stroke-opacity":l.opacity||null,"stroke-width":l.opacity?n.lineWidth/this.scale:null};if(m){c.transform="translate("+n.left+","+n.top+")";if(n.shapeAngle){c.transform+=" rotate("+180*n.shapeAngle/Math.PI+")"}c.d=m;g=this.expect(g,"path",c)}else{c.cx=n.left;c.cy=n.top;c.r=f;g=this.expect(g,"circle",c)}g=this.append(g,a,b)}return g};pv.SvgScene.image=function(a){var f=a.$g.firstChild;for(var b=0;b<a.length;b++){var d=a[b];if(!d.visible){continue}f=this.fill(f,a,b);if(d.image){f=this.expect(f,"foreignObject",{cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});var g=f.firstChild||f.appendChild(document.createElementNS(this.xhtml,"canvas"));g.$scene={scenes:a,index:b};g.style.width=d.width;g.style.height=d.height;g.width=d.imageWidth;g.height=d.imageHeight;g.getContext("2d").putImageData(d.image,0,0)}else{f=this.expect(f,"image",{preserveAspectRatio:"none",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});f.setAttributeNS(this.xlink,"href",d.url)}f=this.append(f,a,b);f=this.stroke(f,a,b)}return f};pv.SvgScene.label=function(a){var d=a.$g.firstChild;for(var c=0;c<a.length;c++){var k=a[c];if(!k.visible){continue}var h=k.textStyle;if(!h.opacity||!k.text){continue}var g=0,f=0,j=0,b="start";switch(k.textBaseline){case"middle":j=".35em";break;case"top":j=".71em";f=k.textMargin;break;case"bottom":f="-"+k.textMargin;break}switch(k.textAlign){case"right":b="end";g="-"+k.textMargin;break;case"center":b="middle";break;case"left":g=k.textMargin;break}d=this.expect(d,"text",{"pointer-events":k.events,cursor:k.cursor,x:g,y:f,dy:j,transform:"translate("+k.left+","+k.top+")"+(k.textAngle?" rotate("+180*k.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:h.color,"fill-opacity":h.opacity||null,"text-anchor":b},{font:k.font,"text-shadow":k.textShadow,"text-decoration":k.textDecoration});if(d.firstChild){d.firstChild.nodeValue=k.text}else{d.appendChild(document.createTextNode(k.text))}d=this.append(d,a,c)}return d};pv.SvgScene.line=function(a){var h=a.$g.firstChild;if(a.length<2){return h}var c=a[0];if(c.segmented){return this.lineSegment(a)}if(!c.visible){return h}var g=c.fillStyle,f=c.strokeStyle;if(!g.opacity&&!f.opacity){return h}var j="M"+c.left+","+c.top;if(a.length>2&&(c.interpolate=="basis"||c.interpolate=="cardinal"||c.interpolate=="monotone")){switch(c.interpolate){case"basis":j+=this.curveBasis(a);break;case"cardinal":j+=this.curveCardinal(a,c.tension);break;case"monotone":j+=this.curveMonotone(a);break}}else{for(var b=1;b<a.length;b++){j+=this.pathSegment(a[b-1],a[b])}}h=this.expect(h,"path",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,d:j,fill:g.color,"fill-opacity":g.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-dasharray":c.strokeDasharray||null,"stroke-width":f.opacity?c.lineWidth/this.scale:null,"stroke-linejoin":c.lineJoin});return this.append(h,a,0)};pv.SvgScene.lineSegment=function(a){var f=a.$g.firstChild;var o=a[0];var m;switch(o.interpolate){case"basis":m=this.curveBasisSegments(a);break;case"cardinal":m=this.curveCardinalSegments(a,o.tension);break;case"monotone":m=this.curveMonotoneSegments(a);break}for(var c=0,b=a.length-1;c<b;c++){var j=a[c],h=a[c+1];if(!j.visible||!h.visible){continue}var l=j.strokeStyle,k=pv.Color.transparent;if(!l.opacity){continue}var g;if((j.interpolate=="linear")&&(j.lineJoin=="miter")){k=l;l=pv.Color.transparent;g=this.pathJoin(a[c-1],j,h,a[c+2])}else{if(m){g=m[c]}else{g="M"+j.left+","+j.top+this.pathSegment(j,h)}}f=this.expect(f,"path",{"shape-rendering":j.antialias?null:"crispEdges","pointer-events":j.events,cursor:j.cursor,d:g,fill:k.color,"fill-opacity":k.opacity||null,stroke:l.color,"stroke-opacity":l.opacity||null,"stroke-width":l.opacity?j.lineWidth/this.scale:null,"stroke-linejoin":j.lineJoin});f=this.append(f,a,c)}return f};pv.SvgScene.pathSegment=function(f,d){var b=1;switch(f.interpolate){case"polar-reverse":b=0;case"polar":var c=d.left-f.left,a=d.top-f.top,h=1-f.eccentricity,g=Math.sqrt(c*c+a*a)/(2*h);if((h<=0)||(h>1)){break}return"A"+g+","+g+" 0 0,"+b+" "+d.left+","+d.top;case"step-before":return"V"+d.top+"H"+d.left;case"step-after":return"H"+d.left+"V"+d.top}return"L"+d.left+","+d.top};pv.SvgScene.lineIntersect=function(d,c,b,a){return d.plus(c.times(b.minus(d).dot(a.perp())/c.dot(a.perp())))};pv.SvgScene.pathJoin=function(u,r,o,l){var t=pv.vector(r.left,r.top),q=pv.vector(o.left,o.top),f=q.minus(t),s=f.perp().norm(),n=s.times(r.lineWidth/(2*this.scale)),k=t.plus(n),i=q.plus(n),h=q.minus(n),g=t.minus(n);if(u&&u.visible){var m=t.minus(u.left,u.top).perp().norm().plus(s);g=this.lineIntersect(t,m,g,f);k=this.lineIntersect(t,m,k,f)}if(l&&l.visible){var j=pv.vector(l.left,l.top).minus(q).perp().norm().plus(s);h=this.lineIntersect(q,j,h,f);i=this.lineIntersect(q,j,i,f)}return"M"+k.x+","+k.y+"L"+i.x+","+i.y+" "+h.x+","+h.y+" "+g.x+","+g.y};pv.SvgScene.panel=function(b){var m=b.$g,n=m&&m.firstChild;for(var l=0;l<b.length;l++){var v=b[l];if(!v.visible){continue}if(!b.parent){v.canvas.style.display="inline-block";if(m&&(m.parentNode!=v.canvas)){m=v.canvas.firstChild;n=m&&m.firstChild}if(!m){m=v.canvas.appendChild(this.create("svg"));m.setAttribute("font-size","10px");m.setAttribute("font-family","sans-serif");m.setAttribute("fill","none");m.setAttribute("stroke","none");m.setAttribute("stroke-width",1.5);for(var h=0;h<this.events.length;h++){m.addEventListener(this.events[h],this.dispatch,false)}n=m.firstChild}b.$g=m;m.setAttribute("width",v.width+v.left+v.right);m.setAttribute("height",v.height+v.top+v.bottom)}if(v.overflow=="hidden"){var d=pv.id().toString(36),o=this.expect(n,"g",{"clip-path":"url(#"+d+")"});if(!o.parentNode){m.appendChild(o)}b.$g=m=o;n=o.firstChild;n=this.expect(n,"clipPath",{id:d});var a=n.firstChild||n.appendChild(this.create("rect"));a.setAttribute("x",v.left);a.setAttribute("y",v.top);a.setAttribute("width",v.width);a.setAttribute("height",v.height);if(!n.parentNode){m.appendChild(n)}n=n.nextSibling}n=this.fill(n,b,l);var f=this.scale,u=v.transform,q=v.left+u.x,p=v.top+u.y;this.scale*=u.k;for(var h=0;h<v.children.length;h++){v.children[h].$g=n=this.expect(n,"g",{transform:"translate("+q+","+p+")"+(u.k!=1?" scale("+u.k+")":"")});this.updateAll(v.children[h]);if(!n.parentNode){m.appendChild(n)}n=n.nextSibling}this.scale=f;n=this.stroke(n,b,l);if(v.overflow=="hidden"){b.$g=m=o.parentNode;n=o.nextSibling}}return n};pv.SvgScene.fill=function(f,a,b){var c=a[b],d=c.fillStyle;if(d.opacity||c.events=="all"){f=this.expect(f,"rect",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,x:c.left,y:c.top,width:c.width,height:c.height,fill:d.color,"fill-opacity":d.opacity,stroke:null});f=this.append(f,a,b)}return f};pv.SvgScene.stroke=function(f,a,b){var c=a[b],d=c.strokeStyle;if(d.opacity||c.events=="all"){f=this.expect(f,"rect",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events=="all"?"stroke":c.events,cursor:c.cursor,x:c.left,y:c.top,width:Math.max(1e-10,c.width),height:Math.max(1e-10,c.height),fill:null,stroke:d.color,"stroke-opacity":d.opacity,"stroke-width":c.lineWidth/this.scale});f=this.append(f,a,b)}return f};pv.SvgScene.rule=function(a){var f=a.$g.firstChild;for(var b=0;b<a.length;b++){var c=a[b];if(!c.visible){continue}var d=c.strokeStyle;if(!d.opacity){continue}f=this.expect(f,"line",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,x1:c.left,y1:c.top,x2:c.left+c.width,y2:c.top+c.height,stroke:d.color,"stroke-opacity":d.opacity,"stroke-width":c.lineWidth/this.scale});f=this.append(f,a,b)}return f};pv.SvgScene.wedge=function(b){var k=b.$g.firstChild;for(var j=0;j<b.length;j++){var u=b[j];if(!u.visible){continue}var r=u.fillStyle,t=u.strokeStyle;if(!r.opacity&&!t.opacity){continue}var f=u.innerRadius,d=u.outerRadius,n=Math.abs(u.angle),c;if(n>=2*Math.PI){if(f){c="M0,"+d+"A"+d+","+d+" 0 1,1 0,"+(-d)+"A"+d+","+d+" 0 1,1 0,"+d+"M0,"+f+"A"+f+","+f+" 0 1,1 0,"+(-f)+"A"+f+","+f+" 0 1,1 0,"+f+"Z"}else{c="M0,"+d+"A"+d+","+d+" 0 1,1 0,"+(-d)+"A"+d+","+d+" 0 1,1 0,"+d+"Z"}}else{var m=Math.min(u.startAngle,u.endAngle),l=Math.max(u.startAngle,u.endAngle),h=Math.cos(m),g=Math.cos(l),q=Math.sin(m),o=Math.sin(l);if(f){c="M"+d*h+","+d*q+"A"+d+","+d+" 0 "+((n<Math.PI)?"0":"1")+",1 "+d*g+","+d*o+"L"+f*g+","+f*o+"A"+f+","+f+" 0 "+((n<Math.PI)?"0":"1")+",0 "+f*h+","+f*q+"Z"}else{c="M"+d*h+","+d*q+"A"+d+","+d+" 0 "+((n<Math.PI)?"0":"1")+",1 "+d*g+","+d*o+"L0,0Z"}}k=this.expect(k,"path",{"shape-rendering":u.antialias?null:"crispEdges","pointer-events":u.events,cursor:u.cursor,transform:"translate("+u.left+","+u.top+")",d:c,fill:r.color,"fill-rule":"evenodd","fill-opacity":r.opacity||null,stroke:t.color,"stroke-opacity":t.opacity||null,"stroke-width":t.opacity?u.lineWidth/this.scale:null});k=this.append(k,b,j)}return k};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(b,a){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[b]=true;pv.Mark.prototype.propertyMethod(b,false,pv.Mark.cast[b]=a);return this};pv.Mark.prototype.propertyMethod=function(b,c,a){if(!a){a=pv.Mark.cast[b]}this[b]=function(f){if(c&&this.scene){var d=this.scene.defs;if(arguments.length){d[b]={id:(f==null)?0:pv.id(),value:((f!=null)&&a)?a(f):f};return this}return d[b]?d[b].value:null}if(arguments.length){var g=!c<<1|(typeof f=="function");this.propertyValue(b,(g&1&&a)?function(){var h=f.apply(this,arguments);return(h!=null)?a(h):null}:(((f!=null)&&a)?a(f):f)).type=g;return this}return this.instance()[b]}};pv.Mark.prototype.propertyValue=function(b,a){var d=this.$properties,f={name:b,id:pv.id(),value:a};for(var c=0;c<d.length;c++){if(d[c].name==b){d.splice(c,1);break}}d.push(f);return f};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String).property("id",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype.defaults=new pv.Mark().data(function(a){return[a]}).visible(true).antialias(true).events("painted");pv.Mark.prototype.extend=function(a){this.proto=a;this.target=a.target;return this};pv.Mark.prototype.add=function(a){return this.parent.add(a).extend(this)};pv.Mark.prototype.def=function(b,a){this.propertyMethod(b,true);return this[b](arguments.length>1?a:null)};pv.Mark.prototype.anchor=function(a){if(!a){a="center"}return new pv.Anchor(this).name(a).data(function(){return this.scene.target.map(function(b){return b.data})}).visible(function(){return this.scene.target[this.index].visible}).id(function(){return this.scene.target[this.index].id}).left(function(){var c=this.scene.target[this.index],b=c.width||0;switch(this.name()){case"bottom":case"top":case"center":return c.left+b/2;case"left":return null}return c.left+b}).top(function(){var c=this.scene.target[this.index],b=c.height||0;switch(this.name()){case"left":case"right":case"center":return c.top+b/2;case"top":return null}return c.top+b}).right(function(){var b=this.scene.target[this.index];return this.name()=="left"?b.right+(b.width||0):null}).bottom(function(){var b=this.scene.target[this.index];return this.name()=="top"?b.bottom+(b.height||0):null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})};pv.Mark.prototype.anchorTarget=function(){return this.target};pv.Mark.prototype.margin=function(a){return this.left(a).right(a).top(a).bottom(a)};pv.Mark.prototype.instance=function(c){var b=this.scene||this.parent.instance(-1).children[this.childIndex],a=!arguments.length||this.hasOwnProperty("index")?this.index:c;return b[a<0?b.length-1:a]};pv.Mark.prototype.instances=function(d){var g=this,a=[],f;while(!(f=g.scene)){d=d.parent;a.push({index:d.index,childIndex:g.childIndex});g=g.parent}while(a.length){var b=a.pop();f=f[b.index].children[b.childIndex]}if(this.hasOwnProperty("index")){var c=pv.extend(f[this.index]);c.right=c.top=c.left=c.bottom=0;return[c]}return f};pv.Mark.prototype.first=function(){return this.scene[0]};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]};pv.Mark.prototype.sibling=function(){return(this.index==0)?null:this.scene[this.index-1]};pv.Mark.prototype.cousin=function(){var b=this.parent,a=b&&b.sibling();return(a&&a.children)?a.children[this.childIndex][this.index]:null};pv.Mark.prototype.render=function(){var d=this.parent,a=pv.Mark.stack;if(d&&!this.root.scene){this.root.render();return}var b=[];for(var g=this;g.parent;g=g.parent){b.unshift(g.childIndex)}function c(m,k,j){m.scale=j;if(k<b.length){a.unshift(null);if(m.hasOwnProperty("index")){f(m,k,j)}else{for(var h=0,l=m.scene.length;h<l;h++){m.index=h;f(m,k,j)}delete m.index}a.shift()}else{m.build();pv.Scene.scale=j;pv.Scene.updateAll(m.scene)}delete m.scale}function f(o,l,k){var j=o.scene[o.index],h;if(j.visible){var n=b[l],m=o.children[n];for(h=0;h<n;h++){o.children[h].scene=j.children[h]}a[0]=j.data;if(m.scene){c(m,l+1,k*j.transform.k)}else{m.scene=j.children[n];c(m,l+1,k*j.transform.k);delete m.scene}for(h=0;h<n;h++){delete o.children[h].scene}}}this.bind();while(d&&!d.hasOwnProperty("index")){d=d.parent}this.context(d?d.scene:undefined,d?d.index:-1,function(){c(this.root,0,1)})};pv.Mark.stack=[];pv.Mark.prototype.bind=function(){var a={},h=[[],[],[],[]],g,k=[];function j(o){do{var m=o.$properties;for(var l=m.length-1;l>=0;l--){var n=m[l];if(!(n.name in a)){a[n.name]=n;switch(n.name){case"data":g=n;break;case"visible":case"id":k.push(n);break;default:h[n.type].push(n);break}}}}while(o=o.proto)}j(this);j(this.defaults);h[1].reverse();h[3].reverse();var c=this;do{for(var b in c.properties){if(!(b in a)){h[2].push(a[b]={name:b,type:2,value:null})}}}while(c=c.proto);var d=h[0].concat(h[1]);for(var f=0;f<d.length;f++){this.propertyMethod(d[f].name,true)}this.binds={properties:a,data:g,defs:d,required:k,optional:pv.blend(h)}};pv.Mark.prototype.build=function(){var j=this.scene,b=pv.Mark.stack;if(!j){j=this.scene=[];j.mark=this;j.type=this.type;j.childIndex=this.childIndex;if(this.parent){j.parent=this.parent.scene;j.parentIndex=this.parent.index}}if(this.target){j.target=this.target.instances(j)}if(this.binds.defs.length){var a=j.defs;if(!a){j.defs=a={}}for(var c=0;c<this.binds.defs.length;c++){var h=this.binds.defs[c],k=a[h.name];if(!k||(h.id>k.id)){a[h.name]={id:0,value:(h.type&1)?h.value.apply(this,b):h.value}}}}var g=this.binds.data;g=g.type&1?g.value.apply(this,b):g.value;b.unshift(null);j.length=g.length;for(var c=0;c<g.length;c++){pv.Mark.prototype.index=this.index=c;var f=j[c];if(!f){j[c]=f={}}f.data=b[0]=g[c];this.buildInstance(f)}pv.Mark.prototype.index=-1;delete this.index;b.shift();return this};pv.Mark.prototype.buildProperties=function(d,c){for(var b=0,g=c.length;b<g;b++){var f=c[b],a=f.value;switch(f.type){case 0:case 1:a=this.scene.defs[f.name].value;break;case 3:a=a.apply(this,pv.Mark.stack);break}d[f.name]=a}};pv.Mark.prototype.buildInstance=function(a){this.buildProperties(a,this.binds.required);if(a.visible){this.buildProperties(a,this.binds.optional);this.buildImplied(a)}};pv.Mark.prototype.buildImplied=function(n){var f=n.left;var a=n.right;var m=n.top;var i=n.bottom;var d=this.properties;var j=d.width?n.width:0;var g=d.height?n.height:0;var c=this.parent?this.parent.width():(j+f+a);if(j==null){j=c-(a=a||0)-(f=f||0)}else{if(a==null){if(f==null){f=a=(c-j)/2}else{a=c-j-f}}else{if(f==null){f=c-j-a}}}var k=this.parent?this.parent.height():(g+m+i);if(g==null){g=k-(m=m||0)-(i=i||0)}else{if(i==null){if(m==null){i=m=(k-g)/2}else{i=k-g-m}}else{if(m==null){m=k-g-i}}}n.left=f;n.right=a;n.top=m;n.bottom=i;if(d.width){n.width=j}if(d.height){n.height=g}if(d.textStyle&&!n.textStyle){n.textStyle=pv.Color.transparent}if(d.fillStyle&&!n.fillStyle){n.fillStyle=pv.Color.transparent}if(d.strokeStyle&&!n.strokeStyle){n.strokeStyle=pv.Color.transparent}};pv.Mark.prototype.mouse=function(){var a=pv.event.pageX||0,g=pv.event.pageY||0,f=this.root.canvas();do{a-=f.offsetLeft+f.clientLeft;g-=f.offsetTop+f.clientTop}while(f=f.offsetParent);var c=pv.Transform.identity,d=this.properties.transform?this:this.parent,b=[];do{b.push(d)}while(d=d.parent);while(d=b.pop()){c=c.translate(d.left(),d.top()).times(d.transform())}c=c.invert();return pv.vector(a*c.k+c.x,g*c.k+c.y)};pv.Mark.prototype.event=function(b,a){this.$handlers[b]=pv.functor(a);return this};pv.Mark.prototype.context=function(b,h,g){var c=pv.Mark.prototype,j=pv.Mark.stack,d=pv.Mark.scene,i=c.index;function k(q,l){pv.Mark.scene=q;c.index=l;if(!q){return}var p=q.mark,s=p,o=[];do{o.push(s);j.push(q[l].data);s.index=l;s.scene=q;l=q.parentIndex;q=q.parent}while(s=s.parent);for(var m=o.length-1,f=1;m>0;m--){s=o[m];s.scale=f;f*=s.scene[s.index].transform.k}if(p.children){for(var m=0,r=p.children.length;m<r;m++){s=p.children[m];s.scene=p.scene[p.index].children[m];s.scale=f}}}function a(o,f){if(!o){return}var m=o.mark,q;if(m.children){for(var l=0,p=m.children.length;l<p;l++){q=m.children[l];delete q.scene;delete q.scale}}q=m;do{j.pop();if(q.parent){delete q.scene;delete q.scale}delete q.index}while(q=q.parent)}a(d,i);k(b,h);try{g.apply(this,j)}finally{a(b,h);k(d,i)}};pv.Mark.dispatch=function(d,g,c){var a=g.mark,f=g.parent,b=a.$handlers[d];if(!b){return f&&pv.Mark.dispatch(d,f,g.parentIndex)}a.context(g,c,function(){a=b.apply(a,pv.Mark.stack);if(a&&a.render){a.render()}});return true};pv.Mark.prototype.transition=function(){return new pv.Transition(this)};pv.Mark.prototype.on=function(a){return this["$"+a]=new pv.Transient(this)};pv.Anchor=function(a){pv.Mark.call(this);this.target=a;this.parent=a.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(a){this.proto=a;return this};pv.Area=function(){pv.Mark.call(this)};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=new pv.Area().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(0.7);pv.Area.prototype.buildImplied=function(a){if(a.height==null){a.height=0}if(a.width==null){a.width=0}pv.Mark.prototype.buildImplied.call(this,a)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var c=this.binds,f=c.required,a=c.optional;for(var b=0,g=a.length;b<g;b++){var d=a[b];d.fixed=d.name in pv.Area.fixed;if(d.name=="segmented"){f.push(d);a.splice(b,1);b--;g--}}this.binds.$required=f;this.binds.$optional=a};pv.Area.prototype.buildInstance=function(c){var b=this.binds;if(this.index){var d=b.fixed;if(!d){d=b.fixed=[];function g(f){return !f.fixed||(d.push(f),false)}b.required=b.required.filter(g);if(!this.scene[0].segmented){b.optional=b.optional.filter(g)}}for(var a=0,j=d.length;a<j;a++){var h=d[a].name;c[h]=this.scene[0][h]}}else{b.required=b.$required;b.optional=b.$optional;b.fixed=null}pv.Mark.prototype.buildInstance.call(this,c)};pv.Area.prototype.anchor=function(a){var b;return pv.Mark.prototype.anchor.call(this,a).interpolate(function(){return this.scene.target[this.index].interpolate}).eccentricity(function(){return this.scene.target[this.index].eccentricity}).tension(function(){return this.scene.target[this.index].tension})};pv.Bar=function(){pv.Mark.call(this)};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=new pv.Bar().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};pv.Dot.prototype=pv.extend(pv.Mark).property("shape",String).property("shapeAngle",Number).property("shapeRadius",Number).property("shapeSize",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=new pv.Dot().extend(pv.Mark.prototype.defaults).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));pv.Dot.prototype.anchor=function(a){var b;return pv.Mark.prototype.anchor.call(this,a).left(function(){var c=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return c.left;case"left":return null}return c.left+c.shapeRadius}).right(function(){var c=this.scene.target[this.index];return this.name()=="left"?c.right+c.shapeRadius:null}).top(function(){var c=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return c.top;case"top":return null}return c.top+c.shapeRadius}).bottom(function(){var c=this.scene.target[this.index];return this.name()=="top"?c.bottom+c.shapeRadius:null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})};pv.Dot.prototype.buildImplied=function(a){var b=a.shapeRadius,c=a.shapeSize;if(b==null){if(c==null){a.shapeSize=20.25;a.shapeRadius=4.5}else{a.shapeRadius=Math.sqrt(c)}}else{if(c==null){a.shapeSize=b*b}}pv.Mark.prototype.buildImplied.call(this,a)};pv.Label=function(){pv.Mark.call(this)};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=new pv.Label().extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("strokeDasharray").property("interpolate",String).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=new pv.Line().extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).strokeDasharray("").interpolate("linear").eccentricity(0).tension(0.7);pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.anchor=function(a){return pv.Area.prototype.anchor.call(this,a).textAlign(function(b){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(b){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})};pv.Rule=function(){pv.Mark.call(this)};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=new pv.Rule().extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false);pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(f){var c=f.left,g=f.right,d=f.top,a=f.bottom;if((f.width!=null)||((c==null)&&(g==null))||((g!=null)&&(c!=null))){f.height=0}else{f.width=0}pv.Mark.prototype.buildImplied.call(this,f)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(a){return(typeof a=="string")?document.getElementById(a):a});pv.Panel.prototype.type="panel";pv.Panel.prototype.defaults=new pv.Panel().extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(b){var a=pv.Bar.prototype.anchor.call(this,b);a.parent=this;return a};pv.Panel.prototype.add=function(a){var b=new a();b.parent=this;b.root=this.root;b.childIndex=this.children.length;this.children.push(b);return b};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var a=0;a<this.children.length;a++){this.children[a].bind()}};pv.Panel.prototype.buildInstance=function(b){pv.Bar.prototype.buildInstance.call(this,b);if(!b.visible){return}if(!b.children){b.children=[]}var c=this.scale*b.transform.k,f,d=this.children.length;pv.Mark.prototype.index=-1;for(var a=0;a<d;a++){f=this.children[a];f.scene=b.children[a];f.scale=c;f.build()}for(var a=0;a<d;a++){f=this.children[a];b.children[a]=f.scene;delete f.scene;delete f.scale}b.children.length=d};pv.Panel.prototype.buildImplied=function(f){if(!this.parent){var i=f.canvas;if(i){if(i.$panel!=this){i.$panel=this;while(i.lastChild){i.removeChild(i.lastChild)}}var a,d;if(f.width==null){a=parseFloat(pv.css(i,"width"));f.width=a-f.left-f.right}if(f.height==null){d=parseFloat(pv.css(i,"height"));f.height=d-f.top-f.bottom}}else{var b=this.$canvas||(this.$canvas=[]);if(!(i=b[this.index])){i=b[this.index]=document.createElement("span");if(this.$dom){this.$dom.parentNode.insertBefore(i,this.$dom)}else{var g=document.body;while(g.lastChild&&g.lastChild.tagName){g=g.lastChild}if(g!=document.body){g=g.parentNode}g.appendChild(i)}}}f.canvas=i}if(!f.transform){f.transform=pv.Transform.identity}pv.Mark.prototype.buildImplied.call(this,f)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=new pv.Image().extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(a){this.$image=function(){var b=a.apply(this,arguments);return b==null?pv.Color.transparent:typeof b=="string"?pv.color(b):b};return this};pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var a=this.binds,b=this;do{a.image=b.$image}while(!a.image&&(b=b.proto))};pv.Image.prototype.buildImplied=function(m){pv.Bar.prototype.buildImplied.call(this,m);if(!m.visible){return}if(m.imageWidth==null){m.imageWidth=m.width}if(m.imageHeight==null){m.imageHeight=m.height}if((m.url==null)&&this.binds.image){var c=this.$canvas||(this.$canvas=document.createElement("canvas")),b=c.getContext("2d"),l=m.imageWidth,g=m.imageHeight,j=pv.Mark.stack,f;c.width=l;c.height=g;f=(m.image=b.createImageData(l,g)).data;j.unshift(null,null);for(var i=0,a=0;i<g;i++){j[1]=i;for(var k=0;k<l;k++){j[0]=k;var d=this.binds.image.apply(this,j);f[a++]=d.r;f[a++]=d.g;f[a++]=d.b;f[a++]=255*d.a}}j.splice(0,2)}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=new pv.Wedge().extend(pv.Mark.prototype.defaults).startAngle(function(){var a=this.sibling();return a?a.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2};pv.Wedge.prototype.anchor=function(c){function b(f){return f.innerRadius||f.angle<2*Math.PI}function a(f){return(f.innerRadius+f.outerRadius)/2}function d(f){return(f.startAngle+f.endAngle)/2}return pv.Mark.prototype.anchor.call(this,c).left(function(){var f=this.scene.target[this.index];if(b(f)){switch(this.name()){case"outer":return f.left+f.outerRadius*Math.cos(d(f));case"inner":return f.left+f.innerRadius*Math.cos(d(f));case"start":return f.left+a(f)*Math.cos(f.startAngle);case"center":return f.left+a(f)*Math.cos(d(f));case"end":return f.left+a(f)*Math.cos(f.endAngle)}}return f.left}).top(function(){var f=this.scene.target[this.index];if(b(f)){switch(this.name()){case"outer":return f.top+f.outerRadius*Math.sin(d(f));case"inner":return f.top+f.innerRadius*Math.sin(d(f));case"start":return f.top+a(f)*Math.sin(f.startAngle);case"center":return f.top+a(f)*Math.sin(d(f));case"end":return f.top+a(f)*Math.sin(f.endAngle)}}return f.top}).textAlign(function(){var f=this.scene.target[this.index];if(b(f)){switch(this.name()){case"outer":return pv.Wedge.upright(d(f))?"right":"left";case"inner":return pv.Wedge.upright(d(f))?"left":"right"}}return"center"}).textBaseline(function(){var f=this.scene.target[this.index];if(b(f)){switch(this.name()){case"start":return pv.Wedge.upright(f.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(f.endAngle)?"bottom":"top"}}return"middle"}).textAngle(function(){var g=this.scene.target[this.index],f=0;if(b(g)){switch(this.name()){case"center":case"inner":case"outer":f=d(g);break;case"start":f=g.startAngle;break;case"end":f=g.endAngle;break}}return pv.Wedge.upright(f)?f:(f+Math.PI)})};pv.Wedge.upright=function(a){a=a%(2*Math.PI);a=(a<0)?(2*Math.PI+a):a;return(a<Math.PI/2)||(a>=3*Math.PI/2)};pv.Wedge.prototype.buildImplied=function(a){if(a.angle==null){a.angle=a.endAngle-a.startAngle}else{if(a.endAngle==null){a.endAngle=a.startAngle+a.angle}}pv.Mark.prototype.buildImplied.call(this,a)};pv.Ease=(function(){function j(p){return function(q){return 1-p(1-q)}}function d(p){return function(q){return 0.5*(q<0.5?p(2*q):(2-p(2-2*q)))}}function b(p){return function(q){return q<0?0:q>1?1:Math.pow(q,p)}}function k(p){return 1-Math.cos(p*Math.PI/2)}function g(p){return p?Math.pow(2,10*(p-1))-0.001:0}function a(p){return -(Math.sqrt(1-p*p)-1)}function n(q,t){var r;if(!t){t=0.45}if(!q||q<1){q=1;r=t/4}else{r=t/(2*Math.PI)*Math.asin(1/q)}return function(p){return p<=0||p>=1?p:-(q*Math.pow(2,10*(--p))*Math.sin((p-r)*(2*Math.PI)/t))}}function i(p){if(!p){p=1.70158}return function(q){return q*q*((p+1)*q-p)}}function o(p){return p<1/2.75?7.5625*p*p:p<2/2.75?7.5625*(p-=1.5/2.75)*p+0.75:p<2.5/2.75?7.5625*(p-=2.25/2.75)*p+0.9375:7.5625*(p-=2.625/2.75)*p+0.984375}var m=b(2),f=b(3),c=n(),h=i();var l={linear:pv.identity,"quad-in":m,"quad-out":j(m),"quad-in-out":d(m),"quad-out-in":d(j(m)),"cubic-in":f,"cubic-out":j(f),"cubic-in-out":d(f),"cubic-out-in":d(j(f)),"sin-in":k,"sin-out":j(k),"sin-in-out":d(k),"sin-out-in":d(j(k)),"exp-in":g,"exp-out":j(g),"exp-in-out":d(g),"exp-out-in":d(j(g)),"circle-in":a,"circle-out":j(a),"circle-in-out":d(a),"circle-out-in":d(j(a)),"elastic-in":c,"elastic-out":j(c),"elastic-in-out":d(c),"elastic-out-in":d(j(c)),"back-in":h,"back-out":j(h),"back-in-out":d(h),"back-out-in":d(j(h)),"bounce-in":o,"bounce-out":j(o),"bounce-in-out":d(o),"bounce-out-in":d(j(o))};pv.ease=function(p){return l[p]};return{reverse:j,reflect:d,linear:function(){return pv.identity},sin:function(){return k},exp:function(){return g},circle:function(){return a},elastic:n,back:i,bounce:o,poly:b}})();pv.Transition=function(h){var l=this,i=pv.ease("cubic-in-out"),j=250,d;var o={top:1,left:1,right:1,bottom:1,width:1,height:1,innerRadius:1,outerRadius:1,radius:1,startAngle:1,endAngle:1,angle:1,fillStyle:1,strokeStyle:1,lineWidth:1,eccentricity:1,tension:1,textAngle:1,textStyle:1,textMargin:1};var k=new pv.Transient();var n=pv.Color.transparent;function a(q){var r={};for(var p=0;p<q.length;p++){var s=q[p];if(s.id){r[s.id]=s}}return r}function g(t,p,s,u){if(p in o){var q=pv.Scale.interpolator(s[p],u[p]);var r=function(v){s[p]=q(v)}}else{var r=function(v){if(v>0.5){s[p]=u[p]}}}r.next=t.head;t.head=r}function f(s,r,t){for(var q in r){if(q=="children"){continue}if(r[q]==t[q]){continue}g(s,q,r,t)}if(r.children){for(var p=0;p<r.children.length;p++){m(s,r.children[p],t.children[p])}}}function m(u,y,p){var r=y.mark,s=a(y),v=a(p);for(var t=0;t<y.length;t++){var w=y[t],x=w.id?v[w.id]:p[t];w.index=t;if(!w.visible){continue}if(!(x&&x.visible)){var q=c(y,t,r.$exit,p);w.transition=x?2:(p.push(q),1);x=q}f(u,w,x)}for(var t=0;t<p.length;t++){var x=p[t],w=x.id?s[x.id]:y[t];if(!(w&&w.visible)&&x.visible){var q=c(p,t,r.$enter,y);if(!w){y.push(q)}else{y[w.index]=q}f(u,q,x)}}}function c(y,A,z,B){var D=pv.extend(y[A]),w=y.mark,u=w.root.scene,v=(z||k).$properties,C;if(B.target&&(C=B.target[B.length])){y=pv.extend(y);y.target=pv.extend(B.target);y.target[A]=C}var q={};for(var x=0;x<v.length;x++){q[v[x].name]=1}v=w.binds.optional.filter(function(r){return !(r.name in q)}).concat(v);w.context(y,A,function(){this.buildProperties(D,v);this.buildImplied(D)});w.root.scene=u;return D}function b(t){for(var q=0,p=0;q<t.length;q++){var r=t[q];if(r.transition!=1){t[p++]=r;if(r.transition==2){r.visible=false}if(r.children){r.children.forEach(b)}}}t.length=p}l.ease=function(p){return arguments.length?(i=typeof p=="function"?p:pv.ease(p),l):i};l.duration=function(p){return arguments.length?(j=Number(p),l):j};l.start=function(){if(h.parent){fail()}if(h.$transition){h.$transition.stop()}h.$transition=l;var p=pv.Mark.prototype.index,r=h.scene,s;h.scene=null;h.bind();h.build();s=h.scene;h.scene=r;pv.Mark.prototype.index=p;var t=Date.now(),q={};m(q,r,s);d=setInterval(function(){var v=Math.max(0,Math.min(1,(Date.now()-t)/j)),w=i(v);for(var u=q.head;u;u=u.next){u(w)}if(v==1){b(h.scene);l.stop()}pv.Scene.updateAll(r)},24)};l.stop=function(){clearInterval(d)}};pv.Transient=function(a){pv.Mark.call(this);this.fillStyle(null).strokeStyle(null).textStyle(null);this.on=function(b){return a.on(b)}};pv.Transient.prototype=pv.extend(pv.Mark);pv.simulation=function(a){return new pv.Simulation(a)};pv.Simulation=function(b){for(var a=0;a<b.length;a++){this.particle(b[a])}};pv.Simulation.prototype.particle=function(a){a.next=this.particles;if(isNaN(a.px)){a.px=a.x}if(isNaN(a.py)){a.py=a.y}if(isNaN(a.fx)){a.fx=0}if(isNaN(a.fy)){a.fy=0}this.particles=a;return this};pv.Simulation.prototype.force=function(a){a.next=this.forces;this.forces=a;return this};pv.Simulation.prototype.constraint=function(a){a.next=this.constraints;this.constraints=a;return this};pv.Simulation.prototype.stabilize=function(g){var f;if(!arguments.length){g=3}for(var a=0;a<g;a++){var b=new pv.Quadtree(this.particles);for(f=this.constraints;f;f=f.next){f.apply(this.particles,b)}}for(var d=this.particles;d;d=d.next){d.px=d.x;d.py=d.y}return this};pv.Simulation.prototype.step=function(){var h,g,i;for(h=this.particles;h;h=h.next){var b=h.px,a=h.py;h.px=h.x;h.py=h.y;h.x+=h.vx=((h.x-b)+h.fx);h.y+=h.vy=((h.y-a)+h.fy)}var d=new pv.Quadtree(this.particles);for(i=this.constraints;i;i=i.next){i.apply(this.particles,d)}for(h=this.particles;h;h=h.next){h.fx=h.fy=0}for(g=this.forces;g;g=g.next){g.apply(this.particles,d)}};pv.Quadtree=function(i){var b;var c=Number.POSITIVE_INFINITY,g=c,a=Number.NEGATIVE_INFINITY,f=a;for(b=i;b;b=b.next){if(b.x<c){c=b.x}if(b.y<g){g=b.y}if(b.x>a){a=b.x}if(b.y>f){f=b.y}}var k=a-c,j=f-g;if(k>j){f=g+k}else{a=c+j}this.xMin=c;this.yMin=g;this.xMax=a;this.yMax=f;function h(t,s,o,r,m,q){if(isNaN(s.x)||isNaN(s.y)){return}if(t.leaf){if(t.p){if((Math.abs(t.p.x-s.x)+Math.abs(t.p.y-s.y))<0.01){d(t,s,o,r,m,q)}else{var l=t.p;t.p=null;d(t,l,o,r,m,q);d(t,s,o,r,m,q)}}else{t.p=s}}else{d(t,s,o,r,m,q)}}function d(r,o,q,v,m,t){var u=(q+m)*0.5,s=(v+t)*0.5,w=o.x>=u,l=o.y>=s;r.leaf=false;switch((l<<1)+w){case 0:r=r.c1||(r.c1=new pv.Quadtree.Node());break;case 1:r=r.c2||(r.c2=new pv.Quadtree.Node());break;case 2:r=r.c3||(r.c3=new pv.Quadtree.Node());break;case 3:r=r.c4||(r.c4=new pv.Quadtree.Node());break}if(w){q=u}else{m=u}if(l){v=s}else{t=s}h(r,o,q,v,m,t)}this.root=new pv.Quadtree.Node();for(b=i;b;b=b.next){h(this.root,b,c,g,a,f)}};pv.Quadtree.Node=function(){this.leaf=true;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null};pv.Force={};pv.Force.charge=function(d){var f=2,j=1/f,g=500,h=1/g,b=0.9,a={};if(!arguments.length){d=-40}a.constant=function(k){if(arguments.length){d=Number(k);return a}return d};a.domain=function(l,k){if(arguments.length){f=Number(l);j=1/f;g=Number(k);h=1/g;return a}return[f,g]};a.theta=function(k){if(arguments.length){b=Number(k);return a}return b};function i(o){var k=0,m=0;o.cn=0;function l(n){i(n);o.cn+=n.cn;k+=n.cn*n.cx;m+=n.cn*n.cy}if(!o.leaf){if(o.c1){l(o.c1)}if(o.c2){l(o.c2)}if(o.c3){l(o.c3)}if(o.c4){l(o.c4)}}if(o.p){o.cn+=d;k+=d*o.p.x;m+=d*o.p.y}o.cx=k/o.cn;o.cy=m/o.cn}function c(o,l,m,x,k,v){var z=o.cx-l.x,y=o.cy-l.y,s=1/Math.sqrt(z*z+y*y);if((o.leaf&&(o.p!=l))||((k-m)*s<b)){if(s<h){return}if(s>j){s=j}var t=o.cn*s*s*s,r=z*t,q=y*t;l.fx+=r;l.fy+=q}else{if(!o.leaf){var w=(m+k)*0.5,u=(x+v)*0.5;if(o.c1){c(o.c1,l,m,x,w,u)}if(o.c2){c(o.c2,l,w,x,k,u)}if(o.c3){c(o.c3,l,m,u,w,v)}if(o.c4){c(o.c4,l,w,u,k,v)}if(s<h){return}if(s>j){s=j}if(o.p&&(o.p!=l)){var t=d*s*s*s,r=z*t,q=y*t;l.fx+=r;l.fy+=q}}}}a.apply=function(k,l){i(l.root);for(var m=k;m;m=m.next){c(l.root,m,l.xMin,l.yMin,l.xMax,l.yMax)}};return a};pv.Force.drag=function(a){var b={};if(!arguments.length){a=0.1}b.constant=function(c){if(arguments.length){a=c;return b}return a};b.apply=function(c){if(a){for(var d=c;d;d=d.next){d.fx-=a*d.vx;d.fy-=a*d.vy}}};return b};pv.Force.spring=function(c){var h=0.1,a=20,b,f,g={};if(!arguments.length){c=0.1}g.links=function(d){if(arguments.length){b=d;f=d.map(function(i){return 1/Math.sqrt(Math.max(i.sourceNode.linkDegree,i.targetNode.linkDegree))});return g}return b};g.constant=function(d){if(arguments.length){c=Number(d);return g}return c};g.damping=function(d){if(arguments.length){h=Number(d);return g}return h};g.length=function(d){if(arguments.length){a=Number(d);return g}return a};g.apply=function(s){for(var m=0;m<b.length;m++){var q=b[m].sourceNode,o=b[m].targetNode,u=q.x-o.x,t=q.y-o.y,n=Math.sqrt(u*u+t*t),r=n?(1/n):1,p=c*f[m],l=h*f[m],d=(p*(n-a)+l*(u*(q.vx-o.vx)+t*(q.vy-o.vy))*r)*r,k=-d*(n?u:(0.01*(0.5-Math.random()))),j=-d*(n?t:(0.01*(0.5-Math.random())));q.fx+=k;q.fy+=j;o.fx-=k;o.fy-=j}};return g};pv.Constraint={};pv.Constraint.collision=function(i){var d=1,f,h,b,g,a,c={};if(!arguments.length){f=10}c.repeat=function(k){if(arguments.length){d=Number(k);return c}return d};function j(s,q,r,B,o,z){if(!s.leaf){var A=(r+o)*0.5,y=(B+z)*0.5,x=y>b,m=y<a,t=A>h,C=A<g;if(x){if(s.c1&&t){j(s.c1,q,r,B,A,y)}if(s.c2&&C){j(s.c2,q,A,B,o,y)}}if(m){if(s.c3&&t){j(s.c3,q,r,y,A,z)}if(s.c4&&C){j(s.c4,q,A,y,o,z)}}}if(s.p&&(s.p!=q)){var E=q.x-s.p.x,D=q.y-s.p.y,u=Math.sqrt(E*E+D*D),w=f+i(s.p);if(u<w){var v=(u-w)/u*0.5;E*=v;D*=v;q.x-=E;q.y-=D;s.p.x+=E;s.p.y+=D}}}c.apply=function(n,o){var s,m,k=-Infinity;for(s=n;s;s=s.next){m=i(s);if(m>k){k=m}}for(var l=0;l<d;l++){for(s=n;s;s=s.next){m=(f=i(s))+k;h=s.x-m;g=s.x+m;b=s.y-m;a=s.y+m;j(o.root,s,o.xMin,o.yMin,o.xMax,o.yMax)}}};return c};pv.Constraint.position=function(c){var b=1,d={};if(!arguments.length){c=function(a){return a.fix}}d.alpha=function(a){if(arguments.length){b=Number(a);return d}return b};d.apply=function(f){for(var g=f;g;g=g.next){var a=c(g);if(a){g.x+=(a.x-g.x)*b;g.y+=(a.y-g.y)*b;g.fx=g.fy=g.vx=g.vy=0}}};return d};pv.Constraint.bound=function(){var b={},a,c;b.x=function(f,d){if(arguments.length){a={min:Math.min(f,d),max:Math.max(f,d)};return this}return a};b.y=function(f,d){if(arguments.length){c={min:Math.min(f,d),max:Math.max(f,d)};return this}return c};b.apply=function(d){if(a){for(var f=d;f;f=f.next){f.x=f.x<a.min?a.min:(f.x>a.max?a.max:f.x)}}if(c){for(var f=d;f;f=f.next){f.y=f.y<c.min?c.min:(f.y>c.max?c.max:f.y)}}};return b};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=function(b,a){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[b]=true;this.propertyMethod(b,false,pv.Mark.cast[b]=a);return this};pv.Layout.Network=function(){pv.Layout.call(this);var a=this;this.$id=pv.id();(this.node=new pv.Mark().data(function(){return a.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(b){return b.x}).top(function(b){return b.y})).parent=this;this.link=new pv.Mark().extend(this.node).data(function(b){return[b.sourceNode,b.targetNode]}).fillStyle(null).lineWidth(function(c,b){return b.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(b){return a.add(pv.Panel).data(function(){return a.links()}).add(b).extend(this)};(this.label=new pv.Mark().extend(this.node).textMargin(7).textBaseline("middle").text(function(b){return b.nodeName||b.nodeValue}).textAngle(function(c){var b=c.midAngle;return pv.Wedge.upright(b)?b:(b+Math.PI)}).textAlign(function(b){return pv.Wedge.upright(b.midAngle)?"left":"right"})).parent=this};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(a){return a.map(function(c,b){if(typeof c!="object"){c={nodeValue:c}}c.index=b;return c})}).property("links",function(a){return a.map(function(b){if(isNaN(b.linkValue)){b.linkValue=isNaN(b.value)?1:b.value}return b})});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this};pv.Layout.Network.prototype.buildProperties=function(b,a){if((b.$id||0)<this.$id){pv.Layout.prototype.buildProperties.call(this,b,a)}};pv.Layout.Network.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);if(a.$id>=this.$id){return true}a.$id=this.$id;a.nodes.forEach(function(b){b.linkDegree=0});a.links.forEach(function(c){var b=c.linkValue;(c.sourceNode||(c.sourceNode=a.nodes[c.source])).linkDegree+=b;(c.targetNode||(c.targetNode=a.nodes[c.target])).linkDegree+=b})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(a){if(!a.links){a.links=pv.Layout.Hierarchy.links.call(this)}pv.Layout.Network.prototype.buildImplied.call(this,a)};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(a){return a.parentNode}).map(function(a){return{sourceNode:a,targetNode:a.parentNode,linkValue:1}})};pv.Layout.Hierarchy.NodeLink={buildImplied:function(r){var a=r.nodes,f=r.orient,b=/^(top|bottom)$/.test(f),q=r.width,k=r.height;if(f=="radial"){var l=r.innerRadius,j=r.outerRadius;if(l==null){l=0}if(j==null){j=Math.min(q,k)/2}}function m(h){return h.parentNode?(h.depth*(j-l)+l):0}function d(h){return(h.parentNode?(h.breadth-0.25)*2*Math.PI:0)}function p(h){switch(f){case"left":return h.depth*q;case"right":return q-h.depth*q;case"top":return h.breadth*q;case"bottom":return q-h.breadth*q;case"radial":return q/2+m(h)*Math.cos(h.midAngle)}}function o(h){switch(f){case"left":return h.breadth*k;case"right":return k-h.breadth*k;case"top":return h.depth*k;case"bottom":return k-h.depth*k;case"radial":return k/2+m(h)*Math.sin(h.midAngle)}}for(var g=0;g<a.length;g++){var c=a[g];c.midAngle=f=="radial"?d(c):b?Math.PI/2:0;c.x=p(c);c.y=o(c);if(c.firstChild){c.midAngle+=Math.PI}}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(a){return a.dx}).height(function(a){return a.dy}).innerRadius(function(a){return a.innerRadius}).outerRadius(function(a){return a.outerRadius}).startAngle(function(a){return a.startAngle}).angle(function(a){return a.angle});this.label.textAlign("center").left(function(a){return a.x+(a.dx/2)}).top(function(a){return a.y+(a.dy/2)});delete this.link},buildImplied:function(m){var p=m.nodes,g=m.orient,z=/^(top|bottom)$/.test(g),k=m.width,u=m.height,A=-p[0].minDepth;if(g=="radial"){var a=m.innerRadius,c=m.outerRadius;if(a==null){a=0}if(a){A*=2}if(c==null){c=Math.min(k,u)/2}}function B(i,h){return(i+h)/(1+h)}function f(h){switch(g){case"left":return B(h.minDepth,A)*k;case"right":return(1-B(h.maxDepth,A))*k;case"top":return h.minBreadth*k;case"bottom":return(1-h.maxBreadth)*k;case"radial":return k/2}}function d(h){switch(g){case"left":return h.minBreadth*u;case"right":return(1-h.maxBreadth)*u;case"top":return B(h.minDepth,A)*u;case"bottom":return(1-B(h.maxDepth,A))*u;case"radial":return u/2}}function l(h){switch(g){case"left":case"right":return(h.maxDepth-h.minDepth)/(1+A)*k;case"top":case"bottom":return(h.maxBreadth-h.minBreadth)*k;case"radial":return h.parentNode?(h.innerRadius+h.outerRadius)*Math.cos(h.midAngle):0}}function j(h){switch(g){case"left":case"right":return(h.maxBreadth-h.minBreadth)*u;case"top":case"bottom":return(h.maxDepth-h.minDepth)/(1+A)*u;case"radial":return h.parentNode?(h.innerRadius+h.outerRadius)*Math.sin(h.midAngle):0}}function b(h){return Math.max(0,B(h.minDepth,A/2))*(c-a)+a}function q(h){return B(h.maxDepth,A/2)*(c-a)+a}function r(h){return(h.parentNode?h.minBreadth-0.25:0)*2*Math.PI}function v(h){return(h.parentNode?h.maxBreadth-h.minBreadth:1)*2*Math.PI}for(var t=0;t<p.length;t++){var o=p[t];o.x=f(o);o.y=d(o);if(g=="radial"){o.innerRadius=b(o);o.outerRadius=q(o);o.startAngle=r(o);o.angle=v(o);o.midAngle=o.startAngle+o.angle/2}else{o.midAngle=z?-Math.PI/2:0}o.dx=l(o);o.dy=j(o)}}};pv.Layout.Grid=function(){pv.Layout.call(this);var a=this;(this.cell=new pv.Mark().data(function(){return a.scene[a.index].$grid}).width(function(){return a.width()/a.cols()}).height(function(){return a.height()/a.rows()}).left(function(){return this.width()*(this.index%a.cols())}).top(function(){return this.height()*Math.floor(this.index/a.cols())})).parent=this};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=new pv.Layout.Grid().extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);var b=a.rows,d=a.cols;if(typeof d=="object"){b=pv.transpose(d)}if(typeof b=="object"){a.$grid=pv.blend(b);a.rows=b.length;a.cols=b[0]?b[0].length:0}else{a.$grid=pv.repeat([a.data],b*d)}};pv.Layout.Stack=function(){pv.Layout.call(this);var f=this,c=function(){return null},g={t:c,l:c,r:c,b:c,w:c,h:c},a,d=f.buildImplied;function b(h){return function(){return g[h](this.parent.index,this.index)}}this.buildImplied=function(H){d.call(this,H);var X=H.layers,N=X.length,P,C=H.orient,V=/^(top|bottom)\b/.test(C),U=this.parent[V?"height":"width"](),B=[],A=[],D=[];var t=pv.Mark.stack,M={parent:{parent:this}};t.unshift(null);a=[];for(var T=0;T<N;T++){D[T]=[];A[T]=[];M.parent.index=T;t[0]=X[T];a[T]=this.$values.apply(M.parent,t);if(!T){P=a[T].length}t.unshift(null);for(var R=0;R<P;R++){t[0]=a[T][R];M.index=R;if(!T){B[R]=this.$x.apply(M,t)}D[T][R]=this.$y.apply(M,t)}t.shift()}t.shift();var u;switch(H.order){case"inside-out":var S=D.map(function(h){return pv.max.index(h)}),W=pv.range(N).sort(function(i,h){return S[i]-S[h]}),F=D.map(function(h){return pv.sum(h)}),J=0,w=0,v=[],O=[];for(var T=0;T<N;T++){var R=W[T];if(J<w){J+=F[R];v.push(R)}else{w+=F[R];O.push(R)}}u=O.reverse().concat(v);break;case"reverse":u=pv.range(N-1,-1,-1);break;default:u=pv.range(N);break}switch(H.offset){case"silohouette":for(var R=0;R<P;R++){var M=0;for(var T=0;T<N;T++){M+=D[T][R]}A[u[0]][R]=(U-M)/2}break;case"wiggle":var M=0;for(var T=0;T<N;T++){M+=D[T][0]}A[u[0]][0]=M=(U-M)/2;for(var R=1;R<P;R++){var r=0,q=0,E=B[R]-B[R-1];for(var T=0;T<N;T++){r+=D[T][R]}for(var T=0;T<N;T++){var l=(D[u[T]][R]-D[u[T]][R-1])/(2*E);for(var Q=0;Q<T;Q++){l+=(D[u[Q]][R]-D[u[Q]][R-1])/E}q+=l*D[u[T]][R]}A[u[0]][R]=M-=r?q/r*E:0}break;case"expand":for(var R=0;R<P;R++){A[u[0]][R]=0;var Q=0;for(var T=0;T<N;T++){Q+=D[T][R]}if(Q){Q=U/Q;for(var T=0;T<N;T++){D[T][R]*=Q}}else{Q=U/N;for(var T=0;T<N;T++){D[T][R]=Q}}}break;default:for(var R=0;R<P;R++){A[u[0]][R]=0}break}for(var R=0;R<P;R++){var M=A[u[0]][R];for(var T=1;T<N;T++){M+=D[u[T-1]][R];A[u[T]][R]=M}}var T=C.indexOf("-"),z=V?"h":"w",I=T<0?(V?"l":"b"):C.charAt(T+1),G=C.charAt(0);for(var K in g){g[K]=c}g[I]=function(k,h){return B[h]};g[G]=function(k,h){return A[k][h]};g[z]=function(k,h){return D[k][h]}};this.layer=new pv.Mark().data(function(){return a[this.parent.index]}).top(b("t")).left(b("l")).right(b("r")).bottom(b("b")).width(b("w")).height(b("h"));this.layer.add=function(h){return f.add(pv.Panel).data(function(){return f.layers()}).add(h).extend(this)}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=new pv.Layout.Stack().extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0};pv.Layout.Stack.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Stack.prototype.y=function(a){this.$y=pv.functor(a);return this};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(a){this.$values=pv.functor(a);return this};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(a){return a.dx}).height(function(a){return a.dy});this.label.visible(function(a){return !a.firstChild}).left(function(a){return a.x+(a.dx/2)}).top(function(a){return a.y+(a.dy/2)}).textAlign("center").textAngle(function(a){return a.dx>a.dy?0:-Math.PI/2});(this.leaf=new pv.Mark().extend(this.node).fillStyle(null).strokeStyle(null).visible(function(a){return !a.firstChild})).parent=this;delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=new pv.Layout.Treemap().extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.padding=function(a){return this.paddingLeft(a).paddingRight(a).paddingTop(a).paddingBottom(a)};pv.Layout.Treemap.prototype.$size=function(a){return Number(a.nodeValue)};pv.Layout.Treemap.prototype.size=function(a){this.$size=pv.functor(a);return this};pv.Layout.Treemap.prototype.buildImplied=function(p){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,p)){return}var g=this,b=p.nodes,j=b[0],k=pv.Mark.stack,c=p.paddingLeft,m=p.paddingRight,i=p.paddingTop,a=p.paddingBottom,o=function(q){return q.size},n=p.round?Math.round:Number,f=p.mode;function l(C,u,q,A,z,B,t){for(var s=0,v=0;s<C.length;s++){var r=C[s];if(q){r.x=A+v;r.y=z;v+=r.dx=n(B*r.size/u);r.dy=t}else{r.x=A;r.y=z+v;r.dx=B;v+=r.dy=n(t*r.size/u)}}if(r){if(q){r.dx+=B-v}else{r.dy+=t-v}}}function h(x,q){var y=-Infinity,t=Infinity,v=0;for(var u=0;u<x.length;u++){var w=x[u].size;if(w<t){t=w}if(w>y){y=w}v+=w}v=v*v;q=q*q;return Math.max(q*y/v,v/(q*t))}function d(s,v){var D=s.x+c,C=s.y+i,E=s.dx-c-m,A=s.dy-i-a;if(f!="squarify"){l(s.childNodes,s.size,f=="slice"?true:f=="dice"?false:v&1,D,C,E,A);return}var F=[],B=Infinity,t=Math.min(E,A),u=E*A/s.size;if(s.size<=0){return}s.visitBefore(function(w){w.size*=u});function z(G){var w=E==t,x=pv.sum(G,o),y=t?n(x/t):0;l(G,x,w,D,C,w?E:y,w?y:A);if(w){C+=y;A-=y}else{D+=y;E-=y}t=Math.min(E,A);return w}var r=s.childNodes.slice();while(r.length){var q=r[r.length-1];if(!q.size){r.pop();continue}F.push(q);var u=h(F,t);if(u<=B){r.pop();B=u}else{F.pop();z(F);F.length=0;B=Infinity}}if(z(F)){for(var v=0;v<F.length;v++){F[v].dy+=A}}else{for(var v=0;v<F.length;v++){F[v].dx+=E}}}k.unshift(null);j.visitAfter(function(r,q){r.depth=q;r.x=r.y=r.dx=r.dy=0;r.size=r.firstChild?pv.sum(r.childNodes,function(s){return s.size}):g.$size.apply(g,(k[0]=r,k))});k.shift();switch(p.order){case"ascending":j.sort(function(r,q){return r.size-q.size});break;case"descending":j.sort(function(r,q){return q.size-r.size});break;case"reverse":j.reverse();break}j.x=0;j.y=0;j.dx=p.width;j.dy=p.height;j.visitBefore(d)};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=new pv.Layout.Tree().extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(l){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,l)){return}var o=l.nodes,i=l.orient,z=l.depth,k=l.breadth,b=l.group,j=l.width,t=l.height;function u(w){var s,y,h;if(!w.firstChild){if(s=w.previousSibling){w.prelim=s.prelim+a(w.depth,true)}}else{s=w.firstChild;y=w.lastChild;h=s;for(var B=s;B;B=B.nextSibling){u(B);h=n(B,h)}g(w);var x=0.5*(s.prelim+y.prelim);if(s=w.previousSibling){w.prelim=s.prelim+a(w.depth,true);w.mod=w.prelim-x}else{w.prelim=x}}}function p(s,h,w){s.breadth=s.prelim+h;h+=s.mod;for(var x=s.firstChild;x;x=x.nextSibling){p(x,h,w)}}function n(K,I){var J=K.previousSibling;if(J){var y=K,x=K,C=J,B=K.parentNode.firstChild,E=y.mod,D=x.mod,G=C.mod,F=B.mod,H=A(C),h=r(y);while(H&&h){C=H;y=h;B=r(B);x=A(x);x.ancestor=K;var s=(C.prelim+G)-(y.prelim+E)+a(C.depth,false);if(s>0){m(v(C,K,I),K,s);E+=s;D+=s}G+=C.mod;E+=y.mod;F+=B.mod;D+=x.mod;H=A(C);h=r(y)}if(H&&!A(x)){x.thread=H;x.mod+=G-D}if(h&&!r(B)){B.thread=h;B.mod+=E-F;I=K}}return I}function r(h){return h.firstChild||h.thread}function A(h){return h.lastChild||h.thread}function m(w,s,h){var x=s.number-w.number;s.change-=h/x;s.shift+=h;w.change+=h/x;s.prelim+=h;s.mod+=h}function g(s){var h=0,x=0;for(var w=s.lastChild;w;w=w.previousSibling){w.prelim+=h;w.mod+=h;x+=w.change;h+=w.shift+x}}function v(w,s,h){return(w.ancestor.parentNode==s.parentNode)?w.ancestor:h}function a(s,h){return(h?1:(b+1))/((i=="radial")?s:1)}var q=o[0];q.visitAfter(function(h,s){h.ancestor=h;h.prelim=0;h.mod=0;h.change=0;h.shift=0;h.number=h.previousSibling?(h.previousSibling.number+1):0;h.depth=s});u(q);p(q,-q.prelim,0);function f(h){return(i=="radial")?h.breadth/z:0}function d(h){switch(i){case"left":return h.depth;case"right":return j-h.depth;case"top":case"bottom":return h.breadth+j/2;case"radial":return j/2+h.depth*Math.cos(f(h))}}function c(h){switch(i){case"left":case"right":return h.breadth+t/2;case"top":return h.depth;case"bottom":return t-h.depth;case"radial":return t/2+h.depth*Math.sin(f(h))}}q.visitAfter(function(h){h.breadth*=k;h.depth*=z;h.midAngle=f(h);h.x=d(h);h.y=c(h);if(h.firstChild){h.midAngle+=Math.PI}delete h.breadth;delete h.depth;delete h.ancestor;delete h.prelim;delete h.mod;delete h.change;delete h.shift;delete h.number;delete h.thread})};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=new pv.Layout.Indent().extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(c){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){return}var b=c.nodes,h=c.breadth,g=c.depth,f=0,d=0;function a(l,k,i){l.x=f+i++*g;l.y=d+k++*h;l.midAngle=0;for(var j=l.firstChild;j;j=j.nextSibling){k=a(j,k,i)}return k}a(b[0],1,1)};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.shapeRadius(function(a){return a.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=new pv.Layout.Pack().extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(a){this.$radius=typeof a=="function"?function(){return Math.sqrt(a.apply(this,arguments))}:(a=Math.sqrt(a),function(){return a});return this};pv.Layout.Pack.prototype.buildImplied=function(o){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,o)){return}var j=this,a=o.nodes,l=a[0];function g(k){var h=pv.Mark.stack;h.unshift(null);for(var p=0,r=k.length;p<r;p++){var q=k[p];if(!q.firstChild){q.radius=j.$radius.apply(j,(h[0]=q,h))}}h.shift()}function n(p){var h=[];for(var k=p.firstChild;k;k=k.nextSibling){if(k.firstChild){k.radius=n(k)}k.n=k.p=k;h.push(k)}switch(o.order){case"ascending":h.sort(function(r,q){return r.radius-q.radius});break;case"descending":h.sort(function(r,q){return q.radius-r.radius});break;case"reverse":h.reverse();break}return f(h)}function f(A){var E=Infinity,I=-Infinity,h=Infinity,u=-Infinity,H,G,F,C,B;function q(k){E=Math.min(k.x-k.radius,E);I=Math.max(k.x+k.radius,I);h=Math.min(k.y-k.radius,h);u=Math.max(k.y+k.radius,u)}function r(K,k){var M=K.n;K.n=k;k.p=K;k.n=M;M.p=k}function J(K,k){K.n=k;k.p=K}function s(M,k){var N=k.x-M.x,K=k.y-M.y,O=M.radius+k.radius;return(O*O-N*N-K*K)>0.001}H=A[0];H.x=-H.radius;H.y=0;q(H);if(A.length>1){G=A[1];G.x=G.radius;G.y=0;q(G);if(A.length>2){F=A[2];d(H,G,F);q(F);r(H,F);H.p=F;r(F,G);G=H.n;for(var D=3;D<A.length;D++){d(H,G,F=A[D]);var p=0,v=1,t=1;for(C=G.n;C!=G;C=C.n,v++){if(s(C,F)){p=1;break}}if(p==1){for(B=H.p;B!=C.p;B=B.p,t++){if(s(B,F)){if(t<v){p=-1;C=B}break}}}if(p==0){r(H,F);G=F;q(F)}else{if(p>0){J(H,C);G=C;D--}else{if(p<0){J(C,G);H=C;D--}}}}}}var x=(E+I)/2,w=(h+u)/2,y=0;for(var D=0;D<A.length;D++){var z=A[D];z.x-=x;z.y-=w;y=Math.max(y,z.radius+Math.sqrt(z.x*z.x+z.y*z.y))}return y+o.spacing}function d(t,r,q){var z=r.radius+q.radius,w=t.radius+q.radius,A=r.x-t.x,y=r.y-t.y,v=Math.sqrt(A*A+y*y),u=(w*w+v*v-z*z)/(2*w*v),k=Math.acos(u),s=u*w,p=Math.sin(k)*w;A/=v;y/=v;q.x=t.x+s*A+p*y;q.y=t.y+s*y-p*A}function b(s,h,r,p){for(var q=s.firstChild;q;q=q.nextSibling){q.x+=s.x;q.y+=s.y;b(q,h,r,p)}s.x=h+p*s.x;s.y=r+p*s.y;s.radius*=p}g(a);l.x=0;l.y=0;l.radius=n(l);var m=this.width(),i=this.height(),c=1/Math.max(2*l.radius/m,2*l.radius/i);b(l,m/2,i/2,c)};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(b,a){return Math.sqrt(a.linkValue)*1.5});this.label.textAlign("center")};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=new pv.Layout.Force().extend(pv.Layout.Network.prototype.defaults).dragConstant(0.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(0.9).springConstant(0.1).springDamping(0.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(t){if(pv.Layout.Network.prototype.buildImplied.call(this,t)){var m=t.$force;if(m){m.next=this.binds.$force;this.binds.$force=m}return}var o=this,a=t.nodes,r=t.links,g=t.iterations,q=t.width,l=t.height;for(var j=0,c;j<a.length;j++){c=a[j];if(isNaN(c.x)){c.x=q/2+40*Math.random()-20}if(isNaN(c.y)){c.y=l/2+40*Math.random()-20}}var p=pv.simulation(a);p.force(pv.Force.drag(t.dragConstant));p.force(pv.Force.charge(t.chargeConstant).domain(t.chargeMinDistance,t.chargeMaxDistance).theta(t.chargeTheta));p.force(pv.Force.spring(t.springConstant).damping(t.springDamping).length(t.springLength).links(r));p.constraint(pv.Constraint.position());if(t.bound){p.constraint(pv.Constraint.bound().x(6,q-6).y(6,l-6))}function d(f){return f.fix?1:f.vx*f.vx+f.vy*f.vy}if(g==null){p.step();p.step();var b=t.$force=this.binds.$force={next:this.binds.$force,nodes:a,min:0.0001*(r.length+1),sim:p};if(!this.$timer){this.$timer=setInterval(function(){var h=false;for(var i=o.binds.$force;i;i=i.next){if(pv.max(i.nodes,d)>i.min){i.sim.step();h=true}}if(h){o.render()}},42)}}else{for(var j=0;j<g;j++){p.step()}}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var a,b=this.buildImplied;this.buildImplied=function(c){b.call(this,c);a=/^(top|bottom)$/.test(c.orient)?"step-before":/^(left|right)$/.test(c.orient)?"step-after":"linear"};this.link.interpolate(function(){return a})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=new pv.Layout.Cluster().extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(c){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){return}var a=c.nodes[0],g=c.group,i,h,f=0,b=0.5-g/2;var d=undefined;a.visitAfter(function(j){if(j.firstChild){j.depth=1+pv.max(j.childNodes,function(k){return k.depth})}else{if(g&&(d!=j.parentNode)){d=j.parentNode;f+=g}f++;j.depth=0}});i=1/f;h=1/a.depth;var d=undefined;a.visitAfter(function(j){if(j.firstChild){j.breadth=pv.mean(j.childNodes,function(k){return k.breadth})}else{if(g&&(d!=j.parentNode)){d=j.parentNode;b+=g}j.breadth=i*b++}j.depth=1-j.depth*h});a.visitAfter(function(j){j.minBreadth=j.firstChild?j.firstChild.minBreadth:(j.breadth-i/2);j.maxBreadth=j.firstChild?j.lastChild.maxBreadth:(j.breadth+i/2)});a.visitBefore(function(j){j.minDepth=j.parentNode?j.parentNode.maxDepth:0;j.maxDepth=j.parentNode?(j.depth+a.depth):(j.minDepth+2*a.depth)});a.minDepth=-h;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,c)};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(a){if(pv.Layout.Cluster.prototype.buildImplied.call(this,a)){return}pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=new pv.Layout.Partition().extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(a){this.$size=a;return this};pv.Layout.Partition.prototype.buildImplied=function(c){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){return}var d=this,b=c.nodes[0],a=pv.Mark.stack,g=0;a.unshift(null);b.visitAfter(function(j,h){if(h>g){g=h}j.size=j.firstChild?pv.sum(j.childNodes,function(i){return i.size}):d.$size.apply(d,(a[0]=j,a))});a.shift();switch(c.order){case"ascending":b.sort(function(i,h){return i.size-h.size});break;case"descending":b.sort(function(h,i){return i.size-h.size});break}var f=1/g;b.minBreadth=0;b.breadth=0.5;b.maxBreadth=1;b.visitBefore(function(k){var h=k.minBreadth,i=k.maxBreadth-h;for(var j=k.firstChild;j;j=j.nextSibling){j.minBreadth=h;j.maxBreadth=h+=(j.size/k.size)*i;j.breadth=(h+j.minBreadth)/2}});b.visitAfter(function(j,h){j.minDepth=(h-1)*f;j.maxDepth=j.depth=h*f});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,c)};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(a){if(pv.Layout.Partition.prototype.buildImplied.call(this,a)){return}pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var b,d,a,c=this.buildImplied;this.buildImplied=function(f){c.call(this,f);d=f.directed;b=f.orient=="radial"?"linear":"polar";a=f.orient=="right"||f.orient=="top"};this.link.data(function(h){var g=h.sourceNode,f=h.targetNode;return a!=(d||(g.breadth<f.breadth))?[g,f]:[f,g]}).interpolate(function(){return b})};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=new pv.Layout.Arc().extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(a){this.$sort=a;return this};pv.Layout.Arc.prototype.buildImplied=function(u){if(pv.Layout.Network.prototype.buildImplied.call(this,u)){return}var c=u.nodes,g=u.orient,k=this.$sort,m=pv.range(c.length),t=u.width,l=u.height,a=Math.min(t,l)/2;if(k){m.sort(function(i,h){return k(c[i],c[h])})}function f(h){switch(g){case"top":return -Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(h-0.25)*2*Math.PI}}function q(h){switch(g){case"top":case"bottom":return h*t;case"left":return 0;case"right":return t;case"radial":return t/2+a*Math.cos(f(h))}}function p(h){switch(g){case"top":return 0;case"bottom":return l;case"left":case"right":return h*l;case"radial":return l/2+a*Math.sin(f(h))}}for(var j=0;j<c.length;j++){var d=c[m[j]],o=d.breadth=(j+0.5)/c.length;d.x=q(o);d.y=p(o);d.midAngle=f(o)}};pv.Layout.Horizon=function(){pv.Layout.call(this);var d=this,f,i,b,h,g,a,c=this.buildImplied;this.buildImplied=function(j){c.call(this,j);f=j.bands;i=j.mode;b=Math.round((i=="color"?0.5:1)*j.height);h=j.backgroundStyle;g=pv.ramp(h,j.negativeStyle).domain(0,f);a=pv.ramp(h,j.positiveStyle).domain(0,f)};var f=new pv.Panel().data(function(){return pv.range(f*2)}).overflow("hidden").height(function(){return b}).top(function(j){return i=="color"?(j&1)*b:0}).fillStyle(function(j){return j?null:h});this.band=new pv.Mark().top(function(k,j){return i=="mirror"&&j&1?(j+1>>1)*b:null}).bottom(function(k,j){return i=="mirror"?(j&1?null:(j+1>>1)*-b):((j&1||-1)*(j+1>>1)*b)}).fillStyle(function(k,j){return(j&1?g:a)((j>>1)+1)});this.band.add=function(j){return d.add(pv.Panel).extend(f).add(j).extend(this)}};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);pv.Layout.Horizon.prototype.defaults=new pv.Layout.Horizon().extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var d=this,b,a,c=d.buildImplied;this.buildImplied=function(f){c.call(this,f);b=f.$rollup.nodes;a=f.$rollup.links};this.node.data(function(){return b}).shapeSize(function(f){return f.nodes.length*20});this.link.interpolate("polar").eccentricity(0.8);this.link.add=function(f){return d.add(pv.Panel).data(function(){return a}).add(f).extend(this)}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Rollup.prototype.y=function(a){this.$y=pv.functor(a);return this};pv.Layout.Rollup.prototype.buildImplied=function(q){if(pv.Layout.Network.prototype.buildImplied.call(this,q)){return}var v=q.nodes,a=q.links,d=q.directed,u=v.length,k=[],j=[],C=0,w={},b={};function r(n){return k[n]+","+j[n]}var g=pv.Mark.stack,t={parent:this};g.unshift(null);for(var A=0;A<u;A++){t.index=A;g[0]=v[A];k[A]=this.$x.apply(t,g);j[A]=this.$y.apply(t,g)}g.shift();for(var A=0;A<v.length;A++){var m=r(A),l=w[m];if(!l){l=w[m]=pv.extend(v[A]);l.index=C++;l.x=k[A];l.y=j[A];l.nodes=[]}l.nodes.push(v[A])}for(var A=0;A<a.length;A++){var z=a[A].sourceNode,D=a[A].targetNode,B=w[r(z.index)],c=w[r(D.index)],h=!d&&B.index>c.index,f=h?c.index+","+B.index:B.index+","+c.index,p=b[f];if(!p){p=b[f]={sourceNode:B,targetNode:c,linkValue:0,links:[]}}p.links.push(a[A]);p.linkValue+=a[A].linkValue}q.$rollup={nodes:pv.values(w),links:pv.values(b)}};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var d=this,h,b,a,g,f,c=d.buildImplied;this.buildImplied=function(i){c.call(this,i);h=i.nodes.length;b=i.width/h;a=i.height/h;g=i.$matrix.labels;f=i.$matrix.pairs};this.link.data(function(){return f}).left(function(){return b*(this.index%h)}).top(function(){return a*Math.floor(this.index/h)}).width(function(){return b}).height(function(){return a}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(i){return i.linkValue?"#555":"#eee"}).parent=this;delete this.link.add;this.label.data(function(){return g}).left(function(){return this.index&1?b*((this.index>>1)+0.5):0}).top(function(){return this.index&1?0:a*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(a){this.$sort=a;return this};pv.Layout.Matrix.prototype.buildImplied=function(f){if(pv.Layout.Network.prototype.buildImplied.call(this,f)){return}var k=f.nodes,c=f.links,v=this.$sort,h=k.length,d=pv.range(h),u=[],A=[],y={};f.$matrix={labels:u,pairs:A};if(v){d.sort(function(j,i){return v(k[j],k[i])})}for(var t=0;t<h;t++){for(var r=0;r<h;r++){var x=d[t],w=d[r],g={row:t,col:r,sourceNode:k[x],targetNode:k[w],linkValue:0};A.push(y[x+"."+w]=g)}}for(var t=0;t<h;t++){var x=d[t];u.push(k[x],k[x])}for(var t=0;t<c.length;t++){var q=c[t],m=q.sourceNode.index,z=q.targetNode.index,o=q.linkValue;y[m+"."+z].linkValue+=o;if(!f.directed){y[z+"."+m].linkValue+=o}}};pv.Layout.Bullet=function(){pv.Layout.call(this);var g=this,f=g.buildImplied,h=g.x=pv.Scale.linear(),c,b,i,d,a;this.buildImplied=function(j){f.call(this,a=j);c=j.orient;b=/^left|right$/.test(c);i=pv.ramp("#bbb","#eee").domain(0,Math.max(1,a.ranges.length-1));d=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,a.measures.length-1))};(this.range=new pv.Mark()).data(function(){return a.ranges}).reverse(true).left(function(){return c=="left"?0:null}).top(function(){return c=="top"?0:null}).right(function(){return c=="right"?0:null}).bottom(function(){return c=="bottom"?0:null}).width(function(j){return b?h(j):null}).height(function(j){return b?null:h(j)}).fillStyle(function(){return i(this.index)}).antialias(false).parent=g;(this.measure=new pv.Mark()).extend(this.range).data(function(){return a.measures}).left(function(){return c=="left"?0:b?null:this.parent.width()/3.25}).top(function(){return c=="top"?0:b?this.parent.height()/3.25:null}).right(function(){return c=="right"?0:b?null:this.parent.width()/3.25}).bottom(function(){return c=="bottom"?0:b?this.parent.height()/3.25:null}).fillStyle(function(){return d(this.index)}).parent=g;(this.marker=new pv.Mark()).data(function(){return a.markers}).left(function(j){return c=="left"?h(j):b?null:this.parent.width()/2}).top(function(j){return c=="top"?h(j):b?this.parent.height()/2:null}).right(function(j){return c=="right"?h(j):null}).bottom(function(j){return c=="bottom"?h(j):null}).strokeStyle("black").shape("bar").shapeAngle(function(){return b?0:Math.PI/2}).parent=g;(this.tick=new pv.Mark()).data(function(){return h.ticks(7)}).left(function(j){return c=="left"?h(j):null}).top(function(j){return c=="top"?h(j):null}).right(function(j){return c=="right"?h(j):b?null:-6}).bottom(function(j){return c=="bottom"?h(j):b?-8:null}).height(function(){return b?6:null}).width(function(){return b?null:6}).parent=g};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=new pv.Layout.Bullet().extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype.buildImplied=function(b){pv.Layout.prototype.buildImplied.call(this,b);var a=this.parent[/^left|right$/.test(b.orient)?"width":"height"]();b.maximum=b.maximum||pv.max([].concat(b.ranges,b.markers,b.measures));this.x.domain(0,b.maximum).range(0,a)};pv.Behavior={};pv.Behavior.drag=function(){var g,c,f,i,a;function b(k){c=this.index;g=this.scene;var j=this.mouse();i=((f=k).fix=pv.vector(k.x,k.y)).minus(j);a={x:this.parent.width()-(k.dx||0),y:this.parent.height()-(k.dy||0)};g.mark.context(g,c,function(){this.render()});pv.Mark.dispatch("dragstart",g,c)}function d(){if(!g){return}g.mark.context(g,c,function(){var j=this.mouse();f.x=f.fix.x=Math.max(0,Math.min(i.x+j.x,a.x));f.y=f.fix.y=Math.max(0,Math.min(i.y+j.y,a.y));this.render()});pv.Mark.dispatch("drag",g,c)}function h(){if(!g){return}f.fix=null;g.mark.context(g,c,function(){this.render()});pv.Mark.dispatch("dragend",g,c);g=null}pv.listen(window,"mousemove",d);pv.listen(window,"mouseup",h);return b};pv.Behavior.point=function(a){var i,h=null,g=1,f=1,b=arguments.length?a*a:900;function j(w,x){var E=w[x],z={cost:Infinity};for(var u=0,o=E.visible&&E.children.length;u<o;u++){var l=E.children[u],r=l.mark,k;if(r.type=="panel"){r.scene=l;for(var t=0,q=l.length;t<q;t++){r.index=t;k=j(l,t);if(k.cost<z.cost){z=k}}delete r.scene;delete r.index}else{if(r.$handlers.point){var B=r.mouse();for(var t=0,q=l.length;t<q;t++){var y=l[t],D=B.x-y.left-(y.width||0)/2,C=B.y-y.top-(y.height||0)/2,A=g*D*D+f*C*C;if(A<z.cost){z.distance=D*D+C*C;z.cost=A;z.scene=l;z.index=t}}}}}return z}function d(){var k=j(this.scene,this.index);if((k.cost==Infinity)||(k.distance>b)){k=null}if(i){if(k&&(i.scene==k.scene)&&(i.index==k.index)){return}pv.Mark.dispatch("unpoint",i.scene,i.index)}if(i=k){pv.Mark.dispatch("point",k.scene,k.index);pv.listen(this.root.canvas(),"mouseout",c)}}function c(k){if(i&&!pv.ancestor(this,k.relatedTarget)){pv.Mark.dispatch("unpoint",i.scene,i.index);i=null}}d.collapse=function(k){if(arguments.length){h=String(k);switch(h){case"y":g=1;f=0;break;case"x":g=0;f=1;break;default:g=1;f=1;break}return d}return h};return d};pv.Behavior.select=function(){var g,c,f,b;function a(i){c=this.index;g=this.scene;b=this.mouse();f=i;f.x=b.x;f.y=b.y;f.dx=f.dy=0;pv.Mark.dispatch("selectstart",g,c)}function d(){if(!g){return}g.mark.context(g,c,function(){var i=this.mouse();f.x=Math.max(0,Math.min(b.x,i.x));f.y=Math.max(0,Math.min(b.y,i.y));f.dx=Math.min(this.width(),Math.max(i.x,b.x))-f.x;f.dy=Math.min(this.height(),Math.max(i.y,b.y))-f.y;this.render()});pv.Mark.dispatch("select",g,c)}function h(){if(!g){return}pv.Mark.dispatch("selectend",g,c);g=null}pv.listen(window,"mousemove",d);pv.listen(window,"mouseup",h);return a};pv.Behavior.resize=function(d){var h,c,g,b;function a(j){c=this.index;h=this.scene;b=this.mouse();g=j;switch(d){case"left":b.x=g.x+g.dx;break;case"right":b.x=g.x;break;case"top":b.y=g.y+g.dy;break;case"bottom":b.y=g.y;break}pv.Mark.dispatch("resizestart",h,c)}function f(){if(!h){return}h.mark.context(h,c,function(){var j=this.mouse();g.x=Math.max(0,Math.min(b.x,j.x));g.y=Math.max(0,Math.min(b.y,j.y));g.dx=Math.min(this.parent.width(),Math.max(j.x,b.x))-g.x;g.dy=Math.min(this.parent.height(),Math.max(j.y,b.y))-g.y;this.render()});pv.Mark.dispatch("resize",h,c)}function i(){if(!h){return}pv.Mark.dispatch("resizeend",h,c);h=null}pv.listen(window,"mousemove",f);pv.listen(window,"mouseup",i);return a};pv.Behavior.pan=function(){var f,h,j,i,c,b;function a(){h=this.index;f=this.scene;i=pv.vector(pv.event.pageX,pv.event.pageY);j=this.transform();c=1/(j.k*this.scale);if(b){b={x:(1-j.k)*this.width(),y:(1-j.k)*this.height()}}}function g(){if(!f){return}f.mark.context(f,h,function(){var l=(pv.event.pageX-i.x)*c,n=(pv.event.pageY-i.y)*c,k=j.translate(l,n);if(b){k.x=Math.max(b.x,Math.min(0,k.x));k.y=Math.max(b.y,Math.min(0,k.y))}this.transform(k).render()});pv.Mark.dispatch("pan",f,h)}function d(){f=null}a.bound=function(k){if(arguments.length){b=Boolean(k);return this}return Boolean(b)};pv.listen(window,"mousemove",g);pv.listen(window,"mouseup",d);return a};pv.Behavior.zoom=function(c){var b;if(!arguments.length){c=1/48}function a(){var g=this.mouse(),f=pv.event.wheel*c,d=this.transform().translate(g.x,g.y).scale((f<0)?(1000/(1000-f)):((1000+f)/1000)).translate(-g.x,-g.y);if(b){d.k=Math.max(1,d.k);d.x=Math.max((1-d.k)*this.width(),Math.min(0,d.x));d.y=Math.max((1-d.k)*this.height(),Math.min(0,d.y))}this.transform(d).render();pv.Mark.dispatch("zoom",this.scene,this.index)}a.bound=function(d){if(arguments.length){b=Boolean(d);return this}return Boolean(b)};return a};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(a){return{x:a.lng/180,y:a.lat>85?1:a.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(a.lat)/2))/Math.PI}},invert:function(a){return{lng:a.x*180,lat:pv.degrees(2*Math.atan(Math.exp(a.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(a){return{x:a.lng/180,y:Math.sin(pv.radians(a.lat))}},invert:function(a){return{lng:a.x*180,lat:pv.degrees(Math.asin(a.y))}}},sinusoidal:{project:function(a){return{x:pv.radians(a.lng)*Math.cos(pv.radians(a.lat))/Math.PI,y:a.lat/90}},invert:function(a){return{lng:pv.degrees((a.x*Math.PI)/Math.cos(a.y*Math.PI/2)),lat:a.y*90}}},aitoff:{project:function(g){var c=pv.radians(g.lng),d=pv.radians(g.lat),b=Math.acos(Math.cos(d)*Math.cos(c/2));return{x:2*(b?(Math.cos(d)*Math.sin(c/2)*b/Math.sin(b)):0)/Math.PI,y:2*(b?(Math.sin(d)*b/Math.sin(b)):0)/Math.PI}},invert:function(b){var a=b.x*Math.PI/2,c=b.y*Math.PI/2;return{lng:pv.degrees(a/Math.cos(c)),lat:pv.degrees(c)}}},hammer:{project:function(g){var a=pv.radians(g.lng),b=pv.radians(g.lat),d=Math.sqrt(1+Math.cos(b)*Math.cos(a/2));return{x:2*Math.SQRT2*Math.cos(b)*Math.sin(a/2)/d/3,y:Math.SQRT2*Math.sin(b)/d/1.5}},invert:function(b){var a=b.x*3,d=b.y*1.5,c=Math.sqrt(1-a*a/16-d*d/4);return{lng:pv.degrees(2*Math.atan2(c*a,2*(2*c*c-1))),lat:pv.degrees(Math.asin(c*d))}}},identity:{project:function(a){return{x:a.lng/180,y:a.lat/90}},invert:function(a){return{lng:a.x*180,lat:a.y*90}}}};pv.Geo.scale=function(b){var i={x:0,y:0},r={x:1,y:1},h=[],g=pv.Geo.projections.identity,n=pv.Scale.linear(-1,1).range(0,1),l=pv.Scale.linear(-1,1).range(1,0),k={lng:0,lat:0},q,m;function f(d){if(!q||(d.lng!=q.lng)||(d.lat!=q.lat)){q=d;var c=o(d);m={x:n(c.x),y:l(c.y)}}return m}function o(d){var c={lng:d.lng-k.lng,lat:d.lat};return g.project(c)}function a(c){var d=g.invert(c);d.lng+=k.lng;return d}f.x=function(c){return f(c).x};f.y=function(c){return f(c).y};f.ticks={lng:function(c){var p,d;if(h.length>1){var j=pv.Scale.linear();if(c==undefined){c=10}p=j.domain(h,function(s){return s.lat}).ticks(c);d=j.domain(h,function(s){return s.lng}).ticks(c)}else{p=pv.range(-80,81,10);d=pv.range(-180,181,10)}return d.map(function(s){return p.map(function(t){return{lat:t,lng:s}})})},lat:function(c){return pv.transpose(f.ticks.lng(c))}};f.invert=function(c){return a({x:n.invert(c.x),y:l.invert(c.y)})};f.domain=function(s,c){if(arguments.length){h=(s instanceof Array)?((arguments.length>1)?pv.map(s,c):s):Array.prototype.slice.call(arguments);if(h.length>1){var d=h.map(function(t){return t.lng});var j=h.map(function(t){return t.lat});k={lng:(pv.max(d)+pv.min(d))/2,lat:(pv.max(j)+pv.min(j))/2};var p=h.map(o);n.domain(p,function(t){return t.x});l.domain(p,function(t){return t.y})}else{k={lng:0,lat:0};n.domain(-1,1);l.domain(-1,1)}q=null;return this}return h};f.range=function(d,c){if(arguments.length){if(typeof d=="object"){i={x:Number(d.x),y:Number(d.y)};r={x:Number(c.x),y:Number(c.y)}}else{i={x:0,y:0};r={x:Number(d),y:Number(c)}}n.range(i.x,r.x);l.range(r.y,i.y);q=null;return this}return[i,r]};f.projection=function(c){if(arguments.length){g=typeof c=="string"?pv.Geo.projections[c]||pv.Geo.projections.identity:c;return this.domain(h)}return c};f.by=function(c){function d(){return f(c.apply(this,arguments))}for(var j in f){d[j]=f[j]}return d};if(arguments.length){f.projection(b)}return f};sc_require("libraries/protovis");DG.Calculator=SC.View.extend((function(){var j=30,i=24,f=3,d=10,k=2,h=2*j+k,b=j+k,a=i+k,g=4,c=5;return{classNames:["calculator"],backgroundColor:"#333333",_justEvaled:NO,viewFormat:pv.Format.number().fractionDigits(0,9).group(""),exportFormat:pv.Format.number().fractionDigits(0,9).group("").negativeAffix("-",""),formatForView:function(l){if(typeof l!=="number"){return String(l)}return this.viewFormat(l)},formatForExport:function(l){if(typeof l!=="number"){return l}return this.exportFormat(l)},clearValue:function(){this.editView.set("value","");this._justEvaled=NO},insert:function(l){if(this._justEvaled&&!isNaN(parseInt(l,10))){this.clearValue()}this.editView.replaceSelectionWithString(l);if(!this.editView.get("isFirstResponder")){this.editView.becomeFirstResponder()}this._justEvaled=NO},insertSymbol:function(l){if(this._justEvaled){this.clearValue()}this.insert(l)},calculate:function(){var m=this.editView.get("formulaExpression"),n=DG.Formula.create({source:m}),o="";if(!SC.empty(m)&&(m.charAt(0)==="#")){return}try{o=n.evaluateDirect()}catch(l){o=!SC.empty(l.message)?l.message:String(l);o="#"+o}this.editView.set("value",this.formatForView(o));this._justEvaled=YES;DG.logUser("Calculation done: %@ = %@",m,this.formatForExport(o))},init:function(){arguments.callee.base.apply(this,arguments);this.setupSubViews()},setupSubViews:function(){var p=this;this.editView=DG.FormulaTextEditView.create({layout:{top:5,left:5,right:5,height:20},value:"",continuouslyUpdatesValue:false,borderStyle:SC.BORDER_BEZEL,keyDown:function(q){if(p.handleKeyDown(q)){return arguments.callee.base.apply(this,arguments)}else{return true}}});this.appendChild(this.editView);this.set("defaultFirstResponder",this.editView);this.equals=SC.ButtonView.create({layout:{bottom:f,left:f+2*b,width:h,height:i},title:"=",titleMinWidth:0});this.appendChild(this.equals);this.equals.action=function(){p.calculate()};var l=d+f+this.editView.layout.height;this.set("layout",{top:0,left:0,width:4*f+g*b,height:l+c*a+f});var m=[["C",function(){p.clearValue()}],["(",function(){p.insertSymbol("(")}],[")",function(){p.insertSymbol(")")}],["/",function(){p.insert(" / ")}],["7",function(){p.insert("7")}],["8",function(){p.insert("8")}],["9",function(){p.insert("9")}],["X",function(){p.insert(" * ")}],["4",function(){p.insert("4")}],["5",function(){p.insert("5")}],["6",function(){p.insert("6")}],[DG.UNICODE.MINUS_SIGN,function(){p.insert(" "+DG.UNICODE.MINUS_SIGN+" ")}],["1",function(){p.insert("1")}],["2",function(){p.insert("2")}],["3",function(){p.insert("3")}],["+",function(){p.insert(" + ")}],["0",function(){p.insert("0")}],[".",function(){p.insertSymbol(".")}]];var o=0,n=5;m.forEach(function(r){var s=Math.floor(o/g);var q=o%g;var t=SC.ButtonView.create({layout:{bottom:f+(n-s-1)*a,left:f+q*b,width:j,height:i},title:r[0],action:r[1],titleMinWidth:0});p.appendChild(t);o++})},handleKeyDown:function(l){if(!this){return NO}if((l.which===SC.Event.KEY_RETURN)&&!l.isIMEInput){if(l.type==="keydown"){this.calculate()}}else{if(l.which===SC.Event.KEY_ESC){this.clearValue()}else{var m=String.fromCharCode(l.which);if(this._justEvaled&&("/*-+\t".indexOf(m)===-1)){this.clearValue()}else{if(m==="="){this.calculate();return false}else{this._justEvaled=NO}}}}return true}}}()));DG.CaseTableAdapter=SC.Object.extend((function(){var g=60,c=18,a=function(i){var j=i.get("parent");return j&&j.get("id").toString()},f=function(i){var j={theCase:i,id:i.get("id").toString(),parentID:a(i)};return j},h=function(k){var j=k.get("name"),m=k.get("formula"),l=k.get("description"),i="";if(m){i="%@ = %@".fmt(j,m)}else{if(!SC.empty(l)){i=l}else{if(!SC.empty(j)){i=j}}}return i},d=function(j){var i=j.get("name"),k=j.get("unit");return i+(!SC.empty(k)?" ("+k+")":"")},b=function(p,i,l,o,k){if(SC.none(l)){l=""}else{if(SC.typeOf(l)===SC.T_NUMBER){var j=o.attribute.get("precision"),m=!SC.none(j)?j:2,n=!SC.none(m)?Math.pow(10,m):1;l=Math.round(n*l)/n}}return l.toString()};return{rowHeight:c,dataContext:null,collection:null,hasAggregates:function(){return this.getPath("collection.hasAggregates")}.property(),showExpandedGroupRows:false,gridDataView:null,gridData:null,gridColumns:null,gridOptions:null,parentIDGroups:null,init:function(){arguments.callee.base.apply(this,arguments);this.parentIDGroups={};this.gridDataView=new Slick.Data.DataView({groupItemMetadataProvider:new Slick.Data.GroupItemMetadataProvider({groupSelectable:true}),inlineFilters:true,showExpandedGroupRows:this.showExpandedGroupRows});if(this.get("dataContext")){this.dataContextDidChange()}},hasParentCollection:function(){var j=this.get("dataContext"),l=this.getPath("collection.id"),k=j&&j.getCollectionAtIndex(0),i=k&&k.get("id");return l!==i},visibleRowCount:function(){return this.gridDataView.getLength()}.property(),totalRowCount:function(){return this.gridDataView.getItems().length}.property(),getIndexForID:function(j){var i=this.get("gridDataView");return i&&i.getRowById(j)},updateColumnInfo:function(){var k=this.get("dataContext"),m=this.get("collection"),l={},n=[];if(!m){return n}if(this.gridColumns){this.gridColumns.forEach(function(o){l[o.id]=o})}function j(p,o){if(p.get("editable")&&!p.get("hasFormula")){o.editor=DG.CaseTableCellEditor}else{delete o.editor}}function i(p){var r=p.get("id").toString(),o=l[r];if(o){j(p,o);n.push(o);return}var t=p.get("collection"),q=p.get("name"),s={context:k,collection:t,collectionID:t.get("id").toString(),attribute:p,id:p.get("id").toString(),name:d(p),field:q,toolTip:h(p),formatter:b,width:g,header:{menu:{items:[{title:"DG.TableController.headerMenuItems.editAttribute".loc(),command:"cmdEditFormula",updater:function(u,w,v){v.disabled=!u.attribute.get("editable")}},{title:"DG.TableController.headerMenuItems.renameAttribute".loc(),command:"cmdRenameAttribute",updater:function(u,w,v){v.disabled=!u.attribute.get("editable")}},{title:"DG.TableController.headerMenuItems.deleteAttribute".loc(),command:"cmdDeleteAttribute",updater:function(u,w,v){v.disabled=!u.attribute.get("editable")}}]}}};j(p,s);n.push(s)}m.forEachAttribute(i);this.gridColumns=n;return n},updateColumnForAttribute:function(i){var j=DG.ArrayUtils.firstMatch(this.gridColumns,function(k){return i.get("id").toString()===k.id});if(j){j.name=d(i);j.field=i.get("name");j.toolTip=h(i);this.gridDataView.refresh();return true}return false},buildRowData:function(){var i=this.get("dataContext"),n=this.get("collection"),p=(n&&n.getPath("collection.collectionRecord.collapseChildren"))||false,k=[],o={},l=[],m=this;if(!n){return l}function j(s){var t=f(s),u=t.parentID;if(!o[u]){k.push(u);o[u]=[t]}else{o[u].push(t)}}n.forEachCase(j);this.parentIDGroups={};k.forEach(function(t){var s=o[t],u={};s.forEach(function(v){l.push(v);if(SC.none(u.firstChildID)){u.firstChildID=v.id;u.isCollapsed=p}u.lastChildID=v.id});m.parentIDGroups[t]=u});this.gridData=l;this.gridDataView.setItems(l);function q(){return i&&i.getLabelForSetOfCases(n)}function r(s){return i&&i.getCaseCountString(n,s)}if(this.hasParentCollection()){this.gridDataView.setGrouping({getter:"parentID",formatter:function(s){return"%@ (%@)".loc(q(),r(s.count))},comparer:function(t,s){return t.value-s.value}});DG.ObjectMap.forEach(this.parentIDGroups,function(s,t){if(t.isCollapsed){this.gridDataView.collapseGroup(s)}}.bind(this))}return l},buildGridOptions:function(){this.gridOptions={rowHeight:c,enableColumnReorder:false,syncColumnCellResize:true,leaveSpaceForNewRows:false,editable:true,enableAddRow:false,asyncEditorLoading:false,autoEdit:true,editCommandHandler:function(j,i,k){k.execute()},dataItemColumnValueExtractor:function(k,i){var j=k.theCase;return j&&j.getValue(i.id)}};return this.gridOptions},rebuild:function(){this.updateColumnInfo();this.buildRowData();this.buildGridOptions()},expandCollapseCounts:function(){var j=0,i=0;DG.ObjectMap.forEach(this.parentIDGroups,function(l,k){if(k){if(k.isCollapsed){++j}else{++i}}});return{collapsed:j,expanded:i}}.property(),expandCollapseAll:function(i){var j=this.get("gridDataView");DG.assert(j);DG.ObjectMap.forEach(this.parentIDGroups,function(l,k){k.isCollapsed=!i;if(i){j.expandGroup(l)}else{j.collapseGroup(l)}})},dataContextDidChange:function(){this.rebuild()}.observes("dataContext"),attributeFormulaDidChange:function(i,j){if(j==="attrFormulaChanges"){this.updateColumnInfo()}this.markCasesChanged();this.gridDataView.refresh()}.observes(".collection.attrFormulaChanges",".collection.attrFormulaDependentChanges"),refresh:function(){var i=this.get("gridDataView");if(i){i.refresh()}},appendRow:function(k){var l=f(k),n=l.parentID,o=this.parentIDGroups[n],i=o&&o.lastChildID,m=this.gridDataView;if(!o){o=this.parentIDGroups[n]={};o.isCollapsed=this.getPath("collection.collection.collectionRecord.collapseChildren")||false}if(SC.none(o.firstChildID)){o.firstChildID=l.id}o.lastChildID=l.id;if(i){var j=m.getIdxById(i);m.setRefreshHints({isFilterExpanding:true});m.insertItem(j+1,l)}else{m.setRefreshHints({isFilterExpanding:true});m.addItem(l);if(n&&o.isCollapsed){m.collapseGroup(n)}}o.lastChildID=l.id;this.parentIDGroups[n]=o},updateRowCount:function(){var j=false,o=this.get("collection"),l=(o&&o.getCaseCount())||0,k=this.get("totalRowCount");if(l>=k){for(var n=k;n<l;++n){var m=o.casesController.objectAt(n);if(DG.assert(m)){this.appendRow(m)}}j=true}return j},getSelectedRows:function(){var l=this.get("dataContext"),o=this.get("collection"),r=this.get("gridDataView"),s=this.getPath("collection.casesController.selection"),m=[];if(s){s.forEach(function(t){var i=r.getRowById(t.get("id").toString());if(i>=0){m.push(i)}})}var n,q=this.get("visibleRowCount"),p=l&&l.getParentCollection(o);if(p&&r&&(q>0)){for(n=0;n<q;++n){var j=r.getItem(n);if(j&&j.__group){var k=DG.store.find(DG.Case,j.value);if(p.isCaseSelected(k)){m.push(n)}}}}return m},handleCellClick:function(o,k){var p=this.get("gridDataView"),q=k&&(k.row>=0)&&p&&p.getItem(k.row),l=q&&q.theCase,j=q&&q.__group&&q.value,r=this.get("dataContext"),i=this.get("collection"),m=i&&l&&i.isCaseSelected(l);if(!SC.none(j)){l=DG.store.find(DG.Case,j);i=r.getCollectionForCase(l)}var n={operation:"selectCases",collection:i,cases:[l],select:o?!m:true,extend:o};if(l){r.applyChange(n)}else{if(!o){DG.globalEditorLock.commitCurrentEdit();n.cases=null;n.select=false;r.applyChange(n)}}},selectRowsInRange:function(p,q){var r=this.get("gridDataView"),t=this.get("dataContext"),j=this.get("collection"),m=[];for(var n=p;n<=q;++n){var s=r.getItem(n),k=s&&s.theCase,l=s&&s.__group&&s.value;if(!SC.empty(l)){k=DG.store.find(DG.Case,l)}if(k){m.push(k)}}if(m.length){var o={operation:"selectCases",collection:j,cases:m,select:true,extend:false};t.applyChange(o)}},markCasesChanged:function(j){var k=this.gridDataView,i=j||this.getPath("collection.casesController");k.beginUpdate();i.forEach(function(m){var l=m.get("id").toString(),n=k.getItemById(l);if(n){k.updateItem(l,n)}});k.endUpdate()}}}()));DG.CaseTableCellEditor=function CaseTableCellEditor(b){var c;var a;this.init=function(){var f=37,d=39;c=SC.$("<INPUT type=text class='editor-text' />").appendTo(b.container).bind("keydown.nav",function(g){if(g.keyCode===f||g.keyCode===d){g.stopImmediatePropagation()}}).bind("blur",function(g){DG.globalEditorLock.commitCurrentEdit()}).focus().select()};this.destroy=function(){c.remove()};this.focus=function(){c.focus()};this.getValue=function(){return c.val()};this.setValue=function(d){c.val(d)};this.loadValue=function(f){var d=Number(b.column.id),g=f.theCase&&f.theCase.getValue(d);a=SC.none(g)?"":g.toString();c.val(a);c[0].defaultValue=a;c.select()};this.serializeValue=function(){return c.val()};this.applyValue=function(h,k){var j=Number(b.column.id),i=k,f=b.column.context,g={operation:"updateCases",cases:[h.theCase],attributeIDs:[j],values:[[i]]};f.applyChange(g);var d=h.theCase.getPath("collection.name")||"",l=b.grid.getData().getIdxById(h.id)+1;DG.logUser("editValue: { collection: %@, case: %@, attribute: '%@', value: '%@' }",d,l,b.column.name,i)};this.isValueChanged=function(){return(!(c.val()===""&&SC.none(a)))&&(c.val()!==a)};this.validate=function(){if(b.column.validator){var d=b.column.validator(c.val());if(!d.valid){return d}}return{valid:true,msg:null}};this.init()};DG.ComponentController=SC.Object.extend((function(){return{model:null,view:null,shouldDestroyOnComponentDestroy:true,willDestroy:function(){},addLink:function(b,c,a){DG.ArchiveUtils.addLink(b,c,a)},getLinkID:function(a,b){return DG.ArchiveUtils.getLinkID(a,b)},createComponentStorage:function(){return null},restoreComponentStorage:function(a,b){},willSaveComponent:function(){if(this.model){var a=this.createComponentStorage();if(a){this.model.set("componentStorage",a)}var b=this.getPath("view.layout");if(b){this.model.set("layout",b)}}},didRestoreComponent:function(b){var a=this.getPath("model.componentStorage");if(a){this.restoreComponentStorage(a,b)}}}}()));sc_require("controllers/component_controller");DG.CaseTableController=DG.ComponentController.extend((function(){return{_currentGameContext:null,_currentGameContextBinding:SC.Binding.oneWay("DG.gameSelectionController.currentContext"),currentGameContextDidChange:function(a,b){if(!this.restoredDataContext){this.notifyPropertyChange("dataContext")}else{if(b==="gameIsReady"){var c=this.getPath("view.contentView");if(c){c.refresh()}}}}.observes("_currentGameContext","DG.currGameController.gameIsReady"),restoredDataContext:null,dataContext:function(){return this.get("restoredDataContext")||this.get("_currentGameContext")}.property("restoredDataContext"),_prevDataContext:null,caseTableAdapters:null,contentView:null,newAttributeDialog:null,init:function(){arguments.callee.base.apply(this,arguments);this.caseTableAdapters=[];if(this.get("dataContext")){this.dataContextDidChange()}},destroy:function(){var a=this.get("dataContext");if(a){a.removeObserver("changeCount",this,"contextDataDidChange")}this.caseTableAdapters=null;arguments.callee.base.apply(this,arguments)},updateTableAdapters:function(){var b=this.get("dataContext"),g=this.getPath("dataContext.collections")||[],d=this.caseTableAdapters,a=[];this.caseTableAdapters=a;function c(k){var h,j=d.length;for(h=0;h<j;++h){if(d[h]&&(d[h].getPath("collection.id")===k)){return d[h]}}return null}function f(j){var i=j.get("id"),k=b.getCollectionByID(i),h=c(i);if(!h){h=DG.CaseTableAdapter.create({dataContext:b,collection:k})}a.push(h)}g.forEach(f)},dataContextDidChange:function(){var a=this.get("dataContext");this.updateTableAdapters();var c=this.getPath("view.contentView");if(c){c.setCaseTableAdapters(this.get("caseTableAdapters"))}if(a!==this._prevDataContext){if(this._prevDataContext){this._prevDataContext.removeObserver("changeCount",this,"contextDataDidChange")}if(a){a.addObserver("changeCount",this,"contextDataDidChange")}this._prevDataContext=a}var b=this.getPath("dataContext.childCollection");if(b){var d=this;b.casesController.addObserver("[]",this,"caseCountDidChange");a.forEachCollection(function(f){f.attrsController.addObserver("[]",d,"attributeCountDidChange")})}}.observes("dataContext"),createComponentStorage:function(){var b={},a=this.get("dataContext");if(a){this.addLink(b,"context",a)}return b},restoreComponentStorage:function(c,d){var b=this.getLinkID(c,"context"),a=b&&DG.DataContext.retrieveContextFromMap(d,b);if(a){this.set("restoredDataContext",a)}},doCommand:function(a){var b=Number(a.column.id);switch(a.command){case"cmdEditFormula":this.editAttributeFormula(b);break;case"cmdRenameAttribute":this.renameAttribute(b);break;case"cmdDeleteAttribute":this.deleteAttribute(b);break}},contextDataDidChange:function(){var b=this.getPath("dataContext.newChanges"),a=true;var d=function(g){var f=g&&g.operation;switch(f){case"createCollection":this.dataContextDidChange();break;case"createCase":case"createCases":this.caseCountDidChange(g);break;case"updateCases":this.doChangeCaseValues(g);break;case"deleteCases":this.caseCountDidChange(g);case"selectCases":this.doSelectCases(g);if(f==="selectCases"){a=false}break;case"createAttributes":case"deleteAttributes":this.attributeCountDidChange(g);break;case"updateAttributes":this.doUpdateAttributes(g);break}}.bind(this);if(b){b.forEach(function(f){d(f)})}if(a){var c=this.get("caseTableAdapters");if(c){c.forEach(function(f){if(f.get("hasAggregates")){f.markCasesChanged()}})}}},doSelectCases:function(a){var b=this.getPath("view.contentView");if(b){b.updateSelectedRows()}},doChangeCaseValues:function(b){var a=this.get("caseTableAdapters");if(a){a.forEach(function(c){c.markCasesChanged(b.cases)})}},doUpdateAttributes:function(f){var g=this.getPath("view.contentView"),c=this.get("caseTableAdapters"),b=[],a=f&&f.result&&f.result.attrs;function d(h){if(a){a.forEach(function(i){if(h.updateColumnForAttribute(i)){b.push(h)}})}}if(c){c.forEach(d);if(g){g.get("childTableViews").forEach(function(h){var i=h.get("gridAdapter");if(b.indexOf(i)>=0){h.setColumns(i.get("gridColumns"))}})}}},caseCountDidChange:function(a){var b=this.getPath("view.contentView");if(b){b.updateRowCount()}},attributeCountDidChange:function(){var a=this.getPath("view.contentView");if(a){a.updateColumnInfo()}},gearMenuItems:function(){var b=this.get("dataContext"),a=b&&b.get("childCollection"),i=a&&a.get("name"),f=b&&b.get("parentCollection"),d=f&&f.get("name"),h=b&&b.getSelectedCases(),g=h&&h.get("length"),c="DG.TableController.gearMenuItems.newAttribute",j=[];if(!SC.empty(i)){j.push({title:c.loc(i),target:this,itemAction:this.newChildAttribute})}if(!SC.empty(d)){j.push({title:c.loc(d),target:this,itemAction:this.newParentAttribute})}j.push({title:"DG.TableController.gearMenuItems.deleteCases",localize:true,target:this,itemAction:this.deleteSelectedCases,isEnabled:g});return j}.property(),modelDidChange:function(){}.observes("model"),viewDidChange:function(){var b=this.get("view"),a=b.get("contentView");this.set("contentView",a);if(!this.getPath("caseTableAdapters.length")){this.updateTableAdapters()}if(a){a.bind("dataContext",this,"dataContext");a.setCaseTableAdapters(this.get("caseTableAdapters")||[])}var c=this.getPath("view.containerView.titlebar.gearView");if(c){c.set("contentView",b)}}.observes("view"),deleteSelectedCases:function(){var a=this.get("dataContext"),b={operation:"deleteCases",cases:a.getSelectedCases()};a.applyChange(b)},newChildAttribute:function(){var b=this.get("dataContext"),a=b&&b.get("childCollection");this.newAttribute({collection:a})},newParentAttribute:function(){var b=this.get("dataContext"),a=b&&b.get("parentCollection");this.newAttribute({collection:a})},newAttribute:function(m,i,h){var g=this.getPath("dataContext.parentCollection"),k=g&&g.collection.getAttributeNames(),a=this.getPath("dataContext.childCollection"),d=a&&a.collection.getAttributeNames(),b=DG.globalsController.getGlobalValueNames(),c=[],l=i||"",f=h||"";function j(n){if(!n||!n.length){return}if(c.length){c.push("--")}c=c.concat(n.sort())}j(k);j(d);j(b);j(["e",""]);this.newAttributeDialog=DG.CreateAttributeFormulaView(SC.mixin({applyTarget:this,applyAction:"applyNewAttribute",applyTooltip:"DG.TableController.newAttrDlg.applyTooltip",attrNameHint:"DG.TableController.newAttrDlg.attrNameHint",attrNameValue:l,attrNameIsEnabled:SC.empty(i),formulaValue:f,formulaOperands:c,formulaHint:"DG.TableController.newAttrDlg.formulaHint"},m))},applyNewAttribute:function(){var a=this.get("dataContext"),g=this.newAttributeDialog.get("attributeName");if(!SC.empty(g)){var c=this.newAttributeDialog.get("collection"),f=this.newAttributeDialog.get("formula"),b={operation:"createAttributes",collection:c,attrPropsArray:[{name:g,formula:f}]},d=a&&a.applyChange(b);if(d.success){DG.logUser("attributeCreate: { name: '%@', collection: '%@', formula: '%@' }",g,c.get("name"),f)}}else{DG.AlertPane.show({localize:true,message:"DG.TableController.newAttrDlg.mustEnterAttrNameMsg"});return}this.newAttributeDialog.close();this.newAttributeDialog=null},willDestroy:function(){if(this.newAttributeDialog){this.newAttributeDialog.close();this.newAttributeDialog=null}arguments.callee.base.apply(this,arguments)},renameAttribute:function(j){var a=this.get("dataContext"),b=a&&a.getAttrRefByID(j),h=b&&b.collection,g=a&&b&&a.getCollectionForAttribute(b.attribute),d=b&&b.attribute.get("name"),f;if(!DG.assert(b,"renameAttribute() is missing the attribute reference")){return}function c(k,l){var m={operation:"updateAttributes",collection:h,attrPropsArray:[{id:k,name:l}]};a.applyChange(m)}function i(){var k=f.get("value"),l=g&&k&&g.getAttributeByName(k);if(k===d){f.close();return}if(k&&!l){f.close();c(j,k)}else{if(l){DG.AlertPane.info({message:"DG.TableController.renameAttributeDuplicateMsg",description:"DG.TableController.renameAttributeDuplicateDesc",localize:true})}else{if(!k){DG.AlertPane.info({message:"DG.TableController.renameAttributeInvalidMsg",description:"DG.TableController.renameAttributeInvalidDesc",localize:true})}}}}f=DG.CreateSingleTextDialog({prompt:"DG.TableController.renameAttributePrompt",textValue:d,okTarget:null,okAction:i,okTooltip:"DG.TableController.renameAttributeOKTip"})},deleteAttribute:function(c){var g=this.get("dataContext"),f=g&&g.getAttrRefByID(c),a=f&&f.collection,b=f&&f.attribute.get("name");function d(){var h={operation:"deleteAttributes",collection:a,attrs:[{id:c,attribute:f.attribute}]};g.applyChange(h)}DG.AlertPane.warn({message:"DG.TableController.deleteAttribute.confirmMessage".loc(b),description:"DG.TableController.deleteAttribute.confirmDescription".loc(),buttons:[{title:"DG.TableController.deleteAttribute.okButtonTitle",action:d,localize:YES},{title:"DG.TableController.deleteAttribute.cancelButtonTitle",localize:YES}],localize:false})},editAttributeFormula:function(c){var f=this.get("dataContext"),d=f&&f.getAttrRefByID(c),a=d&&d.attribute.get("name"),b=d&&d.attribute.get("formula");DG.assert(d&&a,"editAttributeFormula() is missing the attribute reference or attribute name");this.newAttribute({collection:d.collection},a,b||"")}}}()));DG.CaseTableView=SC.View.extend((function(){var a=29,b=200;return{classNames:["dg-case-table"],layout:{left:0,right:0,top:0,bottom:0},backgroundColor:"white",childViews:"_hiddenDragView".w(),_hiddenDragView:SC.LabelView.design({classNames:"drag-label".w(),layout:{width:100,height:20,top:-50,left:0},value:""}),gridAdapter:null,gridDataView:null,gridView:undefined,_slickGrid:null,_gridEventHandler:null,_gridWidth:0,_prevGridWidth:0,gridWidth:function(c,d){if(!SC.none(d)){this._prevGridWidth=this._gridWidth;this._gridWidth=d;return this}return this._gridWidth}.property(),gridWidthChange:function(){return this._gridWidth-this._prevGridWidth}.property(),rowCount:0,scrollPos:null,expandCollapseCount:0,displayProperties:["gridAdapter","gridDataView","_slickGrid"],viewDidResize:function(){if(this._slickGrid){this.invokeLast(function(){this._slickGrid.resizeCanvas();this.setIfChanged("gridWidth",this._slickGrid.getContentSize().width)}.bind(this))}},initGridView:function(){var f="#"+this.get("layerId"),d=this.get("gridAdapter"),g=d&&d.gridDataView;this._slickGrid=new Slick.Grid(f,d.gridDataView,d.gridColumns,d.gridOptions);this._slickGrid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:false}));if(DG.supports("caseTableHeaderMenus")){var c=new Slick.Plugins.HeaderMenu({buttonIsCell:true,buttonImage:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/slickgrid/images/down.gif"});this._slickGrid.registerPlugin(c);c.onBeforeMenuShow.subscribe(function(j,i){var h=0;if(i.menu&&i.menu.items&&i.menu.items.length){i.menu.items.forEach(function(k){if(k.updater){k.updater(i.column,i.menu,k)}if(!k.disabled){++h}})}return(h>0)});c.onCommand.subscribe(function(k,j){var i;for(var h=this;h&&!i;h=h.get("parentView")){i=h.get("controller")}if(i){i.doCommand(j)}}.bind(this))}this._gridEventHandler=new Slick.EventHandler();this.subscribe("onScroll",this.handleScroll);this.subscribe("onHeaderClick",this.handleHeaderClick);this.subscribe("onHeaderDragInit",function(i,h){DG.globalEditorLock.commitCurrentEdit();i.stopImmediatePropagation()});this.subscribe("onHeaderDragStart",this.handleHeaderDragStart);this.subscribe("onCanvasWidthChanged",function(i,h){SC.run(function(){this.setIfChanged("gridWidth",this._slickGrid.getContentSize().width)}.bind(this))}.bind(this));g.onRowCountChanged.subscribe(function(i,h){SC.run(function(){this._slickGrid.updateRowCount();this._slickGrid.render();this.set("rowCount",h.current)}.bind(this))}.bind(this));g.onRowsChanged.subscribe(function(i,h){if(this._slickGrid){this._slickGrid.invalidateRows(h.rows);this._slickGrid.render()}}.bind(this));$(f).show();this.notifyPropertyChange("gridView")},destroySlickGrid:function(){if(this._slickGrid){this._slickGrid.destroy()}this._slickGrid=null;this.gridDataView=null},_destroy:function(){this.destroySlickGrid();if(this.gridAdapter){this.gridAdapter.destroy()}this.gridAdapter=null},willDestroy:function(){this._destroy()},destroy:function(){this._destroy();arguments.callee.base.apply(this,arguments)},subscribe:function(g,d){var c,f=function(h){return function(){if(!c){c=true;h.apply(this,arguments);c=false}}.bind(this)}.bind(this);this._gridEventHandler.subscribe(this._slickGrid[g],f(d))},getRowBounds:function(g){var d=this._slickGrid&&this._slickGrid.getCellNodeBox(g,0),f=this._slickGrid&&this._slickGrid.getColumns(),h=f&&f.length;if(d&&h){var c=this._slickGrid.getCellNodeBox(g,h-1);d.right=c.right}return d},gridAdapterDidChange:function(){if(this._slickGrid){this.destroySlickGrid();this.displayDidChange();this.notifyPropertyChange("gridView")}}.observes("gridAdapter"),refresh:function(){var c=this.get("gridAdapter");if(c){c.refresh()}if(this._slickGrid){this._slickGrid.invalidate()}},render:function(d,f){arguments.callee.base.apply(this,arguments);if(f){this.displayDidChange()}else{if(!this._slickGrid&&this.get("gridAdapter")){this.initGridView();this.set("gridWidth",this._slickGrid.getContentSize().width)}else{if(this._slickGrid){var c=this.get("gridAdapter");if(this._rowDataDidChange){c.buildRowData();c.refresh()}this._slickGrid.render();this._rowDataDidChange=false;this._renderRequired=false}}}if(this._slickGrid){d.classNames(this.$().attr("class"),YES)}},mouseDown:function(c){return this.touchStart(c)},mouseDragged:function(c){this.touchesDragged(c)},mouseUp:function(c){this.touchEnd(c)},touchPosInView:function(c){return this.convertFrameFromView({x:c.pageX,y:c.pageY},null,true)},touchPosInBodyContent:function(c){var d=this.touchPosInView(c),f=this.get("scrollPos");d.y-=a;if(f){d.x+=f.scrollLeft;d.y+=f.scrollTop}return d},cellFromTouch:function(d){var c={},f=this.touchPosInView(d);if(f.y<a){c=this._slickGrid.getCellFromPoint(f.x,0);c.row=-1}else{c=this.bodyCellFromTouch(d)}return c},bodyCellFromTouch:function(c){var d=this.touchPosInBodyContent(c);return this._slickGrid.getCellFromPoint(d.x,d.y)},_touchStartTouch:null,_touchStartCell:null,_touchDragCell:null,captureTouch:function(c){return YES},touchStart:function(g){var c=this.touchPosInView(g),d=this._slickGrid&&this._slickGrid.getVisibleSize();if(!d||(c.x>d.width)||(c.y-a>d.height)){return NO}this._touchStartTouch=g;this._touchStartCell=this.cellFromTouch(g);if(this._touchStartCell&&(this._touchStartCell.row>=0)){var f=DG.Core.isExtendingFromEvent(g);this.get("gridAdapter").handleCellClick(f,this._touchStartCell)}return YES},_autoScrollRow:null,_autoScrollIncrement:0,_autoScrollTimer:null,_autoScrollTimerFunc:function(){var d=this.get("gridAdapter"),f=d&&d.get("visibleRowCount"),g=this._autoScrollRow+this._autoScrollIncrement;if(this._slickGrid&&d){if((g>=0)&&(g<f)){var c=Math.min(this._touchStartCell.row,g),h=Math.max(this._touchStartCell.row,g);this._autoScrollRow=g;d.selectRowsInRange(c,h);this._slickGrid.scrollRowIntoView(this._autoScrollRow)}}else{if(this._autoScrollTimer){this._autoScrollTimer.invalidate();this._autoScrollTimer=null}}},touchesDragged:function(f,g){var c=this._touchStartCell&&this._touchStartCell.row;if(!SC.none(c)){if(c<0){if(SC.none(this._touchDragCell)){this._touchDragCell=this._touchStartCell;var d=this.get("gridAdapter").gridColumns[this._touchDragCell.cell];this.handleHeaderDragStart(f,{column:d})}}else{if(this._touchStartCell.row>=0){if(!g){g=[f]}g.forEach(function(j){var k=this.touchPosInView(j),l=this._slickGrid.getVisibleSize(),i=this.bodyCellFromTouch(j),h=Math.min(this._touchStartCell.row,i.row),m=Math.max(this._touchStartCell.row,i.row);this.get("gridAdapter").selectRowsInRange(h,m);this._autoScrollRow=i.row>=0?i.row:Math.max(0,h-1);this._slickGrid.scrollRowIntoView(this._autoScrollRow);if(k.y<a){this._autoScrollIncrement=-1}else{if(k.y>l.height){this._autoScrollIncrement=1}else{this._autoScrollIncrement=0}}if(this._autoScrollIncrement!==0){if(!this._autoScrollTimer){this._autoScrollTimer=SC.Timer.schedule({target:this,action:"_autoScrollTimerFunc",interval:b,repeats:YES})}else{this._autoScrollTimer.set("lastFireTime",Date.now());this._autoScrollTimer.schedule()}}else{if(this._autoScrollTimer){this._autoScrollTimer.invalidate();this._autoScrollTimer=null}}}.bind(this))}}}},touchEnd:function(c){if(this._autoScrollTimer){this._autoScrollTimer.invalidate();this._autoScrollTimer=null}this._touchStartTouch=this._touchStartCell=this._touchDragCell=null},handleScroll:function(d,c){this.set("scrollPos",c)},handleHeaderDragStart:function(h,d){var f=d.column;if(h.stopImmediatePropagation){h.stopImmediatePropagation()}var c=this._hiddenDragView,g=f.attribute.get("name"),i=this;SC.run(function(){c.set("value",g);i.removeChild(c);i.appendChild(c)});DG.Drag.start({event:h,source:this,dragView:c,ghost:YES,ghostActsLikeCursor:YES,slideBack:YES,origin:{x:h.clientX,y:h.clientY},data:{collection:f.collection,attribute:f.attribute,text:g}})},handleHeaderClick:function(c){DG.globalEditorLock.commitCurrentEdit()},updateColumnInfo:function(){if(this._slickGrid){this.setColumns(this.get("gridAdapter").updateColumnInfo())}},setColumns:function(c){if(this._slickGrid){this._slickGrid.setColumns(c);this._slickGrid.render()}},expandCollapseAll:function(d){var c=this.get("gridAdapter");if(c){c.expandCollapseAll(d);this.updateSelectedRows();this.incrementProperty("expandCollapseCount")}},updateRowData:function(){this._rowDataDidChange=true;this._renderRequired=true;this.displayDidChange()},updateRowCount:function(){var c=this.get("gridAdapter"),d=false;if(!this._slickGrid){return}if(c){d=c.updateRowCount()}if(d){this._slickGrid.updateRowCount();this._slickGrid.scrollRowIntoView(this._slickGrid.getDataLength())}else{this.updateRowData();this.updateSelectedRows()}this._slickGrid.render()},setSelectedRows:function(c){if(this._slickGrid){this._slickGrid.setSelectedRows(c);this._slickGrid.render()}},updateSelectedRows:function(){var c=this.get("gridAdapter"),d=c&&c.getSelectedRows();if(d){this.setSelectedRows(d)}}}}()));(function(j){var f="0.3.0",k="hasOwnProperty",b=/[\.\/]/,a="*",h=function(){},g=function(n,m){return n-m},d,i,l={n:{}},c=function(m,A){var t=l,u=Array.prototype.slice.call(arguments,2),w=c.listeners(m),v=0,s=false,o,n=[],r={},p=[],x=[];d=m;i=0;for(var q=0,y=w.length;q<y;q++){if("zIndex" in w[q]){n.push(w[q].zIndex);if(w[q].zIndex<0){r[w[q].zIndex]=w[q]}}}n.sort(g);while(n[v]<0){o=r[n[v++]];p.push(o.apply(A,u));if(i){return p}}for(q=0;q<y;q++){o=w[q];if("zIndex" in o){if(o.zIndex==n[v]){p.push(o.apply(A,u));if(i){return p}do{v++;o=r[n[v]];o&&p.push(o.apply(A,u));if(i){return p}}while(o)}else{r[o.zIndex]=o}}else{p.push(o.apply(A,u));if(i){return p}}}return p.length?p:null};c.listeners=function(m){var u=m.split(b),s=l,y,t,n,q,x,p,r,v,w=[s],o=[];for(q=0,x=u.length;q<x;q++){v=[];for(p=0,r=w.length;p<r;p++){s=w[p].n;t=[s[u[q]],s[a]];n=2;while(n--){y=t[n];if(y){v.push(y);o=o.concat(y.f||[])}}}w=v}return o};c.on=function(m,p){var r=m.split(b),q=l;for(var n=0,o=r.length;n<o;n++){q=q.n;!q[r[n]]&&(q[r[n]]={n:{}});q=q[r[n]]}q.f=q.f||[];for(n=0,o=q.f.length;n<o;n++){if(q.f[n]==p){return h}}q.f.push(p);return function(s){if(+s==+s){p.zIndex=+s}}};c.stop=function(){i=1};c.nt=function(m){if(m){return new RegExp("(?:\\.|\\/|^)"+m+"(?:\\.|\\/|$)").test(d)}return d};c.unbind=function(n,r){var t=n.split(b),s,v,o,u=[l];for(var q=0,w=t.length;q<w;q++){for(var p=0;p<u.length;p+=o.length-2){o=[p,1];s=u[p].n;if(t[q]!=a){if(s[t[q]]){o.push(s[t[q]])}}else{for(v in s){if(s[k](v)){o.push(s[v])}}}u.splice.apply(u,o)}}for(q=0,w=u.length;q<w;q++){s=u[q];while(s.n){if(r){if(s.f){for(q=0,w=s.f.length;q<w;q++){if(s.f[q]==r){s.f.splice(q,1);break}}!s.f.length&&delete s.f}for(v in s.n){if(s.n[k](v)&&s.n[v].f){var m=s.n[v].f;for(q=0,w=m.length;q<w;q++){if(m[q]==r){m.splice(q,1);break}}!m.length&&delete s.n[v].f}}}else{delete s.f;for(v in s.n){if(s.n[k](v)&&s.n[v].f){delete s.n[v].f}}}s=s.n}}};c.version=f;c.toString=function(){return"You are running Eve "+f};(typeof module!="undefined"&&module.exports)?(module.exports=c):(j.eve=c)})(this);(function(){function aI(E){if(aI.is(E,"function")){return ag?E():eve.on("DOMload",E)}else{if(aI.is(E,a4)){var bA=E,b=aI._engine.create[bu](aI,bA.splice(0,3+aI.is(bA[0],aC))),S=b.set(),g=0,bB=bA.length,d;for(;g<bB;g++){d=bA[g]||{};bk[ac](d.type)&&S.push(b[d.type]().attr(d))}return S}else{var bz=Array.prototype.slice.call(arguments,0);if(aI.is(bz[bz.length-1],"function")){var R=bz.pop();return ag?R.call(aI._engine.create[bu](aI,bz)):eve.on("DOMload",function(){R.call(aI._engine.create[bu](aI,bz))})}else{return aI._engine.create[bu](aI,arguments)}}}}aI.version="2.0.0";aI.eve=eve;var ag,a=/[, ]+/,bk={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},bg=/\{(\d+)\}/g,bx="prototype",ac="hasOwnProperty",aq={doc:document,win:window},s={was:Object.prototype[ac].call(aq.win,"Raphael"),is:aq.win.Raphael},bt=function(){this.customAttributes={}},aV,bd="appendChild",bu="apply",bs="concat",U="createTouch" in aq.doc,aO="",aH=" ",bv=String,C="split",O="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel".split(aH),bl={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},by=bv.prototype.toLowerCase,al=Math,n=al.max,bb=al.min,an=al.abs,be=al.pow,aM=al.PI,aC="number",ab="string",a4="array",aW="toString",a0="fill",aS=Object.prototype.toString,bn={},k="push",h=aI._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,A=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,am={"NaN":1,"Infinity":1,"-Infinity":1},c=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Z=al.round,z="setAttribute",af=parseFloat,P=parseInt,bi=bv.prototype.toUpperCase,r=aI._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},aj=aI._availableAnimAttrs={blur:aC,"clip-rect":"csv",cx:aC,cy:aC,fill:"colour","fill-opacity":aC,"font-size":aC,height:aC,opacity:aC,path:"path",r:aC,rx:aC,ry:aC,stroke:"colour","stroke-opacity":aC,"stroke-width":aC,transform:"transform",width:aC,x:aC,y:aC},a9=/\s*,\s*/,o={hs:1,rg:1},a7=/,?([achlmqrstvxz]),?/gi,aR=/([achlmrqstvz])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,aa=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,aG=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)\s*,?\s*/ig,aN=aI._radial_gradient=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,aL={},bf=function(g,d){return g.key-d.key},t=function(g,d){return af(g)-af(d)},G=function(){},bp=function(b){return b},ap=aI._rectPath=function(b,E,d,g,i){if(i){return[["M",b+i,E],["l",d-i*2,0],["a",i,i,0,0,1,i,i],["l",0,g-i*2],["a",i,i,0,0,1,-i,i],["l",i*2-d,0],["a",i,i,0,0,1,-i,-i],["l",0,i*2-g],["a",i,i,0,0,1,i,-i],["z"]]}return[["M",b,E],["l",d,0],["l",0,g],["l",-d,0],["z"]]},I=function(b,i,g,d){if(d==null){d=g}return[["M",b,i],["m",0,-d],["a",g,d,0,1,1,0,2*d],["a",g,d,0,1,1,0,-2*d],["z"]]},M=aI._getPath={path:function(b){return b.attr("path")},circle:function(d){var b=d.attrs;return I(b.cx,b.cy,b.r)},ellipse:function(d){var b=d.attrs;return I(b.cx,b.cy,b.rx,b.ry)},rect:function(d){var b=d.attrs;return ap(b.x,b.y,b.width,b.height,b.r)},image:function(d){var b=d.attrs;return ap(b.x,b.y,b.width,b.height)},text:function(b){var d=b._getBBox();return ap(d.x,d.y,d.width,d.height)}},J=function(S,d){if(!d){return S}var b,bz,E,g,R;S=T(S);for(E=0,ii=S.length;E<ii;E++){R=S[E];for(g=1,jj=R.length;g<jj;g+=2){b=d.x(R[g],R[g+1]);bz=d.y(R[g],R[g+1]);R[g]=b;R[g+1]=bz}}return S};aI._g=aq;aI.type=(aq.win.SVGAngle||aq.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(aI.type=="VML"){var av=aq.doc.createElement("div"),ay;av.innerHTML='<v:shape adj="1"/>';ay=av.firstChild;ay.style.behavior="url(#default#VML)";if(!(ay&&typeof ay.adj=="object")){return(aI.type=aO)}av=null}aI.svg=!(aI.vml=aI.type=="VML");aI._Paper=bt;aI.fn=aV=bt.prototype=aI.prototype;aI._id=0;aI._oid=0;aI.is=function(d,b){b=by.call(b);if(b=="finite"){return !am[ac](+d)}if(b=="array"){return d instanceof Array}return(b=="null"&&d===null)||(b==typeof d)||(b=="object"&&d===Object(d))||(b=="array"&&Array.isArray&&Array.isArray(d))||aS.call(d).slice(8,-1).toLowerCase()==b};aI.angle=function(E,S,g,R,d,i){if(d==null){var b=E-g,bz=S-R;if(!b&&!bz){return 0}return(180+al.atan2(-bz,-b)*180/aM+360)%360}else{return aI.angle(E,S,d,i)-aI.angle(g,R,d,i)}};aI.rad=function(b){return b%360*aM/180};aI.deg=function(b){return b*180/aM%360};aI.snapTo=function(d,E,b){b=aI.is(b,"finite")?b:10;if(aI.is(d,a4)){var g=d.length;while(g--){if(an(d[g]-E)<=b){return d[g]}}}else{d=+d;var R=E%d;if(R<b){return E-R}if(R>d-b){return E-R+d}}return E};var j=aI._createUUID=(function(b,d){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(b,d).toUpperCase()}})(/[xy]/g,function(g){var d=al.random()*16|0,b=g=="x"?d:(d&3|8);return b.toString(16)});aI.setWindow=function(b){eve("setWindow",aI,aq.win,b);aq.win=b;aq.doc=aq.win.document;if(initWin){initWin(aq.win)}};var a6=function(g){if(aI.vml){var b=/^\s+|\s+$/g;var R;try{var S=new ActiveXObject("htmlfile");S.write("<body>");S.close();R=S.body}catch(bz){R=createPopup().document.body}var d=R.createTextRange();a6=ax(function(i){try{R.style.color=bv(i).replace(b,aO);var bA=d.queryCommandValue("ForeColor");bA=((bA&255)<<16)|(bA&65280)|((bA&16711680)>>>16);return"#"+("000000"+bA.toString(16)).slice(-6)}catch(bB){return"none"}})}else{var E=aq.doc.createElement("i");E.title="Rapha\xebl Colour Picker";E.style.display="none";aq.doc.body.appendChild(E);a6=ax(function(i){E.style.color=i;return aq.doc.defaultView.getComputedStyle(E,aO).getPropertyValue("color")})}return a6(g)},az=function(){return"hsb("+[this.h,this.s,this.b]+")"},K=function(){return"hsl("+[this.h,this.s,this.l]+")"},x=function(){return this.hex},aP=function(R,E,d){if(E==null&&aI.is(R,"object")&&"r" in R&&"g" in R&&"b" in R){d=R.b;E=R.g;R=R.r}if(E==null&&aI.is(R,ab)){var i=aI.getRGB(R);R=i.r;E=i.g;d=i.b}if(R>1||E>1||d>1){R/=255;E/=255;d/=255}return[R,E,d]},aT=function(R,E,d,S){R*=255;E*=255;d*=255;var i={r:R,g:E,b:d,hex:aI.rgb(R,E,d),toString:x};aI.is(S,"finite")&&(i.opacity=S);return i};aI.color=function(b){var d;if(aI.is(b,"object")&&"h" in b&&"s" in b&&"b" in b){d=aI.hsb2rgb(b);b.r=d.r;b.g=d.g;b.b=d.b;b.hex=d.hex}else{if(aI.is(b,"object")&&"h" in b&&"s" in b&&"l" in b){d=aI.hsl2rgb(b);b.r=d.r;b.g=d.g;b.b=d.b;b.hex=d.hex}else{if(aI.is(b,"string")){b=aI.getRGB(b)}if(aI.is(b,"object")&&"r" in b&&"g" in b&&"b" in b){d=aI.rgb2hsl(b);b.h=d.h;b.s=d.s;b.l=d.l;d=aI.rgb2hsb(b);b.v=d.b}else{b={hex:"none"};crl.r=b.g=b.b=b.h=b.s=b.v=b.l=-1}}}b.toString=x;return b};aI.hsb2rgb=function(S,bB,bz,i){if(this.is(S,"object")&&"h" in S&&"s" in S&&"b" in S){bz=S.b;bB=S.s;S=S.h;i=S.o}S*=360;var E,bA,d,g,b;S=(S%360)/60;b=bz*bB;g=b*(1-an(S%2-1));E=bA=d=bz-b;S=~~S;E+=[b,g,0,0,g,b][S];bA+=[g,b,b,g,0,0][S];d+=[0,0,g,b,b,g][S];return aT(E,bA,d,i)};aI.hsl2rgb=function(bz,bB,E,i){if(this.is(bz,"object")&&"h" in bz&&"s" in bz&&"l" in bz){E=bz.l;bB=bz.s;bz=bz.h}if(bz>1||bB>1||E>1){bz/=360;bB/=100;E/=100}bz*=360;var S,bA,d,g,b;bz=(bz%360)/60;b=2*bB*(E<0.5?E:1-E);g=b*(1-an(bz%2-1));S=bA=d=E-b/2;bz=~~bz;S+=[b,g,0,0,g,b][bz];bA+=[g,b,b,g,0,0][bz];d+=[0,0,g,b,b,g][bz];return aT(S,bA,d,i)};aI.rgb2hsb=function(bA,bz,d){d=aP(bA,bz,d);bA=d[0];bz=d[1];d=d[2];var R,E,i,bB;i=n(bA,bz,d);bB=i-bb(bA,bz,d);R=(bB==0?null:i==bA?(bz-d)/bB:i==bz?(d-bA)/bB+2:(bA-bz)/bB+4);R=((R+360)%6)*60/360;E=bB==0?0:bB/i;return{h:R,s:E,b:i,toString:az}};aI.rgb2hsl=function(d,bz,bC){bC=aP(d,bz,bC);d=bC[0];bz=bC[1];bC=bC[2];var bD,R,bB,bA,E,i;bA=n(d,bz,bC);E=bb(d,bz,bC);i=bA-E;bD=(i==0?null:bA==d?(bz-bC)/i:bA==bz?(bC-d)/i+2:(d-bz)/i+4);bD=((bD+360)%6)*60/360;bB=(bA+E)/2;R=(i==0?0:bB<0.5?i/(2*bB):i/(2-2*bB));return{h:bD,s:R,l:bB,toString:K}};aI._path2string=function(){return this.join(",").replace(a7,"$1")};function ba(E,g){for(var b=0,d=E.length;b<d;b++){if(E[b]===g){return E.push(E.splice(b,1)[0])}}}function ax(i,d,b){function g(){var E=Array.prototype.slice.call(arguments,0),S=E.join("\u2400"),R=g.cache=g.cache||{},bz=g.count=g.count||[];if(R[ac](S)){ba(bz,S);return b?b(R[S]):R[S]}bz.length>=1000&&delete R[bz.shift()];bz.push(S);R[S]=i[bu](d,E);return b?b(R[S]):R[S]}return g}var bj=aI._preload=function(g,d){var b=aq.doc.createElement("img");b.style.cssText="position:absolute;left:-9999em;top-9999em";b.onload=function(){d.call(this);this.onload=null;aq.doc.body.removeChild(this)};b.onerror=function(){aq.doc.body.removeChild(this)};aq.doc.body.appendChild(b);b.src=g};function ai(){return this.hex}aI.getRGB=ax(function(b){if(!b||!!((b=bv(b)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ai}}if(b=="none"){return{r:-1,g:-1,b:-1,hex:"none",toString:ai}}!(o[ac](b.toLowerCase().substring(0,2))||b.charAt()=="#")&&(b=a6(b));var E,d,g,S,i,bA,bz,R=b.match(A);if(R){if(R[2]){S=P(R[2].substring(5),16);g=P(R[2].substring(3,5),16);d=P(R[2].substring(1,3),16)}if(R[3]){S=P((bA=R[3].charAt(3))+bA,16);g=P((bA=R[3].charAt(2))+bA,16);d=P((bA=R[3].charAt(1))+bA,16)}if(R[4]){bz=R[4].split(a9);d=af(bz[0]);bz[0].slice(-1)=="%"&&(d*=2.55);g=af(bz[1]);bz[1].slice(-1)=="%"&&(g*=2.55);S=af(bz[2]);bz[2].slice(-1)=="%"&&(S*=2.55);R[1].toLowerCase().slice(0,4)=="rgba"&&(i=af(bz[3]));bz[3]&&bz[3].slice(-1)=="%"&&(i/=100)}if(R[5]){bz=R[5].split(a9);d=af(bz[0]);bz[0].slice(-1)=="%"&&(d*=2.55);g=af(bz[1]);bz[1].slice(-1)=="%"&&(g*=2.55);S=af(bz[2]);bz[2].slice(-1)=="%"&&(S*=2.55);(bz[0].slice(-3)=="deg"||bz[0].slice(-1)=="\xb0")&&(d/=360);R[1].toLowerCase().slice(0,4)=="hsba"&&(i=af(bz[3]));bz[3]&&bz[3].slice(-1)=="%"&&(i/=100);return aI.hsb2rgb(d,g,S,i)}if(R[6]){bz=R[6].split(a9);d=af(bz[0]);bz[0].slice(-1)=="%"&&(d*=2.55);g=af(bz[1]);bz[1].slice(-1)=="%"&&(g*=2.55);S=af(bz[2]);bz[2].slice(-1)=="%"&&(S*=2.55);(bz[0].slice(-3)=="deg"||bz[0].slice(-1)=="\xb0")&&(d/=360);R[1].toLowerCase().slice(0,4)=="hsla"&&(i=af(bz[3]));bz[3]&&bz[3].slice(-1)=="%"&&(i/=100);return aI.hsl2rgb(d,g,S,i)}R={r:d,g:g,b:S,toString:ai};R.hex="#"+(16777216|S|(g<<8)|(d<<16)).toString(16).slice(1);aI.is(i,"finite")&&(R.opacity=i);return R}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ai}},aI);aI.hsb=ax(function(i,g,d){return aI.hsb2rgb(i,g,d).hex});aI.hsl=ax(function(g,d,b){return aI.hsl2rgb(g,d,b).hex});aI.rgb=ax(function(E,i,d){return"#"+(16777216|d|(i<<8)|(E<<16)).toString(16).slice(1)});aI.getColor=function(d){var g=this.getColor.start=this.getColor.start||{h:0,s:1,b:d||0.75},b=this.hsb2rgb(g.h,g.s,g.b);g.h+=0.075;if(g.h>1){g.h=0;g.s-=0.2;g.s<=0&&(this.getColor.start={h:0,s:1,b:g.b})}return b.hex};aI.getColor.reset=function(){delete this.start};function a2(E){var S=[];for(var g=0,b=E.length;b-2>g;g+=2){var R=[{x:+E[g],y:+E[g+1]},{x:+E[g],y:+E[g+1]},{x:+E[g+2],y:+E[g+3]},{x:+E[g+4],y:+E[g+5]}];if(b-4==g){R[0]={x:+E[g-2],y:+E[g-1]};R[3]=R[2]}else{if(g){R[0]={x:+E[g-2],y:+E[g-1]}}}S.push(["C",(-R[0].x+6*R[1].x+R[2].x)/6,(-R[0].y+6*R[1].y+R[2].y)/6,(R[1].x+6*R[2].x-R[3].x)/6,(R[1].y+6*R[2].y-R[3].y)/6,R[2].x,R[2].y])}return S}aI.parsePathString=ax(function(b){if(!b){return null}var g={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},d=[];if(aI.is(b,a4)&&aI.is(b[0],a4)){d=aQ(b)}if(!d.length){bv(b).replace(aR,function(E,i,bz){var S=[],R=i.toLowerCase();bz.replace(aG,function(bB,bA){bA&&S.push(+bA)});if(R=="m"&&S.length>2){d.push([i][bs](S.splice(0,2)));R="l";i=i=="m"?"l":"L"}if(R=="r"){d.push([i][bs](S))}else{while(S.length>=g[R]){d.push([i][bs](S.splice(0,g[R])));if(!g[R]){break}}}})}d.toString=aI._path2string;return d});aI.parseTransformString=ax(function(d){if(!d){return null}var g={r:3,s:4,t:2,m:6},b=[];if(aI.is(d,a4)&&aI.is(d[0],a4)){b=aQ(d)}if(!b.length){bv(d).replace(aa,function(E,i,bz){var S=[],R=by.call(i);bz.replace(aG,function(bB,bA){bA&&S.push(+bA)});b.push([R][bs](S))})}b.toString=aI._path2string;return b});aI.findDotsAtSegment=function(d,b,bQ,bO,S,E,bB,bz,bJ){var bG=1-bJ,bL=be(bG,3),bM=be(bG,2),bD=bJ*bJ,bA=bD*bJ,bF=bL*d+bM*3*bJ*bQ+bG*3*bJ*bJ*S+bA*bB,bC=bL*b+bM*3*bJ*bO+bG*3*bJ*bJ*E+bA*bz,bK=d+2*bJ*(bQ-d)+bD*(S-2*bQ+d),bI=b+2*bJ*(bO-b)+bD*(E-2*bO+b),bP=bQ+2*bJ*(S-bQ)+bD*(bB-2*S+bQ),bN=bO+2*bJ*(E-bO)+bD*(bz-2*E+bO),bH=bG*d+bJ*bQ,bE=bG*b+bJ*bO,i=bG*S+bJ*bB,g=bG*E+bJ*bz,R=(90-al.atan2(bK-bP,bI-bN)*180/aM);(bK>bP||bI<bN)&&(R+=180);return{x:bF,y:bC,m:{x:bK,y:bI},n:{x:bP,y:bN},start:{x:bH,y:bE},end:{x:i,y:g},alpha:R}};var ae=ax(function(bD){if(!bD){return{x:0,y:0,width:0,height:0}}bD=T(bD);var bA=0,bz=0,E=[],d=[],g;for(var R=0,bC=bD.length;R<bC;R++){g=bD[R];if(g[0]=="M"){bA=g[1];bz=g[2];E.push(bA);d.push(bz)}else{var S=a1(bA,bz,g[1],g[2],g[3],g[4],g[5],g[6]);E=E[bs](S.min.x,S.max.x);d=d[bs](S.min.y,S.max.y);bA=g[5];bz=g[6]}}var b=bb[bu](0,E),bB=bb[bu](0,d);return{x:b,y:bB,width:n[bu](0,E)-b,height:n[bu](0,d)-bB}},null,function(b){return{x:b.x,y:b.y,width:b.width,height:b.height}}),aQ=function(S){var g=[];if(!aI.is(S,a4)||!aI.is(S&&S[0],a4)){S=aI.parsePathString(S)}for(var d=0,E=S.length;d<E;d++){g[d]=[];for(var b=0,R=S[d].length;b<R;b++){g[d][b]=S[d][b]}}g.toString=aI._path2string;return g},at=aI._pathToRelative=ax(function(E){if(!aI.is(E,a4)||!aI.is(E&&E[0],a4)){E=aI.parsePathString(E)}var bC=[],bE=0,bD=0,bH=0,bG=0,g=0;if(E[0][0]=="M"){bE=E[0][1];bD=E[0][2];bH=bE;bG=bD;g++;bC.push(["M",bE,bD])}for(var bz=g,bI=E.length;bz<bI;bz++){var b=bC[bz]=[],bF=E[bz];if(bF[0]!=by.call(bF[0])){b[0]=by.call(bF[0]);switch(b[0]){case"a":b[1]=bF[1];b[2]=bF[2];b[3]=bF[3];b[4]=bF[4];b[5]=bF[5];b[6]=+(bF[6]-bE).toFixed(3);b[7]=+(bF[7]-bD).toFixed(3);break;case"v":b[1]=+(bF[1]-bD).toFixed(3);break;case"m":bH=bF[1];bG=bF[2];default:for(var S=1,bA=bF.length;S<bA;S++){b[S]=+(bF[S]-((S%2)?bE:bD)).toFixed(3)}}}else{b=bC[bz]=[];if(bF[0]=="m"){bH=bF[1]+bE;bG=bF[2]+bD}for(var R=0,d=bF.length;R<d;R++){bC[bz][R]=bF[R]}}var bB=bC[bz].length;switch(bC[bz][0]){case"z":bE=bH;bD=bG;break;case"h":bE+=+bC[bz][bB-1];break;case"v":bD+=+bC[bz][bB-1];break;default:bE+=+bC[bz][bB-2];bD+=+bC[bz][bB-1]}}bC.toString=aI._path2string;return bC},0,aQ),v=aI._pathToAbsolute=ax(function(E){if(!aI.is(E,a4)||!aI.is(E&&E[0],a4)){E=aI.parsePathString(E)}if(!E||!E.length){return[["M",0,0]]}var bB=[],bE=0,bD=0,bH=0,bG=0,g=0;if(E[0][0]=="M"){bE=+E[0][1];bD=+E[0][2];bH=bE;bG=bD;g++;bB[0]=["M",bE,bD]}for(var b,bF,bz=g,bI=E.length;bz<bI;bz++){bB.push(b=[]);bF=E[bz];if(bF[0]!=bi.call(bF[0])){b[0]=bi.call(bF[0]);switch(b[0]){case"A":b[1]=bF[1];b[2]=bF[2];b[3]=bF[3];b[4]=bF[4];b[5]=bF[5];b[6]=+(bF[6]+bE);b[7]=+(bF[7]+bD);break;case"V":b[1]=+bF[1]+bD;break;case"H":b[1]=+bF[1]+bE;break;case"R":var bC=[bE,bD][bs](bF.slice(1));for(var S=2,bA=bC.length;S<bA;S++){bC[S]=+bC[S]+bE;bC[++S]=+bC[S]+bD}bB.pop();bB=bB[bs](a2(bC));break;case"M":bH=+bF[1]+bE;bG=+bF[2]+bD;default:for(S=1,bA=bF.length;S<bA;S++){b[S]=+bF[S]+((S%2)?bE:bD)}}}else{if(bF[0]=="R"){bC=[bE,bD][bs](bF.slice(1));bB.pop();bB=bB[bs](a2(bC));b=["R"][bs](bF.slice(-2))}else{for(var R=0,d=bF.length;R<d;R++){b[R]=bF[R]}}}switch(b[0]){case"Z":bE=bH;bD=bG;break;case"H":bE=b[1];break;case"V":bD=b[1];break;case"M":bH=b[b.length-2];bG=b[b.length-1];default:bE=b[b.length-2];bD=b[b.length-1]}}bB.toString=aI._path2string;return bB},null,aQ),bw=function(d,i,b,g){return[d,i,b,g,b,g]},bc=function(d,i,S,E,b,g){var R=1/3,bz=2/3;return[R*d+bz*S,R*i+bz*E,R*b+bz*S,R*g+bz*E,b,g]},X=function(bG,cb,bP,bN,bH,bB,E,bF,ca,bI){var bM=aM*120/180,b=aM/180*(+bH||0),bT=[],bQ,b7=ax(function(cc,cf,i){var ce=cc*al.cos(i)-cf*al.sin(i),cd=cc*al.sin(i)+cf*al.cos(i);return{x:ce,y:cd}});if(!bI){bQ=b7(bG,cb,-b);bG=bQ.x;cb=bQ.y;bQ=b7(bF,ca,-b);bF=bQ.x;ca=bQ.y;var d=al.cos(aM/180*bH),bD=al.sin(aM/180*bH),bV=(bG-bF)/2,bU=(cb-ca)/2;var b5=(bV*bV)/(bP*bP)+(bU*bU)/(bN*bN);if(b5>1){b5=al.sqrt(b5);bP=b5*bP;bN=b5*bN}var g=bP*bP,bY=bN*bN,b0=(bB==E?-1:1)*al.sqrt(an((g*bY-g*bU*bU-bY*bV*bV)/(g*bU*bU+bY*bV*bV))),bK=b0*bP*bU/bN+(bG+bF)/2,bJ=b0*-bN*bV/bP+(cb+ca)/2,bA=al.asin(((cb-bJ)/bN).toFixed(9)),bz=al.asin(((ca-bJ)/bN).toFixed(9));bA=bG<bK?aM-bA:bA;bz=bF<bK?aM-bz:bz;bA<0&&(bA=aM*2+bA);bz<0&&(bz=aM*2+bz);if(E&&bA>bz){bA=bA-aM*2}if(!E&&bz>bA){bz=bz-aM*2}}else{bA=bI[0];bz=bI[1];bK=bI[2];bJ=bI[3]}var bE=bz-bA;if(an(bE)>bM){var bL=bz,bO=bF,bC=ca;bz=bA+bM*(E&&bz>bA?1:-1);bF=bK+bP*al.cos(bz);ca=bJ+bN*al.sin(bz);bT=X(bF,ca,bP,bN,bH,0,E,bO,bC,[bz,bL,bK,bJ])}bE=bz-bA;var S=al.cos(bA),b9=al.sin(bA),R=al.cos(bz),b8=al.sin(bz),bW=al.tan(bE/4),bZ=4/3*bP*bW,bX=4/3*bN*bW,b6=[bG,cb],b4=[bG+bZ*b9,cb-bX*S],b3=[bF+bZ*b8,ca-bX*R],b1=[bF,ca];b4[0]=2*b6[0]-b4[0];b4[1]=2*b6[1]-b4[1];if(bI){return[b4,b3,b1][bs](bT)}else{bT=[b4,b3,b1][bs](bT).join().split(",");var bR=[];for(var b2=0,bS=bT.length;b2<bS;b2++){bR[b2]=b2%2?b7(bT[b2-1],bT[b2],b).y:b7(bT[b2],bT[b2+1],b).x}return bR}},Y=function(d,b,i,g,bA,bz,S,R,bB){var E=1-bB;return{x:be(E,3)*d+be(E,2)*3*bB*i+E*3*bB*bB*bA+be(bB,3)*S,y:be(E,3)*b+be(E,2)*3*bB*g+E*3*bB*bB*bz+be(bB,3)*R}},a1=ax(function(i,d,R,E,bI,bH,bE,bB){var bG=(bI-2*R+i)-(bE-2*bI+R),bD=2*(R-i)-2*(bI-R),bA=i-R,bz=(-bD+al.sqrt(bD*bD-4*bG*bA))/2/bG,S=(-bD-al.sqrt(bD*bD-4*bG*bA))/2/bG,bC=[d,bB],bF=[i,bE],g;an(bz)>"1e12"&&(bz=0.5);an(S)>"1e12"&&(S=0.5);if(bz>0&&bz<1){g=Y(i,d,R,E,bI,bH,bE,bB,bz);bF.push(g.x);bC.push(g.y)}if(S>0&&S<1){g=Y(i,d,R,E,bI,bH,bE,bB,S);bF.push(g.x);bC.push(g.y)}bG=(bH-2*E+d)-(bB-2*bH+E);bD=2*(E-d)-2*(bH-E);bA=d-E;bz=(-bD+al.sqrt(bD*bD-4*bG*bA))/2/bG;S=(-bD-al.sqrt(bD*bD-4*bG*bA))/2/bG;an(bz)>"1e12"&&(bz=0.5);an(S)>"1e12"&&(S=0.5);if(bz>0&&bz<1){g=Y(i,d,R,E,bI,bH,bE,bB,bz);bF.push(g.x);bC.push(g.y)}if(S>0&&S<1){g=Y(i,d,R,E,bI,bH,bE,bB,S);bF.push(g.x);bC.push(g.y)}return{min:{x:bb[bu](0,bF),y:bb[bu](0,bC)},max:{x:n[bu](0,bF),y:n[bu](0,bC)}}}),T=aI._path2curve=ax(function(bH,bC){var E=v(bH),bD=bC&&v(bC),bE={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},b={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},S=function(bI,bJ){var i,bK;if(!bI){return["C",bJ.x,bJ.y,bJ.x,bJ.y,bJ.x,bJ.y]}!(bI[0] in {T:1,Q:1})&&(bJ.qx=bJ.qy=null);switch(bI[0]){case"M":bJ.X=bI[1];bJ.Y=bI[2];break;case"A":bI=["C"][bs](X[bu](0,[bJ.x,bJ.y][bs](bI.slice(1))));break;case"S":i=bJ.x+(bJ.x-(bJ.bx||bJ.x));bK=bJ.y+(bJ.y-(bJ.by||bJ.y));bI=["C",i,bK][bs](bI.slice(1));break;case"T":bJ.qx=bJ.x+(bJ.x-(bJ.qx||bJ.x));bJ.qy=bJ.y+(bJ.y-(bJ.qy||bJ.y));bI=["C"][bs](bc(bJ.x,bJ.y,bJ.qx,bJ.qy,bI[1],bI[2]));break;case"Q":bJ.qx=bI[1];bJ.qy=bI[2];bI=["C"][bs](bc(bJ.x,bJ.y,bI[1],bI[2],bI[3],bI[4]));break;case"L":bI=["C"][bs](bw(bJ.x,bJ.y,bI[1],bI[2]));break;case"H":bI=["C"][bs](bw(bJ.x,bJ.y,bI[1],bJ.y));break;case"V":bI=["C"][bs](bw(bJ.x,bJ.y,bJ.x,bI[1]));break;case"Z":bI=["C"][bs](bw(bJ.x,bJ.y,bJ.X,bJ.Y));break}return bI},d=function(bI,bJ){if(bI[bJ].length>7){bI[bJ].shift();var bK=bI[bJ];while(bK.length){bI.splice(bJ++,0,["C"][bs](bK.splice(0,6)))}bI.splice(bJ,1);bF=n(E.length,bD&&bD.length||0)}},g=function(bM,bL,bJ,bI,bK){if(bM&&bL&&bM[bK][0]=="M"&&bL[bK][0]!="M"){bL.splice(bK,0,["M",bI.x,bI.y]);bJ.bx=0;bJ.by=0;bJ.x=bM[bK][1];bJ.y=bM[bK][2];bF=n(E.length,bD&&bD.length||0)}};for(var bA=0,bF=n(E.length,bD&&bD.length||0);bA<bF;bA++){E[bA]=S(E[bA],bE);d(E,bA);bD&&(bD[bA]=S(bD[bA],b));bD&&d(bD,bA);g(E,bD,bE,b,bA);g(bD,E,b,bE,bA);var bz=E[bA],bG=bD&&bD[bA],R=bz.length,bB=bD&&bG.length;bE.x=bz[R-2];bE.y=bz[R-1];bE.bx=af(bz[R-4])||bE.x;bE.by=af(bz[R-3])||bE.y;b.bx=bD&&(af(bG[bB-4])||b.x);b.by=bD&&(af(bG[bB-3])||b.y);b.x=bD&&bG[bB-2];b.y=bD&&bG[bB-1]}return bD?[E,bD]:E},null,aQ),u=aI._parseDots=ax(function(bC){var bB=[];for(var S=0,bD=bC.length;S<bD;S++){var b={},bA=bC[S].match(/^([^:]*):?([\d\.]*)/);b.color=aI.getRGB(bA[1]);if(b.color.error){return null}b.color=b.color.hex;bA[2]&&(b.offset=bA[2]+"%");bB.push(b)}for(S=1,bD=bB.length-1;S<bD;S++){if(!bB[S].offset){var g=af(bB[S-1].offset||0),E=0;for(var R=S+1;R<bD;R++){if(bB[R].offset){E=bB[R].offset;break}}if(!E){E=100;R=bD}E=af(E);var bz=(E-g)/(R-S+1);for(;S<R;S++){g+=bz;bB[S].offset=g+"%"}}}return bB}),aB=aI._tear=function(b,d){b==d.top&&(d.top=b.prev);b==d.bottom&&(d.bottom=b.next);b.next&&(b.next.prev=b.prev);b.prev&&(b.prev.next=b.next)},ah=aI._tofront=function(b,d){if(d.top===b){return}aB(b,d);b.next=null;b.prev=d.top;d.top.next=b;d.top=b},q=aI._toback=function(b,d){if(d.bottom===b){return}aB(b,d);b.next=d.bottom;b.prev=null;d.bottom.prev=b;d.bottom=b},D=aI._insertafter=function(d,b,g){aB(d,g);b==g.top&&(g.top=d);b.next&&(b.next.prev=d);d.next=b.next;d.prev=b;b.next=d},aK=aI._insertbefore=function(d,b,g){aB(d,g);b==g.bottom&&(g.bottom=d);b.prev&&(b.prev.next=d);d.prev=b.prev;b.prev=d;d.next=b},w=function(b){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+b+"\u201d of removed object")}},aF=aI._extractTransform=function(d,bz){if(bz==null){return d._.transform}bz=bv(bz).replace(/\.{3}|\u2026/g,d._.transform||aO);var R=aI.parseTransformString(bz),b=0,bH=0,bG=0,bC=1,bB=1,bD=d._,g=new aw;bD.transform=R||[];if(R){for(var S=0,bE=R.length;S<bE;S++){var bF=R[S],E=bF.length,bA;bF[0]=bv(bF[0]).toLowerCase();if(bF[0]=="t"&&E==3){g.translate(bF[1],bF[2])}else{if(bF[0]=="r"){if(E==2){bA=bA||d.getBBox(1);g.rotate(bF[1],bA.x+bA.width/2,bA.y+bA.height/2);b+=bF[1]}else{if(E==4){g.rotate(bF[1],bF[2],bF[3]);b+=bF[1]}}}else{if(bF[0]=="s"){if(E==2||E==3){bA=bA||d.getBBox(1);g.scale(bF[1],bF[E-1],bA.x+bA.width/2,bA.y+bA.height/2);bC*=bF[1];bB*=bF[E-1]}else{if(E==5){g.scale(bF[1],bF[2],bF[3],bF[4]);bC*=bF[1];bB*=bF[2]}}}else{if(bF[0]=="m"&&E==7){g.add(bF[1],bF[2],bF[3],bF[4],bF[5],bF[6])}}}}bD.dirtyT=1;d.matrix=g}}d.matrix=g;bD.sx=bC;bD.sy=bB;bD.deg=b;bD.dx=bH=g.e;bD.dy=bG=g.f;if(bC==1&&bB==1&&!b&&bD.bbox){bD.bbox.x+=+bH;bD.bbox.y+=+bG}else{bD.dirtyT=1}},m=function(b){switch(b[0]){case"t":return["t",0,0];case"m":return["m",1,0,0,1,0,0];case"r":if(b.length==4){return["r",0,b[2],b[3]]}else{return["r",0]}case"s":if(b.length==5){return["s",1,1,b[3],b[4]]}else{if(b.length==3){return["s",1,1]}else{return["s",1]}}}},ar=aI._equaliseTransform=function(R,E){E=bv(E).replace(/\.{3}|\u2026/g,R);R=aI.parseTransformString(R)||[];E=aI.parseTransformString(E)||[];var b=n(R.length,E.length),bB=[],bC=[],g=0,d,S,bA,bz;for(;g<b;g++){bA=R[g]||m(E[g]);bz=E[g]||m(bA);if((bA[0]!=bz[0])||(bA[0]=="r"&&(bA[2]!=bz[2]||bA[3]!=bz[3]))||(bA[0]=="s"&&(bA[3]!=bz[3]||bA[4]!=bz[4]))){return}bB[g]=[];bC[g]=[];for(d=0,S=n(bA.length,bz.length);d<S;d++){d in bA&&(bB[g][d]=bA[d]);d in bz&&(bC[g][d]=bz[d])}}return{from:bB,to:bC}};aI._getContainer=function(b,E,g,i){var d;d=i==null&&!aI.is(b,"object")?aq.doc.getElementById(b):b;if(d==null){return}if(d.tagName){if(E==null){return{container:d,width:d.style.pixelWidth||d.offsetWidth,height:d.style.pixelHeight||d.offsetHeight}}else{return{container:d,width:E,height:g}}}return{container:1,x:b,y:E,width:g,height:i}};aI.pathToRelative=at;aI._engine={};aI.path2curve=T;aI.matrix=function(i,g,bz,S,R,E){return new aw(i,g,bz,S,R,E)};function aw(i,g,bz,S,R,E){if(i!=null){this.a=+i;this.b=+g;this.c=+bz;this.d=+S;this.e=+R;this.f=+E}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0}}(function(g){g.add=function(bH,bE,bC,bA,S,R){var E=[[],[],[]],i=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],bG=[[bH,bC,S],[bE,bA,R],[0,0,1]],bF,bD,bB,bz;if(bH&&bH instanceof aw){bG=[[bH.a,bH.c,bH.e],[bH.b,bH.d,bH.f],[0,0,1]]}for(bF=0;bF<3;bF++){for(bD=0;bD<3;bD++){bz=0;for(bB=0;bB<3;bB++){bz+=i[bF][bB]*bG[bB][bD]}E[bF][bD]=bz}}this.a=E[0][0];this.b=E[1][0];this.c=E[0][1];this.d=E[1][1];this.e=E[0][2];this.f=E[1][2]};g.invert=function(){var E=this,i=E.a*E.d-E.b*E.c;return new aw(E.d/i,-E.b/i,-E.c/i,E.a/i,(E.c*E.f-E.d*E.e)/i,(E.b*E.e-E.a*E.f)/i)};g.clone=function(){return new aw(this.a,this.b,this.c,this.d,this.e,this.f)};g.translate=function(i,E){this.add(1,0,0,1,i,E)};g.scale=function(E,S,i,R){S==null&&(S=E);(i||R)&&this.add(1,0,0,1,i,R);this.add(E,0,0,S,0,0);(i||R)&&this.add(1,0,0,1,-i,-R)};g.rotate=function(E,i,bz){E=aI.rad(E);i=i||0;bz=bz||0;var S=+al.cos(E).toFixed(9),R=+al.sin(E).toFixed(9);this.add(S,R,-R,S,i,bz);this.add(1,0,0,1,-i,-bz)};g.x=function(i,E){return i*this.a+E*this.c+this.e};g.y=function(i,E){return i*this.b+E*this.d+this.f};g.get=function(E){return +this[bv.fromCharCode(97+E)].toFixed(4)};g.toString=function(){return aI.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};g.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};g.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};function d(i){return i[0]*i[0]+i[1]*i[1]}function b(i){var E=al.sqrt(d(i));i[0]&&(i[0]/=E);i[1]&&(i[1]/=E)}g.split=function(){var E={};E.dx=this.e;E.dy=this.f;var S=[[this.a,this.c],[this.b,this.d]];E.scalex=al.sqrt(d(S[0]));b(S[0]);E.shear=S[0][0]*S[1][0]+S[0][1]*S[1][1];S[1]=[S[1][0]-S[0][0]*E.shear,S[1][1]-S[0][1]*E.shear];E.scaley=al.sqrt(d(S[1]));b(S[1]);E.shear/=E.scaley;var i=-S[0][1],R=S[1][1];if(R<0){E.rotate=aI.deg(al.acos(R));if(i<0){E.rotate=360-E.rotate}}else{E.rotate=aI.deg(al.asin(i))}E.isSimple=!+E.shear.toFixed(9)&&(E.scalex.toFixed(9)==E.scaley.toFixed(9)||!E.rotate);E.isSuperSimple=!+E.shear.toFixed(9)&&E.scalex.toFixed(9)==E.scaley.toFixed(9)&&!E.rotate;E.noRotation=!+E.shear.toFixed(9)&&!E.rotate;return E};g.toTransformString=function(){var i=this.split();if(i.isSimple){return"t"+[i.dx,i.dy]+"s"+[i.scalex,i.scaley,0,0]+"r"+[i.rotate,0,0]}else{return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}})(aw.prototype);var Q=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);if((navigator.vendor=="Apple Computer, Inc.")&&(Q&&Q[1]<4||navigator.platform.slice(0,2)=="iP")||(navigator.vendor=="Google Inc."&&Q&&Q[1]<8)){aV.safari=function(){var b=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){b.remove()})}}else{aV.safari=G}var N=function(){this.returnValue=false},br=function(){return this.originalEvent.preventDefault()},aZ=function(){this.cancelBubble=true},aA=function(){return this.originalEvent.stopPropagation()},au=(function(){if(aq.doc.addEventListener){return function(R,i,g,d){var b=U&&bl[i]?bl[i]:i,E=function(bD){var bC=aq.doc.documentElement.scrollTop||aq.doc.body.scrollTop,bE=aq.doc.documentElement.scrollLeft||aq.doc.body.scrollLeft,S=bD.clientX+bE,bF=bD.clientY+bC;if(U&&bl[ac](i)){for(var bA=0,bB=bD.targetTouches&&bD.targetTouches.length;bA<bB;bA++){if(bD.targetTouches[bA].target==R){var bz=bD;bD=bD.targetTouches[bA];bD.originalEvent=bz;bD.preventDefault=br;bD.stopPropagation=aA;break}}}return g.call(d,bD,S,bF)};R.addEventListener(b,E,false);return function(){R.removeEventListener(b,E,false);return true}}}else{if(aq.doc.attachEvent){return function(R,i,g,d){var E=function(bA){bA=bA||aq.win.event;var bz=aq.doc.documentElement.scrollTop||aq.doc.body.scrollTop,bB=aq.doc.documentElement.scrollLeft||aq.doc.body.scrollLeft,S=bA.clientX+bB,bC=bA.clientY+bz;bA.preventDefault=bA.preventDefault||N;bA.stopPropagation=bA.stopPropagation||aZ;return g.call(d,bA,S,bC)};R.attachEvent("on"+i,E);var b=function(){R.detachEvent("on"+i,E);return true};return b}}}})(),a5=[],bm=function(bA){var bD=bA.clientX,bC=bA.clientY,bF=aq.doc.documentElement.scrollTop||aq.doc.body.scrollTop,bG=aq.doc.documentElement.scrollLeft||aq.doc.body.scrollLeft,g,E=a5.length;while(E--){g=a5[E];if(U){var S=bA.touches.length,R;while(S--){R=bA.touches[S];if(R.identifier==g.el._drag.id){bD=R.clientX;bC=R.clientY;(bA.originalEvent?bA.originalEvent:bA).preventDefault();break}}}else{bA.preventDefault()}var d=g.el.node,b,bz=d.nextSibling,bE=d.parentNode,bB=d.style.display;aq.win.opera&&bE.removeChild(d);d.style.display="none";b=g.el.paper.getElementByPoint(bD,bC);d.style.display=bB;aq.win.opera&&(bz?bE.insertBefore(d,bz):bE.appendChild(d));b&&eve("drag.over."+g.el.id,g.el,b);bD+=bG;bC+=bF;eve("drag.move."+g.el.id,g.move_scope||g.el,bD-g.el._drag.x,bC-g.el._drag.y,bD,bC,bA)}},f=function(g){aI.unmousemove(bm).unmouseup(f);var d=a5.length,b;while(d--){b=a5[d];b.el._drag={};eve("drag.end."+b.el.id,b.end_scope||b.start_scope||b.move_scope||b.el,g)}a5=[]},a8=aI.el={};for(var ao=O.length;ao--;){(function(b){aI[b]=a8[b]=function(g,d){if(aI.is(g,"function")){this.events=this.events||[];this.events.push({name:b,f:g,unbind:au(this.shape||this.node||aq.doc,b,g,d||this)})}return this};aI["un"+b]=a8["un"+b]=function(i){var g=this.events,d=g.length;while(d--){if(g[d].name==b&&g[d].f==i){g[d].unbind();g.splice(d,1);!g.length&&delete this.events;return this}}return this}})(O[ao])}a8.data=function(d,E){var g=aL[this.id]=aL[this.id]||{};if(arguments.length==1){if(aI.is(d,"object")){for(var b in d){if(d[ac](b)){this.data(b,d[b])}}return this}eve("data.get."+this.id,this,g[d],d);return g[d]}g[d]=E;eve("data.set."+this.id,this,E,d);return this};a8.removeData=function(b){if(b==null){aL[this.id]={}}else{aL[this.id]&&delete aL[this.id][b]}return this};a8.hover=function(i,b,g,d){return this.mouseover(i,g).mouseout(b,d||g)};a8.unhover=function(d,b){return this.unmouseover(d).unmouseout(b)};a8.drag=function(d,R,E,b,g,i){function S(bA){(bA.originalEvent||bA).preventDefault();var bz=aq.doc.documentElement.scrollTop||aq.doc.body.scrollTop,bB=aq.doc.documentElement.scrollLeft||aq.doc.body.scrollLeft;this._drag.x=bA.clientX+bB;this._drag.y=bA.clientY+bz;this._drag.id=bA.identifier;!a5.length&&aI.mousemove(bm).mouseup(f);a5.push({el:this,move_scope:b,start_scope:g,end_scope:i});R&&eve.on("drag.start."+this.id,R);d&&eve.on("drag.move."+this.id,d);E&&eve.on("drag.end."+this.id,E);eve("drag.start."+this.id,g||b||this,bA.clientX+bB,bA.clientY+bz,bA)}this._drag={};this.mousedown(S);return this};a8.onDragOver=function(b){b?eve.on("drag.over."+this.id,b):eve.unbind("drag.over."+this.id)};a8.undrag=function(){var b=a5.length;while(b--){if(a5[b].el==this){aI.unmousedown(a5[b].start);a5.splice(b++,1);eve.unbind("drag.*."+this.id)}}!a5.length&&aI.unmousemove(bm).unmouseup(f)};aV.circle=function(b,i,g){var d=aI._engine.circle(this,b||0,i||0,g||0);this.__set__&&this.__set__.push(d);return d};aV.rect=function(b,R,d,i,E){var g=aI._engine.rect(this,b||0,R||0,d||0,i||0,E||0);this.__set__&&this.__set__.push(g);return g};aV.ellipse=function(b,E,i,g){var d=aI._engine.ellipse(this,b||0,E||0,i||0,g||0);this.__set__&&this.__set__.push(d);return d};aV.path=function(b){b&&!aI.is(b,ab)&&!aI.is(b[0],a4)&&(b+=aO);var d=aI._engine.path(aI.format[bu](aI,arguments),this);this.__set__&&this.__set__.push(d);return d};aV.image=function(E,b,R,d,i){var g=aI._engine.image(this,E||"about:blank",b||0,R||0,d||0,i||0);this.__set__&&this.__set__.push(g);return g};aV.text=function(b,i,g){var d=aI._engine.text(this,b||0,i||0,bv(g));this.__set__&&this.__set__.push(d);return d};aV.set=function(d){!aI.is(d,"array")&&(d=Array.prototype.splice.call(arguments,0,arguments.length));var b=new ad(d);this.__set__&&this.__set__.push(b);return b};aV.setStart=function(b){this.__set__=b||this.set()};aV.setFinish=function(d){var b=this.__set__;delete this.__set__;return b};aV.setSize=function(d,b){return aI._engine.setSize.call(this,d,b)};aV.setViewBox=function(b,E,d,i,g){return aI._engine.setViewBox.call(this,b,E,d,i,g)};aV.top=aV.bottom=null;aV.raphael=aI;var bh=function(g){var E=g.getBoundingClientRect(),bA=g.ownerDocument,R=bA.body,b=bA.documentElement,i=b.clientTop||R.clientTop||0,S=b.clientLeft||R.clientLeft||0,bz=E.top+(aq.win.pageYOffset||b.scrollTop||R.scrollTop)-i,d=E.left+(aq.win.pageXOffset||b.scrollLeft||R.scrollLeft)-S;return{y:bz,x:d}};aV.getElementByPoint=function(d,bz){var S=this,g=S.canvas,R=aq.doc.elementFromPoint(d,bz);if(aq.win.opera&&R.tagName=="svg"){var E=bh(g),i=g.createSVGRect();i.x=d-E.x;i.y=bz-E.y;i.width=i.height=1;var b=g.getIntersectionList(i,null);if(b.length){R=b[b.length-1]}}if(!R){return null}while(R.parentNode&&R!=g.parentNode&&!R.raphael){R=R.parentNode}R==S.canvas.parentNode&&(R=g);R=R&&R.raphael?S.getById(R.raphaelid):null;return R};aV.getById=function(d){var b=this.bottom;while(b){if(b.id==d){return b}b=b.next}return null};aV.forEach=function(g,b){var d=this.bottom;while(d){if(g.call(b,d)===false){return this}d=d.next}return this};function y(){return this.x+aH+this.y}function ak(){return this.x+aH+this.y+aH+this.width+" \xd7 "+this.height}a8.getBBox=function(d){if(this.removed){return{}}var b=this._;if(d){if(b.dirty||!b.bboxwt){this.realPath=M[this.type](this);b.bboxwt=ae(this.realPath);b.bboxwt.toString=ak;b.dirty=0}return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath){b.bboxwt=0;this.realPath=M[this.type](this)}b.bbox=ae(J(this.realPath,this.matrix));b.bbox.toString=ak;b.dirty=b.dirtyT=0}return b.bbox};a8.clone=function(){if(this.removed){return null}return this.paper[this.type]().attr(this.attr())};a8.glow=function(bz){if(this.type=="text"){return null}bz=bz||{};var g={width:(bz.width||10)+(+this.attr("stroke-width")||1),fill:bz.fill||false,opacity:bz.opacity||0.5,offsetx:bz.offsetx||0,offsety:bz.offsety||0,color:bz.color||"#000"},S=g.width/2,E=this.paper,b=E.set(),R=this.realPath||M[this.type](this);R=this.matrix?J(R,this.matrix):R;for(var d=1;d<S+1;d++){b.push(E.path(R).attr({stroke:g.color,fill:g.fill?g.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(g.width/S*d).toFixed(3),opacity:+(g.opacity/S).toFixed(3)}))}return b.insertBefore(this).translate(g.offsetx,g.offsety)};var aY={},l=function(R,d,bB,bA,bJ,bI,bH,bF,S){var bE=0,bD=100,E=[R,d,bB,bA,bJ,bI,bH,bF].join(),b=aY[E],bz,g;!b&&(aY[E]=b={data:[]});b.timer&&clearTimeout(b.timer);b.timer=setTimeout(function(){delete aY[E]},2000);if(S!=null&&!b.precision){var bG=l(R,d,bB,bA,bJ,bI,bH,bF);b.precision=~~bG*10;b.data=[]}bD=b.precision||bD;for(var bC=0;bC<bD+1;bC++){if(b.data[bC*bD]){g=b.data[bC*bD]}else{g=aI.findDotsAtSegment(R,d,bB,bA,bJ,bI,bH,bF,bC/bD);b.data[bC*bD]=g}bC&&(bE+=be(be(bz.x-g.x,2)+be(bz.y-g.y,2),0.5));if(S!=null&&bE>=S){return g}bz=g}if(S==null){return bE}},aX=function(b,d){return function(bH,R,S){bH=T(bH);var bD,bC,g,bz,E="",bG={},bE,bB=0;for(var bA=0,bF=bH.length;bA<bF;bA++){g=bH[bA];if(g[0]=="M"){bD=+g[1];bC=+g[2]}else{bz=l(bD,bC,g[1],g[2],g[3],g[4],g[5],g[6]);if(bB+bz>R){if(d&&!bG.start){bE=l(bD,bC,g[1],g[2],g[3],g[4],g[5],g[6],R-bB);E+=["C"+bE.start.x,bE.start.y,bE.m.x,bE.m.y,bE.x,bE.y];if(S){return E}bG.start=E;E=["M"+bE.x,bE.y+"C"+bE.n.x,bE.n.y,bE.end.x,bE.end.y,g[5],g[6]].join();bB+=bz;bD=+g[5];bC=+g[6];continue}if(!b&&!d){bE=l(bD,bC,g[1],g[2],g[3],g[4],g[5],g[6],R-bB);return{x:bE.x,y:bE.y,alpha:bE.alpha}}}bB+=bz;bD=+g[5];bC=+g[6]}E+=g.shift()+g}bG.end=E;bE=b?bB:d?bG:aI.findDotsAtSegment(bD,bC,g[0],g[1],g[2],g[3],g[4],g[5],1);bE.alpha&&(bE={x:bE.x,y:bE.y,alpha:bE.alpha});return bE}};var aJ=aX(1),H=aX(),W=aX(0,1);aI.getTotalLength=aJ;aI.getPointAtLength=H;aI.getSubpath=function(d,i,g){if(this.getTotalLength(d)-g<0.000001){return W(d,i).end}var b=W(d,g,1);return i?W(b,i).end:b};a8.getTotalLength=function(){if(this.type!="path"){return}if(this.node.getTotalLength){return this.node.getTotalLength()}return aJ(this.attrs.path)};a8.getPointAtLength=function(b){if(this.type!="path"){return}return H(this.attrs.path,b)};a8.getSubpath=function(d,b){if(this.type!="path"){return}return aI.getSubpath(this.attrs.path,d,b)};var p=aI.easing_formulas={linear:function(b){return b},"<":function(b){return be(b,1.7)},">":function(b){return be(b,0.48)},"<>":function(bz){var i=0.48-bz/1.04,g=al.sqrt(0.1734+i*i),b=g-i,S=be(an(b),1/3)*(b<0?-1:1),R=-g-i,E=be(an(R),1/3)*(R<0?-1:1),d=S+E+0.5;return(1-d)*3*d*d+d*d*d},backIn:function(d){var b=1.70158;return d*d*((b+1)*d-b)},backOut:function(d){d=d-1;var b=1.70158;return d*d*((b+1)*d+b)+1},elastic:function(b){if(b==!!b){return b}return be(2,-10*b)*al.sin((b-0.075)*(2*aM)/0.3)+1},bounce:function(i){var d=7.5625,g=2.75,b;if(i<(1/g)){b=d*i*i}else{if(i<(2/g)){i-=(1.5/g);b=d*i*i+0.75}else{if(i<(2.5/g)){i-=(2.25/g);b=d*i*i+0.9375}else{i-=(2.625/g);b=d*i*i+0.984375}}}return b}};p.easeIn=p["ease-in"]=p["<"];p.easeOut=p["ease-out"]=p[">"];p.easeInOut=p["ease-in-out"]=p["<>"];p["back-in"]=p.backIn;p["back-out"]=p.backOut;var V=[],aE=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(b,16)},bq=function(){var bz=+new Date,bH=0;for(;bH<V.length;bH++){var bM=V[bH];if(bM.el.removed||bM.paused){continue}var E=bz-bM.start,bF=bM.ms,bE=bM.easing,bI=bM.from,bC=bM.diff,d=bM.to,bB=bM.t,S=bM.el,bD={},b;if(bM.initstatus){E=(bM.initstatus*bM.anim.top-bM.prev)/(bM.percent-bM.prev)*bF;bM.status=bM.initstatus;delete bM.initstatus;bM.stop&&V.splice(bH--,1)}else{bM.status=(bM.prev+(bM.percent-bM.prev)*(E/bF))/bM.anim.top}if(E<0){continue}if(E<bF){var g=bE(E/bF);for(var bG in bI){if(bI[ac](bG)){switch(aj[bG]){case aC:b=+bI[bG]+g*bF*bC[bG];break;case"colour":b="rgb("+[F(Z(bI[bG].r+g*bF*bC[bG].r)),F(Z(bI[bG].g+g*bF*bC[bG].g)),F(Z(bI[bG].b+g*bF*bC[bG].b))].join(",")+")";break;case"path":b=[];for(var bK=0,bA=bI[bG].length;bK<bA;bK++){b[bK]=[bI[bG][bK][0]];for(var bJ=1,bL=bI[bG][bK].length;bJ<bL;bJ++){b[bK][bJ]=+bI[bG][bK][bJ]+g*bF*bC[bG][bK][bJ]}b[bK]=b[bK].join(aH)}b=b.join(aH);break;case"transform":if(bC[bG].real){b=[];for(bK=0,bA=bI[bG].length;bK<bA;bK++){b[bK]=[bI[bG][bK][0]];for(bJ=1,bL=bI[bG][bK].length;bJ<bL;bJ++){b[bK][bJ]=bI[bG][bK][bJ]+g*bF*bC[bG][bK][bJ]}}}else{var bN=function(bO){return +bI[bG][bO]+g*bF*bC[bG][bO]};b=[["m",bN(0),bN(1),bN(2),bN(3),bN(4),bN(5)]]}break;case"csv":if(bG=="clip-rect"){b=[];bK=4;while(bK--){b[bK]=+bI[bG][bK]+g*bF*bC[bG][bK]}}break;default:var R=[].concat(bI[bG]);b=[];bK=S.paper.customAttributes[bG].length;while(bK--){b[bK]=+R[bK]+g*bF*bC[bG][bK]}break}bD[bG]=b}}S.attr(bD);(function(bP,i,bO){setTimeout(function(){eve("anim.frame."+bP,i,bO)})})(S.id,S,bM.anim)}else{(function(bP,bO,i){setTimeout(function(){eve("anim.frame."+bO.id,bO,i);eve("anim.finish."+bO.id,bO,i);aI.is(bP,"function")&&bP.call(bO)})})(bM.callback,S,bM.anim);S.attr(d);V.splice(bH--,1);if(bM.repeat>1&&!bM.next){aD(bM.anim,bM.el,bM.anim.percents[0],null,bM.totalOrigin,bM.repeat-1)}if(bM.next&&!bM.stop){aD(bM.anim,bM.el,bM.next,null,bM.totalOrigin,bM.repeat)}}}aI.svg&&S&&S.paper&&S.paper.safari();V.length&&aE(bq)},F=function(b){return b>255?255:b<0?0:b};a8.animateWith=function(g,i,E,d,S,R){var b=E?aI.animation(E,d,S,R):i;status=g.status(i);return this.animate(b).status(b,status*i.ms/b.ms)};function aU(bF,i,d,bE,bD,bz){var bA=3*i,bC=3*(bE-i)-bA,b=1-bA-bC,S=3*d,bB=3*(bD-d)-S,bG=1-S-bB;function R(bH){return((b*bH+bC)*bH+bA)*bH}function g(bH,bJ){var bI=E(bH,bJ);return((bG*bI+bB)*bI+S)*bI}function E(bH,bO){var bN,bM,bK,bI,bL,bJ;for(bK=bH,bJ=0;bJ<8;bJ++){bI=R(bK)-bH;if(an(bI)<bO){return bK}bL=(3*b*bK+2*bC)*bK+bA;if(an(bL)<0.000001){break}bK=bK-bI/bL}bN=0;bM=1;bK=bH;if(bK<bN){return bN}if(bK>bM){return bM}while(bN<bM){bI=R(bK);if(an(bI-bH)<bO){return bK}if(bH>bI){bN=bK}else{bM=bK}bK=(bM-bN)/2+bN}return bK}return g(bF,1/(200*bz))}a8.onAnimation=function(b){b?eve.on("anim.frame."+this.id,b):eve.unbind("anim.frame."+this.id);return this};function bo(E,g){var d=[],i={};this.ms=g;this.times=1;if(E){for(var b in E){if(E[ac](b)){i[af(b)]=E[b];d.push(af(b))}}d.sort(t)}this.anim=i;this.top=d[d.length-1];this.percents=d}bo.prototype.delay=function(d){var b=new bo(this.anim,this.ms);b.times=this.times;b.del=+d||0;return b};bo.prototype.repeat=function(d){var b=new bo(this.anim,this.ms);b.del=this.del;b.times=al.floor(n(d,0))||1;return b};function aD(bQ,g,b,bO,bz,bD){b=af(b);var bX,S,bC,bY=[],bJ,bI,R,bL=bQ.ms,bP={},E={},bF={};if(bO){for(bT=0,bE=V.length;bT<bE;bT++){var bV=V[bT];if(bV.el.id==g.id&&bV.anim==bQ){if(bV.percent!=b){V.splice(bT,1);bC=1}else{S=bV}g.attr(bV.totalOrigin);break}}}else{bO=+E}for(var bT=0,bE=bQ.percents.length;bT<bE;bT++){if(bQ.percents[bT]==b||bQ.percents[bT]>bO*bQ.top){b=bQ.percents[bT];bI=bQ.percents[bT-1]||0;bL=bL/bQ.top*(b-bI);bJ=bQ.percents[bT+1];bX=bQ.anim[b];break}else{if(bO){g.attr(bQ.anim[bQ.percents[bT]])}}}if(!bX){return}if(!S){for(attr in bX){if(bX[ac](attr)){if(aj[ac](attr)||g.paper.customAttributes[ac](attr)){bP[attr]=g.attr(attr);(bP[attr]==null)&&(bP[attr]=r[attr]);E[attr]=bX[attr];switch(aj[attr]){case aC:bF[attr]=(E[attr]-bP[attr])/bL;break;case"colour":bP[attr]=aI.getRGB(bP[attr]);var bN=aI.getRGB(E[attr]);bF[attr]={r:(bN.r-bP[attr].r)/bL,g:(bN.g-bP[attr].g)/bL,b:(bN.b-bP[attr].b)/bL};break;case"path":var bA=T(bP[attr],E[attr]),bH=bA[1];bP[attr]=bA[0];bF[attr]=[];for(bT=0,bE=bP[attr].length;bT<bE;bT++){bF[attr][bT]=[0];for(var bS=1,bU=bP[attr][bT].length;bS<bU;bS++){bF[attr][bT][bS]=(bH[bT][bS]-bP[attr][bT][bS])/bL}}break;case"transform":var b0=g._,bZ=ar(b0[attr],E[attr]);if(bZ){bP[attr]=bZ.from;E[attr]=bZ.to;bF[attr]=[];bF[attr].real=true;for(bT=0,bE=bP[attr].length;bT<bE;bT++){bF[attr][bT]=[bP[attr][bT][0]];for(bS=1,bU=bP[attr][bT].length;bS<bU;bS++){bF[attr][bT][bS]=(E[attr][bT][bS]-bP[attr][bT][bS])/bL}}}else{var bM=(g.matrix||new aw),bW={_:{transform:b0.transform},getBBox:function(){return g.getBBox(1)}};bP[attr]=[bM.a,bM.b,bM.c,bM.d,bM.e,bM.f];aF(bW,E[attr]);E[attr]=bW._.transform;bF[attr]=[(bW.matrix.a-bM.a)/bL,(bW.matrix.b-bM.b)/bL,(bW.matrix.c-bM.c)/bL,(bW.matrix.d-bM.d)/bL,(bW.matrix.e-bM.e)/bL,(bW.matrix.e-bM.f)/bL]}break;case"csv":var d=bv(bX[attr]).split(a),bB=bv(bP[attr]).split(a);if(attr=="clip-rect"){bP[attr]=bB;bF[attr]=[];bT=bB.length;while(bT--){bF[attr][bT]=(d[bT]-bP[attr][bT])/bL}}E[attr]=d;break;default:d=[].concat(bX[attr]);bB=[].concat(bP[attr]);bF[attr]=[];bT=g.paper.customAttributes[attr].length;while(bT--){bF[attr][bT]=((d[bT]||0)-(bB[bT]||0))/bL}break}}}}var bK=bX.easing,bR=aI.easing_formulas[bK];if(!bR){bR=bv(bK).match(c);if(bR&&bR.length==5){var bG=bR;bR=function(i){return aU(i,+bG[1],+bG[2],+bG[3],+bG[4],bL)}}else{bR=bp}}R=bX.start||bQ.start||+new Date;bV={anim:bQ,percent:b,timestamp:R,start:R+(bQ.del||0),status:0,initstatus:bO||0,stop:false,ms:bL,easing:bR,from:bP,diff:bF,to:E,el:g,callback:bX.callback,prev:bI,next:bJ,repeat:bD||bQ.times,origin:g.attr(),totalOrigin:bz};V.push(bV);if(bO&&!S&&!bC){bV.stop=true;bV.start=new Date-bL*bO;if(V.length==1){return bq()}}if(bC){bV.start=new Date-bV.ms*bO}V.length==1&&aE(bq)}else{S.initstatus=bO;S.start=new Date-S.ms*bO}eve("anim.start."+g.id,g,bQ)}aI.animation=function(E,d,S,R){if(E instanceof bo){return E}if(aI.is(S,"function")||!S){R=R||S||null;S=null}E=Object(E);d=+d||0;var i={},g,b;for(b in E){if(E[ac](b)&&af(b)!=b&&af(b)+"%"!=b){g=true;i[b]=E[b]}}if(!g){return new bo(E,d)}else{S&&(i.easing=S);R&&(i.callback=R);return new bo({100:i},d)}};a8.animate=function(i,b,R,E){var d=this;if(d.removed){E&&E.call(d);return d}var g=i instanceof bo?i:aI.animation(i,b,R,E);aD(g,d,g.percents[0],null,d.attr());return d};a8.setTime=function(d,b){if(d&&b!=null){this.status(d,bb(b,d.ms)/d.ms)}return this};a8.status=function(R,E){var d=[],g=0,b,S;if(E!=null){aD(R,this,-1,bb(E,1));return this}else{b=V.length;for(;g<b;g++){S=V[g];if(S.el.id==this.id&&(!R||S.anim==R)){if(R){return S.status}d.push({anim:S.anim,status:S.status})}}if(R){return 0}return d}};a8.pause=function(d){for(var b=0;b<V.length;b++){if(V[b].el.id==this.id&&(!d||V[b].anim==d)){if(eve("anim.pause."+this.id,this,V[b].anim)!==false){V[b].paused=true}}}return this};a8.resume=function(d){for(var b=0;b<V.length;b++){if(V[b].el.id==this.id&&(!d||V[b].anim==d)){var g=V[b];if(eve("anim.resume."+this.id,this,g.anim)!==false){delete g.paused;this.status(g.anim,g.status)}}}return this};a8.stop=function(d){for(var b=0;b<V.length;b++){if(V[b].el.id==this.id&&(!d||V[b].anim==d)){if(eve("anim.stop."+this.id,this,V[b].anim)!==false){V.splice(b--,1)}}}return this};a8.toString=function(){return"Rapha\xebl\u2019s object"};var ad=function(b){this.items=[];this.length=0;this.type="set";if(b){for(var d=0,g=b.length;d<g;d++){if(b[d]&&(b[d].constructor==a8.constructor||b[d].constructor==ad)){this[this.items.length]=this.items[this.items.length]=b[d];this.length++}}}},a3=ad.prototype;a3.push=function(){var E,b;for(var d=0,g=arguments.length;d<g;d++){E=arguments[d];if(E&&(E.constructor==a8.constructor||E.constructor==ad)){b=this.items.length;this[b]=this.items[b]=E;this.length++}}return this};a3.pop=function(){this.length&&delete this[this.length--];return this.items.pop()};a3.forEach=function(E,b){for(var d=0,g=this.items.length;d<g;d++){if(E.call(b,this.items[d])===false){return this}}return this};for(var B in a8){if(a8[ac](B)){a3[B]=(function(b){return function(){var d=arguments;return this.forEach(function(g){g[b][bu](g,d)})}})(B)}}a3.attr=function(d,S){if(d&&aI.is(d,a4)&&aI.is(d[0],"object")){for(var b=0,R=d.length;b<R;b++){this.items[b].attr(d[b])}}else{for(var g=0,E=this.items.length;g<E;g++){this.items[g].attr(d,S)}}return this};a3.clear=function(){while(this.length){this.pop()}};a3.splice=function(E,bz,bA){E=E<0?n(this.length+E,0):E;bz=n(0,bb(this.length-E,bz));var g=[],b=[],d=[],R;for(R=2;R<arguments.length;R++){d.push(arguments[R])}for(R=0;R<bz;R++){b.push(this[E+R])}for(;R<this.length-E;R++){g.push(this[E+R])}var S=d.length;for(R=0;R<S+g.length;R++){this.items[E+R]=this[E+R]=R<S?d[R]:g[R-S]}R=this.items.length=this.length-=bz-S;while(this[R]){delete this[R++]}return new ad(b)};a3.exclude=function(g){for(var b=0,d=this.length,E;b<d;b++){if(E||this[b]==g){this[b]=this[b+1];E=1}}if(E){this.length--;delete this[b];return true}};a3.animate=function(g,b,bz,bB){(aI.is(bz,"function")||!bz)&&(bB=bz||null);var S=this.items.length,E=S,bC,bA=this,R;if(!S){return this}bB&&(R=function(){!--S&&bB.call(bA)});bz=aI.is(bz,ab)?bz:R;var d=aI.animation(g,b,bz,R);bC=this.items[--E].animate(d);while(E--){this.items[E]&&!this.items[E].removed&&this.items[E].animateWith(bC,d)}return this};a3.insertAfter=function(d){var b=this.items.length;while(b--){this.items[b].insertAfter(d)}return this};a3.getBBox=function(){var b=[],S=[],d=[],E=[];for(var g=this.items.length;g--;){if(!this.items[g].removed){var R=this.items[g].getBBox();b.push(R.x);S.push(R.y);d.push(R.x+R.width);E.push(R.y+R.height)}}b=bb[bu](0,b);S=bb[bu](0,S);return{x:b,y:S,width:n[bu](0,d)-b,height:n[bu](0,E)-S}};a3.clone=function(g){g=new ad;for(var b=0,d=this.items.length;b<d;b++){g.push(this.items[b].clone())}return g};a3.toString=function(){return"Rapha\xebl\u2018s set"};aI.registerFont=function(d){if(!d.face){return d}this.fonts=this.fonts||{};var i={w:d.w,face:{},glyphs:{}},g=d.face["font-family"];for(var S in d.face){if(d.face[ac](S)){i.face[S]=d.face[S]}}if(this.fonts[g]){this.fonts[g].push(i)}else{this.fonts[g]=[i]}if(!d.svg){i.face["units-per-em"]=P(d.face["units-per-em"],10);for(var E in d.glyphs){if(d.glyphs[ac](E)){var R=d.glyphs[E];i.glyphs[E]={w:R.w,k:{},d:R.d&&"M"+R.d.replace(/[mlcxtrv]/g,function(bz){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[bz]||"M"})+"z"};if(R.k){for(var b in R.k){if(R[ac](b)){i.glyphs[E].k[b]=R.k[b]}}}}}}return d};aV.getFont=function(bA,bB,d,E){E=E||"normal";d=d||"normal";bB=+bB||{normal:400,bold:700,lighter:300,bolder:800}[bB]||400;if(!aI.fonts){return}var R=aI.fonts[bA];if(!R){var g=new RegExp("(^|\\s)"+bA.replace(/[^\w\d\s+!~.:_-]/g,aO)+"(\\s|$)","i");for(var b in aI.fonts){if(aI.fonts[ac](b)){if(g.test(b)){R=aI.fonts[b];break}}}}var S;if(R){for(var bz=0,bC=R.length;bz<bC;bz++){S=R[bz];if(S.face["font-weight"]==bB&&(S.face["font-style"]==d||!S.face["font-style"])&&S.face["font-stretch"]==E){break}}}return S};aV.print=function(R,E,b,bA,bB,bK,d){bK=bK||"middle";d=n(bb(d||0,1),-1);var bG=this.set(),bJ=bv(b).split(aO),bH=0,bE=aO,bL;aI.is(bA,b)&&(bA=this.getFont(bA));if(bA){bL=(bB||16)/bA.face["units-per-em"];var g=bA.face.bbox.split(a),bz=+g[0],bC=+g[1]+(bK=="baseline"?g[3]-g[1]+(+bA.face.descent):(g[3]-g[1])/2);for(var bF=0,S=bJ.length;bF<S;bF++){var bD=bF&&bA.glyphs[bJ[bF-1]]||{},bI=bA.glyphs[bJ[bF]];bH+=bF?(bD.w||bA.w)+(bD.k&&bD.k[bJ[bF]]||0)+(bA.w*d):0;bI&&bI.d&&bG.push(this.path(bI.d).attr({fill:"#000",stroke:"none",transform:[["t",bH*bL,0]]}))}bG.transform(["...s",bL,bL,bz,bC,"t",(R-bz)/bL,(E-bC)/bL])}return bG};aI.format=function(d,g){var b=aI.is(g,a4)?[0][bs](g):arguments;d&&aI.is(d,ab)&&b.length-1&&(d=d.replace(bg,function(R,E){return b[++E]==null?aO:b[E]}));return d||aO};aI.fullfill=(function(){var g=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,d=function(R,E,S){var i=S;E.replace(b,function(bB,bA,bz,bD,bC){bA=bA||bD;if(i){if(bA in i){i=i[bA]}typeof i=="function"&&bC&&(i=i())}});i=(i==null||i==S?R:i)+"";return i};return function(E,i){return String(E).replace(g,function(S,R){return d(S,R,i)})}})();aI.ninja=function(){s.was?(aq.win.Raphael=s.is):delete Raphael;return aI};aI.st=a3;(function(i,d,g){if(i.readyState==null&&i.addEventListener){i.addEventListener(d,g=function(){i.removeEventListener(d,g,false);i.readyState="complete"},false);i.readyState="loading"}function b(){(/in/).test(i.readyState)?setTimeout(b,9):aI.eve("DOMload")}b()})(document,"DOMContentLoaded");s.was?(aq.win.Raphael=aI):(Raphael=aI);eve.on("DOMload",function(){ag=true})})();window.Raphael.svg&&function(n){var f="hasOwnProperty",G=String,p=parseFloat,s=parseInt,h=Math,H=h.max,u=h.abs,j=h.pow,i=/[, ]+/,D=n.eve,t="",l=" ";var q="http://www.w3.org/1999/xlink",C={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},y={};n.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version};var k=function(J,E){if(E){if(typeof J=="string"){J=k(J)}for(var I in E){if(E[f](I)){if(I.substring(0,6)=="xlink:"){J.setAttributeNS(q,I.substring(6),G(E[I]))}else{J.setAttribute(I,G(E[I]))}}}}else{J=n._g.doc.createElementNS("http://www.w3.org/2000/svg",J);J.style&&(J.style.webkitTapHighlightColor="rgba(0,0,0,0)")}return J},w={},c=/^url\(#(.*)\)$/,v=function(I,J){var E=I.getAttribute("fill");E=E&&E.match(c);if(E&&!--w[E[1]]){delete w[E[1]];J.defs.removeChild(n._g.doc.getElementById(E[1]))}},a=function(R,V){var T="linear",I=R.id+V,P=0.5,N=0.5,K=R.node,E=R.paper,X=K.style,J=n._g.doc.getElementById(I);if(!J){V=G(V).replace(n._radial_gradient,function(aa,Y,ab){T="radial";if(Y&&ab){P=p(Y);N=p(ab);var Z=((N>0.5)*2-1);j(P-0.5,2)+j(N-0.5,2)>0.25&&(N=h.sqrt(0.25-j(P-0.5,2))*Z+0.5)&&N!=0.5&&(N=N.toFixed(5)-0.00001*Z)}return t});V=V.split(/\s*\-\s*/);if(T=="linear"){var O=V.shift();O=-p(O);if(isNaN(O)){return null}var M=[0,0,h.cos(n.rad(O)),h.sin(n.rad(O))],U=1/(H(u(M[2]),u(M[3]))||1);M[2]*=U;M[3]*=U;if(M[2]<0){M[0]=-M[2];M[2]=0}if(M[3]<0){M[1]=-M[3];M[3]=0}}var S=n._parseDots(V);if(!S){return null}if(R.gradient){E.defs.removeChild(R.gradient);delete R.gradient}I=I.replace(/[\(\)\s,\xb0#]/g,"-");J=k(T+"Gradient",{id:I});R.gradient=J;k(J,T=="radial"?{fx:P,fy:N}:{x1:M[0],y1:M[1],x2:M[2],y2:M[3],gradientTransform:R.matrix.invert()});E.defs.appendChild(J);for(var Q=0,W=S.length;Q<W;Q++){J.appendChild(k("stop",{offset:S[Q].offset?S[Q].offset:Q?"100%":"0%","stop-color":S[Q].color||"#fff"}))}}k(K,{fill:"url(#"+I+")",opacity:1,"fill-opacity":1});X.fill=t;X.opacity=1;X.fillOpacity=1;return 1},b=function(I){var E=I.getBBox(1);k(I.pattern,{patternTransform:I.matrix.invert()+" translate("+E.x+","+E.y+")"})},d=function(T,V,O){if(T.type=="path"){var E=G(V).toLowerCase().split("-"),S=T.paper,ag=O?"end":"start",X=T.node,U=T.attrs,N=U["stroke-width"],ab=E.length,K="classic",aa,J,Q,Y,W,P=3,ac=3,R=5;while(ab--){switch(E[ab]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":K=E[ab];break;case"wide":ac=5;break;case"narrow":ac=2;break;case"long":P=5;break;case"short":P=2;break}}if(K=="open"){P+=2;ac+=2;R+=2;Q=1;Y=O?4:1;W={fill:"none",stroke:U.stroke}}else{Y=Q=P/2;W={fill:U.stroke,stroke:"none"}}if(T._.arrows){if(O){T._.arrows.endPath&&y[T._.arrows.endPath]--;T._.arrows.endMarker&&y[T._.arrows.endMarker]--}else{T._.arrows.startPath&&y[T._.arrows.startPath]--;T._.arrows.startMarker&&y[T._.arrows.startMarker]--}}else{T._.arrows={}}if(K!="none"){var I="raphael-marker-"+K,af="raphael-marker-"+ag+K+P+ac;if(!n._g.doc.getElementById(I)){S.defs.appendChild(k(k("path"),{"stroke-linecap":"round",d:C[K],id:I}));y[I]=1}else{y[I]++}var M=n._g.doc.getElementById(af),Z;if(!M){M=k(k("marker"),{id:af,markerHeight:ac,markerWidth:P,orient:"auto",refX:Y,refY:ac/2});Z=k(k("use"),{"xlink:href":"#"+I,transform:(O?" rotate(180 "+P/2+" "+ac/2+") ":l)+"scale("+P/R+","+ac/R+")","stroke-width":1/((P/R+ac/R)/2)});M.appendChild(Z);S.defs.appendChild(M);y[af]=1}else{y[af]++;Z=M.getElementsByTagName("use")[0]}k(Z,W);var ae=Q*(K!="diamond"&&K!="oval");if(O){aa=T._.arrows.startdx*N||0;J=n.getTotalLength(U.path)-ae*N}else{aa=ae*N;J=n.getTotalLength(U.path)-(T._.arrows.enddx*N||0)}W={};W["marker-"+ag]="url(#"+af+")";if(J||aa){W.d=Raphael.getSubpath(U.path,aa,J)}k(X,W);T._.arrows[ag+"Path"]=I;T._.arrows[ag+"Marker"]=af;T._.arrows[ag+"dx"]=ae;T._.arrows[ag+"Type"]=K;T._.arrows[ag+"String"]=V}else{if(O){aa=T._.arrows.startdx*N||0;J=n.getTotalLength(U.path)-aa}else{aa=0;J=n.getTotalLength(U.path)-(T._.arrows.enddx*N||0)}T._.arrows[ag+"Path"]&&k(X,{d:Raphael.getSubpath(U.path,aa,J)});delete T._.arrows[ag+"Path"];delete T._.arrows[ag+"Marker"];delete T._.arrows[ag+"dx"];delete T._.arrows[ag+"Type"];delete T._.arrows[ag+"String"]}for(W in y){if(y[f](W)&&!y[W]){var ad=n._g.doc.getElementById(W);ad&&ad.parentNode.removeChild(ad)}}}},z={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},m=function(O,M,N){M=z[G(M).toLowerCase()];if(M){var J=O.attrs["stroke-width"]||"1",E={round:J,square:J,butt:0}[O.attrs["stroke-linecap"]||N["stroke-linecap"]]||0,K=[],I=M.length;while(I--){K[I]=M[I]*J+((I%2)?1:-1)*E}k(O.node,{"stroke-dasharray":K.join(",")})}},A=function(X,ag){var ac=X.node,Y=X.attrs,V=ac.style.visibility;ac.style.visibility="hidden";for(var aa in ag){if(ag[f](aa)){if(!n._availableAttrs[f](aa)){continue}var Z=ag[aa];Y[aa]=Z;switch(aa){case"blur":X.blur(Z);break;case"href":case"title":case"target":var ae=ac.parentNode,M=false;if(ae.tagName.toLowerCase()!="a"){var N=k("a");ae.insertBefore(N,ac);N.appendChild(ac);ae=N;if(aa==="title"){var T=document.createTextNode(Z),ab=k("title");ab.appendChild(T);ae.appendChild(ab);M=true}}if(aa=="target"&&Z=="blank"){ae.setAttributeNS(q,"show","new")}else{ae.setAttributeNS(q,aa,Z)}if(!M&&(aa==="title")){for(var P=ae.firstChild;P;P=P.nextSibling){if(P.tagName==="title"){var W=P.firstChild,R=document.createTextNode(Z);if(W){P.replaceChild(R,W)}else{P.appendChild(R)}}}}break;case"cursor":ac.style.cursor=Z;break;case"transform":X.transform(Z);break;case"arrow-start":d(X,Z);break;case"arrow-end":d(X,Z,1);break;case"clip-rect":var I=G(Z).split(i);if(I.length==4){X.clip&&X.clip.parentNode.parentNode.removeChild(X.clip.parentNode);var J=k("clipPath"),ad=k("rect");J.id=n._createUUID();k(ad,{x:I[0],y:I[1],width:I[2],height:I[3]});J.appendChild(ad);X.paper.defs.appendChild(J);k(ac,{"clip-path":"url(#"+J.id+")"});X.clip=ad}if(!Z){var af=n._g.doc.getElementById(ac.getAttribute("clip-path").replace(/(^url\(#|\)$)/g,t));af&&af.parentNode.removeChild(af);k(ac,{"clip-path":t});delete X.clip}break;case"path":if(X.type=="path"){k(ac,{d:Z?Y.path=n._pathToAbsolute(Z):"M0,0"});X._.dirty=1;if(X._.arrows){"startString" in X._.arrows&&d(X,X._.arrows.startString);"endString" in X._.arrows&&d(X,X._.arrows.endString,1)}}break;case"width":ac.setAttribute(aa,Z);X._.dirty=1;if(Y.fx){aa="x";Z=Y.x}else{break}case"x":if(Y.fx){Z=-Y.x-(Y.width||0)}case"rx":if(aa=="rx"&&X.type=="rect"){break}case"cx":ac.setAttribute(aa,Z);X.pattern&&b(X);X._.dirty=1;break;case"height":ac.setAttribute(aa,Z);X._.dirty=1;if(Y.fy){aa="y";Z=Y.y}else{break}case"y":if(Y.fy){Z=-Y.y-(Y.height||0)}case"ry":if(aa=="ry"&&X.type=="rect"){break}case"cy":ac.setAttribute(aa,Z);X.pattern&&b(X);X._.dirty=1;break;case"r":if(X.type=="rect"){k(ac,{rx:Z,ry:Z})}else{ac.setAttribute(aa,Z)}X._.dirty=1;break;case"src":if(X.type=="image"){ac.setAttributeNS(q,"href",Z)}break;case"stroke-width":if(X._.sx!=1||X._.sy!=1){Z/=H(u(X._.sx),u(X._.sy))||1}if(X.paper._vbSize){Z*=X.paper._vbSize}ac.setAttribute(aa,Z);if(Y["stroke-dasharray"]){m(X,Y["stroke-dasharray"],ag)}if(X._.arrows){"startString" in X._.arrows&&d(X,X._.arrows.startString);"endString" in X._.arrows&&d(X,X._.arrows.endString,1)}break;case"stroke-dasharray":m(X,Z,ag);break;case"fill":var O=G(Z).match(n._ISURL);if(O){J=k("pattern");var U=k("image");J.id=n._createUUID();k(J,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});k(U,{x:0,y:0,"xlink:href":O[1]});J.appendChild(U);(function(ah){n._preload(O[1],function(){var ai=this.offsetWidth,aj=this.offsetHeight;k(ah,{width:ai,height:aj});k(U,{width:ai,height:aj});X.paper.safari()})})(J);X.paper.defs.appendChild(J);ac.style.fill="url(#"+J.id+")";k(ac,{fill:"url(#"+J.id+")"});X.pattern=J;X.pattern&&b(X);break}var K=n.getRGB(Z);if(!K.error){delete ag.gradient;delete Y.gradient;!n.is(Y.opacity,"undefined")&&n.is(ag.opacity,"undefined")&&k(ac,{opacity:Y.opacity});!n.is(Y["fill-opacity"],"undefined")&&n.is(ag["fill-opacity"],"undefined")&&k(ac,{"fill-opacity":Y["fill-opacity"]})}else{if((X.type=="circle"||X.type=="ellipse"||G(Z).charAt()!="r")&&a(X,Z)){if("opacity" in Y||"fill-opacity" in Y){var E=n._g.doc.getElementById(ac.getAttribute("fill").replace(/^url\(#|\)$/g,t));if(E){var Q=E.getElementsByTagName("stop");k(Q[Q.length-1],{"stop-opacity":("opacity" in Y?Y.opacity:1)*("fill-opacity" in Y?Y["fill-opacity"]:1)})}}Y.gradient=Z;Y.fill="none";break}}K[f]("opacity")&&k(ac,{"fill-opacity":K.opacity>1?K.opacity/100:K.opacity});case"stroke":K=n.getRGB(Z);ac.setAttribute(aa,K.hex);aa=="stroke"&&K[f]("opacity")&&k(ac,{"stroke-opacity":K.opacity>1?K.opacity/100:K.opacity});if(aa=="stroke"&&X._.arrows){"startString" in X._.arrows&&d(X,X._.arrows.startString);"endString" in X._.arrows&&d(X,X._.arrows.endString,1)}break;case"gradient":(X.type=="circle"||X.type=="ellipse"||G(Z).charAt()!="r")&&a(X,Z);break;case"opacity":if(Y.gradient&&!Y[f]("stroke-opacity")){k(ac,{"stroke-opacity":Z>1?Z/100:Z})}case"fill-opacity":if(Y.gradient){E=n._g.doc.getElementById(ac.getAttribute("fill").replace(/^url\(#|\)$/g,t));if(E){Q=E.getElementsByTagName("stop");k(Q[Q.length-1],{"stop-opacity":Z})}break}default:aa=="font-size"&&(Z=s(Z,10)+"px");var S=aa.replace(/(\-.)/g,function(ah){return ah.substring(1).toUpperCase()});ac.style[S]=Z;X._.dirty=1;ac.setAttribute(aa,Z);break}}}r(X,ag);ac.style.visibility=V},F=1.2,r=function(E,M){if(E.type!="text"||!(M[f]("text")||M[f]("font")||M[f]("font-size")||M[f]("x")||M[f]("y"))){return}var R=E.attrs,J=E.node,T=J.firstChild?s(n._g.doc.defaultView.getComputedStyle(J.firstChild,t).getPropertyValue("font-size"),10):10;if(M[f]("text")){R.text=M.text;while(J.firstChild){J.removeChild(J.firstChild)}var K=G(M.text).split("\n"),I=[],P;for(var N=0,S=K.length;N<S;N++){P=k("tspan");N&&k(P,{dy:T*F,x:R.x});P.appendChild(n._g.doc.createTextNode(K[N]));J.appendChild(P);I[N]=P}}else{I=J.getElementsByTagName("tspan");for(N=0,S=I.length;N<S;N++){if(N){k(I[N],{dy:T*F,x:R.x})}else{k(I[0],{dy:0})}}}k(J,{x:R.x,y:R.y});E._.dirty=1;var O=E._getBBox(),Q=R.y-(O.y+O.height/2);Q&&n.is(Q,"finite")&&k(I[0],{dy:Q})},x=function(I,E){var K=0,J=0;this[0]=this.node=I;I.raphael=true;this.id=n._oid++;I.raphaelid=this.id;this.matrix=n.matrix();this.realPath=null;this.paper=E;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!E.bottom&&(E.bottom=this);this.prev=E.top;E.top&&(E.top.next=this);E.top=this;this.next=null},o=n.el;x.prototype=o;o.constructor=x;n._engine.path=function(E,K){var I=k("path");K.canvas&&K.canvas.appendChild(I);var J=new x(I,K);J.type="path";A(J,{fill:"none",stroke:"#000",path:E});return J};o.rotate=function(I,E,K){if(this.removed){return this}I=G(I).split(i);if(I.length-1){E=p(I[1]);K=p(I[2])}I=p(I[0]);(K==null)&&(E=K);if(E==null||K==null){var J=this.getBBox(1);E=J.x+J.width/2;K=J.y+J.height/2}this.transform(this._.transform.concat([["r",I,E,K]]));return this};o.scale=function(M,J,E,K){if(this.removed){return this}M=G(M).split(i);if(M.length-1){J=p(M[1]);E=p(M[2]);K=p(M[3])}M=p(M[0]);(J==null)&&(J=M);(K==null)&&(E=K);if(E==null||K==null){var I=this.getBBox(1)}E=E==null?I.x+I.width/2:E;K=K==null?I.y+I.height/2:K;this.transform(this._.transform.concat([["s",M,J,E,K]]));return this};o.translate=function(I,E){if(this.removed){return this}I=G(I).split(i);if(I.length-1){E=p(I[1])}I=p(I[0])||0;E=+E||0;this.transform(this._.transform.concat([["t",I,E]]));return this};o.transform=function(I){var J=this._;if(I==null){return J.transform}n._extractTransform(this,I);this.clip&&k(this.clip,{transform:this.matrix.invert()});this.pattern&&b(this);this.node&&k(this.node,{transform:this.matrix});if(J.sx!=1||J.sy!=1){var E=this.attrs[f]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":E})}return this};o.hide=function(){!this.removed&&this.paper.safari(this.node.style.display="none");return this};o.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};o.remove=function(){if(this.removed){return}D.unbind("*.*."+this.id);n._tear(this,this.paper);this.node.parentNode.removeChild(this.node);for(var E in this){delete this[E]}this.removed=true};o._getBBox=function(){if(this.node.style.display=="none"){this.show();var E=true}var J={};try{J=this.node.getBBox()}catch(I){}finally{J=J||{}}E&&this.hide();return J};o.attr=function(E,R){if(this.removed){return this}if(E==null){var O={};for(var Q in this.attrs){if(this.attrs[f](Q)){O[Q]=this.attrs[Q]}}O.gradient&&O.fill=="none"&&(O.fill=O.gradient)&&delete O.gradient;O.transform=this._.transform;return O}if(R==null&&n.is(E,"string")){if(E=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient}if(E=="transform"){return this._.transform}var P=E.split(i),K={};for(var M=0,T=P.length;M<T;M++){E=P[M];if(E in this.attrs){K[E]=this.attrs[E]}else{if(n.is(this.paper.customAttributes[E],"function")){K[E]=this.paper.customAttributes[E].def}else{K[E]=n._availableAttrs[E]}}}return T-1?K:K[P[0]]}if(R==null&&n.is(E,"array")){K={};for(M=0,T=E.length;M<T;M++){K[E[M]]=this.attr(E[M])}return K}if(R!=null){var I={};I[E]=R}else{if(E!=null&&n.is(E,"object")){I=E}}for(var S in this.paper.customAttributes){if(this.paper.customAttributes[f](S)&&I[f](S)&&n.is(this.paper.customAttributes[S],"function")){var N=this.paper.customAttributes[S].apply(this,[].concat(I[S]));this.attrs[S]=I[S];for(var J in N){if(N[f](J)){I[J]=N[J]}}}}A(this,I);return this};o.toFront=function(){if(this.removed){return this}this.node.parentNode.appendChild(this.node);var E=this.paper;E.top!=this&&n._tofront(this,E);return this};o.toBack=function(){if(this.removed){return this}if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);n._toback(this,this.paper);var E=this.paper}return this};o.insertAfter=function(E){if(this.removed){return this}var I=E.node||E[E.length-1].node;if(I.nextSibling){I.parentNode.insertBefore(this.node,I.nextSibling)}else{I.parentNode.appendChild(this.node)}n._insertafter(this,E,this.paper);return this};o.insertBefore=function(E){if(this.removed){return this}var I=E.node||E[0].node;I.parentNode.insertBefore(this.node,I);n._insertbefore(this,E,this.paper);return this};o.blur=function(I){var E=this;if(+I!==0){var J=k("filter"),K=k("feGaussianBlur");E.attrs.blur=I;J.id=n._createUUID();k(K,{stdDeviation:+I||1.5});J.appendChild(K);E.paper.defs.appendChild(J);E._blur=J;k(E.node,{filter:"url(#"+J.id+")"})}else{if(E._blur){E._blur.parentNode.removeChild(E._blur);delete E._blur;delete E.attrs.blur}E.node.removeAttribute("filter")}};n._engine.circle=function(I,E,N,M){var K=k("circle");I.canvas&&I.canvas.appendChild(K);var J=new x(K,I);J.attrs={cx:E,cy:N,r:M,fill:"none",stroke:"#000"};J.type="circle";k(K,J.attrs);return J};n._engine.rect=function(J,E,P,I,N,O){var M=k("rect");J.canvas&&J.canvas.appendChild(M);var K=new x(M,J);K.attrs={x:E,y:P,width:I,height:N,r:O||0,rx:O||0,ry:O||0,fill:"none",stroke:"#000"};K.type="rect";k(M,K.attrs);return K};n._engine.ellipse=function(I,E,O,N,M){var K=k("ellipse");I.canvas&&I.canvas.appendChild(K);var J=new x(K,I);J.attrs={cx:E,cy:O,rx:N,ry:M,fill:"none",stroke:"#000"};J.type="ellipse";k(K,J.attrs);return J};n._engine.image=function(J,O,E,P,I,N){var M=k("image");k(M,{x:E,y:P,width:I,height:N,preserveAspectRatio:"none"});M.setAttributeNS(q,"href",O);J.canvas&&J.canvas.appendChild(M);var K=new x(M,J);K.attrs={x:E,y:P,width:I,height:N,src:O};K.type="image";return K};n._engine.text=function(I,E,N,M){var K=k("text");I.canvas&&I.canvas.appendChild(K);var J=new x(K,I);J.attrs={x:E,y:N,"text-anchor":"middle",text:M,font:n._availableAttrs.font,stroke:"none",fill:"#000"};J.type="text";A(J,J.attrs);return J};n._engine.setSize=function(I,E){this.width=I||this.width;this.height=E||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);if(this._viewBox){this.setViewBox.apply(this,this._viewBox)}return this};n._engine.create=function(){var K=n._getContainer.apply(0,arguments),I=K&&K.container,P=K.x,O=K.y,J=K.width,Q=K.height;if(!I){throw new Error("SVG container not found.")}var E=k("svg"),N="overflow:hidden;",M;P=P||0;O=O||0;J=J||512;Q=Q||342;k(E,{height:Q,version:1.1,width:J,xmlns:"http://www.w3.org/2000/svg"});if(I==1){E.style.cssText=N+"position:absolute;left:"+P+"px;top:"+O+"px";n._g.doc.body.appendChild(E);M=1}else{E.style.cssText=N+"position:relative";if(I.firstChild){I.insertBefore(E,I.firstChild)}else{I.appendChild(E)}}I=new n._Paper;I.width=J;I.height=Q;I.canvas=E;I.clear();I._left=I._top=0;M&&(I.renderfix=function(){});I.renderfix();return I};n._engine.setViewBox=function(N,K,P,E,I){D("setViewBox",this,this._viewBox,[N,K,P,E,I]);var R=H(P/this.width,E/this.height),M=this.top,Q=I?"meet":"xMinYMin",J,O;if(N==null){if(this._vbSize){R=1}delete this._vbSize;J="0 0 "+this.width+l+this.height}else{this._vbSize=R;J=N+l+K+l+P+l+E}k(this.canvas,{viewBox:J,preserveAspectRatio:Q});while(R&&M){O="stroke-width" in M.attrs?M.attrs["stroke-width"]:1;M.attr({"stroke-width":O});M._.dirty=1;M._.dirtyT=1;M=M.prev}this._viewBox=[N,K,P,E,!!I];return this};n.prototype.renderfix=function(){var M=this.canvas,E=M.style,K=M.getScreenCTM()||M.createSVGMatrix(),J=-K.e%1,I=-K.f%1;if(J||I){if(J){this._left=(this._left+J)%1;E.left=this._left+"px"}if(I){this._top=(this._top+I)%1;E.top=this._top+"px"}}};n.prototype.clear=function(){n.eve("clear",this);var E=this.canvas;while(E.firstChild){E.removeChild(E.firstChild)}this.bottom=this.top=null;(this.desc=k("desc")).appendChild(n._g.doc.createTextNode("Created with Rapha\xebl "+n.version));E.appendChild(this.desc);E.appendChild(this.defs=k("defs"))};n.prototype.remove=function(){D("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var E in this){this[E]=removed(E)}};var B=n.st;for(var g in o){if(o[f](g)&&!B[f](g)){B[g]=(function(E){return function(){var I=arguments;return this.forEach(function(J){J[E].apply(J,I)})}})(g)}}}(window.Raphael);window.Raphael.vml&&function(j){var c="hasOwnProperty",A=String,l=parseFloat,f=Math,x=f.round,D=f.max,y=f.min,q=f.abs,s="fill",g=/[, ]+/,w=j.eve,t=" progid:DXImageTransform.Microsoft",i=" ",o="",z={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},h=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,C=/-?[^,\s-]+/g,b="position:absolute;left:0;top:0;width:1px;height:1px",a=21600,u={path:1,rect:1,image:1},p={circle:1,ellipse:1},d=function(P){var M=/[ahqstv]/ig,G=j._pathToAbsolute;A(P).match(M)&&(G=j._path2curve);M=/[clmz]/g;if(G==j._pathToAbsolute&&!A(P).match(M)){var K=A(P).replace(h,function(T,V,R){var U=[],Q=V.toLowerCase()=="m",S=z[V];R.replace(C,function(W){if(Q&&U.length==2){S+=U+z[V=="m"?"l":"L"];U=[]}U.push(x(W*a))});return S+U});return K}var N=G(P),F,E;K=[];for(var I=0,O=N.length;I<O;I++){F=N[I];E=N[I][0].toLowerCase();E=="z"&&(E="x");for(var H=1,J=F.length;H<J;H++){E+=x(F[H]*a)+(H!=J-1?",":o)}K.push(E)}return K.join(i)},m=function(H,G,F){var E=j.matrix();E.rotate(-H,0.5,0.5);return{dx:E.x(G,F),dy:E.y(G,F)}},n=function(O,N,M,I,H,J){var W=O._,Q=O.matrix,E=W.fillpos,P=O.node,K=P.style,G=1,F="",S,U=a/N,T=a/M;K.visibility="hidden";if(!N||!M){return}P.coordsize=q(U)+i+q(T);K.rotation=J*(N*M<0?-1:1);if(J){var V=m(J,I,H);I=V.dx;H=V.dy}N<0&&(F+="x");M<0&&(F+=" y")&&(G=-1);K.flip=F;P.coordorigin=(I*-U)+i+(H*-T);if(E||W.fillsize){var R=P.getElementsByTagName(s);R=R&&R[0];P.removeChild(R);if(E){V=m(J,Q.x(E[0],E[1]),Q.y(E[0],E[1]));R.position=V.dx*G+i+V.dy*G}if(W.fillsize){R.size=W.fillsize[0]*q(N)+i+W.fillsize[1]*q(M)}P.appendChild(R)}K.visibility="visible"};j.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version};addArrow=function(E,K,F){var N=A(K).toLowerCase().split("-"),I=F?"end":"start",G=N.length,J="classic",M="medium",H="medium";while(G--){switch(N[G]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":J=N[G];break;case"wide":case"narrow":H=N[G];break;case"long":case"short":M=N[G];break}}var O=E.node.getElementsByTagName("stroke")[0];O[I+"arrow"]=J;O[I+"arrowlength"]=M;O[I+"arrowwidth"]=H};setFillAndStroke=function(aj,F){aj.attrs=aj.attrs||{};var ac=aj.node,ao=aj.attrs,ai=ac.style,aa,ad=u[aj.type]&&(F.x!=ao.x||F.y!=ao.y||F.width!=ao.width||F.height!=ao.height||F.cx!=ao.cx||F.cy!=ao.cy||F.rx!=ao.rx||F.ry!=ao.ry||F.r!=ao.r),ag=p[aj.type]&&(ao.cx!=F.cx||ao.cy!=F.cy||ao.r!=F.r||ao.rx!=F.rx||ao.ry!=F.ry),ae=aj;for(var J in F){if(F[c](J)){ao[J]=F[J]}}if(ad){ao.path=j._getPath[aj.type](aj);aj._.dirty=1}F.href&&(ac.href=F.href);F.title&&(ac.title=F.title);F.target&&(ac.target=F.target);F.cursor&&(ai.cursor=F.cursor);"blur" in F&&aj.blur(F.blur);if(F.path&&aj.type=="path"||ad){ac.path=d(~A(ao.path).toLowerCase().indexOf("r")?j._pathToAbsolute(ao.path):ao.path);if(aj.type=="image"){aj._.fillpos=[ao.x,ao.y];aj._.fillsize=[ao.width,ao.height];n(aj,1,1,0,0,0)}}"transform" in F&&aj.transform(F.transform);if(ag){var V=+ao.cx,T=+ao.cy,Y=+ao.rx||+ao.r||0,X=+ao.ry||+ao.r||0;ac.path=j.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",x((V-Y)*a),x((T-X)*a),x((V+Y)*a),x((T+X)*a),x(V*a))}if("clip-rect" in F){var ab=A(F["clip-rect"]).split(g);if(ab.length==4){ab[2]=+ab[2]+(+ab[0]);ab[3]=+ab[3]+(+ab[1]);var am=ac.clipRect||j._g.doc.createElement("div"),W=am.style,R=ac.parentNode;W.clip=j.format("rect({1}px {2}px {3}px {0}px)",ab);if(!ac.clipRect){W.position="absolute";W.top=0;W.left=0;W.width=aj.paper.width+"px";W.height=aj.paper.height+"px";R.parentNode.insertBefore(am,R);am.appendChild(R);ac.clipRect=am}}if(!F["clip-rect"]){ac.clipRect&&(ac.clipRect.style.clip=o)}}if(aj.textpath){var H=aj.textpath.style;F.font&&(H.font=F.font);F["font-family"]&&(H.fontFamily='"'+F["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"');F["font-size"]&&(H.fontSize=F["font-size"]);F["font-weight"]&&(H.fontWeight=F["font-weight"]);F["font-style"]&&(H.fontStyle=F["font-style"])}if("arrow-start" in F){addArrow(ae,F["arrow-start"])}if("arrow-end" in F){addArrow(ae,F["arrow-end"],1)}if(F.opacity!=null||F["stroke-width"]!=null||F.fill!=null||F.src!=null||F.stroke!=null||F["stroke-width"]!=null||F["stroke-opacity"]!=null||F["fill-opacity"]!=null||F["stroke-dasharray"]!=null||F["stroke-miterlimit"]!=null||F["stroke-linejoin"]!=null||F["stroke-linecap"]!=null){var O=ac.getElementsByTagName(s),I=false;O=O&&O[0];!O&&(I=O=B(s));if(aj.type=="image"&&F.src){O.src=F.src}F.fill&&(O.on=true);if(O.on==null||F.fill=="none"||F.fill===null){O.on=false}if(O.on&&F.fill){var G=A(F.fill).match(j._ISURL);if(G){O.parentNode==ac&&ac.removeChild(O);O.rotate=true;O.src=G[1];O.type="tile";var S=aj.getBBox(1);O.position=S.x+i+S.y;aj._.fillpos=[S.x,S.y];j._preload(G[1],function(){aj._.fillsize=[this.offsetWidth,this.offsetHeight]})}else{O.color=j.getRGB(F.fill).hex;O.src=o;O.type="solid";if(j.getRGB(F.fill).error&&(ae.type in {circle:1,ellipse:1}||A(F.fill).charAt()!="r")&&addGradientFill(ae,F.fill,O)){ao.fill="none";ao.gradient=F.fill;O.rotate=false}}}if("fill-opacity" in F||"opacity" in F){var al=((+ao["fill-opacity"]+1||2)-1)*((+ao.opacity+1||2)-1)*((+j.getRGB(F.fill).o+1||2)-1);al=y(D(al,0),1);O.opacity=al;if(O.src){O.color="none"}}ac.appendChild(O);var Z=(ac.getElementsByTagName("stroke")&&ac.getElementsByTagName("stroke")[0]),af=false;!Z&&(af=Z=B("stroke"));if((F.stroke&&F.stroke!="none")||F["stroke-width"]||F["stroke-opacity"]!=null||F["stroke-dasharray"]||F["stroke-miterlimit"]||F["stroke-linejoin"]||F["stroke-linecap"]){Z.on=true}(F.stroke=="none"||F.stroke===null||Z.on==null||F.stroke==0||F["stroke-width"]==0)&&(Z.on=false);var K=j.getRGB(F.stroke);Z.on&&F.stroke&&(Z.color=K.hex);al=((+ao["stroke-opacity"]+1||2)-1)*((+ao.opacity+1||2)-1)*((+K.o+1||2)-1);var E=(l(F["stroke-width"])||1)*0.75;al=y(D(al,0),1);F["stroke-width"]==null&&(E=ao["stroke-width"]);F["stroke-width"]&&(Z.weight=E);E&&E<1&&(al*=E)&&(Z.weight=1);Z.opacity=al;F["stroke-linejoin"]&&(Z.joinstyle=F["stroke-linejoin"]||"miter");Z.miterlimit=F["stroke-miterlimit"]||8;F["stroke-linecap"]&&(Z.endcap=F["stroke-linecap"]=="butt"?"flat":F["stroke-linecap"]=="square"?"square":"round");if(F["stroke-dasharray"]){var M={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Z.dashstyle=M[c](F["stroke-dasharray"])?M[F["stroke-dasharray"]]:o}af&&ac.appendChild(Z)}if(ae.type=="text"){ae.paper.canvas.style.display=o;var U=ae.paper.span,ak=100,P=ao.font&&ao.font.match(/\d+(?:\.\d*)?(?=px)/);ai=U.style;ao.font&&(ai.font=ao.font);ao["font-family"]&&(ai.fontFamily=ao["font-family"]);ao["font-weight"]&&(ai.fontWeight=ao["font-weight"]);ao["font-style"]&&(ai.fontStyle=ao["font-style"]);P=l(P?P[0]:ao["font-size"]);ai.fontSize=P*ak+"px";ae.textpath.string&&(U.innerHTML=A(ae.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var ah=U.getBoundingClientRect();ae.W=ao.w=(ah.right-ah.left)/ak;ae.H=ao.h=(ah.bottom-ah.top)/ak;ae.X=ao.x;ae.Y=ao.y+ae.H/2;("x" in F||"y" in F)&&(ae.path.v=j.format("m{0},{1}l{2},{1}",x(ao.x*a),x(ao.y*a),x(ao.x*a)+1));var Q=["x","y","text","font","font-family","font-weight","font-style","font-size"];for(var an=0,N=Q.length;an<N;an++){if(Q[an] in F){ae._.dirty=1;break}}switch(ao["text-anchor"]){case"start":ae.textpath.style["v-text-align"]="left";ae.bbx=ae.W/2;break;case"end":ae.textpath.style["v-text-align"]="right";ae.bbx=-ae.W/2;break;default:ae.textpath.style["v-text-align"]="center";ae.bbx=0;break}ae.textpath.style["v-text-kern"]=true}};addGradientFill=function(E,N,Q){E.attrs=E.attrs||{};var O=E.attrs,H,I,K="linear",M=".5 .5";E.attrs.gradient=N;N=A(N).replace(j._radial_gradient,function(T,U,S){K="radial";if(U&&S){U=l(U);S=l(S);pow(U-0.5,2)+pow(S-0.5,2)>0.25&&(S=f.sqrt(0.25-pow(U-0.5,2))*((S>0.5)*2-1)+0.5);M=U+i+S}return o});N=N.split(/\s*\-\s*/);if(K=="linear"){var F=N.shift();F=-l(F);if(isNaN(F)){return null}}var J=j._parseDots(N);if(!J){return null}E=E.shape||E.node;if(J.length){E.removeChild(Q);Q.on=true;Q.method="none";Q.color=J[0].color;Q.color2=J[J.length-1].color;var R=[];for(var G=0,P=J.length;G<P;G++){J[G].offset&&R.push(J[G].offset+i+J[G].color)}Q.colors=R.length?R.join():"0% "+Q.color;if(K=="radial"){Q.type="gradientTitle";Q.focus="100%";Q.focussize="0 0";Q.focusposition=M;Q.angle=0}else{Q.type="gradient";Q.angle=(270-F)%360}E.appendChild(Q)}return 1};Element=function(F,E){this[0]=this.node=F;F.raphael=true;this.id=j._oid++;F.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=E;this.matrix=j.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!E.bottom&&(E.bottom=this);this.prev=E.top;E.top&&(E.top.next=this);E.top=this;this.next=null};var k=j.el;Element.prototype=k;k.constructor=Element;k.transform=function(I){if(I==null){return this._.transform}var K=this.paper._viewBoxShift,J=K?"s"+[K.scale,K.scale]+"-1-1t"+[K.dx,K.dy]:o,O;if(K){O=I=A(I).replace(/\.{3}|\u2026/g,this._.transform||o)}j._extractTransform(this,J+I);var P=this.matrix.clone(),R=this.skew,G=this.node,N,H=~A(this.attrs.fill).indexOf("-"),E=!A(this.attrs.fill).indexOf("url(");P.translate(-0.5,-0.5);if(E||H||this.type=="image"){R.matrix="1 0 0 1";R.offset="0 0";N=P.split();if((H&&N.noRotation)||!N.isSimple){G.style.filter=P.toFilter();var M=this.getBBox(),F=this.getBBox(1),S=M.x-F.x,Q=M.y-F.y;G.coordorigin=(S*-a)+i+(Q*-a);n(this,1,1,S,Q,0)}else{G.style.filter=o;n(this,N.scalex,N.scaley,N.dx,N.dy,N.rotate)}}else{G.style.filter=o;R.matrix=A(P);R.offset=P.offset()}O&&(this._.transform=O);return this};k.rotate=function(F,E,H){if(this.removed){return this}if(F==null){return}F=A(F).split(g);if(F.length-1){E=l(F[1]);H=l(F[2])}F=l(F[0]);(H==null)&&(E=H);if(E==null||H==null){var G=this.getBBox(1);E=G.x+G.width/2;H=G.y+G.height/2}this._.dirtyT=1;this.transform(this._.transform.concat([["r",F,E,H]]));return this};k.translate=function(F,E){if(this.removed){return this}F=A(F).split(g);if(F.length-1){E=l(F[1])}F=l(F[0])||0;E=+E||0;if(this._.bbox){this._.bbox.x+=F;this._.bbox.y+=E}this.transform(this._.transform.concat([["t",F,E]]));return this};k.scale=function(I,G,E,H){if(this.removed){return this}I=A(I).split(g);if(I.length-1){G=l(I[1]);E=l(I[2]);H=l(I[3]);isNaN(E)&&(E=null);isNaN(H)&&(H=null)}I=l(I[0]);(G==null)&&(G=I);(H==null)&&(E=H);if(E==null||H==null){var F=this.getBBox(1)}E=E==null?F.x+F.width/2:E;H=H==null?F.y+F.height/2:H;this.transform(this._.transform.concat([["s",I,G,E,H]]));this._.dirtyT=1;return this};k.hide=function(){!this.removed&&(this.node.style.display="none");return this};k.show=function(){!this.removed&&(this.node.style.display=o);return this};k._getBBox=function(){if(this.removed){return{}}if(this.type=="text"){return{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}}else{return pathDimensions(this.attrs.path)}};k.remove=function(){if(this.removed){return}j.eve.unbind("*.*."+this.id);j._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var E in this){delete this[E]}this.removed=true};k.attr=function(E,O){if(this.removed){return this}if(E==null){var K={};for(var N in this.attrs){if(this.attrs[c](N)){K[N]=this.attrs[N]}}K.gradient&&K.fill=="none"&&(K.fill=K.gradient)&&delete K.gradient;K.transform=this._.transform;return K}if(O==null&&j.is(E,"string")){if(E==s&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient}var M=E.split(g),H={};for(var I=0,Q=M.length;I<Q;I++){E=M[I];if(E in this.attrs){H[E]=this.attrs[E]}else{if(j.is(this.paper.customAttributes[E],"function")){H[E]=this.paper.customAttributes[E].def}else{H[E]=j._availableAttrs[E]}}}return Q-1?H:H[M[0]]}if(this.attrs&&O==null&&j.is(E,"array")){H={};for(I=0,Q=E.length;I<Q;I++){H[E[I]]=this.attr(E[I])}return H}var F;if(O!=null){F={};F[E]=O}O==null&&j.is(E,"object")&&(F=E);for(var P in F){j.eve("attr."+P+"."+this.id,this,F[P])}if(F){for(P in this.paper.customAttributes){if(this.paper.customAttributes[c](P)&&F[c](P)&&j.is(this.paper.customAttributes[P],"function")){var J=this.paper.customAttributes[P].apply(this,[][concat](F[P]));this.attrs[P]=F[P];for(var G in J){if(J[c](G)){F[G]=J[G]}}}}if(F.text&&this.type=="text"){this.textpath.string=F.text}setFillAndStroke(this,F)}return this};k.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&j._tofront(this,this.paper);return this};k.toBack=function(){if(this.removed){return this}if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);j._toback(this,this.paper)}return this};k.insertAfter=function(E){if(this.removed){return this}if(E.constructor==j.st.constructor){E=E[E.length-1]}if(E.node.nextSibling){E.node.parentNode.insertBefore(this.node,E.node.nextSibling)}else{E.node.parentNode.appendChild(this.node)}j._insertafter(this,E,this.paper);return this};k.insertBefore=function(E){if(this.removed){return this}if(E.constructor==j.st.constructor){E=E[0]}E.node.parentNode.insertBefore(this.node,E.node);j._insertbefore(this,E,this.paper);return this};k.blur=function(E){var F=this.node.runtimeStyle,G=F.filter;G=G.replace(r,o);if(+E!==0){this.attrs.blur=E;F.filter=G+i+t+".Blur(pixelradius="+(+E||1.5)+")";F.margin=j.format("-{0}px 0 0 -{0}px",x(+E||1.5))}else{F.filter=G;F.margin=0;delete this.attrs.blur}};j._engine.path=function(H,F){var I=B("shape");I.style.cssText=b;I.coordsize=a+i+a;I.coordorigin=F.coordorigin;var J=new Element(I,F),E={fill:"none",stroke:"#000"};H&&(E.path=H);J.type="path";J.path=[];J.Path=o;setFillAndStroke(J,E);F.canvas.appendChild(I);var G=B("skew");G.on=true;I.appendChild(G);J.skew=G;J.transform(o);return J};j._engine.rect=function(F,K,I,M,G,E){var N=j._rectPath(K,I,M,G,E),H=F.path(N),J=H.attrs;H.X=J.x=K;H.Y=J.y=I;H.W=J.width=M;H.H=J.height=G;J.r=E;J.path=N;H.type="rect";return H};j._engine.ellipse=function(F,E,K,J,I){var H=F.path(),G=H.attrs;H.X=E-J;H.Y=K-I;H.W=J*2;H.H=I*2;H.type="ellipse";setFillAndStroke(H,{cx:E,cy:K,rx:J,ry:I});return H};j._engine.circle=function(F,E,J,I){var H=F.path(),G=H.attrs;H.X=E-I;H.Y=J-I;H.W=H.H=I*2;H.type="circle";setFillAndStroke(H,{cx:E,cy:J,r:I});return H};j._engine.image=function(F,E,M,J,N,H){var P=j._rectPath(M,J,N,H),I=F.path(P).attr({stroke:"none"}),K=I.attrs,G=I.node,O=G.getElementsByTagName(s)[0];K.src=E;I.X=K.x=M;I.Y=K.y=J;I.W=K.width=N;I.H=K.height=H;K.path=P;I.type="image";O.parentNode==G&&G.removeChild(O);O.rotate=true;O.src=E;O.type="tile";I._.fillpos=[M,J];I._.fillsize=[N,H];G.appendChild(O);n(I,1,1,0,0,0);return I};j._engine.text=function(E,K,J,M){var H=B("shape"),O=B("path"),G=B("textpath");K=K||0;J=J||0;M=M||"";O.v=j.format("m{0},{1}l{2},{1}",x(K*a),x(J*a),x(K*a)+1);O.textpathok=true;G.string=A(M);G.on=true;H.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";H.coordsize=a+i+a;H.coordorigin="0 0";var F=new Element(H,E),I={fill:"#000",stroke:"none",font:j._availableAttrs.font,text:M};F.shape=H;F.path=O;F.textpath=G;F.type="text";F.attrs.text=A(M);F.attrs.x=K;F.attrs.y=J;F.attrs.w=1;F.attrs.h=1;setFillAndStroke(F,I);H.appendChild(G);H.appendChild(O);E.canvas.appendChild(H);var N=B("skew");N.on=true;H.appendChild(N);F.skew=N;F.transform(o);return F};j._engine.setSize=function(G,E){var F=this.canvas.style;this.width=G;this.height=E;G==+G&&(G+="px");E==+E&&(E+="px");F.width=G;F.height=E;F.clip="rect(0 "+G+" "+E+" 0)";if(this._viewBox){setViewBox.apply(this,this._viewBox)}return this};j._engine.setViewBox=function(K,J,M,G,I){j.eve("setViewBox",this,this._viewBox,[K,J,M,G,I]);var E=this.width,O=this.height,P=1/D(M/E,G/O),N,F;if(I){N=O/G;F=E/M;if(M*N<E){K-=(E-M*N)/2/N}if(G*F<O){J-=(O-G*F)/2/F}}this._viewBox=[K,J,M,G,!!I];this._viewBoxShift={dx:-K,dy:-J,scale:P};this.forEach(function(H){H.transform("...")});return this};var B,v=function(G){var F=G.document;F.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!F.namespaces.rvml&&F.namespaces.add("rvml","urn:schemas-microsoft-com:vml");B=function(H){return F.createElement("<rvml:"+H+' class="rvml">')}}catch(E){B=function(H){return F.createElement("<"+H+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};v(j._g.win);j._engine.create=function(){var G=j._getContainer.apply(0,arguments),E=G.container,N=G.height,O,F=G.width,M=G.x,K=G.y;if(!E){throw new Error("VML container not found.")}var I=new j._Paper,J=I.canvas=j._g.doc.createElement("div"),H=J.style;M=M||0;K=K||0;F=F||512;N=N||342;I.width=F;I.height=N;F==+F&&(F+="px");N==+N&&(N+="px");I.coordsize=a*1000+i+a*1000;I.coordorigin="0 0";I.span=j._g.doc.createElement("span");I.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";J.appendChild(I.span);H.cssText=j.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",F,N);if(E==1){j._g.doc.body.appendChild(J);H.left=M+"px";H.top=K+"px";H.position="absolute"}else{if(E.firstChild){E.insertBefore(J,E.firstChild)}else{E.appendChild(J)}}I.renderfix=function(){};return I};j.prototype.clear=function(){j.eve("clear",this);this.canvas.innerHTML=o;this.span=j._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};j.prototype.remove=function(){j.eve("remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var E in this){this[E]=removed(E)}return true}}(window.Raphael);DG.LayerManager=function(a){return{_firstLayer:null,_lastLayer:null,_paper:a,addNamedLayer:function(b,d){DG.assert(!SC.empty(b));if(this[b]){return this[b]}var c=DG.RaphaelLayer.create({_paper:this._paper,name:b});this[b]=c;if(d){c._prevLayer=d}else{if(this._lastLayer){c._prevLayer=this._lastLayer;this._lastLayer=c}else{this._firstLayer=this._lastLayer=c}}return this},forEach:function(d){var c,b;for(c=this._lastLayer;c;c=b){b=c._prevLayer;d(c)}},moveElementFromTo:function(d,c,b){if(c===b){return}if(typeof c==="string"){c=this[c]}if(typeof b==="string"){b=this[b]}if(c.contains(d)){c.prepareToMoveOrRemove(d);b.push(d)}this.testValidity()},removeElement:function(b){this.forEach(function(c){c.prepareToMoveOrRemove(b)});b.remove();this.testValidity()},testValidity:function(){}}};sc_require("libraries/raphael");sc_require("utilities/layer_manager");DG.RaphaelBaseView=SC.View.extend(DG.Destroyable,{drawWidth:function(){return this.get("frame").width}.property("frame"),drawHeight:function(){return this.get("frame").height}.property("frame"),_paper:null,paper:function(){return this._paper}.property("_paper"),_layerManager:null,layerManager:function(){if(!this._layerManager){this.initLayerManager()}return this._layerManager}.property(),_elementsToClear:null,_elementsInFront:null,_firstTimeToDraw:true,init:function(){arguments.callee.base.apply(this,arguments);this._elementsToClear=[];this._elementsInFront=[]},destroy:function(){this._elementsToClear=null;this._elementsInFront=null;this._paper=null;arguments.callee.base.apply(this,arguments)},createVisualization:function(){if(this.shouldDraw()){this.willDraw();this.doDraw();this.didDraw()}if(this._firstTimeToDraw){this._firstTimeToDraw=false;this.invokeLater("displayDidChange",1)}},shouldDraw:function shouldDraw(){return !SC.none(this._elementsToClear)},willDraw:function willDraw(){this._elementsToClear.forEach(function(a){a.remove()});this._elementsToClear=[]},doDraw:function doDraw(){},didDraw:function didDraw(){var b,a=this._elementsToClear.length;for(b=a-1;b>=0;b--){this._elementsToClear[b].toBack()}a=this._elementsInFront.length;for(b=0;b<a;b++){this._elementsInFront[b].toFront()}},updatePaper:function updatePaper(){if(this._paper){var b=this.get("drawWidth"),a=this.get("drawHeight");if((b<=0)||(a<=0)){return}if((this._paper.width!==b)||(this._paper.height!==a)){this._paper.setSize(b,a);this.notifyPropertyChange("paperSize");this.invokeLast(this.createVisualization)}}}.observes("frame"),render:function render(a,b){arguments.callee.base.apply(this,arguments);if(this._paper){this.createVisualization()}},initLayerManager:function(){if(!this._layerManager){DG.assert(this._paper);this._layerManager=new DG.LayerManager(this._paper)}},didCreateLayer:function didCreateLayer(){this._paper=Raphael(this.get("layer"),this.get("drawWidth"),this.get("drawHeight"));this.createVisualization()},touchStart:function(a){return YES},touchEnd:function(a){return YES},touchesDragged:function(a,b){return YES},captureTouch:function(a){return YES},touchPriority:YES});sc_require("views/raphael_base");DG.RDV_DIVIDER_WIDTH=48;DG.RelationDividerView=SC.View.extend((function(){var g=12,c=4,d="#808080",i="#EEEEEE",h="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/slickgrid/images/expand.gif",f="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/slickgrid/images/collapse.gif",b={width:9,height:9},j=5;function a(n,m){var o=m.width+2*j,l=m.height+2*j,k="M%@,%@ h%@ v%@ h%@ z".fmt(n.x-j,n.y-j,o,l,-o);return k}return{layout:{width:DG.RDV_DIVIDER_WIDTH},leftTable:function(k,l){if(l!==undefined){this.setPath("dividerView.leftTable",l);return this}return this.getPath("dividerView.leftTable")}.property(),rightTable:function(k,l){if(l!==undefined){this.setPath("headerView.rightTable",l);this.setPath("dividerView.rightTable",l);return this}return this.getPath("dividerView.rightTable")}.property(),displayDidChange:function(){arguments.callee.base.apply(this,arguments);var k=this.get("headerView"),l=this.get("dividerView");if(k){k.displayDidChange()}if(l){l.displayDidChange()}},childViews:["headerView","dividerView"],headerView:DG.RaphaelBaseView.extend({layout:{left:0,top:0,right:0,height:24},render:function(k,l){arguments.callee.base.apply(this,arguments);k.classNames(["slick-header","ui-state-default"],YES)},classNames:["slick-header-column"],backgroundColor:"#E6E6E6",doDraw:function(){function l(r){return r&&((r.expanded===0)&&(r.collapsed>0))}var o=this.get("rightTable"),k=this.getPath("rightTable.gridAdapter"),n=l(k&&k.get("expandCollapseCounts"))?h:f,q={x:3,y:8},p=b;function m(s){if(k&&o){var r=k.get("expandCollapseCounts");o.expandCollapseAll(l(r))}}this._paper.path(a(q,p)).attr({fill:"transparent",stroke:"transparent"}).touchstart(function(r){SC.run(m(r))});this._paper.image(n,q.x,q.y,p.width,p.height).click(function(r){SC.run(m(r))})}}),dividerView:DG.RaphaelBaseView.extend({layout:{left:0,top:24,right:0,bottom:0},backgroundColor:"white",leftTable:null,rightTable:null,_parentChildRelationsMap:null,displayProperties:["leftTable","rightTable"],doDraw:function(){var p=this.get("leftTable"),t=p&&p.get("gridAdapter"),A=(p&&p.getPath("scrollPos.scrollTop"))||0,r=this.get("rightTable"),E=r&&r.get("gridAdapter"),s=(r&&r.getPath("scrollPos.scrollTop"))||0,v=E&&E.get("parentIDGroups"),l=0,D=0,m=E&&E.get("rowHeight"),k=0,u=this;if(!t||!E){return}if(!this._parentChildRelationsMap){this._parentChildRelationsMap={}}function y(J,H){if(J===H){return"M0,%@ h%@".fmt(J,DG.RDV_DIVIDER_WIDTH)}var I={x:g,y:J},G={x:DG.RDV_DIVIDER_WIDTH-c,y:H},K={x:(I.x+G.x)/2,y:(I.y+G.y)/2},F={x:K.x,y:I.y};return"M0,%@ h%@ Q%@,%@ %@,%@ T%@,%@ h%@".fmt(I.y,g,F.x,F.y,K.x,K.y,G.x,G.y,c)}function o(M,J,K,H){var I={x:g,y:K},N={x:DG.RDV_DIVIDER_WIDTH-c,y:H},G={x:(I.x+N.x)/2,y:(I.y+N.y)/2},F={x:G.x,y:N.y};return"%@ V%@ h%@ Q%@,%@ %@,%@ T%@,%@ h%@ Z".fmt(y(M,J),N.y,-c,F.x,F.y,G.x,G.y,I.x,I.y,-g)}function B(J,I,K,G,H){var M=I.getIndexForID(K),F;if(SC.none(M)){F={left:0,top:G,right:0,bottom:G+H}}else{F=J.getRowBounds(M)}return F}function w(I){var G=this.dgChildIDRange,F=G&&G.isCollapsed,H=E&&E.gridDataView;G.isCollapsed=!F;if(H){if(G.isCollapsed){H.collapseGroup(this.dgParentID)}else{H.expandGroup(this.dgParentID)}r.updateSelectedRows();r.incrementProperty("expandCollapseCount")}}function z(F,H,I){var J=H&&H.get("showExpandedGroupRows");if(J){var K=H&&H.get("gridDataView"),G=K&&K.isGroupCollapsed(I);if(!G){F.top-=m}}}function x(G,F,H){if(G){if(F){G.attr({path:H})}else{G.remove()}}}var n=0;function q(I,J){var P=B(p,t,I,l,0),H=B(r,E,J.firstChildID,D,m),N=B(r,E,J.lastChildID,D,m),G=u._parentChildRelationsMap[I];if(!P||!H||!N){return}z(H,E,I);l=Math.max(l,P.bottom);D=Math.max(D,N.bottom);if(P&&H&&N){var T=true,F=I===k,V=n%2,M=T?y(P.top-A,H.top-s):"",K=F?y(P.bottom-A+1,N.bottom-s+1):"",R=V?o(P.top-A,H.top-s,P.bottom-A+1,N.bottom-s+1):"",U=J.isCollapsed?h:f,Q={x:3,y:P.top-A+5},S=b,O=a(Q,S);if(!G){u._parentChildRelationsMap[I]=G={};G.area=V?u._paper.path(R).attr({fill:i,stroke:"transparent"}):null;G.top=T?u._paper.path(M).attr({stroke:d}):null;if((SC.browser.os===SC.OS.ios)||(SC.browser.os===SC.OS.android)){G.touch=u._paper.path(O).attr({fill:"transparent",stroke:"transparent"}).touchstart(function(W){SC.run(w.call(G.icon,W))})}G.icon=u._paper.image(U,Q.x,Q.y,S.width,S.height).click(function(W){SC.run(w.call(this,W))});G.icon.dgParentID=I;G.icon.dgChildIDRange=J;if(F){G.bottom=u._paper.path(K).attr({stroke:d})}}else{x(G.top,T,M);x(G.area,V,R);x(G.touch,true,O);if(G.icon){G.icon.attr({src:U,x:Q.x,y:Q.y})}x(G.bottom,F,K)}G.marked=false;++n}}DG.ObjectMap.forEach(u._parentChildRelationsMap,function(F,G){G.marked=true});DG.ObjectMap.forEach(v,function(F){if(k<F){k=F}});DG.ObjectMap.forEach(v,q);function C(F,G){if(G&&(typeof G.remove==="function")){G.remove()}}DG.ObjectMap.forEach(u._parentChildRelationsMap,function(G,F){if(F.marked){DG.ObjectMap.forEach(F,C);delete u._parentChildRelationsMap[G]}})}})}}()));sc_require("components/case_table/case_table_view");sc_require("components/case_table/relation_divider_view");DG.HierTableView=SC.SplitView.extend((function(){var d="#E6E6E6",b=60,a=b,c=7;return{dataContext:null,layout:{left:0,top:0,right:0,bottom:0},layoutDirection:SC.LAYOUT_HORIZONTAL,childViews:["parentTableView","relationDividerView","childTableView","slopView"],parentTableView:DG.CaseTableView.extend(SC.SplitChild,{name:"parentTableView",minimumSize:a,autoResizeStyle:SC.RESIZE_AUTOMATIC,compensatesForMovement:YES}),relationDividerView:DG.RelationDividerView.extend(SC.SplitChild,{name:"relationDividerView",minimumSize:DG.RDV_DIVIDER_WIDTH,maximumSize:DG.RDV_DIVIDER_WIDTH,size:DG.RDV_DIVIDER_WIDTH,autoResizeStyle:SC.FIXED_SIZE,compensatesForMovement:NO,allowsIndirectAdjustments:NO}),childTableView:DG.CaseTableView.extend(SC.SplitChild,{name:"childTableView",minimumSize:a,autoResizeStyle:SC.RESIZE_MANUAL,compensatesForMovement:function(){var f=this.getPath("parentView.slopView.size");return f<=c}.property()}),slopView:SC.View.extend(SC.SplitChild,{name:"slopView",minimumSize:c,size:c,autoResizeStyle:SC.RESIZE_MANUAL,compensatesForMovement:YES,backgroundColor:d}),childTableViews:function(){var g=this.get("childViews")||[],f=[];g.forEach(function(h){if(h.kindOf(DG.CaseTableView)){f.push(h)}});return f}.property(),willDestroy:function(){var f=this.get("childTableViews");f.forEach(function(g){if(g&&g.willDestroy){g.willDestroy()}})},splitViewDividerBetween:function(h,g,f){if(!this.get("splitDividerView")){return null}if(g===this.get("parentTableView")){return this.get("splitDividerView").create()}return DG.InertSplitDividerView.create()},refresh:function(){var f=this.get("childTableViews");f.forEach(function(g){g.refresh()})},mouseDown:function(){DG.globalEditorLock.commitCurrentEdit()},_klugeAdjust:false,gridViewDidChange:function(g){this.get("relationDividerView").displayDidChange();if(!this._klugeAdjust){this._klugeAdjust=true;var h=DG.ComponentView.findComponentViewParent(this),f=h&&h.get("frame"),i=f&&f.width;if(i){h.adjust("width",i+1)}}}.observes(".parentTableView.gridView",".childTableView.gridView"),gridWidthDidChange:function(g){var f=g&&g.get("maximumSize"),i=g&&g.get("gridWidth"),h=false;if(g&&(i!==f)){g.set("maximumSize",i);if(h){this.columnWidthDidChange(g)}else{g.set("size",i);this.invokeOnce("_scsv_tile")}}}.observes(".parentTableView.gridWidth",".childTableView.gridWidth"),childTableLayoutDidChange:function(g){var h=this.get("parentTableView"),i=this.get("relationDividerView"),f=this.get("childTableView");if(h){this.invokeLater(function(){h.displayDidChange()})}if(i){this.invokeLater(function(){i.displayDidChange()})}if(f){this.invokeLater(function(){f.displayDidChange()})}}.observes(".parentTableView.size",".childTableView.size"),columnWidthDidChange:function(f){var q=f.get("gridWidthChange"),m=this.get("parentTableView"),o=this.get("childTableView"),k=f,n=k&&k.get("size"),j=k&&k.get("gridWidth"),i=f===o?m:o,g=this.get("slopView"),l=g&&g.get("size"),s=l-c;if((q>0)&&(s>0)){var h=Math.max(0,Math.min(q,s));this.splitViewAdjustChildToFit(this,k,h);this.splitViewAdjustChildToFit(this,g,-h,l);this.splitViewLayoutChildren(this)}else{if((q<0)&&(j+q<=n)){var r,p;r=this.splitViewAdjustChildToFit(this,k,q);p=q-r;if(p!==0){p=this.splitViewAdjustChildToFit(this,i,-p)}if(p!==0){this.splitViewAdjustChildToFit(this,g,p,l+p)}this.splitViewLayoutChildren(this)}}},rowCountDidChange:function(){this.relationDividerView.displayDidChange()}.observes(".parentTableView.rowCount",".childTableView.rowCount"),tableDidScroll:function(){SC.run(function(){this.relationDividerView.displayDidChange()}.bind(this))}.observes(".parentTableView.scrollPos",".childTableView.scrollPos"),tableDidExpandCollapse:function(){SC.run(function(){this.relationDividerView.displayDidChange()}.bind(this))}.observes(".parentTableView.expandCollapseCount",".childTableView.expandCollapseCount"),setCaseTableAdapters:function(i){var h=this.get("childTableViews");h.forEach(function(m,l){var k=i.objectAt(l);m.setIfChanged("gridAdapter",k)});var j=this.get("parentTableView"),g=this.get("childTableView"),f=this.get("relationDividerView");if(f&&j&&g){f.set("leftTable",j);f.set("rightTable",g)}},updateColumnInfo:function(){var f=this.get("childTableViews")||[];f.forEach(function(g){g.updateColumnInfo()})},updateRowData:function(){var f=this.get("childTableViews")||[];f.forEach(function(g){g.updateRowData()})},updateRowCount:function(){var f=this.get("childTableViews")||[];f.forEach(function(g){g.updateRowCount()})},updateSelectedRows:function(){var f=this.get("childTableViews")||[];f.forEach(function(g){g.updateSelectedRows()})},splitViewAdjustChildToFit:function(g,k,h,i){var j=k&&k.get("minimumSize"),m=!SC.none(i)?i:Math.max(j,k&&k.get("gridWidth")),l=k&&k.get("size"),f=0;if(h>0){f=Math.min(h,m-l)}else{if(h<0){f=Math.max(h,j-l)}}if(f!==0){k.set("size",l+f)}return h-f},splitViewResizeChildrenToFit:function(l,h){var k=this.get("_frameSize"),o=this.get("parentTableView"),i=o&&o.get("size"),n=o&&o.get("gridWidth"),p=this.get("childTableView"),q=p&&p.get("size"),g=p&&p.get("gridWidth"),j=this.get("slopView"),m=j&&j.get("size"),r=(m-c)||0,s=k-h,f=0;if(r>0){if((s<0)&&(r>-s)){f=r+s}}if((s<0)&&(m>c)){s=this.splitViewAdjustChildToFit(this,j,s-f,k);s+=f}if((s!==0)&&(q<g)){s=this.splitViewAdjustChildToFit(this,p,s)}if((s!==0)&&(i<n)){s=this.splitViewAdjustChildToFit(this,o,s)}if(s>0){s=this.splitViewAdjustChildToFit(this,j,s,k)}if(s!==0){s=this.splitViewAdjustChildToFit(this,o,s)}if(s!==0){s=this.splitViewAdjustChildToFit(this,p,s)}}}}()));DG.InertSplitDividerView=SC.View.extend(SC.SplitChild,{classNames:["sc-split-divider-view"],isSplitDivider:YES,autoResizeStyle:"sc-fixed-size",movesSibling:SC.MOVES_CHILD,size:SC.propertyFromRenderDelegate("dividerSize",1),renderDelegateName:"inertSplitDividerRenderDelegate"});SC.BaseTheme.inertSplitDividerRenderDelegate=SC.RenderDelegate.create({className:"split-divider",dividerSize:1,splitPositionOffset:-5,splitSizeOffset:5,render:function(b,a){this.addSizeClassName(b,a);a.push("<div class='line'></div>")},update:function(b,a){this.updateSizeClassName(b,a)}});DG.TableView=DG.HierTableView;sc_require("controllers/component_controller");DG.GameController=DG.ComponentController.extend({openCaseIDs:null,shouldDestroyOnComponentDestroy:false,gameIsReady:true,changeCount:0,savedChangeCount:0,init:function(){arguments.callee.base.apply(this,arguments);this.openCaseIDs=[]},hasUnsavedChanges:function(){return this.get("changeCount")>this.get("savedChangeCount")}.property(),updateSavedChangeCount:function(){this.set("savedChangeCount",this.get("changeCount"))},getOpenCaseIDs:function(b){var d=[],a=(b?false:true);function c(g){d.push(g.get("id"));if(a){var f=g.get("children");f.forEach(function(h){c(h)})}}this.openCaseIDs.forEach(function(g){var f=DG.store.find(DG.Case,g);if(f){c(f)}});DG.ObjectMap.forEach(this._openParentCases,function(f,g){c(g)});return d},doCommand:function(b){var c=this,a;SC.run(function(){a=c.dispatchCommand(b)});return a},dispatchCommand:function(d){var g=null;var b={success:false};if(SC.typeOf(d)===SC.T_STRING){try{g=SC.json.decode(d)}catch(f){DG.logWarn("Invalid JSON in doCommand(), reported from DG.GameController.dispatchCommand()");DG.log("JSON: "+d)}}else{g=d}if(!g){return b}var a=true;switch(g.action){case"initGame":b=this.handleInitGame(g.args);this.set("changeCount",0);this.updateSavedChangeCount();a=false;break;case"createComponent":b=this.handleCreateComponent(g.args);break;case"createCollection":b=this.handleCreateCollection(g.args);break;case"openCase":b=this.handleOpenCase(g.args);break;case"updateCase":b=this.handleUpdateCase(g.args);break;case"closeCase":b=this.handleCloseCase(g.args);break;case"createCase":b=this.handleCreateCase(g.args);break;case"createCases":b=this.handleCreateCases(g.args);break;case"deleteAllCaseData":b=this.handleDeleteAllCaseData(g.args);break;case"logAction":b=this.handleLogAction(g.args);a=false;break;case"newCollection":DG.gameSelectionController.processNewCollectionArgs(g.args);var c=[];g.args.attrs.forEach(function(h){c.push(h.name)});this.newCollectionWithAttributes(g.args.name,c);b.success=true;break;case"newCase":this.addCaseToCollectionWithValues(g.args.collection,g.args.values);b.success=true;break;case"requestFormulaObject":b.success=DG.formulaObjectCoordinator.requestFormulaObject(g.args.title,g.args.description,g.args.output,g.args.inputs,g.args.descriptions,g.args.allow_user_variables);a=false;break;case"updateFormulaObject":b.success=DG.formulaObjectCoordinator.updateFormulaObject(g.args.description,g.args.output,g.args.inputs,g.args.descriptions,g.args.allow_user_variables);a=false;break;case"requestFormulaValue":b=DG.formulaObjectCoordinator.requestFormulaValue(g.args.output,g.args);a=false;break;case"requestAttributeValues":b=this.handleRequestAttributeValues(g.args);a=false;break;default:a=false;break}if(a){this.incrementProperty("changeCount")}return b},handleInitGame:function(o){var m=DG.gameSelectionController.get("currentGame"),b=m&&m.get("name"),k,i=[];if(m){DG.ObjectMap.copySome(m,o,function(q){return q!=="name"});k=DG.GameContext.getContextForGame(m);if(o.dimensions){var j=DG.gameSelectionController.get("currentDimensions"),n=j&&j.width,g=j&&j.height,l={width:o.dimensions.width,height:o.dimensions.height};if((n!==l.width)||(g!==l.height)){DG.gameSelectionController.set("currentDimensions",l)}}this.view.set("version",SC.none(m.version)?"":m.version)}function d(q){var r={name:q.name,areParentChildLinksConfigured:true};if(i.length>0){r.parent=i[i.length-1].get("id")}if(q.collapseChildren){r.collapseChildren=true}var s=k.guaranteeCollection(r);if(s){i.push(s);q.attrs.forEach(function(t){s.guaranteeAttribute(t)})}}if(o.collections){o.collections.forEach(d)}if(m){m.notifyPropertyChange("collections");var f=m.get("context"),h=f&&f.get("restoredGameState"),c={operation:"restoreState",args:{state:h}},a=m.get("doCommandFunc"),p=DG.gameSelectionController.findCurrentGameElement(m.get("gameEmbedID"));if(h){if(a){a(c)}else{if(p&&p.doCommandFunc){p.doCommandFunc(SC.json.encode(c))}}}}this.set("gameIsReady",true);if((o.log===undefined)||o.log){DG.logUser("initGame: '%@', Collections: [%@]",b,i.getEach("name").join(", "))}},handleCreateComponent:function(a){return SC.RootResponder.responder.sendAction("createComponentAndView",null,this,null,a)},doCreateCase:function(f,d){var a=DG.gameSelectionController.get("currentGame"),c=DG.GameContext.getContextForGame(a),h=c.getCollectionByName(d.collection),g={},b={success:false};if(!SC.none(d.parent)){g.parent=d.parent}if(!DG.assert(c)){return b}var i={operation:"createCase",properties:g,values:d.values};if(h){i.collection=h}else{DG.logWarn("DG.GameController.doCreateCase: Can't find collection '%@'",d.collection)}b=c.applyChange(i);if(b.success&&((d.log===undefined)||d.log)){DG.logUser("%@: %@ [%@]",f,d.collection,d.values.join(", "))}return b},doCreateCases:function(f,d){var a=DG.gameSelectionController.get("currentGame"),c=DG.GameContext.getContextForGame(a),h=c.getCollectionByName(d.collection),g={},b={success:false};if(!SC.none(d.parent)){g.parent=d.parent}if(!DG.assert(c)){return b}var i={operation:"createCases",properties:g,values:d.values};if(h){i.collection=h}else{DG.logWarn("DG.GameController.doCreateCase: Can't find collection '%@'",d.collection)}b=c.applyChange(i);if(b.success&&((d.log===undefined)||d.log)){DG.logUser("%@: %@ %@ cases created",f,d.collection,d.values.length)}return b},doUpdateCase:function(f,d){var a=DG.gameSelectionController.get("currentGame"),c=DG.GameContext.getContextForGame(a),h=c.getCollectionByName(d.collection),g=DG.store.find(DG.Case,d.caseID),b={success:false};if(h&&g&&d.values){var i={operation:"updateCases",collection:h,cases:[g],values:[d.values]};c.applyChange(i);b.success=true}if((d.log===undefined)||d.log){DG.logUser("%@: %@ [%@]",f,h.get("name"),d.values?d.values.join(", "):"")}return b},handleOpenCase:function(a){var b=this.doCreateCase("openCase",a);if(b.success&&!SC.none(b.caseID)){this.openCaseIDs.pushObject(b.caseID)}return b},handleUpdateCase:function(a){return this.doUpdateCase("updateCase",a)},handleCloseCase:function(a){var b=this.doUpdateCase("closeCase",a);if(!SC.none(a.caseID)){this.openCaseIDs.removeObject(a.caseID)}return b},handleCreateCase:function(a){return this.doCreateCase("createCase",a)},handleCreateCases:function(a){return this.doCreateCases("createCases",a)},handleDeleteAllCaseData:function(a){DG.logUser("deleteAllCaseData by Game");var b=a&&a.preserveAllGames,c=a&&a.preserveOpenEvents;return this.doDeleteAllCaseData(b,!c)},doDeleteAllCaseData:function(c,h){c=c||false;h=h||false;var b=DG.gameSelectionController.get("currentContext"),g=this.getOpenCaseIDs(h),d=null,i=null;if(c){d=b&&b.getCollectionAtIndex(0);if(d){d.getCaseIDs().forEach(function(j){if(g.indexOf(j)===-1){g.push(j)}})}}i=DG.Record.destroyAllRecordsOfType(DG.Case,g);DG.store.commitRecords();var f={operation:"deleteCases",isComplete:true,ids:i},a={success:false};if(b){a=b.applyChange(f)}return a},handleCreateCollection:function(i){DG.gameSelectionController.addCollectionSpecToGameSpecIfNecessary(i.name,i.attrs);var h=DG.gameSelectionController.get("currentGame"),g=DG.GameContext.getContextForGame(h),f={name:i.name,collapseChildren:i.collapseChildren,areParentChildLinksConfigured:true},j=DG.gameSelectionController.getPath("currentGame.collections");if(j&&j.length>1){var b=j[j.length-2],d=b&&g&&g.getCollectionByName(b.name);if(d){f.parent=d.get("id")}}var c=g&&g.applyChange({operation:"createCollection",properties:f,attributes:i.attrs}),a=c&&c.success&&c.collection;if(a){if((i.log===undefined)||i.log){DG.logUser("newCollectionCreated: %@ with %@ attributes",i.name,i.attrs.length)}return{success:true,collectionID:a.get("id")}}else{return{success:false}}},handleLogAction:function(a){if(a.formatStr){var b=[a.formatStr];if(a.replaceArgs){b=b.concat(a.replaceArgs)}DG.logUser.apply(this,b);return{success:true}}return{success:false}},handleRequestAttributeValues:function(n){var m=DG.gameSelectionController.get("currentGame"),l=DG.GameContext.getContextForGame(m),g=l.getCollectionByName(n.collection),b=DG.store.find(DG.Case,n.caseID),k={success:false,values:[]};if(g&&b&&n.attributeNames){var h=g.getAttributeIDs(),a,f,d,c=n.attributeNames.length;for(d=0;d<c;++d){a=g.getAttributeIndexByName(n.attributeNames[d]);f=null;if(a>0&&a<h.length){f=b.getValue(h[a])}k.values.push(f)}k.success=true}return k},newCollectionWithAttributes:function(c,d){DG.logUser("newCollectionCreated: %@ [%@]",c,d.join(", "));var a=DG.gameSelectionController.get("currentGame"),b=DG.GameContext.getContextForGame(a),f=b&&b.guaranteeCollection({name:c});if(f){d.forEach(function(g){f.guaranteeAttribute({name:g})})}if(c==="Weasels"){this.newCollectionWithAttributes("Games",["game"])}if(a){a.notifyPropertyChange("collections")}this.set("gameIsReady",true)},queuedCases:[],addCasesTimer:null,startQueueTime:null,_openGameName:"",_openParentCollectionName:"",_openParentCases:{},openParentCase:function(c,b,d,a){this._openGameName=c;this._openParentCollectionName=d;this._openParentCases[b]=a},closeParentCases:function(){this._openGameName="";this._openParentCollectionName="";this._openParentCases={}},closeParentCase:function(a){this.closeParentCases()},getParentCaseFor:function(a){return this._openParentCases[Object.keys(this._openParentCases).pop()]},addCasesFromQueue:function(){var f=this,a=DG.gameSelectionController.get("currentGame"),c=DG.gameSelectionController.get("currentName"),b=a&&a.get("parentCollectionName"),d=DG.gameCollectionWithName(c,b);this.queuedCases.forEach(function(n){var p=n.collectionName,s=n.values,q=DG.gameCollectionWithName(c,p),o=q&&q.getAttributeIDs(),j=o?o.length:0;DG.logUser("caseCreated: %@ [%@]",p,s.join(", "));if(j>s.length){j=s.length}var r=(p===b);if(c!==f._openGameName){f.closeParentCases()}if(!r&&!SC.none(d)&&SC.none(f._openParentCases[p])){var g=d.createCase();f.openParentCase(c,p,b,g)}var m=null;if(p!==f._openParentCollectionName){var k={};if(!r&&!SC.none(f._openParentCases[p])){k.parent=f._openParentCases[p].get("id")}m=q.createCase(k)}else{m=f.getParentCaseFor(s);if(m){m.beginCaseValueChanges()}}if(m){for(var l=0;l<j;++l){var h=DG.DataUtilities.canonicalizeInputValue(s[l]);m.setValue(o[l],h)}}if((p===f._openParentCollectionName)){f.closeParentCase(s);if(m){m.endCaseValueChanges()}}})},addCaseToCollectionWithValues:function(b,a){var f=this,c;function d(){SC.run(function(){f.addCasesFromQueue();f.queuedCases.length=0})}if(!SC.none(this.addCasesTimer)){this.addCasesTimer.invalidate()}c=(new Date()).valueOf();if(this.queuedCases.length===0){this.startQueueTime=c}this.queuedCases.push({collectionName:b,values:a});this.addCasesTimer=SC.Timer.schedule({action:d,interval:20})},createComponentStorage:function(){var b=DG.gameSelectionController.get("currentGame"),c={};if(b){c.currentGameName=b.get("name");c.currentGameUrl=b.get("url");var a=b.get("context");if(a){this.addLink(c,"context",a)}c.currentGameFormulas=SC.clone(b.get("formulas"))}return c},restoreComponentStorage:function(a,j){var g=this.getPath("model.layout"),h=g?{width:g.width,height:g.height}:null,d=a.currentGameName,b=DG.gameSelectionController.findGameByName(d);if(!b){b=DG.GameSpec.create({name:d,url:a.currentGameUrl});DG.gameSelectionController.prependToGamesMenu([b])}if(b&&!b.get("context")){var i=this.getLinkID(a,"context"),c=i&&DG.DataContext.retrieveContextFromMap(j,i),f=null;if(!c){DG.DataContext.forEachContextInMap(j,function(k,l){if(!c&&l){var m=l.get("gameName");if(m===d){c=l}else{if(!f){f=l}}}});if(!c&&f){c=f}}if(c){b.set("context",c);if(c.get("type")==="DG.GameContext"){c.set("gameSpec",b)}}}if(b&&a.currentGameFormulas){b.set("formulas",a.currentGameFormulas)}DG.gameSelectionController.setCurrentGameByName(d,h);this.set("gameIsReady",true)},logUserAction:function(b,a){DG.logUser(b+(a&&a.length?": ["+a.join(", ")+"]":""))}});DG.currGameController=DG.GameController.create({});DG.doCommand=function(b){var a;SC.run(function(){a=DG.currGameController.dispatchCommand(b)});return a};DG.BaseGameSpec=SC.Object.extend({name:null,url:null,collections:null,dimensions:{width:0,height:0},context:null,collectionName:null,parentCollectionName:null,eventsAttributeName:null,xAttrName:null,xAttrIsNumeric:true,yAttrName:null,yAttrIsNumeric:true,init:function(){arguments.callee.base.apply(this,arguments);this.collections=[]},getCollectionSpecByName:function(b){var d=this.get("collections"),c,a=d&&d.length;for(c=0;c<a;++c){if(d[c].name===b){return d[c]}}return null}});sc_require("models/base_game_spec");DG.GameSpec=DG.BaseGameSpec.extend({childCollection:function(){var c=this.get("collections"),b=(c&&c.length)||0,a=b-1;return(a>=0)?c[a]:null}.property("collections").cacheable(),parentCollection:function(){var c=this.get("collections"),b=(c&&c.length)||0,a=b-2;return(a>=0)?c[a]:null}.property("collections").cacheable(),collectionName:function(){var b=this.get("childCollection"),a=b&&b.name;return !SC.empty(a)?a:null}.property("childCollection").cacheable(),parentCollectionName:function(){var b=this.get("parentCollection"),a=b&&b.name;return !SC.empty(a)?a:null}.property("parentCollection").cacheable(),eventsAttributeName:function(){var b=this.get("parentCollection"),a=b&&b.childAttrName;if(SC.empty(a)){var c=this.get("childCollection");a=c&&c.name}return !SC.empty(a)?a:null}.property("parentCollection","childCollection").cacheable(),getAttrType:function(b,f){var c,d=b.attrs.length;for(c=0;c<d;++c){var a=b.attrs[c];if(a&&(a.name===f)){return a.type}}return null},graphDefaults:function(){var a=this.get("childCollection");return a&&a.defaults}.property("childCollection").cacheable(),xAttrName:function(){var a=this.get("graphDefaults");return a&&a.xAttr}.property("graphDefaults").cacheable(),xAttrIsNumeric:function(){var c=this.get("childCollection"),a=this.get("xAttrName"),b=this.getAttrType(c,a);return b==="numeric"}.property("childCollection","xAttrName").cacheable(),yAttrName:function(){var a=this.get("graphDefaults");return a&&a.yAttr}.property("graphDefaults").cacheable(),yAttrIsNumeric:function(){var c=this.get("childCollection"),a=this.get("yAttrName"),b=this.getAttrType(c,a);return b==="numeric"}.property("childCollection","yAttrName").cacheable(),legendAttrName:function(){var a=this.get("graphDefaults");return a&&a.legendAttr}.property("graphDefaults").cacheable(),legendAttrIsNumeric:function(){var c=this.get("childCollection"),a=this.get("legendAttrName"),b=this.getAttrType(c,a);return b==="numeric"}.property("childCollection","legendAttrName").cacheable()});sc_require("models/game_spec");DG.gameSelectionController=SC.ObjectController.create((function(){var a=0;return{baseGames:[DG.GameSpec.create({name:"Please choose an activity",dimensions:{width:300,height:20},url:""}),DG.GameSpec.create({name:"DataInteractive",dimensions:{width:650,height:550},url:"data_interactive/index"}),DG.GameSpec.create({name:"Analytics",dimensions:{width:650,height:550},url:"analytics/index"})],currentGame:null,currentName:function(){return this.getPath("currentGame.name")}.property("currentGame").cacheable(),requestedDimensions:null,currentDimensions:function(){return this.getPath("currentGame.dimensions")}.property("currentGame").cacheable(),currentUrl:function(){return this.getPath("currentGame.url")}.property("currentGame").cacheable(),currentContext:function(){return this.getPath("currentGame.context")}.property("currentGame","currentGame.context"),menuPane:null,init:function(){arguments.callee.base.apply(this,arguments);this.buildGamesMenu(DG.IS_SRRI_BUILD,DG.IS_DEV_BUILD);this.menuPane=SC.MenuPane.create({items:this.games,itemTitleKey:"name",layout:{width:200}});this.setDefaultGame()},prependToGamesMenu:function(c){var b=c.concat([DG.BaseGameSpec.create({name:null,isSeparator:true})],this.games);this.games=b;this.menuPane.set("items",b)},buildGamesMenu:function(d,c){this.games=[];if(!SC.empty(DG.urlParamGames)){var b=SC.json.decode(DG.urlParamGames);if(SC.none(b.length)){b=[b]}b.forEach(function(g){if(!SC.empty(g.name)&&!SC.empty(g.url)){var f=DG.GameSpec.create(g);if(f){this.games.push(f)}}}.bind(this));if(this.games.length>0){this.games.push(DG.BaseGameSpec.create({name:null,isSeparator:true}))}}this.games=this.games.concat(this.get("baseGames"));if(d||c){this.games=this.games.concat(this.get("srriGames"))}if(c){this.games=this.games.concat(this.get("devGames"))}},loginDidChange:function(){var b=DG.authorizationController.get("isUserDeveloper");this.buildGamesMenu(DG.IS_SRRI_BUILD||b,DG.IS_DEV_BUILD||b);this.menuPane.set("items",this.games)}.observes("DG.authorizationController.isUserDeveloper"),setDefaultGame:function(b){var c=null;if(!SC.empty(b)){c=this.findGameByName(b)}if(!c&&!SC.empty(DG.defaultGameName)){c=this.findGameByName(DG.defaultGameName)}if(!c){c=this.games[a];if(c){DG.defaultGameName=c.get("name")}}if(c){this.beginPropertyChanges();this.set("requestedDimensions",null);this.set("currentGame",c);this.endPropertyChanges()}},currentGameDidChange:function(){if(DG.currGameController){DG.currGameController.set("gameIsReady",false)}}.observes("currentGame"),gameSelected:function(g,d,f){var c=g.get(d),b=c&&c.get("name");if(c&&!SC.empty(b)){this.set("requestedDimensions",null);if(this.get("currentGame")===c){this.notifyPropertyChange("currentGame");return}this.setPath("menuPane.selectedItem",null);DG.appController.closeDocumentWithConfirmation(b)}}.observes(".menuPane.selectedItem"),setCurrentGameByName:function(d,c){var b=this.findGameByName(d);if(b){this.beginPropertyChanges();this.set("requestedDimensions",c);this.set("currentGame",b);this.menuPane.set("selectedItem",null);this.endPropertyChanges()}},saveCurrentGameState:function(){var g=this.get("currentGame"),d=g&&g.get("context"),h=g&&g.get("doCommandFunc"),c=this.findCurrentGameElement(g&&g.get("gameEmbedID")),f={operation:"saveState"},b;if(d){if(h){b=h(f)}else{if(c&&c.doCommandFunc){b=c.doCommandFunc(SC.json.encode(f));b=this.safeJsonDecode(b,"Invalid JSON found in saveCurrentGameState()")}}if(b&&b.success){d.set("savedGameState",b.state)}}},findCurrentGameElement:function(b){var g=document.getElementsByTagName("iframe"),d=null;if(b){var f,c;for(f=0,c=g.length;f<c&&!d;++f){d=g[f].contentWindow.document.getElementById(b)}}return d},safeJsonDecode:function(f,c){var b;if(SC.typeOf(f)===SC.T_STRING){try{b=SC.json.decode(f)}catch(d){DG.logWarn(c+" [DG.GameSelection.safeJsonDecode]");DG.log("JSON: "+b);b=undefined}}return b},gameViewWillClose:function(){this.menuPane.set("selectedItem",null)},reset:function(){this.games.forEach(function(b){if(b){b.set("context",null);b.set("formulas",null)}});this.menuPane.set("selectedItem",null)},findGameByName:function(b){var d=this.games.length;for(var c=0;c<d;++c){if(this.games[c].name===b){return this.games[c]}}return null},addCollectionSpecToGameSpecIfNecessary:function(b,d){var f=this.get("currentGame"),c=f&&f.get("collections");if(!SC.none(c)){c.push({name:b,attrs:d})}},processNewCollectionArgs:function(d){var b=this.get("currentGame");if(!b){return}var c=d.name,f=d.children,h=d.defaultPlotX,g=d.defaultPlotY;if(!SC.empty(c)){if(b.collections.indexOf(c)<0){b.collections.push(c)}switch(b.collections.length){case 1:if(SC.empty(b.parentCollectionName)){b.parentCollectionName=c}break;case 2:if(SC.empty(b.collectionName)){b.collectionName=c}break;default:}}if(SC.empty(b.eventsAttributeName)&&!SC.empty(f)){b.eventsAttributeName=f}if(SC.empty(b.xAttrName)&&!SC.empty(h)){b.xAttrName=h}if(SC.empty(b.yAttrName)&&!SC.empty(g)){b.yAttrName=g}}}}()));sc_require("components/game/game_controller");sc_require("controllers/game_selection");DG.GameView=SC.WebView.extend({valueBinding:"DG.gameSelectionController.currentUrl",destroy:function(){DG.gameSelectionController.gameViewWillClose();arguments.callee.base.apply(this,arguments)},iframeDidLoad:function(){var b=this.$("iframe")[0];if(b&&b.contentWindow){var a=b.contentWindow,c=DG.currGameController;$(b).attr("allowfullscreen",true).attr("webkitallowfullscreen",true).attr("mozallowfullscreen",true);a.NewCollectionWithAttributes=function(d,f){SC.run(function(){c.newCollectionWithAttributes(d,f)})};a.AddCaseToCollectionWithValues=function(f,d){SC.run(function(){c.addCaseToCollectionWithValues(f,d)})};a.LogUserAction=function(f,d){SC.run(function(){c.logUserAction(f,d)})};a.DoCommand=function(f){var d;SC.run(function(){d=c.doCommand(f)});return SC.json.encode(d)}}else{DG.logWarn("DG.GameView:iframeDidLoad no contentWindow\n")}arguments.callee.base.apply(this,arguments)}});DG.PlotAdornment=SC.Object.extend({model:null,paperSource:null,paper:function(){return this.getPath("paperSource.paper")}.property("paperSource").cacheable(),xAxisView:null,yAxisView:null,parentView:null,myElements:null,layerName:null,layer:function(){var a=this.getPath("paperSource.layerManager");return(a&&this.layerName)?a[this.layerName]:null}.property("paperSource","layerName"),modelPropertiesToObserve:[["willDestroy","detachModel"],["isVisible","updateVisibility"]],concatenatedProperties:["modelPropertiesToObserve"],init:function(){arguments.callee.base.apply(this,arguments);this.myElements=[];this.modelDidChange();this.addObserver("model",this,"modelDidChange")},detachModel:function(){this.set("model",null);this.removeObserver("model",this,"modelDidChange")},destroy:function(){var a=this.getPath("paperSource.layerManager");this.detachModel();this.myElements.forEach(function(b){a.removeElement(b);b.remove()});this.myElements=null;arguments.callee.base.apply(this,arguments)},_observedModel:null,modelDidChange:function(){var a=this.get("modelPropertiesToObserve");if(this._observedModel){if(a){a.forEach(function(c){this._observedModel.removeObserver(c[0],this,c[1])}.bind(this))}this._observedModel=null}var b=this.get("model");if(b){if(a){a.forEach(function(c){b.addObserver(c[0],this,c[1])}.bind(this))}this._observedModel=b}},updateVisibility:function(){if(this.getPath("model.isVisible")){this.updateToModel();this.myElements.forEach(function(a){a.show();if(a.animatable){a.animate({"stroke-opacity":1,opacity:1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}})}else{if(!SC.none(this.myElements)){this.myElements.forEach(function(a){if(a.animatable){a.animate({"stroke-opacity":0,opacity:0},DG.PlotUtilities.kDefaultAnimationTime,"<>",function(){a.hide()})}else{a.hide()}})}}}});sc_require("components/graph/adornments/plot_adornment");DG.ConnectingLineAdornment=DG.PlotAdornment.extend({_dataTip:null,init:function(){arguments.callee.base.apply(this,arguments);this.myElements=[];var a=this.get("parentView");DG.assert(a);this._dataTip=DG.LineDataTip.create({paperSource:this.get("paperSource"),plotView:a,layerName:DG.LayerNames.kDataTip})},wantVisible:function(){return this.getPath("model.isVisible")},invalidateModel:function(){var a=this.get("model");if(a){a.setComputingNeeded()}},updateToModel:function(a){var b=this.get("model");if(SC.none(b)){return}if(b.get("isVisible")){b.recomputeValueIfNeeded();this.updateLine(a)}else{this.hideLines()}},updateVisibility:function(){this.updateToModel(true)},hideLines:function(){var c=this.myElements.length,b=this.get("layer");for(var a=0;a<c;a++){this.myElements[a].animate({"stroke-opacity":0},DG.PlotUtilities.kDefaultAnimationTime,"<>",function(){b.prepareToMoveOrRemove(this);this.remove()})}this.myElements.length=0},updateLine:function(h){var c=this,d=this.getPath("parentView.xAxisView"),j=this.getPath("parentView.yAxisView"),i=this.getPath("model.values"),b=10,f=this.get("paper"),g=this.get("layer");if(!f){this.invokeOnceLater(function(){this.updateLine(h)}.bind(this));return}DG.assert(d&&j);if(!i){return}i.forEach(function(s,m){var o=s?s.length:0,l="M0,0",p=DG.ColorUtilities.calcAttributeColorFromIndex(m%b,b).colorString,n,r,q,k;for(n=0;n<o;++n){r=d.dataToCoordinate(s[n].x);q=j.dataToCoordinate(s[n].y);if(n===0){l="M%@,%@".fmt(r,q)}else{l+=" L%@,%@".fmt(r,q)}}DG.assert(l);k=c.myElements[m];if(!k){k=f.path("");c.myElements.push(k);g.push(k)}k.attr({path:l,"stroke-opacity":0,stroke:p,cursor:"pointer"}).mousedown(function(t){c.get("model").selectParent(m,t.shiftKey)}).hover(function(t){c.showDataTip(t,m)},function(){c.hideDataTip()});if(h){k.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}else{k.attr({"stroke-opacity":1})}});while(this.myElements.length>i.length){var a=this.myElements.pop();g.prepareToMoveOrRemove(a);a.remove()}this.updateSelection()},updateSelection:function(){if(!this.get("paper")){return}var b=this.getPath("model.values")||[],a=this.getPath("model.plotModel.selection");b.forEach(function(g,f){var k=3,d=6,l=g?g.length:0,c=true,h=this.myElements[f],j;if(h){for(j=0;j<l;++j){c=c&&a.indexOf(g[j].theCase)>=0;if(!c){break}}h.attr({"stroke-width":(c?d:k)})}}.bind(this))},showDataTip:function(i,a){if(this._dataTip){var b=this.getPath("model.parents"),c=SC.isArray(b)&&(a<b.length)?b[a]:null,g=c.getPath("collection.name"),d=c.get("children").flatten(),h=SC.isArray(d)?d.get("length"):0,f=(h>0)?d[0].getPath("collection.name"):"";this._dataTip.show({lineIndex:a+1,parentName:g,numChildren:h,childrenName:f},{x:i.offsetX,y:i.offsetY})}},hideDataTip:function(){if(this._dataTip){this._dataTip.hide()}}});DG.PlotAdornmentModel=SC.Object.extend({plotModel:null,isVisible:true,destroy:function(){this.notifyPropertyChange("willDestroy");arguments.callee.base.apply(this,arguments)},createStorage:function(){var a={};a.isVisible=this.get("isVisible")||false;return a},restoreStorage:function(a){this.set("isVisible",a.isVisible||false)}});DG.PlotAdornmentModel.registry={};sc_require("components/graph/adornments/plot_adornment_model");DG.ConnectingLineModel=DG.PlotAdornmentModel.extend({parents:null,_values:null,values:function(b,a){if(a){this._values=a}else{this.recomputeValueIfNeeded()}return this._values}.property(),isComputingNeeded:function(){return this._needsComputing&&this.isVisible},setComputingNeeded:function(){this._needsComputing=true},recomputeValueIfNeeded:function(){if(this.isComputingNeeded()){this.recomputeValue()}},recomputeValue:function(){var c=this.getPath("plotModel.cases"),b=[],a=this.getPath("plotModel.xVarID"),f=this.getPath("plotModel.yVarID");if(!(a&&f)){return}var d={};c.forEach(function(h,j){var l=h.getNumValue(a),i=h.getNumValue(f),g=h.get("parent"),k=g?g.get("id"):"top";if(isFinite(l)&&isFinite(i)){if(!d[k]){d[k]=[];b.push(g)}d[k].push({x:l,y:i,theCase:h})}});DG.ObjectMap.forEach(d,function(h,g){g.sort(function(j,i){return(j.x>i.x)?1:((i.x>j.x)?-1:((j.y>i.y)?1:((i.y>j.y)?-1:0)))})});this.set("parents",b);this._needsComputing=false;this.set("values",DG.ObjectMap.values(d))},_needsComputing:true,selectParent:function(d,f){var a=this.get("parents");if(SC.isArray(a)&&d<a.length){var b=a[d],c={operation:"selectCases",collection:b.get("collection"),cases:[b],select:true,extend:f};this.getPath("plotModel.dataContext").applyChange(c);if(c.select){DG.logUser("lineSelected: %@",d)}else{DG.logUser("lineDeselected: %@",d)}}}});DG.PlotAdornmentModel.registry.connectingLine=DG.ConnectingLineModel;DG.ToolTip=SC.Object.extend({paperSource:null,paper:function(){return this.getPath("paperSource.paper")}.property("paperSource").cacheable(),layerName:null,layer:function(){var a=this.getPath("paperSource.layerManager");return(a&&this.layerName)?a[this.layerName]:null}.property("paperSource","layerName"),text:null,tipOrigin:null,_tipTextElement:null,_tipRectElement:null,_tipShadowElement:null,updateTip:function(){var f=this.get("paper"),m=10,h=5,d=2,n,i,g=15,b,k,j,l,a,c;k=this.tipOrigin.x;j=this.tipOrigin.y;this._tipTextElement.attr({text:this.get("text")});l=DG.RenderingUtilities.getExtentForTextElement(this._tipTextElement,12);a=l.width+10;c=l.height+10;b=c/2+5;n=m+a+d;i=h+d;if(k+n>f.width){k-=(k+n)-f.width}if(j+i+c>f.height){j-=i+c}this._tipTextElement.attr({x:k+g,y:j+b});this._tipShadowElement.attr({path:"M"+(k+n)+" "+(j+i)+" v"+c+" h-"+a});this._tipRectElement.attr({x:k+m,y:j+h,width:a,height:c})},show:function(){var a=this.get("paper"),b=this.get("layer");this.hide();this._tipTextElement=a.text(0,0,"").attr({"text-anchor":"start",opacity:0}).addClass(DG.PlotUtilities.kToolTipTextClassName);this._tipShadowElement=a.path("").addClass(DG.PlotUtilities.kToolTipShadowClassName).attr("stroke-opacity",0);this._tipRectElement=a.rect(0,0,0,0).addClass(DG.PlotUtilities.kToolTipClassName).attr("opacity",0);this.updateTip();b.push(this._tipShadowElement);b.push(this._tipRectElement);b.push(this._tipTextElement);this._tipRectElement.animate({opacity:0.7},DG.PlotUtilities.kToolTipShowTime,"<>");this._tipTextElement.animate({opacity:1},DG.PlotUtilities.kToolTipShowTime,"<>");this._tipShadowElement.animate({"stroke-opacity":0.7},DG.PlotUtilities.kToolTipShowTime,"<>")},hide:function(){var a=this.get("layer");[this._tipShadowElement,this._tipRectElement,this._tipTextElement].forEach(function(b){if(b){a.prepareToMoveOrRemove(b);b.remove()}})}});sc_require("utilities/tool_tip");DG.DataTip=DG.ToolTip.extend({plotLayer:null,plotBinding:".plotLayer.model",caseIndex:null,text:function(){return this.getDataTipText()}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.set("paperSource",this.get("plotLayer"))},show:function(a,c,b){this.set("caseIndex",b);arguments.callee.base.apply(this,arguments)},getDataTipText:function(){return""},handleChanges:function(b){var a=(SC.typeOf(b)===SC.T_NUMBER?SC.IndexSet.create(b):b);if(SC.none(this._myElements)||(this._myElements.length===0)||!(a.contains(this.get("caseIndex")))){return}this.updateTip()}});sc_require("components/graph/adornments/data_tip");DG.LineDataTip=DG.DataTip.extend({info:null,getDataTipText:function(){var a="";if(this.info){a="DG.DataTip.connectingLine".loc(this.info.parentName,this.info.lineIndex,this.info.numChildren,this.info.childrenName)}return a},show:function(b,a){this.info={};this.tipOrigin={};DG.ObjectMap.copy(this.info,b);DG.ObjectMap.copy(this.tipOrigin,a);arguments.callee.base.apply(this,arguments)}});DG.LineLabelMixin={textElement:null,createTextElement:function(){this.textElement=this.get("paper").text(0,0,"").attr({font:"caption","text-anchor":"start",opacity:0});return this.textElement},updateTextToModel:function(i){if(this.myElements===null){this.createElements()}var d=5,l=this.get("valueAxisView"),a=this.get("value"),b=l.dataToCoordinate(a),g=this.get("paper"),f=this.get("valueString"),c=this.get("textElement"),h,k,j={};c.attr({text:f});h=c.getBBox();if(l.get("orientation")==="horizontal"){k=c.attr("text-anchor");j.y=i*g.height;switch(k){case"start":if(h.width+d<g.width-b){j.x=b+d}else{if(h.width+d<b){j.x=b-d;k="end"}else{j.x=d}}break;case"end":if(h.width+d<b){j.x=b-d}else{if(h.width+d<g.width-b){j.x=b+d;k="start"}else{j.x=g.width-d}}break}}else{j.y=b;j.x=g.width/2;k="middle";if(h.height>b){j.y+=h.height/2}else{j.y-=h.height/2}}c.attr({x:j.x,y:j.y,"text-anchor":k})}};sc_require("components/graph/adornments/plot_adornment");DG.MovableLineAdornment=DG.PlotAdornment.extend({kLineSlideCur:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LineSlide.cur",8,8),kLineBotLeft:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LinePivotBotLeft.cur",5,12),kLineBotRight:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LinePivotBotRight.cur",12,12),kLineTopLeft:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LinePivotTopLeft.cur",5,5),kLineTopRight:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LinePivotTopRight.cur",12,5),lineSeg:null,firstSegHit:null,secondSegHit:null,thirdSegHit:null,equation:null,pivot1:null,pivot2:null,modelPropertiesToObserve:[["slope","updateToModel"],["intercept","updateToModel"],["isVertical","updateToModel"],["xIntercept","updateToModel"]],equationString:function(){var c=this;function a(){var i=c.getPath("model.intercept"),o=c.getPath("model.slope"),f=DG.PlotUtilities.findNeededFractionDigits(o,i,c.get("xAxisView"),c.get("yAxisView")),k=pv.Format.number().fractionDigits(0,f.interceptDigits),d=k(i),g=pv.Format.number().fractionDigits(0,f.slopeDigits),m=g(o)+" ",h=(i<0)?" ":" + ",j=c.getPath("yAxisView.model.firstAttributeName"),n=c.getPath("xAxisView.model.firstAttributeName"),l;if(d==="0"){d=h=""}if(m==="1 "){m=""}if(m==="0 "){l="";h=""}else{l=m+n}return j+" = "+l+h+d}function b(){var f=DG.PlotUtilities.findFractionDigitsForAxis(c.get("xAxisView")),g=c.getPath("model.xIntercept"),d=c.getPath("xAxisView.model.label");return d+" = "+pv.Format.number().fractionDigits(0,f)(g)}if(this.getPath("model.isVertical")){return b()}else{return a()}}.property("model.intercept","model.slope","model.isVertical","model.xIntercept","xAxisView.model.firstAttributeName","yAxisView.model.firstAttributeName").cacheable(),createElements:function(){var f=this,l=this.get("xAxisView"),a=this.get("yAxisView"),p,g,r=false;function h(){var u=f.get("equationString");u=u.replace(/\u2212/g,"-");DG.logUser("dragMovableLine: '%@'",u)}function n(){var u={stroke:DG.PlotUtilities.kLineHighlightColor};f.firstSegHit.stop();f.secondSegHit.stop();f.thirdSegHit.stop();f.firstSegHit.animate(u,DG.PlotUtilities.kHighlightShowTime);f.secondSegHit.animate(u,DG.PlotUtilities.kHighlightShowTime);f.thirdSegHit.animate(u,DG.PlotUtilities.kHighlightShowTime)}function j(){var u={stroke:DG.RenderingUtilities.kSeeThrough};if(!r){f.firstSegHit.stop();f.secondSegHit.stop();f.thirdSegHit.stop();f.firstSegHit.animate(u,DG.PlotUtilities.kHighlightHideTime);f.secondSegHit.animate(u,DG.PlotUtilities.kHighlightHideTime);f.thirdSegHit.animate(u,DG.PlotUtilities.kHighlightHideTime)}}function d(w,v){var u={slope:f.getPath("model.slope"),intercept:f.getPath("model.intercept")};p=DG.ViewUtilities.windowToViewCoordinates({x:w,y:v},f.parentView);if(f.getPath("model.isVertical")){p.x=l.dataToCoordinate(f.getPath("model.xIntercept"))}else{p=DG.PlotUtilities.closestScreenPtGivenScreenPtAndWorldLine(p,u,l,a)}g=f.getPath("model.isInterceptLocked");n();r=true}function i(v,u){f.get("model").forceThroughPoint({x:l.coordinateToData(p.x+v),y:a.coordinateToData(p.y+u)})}function t(v,u){f.pivot1=f.pivot2=null;f.updateToModel();h();r=false;j()}function m(v,u){d(v,u)}function q(y,w,u,x){var v=2;if(Math.abs(u.x-x.x)<v){y.x=w.x}else{if(Math.abs(u.y-x.y)<v){y.y=w.y}}f.get("model").forceThroughPoints(f.pivot1,f.pivot2)}function c(x,v){var w={x:p.x+x,y:p.y+v},u={x:l.dataToCoordinate(f.pivot2.x),y:a.dataToCoordinate(f.pivot2.y)};f.pivot1.x=l.coordinateToData(w.x);f.pivot1.y=a.coordinateToData(w.y);if(g){f.get("model").forceThroughOriginAndPoint(f.pivot1)}else{q(f.pivot1,f.pivot2,w,u)}}function b(x,v){var w={x:p.x+x,y:p.y+v},u={x:l.dataToCoordinate(f.pivot1.x),y:a.dataToCoordinate(f.pivot1.y)};f.pivot2.x=l.coordinateToData(w.x);f.pivot2.y=a.coordinateToData(w.y);if(g){f.get("model").forceThroughOriginAndPoint(f.pivot2)}else{q(f.pivot2,f.pivot1,w,u)}}function o(w,v){if(f.pivot1.x>f.pivot2.x){var u=f.pivot1;f.pivot1=f.pivot2;f.pivot2=u}h();r=false;j()}if(this.myElements&&(this.myElements.length>0)){return}var s=this.get("paper"),k=this.get("layer");this.lineSeg=s.line(0,0,0,0).attr({stroke:DG.PlotUtilities.kDefaultMovableLineColor,"stroke-opacity":0});this.lineSeg.animatable=true;this.equation=s.text(0,0,"").attr({font:"caption",opacity:0});this.equation.animatable=true;this.firstSegHit=this.lineSeg.clone().attr({"stroke-width":12,stroke:DG.RenderingUtilities.kSeeThrough}).hover(n,j).drag(c,m,o);this.secondSegHit=this.firstSegHit.clone().attr({cursor:this.kLineSlideCur}).hover(n,j).drag(i,d,t);this.thirdSegHit=this.firstSegHit.clone().hover(n,j).drag(b,m,o);this.lineSeg.node.setAttribute("shape-rendering","geometric-precision");this.myElements=[this.lineSeg,this.equation,this.firstSegHit,this.secondSegHit,this.thirdSegHit];this.myElements.forEach(function(u){k.push(u)});return this.myElements},updateToModel:function(){if(this.myElements===null){this.createElements()}var k=this.get("xAxisView"),a=this.get("yAxisView"),n=this.get("model"),t=n.get("slope"),g=n.get("isInterceptLocked"),u=n.get("intercept"),l=k.getPath("model.lowerBound"),p=k.getPath("model.upperBound"),q=a.getPath("model.lowerBound"),v=a.getPath("model.upperBound"),j=(n.get("isVertical"))?{pt1:{x:n.get("xIntercept"),y:q},pt2:{x:n.get("xIntercept"),y:v}}:DG.PlotUtilities.lineToAxisIntercepts(t,u,k.get("model"),a.get("model"));function b(w){return{x:k.dataToCoordinate(w.x),y:a.dataToCoordinate(w.y)}}function h(){var w=j.pt1;j.pt1=j.pt2;j.pt2=w}if(j.pt2.x<j.pt1.x){h()}var r=b({x:(j.pt1.x+j.pt2.x)/2,y:(j.pt1.y+j.pt2.y)/2}),s=this.get("paper").width,c=this.get("paper").height,o,m,i,d,f;if(g){if((l<=0)&&(p>=0)&&(q<=0)&&(v>=0)){o={x:0,y:0};m=o}else{if(t>=0){if((v<0)||(p<0)){o=m=j.pt2}else{o=m=j.pt1}}else{if((q>0)||(p<0)){o=m=j.pt2}else{o=m=j.pt1}}}}else{o={x:j.pt1.x+(3/8)*(j.pt2.x-j.pt1.x),y:j.pt1.y+(3/8)*(j.pt2.y-j.pt1.y)};m={x:j.pt1.x+(5/8)*(j.pt2.x-j.pt1.x),y:j.pt1.y+(5/8)*(j.pt2.y-j.pt1.y)}}if(SC.none(this.pivot1)||!DG.MathUtilities.isInRange(this.pivot1.x,l,p)||!DG.MathUtilities.isInRange(this.pivot1.y,q,v)){this.pivot1=j.pt1}if(SC.none(this.pivot2)||!DG.MathUtilities.isInRange(this.pivot2.x,l,p)||!DG.MathUtilities.isInRange(this.pivot2.y,q,v)){this.pivot2=j.pt2}DG.RenderingUtilities.updateLine(this.lineSeg,b(j.pt1),b(j.pt2));DG.RenderingUtilities.updateLine(this.firstSegHit,b(j.pt1),b(o));DG.RenderingUtilities.updateLine(this.secondSegHit,b(o),b(m));DG.RenderingUtilities.updateLine(this.thirdSegHit,b(m),b(j.pt2));if(t>0){this.firstSegHit.attr({cursor:this.kLineBotLeft});this.thirdSegHit.attr({cursor:this.kLineTopRight})}else{this.firstSegHit.attr({cursor:this.kLineTopLeft});this.thirdSegHit.attr({cursor:this.kLineBotRight})}i=this.equation.attr({text:this.get("equationString")}).getBBox();d=i.width;d+=10;if(r.x<s/2){f="start";r.x=Math.min(r.x,s-d)}else{f="end";r.x=Math.max(r.x,d)}r.y+=i.height/2;r.y=Math.min(Math.max(r.y,i.height/2),c-i.height/2);this.equation.attr({x:r.x,y:r.y,"text-anchor":f,text:this.get("equationString")})},updateVisibility:function(){if(this.getPath("model.isVisible")){this.pivot1=this.pivot2=null}arguments.callee.base.apply(this,arguments)}});sc_require("components/graph/adornments/plot_adornment_model");DG.MovableLineModel=DG.PlotAdornmentModel.extend({slope:null,intercept:null,isVertical:false,xIntercept:null,isInterceptLocked:function(b,a){if(a!==undefined){this._interceptLocked=a;if(a){this.set("intercept",0)}}return this._interceptLocked}.property(),isComputingNeeded:function(b,a){if(this._needsComputing){return true}if(this.isVertical){this._needsComputing=(this.xIntercept<b.get("lowerBound"))||(this.xIntercept>b.get("upperBound"))}else{this._needsComputing=!DG.PlotUtilities.lineIntersectsPlotArea(this.slope,this.intercept,b,a)}return this._needsComputing},recomputeSlopeAndIntercept:function(g,c){var b=g.get("lowerBound"),f=g.get("upperBound"),a=c.get("lowerBound"),d=c.get("upperBound");f=b+(f-b)/2;if(!this.get("isInterceptLocked")){this.beginPropertyChanges();this.set("slope",(d-a)/(f-b));this.set("intercept",a-this.slope*b);this.set("isVertical",false);this.set("xIntercept",null);this.endPropertyChanges()}else{this.forceThroughOriginAndPoint({x:f,y:(d+a)/2})}this._needsComputing=false},recomputeSlopeAndInterceptIfNeeded:function(b,a){if(this.isComputingNeeded(b,a)){this.recomputeSlopeAndIntercept(b,a)}},toggleInterceptLocked:function(){this.set("isInterceptLocked",!this._interceptLocked)},forceThroughPoint:function(b){if(this.isVertical){this.set("xIntercept",b.x)}else{var a=this.get("slope"),c=b.y-a*b.x;this.set("intercept",c)}},forceThroughPoints:function(c,b){if(c.x===b.x){this.beginPropertyChanges();this.set("isVertical",true);this.set("xIntercept",c.x);this.set("slope",null);this.set("intercept",null);this.endPropertyChanges()}else{var a=(b.y-c.y)/(b.x-c.x);this.beginPropertyChanges();this.set("slope",a);this.set("intercept",c.y-a*c.x);this.set("isVertical",false);this.set("xIntercept",null);this.endPropertyChanges()}},forceThroughOriginAndPoint:function(a){this.forceThroughPoints(a,{x:0,y:0})},_needsComputing:null,_interceptLocked:null,init:function(){arguments.callee.base.apply(this,arguments);this.slope=1;this.intercept=0;this.isVertical=false;this.xIntercept=null;this._interceptLocked=false;this._needsComputing=true},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);DG.ObjectMap.copy(a,{intercept:this.get("intercept"),slope:this.get("slope"),isInterceptLocked:this.get("isInterceptLocked"),isVertical:this.get("isVertical"),xIntercept:this.get("xIntercept")});return a},restoreStorage:function(a){arguments.callee.base.apply(this,arguments);this.set("intercept",a.intercept);this.set("slope",a.slope);this.set("isInterceptLocked",a.isInterceptLocked);this.set("isVertical",a.isVertical);this.set("xIntercept",a.xIntercept)}});DG.ValueAxisViewMixin={valueAxisView:null,_observedAxisModel:null,_observedAxisView:null,initMixin:function(){this.axisViewDidChange();this.addObserver("valueAxisView",this,"axisViewDidChange")},destroyMixin:function(){this.set("valueAxisView",null);this.removeObserver("valueAxisView",this,"axisViewDidChange")},axisModelDidChange:function(){if(this._observedAxisModel){this._observedAxisModel.removeObserver("lowerBound",this,"updateToModel");this._observedAxisModel.removeObserver("upperBound",this,"updateToModel");this._observedAxisModel=null}var a=this.getPath("valueAxisView.model");if(a){a.addObserver("lowerBound",this,"updateToModel");a.addObserver("upperBound",this,"updateToModel");this._observedAxisModel=a}},axisViewDidChange:function(){if(this._observedAxisView){this._observedAxisView.removeObserver("model",this,"axisModelDidChange");this._observedAxisView.removeObserver("pixelMin",this,"updateToModel");this._observedAxisView.removeObserver("pixelMax",this,"updateToModel");this._observedAxisView=null}this.axisModelDidChange();var a=this.get("valueAxisView");if(a){a.addObserver("model",this,"axisModelDidChange");a.addObserver("pixelMin",this,"updateToModel");a.addObserver("pixelMax",this,"updateToModel");this._observedAxisView=a}},updateToModel:function(){}};sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/line_label_mixin");sc_require("components/graph/adornments/value_axis_view_mixin");DG.MovableValueAdornment=DG.PlotAdornment.extend(DG.LineLabelMixin,DG.ValueAxisViewMixin,{kLineSlideHCur:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LineSlideH.cur",8,8),kLineSlideVCur:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LineSlide.cur",8,8),lineSeg:null,coverSeg:null,value:function(){return this.getPath("model.value")}.property("model.value"),valueString:function(){var d=this.get("value"),a=DG.PlotUtilities.findFractionDigitsForAxis(this.get("valueAxisView")),c=pv.Format.number().fractionDigits(0,a),b=this.getPath("valueAxisView.model.firstAttributeName");return b+" = "+c(d)}.property("model.value","valueAxisView.model.firstAttributeName").cacheable(),modelPropertiesToObserve:[["value","updateToModel"]],createElements:function(){var d=this,j=this.get("layer"),b;function g(m,l){var n=DG.ViewUtilities.windowToViewCoordinates({x:m,y:l},d.parentView);b=(d.getPath("valueAxisView.orientation")==="horizontal")?n.x:n.y}function i(p,o){var m=d.get("valueAxisView"),l=(m.get("orientation")==="horizontal")?p:o,n=m.coordinateToData(b+l);d.setPath("model.value",n)}function a(m,l){DG.logUser("dragMovableValue: '%@'",d.get("valueString"))}function c(){var l={stroke:DG.PlotUtilities.kLineHighlightColor};d.coverSeg.stop();d.coverSeg.animate(l,DG.PlotUtilities.kHighlightShowTime)}function k(){var l={stroke:DG.RenderingUtilities.kSeeThrough};d.coverSeg.stop();d.coverSeg.animate(l,DG.PlotUtilities.kHighlightHideTime)}if(this.myElements&&(this.myElements.length>0)){return}var f=this.get("paper"),h=(this.getPath("valueAxisView.orientation")==="horizontal")?this.kLineSlideHCur:this.kLineSlideVCur;this.lineSeg=f.line(0,0,0,0).attr({stroke:DG.PlotUtilities.kDefaultMovableLineColor,"stroke-opacity":0});this.coverSeg=this.lineSeg.clone().attr({"stroke-width":5,stroke:DG.RenderingUtilities.kSeeThrough,cursor:h,title:"Drag the value"}).hover(c,k).drag(i,g,a);this.myElements=[this.lineSeg,this.coverSeg];this.myElements.push(this.createTextElement());this.lineSeg.animatable=true;this.textElement.animatable=true;this.lineSeg.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>");this.textElement.animate({opacity:1},DG.PlotUtilities.kDefaultAnimationTime,"<>");this.myElements.forEach(function(l){j.push(l)})},updateToModel:function(){if(this.myElements===null){this.createElements()}var c=this.get("valueAxisView"),g=this.getPath("model.value"),b=c&&c.dataToCoordinate(g),a=this.get("paper"),f,d;if(!c){return}if(this.getPath("model.isVisible")){if(c.get("orientation")==="horizontal"){f={x:b,y:a.height};d={x:b,y:0}}else{f={x:0,y:b};d={x:a.width,y:b}}DG.RenderingUtilities.updateLine(this.lineSeg,f,d);DG.RenderingUtilities.updateLine(this.coverSeg,f,d);this.updateTextToModel(1/3)}}});sc_require("components/graph/adornments/plot_adornment_model");DG.MovableValueModel=DG.PlotAdornmentModel.extend({value:1,_needsComputing:true,isComputingNeeded:function(a){if(this._needsComputing){return true}this._needsComputing=(this.value<a.get("lowerBound"))||(this.value>a.get("upperBound"));return this._needsComputing},setComputingNeeded:function(){this._needsComputing=true},recomputeValue:function(b){var a=b.get("lowerBound"),c=b.get("upperBound");this.set("value",a+(c-a)/3);this._needsComputing=false},recomputeValueIfNeeded:function(a){if(this.isComputingNeeded(a)){this.recomputeValue(a)}},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);if(this.get("isVisible")){a.value=this.get("value")}return a},restoreStorage:function(a){arguments.callee.base.apply(this,arguments);if(a&&a.value){this.set("value",a.value)}}});DG.PlotAdornmentModel.registry.movableValue=DG.MovableValueModel;sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/line_label_mixin");DG.PlottedAverageLogString="";DG.PlottedAverageAdornment=DG.PlotAdornment.extend(DG.LineLabelMixin,{cellGap:2,hoverWidth:5,hoverDelay:10,symSize:3,symStrokeWidth:1,bgStroke:"black",bgFill:"gray",bgStrokeWidth:0.5,titlePrecision:2,titleFraction:1/5,shadingLayerName:"",shadingLayer:function(){var a=this.getPath("paperSource.layerManager");return(a&&this.layerName)?a[this.shadingLayerName]:null}.property("paperSource","shadingLayerName"),wantVisible:function(){return this.getPath("model.isVisible")},updateToModel:function(b){var a=this.get("model");if(a&&a.get("isVisible")){if(!this.textElement){this.createTextElement();this.textElement.attr("opacity",1)}a.recomputeValueIfNeeded();this.updateSymbols(b)}},updateTextElement:function(b,d,c,f,a){DG.assert(this.textElement);if(b&&DG.isFinite(d)){this.value=c;this.valueString=this.titleString(d);this.valueAxisView=this.getPath("parentView.primaryAxisView");this.updateTextToModel(f);this.textElement.show();this.textShowingForID=a}else{this.valueString="";this.valueAxisView=null;this.textElement.hide();this.textShowingForID=undefined}},updateHoverLog:function(a){if(a!==DG.PlottedAverageLogString){DG.PlottedAverageLogString=a;DG.logUser("%@: %@","hoverOverGraphLine",DG.PlottedAverageLogString)}},getTextPositionOnAxis:function(a,b){return a},updateSymbols:function(d){var z=this,m=this.get("layer"),y=this.get("shadingLayer"),n=this.getPath("parentView.primaryAxisView"),b=this.getPath("parentView.secondaryAxisView"),o=n&&(n.get("orientation")==="horizontal"),v=this.getPath("model.values"),k=v&&v.length,A=this.myElements.length;DG.assert(k>0);var B=this.get("paper"),c=(k?(Math.abs(b.get("pixelMax")-b.get("pixelMin"))/k):0),q={x:0,y:0,symSize:this.symSize,cellHeight:c-this.cellGap},w=-3*this.symSize;var g,u,t,j,s;var a,h,x,f=3;function r(){var i={stroke:z.hoverColor};this.stop();this.animate(i,z.hoverDelay);if(this.textStatValue!==z.value){z.updateHoverLog(z.statisticKey+"="+this.textStatValue)}z.updateTextElement(true,this.textStatValue,this.textAxisPosition,this.textCrossPosition,this.id)}function l(){var i={stroke:DG.RenderingUtilities.kTransparent};this.stop();this.animate(i,DG.PlotUtilities.kHighlightHideTime);z.updateTextElement(false)}for(t=0;t<k;++t){s=v[t][this.statisticKey];g=v[t][this.centerKey];j=v[t][this.spreadKey];u=(isFinite(g)?n.dataToCoordinate(g):w);q.width=(isFinite(j)?Math.abs(n.dataToCoordinate(g+j)-u):0);q.x=(o?u:t*c);q.y=(o?(t+1)*c:u);if(t*f>=A){x=B.path("M0,0").attr({stroke:this.bgStroke,"stroke-width":this.bgStrokeWidth,fill:this.bgFill,"fill-opacity":0.5});a=B.path("M0,0").attr({stroke:this.symStroke,"stroke-width":this.symStrokeWidth,"stroke-opacity":0});h=B.path("M0,0").attr({"stroke-width":this.hoverWidth,stroke:DG.RenderingUtilities.kTransparent}).hover(r,l);x.animatable=a.animatable=true;x.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>");a.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>");this.myElements.push(x);this.myElements.push(a);this.myElements.push(h);y.push(x);m.push(a);m.push(h)}x=this.myElements[t*f];a=this.myElements[t*f+1];h=this.myElements[t*f+2];if(d){x.animate({path:this.backgroundPath(q,o)},DG.PlotUtilities.kDefaultAnimationTime,"<>");a.animate({path:this.symbolPath(q,o)},DG.PlotUtilities.kDefaultAnimationTime,"<>")}else{x.attr({path:this.backgroundPath(q,o)});a.attr({path:this.symbolPath(q,o)})}h.attr("path",this.coverPath(q,o));h.textStatValue=s;h.textAxisPosition=this.getTextPositionOnAxis(g,j);h.textCrossPosition=((1/k)*(t+this.titleFraction));a.toFront();h.toFront();if(this.textElement){this.textElement.toFront()}if(this.textShowingForID===h.id){this.updateTextElement(true,h.textStatValue,h.textAxisPosition,h.textCrossPosition,h.id)}}if(this.myElements.length>(f*k)){this.removeExtraSymbols(f*k)}DG.assert(this.myElements.length===f*v.length)},removeExtraSymbols:function(d){var f=this.get("layer"),g=this.get("shadingLayer"),c,b,a;for(c=d,b=this.myElements.length;c<b;++c){a=this.myElements[c];f.prepareToMoveOrRemove(a);g.prepareToMoveOrRemove(a);a.remove()}this.myElements.length=d},symbolPath:function(b,a){if(a){return"M%@,%@ v%@".fmt(b.x,b.y,-(b.cellHeight))}else{return"M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight)}},coverPath:function(b,a){if(a){return"M%@,%@ v%@".fmt(b.x,b.y,-(b.cellHeight))}else{return"M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight)}},backgroundPath:function(b,a){return"M0,0"},titleString:function(b){DG.assert(isFinite(b));var a=this.titlePrecision+(this.get("model.precision")||0);return this.titleResource.loc(b.toFixed(a))}});DG.PlottedMeanAdornment=DG.PlottedAverageAdornment.extend({statisticKey:"mean",centerKey:"mean",titleResource:"DG.PlottedAverageAdornment.meanValueTitle",hoverColor:"rgba(0, 0, 255, 0.3)",symStroke:"#00F",symStrokeWidth:1.5});DG.PlottedMedianAdornment=DG.PlottedAverageAdornment.extend({statisticKey:"median",centerKey:"median",titleResource:"DG.PlottedAverageAdornment.medianValueTitle",hoverColor:"rgba(255, 0, 0, 0.3)",symStroke:"#F00",symStrokeWidth:1.5});DG.PlottedStDevAdornment=DG.PlottedAverageAdornment.extend({bgFill:"#9980FF",bgStroke:"#9980FF",bgStrokeWidth:0.5,symStrokeWidth:1,symStroke:"#30F",statisticKey:"stdev",centerKey:"stDevMinus1",spreadKey:"stdev",titleResource:"DG.PlottedAverageAdornment.stDevValueTitle",symHeight:0.6,hoverColor:"rgba(48, 0, 255, 0.3)",symbolPath:function(b,a){if(a){return"M%@,%@ v%@ M%@,%@ v%@".fmt(b.x,b.y,-b.cellHeight,b.x+2*b.width,b.y,-b.cellHeight)}else{return"M%@,%@ h%@ M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight,b.x,b.y-2*b.width,b.cellHeight)}},backgroundPath:function(f,c){var a=f.x,g=f.y,b=f.width,d=f.cellHeight;if(c){return"M%@,%@ v%@ h%@ v%@ z M%@,%@ v%@".fmt(a,g,-d,2*b,d,a+b,g,-d)}else{return"M%@,%@ h%@ v%@ h%@ z M%@,%@ h%@".fmt(a,g,d,-2*b,-d,a,g-b,d)}},coverPath:function(b,a){return this.symbolPath(b,a)},getTextPositionOnAxis:function(a,b){return a+2*b}});DG.PlottedIQRAdornment=DG.PlottedAverageAdornment.extend({statisticKey:"IQR",centerKey:"Q1",spreadKey:"IQR",titleResource:"DG.PlottedAverageAdornment.iqrValueTitle",hoverColor:"rgba(255, 48, 0, 0.3)",bgStroke:"#FFb280",bgStrokeWidth:0.5,bgFill:"#FFb280",symStroke:"#F30",symStrokeWidth:1,symbolPath:function(b,a){if(a){return"M%@,%@ v%@ M%@,%@ v%@".fmt(b.x,b.y,-b.cellHeight,b.x+b.width,b.y,-b.cellHeight)}else{return"M%@,%@ h%@ M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight,b.x,b.y-b.width,b.cellHeight)}},coverPath:function(b,a){if(a){return"M%@,%@ v%@ M%@,%@ v%@".fmt(b.x,b.y,-b.cellHeight,b.x+b.width,b.y,-b.cellHeight)}else{return"M%@,%@ h%@ M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight,b.x,b.y-b.width,b.cellHeight)}},backgroundPath:function(b,a){if(a){return"M%@,%@ v%@ h%@ v%@ z".fmt(b.x,b.y,-b.cellHeight,b.width,b.cellHeight)}else{return"M%@,%@ h%@ v%@ h%@ z".fmt(b.x,b.y,b.cellHeight,-b.width,-b.cellHeight)}},getTextPositionOnAxis:function(a,b){return a+b}});sc_require("components/graph/adornments/plot_adornment_model");DG.PlottedAverageModel=DG.PlotAdornmentModel.extend({values:null,precision:0,isComputingNeeded:function(){return this._needsComputing&&this.isVisible},setComputingNeeded:function(){this._needsComputing=true},recomputeValueIfNeeded:function(){if(this.isComputingNeeded()){this.recomputeValue()}},recomputeValue:function(){},_needsComputing:true});DG.PlottedMeanStDevModel=DG.PlottedAverageModel.extend({computeSumCountMean:function(){var b=this.getPath("plotModel.cases"),k=this.getPath("plotModel.primaryVarID"),f=this.getPath("plotModel.primaryAxisModel"),g=this.getPath("plotModel.secondaryVarID"),h=this.getPath("plotModel.secondaryAxisModel");if(!(h&&f)){return null}var l=h.get("numberOfCells");var a=[];var d,c;for(d=0,c=l;d<c;++d){a.push({sum:0,sumOfSquares:0,count:0,mean:undefined,stdev:undefined})}b.forEach(function(m,n){var p=m.getNumValue(k),j=m.getStrValue(g),i=h.cellNameToCellNumber(j);if(i!==null&&DG.MathUtilities.isInIntegerRange(i,0,a.length)){var o=a[i];if(isFinite(p)){o.sum+=p;o.sumOfSquares+=(p*p);o.count+=1}}});a.forEach(function(i){if(i.count>0){i.mean=i.sum/i.count}});return a}});DG.PlottedMeanModel=DG.PlottedMeanStDevModel.extend({recomputeValue:function(){var b=this.computeSumCountMean();if(b){var a=this.getPath("plotModel.primaryAxisModel");this.set("precision",a.getPath("attributeDescription.attribute.precision"));this.set("values",b);this._needsComputing=false}}});DG.PlotAdornmentModel.registry.plottedMean=DG.PlottedMeanModel;DG.PlottedStDevModel=DG.PlottedMeanStDevModel.extend({recomputeValue:function(){var b=this.computeSumCountMean();b.forEach(function(c){if(c.count>0){c.stdev=Math.sqrt((c.sumOfSquares/c.count)-(c.mean*c.mean));c.stDevMinus1=c.mean-c.stdev}});if(b){var a=this.getPath("plotModel.primaryAxisModel");this.set("precision",a.getPath("attributeDescription.attribute.precision"));this.set("values",b);this._needsComputing=false}}});DG.PlotAdornmentModel.registry.plottedStDev=DG.PlottedStDevModel;DG.PlottedQuantileModel=DG.PlottedAverageModel.extend({collectCellValsAndMedian:function(){var h=this.getPath("plotModel.cases"),f=this.getPath("plotModel.primaryVarID"),g=this.getPath("plotModel.secondaryVarID"),d=this.getPath("plotModel.secondaryAxisModel");if(!d){return}var b=d.get("numberOfCells"),k=[],c,a;for(c=0,a=b;c<a;++c){k.push({vals:[],median:undefined})}h.forEach(function(l,m){var o=l.getNumValue(f),j=l.getStrValue(g),i=d.cellNameToCellNumber(j);if(i!==null&&DG.MathUtilities.isInIntegerRange(i,0,k.length)){var n=k[i];if(isFinite(o)){n.vals.push(o)}}});k.forEach(function(i){if(i.vals.length>0){i.median=DG.MathUtilities.medianOfNumericArray(i.vals)}});return k}});DG.PlottedMedianModel=DG.PlottedQuantileModel.extend({recomputeValue:function(){var a=this.collectCellValsAndMedian();this.set("values",a);this._needsComputing=false}});DG.PlotAdornmentModel.registry.plottedMedian=DG.PlottedMedianModel;DG.PlottedIQRModel=DG.PlottedQuantileModel.extend({recomputeValue:function(){var a=this.collectCellValsAndMedian();a.forEach(function(b){if(b.vals.length>0){b.Q1=DG.MathUtilities.quantileOfSortedArray(b.vals,0.25);b.Q3=DG.MathUtilities.quantileOfSortedArray(b.vals,0.75);b.IQR=(b.Q3-b.Q1)}});this.set("values",a);this._needsComputing=false}});DG.PlotAdornmentModel.registry.plottedIQR=DG.PlottedIQRModel;sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/value_axis_view_mixin");DG.PlottedCountAdornment=DG.PlotAdornment.extend(DG.ValueAxisViewMixin,{marginX:10,marginY:15,textColor:"#315B7D",numCellsOnX:1,numCellsOnY:1,numCellsOnSecondary:1,xIsPrimaryAxis:true,modelPropertiesToObserve:[["values","updateToModel"]],wantVisible:function(){return this.getPath("model.isVisible")},updateToModel:function(a){var b=this.get("model");if(b&&b.get("isVisible")){b.recomputeValueIfNeeded();this.updateSymbols(a)}},updateSymbols:function(s){var g=this.getPath("model.values"),n=g.length,m=this.myElements.length;this.updateNumCells();if(n!==(this.numCellsOnX*this.numCellsOnY)){if(n>0){DG.logWarn("DG.PlottedCountAdornment.updateSymbols has mismatch of %@ values and %@ cells",n,(this.numCellsOnX*this.numCellsOnY))}this.removeExtraSymbols(0);return}var o=this.get("paper"),q=this.get("layer"),f=(this.numCellsOnY?o.height/this.numCellsOnY:o.height),j=(this.numCellsOnX?o.width/this.numCellsOnX:o.width);var c,d,a,b,l;for(l=0;l<n;++l){var k=Math.floor(l/this.numCellsOnSecondary),h=l%this.numCellsOnSecondary,r=(this.xIsPrimaryAxis?k:h),p=(this.xIsPrimaryAxis?h:k);b=(l>=m);c=g[l];DG.assert(c.primaryCell===k&&c.secondaryCell===h,"unexpected cell arrangement");d={x:((r+1)*j)-this.marginX,y:this.marginY+(p*f),text:c.count.toString(),title:this.getTitle(c.count,c.percent)};if(b){a=o.text(d.x,d.y,d.text);a.attr({title:d.title,"text-anchor":"end",fill:this.textColor});this.myElements.push(a);q.push(a);a.attr({opacity:0}).animate({opacity:1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}else{a=this.myElements[l];a.attr(d)}}if(n<this.myElements.length){this.removeExtraSymbols(n)}DG.assert(this.myElements.length===g.length)},removeExtraSymbols:function(d){var f=this.get("layer"),c,b,a;for(c=d,b=this.myElements.length;c<b;++c){a=this.myElements[c];f.prepareToMoveOrRemove(a);a.remove();a=null}this.myElements.length=d},getTitle:function(b,a){var c=(b===1?"DG.DataContext.singleCaseName".loc():"DG.DataContext.pluralCaseName".loc());return"DG.PlottedCountAdornment.title".loc(b,c,a.toFixed(0))},updateNumCells:function(){var b=this.get("parentView"),d=b.get("primaryAxisView"),c=b.get("secondaryAxisView"),a=b.get("xAxisView"),f=b.get("yAxisView");this.xIsPrimaryAxis=(d?(d.get("orientation")==="horizontal"):true);if(d){if(this.xIsPrimaryAxis){a=d}else{f=d}}if(c){if(this.xIsPrimaryAxis){f=c}else{a=c}}this.numCellsOnX=a.get("numberOfCells")||1;this.numCellsOnY=f.get("numberOfCells")||1;this.numCellsOnSecondary=this.xIsPrimaryAxis?this.numCellsOnY:this.numCellsOnX;DG.assert(this.numCellsOnX>0,"expecting 1+ cells in X");DG.assert(this.numCellsOnY>0,"expecting 1+ cells in Y")}});sc_require("components/graph/adornments/plot_adornment_model");DG.PlottedCountModel=DG.PlotAdornmentModel.extend({values:null,plotModel:null,isComputingNeeded:function(){return this._needsComputing&&this.get("isVisible")},setComputingNeeded:function(){this._needsComputing=true},recomputeValueIfNeeded:function(){if(this.isComputingNeeded()){this.recomputeValue()}},recomputeValue:function(){DG.assert(this.plotModel&&this.plotModel.getCellCaseCounts);var b=0,a=this.plotModel.getCellCaseCounts();a.forEach(function(c){b+=c.count});a.forEach(function(c){if(b>0&&c.count>0){c.percent=100*c.count/b}else{c.percent=0}});this.set("values",a);this._needsComputing=false},_needsComputing:true});DG.PlotAdornmentModel.registry.plottedCount=DG.PlottedCountModel;sc_require("components/graph/adornments/plot_adornment");DG.PlottedFunctionAdornment=DG.PlotAdornment.extend({modelPropertiesToObserve:[["expression","updateToModel"],["dependentChange","updateToModel"]],curve:null,createElements:function(){if(this.myElements&&(this.myElements.length>0)){return}this.curve=this.get("paper").path("").attr({stroke:"red"});this.curve.animatable=true;this.myElements.push(this.curve);this.get("layer").push(this.curve)},updateToModel:function(){if(!this.getPath("model.isVisible")){return}this.createElements();var h=this.get("xAxisView"),n=this.get("yAxisView"),b=h.get("pixelMin"),f=h.get("pixelMax"),g=1,j,m=this.get("model"),c="",l,k,i,a=[];if(m){try{for(j=b;j<=f;j+=g){l=h.coordinateToData(j);k=m.evaluate(l);if(DG.isFinite(k)){i=n.dataToCoordinate(k);a.push({top:i,left:j})}}}catch(d){}if(a.length>0){c="M"+a[0].left+","+a[0].top+pv.SvgScene.curveBasis(a)}}this.curve.attr({path:c})}});DG.PlottedFunctionAdornment.createFormulaEditView=function(a){return DG.FormulaTextEditView.create({layout:{height:20},borderStyle:SC.BORDER_BEZEL,isVisible:false,hint:"Type an expression e.g. x*x/30 - 50",leftAccessoryView:SC.LabelView.create({layout:{left:0,width:25,height:20,centerY:0},value:"y =",backgroundColor:"gray"}),keyDown:function(b){var c=b.which;if(c===SC.Event.KEY_RETURN){this.completeEditing();return YES}if(c===SC.Event.KEY_ESC){this.discardEditing();return YES}return arguments.callee.base.apply(this,arguments)},commitEditing:function(){var b=arguments.callee.base.apply(this,arguments);if(b){a.set("expression",this.get("formulaExpression"));DG.logUser("plotFunction: '%@'",this.get("formulaExpression"))}this.parentView.displayDidChange();return b}})};DG.UNICODE={PLUS_SIGN:"+",MINUS_SIGN:"\u2212",MULTIPLICATION_SIGN:"\u00D7",DIVISION_SIGN:"\u00F7",EQUALS_SIGN:"=",NOT_EQUAL_TO:"\u2260",LESS_THAN_OR_EQUAL_TO:"\u2264",GREATER_THAN_OR_EQUAL_TO:"\u2265",GREEK_SMALL_LETTER_ALPHA:"\u03B1",GREEK_SMALL_LETTER_BETA:"\u03B2",GREEK_SMALL_LETTER_GAMMA:"\u03B3",GREEK_SMALL_LETTER_DELTA:"\u03B4",GREEK_SMALL_LETTER_EPSILON:"\u03B5",GREEK_SMALL_LETTER_ZETA:"\u03B6",GREEK_SMALL_LETTER_ETA:"\u03B7",GREEK_SMALL_LETTER_THETA:"\u03B8",GREEK_SMALL_LETTER_IOTA:"\u03B9",GREEK_SMALL_LETTER_KAPPA:"\u03BA",GREEK_SMALL_LETTER_LAMDA:"\u03BB",GREEK_SMALL_LETTER_MU:"\u03BC",GREEK_SMALL_LETTER_NU:"\u03BD",GREEK_SMALL_LETTER_XI:"\u03BE",GREEK_SMALL_LETTER_OMICRON:"\u03BF",GREEK_SMALL_LETTER_PI:"\u03C0",GREEK_SMALL_LETTER_RHO:"\u03C1",GREEK_SMALL_LETTER_FINAL_SIGMA:"\u03C2",GREEK_SMALL_LETTER_SIGMA:"\u03C3",GREEK_SMALL_LETTER_TAU:"\u03C4",GREEK_SMALL_LETTER_UPSILON:"\u03C5",GREEK_SMALL_LETTER_PHI:"\u03C6",GREEK_SMALL_LETTER_CHI:"\u03C7",GREEK_SMALL_LETTER_PSI:"\u03C8",GREEK_SMALL_LETTER_OMEGA:"\u03C9",INFINITY:"\u221E"};DG.VarReferenceError=function(a){this.name="VarReferenceError";this.message="DG.Formula.VarReferenceError.message".loc(a);this.description="DG.Formula.VarReferenceError.description".loc(a);this.reference=a};DG.VarReferenceError.prototype=new Error();DG.VarReferenceError.prototype.constructor=DG.VarReferenceError;DG.FuncReferenceError=function(a){this.name="FuncReferenceError";this.message="DG.Formula.FuncReferenceError.message".loc(a);this.description="DG.Formula.FuncReferenceError.description".loc(a);this.reference=a};DG.FuncReferenceError.prototype=new Error();DG.FuncReferenceError.prototype.constructor=DG.FuncReferenceError;DG.FuncArgsError=function(a,c){var b=c&&c.min,d=c&&c.max;this.name="FuncArgsError";if((b===1)&&(b===d)){this.message="DG.Formula.FuncArgsErrorSingle.message".loc(a,b);this.description="DG.Formula.FuncArgsErrorSingle.description".loc(a,b)}else{if((b>=0)&&!SC.none(d)&&(b!==d)){this.message="DG.Formula.FuncArgsErrorRange.message".loc(a,b,d);this.description="DG.Formula.FuncArgsErrorRange.description".loc(a,b,d)}else{this.message="DG.Formula.FuncArgsErrorPlural.message".loc(a,b);this.description="DG.Formula.FuncArgsErrorPlural.description".loc(a,b)}}this.reference=a};DG.FuncArgsError.prototype=new Error();DG.FuncArgsError.prototype.constructor=DG.FuncArgsError;DG.ObjectMap={length:function(a){return Object.keys(a||{}).length},keys:function(a){return Object.keys(a||{})},values:function(a){var b=[];DG.ObjectMap.forEach(a,function(c,d){b.push(d)});return b},copy:function(b,a){DG.ObjectMap.forEach(a,function(c,d){b[c]=d})},copySome:function(c,b,a){DG.ObjectMap.forEach(b,function(d,f){if(a(d,f)){c[d]=f}})},forEach:function(a,c){if(!a){return}for(var b in a){if(a.hasOwnProperty(b)){c(b,a[b])}}},firstKey:function(a){return DG.ObjectMap.findKey(a,function(b,c){return true})},findKey:function(b,f){if(!b||!f){return undefined}var c,a=f;if(SC.typeOf(f)!==SC.T_FUNCTION){c=String(f);a=function(g,h){return g===c}}for(var d in b){if(b.hasOwnProperty(d)&&a(d,b[d])){return d}}return undefined},findValue:function(a,c){var b=c;return DG.ObjectMap.findKey(a,function(d,f){return f===b})},insert:function(a,b,c){a[b]=c},remove:function(a,b){var c=b?a[b]:undefined;delete a[b];return c}};sc_require("formula/formula_common");sc_require("utilities/object_map");DG.FormulaContext=SC.Object.extend((function(){var a=function(c,b,f){var d=f&&f[c];if(d&&(b.length<d.min)){throw new DG.FuncArgsError(c,d)}};return{clearCaches:function(){},compileVariable:function(b){switch(b){case"pi":case"":return"Math.PI";case"e":return"Math.E";default:var c=this.get("eVars");if(c&&(c[b]!==undefined)){return"e."+b}var d=this.get("vars");if(d&&(d[b]!==undefined)){return"c.vars."+b}}return"(function(){throw new DG.VarReferenceError("+b+");})()"},evaluateVariable:function(c,d){switch(c){case"pi":case"":return Math.PI;case"e":return Math.E;default:var b=d&&d[c];if(b!==undefined){return b}var f=this.get("vars");if(f&&(f[c]!==undefined)){return f[c]}}throw new DG.VarReferenceError(c)},hasAggregates:false,fnNames:[],_fns:{"boolean":function(b){return Boolean(b)},frac:function(b){return b-this.trunc(b)},ln:function(b){return Math.log(b)},log:function(b){return Math.log(b)/Math.LN10},number:function(b){return Number(b)},random:function(c,b){if(SC.none(c)){return Math.random()}if(SC.none(b)){return c*Math.random()}return c+(b-c)*Math.random()},round:function(b,d){if(SC.none(d)){return Math.round(b)}var c=Math.pow(10,this.trunc(d));return Math.round(c*b)/c},string:function(b){return String(b)},trunc:function(b){return b<0?Math.ceil(b):Math.floor(b)}},_fnsArgs:{"boolean":{min:1,max:1},frac:{min:1,max:1},ln:{min:1,max:1},log:{min:1,max:1},number:{min:1,max:1},random:{min:0,max:2},round:{min:1,max:2},string:{min:1,max:1},trunc:{min:1,max:1}},_MathArgs:{abs:{min:1,max:1},acos:{min:1,max:1},asin:{min:1,max:1},atan:{min:1,max:1},atan2:{min:2,max:2},ceil:{min:1,max:1},cos:{min:1,max:1},exp:{min:1,max:1},floor:{min:1,max:1},pow:{min:2,max:2},sin:{min:1,max:1},sqrt:{min:1,max:1},tan:{min:1,max:1}},compileFunction:function(c,b){var f=this.get("_fns");if(f&&typeof f[c]==="function"){a(c,b,this.get("_fnsArgs"));return"c._fns."+c+"("+b+")"}if(typeof Math[c]==="function"){a(c,b,this._MathArgs);return"Math."+c+"("+b+")"}var d=this.get("fns");if(d&&typeof d[c]==="function"){a(c,b,this.get("fnsArgs"));return"c.fns."+c+"("+b+")"}return"(function(){throw new DG.FuncReferenceError("+c+");})()"},evaluateFunction:function(c,b){var f=this.get("_fns");if(f&&typeof f[c]==="function"){a(c,b,this.get("_fnsArgs"));return f[c].apply(f,b)}if(typeof Math[c]==="function"){a(c,b,this._MathArgs);return Math[c].apply(Math,b)}var d=this.get("fns");if(d&&typeof d[c]==="function"){a(c,b,this.get("fnsArgs"));return d[c].apply(d,b)}throw new DG.FuncReferenceError(c)}}}()));DG.FormulaContext.createContextFunction=function(a){return new Function("c","e","return "+a)};DG.FormulaContext.registerFnModule=function(a){var b=DG.FormulaContext.prototype.fnNames;b.push.apply(b,DG.ObjectMap.keys(a));b.sort()};DG.FormulaContext.registerFnModule(DG.FormulaContext.prototype._fns);DG.FormulaContext.registerFnModule(DG.FormulaContext.prototype._MathArgs);DG.FormulaContext.getFunctionNamesWithParentheses=function(){var a=DG.FormulaContext.prototype.fnNames;return a.map(function(b){return b+"()"})};sc_require("formula/formula_context");DG.GlobalFormulaContext=DG.FormulaContext.extend({init:function(){arguments.callee.base.apply(this,arguments);DG.globalsController.addObserver("globalNameChanges",this,"globalNamesDidChange");DG.globalsController.addObserver("globalValueChanges",this,"globalValuesDidChange")},destroy:function(){DG.globalsController.removeObserver("globalNameChanges",this,"globalNamesDidChange");DG.globalsController.removeObserver("globalValueChanges",this,"globalValuesDidChange");arguments.callee.base.apply(this,arguments)},compileVariable:function(a){var b=DG.globalsController.getGlobalValueByName(a);if(b){if(!this.g){this.g={}}this.g[a]=function(){return b.get("value")};return'c.g["'+a+'"]()'}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,b){var c=DG.globalsController.findGlobalByName(a);if(c){this.g[a]=true;return c.get("value")}return arguments.callee.base.apply(this,arguments)},globalNamesDidChange:function(){this.notifyPropertyChange("namespaceChange")},globalValuesDidChange:function(){var c=DG.globalsController.get("globalValueChanges"),a,b=c&&c.length;for(a=0;a<b;++a){if(this.g&&this.g[c[a]]){this.notifyPropertyChange("dependentChange");return}}}});sc_require("formula/global_formula_context");sc_require("components/graph/adornments/plot_adornment_model");DG.PlottedFunctionContext=DG.GlobalFormulaContext.extend({isXAxisName:function(a){var b=this.getPath("dataConfiguration.xAttributeDescription.attribute.name");return !SC.empty(b)&&(a===b)},compileVariable:function(a){if((a==="x")||this.isXAxisName(a)){return"e.x"}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,b){if((a==="x")||this.isXAxisName(a)){return b&&b.x}return arguments.callee.base.apply(this,arguments)}});DG.PlottedFunctionModel=DG.PlotAdornmentModel.extend({_expression:null,expression:function(a,b){if(b!==undefined){if(SC.empty(b)){this._expression=null}else{if(SC.none(this._expression)){this.createDGFormula(b)}else{this._expression.set("source",b)}}return this}return(this._expression&&this._expression.get("source"))||""}.property(),destroy:function(){if(this._expression){this.destroyDGFormula()}arguments.callee.base.apply(this,arguments)},createDGFormula:function(a){this._expression=DG.Formula.create({context:DG.PlottedFunctionContext.create(),source:a});this._expression.setPath("context.dataConfiguration",this.get("dataConfiguration"));this._expression.addObserver("dependentChange",this,"dependentDidChange")},destroyDGFormula:function(){this._expression.removeObserver("dependentChange",this,"dependentDidChange");this._expression.destroy();this._expression=null},dependentDidChange:function(a,b){this.notifyPropertyChange(b)},globalNamesDidChange:function(){if(this._expression){this._expression.invalidate()}}.observes("DG.globalsController.globalNameChanges"),evaluate:function(a){if(!this._expression){return}return this._expression.evaluate({x:a})},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);a.expression=this.get("expression");return a},restoreStorage:function(a){arguments.callee.base.apply(this,arguments);this.set("expression",a.expression)}});DG.PlotAdornmentModel.registry.plottedValue=DG.PlottedFunctionModel;DG.PlotAdornmentModel.registry.plottedFunction=DG.PlottedFunctionModel;sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/line_label_mixin");DG.PlottedValueAdornment=DG.PlotAdornment.extend(DG.LineLabelMixin,{valueSegment:null,valueAxisView:null,value:function(){return this.getValueToPlot()}.property(),valueString:function(){var c=this.get("value");if(c instanceof Error){return c.message}var a=DG.PlotUtilities.findFractionDigitsForAxis(this.get("valueAxisView")),b=pv.Format.number().fractionDigits(0,a);return DG.isFinite(c)?b(c):(c&&c.toString())}.property(),modelPropertiesToObserve:[["expression","updateToModel"],["dependentChange","updateToModel"]],createElements:function(){if(this.myElements&&(this.myElements.length>0)){return}var a=this.get("layer");this.myElements=[];this.valueSegment=this.get("paper").path("").attr({stroke:"red"});this.myElements.push(this.valueSegment);this.myElements.push(this.createTextElement());this.myElements.forEach(function(b){a.push(b)})},updateToModel:function(){if(!this.myElements||(this.myElements.length===0)){this.createElements()}var c=this.get("valueAxisView"),a=this.get("paper"),g,b,f,d;g=this.getValueToPlot();if(isFinite(g)){b=c.dataToCoordinate(g);if(c.get("orientation")==="horizontal"){f={x:b,y:a.height};d={x:b,y:0}}else{f={x:0,y:b};d={x:a.width,y:b}}DG.RenderingUtilities.updateLine(this.valueSegment,f,d)}else{this.valueSegment.attr({path:""})}this.updateTextToModel(1/4)}.observes("DG.globalsController.globalNameChanges"),getValueToPlot:function(){var a=this.get("model"),c=NaN;try{if(a){c=a.evaluate()}}catch(b){c=b}return c}});DG.PlottedValueAdornment.createFormulaEditView=function(a){return DG.FormulaTextEditView.create({layout:{height:20},borderStyle:SC.BORDER_BEZEL,isVisible:false,hint:"Type an expression e.g. mean()",value:a.get("expression"),leftAccessoryView:SC.LabelView.create({layout:{left:0,width:45,height:20,centerY:0},value:"value =",backgroundColor:"gray"}),keyDown:function(b){var c=b.which;if(c===SC.Event.KEY_RETURN){this.parentView.displayDidChange();return this.commitEditing()}return arguments.callee.base.apply(this,arguments)},commitEditing:function(){var b=arguments.callee.base.apply(this,arguments);if(b){var c=this.get("formulaExpression");DG.logUser("plotValue: '%@'",c);a.set("expression",c)}return b}})};sc_require("components/graph/adornments/data_tip");DG.PointDataTip=DG.DataTip.extend({caseIndex:null,getDataTipText:function(){var i=this,h=this.getPath("plot.cases"),f=h?h[this.get("caseIndex")]:null;function a(o){var s=i.get("plot").getPath("dataConfiguration."+o+"AttributeDescription"),r=s.get("attributes"),k=i.getPath("plotLayer.plotIndex");k=(k<r.length)?k:0;var q=r[k],p=(typeof(q)==="object")?q.get("id"):null,m,l,j,n;if(!SC.none(p)){m=q.get("name");l=f&&f.getValue(p);if(SC.none(l)){return null}if(s.get("isNumeric")){j=(o==="legend")?DG.PlotUtilities.findFractionDigitsForRange(s.getPath("attributeStats.minMax")):DG.PlotUtilities.findFractionDigitsForAxis(i.getPath("plotLayer."+o+"AxisView"));n=pv.Format.number().fractionDigits(0,j);l=n(f.getNumValue(p))}else{l=f.getStrValue(p)}return m+": "+l}return null}if(SC.none(f)){return""}var d=a("x"),g=a("y"),b=a("legend"),c;c=SC.none(d)?"":d;if(!SC.none(g)){if(c.length>0){c+="\n"}c+=g}if(!SC.none(b)){if(c.length>0){c+="\n"}c+=b}return c},show:function(a,c,b){this.set("tipOrigin",{x:a,y:c});this.set("caseIndex",b);arguments.callee.base.apply(this,arguments)},handleChanges:function(b){var a=(SC.typeOf(b)===SC.T_NUMBER?SC.IndexSet.create(b):b);if(!a.contains(this.get("caseIndex"))){return}this.updateTip()}});DG.AxisModel=SC.Object.extend({attributeDescription:null,labels:function(){var b=this.attributeDescription,a=[];if(b){b.get("attributes").forEach(function(d){if(d!==DG.Analysis.kNullAttribute){var c=d.get("name"),g=d.get("unit"),f=c+(!SC.empty(g)?" ("+g+")":"");a.push(f)}})}return a}.property("attributeDescription.attribute"),labelDescription:function(){return this.getPath("attributeDescription.attribute.description")||""}.property("attributeDescription.attribute"),getLabelDescription:function(a){var b=this.getPath("attributeDescription.attributes");return(a<b.length)?b[a].get("description"):""},firstAttributeName:function(){var a=this.getPath("attributeDescription.attributes");if(SC.isArray(a)&&(a.length>0)){return a[0].get("name")}return""}.property("attributeDescription.attributes"),numberOfCells:function(){return 1}.property().cacheable(),axisAnimator:null,cellNameToCellNumber:function(a){return 0},isNumeric:null,setLowerAndUpperBounds:function(){},stopAnimation:function(){var a=this.get("axisAnimator");if(!SC.none(a)){a.endAnimation()}}});DG.GraphDropTarget={kDropFrameClass:"graph-drop-frame",kDropHintClass:"graph-drop-hint",kDropBoxClass:"graph-drop-box",blankDropHint:"",isDropTarget:true,dragData:null,computeDragOperations:function(a){if(this.isValidAttribute(a)){return SC.DRAG_LINK}else{return SC.DRAG_NONE}},dragEntered:function(a,b){this.borderFrame.addClass("graph-drop-frame-fill");this.showDropHint()},dragExited:function(a,b){this.borderFrame.removeClass("graph-drop-frame-fill");this.hideDropHint()},acceptDragOperation:function(){return YES},isValidAttribute:function(c){var a=c.data.attribute,b=this.get("plottedAttribute");return SC.none(b)||(b!==a)},dragStarted:function(g){var f=3,c=this.get("paper"),b;function h(j){return SC.empty(j)||j==="undefined"}if(this.isValidAttribute(g)){b={x:f,y:f,width:c.width-2*f,height:c.height-2*f};if(this.get("isVertical")){b.y+=18+2*f;b.height-=18+2*f}if(SC.none(this.borderFrame)){this.borderFrame=c.path("").addClass(this.kDropFrameClass)}this.borderFrame.attr({path:DG.RenderingUtilities.pathForFrame(b)}).show();var i=g.data.attribute.get("name"),d=this.getPath("plottedAttribute.name"),a=h(d)?this.get("blankDropHint").loc(i):"DG.GraphView.replaceAttribute".loc(d,i);this.set("dropHintString",a)}},dragEnded:function(){if(this.borderFrame){this.borderFrame.hide()}},borderFrame:null,dropHintString:null,dropHintElement:null,dropHintBox:null,isVertical:function(){return this.get("orientation")==="vertical"}.property(),showDropHint:function(){if(SC.empty(this.dropHintString)){return}var b=this.get("paper"),f=3,a=b.width/2,d=b.height/2;if(!this.dropHintElement){this.dropHintBox=b.rect(0,0,0,0,3).addClass(this.kDropBoxClass).attr("stroke-width",0);this.dropHintElement=b.text(a,d,this.dropHintString).addClass(this.kDropHintClass)}this.dropHintBox.transform("");this.dropHintElement.transform("");this.dropHintElement.attr({text:this.dropHintString,x:a,y:d});var c=this.dropHintElement.getBBox();this.dropHintBox.attr({x:c.x-f,y:c.y-f,width:c.width+2*f,height:c.height+2*f});if(this.isVertical()){this.dropHintBox.transform("R-90");this.dropHintElement.transform("R-90")}this.dropHintBox.toFront().show();this.dropHintElement.toFront().show()},hideDropHint:function(){if(this.dropHintElement){this.dropHintElement.hide();this.dropHintBox.hide()}},performDragOperation:function(a,b){this.set("dragData",a.data);return SC.DRAG_LINK}};sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.AxisMultiTarget=DG.RaphaelBaseView.extend(DG.GraphDropTarget,{attributeDescription:null,otherAttributeDescription:null,plottedAttribute:function(){return this.getPath("attributeDescription.attribute")}.property(),otherPlottedAttribute:function(){return this.getPath("otherAttributeDescription.attribute")}.property(),plusArea:null,desiredExtent:function(){return{width:this.getPath("parentView.layout.width"),height:24}}.property(),dragEntered:function(a,b){this.plusArea.addClass("graph-drop-plus-fill");this.set("backgroundColor",Raphael.color("rgba(100%,100%,0%,50%)"));this.showDropHint()},dragExited:function(a,b){this.plusArea.removeClass("graph-drop-plus-fill");this.set("backgroundColor",null);this.hideDropHint()},isValidAttribute:function(d){var a=d.data.attribute,b=this.get("plottedAttribute"),c=this.get("otherPlottedAttribute");return(c!==DG.Analysis.kNullAttribute)&&(b!==DG.Analysis.kNullAttribute)&&(b!==a)},dragStarted:function(f){var i=3,c=24;function d(){return"M-6,-18 h6 v6 h6 v6 h-6 v6 h-6 v-6 h-6 v-6 h6 v-6Z"}if(this.isValidAttribute(f)){this.set("isVisible",true);var b=c/2+i,h=b+2*i;if(SC.none(this.plusArea)){this.plusArea=this._paper.path(d()).addClass(this.kDropFrameClass)}this.plusArea.transform("").transform("T"+b+","+h).show();var g=f.data.attribute.get("name"),a="DG.GraphView.addAttribute".loc(g);this.set("dropHintString",a)}},dragEnded:function(){if(this.plusArea){this.plusArea.hide()}this.set("isVisible",false)}});sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.AxisView=DG.RaphaelBaseView.extend(DG.GraphDropTarget,{displayProperties:["model.attributeDescription.attribute","model.attributeDescription.attributeStats.categoricalStats.numberOfCells"],model:null,orientation:null,plottedAttribute:function(){return this.getPath("model.attributeDescription.attribute")}.property(),blankDropHint:"DG.GraphView.addToEmptyPlace",desiredExtent:function(){var a=this.get("labelExtent"),b=(Raphael.version<"2.0")?"y":((this.get("orientation")==="horizontal")?"y":"x");return a[b]}.property("labelNode"),pixelMin:function(){return(this.get("orientation")==="vertical")?this.get("drawHeight"):0}.property("drawHeight"),pixelMax:function(){return(this.get("orientation")==="vertical")?0:this.get("drawWidth")}.property("drawWidth"),labelExtent:function(){var d=DG.RenderingUtilities.kCaptionFontHeight,b=this.get("labelNode"),a={x:d,y:d};if(!SC.none(b)){var c=b.getBBox();a={x:isNaN(c.width)?d:Math.max(d,c.width),y:isNaN(c.height)?d:Math.max(d,Math.ceil(c.height/2)*2)}}return a}.property("labelNode").cacheable(),isNumeric:null,labelNodes:function(){var h=this,g=false,f=0,b=this.get("orientation")==="vertical"?-90:0,c,a,d;if(SC.none(this._paper)){return[]}c=this.getPath("model.labels");c.forEach(function(k,j){var i="blue";if(j>0){k=": "+k;i=DG.ColorUtilities.calcAttributeColorFromIndex(j,c.length).colorString}if(f>=h._labelNodes.length){d=h._paper.text(0,0,"").addClass("axis-label");DG.RenderingUtilities.rotateText(d,b,0,0);h._labelNodes.push(d);g=true}else{d=h._labelNodes[f]}d.attr("fill",i);if(k!==d.attr("text")){a=h.get("model").getLabelDescription(j);a+="Click to change "+h.orientation+" axis attribute";d.attr({text:k,title:a});g=true}f++});while(h._labelNodes.length>f){h._labelNodes.pop().remove();g=true}if(g){this.notifyPropertyChange("labelNode",this._labelNodes)}return this._labelNodes}.property("model.labels"),labelNode:function(){var a=this.get("labelNodes");return(a.length>0)?a[0]:null}.property("labelNodes"),_labelNodes:null,init:function(){arguments.callee.base.apply(this,arguments);this._labelNodes=[]},renderLabel:function(){var d=this.get("labelNodes"),i=this.get("drawWidth"),b=this.get("drawHeight"),f=this.get("orientation")==="vertical",c=f?-90:0,g=0,a=d.map(function(k){var j=k.getBBox();g+=f?j.height:j.width;return{node:k,box:j}}),h=f?((b+g)/2):((i-g)/2);a.forEach(function(k){var m=k.node,l=k.box,j={x:l.width,y:l.height},n={};if(f){n.x=j.x/4+2;n.y=h-j.y/2;h-=j.y}else{n.x=h+j.x/2;n.y=b-j.y/2-2;h+=j.x}m.attr({x:n.x,y:n.y});DG.RenderingUtilities.rotateText(m,c,n.x,n.y)})},dragData:null,performDragOperation:function(a,b){this.set("dragData",a.data);return SC.DRAG_LINK},drawWidth:function(){var a=this.get("frame").width;if(this.get("orientation")==="horizontal"){a-=2*DG.ViewUtilities.kBorderWidth}return a}.property("frame"),drawHeight:function(){var a=this.get("frame").height;if(this.get("orientation")==="vertical"){a-=2*DG.ViewUtilities.kBorderWidth}return a}.property("frame"),numberOfCells:function(){return this.getPath("model.numberOfCells")}.property("model.numberOfCells"),fullCellWidth:function(){var a=this.get("numberOfCells");return Math.abs(this.get("pixelMax")-this.get("pixelMin"))/a}.property("numberOfCells","pixelMax","pixelMin"),cellWidth:function(){var c=this.get("numberOfCells"),b=this.get("pixelMin"),g=this.get("pixelMax"),i=0.9,h=c+0.5,f=0,a=h-f,d=Math.abs((g-b)/a);return d*i}.property("numberOfCells","pixelMax","pixelMin"),cellToCoordinate:function(a){var b=this.get("numberOfCells"),c=Math.abs((a+0.5)/b*(this.get("pixelMax")-this.get("pixelMin")));return c},cellNameToCoordinate:function(a){return this.cellToCoordinate(this.model.cellNameToCellNumber(a))},forEachTickDo:function(){},dataToCoordinate:function(c){var a=this.get("pixelMin"),b=this.get("pixelMax");return a+c*(b-a)},coordinateToData:function(b){var a=this.get("pixelMin"),c=this.get("pixelMax");return(b-a)/(c-a)}});sc_require("components/graph/axes/axis_model");DG.CellAxisModel=DG.AxisModel.extend({numberOfCells:function(){return Math.max(1,this.getPath("attributeDescription.attributeStats.numberOfCells"))}.property("attributeDescription.attributeStats.numberOfCells"),maxCellNameLength:function(){var a=0;this.forEachCellDo(function(c,b){a=Math.max(a,b.length)});return a}.property("attributeDescription.attributeStats.cellMap"),isNumeric:false,cellNameToCellNumber:function(b){var a=this.getPath("attributeDescription.attributeStats");return a?a.cellNameToCellNumber(b):0},forEachCellDo:function(d){var a=this.getPath("attributeDescription.attributeStats.cellMap"),c=DG.ObjectMap.keys(a),b=0;if(c.length===0){d(0,"",0,0)}else{c.forEach(function(f){var i=a[f],h=i.length,g=0;d(b++,f,h,g)})}}});sc_require("components/graph/axes/axis_view");DG.CellAxisView=DG.AxisView.extend((function(){var b=4,c=2;return{desiredExtent:function(){var d=arguments.callee.base.apply(this,arguments);if(!this.get("isNumeric")){d+=b+c+this.get("maxLabelExtent")}return d}.property("maxLabelExtent"),isNumeric:false,axisLineCoordinate:function(){return(this.get("orientation")==="vertical")?this.get("drawWidth"):0}.property("drawWidth"),maxLabelExtent:0,renderAxisLine:function(){var g=this.get("axisLineCoordinate"),d=this.get("pixelMin"),i=this.get("pixelMax"),f,h;switch(this.get("orientation")){case"vertical":f={x:g-1,y:d};h={x:g-1,y:i};break;case"horizontal":f={x:d,y:g+1};h={x:i,y:g+1};break}return this._paper.line(f.x,f.y,h.x,h.y).attr({stroke:DG.PlotUtilities.kAxisColor,strokeWidth:2})},whichCell:function(g){var h=this.getPath("model.numberOfCells"),f=0;if(h>1){var d=this.get("pixelMin"),i=this.get("pixelMax");if(this.get("orientation")==="vertical"){g=Math.min(Math.max(i+1,g),d-1);f=Math.floor((g-i)*h/(d-i))}else{g=Math.max(Math.min(i-d-1,g),1);f=Math.floor(g*h/(i-d))}}return f},doDraw:function a(){var l=this,p=this.get("model"),k=l.get("axisLineCoordinate"),g=this.get("orientation"),d=(g==="horizontal")?0:-90,m=DG.RenderingUtilities.kDefaultFontHeight,n=m,i=[],o=false,j;function h(s,u){var t=l.cellToCoordinate(s),r=l._paper.text(0,0,u),q=DG.RenderingUtilities.getExtentForTextElement(r,DG.RenderingUtilities.kDefaultFontHeight);if(!isFinite(t)){r.remove();return}i.push({element:r,coord:t,height:q.height,width:q.width});m=Math.max(m,q.height);n=Math.max(n,q.width);l._elementsToClear.push(r);if(SC.none(j)){o=q.width>l.get("fullCellWidth")}else{o=o||(t-q.width/2<j)}j=(t+q.width/2)}function f(s){var q=s.coord,t,r;switch(l.get("orientation")){case"vertical":l._elementsToClear.push(l._paper.line(k,q,k-b,q).attr({stroke:DG.PlotUtilities.kAxisColor}));t=k-b-c-s.height/3;r=q;if(d===0){t-=s.width/2}break;case"horizontal":l._elementsToClear.push(l._paper.line(q,k,q,k+b).attr({stroke:DG.PlotUtilities.kAxisColor}));t=q+1;r=k+b+c+s.height/3;if(d===-90){r+=s.width/2}break}s.element.attr({x:t,y:r});DG.RenderingUtilities.rotateText(s.element,d,t,r)}if(this.getPath("model.maxCellNameLength")<=3){d=0}this._elementsToClear.push(this.renderAxisLine());p.forEachCellDo(h);if(o){d=(g==="horizontal")?-90:0}i.forEach(f);this.renderLabel();this.setIfChanged("maxLabelExtent",(g==="horizontal")?((d===0)?m:n):((d===0)?n:m))}}}()));sc_require("components/graph/axes/cell_axis_model");DG.CellLinearAxisModel=DG.CellAxisModel.extend({tickGap:null,lowerBound:null,upperBound:null,lockZero:function(b,a){if(a!==undefined){this.beginPropertyChanges();this.set("_lockZero",a);if(a){this.set("lowerBound",0)}else{this.setDataMinAndMax(this._lowerBound,this._upperBound)}this.endPropertyChanges()}return this._lockZero}.property("_lockZero").cacheable(),displayOnlyIntegers:false,isNumeric:true,_lowerBound:null,_upperBound:null,numberOfCells:function(){return 1}.property(),_lockZero:false,setLowerAndUpperBounds:function(a,b){this.beginPropertyChanges();this._lowerBound=a;this._upperBound=b;this.setIfChanged("lowerBound",a);this.setIfChanged("upperBound",b);this.setIfChanged("tickGap",this._computeTickGap(a,b));this.endPropertyChanges()},translate:function(a){if((a===0)||this._lockZero){return}this.beginPropertyChanges();this._lowerBound+=a;this._upperBound+=a;this._setBoundsFromInternalBounds();this.endPropertyChanges()},computeBoundsForDilation:function(c,a){var b=(!this._lockZero||(this._lowerBound!==0))?c+(this._lowerBound-c)*a:this._lowerBound,d=(!this._lockZero||(this._upperBound!==0))?c+(this._upperBound-c)*a:this._upperBound;return{lower:b,upper:d}},dilate:function(d,b,c){var a=this.computeBoundsForDilation(d,b);c=c||false;if(c){if(SC.none(this.axisAnimator)){this.axisAnimator=DG.GraphAnimator.create()}this.axisAnimator.set("axisInfoArray",[{axis:this,newBounds:a}]).animate()}else{this._lowerBound=a.lower;this._upperBound=a.upper;if(this._setBoundsFromInternalBounds()){this.beginPropertyChanges();this._resetTickGap(this.get("lowerBound"),this.get("upperBound"));this._handleAxisChange();this.endPropertyChanges()}}},setDataMinAndMax:function(b,f,d){if(!d&&(SC.none(b)||SC.none(f))){return}if(!d&&(b>=this.get("lowerBound"))&&(f<=this.get("upperBound"))){return}this._resetScale(b,f);var a=this._setBoundsFromInternalBounds(),c=this._resetTickGap(this.get("lowerBound"),this.get("upperBound"));if(a||c){this._handleAxisChange()}},_resetScale:function(a,c){var b=this._computeBoundsAndTickGap(a,c);this.set("tickGap",b.gap);this._lowerBound=b.lower;this._upperBound=b.upper},_computeBoundsAndTickGap:function(a,d){var f=2.5,c;if(!DG.isFinite(d)||!DG.isFinite(a)||(d<a)){var b=this.getPath("attributeDescription.attribute.defaultMin"),g=this.getPath("attributeDescription.attribute.defaultMax");a=SC.none(b)?0:b;d=SC.none(g)?10:g}else{if((a===d)&&(a===0)){a=-10;d=10}else{if((a===d)&&(Math.floor(a)===a)){d+=5;a-=5}else{if(a===d){d=a+0.1*Math.abs(a);a=a-0.1*Math.abs(a)}else{if((a>0)&&(d>0)&&(a<=d/f)){a=0}else{if((a<0)&&(d<0)&&(d>=a/f)){d=0}}}}}}c=this._computeTickGap(a,d);return{lower:this._findLow(a,c),upper:this._findHigh(d,c),gap:c}},_computeTickGap:function(a,d){var b=(a>=d)?Math.abs(a):d-a,c=this._goodTickValue(b/5);if(this.displayOnlyIntegers&&(c<1)){c=1}return c},_resetTickGap:function(a,d){var c=this.tickGap,b=this._computeTickGap(a,d);this.set("tickGap",b);return c!==b},_setBoundsFromInternalBounds:function(){var d=0.05,a=this.get("lowerBound"),c=this.get("upperBound"),b=(this._upperBound-this._lowerBound)*d;this.beginPropertyChanges();if((this.get("lockZero")||((this._lowerBound>0)&&(this._lowerBound-b<0)))){this.set("lowerBound",0)}else{this.set("lowerBound",this._lowerBound)}if((this._upperBound<0)&&(this._upperBound+b>0)){this.set("upperBound",0)}else{this.set("upperBound",this._upperBound)}this.endPropertyChanges();return(a!==this.get("lowerBound"))||(c!==this.get("upperBound"))},_handleAxisChange:function(){},_findLow:function(b,a){if(a!==0){return(Math.floor(b/a)-0.5)*a}else{return b-1}},_findHigh:function(b,a){if(a!==0){return(Math.floor(b/a)+1.5)*a}else{return b+1}},_goodTickValue:function(f){if(f===0){return 1}var d=Math.log(f)/Math.LN10,c=Math.floor(d),b=Math.pow(10,c),a=Math.pow(10,d-c);if(a<2){a=1}else{if(a<5){a=2}else{a=5}}return Math.max(b*a,Number.MIN_VALUE)}});sc_require("components/graph/axes/cell_axis_view");DG.CellLinearAxisView=DG.CellAxisView.extend((function(){var c=1,b=4;return{displayProperties:"model.lowerBound model.upperBound model.tickGap".w(),isNumeric:true,zeroPixel:function(){if((0>=this.getPath("model.lowerBound"))&&(0<=this.getPath("model.upperBound"))){return this.dataToCoordinate(0)}else{return null}}.property("model.lowerBound","model.upperBound","pixelMin","pixelMax").cacheable(),maxNumberExtent:0,coordToString:function(h){var g=this.coordinateToData(h),f=this.getPath("model.tickGap"),i=(f<1)?1+Math.ceil(Math.abs(Math.log(f)/Math.LN10)):0,d;if((i===0)&&(f<10)){i++}d=pv.Format.number().group("").fractionDigits(0,i);return d(g)},prepareVisualization:function(){this.displayDidChange()},doDraw:function a(){var m=this,r=this.get("model"),q=r.get("lowerBound"),g=r.get("upperBound"),l=this.get("axisLineCoordinate"),i=this.get("orientation"),j=m.getPath("model.tickGap"),n=Math.ceil(q/j)*j,d=Math.floor(Math.abs((g-n)/j)),f,s=DG.RenderingUtilities.kDefaultFontHeight,k=(j<1)?Math.ceil(Math.abs(Math.log(j)/Math.LN10)):0,p=pv.Format.number().group("").fractionDigits(0,k);function o(){function y(D,H){var N=false,I=1,J=false,F,E;while(!J){var C=0,A=true,O=I*j,B;d=Math.floor(Math.abs((g-D)/O));J=true;for(B=0;(B<=d)&&J;B++){var M=D+B*O,K=m.dataToCoordinate(M+H),G;f=p(M);G=DG.RenderingUtilities.textExtentOnCanvas(m._paper,f);switch(i){case"vertical":E=G.y/2;if(A||(Math.abs(C-K)>E)){A=false;C=K+(N?E:-E)}else{J=false;I++}break;case"horizontal":F=5*G.x/8;if(A||(Math.abs(K-C)>F)){A=false;C=K+(N?-F:F)}else{J=false;I++}break}}}return I}var v=0,x=y(n,v),t=0,z=t,w=m.get("pixelMax"),u=0;m.forEachTickDo(function(C,F){var B,A,E,D;f=p(C);B=m._paper.text(0,0,f);m._elementsToClear.push(B);A=DG.RenderingUtilities.getExtentForTextElement(B,DG.RenderingUtilities.kDefaultFontHeight);E=A.width;D=A.height;switch(i){case"vertical":F+=w;if((F<m.get("pixelMin"))&&(u>=0)){m._elementsToClear.push(m._paper.line(l,F,l-b,F).attr({stroke:DG.PlotUtilities.kAxisColor}))}if(z===0){if((F<m.get("pixelMin"))&&(u>=0)){B.attr({x:l-b-c,y:F,"text-anchor":"end"});s=Math.max(s,E)}}else{B.hide()}break;case"horizontal":F+=m.get("pixelMin");if((F>=m.get("pixelMin"))&&(u>=0)){m._elementsToClear.push(m._paper.line(F,l,F,l+b).attr({stroke:DG.PlotUtilities.kAxisColor}))}if(z===0){if((F>=m.get("pixelMin"))&&(u>=0)){B.attr({x:F+1,y:l+b+c+D/3});s=Math.max(s,D)}}else{B.hide()}break}if(u>=0){z=(z+1)%x}u++})}function h(){var z=m.get("frame"),u=false;function B(){m._dragPanel.show();m._isDragging=true;DG.logUser("dragStart: { lower: %@, upper: %@ }",m.getPath("model.lowerBound"),m.getPath("model.upperBound"))}function D(){m._dragPanel.hide();m._isDragging=false;DG.logUser("dragEnd: { lower: %@, upper: %@ }",m.getPath("model.lowerBound"),m.getPath("model.upperBound"))}function A(I,H){if(!u){B();m._lowerBoundAtDragStart=m.getPath("model.lowerBound");m._upperBoundAtDragStart=m.getPath("model.upperBound")}}function F(N,M){if(!u&&m._isDragging){var H=(m.get("orientation")==="vertical")?M:N,J=m.getPath("model.lowerBound"),K=m.coordinateToDataGivenCell(0,0)-m.coordinateToDataGivenCell(0,H),I=K-(J-m._lowerBoundAtDragStart);m.get("model").translate(I)}}function C(J,I){if(!u){var H=DG.ViewUtilities.windowToViewCoordinates({x:J,y:I},m);m._dilationAnchorCoord=(m.get("orientation")==="vertical")?H.y:H.x;m._lowerBoundAtDragStart=m.getPath("model.lowerBound");B()}}function x(P,N){if(!u&&m._isDragging){var J=m.get("_lowerBoundAtDragStart"),K=m.getPath("model.upperBound"),H=(m.get("orientation")==="vertical")?N:P,M=m.get("pixelMax"),I=M-m._dilationAnchorCoord,O=I/(I-H);if((O>0)&&(O<10)){m.setPath("model._lowerBound",J);m.get("model").dilate(K,O)}}}function E(J,I){if(!u){var H=DG.ViewUtilities.windowToViewCoordinates({x:J,y:I},m);m._dilationAnchorCoord=(m.get("orientation")==="vertical")?H.y:H.x;m._upperBoundAtDragStart=m.getPath("model.upperBound");B()}}function w(P,N){if(!u&&m._isDragging){var K=m.get("_upperBoundAtDragStart"),J=m.getPath("model.lowerBound"),H=(m.get("orientation")==="vertical")?N:P,M=m.get("pixelMin"),I=M-m._dilationAnchorCoord,O=I/(I-H);if((O>0)&&(O<10)){m.setPath("model._upperBound",K);m.get("model").dilate(J,O)}}}function v(I,H,M,J,K){I.attr({x:H,y:M,width:J,height:K})}function t(H){u=H.altKey}function y(K){var H;if(K.altKey){var I="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/MagnifyPlus.cur",M="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/MagnifyMinus.cur",J=K.shiftKey?M:I;H=K.shiftKey?"out":"in";this.attr({cursor:DG.Browser.customCursorStr(J,8,8),title:"Click to zoom "+H})}else{this.attr({cursor:this.defaultCursor,title:this.defaultTitle})}}function G(J){var K,I,H;if(J.altKey){K=J.shiftKey?2:0.5;I=DG.ViewUtilities.windowToViewCoordinates({x:J.clientX,y:J.clientY},m);H=(m.get("orientation")==="vertical")?I.y:I.x;m.get("model").dilate(m.coordinateToData(H),K,true);u=false}}if(SC.none(m._midPanel)){m._midPanel=m._paper.rect(0,0,0,0).attr({stroke:DG.RenderingUtilities.kTransparent,fill:DG.RenderingUtilities.kSeeThrough});m._lowerPanel=m._midPanel.clone();m._upperPanel=m._midPanel.clone();m._dragPanel=m._midPanel.clone();m._midPanel.defaultTitle="DG.CellLinearAxisView.midPanelTooltip".loc();m._midPanel.attr({title:m._midPanel.defaultTitle});m._midPanel.mousedown(t);m._midPanel.mouseup(G);m._midPanel.drag(F,A,D);m._midPanel.mousemove(y);m._lowerPanel.defaultTitle="DG.CellLinearAxisView.lowerPanelTooltip".loc();m._lowerPanel.attr({title:m._lowerPanel.defaultTitle});m._lowerPanel.mousedown(t);m._lowerPanel.mouseup(G);m._lowerPanel.drag(x,C,D);m._lowerPanel.mousemove(y);m._upperPanel.defaultTitle="DG.CellLinearAxisView.upperPanelTooltip".loc();m._upperPanel.attr({title:m._upperPanel.defaultTitle});m._upperPanel.mousedown(t);m._upperPanel.mouseup(G);m._upperPanel.drag(w,E,D);m._upperPanel.mousemove(y);m._dragPanel.attr({cursor:DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/ClosedHandXY.cur",8,8)})}if(m.get("orientation")==="vertical"){v(m._lowerPanel,z.x,(5/8)*z.height,z.width,(3/8)*z.height);m._lowerPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/DownDilate.cur",8,8);m._lowerPanel.attr({cursor:m._lowerPanel.defaultCursor});v(m._midPanel,z.x,(3/8)*z.height,z.width,(3/8)*z.height);m._midPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/TranslateY.cur",8,8);m._midPanel.attr({cursor:m._midPanel.defaultCursor});v(m._upperPanel,z.x,0,z.width,(3/8)*z.height);m._upperPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/UpDilate.cur",8,8);m._upperPanel.attr({cursor:m._upperPanel.defaultCursor});v(m._dragPanel,z.x,0,z.width,z.height)}else{v(m._lowerPanel,0,0,(3/8)*z.width,z.height);m._lowerPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/LeftDilate.cur",8,8);m._lowerPanel.attr({cursor:m._lowerPanel.defaultCursor});v(m._midPanel,(3/8)*z.width,0,(3/8)*z.width,z.height);m._midPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/TranslateX.cur",8,8);m._midPanel.attr({cursor:m._midPanel.defaultCursor});v(m._upperPanel,(5/8)*z.width,0,(3/8)*z.width,z.height);m._upperPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/RightDilate.cur",8,8);m._upperPanel.attr({cursor:m._upperPanel.defaultCursor});v(m._dragPanel,0,0,z.width,z.height)}if(!m._isDragging){m._dragPanel.hide()}}this._elementsToClear.push(this.renderAxisLine());o();h();this.renderLabel();this.setIfChanged("maxNumberExtent",s)},info:function(){var d={lowerBound:this.getPath("model.lowerBound"),upperBound:this.getPath("model.upperBound"),range:null,cellWidth:this.get("fullCellWidth"),pixelMax:this.get("pixelMax")};d.range=d.upperBound-d.lowerBound;return d}.property("model.lowerBound","model.upperBound","fullCellWidth","pixelMax").cacheable(),cellDataToCoordinateUsingCache:function(d,h,f){if(!isFinite(h)){return null}var g=SC.none(h)?null:(h-f.lowerBound)*f.cellWidth/f.range;if(!SC.none(g)){switch(this.get("orientation")){case"vertical":g=f.pixelMax+(d+1)*f.cellWidth-g;break;case"horizontal":g=d*f.cellWidth+g;break}}return g},cellDataToCoordinate:function(d,f){return this.cellDataToCoordinateUsingCache(d,f,this.get("info"))},dataToCoordinate:function(d){return this.cellDataToCoordinate(0,d)},dataToCoordinateUsingCache:function(f,d){return this.cellDataToCoordinateUsingCache(0,f,d)},coordinateToDataGivenCell:function(d,k){var l=0,g=this.get("fullCellWidth"),h,m,f,i,j;if(g!==0){h=this.getPath("model.lowerBound");m=this.getPath("model.upperBound");if(this.get("orientation")==="vertical"){f=this.get("pixelMax")+g*(d+1);i=f-g;k+=this.get("pixelMax")}else{f=this.get("pixelMin")+g*d;i=f+g;k+=this.get("pixelMin")}j=k-f;l=h+j*(m-h)/(i-f)}return l},coordinateToData:function(d){return this.coordinateToDataGivenCell(this.whichCell(d),d)},increment:function(){return this.coordinateToData(1)-this.coordinateToData(0)}.property("model.lowerBound","model.upperBound","frame").cacheable(),desiredExtent:function(){var d=arguments.callee.base.apply(this,arguments)+c+b+this.get("maxNumberExtent");return d}.property("maxNumberExtent"),forEachTickDo:function(f){var i,h=this.getPath("model.lowerBound"),k=this.getPath("model.upperBound"),j=this.getPath("model.tickGap"),d=Math.ceil(h/j)*j,l=Math.abs((k-d)/j),g;for(i=0;i<=l;i++){g=d+i*j;f(g,this.dataToCoordinate(g))}},_isDragging:false,_lowerBoundAtDragStart:null,_upperBoundAtDragStart:null,_dilationAnchorCoord:null,_dragPanel:null,_lowerPanel:null,_midPanel:null,_upperPanel:null}}()));DG.Analysis={EAttributeType:{eNone:0,eNumeric:1,eCategorical:2},EAnalysisRole:{eInvalid:-1,eNone:0,ePrimaryNumeric:1,eSecondaryNumeric:2,ePrimaryCategorical:3,eSecondaryCategorical:4,eLegendNumeric:5,eLegendCategorical:6},kNullAttribute:-1};DG.AttributePlacementDescription=SC.Object.extend({attribute:function(a,b){if(!SC.none(b)){this._attributes=[b];this.setupStats()}return(this._attributes.length>0)?this._attributes[0]:DG.Analysis.kNullAttribute}.property(),attributes:function(){return this._attributes}.property(),attributeAt:function(a){if((a>=0)&&(a<this._attributes.length)){return this._attributes[a]}else{return DG.Analysis.kNullAttribute}},attributeIDAt:function(b){var a=this.attributeAt(b);return(a!==DG.Analysis.kNullAttribute)?a.get("id"):null},addAttribute:function(a){if(!this._attributes.contains(a)){this._attributes.push(a)}this.setupStats();this.invalidateCaches();this.notifyPropertyChange("attribute")},removeAttributeAtIndex:function(a){DG.assert(a<this._attributes.length);this._attributes.splice(a,1);this.invalidateCaches();this.notifyPropertyChange("attribute")},removeAttribute:function(a){this._attributes.removeObject(a);this.invalidateCaches();this.notifyPropertyChange("attribute")},removeAllAttributes:function(){this._attributes=[];this.setPath("attributeStats.attributes",[]);this.invalidateCaches();this.notifyPropertyChange("attribute")},attributeStats:null,_attributes:null,init:function(){arguments.callee.base.apply(this,arguments);this._attributes=[];this.attributeStats=DG.AttributeStats.create()},setupStats:function(){this.attributeStats.beginPropertyChanges();this.attributeStats.set("collectionClient",this.get("collectionClient"));this.attributeStats.set("attributes",this.get("attributes"));this.attributeStats.endPropertyChanges()},attributeID:function(){var a=this.get("attribute");return(a!==DG.Analysis.kNullAttribute)?a.get("id"):null}.property("attribute"),isNumeric:function(){var a=this.get("attributeType");return a===DG.Analysis.EAttributeType.eNumeric}.property("attributeType"),hasFormula:function(){var a=this.getPath("attribute.formula");return !SC.empty(a)}.property(),attributeType:function(){var a=this.get("attributeStats");if(SC.none(a)){return DG.Analysis.EAttributeType.eNone}else{return a.get("attributeType")}}.property("attributeStats.attributeType"),role:DG.Analysis.EAnalysisRole.eNone,collectionClient:null,collectionClientDidChange:function(){this.setPath("attributeStats.collectionClient",this.get("collectionClient"))}.observes("collectionClient"),invalidateCaches:function(c,b){var a=this.get("attributeStats");if(a){a.invalidateCaches(c,b)}},casesForCategory:function(b){var a=this.getPath("attributeStats.cellMap");return a?a[b]:[]}});DG.AttributeStats=SC.Object.extend({attributes:null,numericStats:null,categoricalStats:null,_cases:null,_numericCacheIsValid:null,_categoricalCacheIsValid:null,_attributeType:DG.Analysis.EAttributeType.eNone,init:function(){arguments.callee.base.apply(this,arguments);this.attributes=[];this.numericStats=DG.UnivariateStats.create();this._numericCacheIsValid=true;this.categoricalStats=DG.CategoricalStats.create();this._categoricalCacheIsValid=true},attributeDidChange:function(){this.invalidateCaches();this.set("attributeType",null)}.observes("attributes"),invalidateCaches:function(l,g){function f(o,n){return SC.none(n)||(o<n)}function k(o,n){return SC.none(n)||(o>n)}var i=function(n,o){var p={},q=n.getNumValue(o,p);if(isFinite(q)){this.numericStats.incrementProperty("count");this.numericStats.set("sum",this.numericStats.sum+q);if(f(q,this.numericStats.rangeMin)){this.numericStats.set("rangeMin",q)}if(k(q,this.numericStats.rangeMax)){this.numericStats.set("rangeMax",q)}if(q>0){if(f(q,this.numericStats.positiveMin)){this.numericStats.set("positiveMin",q)}if(k(q,this.numericStats.positiveMax)){this.numericStats.set("positiveMax",q)}}this.numericStats.setIfChanged("squaredDeviations",null)}else{if(p.isNominal){this.numericStats.setIfChanged("attributeType",DG.Analysis.EAttributeType.eCategorical)}}}.bind(this),b=function(o,p){var q=o.getStrValue(p);if(!SC.empty(q)){var n=this.getPath("categoricalStats.cellMap");if(SC.none(n[q])){n[q]=[]}n[q].push(o);this.categoricalStats.incrementProperty("count");this.setPath("categoricalStats.cellMap",n)}}.bind(this);this._cases=l||this._cases;if(g&&((g.operation==="createCase")||(g.operation==="createCases"))){var d=g.result.caseIDs||[g.result.caseID],c=this.getPath("attribute.id"),j=this.get("attributeType"),h=this.get("attributes"),a=this._numericCacheIsValid,m=this._categoricalCacheIsValid&&(j===DG.Analysis.EAttributeType.eCategorical);if(a){this.numericStats.beginPropertyChanges()}if(m){this.categoricalStats.beginPropertyChanges()}d.forEach(function(o){var n=DG.store.find(DG.Case,o);if(n){h.forEach(function(p){c=p.get("id");if(a){i(n,c)}if(m){b(n,c)}else{this.setIfChanged("_categoricalCacheIsValid",false)}}.bind(this))}}.bind(this));if(a){this.numericStats.endPropertyChanges()}if(m){this.categoricalStats.endPropertyChanges()}return}this.setIfChanged("_numericCacheIsValid",false);this.setIfChanged("_categoricalCacheIsValid",false)},minMax:function(){if(!this._numericCacheIsValid){this._computeNumericStats()}var a=this.numericStats.get("numericRange");return{min:a.min,max:a.max,isDataInteger:this.numericStats.get("dataIsInteger")}}.property(),attributeType:function(a,b){if(b!==undefined){this._attributeType=b}if(!SC.none(this._attributeType)){return this._attributeType}var c=this.get("attributes");if(c.length===0){return DG.Analysis.EAttributeType.eNone}switch(c[0].get("type")){case"nominal":return DG.Analysis.EAttributeType.eCategorical;case"numeric":return DG.Analysis.EAttributeType.eNumeric;default:}if(!this._numericCacheIsValid){this._computeNumericStats()}return this.getPath("numericStats.attributeType")}.property("attributes","numericStats.attributeType"),_computeNumericStats:function(){var f=this._cases,o=this.get("attributes"),p=0,m,i=true,b=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,c=Number.MAX_VALUE,h=-Number.MAX_VALUE,g=0,k=0,l=0,d,a=[];function n(q){var r=Number(q);if(!SC.empty(q)&&isFinite(r)){p++;if(r<b){b=r}if(r>j){j=r}g+=r;a.push(r);if(r>0){c=Math.min(r,c);h=Math.max(r,h)}}else{if((typeof q!=="number")&&!SC.empty(q)){r=String(q);if(i&&!SC.empty(r)){i=false}}}}this.numericStats.reset();this.numericStats.beginPropertyChanges();if(SC.isArray(f)){o.forEach(function(q){var r=q.get("id");f.forEach(function(s){n(s.getValue(r))})})}if(p>0){this.numericStats.set("count",p);this.numericStats.set("sum",g);this.numericStats.set("rangeMin",b);this.numericStats.set("rangeMax",j);d=g/p;a.forEach(function(r){var q=r-d;k+=q;l+=q*q});l-=k*k/p;this.numericStats.set("squaredDeviations",l);if(c<=h){this.numericStats.set("positiveMin",c);this.numericStats.set("positiveMax",h)}}m=i?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical;this.numericStats.set("attributeType",m);this._numericCacheIsValid=true;this.numericStats.endPropertyChanges()},numberOfCells:function(){if(!this._categoricalCacheIsValid){this._computeCategoricalStats()}return this.getPath("categoricalStats.numberOfCells")}.property("categoricalStats.numberOfCells"),numericRange:function(){if(!this._numericCacheIsValid){this._computeNumericStats()}return this.getPath("numericStats.numericRange")}.property("numericStats.numericRange"),numericRangeDidChange:function(){this.notifyPropertyChange("numericRange")}.observes("numericStats.numericRange"),dataDidChange:function(){if((this.get("attributeType")===DG.Analysis.EAttributeType.eCategorical)&&!this._categoricalCacheIsValid){var a=this.categoricalStats.get("numberOfCells"),b;this._computeCategoricalStats();b=this.categoricalStats.get("numberOfCells");if(b!==a){this.notifyPropertyChange("numberOfCells")}}}.observes("_categoricalCacheIsValid"),cellMap:function(){if(!this._categoricalCacheIsValid){this._computeCategoricalStats()}return this.categoricalStats.get("cellMap")}.property("categoricalStats.cellMap"),cellNameToCellNumber:function(a){if(!this._categoricalCacheIsValid){this._computeCategoricalStats()}return this.categoricalStats.cellNameToCellNumber(a)},_computeCategoricalStats:function(){var d=this._cases,f=this.get("attributes"),c=0,a={};function b(h,g){var i=String(g);if(!SC.none(g)&&!SC.empty(i)){if(SC.none(a[i])){a[i]=[]}a[i].push(h);c++}}this.categoricalStats.reset();if(SC.isArray(d)){f.forEach(function(h){var g=h.get("colormap");if(g){DG.ObjectMap.forEach(g,function(j){a[j]=[]})}var i=h.get("id");d.forEach(function(j){b(j,j.getValue(i))})});this.categoricalStats.beginPropertyChanges();this.categoricalStats.set("cellMap",a);this.categoricalStats.set("count",c);this.categoricalStats.endPropertyChanges()}this._categoricalCacheIsValid=true}});DG.CategoricalStats=SC.Object.extend({count:null,cellMap:null,_prevNumberOfCells:0,init:function(){arguments.callee.base.apply(this,arguments);this.cellMap=[]},numberOfCells:function(){return DG.ObjectMap.length(this.cellMap)}.property("cellMap"),countDidChange:function(){var a=this.get("numberOfCells");if(a!==this._prevNumberOfCells){this.notifyPropertyChange("numberOfCells")}this._prevNumberOfCells=a}.observes("count"),cellNameToCellNumber:function(a){return SC.empty(a)?null:DG.ObjectMap.keys(this.cellMap).indexOf(a.toString())},reset:function(){this.set("count",0);this.set("cellMap",[])}});DG.PlotDataConfiguration=SC.Object.extend({dataContext:null,attributesByPlace:null,collectionClient:function(){return this.chooseChildCollection(this.get("xCollectionClient"),this.get("yCollectionClient"))||DG.currDocumentController().collectionDefaults().collectionClient}.property("xCollectionClient","yCollectionClient"),xCollectionClient:function(){return this.getPath("xAttributeDescription.collectionClient")}.property("xAttributeDescription.collectionClient"),yCollectionClient:function(){return this.getPath("yAttributeDescription.collectionClient")}.property("yAttributeDescription.collectionClient"),legendCollectionClient:function(){return this.getPath("legendAttributeDescription.collectionClient")}.property("legendAttributeDescription.collectionClient"),xCollectionDidChange:function(){this.notifyPropertyChange("xCollectionClient")},yCollectionDidChange:function(){this.notifyPropertyChange("yCollectionClient")},legendCollectionDidChange:function(){this.notifyPropertyChange("legendCollectionClient")},xAttributeDescription:function(a,b){return this.attributeDescriptionForPlace(a,b,DG.GraphTypes.EPlace.eX)}.property(),yAttributeDescription:function(a,b){return this.attributeDescriptionForPlace(a,b,DG.GraphTypes.EPlace.eY)}.property(),legendAttributeDescription:function(a,b){return this.attributeDescriptionForPlace(a,b,DG.GraphTypes.EPlace.eLegend)}.property(),attributeDescriptionForPlace:function(b,c,a){if(c){DG.assert(c instanceof DG.AttributePlacementDescription);this.attributesByPlace[a][0]=c}return !SC.none(this.attributesByPlace)?this.attributesByPlace[a][0]:null}.property(),firstAttributeDescriptionForRole:function(a){return this.firstPlaceAndAttributeDescriptionForRole(a).attributeDescription},firstAttributeIDForRole:function(b){var a=this.firstPlaceAndAttributeDescriptionForRole(b);return a.attributeDescription.get("attributeID")},getPlaceForRole:function(a){return this.firstPlaceAndAttributeDescriptionForRole(a).place},xAttributeID:function(){return this.getPath("xAttributeDescription.attributeID")}.property("xAttributeDescription.attributeID"),yAttributeID:function(){return this.getPath("yAttributeDescription.attributeID")}.property("yAttributeDescription.attributeID"),legendAttributeID:function(){return this.getPath("legendAttributeDescription.attributeID")}.property("legendAttributeDescription.attributeID"),xIsNumeric:function(){return this.getPath("xAttributeDescription.isNumeric")}.property("xAttributeDescription.isNumeric"),yIsNumeric:function(){return this.getPath("yAttributeDescription.isNumeric")}.property("yAttributeDescription.isNumeric"),xType:function(){return this.getPath("xAttributeDescription.attributeType")}.property("xAttributeDescription.attributeType"),yType:function(){return this.getPath("yAttributeDescription.attributeType")}.property("yAttributeDescription.attributeType"),attributeAssignment:null,hasAggregates:function(){var b={},c,a=function(d){var g=this.getPath(d+"AttributeDescription.collectionClient"),f=g&&g.get("id");if(!SC.none(f)){b[f]=g}}.bind(this);a("x");a("y");a("legend");c=DG.ObjectMap.findKey(b,function(f,d){return d&&d.get("hasAggregates")});return !SC.none(c)}.property(),yAttributeIDAt:function(a){return this.get("yAttributeDescription").attributeIDAt(a)},_hiddenCases:null,hiddenCases:function(a,b){if(b){this._hiddenCases=b;this.invalidateCaches()}return this._hiddenCases}.property(),init:function(){arguments.callee.base.apply(this,arguments);this._hiddenCases=[]},destroy:function(){var a=this.get("xAttributeDescription"),c=this.get("yAttributeDescription"),b=this.get("legendAttributeDescription");if(a){a.removeObserver("collectionClient",this,"xCollectionDidChange")}if(c){c.removeObserver("collectionClient",this,"yCollectionDidChange")}if(b){b.removeObserver("collectionClient",this,"legendCollectionDidChange")}this._hiddenCases=[];arguments.callee.base.apply(this,arguments)},setAttributeAndCollectionClient:function(b,f,g,d){var a=this.get(b);a.removeAllAttributes();a.beginPropertyChanges();a.set("collectionClient",(f&&f.collection)||null);if(!SC.none(f)){f.attributes.forEach(function(h){a.addAttribute(h)})}if(!SC.none(g)){a.set("role",g)}if(!SC.none(d)){a.setPath("attributeStats.attributeType",d)}else{var c=a.get("isNumeric")?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical;a.setPath("attributeStats.attributeType",c)}this._casesCache=null;a.invalidateCaches(this.get("cases"));a.endPropertyChanges()},setAttributeType:function(f,g){DG.assert(typeof f==="string");DG.assert(typeof g==="boolean");var b=this.get(f),c=(g?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical),a=b&&b.get("attribute"),d=b&&b.get("attributeStats");DG.assert(a!==DG.Analysis.kNullAttribute);b.invalidateCaches(this.get("cases"));if(d){d.set("attributeType",c)}},chooseChildCollection:function(d,c){var b=d&&!d.get("areParentChildLinksConfigured"),a=c&&!c.get("areParentChildLinksConfigured");if(b||a){if(!SC.none(d)&&(d.getCaseCount()>0)&&!SC.none(d.getCaseAt(0).get("parent"))){return d}else{if(SC.none(c)){return d}else{return c}}}if(!SC.none(d)&&!SC.none(c)){if(d.isDescendantOf(c)){return d}if(c.isDescendantOf(d)){return c}}return d||c||null},plottedCollectionIDs:function(){var d=[],a=this.get("collectionClient"),b=a&&a.get("id"),c=["xCollectionClient","yCollectionClient","legendCollectionClient"];if(a&&!SC.none(b)){d.push(b)}c.forEach(function(f){var h=this.get(f),g=h&&h.get("id");if(!SC.none(g)){if(d.indexOf(g)<0){d.push(g)}}}.bind(this));return d}.property("collectionClient","xCollectionClient","yCollectionClient","legendCollectionClient").cacheable(),_casesCache:null,allCases:function(){var a=this.get("collectionClient")||DG.currDocumentController().collectionDefaults().collectionClient;return a?a.getPath("casesController.arrangedObjects"):null}.property(),cases:function(){if(SC.none(this._casesCache)){var g=this.get("allCases"),c=this.get("hiddenCases"),b,f=[],d=[],a=this.get("attributesByPlace");if(g){b=DG.ArrayUtils.subtract(g,c,function(h){return h.get("id")});[DG.GraphTypes.EPlace.eX,DG.GraphTypes.EPlace.eY].forEach(function(h){a[h].forEach(function(j){var i=j.get("attributeID");if(!SC.none(i)){d.push(i)}})});b.forEach(function(h){var i=true;d.forEach(function(j){if(!h.hasValue(j)){i=false}});if(i){f.push(h)}})}this._casesCache=f}return this._casesCache}.property("xCollectionClient","yCollectionClient","legendCollectionClient"),getCaseCount:function(){return this.getPath("cases.length")},selection:function(){var a=this.getPath("collectionClient.casesController.selection");a=a?a.toArray():[];return DG.ArrayUtils.subtract(a,this.get("hiddenCases"),function(b){return b.get("id")})}.property("xCollectionClient","yCollectionClient","legendCollectionClient","hiddenCases"),attributeAssignmentDidChange:function(){this.notifyPropertyChange("attributeAssignment")}.observes(".xAttributeDescription.attribute",".yAttributeDescription.attribute",".legendAttributeDescription.attribute"),forEachAttribute:function(a){this.get("attributesByPlace").forEach(function(b){b.forEach(a)})},firstAttributeDescriptionSuchThat:function(g){var c=this.get("attributesByPlace"),h=c.length,d;for(d=0;d<h;d++){var b=c[d],a=!SC.none(b)?b.length:0,f;for(f=0;f<a;f++){if(g(b[f])){return{attributeDescription:b[f],place:d}}}}return{attributeDescription:null,place:DG.GraphTypes.EPlace.eUndefined}},firstPlaceAndAttributeDescriptionForRole:function(a){return this.firstAttributeDescriptionSuchThat(function(b){return b.get("role")===a})},invalidateAxisDescriptionCaches:function(b,a){this.get("xAttributeDescription").invalidateCaches(b,a);this.get("yAttributeDescription").invalidateCaches(b,a);this.get("legendAttributeDescription").invalidateCaches(b,a)},invalidateCaches:function(d,c){var b;if(!d&&c&&this._casesCache&&((c.operation==="createCase")||(c.operation==="createCases"))){var f=c.collection&&c.collection.get("id");if(f&&(this.get("plottedCollectionIDs").indexOf(f)<0)){return}var a=c.result.caseIDs||[c.result.caseID];a.forEach(function(h){var g=DG.store.find(DG.Case,h);if(g){this._casesCache.push(g)}}.bind(this));b=this._casesCache}else{this._casesCache=null;b=d||this.get("cases")}this.invalidateAxisDescriptionCaches(b,c)},hiddenCasesDidChange:function(){this._casesCache=null;this.invalidateAxisDescriptionCaches()}.observes("hiddenCases"),arrangedObjectArrays:function(){var b=this.get("xCollectionClient"),f=this.get("yCollectionClient"),a=this.get("legendCollectionClient"),c=!SC.none(b)?[b.casesController.arrangedObjects()]:[];if((b!==f)&&!SC.none(f)){c.push(f.casesController.arrangedObjects())}else{if(!SC.none(a)&&(a!==b)&&(a!==f)){c.push(a.casesController.arrangedObjects())}}if(c.length===0){var d=DG.currDocumentController().collectionDefaults().collectionClient;if(d){c.push(d.casesController.arrangedObjects())}}return c}.property("xCollectionClient","yCollectionClient","legendCollectionClient"),getDataMinAndMaxForDimension:function(a){var b;switch(a){case DG.GraphTypes.EPlace.eX:b=this.get("xAttributeDescription");break;case DG.GraphTypes.EPlace.eY:b=this.get("yAttributeDescription");break;case DG.GraphTypes.EPlace.eLegend:b=this.get("legendAttributeDescription");break}return b.getPath("attributeStats.minMax")},hideCases:function(a){this.set("hiddenCases",this.get("hiddenCases").concat(a).uniq())},showCases:function(a){this.set("hiddenCases",DG.ArrayUtils.subtract(this.get("hiddenCases"),a,function(b){return b.get("id")}))},showAllCases:function(){this.set("hiddenCases",[])},restoreHiddenCases:function(a){if(SC.none(a)){return}this.set("hiddenCases",a.map(function(b){return DG.store.find(DG.Case,b)}))}});sc_require("components/graph_map_common/plot_data_configuration");DG.GraphDataConfiguration=DG.PlotDataConfiguration.extend({init:function(){var d={x:DG.AttributePlacementDescription.create(),y:DG.AttributePlacementDescription.create(),legend:DG.AttributePlacementDescription.create()},b,c=DG.currDocumentController().collectionDefaults();arguments.callee.base.apply(this,arguments);var a=function(g,i,f,k){var l=d[g],h=c["plot"+i+"Attr"],j=c["plot"+i+"AttrIsNumeric"];DG.assert(l);if(h){l.set("collectionClient",c.collectionClient);l.set("attribute",h);l.setPath("attributeStats.attributeType",SC.none(h)?DG.Analysis.EAttributeType.eNone:j?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical);l.set("role",SC.none(h)?DG.Analysis.EAnalysisRole.eNone:j?f:k)}else{l.set("collectionClient",null);l.removeAllAttributes()}l.addObserver("collectionClient",this,g+"CollectionDidChange")}.bind(this);a("x","X",DG.Analysis.EAnalysisRole.ePrimaryNumeric,DG.Analysis.EAnalysisRole.ePrimaryCategorical);a("y","Y",DG.Analysis.EAnalysisRole.eSecondaryNumeric,DG.Analysis.EAnalysisRole.eSecondaryCategorical);a("legend","Legend",DG.Analysis.EAnalysisRole.eLegendNumeric,DG.Analysis.EAnalysisRole.eLegendCategorical);this.attributesByPlace=[];for(b=0;b<DG.GraphTypes.EPlace.eNumPlaces;b++){this.attributesByPlace[b]=[]}this.attributesByPlace[DG.GraphTypes.EPlace.eX][0]=d.x;this.attributesByPlace[DG.GraphTypes.EPlace.eY][0]=d.y;this.attributesByPlace[DG.GraphTypes.EPlace.eLegend][0]=d.legend}});DG.UnivariateStats=SC.Object.extend({count:0,attributeType:null,dataIsInteger:null,sum:null,squaredDeviations:null,rangeMin:null,rangeMax:null,numericRange:function(){return{min:this.get("rangeMin"),max:this.get("rangeMax")}}.property("rangeMin","rangeMax"),positiveMin:null,positiveMax:null,isEmpty:function(){return !this.count}.property("count"),mean:function(){return !this.isEmpty()?this.sum/this.count:NaN}.property("count","sum").cacheable(),hasRange:function(){return DG.isFinite(this.rangeMin)&&DG.isFinite(this.rangeMax)}.property("rangeMin","rangeMax").cacheable(),reset:function(){this.beginPropertyChanges();this.set("count",0);this.set("attributeType",null);this.set("dataIsInteger",null);this.set("sum",null);this.set("squaredDeviations",null);this.set("rangeMin",null);this.set("rangeMax",null);this.set("positiveMin",null);this.set("positiveMax",null);this.endPropertyChanges()}});sc_require("controllers/component_controller");DG.GraphController=DG.ComponentController.extend((function(){function a(d,b){var c=b.collection&&b.collection.get("id");return d&&!SC.none(c)&&d.getCollectionByID(c)}return{dataContext:null,graphModel:null,xAxisView:null,yAxisView:null,plotView:null,legendView:null,axisMultiTarget:null,attributeMenu:null,menuAnchorView:null,createComponentStorage:function(){var i={_links_:{}},b=this.get("dataContext"),g=this.getPath("graphModel.dataConfiguration"),h=g&&g.get("hiddenCases"),d=this.getPath("graphModel.plots");var c=function(n){var l=g&&g.get(n+"CollectionClient"),m=g&&g.get(n+"AttributeDescription"),k=(m&&m.get("attributes"))||[];if(l&&(k.length>0)){i._links_[n+"Coll"]=l.toLink();var j=n+"Attr";k.forEach(function(o){DG.ArchiveUtils.addLink(i,j,o)})}i[n+"Role"]=m.get("role");i[n+"AttributeType"]=m.get("attributeType")};var f=function(k){var j=this.getPath("graphModel."+k+"Axis");if(j){i[k+"AxisClass"]=String(j.constructor)}if(j&&j.get("isNumeric")){i[k+"LowerBound"]=j.get("lowerBound");i[k+"UpperBound"]=j.get("upperBound")}}.bind(this);if(b){i._links_.context=b.toLink()}c("x");c("y");c("legend");f("x");f("y");if(d){i.plotModels=[];d.forEach(function(j){i.plotModels.push({plotModelStorage:j.createStorage(),plotClass:String(j.constructor)})})}if(h){i.hiddenCases=h.map(function(j){return j.get("id")})}return i},restoreComponentStorage:function(i,k){var h=this.get("graphModel"),j=this.getLinkID(i,"context"),d=null;if(!SC.none(j)){d=DG.DataContext.retrieveContextFromMap(k,j);if(d){this.set("dataContext",d);this.setPath("graphModel.dataConfiguration.dataContext",d)}}if(SC.none(i._links_)){return}h.restoreStorage(i);h.stopAnimation();if(i.plotModelStorage){var b=h.get("plot");if(b){b.restoreStorage(i.plotModelStorage)}}else{if(i.plotModels){var g=h.get("plots");g.forEach(function(m,l){m.restoreStorage(i.plotModels[l].plotModelStorage)})}}var f=h.get("xAxis"),c=h.get("yAxis");if(f&&f.get("isNumeric")&&isFinite(i.xLowerBound)&&isFinite(i.xUpperBound)){f.setLowerAndUpperBounds(i.xLowerBound,i.xUpperBound)}if(c&&c.get("isNumeric")&&isFinite(i.yLowerBound)&&isFinite(i.yUpperBound)){c.setLowerAndUpperBounds(i.yLowerBound,i.yUpperBound)}},dataContextDidChange:function(){var b=this.get("graphModel");if(b){b.set("dataContext",this.get("dataContext"))}}.observes("dataContext"),modelDidChange:function(){var b=this.getPath("model.content");this.set("graphModel",b);if(b){b.set("dataContext",this.get("dataContext"))}}.observes("model"),viewDidChange:function(){var c=this.get("view"),b=c&&c.get("contentView");if(b){this.set("xAxisView",b.get("xAxisView"));this.set("yAxisView",b.get("yAxisView"));this.set("plotView",b.get("plotBackgroundView"));this.set("legendView",b.get("legendView"));this.set("axisMultiTarget",b.get("yAxisMultiTarget"));b.set("controller",this)}}.observes("view"),gearMenuItems:function(){var b=this.getPath("graphModel");return SC.none(b)?[]:b.getGearMenuItems()}.property("graphModel"),rescaleAxes:function(){this.graphModel.rescaleAxes()},plotFunction:function(){this.graphModel.get("plot").togglePlotFunction()},init:function(){arguments.callee.base.apply(this,arguments);this.attributeMenu=SC.MenuPane.create({layout:{width:200,height:150}});this.attributeMenu.selectedAxis=null;this.attributeMenu.addObserver("selectedItem",this,this.attributeMenuItemChanged);this.menuAnchorView=SC.View.create({layout:{left:0,width:20,top:0,height:20},backgroundColor:"transparent",isVisible:false})},addAxisHandler:function(b){var d=this,c=b.get("labelNodes");if(SC.isArray(c)){c.forEach(function(h,g){function f(i){d.setupAttributeMenu(i,b,g)}if(!SC.none(h.events)){h.unmousedown(f)}h.mousedown(f)})}},axisViewChanged:function(c,d){var f=this,b=this.get(d);if(!SC.none(b)){b.addObserver("labelNode",this,function(){f.addAxisHandler(b)})}}.observes("xAxisView","yAxisView","legendView"),setupAttributeMenu:function(b,c,j){var h=this.get("graphModel"),f={left:b.layerX,top:b.layerY,height:20,width:20},d=c.get("orientation"),i=(d==="horizontal")?[0,2,1,3,0]:[0,1,3,2,0],l=((c.instanceOf(DG.LegendView))?"legend":((d==="horizontal")?"x":"y")),k;k=this.getAttributeMenuItems();k.push({isSeparator:YES});var g=false;k.push(h.createRemoveAttributeMenuItem(l,g,j));k.push(h.createChangeAttributeTypeMenuItem(l,g,j));this.attributeMenu.set("items",k);this.attributeMenu.selectedAxis=d;this.attributeMenu.isLegend=c.instanceOf(DG.LegendView);SC.RunLoop.begin();this.menuAnchorView.removeFromParent();c.appendChild(this.menuAnchorView);this.menuAnchorView.set("layout",f);this.menuAnchorView.set("isVisible",true);SC.RunLoop.end();this.attributeMenu.popup(this.menuAnchorView,i)},getAttributeMenuItems:function(){var f=this.getPath("dataContext.childCollection"),c=f&&f.get("name"),d=f?f.getAttributeNames():[],h=d.map(function(k){return{title:k,collection:f}}),i=this.getPath("dataContext.parentCollection"),j=i&&i.get("name"),g=i?i.getAttributeNames():[],b=g.map(function(k){return{title:k,collection:i}});if(b.length===0){return h}else{if(h.length===0){return b}else{return[{title:c,subMenu:h},{title:j,subMenu:b}]}}},attributeMenuItemChanged:function(){var f=this.attributeMenu.selectedItem,b=f&&f.collection,h=this.attributeMenu.selectedAxis,c,d=this.get("graphModel"),g=this.get("dataContext");if(!f){return}if(b){c={collection:b,attributes:[b.attrsController.objectAt(f.contentIndex)]};if(this.attributeMenu.isLegend){d.changeAttributeForLegend(g,c)}else{d.changeAttributeForAxis(g,c,h)}}else{if(f.target===d){f.itemAction.apply(f.target,f.args)}}this.menuAnchorView.set("isVisible",false)},axisViewDidAcceptDrop:function(f,d,c){if(SC.none(c)){return}var g=this.get("dataContext"),b=a(g,c);f.dragData=null;this.get("graphModel").changeAttributeForAxis(g,{collection:b,attributes:[c.attribute]},f.get("orientation"))}.observes("*xAxisView.dragData","*yAxisView.dragData"),multiTargetDidAcceptDrop:function(f,d,c){if(SC.none(c)){return}var g=this.get("dataContext"),b=a(g,c);f.dragData=null;this.get("graphModel").addAttributeToAxis(g,{collection:b,attribute:c.attribute})}.observes("*axisMultiTarget.dragData"),plotOrLegendViewDidAcceptDrop:function(c,f,d){if(SC.none(d)){return}var g=this.get("dataContext"),b=a(g,d);c.dragData=null;this.get("graphModel").changeAttributeForLegend(g,{collection:b,attributes:[d.attribute]})}.observes("*plotView.dragData","*legendView.dragData")}}()));sc_require("alpha/destroyable");DG.DataDisplayModel=SC.Object.extend(DG.Destroyable,{autoDestroyProperties:["dataConfiguration"],dataConfiguration:null,collectionClient:null,collectionClientBinding:"*dataConfiguration.collectionClient",casesController:null,casesControllerBinding:"*dataConfiguration.collectionClient.casesController",cases:null,casesBinding:"*dataConfiguration.cases",selection:function(){return this.getPath("dataConfiguration.selection")}.property("dataConfiguration.selection"),_oldNumberOfCases:0,init:function(){arguments.callee.base.apply(this,arguments)},destroy:function(){if(this._dataContext){this._dataContext.removeObserver("changeCount",this,"handleDataContextNotification")}arguments.callee.base.apply(this,arguments)},_dataContext:null,dataContext:function(a,b){if(b){if(b!==this._dataContext){if(this._dataContext){this._dataContext.removeObserver("changeCount",this,"handleDataContextNotification")}this._dataContext=b;if(this._dataContext){this._dataContext.addObserver("changeCount",this,"handleDataContextNotification")}}return this}return this._dataContext}.property(),dataContextDidChange:function(){var a=this.get("dataConfiguration");if(a){a.set("dataContext",this.get("dataContext"))}}.observes("dataContext"),deleteSelectedCases:function(){var a={operation:"deleteCases",cases:DG.copy(this.get("selection"))};this.get("dataContext").applyChange(a)},selectAll:function(d){var c=SC.none(d)?true:!!d,b=c?this.get("cases"):null,a={operation:"selectCases",collection:this.get("collectionClient"),cases:b,select:c};this.get("dataContext").applyChange(a);DG.logUser(d?"selectAll":"deselectAll")},instantiateAttributeRefFromStorage:function(f,l,h){var b={collection:null,attributes:[]},d=this.getPath("dataConfiguration.dataContext");if(SC.empty(l)||SC.empty(h)||!f||!f._links_){return b}var c=f._links_[l],a=c&&c.id&&d.getCollectionByID(c.id),j=[],g=DG.ArchiveUtils.getLinkCount(f,h),k;if(!a){return b}for(k=0;k<g;k++){var i=a.getAttributeByID(DG.ArchiveUtils.getLinkID(f,h,k));if(i){j.push(i)}}return{collection:a,attributes:j}},restoreStorage:function(a){this.get("dataConfiguration").restoreHiddenCases(a.hiddenCases)},handleOneDataContextChange:function(a,b){},buildIndices:function(b){var a=this.getPath("dataConfiguration.cases");if((b.operation==="updateCases")&&a&&!SC.none(b.cases)&&!this.getPath("dataConfiguration.hasAggregates")){var d={},c=SC.IndexSet.create();b.cases.forEach(function(f){d[f.get("id")]=f});a.forEach(function(g,h){var f=g.get("id");if(d[f]){c.add(h)}});return c}return SC.IndexSet.create(0,this.getPath("dataConfiguration.cases.length"))},handleDataContextNotification:function(c){var b=c.get("newChanges"),a=b.length,d;for(d=0;d<a;d++){this.handleOneDataContextChange(c,b[d])}},dataRangeDidChange:function(d,c,b,a){this.invalidate()},invalidate:function(b,a){this.get("dataConfiguration").invalidateCaches(null,b)}});sc_require("components/graph_map_common/data_display_model");DG.GraphModel=DG.DataDisplayModel.extend({autoDestroyProperties:["plot","xAxis","yAxis","legend"],numberToggle:null,xAxis:null,yAxis:null,legend:null,plot:function(a,b){if(!SC.none(b)){this._plots.forEach(function(c){c.removeObserver("connectingLine",this,this.connectingLineChanged);c.destroy()});this._plots=[b];b.addObserver("connectingLine",this,this.connectingLineChanged)}return(this._plots.length<1)?null:this._plots[0]}.property(),_plots:null,plots:function(){return this._plots}.property(),lastPlot:function(){var a=this._plots.length;return(a>0)?this._plots[a-1]:null}.property(),getPlotAtIndex:function(a){if(a<this._plots.length){return this._plots[a]}return null},addPlot:function(b){if(!this._plots.contains(b)){var a=this.get("plot");if(a.isAdornmentVisible("connectingLine")){b.toggleAdornmentVisibility("connectingLine")}this._plots.push(b)}},removePlotAtIndex:function(a){DG.assert(a<this._plots.length);var b=this._plots[a];this._plots.splice(a,1);b.destroy();this._plots.forEach(function(d,c){d.setIfChanged("yAttributeIndex",c)})},aboutToChangeConfiguration:false,xAxisChanged:function(){var a=this.get("plot");if(!SC.none(a)){a.set("xAxis",this.get("xAxis"))}}.observes("xAxis"),yAxisChanged:function(){var a=this.get("plot");if(!SC.none(a)){a.set("yAxis",this.get("yAxis"))}}.observes("yAxis"),connectingLineChanged:function(){var a=this.get("plots"),b=(a.length>0)?a[0].getAdornmentModel("connectingLine").get("isVisible"):false;this.get("plots").forEach(function(d,c){if(c>0){d.setAdornmentVisibility("connectingLine",b)}})},init:function(){var d,a,b;arguments.callee.base.apply(this,arguments);function c(f){if(f===DG.Analysis.EAttributeType.eNumeric){return DG.CellLinearAxisModel}else{if(f===DG.Analysis.EAttributeType.eCategorical){return DG.CellAxisModel}else{return DG.AxisModel}}}this.set("dataConfiguration",DG.GraphDataConfiguration.create());this._plots=[];if(DG.IS_INQUIRY_SPACE_BUILD){this.set("numberToggle",DG.NumberToggleModel.create({dataConfiguration:this.get("dataConfiguration")}))}d=this.dataConfiguration.get("xAttributeDescription");a=this.dataConfiguration.get("yAttributeDescription");b=this.dataConfiguration.get("legendAttributeDescription");this.set("xAxis",c(d.get("attributeType")).create());this.setPath("xAxis.attributeDescription",d);this.set("yAxis",c(a.get("attributeType")).create());this.setPath("yAxis.attributeDescription",a);this.set("legend",DG.LegendModel.create());this.setPath("legend.attributeDescription",b);this.synchPlotWithAttributes();this.invalidate();this.rescaleAxesFromData(true,true)},destroy:function(){arguments.callee.base.apply(this,arguments)},changeAttributeForAxis:function(c,d,f){var a=(f==="horizontal")?"xAttributeDescription":"yAttributeDescription",g=(f==="horizontal")?"xAxis":"yAxis";DG.logUser("plotAxisAttributeChange: { orientation: %@, attribute: %@ }",f,d.attributes[0].get("name"));this.set("aboutToChangeConfiguration",true);var b=this.get("dataConfiguration");b.set("dataContext",c);b.setAttributeAndCollectionClient(a,d);this.privSyncAxisWithAttribute(a,g);this.invalidate();this.set("aboutToChangeConfiguration",false)},changeAttributeForLegend:function(c,d){var a=d&&d.attributes[0];if(a){DG.logUser("legendAttributeChange: { to attribute %@ }",a.get("name"))}else{DG.logUser("legendAttributeRemoved:")}this.set("aboutToChangeConfiguration",true);var b=this.get("dataConfiguration");if(c){b.set("dataContext",c)}b.setAttributeAndCollectionClient("legendAttributeDescription",d);this.invalidate();this.set("aboutToChangeConfiguration",false)},addAttributeToAxis:function(d,c){DG.logUser("addAxisAttribute: { attribute: %@ }",c.attribute.get("name"));var a=this.getPath("dataConfiguration.yAttributeDescription"),b=a.get("attributes").length;a.addAttribute(c.attribute);var f=DG.ScatterPlotModel.create();f.beginPropertyChanges();f.setIfChanged("dataConfiguration",this.get("dataConfiguration"));f.setIfChanged("xAxis",this.get("xAxis"));f.setIfChanged("yAxis",this.get("yAxis"));f.set("yAttributeIndex",b);f.endPropertyChanges();this.addPlot(f);this.notifyPropertyChange("attributeAdded")},hasNumericAxis:function(){return this.getPath("xAxis.isNumeric")||this.getPath("yAxis.isNumeric")}.property(),rescaleAxesFromData:function(a,b){var c=this.get("plot");if(c){c.rescaleAxesFromData(a,b)}},removeLegendAttribute:function(){this.changeAttributeForLegend(null,null)},changeAttributeType:function(b,a,c){var d=this.get("dataConfiguration");DG.logUser("plotAxisAttributeChangeType: { axis: %@, attribute: %@ }",a,d.getPath(b+".attribute.name"));this.set("aboutToChangeConfiguration",true);d.setAttributeType(b,c);if(b==="xAttributeDescription"||b==="yAttributeDescription"){this.privSyncAxisWithAttribute(b,a)}this.invalidate(null,true);this.set("aboutToChangeConfiguration",false)},privSyncAxisWithAttribute:function(f,c){var h=this.get("dataConfiguration"),d=h.getPath(f+".isNumeric"),g=this.getPath(c+".isNumeric");if(g!==d){var b=this.get(c),a=d?DG.CellLinearAxisModel.create():DG.CellAxisModel.create();a.set("attributeDescription",h.get(f));this.set(c,a);b.destroy();this.synchPlotWithAttributes()}},synchPlotWithAttributes:function(){var b=this.get("dataConfiguration"),j=b.get("xType"),i=b.get("yType"),f=this.get("plot"),a,k,h,d,c={};d=[[DG.CasePlotModel,DG.DotPlotModel,DG.DotChartModel],[DG.DotPlotModel,DG.ScatterPlotModel,DG.DotPlotModel],[DG.DotChartModel,DG.DotPlotModel,DG.DotChartModel]];a=d[j][i];if(SC.none(a)){a=DG.PlotModel}a.configureRoles(b);if(SC.none(f)||(a!==f.constructor)){k=h=a.create()}else{h=f}if(f&&h!==f){c=f.copyAdornmentModels(h)}h.beginPropertyChanges();h.setIfChanged("dataConfiguration",b);h.setIfChanged("xAxis",this.get("xAxis"));h.setIfChanged("yAxis",this.get("yAxis"));for(var g in c){if(c.hasOwnProperty(g)){h.setIfChanged(g,c[g])}}h.endPropertyChanges();this.setIfChanged("plot",h);if(!SC.none(k)&&!SC.none(f)){f.destroy()}},removeAttribute:function(c,b,a){var f=function(){var m=g.getPath(c+".attribute.name"),k=this.get(b),i=DG.AxisModel.create(),j=(c==="xAttributeDescription")?"yAttributeDescription":"xAttributeDescription",n,l;DG.logUser("attributeRemoved: %@",m);this.set("aboutToChangeConfiguration",true);i.set("attributeDescription",g.get(c));this.set(b,i);k.destroy();g.setAttributeAndCollectionClient(c,null);switch(this.getPath("dataConfiguration."+j+".attributeType")){case DG.Analysis.EAttributeType.eNumeric:n=DG.Analysis.EAnalysisRole.eSecondaryNumeric;l=DG.Analysis.EAnalysisRole.ePrimaryNumeric;break;case DG.Analysis.EAttributeType.eCategorical:n=DG.Analysis.EAnalysisRole.eSecondaryCategorical;l=DG.Analysis.EAnalysisRole.ePrimaryCategorical;break;default:n=DG.Analysis.EAnalysisRole.eNone;l=DG.Analysis.EAnalysisRole.eNone}g.get(c).set("role",n);g.get(j).set("role",l);this.synchPlotWithAttributes();this.invalidate();this.set("aboutToChangeConfiguration",false)}.bind(this),d=function(){var i=g.get(c);i.removeAttributeAtIndex(a);this.removePlotAtIndex(a);this.notifyPropertyChange("attributeRemoved")}.bind(this);a=a||0;var g=this.get("dataConfiguration"),h=g.getPath(c+".attributes");if(h.length===1){f()}else{d()}},restoreStorage:function(d){var c=this.getPath("dataConfiguration.dataContext"),k,g,j,m=DG.Core.classFromClassName(d.xAxisClass),l=this.get("xAxis"),b=DG.Core.classFromClassName(d.yAxisClass),i=this.get("yAxis"),o=l.constructor,p=i.constructor,n=this.get("dataConfiguration");var a=function(q){q.forEach(function(r,s){if(!r.plotClass){return}var t=DG.Core.classFromClassName(r.plotClass).create({_isBeingRestored:true});t.beginPropertyChanges();t.setIfChanged("dataConfiguration",n);t.setIfChanged("xAxis",this.get("xAxis"));t.setIfChanged("yAxis",this.get("yAxis"));t.setIfChanged("yAttributeIndex",s);t.endPropertyChanges();if(s===0){this.set("plot",t)}else{this.addPlot(t)}}.bind(this))}.bind(this);arguments.callee.base.apply(this,arguments);k=this.instantiateAttributeRefFromStorage(d,"xColl","xAttr");g=this.instantiateAttributeRefFromStorage(d,"yColl","yAttr");j=this.instantiateAttributeRefFromStorage(d,"legendColl","legendAttr");this.set("aboutToChangeConfiguration",true);n.setAttributeAndCollectionClient("xAttributeDescription",k,d.xRole,d.xAttributeType);n.setAttributeAndCollectionClient("yAttributeDescription",g,d.yRole,d.yAttributeType);n.setAttributeAndCollectionClient("legendAttributeDescription",j,d.legendRole,d.legendAttributeType);this.set("aboutToChangeConfiguration",false);if(m&&m!==o){var h=m.create();h.set("attributeDescription",n.get("xAttributeDescription"));this.set("xAxis",h);l.destroy()}if(b&&b!==p){var f=b.create();f.set("attributeDescription",n.get("yAttributeDescription"));this.set("yAxis",f);i.destroy()}a((d.plotClass?[{plotClass:d.plotClass}]:null)||d.plotModels||[]);this.get("plots").forEach(function(q){q._isBeingRestored=null})},getGearMenuItems:function(){var c=this,b=this.get("plot");if(SC.none(b)){return[]}var a=function(){var d=c.get("selection"),f=d&&d.get("length")!==0;return[{title:"Select All",target:c,itemAction:c.selectAll,isEnabled:true},{title:"Delete Selected Cases",target:c,itemAction:c.deleteSelectedCases,isEnabled:f}]};return b.getGearMenuItems().concat(a()).concat([{isSeparator:YES}]).concat(this.createHideShowAttributeSubMenuItems())},createHideShowAttributeSubMenuItems:function(){var f=this.getPath("dataConfiguration.selection").toArray(),g=f&&f.get("length")!==0,b=this.getPath("dataConfiguration.cases"),c=f&&b&&(f.get("length")<b.length),h=this.getPath("dataConfiguration.hiddenCases").length>0,a=(f&&f.length>1)?"Plural":"Sing",i=(f&&b&&(b.length-f.length>1))?"Plural":"Sing";function k(){DG.logUser("Hide %@ selected cases",f.length);this.get("dataConfiguration").hideCases(f)}function j(){var l=DG.ArrayUtils.subtract(b,f,function(m){return m.get("id")});DG.logUser("Hide %n selected cases",l.length);this.get("dataConfiguration").hideCases(l)}function d(){DG.logUser("Show all cases");this.get("dataConfiguration").showAllCases()}return[{title:("DG.GraphMenu.hideSelected"+a),isEnabled:g,target:this,itemAction:k},{title:("DG.GraphMenu.hideUnselected"+i),isEnabled:c,target:this,itemAction:j},{title:"DG.GraphMenu.showAll",isEnabled:h,target:this,itemAction:d}]},createRemoveAttributeMenuItem:function(a,g,i){i=i||0;var b=a+"AttributeDescription",l=a+"Axis",j=this.getPath("dataConfiguration."+b+".attributes"),k=(SC.isArray(j)&&i<j.length)?j[i]:DG.Analysis.kNullAttribute,f=(k===DG.Analysis.kNullAttribute)?"":k.get("name"),h=g?"attribute_":"removeAttribute_",c=("DG.GraphMenu."+h+a).loc(f),d=((a==="x"||a==="y")?this.removeAttribute:this.removeLegendAttribute);return{title:c,target:this,itemAction:d,isEnabled:(k!==DG.Analysis.kNullAttribute),args:[b,l,i]}},createChangeAttributeTypeMenuItem:function(g){var d=g+"AttributeDescription",h=g+"Axis",c=this.getPath("dataConfiguration."+d),b=c&&c.get("attribute"),f=c&&c.get("isNumeric"),a=(f?"DG.GraphMenu.treatAsCategorical":"DG.GraphMenu.treatAsNumeric").loc();return{title:a,target:this,itemAction:this.changeAttributeType,isEnabled:(b!==DG.Analysis.kNullAttribute),args:[d,h,!f]}},stopAnimation:function(){this.get("plot").stopAnimation();this.get("xAxis").stopAnimation();this.get("yAxis").stopAnimation()},isParentCase:function(a){var b=a.get("parent");return SC.none(b)},handleOneDataContextChange:function(b,d){var c=this.get("plot"),a=d&&d.operation;if(c&&!c.isAffectedByChange(d)){return}switch(a){case"createCase":case"createCases":case"deleteCases":this.dataDidChange(null,null,d);break;case"updateCases":case"createAttributes":case"updateAttributes":this.get("dataConfiguration").invalidateCaches(null,d);d.indices=this.buildIndices(d);this.dataRangeDidChange(this,"revision",this,d.indices);break;case"selectCases":break}this.get("plots").forEach(function(f){f.handleDataContextNotification(b,d)})},handleDataContextNotification:function(a){arguments.callee.base.apply(this,arguments);if(this.get("numberToggle")){this.get("numberToggle").handleDataContextNotification(a)}},dataDidChange:function(a,d,h){var i=this.get("plot");if(i&&i.isAffectedByChange(h)){this.invalidate(h);var b=this.get("dataConfiguration"),j=b&&b.get("cases"),g=j?j.length:0;if(g!==this._oldNumberOfCases){var f=(g>this._oldNumberOfCases);if(i&&f){var c=j[g-1];if(this.isParentCase(c)){i.set("openParentCaseID",c.get("id"))}i.rescaleAxesFromData(false,false)}this._oldNumberOfCases=g}}if(this.getPath("dataConfiguration.hasAggregates")){this.invalidate()}},invalidate:function(c,a){var b=this.get("plot");arguments.callee.base.apply(this,arguments);if(a&&!SC.none(b)){b.invalidateCaches()}}});DG.GraphTypes={EPlace:{eUndefined:-1,eX:0,eY:1,eLegend:2,eNumPlaces:3}};DG.GraphView=SC.View.extend({displayProperties:["model.dataConfiguration.attributeAssignment"],classNames:"graph-view".w(),model:null,controller:null,xAxisView:null,yAxisView:null,yAxisMultiTarget:null,legendView:null,plotBackgroundView:null,numberToggleView:null,rescaleButton:null,plotView:function(a,b){if(!SC.none(b)){this._plotViews.forEach(function(c){c.destroy()});this._plotViews=[b]}return(this._plotViews.length<1)?null:this._plotViews[0]}.property(),_plotViews:null,plotViews:function(){return this._plotViews}.property(),addPlotView:function(a){if(!this._plotViews.contains(a)){this._plotViews.push(a)}},setPlotViewProperties:function(c,a,b){c.beginPropertyChanges();c.setIfChanged("paperSource",this.get("plotBackgroundView"));c.setIfChanged("model",a);c.setIfChanged("xAxisView",this.xAxisView);c.setIfChanged("yAxisView",this.yAxisView);c.setIfChanged("parentView",this);if(!SC.none(b)){c.set("cachedPointCoordinates",b)}c.addObserver("plotDisplayDidChange",this,function(){this.invokeLast(this.drawPlots)});c.endPropertyChanges()},init:function(){function c(o){switch(o.constructor){case DG.AxisModel:return DG.AxisView;case DG.CellLinearAxisModel:return DG.CellLinearAxisView;case DG.CellAxisModel:return DG.CellAxisView}return null}var h=function(){this.get("model").rescaleAxesFromData(true,true)}.bind(this);var g=this.getPath("model.xAxis"),f=this.getPath("model.yAxis"),a={orientation:"horizontal"},d={orientation:"vertical"},i=c(g).create(a),n=c(f).create(d),k=DG.PlotBackgroundView.create({xAxisView:i,yAxisView:n,graphModel:this.get("model")}),b=this.getPath("model.plots"),l=DG.LegendView.create();arguments.callee.base.apply(this,arguments);this.createMultiTarget();this._plotViews=[];this.set("xAxisView",i);this.appendChild(i);this.set("yAxisView",n);this.appendChild(n);this.set("plotBackgroundView",k);this.appendChild(k);this.set("legendView",l);this.appendChild(l);if(DG.IS_INQUIRY_SPACE_BUILD){var m=DG.NumberToggleView.create({model:this.getPath("model.numberToggle")});this.set("numberToggleView",m);this.appendChild(m);var j=SC.ImageButtonView.create({classNames:["rescale-button"],layout:{width:16,height:16,right:2,top:1},toolTip:"DG.GraphView.rescale".loc(),action:h});this.set("rescaleButton",j);this.appendChild(j)}i.set("model",g);n.set("model",f);b.forEach(function(p){var o=this.mapPlotModelToPlotView(p).create();this.addPlotView(o);this.setPlotViewProperties(o,p)}.bind(this));l.set("model",this.getPath("model.legend"));DG.globalsController.addObserver("globalValueChanges",this,"globalValueDidChange")},destroy:function(){DG.globalsController.removeObserver("globalValueChanges",this,"globalValueDidChange");this.model.destroy();arguments.callee.base.apply(this,arguments)},drawPlots:function(){var b=this.get("plotViews"),a=b.length;this.get("plotViews").forEach(function(d,c){if(d.readyToDraw()){d.doDraw(c,a)}})},selectPointsInRect:function(d,g){var a=[];g=g||[];var f=this.getPath("model.dataContext"),c=this.getPath("model.collectionClient");if(SC.none(f)){return}this.get("plotViews").forEach(function(h){var i=h.getCasesForPointsInRect(d);a=a.concat(i)});var b={operation:"selectCases",collection:c,cases:g.concat(a),select:true};if(b.cases.length===0){b.cases=null;b.select=false}f.applyChange(b)},handleBackgroundClick:function(a){this.get("plotView").handleBackgroundClick(a)},handleBackgroundDblClick:function(a){this.get("plotView").handleBackgroundDblClick(a)},renderLayout:function(b,a){if(this._isRenderLayoutInProgress){return}this._isRenderLayoutInProgress=true;arguments.callee.base.apply(this,arguments);var h=this.get("xAxisView"),n=this.get("yAxisView"),i=this.get("plotBackgroundView"),f=this.get("plotViews"),l=this.get("legendView"),o=this.get("numberToggleView"),k=this.get("rescaleButton"),g=!SC.none(o)&&o.shouldShow(),m=SC.none(h)?0:h.get("desiredExtent"),d=SC.none(n)?0:n.get("desiredExtent"),j=SC.none(l)?0:l.get("desiredExtent"),c=g?o.get("desiredExtent"):0;if(!SC.none(h)&&!SC.none(n)&&(f.length>0)){if(a){h.set("layout",{left:d,bottom:j,height:m});n.set("layout",{left:0,top:c,bottom:m+j,width:d});i.set("layout",{left:d,top:c,bottom:m+j});l.set("layout",{bottom:0,height:j});if(o){o.set("layout",{left:d,height:c})}}else{h.adjust("left",d);h.adjust("bottom",j);h.adjust("height",m);n.adjust("bottom",m+j);n.adjust("width",d);n.adjust("top",c);i.adjust("left",d);i.adjust("top",c);i.adjust("bottom",m+j);l.adjust("height",j);if(o){o.adjust("height",c)}}if(o){o.set("isVisible",g)}if(k){k.set("isVisible",this.getPath("model.hasNumericAxis"))}}this._isRenderLayoutInProgress=false},viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.renderLayout(this.renderContext(this.get("tagName")));this.invokeOnce(this.drawPlots)},_isRenderLayoutInProgress:false,handleAxisModelChange:function(){var d=this,b=false,c=this.get("plotBackgroundView");function a(n,m){var l=d.getPath(n),g=l&&l.constructor,o=d.get(m),h=o&&o.constructor,j,f,i=d.get("plotView"),k=(m==="xAxisView")?{orientation:"horizontal"}:{orientation:"vertical"};switch(g){case DG.AxisModel:j=DG.AxisView;break;case DG.CellAxisModel:j=DG.CellAxisView;break;case DG.CellLinearAxisModel:j=DG.CellLinearAxisView;break;default:j=null}if(j&&(h!==j)){f=j.create(k);f.set("model",l);d.removeChild(o);d.appendChild(f);d.set(m,f);c.set(m,f);if(!SC.none(i)){i.set(m,f)}o.destroy();d.controller.set(m,f);b=true}}a("model.xAxis","xAxisView");a("model.yAxis","yAxisView");this.renderLayout(this.renderContext(this.get("tagName")),b)}.observes(".model.xAxis",".model.yAxis"),handlePlotModelChange:function(){var g=this.getPath("model.plot"),f=this.get("plotView"),c=f.constructor,h,a,d,b=false;a=this.mapPlotModelToPlotView(g);if(a&&(c!==a)){d=a.create();b=true}if(!SC.none(d)){if(!SC.none(f)){h=f.get("cachedPointCoordinates")}this.setPlotViewProperties(d,g,h);if(d.readyToDraw()){d.doDraw()}this.set("plotView",d);if(b){this.renderLayout(this.renderContext(this.get("tagName")),b)}}}.observes(".model.plot"),handleAttributeAdded:function(){var b=this.getPath("model.lastPlot"),a;if(!SC.none(b)){a=DG.ScatterPlotView.create();this.addPlotView(a);this.renderLayout(this.renderContext(this.get("tagName")),false);this.setPlotViewProperties(a,b)}}.observes("model.attributeAdded"),handleAttributeRemoved:function(){var a=this.getPath("model.plots"),c=this.get("plotViews"),b;c.forEach(function(f,d){if(a.indexOf(f.get("model"))<0){b=d;f.removePlottedElements(true);f.destroy()}});c.splice(b,1)}.observes("model.attributeRemoved"),configurationIsAboutToChange:function(){var a=this.get("plotView");if(this.getPath("model.aboutToChangeConfiguration")){a.prepareForConfigurationChange()}else{a.handleConfigurationChange()}}.observes(".model.aboutToChangeConfiguration"),handleAxisOrLegendLayoutChange:function(){this.renderLayout(this.renderContext(this.get("tagName")))}.observes("*xAxisView.desiredExtent","*yAxisView.desiredExtent","*legendView.desiredExtent"),handleNumberToggleCaseCountChange:function(){this.renderLayout(this.renderContext(this.get("tagName")))}.observes("model.numberToggle.caseCount"),globalValueDidChange:function(){var a=this.get("plotView");if(a){a.refreshCoordinates()}},mapPlotModelToPlotView:function(b){var c=b&&b.constructor,a=null;switch(c){case DG.PlotModel:a=DG.PlotView;break;case DG.CasePlotModel:a=DG.CasePlotView;break;case DG.DotPlotModel:a=DG.DotPlotView;break;case DG.ScatterPlotModel:a=DG.ScatterPlotView;break;case DG.DotChartModel:a=DG.DotChartView;break}return a},createMultiTarget:function(){var b=DG.AxisMultiTarget.create(),a=b.get("desiredExtent");this.appendChild(b);b.set("attributeDescription",this.getPath("model.yAxis.attributeDescription"));b.set("otherAttributeDescription",this.getPath("model.xAxis.attributeDescription"));b.set("layout",{left:0,top:0,width:a.width,height:a.height});this.set("yAxisMultiTarget",b)}});sc_require("alpha/destroyable");DG.PlotModel=SC.Object.extend(DG.Destroyable,{dataConfiguration:null,dataContext:function(){return this.getPath("dataConfiguration.dataContext")}.property("dataConfiguration.dataContext"),collectionClient:function(){return this.getPath("dataConfiguration.collectionClient")}.property("dataConfiguration.collectionClient"),cases:function(){return this.getPath("dataConfiguration.cases")}.property("dataConfiguration.cases"),casesController:null,casesControllerBinding:"*dataConfiguration.collectionClient.casesController",selection:function(){return this.getPath("dataConfiguration.selection")}.property("dataConfiguration.selection"),xVarID:function(){return this.getPath("dataConfiguration.xAttributeID")}.property("dataConfiguration.xAttributeID"),yAttributeIndex:0,yVarID:function(){var a=this.get("dataConfiguration");return a?a.yAttributeIDAt(this.yAttributeIndex):null}.property("dataConfiguration.yAttributeID"),legendVarID:function(){return this.getPath("dataConfiguration.legendAttributeID")}.property("dataConfiguration.legendAttributeID"),primaryVarID:function(){switch(this.get("primaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xVarID");case DG.GraphTypes.EPlace.eY:return this.get("yVarID");default:return null}}.property("xVarID","yVarID"),secondaryVarID:function(){switch(this.get("secondaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xVarID");case DG.GraphTypes.EPlace.eY:return this.get("yVarID");default:return null}}.property("xVarID","yVarID"),xAxis:null,yAxis:null,autoDestroyProperties:["plotAnimator","caseValueAnimator"],plotAnimator:null,caseValueAnimator:null,_adornmentModels:null,plottedCount:null,isPlottedCountVisible:function(){return !SC.none(this.plottedCount)&&this.plottedCount.get("isVisible")}.property("plottedCount"),togglePlottedCount:function(){if(SC.none(this.plottedCount)){this.beginPropertyChanges();this.set("plottedCount",DG.PlottedCountModel.create({plotModel:this}));this.setAdornmentModel("plottedCount",this.get("plottedCount"));this.plottedCount.recomputeValue();this.endPropertyChanges()}else{var a=!this.plottedCount.get("isVisible");this.plottedCount.set("isVisible",a)}DG.logUser("togglePlottedCount: %@",this.plottedCount.get("isVisible")?"show":"hide")},init:function(){arguments.callee.base.apply(this,arguments);this._adornmentModels={};this.addObserver("dataConfiguration",this,"dataConfigurationDidChange");this.addObserver("xAxis",this,"xAxisDidChange");this.addObserver("yAxis",this,"yAxisDidChange")},destroy:function(){this.set("xAxis",null);this.set("yAxis",null);this.removeObserver("xAxis",this,"xAxisDidChange");this.removeObserver("yAxis",this,"yAxisDidChange");this.set("dataConfiguration",null);this.removeObserver("dataConfiguration",this,"dataConfigurationDidChange");DG.ObjectMap.forEach(this._adornmentModels,function(a,b){if(b&&b.destroy){b.destroy()}});this._adornmentModels=null;arguments.callee.base.apply(this,arguments)},_observedXAxis:null,_observedYAxis:null,xAxisDidChange:function(){if(this._observedXAxis){this._observedXAxis.removeObserver("lowerBound",this,"axisBoundsDidChange");this._observedXAxis.removeObserver("upperBound",this,"axisBoundsDidChange");this._observedXAxis=null}var a=this.get("xAxis");if(a){a.addObserver("lowerBound",this,"axisBoundsDidChange");a.addObserver("upperBound",this,"axisBoundsDidChange");this._observedXAxis=a}},yAxisDidChange:function(){if(this._observedYAxis){this._observedYAxis.removeObserver("lowerBound",this,"axisBoundsDidChange");this._observedYAxis.removeObserver("upperBound",this,"axisBoundsDidChange");this._observedYAxis=null}var a=this.get("yAxis");if(a){a.addObserver("lowerBound",this,"axisBoundsDidChange");a.addObserver("upperBound",this,"axisBoundsDidChange");this._observedYAxis=a}},dataArrays:function(){return this.getPath("dataConfiguration.arrangedObjectArrays")}.property("dataConfiguration"),isAnimating:false,getAdornmentModel:function(a){DG.assert(this._adornmentModels);DG.assert(a);return a&&this._adornmentModels[a]},setAdornmentModel:function(a,b){DG.assert(this._adornmentModels);DG.assert(a);this._adornmentModels[a]=b;this.notifyPropertyChange(a)},isAdornmentVisible:function(b){var a=this.getAdornmentModel(b);return a?a.get("isVisible"):false},setAdornmentVisibility:function(d,c){var b=this.getAdornmentModel(d);if(!b){var a=DG.PlotAdornmentModel.registry[d];DG.assert(a,"No model class registered for '%@'".fmt(d));b=a&&a.create({plotModel:this});if(b){this.setAdornmentModel(d,b)}}if(b&&(this.isAdornmentVisible(d)!==c)){b.set("isVisible",c);this.notifyPropertyChange(d)}},toggleAdornmentVisibility:function(b,a){DG.assert(!SC.empty(b));var c=this.getAdornmentModel(b),d=c&&c.get("isVisible");this.setAdornmentVisibility(b,!d);DG.logUser("%@: %@",a||"toggle"+b,!d?"show":"hide");return c},getAxisForPlace:function(a){switch(a){case DG.GraphTypes.EPlace.eX:return this.get("xAxis");case DG.GraphTypes.EPlace.eY:return this.get("yAxis");default:return null}},invalidateCaches:function(){this.notifyPropertyChange("plotConfiguration")},handleDataConfigurationChange:function(){},rescaleAxesFromData:function(c,b,a){},axisBoundsDidChange:function(){this.notifyPropertyChange("axisBounds")},animateSelectionBackToStart:function(a,b){if(SC.none(this.caseValueAnimator)){this.caseValueAnimator=DG.CaseValueAnimator.create()}else{this.caseValueAnimator.endAnimation()}this.caseValueAnimator.set("dataContext",this.get("dataContext"));this.caseValueAnimator.set("cases",DG.copy(this.get("selection")));this.caseValueAnimator.set("attributeIDs",a);this.caseValueAnimator.set("deltas",b);this.caseValueAnimator.animate()},getGearMenuItems:function(){var a=(this.get("isPlottedCountVisible")?"DG.PlotModel.hideCount":"DG.PlotModel.showCount").loc();return[{title:a,target:this,itemAction:this.togglePlottedCount}]},forEachCaseDo:function(a){var b=this.get("cases");if(!SC.none(b)){b.forEach(a)}},getPlottedCollectionIDs:function(){return this.getPath("dataConfiguration.plottedCollectionIDs")||[]},getPlottedAttributeIDs:function(){var c=[],b=this.get("dataConfiguration"),a=["xAttributeID","yAttributeID","legendAttributeID"];if(!b){return c}a.forEach(function(d){var f=b.get(d);if(!SC.none(f)&&(f!==DG.Analysis.kNullAttribute)){if(c.indexOf(f)<0){c.push(f)}}});return c},getPlottedAttributesIncludeIDs:function(b){var c=this.getPlottedAttributeIDs(),a=false;b.forEach(function(d){if(c.indexOf(d)>=0){a=true}});return a},getPlottedAttributesContainFormulas:function(){var c=false,b=this.get("dataConfiguration"),a=["xAttributeDescription","yAttributeDescription","legendAttributeDescription"];if(!b){return false}a.forEach(function(d){var f=b.get(d);if(f&&f.get("hasFormula")){c=true}});return c},isAffectedByChange:function(d){var a=false;if(!d||!d.operation){return false}switch(d.operation){case"updateCases":var c=d.attributeIDs;if(c){a=this.getPlottedAttributesIncludeIDs(c);return a||this.getPlottedAttributesContainFormulas()}case"createCase":case"createCases":var b=d.collection&&d.collection.get("id"),f=this.getPlottedCollectionIDs();return !b||(f.indexOf(b)>=0);case"deleteCases":case"selectCases":return true;case"createAttributes":case"updateAttributes":if(d.result&&d.result.attrIDs){a=this.getPlottedAttributesIncludeIDs(d.result.attrIDs)}return a||this.getPlottedAttributesContainFormulas()}return true},handleDataContextNotification:function(a,b){this.set("lastChange",b)},_observedDataConfiguration:null,dataConfigurationDidChange:function(c,a){if(this._observedDataConfiguration&&(a==="dataConfiguration")){this._observedDataConfiguration.removeObserver("cases",this,"dataConfigurationDidChange");this._observedDataConfiguration.removeObserver("attributeAssignment",this,"dataConfigurationDidChange");this._observedDataConfiguration.removeObserver("arrangedObjectArrays",this,"sourceArraysDidChange");this._observedDataConfiguration.removeObserver("hiddenCases",this,"hiddenCasesDidChange");this._observedDataConfiguration=null}var b=this.get("dataConfiguration");if(b){this.invalidateCaches();this.handleDataConfigurationChange();if(a==="dataConfiguration"){b.addObserver("cases",this,"dataConfigurationDidChange");b.addObserver("attributeAssignment",this,"dataConfigurationDidChange");b.addObserver("arrangedObjectArrays",this,"sourceArraysDidChange");b.addObserver("hiddenCases",this,"hiddenCasesDidChange");this._observedDataConfiguration=b}}},sourceArraysDidChange:function(b,a){this.invalidateCaches();this.notifyPropertyChange("dataArrays")},selectCaseByIndex:function(d,g){var f=this.get("cases"),b=f[d],a=this.get("selection"),c={operation:"selectCases",collection:this.get("collectionClient"),cases:[b],select:true,extend:g};if(a.get("length")!==0){if(a.contains(b)){if(g){c.select=false}else{return}}else{c.select=true}}this.get("dataContext").applyChange(c);if(c.select){DG.logUser("caseSelected: %@",d)}else{DG.logUser("caseDeselected: %@",d)}},stopAnimation:function(){var a=this.get("plotAnimator"),b=this.get("caseValueAnimator");if(!SC.none(a)){a.endAnimation()}if(!SC.none(b)){b.endAnimation()}},hiddenCasesDidChange:function(){if(!this._isBeingRestored){this.invalidateCaches();this.rescaleAxesFromData(false,true)}},createStorage:function(){var a={};if(DG.ObjectMap.length(this._adornmentModels)>0){a.adornments={};DG.ObjectMap.forEach(this._adornmentModels,function(b,d){var c=d.createStorage&&d.createStorage();if(DG.ObjectMap.length(c)){a.adornments[b]=c}})}return a},moveAdornmentStorage:function(c,b,a){if(a){if(!c.adornments){c.adornments={}}c.adornments[b]=a}},restoreStorage:function(a){DG.ObjectMap.forEach(a.adornments,function(d,c){var b=DG.PlotAdornmentModel.registry[d],f=b&&b.create({plotModel:this});if(f){f.restoreStorage(c);this.setAdornmentModel(d,f);this.set(d,f)}}.bind(this))},copyAdornmentModels:function(a){DG.assert((typeof a==="object")&&(a instanceof DG.PlotModel));var b={};if(this.get("isPlottedCountVisible")){DG.log("transferring Show Count to new plot of type %@",a.constructor);b.plottedCount=DG.PlottedCountModel.create({plotModel:a})}return b},getCellCaseCounts:function(){DG.assert(false,"derived classes must override getCellCaseCounts()");return[]}});DG.PlotModel.configureRoles=function(a){};sc_require("components/graph/plots/plot_model");DG.CasePlotModel=DG.PlotModel.extend({worldValues:null,getWorldCoords:function(b){if(SC.none(this.worldValues)){this.worldValues=[]}var a=this.worldValues;if((b>=a.length)||SC.none(a[b])){a[b]={x:Math.random(),y:Math.random()}}return a[b]},setWorldCoords:function(a,b){if(SC.none(this.worldValues)){this.worldValues=[]}this.worldValues[a]=b},mixUp:function(){this.set("worldValues",[])},getGearMenuItems:function(){var a=this;return[{title:"DG.PlotModel.mixup",target:a,itemAction:a.mixUp,localize:true}].concat(arguments.callee.base.apply(this,arguments))},getCellCaseCounts:function(){var a=[];var c=this.get("cases");var b=c.length;a.push({count:b,primaryCell:0,secondaryCell:0});return a}});DG.PlotUtilities={kAxisColor:"#ccc",kRuleColor:"#ddd",kRuleWidth:1,kZeroLineColor:"#555",kZeroLineWidth:1,kDefaultMovableLineColor:"steelblue",kLineHighlightColor:"rgba(255, 0, 0, 0.3)",kPlotCellFill:"rgba(128, 128, 128, 0)",kPlotCellStroke:"#eee",kStrokeDarkerFactor:3,kPointRadiusLogBase:2,kPointRadiusMax:10,kPointRadiusMin:5,kDefaultPointOpacity:0.85,kDefaultStripWidth:4,kMarqueeColor:"rgba(128, 128, 128, 0.3)",kDotClassName:"data-dot",kSelectedDotClassName:"data-dot-selected",kColoredDotClassName:"data-dot-colored",kSelectedColoredDotClassName:"data-dot-colored-selected",kDotClassPattern:/data-dot[a-z\-]*/g,kToolTipClassName:"data-tip",kToolTipShadowClassName:"data-tip-shadow",kToolTipTextClassName:"data-tip-text",kStripClassName:"data-strip",kSelectedStripClassName:"data-strip-selected",kColoredStripClassName:"data-strip-colored",kSelectedColoredStripClassName:"data-strip-colored-selected",kLegendKey:"legend-key",kLegendKeyName:"legend-key-name",kDefaultAnimationTime:1000,kDataTipShowTime:500,kHighlightShowTime:100,kHighlightHideTime:250,kDataHoverTransform:"s1.5",kDataCreateTransform:"s2",lineToAxisIntercepts:function(j,b,f,c){function k(){return{left:f.get("lowerBound"),top:c.get("upperBound"),right:f.get("upperBound"),bottom:c.get("lowerBound")}}var i,d,h,a,l=k();if(Math.abs(j)>1){d=l.bottom;i=(d-b)/j;if(i<l.left){i=l.left;d=j*i+b}else{if(i>l.right){i=l.right;d=j*i+b}}a=l.top;h=(a-b)/j;if(h>l.right){h=l.right;a=j*h+b}else{if(h<l.left){h=l.left;a=j*h+b}}}else{i=l.left;d=j*i+b;if(d<l.bottom){d=l.bottom;i=(d-b)/j}else{if(d>l.top){d=l.top;i=(d-b)/j}}h=l.right;a=j*h+b;if(a>l.top){a=l.top;h=(a-b)/j}else{if(a<l.bottom){a=l.bottom;h=(a-b)/j}}}if(i>h){var g=i;i=h;h=g;g=d;d=a;a=g}return{pt1:{x:i,y:d},pt2:{x:h,y:a}}},closestScreenPtGivenScreenPtAndWorldLine:function(h,a,i,g){var f=i.coordinateToData(h.x),d=g.coordinateToData(h.y),c=(a.slope===0)?f:(d-a.intercept+(f/a.slope))/(a.slope+(1/a.slope)),b=a.slope*c+a.intercept;return{x:i.dataToCoordinate(c),y:g.dataToCoordinate(b)}},lineIntersectsPlotArea:function(b,g,h,d){DG.assert(isFinite(b));var i=h.get("lowerBound"),a=h.get("upperBound"),c=d.get("lowerBound"),f=d.get("upperBound");return DG.MathUtilities.isInRange(b*i+g,c,f)||DG.MathUtilities.isInRange(b*a+g,c,f)||DG.MathUtilities.isInRange((c-g)/b,i,a)||DG.MathUtilities.isInRange((f-g)/b,i,a)},isPointInPlotArea:function(b,c,a){return DG.MathUtilities.isInRange(b.x,c.get("lowerBound"),c.get("upperBound"))&&DG.MathUtilities.isInRange(b.y,a.get("lowerBound"),a.get("upperBound"))},findFractionDigitsForAxis:function(d){var b=(d.get("pixelMin")+d.get("pixelMax"))/2,c=d.coordinateToData(b)-d.coordinateToData(b+1),a=Math.floor(Math.log(Math.abs(c))/Math.LN10);return Math.max(-a,0)},findFractionDigitsForRange:function(a){return(a.max-a.min===0)?2:Math.max(-Math.floor(Math.log((a.max-a.min)/1000)/Math.LN10),0)},findNeededFractionDigits:function(n,b,a,k){var h=12,o=a.get("model"),i=k.get("model"),q,d,c,m,g,j=2,p=3;function l(r){r.pt1.x=a.dataToCoordinate(r.pt1.x);r.pt1.y=k.dataToCoordinate(r.pt1.y);r.pt2.x=a.dataToCoordinate(r.pt2.x);r.pt2.y=k.dataToCoordinate(r.pt2.y);return r}function f(){var r;r=Math.max(Math.abs(d.pt1.x-q.pt1.x),Math.abs(d.pt1.y-q.pt1.y));r=Math.max(r,Math.abs(d.pt2.x-q.pt2.x));r=Math.max(r,Math.abs(d.pt2.y-q.pt2.y));return r}DG.assert(isFinite(n));if(isNaN(n)||isNaN(b)){return{slopeDigits:0,interceptDigits:0}}q=l(DG.PlotUtilities.lineToAxisIntercepts(n,b,o,i));do{m=DG.MathUtilities.roundToSignificantDigits(b,j);d=l(DG.PlotUtilities.lineToAxisIntercepts(n,m.roundedValue,o,i));c=f();if(c>1){j+=1}}while((c>1)&&(j<h));do{g=DG.MathUtilities.roundToSignificantDigits(n,p);d=l(DG.PlotUtilities.lineToAxisIntercepts(g.roundedValue,b,o,i));c=f();if(c>1){p+=1}}while((c>1)&&(p<h));if(Math.abs(n)>1){p=Math.max(0,p-Math.floor(Math.log(Math.abs(n))/Math.LN10)-1)}if(Math.abs(b)>1){j=Math.max(0,j-Math.floor(Math.log(Math.abs(b))/Math.LN10)-1)}return{slopeDigits:p,interceptDigits:j}},doCreateCircleAnimation:function(a){a.attr({"fill-opacity":0,"stroke-opacity":0});a.animate({"fill-opacity":this.kDefaultPointOpacity,"stroke-opacity":1},this.kDefaultAnimationTime,"<>")},doHideRemoveAnimation:function(a,b){a.animate({"fill-opacity":0,"stroke-opacity":0},this.kDefaultAnimationTime,"<>",function(){if(b){b.removeElement(this)}else{this.remove()}})}};sc_require("alpha/destroyable");sc_require("components/graph/utilities/plot_utilities");DG.PlotLayer=SC.Object.extend(DG.Destroyable,{autoDestroyProperties:["_dataTip"],paperSource:null,paper:function(){return this.getPath("paperSource.paper")}.property("paperSource.paper"),layerManager:function(){return this.getPath("paperSource.layerManager")}.property("paperSource.layerManager"),frame:function(){return this.getPath("paperSource.frame")}.property("paperSource.frame"),elementsToClear:function(){return this.getPath("paperSource._elementsToClear")}.property("paperSource._elementsToClear"),_dataTip:null,dataTip:function(){if(!this._dataTip){this._dataTip=DG.PointDataTip.create({plotLayer:this,layerName:DG.LayerNames.kDataTip})}return this._dataTip}.property(),displayDidChange:function(){this.notifyPropertyChange("plotDisplayDidChange")},model:null,dataContext:function(){return this.getPath("model.dataContext")}.property("model.dataContext"),selection:null,selectionBinding:"*model.casesController.selection",cleanupFunc:null,cleanupDelay:300,cleanupInterval:300,waitingForCleanup:false,timeOfLastCleanupCall:null,cleanupTimer:null,installCleanup:function(){if(!this.cleanupFunc){return}var a=function(){var b=Date.now();if(b-this.timeOfLastCleanupCall>this.cleanupDelay){this.cleanupFunc();this.waitingForCleanup=false;this.cleanupTimer=null}else{this.cleanupTimer=SC.Timer.schedule({target:this,action:a,interval:this.cleanupInterval})}};this.timeOfLastCleanupCall=Date.now();if(!this.waitingForCleanup){this.waitingForCleanup=true;this.cleanupTimer=SC.Timer.schedule({target:this,action:a,interval:this.cleanupInterval})}},changeKey:"dataDidChange",_pointRadius:DG.PlotUtilities.kPointRadiusMax,_isRenderingValid:false,blankDropHint:"DG.GraphView.dropInPlot",plottedAttribute:function(){return this.getPath("model.dataConfiguration.legendAttributeDescription.attribute")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this._plottedElements=[]},modelDidChange:function(b,a){this.dataConfigurationDidChange(b,a);this.addObserver("model.dataConfiguration.cases",this,"dataDidChange");this.addObserver("model.dataConfiguration.hiddenCases",this,"dataDidChange");this.addObserver("model.dataConfiguration.dataContext.selectionChangeCount",this,"selectionChangeCount");this._isRenderingValid=false}.observes("model"),dataConfigurationDidChange:function(b,a){this._pointRadius=this.calcPointRadius();this._isRenderingValid=false},destroy:function(){this.removePlottedElements();this.removeObserver("model.dataConfiguration.cases",this,"dataDidChange");this.removeObserver("model.dataConfiguration.hiddenCases",this,"dataDidChange");this.removeObserver("model.dataConfiguration.dataContext.selectionChangeCount",this,"selectionChangeCount");if(this.cleanupTimer){this.cleanupTimer.invalidate()}this.model=null;arguments.callee.base.apply(this,arguments)},handleDataContextNotification:function(g,c){var f=this.get("model"),h=f&&f.get("lastChange"),b=h&&h.operation;if(!f||!f.isAffectedByChange(h)){return}switch(b){case"createCase":case"createCases":case"deleteCases":var a=this.get("changeKey");if(!SC.empty(a)){var d=this[a];if(d){d.call(this,c)}}break;case"updateCases":case"createAttributes":case"updateAttributes":this.dataRangeDidChange(this,"revision",this,h.indices);break;case"selectCases":this.selectionDidChange();break}}.observes(".model.lastChange"),plotConfigurationDidChange:function(){this._isRenderingValid=false;this.displayDidChange()}.observes(".model.plotConfiguration"),paperSizeDidChange:function(){this._isRenderingValid=false;this.displayDidChange()}.observes("paperSize"),selectionChangeCount:function(){this._elementOrderIsValid=false},prepareToResetCoordinates:function(){},refreshCoordinates:function(){if(this.get("paper")){this.drawData()}},callCreateCircle:function(c,d,b){var a=this.createCircle(c,d,b);if(a){this._plottedElements.push(a);this.getPath("layerManager."+DG.LayerNames.kPoints).push(a)}return a},dataDidChange:function(){if(SC.none(this.get("paper"))){return}var i=this,h=this.getPath("model.cases"),f=this.createRenderContext(),c=h&&h.length,a=this._plottedElements.length,d=(this._pointRadius!==this.calcPointRadius()),g=this.get("layerManager"),b;this._elementOrderIsValid=false;if(d){this._pointRadius=this.calcPointRadius();this._isRenderingValid=false;this.displayDidChange()}this.updateAdornments();if(c>a){if(d){this.prepareToResetCoordinates();for(b=0;b<a;b++){this.setCircleCoordinate(f,h[b],b)}}for(b=a;b<c;b++){this.callCreateCircle(h[b],b,this.animationIsAllowable());this.setCircleCoordinate(f,h[b],b)}this._isRenderingValid=false}if(c<a){for(b=c;b<a;b++){if(!SC.none(this._plottedElements[b])){this._plottedElements[b].stop();g.removeElement(this._plottedElements[b]);DG.PlotUtilities.doHideRemoveAnimation(this._plottedElements[b])}}this._plottedElements.length=c;this.prepareToResetCoordinates();h.forEach(function(j,k){i.setCircleCoordinate(f,h[k],k)});this._isRenderingValid=false;this.displayDidChange()}this.installCleanup()},dataRangeDidChange:function(b,d,a,c){this.updateAdornments();this.get("dataTip").handleChanges(c)},updateAdornments:function(){},animationIsAllowable:function(){var b=Date.now(),a=b-this._timeLastCreate;if(a<DG.PlotUtilities.kDefaultAnimationTime){this._createAnimationOn=false}else{if(b-this._timeLastCreate>this._kAllowableInterval){this._createAnimationOn=true}}this._timeLastCreate=b;return this._createAnimationOn},readyToDraw:function(){return !SC.none(this.get("paper"))},_timeLastCreate:null,_createAnimationOn:true,_kAllowableInterval:1000,animationStateDidChange:function(){if(this.getPath("model.isAnimating")){this.enterAnimationState()}else{this.leaveAnimationState()}}.observes(".model.isAnimating"),enterAnimationState:function(){},leaveAnimationState:function(){},_plottedElements:null,_mustCreatePlottedElements:true,_elementOrderIsValid:false,shouldDraw:function(){return !this._isRenderingValid},drawData:function drawData(){if(!this.get("paper")){return}var g=this,f=this.getPath("model.cases"),c=this.createRenderContext(),d=this.get("layerManager"),a=this._plottedElements.length,b;if(SC.none(f)){return}if(this._mustCreatePlottedElements){this._plottedElements.forEach(function(h){d.removeElement(h)});a=this._plottedElements.length=0;this._mustCreatePlottedElements=false;c.casesAdded=true}if(c.casesRemoved){for(b=f.length;b<a;b++){DG.PlotUtilities.doHideRemoveAnimation(this._plottedElements[b],d)}if(f.length<a){a=this._plottedElements.length=f.length}}if(c.casesAdded){this._pointRadius=this.calcPointRadius()}if(a<f.length){g._elementOrderIsValid=false}if(c.updatedPositions||c.updatedColors||c.casesAdded){this.prepareToResetCoordinates();f.forEach(function(h,i){if(i>=a){g.callCreateCircle(f[i],i,true)}g.setCircleCoordinate(c,f[i],i)})}DG.assert(this._plottedElements.length===f.length)},didDraw:function(){arguments.callee.base.apply(this,arguments);this._isRenderingValid=true},selectionDidChange:function(){this.updateSelection();this._isRenderingValid=false}.observes("selection"),getPlottedElementClass:function(b,a){return(a?(b?DG.PlotUtilities.kSelectedColoredDotClassName:DG.PlotUtilities.kColoredDotClassName):(b?DG.PlotUtilities.kSelectedDotClassName:DG.PlotUtilities.kDotClassName))},updateSelection:function(){if(!this.get("model")){return}if(this._elementOrderIsValid){return}var g=this,b=this._plottedElements,a=this.getPath("model.dataConfiguration.collectionClient.casesController.selection"),f=(this.getPath("model.dataConfiguration.legendAttributeDescription.attribute")!==DG.Analysis.kNullAttribute)||(this.get("numPlots")>1),d=this.get("layerManager"),c=this.getPath("model.cases");if(!c){return}this.getPath("model.cases").forEach(function(j,k){var h,i,m,l;if((k<b.length)&&b[k]){i=b[k];h=a.containsObject(j);m=h?DG.LayerNames.kPoints:DG.LayerNames.kSelectedPoints;l=h?DG.LayerNames.kSelectedPoints:DG.LayerNames.kPoints;i.removeClass(DG.PlotUtilities.kDotClassPattern);i.addClass(g.getPlottedElementClass(h,f));d.moveElementFromTo(i,m,l)}});this._elementOrderIsValid=true},getCasesForPointsInRect:function(b){var c=this.getPath("model.cases"),a=[];this._plottedElements.forEach(function(f,d){if(DG.ViewUtilities.ptInRect({x:f.attrs.cx,y:f.attrs.cy},b)){a.push(c[d])}});return a},removePlottedElements:function(a){var b=this.get("layerManager");this._plottedElements.forEach(function(c){c.stop();if(a){DG.PlotUtilities.doHideRemoveAnimation(c,b)}else{b.removeElement(c)}});this._plottedElements.length=0},drawWidth:function(){return this.get("frame").width-2*DG.ViewUtilities.kBorderWidth}.property("frame"),drawHeight:function(){return this.get("frame").height-2*DG.ViewUtilities.kBorderWidth}.property("frame"),dragData:null,performDragOperation:function(a,b){this.set("dragData",a.data);return SC.DRAG_LINK},showDataTip:function(b,a){this.get("dataTip").show(b.attr("cx"),b.attr("cy"),a)},hideDataTip:function(){var a=this.get("dataTip");if(a){a.hide()}},calcPointRadius:function(){var g=this.getPath("model.dataConfiguration"),b=g?g.getCaseCount():0,f=DG.PlotUtilities.kPointRadiusMax,c=DG.PlotUtilities.kPointRadiusMin,d=DG.PlotUtilities.kPointRadiusLogBase;for(var a=d;a<=b;a=a*d){--f;if(f<=c){break}}DG.assert(f>0&&Math.round(f)===f);return f},createRenderContext:function(){return{}},showHidePlottedElement:function(a,c){var b=a.isHidden();if(c){if(!b){a.stop();a.hide();a.attr({cx:0,cy:0,r:1,fill:DG.ColorUtilities.kMissingValueCaseColor.colorString})}}else{if(b){a.show();a.animate({"fill-opacity":DG.PlotUtilities.kDefaultPointOpacity,"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}}return !c},updatePlottedElement:function(j,c,a,l,i,n,f){var h={cx:c,cy:a,r:l},k=pv.color(i),d;if(k.rgb){d=k.darker(DG.PlotUtilities.kStrokeDarkerFactor).color}else{d=pv.color("#"+i).darker(DG.PlotUtilities.kStrokeDarkerFactor).color}if(j.posAnimation){j.stop(j.posAnimation);j.posAnimation=null}function b(){this.posAnimation=null;if(f){f()}}if(n){j.attr({fill:i,stroke:d});if(j.hoverAnimation){j.stop(j.hoverAnimation);j.hoverAnimation=null;j.transform("")}j.posAnimation=Raphael.animation(h,DG.PlotUtilities.kDefaultAnimationTime,"<>",b);j.animate(j.posAnimation)}else{var m=j.transform(),g=SC.empty(m)||(m.toString()==="s1");if(!g){j.transform("")}h.fill=i;h.stroke=d;j.attr(h);if(!g){j.transform(m)}}},vanishPlottedElement:function(c,a){function d(){this.hide()}var b=this.get("paper").circle(-100,-100,this._pointRadius).toBack().addClass(DG.PlotUtilities.kColoredDotClassName).attr(c).animate(a,DG.PlotUtilities.kDefaultAnimationTime,"<>",d);this.get("elementsToClear").push(b)},updatePointSize:function(){this._pointRadius=this.calcPointRadius();var a={r:this._pointRadius};this._plottedElements.forEach(function(b){b.animate(a,DG.PlotUtilities.kDefaultAnimationTime,"<>")})},didCreateLayer:function(){}});sc_require("components/graph_map_common/plot_layer");DG.PlotView=DG.PlotLayer.extend({autoDestroyProperties:["plottedCountAdorn"],plotIndex:0,numPlots:1,xAxisView:null,yAxisView:null,cachedPointCoordinates:null,transferredPointCoordinates:null,allowTransferAnimation:true,_areAdornmentsInitialized:false,plottedCountAdorn:null,init:function(){arguments.callee.base.apply(this,arguments)},destroy:function(){arguments.callee.base.apply(this,arguments)},axisBoundsDidChange:function(){this._isRenderingValid=false;this.displayDidChange()}.observes(".model.axisBounds"),updateAdornments:function(){if(this.plottedCountAdorn){this.plottedCountAdorn.get("model").setComputingNeeded();this.plottedCountAdorn.updateToModel()}},rescaleOnParentCaseCompletion:function(g){var a=g&&g.length,b=a&&g[a-1],c=b&&b.get("id"),f=this.getPath("model.openParentCaseID");if(!SC.none(c)&&(c===f)){var d=this.get("model");if(d&&d.rescaleAxesFromData){d.rescaleAxesFromData(false,false)}this.setPath("model.openParentCaseID",null)}},initializeAdornments:function(){if(this.plottedCountAdorn&&this.plottedCountAdorn.wantVisible()){this.plottedCountAdorn.updateToModel()}var a=this.get("model"),b=a&&a._adornmentModels;DG.ObjectMap.forEach(b,function(c,d){a.notifyPropertyChange(c)});this._areAdornmentsInitialized=true},_plottedElements:null,_mustCreatePlottedElements:true,_elementOrderIsValid:false,shouldDraw:function(){return !this._isRenderingValid},doDraw:function doDraw(b,a){this.set("plotIndex",b);this.set("numPlots",a);if(!this._areAdornmentsInitialized){this.initializeAdornments()}},getPointPositionsInParentFrame:function(){var a=this.get("frame");return this._plottedElements.map(function(c){var b=(c.isHidden()?0:c.attr("r"));return{cx:c.attr("cx")+a.x,cy:c.attr("cy")+a.y,r:b,fill:c.attr("fill")}})},animateFromTransferredPoints:function(){var h=this,d=this._plottedElements,f=this.getPath("model.cases"),n=this.createRenderContext(),j=this.get("frame"),a=this.get("transferredPointCoordinates"),i=[],m=[],o=[];function c(q){return a[q]}function p(q){return a[m[q]]}this._getTransferredPointsToCasesMap(m,o);var b=m.length>0,g=o.length>0,l=(b?p:c),k=false;this._elementOrderIsValid=false;DG.sounds.playMixup();this.setPath("model.isAnimating",true);this.prepareToResetCoordinates();this.removePlottedElements();a.forEach(function(q,r){q.cx-=j.x;q.cy-=j.y});f.forEach(function(r,s){var u=l(s),q=false,t;h.callCreateCircle(r,s,false);if(!SC.none(u)){d[s].attr(u);q=true;if(!k){t=function(){h.setPath("model.isAnimating",false);h.drawData()}}}u=h.setCircleCoordinate(n,r,s,q,t);if(u&&t){k=true}if(g){i.push(u)}});if(!k){this.setPath("model.isAnimating",false)}if(g){a.forEach(function(s,t){var r=o[t],q=i[r];if(SC.none(r)||SC.none(q)||(s.r===0)){return}h.vanishPlottedElement(s,q)})}this._mustCreatePlottedElements=false;this.set("transferredPointCoordinates",null)},_getTransferredPointsToCasesMap:function(n,c){var q=this.get("transferredPointCoordinates"),g=this.getPath("model.cases"),k=this.getPath("model.collectionClient"),i=this.getPath("model.dataContext.childCollection"),d=this.getPath("model.dataContext.parentCollection"),m=d?d.getCaseCount():0,f=i?i.getCaseCount():0,p=g.length,b=q.length;function h(){return(d&&(m===b)&&(k&&k.isDescendantOf(d)))}function l(){return(i&&(f===b)&&(k&&k.isAncestorOf(i)))}function j(s){var r=d.getCaseAt(s),t=r&&r.get("children");return(t?t.length():0)}function o(t,r){var v,s,u;for(v=0;v<b;++v){u=j(v);for(s=0;s<u;++s){t.push(v)}}if(!DG.assert(t.length===p,"Parent/Child case mismatch")){t.length=0}DG.assert(r.length===0,"another parent/child case mismatch")}function a(v,t){var x,u,w,s,r;x=0;for(u=0;u<p;++u){w=j(u);v.push((w>0)?x:undefined);for(s=0;s<w;++s){r=((s===0)?undefined:v.length-1);t.push(r);++x}}}if(h()){o(n,c)}else{if(l()){a(n,c)}}},prepareForConfigurationChange:function(){this.set("cachedPointCoordinates",this.getPointPositionsInParentFrame())},handleConfigurationChange:function(){if(this.get("allowTransferAnimation")){this.set("transferredPointCoordinates",this.get("cachedPointCoordinates"))}},handleBackgroundClick:function(a){},handleBackgroundDblClick:function(a){},createRenderContext:function(){var c=this.get("model"),b=c.getPath("dataConfiguration.legendAttributeDescription"),a=this.get("plotIndex");return{casesAdded:true,casesRemoved:true,updatedColors:true,updatedPositions:true,xAxisView:this.get("xAxisView"),yAxisView:this.get("yAxisView"),xVarID:c.get("xVarID"),yVarID:c.get("yVarID"),legendDesc:b,legendVarID:b&&b.get("attributeID"),attrColor:SC.none(a)||(a===0)?null:DG.ColorUtilities.calcAttributeColorFromIndex(this.get("plotIndex"),this.get("numPlots")),calcCaseColorString:function(g){DG.assert(g);var d=g.getValue(this.legendVarID),f=DG.ColorUtilities.calcCaseColor(d,this.legendDesc,this.attrColor);return f.colorString}}},plottedCountChanged:function(){var a=this.getPath("model.plottedCount");if(this.plottedCountAdorn){this.plottedCountAdorn.destroy();this.plottedCountAdorn=null}if(a&&this.get("paper")){this.plottedCountAdorn=DG.PlottedCountAdornment.create({parentView:this,valueAxisView:this.get("primaryAxisView"),model:a,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments});this.plottedCountAdorn.updateToModel()}}.observes(".model.plottedCount"),didCreateLayer:function(){this.plottedCountChanged()}});sc_require("components/graph/plots/plot_view");DG.CasePlotView=DG.PlotView.extend({dataRangeDidChange:function(a,h,d,f){var c=this,j=this._plottedElements.length,b=this.getPath("model.cases"),i=this.createRenderContext();var g=(SC.typeOf(f)===SC.T_NUMBER?[f]:f);g.forEach(function(k){if(k>=j){c.callCreateCircle(b[k],k,c._createAnimationOn)}c.setCircleCoordinate(i,b[k],k)});arguments.callee.base.apply(this,arguments)},setCircleCoordinate:function setCircleCoordinate(d,b,g,k,c){DG.assert(d&&d.xAxisView);DG.assert(b);DG.assert(DG.MathUtilities.isInIntegerRange(g,0,this._plottedElements.length));function m(o,r,p){var n=o.get("pixelMin"),q=o.get("pixelMax");if(n<q){return n+p+r*(q-n-2*p)}else{return n-p+r*(q-n+2*p)}}var a=this._plottedElements[g],h=this._pointRadius,f=this.get("model").getWorldCoords(g),j=m(d.xAxisView,f.x,h),i=m(d.yAxisView,f.y,h),l=SC.none(j)||SC.none(i);if(this.showHidePlottedElement(a,l)){this.updatePlottedElement(a,j,i,h,d.calcCaseColorString(b),k,c);return{cx:j,cy:i,r:h}}return null},createCircle:function(g,d,j){var c=this;function i(k,l){c.get("model").setWorldCoords(k,l)}var b=false,f=1,h=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(k){if(!b&&SC.none(h)){h=this.transform();this.animate({opacity:f,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime)}},function(k){if(!b){this.stop();this.animate({transform:h},DG.PlotUtilities.kHighlightHideTime);h=null}}).mousedown(function(k){c.get("model").selectCaseByIndex(d,k.shiftKey)}).drag(function(n,l){var p=c.get("xAxisView").coordinateToData(this.ox+n),o=c.get("yAxisView").coordinateToData(this.oy+l),m={x:p,y:o},q=c.createRenderContext(),k=this.transform();if(isFinite(m.x)&&isFinite(m.y)){this.transform(h);i(this.index,m);this.transform(k)}c.setCircleCoordinate(q,c.getPath("model.cases")[this.index],this.index)},function(k,l){b=true;this.ox=this.attr("cx");this.oy=this.attr("cy");this.animate({opacity:f},DG.PlotUtilities.kDataTipShowTime,"bounce");this.toFront()},function(){this.animate({transform:h},DG.PlotUtilities.kHighlightHideTime);b=false});a.index=d;a.node.setAttribute("shape-rendering","geometric-precision");if(j){DG.PlotUtilities.doCreateCircleAnimation(a)}return a},drawData:function(){if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}var d=this,c=this.getPath("model.cases"),b=this.createRenderContext(),a;if(this._mustCreatePlottedElements){this._plottedElements.forEach(function(f){f.remove()});this._plottedElements.length=0;this._pointRadius=this.calcPointRadius();c.forEach(this.callCreateCircle,this);this._mustCreatePlottedElements=false}c.forEach(function(f,g){d.setCircleCoordinate(b,f,g)});for(a=c.length;a<this._plottedElements.length;a++){this._plottedElements[a].remove()}this._plottedElements.length=c.length},doDraw:function doDraw(){arguments.callee.base.apply(this,arguments);this.drawData();this.updateSelection()},worldValuesChanged:function(){this.prepareForConfigurationChange();this.set("transferredPointCoordinates",this.get("cachedPointCoordinates"));this._isRenderingValid=false;this.displayDidChange()}.observes(".model.worldValues")});sc_require("components/graph/plots/plot_model");DG.DotChartModel=DG.PlotModel.extend({primaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.ePrimaryCategorical)}.property("xVarID","yVarID"),secondaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.eSecondaryCategorical)}.property("xVarID","yVarID"),primaryAxisModel:function(){return this.getAxisForPlace(this.get("primaryAxisPlace"))}.property("primaryAxisPlace","xAxis","yAxis"),secondaryAxisModel:function(){return this.getAxisForPlace(this.get("secondaryAxisPlace"))}.property("secondaryAxisPlace","xAxis","yAxis"),orientation:function(){return(this.get("primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?"vertical":"horizontal"}.property(),cachedCells:null,cachedIndex:null,maxInCell:function(){if(!this._cacheIsValid){this._buildCache()}return this._maxInCell}.property(),handleDataContextNotification:function(c,f){if(!this.isAffectedByChange(f)){return}var a=function(l,n,j,o){var k;if(SC.none(j)||SC.none(o)){return}var i=this.get("cachedCells"),h=this.get("cachedIndex"),m=this.get("_maxInCell");if(SC.none(i[j])){i[j]=[]}if(SC.none(i[j][o])){i[j][o]=[]}i[j][o].push({theCase:l,caseIndex:n});k=i[j][o].length;h[n]={primaryCell:j,secondaryCell:o,indexInCell:k-1};this.beginPropertyChanges();this.set("cachedCells",i);this.set("cachedIndex",h);this.set("_maxInCell",Math.max(m,k));this.endPropertyChanges()}.bind(this);if((f.operation==="createCase")||(f.operation==="createCases")){var b=f.result.caseIDs||[f.result.caseID],d=this.getPath("dataConfiguration.cases.length")-1,g=this.get("computationContext");b.forEach(function(i){var h=DG.store.find(DG.Case,i);this.doForOneCase(h,d++,g,a)}.bind(this))}else{this.invalidateCaches()}arguments.callee.base.apply(this,arguments)},lookupCellForCaseIndex:function(a){if(!this._cacheIsValid){this._buildCache()}return this.get("cachedIndex")[a]},_cachedComputationContext:null,computationContext:function(){if(!this._cachedComputationContext){this._cachedComputationContext={primaryAxis:this.get("primaryAxisModel"),secondaryAxis:this.get("secondaryAxisModel"),primaryVarID:this.get("primaryVarID"),secondaryVarID:this.get("secondaryVarID"),legendVarID:this.get("legendVarID")}}return this._cachedComputationContext}.property("primaryAxisModel","secondaryAxisModel","primaryVarID","secondaryVarID","legendVarID"),doForOneCase:function(a,f,h,k){var j=a.getValue(h.primaryVarID),b=SC.none(h.primaryVarID)||!SC.none(j),c=a.getValue(h.secondaryVarID),g=SC.none(h.secondaryVarID)||!SC.none(c),m=a.getValue(h.legendVarID),i=SC.none(h.legendVarID)||!SC.none(m),l,d;if(b&&g&&i){l=h.primaryAxis.cellNameToCellNumber(j);d=h.secondaryAxis.cellNameToCellNumber(c);k(a,f,l,d)}},forEachBivariateCaseDo:function(a){var b=this.get("cases"),c=this.get("computationContext");if(!c.primaryAxis||!b){return}b.forEach(function(d,f){this.doForOneCase(d,f,c,a)}.bind(this))},invalidateCaches:function(){arguments.callee.base.apply(this,arguments);this.set("_cacheIsValid",false);this._cachedComputationContext=null},getCellCaseCounts:function(){var h=this.get("primaryAxisModel"),g=this.get("secondaryAxisModel"),b=[];if(!(h&&g)){return b}var f=h.get("numberOfCells")||1,d=g.get("numberOfCells")||1;var j=f*d;var c,a;for(c=0;c<j;++c){b.push({count:0,primaryCell:Math.floor(c/d),secondaryCell:c%d})}this.forEachBivariateCaseDo(function(k,l,i,m){a=i*d+m;if(DG.MathUtilities.isInIntegerRange(a,0,j)){var n=b[a];n.count+=1;DG.assert(n.primaryCell===(i||0),"primary cell index error in DG.DotChartModel.getCellCaseCounts()");DG.assert(n.secondaryCell===(m||0),"secondary cell index error in DG.DotChartModel.getCellCaseCounts()")}});return b},_buildCache:function(){var b=[],a=[],c=0;this.forEachBivariateCaseDo(function(g,h,d,i){var f;if(SC.none(d)||SC.none(i)){return}if(SC.none(b[d])){b[d]=[]}if(SC.none(b[d][i])){b[d][i]=[]}b[d][i].push({theCase:g,caseIndex:h});f=b[d][i].length;a[h]={primaryCell:d,secondaryCell:i,indexInCell:f-1};c=Math.max(c,f)});this._cacheIsValid=true;this.beginPropertyChanges();this.set("cachedCells",b);this.set("cachedIndex",a);this.set("_maxInCell",c);this.endPropertyChanges()},_cacheIsValid:false,_maxInCell:0});DG.DotChartModel.configureRoles=function(b){var c=b.get("xType"),d=(c===DG.Analysis.EAttributeType.eCategorical)?"x":"y",a=(d==="x")?"y":"x";b.setPath(d+"AttributeDescription.role",DG.Analysis.EAnalysisRole.ePrimaryCategorical);b.setPath(a+"AttributeDescription.role",DG.Analysis.EAnalysisRole.eSecondaryCategorical)};sc_require("components/graph/plots/plot_view");DG.DotChartView=DG.PlotView.extend({displayProperties:["numPointsInRow","overlap","xAxisView.model.numberOfCells","yAxisView.model.numberOfCells"],numPointsInRow:1,overlap:0,cleanupFunc:function(){this.computeCellParams();this.displayDidChange()},primaryAxisView:function(){return(this.getPath("model.orientation")==="vertical")?this.get("xAxisView"):this.get("yAxisView")}.property("orientation","yAxisView","xAxisView"),secondaryAxisView:function(){return(this.getPath("model.orientation")==="vertical")?this.get("yAxisView"):this.get("xAxisView")}.property("orientation","yAxisView","xAxisView"),dataDidChange:function(){this.updatePoints();this.installCleanup()},updatePoints:function(){if(!this.get("paper")){return}var b=this,h=this.get("model"),a=this.getPath("model.cases"),g=this.createRenderContext(),d=a&&a.length,j=this._plottedElements.length,c=(this._pointRadius!==this.calcPointRadius()),i,f;if(c){this._pointRadius=this.calcPointRadius()}this.updateAdornments();if(d>j){if(c){for(i=0;i<j;i++){f=h.lookupCellForCaseIndex(i);this.privSetCircleCoords(g,a[i],i,f)}}for(i=j;i<d;i++){this.callCreateCircle(a[i],i,this.animationIsAllowable());f=h.lookupCellForCaseIndex(i);this.privSetCircleCoords(g,a[i],i,f)}}if(d<j){for(i=d;i<j;i++){this._plottedElements[i].remove()}this._plottedElements.length=d;a.forEach(function(k,l){f=h.lookupCellForCaseIndex(l);b.privSetCircleCoords(g,k,l,f)})}this._isRenderingValid=false},dataRangeDidChange:function(c,h,b,f){var i=this,g=this.getPath("model.cases"),d=this.createRenderContext(),a=(SC.typeOf(f)===SC.T_NUMBER?[f]:f);this.model.invalidateCaches();this.computeCellParams();a.forEach(function(j){if(!i._plottedElements[j]){i.callCreateCircle(g[j],j,i._createAnimationOn)}var k=i.get("model").lookupCellForCaseIndex(j);i.privSetCircleCoords(d,g[j],j,k)});arguments.callee.base.apply(this,arguments)},createRenderContext:function(){var a=arguments.callee.base.apply(this,arguments);a.primaryAxisView=this.get("primaryAxisView");a.secondaryAxisView=this.get("secondaryAxisView");a.isVerticalOrientation=this.getPath("model.orientation")==="vertical";return a},setCircleCoordinate:function setCircleCoordinate(g,b,c,a,f){var d=this.get("model").lookupCellForCaseIndex(c);return this.privSetCircleCoords(g,b,c,d,a,f)},privSetCircleCoords:function(m,j,i,g,c,d){DG.assert(m&&m.xAxisView);DG.assert(j);DG.assert(DG.MathUtilities.isInIntegerRange(i,0,this._plottedElements.length));var b=this._plottedElements[i],l=SC.none(g);if(this.showHidePlottedElement(b,l)){var t=m.secondaryAxisView.get("fullCellWidth")/2,n=this.get("numPointsInRow"),k=this.get("overlap"),s=Math.floor(g.indexInCell/n),r=g.indexInCell-s*n,o=this._pointRadius,u=2*o,a=m.primaryAxisView.cellToCoordinate(g.primaryCell)-(n-1)*u/2+r*u,q=m.secondaryAxisView.cellToCoordinate(g.secondaryCell),p=((s+0.5)*(u-k)+1+k/2),h,f;DG.assert(DG.isFinite(a)&&DG.isFinite(q),"tPrimaryCoord & tSecondaryCoord");if(m.isVerticalOrientation){h=a;f=q+t-p}else{h=q-t+p;f=a}DG.assert(isFinite(h)&&isFinite(f));this.updatePlottedElement(b,h,f,o,m.calcCaseColorString(j),c,d);return{cx:h,cy:f,r:o}}return null},createCircle:function(f,g,d){var h=this,c=null,a=1;if(!this.get("paper")){return}var b=this.get("paper").circle(0,0,this._pointRadius).attr({cursor:"pointer",cx:-1000,cy:-1000}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(i){if(SC.none(c)){c="";this.animate({opacity:a,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime);h.showDataTip(this,g)}},function(i){this.stop();this.animate({opacity:DG.PlotUtilities.kDefaultPointOpacity,transform:c},DG.PlotUtilities.kHighlightHideTime);c=null;h.hideDataTip()}).mousedown(function(i){h.get("model").selectCaseByIndex(g,i.shiftKey)});b.index=g;b.node.setAttribute("shape-rendering","geometric-precision");if(d){DG.PlotUtilities.doCreateCircleAnimation(b)}return b},drawData:function drawData(){if(SC.none(this.get("paper"))){return}if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}var d=this,a=this.get("model"),c=a.get("cases"),b=this.createRenderContext();if(!c){return}if(this._mustCreatePlottedElements){this.removePlottedElements();this._pointRadius=this.calcPointRadius();c.forEach(this.callCreateCircle,this);this._mustCreatePlottedElements=false}this.computeCellParams();c.forEach(function(f,g){var h=a.lookupCellForCaseIndex(g);d.privSetCircleCoords(b,f,g,h)});this.updateSelection()},doDraw:function doDraw(){arguments.callee.base.apply(this,arguments);if(!this.getPath("model._cacheIsValid")){this.updatePoints()}this.drawData()},animateFromTransferredPoints:function(){var h=this,n=this.get("model"),d=n.get("cases"),m=this.createRenderContext(),j=this.get("frame"),a=this.get("transferredPointCoordinates"),i=[],l=[],o=[];function f(){n.set("isAnimating",false)}function c(q){return a[q]}function p(q){return a[l[q]]}DG.sounds.playMixup();this._getTransferredPointsToCasesMap(l,o);var b=l.length>0,g=o.length>0,k=(b?p:c);this.prepareToResetCoordinates();this.removePlottedElements();this.computeCellParams();a.forEach(function(q,r){q.cx-=j.x;q.cy-=j.y});d.forEach(function(q,r){var t=k(r),s=n.lookupCellForCaseIndex(r);h.callCreateCircle(q,r,false);if(!SC.none(t)){h._plottedElements[r].attr(t)}t=h.privSetCircleCoords(m,q,r,s,true);if(g){i.push(t)}});if(g){a.forEach(function(s,t){var r=o[t],q=i[r];if(SC.none(r)||SC.none(q)||(s.r===0)){return}h.vanishPlottedElement(s,q)})}this._mustCreatePlottedElements=false;this.set("transferredPointCoordinates",null);n.set("isAnimating",true);SC.Timer.schedule({action:f,interval:DG.PlotUtilities.kDefaultAnimationTime})},computeCellParams:function(){var b=this.getPath("primaryAxisView.cellWidth"),a=this.getPath("secondaryAxisView.fullCellWidth")-5,g=this.getPath("model.maxInCell"),f=2*this._pointRadius,c=Math.max(1,Math.floor(a/f)),i=Math.max(1,Math.floor(b/f)),d=Math.max(1,Math.min(i,Math.ceil(g/c))),j=Math.ceil(g/d),h=Math.max(0,((j+1)*f-a)/j);if(!isFinite(d)){d=0}if(!isFinite(h)){h=0}this.beginPropertyChanges();this.setIfChanged("numPointsInRow",d);this.setIfChanged("overlap",h);this.endPropertyChanges()}});DG.NumericPlotModelMixin={doDilation:function(a,f,b){var g=this,d=[];function c(i,j){if(SC.none(i)){return}var h=i.computeBoundsForDilation(j,b);d.push({axis:i,newBounds:h})}a.forEach(function(i){var h=(i===DG.GraphTypes.EPlace.eX)?f.x:f.y;c(g.getAxisForPlace(i),h)});if(SC.none(this.plotAnimator)){this.plotAnimator=DG.GraphAnimator.create({plot:this})}this.plotAnimator.set("axisInfoArray",d).animate()},doRescaleAxesFromData:function(c,d,a){var h=this,b=[],j=[];function g(m,o){var s=o&&o.getPath("attributeDescription.attribute");if(!o||!o.setDataMinAndMax||(s===DG.Analysis.kNullAttribute)){return}var k=h.get("dataConfiguration"),p=k&&k.getDataMinAndMaxForDimension(m),n=o.get("lowerBound"),r=o.get("upperBound"),q,l;j.push({lower:n,upper:r});o.setDataMinAndMax(p.min,p.max,d||false);q=o.get("lowerBound");l=o.get("upperBound");b.push({axis:o,newBounds:{lower:q,upper:l}})}function f(l,k){if(!SC.none(l)){l.setLowerAndUpperBounds(k.lower,k.upper)}}function i(m,l){var k;for(k=0;k<m.length;k++){if(!SC.none(l[k].lower)&&!SC.none(l[k].upper)&&((m[k].newBounds.lower!==l[k].lower)||(m[k].newBounds.upper!==l[k].upper))){return true}}return false}if(SC.none(a)){a=true}c.forEach(function(k){g(k,h.getAxisForPlace(k))});if(i(b,j)){if(a){DG.sounds.playMixup()}this.set("isAnimating",true);while((c.length>0)&&(j.length>0)){f(h.getAxisForPlace(c.pop()),j.pop())}if(SC.none(this.plotAnimator)){this.plotAnimator=DG.GraphAnimator.create({plot:this})}this.plotAnimator.set("axisInfoArray",b).animate(this,this.onRescaleIsComplete)}},onRescaleIsComplete:function(){}};sc_require("components/graph/plots/plot_model");sc_require("components/graph/plots/numeric_plot_model_mixin");DG.DotPlotModel=DG.PlotModel.extend(DG.NumericPlotModelMixin,{primaryVarID:function(){return(this.get("primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?this.get("xVarID"):this.get("yVarID")}.property("primaryAxisPlace","xVarID","yVarID"),primaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.ePrimaryNumeric)}.property("xVarID","yVarID"),secondaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.eSecondaryCategorical)}.property("xVarID","yVarID"),primaryAxisModel:function(){return this.getAxisForPlace(this.get("primaryAxisPlace"))}.property("primaryAxisPlace","xAxis","yAxis"),secondaryAxisModel:function(){return this.getAxisForPlace(this.get("secondaryAxisPlace"))}.property("secondaryAxisPlace","xAxis","yAxis"),orientation:function(){return(this.get("primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?"vertical":"horizontal"}.property("primaryAxisPlace"),toggleMovableValue:function(){var a=this.toggleAdornmentVisibility("movableValue","toggleMovableValue");if(a&&a.get("isVisible")){a.recomputeValue(this.get("primaryAxisModel"))}},toggleAverage:function(b,a){var c=this.toggleAdornmentVisibility(b,a);if(c){if(c.get("isVisible")){c.recomputeValue()}else{c.setComputingNeeded()}}},togglePlottedMean:function(){this.toggleAverage("plottedMean","togglePlottedMean")},togglePlottedMedian:function(){this.toggleAverage("plottedMedian","togglePlottedMedian")},togglePlottedStDev:function(){this.toggleAverage("plottedStDev","togglePlottedStDev")},togglePlottedIQR:function(){this.toggleAverage("plottedIQR","togglePlottedIQR")},togglePlotValue:function(){this.toggleAdornmentVisibility("plottedValue","togglePlotValue")},handleDataConfigurationChange:function(){if(!DG.assert(!this.get("isDestroyed"),"DG.DotPlotModel.handleDataConfiguration() shouldn't be triggered after destroy()!")){return}arguments.callee.base.apply(this,arguments);var a=true,c=true,b=false;this.rescaleAxesFromData(a,c,b);["movableValue","plottedMean","plottedMedian","plottedStDev","plottedIQR","plottedCount"].forEach(function(d){var f=this.getAdornmentModel(d);if(f){if(f.setComputingNeeded){f.setComputingNeeded()}if(d==="movableValue"){f.recomputeValueIfNeeded(this.get("primaryAxisModel"))}else{f.recomputeValueIfNeeded()}}}.bind(this))},rescaleAxesFromData:function(c,b,a){if(b===undefined){b=true}this.doRescaleAxesFromData([this.get("primaryAxisPlace")],c,b);if(a){DG.logUser("rescaleDotPlot")}},dilate:function(b,a){this.doDilation([this.get("primaryAxisPlace")],b,a)},getCellCaseCounts:function(){var j=this.get("cases"),g=this.get("primaryVarID"),b=this.get("primaryAxisModel"),h=this.get("secondaryVarID"),f=this.get("secondaryAxisModel"),a=[];if(!(f&&b)){return a}var c=f.get("numberOfCells");for(var d=0;d<c;++d){a.push({count:0,primaryCell:0,secondaryCell:d})}j.forEach(function(l,m){var n=l.getNumValue(g),k=l.getStrValue(h),i=f.cellNameToCellNumber(k);if(i!==null&&DG.MathUtilities.isInIntegerRange(i,0,a.length)&&isFinite(n)){a[i].count+=1}});return a},getGearMenuItems:function(){var a="DG.DotPlotModel.rescaleToData".loc(),h=(this.isAdornmentVisible("movableValue")?"DG.DotPlotModel.hideMovableValue":"DG.DotPlotModel.showMovableValue").loc(),c=(this.isAdornmentVisible("plottedMean")?"DG.DotPlotModel.hideMean":"DG.DotPlotModel.showMean").loc(),d=(this.isAdornmentVisible("plottedMedian")?"DG.DotPlotModel.hideMedian":"DG.DotPlotModel.showMedian").loc(),j=(this.isAdornmentVisible("plottedStDev")?"DG.DotPlotModel.hideStDev":"DG.DotPlotModel.showStDev").loc(),i=(this.isAdornmentVisible("plottedIQR")?"DG.DotPlotModel.hideIQR":"DG.DotPlotModel.showIQR").loc(),b=(this.isAdornmentVisible("plottedValue")?"DG.DotPlotModel.hidePlottedValue":"DG.DotPlotModel.plotValue").loc(),g=[{title:a,target:this,itemAction:this.rescaleAxesFromData,args:[true,false,true]},{title:h,target:this,itemAction:this.toggleMovableValue},{title:b,target:this,itemAction:this.togglePlotValue}],f=[{isSeparator:YES},{title:c,target:this,itemAction:this.togglePlottedMean},{title:d,target:this,itemAction:this.togglePlottedMedian},{title:j,target:this,itemAction:this.togglePlottedStDev},{title:i,target:this,itemAction:this.togglePlottedIQR},{isSeparator:YES}];return g.concat(arguments.callee.base.apply(this,arguments)).concat(f)}});DG.DotPlotModel.configureRoles=function(b){var c=b.get("xType"),d=(c===DG.Analysis.EAttributeType.eNumeric)?"x":"y",a=(d==="x")?"y":"x";b.setPath(d+"AttributeDescription.role",DG.Analysis.EAnalysisRole.ePrimaryNumeric);b.setPath(a+"AttributeDescription.role",DG.Analysis.EAnalysisRole.eSecondaryCategorical)};sc_require("components/graph/plots/plot_view");DG.DotPlotView=DG.PlotView.extend({displayProperties:["primaryAxisView.model.lowerBound","primaryAxisView.model.upperBound","secondaryAxisView.model.numberOfCells","overlap"],autoDestroyProperties:["movableValueAdorn","plottedValueAdorn","plottedMeanAdorn","plottedMedianAdorn","plottedStDevAdorn","plottedIQRAdorn"],primaryAxisView:function(){switch(this.getPath("model.primaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xAxisView");case DG.GraphTypes.EPlace.eY:return this.get("yAxisView");default:return null}}.property("model.primaryAxisPlace","xAxisView","yAxisView"),secondaryAxisView:function(){switch(this.getPath("model.secondaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xAxisView");case DG.GraphTypes.EPlace.eY:return this.get("yAxisView");default:return null}}.property("model.secondaryAxisPlace","xAxisView","yAxisView"),movableValueAdorn:null,plottedMeanAdorn:null,plottedMedianAdorn:null,plottedStDevAdorn:null,plottedIQRAdorn:null,binArrays:null,overlap:0,functionEditView:null,plottedValueAdorn:null,prepareToResetCoordinates:function(){this.zeroBinArray()},dataDidChange:function(){arguments.callee.base.apply(this,arguments);if(SC.none(this.get("paper"))){return}this.updateAverages()},dataRangeDidChange:function(c,h,b,f){var i=this,a=this._plottedElements.length,g=this.getPath("model.cases"),d=this.createRenderContext();this.prepareToResetCoordinates();g.forEach(function(j,k){if(k>=a){i.callCreateCircle(g[k],k,i._createAnimationOn)}i.setCircleCoordinate(d,g[k],k)});this.updateAverages();this.rescaleOnParentCaseCompletion(g);arguments.callee.base.apply(this,arguments)},numberOfCellsDidChange:function(){if(this.plottedMeanAdorn){this.plottedMeanAdorn.get("model").setComputingNeeded()}if(this.plottedMedianAdorn){this.plottedMedianAdorn.get("model").setComputingNeeded()}if(this.plottedStDevAdorn){this.plottedStDevAdorn.get("model").setComputingNeeded()}if(this.plottedIQRAdorn){this.plottedIQRAdorn.get("model").setComputingNeeded()}}.observes("*secondaryAxisView.model.numberOfCells"),updateAverages:function(a){function b(d){if(d){var c=d.get("model");if(c){c.setComputingNeeded();d.updateToModel(a)}}}if(!this.getPath("model.dataConfiguration")){return}b(this.plottedMeanAdorn);b(this.plottedMedianAdorn);b(this.plottedStDevAdorn);b(this.plottedIQRAdorn)},createRenderContext:function(){var b=arguments.callee.base.apply(this,arguments),a=this.get("model");b.categoryAxisView=this.get("secondaryAxisView");b.categoryAxisModel=b.categoryAxisView&&b.categoryAxisView.get("model");b.categoryVarID=a&&a.get("secondaryVarID");b.primaryVarID=a&&a.get("primaryVarID");b.primaryAxisPlace=a&&a.get("primaryAxisPlace");b.primaryAxisView=this.get("primaryAxisView");return b},setCircleCoordinate:function setCircleCoordinate(r,n,m,g,i){DG.assert(r&&r.categoryAxisView);DG.assert(n);DG.assert(DG.MathUtilities.isInIntegerRange(m,0,this._plottedElements.length));var f=this._plottedElements[m],b=n.getNumValue(r.primaryVarID),h=r.primaryAxisView.dataToCoordinate(b),p=(!DG.isFinite(h)||r.primaryAxisPlace===DG.GraphTypes.EPlace.eUndefined);if(this.showHidePlottedElement(f,p)){var u=r.categoryAxisModel.cellNameToCellNumber(n.getStrValue(r.categoryVarID)),l=SC.none(u)?0:r.categoryAxisView.cellToCoordinate(u),w=r.categoryAxisView.get("fullCellWidth")/2,t=this._pointRadius,q=this.get("binArrays"),s=q&&(u<q.length)&&q[u],k,j;var d=Math.round(h/(2*t)),c=(s&&s.length)||0,v=(s&&d>=0&&d<c)?s[d].counter++:0,o=this.get("overlap"),a=t+(2*t-o)*v+1;switch(r.primaryAxisPlace){case DG.GraphTypes.EPlace.eX:k=h;j=l-a+w;break;case DG.GraphTypes.EPlace.eY:k=l+a-w;j=h;break}this.updatePlottedElement(f,k,j,t,r.calcCaseColorString(n),g,i);return{cx:k,cy:j,r:t}}return null},createCircle:function(j,g,l){var f=this,d=this.getPath("model.primaryAxisPlace");function k(m){var o=f.getPath("model.primaryVarID"),n={operation:"updateCases",cases:[],attributeIDs:[o],values:[[]]},p=f.get("dataContext");if(!p){return}f.getPath("model.casesController.selection").forEach(function(q){n.cases.push(q);n.values[0].push(q.getNumValue(o)+m)});p.applyChange(n)}function b(p,q){var n=f.getPath("model.cases")[p],o=f.getPath("model.primaryVarID"),m=n.getNumValue(o)-q;f.get("model").animateSelectionBackToStart([o],[m])}var c=false,h=1,i=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(m){if(!c&&SC.none(i)){i="";this.animate({opacity:h,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime);f.showDataTip(this,g)}},function(m){if(!c){this.stop();this.animate({opacity:DG.PlotUtilities.kDefaultPointOpacity,transform:i},DG.PlotUtilities.kHighlightHideTime);i=null;f.hideDataTip()}}).mousedown(function(m){f.get("model").selectCaseByIndex(g,m.shiftKey)}).drag(function(q,p){var m=(d===DG.GraphTypes.EPlace.eX)?this.ox+q:this.oy+p,r=f.get("primaryAxisView").coordinateToData(m),o=f.getPath("model.cases")[this.index].getNumValue(f.getPath("model.primaryVarID")),n=this.transform();if(isFinite(r)){this.transform(i);k(r-o);this.transform(n)}},function(m,n){c=true;this.ox=this.attr("cx");this.oy=this.attr("cy");this.w=f.getPath("model.cases")[this.index].getNumValue(f.getPath("model.primaryVarID"));this.attr({opacity:h})},function(){this.animate({transform:i},DG.PlotUtilities.kHighlightHideTime);b(this.index,this.w);c=false;this.ox=this.oy=this.w=undefined});a.index=g;a.node.setAttribute("shape-rendering","geometric-precision");if(l){DG.PlotUtilities.doCreateCircleAnimation(a)}return a},drawData:function drawData(){if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}arguments.callee.base.apply(this,arguments)},doDraw:function doDraw(){function a(b){if(!SC.none(b)&&b.wantVisible()){b.updateToModel()}}arguments.callee.base.apply(this,arguments);this.drawData();this.updateSelection();if(!SC.none(this.movableValueAdorn)&&this.getPath("movableValueAdorn.plotModel.isVisible")){this.movableValueAdorn.updateToModel()}a(this.plottedMeanAdorn);a(this.plottedMedianAdorn);a(this.plottedStDevAdorn);a(this.plottedIQRAdorn);if(!SC.none(this.plottedValueAdorn)){this.plottedValueAdorn.updateToModel()}},zeroBinArray:function(){this._zeroBinArray(2*this._pointRadius)},_zeroBinArray:function(g){var i=this,d=this.get("primaryAxisView"),f=this.get("secondaryAxisView");if(!d||!f){return}var h=f.get("model"),c=h.get("numberOfCells"),b=Math.round(Math.abs(d.get("pixelMax")-d.get("pixelMin"))/g)+1;function a(){var k=i.getPath("model.cases"),u=i.getPath("model.primaryVarID"),q=i.getPath("model.secondaryVarID"),t=g/2,l=i.get("binArrays"),n=f.get("fullCellWidth"),j=Math.round(n/(2*t))-2,p=0,m=i.getPath("model.dataConfiguration.legendAttributeDescription"),r=m.get("attributeID"),s,o;if(j<=0){return 0}k.forEach(function(z){var v=!SC.none(r)?z.getValue(r):null,w=d.dataToCoordinate(z.getNumValue(u)),y=Math.round(w/(2*t)),x=h.cellNameToCellNumber(z.getStrValue(q));if((SC.none(r)||!SC.none(v))&&(y>=0)&&!SC.none(x)&&(x>=0)&&(x<l.length)&&(y<l[x].length)){l[x][y].total++}});s=pv.max(l.map(function(v){return pv.max(v.map(function(w){return w.total}))}));if(s>j){o=(s-j)*2*t;p=o/(s-1)}return p}this.set("binArrays",pv.range(c).map(function(){return pv.range(b).map(function(){return{total:0,counter:0}})}));this.set("overlap",a())},enterAnimationState:function(){var d=this,a=this._plottedElements.length,c=this.getPath("model.cases"),b=this.createRenderContext();this.zeroBinArray();c.forEach(function(f,g){var h=true;if(g>=a){d.callCreateCircle(f,g,false);h=false}d.setCircleCoordinate(b,c[g],g,h)})},movableValueChanged:function(){var a=this.get("model"),b=a&&a.getAdornmentModel("movableValue");if(b){if(!this.movableValueAdorn){this.movableValueAdorn=DG.MovableValueAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,valueAxisView:this.get("primaryAxisView")});this.movableValueAdorn.createElements()}if(b.get("isVisible")){this.movableValueAdorn.updateToModel()}}}.observes(".model.movableValue"),plottedMeanChanged:function(){this.adornmentDidChange("plottedMean","plottedMeanAdorn",DG.PlottedMeanAdornment)}.observes(".model.plottedMean"),plottedMedianChanged:function(){this.adornmentDidChange("plottedMedian","plottedMedianAdorn",DG.PlottedMedianAdornment)}.observes(".model.plottedMedian"),plottedStDevChanged:function(){this.adornmentDidChange("plottedStDev","plottedStDevAdorn",DG.PlottedStDevAdornment)}.observes(".model.plottedStDev"),plottedIQRChanged:function(){this.adornmentDidChange("plottedIQR","plottedIQRAdorn",DG.PlottedIQRAdornment)}.observes(".model.plottedIQR"),adornmentDidChange:function(f,g,c){var a=this.get("model"),b=a&&a.getAdornmentModel(f),d=this[g];if(b){if(!d){d=c.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,shadingLayerName:DG.LayerNames.kIntervalShading});this[g]=d}d.updateToModel()}},plottedValueChanged:function(){var a=this.get("model"),b=a&&a.getAdornmentModel("plottedValue");if(SC.none(this.functionEditView)){this.functionEditView=DG.PlottedValueAdornment.createFormulaEditView(b);this.get("parentView").appendChild(this.functionEditView)}this.functionEditView.set("isVisible",b.get("isVisible"));if(SC.none(this.plottedValueAdorn)){this.plottedValueAdorn=DG.PlottedValueAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,valueAxisView:this.get("primaryAxisView")})}}.observes(".model.plottedValue"),cleanupFunc:function(){this.prepareToResetCoordinates();this.displayDidChange()},zoom:function(d){var g=(this.getPath("model.primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?"x":"y",b=this.get("primaryAxisView"),a={},f=d.shiftKey?2:0.5,c=DG.ViewUtilities.windowToViewCoordinates({x:d.clientX,y:d.clientY},this);a[g]=b.coordinateToData(c[g]);this.get("model").dilate(a,f)},handleBackgroundClick:function(a){if(a.altKey){this.zoom(a)}},handleBackgroundDblClick:function(a){this.zoom(a)}});DG.LegendModel=SC.Object.extend({attributeDescription:null,label:function(){var b=this.get("attributeDescription"),a=SC.none(b)?null:b.get("attribute");return(a===DG.Analysis.kNullAttribute)?"":a.get("name")}.property("attributeDescription.attribute"),numberOfCells:function(){return Math.max(1,this.getPath("attributeDescription.attributeStats.numberOfCells"))}.property("attributeDescription.attributeStats.numberOfCells"),numericRange:function(){return this.getPath("attributeDescription.attributeStats.numericRange")}.property("attributeDescription.attributeStats.numericRange"),cellNames:function(){var a=this.getPath("attributeDescription.attributeStats.cellMap");return DG.ObjectMap.keys(a)}.property("attributeDescription.attributeStats.cellMap"),selectCasesInCell:function(c,g){var d=this.getPath("attributeDescription.collectionClient"),a=d&&DG.DataContext.getContextFromCollection(d),f=this.get("attributeDescription").casesForCategory(c),b={operation:"selectCases",collection:d,cases:f,select:true,extend:g};if(a&&f){a.applyChange(b)}}});sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.LegendView=DG.RaphaelBaseView.extend(DG.GraphDropTarget,(function(){var d=150,c=3,a=12;return{displayProperties:["model.attributeDescription.attribute","model.attributeDescription.attributeStats.categoricalStats.numberOfCells","model.numericRange"],model:null,orientation:"horizontal",plottedAttribute:function(){return this.getPath("model.attributeDescription.attribute")}.property(),desiredExtent:function(){var j=this.getPath("parentView.frame.width")||d,k=Math.max(2,Math.floor(j/d)),i=this.get("labelExtent").y,g=this.model?this.getPath("model.numberOfCells"):0,h=this.get("isNumeric")?3:(1+Math.ceil(g/k)),f=h*i;DG.assert(isFinite(f));return f}.property("labelNode","model.numberOfCells"),labelExtent:function(){var h=DG.RenderingUtilities.kCaptionFontHeight,f=this.get("labelNode"),g;if(!SC.none(f)){g=f.getBBox();return{x:isNaN(g.width)?h:Math.max(h,g.width),y:isNaN(g.height)?h:Math.max(h,Math.ceil(g.height/2)*2)}}return{x:0,y:0}}.property("labelNode").cacheable(),labelNode:function(){var g=false,f;if(SC.none(this._paper)){return}if(SC.none(this._labelNode)){this._labelNode=this._paper.text(0,0,"").attr({font:"caption",fill:"blue",cursor:"pointer",title:SC.String.loc("DG.LegendView.attributeTooltip"),"text-anchor":"start"});this._labelNode.node.setAttribute("text-decoration","underline");g=true}f=this.getPath("model.label");if(f!==this._labelNode.attr("text")){this._labelNode.attr({text:f});g=true}if(g){this.notifyPropertyChange("labelNode",this._labelNode)}if(SC.empty(f)){return null}else{return this._labelNode}}.property("model.label"),labelNodes:function(){var f=this.get("labelNode");if(f){return[f]}else{return[]}}.property("labelNode"),_labelNode:null,_gradientRect:null,doDraw:function b(){var m=this,l=this.getPath("model.attributeDescription"),g=l.get("attributeStats"),k=m._paper.width-2*a,j=m._paper.height-2*c;function h(){var n=m.get("labelNode"),o=m.get("labelExtent");if(SC.none(n)){return}n.attr({text:m.getPath("model.label"),x:a,y:o.y/2})}function f(){var n=DG.ColorUtilities.calcAttributeColor(l).colorString,u=g.get("minMax"),p=pv.Format.number().fractionDigits(0,2)(u.min),t=pv.Format.number().fractionDigits(0,2)(u.max),s=m.get("labelExtent").y,o=0.5,v=4,w=3,x,q=(SC.browser.isSafari),A={stroke:n,"stroke-width":o,width:k,height:j/3,fill:("0-#fff-"+n)};if(q){m._elementsToClear.push(m._paper.rect(a,c+s,0,0).attr(A))}else{if(SC.none(m._gradientRect)){m._gradientRect=m._paper.rect(a,c+s,0,0)}m._gradientRect.attr(A).show()}for(x=0;x<=v;x++){var z=a+o+x*(k-2*o)/4,r=c+s+j/3;m._elementsToClear.push(m._paper.line(z,r,z,r+w).attr({stroke:n}))}var y=c+s+j/3+w+DG.RenderingUtilities.kDefaultFontHeight/2;m._elementsToClear.push(m._paper.text(a+o,y,p));m._elementsToClear.push(m._paper.text(a+k-2*o,y,t))}function i(){var s=Math.max(2,Math.floor(k/d)),B=m.getPath("model.numberOfCells"),n=Math.ceil(B/s),y=j/(n+1),p=y-2*c,v,A=m.getPath("model.cellNames");function o(D){m.get("model").selectCasesInCell(this.cellName,D.shiftKey)}function r(D){m.get("model").selectCasesInCell(this.attr("text"),D.shiftKey)}for(v=0;v<B;v++){var q=A[v],u=DG.ColorUtilities.calcCaseColor(q,l).colorString,x=Math.floor(v/s),C=v%s,z=a+C*k/s,w=c+(x+1)*y,t=m._paper.rect(z,w,p,p).attr({fill:u}).addClass(DG.PlotUtilities.kLegendKey).mousedown(o);t.cellName=q;m._elementsToClear.push(t);m._elementsToClear.push(m._paper.text(z+y,w+DG.RenderingUtilities.kDefaultFontHeight/3,q).attr({"text-anchor":"start"}).addClass(DG.PlotUtilities.kLegendKeyName).mousedown(r))}}h();if(this.get("isNumeric")){f()}else{if(this._gradientRect){this._gradientRect.hide()}i()}},dragData:null,performDragOperation:function(f,g){this.set("dragData",f.data);return SC.DRAG_LINK},drawWidth:function(){return this.get("frame").width-2*DG.ViewUtilities.kBorderWidth}.property("frame"),drawHeight:function(){return this.get("frame").height}.property("frame"),isNumeric:function(){return this.getPath("model.attributeDescription.isNumeric")}.property("model.attributeDescription.isNumeric"),attributeTypeDidChange:function(){this.displayDidChange()}.observes(".model.attributeDescription.attributeStats.attributeType")}}()));DG.NumberToggleModel=SC.Object.extend({dataConfiguration:null,_cachedCaseCount:null,_cachedParentCases:null,parentCases:function(){var a=[],b=this.getPath("dataConfiguration.allCases");if(!b){return[]}b=b.flatten();if(b.length===this._cachedCaseCount){a=this._cachedParentCases}else{b.forEach(function(d){var c=d.get("parent");if(c&&a.indexOf(c)<0){a.push(c)}});this._cachedCaseCount=b.length;this._cachedParentCases=a}return a}.property("*dataConfiguration.cases"),numberOfParents:function(){return this.get("parentCases").length}.property("parentCases"),nameOfParentCollection:function(){var a="";if(this.get("numberOfParents")>0){a=this.get("parentCases")[0].getPath("collection.name")}return a}.property(),childrenOfParent:function(c){var a=this.get("parentCases"),b=(c<a.length)?a[c]:null;return b?b.get("children").flatten():[]},changeAllCaseVisibility:function(){var a=this.get("dataConfiguration");a.showAllCases()},toggleChildrenVisibility:function(c){var a=this.childrenOfParent(c),d=this.get("dataConfiguration"),b=d.get("cases");d.hideCases(b);d.showCases(a)},allChildrenAreHidden:function(d){var c=this.childrenOfParent(d),b=this.getPath("dataConfiguration.hiddenCases");function a(f){return b.indexOf(f)<0}return !c.some(a)},allCasesAreHidden:function(){return this.get("dataConfiguration").getCaseCount()===0},handleDataContextNotification:function(a){this.invokeOnceLater(this.propertyDidChange,300,"caseCount")}});sc_require("views/raphael_base");DG.NumberToggleView=DG.RaphaelBaseView.extend((function(){var b=33,a=SC.Object.extend({paper:null,url:null,depressedUrl:null,action:null,target:null,arrow:null,depressedArrow:null,_position:null,_state:null,kHeight:19,init:function(){arguments.callee.base.apply(this,arguments);var d=false,f=this;this._position={x:0,y:0};this.arrow=this.paper.image(this.url,0,0,b,this.kHeight).hide().attr({cursor:"pointer"}).mousedown(function(){d=true;f._state="depressed";f.show()});this.depressedArrow=this.paper.image(this.depressedUrl,0,0,b,this.kHeight).hide().mouseup(function(){if(d&&f.action){f.action.call(f.target)}d=false;f._state="normal";f.show()})},position:function(d,f){if(f){this._position=f;if(this.arrow){this.arrow.attr(this._position)}if(this.depressedArrow){this.depressedArrow.attr(this._position)}}return this._position}.property(),show:function(){if(!this._state){this._state="normal"}switch(this._state){case"normal":this.arrow.show();this.depressedArrow.hide();break;case"depressed":this.depressedArrow.show();this.arrow.hide();break}return this},hide:function(){this.arrow.hide();this.depressedArrow.hide();return this}});return{displayProperties:["firstDisplayedIndex","lastDisplayedIndex"],model:null,firstDisplayedIndex:0,lastDisplayedIndex:0,_leftArrow:null,_rightArrow:null,leftArrow:function(){if(this._paper&&!this._leftArrow){this._leftArrow=a.create({paper:this._paper,url:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/arrow_left.png",depressedUrl:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/arrow_left_depressed.png",action:this.scrollLeft,target:this})}return this._leftArrow}.property(),rightArrow:function(){if(this._paper&&!this._rightArrow){this._rightArrow=a.create({paper:this._paper,url:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/arrow_right.png",depressedUrl:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/arrow_right_depressed.png",action:this.scrollRight,target:this})}return this._rightArrow}.property(),desiredExtent:function(){return DG.RenderingUtilities.kCaptionFontHeight}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.lastDisplayedIndex=this.getPath("model.numberOfParents")-1},doDraw:function c(){var i=function(z){DG.logUser("Show parent: %@",z.toggleIndex+1);this.get("model").toggleChildrenVisibility(z.toggleIndex)}.bind(this),q=function(){this.get("model").changeAllCaseVisibility();DG.logUser("Show all parents:")}.bind(this),v=function(){var z=false;return this._paper.text(0,0,"DG.NumberToggleView.showAll".loc()+" -").attr({font:"caption",cursor:"pointer","text-anchor":"start",fill:p.allCasesAreHidden()?"lightGray":"black",title:SC.String.loc("DG.NumberToggleView.overallTooltip")}).mousedown(function(){z=true}).mouseup(function(){if(z){q()}z=false})}.bind(this),f=function(){var C,z=false;function B(F){z=true}function E(F){if(z){i(this)}z=false}for(C=0;C<h;C++){var D=p.allChildrenAreHidden(C)?"lightGray":"black",A=this._paper.text(-100,n,C+1).attr({font:"caption",cursor:"pointer","text-anchor":"start",fill:D}).mousedown(B).mouseup(E);A.width=A.getBBox().width;A.toggleIndex=C;x.push(A);d+=A.width+g;this._elementsToClear.push(A)}}.bind(this),s=function(){var z=l,A;if(u){y=this.get("leftArrow").show();y.set("position",{x:z,y:0});z+=b}else{this.get("leftArrow").hide()}for(A=this.firstDisplayedIndex;A<=this.lastDisplayedIndex;A++){x[A].attr({x:z});z+=x[A].width+g}if(k){o=this.get("rightArrow").show();o.set("position",{x:z-g,y:0})}else{this.get("rightArrow").hide()}}.bind(this);var g=5,p=this.get("model"),h=p.get("numberOfParents"),j=v(),r=j.getBBox(),n=r.height/2,l=r.x+r.width+g,m=this._paper.width-l,k,u,o,y,x=[],d=0,t,w;this._elementsToClear.push(j);if(!DG.isFinite(l)||!DG.isFinite(n)){return}if(n===0){this.invokeLast(this.displayDidChange);return}j.attr({y:n});f();if(d<=m){k=u=false;this.firstDisplayedIndex=0;this.lastDisplayedIndex=h-1}else{if(this.lastDisplayedIndex===h-1){k=false;u=true;w=b;t=h;while(w<m&&t>0){t--;w+=x[t].width+g}this.firstDisplayedIndex=t+1}else{k=true;w=b;t=this.lastDisplayedIndex+1;while(w<m&&t>0){t--;w+=x[t].width+g}this.firstDisplayedIndex=t;if(this.firstDisplayedIndex===0){u=false}else{u=true;w=2*b;t=this.lastDisplayedIndex+1;while(w<m&&t>0){t--;w+=x[t].width+g}this.firstDisplayedIndex=t+1}}}s()},scrollLeft:function(){var f=this.get("firstDisplayedIndex"),g=this.get("lastDisplayedIndex"),d=Math.min(f,g-f);this.decrementProperty("lastDisplayedIndex",d)},scrollRight:function(){var f=this.get("firstDisplayedIndex"),h=this.get("lastDisplayedIndex"),g=this.getPath("model.numberOfParents"),d=Math.min(g-h-1,h-f);this.incrementProperty("lastDisplayedIndex",d)},shouldShow:function(){return this.getPath("model.numberOfParents")>1},handleCaseCountChange:function(){this.set("lastDisplayedIndex",this.getPath("model.numberOfParents")-1);this.displayDidChange()}.observes("model.caseCount"),handleHiddenCasesChange:function(){SC.run(function(){this.displayDidChange()}.bind(this))}.observes("model.dataConfiguration.hiddenCases")}}()));sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.PlotBackgroundView=DG.RaphaelBaseView.extend(DG.GraphDropTarget,{autoDestroyProperties:["_backgroundForClick"],displayProperties:["xAxisView.model.lowerBound","xAxisView.model.upperBound","yAxisView.model.lowerBound","yAxisView.model.upperBound","xAxisView.model.attributeDescription.attributeStats.categoricalStats.numberOfCells","yAxisView.model.attributeDescription.attributeStats.categoricalStats.numberOfCells"],graphModel:null,xAxisView:null,yAxisView:null,_backgroundForClick:null,didCreateLayer:function(){var a=this.get("parentView");arguments.callee.base.apply(this,arguments);a.get("plotViews").forEach(function(b){b.didCreateLayer()});a.drawPlots()},initLayerManager:function(){arguments.callee.base.apply(this,arguments);var a=DG.LayerNames;this.get("layerManager").addNamedLayer(a.kBackground).addNamedLayer(a.kGrid).addNamedLayer(a.kIntervalShading).addNamedLayer(a.kClick).addNamedLayer(a.kGhost).addNamedLayer(a.kConnectingLines).addNamedLayer(a.kPoints).addNamedLayer(a.kSelectedPoints).addNamedLayer(a.kAdornments).addNamedLayer(a.kDataTip)},doDraw:function doDraw(){var k=this,c=this.get("frame"),n=this.get("xAxisView"),a=this.get("yAxisView"),o=this.getPath("layerManager."+DG.LayerNames.kBackground),j=this.getPath("layerManager."+DG.LayerNames.kGrid),g=(n.get("isNumeric")&&a.get("isNumeric")),t,d,f=[],p=false,b;function h(){function w(A,B,C){j.push(k._paper.line(A,c.height,A,0).attr({stroke:B,"stroke-width":C}))}function x(C,A,B){j.push(k._paper.line(0,C,c.width,C).attr({stroke:A,"stroke-width":B}))}function y(B,A){w(A,DG.PlotUtilities.kRuleColor,DG.PlotUtilities.kRuleWidth)}function v(A,B){x(B,DG.PlotUtilities.kRuleColor,DG.PlotUtilities.kRuleWidth)}function z(){function A(B,D){var C=B.get("zeroPixel");if(C){D(C,DG.PlotUtilities.kZeroLineColor,DG.PlotUtilities.kZeroLineWidth)}}A(n,w);A(a,x)}if(g){n.forEachTickDo(y);a.forEachTickDo(v);z()}}function m(w,v,x){if(x.altKey){return}if(x.shiftKey){f=k.getPath("graphModel.selection").toArray()}else{k.get("graphModel").selectAll(false)}d=DG.ViewUtilities.windowToViewCoordinates({x:w,y:v},k);t=k._paper.rect(d.x,d.y,0,0).attr({fill:DG.PlotUtilities.kMarqueeColor,stroke:DG.RenderingUtilities.kTransparent});k.getPath("layerManager."+DG.LayerNames.kAdornments).push(t)}function s(B,z){if(SC.none(t)){return}var v=(B>0)?d.x:d.x+B,A=(z>0)?d.y:d.y+z,y=Math.abs(B),x=Math.abs(z),w={x:v,y:A,width:y,height:x};t.attr(w);k.get("parentView").selectPointsInRect(w,f)}function q(x,w){if(SC.none(t)){return}k.getPath("layerManager").removeElement(t);t=null;f=[];var v=k.getPath("graphModel.casesController.selection.length");if(v>0){DG.logUser("marqueeSelection: %@",v)}}function u(x){if(x.altKey){var v="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/MagnifyPlus.cur",y="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/cursors/MagnifyMinus.cur",w=x.shiftKey?y:v;this.attr({cursor:DG.Browser.customCursorStr(w,8,8)})}else{this.attr({cursor:"auto"})}}function l(){if(b){b.hide();b.destroy();b=null}}function i(w){if(!p){var v="DG.GraphView.zoomTip".loc();b=DG.ToolTip.create({paperSource:k,text:v,tipOrigin:{x:w.layerX,y:w.layerY},layerName:"dataTip"});b.show();p=true;k.invokeLater(l,5000)}}var r=function(){var E=this.get("paper"),K=this.get("xAxisView"),J=this.get("yAxisView"),z=K.getPath("model.numberOfCells"),v=J.getPath("model.numberOfCells"),F=K.get("fullCellWidth"),y=J.get("fullCellWidth"),w=this.getPath("model.orientation")==="vertical",I=w?F:y,B=w?y:F,H,A,x,G,D,C;if(SC.none(E)){return}for(A=0;A<v;A++){if(w){x=J.cellToCoordinate(A);D=x-y/2}else{G=J.cellToCoordinate(A);C=G-y/2}for(H=0;H<z;H++){if(w){G=K.cellToCoordinate(H);C=G-F/2}else{x=K.cellToCoordinate(H);D=x-F/2}if((A+H)/2!==Math.floor((A+H)/2)){o.push(E.rect(D,C,B,I).attr({fill:DG.PlotUtilities.kPlotCellFill,opacity:0.8,stroke:DG.RenderingUtilities.kTransparent}))}}}}.bind(this);j.clear();o.clear();h();r();if(SC.none(this._backgroundForClick)){this._backgroundForClick=this.getPath("layerManager."+DG.LayerNames.kClick).push(this._paper.rect(0,0,0,0).attr({fill:DG.RenderingUtilities.kSeeThrough,stroke:DG.RenderingUtilities.kTransparent}).click(function(v){k.get("parentView").handleBackgroundClick(v)}).dblclick(function(v){k.get("parentView").handleBackgroundDblClick(v)}).drag(s,m,q).mousemove(u))}this._backgroundForClick.attr({width:this.get("drawWidth"),height:this.get("drawHeight")})}});sc_require("components/graph/plots/plot_model");sc_require("components/graph/plots/numeric_plot_model_mixin");DG.ScatterPlotModel=DG.PlotModel.extend(DG.NumericPlotModelMixin,{movableLine:null,isMovableLineVisible:function(){return !SC.none(this.movableLine)&&this.movableLine.get("isVisible")}.property("movableLine.isVisible"),isInterceptLocked:function(){return !SC.none(this.movableLine)&&this.movableLine.get("isInterceptLocked")}.property("movableLine.isInterceptLocked"),areSquaresVisible:false,squares:null,lineDidChange:function(){this.notifyPropertyChange("squares")}.observes(".movableLine.slope",".movableLine.intercept"),createMovableLine:function(){if(SC.none(this.movableLine)){this.beginPropertyChanges();this.set("movableLine",DG.MovableLineModel.create());this.movableLine.recomputeSlopeAndIntercept(this.get("xAxis"),this.get("yAxis"));this.endPropertyChanges()}},toggleMovableLine:function(){if(SC.none(this.movableLine)){this.createMovableLine()}else{this.movableLine.recomputeSlopeAndInterceptIfNeeded(this.get("xAxis"),this.get("yAxis"));this.movableLine.set("isVisible",!this.movableLine.get("isVisible"))}DG.logUser("toggleMovableLine: %@",this.movableLine.get("isVisible")?"show":"hide")},toggleInterceptLocked:function(){if(SC.none(this.movableLine)){this.createMovableLine()}else{this.movableLine.toggleInterceptLocked();this.movableLine.recomputeSlopeAndInterceptIfNeeded(this.get("xAxis"),this.get("yAxis"))}DG.logUser("lockIntercept: %@",this.movableLine.get("isInterceptLocked"))},togglePlotFunction:function(){this.toggleAdornmentVisibility("plottedFunction","togglePlotFunction");if(this.isAdornmentVisible("plottedFunction")){var a=this.getAdornmentModel("plottedFunction");if(a){a.set("dataConfiguration",this.get("dataConfiguration"))}}},toggleConnectingLine:function(){var a=this.toggleAdornmentVisibility("connectingLine","toggleConnectingLine");if(a&&a.get("isVisible")){a.recomputeValue()}},toggleShowSquares:function(){this.set("areSquaresVisible",!this.get("areSquaresVisible"))},handleDataConfigurationChange:function(){arguments.callee.base.apply(this,arguments);this.rescaleAxesFromData(true,true);var a=this.getAdornmentModel("connectingLine");if(a){a.setComputingNeeded()}},rescaleAxesFromData:function(c,b,a){if(b===undefined){b=true}this.doRescaleAxesFromData([DG.GraphTypes.EPlace.eX,DG.GraphTypes.EPlace.eY],c,b);if(a){DG.logUser("rescaleScatterplot")}},dilate:function(b,a){this.doDilation([DG.GraphTypes.EPlace.eX,DG.GraphTypes.EPlace.eY],b,a)},getGearMenuItems:function(){var i=this,h=this.get("isMovableLineVisible"),c=this.isAdornmentVisible("plottedFunction"),b=h?"Hide Movable Line":"Show Movable Line",f=(this.isAdornmentVisible("connectingLine")?"DG.ScatterPlotModel.HideConnectingLine":"DG.ScatterPlotModel.ShowConnectingLine").loc(),a=(this.get("isInterceptLocked")?"DG.ScatterPlotModel.UnlockIntercept":"DG.ScatterPlotModel.LockIntercept").loc(),g=c?"Hide Plotted Function":"Plot Function",d=this.get("areSquaresVisible")?"Hide Squares":"Show Squares";return[{title:"Rescale to Data",target:i,itemAction:i.rescaleAxesFromData,args:[true,false,true]},{title:f,target:i,itemAction:this.toggleConnectingLine},{title:b,target:i,itemAction:this.toggleMovableLine},{title:a,target:i,itemAction:this.toggleInterceptLocked,isEnabled:h},{title:g,target:i,itemAction:this.togglePlotFunction},{title:d,target:i,itemAction:this.toggleShowSquares,isEnabled:h||c}].concat(arguments.callee.base.apply(this,arguments)).concat([{isSeparator:YES}])},createStorage:function(){var b=arguments.callee.base.apply(this,arguments),a=this.get("movableLine");if(!SC.none(a)){b.movableLineStorage=a.createStorage()}if(this.get("areSquaresVisible")){b.areSquaresVisible=true}return b},restoreStorage:function(a){this.moveAdornmentStorage(a,"movableLine",a.movableLineStorage);this.moveAdornmentStorage(a,"plottedFunction",a.plottedFunctionStorage);arguments.callee.base.apply(this,arguments);if(a.movableLineStorage){if(SC.none(this.movableLine)){this.createMovableLine()}this.get("movableLine").restoreStorage(a.movableLineStorage)}if(a.areSquaresVisible){this.toggleShowSquares()}if(a.plottedFunctionStorage){if(SC.none(this.plottedFunction)){this.set("plottedFunction",DG.PlottedFunctionModel.create())}this.get("plottedFunction").restoreStorage(a.plottedFunctionStorage)}},onRescaleIsComplete:function(){if(!SC.none(this.movableLine)){this.movableLine.recomputeSlopeAndInterceptIfNeeded(this.get("xAxis"),this.get("yAxis"))}},getCellCaseCounts:function(){var d=this.get("cases"),a=this.get("xVarID"),f=this.get("yVarID"),c=0,b=[];if(!(a&&f)){return b}d.forEach(function(g,i){var j=g.getNumValue(a),h=g.getNumValue(f);if(isFinite(j)&&isFinite(h)){++c}});b.push({count:c,primaryCell:0,secondaryCell:0});return b}});sc_require("components/graph/plots/plot_view");DG.ScatterPlotView=DG.PlotView.extend({displayProperties:["xAxisView.model.lowerBound","xAxisView.model.upperBound","yAxisView.model.lowerBound","yAxisView.model.upperBound","xAxisView.pixelMin","xAxisView.pixelMax","yAxisView.pixelMin","yAxisView.pixelMax","model.areSquaresVisible","model.squares"],autoDestroyProperties:["movableLineAdorn","functionAdorn","connectingLineAdorn"],connectingLineAdorn:null,primaryAxisView:function(){return this.get("xAxisView")}.property("xAxisView"),secondaryAxisView:function(){return this.get("yAxisView")}.property("yAxisView"),movableLineAdorn:null,functionEditView:null,functionAdorn:null,_squares:null,cleanupFunc:function(){var a=this.get("connectingLineAdorn");if(a){a.updateToModel()}},destroy:function(){var a=this.get("model");if(a){a.removeObserver("squares",this,"squaresDidChange")}if(a){a.removeObserver("areSquaresVisible",this,"squaresDidChange")}arguments.callee.base.apply(this,arguments)},modelDidChange:function(){arguments.callee.base.apply(this,arguments);var a=this.get("model");if(a){a.addObserver("squares",this,"squaresDidChange");a.addObserver("areSquaresVisible",this,"squaresDidChange");this.connectingLineChanged()}},dataDidChange:function(){arguments.callee.base.apply(this,arguments);if(this.connectingLineAdorn){this.connectingLineAdorn.invalidateModel()}},dataRangeDidChange:function(a,h,d,f){var c=this,j=this._plottedElements.length,b=this.getPath("model.cases"),i=this.createRenderContext(),g=(SC.typeOf(f)===SC.T_NUMBER?[f]:f);DG.assert(g);g.forEach(function(k){if(k>=j){c.callCreateCircle(b[k],k,c._createAnimationOn)}c.setCircleCoordinate(i,b[k],k)});if(this.getPath("model.areSquaresVisible")){this.squaresDidChange()}if(this.connectingLineAdorn){this.connectingLineAdorn.invalidateModel();this.connectingLineAdorn.updateToModel()}this.rescaleOnParentCaseCompletion(b);arguments.callee.base.apply(this,arguments)},calcPointRadius:function(){var b=2,a=arguments.callee.base.apply(this,arguments);if(this.connectingLineAdorn&&this.connectingLineAdorn.wantVisible()){a=Math.max(b,a-4)}return a},setCircleCoordinate:function setCircleCoordinate(d,b,f,i,c){DG.assert(d&&d.xAxisView);DG.assert(b);DG.assert(DG.MathUtilities.isInIntegerRange(f,0,this._plottedElements.length));var a=this._plottedElements[f],h=d.xAxisView.dataToCoordinate(b.getNumValue(d.xVarID)),g=d.yAxisView.dataToCoordinate(b.getNumValue(d.yVarID)),j=!DG.isFinite(h)||!DG.isFinite(g);if(this.showHidePlottedElement(a,j)){this.updatePlottedElement(a,h,g,this._pointRadius,d.calcCaseColorString(b),i,c);return{cx:h,cy:g,r:this._pointRadius}}return null},createCircle:function(j,f,l){var d=this;function k(o){var m=d.getPath("model.xVarID"),q=d.getPath("model.yVarID"),n={operation:"updateCases",cases:[],attributeIDs:[m,q],values:[[],[]]},p=d.get("dataContext");if(!p){return}d.getPath("model.casesController.selection").forEach(function(r){n.cases.push(r);n.values[0].push(r.getNumValue(m)+o.x);n.values[1].push(r.getNumValue(q)+o.y)});p.applyChange(n)}function b(r,n){var o=d.getPath("model.cases")[r],m=d.getPath("model.xVarID"),s=d.getPath("model.yVarID"),q=o.getNumValue(m)-n.x,p=o.getNumValue(s)-n.y;d.get("model").animateSelectionBackToStart([m,s],[q,p])}function g(){this.hoverAnimation=null}var c=false,h=1,i=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(m){if(!c&&SC.none(i)){i="";if(this.hoverAnimation){this.stop(this.hoverAnimation)}this.hoverAnimation=Raphael.animation({opacity:h,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime,"<>",g);this.animate(this.hoverAnimation);d.showDataTip(this,f)}},function(m){if(!c){if(this.hoverAnimation){this.stop(this.hoverAnimation)}this.hoverAnimation=Raphael.animation({transform:i},DG.PlotUtilities.kHighlightHideTime,"<>",g);this.animate(this.hoverAnimation);i=null;d.hideDataTip()}}).mousedown(function(m){d.get("model").selectCaseByIndex(f,m.shiftKey||m.metaKey)}).drag(function(n,m){SC.run(function(){var t=d.get("xAxisView").coordinateToData(this.ox+n),s=d.get("yAxisView").coordinateToData(this.oy+m),p=d.getPath("model.cases")[this.index],r=p.getNumValue(d.getPath("model.xVarID")),q=p.getNumValue(d.getPath("model.yVarID")),o=this.transform();if(isFinite(t)&&isFinite(s)){this.transform(i);k({x:t-r,y:s-q});this.transform(o)}},this)},function(m,o){var n=d.getPath("model.cases")[this.index];c=true;this.ox=this.attr("cx");this.oy=this.attr("cy");this.wx=n.getNumValue(d.getPath("model.xVarID"));this.wy=n.getNumValue(d.getPath("model.yVarID"));this.animate({opacity:h},DG.PlotUtilities.kDataTipShowTime,"bounce")},function(){this.animate({transform:i},DG.PlotUtilities.kHighlightHideTime);i=null;b(this.index,{x:this.wx,y:this.wy});c=false;this.ox=this.oy=this.wx=this.wy=undefined;d.hideDataTip()});a.index=f;a.node.setAttribute("shape-rendering","geometric-precision");if(l){DG.PlotUtilities.doCreateCircleAnimation(a)}return a},drawData:function drawData(){if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}arguments.callee.base.apply(this,arguments)},doDraw:function doDraw(){var b=this;function a(){var c=b.getPath("model.areSquaresVisible"),g=!c&&b._squares&&(b._squares.length>0),f=c&&(!b._squares||(b._squares.length===0));if(!b._squares){b._squares=[]}b._squares.forEach(function(o){if(g){o.animate({"stroke-opacity":0},DG.PlotUtilities.kDefaultAnimationTime,"<>",function(){o.remove()})}else{o.remove()}});b._squares=[];if(!c){return}var d=b.getPath("model.cases"),k=b.getPath("model.xVarID"),m=b.getPath("model.yVarID"),i=b.get("xAxisView"),n=b.get("yAxisView"),h=b.get("paper");if(b.getPath("model.isMovableLineVisible")){var l=b.getPath("model.movableLine.slope"),j=b.getPath("model.movableLine.intercept");d.forEach(function(o){var q=o.getNumValue(k),p=o.getNumValue(m),y=i.dataToCoordinate(q),x=n.dataToCoordinate(p),r=n.dataToCoordinate(l*q+j),s=y+x-r,v=Math.min(y,s),u=Math.min(x,r),w=Math.abs(r-x),t=DG.RenderingUtilities.pathForFrame({x:v,y:u,width:w,height:w}),z=h.path(t).attr({stroke:"red"});if(f){z.attr({"stroke-opacity":0}).animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}b._squares.push(z)})}}arguments.callee.base.apply(this,arguments);this.drawData();this.updateSelection();if(!SC.none(this.connectingLineAdorn)&&this.connectingLineAdorn.wantVisible()){this.connectingLineAdorn.updateToModel()}if(!SC.none(this.movableLineAdorn)){this.movableLineAdorn.updateToModel()}if(!SC.none(this.functionAdorn)){this.functionAdorn.updateToModel()}a()},updateSelection:function(){arguments.callee.base.apply(this,arguments);if(this.connectingLineAdorn&&this.connectingLineAdorn.wantVisible()){this.connectingLineAdorn.updateSelection()}},enterAnimationState:function(){var f=this,a=this._plottedElements.length,d=this.getPath("model.cases"),c=this.createRenderContext(),b;d.forEach(function(g,h){var i=true;if(h>=a){f.callCreateCircle(g,h,false);i=false}f.setCircleCoordinate(c,d[h],h,i)});for(b=d.length;b<a;b++){this._plottedElements[b].animate({transform:"s0 0"},DG.PlotUtilities.kDefaultAnimationTime,"<>")}this.set("allowTransferAnimation",false)},movableLineChanged:function(){if(!this.readyToDraw()){return}var b=this.getPath("model.movableLine");if(b){if(!this.movableLineAdorn){var a=DG.MovableLineAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),xAxisView:this.get("xAxisView"),yAxisView:this.get("yAxisView"),layerName:DG.LayerNames.kAdornments});a.createElements();this.movableLineAdorn=a}this.movableLineAdorn.updateVisibility()}}.observes("*model.movableLine.isVisible"),connectingLineChanged:function(){var d=function(){if(b){b.updateToModel(true)}this.updatePointSize();this._elementOrderIsValid=false;this.updateSelection()}.bind(this);var a=this.get("model"),c=a&&a.getAdornmentModel("connectingLine"),b=this.get("connectingLineAdorn");if(c&&c.get("isVisible")&&!b){b=DG.ConnectingLineAdornment.create({parentView:this,model:c,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kConnectingLines});this.set("connectingLineAdorn",b)}this.invokeLast(d)}.observes(".model.connectingLine"),squaresDidChange:function(){this._isRenderingValid=false;this.displayDidChange()},plottedFunctionChanged:function(){var a=this.get("model"),b=a&&a.getAdornmentModel("plottedFunction");if(!b){return}if(!this.functionEditView){this.functionEditView=DG.PlottedFunctionAdornment.createFormulaEditView(b);this.get("parentView").appendChild(this.functionEditView)}this.functionEditView.set("isVisible",b.get("isVisible"));this.functionEditView.set("formulaExpression",b.get("expression"));if(SC.none(this.functionAdorn)){this.functionAdorn=DG.PlottedFunctionAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,xAxisView:this.get("xAxisView"),yAxisView:this.get("yAxisView")})}this.functionAdorn.updateVisibility()}.observes(".model.plottedFunction"),didCreateLayer:function(){arguments.callee.base.apply(this,arguments);this.movableLineChanged();this.plottedFunctionChanged()},zoom:function(c){var d=c.shiftKey?2:0.5,b=DG.ViewUtilities.windowToViewCoordinates({x:c.clientX,y:c.clientY},this),a={x:this.get("xAxisView").coordinateToData(b.x),y:this.get("yAxisView").coordinateToData(b.y)};this.get("model").dilate(a,d)},handleBackgroundClick:function(a){if(a.altKey){this.zoom(a)}},handleBackgroundDblClick:function(a){this.zoom(a)}});DG.Drag=SC.Drag.extend({_findDropTarget:function(b){var d=this._dropTargets(),c={x:b.pageX,y:b.pageY},a=null;d.forEach(function(g){if(g.constructor===DG.AxisMultiTarget){var f=g.convertFrameToView(g.get("frame"),null);if(SC.pointInRect(c,f)){a=g}}});if(!SC.none(a)){return a}else{return arguments.callee.base.apply(this,arguments)}}});DG.GraphAnimator=SC.Object.extend({isAnimating:false,startTime:null,plot:null,axisInfoArray:null,savedAxisInfoArray:null,destroy:function(){this.endAnimation();this.plot=null;this.axisInfoArray=null;this.savedAxisInfoArray=null;arguments.callee.base.apply(this,arguments)},animate:function(f,c){var h=this,g=50,d=DG.PlotUtilities.kDefaultAnimationTime;function b(){var i=(new Date()).valueOf(),j=(i-h.startTime)/d,l;function m(o){if(o>=1){return 1}else{return DG.AnimationMath.DefaultAnimationTween(o)}}function k(p,o,q){return p+q*(o-p)}function n(q){var o=k(q.oldBounds.lower,q.newBounds.lower,l),p=k(q.oldBounds.upper,q.newBounds.upper,l);q.axis.setLowerAndUpperBounds(o,p)}l=m(j);h.axisInfoArray.forEach(n);if(j<1){DG.assert(!h.animationTimer.get("isPaused"))}else{h.endAnimation(f,c)}}function a(i){i.oldBounds={lower:i.axis.get("lowerBound"),upper:i.axis.get("upperBound")}}if(this.isAnimating){this.endAnimation()}this.isAnimating=true;this.savedAxisInfoArray=this.axisInfoArray;this.axisInfoArray.forEach(a);this.startTime=(new Date()).valueOf();if(SC.none(this.animationTimer)){this.animationTimer=SC.Timer.schedule({action:b,interval:g,repeats:YES,until:false})}this.animationTimer.set("isPaused",NO);b()},endAnimation:function(b,a){this.animationTimer.set("isPaused",YES);if(!SC.none(this.plot)){this.setPath("plot.isAnimating",false)}this.savedAxisInfoArray.forEach(function(c){c.axis.setLowerAndUpperBounds(c.newBounds.lower,c.newBounds.upper)});this.isAnimating=false;if(!SC.none(a)){a.call(b)}}});DG.LayerNames={kBackground:"background",kGrid:"grid",kIntervalShading:"intervalShading",kClick:"click",kGhost:"ghost",kConnectingLines:"connectingLines",kPoints:"points",kSelectedPoints:"selectedPoints",kAdornments:"adornments",kDataTip:"dataTip"};DG.GuideConfigurationView=SC.PalettePane.extend({itemRow:SC.View.extend({blurAction:null,blurTarget:null,childViews:"itemTitle itemURL".w(),itemTitle:SC.TextFieldView.design({hint:"DG.GuideConfigView.itemTitleHint"}),itemURL:SC.TextFieldView.design({hint:"DG.GuideConfigView.itemURLHint"}),init:function(){arguments.callee.base.apply(this,arguments);var b=this.get("blurAction"),a=this.get("blurTarget");this.setPath("itemTitle.layout",{left:5,width:140});this.setPath("itemURL.layout",{left:150,right:5});this.get("childViews").forEach(function(c){c.set("fieldDidBlur",function(){if(b){b.call(a)}})})},rowObject:function(){var a=this.getPath("itemTitle.value"),b=this.getPath("itemURL.value");if(!SC.empty(a)||!SC.empty(b)){return{itemTitle:a,url:b}}return null}.property(),setItem:function(a){if(a){this.setPath("itemTitle.value",a.itemTitle);this.setPath("itemURL.value",a.url)}}}),model:null,isModal:YES,layout:{width:400,height:400,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"titleField menuItems okButton cancel".w(),titleField:SC.TextFieldView.design({layout:{top:5,left:5,right:25,height:24},value:"",spellCheckEnabled:true,hint:"DG.GuideConfigView.titleHint",leftAccessoryView:SC.LabelView.create({layout:{left:1,width:95,height:22,centerY:0},value:"DG.GuideConfigView.titlePrompt",backgroundColor:"lightgray",localize:true})}),menuItems:SC.View.design({layout:{left:5,right:5,top:34,bottom:34},backgroundColor:"white"}),okButton:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,title:"DG.GuideConfigView.okBtnTitle",toolTip:"DG.GuideConfigView.okBtnToolTip",target:null,action:null,toolTip:"",localize:true,isDefault:true}),cancel:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,title:"DG.GuideConfigView.cancelBtnTitle",target:null,action:null,toolTip:"DG.GuideConfigView.cancelBtnTooltip",localize:true,isCancel:true})}),title:function(){return this.getPath("contentView.titleField.value")}.property(),items:function(){return this.get("rowObjects")}.property(),addMenuItemRow:function(d){var a=this.getPath("contentView.menuItems"),b=this.get("rowViews").length,f=5+b*27,c=this.itemRow.create({layout:{border:1,left:5,right:5,top:f+5,height:22},blurAction:this.configureRows,blurTarget:this});c.setItem(d);a.appendChild(c)},rowViews:function(){return this.getPath("contentView.menuItems.childViews")}.property(),rowObjects:function(){return this.get("rowViews").map(function(a){return a.get("rowObject")}).filter(function(a){return a?true:false})}.property(),configureRows:function(){var b=this.get("rowViews").length,a=this.get("rowObjects").length;while(b<a+1){this.addMenuItemRow();b++}},setupFromModel:function(b){var a=this.get("model");this.setPath("contentView.titleField.value",a.get("title"));a.get("items").forEach(function(c){this.addMenuItemRow(c)}.bind(this))},init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancel.target",this);this.setPath("contentView.cancel.action","close");this.setupFromModel();this.configureRows()},close:function(){this.remove();this.destroy()}});DG.CreateGuideConfigurationView=function(b){var d=DG.GuideConfigurationView.create(b),a=d.get("contentView"),c=d.getPath("contentView.titleField");a.setPath("okButton.target",b.okTarget);a.setPath("okButton.action",b.okAction);d.append();c.becomeFirstResponder();return d};DG.StringUtilities={guaranteePrefix:function(a,b){return(a.indexOf(b)===0)?a:b+a}};sc_require("controllers/component_controller");sc_require("utilities/string_utilities");DG.GuideController=DG.ComponentController.extend({guideModel:null,guideButton:null,guideMenuPane:null,updateViewTitle:function(){var a=this.getPath("guideModel.title"),b=this.getPath("guideModel.currentItemTitle");this.setPath("view.title",a+(SC.empty(b)?"":" - "+b))}.observes("guideModel.title","guideModel.currentItemTitle"),modelContentsDidChange:function(){var a=this.getPath("guideModel.title"),k=this.getPath("guideModel.items"),i=this.get("iconMenuItems"),b=this.get("guideButton"),d=this.get("guideMenuPane"),h=!SC.empty(a)||(k.length>0),j=this.getPath("guideModel.currentURL");if(b){b.set("isVisible",h)}if(d){var f="DG.ToolButtonData.guideMenu.showGuide".loc(),g=[{title:f,isEnabled:true,target:this,action:"showGuide"},{isSeparator:true}];d.set("items",g.concat(i))}if((i.length>0)&&SC.empty(j)){var c=i[0];this.setPath("guideModel.currentURL",c.url);this.setPath("guideModel.currentItemTitle",c.title)}}.observes("guideModel.title","guideModel.items"),showGuide:function(){var a=this.get("view");a.setPath("isVisible",true);a.bringToFront();a.scrollToVisible()},guideNavigation:function(){var a=this.getPath("guideMenuPane.selectedItem.url"),b=this.getPath("guideMenuPane.selectedItem.title");this.setPath("guideModel.currentURL",a);this.setPath("guideModel.currentItemTitle",b);this.showGuide();DG.logUser("Guide icon navigation: { Title: %@, itemTitle: %@, url: %@ }",this.getPath("guideModel.title"),b,a)},gearMenuItems:function(){var b=this.getPath("guideModel.items"),c=[],a=function(d){this.setPath("guideModel.currentURL",d.url);this.setPath("guideModel.currentItemTitle",d.itemTitle);DG.logUser("Guide gear navigation: { Title: %@, itemTitle: %@, url: %@ }",this.getPath("guideModel.title"),d.itemTitle,d.url)}.bind(this);b.forEach(function(d){c.push({title:d.itemTitle,url:d.url,target:this,itemAction:a,args:[d]})}.bind(this));return c}.property("guideModel.items"),iconMenuItems:function(){var b=this.getPath("guideModel.items"),c=[],a="guideNavigation";b.forEach(function(d){c.push({title:d.itemTitle,url:d.url,target:this,action:a})}.bind(this));return c}.property(),viewDidChange:function(){if(!SC.none(this.tempIsVisible)){this.setPath("view.isVisible",this.tempIsVisible)}this.tempIsVisible=undefined}.observes("view"),createComponentStorage:function(){var a=this.get("guideModel").createComponentStorage();a.isVisible=this.getPath("view.isVisible");return a},restoreComponentStorage:function(a){this.get("guideModel").restoreComponentStorage(a);if(!SC.none(a.isVisible)){this.tempIsVisible=a.isVisible}}});DG.GuideModel=SC.Object.extend({title:"",items:null,currentURL:"",currentItemTitle:"",init:function(){arguments.callee.base.apply(this,arguments);this.reset()},reset:function(){this.beginPropertyChanges();this.set("title","");this.set("currentURL","");this.set("currentItemTitle","");this.set("items",[]);this.endPropertyChanges()},createComponentStorage:function(){return{title:this.title,items:this.items,currentURL:this.currentURL,currentItemTitle:this.currentItemTitle}},restoreComponentStorage:function(a){this.beginPropertyChanges();if(a.currentURL){this.set("currentURL",a.currentURL)}if(a.title){this.set("title",a.title)}if(a.title){this.set("currentItemTitle",a.currentItemTitle)}if(a.items){this.set("items",a.items)}this.endPropertyChanges()}});DG.GuideView=SC.WebView.extend((function(){return{guideModel:null,realURL:function(){return DG.StringUtilities.guaranteePrefix(this.getPath("guideModel.currentURL"),"http://")}.property("guideModel.currentURL"),init:function(){arguments.callee.base.apply(this,arguments);DG.assert(!SC.none(this.get("guideModel")));this.currentURLDidChange()},currentURLDidChange:function(){this.set("value",this.get("realURL"))}.observes("guideModel.currentURL")}}()));sc_require("components/graph_map_common/plot_data_configuration");DG.MapDataConfiguration=DG.PlotDataConfiguration.extend({init:function(){var g={x:DG.AttributePlacementDescription.create(),y:DG.AttributePlacementDescription.create(),legend:DG.AttributePlacementDescription.create()},j,a=DG.currDocumentController().collectionDefaults(),h=a&&a.collectionClient,c=h&&h.getAttributeNames(),d,m,l,f,b=["latitude","lat","Latitude","Lat"],k=["longitude","long","lng","Longitude","Long","Lng"];arguments.callee.base.apply(this,arguments);var i=function(o,n){var p=g[o];DG.assert(p);if(n){p.set("collectionClient",h);p.set("attribute",n);p.setPath("attributeStats.attributeType",DG.Analysis.EAttributeType.eNumeric)}else{p.set("collectionClient",null);p.removeAllAttributes()}p.addObserver("collectionClient",this,o+"CollectionDidChange")}.bind(this);if(c){b.forEach(function(n){if(c.indexOf(n)>=0){d=n}});l=d&&h.getAttributeByName(d);k.forEach(function(n){if(c.indexOf(n)>=0){m=n}});f=m&&h.getAttributeByName(m)}i("x",f);i("y",l);i("legend",null);this.attributesByPlace=[];for(j=0;j<DG.GraphTypes.EPlace.eNumPlaces;j++){this.attributesByPlace[j]=[]}this.attributesByPlace[DG.GraphTypes.EPlace.eX][0]=g.x;this.attributesByPlace[DG.GraphTypes.EPlace.eY][0]=g.y;this.attributesByPlace[DG.GraphTypes.EPlace.eLegend][0]=g.legend}});DG.MapLayer=SC.Object.extend({containerView:null,kSanFran:[37.84,-122.1],kDefaultZoom:5,_layerID:null,_map:null,map:function(){return this._map}.property("_map"),didCreateMap:function(a){},init:function(){arguments.callee.base.apply(this,arguments)},render:function(a,b){if(b){this._layerID=a.push("<div></div>").id()}},didCreateLayer:function(){this.invokeLast(this._createMap)},_createMap:function(){var a=function(d){this.containerView.addPointLayer()}.bind(this),c=function(d){this.getPath("containerView.mapPointView").doDraw()}.bind(this);if(this._map){}else{this._map=L.map(this._layerID).setView(this.kSanFran,this.kDefaultZoom);this._map.on("layeradd",a);var b=L.tileLayer.wms("http://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv",{layers:"gebco_08_grid",format:"image/jpeg",crs:L.CRS.EPSG4326});this._map.addLayer(b,true);this._map.on("drag",c);this._map.on("zoomend",c)}},viewDidResize:function(){var a=this.get("map");if(a){a.invalidateSize()}}});sc_require("components/graph_map_common/data_display_model");DG.MapModel=DG.DataDisplayModel.extend({handleOneDataContextChange:function(a,b){this.get("dataConfiguration").invalidateCaches(null,b);b.indices=this.buildIndices(b);this.dataRangeDidChange(this,"revision",this,b.indices);this.set("lastChange",b)},selectCaseByIndex:function(d,g){var f=this.get("cases"),b=f[d],a=this.get("selection"),c={operation:"selectCases",collection:this.get("collectionClient"),cases:[b],select:true,extend:g};if(a.get("length")!==0){if(a.contains(b)){if(g){c.select=false}else{return}}else{c.select=true}}this.get("dataContext").applyChange(c);if(c.select){DG.logUser("caseSelected: %@",d)}else{DG.logUser("caseDeselected: %@",d)}},getLatLngBounds:function(){var a=this.getPath("dataConfiguration.yAttributeDescription.attributeStats.minMax"),b=this.getPath("dataConfiguration.xAttributeDescription.attributeStats.minMax"),d=[a.min,b.min],c=[a.max,b.max];return[d,c]},isAffectedByChange:function(a){return true}});sc_require("components/graph_map_common/plot_layer");DG.MapPointLayer=DG.PlotLayer.extend({displayProperties:[],autoDestroyProperties:[],mapSource:null,map:function(){return this.getPath("mapSource.mapLayer.map")}.property(),hasSomethingToDraw:function(){var a=this.get("model");return a&&!SC.none(a.getPath("dataConfiguration.yAttributeDescription.attributeID"))&&!SC.none(a.getPath("dataConfiguration.xAttributeDescription.attributeID"))},createRenderContext:function(){var b=this.get("model");if(!b){return}var a=b.getPath("dataConfiguration.legendAttributeDescription");return{map:this.get("map"),latVarID:b.getPath("dataConfiguration.yAttributeDescription.attributeID"),lngVarID:b.getPath("dataConfiguration.xAttributeDescription.attributeID"),legendDesc:a,legendVarID:a&&a.get("attributeID"),updatedPositions:true,calcCaseColorString:function(f){if(!this.legendVarID){return"yellow"}DG.assert(f);var c=f.getValue(this.legendVarID),d=DG.ColorUtilities.calcCaseColor(c,this.legendDesc,this.attrColor);return d.colorString}}},dataRangeDidChange:function(a,h,d,f){var c=this,j=this._plottedElements.length,b=this.getPath("model.cases"),i=this.createRenderContext(),g=(SC.typeOf(f)===SC.T_NUMBER?[f]:f);DG.assert(g);g.forEach(function(k){if(k>=j){c.callCreateCircle(b[k],k,c._createAnimationOn)}c.setCircleCoordinate(i,b[k],k)});arguments.callee.base.apply(this,arguments)},setCircleCoordinate:function(d,b,f,j,c){DG.assert(d&&d.map&&d.latVarID&&d.lngVarID);DG.assert(b);DG.assert(DG.MathUtilities.isInIntegerRange(f,0,this._plottedElements.length));var a=this._plottedElements[f],g=d.map.latLngToContainerPoint([b.getNumValue(d.latVarID),b.getNumValue(d.lngVarID)]),i=g.x,h=g.y,k=!DG.isFinite(i)||!DG.isFinite(h);if(this.showHidePlottedElement(a,k)){this.updatePlottedElement(a,i,h,this._pointRadius,d.calcCaseColorString(b),j,c);return{cx:i,cy:h,r:this._pointRadius}}return null},createCircle:function(j,f,l){var d=this;function k(o){var m=d.getPath("model.xVarID"),q=d.getPath("model.yVarID"),n={operation:"updateCases",cases:[],attributeIDs:[m,q],values:[[],[]]},p=d.get("dataContext");if(!p){return}d.getPath("model.casesController.selection").forEach(function(r){n.cases.push(r);n.values[0].push(r.getNumValue(m)+o.x);n.values[1].push(r.getNumValue(q)+o.y)});p.applyChange(n)}function b(r,n){var o=d.getPath("model.cases")[r],m=d.getPath("model.xVarID"),s=d.getPath("model.yVarID"),q=o.getNumValue(m)-n.x,p=o.getNumValue(s)-n.y;d.get("model").animateSelectionBackToStart([m,s],[q,p])}function g(){this.hoverAnimation=null}var c=false,h=1,i=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).mousedown(function(m){d.get("model").selectCaseByIndex(f,m.shiftKey||m.metaKey)});a.index=f;a.node.setAttribute("shape-rendering","geometric-precision");return a},doDraw:function doDraw(){if(this.hasSomethingToDraw()){this.drawData();this.updateSelection()}},updateSelection:function(){if(SC.none(this.get("map"))){return}arguments.callee.base.apply(this,arguments)}});sc_require("views/raphael_base");DG.MapPointView=DG.RaphaelBaseView.extend({autoDestroyProperties:[],displayProperties:[],model:null,mapPointLayer:null,mapLayer:null,initLayerManager:function(){arguments.callee.base.apply(this,arguments);var a=DG.LayerNames;this.get("layerManager").addNamedLayer(a.kBackground).addNamedLayer(a.kPoints).addNamedLayer(a.kSelectedPoints).addNamedLayer(a.kDataTip)},init:function(){arguments.callee.base.apply(this,arguments);this.set("mapPointLayer",DG.MapPointLayer.create({paperSource:this,model:this.get("model"),mapSource:this}))},modelDidChange:function(){this.setPath("mapPointLayer.model",this.get("model"))}.observes("model"),shouldDraw:function(){return !SC.none(this.getPath("mapLayer.map"))},doDraw:function doDraw(){this.get("mapPointLayer").doDraw()}});DG.MapView=SC.View.extend({model:null,mapLayer:null,mapPointView:null,init:function(){arguments.callee.base.apply(this,arguments);this.set("mapLayer",DG.MapLayer.create({containerView:this}))},addPointLayer:function(){function b(d){return !SC.none(d[0][0],d[0][1],d[1][0],d[1][1])}var c=[10,10];this.set("mapPointView",DG.MapPointView.create({mapLayer:this.get("mapLayer")}));this.setPath("mapPointView.model",this.get("model"));this.appendChild(this.get("mapPointView"));var a=this.get("model").getLatLngBounds();if(b(a)){this.getPath("mapLayer.map").fitBounds(a,c)}},render:function(a,b){arguments.callee.base.apply(this,arguments);this.get("mapLayer").render(a,b)},didCreateLayer:function(){this.get("mapLayer").didCreateLayer()},viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.get("mapLayer").viewDidResize()}});sc_require("controllers/component_controller");DG.SliderController=DG.ComponentController.extend({sliderModel:null,axisModel:null,sliderView:null,axisView:null,valueAnimator:null,animationSign:1,isAnimating:function(){return !!this.getPath("valueAnimator.isAnimating")}.property("valueAnimator.isAnimating"),modelDidChange:function(){var a=this.getPath("model.content");this.set("sliderModel",a);if(a){this.set("axisModel",a.get("axis"))}}.observes("model"),viewDidChange:function(){var a=this.getPath("view.contentView");this.set("sliderView",a);this.set("axisView",a.get("axisView"));a.set("controller",this)}.observes("view","view.contentView"),toggleAnimation:function(){var a=this.get("valueAnimator");if(SC.none(a)){a=DG.ValueAnimator.create({valueHolder:this.get("sliderModel"),incrementProvider:this});this.set("valueAnimator",a)}if(a.get("isAnimating")){a.endAnimation();DG.logUser("sliderEndAnimation: %@",this.getPath("sliderModel.name"))}else{a.animate();DG.logUser("sliderBeginAnimation: %@",this.getPath("sliderModel.name"))}},stopAnimation:function(){var a=this.get("valueAnimator");if(a&&a.get("isAnimating")){a.endAnimation()}},increment:function(){var a=this.get("axisModel"),d=this.get("axisView"),f=d&&d.get("increment"),b=a&&a.get("lowerBound"),c=a&&a.get("upperBound"),g=this.getPath("sliderModel.value"),h=g+this.get("animationSign")*f;if(h>c){this.set("animationSign",-1);f=h-c}else{if(h<b){this.set("animationSign",1);f=b-h}}return this.animationSign*f}.property("axisView.increment","axisModel.lowerBound","axisModel.upperBound","sliderModel.value"),createComponentStorage:function(){var c={},b=this.get("sliderModel"),a=this.get("axisModel");if(b){this.addLink(c,"model",b);if(a){c.lowerBound=a.get("lowerBound");c.upperBound=a.get("upperBound")}}return c},restoreComponentStorage:function(a,f){var d=this.getPath("model.content");if(d){var g=this.getLinkID(a,"model");if(g){var c=DG.store.find(DG.GlobalValue,g);if(c){DG.globalsController.registerGlobalValue(c);d.set("content",c)}}var b=d.get("axis");if(b&&a.lowerBound&&a.upperBound){b.setLowerAndUpperBounds(a.lowerBound,a.upperBound)}}}});DG.SliderModel=SC.Object.extend({axis:null,content:null,id:null,idBinding:"*content.id",name:null,nameBinding:"*content.name",value:null,valueBinding:"*content.value",animator:null,init:function(){arguments.callee.base.apply(this,arguments);var a=DG.CellLinearAxisModel.create();a.setDataMinAndMax(0,10);this.set("axis",a)},destroy:function(){DG.globalsController.destroyGlobalValue(this.get("content"));arguments.callee.base.apply(this,arguments)},encompassValue:function(){var c=this.get("axis"),b=c.get("lowerBound"),g=c.get("upperBound"),h=this.get("value");if((h<b)||(h>g)){var a=b,f=g,d=[];if(h<b){a=h-(g-h)/10}else{f=h+(h-b)/10}if(SC.none(this.get("animator"))){this.set("animator",DG.GraphAnimator.create())}d.push({axis:c,newBounds:{lower:a,upper:f}});DG.sounds.playDrag();this.get("animator").set("axisInfoArray",d).animate()}},getGearMenuItems:function(){return[]},bringValueInBounds:function(){if(this.getPath("animator.isAnimating")){return}var b=this.get("axis"),a=b.get("lowerBound"),c=b.get("upperBound"),d=this.get("value");if(d<a){this.set("value",a)}else{if(d>c){this.set("value",c)}}}.observes(".axis.lowerBound",".axis.upperBound"),toLink:function(){var a=this.get("content");return a?a.toLink():null}});DG.SliderView=SC.View.extend((function(){var h=23,d=15,i=20,b=22,c=24,f=5,g,a=false;return{backgroundColor:"white",model:null,axisView:null,thumbView:null,startButton:null,valueView:null,userEdit:false,value:function(){return this.getPath("model.value")}.property("model.value").cacheable(),name:function(){return this.getPath("model.name")}.property("model.name").cacheable(),thumbCoord:function(){var k=this.get("value"),j=this.get("axisView");return(SC.none(k)||SC.none(j))?null:j.dataToCoordinate(k)}.property("value","axisView.model.lowerBound","axisView.model.upperBound"),init:function(){arguments.callee.base.apply(this,arguments);DG.assert(!SC.none(this.get("model")));this.set("axisView",DG.CellLinearAxisView.create({layout:{bottom:0,height:i},orientation:"horizontal",isDropTarget:false}));this.appendChild(this.axisView);this.setPath("axisView.model",this.getPath("model.axis"));this.set("thumbView",DG.ImageView.create({layout:{bottom:i,width:h,height:d},value:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/slider_thumb.png",classNames:"slider-thumb",toolTip:"DG.SliderView.thumbView.toolTip",localize:true,touchPriority:true}));this.appendChild(this.thumbView);this.set("startButton",DG.IconButton.create({layout:{top:0,width:c+2,height:b+2},iconExtent:{width:c,height:b},title:"",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/start.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/start_pushed.png",target:this,action:"toggleAnimation",toolTip:"DG.SliderView.startButton.toolTip",localize:true}));this.appendChild(this.startButton);this.set("valueView",SC.LabelView.create({layout:{left:c+f,top:3,bottom:i+d},classNames:"slider-label".w(),isEditable:true,inlineEditorWillBeginEditing:function(l,n,k){arguments.callee.base.apply(this,arguments);var j=this.get("frame"),p=4,m=5,o=DG.ViewUtilities.viewToWindowCoordinates({x:p,y:m-2},this);this.parentView.set("userEdit",true);l.set("exampleFrame",{x:o.x,y:o.y,width:j.width-2*p,height:j.height-2*m})}}));this.appendChild(this.valueView)},willDestroy:function(){var j=this.get("controller");if(j){j.stopAnimation()}},viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.positionThumb()},positionThumb:function(){var j=this.get("thumbCoord");if(DG.isFinite(j)){var k=this.get("thumbView");if(k){k.adjust("left",1+j-h/2)}}}.observes("thumbCoord"),updateValueView:function(){var o=this.get("axisView"),k=o.coordinateToData(1)-o.coordinateToData(0),j=Math.log(k)/Math.LN10,p=Math.ceil(-j),n=this.get("model"),m=SC.none(n)?"":n.get("name"),l=SC.none(n)?"":pv.Format.number().fractionDigits(0,p)(n.get("value"));this.setPath("valueView.value",m+" = "+l)}.observes("thumbCoord","name"),mouseDown:function(k){DG.globalEditorLock.commitCurrentEdit();var j=this.getPath("thumbView.frame");g={pagePoint:{x:k.pageX,y:k.pageY},viewPoint:DG.ViewUtilities.windowToViewCoordinates({x:k.pageX,y:k.pageY},this),thumbCoord:this.get("thumbCoord")};if(DG.ViewUtilities.ptInRect(g.viewPoint,j)){a=true;return YES}else{return NO}},mouseDragged:function(m){if(a){var k=m.pageX-g.pagePoint.x,j=g.thumbCoord+k,l=this.get("axisView").coordinateToData(j);this.setPath("model.value",l)}},mouseUp:function(){if(a){this.get("model").encompassValue();DG.logUser("sliderThumbDrag: { name: %@, newValue: %@ }",this.getPath("model.name"),this.getPath("model.value"))}a=false},touchStart:function(j){return this.mouseDown(j)},touchEnd:function(j){return this.mouseUp(j)},touchesDragged:function(j,k){return this.mouseDragged(j)},toggleAnimation:function(){var j=this.get("controller");if(j){j.toggleAnimation()}},isAnimatingDidChange:function(){var j=this.get("startButton");if(!this.getPath("controller.isAnimating")){j.set("iconName","/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/start.png");j.set("depressedIconName","/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/start_pushed.png")}else{j.set("iconName","/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/stop.png");j.set("depressedIconName","/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/stop_pushed.png")}}.observes("*controller.isAnimating"),valueViewWasEdited:function(){var k=/^\s*([a-zA-Z][\w]*)\s*=\s*([+\-]?[0-9.]+)/,m,l,n;if(this.get("userEdit")){var j=this.getPath("valueView.value");this.set("userEdit",false);m=k.exec(j);DG.logUser("sliderEdit: { expression: '%@', result: %@ }",j,!SC.none(m)?"success":"failure");if(!SC.none(m)){l=parseFloat(m[2]);n=m[1];this.setPathIfChanged("model.value",l);this.setPathIfChanged("model.name",n);this.get("model").encompassValue()}else{this.updateValueView()}}}.observes(".valueView.value")}}()));sc_require("controllers/component_controller");DG.TextComponentController=DG.ComponentController.extend({theText:"",createComponentStorage:function(){var a=this.get("theText"),b={};if(!SC.empty(a)){b.text=a}return b},restoreComponentStorage:function(b,c){var a=b.text||"";this.set("theText",a)},viewDidChange:function(){var a=this.getPath("view.containerView.contentView.editView");if(a){a.bind("value",this,"theText")}}.observes("view")});DG.TextFieldView=SC.TextFieldView.extend({beginEditing:function(){if(DG.globalEditorLock.isActive(this)){return arguments.callee.base.apply(this,arguments)}if(!DG.globalEditorLock.commitCurrentEdit()){return false}var b=this.get("value"),a=arguments.callee.base.apply(this,arguments);if(a){this._prevValue=b;DG.globalEditorLock.activate(this)}return a},commitEditing:function(){var a=arguments.callee.base.apply(this,arguments);if(a&&DG.globalEditorLock.isActive(this)){DG.globalEditorLock.deactivate(this)}return a},discardEditing:function(){this.set("value",this._prevValue||"");this.resignFirstResponder();if(DG.globalEditorLock.isActive(this)){DG.globalEditorLock.deactivate(this)}return true},completeEditing:function(){this.$input().blur()},commitCurrentEdit:function(){return this.commitEditing()},cancelCurrentEdit:function(){return this.discardEditing()},setSelection:function(c,b){if(SC.none(c)){return}var a=b||c;if(a<c){a=c}this.set("selection",SC.TextSelection.create({start:c,end:a}))},replaceSelectionWithString:function(c){var a=this.get("value"),j=this.get("selection"),f=j.get("start"),i=j.get("end"),d=a.substr(0,f),h=a.substr(i),g=d+c+h,b=f+c.length;this.set("value",g);if(!this.get("focused")){this._disableNextSelectRoot=true}this.setSelection(b)}});sc_require("views/text_field_view");DG.TextView=SC.View.extend({backgroundColor:"white",childViews:["editView"],editView:DG.TextFieldView.design({layout:{left:2,right:2,top:2,bottom:2},isEditable:true,isTextArea:true,commitEditing:function(){var a=arguments.callee.base.apply(this,arguments);DG.logUser("editTextObject: '%@'",this.get("value"));return a}}),defaultFirstResponder:function(){return this.get("editView")}.property()});DG.config=(function(){return{}}());DG.supportFuncs={caseTableHeaderMenus:function(){return true},docSavePermissions:function(){return DG.IS_INQUIRY_SPACE_BUILD}};DG.supports=function(b){var a=DG.supportFuncs[b];return a?a():false};DG.appController=SC.Object.create((function(){return{fileMenuPane:null,optionMenuPane:null,guideMenuPane:null,init:function(){arguments.callee.base.apply(this,arguments);this.fileMenuPane=SC.MenuPane.create({items:this.get("fileMenuItems"),layout:{width:165}});this.optionMenuPane=SC.MenuPane.create({items:this.get("optionMenuItems"),layout:{width:150}});this.guideMenuPane=SC.MenuPane.create({layout:{width:250}});window.onbeforeunload=function(a){if(DG.currDocumentController().get("hasUnsavedChanges")){return"DG.AppController.beforeUnload.confirmationMessage".loc()}}},_fileMenuIncludesDevItems:DG.IS_DEV_BUILD,fileMenuItems:function(){var a=[{localize:true,title:"DG.AppController.fileMenuItems.openDocument",target:this,action:"openDocument",isEnabledBinding:"DG.authorizationController.isSaveEnabled"},{localize:true,title:"DG.AppController.fileMenuItems.saveDocument",target:this,action:"saveDocument",isEnabledBinding:"DG.authorizationController.isSaveEnabled"},{localize:true,title:"DG.AppController.fileMenuItems.closeDocument",target:this,action:"closeDocumentWithConfirmation"},{isSeparator:YES},{localize:true,title:"DG.AppController.fileMenuItems.documentManager",target:this,action:"loadManager",isEnabledBinding:"DG.authorizationController.isSaveEnabled"},{isSeparator:YES},{localize:true,title:"DG.AppController.fileMenuItems.exportCaseData",target:this,action:"exportCaseData"}],b=[{isSeparator:YES},{localize:true,title:"DG.AppController.fileMenuItems.importDocument",target:this,action:"importDocument"},{localize:true,title:"DG.AppController.fileMenuItems.exportDocument",target:this,action:"exportDocument"}];return this._fileMenuIncludesDevItems?a.concat(b):a}.property(),loginDidChange:function(){var a=DG.authorizationController.get("isUserDeveloper");this._fileMenuIncludesDevItems=DG.IS_DEV_BUILD||a;this.fileMenuPane.set("items",this.get("fileMenuItems"))}.observes("DG.authorizationController.isUserDeveloper"),optionMenuItems:function(){return[{localize:true,title:"DG.AppController.optionMenuItems.help",target:this,action:"showHelp"},{localize:true,title:"DG.AppController.optionMenuItems.reportProblem",target:this,action:"reportProblem"},{localize:true,title:"DG.AppController.optionMenuItems.toWebSite",target:this,action:"showWebSite"},{isSeparator:YES},{localize:true,title:"DG.AppController.optionMenuItems.about",target:this,action:"showAbout"},{localize:true,title:"DG.AppController.optionMenuItems.releaseNotes",target:this,action:"showReleaseNotes"},{isSeparator:YES},{localize:true,title:"DG.AppController.optionMenuItems.configureGuide",target:this,action:"configureGuide"},{localize:true,title:"DG.AppController.optionMenuItems.viewWebPage",target:this,action:"viewWebPage"}]}.property(),openDocument:function(){this.openSaveDialog=DG.CreateOpenSaveDialog({dialogType:DG.OpenSaveDialog.kOpenDialog,prompt:"DG.AppController.openDocument.prompt",documentList:DG.DocumentListController.create(),okTitle:"DG.AppController.openDocument.okTitle",okTooltip:"DG.AppController.openDocument.okTooltip",okTarget:this,okAction:"openDocumentFromDialog"})},openDocumentFromDialog:function(){var d=this.openSaveDialog.get("documentName"),c=this.openSaveDialog.get("documentID");this.openSaveDialog.close();this.openSaveDialog=null;var b=function(){DG.authorizationController.openDocument(c,this);DG.logUser("openDocument: '%@'",d)}.bind(this);var a=function(){DG.logUser("cancelOpenDocument: '%@'",d)};if(!SC.empty(d)){if(DG.currDocumentController().get("hasUnsavedChanges")){DG.logUser("confirmOpenDocument?: '%@'",d);DG.AlertPane.warn({message:"DG.AppController.closeDocument.warnMessage",description:"DG.AppController.closeDocument.warnDescription",buttons:[{title:"DG.AppController.closeDocument.okButtonTitle",action:b,localize:YES},{title:"DG.AppController.closeDocument.cancelButtonTitle",action:a,localize:YES}],localize:YES})}else{b()}}},openDocumentNamed:function(b,a){if(b){DG.authorizationController.openDocumentByName(b,a,this);DG.logUser("openDocument: '%@'",b)}},receivedOpenDocumentResponse:function(c){var a=true,b=null;if(SC.ok(c)&&!c.get("isError")){if(this.openJsonDocument(c.get("body"))){a=false}}var d="DG.AppController.openDocument."+SC.json.decode(c.get("body")).message;if(d.loc()===d){d="DG.AppController.openDocument.error.general"}b=d;if(a){DG.AlertPane.error({localize:true,message:b,delegate:SC.Object.create({alertPaneDidDismiss:function(g,f){}})})}},isValidJsonDocument:function(a){return true},openJsonDocument:function(f){var g="DG.MemoryDataSource",b=g;if(!this.isValidJsonDocument(f)){return false}this.closeDocument();var a=SC.Store.create({}).from(b),c=DG.DocumentArchiver.create({}),d;DG.store=a;d=c.openDocument(a,f);if(d){a.document=d;DG.currDocumentController().setDocument(d)}return true},saveDocument:function(){this.openSaveDialog=DG.CreateOpenSaveDialog({dialogType:DG.OpenSaveDialog.kSaveDialog,prompt:"DG.AppController.saveDocument.prompt",documentNameValue:DG.currDocumentController().get("documentName"),documentPermissionValue:DG.currDocumentController().get("documentPermissions"),okTitle:"DG.AppController.saveDocument.okTitle",okTooltip:"DG.AppController.saveDocument.okTooltip",okTarget:this,okAction:"saveDocumentFromDialog"})},saveDocumentFromDialog:function(){var a=this.openSaveDialog.get("documentName"),b=this.openSaveDialog.get("documentPermissions");if(!SC.empty(a)){a=a.trim();DG.currDocumentController().set("documentName",a);DG.currDocumentController().saveDocument(a,b);DG.logUser("saveDocument: '%@'",a)}this.openSaveDialog.close();this.openSaveDialog=null},loadManager:function(){var a="http://"+DG.getDrupalSubdomain()+DG.authorizationController.getLoginCookieDomain()+("DG.AppController.manageDocumentsURL".loc());window.open(a,"document_manager")},logout:function(){var a=function(){this.closeDocument();DG.currDocumentController().setDocument(DG.currDocumentController().createDocument());DG.authorizationController.logout()}.bind(this);var b=function(){DG.logUser("cancelLogout:")};if(DG.currDocumentController().get("hasUnsavedChanges")){DG.logUser("confirmLogout?:");DG.AlertPane.warn({message:"DG.AppController.closeDocument.warnMessage",description:"DG.AppController.closeDocument.warnDescription",buttons:[{title:"DG.AppController.closeDocument.okButtonTitle",action:a,localize:YES},{title:"DG.AppController.closeDocument.cancelButtonTitle",action:b,localize:YES}],localize:YES})}else{a()}},closeDocument:function(){DG.mainPage.closeAllComponents();if(DG.store){DG.store.commitRecords()}DG.currDocumentController().closeDocument();DG.store=null},closeDocumentWithConfirmation:function(a){var c=DG.currDocumentController().get("documentName");var d=function(){this.closeAndNewDocument(a);DG.logUser("closeDocument: '%@'",c)}.bind(this);var b=function(){DG.logUser("cancelCloseDocument: '%@'",c)};if(DG.currDocumentController().get("hasUnsavedChanges")){DG.logUser("confirmCloseDocument?: '%@'",c);DG.AlertPane.warn({message:"DG.AppController.closeDocument.warnMessage",description:"DG.AppController.closeDocument.warnDescription",buttons:[{title:"DG.AppController.closeDocument.okButtonTitle",action:d,localize:YES},{title:"DG.AppController.closeDocument.cancelButtonTitle",action:b,localize:YES}],localize:YES})}else{d()}},closeAndNewDocument:function(a){this.closeDocument();DG.currDocumentController().setDocument(DG.currDocumentController().createDocument());DG.gameSelectionController.setDefaultGame(a);DG.mainPage.addGameIfNotPresent()},deleteAllCaseData:function(){function a(){DG.logUser("deleteAllCaseData by User");DG.currGameController.doDeleteAllCaseData()}DG.AlertPane.warn({message:"DG.AppController.resetData.warnMessage",description:"DG.AppController.resetData.warnDescription",buttons:[{title:"DG.AppController.resetData.okButtonTitle",action:a,localize:YES},{title:"DG.AppController.resetData.cancelButtonTitle",localize:YES}],localize:YES})},importDocument:function(){var b;var a=function(){var c=b.get("value");b.close();if(!SC.empty(c)){this.openJsonDocument(c)}}.bind(this);b=DG.CreateSingleTextDialog({prompt:"DG.AppController.importDocument.prompt",textValue:"",textHint:"JSON document text",textLimit:1000000,okTarget:null,okAction:a,okTitle:"DG.AppController.importDocument.okTitle",okTooltip:"DG.AppController.importDocument.okTooltip"})},exportDocument:function(){var b=DG.currDocumentController().exportDocument(),d=null,a=function(){d.close()};if(b){var c=SC.json.encode(b);if(!SC.empty(c)){d=DG.CreateSingleTextDialog({prompt:"DG.AppController.exportDocument.prompt",textLimit:1000000,textValue:c,okTarget:null,okAction:a,okTitle:"DG.AppController.exportDocument.okTitle",okTooltip:"DG.AppController.exportDocument.okTooltip",cancelVisible:false})}}},exportCaseData:function(){var a=function(d){return DG.currDocumentController().exportCaseData(d)};var c=DG.currDocumentController().exportCaseData().split("\t"),b=c[0];DG.CreateExportCaseDataDialog({prompt:"DG.AppController.exportCaseData.prompt",textLimit:1000000,textValue:a(b),collectionMenuTitle:b,collectionMenuItems:c,collectionMenuItemAction:a,okTitle:"DG.AppController.exportDocument.okTitle",okTooltip:"DG.AppController.exportDocument.okTooltip"})},reportProblem:function(){var b=DG.authorizationController.getPath("currLogin.user");if(b==="guest"){b=""}var a="DataGames/WebPages/scripts/datagames.php"+"?device=%@&os=%@&os_version=%@&cf_browser=%@&cf_browser_version=%@&version=%@&name=%@".fmt(encodeURIComponent(SC.browser.device),encodeURIComponent(SC.browser.os),encodeURIComponent(SC.browser.osVersion),encodeURIComponent(SC.browser.name),encodeURIComponent(SC.browser.version),encodeURIComponent(DG.BUILD_NUM),encodeURIComponent(b));DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,a,"DG.AppController.reportProblem.dialogTitle".loc(),{centerX:0,centerY:0,width:600,height:400})},viewWebPage:function(){DG.currDocumentController().viewWebPage()},configureGuide:function(){DG.currDocumentController().configureGuide()},showReleaseNotes:function(){DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,"DG.AppController.showReleaseNotesURL".loc(),"DG.AppController.showReleaseNotesTitle".loc(),{centerX:0,centerY:0,width:600,height:400})},showAbout:function(){DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,"DG.AppController.showAboutURL".loc(),"DG.AppController.showAboutTitle".loc(),{centerX:0,centerY:0,width:770,height:400})},showHelp:function(){DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,"http://"+DG.getDrupalSubdomain()+DG.authorizationController.getLoginCookieDomain()+("DG.AppController.showHelpURL".loc()),"DG.AppController.showHelpTitle".loc(),{centerX:0,centerY:0,width:600,height:400})},showWebSite:function(){var a="http://"+DG.getDrupalSubdomain()+DG.authorizationController.getLoginCookieDomain()+("DG.AppController.showWebSiteURL".loc());window.open(a,"dg_website")}}}()));DG.Authorization=SC.Object.extend({user:"",passwd:"",status:0,failedLoginAttempt:false,statusMsg:function(){var b=!SC.empty(this.get("user"));var a=(this.get("status")!==0);if(b&&!a){return"<img src='/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/ajax-loader.gif'>"}if(this.failedLoginAttempt){var c=("DG.Authorization.loginPane."+this.get("errorCode"));if(c.loc()===c){c="DG.Authorization.loginPane.error.general"}return c.loc()}return""}.property("user","status"),isValid:function(){var b=!SC.empty(this.get("user"));var a=(this.get("status")!==0);return b&&a}.property("user","status"),sessionID:0,isSaveEnabled:false,isLoggingEnabled:false,logIndex:0,clear:function(){this.set("user","");this.set("passwd","");this.set("status",0);this.set("sessionID",0);this.set("isSaveEnabled",false);this.set("isLoggingEnabled",false);return this}});sc_require("models/authorization_model");DG.logToServer=function(a,c,b){DG.authorizationController.logToServer(a,c,b)};DG.authorizationController=SC.Controller.create((function(){var a=function(b){return"/api/"+b};return{currEdit:null,currLogin:null,isValid:function(){return this.getPath("currLogin.isValid")}.property("currLogin.isValid"),isSaveEnabled:function(){return this.getPath("currLogin.isSaveEnabled")}.property("currLogin.isSaveEnabled"),isUserDeveloper:function(){return true}.property("currLogin.privileges"),init:function(){arguments.callee.base.apply(this,arguments);this.set("currEdit",DG.Authorization.create({user:"",passwd:""}));this.set("currLogin",DG.Authorization.create({}));if(DG.Browser.isCompatibleBrowser()){this.loadLoginCookie()}},getServerUrl:function(b){return SC.Request.getUrl(a(b))},postServerUrl:function(b){return SC.Request.postUrl(a(b))},postServerUrlJSON:function(b){return this.postServerUrl(b).json()},sendLoginAsGuestRequest:function(){this.sendLoginRequest("DG.Authorization.guestUserName".loc(),"DG.Authorization.guestPassword".loc())},sendLoginRequestFromDialog:function(){this.sendLoginRequest(this.getPath("currEdit.user"),this.getPath("currEdit.passwd"))},sendLoginRequest:function(c,f,d){if(!SC.empty(c)){this.setPath("currLogin.user",c);this.setPath("currLogin.failedLoginAttempt",false);var b={username:c,password:f,sessiontoken:d};if(d){this.get("currLogin").set("sessionID",d)}this.postServerUrlJSON("auth/login").notify(this,"receiveLoginResponse").send(b)}},sendTokenRequest:function(c,f,d){this.setPath("currLogin.user",c);var b={username:c,phrase:f,pass:d};this.postServerUrlJSON("auth/login").notify(this,"receiveLoginResponse").send(b)},sendLogoutRequest:function(c,d){if(!SC.empty(c)){var b={username:c,sessiontoken:d};this.postServerUrlJSON("auth/logout").send(b)}},cookie:null,saveLoginCookie:function(){this.cookie=this.findLoginCookie()||SC.Cookie.create({name:"login",value:"",domain:this.getLoginCookieDomain()});var b=this.get("currLogin"),d=[b.get("user"),b.get("status"),b.get("sessionID"),b.get("logIndex"),b.get("isLoggingEnabled")].join("\t");this.cookie.set("value",d);this.cookie.write()},loadLoginCookie:function(){var f=this.get("currLogin"),b=this.get("currEdit");this.cookie=this.findLoginCookie();if(this.cookie){var h=this.cookie.get("value").split("\t"),d=h[0],g=h[2];f.beginPropertyChanges();f.set("user",d);f.set("status",0);f.endPropertyChanges();if(b){b.beginPropertyChanges();b.set("user",d);b.set("sessionID",g);b.endPropertyChanges()}}},findLoginCookie:function(){if(!SC.empty(this.cookie)){return this.cookie}this.cookie=SC.Cookie.find("login");if(!SC.empty(this.cookie)){this.cookie.domain=this.getLoginCookieDomain()}return this.cookie},getLoginCookieDomain:function(){var c=document.domain.indexOf("."),b=c>=0?document.domain.slice(c+1):document.domain;if(b.indexOf("localhost")>=0){return""}return b},_documentPath:function(c){var b=c;if(!/^:/.test(b)){b=":"+this.getPath("currLogin.user")+":"+c}return b},_documentUrl:function(c){var b=a("document");b+="/"+encodeURIComponent(this.getPath("currLogin.sessionID"));b+="/"+encodeURIComponent(this._documentPath(c));return b},saveDocument:function(f,b,d){var c="document/save?username=%@&sessiontoken=%@&recordname=%@".fmt(this.getPath("currLogin.user"),this.getPath("currLogin.sessionID"),f);this.postServerUrlJSON(c).notify(d,"receivedSaveDocumentResponse").send(b)},documentList:function(c){var b="document/all";b+="?username="+this.getPath("currLogin.user");b+="&sessiontoken="+encodeURIComponent(this.getPath("currLogin.sessionID"));this.getServerUrl(b).notify(c,"receivedDocumentListResponse").send()},openDocument:function(d,c){var b="document/open";b+="?username="+this.getPath("currLogin.user");b+="&sessiontoken="+this.getPath("currLogin.sessionID");b+="&recordid="+d;this.getServerUrl(b).notify(c,"receivedOpenDocumentResponse").send()},openDocumentByName:function(b,f,d){var c="document/open";c+="?username="+this.getPath("currLogin.user");c+="&sessiontoken="+this.getPath("currLogin.sessionID");c+="&recordname="+b;c+="&owner="+f;this.getServerUrl(c).notify(d,"receivedOpenDocumentResponse").send()},logout:function(){this.sendLogoutRequest(this.getPath("currLogin.user"),this.getPath("currLogin.sessionID"));DG.logUser("Logout: %@",this.getPath("currLogin.user"),{force:true});this.get("currEdit").clear();this.get("currLogin").clear();this.saveLoginCookie();this.requireLogin()},receiveLoginResponse:function(h){var b=this.get("currLogin"),f,g;if(SC.ok(h)){f=h.get("status");g=h.get("body");var l=g.valid,j=g.sessiontoken,k=g.enableLogging,d=g.enableSave,c=g.privileges;if(l&&b){if(this.sheetPane){this.sheetPane.remove();this.sheetPane=null}b.beginPropertyChanges();b.set("status",f);if(j){b.set("sessionID",j)}b.set("isLoggingEnabled",k);b.set("isSaveEnabled",d);b.set("privileges",c);b.set("logIndex",0);b.endPropertyChanges();if(g.useCookie){this.saveLoginCookie()}DG.logUser("Login: %@",b.get("user"),{force:true});return}}var i=(g&&g.message)||"";b.clear().set("errorCode",i).set("failedLoginAttempt",true)},logToServer:function(d,c,b){},requireLogin:function(){var d=2;var i=0;var j=0;var h=function(m){i+=(j+m);return i};var g=function(m){j=m;return j};var b=this.get("currLogin"),l=this.get("currEdit"),k=b&&b.get("isValid");if(k){return}if(!DG.Browser.isCompatibleBrowser()){return}if(this.sheetPane){return}var f=l&&l.get("user"),c=l&&l.get("sessionID");if(!SC.empty(f)&&c){this.sendLoginRequest(f,null,c)}this.sheetPane=SC.PanelPane.create({layout:{top:0,centerX:0,width:340,height:200},contentView:SC.View.extend({childViews:"labelView userLabel userText passwordLabel passwordText loginAsGuestButton loginButton statusLabel registerLink recoveryLink".w(),labelView:SC.LabelView.design({layout:{top:h(0),left:0,right:0,height:g(24)},controlSize:SC.LARGE_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,textAlign:SC.ALIGN_CENTER,value:"DG.Authorization.loginPane.dialogTitle",localize:YES}),userLabel:SC.LabelView.design({layout:{top:h(d),left:0,right:0,height:g(18)},textAlign:SC.ALIGN_CENTER,value:"DG.Authorization.loginPane.userLabel",localize:YES}),userText:SC.TextFieldView.design({layout:{top:h(d),centerX:0,width:200,height:g(20)},autoCorrect:false,autoCapitalize:false,valueBinding:"DG.authorizationController.currEdit.user"}),passwordLabel:SC.LabelView.design({layout:{top:h(d),left:0,right:0,height:g(18)},textAlign:SC.ALIGN_CENTER,value:"DG.Authorization.loginPane.passwordLabel",localize:YES}),passwordText:SC.TextFieldView.design({layout:{top:h(d),centerX:0,height:g(20),width:200},type:"password",autoCorrect:false,autoCapitalize:false,valueBinding:"DG.authorizationController.currEdit.passwd"}),loginAsGuestButton:SC.ButtonView.design({layout:{top:h(6*d),height:g(24),left:20,width:125},title:"DG.Authorization.loginPane.loginAsGuest",localize:YES,target:"DG.authorizationController",action:"sendLoginAsGuestRequest",isDefault:NO}),loginButton:SC.ButtonView.design({layout:{top:i,height:g(24),right:20,width:100},title:"DG.Authorization.loginPane.login",localize:YES,target:"DG.authorizationController",action:"sendLoginRequestFromDialog",isDefault:YES}),statusLabel:SC.LabelView.design({escapeHTML:NO,layout:{top:h(d),left:0,right:0,height:g(18)},textAlign:SC.ALIGN_CENTER,valueBinding:"DG.authorizationController.currLogin.statusMsg"}),registerLink:SC.StaticContentView.design({layout:{top:h(d),left:20,height:18},textAlign:SC.ALIGN_CENTER,content:DG.getVariantString("DG.Authorization.loginPane.registerLink").loc(DG.getDrupalSubdomain()+this.getLoginCookieDomain())}),recoveryLink:SC.StaticContentView.design({layout:{top:148,left:200,height:18},textAlign:SC.ALIGN_CENTER,content:DG.getVariantString("DG.Authorization.loginPane.recoveryLink").loc(DG.getDrupalSubdomain()+this.getLoginCookieDomain())})})});this.sheetPane.append();this.sheetPane.contentView.userText.becomeFirstResponder()},_loginSessionDidChange:function(){if(this.get("isValid")){this.invokeLater(this._setupGameOrDocument)}}.observes(".currLogin.status"),_setupGameOrDocument:function(){if(!SC.empty(DG.startingDocName)){var b=!SC.empty(DG.startingDocOwner)?DG.startingDocOwner:DG.iUser;DG.appController.openDocumentNamed(DG.startingDocName,b);DG.startingDocName=""}else{DG.gameSelectionController.setDefaultGame();DG.mainPage.addGameIfNotPresent()}if(SC.browser.name===SC.BROWSER.firefox){var c=DG.mainPage.mainPane.scrollView;if(c){this.invokeLater(function(){c.layoutDidChange()},10)}}}}})());DG.CollectionClient=SC.Object.extend({collection:null,id:function(){return this.getPath("collection.collectionRecord.id")}.property("collection").cacheable(),name:function(){return this.getPath("collection.collectionRecord.name")}.property("collection").cacheable(),attrsController:null,casesController:null,attrFormulaChanges:0,attrFormulaDependentChanges:0,hasAggregates:function(){var c=this.attrsController.get("length");for(var b=0;b<c;++b){var a=this.attrsController.objectAt(b);if(a&&a.getPath("_dgFormula.hasAggregates")){return true}}return false}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.attrsController=SC.ArrayController.create({});this.casesController=SC.ArrayController.create({})},destroy:function(){this.attrsController.forEach(function(a){if(a){this.willDestroyAttribute(a)}});arguments.callee.base.apply(this,arguments)},areParentChildLinksConfigured:function(){return this.getPath("collection.areParentChildLinksConfigured")}.property("collection.areParentChildLinksConfigured").cacheable(),setParentCollection:function(c){var a=this.getPath("collection.collectionRecord"),b=c.getPath("collection.collectionRecord");if(a&&b){a.set("parent",b);a.set("areParentChildLinksConfigured",true);b.set("areParentChildLinksConfigured",true);DG.store.commitRecords()}},isAncestorOf:function(a){var b=this.get("collection");return b&&b.isAncestorOf(a.get("collection"))},isDescendantOf:function(a){var b=this.get("collection");return b&&b.isDescendantOf(a.get("collection"))},setTargetCollection:function(a){this.collection=a;this.attrsController.set("content",a.attrsRecords);this.casesController.set("content",a.casesRecords);this.forEachAttribute(function(b){this.didCreateAttribute(b)}.bind(this))},getAttributeIDs:function(){return this.attrsController.getEach("id")},getAttributeNames:function(){return this.attrsController.getEach("name")},getAttributeCount:function(){return this.attrsController.get("length")},getAttributeAt:function(a){return this.attrsController.objectAt(a)},getAttributeByID:function(a){return !SC.none(a)?this.attrsController.findProperty("id",a):undefined},getAttributeByName:function(a){return !SC.empty(a)?this.attrsController.findProperty("name",a):undefined},getAttributeIndexByName:function(a){var b=this.getAttributeNames();return b.indexOf(a)},hasAttribute:function(a){return this.getAttributeIndexByName(a)>=0},createAttribute:function(b){var a=this.collection.createAttribute(b||{});if(a){this.didCreateAttribute(a)}return a},didCreateAttribute:function(a){a.addObserver("dependentChange",this,"attrFormulaDependentDidChange")},willDestroyAttribute:function(a){a.removeObserver("dependentChange",this,"attrFormulaDependentDidChange")},guaranteeAttribute:function(c){var a=null;function d(){var f=c.name||"",h=/\((.*)\)/,g=h.exec(f);if(g&&g.length>1){c.unit=g[1];f=f.replace(h,"")}f=f.replace(/\W$/,"");f=f.replace(/\W/g,"_");c.name=f}c=c||{};d();if(!SC.empty(c.name)){a=this.getAttributeByName(c.name);if(a){if(c.formula!==undefined){if(a.get("editable")||a.get("hasFormula")){this.setAttributeFormula(a,c.formula)}else{var b=a.get("name");DG.AlertPane.error({message:"DG.CollectionClient.cantEditFormulaErrorMsg".loc(b),description:"DG.CollectionClient.cantEditFormulaErrorDesc".loc(),localize:false})}}if(!SC.none(c.colormap)){a.set("colormap",SC.clone(c.colormap))}if(!SC.none(c.editable)){a.set("colormap",c.editable)}}else{a=this.createAttribute(c)}}return a},setAttributeFormula:function(c,b){var g=c&&c.get("id"),f=c.get("hasFormula"),a=!SC.empty(b),h=f&&!a,d=[];if(h){this.forEachAttributeValue(g,function(i){d.push(i)})}c.set("formula",b);if(h){this.setAttributeValuesFromArray(g,d);if(!c.get("editable")){c.set("editable",true)}}this.attributeFormulaDidChange()},forEachAttribute:function(a){this.attrsController.forEach(a);return this},getCaseIDs:function(){return this.casesController.getEach("id")},getCaseCount:function(){return this.casesController.get("length")},getCaseAt:function(a){return this.casesController.objectAt(a)},isCaseSelected:function(b){var a=this.getPath("casesController.selection");return b&&a?a.contains(b):false},isCaseAtIndexSelected:function(c){var b=this.getCaseAt(c),a=this.getPath("casesController.selection");return b&&a?a.contains(b):false},createCase:function(a){return this.collection.createCase(a||{})},attributeFormulaDidChange:function(){this.incrementProperty("attrFormulaChanges")},attrFormulaDependentDidChange:function(){this.incrementProperty("attrFormulaDependentChanges")},forEachCase:function(a){this.casesController.forEach(a);return this},forEachAttributeValue:function(a,c){var b=this.getPath("casesController.arrangedObjects");b.forEach(function(f){var d=f.getValue(a);c(d)});return this},setCaseValuesFromArray:function(d,b){var a=this.getAttributeIDs(),g=a.length,j=b?b.length:0,c,f=g<j?g:j,h;d.beginCaseValueChanges();for(c=0;c<f;++c){h=DG.DataUtilities.canonicalizeInputValue(b[c]);if(h!==undefined){d.setValue(a[c],h)}}d.endCaseValueChanges()},setAttributeValuesFromArray:function(b,a){var c=this.getPath("casesController.arrangedObjects");c.forEach(function(d,f){if(f<a.length){d.setValue(b,a[f])}})},deleteCase:function(a){this.get("collection").deleteCase(a)},didDeleteCases:function(){DG.store.commitRecords();this.get("collection").updateCaseIDToIndexMap();this.getPath("casesController.content").refresh()},deleteSelectedCases:function(){var b=this.get("collection"),a=this.getPath("casesController.selection");DG.logUser("deleteSelectedCases: %@",a.length());a.forEach(function(c){b.deleteCase(c)});this.didDeleteCases()},deleteAllCases:function(){var a=this.get("collection"),b=this.get("casesController");b.forEach(function(c){a.deleteCase(c)});this.didDeleteCases()},toLink:function(){var a=this.getPath("collection.collectionRecord");return a&&a.toLink()},debugLog:function(a){this.get("collection").debugLog(a)}});DG.DataContext=SC.Object.extend((function(){return{type:"DG.DataContext",model:null,changeCount:0,selectionChangeCount:0,changes:null,id:function(){return this.getPath("model.id")}.property("model","model.id"),collections:function(){return this.getPath("model.collections")}.property("model","model.collections"),_collectionClients:null,init:function(){arguments.callee.base.apply(this,arguments);this._collectionClients={};this.changes=[]},destroy:function(){var b,a=this.get("collectionCount");for(b=0;b<a;++b){var c=this.getCollectionAtIndex(b);if(c){this.willRemoveCollection(c)}}arguments.callee.base.apply(this,arguments)},getSelectedCases:function(){var d,b=this.get("collectionCount"),f=[];function c(h){f.push(h)}for(d=0;d<b;++d){var g=this.getCollectionAtIndex(d),a=g&&g.getPath("casesController.selection");if(a){a.forEach(c)}}return f},_changeCount:0,_prevChangeCount:0,lastChange:function(){var a=this.changes.length;return a>0?this.changes[a-1]:null}.property(),newChanges:function(){var a=this.changes&&this.changes.length,b=this._changeCount-this._prevChangeCount;DG.assert(this._changeCount<=a);DG.assert(this._prevChangeCount<=this._changeCount);return this.changes.slice(a-b)}.property(),applyChange:function(a){a.result=this.performChange(a);this.changes.push(a);++this._changeCount;this.invokeLast(function(){this.set("changeCount",this._changeCount);this._prevChangeCount=this._changeCount}.bind(this));return a.result},performChange:function(b){if(b.isComplete){return{success:true}}var a={success:false};switch(b.operation){case"createCollection":a=this.doCreateCollection(b);break;case"createCase":b.values=[b.values||[]];a=this.doCreateCases(b);if(a.caseIDs&&a.caseIDs.length){a.caseID=a.caseIDs[0]}break;case"createCases":a=this.doCreateCases(b);break;case"updateCases":a=this.doUpdateCases(b);break;case"deleteCases":a=this.doDeleteCases(b);break;case"selectCases":a=this.doSelectCases(b);break;case"createAttributes":a=this.doCreateAttributes(b);break;case"updateAttributes":a=this.doUpdateAttributes(b);break;case"deleteAttributes":a=this.doDeleteAttributes(b);break}return a},doCreateCollection:function(b){var a=this.guaranteeCollection(b.properties);if(a){b.attributes.forEach(function(c){a.guaranteeAttribute(c)});DG.store.flush();return{success:true,collection:a}}return{success:false}},doCreateCases:function(d){if(!d.collection){d.collection=this.get("childCollection")}var f=d.collection,b={success:false,caseIDs:[]};if(f){var a=function(g){var h=f.createCase(d.properties);if(h){if(!SC.none(g)){f.setCaseValuesFromArray(h,g);DG.store.commitRecords()}b.success=true;b.caseIDs.push(h.get("id"))}}.bind(this);var c=d.values||[[]];c.forEach(a);if(b.caseIDs&&(b.caseIDs.length>0)){b.caseID=b.caseIDs[0]}}return b},doSelectCases:function(l){var a=l.collection||this.get("childCollection"),m=a&&a.get("casesController"),j=l.extend||false,c={},g=false,h=this;function f(n){var o=n.get("id").toString();if(c[o]===undefined){c[o]=true;return j}return true}function k(p){var o=p.get("children"),q=h.getCollectionForCase(p),r=q&&q.get("casesController");if(r){var n=r.get("selection");if(n&&!n.contains(p)){g=true}r.selectObject(p,f(q));o.forEach(k)}}function b(p){var o=p.get("children"),q=h.getCollectionForCase(p),r=q&&q.get("casesController");if(r){var n=r.get("selection");if(n&&n.contains(p)){g=true}r.deselectObject(p);o.forEach(b)}}var d=l.cases||m,i=l.select?k:b;if(d&&i){d.forEach(i)}if(g){this.forEachCollection(function(o){var n=o.get("id"),p=o.get("casesController");if(n&&p&&!f(o)){p.selectObject()}});this.incrementProperty("selectionChangeCount")}return{success:true}},doUpdateCases:function(k){var d=k.cases.get("length"),f=k.attributeIDs?k.attributeIDs.get("length"):0,i=k.values.get("length"),m=[],j,h;if((d>0)&&(f===0)&&(i>0)){k.cases.forEach(function(a,c){if(a&&!a.get("isDestroyed")){this.setCaseValuesFromArray(a,k.values[c],k.collection)}}.bind(this));return{success:true}}k.caseIDs=[];for(j=0;j<f;++j){var l=k.attributeIDs.objectAt(j),g=this.getAttrRefByID(l);g.attributeID=l;m.push(g)}for(h=0;h<d;++h){var b=k.cases.objectAt(h);k.caseIDs.push(b.get("id"));b.beginCaseValueChanges();for(j=0;j<f;++j){b.setValue(m[j].attributeID,k.values[j][h])}b.endCaseValueChanges()}return{success:true}},doDeleteCases:function(b){b.ids=[];b.collectionIDs={};var a=function(d){var c=d.get("children");if(c&&c.length){c.forEach(a)}b.ids.push(d.get("id"));var f=this.getCollectionForCase(d);f.deleteCase(d);b.collectionIDs[f.get("id")]=f}.bind(this);b.cases.forEach(a);DG.ObjectMap.forEach(b.collectionIDs,function(d,c){if(c){c.didDeleteCases()}});return{success:true}},doCreateAttributes:function(c){var d=typeof c.collection==="string"?this.getCollectionByName(c.collection):c.collection,b=false,a={success:false,attrs:[],attrIDs:[]};function f(h){var g=d.hasAttribute(h.name),j=DG.copy(h),i;if(!g){j.editable=true}i=d.guaranteeAttribute(j);if(i){if(!g){b=true}a.success=true;a.attrs.push(i);a.attrIDs.push(i.get("id"))}}if(d&&c.attrPropsArray){c.attrPropsArray.forEach(f)}if(!b){c.operation="updateAttributes"}return a},doUpdateAttributes:function(c){var d=typeof c.collection==="string"?this.getCollectionByName(c.collection):c.collection,a={success:false,attrs:[],attrIDs:[]};function b(f){var g=d&&!SC.none(f.id)?d.getAttributeByID(f.id):null;if(!g&&d&&f.name){g=d.getAttributeByName(f.name)}if(g){g.beginPropertyChanges();DG.ObjectMap.forEach(f,function(h,i){if(h!=="id"){g.set(h,i)}});g.endPropertyChanges();a.success=true;a.attrs.push(g);a.attrIDs.push(g.get("id"))}}if(d&&c.attrPropsArray){c.attrPropsArray.forEach(b)}return a},doDeleteAttributes:function(b){var c=typeof b.collection==="string"?this.getCollectionByName(b.collection):b.collection,a={success:false,attrIDs:[]};function d(f){var g=c&&!SC.none(f.id)?c.getAttributeByID(f.id):null;if(g){DG.Attribute.destroyAttribute(f.attribute);a.attrIDs.push(f.id)}}if(c&&b.attrs){b.attrs.forEach(d);DG.store.commitRecords()}return a},exportCaseData:function(d){var i=this.get("childCollection"),h=this.get("parentCollection"),m=i&&i.get("name"),a=h&&h.get("name"),c=(a+"+"+m),l="\t",n="\r\n";DG.assert(i&&h,"exportCaseData collections not found");if(!(i&&h)){return("")}if(SC.empty(d)){return a+l+m+l+(a+"+"+m)}var g=((d===a)?h:i),k=((d===c)?h:null),b=g&&g.getAttributeNames(),j=g&&g.getAttributeIDs(),f;if(k){b=k.getAttributeNames().concat(b);j=k.getAttributeIDs().concat(j)}f=b.join(l)+n;g.forEachCase(function(o,p){var q="";j.forEach(function(s){var r=o.getValue(s);if(q.length>0){q+=l}if(!SC.empty(r)){q+=r.toString()}});f+=q+n});return f},createContextModel:function(b){if(!b){b={}}if(SC.empty(b.type)){b.type=this.get("type")||"DG.DataContext"}var a=DG.DataContextRecord.create(b);this.set("model",a);return a},collectionCount:function(){return this.getPath("collections.length")||0}.property(),childCollection:function(){var a=this.get("collectionCount");return(a?this.getCollectionAtIndex(a-1):null)}.property("_collectionClients","_collectionClients.[]"),parentCollection:function(){var a=this.get("collectionCount");return(a?this.getCollectionAtIndex(a-2):null)}.property("_collectionClients","_collectionClients.[]"),getCollectionAtIndex:function(c){var d=this.get("collections"),b=this.get("collectionCount"),a=(d&&(b>c)&&d.objectAt(c))||null;return a&&this._collectionClients[a.get("id")]},getCollectionByName:function(c){var b=this.get("collectionCount"),f=this.get("collections"),a;for(var d=0;d<b;++d){a=f.objectAt(d);if(a&&(a.get("name")===c)){return this._collectionClients[a.get("id")]}}return null},getCollectionByID:function(a){return this._collectionClients[a]||null},getCollectionForCase:function(a){return this.getCollectionByID(a.getPath("collection.id"))},getCollectionForAttribute:function(a){return this.getCollectionByID(a.getPath("collection.id"))},getParentCollection:function(c){var f=c&&c.get("id"),d=this.get("collectionCount"),j=this.get("collections"),b,h,a=null;for(var g=0;g<d;++g){b=j.objectAt(g);h=b.get("id");if(b&&(h===f)){return this.getCollectionByID(a)}a=h}return null},getChildCollection:function(c){var f=c&&c.get("id"),d=this.get("collectionCount"),j=this.get("collections"),b,h,a=null;for(var g=d-1;g>=0;--g){b=j.objectAt(g);h=b.get("id");if(b&&(h===f)){return this.getCollectionByID(a)}a=h}return null},createCollection:function(c){var a=this.get("model").createCollection(c||{}),b=this.addCollection(a);DG.store.commitRecords();this.didCreateCollection(b);return b},didCreateCollection:function(a){},guaranteeCollection:function(b){var a=this.getCollectionByName(b.name);if(!a){a=this.createCollection(b)}return a},addCollection:function(b){var a=b&&b.get("id"),d=a&&DG.Collection.create({collectionRecord:b}),c=d&&DG.CollectionClient.create({});if(c&&d&&a){c.setTargetCollection(d);this._collectionClients[c.get("id")]=c;this.didAddCollection(c)}return c},didAddCollection:function(a){a.addObserver("attrFormulaChanges",this,"attrFormulaDidChange")},willRemoveCollection:function(a){a.removeObserver("attrFormulaChanges",this,"attrFormulaDidChange")},attrFormulaDidChange:function(a){var b={operation:"updateCases",collection:a,isComplete:true};this.applyChange(b)},forEachCollection:function(b){var c=this,a=this.get("collections");a.forEach(function(g){var f=g.get("id"),d=c.getCollectionByID(f);if(d){b(d)}});return this},getCaseNameForCount:function(a,b){return b===1?"DG.DataContext.singleCaseName".loc():"DG.DataContext.pluralCaseName".loc()},getCaseCountString:function(a,c){var b=this.getCaseNameForCount(a,c);return"DG.DataContext.caseCountString".loc(c,b)},getLabelForSetOfCases:function(a){return"DG.DataContext.setOfCasesLabel".loc()},getAttrRefByID:function(b){var d=this.get("collectionCount"),h=this.get("collections");for(var f=d-1;f>=0;--f){var c=h.objectAt(f),a=c&&this._collectionClients[c.get("id")],g=a&&a.getAttributeByID(b);if(g){return{collection:a,attribute:g}}}return null},getAttrRefByName:function(d){var c=this.get("collectionCount"),h=this.get("collections");for(var f=c-1;f>=0;--f){var b=h.objectAt(f),a=b&&this._collectionClients[b.get("id")],g=a&&a.getAttributeByName(d);if(g){return{collection:a,attribute:g}}}return null},getAttributeByName:function(a){var b=this.getAttrRefByName(a);return b?b.attribute:null},setCaseValuesFromArray:function(c,a,b){var d=b||this.getCollectionForCase(c);if(d){d.setCaseValuesFromArray(c,a)}},collectionDefaults:function(){var a={collectionClient:this.get("childCollection"),parentCollectionClient:this.get("parentCollection"),plotXAttr:null,plotXAttrIsNumeric:true,plotYAttr:null,plotYAttrIsNumeric:true};return a},willSaveContext:function(){var a=this.get("model");if(a){var b=this.createStorage()||{};a.set("contextStorage",b)}},toLink:function(){var a=this.get("model");return a&&a.toLink()},createStorage:function(){return{}},restoreFromStorage:function(b){var a=this.get("collections"),c=this;if(!SC.none(a)){a.forEach(function(d){c.addCollection(d)})}}}}()));DG.DataContext.registry={};DG.DataContext.registry["DG.DataContext"]=function(a){return DG.DataContext.create(a)};DG.DataContext._contextMap={};DG.DataContext.clearContextMap=function(a){DG.DataContext._contextMap={}};DG.DataContext.storeContextInMap=function(c,b){if(b){var a=b.get("id");if(!SC.none(a)){DG.DataContext._contextMap[a]=b}}};DG.DataContext.retrieveContextFromMap=function(b,a){return DG.DataContext._contextMap[a]};DG.DataContext.forEachContextInMap=function(b,a){DG.ObjectMap.forEach(DG.DataContext._contextMap,a)};DG.DataContext.getContextFromCollection=function(d){var b=d&&d.getPath("collection.collectionRecord"),a=b&&b.getPath("context.id"),c=a&&DG.DataContext.retrieveContextFromMap(null,a);return c};DG.DataContext.factory=function(d){var b=d&&d.type,c=b&&DG.DataContext.registry[b],a=c?c(d):DG.DataContext.create(d);if(a){DG.DataContext.storeContextInMap(a.getPath("model.document.id"),a)}return a};DG.DocumentArchiver=SC.Object.extend({addRecord:function(b,c,d){var g=DG.Record.recordTypeFromString(b),f=c.guid;if(!this._records){this._records=[]}if(!this._records[b]){this._records[b]={type:g,idMap:{},array:[]}}var a=this._records[b];a.idMap[f]=c;a.array.push(c);if(!SC.none(d)){if(!a.serverIDMap){a.serverIDMap={}}a.serverIDMap[d.toString()]=f}},getRecord:function(b,a){return this._records&&this._records[b]&&this._records[b].idMap[a]},loadRecordsIntoStore:function(a){var b=a._getDataSource();DG.ObjectMap.forEach(this._records,function(d,c){b.loadRecords(c.type,c.array);a.loadRecords(c.type,c.array)});a.find(DG.Attribute).forEach(function(c){c.didLoadRecord()});a.find(DG.Case).forEach(function(c){c.didLoadRecord()})},clientIDFromServerID:function(b,d){if(SC.empty(b)||SC.none(d)){return null}var a=this._records&&this._records[b],c=a&&a.serverIDMap,f=c&&c[d.toString()];return f},recordFromClientID:function(c,d){if(!c||!d){return null}var b=this._records&&this._records[c],a=b&&b.idMap&&b.idMap[d];return a},restoreObject:function(c,g,h){var b=!SC.none(h.guid)?h.guid:undefined,d=c.assignIDForNewRecord(g,h);this.addRecord(g,h,b);var a=function(j,n,m){if(n.isOwner){var p=h[j]||[],k=[];h[j]=k;p.forEach(function(r){this.restoreObject(c,n.type,r);r[n.inverse]=d;k.push(r.guid)}.bind(this))}else{if(n.isMaster){h[j]=SC.instanceOf(n,SC.ManyAttribute)?[]:null}else{if(m.isMaster&&!m.isOwner){var q=n.type,l=h[j],o=this.clientIDFromServerID(q,l);if(o){var i=this.recordFromClientID(q,o);h[j]=o;if(i){if(SC.instanceOf(m,SC.ManyAttribute)){if(!i[n.inverse]){i[n.inverse]=[]}i[n.inverse].push(h.guid)}else{i[n.inverse]=h.guid}}else{DG.logWarn("DG.DocumentArchiver.restoreObject.processRelation failed to find linked parent:");DG.logWarn("  Parent Type: %@, ID: %@, Property: %@",q,o,n.inverse);DG.logWarn("  Child Type:  %@, ID: %@, Property: %@",g,h.guid,j)}}}}}}.bind(this);DG.Record.forEachRelation(DG.Record.recordTypeFromString(g),a);var f=function(j,k){var i=7;if((j.lastIndexOf("Storage")===j.length-i)&&!SC.none(k)&&(typeof k==="object")&&!SC.none(k._links_)&&(typeof k._links_==="object")){this._storageProperties.push({record:h,key:j,value:k})}}.bind(this);DG.ObjectMap.forEach(h,f)},processStorageProperties:function(){var a=function(d){var b=false,f=d.value,c=function(i,h){var g=SC.isArray(h)?h:[h];g.forEach(function(j){j.id=this.clientIDFromServerID(j.type,j.id)}.bind(this));b=true}.bind(this);DG.ObjectMap.forEach(f._links_,c);if(b){d.record[d.key]=f}}.bind(this);if(this._storageProperties){this._storageProperties.forEach(a)}this._storageProperties=null},openDocument:function(d,h){var c=SC.json.decode(h),i=d._getDataSource(),b=null;this._storageProperties=[];this.restoreObject(i,"DG.Document",c);this.processStorageProperties();this.loadRecordsIntoStore(d);var g=this._records&&this._records["DG.Document"],f=g&&g.array[0],a=f&&f.guid;b=a&&d.find(DG.Document,a);this._records=null;return b},saveDocument:function(c){var b=DG.currDocumentController();DG.gameSelectionController.saveCurrentGameState();DG.DataContext.forEachContextInMap(c.get("id"),function(d,f){f.willSaveContext()});if(b){DG.ObjectMap.forEach(b.componentControllersMap,function(f,d){d.willSaveComponent()})}var a=c.toArchive();return a},exportCaseData:function(b,a){var c="";DG.DataContext.forEachContextInMap(b.get("id"),function(d,f){c+=f.exportCaseData(a)});return c}});DG.DocumentController=SC.Object.extend({content:null,contexts:function(){return this.getPath("content.contexts")}.property(),components:function(){return this.getPath("content.components")}.property(),componentControllersMap:null,_singletonViews:null,gameView:function(){return this._singletonViews.gameView||null}.property(),guideMenuPane:null,guideButton:null,_guideModel:null,guideModel:function(){if(!this._guideModel){this._guideModel=DG.GuideModel.create()}return this._guideModel}.property(),_guideController:null,guideController:function(){if(!this._guideController){this._guideController=DG.GuideController.create({guideModel:this.get("guideModel")})}return this._guideController}.property(),documentID:function(){return this.getPath("content.id")}.property("content.id"),documentName:function(a,c){var b=this.get("content");if(c!==undefined){b.set("name",c);DG.store.commitRecords()}return b.get("name")}.property("content.name"),documentPermissions:function(){return this.getPath("content._permissions")||0}.property("content._permissions"),changeCount:0,savedChangeCount:0,init:function(){arguments.callee.base.apply(this,arguments);this._singletonViews={};this.setDocument(this.get("content")||this.createDocument())},destroy:function(){this.closeDocument();arguments.callee.base.apply(this,arguments)},createDocument:function(a){return DG.Document.createDocument({name:a||SC.String.loc("DG.Document.defaultDocumentName")})},setDocument:function(a){this.set("content",a);DG.DataContext.clearContextMap();this.componentControllersMap={};this.restoreDataContexts();this.restoreComponentControllersAndViews();this.set("changeCount",0);this.updateSavedChangeCount()},hasUnsavedChanges:function(){return DG.authorizationController.get("isSaveEnabled")&&((this.get("changeCount")>this.get("savedChangeCount"))||DG.currGameController.get("hasUnsavedChanges"))}.property(),updateSavedChangeCount:function(){DG.currGameController.updateSavedChangeCount();this.set("savedChangeCount",this.get("changeCount"))},createDataContextForModel:function(b,c){if(SC.none(b)){b=DG.DataContextRecord.createContext({document:this.get("documentID")})}if(!c){c={}}c.type=b.get("type");c.model=b;var a=DG.DataContext.factory(c);return a},restoreDataContexts:function(){var b=this.get("contexts")||[],a=this;b.forEach(function(c){var d=a.createDataContextForModel(c);if(d){d.restoreFromStorage(c.get("contextStorage"))}})},createComponentAndView:function(a,b){var d=DG.mainPage.get("docView"),c=(a&&a.get("type"))||b,f=true;switch(c){case"DG.FlashView":if(a){a.set("type","DG.GameView")}case"DG.GameView":this.addGame(d,a);break;case"DG.TableView":this.addCaseTable(d,a);break;case"DG.GraphView":this.addGraph(d,a);break;case"DG.SliderView":this.addSlider(d,a);break;case"DG.Calculator":this.addCalculator(d,a);break;case"DG.TextView":this.addText(d,a);break;case"DG.MapView":this.addMap(d,a);break;case"SC.WebView":this.addWebView(d,a);break;case"DG.GuideView":this.addGuideView(d,a);break;default:f=false;break}if(a){a.didLoadRecord()}if(f){this.incrementProperty("changeCount")}},restoreComponentControllersAndViews:function(){var a=this.get("components");if(a){a.forEach(function(b){this.createComponentAndView(b)}.bind(this))}},gameCollectionWithName:function(c,b){var d=DG.gameSelectionController.findGameByName(c),a=d&&DG.GameContext.getContextForGame(d),f=a&&a.getCollectionByName(b);return f},collectionDefaults:function(){var c=DG.gameSelectionController.get("currentGame"),a=c&&DG.GameContext.getContextForGame(c),b=a&&a.collectionDefaults();return b},configureComponent:function(a,c){var f=!SC.none(a),b=this.get("documentID"),h=a,g=c.controller;if(!f){var d={type:c.componentClass.type};if(!SC.none(b)){d.document=b}h=DG.Component.createComponent(d)}if(c.contentProperties&&c.contentProperties.model){h.set("content",c.contentProperties.model)}g.set("model",h);this.componentControllersMap[h.get("id")]=g;if(f){g.didRestoreComponent(b)}return h},createComponentView:function(a,f){var b=f&&f.defaultLayout,g=!SC.none(a),h,d;DG.globalEditorLock.commitCurrentEdit();h=this.configureComponent(a,f);if(h&&h.get("layout")){b=h.get("layout")}if(g){d=DG.ComponentView.restoreComponent(f.parentView,b,f.componentClass.constructor,f.contentProperties,f.title,f.isResizable)}else{DG.sounds.playCreate();d=DG.ComponentView.addComponent(f.parentView,b,f.componentClass.constructor,f.contentProperties,f.title,f.isResizable,f.useLayout,f.isVisible);var c=d&&d.getPath("contentView.defaultFirstResponder");if(c){if(c.beginEditing){c.beginEditing()}else{if(c.becomeFirstResponder){c.becomeFirstResponder()}}}}if(f.controller){f.controller.set("view",d);d.set("controller",f.controller)}if(d){this.incrementProperty("changeCount")}return d},addGame:function(f,a){var c=DG.gameSelectionController.get("currentDimensions")||{width:0,height:0},d=DG.gameSelectionController.get("currentName")||"";var b=this.createComponentView(a,{parentView:f,controller:DG.currGameController,componentClass:{type:"DG.GameView",constructor:DG.GameView},contentProperties:{},defaultLayout:{width:c.width,height:c.height},title:d,isResizable:true});this._singletonViews.gameView=b;b.bringToFront=function(){};b.bind("title","DG.gameSelectionController.currentName");return b},addCaseTable:function(c,a){var b=this.createComponentView(a,{parentView:c,controller:DG.CaseTableController.create(),componentClass:{type:"DG.TableView",constructor:DG.HierTableView},contentProperties:{},defaultLayout:{width:500,height:200},title:"DG.DocumentController.caseTableTitle".loc(),isResizable:true});this._singletonViews.caseTableView=b;return b},addGraph:function(f,a){var c=DG.GraphModel.create(),d=DG.GraphController.create();d.set("dataContext",DG.gameSelectionController.get("currentContext"));var b=this.createComponentView(a,{parentView:f,controller:d,componentClass:{type:"DG.GraphView",constructor:DG.GraphView},contentProperties:{model:c},defaultLayout:{width:300,height:300},title:"DG.DocumentController.graphTitle".loc(),isResizable:true});return b},addText:function(c,a){var b=this.createComponentView(a,{parentView:c,controller:DG.TextComponentController.create(),componentClass:{type:"DG.TextView",constructor:DG.TextView},contentProperties:{hint:"Type some notes here"},defaultLayout:{width:300,height:100},title:"DG.DocumentController.textTitle".loc(),isResizable:true});return b},addMap:function(f,a){var d=DG.MapModel.create(),c=DG.gameSelectionController.get("currentContext");d.set("dataContext",c);d.set("dataConfiguration",DG.MapDataConfiguration.create({dataContext:c}));var b=this.createComponentView(a,{parentView:f,controller:DG.ComponentController.create(),componentClass:{type:"DG.MapView",constructor:DG.MapView},contentProperties:{model:d},defaultLayout:{width:300,height:300},title:"DG.DocumentController.mapTitle".loc(),isResizable:true});return b},addSlider:function(f,b){var a={};if(!b||!b.get("componentStorage")){a.content=this.createGlobalValue()}var d=DG.SliderModel.create(a),c=this.createComponentView(b,{parentView:f,controller:DG.SliderController.create(),componentClass:{type:"DG.SliderView",constructor:DG.SliderView},contentProperties:{model:d},defaultLayout:{width:300,height:60},title:"DG.DocumentController.sliderTitle".loc(),isResizable:true});return c},addCalculator:function(c,a){var b=this.createComponentView(a,{parentView:c,controller:DG.ComponentController.create(),componentClass:{type:"DG.Calculator",constructor:DG.Calculator},contentProperties:{},defaultLayout:{},title:"DG.DocumentController.calculatorTitle".loc(),isResizable:false});this._singletonViews.calcView=b;return b},viewWebPage:function(){var c=this,b=null;function a(){var d=b.get("value");b.close();if(!SC.empty(d)){if(!/^https?:\/\//i.test(d)){d="http://"+d}c.addWebView(DG.mainPage.get("docView"),null,d,"Web Page",{width:600,height:400})}}b=DG.CreateSingleTextDialog({prompt:"DG.DocumentController.enterURLPrompt",textValue:"",textHint:"URL",okTarget:null,okAction:a,okTooltip:"DG.DocumentController.enterViewWebPageOKTip"})},addWebView:function(f,b,d,a,c){d=d||"";a=a||"";c=c||{width:600,height:400};return this.createComponentView(b,{parentView:f,controller:DG.WebViewController.create(),componentClass:{type:"SC.WebView",constructor:SC.WebView},contentProperties:{value:d,backgroundColor:"white"},defaultLayout:c,title:a,isResizable:true,useLayout:!SC.none(c.centerX)||!SC.none(c.left)})},addGuideView:function(f,a){if(this._singletonViews.guideView){return}var c=this.get("guideModel"),d=this.get("guideController"),b=this.createComponentView(a,{parentView:f,controller:d,componentClass:{type:"DG.GuideView",constructor:DG.GuideView},contentProperties:{backgroundColor:"white",guideModel:c,controller:d,closeAction:{action:this.closeGuideView,target:this}},defaultLayout:{width:400,height:200},isResizable:true,useLayout:true,isVisible:false});this._singletonViews.guideView=b;return b},closeGuideView:function(){var a=this._singletonViews.guideView;if(a){a.set("isVisible",false)}},configureGuide:function(){var d=this,c=null,b=this.get("guideModel");var a=function(){this.addGuideView(DG.mainPage.docView);b.beginPropertyChanges();b.set("title",c.get("title"));b.set("items",c.get("items"));b.endPropertyChanges();c.close()}.bind(this);c=DG.CreateGuideConfigurationView({okTarget:null,okAction:a,model:b})},guideButtonOrMenuDidChange:function(){var c=this.get("guideButton"),b=this.get("guideMenuPane");if(c&&b){var a=this.get("guideController");a.set("guideButton",c);a.set("guideMenuPane",b)}}.observes("guideButton","guideMenuPane"),toggleComponent:function(b,a){var c=this._singletonViews[a];if(c){this.removeComponentAssociatedWithView(c);c.destroy()}else{switch(a){case"calcView":this.addCalculator(b);break;case"caseTableView":this.addCaseTable(b);break;case"mapView":this.addMap(b);break}}},closeDocument:function(){DG.ObjectMap.forEach(this.componentControllersMap,function(b,a){if(a&&a.willDestroy){a.willDestroy()}});DG.globalsController.stopAnimation();DG.gameSelectionController.reset();DG.DataContext.clearContextMap();DG.Record.destroyAllRecordsOfType(DG.GlobalValue);DG.Record.destroyAllRecordsOfType(DG.Case);DG.Record.destroyAllRecordsOfType(DG.Attribute);DG.Record.destroyAllRecordsOfType(DG.CollectionRecord);DG.Record.destroyAllRecordsOfType(DG.DataContextRecord);DG.Record.destroyAllRecordsOfType(DG.Component);DG.store.commitRecords();DG.gameSelectionController.reset();this.closeAllComponents()},closeAllComponents:function(){this._singletonViews={};this.componentControllersMap={};this.get("guideModel").reset()},removeComponentAssociatedWithView:function(f){var d=null,a=DG.ObjectMap.findKey(this.componentControllersMap,function(h,g){if(g.view===f){d=g;return true}return false});var c=DG.ObjectMap.findValue(this._singletonViews,f);if(c&&this._singletonViews[c]){this._singletonViews[c]=null}if(d){var b=d.get("model");if(b){DG.Component.destroyComponent(b)}delete this.componentControllersMap[a];if(d.get("shouldDestroyOnComponentDestroy")){d.destroy()}else{d.set("model",null);d.set("view",null)}this.incrementProperty("changeCount")}},addFormulaObject:function(c,i,g,a,b,d,f,h){var j=this.createComponentView(i,{parentView:c,controller:DG.ComponentController.create({}),componentClass:{type:"DG.FormulaObject",constructor:DG.FormulaObject},contentProperties:{description:a,outputSymbol:b,nameSpaceSymbols:d,variableDescriptions:f,allow_user_variables:h},defaultLayout:{},title:g,isResizable:true});return j},createGlobalValue:function(a){a=a||{};a.document=this.get("documentID");return DG.globalsController.createGlobalValue(a)},exportDocument:function(){var a=DG.DocumentArchiver.create({}),b=a.saveDocument(this.get("content"));return b},exportCaseData:function(a){var b=DG.DocumentArchiver.create({}),c=b.exportCaseData(this.get("content"),a);return c},saveDocument:function(c,b){var a=this.exportDocument();if(!SC.none(b)){a._permissions=b}if(DG.assert(!SC.none(a))){DG.authorizationController.saveDocument(c,a,this);this.updateSavedChangeCount()}},receivedSaveDocumentResponse:function(d){var a=d.get("body"),c=!SC.ok(d)||d.get("isError")||d.getPath("response.valid")===false;if(c){var b="DG.AppController.saveDocument."+a.message;if(b.loc()===b){b="DG.AppController.saveDocument.error.general"}if(c){DG.AlertPane.error({localize:true,message:b})}}}});DG.currDocumentController=function(){if(!DG._currDocumentController){DG._currDocumentController=DG.DocumentController.create();DG._currDocumentController.set("guideMenuPane",DG.appController.get("guideMenuPane"))}return DG._currDocumentController};DG.gameCollectionWithName=function(b,a){return DG.currDocumentController().gameCollectionWithName(b,a)};DG.DocumentListController=SC.ArrayController.extend({loadingMessage:"DG.OpenSaveDialog.loading",noDocumentsMessage:"DG.OpenSaveDialog.noDocuments",noResponseMessage:"DG.OpenSaveDialog.error.noResponse",init:function(){arguments.callee.base.apply(this,arguments);this.set("content",[]);var a=this.get("loadingMessage").loc();if(!SC.empty(a)){this.addObject({name:a,id:""})}DG.authorizationController.documentList(this)},receivedDocumentListResponse:function(i){this.set("content",[]);if(SC.ok(i)){var f=i.get("body"),a=[],b;try{b=f&&SC.json.decode(f)}catch(g){b={valid:false,message:"error.parseError"}}if(b.valid===false){var c=b.message;this.addObject({name:("DG.DocumentListController."+c).loc(),id:""})}else{if(b){b.forEach(function(j){if(j.id&&j.name){a.push({name:j.name,id:j.id})}});if(a.length===0){var h=this.get("noDocumentsMessage").loc();if(!SC.empty(h)){this.addObject({name:h,id:""})}}else{a.sort(function(m,l){var k=m.name.toLowerCase(),j=l.name.toLowerCase();return k.localeCompare(j)||m.name.localeCompare(l.name)});this.set("content",a)}}}}else{var d=this.get("noResponseMessage").loc();this.addObject({name:d,id:""})}}});sc_require("formula/formula_context");DG.FormulaObjectContext=DG.FormulaContext.extend({compileVariable:function(a){var b=this.get("locals");if(b&&!SC.none(b[a])){return"c.locals."+a+".evaluate(e)"}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,b){var c=this.get("locals");if(c&&!SC.none(c[a])){return c[a].evaluateDirect(b)}return arguments.callee.base.apply(this,arguments)}});DG.formulaObjectCoordinator=SC.Object.create({init:function(){arguments.callee.base.apply(this,arguments);this.formulaContext=DG.FormulaObjectContext.create()},findFormulaObject:function(a){var b=DG.mainPage.getComponentsOfType(DG.FormulaObject),c=null;b.forEach(function(d){if(d.get("outputSymbol")===a){c=d}});return c},requestFormulaObject:function(c,d,b,i,g,h){var a=this.findFormulaObject(b);if(SC.none(a)){var f=DG.currDocumentController().addFormulaObject(DG.mainPage.get("docView"),null,c,d,b,i,g,h);a=f&&f.get("contentView");if(a){a.addObserver("willDestroy",this,"_willDestroyFormulaObject")}}return true},updateFormulaObject:function(c,b,g,d,f){var a=this.findFormulaObject(b);if(!SC.none(a)){a.updateContents(c,b,g,d,f)}return true},requestFormulaValue:function(c,i){var b={error:"",formula:""},a=this.findFormulaObject(c),f=this.getFormulaForObject(c,a),d=this.getLocalsForObject(a);if(!SC.empty(f)){var j=this.get("formulaContext"),g={};DG.ObjectMap.forEach(d,function(k,l){g[k]=DG.Formula.create({source:l,context:j})});try{b[c]=this._evaluateFormula(f,g,i)}catch(h){b[c]=null;b.error=h}b.formula=f;if(a){this.stashFormulaForObject(a)}return b}else{return false}},getFormulaForObject:function(a,c){if(c){return c.get("formula")}var b=DG.gameSelectionController.getPath("currentGame.formulas");return b&&b[a]},getLocalsForObject:function(b){if(b){return b.get("locals")}var a=DG.gameSelectionController.getPath("currentGame.formulas");return a&&a.locals},stashFormulaForObject:function(a){if(a){var b=DG.gameSelectionController.get("currentGame");if(b){b.set("formulas",a.get("formulas"))}}},_evaluateFormula:function(a,d,c){var b=this.get("formulaContext");b.set("locals",d);b.set("eVars",c);var f=DG.Formula.create({source:a,context:b});return f.evaluate(c)},_willDestroyFormulaObject:function(a){this.stashFormulaForObject(a)}});sc_require("controllers/data_context");DG.GameContext=DG.DataContext.extend({type:"DG.GameContext",gameSpec:null,gameName:function(){return this.getPath("gameSpec.name")}.property("gameSpec","gameSpec.name").cacheable(),gameDimensions:function(){return this.getPath("gameSpec.dimensions")}.property("gameSpec","gameSpec.dimensions").cacheable(),gameUrl:function(){return this.getPath("gameSpec.url")}.property("gameSpec","gamespec.url").cacheable(),_collections:null,collections:function(){var f=this.getPath("model.collections"),c,a=f?f.get("length"):0;if(this._collections&&(this._collections.length===a)){return this._collections}this._collections=[];if(a>0){var d=f&&f.objectAt(0),b=d&&d.get("name"),g=this.getPath("gameSpec.collectionName");if(b===g){for(c=a-1;c>=0;--c){this._collections.push(f.objectAt(c))}}else{for(c=0;c<a;++c){this._collections.push(f.objectAt(c))}}}return this._collections}.property("model","model.collections"),didCreateCollection:function(c){var a=this.get("gameSpec");if(a){a.notifyPropertyChange("collections")}var b=a&&this.getCollectionByName(a.get("collectionName")),d=a&&this.getCollectionByName(a.get("parentCollectionName"));if(b&&d&&(b!==d)){b.setParentCollection(d);DG.assert(b.isDescendantOf(d));DG.assert(d.isAncestorOf(b))}},collectionDefaults:function(){var d={collectionClient:null,plotXAttr:null,plotXAttrIsNumeric:true,plotYAttr:null,plotYAttrIsNumeric:true},b=this.get("gameSpec"),c=b&&b.get("collectionName");if(!SC.empty(c)){d.collectionClient=this.getCollectionByName(c);d.parentCollectionClient=this.getCollectionByName(b.get("parentCollectionName"))}if(SC.none(d.collectionClient)){d.collectionClient=this.get("childCollection")}function a(f,g){var h=b&&b.get(f+"AttrName");if(d.collectionClient&&!SC.empty(h)){d["plot"+g+"Attr"]=d.collectionClient.getAttributeByName(h);var i=b.get(f+"AttrIsNumeric");if(!SC.none(i)){d["plot"+g+"AttrIsNumeric"]=i}}}a("x","X");a("y","Y");a("legend","Legend");return d},getLabelsForCollection:function(b){var d=this.get("gameSpec"),c=b.get("name"),a=d&&c&&d.getCollectionSpecByName(c),f=a&&a.labels;return f},getCaseNameForCount:function(a,b){var c=this.getLabelsForCollection(a);if(!c||!c.singleCase||!c.pluralCase){return arguments.callee.base.apply(this,arguments)}return b===1?c.singleCase:c.pluralCase},getLabelForSetOfCases:function(b){var d=this.getLabelsForCollection(b),a=d&&d.setOfCasesWithArticle;if(!SC.empty(a)){return a}var c=this.getPath("gameSpec.eventsAttributeName");if(!SC.empty(c)){return c}return arguments.callee.base.apply(this,arguments)},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);a.gameName=this.get("gameName");a.gameUrl=this.get("gameUrl");var b=this.get("savedGameState");if(b){DG.ObjectMap.forEach(b._links_,function(c,d){DG.ArchiveUtils.addLinkID(a,"_game_"+c,"DG.Case",d)});a.gameState=b;this.set("savedGameState",null)}return a},restoreFromStorage:function(b){arguments.callee.base.apply(this,arguments);var a=DG.gameSelectionController.findGameByName(b.gameName);if(a){this.set("gameSpec",a);a.set("context",this)}if(b.gameState){if(b._links_){DG.ObjectMap.forEach(b._links_,function(f,d){if(f.slice(0,6)==="_game_"){var c=f.slice(6);if(!b.gameState._links_){b.gameState._links_={}}b.gameState._links_[c]=d.id}})}this.set("restoredGameState",b.gameState)}}});DG.DataContext.registry["DG.GameContext"]=function(a){return DG.GameContext.create(a)};DG.GameContext.getContextForGame=function(a){if(!a){return null}var d=a.get("context");if(!d){var f={type:a.get("contextType")||"DG.GameContext"};if(f.type==="DG.GameContext"){f.gameSpec=a}var c=DG.currDocumentController().getPath("content.id"),b=DG.DataContextRecord.createContext({type:f.type,document:c});if(b){f.model=b}d=DG.DataContext.factory(f);if(d){a.set("context",d)}}return d};DG.globalsController=SC.Controller.create((function(){return{globalNameChanges:null,globalValueChanges:0,_globalsMap:{},isNameInUse:function(a){return !SC.none(this.getGlobalValueByName(a))},getGlobalValueByName:function(b){var c=SC.Query.local(DG.GlobalValue,{conditions:"name = {name}",name:b}),a=DG.store.find(c);return a.get("length")>0?a.objectAt(0):null},getUniqueName:function(a){var c=0,b;a=a||"v";do{++c;b=a+c}while(this.isNameInUse(b));return b},createGlobalValue:function(c,b){c=c||{};if(SC.empty(c.name)){c.name=this.getUniqueName(b)}if(!c.value){c.value=0.5}var a=DG.GlobalValue.createGlobalValue(c);this.registerGlobalValue(a);return a},destroyGlobalValue:function(a){var b=a&&a.get("name");a.removeObserver("name",this,this.nameDidChange);a.removeObserver("value",this,this.valueDidChange);delete this._globalsMap[b];DG.GlobalValue.destroyGlobalValue(a);this.set("globalNameChanges",[{oldName:b}]);this.valueDidChange()},registerGlobalValue:function(a){var b=a&&a.get("name");this._globalsMap[b]=a;a.addObserver("name",this,this.nameDidChange);a.addObserver("value",this,this.valueDidChange);this.set("globalNameChanges",[{newName:b}])},nameDidChange:function(b){var a=DG.ObjectMap.findValue(this._globalsMap,b),c=b.get("name");if(a!==c){this._globalsMap[c]=b;DG.ObjectMap.remove(this._globalsMap,a);this.set("globalNameChanges",[{oldName:a,newName:c}])}},valueDidChange:function(a){var b=a&&a.get("name"),c=b?[b]:[];this.set("globalValueChanges",c)},stopAnimation:function(){DG.ObjectMap.forEach(this._globalsMap,function(a,b){if(b&&b.stopAnimation){b.stopAnimation()}})},getGlobalValueNames:function(){return DG.ObjectMap.keys(this._globalsMap)},addGlobalValuesToNamespace:function(a){DG.ObjectMap.forEach(this._globalsMap,function(b,c){a[b]=c.get("value")})}}}()));sc_require("controllers/component_controller");DG.WebViewController=DG.ComponentController.extend({theURL:"",gearMenuItems:function(){return[{title:"Edit URL",target:this,itemAction:this.editURL,isEnabled:true}]}.property(),editURL:function(){var c=this,b=null;function a(){var d=b.get("value");b.close();if(!SC.empty(d)){c.set("theURL",d)}}b=DG.CreateSingleTextDialog({prompt:DG.DocumentController.enterURLPrompt,textValue:this.get("theURL"),textHint:"URL",okTarget:null,okAction:a,okTooltip:DG.DocumentController.enterViewWebPageOKTip})},createComponentStorage:function(){var a=this.get("theURL"),b={};if(!SC.empty(a)){b.URL=a}return b},restoreComponentStorage:function(a){var b=a.URL||"";this.set("theURL",b)},viewDidChange:function(){var a=this.getPath("view.containerView.contentView");if(a){if(SC.empty(this.theURL)){this.set("theURL",a.get("value"))}a.bind("value",this,"theURL");a.set("controller",this)}}.observes("view")});DG.MemoryDataSource=SC.DataSource.extend((function(){var o={},f={},l={},k={},t={},a={},m={},s={},j={};o["DG.Document"]=l;o["DG.Component"]=k;o["DG.DataContextRecord"]=t;o["DG.CollectionRecord"]=a;o["DG.Attribute"]=m;o["DG.Case"]=s;o["DG.GlobalValue"]=j;f["DG.Document"]=[];f["DG.Component"]=[];f["DG.DataContextRecord"]=[];f["DG.CollectionRecord"]=[];f["DG.Attribute"]=[];f["DG.Case"]=[];f["DG.GlobalValue"]=[];var c={};c["DG.Document"]=10;c["DG.Component"]=100;c["DG.DataContextRecord"]=400;c["DG.CollectionRecord"]=600;c["DG.Attribute"]=1000;c["DG.Case"]=2000;c["DG.GlobalValue"]=9000;function q(u){return SC.clone(u,YES)}function n(u){var w=[];for(var v=0;v<u.length;v++){w.push(q(u[v]))}return w}var d=function(v,u){if(SC.kindOf(v,DG.Document)){return"DG.Document"}if(SC.kindOf(v,DG.DataContextRecord)){return"DG.DataContextRecord"}if(SC.kindOf(v,DG.Component)){return"DG.Component"}if(SC.kindOf(v,DG.CollectionRecord)){return"DG.CollectionRecord"}if(SC.kindOf(v,DG.Attribute)){return"DG.Attribute"}if(SC.kindOf(v,DG.Case)){return"DG.Case"}if(SC.kindOf(v,DG.GlobalValue)){return"DG.GlobalValue"}};function g(x,y,z,w){var v=w.storeKeyFor(x,y.guid),u=w.readEditableDataHash(v);u[z]=SC.copy(y[z],true);w.dataHashDidChange(v,null,false,z)}function b(u,C,y,z,B){var x=u[C];if(!SC.none(x)){var w=d(y,B),v=w&&o[w][x];if(!v){return}var A=false;if(!v[z]){v[z]=[];A=true}if(v[z].indexOf(u.guid)<0){v[z].pushObject(u.guid);A=true}if(A){g(y,v,z,B)}}}function r(x,w,v){var u=w[v];if(u&&u.indexOf(x.guid)>=0){u.removeObject(x.guid);return true}return false}function p(u,D,z,B,C){var w=d(z,C),x=!SC.empty(D)&&u[D],v=o[w][x];if(v){if(r(u,v,B)){g(z,v,B,C)}return}var A=w&&f[w],E=A?A.length:0;for(var y=0;y<E;++y){v=A[y];if(r(u,v,B)){g(z,v,B,C);break}}}var h=function(w,v,u){if(!v){return}switch(w){case"DG.Document":break;case"DG.Component":p(v,"document",DG.Document,"components",u);break;case"DG.DataContextRecord":p(v,"document",DG.Document,"contexts",u);break;case"DG.CollectionRecord":p(v,"context",DG.DataContextRecord,"collections",u);p(v,"parent",DG.CollectionRecord,"children",u);break;case"DG.Attribute":p(v,"collection",DG.CollectionRecord,"attrs",u);break;case"DG.Case":p(v,"collection",DG.CollectionRecord,"cases",u);p(v,"parent",DG.Case,"children",u);break;case"DG.GlobalValue":p(v,"document",DG.Document,"globalValues",u);break;default:DG.logWarn("removeRelations: Unrecognized record type: "+w)}};var i=function(x,v,u,w){if(w){h(x,v,u)}switch(x){case"DG.Document":break;case"DG.Component":b(v,"document",DG.Document,"components",u);break;case"DG.DataContextRecord":b(v,"document",DG.Document,"contexts",u);break;case"DG.CollectionRecord":b(v,"context",DG.DataContextRecord,"collections",u);b(v,"parent",DG.CollectionRecord,"children",u);break;case"DG.Attribute":b(v,"collection",DG.CollectionRecord,"attrs",u);break;case"DG.Case":b(v,"collection",DG.CollectionRecord,"cases",u);b(v,"parent",DG.Case,"children",u);break;case"DG.GlobalValue":b(v,"document",DG.Document,"globalValues",u);break;default:DG.logWarn("configureRelations: Unrecognized record type: "+x)}};return{getDataHash:function(u,v){return o[u][v]},fetch:function(v,w){var x=w.get("recordType");var y=d(x,v);var u=null;u=n(f[y]);v.loadRecords(x,u);v.dataSourceDidFetchQuery(w);return YES},assignIDForNewRecord:function(u,v){v.guid=++c[u];return v.guid},loadRecords:function(v,w){var u=DG.Record.stringFromRecordType(v);w.forEach(function(z){var x=q(z),y=x.guid;if(c[u]<y){c[u]=y}o[u][y]=x;f[u].pushObject(x)})},retrieveRecord:function(v,x){var y=d(v.recordTypeFor(x),v);var w=v.idFor(x);var u=q(o[y][w]);v.dataSourceDidComplete(x,u);return YES},createRecord:function(v,w){var x=d(v.recordTypeFor(w),v);var u=q(v.readDataHash(w));u.guid=++c[x];o[x][u.guid]=u;f[x].pushObject(u);i(x,u,v);v.dataSourceDidComplete(w,q(u),u.guid);return YES},updateRecord:function(v,y){var z=d(v.recordTypeFor(y),v);var u=q(v.readDataHash(y));var w=v.idFor(y);var x=o[z][w];f[z].removeObject(x);delete o[z][w];o[z][w]=u;f[z].pushObject(u);i(z,u,v,true);v.dataSourceDidComplete(y);return YES},destroyRecord:function(u,x){var y=d(u.recordTypeFor(x),u);var v=u.idFor(x);var w=o[y][v];f[y].removeObject(w);delete o[y][v];h(y,w,u);u.dataSourceDidDestroy(x);return YES}}}()));DG.RESTDataSource=SC.DataSource.extend((function(){var b=function(f,g){var c=DG.Record.stringFromRecordType(f),d=c.indexOf(".");if(d>=0){c=c.substr(d+1)}return"/DataGames/DataServer/server/%@/%@".fmt(c,g)},a=function(d){var c=d.get("recordType");return b(c)};return{fetch:function(d,f){var c=a(f);if(!SC.empty(c)){SC.Request.getUrl(c).notify(this,"fetchDidComplete",d,f).json().send();return YES}return NO},fetchDidComplete:function(g,d,f){if(SC.ok(g)){var h=f.get("recordType"),c=g.get("body");d.loadRecords(h,c);d.dataSourceDidFetchQuery(f)}else{d.dataSourceDidErrorQuery(f,g)}},retrieveRecord:function(f,d){var i=f.recordTypeFor(d),h=f.idFor(d),g=f.readDataHash(d),c=b(i,h);if(!SC.none(c)){SC.Request.getUrl(c).notify(this,"retrieveRecordDidComplete",f,d,h).json().send(g);return YES}return NO},retrieveRecordDidComplete:function(g,d,c,f){if(SC.ok(g)&&g.get("status")===200){d.dataSourceDidComplete(c,g.get("body"))}else{d.dataSourceDidError(c,g)}},createRecord:function(f,d){var h=f.recordTypeFor(d),g=f.readDataHash(d),c=b(h);if(!SC.empty(c)){SC.Request.postUrl(c).notify(this,"createRecordDidComplete",f,d).json().send(g);return YES}return NO},createRecordDidComplete:function(g,f,d){var c=g.get("body");if(SC.ok(g)&&g.get("status")===200){f.dataSourceDidComplete(d,null,c.id)}else{f.dataSourceDidError(d,g)}},updateRecord:function(f,d){var i=f.recordTypeFor(d),h=f.idFor(d),g=f.readDataHash(d),c=b(i,h);if(!SC.empty(c)){SC.Request.putUrl(c).notify(this,"updateRecordDidComplete",f,d,h).json().send(g);return YES}return NO},updateRecordDidComplete:function(g,d,c,f){if(SC.ok(g)&&g.get("status")===200){d.dataSourceDidComplete(c)}else{d.dataSourceDidError(c,g)}},destroyRecord:function(f,d){var h=f.recordTypeFor(d),g=f.idFor(d),c=b(h,g);if(!SC.empty(c)){SC.Request.deleteUrl(c).notify(this,"destroyRecordDidComplete",f,d).json().send();return YES}return NO},destroyRecordDidComplete:function(f,d,c){if(SC.ok(f)&&f.get("status")===200){d.dataSourceDidDestroy(c)}else{d.dataSourceDidError(c,f)}}}}()));DG.AggregateFunction=SC.Object.extend({requiredArgs:{min:0,max:999},queryCache:function(c,b,a){return undefined},evaluate:function(c,b,a){}});DG.IteratingAggregate=DG.AggregateFunction.extend({queryCache:function(c,b,a){return a.results?a.results[b._id_]:undefined},evaluate:function(k,h,j){var b=this.queryCache(k,h,j);if(b!==undefined){return b}var f=k&&k.getCollectionToIterate(),l=f&&f.get("cases"),c=l&&l.get("length");j.caches={};j.results={};for(var d=0;d<c;++d){var a=l.objectAt(d),g={_case_:a,_id_:a&&a.get("id")};this.evalCase(k,g,j)}return this.computeResults(k,h,j)},evalCase:function(c,b,a,d){},computeResults:function(c,b,a){return this.queryCache(c,b,a)}});DG.ParentCaseAggregate=DG.IteratingAggregate.extend({queryCache:function(c,b,a){if(a.results){if(a.results[b._id_]!==undefined){return a.results[b._id_]}var f=b._case_&&b._case_.getPath("parent.id"),d=f||null;if(a.results[d]!==undefined){return a.results[d]}}return undefined},evaluate:function(l,h,k){var b=this.queryCache(l,h,k);if(b!==undefined){return b}var f=l&&l.getCollectionToIterate(),m=f&&f.get("cases"),c=m&&m.get("length");k.caches={};k.results={};for(var d=0;d<c;++d){var a=m.objectAt(d),j=(a&&a.getPath("parent.id"))||null,g={_case_:a,_id_:a&&a.get("id")};this.evalCase(l,g,k,j)}return this.computeResults(l,h,k)}});DG.SortDataFunction=DG.ParentCaseAggregate.extend({evalCase:function(d,c,b,h){var g=b.argFns[0],f=g&&g(d,c);if(isFinite(f)){var a=b.caches[h];if(a){a.push(f)}else{b.caches[h]=[f]}}},extractResult:function(a){return null},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(d,f){if(f.length>0){f.sort(function(h,g){return h-g})}a.results[d]=this.extractResult(f)}.bind(this));return this.queryCache(c,b,a)}});sc_require("formula/aggregate_function");sc_require("formula/global_formula_context");DG.CollectionFormulaContext=DG.GlobalFormulaContext.extend({collection:null,attrFns:null,collectionAttrRefCounts:null,aggFnInstances:null,aggFnCount:0,init:function(){arguments.callee.base.apply(this,arguments);this.clearCaches()},clearCaches:function(){this.attrFns={};this.collectionAttrRefCounts={};this.aggFnInstances=[];this.aggFnCount=0},getCaseIndex:function(b){var a=this.collection.caseIDToIndexMap;return a&&(a[b]+1)},getAttrValue:function(b,a){var c=b&&a&&b.getValue(a);if(c instanceof Error){throw c}return c},compileVariable:function(g){if(g==="caseIndex"){return"c.getCaseIndex(e._id_)"}var l,b,k=this.get("collection"),c=k&&k.getAttributeByName(g);if(SC.none(c)){l=k&&k.get("parent");for(l;!SC.none(l)&&SC.none(c);l=l.get("parent")){c=l&&l.getAttributeByName(g);if(!SC.none(c)){k=l;break}}}if(SC.none(c)){var d=this.getPath("collection.children"),h=d&&d.get("length");for(var j=0;j<h;++j){b=d.objectAt(j);c=b&&b.getAttributeByName(g);if(!SC.none(c)){k=b;break}}}if(c){var a=c.get("id");this.attrFns[g]=function(o){var n=o._case_,i=(b&&o._childCase_)||(l&&n.get("parent"))||n,p=i&&i.getValue(a);if(p instanceof Error){throw p}return p};var f=k.get("id"),m=this.collectionAttrRefCounts[f]||0;this.collectionAttrRefCounts[f]=m+1;return'c.attrFns["'+g+'"](e)'}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,c){if(a==="caseIndex"){return this.getCaseIndex(c._id_)}var f=this.get("collection"),d=f&&f.getAttributeByName(a),b=d&&d.get("id");if(b){return this.getAttrValue(c._case_,b)}return arguments.callee.base.apply(this,arguments)},getCollectionToIterate:function(){var d=this.get("collection"),k=d&&d.get("children"),b=k&&k.get("length");for(var c=0;c<b;++c){var g=k.objectAt(c),h=g&&g.get("id");if(this.collectionAttrRefCounts[h]>0){return g}}var a=d&&d.get("id");if(this.collectionAttrRefCounts[a]>0){return d}var f=d&&d.get("parent"),j=f&&f.get("id");if(this.collectionAttrRefCounts[j]>0){return f}return d},aggFns:{},hasAggregates:function(){return this.aggFnCount>0}.property("aggFnCount"),isAggregate:function(a){return SC.kindOf(this.aggFns[a],DG.AggregateFunction)},evalAggregate:function(d,g){if(!d._case_||SC.none(d._id_)){return null}var b=this.aggFnInstances[g];b.results={};var f=this.aggFns[b.name],a=f&&f.queryCache(this,d,b),c,j=b.args.length;if(a!==undefined){return a}b.argFns=[];for(c=0;c<j;++c){b.argFns.push(DG.FormulaContext.createContextFunction(b.args[c]))}var h=f.get("requiredArgs");if((j<h.min)||(h.max<j)){throw new DG.FuncArgsError(b.name,h)}return f.evaluate(this,d,b)},compileFunction:function(c,b){if(this.isAggregate(c)){var a=this.aggFnCount++;this.aggFnInstances.push({name:c,args:b});return"c.evalAggregate(e,"+a+")"}return arguments.callee.base.apply(this,arguments)}});DG.CollectionFormulaContext.registerAggFnModule=function(a){DG.FormulaContext.registerFnModule(a);DG.ObjectMap.copy(DG.CollectionFormulaContext.prototype.aggFns,a)};sc_require("formula/formula_common");sc_require("formula/formula_context");DG.Formula=SC.Object.extend({context:null,source:null,init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("context");if(a){a.addObserver("namespaceChange",this,"namespaceDidChange")}if(a){a.addObserver("dependentChange",this,"dependentDidChange")}},destroy:function(){var a=this.get("context");if(a){a.removeObserver("namespaceChange",this,"namespaceDidChange");a.removeObserver("dependentChange",this,"dependentDidChange");a.destroy();this.context=null}arguments.callee.base.apply(this,arguments)},invalidate:function(){this.notifyPropertyChange("source")},invalidateContext:function(){this.notifyPropertyChange("context")},namespaceDidChange:function(a,b){this.notifyPropertyChange(b);this.notifyPropertyChange("dependentChange")},dependentDidChange:function(a,b){this.notifyPropertyChange(b)},parseCount:0,parsed:function(){++this.parseCount;var c=this.get("source"),a;try{a=c&&DG.formulaParser.parse(c)}catch(b){b.originalMessage=b.message;b.message=b.found?"DG.Formula.SyntaxErrorMiddle".loc(b.found):"DG.Formula.SyntaxErrorEnd".loc();throw b}return a}.property("source").cacheable(),compiled:function(){var b=this.get("parsed"),c=this.get("context"),d=null;if(!c){c=DG.FormulaContext.create({});this.context=c}if(b){c.clearCaches();var a=DG.Formula.compileToJavaScript(b,c);d=DG.FormulaContext.createContextFunction(a)}return d}.property("parsed","context","namespaceChange").cacheable(),hasAggregates:function(){var a=false;try{this.get("compiled");var b=this.get("context");if(b){a=b.get("hasAggregates")}}catch(c){}return a}.property("compiled","context").cacheable(),evaluate:function(b){var c=this.get("compiled"),a=this.get("context");return c&&c(a,b)},evaluateDirect:function(c){var a=this.get("parsed"),b=this.get("context");if(!b){b=DG.FormulaContext.create({});this.context=b}return DG.Formula.evaluateParseTree(a,b,c)}});DG.Formula.compileToJavaScript=function(a,l){var i;function k(o){var n=i[o.type];return n&&n(o)}function f(n){return n.value}function b(n){return'"'+n.value+'"'}function h(n){return l.compileVariable(n.name)}function m(q){var p,n=q.args&&q.args.length,o=[];for(p=0;p<n;++p){o.push(k(q.args[p]))}return l.compileFunction(q.name.name,o)}function g(o){var n=(o.type==="BinaryExpression"),p=k(o);if(n){p="("+p+")"}return p}function d(n){return n.operator+g(n.expression)}function c(o){var n=g(o.left),p=g(o.right);if(o.operator==="^"){return"Math.pow("+n+","+p+")"}return n+o.operator+p}function j(n){return"("+g(n.condition)+"?"+g(n.trueExpression)+":"+g(n.falseExpression)+")"}i={BooleanLiteral:f,NumericLiteral:f,StringLiteral:b,Variable:h,FunctionCall:m,UnaryExpression:d,BinaryExpression:c,ConditionalExpression:j};return k(a)};DG.Formula.evaluateParseTree=function(a,k,j){var g;function i(n){var m=g[n.type];return m&&m(n)}function d(m){return m.value}function f(m){return k.evaluateVariable(m.name,j)}function l(p){var o,m=p.args&&p.args.length,n=[];for(o=0;o<m;++o){n.push(i(p.args[o]))}return k.evaluateFunction(p.name.name,n)}function c(m){var n=i(m.expression);switch(m.operator){case"+":return +n;case"-":return -n;case"!":return !n}return undefined}function b(n){var o=i(n.left),m=i(n.right);switch(n.operator){case"^":return Math.pow(o,m);case"*":return o*m;case"/":return o/m;case"%":return o%m;case"+":return o+m;case"-":return o-m;case"<":return o<m;case">":return o>m;case"<=":return o<=m;case">=":return o>=m;case"===":return o===m;case"!==":return o!==m;case"&&":return o&&m;case"||":return o||m}return undefined}function h(m){return i(m.condition)?i(m.trueExpression):i(m.falseExpression)}g={BooleanLiteral:d,NumericLiteral:d,StringLiteral:d,Variable:f,FunctionCall:l,UnaryExpression:c,BinaryExpression:b,ConditionalExpression:h};return i(a)};DG.formulaParser=(function(){function b(c){return'"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var a={parse:function(aQ,aR){var U={start:ai,SourceCharacter:ar,WhiteSpace:D,LineTerminator:al,LineTerminatorSequence:A,Identifier:ae,IdentifierName:S,IdentifierStart:O,IdentifierPart:an,UnicodeLetter:aK,ReservedWord:Z,Keyword:o,Literal:at,BooleanLiteral:C,NumericLiteral:d,DecimalLiteral:q,DecimalIntegerLiteral:aJ,DecimalDigits:P,DecimalDigit:v,NonZeroDigit:n,ExponentPart:aE,ExponentIndicator:G,SignedInteger:aj,HexDigit:u,StringLiteral:af,DoubleStringCharacters:r,SingleStringCharacters:i,DoubleStringCharacter:Q,SingleStringCharacter:aw,EscapeSequence:aG,CharacterEscapeSequence:c,SingleEscapeCharacter:J,NonEscapeCharacter:W,EscapeCharacter:I,HexEscapeSequence:F,UnicodeEscapeSequence:aB,AndToken:aM,OrToken:K,FalseToken:av,TrueToken:aS,Ll:aD,Lm:aC,Lo:az,Lt:ay,Lu:ax,Mc:ap,Mn:ag,Nd:R,Nl:M,Pc:t,Zs:N,_:V,__:aA,PrimaryExpression:y,MemberExpression:z,CallExpression:ak,Arguments:X,ArgumentList:T,LeftHandSideExpression:j,UnaryExpression:ah,UnaryOperator:aH,PowerExpression:p,PowerOperator:ac,MultiplicativeExpression:h,MultiplicativeOperator:x,AdditiveExpression:am,AdditiveOperator:ad,RelationalExpression:k,RelationalOperator:l,EqualityExpression:w,EqualityOperator:ao,LogicalANDExpression:aI,LogicalANDOperator:aP,LogicalORExpression:au,LogicalOROperator:ab,ConditionalExpression:g};if(aR!==undefined){if(U[aR]===undefined){throw new Error("Invalid rule name: "+b(aR)+".")}}else{aR="start"}var aF=0;var aq=0;var Y=0;var B=[];function aO(aU,aY,aW){var aT=aU;var aX=aW-aU.length;for(var aV=0;aV<aX;aV++){aT=aY+aT}return aT}function aL(aV){var aU=aV.charCodeAt(0);var aT;var aW;if(aU<=255){aT="x";aW=2}else{aT="u";aW=4}return"\\"+aT+aO(aU.toString(16).toUpperCase(),"0",aW)}function H(aT){if(aF<Y){return}if(aF>Y){Y=aF;B=[]}B.push(aT)}function ai(){var aW,aU,aT;var aX,aV;aX=aF;aV=aF;aW=aA();if(aW!==null){aU=g();if(aU!==null){aT=aA();if(aT!==null){aW=[aW,aU,aT]}else{aW=null;aF=aV}}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY,aZ){return aZ})(aX,aW[1])}if(aW===null){aF=aX}return aW}function ar(){var aT;if(aQ.length>aF){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("any character")}}return aT}function D(){var aT;aq++;if(/^[\t\x0B\f \xA0]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[\\t\\x0B\\f \\xA0]")}}if(aT===null){aT=N()}aq--;if(aq===0&&aT===null){H("whitespace")}return aT}function al(){var aT;if(/^[\n\r]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[\\n\\r]")}}return aT}function A(){var aT;aq++;if(aQ.charCodeAt(aF)===10){aT="\n";aF++}else{aT=null;if(aq===0){H('"\\n"')}}if(aT===null){if(aQ.substr(aF,2)==="\r\n"){aT="\r\n";aF+=2}else{aT=null;if(aq===0){H('"\\r\\n"')}}if(aT===null){if(aQ.charCodeAt(aF)===13){aT="\r";aF++}else{aT=null;if(aq===0){H('"\\r"')}}}}aq--;if(aq===0&&aT===null){H("end of line")}return aT}function ae(){var aW,aU;var aX,aV,aT;aq++;aX=aF;aV=aF;aT=aF;aq++;aW=Z();aq--;if(aW===null){aW=""}else{aW=null;aF=aT}if(aW!==null){aU=S();if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aZ,aY){return aY})(aX,aW[1])}if(aW===null){aF=aX}aq--;if(aq===0&&aW===null){H("identifier")}return aW}function S(){var aW,aU,aT;var aX,aV;aq++;aX=aF;aV=aF;aW=O();if(aW!==null){aU=[];aT=an();while(aT!==null){aU.push(aT);aT=an()}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aZ,a0,aY){return a0+aY.join("")})(aX,aW[0],aW[1])}if(aW===null){aF=aX}aq--;if(aq===0&&aW===null){H("identifier")}return aW}function O(){var aT;aT=aK();if(aT===null){if(aQ.charCodeAt(aF)===95){aT="_";aF++}else{aT=null;if(aq===0){H('"_"')}}}return aT}function an(){var aT;aT=O();if(aT===null){aT=R();if(aT===null){aT=t()}}return aT}function aK(){var aT;aT=ax();if(aT===null){aT=aD()}return aT}function Z(){var aT;aT=o();if(aT===null){aT=C()}return aT}function o(){var aV,aT;var aW,aU;aW=aF;if(aQ.substr(aF,4)==="else"){aV="else";aF+=4}else{aV=null;if(aq===0){H('"else"')}}if(aV===null){if(aQ.substr(aF,2)==="if"){aV="if";aF+=2}else{aV=null;if(aq===0){H('"if"')}}if(aV===null){if(aQ.substr(aF,6)==="switch"){aV="switch";aF+=6}else{aV=null;if(aq===0){H('"switch"')}}if(aV===null){if(aQ.substr(aF,4)==="then"){aV="then";aF+=4}else{aV=null;if(aq===0){H('"then"')}}}}}if(aV!==null){aU=aF;aq++;aT=an();aq--;if(aT===null){aT=""}else{aT=null;aF=aU}if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aW}}else{aV=null;aF=aW}return aV}function at(){var aT;var aU;aT=C();if(aT===null){aU=aF;aT=d();if(aT!==null){aT=(function(aW,aV){return{type:"NumericLiteral",value:aV}})(aU,aT)}if(aT===null){aF=aU}if(aT===null){aU=aF;aT=af();if(aT!==null){aT=(function(aW,aV){return{type:"StringLiteral",value:aV}})(aU,aT)}if(aT===null){aF=aU}}}return aT}function C(){var aT;var aU;aU=aF;aT=aS();if(aT!==null){aT=(function(aV){return{type:"BooleanLiteral",value:true}})(aU)}if(aT===null){aF=aU}if(aT===null){aU=aF;aT=av();if(aT!==null){aT=(function(aV){return{type:"BooleanLiteral",value:false}})(aU)}if(aT===null){aF=aU}}return aT}function d(){var aW,aU;var aX,aV,aT;aq++;aX=aF;aV=aF;aW=q();if(aW!==null){aT=aF;aq++;aU=O();aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aZ,aY){return aY})(aX,aW[0])}if(aW===null){aF=aX}aq--;if(aq===0&&aW===null){H("number")}return aW}function q(){var aX,aV,aU,aT;var aY,aW;aY=aF;aW=aF;aX=aJ();if(aX!==null){if(aQ.charCodeAt(aF)===46){aV=".";aF++}else{aV=null;if(aq===0){H('"."')}}if(aV!==null){aU=P();aU=aU!==null?aU:"";if(aU!==null){aT=aE();aT=aT!==null?aT:"";if(aT!==null){aX=[aX,aV,aU,aT]}else{aX=null;aF=aW}}else{aX=null;aF=aW}}else{aX=null;aF=aW}}else{aX=null;aF=aW}if(aX!==null){aX=(function(a2,a0,a1,aZ){return parseFloat(a0+"."+a1+aZ)})(aY,aX[0],aX[2],aX[3])}if(aX===null){aF=aY}if(aX===null){aY=aF;aW=aF;if(aQ.charCodeAt(aF)===46){aX=".";aF++}else{aX=null;if(aq===0){H('"."')}}if(aX!==null){aV=P();if(aV!==null){aU=aE();aU=aU!==null?aU:"";if(aU!==null){aX=[aX,aV,aU]}else{aX=null;aF=aW}}else{aX=null;aF=aW}}else{aX=null;aF=aW}if(aX!==null){aX=(function(a1,a0,aZ){return parseFloat("."+a0+aZ)})(aY,aX[1],aX[2])}if(aX===null){aF=aY}if(aX===null){aY=aF;aW=aF;aX=aJ();if(aX!==null){aV=aE();aV=aV!==null?aV:"";if(aV!==null){aX=[aX,aV]}else{aX=null;aF=aW}}else{aX=null;aF=aW}if(aX!==null){aX=(function(a1,a0,aZ){return parseFloat(a0+aZ)})(aY,aX[0],aX[1])}if(aX===null){aF=aY}}}return aX}function aJ(){var aV,aT;var aW,aU;if(aQ.charCodeAt(aF)===48){aV="0";aF++}else{aV=null;if(aq===0){H('"0"')}}if(aV===null){aW=aF;aU=aF;aV=n();if(aV!==null){aT=P();aT=aT!==null?aT:"";if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aU}}else{aV=null;aF=aU}if(aV!==null){aV=(function(aY,aZ,aX){return aZ+aX})(aW,aV[0],aV[1])}if(aV===null){aF=aW}}return aV}function P(){var aU,aT;var aV;aV=aF;aT=v();if(aT!==null){aU=[];while(aT!==null){aU.push(aT);aT=v()}}else{aU=null}if(aU!==null){aU=(function(aX,aW){return aW.join("")})(aV,aU)}if(aU===null){aF=aV}return aU}function v(){var aT;if(/^[0-9]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[0-9]")}}return aT}function n(){var aT;if(/^[1-9]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[1-9]")}}return aT}function aE(){var aV,aT;var aW,aU;aW=aF;aU=aF;aV=G();if(aV!==null){aT=aj();if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aU}}else{aV=null;aF=aU}if(aV!==null){aV=(function(aZ,aX,aY){return aX+aY})(aW,aV[0],aV[1])}if(aV===null){aF=aW}return aV}function G(){var aT;if(/^[eE]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[eE]")}}return aT}function aj(){var aV,aT;var aW,aU;aW=aF;aU=aF;if(/^[\-+]/.test(aQ.charAt(aF))){aV=aQ.charAt(aF);aF++}else{aV=null;if(aq===0){H("[\\-+]")}}aV=aV!==null?aV:"";if(aV!==null){aT=P();if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aU}}else{aV=null;aF=aU}if(aV!==null){aV=(function(aZ,aX,aY){return aX+aY})(aW,aV[0],aV[1])}if(aV===null){aF=aW}return aV}function u(){var aT;if(/^[0-9a-fA-F]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[0-9a-fA-F]")}}return aT}function af(){var aW,aU,aT;var aX,aV;aq++;aX=aF;aV=aF;if(aQ.charCodeAt(aF)===34){aW='"';aF++}else{aW=null;if(aq===0){H('"\\""')}}if(aW!==null){aU=r();aU=aU!==null?aU:"";if(aU!==null){if(aQ.charCodeAt(aF)===34){aT='"';aF++}else{aT=null;if(aq===0){H('"\\""')}}if(aT!==null){aW=[aW,aU,aT]}else{aW=null;aF=aV}}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW===null){aV=aF;if(aQ.charCodeAt(aF)===39){aW="'";aF++}else{aW=null;if(aq===0){H('"\'"')}}if(aW!==null){aU=i();aU=aU!==null?aU:"";if(aU!==null){if(aQ.charCodeAt(aF)===39){aT="'";aF++}else{aT=null;if(aq===0){H('"\'"')}}if(aT!==null){aW=[aW,aU,aT]}else{aW=null;aF=aV}}else{aW=null;aF=aV}}else{aW=null;aF=aV}}if(aW!==null){aW=(function(aZ,aY){return aY[1]})(aX,aW)}if(aW===null){aF=aX}aq--;if(aq===0&&aW===null){H("string")}return aW}function r(){var aU,aT;var aV;aV=aF;aT=Q();if(aT!==null){aU=[];while(aT!==null){aU.push(aT);aT=Q()}}else{aU=null}if(aU!==null){aU=(function(aX,aW){return aW.join("")})(aV,aU)}if(aU===null){aF=aV}return aU}function i(){var aU,aT;var aV;aV=aF;aT=aw();if(aT!==null){aU=[];while(aT!==null){aU.push(aT);aT=aw()}}else{aU=null}if(aU!==null){aU=(function(aX,aW){return aW.join("")})(aV,aU)}if(aU===null){aF=aV}return aU}function Q(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;aT=aF;aq++;if(aQ.charCodeAt(aF)===34){aW='"';aF++}else{aW=null;if(aq===0){H('"\\""')}}if(aW===null){if(aQ.charCodeAt(aF)===92){aW="\\";aF++}else{aW=null;if(aq===0){H('"\\\\"')}}if(aW===null){aW=al()}}aq--;if(aW===null){aW=""}else{aW=null;aF=aT}if(aW!==null){aU=ar();if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aZ,aY){return aY})(aX,aW[1])}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.charCodeAt(aF)===92){aW="\\";aF++}else{aW=null;if(aq===0){H('"\\\\"')}}if(aW!==null){aU=aG();if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY,aZ){return aZ})(aX,aW[1])}if(aW===null){aF=aX}}return aW}function aw(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;aT=aF;aq++;if(aQ.charCodeAt(aF)===39){aW="'";aF++}else{aW=null;if(aq===0){H('"\'"')}}if(aW===null){if(aQ.charCodeAt(aF)===92){aW="\\";aF++}else{aW=null;if(aq===0){H('"\\\\"')}}if(aW===null){aW=al()}}aq--;if(aW===null){aW=""}else{aW=null;aF=aT}if(aW!==null){aU=ar();if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aZ,aY){return aY})(aX,aW[1])}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.charCodeAt(aF)===92){aW="\\";aF++}else{aW=null;if(aq===0){H('"\\\\"')}}if(aW!==null){aU=aG();if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY,aZ){return aZ})(aX,aW[1])}if(aW===null){aF=aX}}return aW}function aG(){var aT;aT=c();if(aT===null){aT=F();if(aT===null){aT=aB()}}return aT}function c(){var aT;aT=J();if(aT===null){aT=W()}return aT}function J(){var aT;var aU;aU=aF;if(/^['"\\bfnrtv]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("['\"\\\\bfnrtv]")}}if(aT!==null){aT=(function(aW,aV){return aV.replace("b","\b").replace("f","\f").replace("n","\n").replace("r","\r").replace("t","\t").replace("v","\x0B")})(aU,aT)}if(aT===null){aF=aU}return aT}function W(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;aT=aF;aq++;aW=I();aq--;if(aW===null){aW=""}else{aW=null;aF=aT}if(aW===null){aW=al()}if(aW!==null){aU=ar();if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aZ,aY){return aY})(aX,aW[1])}if(aW===null){aF=aX}return aW}function I(){var aT;aT=J();if(aT===null){aT=v();if(aT===null){if(aQ.charCodeAt(aF)===120){aT="x";aF++}else{aT=null;if(aq===0){H('"x"')}}if(aT===null){if(aQ.charCodeAt(aF)===117){aT="u";aF++}else{aT=null;if(aq===0){H('"u"')}}}}}return aT}function F(){var aW,aU,aT;var aX,aV;aX=aF;aV=aF;if(aQ.charCodeAt(aF)===120){aW="x";aF++}else{aW=null;if(aq===0){H('"x"')}}if(aW!==null){aU=u();if(aU!==null){aT=u();if(aT!==null){aW=[aW,aU,aT]}else{aW=null;aF=aV}}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(a0,aZ,aY){return String.fromCharCode(parseInt("0x"+aZ+aY))})(aX,aW[1],aW[2])}if(aW===null){aF=aX}return aW}function aB(){var aY,aW,aV,aU,aT;var aZ,aX;aZ=aF;aX=aF;if(aQ.charCodeAt(aF)===117){aY="u";aF++}else{aY=null;if(aq===0){H('"u"')}}if(aY!==null){aW=u();if(aW!==null){aV=u();if(aV!==null){aU=u();if(aU!==null){aT=u();if(aT!==null){aY=[aY,aW,aV,aU,aT]}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}if(aY!==null){aY=(function(a4,a3,a2,a1,a0){return String.fromCharCode(parseInt("0x"+a3+a2+a1+a0))})(aZ,aY[1],aY[2],aY[3],aY[4])}if(aY===null){aF=aZ}return aY}function aM(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;if(aQ.substr(aF,3)==="and"){aW="and";aF+=3}else{aW=null;if(aq===0){H('"and"')}}if(aW!==null){aT=aF;aq++;aU=an();aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"&&"})(aX)}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.substr(aF,3)==="AND"){aW="AND";aF+=3}else{aW=null;if(aq===0){H('"AND"')}}if(aW!==null){aT=aF;aq++;aU=an();aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"&&"})(aX)}if(aW===null){aF=aX}}return aW}function K(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;if(aQ.substr(aF,2)==="or"){aW="or";aF+=2}else{aW=null;if(aq===0){H('"or"')}}if(aW!==null){aT=aF;aq++;aU=an();aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"||"})(aX)}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.substr(aF,2)==="OR"){aW="OR";aF+=2}else{aW=null;if(aq===0){H('"OR"')}}if(aW!==null){aT=aF;aq++;aU=an();aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"||"})(aX)}if(aW===null){aF=aX}}return aW}function av(){var aV,aT;var aW,aU;aW=aF;if(aQ.substr(aF,5)==="false"){aV="false";aF+=5}else{aV=null;if(aq===0){H('"false"')}}if(aV!==null){aU=aF;aq++;aT=an();aq--;if(aT===null){aT=""}else{aT=null;aF=aU}if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aW}}else{aV=null;aF=aW}return aV}function aS(){var aV,aT;var aW,aU;aW=aF;if(aQ.substr(aF,4)==="true"){aV="true";aF+=4}else{aV=null;if(aq===0){H('"true"')}}if(aV!==null){aU=aF;aq++;aT=an();aq--;if(aT===null){aT=""}else{aT=null;aF=aU}if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aW}}else{aV=null;aF=aW}return aV}function aD(){var aT;if(/^[a-z|\u03B1-\u03C9]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[a-z|\\u03B1-\\u03C9]")}}return aT}function aC(){var aT;if(/^(?!)/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[]")}}return aT}function az(){var aT;if(/^(?!)/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[]")}}return aT}function ay(){var aT;if(/^(?!)/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[]")}}return aT}function ax(){var aT;if(/^[A-Z|\u0391-\u03A9]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[A-Z|\\u0391-\\u03A9]")}}return aT}function ap(){var aT;if(/^(?!)/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[]")}}return aT}function ag(){var aT;if(/^(?!)/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[]")}}return aT}function R(){var aT;if(/^[0-9]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[0-9]")}}return aT}function M(){var aT;if(/^(?!)/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[]")}}return aT}function t(){var aT;if(/^[_]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[_]")}}return aT}function N(){var aT;if(/^[ \xA0]/.test(aQ.charAt(aF))){aT=aQ.charAt(aF);aF++}else{aT=null;if(aq===0){H("[ \\xA0]")}}return aT}function V(){var aU,aT;aU=[];aT=D();while(aT!==null){aU.push(aT);aT=D()}return aU}function aA(){var aU,aT;aU=[];aT=D();if(aT===null){aT=A()}while(aT!==null){aU.push(aT);aT=D();if(aT===null){aT=A()}}return aU}function y(){var aY,aW,aV,aU,aT;var aZ,aX;aZ=aF;aY=ae();if(aY!==null){aY=(function(a1,a0){return{type:"Variable",name:a0}})(aZ,aY)}if(aY===null){aF=aZ}if(aY===null){aY=at();if(aY===null){aZ=aF;aX=aF;if(aQ.charCodeAt(aF)===40){aY="(";aF++}else{aY=null;if(aq===0){H('"("')}}if(aY!==null){aW=aA();if(aW!==null){aV=g();if(aV!==null){aU=aA();if(aU!==null){if(aQ.charCodeAt(aF)===41){aT=")";aF++}else{aT=null;if(aq===0){H('")"')}}if(aT!==null){aY=[aY,aW,aV,aU,aT]}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}if(aY!==null){aY=(function(a1,a0){return a0})(aZ,aY[2])}if(aY===null){aF=aZ}}}return aY}function z(){var aT;aT=y();return aT}function ak(){var aZ,aX,aV,aT;var a0,aY,aW,aU;a0=aF;aY=aF;aW=aF;aU=aF;aZ=z();if(aZ!==null){aX=aA();if(aX!==null){aV=X();if(aV!==null){aZ=[aZ,aX,aV]}else{aZ=null;aF=aU}}else{aZ=null;aF=aU}}else{aZ=null;aF=aU}if(aZ!==null){aZ=(function(a3,a2,a1){return{type:"FunctionCall",name:a2,args:a1}})(aW,aZ[0],aZ[2])}if(aZ===null){aF=aW}if(aZ!==null){aX=[];aW=aF;aU=aF;aV=aA();if(aV!==null){aT=X();if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aU}}else{aV=null;aF=aU}if(aV!==null){aV=(function(a2,a1){return{type:"FunctionCallArguments",args:a1}})(aW,aV[1])}if(aV===null){aF=aW}while(aV!==null){aX.push(aV);aW=aF;aU=aF;aV=aA();if(aV!==null){aT=X();if(aT!==null){aV=[aV,aT]}else{aV=null;aF=aU}}else{aV=null;aF=aU}if(aV!==null){aV=(function(a2,a1){return{type:"FunctionCallArguments",args:a1}})(aW,aV[1])}if(aV===null){aF=aW}}if(aX!==null){aZ=[aZ,aX]}else{aZ=null;aF=aY}}else{aZ=null;aF=aY}if(aZ!==null){aZ=(function(a5,a4,a3){var a1=a4;for(var a2=0;a2<a3.length;a2++){switch(a3[a2].type){case"FunctionCallArguments":a1={type:"FunctionCall",name:a1,args:a3[a2].args};break;default:throw new Error("Invalid expression type: "+a3[a2].type)}}return a1})(a0,aZ[0],aZ[1])}if(aZ===null){aF=a0}return aZ}function X(){var aY,aW,aV,aU,aT;var aZ,aX;aZ=aF;aX=aF;if(aQ.charCodeAt(aF)===40){aY="(";aF++}else{aY=null;if(aq===0){H('"("')}}if(aY!==null){aW=aA();if(aW!==null){aV=T();aV=aV!==null?aV:"";if(aV!==null){aU=aA();if(aU!==null){if(aQ.charCodeAt(aF)===41){aT=")";aF++}else{aT=null;if(aq===0){H('")"')}}if(aT!==null){aY=[aY,aW,aV,aU,aT]}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}}else{aY=null;aF=aX}if(aY!==null){aY=(function(a1,a0){return a0!==""?a0:[]})(aZ,aY[2])}if(aY===null){aF=aZ}return aY}function T(){var aY,aX,aW,aV,aU,aT;var a1,a0,aZ;a1=aF;a0=aF;aY=g();if(aY!==null){aX=[];aZ=aF;aW=aA();if(aW!==null){if(aQ.charCodeAt(aF)===44){aV=",";aF++}else{aV=null;if(aq===0){H('","')}}if(aV!==null){aU=aA();if(aU!==null){aT=g();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}while(aW!==null){aX.push(aW);aZ=aF;aW=aA();if(aW!==null){if(aQ.charCodeAt(aF)===44){aV=",";aF++}else{aV=null;if(aq===0){H('","')}}if(aV!==null){aU=aA();if(aU!==null){aT=g();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}if(aX!==null){aY=[aY,aX]}else{aY=null;aF=a0}}else{aY=null;aF=a0}if(aY!==null){aY=(function(a6,a5,a3){var a2=[a5];for(var a4=0;a4<a3.length;a4++){a2.push(a3[a4][3])}return a2})(a1,aY[0],aY[1])}if(aY===null){aF=a1}return aY}function j(){var aT;aT=ak();if(aT===null){aT=z()}return aT}function ah(){var aW,aU,aT;var aX,aV;aW=j();if(aW===null){aX=aF;aV=aF;aW=aH();if(aW!==null){aU=aA();if(aU!==null){aT=ah();if(aT!==null){aW=[aW,aU,aT]}else{aW=null;aF=aV}}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(a0,aY,aZ){return{type:"UnaryExpression",operator:aY,expression:aZ}})(aX,aW[0],aW[2])}if(aW===null){aF=aX}}return aW}function aH(){var aT;var aU;if(aQ.charCodeAt(aF)===43){aT="+";aF++}else{aT=null;if(aq===0){H('"+"')}}if(aT===null){if(aQ.charCodeAt(aF)===45){aT="-";aF++}else{aT=null;if(aq===0){H('"-"')}}if(aT===null){aU=aF;if(aQ.charCodeAt(aF)===8722){aT="\u2212";aF++}else{aT=null;if(aq===0){H('"\\u2212"')}}if(aT!==null){aT=(function(aV){return"-"})(aU)}if(aT===null){aF=aU}if(aT===null){if(aQ.charCodeAt(aF)===33){aT="!";aF++}else{aT=null;if(aq===0){H('"!"')}}}}}return aT}function p(){var aZ,aX,aV,aU,aT;var a0,aY,aW;a0=aF;aY=aF;aZ=[];aW=aF;aX=aA();if(aX!==null){aV=ah();if(aV!==null){aU=aA();if(aU!==null){aT=ac();if(aT!==null){aX=[aX,aV,aU,aT]}else{aX=null;aF=aW}}else{aX=null;aF=aW}}else{aX=null;aF=aW}}else{aX=null;aF=aW}while(aX!==null){aZ.push(aX);aW=aF;aX=aA();if(aX!==null){aV=ah();if(aV!==null){aU=aA();if(aU!==null){aT=ac();if(aT!==null){aX=[aX,aV,aU,aT]}else{aX=null;aF=aW}}else{aX=null;aF=aW}}else{aX=null;aF=aW}}else{aX=null;aF=aW}}if(aZ!==null){aX=ah();if(aX!==null){aZ=[aZ,aX]}else{aZ=null;aF=aY}}else{aZ=null;aF=aY}if(aZ!==null){aZ=(function(a5,a4,a2){var a1=a2;for(var a3=a4.length-1;a3>=0;a3--){a1={type:"BinaryExpression",operator:"^",left:a4[a3][1],right:a1}}return a1})(a0,aZ[0],aZ[1])}if(aZ===null){aF=a0}return aZ}function ac(){var aT;if(aQ.charCodeAt(aF)===94){aT="^";aF++}else{aT=null;if(aq===0){H('"^"')}}return aT}function h(){var aY,aX,aW,aV,aU,aT;var a1,a0,aZ;a1=aF;a0=aF;aY=p();if(aY!==null){aX=[];aZ=aF;aW=aA();if(aW!==null){aV=x();if(aV!==null){aU=aA();if(aU!==null){aT=p();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}while(aW!==null){aX.push(aW);aZ=aF;aW=aA();if(aW!==null){aV=x();if(aV!==null){aU=aA();if(aU!==null){aT=p();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}if(aX!==null){aY=[aY,aX]}else{aY=null;aF=a0}}else{aY=null;aF=a0}if(aY!==null){aY=(function(a6,a5,a3){var a2=a5;for(var a4=0;a4<a3.length;a4++){a2={type:"BinaryExpression",operator:a3[a4][1],left:a2,right:a3[a4][3]}}return a2})(a1,aY[0],aY[1])}if(aY===null){aF=a1}return aY}function x(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;if(aQ.charCodeAt(aF)===42){aW="*";aF++}else{aW=null;if(aq===0){H('"*"')}}if(aW===null){if(aQ.charCodeAt(aF)===47){aW="/";aF++}else{aW=null;if(aq===0){H('"/"')}}if(aW===null){if(aQ.charCodeAt(aF)===37){aW="%";aF++}else{aW=null;if(aq===0){H('"%"')}}}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aZ,aY){return aY})(aX,aW[0])}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.charCodeAt(aF)===215){aW="\xD7";aF++}else{aW=null;if(aq===0){H('"\\xD7"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"*"})(aX)}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.charCodeAt(aF)===247){aW="\xF7";aF++}else{aW=null;if(aq===0){H('"\\xF7"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"/"})(aX)}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.charCodeAt(aF)===8901){aW="\u22C5";aF++}else{aW=null;if(aq===0){H('"\\u22C5"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"*"})(aX)}if(aW===null){aF=aX}}}}return aW}function am(){var aY,aX,aW,aV,aU,aT;var a1,a0,aZ;a1=aF;a0=aF;aY=h();if(aY!==null){aX=[];aZ=aF;aW=aA();if(aW!==null){aV=ad();if(aV!==null){aU=aA();if(aU!==null){aT=h();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}while(aW!==null){aX.push(aW);aZ=aF;aW=aA();if(aW!==null){aV=ad();if(aV!==null){aU=aA();if(aU!==null){aT=h();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}if(aX!==null){aY=[aY,aX]}else{aY=null;aF=a0}}else{aY=null;aF=a0}if(aY!==null){aY=(function(a6,a5,a3){var a2=a5;for(var a4=0;a4<a3.length;a4++){a2={type:"BinaryExpression",operator:a3[a4][1],left:a2,right:a3[a4][3]}}return a2})(a1,aY[0],aY[1])}if(aY===null){aF=a1}return aY}function ad(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;if(aQ.charCodeAt(aF)===43){aW="+";aF++}else{aW=null;if(aq===0){H('"+"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===43){aU="+";aF++}else{aU=null;if(aq===0){H('"+"')}}if(aU===null){if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"+"})(aX)}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.charCodeAt(aF)===45){aW="-";aF++}else{aW=null;if(aq===0){H('"-"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===45){aU="-";aF++}else{aU=null;if(aq===0){H('"-"')}}if(aU===null){if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"-"})(aX)}if(aW===null){aF=aX}if(aW===null){aX=aF;aV=aF;if(aQ.charCodeAt(aF)===8722){aW="\u2212";aF++}else{aW=null;if(aq===0){H('"\\u2212"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===8722){aU="\u2212";aF++}else{aU=null;if(aq===0){H('"\\u2212"')}}if(aU===null){if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"-"})(aX)}if(aW===null){aF=aX}}}return aW}function k(){var aY,aX,aW,aV,aU,aT;var a1,a0,aZ;a1=aF;a0=aF;aY=am();if(aY!==null){aX=[];aZ=aF;aW=aA();if(aW!==null){aV=l();if(aV!==null){aU=aA();if(aU!==null){aT=am();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}while(aW!==null){aX.push(aW);aZ=aF;aW=aA();if(aW!==null){aV=l();if(aV!==null){aU=aA();if(aU!==null){aT=am();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}if(aX!==null){aY=[aY,aX]}else{aY=null;aF=a0}}else{aY=null;aF=a0}if(aY!==null){aY=(function(a6,a5,a3){var a2=a5;for(var a4=0;a4<a3.length;a4++){a2={type:"BinaryExpression",operator:a3[a4][1],left:a2,right:a3[a4][3]}}return a2})(a1,aY[0],aY[1])}if(aY===null){aF=a1}return aY}function l(){var aT;var aU;if(aQ.substr(aF,2)==="<="){aT="<=";aF+=2}else{aT=null;if(aq===0){H('"<="')}}if(aT===null){if(aQ.substr(aF,2)===">="){aT=">=";aF+=2}else{aT=null;if(aq===0){H('">="')}}if(aT===null){if(aQ.charCodeAt(aF)===60){aT="<";aF++}else{aT=null;if(aq===0){H('"<"')}}if(aT===null){if(aQ.charCodeAt(aF)===62){aT=">";aF++}else{aT=null;if(aq===0){H('">"')}}if(aT===null){aU=aF;if(aQ.charCodeAt(aF)===8804){aT="\u2264";aF++}else{aT=null;if(aq===0){H('"\\u2264"')}}if(aT!==null){aT=(function(aV){return"<="})(aU)}if(aT===null){aF=aU}if(aT===null){aU=aF;if(aQ.charCodeAt(aF)===8805){aT="\u2265";aF++}else{aT=null;if(aq===0){H('"\\u2265"')}}if(aT!==null){aT=(function(aV){return">="})(aU)}if(aT===null){aF=aU}}}}}}return aT}function w(){var aY,aX,aW,aV,aU,aT;var a1,a0,aZ;a1=aF;a0=aF;aY=k();if(aY!==null){aX=[];aZ=aF;aW=aA();if(aW!==null){aV=ao();if(aV!==null){aU=aA();if(aU!==null){aT=k();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}while(aW!==null){aX.push(aW);aZ=aF;aW=aA();if(aW!==null){aV=ao();if(aV!==null){aU=aA();if(aU!==null){aT=k();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}if(aX!==null){aY=[aY,aX]}else{aY=null;aF=a0}}else{aY=null;aF=a0}if(aY!==null){aY=(function(a6,a5,a3){var a2=a5;for(var a4=0;a4<a3.length;a4++){a2={type:"BinaryExpression",operator:a3[a4][1],left:a2,right:a3[a4][3]}}return a2})(a1,aY[0],aY[1])}if(aY===null){aF=a1}return aY}function ao(){var aT;var aU;aU=aF;if(aQ.charCodeAt(aF)===61){aT="=";aF++}else{aT=null;if(aq===0){H('"="')}}if(aT!==null){aT=(function(aV){return"==="})(aU)}if(aT===null){aF=aU}if(aT===null){aU=aF;if(aQ.substr(aF,2)==="!="){aT="!=";aF+=2}else{aT=null;if(aq===0){H('"!="')}}if(aT!==null){aT=(function(aV){return"!=="})(aU)}if(aT===null){aF=aU}if(aT===null){aU=aF;if(aQ.charCodeAt(aF)===8800){aT="\u2260";aF++}else{aT=null;if(aq===0){H('"\\u2260"')}}if(aT!==null){aT=(function(aV){return"!=="})(aU)}if(aT===null){aF=aU}}}return aT}function aI(){var aY,aX,aW,aV,aU,aT;var a1,a0,aZ;a1=aF;a0=aF;aY=w();if(aY!==null){aX=[];aZ=aF;aW=aA();if(aW!==null){aV=aP();if(aV!==null){aU=aA();if(aU!==null){aT=w();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}while(aW!==null){aX.push(aW);aZ=aF;aW=aA();if(aW!==null){aV=aP();if(aV!==null){aU=aA();if(aU!==null){aT=w();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}if(aX!==null){aY=[aY,aX]}else{aY=null;aF=a0}}else{aY=null;aF=a0}if(aY!==null){aY=(function(a6,a5,a3){var a2=a5;for(var a4=0;a4<a3.length;a4++){a2={type:"BinaryExpression",operator:a3[a4][1],left:a2,right:a3[a4][3]}}return a2})(a1,aY[0],aY[1])}if(aY===null){aF=a1}return aY}function aP(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;if(aQ.charCodeAt(aF)===38){aW="&";aF++}else{aW=null;if(aq===0){H('"&"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"&&"})(aX)}if(aW===null){aF=aX}if(aW===null){aW=aM()}return aW}function au(){var aY,aX,aW,aV,aU,aT;var a1,a0,aZ;a1=aF;a0=aF;aY=aI();if(aY!==null){aX=[];aZ=aF;aW=aA();if(aW!==null){aV=ab();if(aV!==null){aU=aA();if(aU!==null){aT=aI();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}while(aW!==null){aX.push(aW);aZ=aF;aW=aA();if(aW!==null){aV=ab();if(aV!==null){aU=aA();if(aU!==null){aT=aI();if(aT!==null){aW=[aW,aV,aU,aT]}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}else{aW=null;aF=aZ}}if(aX!==null){aY=[aY,aX]}else{aY=null;aF=a0}}else{aY=null;aF=a0}if(aY!==null){aY=(function(a6,a5,a3){var a2=a5;for(var a4=0;a4<a3.length;a4++){a2={type:"BinaryExpression",operator:a3[a4][1],left:a2,right:a3[a4][3]}}return a2})(a1,aY[0],aY[1])}if(aY===null){aF=a1}return aY}function ab(){var aW,aU;var aX,aV,aT;aX=aF;aV=aF;if(aQ.charCodeAt(aF)===124){aW="|";aF++}else{aW=null;if(aq===0){H('"|"')}}if(aW!==null){aT=aF;aq++;if(aQ.charCodeAt(aF)===61){aU="=";aF++}else{aU=null;if(aq===0){H('"="')}}aq--;if(aU===null){aU=""}else{aU=null;aF=aT}if(aU!==null){aW=[aW,aU]}else{aW=null;aF=aV}}else{aW=null;aF=aV}if(aW!==null){aW=(function(aY){return"||"})(aX)}if(aW===null){aF=aX}if(aW===null){aW=K()}return aW}function g(){var a0,aZ,aY,aX,aW,aV,aU,aT,a3;var a2,a1;a2=aF;a1=aF;a0=au();if(a0!==null){aZ=aA();if(aZ!==null){if(aQ.charCodeAt(aF)===63){aY="?";aF++}else{aY=null;if(aq===0){H('"?"')}}if(aY!==null){aX=aA();if(aX!==null){aW=g();if(aW!==null){aV=aA();if(aV!==null){if(aQ.charCodeAt(aF)===58){aU=":";aF++}else{aU=null;if(aq===0){H('":"')}}if(aU!==null){aT=aA();if(aT!==null){a3=g();if(a3!==null){a0=[a0,aZ,aY,aX,aW,aV,aU,aT,a3]}else{a0=null;aF=a1}}else{a0=null;aF=a1}}else{a0=null;aF=a1}}else{a0=null;aF=a1}}else{a0=null;aF=a1}}else{a0=null;aF=a1}}else{a0=null;aF=a1}}else{a0=null;aF=a1}}else{a0=null;aF=a1}if(a0!==null){a0=(function(a6,a7,a4,a5){return{type:"ConditionalExpression",condition:a7,trueExpression:a4,falseExpression:a5}})(a2,a0[0],a0[4],a0[8])}if(a0===null){aF=a2}if(a0===null){a0=au()}return a0}function E(aV){aV.sort();var aW=null;var aU=[];for(var aT=0;aT<aV.length;aT++){if(aV[aT]!==aW){aU.push(aV[aT]);aW=aV[aT]}}return aU}function s(){var aT=1;var aW=1;var aX=false;for(var aU=0;aU<Math.max(aF,Y);aU++){var aV=aQ.charAt(aU);if(aV==="\n"){if(!aX){aT++}aW=1;aX=false}else{if(aV==="\r"||aV==="\u2028"||aV==="\u2029"){aT++;aW=1;aX=true}else{aW++;aX=false}}}return{line:aT,column:aW}}var aN=U[aR]();if(aN===null||aF!==aQ.length){var m=Math.max(aF,Y);var aa=m<aQ.length?aQ.charAt(m):null;var f=s();throw new this.SyntaxError(E(B),aa,m,f.line,f.column)}return aN},toSource:function(){return this._source}};a.SyntaxError=function(g,h,i,d,f){function c(l,m){var j,k;switch(l.length){case 0:j="end of input";break;case 1:j=l[0];break;default:j=l.slice(0,l.length-1).join(", ")+" or "+l[l.length-1]}k=m?b(m):"end of input";return"Expected "+j+" but "+k+" found."}this.name="SyntaxError";this.expected=g;this.found=h;this.message=c(g,h);this.offset=i;this.line=d;this.column=f};a.SyntaxError.prototype=Error.prototype;return a})();sc_require("formula/aggregate_function");sc_require("formula/collection_formula_context");DG.LookupAggFns={first:DG.AggregateFunction.create({requiredArgs:{min:1,max:1},evaluate:function(c,b,a){var f=a.argFns[0];function d(l,j){var i=j._case_,o=i&&i.get("parent"),n=o?o.get("children"):l&&l.getPath("collection.cases"),h=i&&i.get("children"),k=n&&n.firstObject(),m=k?{_case_:k,_id_:k.get("id")}:null;if(h){m._childCase_=h.firstObject()}return m}var g=f&&d(c,b);return g?f(c,g):undefined}}),last:DG.AggregateFunction.create({requiredArgs:{min:1,max:1},evaluate:function(f,d,c){var g=c.argFns[0];function b(l,k){var j=k._case_,o=j&&j.get("parent"),n=o?o.get("children"):l&&l.getPath("collection.cases"),i=j&&j.get("children"),h=n&&n.lastObject(),m=h?{_case_:h,_id_:h.get("id")}:null;if(i){m._childCase_=i.lastObject()}return m}var a=g&&b(f,d);return a?g(f,a):undefined}}),next:DG.AggregateFunction.create({requiredArgs:{min:1,max:2},evaluate:function(f,b,a){var g=a.argFns[0],h=a.argFns[1];function d(m,l){var o=l._case_&&l._case_.get("parent"),k=o&&o.get("children"),j=k&&k.get("length"),i=m.getCaseIndex(l._id_),n=k&&(i<j)?k.objectAt(i):null;return n?{_case_:n,_id_:n.get("id")}:null}var c=g&&d(f,b);return c?g(f,c):h?h(f,b):undefined}}),prev:DG.AggregateFunction.create({requiredArgs:{min:1,max:2},evaluate:function(f,d,c){var g=c.argFns[0],h=c.argFns[1];function b(l,k){var m=k._case_&&k._case_.get("parent"),j=m&&m.get("children"),i=l.getCaseIndex(k._id_),n=j&&(i>=2)?j.objectAt(i-2):null;return n?{_case_:n,_id_:n.get("id")}:null}var a=g&&b(f,d);return a?g(f,a):h?h(f,d):undefined}})};DG.CollectionFormulaContext.registerAggFnModule(DG.LookupAggFns);sc_require("formula/aggregate_function");sc_require("formula/collection_formula_context");DG.UnivariateStatsFns={count:DG.ParentCaseAggregate.create({requiredArgs:{min:0,max:1},evalCase:function(c,b,a,g){var f=a.argFns[0],d=f&&f(c,b);if(!f||(!SC.none(d)&&(d!==false))){if(a.results[g]){++a.results[g]}else{a.results[g]=1}}}}),min:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(d,c,b,h){var g=b.argFns[0],f=g&&g(d,c);if(isFinite(f)){var a=b.caches[h];if(a){if(a.min>f){a.min=f}}else{b.caches[h]={min:f}}}},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(f,d){a.results[f]=d.min});return this.queryCache(c,b,a)}}),max:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(d,c,b,h){var g=b.argFns[0],f=g&&g(d,c);if(isFinite(f)){var a=b.caches[h];if(a){if(a.max<f){a.max=f}}else{b.caches[h]={max:f}}}},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(f,d){a.results[f]=d.max});return this.queryCache(c,b,a)}}),mean:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(d,c,b,h){var g=b.argFns[0],f=g&&g(d,c);if(isFinite(f)){var a=b.caches[h];if(a){a.count+=1;a.sum+=f}else{b.caches[h]={count:1,sum:f}}}},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(f,d){a.results[f]=d.count>0?d.sum/d.count:null});return this.queryCache(c,b,a)}}),median:DG.SortDataFunction.create({requiredArgs:{min:1,max:1},extractResult:function(a){return DG.MathUtilities.medianOfNumericArray(a)}}),sum:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(c,b,a,g){var f=a.argFns[0],d=f&&f(c,b);if(isFinite(d)){if(a.results[g]){a.results[g]+=d}else{a.results[g]=d}}}})};DG.CollectionFormulaContext.registerAggFnModule(DG.UnivariateStatsFns);
/*! 
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(d){d.fn.drag=function(c,f,j){var i=typeof c=="string"?c:"",h=d.isFunction(c)?c:d.isFunction(f)?f:null;if(i.indexOf("drag")!==0){i="drag"+i}j=(c==h?f:j)||{};return h?this.bind(i,j,h):this.trigger(i)};var a=d.event,b=a.special,g=b.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",livekey:"livedrag",add:function(c){var f=d.data(this,g.datakey),h=c.data||{};f.related+=1;if(!f.live&&c.selector){f.live=true;a.add(this,"draginit."+g.livekey,g.delegate)}d.each(g.defaults,function(i){if(h[i]!==undefined){f[i]=h[i]}})},remove:function(){d.data(this,g.datakey).related-=1},setup:function(){if(!d.data(this,g.datakey)){var c=d.extend({related:0},g.defaults);d.data(this,g.datakey,c);a.add(this,"mousedown",g.init,c);this.attachEvent&&this.attachEvent("ondragstart",g.dontstart)}},teardown:function(){if(!d.data(this,g.datakey).related){d.removeData(this,g.datakey);a.remove(this,"mousedown",g.init);a.remove(this,"draginit",g.delegate);g.textselect(true);this.detachEvent&&this.detachEvent("ondragstart",g.dontstart)}},init:function(c){var f=c.data,h;if(!(f.which>0&&c.which!=f.which)){if(!d(c.target).is(f.not)){if(!(f.handle&&!d(c.target).closest(f.handle,c.currentTarget).length)){f.propagates=1;f.interactions=[g.interaction(this,f)];f.target=c.target;f.pageX=c.pageX;f.pageY=c.pageY;f.dragging=null;h=g.hijack(c,"draginit",f);if(f.propagates){if((h=g.flatten(h))&&h.length){f.interactions=[];d.each(h,function(){f.interactions.push(g.interaction(this,f))})}f.propagates=f.interactions.length;f.drop!==false&&b.drop&&b.drop.handler(c,f);g.textselect(false);a.add(document,"mousemove mouseup",g.handler,f);return false}}}}},interaction:function(c,f){return{drag:c,callback:new g.callback,droppable:[],offset:d(c)[f.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(c){var f=c.data;switch(c.type){case !f.dragging&&"mousemove":if(Math.pow(c.pageX-f.pageX,2)+Math.pow(c.pageY-f.pageY,2)<Math.pow(f.distance,2)){break}c.target=f.target;g.hijack(c,"dragstart",f);if(f.propagates){f.dragging=true}case"mousemove":if(f.dragging){g.hijack(c,"drag",f);if(f.propagates){f.drop!==false&&b.drop&&b.drop.handler(c,f);break}c.type="mouseup"}case"mouseup":a.remove(document,"mousemove mouseup",g.handler);if(f.dragging){f.drop!==false&&b.drop&&b.drop.handler(c,f);g.hijack(c,"dragend",f)}g.textselect(true);if(f.click===false&&f.dragging){jQuery.event.triggered=true;setTimeout(function(){jQuery.event.triggered=false},20);f.dragging=false}break}},delegate:function(c){var f=[],i,h=d.data(this,"events")||{};d.each(h.live||[],function(l,m){if(m.preType.indexOf("drag")===0){if(i=d(c.target).closest(m.selector,c.currentTarget)[0]){a.add(i,m.origType+"."+g.livekey,m.origHandler,m.data);d.inArray(i,f)<0&&f.push(i)}}});if(!f.length){return false}return d(f).bind("dragend."+g.livekey,function(){a.remove(this,"."+g.livekey)})},hijack:function(u,v,t,s,p){if(t){var q={event:u.originalEvent,type:u.type},f=v.indexOf("drop")?"drag":"drop",i,c=s||0,r,h;s=!isNaN(s)?s:t.interactions.length;u.type=v;u.originalEvent=null;t.results=[];do{if(r=t.interactions[c]){if(!(v!=="dragend"&&r.cancelled)){h=g.properties(u,t,r);r.results=[];d(p||r[f]||t.droppable).each(function(j,k){i=(h.target=k)?a.handle.call(k,u,h):null;if(i===false){if(f=="drag"){r.cancelled=true;t.propagates-=1}if(v=="drop"){r[f][j]=null}}else{if(v=="dropinit"){r.droppable.push(g.element(i)||k)}}if(v=="dragstart"){r.proxy=d(g.element(i)||r.drag)[0]}r.results.push(i);delete u.result;if(v!=="dropinit"){return i}});t.results[c]=g.flatten(r.results);if(v=="dropinit"){r.droppable=g.flatten(r.droppable)}v=="dragstart"&&!r.cancelled&&h.update()}}}while(++c<s);u.type=q.type;u.originalEvent=q.event;return g.flatten(t.results)}},properties:function(c,f,i){var h=i.callback;h.drag=i.drag;h.proxy=i.proxy||i.drag;h.startX=f.pageX;h.startY=f.pageY;h.deltaX=c.pageX-f.pageX;h.deltaY=c.pageY-f.pageY;h.originalX=i.offset.left;h.originalY=i.offset.top;h.offsetX=c.pageX-(f.pageX-h.originalX);h.offsetY=c.pageY-(f.pageY-h.originalY);h.drop=g.flatten((i.drop||[]).slice());h.available=g.flatten((i.droppable||[]).slice());return h},element:function(c){if(c&&(c.jquery||c.nodeType==1)){return c}},flatten:function(c){return d.map(c,function(f){return f&&f.jquery?d.makeArray(f):f&&f.length?g.flatten(f):f})},textselect:function(c){d(document)[c?"unbind":"bind"]("selectstart",g.dontstart).attr("unselectable",c?"off":"on").css("MozUserSelect",c?"":"none")},dontstart:function(){return false},callback:function(){}};g.callback.prototype={update:function(){b.drop&&this.available.length&&d.each(this.available,function(c){b.drop.locate(this,c)})}};b.draginit=b.dragstart=b.dragend=g})(jQuery);(function(d,b,h){var f=d.L,a={};a.version="0.7.2";if(typeof module==="object"&&typeof module.exports==="object"){module.exports=a}else{if(typeof define==="function"&&define.amd){define(a)}}a.noConflict=function(){d.L=f;return this};d.L=a;a.Util={extend:function(n){var m=Array.prototype.slice.call(arguments,1),o,l,k,p;for(l=0,k=m.length;l<k;l++){p=m[l]||{};for(o in p){if(p.hasOwnProperty(o)){n[o]=p[o]}}}return n},bind:function(j,k){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return j.apply(k,i||arguments)}},stamp:(function(){var j=0,i="_leaflet_id";return function(k){k[i]=k[i]||++j;return k[i]}}()),invokeEach:function(m,n,l){var k,j;if(typeof m==="object"){j=Array.prototype.slice.call(arguments,3);for(k in m){n.apply(l,[k,m[k]].concat(j))}return true}return false},limitExecByInterval:function(l,n,k){var j,m;return function i(){var o=arguments;if(j){m=true;return}j=true;setTimeout(function(){j=false;if(m){i.apply(k,o);m=false}},n);l.apply(k,o)}},falseFn:function(){return false},formatNum:function(i,k){var j=Math.pow(10,k||5);return Math.round(i*j)/j},trim:function(i){return i.trim?i.trim():i.replace(/^\s+|\s+$/g,"")},splitWords:function(i){return a.Util.trim(i).split(/\s+/)},setOptions:function(j,i){j.options=a.extend({},j.options,i);return j.options},getParamString:function(m,j,k){var n=[];for(var l in m){n.push(encodeURIComponent(k?l.toUpperCase():l)+"="+encodeURIComponent(m[l]))}return((!j||j.indexOf("?")===-1)?"?":"&")+n.join("&")},template:function(j,i){return j.replace(/\{ *([\w_]+) *\}/g,function(m,k){var l=i[k];if(l===h){throw new Error("No value provided for variable "+m)}else{if(typeof l==="function"){l=l(i)}}return l})},isArray:Array.isArray||function(i){return(Object.prototype.toString.call(i)==="[object Array]")},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function l(n){var o,p,q=["webkit","moz","o","ms"];for(o=0;o<q.length&&!p;o++){p=d[q[o]+n]}return p}var m=0;function j(n){var p=+new Date(),o=Math.max(0,16-(p-m));m=p+o;return d.setTimeout(n,o)}var i=d.requestAnimationFrame||l("RequestAnimationFrame")||j;var k=d.cancelAnimationFrame||l("CancelAnimationFrame")||l("CancelRequestAnimationFrame")||function(n){d.clearTimeout(n)};a.Util.requestAnimFrame=function(q,p,n,o){q=a.bind(q,p);if(n&&i===j){q()}else{return i.call(d,q,o)}};a.Util.cancelAnimFrame=function(n){if(n){k.call(d,n)}}}());a.extend=a.Util.extend;a.bind=a.Util.bind;a.stamp=a.Util.stamp;a.setOptions=a.Util.setOptions;a.Class=function(){};a.Class.extend=function(l){var o=function(){if(this.initialize){this.initialize.apply(this,arguments)}if(this._initHooks){this.callInitHooks()}};var n=function(){};n.prototype=this.prototype;var m=new n();m.constructor=o;o.prototype=m;for(var j in this){if(this.hasOwnProperty(j)&&j!=="prototype"){o[j]=this[j]}}if(l.statics){a.extend(o,l.statics);delete l.statics}if(l.includes){a.Util.extend.apply(null,[m].concat(l.includes));delete l.includes}if(l.options&&m.options){l.options=a.extend({},m.options,l.options)}a.extend(m,l);m._initHooks=[];var k=this;o.__super__=k.prototype;m.callInitHooks=function(){if(this._initHooksCalled){return}if(k.prototype.callInitHooks){k.prototype.callInitHooks.call(this)}this._initHooksCalled=true;for(var q=0,p=m._initHooks.length;q<p;q++){m._initHooks[q].call(this)}};return o};a.Class.include=function(i){a.extend(this.prototype,i)};a.Class.mergeOptions=function(i){a.extend(this.prototype.options,i)};a.Class.addInitHook=function(j){var i=Array.prototype.slice.call(arguments,1);var k=typeof j==="function"?j:function(){this[j].apply(this,i)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(k)};var g="_leaflet_events";a.Mixin={};a.Mixin.Events={addEventListener:function(o,t,k){if(a.Util.invokeEach(o,this.addEventListener,this,t,k)){return this}var u=this[g]=this[g]||{},n=k&&k!==this&&a.stamp(k),m,p,j,s,l,r,q;o=a.Util.splitWords(o);for(m=0,p=o.length;m<p;m++){j={action:t,context:k||this};s=o[m];if(n){l=s+"_idx";r=l+"_len";q=u[l]=u[l]||{};if(!q[n]){q[n]=[];u[r]=(u[r]||0)+1}q[n].push(j)}else{u[s]=u[s]||[];u[s].push(j)}}return this},hasEventListeners:function(j){var i=this[g];return !!i&&((j in i&&i[j].length>0)||(j+"_idx" in i&&i[j+"_idx_len"]>0))},removeEventListener:function(q,w,k){if(!this[g]){return this}if(!q){return this.clearAllEventListeners()}if(a.Util.invokeEach(q,this.removeEventListener,this,w,k)){return this}var x=this[g],o=k&&k!==this&&a.stamp(k),n,r,v,u,l,m,t,s,p;q=a.Util.splitWords(q);for(n=0,r=q.length;n<r;n++){v=q[n];m=v+"_idx";t=m+"_len";s=x[m];if(!w){delete x[v];delete x[m];delete x[t]}else{u=o&&s?s[o]:x[v];if(u){for(l=u.length-1;l>=0;l--){if((u[l].action===w)&&(!k||(u[l].context===k))){p=u.splice(l,1);p[0].action=a.Util.falseFn}}if(k&&s&&(u.length===0)){delete s[o];x[t]--}}}}return this},clearAllEventListeners:function(){delete this[g];return this},fireEvent:function(p,k){if(!this.hasEventListeners(p)){return this}var j=a.Util.extend({},k,{type:p,target:this});var r=this[g],q,l,n,o,m;if(r[p]){q=r[p].slice();for(l=0,n=q.length;l<n;l++){q[l].action.call(q[l].context,j)}}o=r[p+"_idx"];for(m in o){q=o[m].slice();if(q){for(l=0,n=q.length;l<n;l++){q[l].action.call(q[l].context,j)}}}return this},addOneTimeEventListener:function(j,l,i){if(a.Util.invokeEach(j,this.addOneTimeEventListener,this,l,i)){return this}var k=a.bind(function(){this.removeEventListener(j,l,i).removeEventListener(j,k,i)},this);return this.addEventListener(j,l,i).addEventListener(j,k,i)}};a.Mixin.Events.on=a.Mixin.Events.addEventListener;a.Mixin.Events.off=a.Mixin.Events.removeEventListener;a.Mixin.Events.once=a.Mixin.Events.addOneTimeEventListener;a.Mixin.Events.fire=a.Mixin.Events.fireEvent;(function(){var u="ActiveXObject" in d,z=u&&!b.addEventListener,y=navigator.userAgent.toLowerCase(),i=y.indexOf("webkit")!==-1,t=y.indexOf("chrome")!==-1,k=y.indexOf("phantom")!==-1,A=y.indexOf("android")!==-1,s=y.search("android [23]")!==-1,q=y.indexOf("gecko")!==-1,m=typeof orientation!==h+"",l=d.navigator&&d.navigator.msPointerEnabled&&d.navigator.msMaxTouchPoints&&!d.PointerEvent,v=(d.PointerEvent&&d.navigator.pointerEnabled&&d.navigator.maxTouchPoints)||l,j=("devicePixelRatio" in d&&d.devicePixelRatio>1)||("matchMedia" in d&&d.matchMedia("(min-resolution:144dpi)")&&d.matchMedia("(min-resolution:144dpi)").matches),B=b.documentElement,w=u&&("transition" in B.style),r=("WebKitCSSMatrix" in d)&&("m11" in new d.WebKitCSSMatrix())&&!s,o="MozPerspective" in B.style,x="OTransition" in B.style,p=!d.L_DISABLE_3D&&(w||r||o||x)&&!k;var n=!d.L_NO_TOUCH&&!k&&(function(){var D="ontouchstart";if(v||(D in B)){return true}var E=b.createElement("div"),C=false;if(!E.setAttribute){return false}E.setAttribute(D,"return;");if(typeof E[D]==="function"){C=true}E.removeAttribute(D);E=null;return C}());a.Browser={ie:u,ielt9:z,webkit:i,gecko:q&&!i&&!d.opera&&!u,android:A,android23:s,chrome:t,ie3d:w,webkit3d:r,gecko3d:o,opera3d:x,any3d:p,mobile:m,mobileWebkit:m&&i,mobileWebkit3d:m&&r,mobileOpera:m&&d.opera,touch:n,msPointer:l,pointer:v,retina:j}}());a.Point=function(i,k,j){this.x=(j?Math.round(i):i);this.y=(j?Math.round(k):k)};a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},add:function(i){return this.clone()._add(a.point(i))},_add:function(i){this.x+=i.x;this.y+=i.y;return this},subtract:function(i){return this.clone()._subtract(a.point(i))},_subtract:function(i){this.x-=i.x;this.y-=i.y;return this},divideBy:function(i){return this.clone()._divideBy(i)},_divideBy:function(i){this.x/=i;this.y/=i;return this},multiplyBy:function(i){return this.clone()._multiplyBy(i)},_multiplyBy:function(i){this.x*=i;this.y*=i;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},distanceTo:function(j){j=a.point(j);var i=j.x-this.x,k=j.y-this.y;return Math.sqrt(i*i+k*k)},equals:function(i){i=a.point(i);return i.x===this.x&&i.y===this.y},contains:function(i){i=a.point(i);return Math.abs(i.x)<=Math.abs(this.x)&&Math.abs(i.y)<=Math.abs(this.y)},toString:function(){return"Point("+a.Util.formatNum(this.x)+", "+a.Util.formatNum(this.y)+")"}};a.point=function(i,k,j){if(i instanceof a.Point){return i}if(a.Util.isArray(i)){return new a.Point(i[0],i[1])}if(i===h||i===null){return i}return new a.Point(i,k,j)};a.Bounds=function(l,k){if(!l){return}var n=k?[l,k]:l;for(var m=0,j=n.length;m<j;m++){this.extend(n[m])}};a.Bounds.prototype={extend:function(i){i=a.point(i);if(!this.min&&!this.max){this.min=i.clone();this.max=i.clone()}else{this.min.x=Math.min(i.x,this.min.x);this.max.x=Math.max(i.x,this.max.x);this.min.y=Math.min(i.y,this.min.y);this.max.y=Math.max(i.y,this.max.y)}return this},getCenter:function(i){return new a.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,i)},getBottomLeft:function(){return new a.Point(this.min.x,this.max.y)},getTopRight:function(){return new a.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(k){var j,i;if(typeof k[0]==="number"||k instanceof a.Point){k=a.point(k)}else{k=a.bounds(k)}if(k instanceof a.Bounds){j=k.min;i=k.max}else{j=i=k}return(j.x>=this.min.x)&&(i.x<=this.max.x)&&(j.y>=this.min.y)&&(i.y<=this.max.y)},intersects:function(n){n=a.bounds(n);var l=this.min,i=this.max,m=n.min,j=n.max,k=(j.x>=l.x)&&(m.x<=i.x),o=(j.y>=l.y)&&(m.y<=i.y);return k&&o},isValid:function(){return !!(this.min&&this.max)}};a.bounds=function(j,i){if(!j||j instanceof a.Bounds){return j}return new a.Bounds(j,i)};a.Transformation=function(j,i,l,k){this._a=j;this._b=i;this._c=l;this._d=k};a.Transformation.prototype={transform:function(i,j){return this._transform(i.clone(),j)},_transform:function(i,j){j=j||1;i.x=j*(this._a*i.x+this._b);i.y=j*(this._c*i.y+this._d);return i},untransform:function(i,j){j=j||1;return new a.Point((i.x/j-this._b)/this._a,(i.y/j-this._d)/this._c)}};a.DomUtil={get:function(i){return(typeof i==="string"?b.getElementById(i):i)},getStyle:function(k,j){var l=k.style[j];if(!l&&k.currentStyle){l=k.currentStyle[j]}if((!l||l==="auto")&&b.defaultView){var i=b.defaultView.getComputedStyle(k,null);l=i?i[j]:null}return l==="auto"?null:l},getViewportOffset:function(n){var q=0,m=0,l=n,o=b.body,k=b.documentElement,p;do{q+=l.offsetTop||0;m+=l.offsetLeft||0;q+=parseInt(a.DomUtil.getStyle(l,"borderTopWidth"),10)||0;m+=parseInt(a.DomUtil.getStyle(l,"borderLeftWidth"),10)||0;p=a.DomUtil.getStyle(l,"position");if(l.offsetParent===o&&p==="absolute"){break}if(p==="fixed"){q+=o.scrollTop||k.scrollTop||0;m+=o.scrollLeft||k.scrollLeft||0;break}if(p==="relative"&&!l.offsetLeft){var j=a.DomUtil.getStyle(l,"width"),s=a.DomUtil.getStyle(l,"max-width"),i=l.getBoundingClientRect();if(j!=="none"||s!=="none"){m+=i.left+l.clientLeft}q+=i.top+(o.scrollTop||k.scrollTop||0);break}l=l.offsetParent}while(l);l=n;do{if(l===o){break}q-=l.scrollTop||0;m-=l.scrollLeft||0;l=l.parentNode}while(l);return new a.Point(m,q)},documentIsLtr:function(){if(!a.DomUtil._docIsLtrCached){a.DomUtil._docIsLtrCached=true;a.DomUtil._docIsLtr=a.DomUtil.getStyle(b.body,"direction")==="ltr"}return a.DomUtil._docIsLtr},create:function(j,l,i){var k=b.createElement(j);k.className=l;if(i){i.appendChild(k)}return k},hasClass:function(k,i){if(k.classList!==h){return k.classList.contains(i)}var j=a.DomUtil._getClass(k);return j.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(j)},addClass:function(o,k){if(o.classList!==h){var m=a.Util.splitWords(k);for(var l=0,j=m.length;l<j;l++){o.classList.add(m[l])}}else{if(!a.DomUtil.hasClass(o,k)){var n=a.DomUtil._getClass(o);a.DomUtil._setClass(o,(n?n+" ":"")+k)}}},removeClass:function(j,i){if(j.classList!==h){j.classList.remove(i)}else{a.DomUtil._setClass(j,a.Util.trim((" "+a.DomUtil._getClass(j)+" ").replace(" "+i+" "," ")))}},_setClass:function(j,i){if(j.className.baseVal===h){j.className=i}else{j.className.baseVal=i}},_getClass:function(i){return i.className.baseVal===h?i.className:i.className.baseVal},setOpacity:function(k,l){if("opacity" in k.style){k.style.opacity=l}else{if("filter" in k.style){var j=false,i="DXImageTransform.Microsoft.Alpha";try{j=k.filters.item(i)}catch(m){if(l===1){return}}l=Math.round(l*100);if(j){j.Enabled=(l!==100);j.Opacity=l}else{k.style.filter+=" progid:"+i+"(opacity="+l+")"}}}},testProp:function(l){var k=b.documentElement.style;for(var j=0;j<l.length;j++){if(l[j] in k){return l[j]}}return false},getTranslateString:function(i){var k=a.Browser.webkit3d,j="translate"+(k?"3d":"")+"(",l=(k?",0":"")+")";return j+i.x+"px,"+i.y+"px"+l},getScaleString:function(k,i){var l=a.DomUtil.getTranslateString(i.add(i.multiplyBy(-1*k))),j=" scale("+k+") ";return l+j},setPosition:function(k,i,j){k._leaflet_pos=i;if(!j&&a.Browser.any3d){k.style[a.DomUtil.TRANSFORM]=a.DomUtil.getTranslateString(i)}else{k.style.left=i.x+"px";k.style.top=i.y+"px"}},getPosition:function(i){return i._leaflet_pos}};a.DomUtil.TRANSFORM=a.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);a.DomUtil.TRANSITION=a.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);a.DomUtil.TRANSITION_END=a.DomUtil.TRANSITION==="webkitTransition"||a.DomUtil.TRANSITION==="OTransition"?a.DomUtil.TRANSITION+"End":"transitionend";(function(){if("onselectstart" in b){a.extend(a.DomUtil,{disableTextSelection:function(){a.DomEvent.on(d,"selectstart",a.DomEvent.preventDefault)},enableTextSelection:function(){a.DomEvent.off(d,"selectstart",a.DomEvent.preventDefault)}})}else{var i=a.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);a.extend(a.DomUtil,{disableTextSelection:function(){if(i){var j=b.documentElement.style;this._userSelect=j[i];j[i]="none"}},enableTextSelection:function(){if(i){b.documentElement.style[i]=this._userSelect;delete this._userSelect}}})}a.extend(a.DomUtil,{disableImageDrag:function(){a.DomEvent.on(d,"dragstart",a.DomEvent.preventDefault)},enableImageDrag:function(){a.DomEvent.off(d,"dragstart",a.DomEvent.preventDefault)}})})();a.LatLng=function(k,i,j){k=parseFloat(k);i=parseFloat(i);if(isNaN(k)||isNaN(i)){throw new Error("Invalid LatLng object: ("+k+", "+i+")")}this.lat=k;this.lng=i;if(j!==h){this.alt=parseFloat(j)}};a.extend(a.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9});a.LatLng.prototype={equals:function(j){if(!j){return false}j=a.latLng(j);var i=Math.max(Math.abs(this.lat-j.lat),Math.abs(this.lng-j.lng));return i<=a.LatLng.MAX_MARGIN},toString:function(i){return"LatLng("+a.Util.formatNum(this.lat,i)+", "+a.Util.formatNum(this.lng,i)+")"},distanceTo:function(p){p=a.latLng(p);var o=6378137,l=a.LatLng.DEG_TO_RAD,q=(p.lat-this.lat)*l,i=(p.lng-this.lng)*l,n=this.lat*l,k=p.lat*l,m=Math.sin(q/2),j=Math.sin(i/2);var r=m*m+j*j*Math.cos(n)*Math.cos(k);return o*2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))},wrap:function(j,i){var k=this.lng;j=j||-180;i=i||180;k=(k+i)%(i-j)+(k<j||k===i?i:j);return new a.LatLng(this.lat,k)}};a.latLng=function(j,i){if(j instanceof a.LatLng){return j}if(a.Util.isArray(j)){if(typeof j[0]==="number"||typeof j[0]==="string"){return new a.LatLng(j[0],j[1],j[2])}else{return null}}if(j===h||j===null){return j}if(typeof j==="object"&&"lat" in j){return new a.LatLng(j.lat,"lng" in j?j.lng:j.lon)}if(i===h){return null}return new a.LatLng(j,i)};a.LatLngBounds=function(n,l){if(!n){return}var k=l?[n,l]:n;for(var m=0,j=k.length;m<j;m++){this.extend(k[m])}};a.LatLngBounds.prototype={extend:function(j){if(!j){return this}var i=a.latLng(j);if(i!==null){j=i}else{j=a.latLngBounds(j)}if(j instanceof a.LatLng){if(!this._southWest&&!this._northEast){this._southWest=new a.LatLng(j.lat,j.lng);this._northEast=new a.LatLng(j.lat,j.lng)}else{this._southWest.lat=Math.min(j.lat,this._southWest.lat);this._southWest.lng=Math.min(j.lng,this._southWest.lng);this._northEast.lat=Math.max(j.lat,this._northEast.lat);this._northEast.lng=Math.max(j.lng,this._northEast.lng)}}else{if(j instanceof a.LatLngBounds){this.extend(j._southWest);this.extend(j._northEast)}}return this},pad:function(l){var j=this._southWest,m=this._northEast,i=Math.abs(j.lat-m.lat)*l,k=Math.abs(j.lng-m.lng)*l;return new a.LatLngBounds(new a.LatLng(j.lat-i,j.lng-k),new a.LatLng(m.lat+i,m.lng+k))},getCenter:function(){return new a.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new a.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new a.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(m){if(typeof m[0]==="number"||m instanceof a.LatLng){m=a.latLng(m)}else{m=a.latLngBounds(m)}var i=this._southWest,l=this._northEast,j,k;if(m instanceof a.LatLngBounds){j=m.getSouthWest();k=m.getNorthEast()}else{j=k=m}return(j.lat>=i.lat)&&(k.lat<=l.lat)&&(j.lng>=i.lng)&&(k.lng<=l.lng)},intersects:function(l){l=a.latLngBounds(l);var i=this._southWest,o=this._northEast,j=l.getSouthWest(),n=l.getNorthEast(),m=(n.lat>=i.lat)&&(j.lat<=o.lat),k=(n.lng>=i.lng)&&(j.lng<=o.lng);return m&&k},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(i){if(!i){return false}i=a.latLngBounds(i);return this._southWest.equals(i.getSouthWest())&&this._northEast.equals(i.getNorthEast())},isValid:function(){return !!(this._southWest&&this._northEast)}};a.latLngBounds=function(j,i){if(!j||j instanceof a.LatLngBounds){return j}return new a.LatLngBounds(j,i)};a.Projection={};a.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(n){var l=a.LatLng.DEG_TO_RAD,j=this.MAX_LATITUDE,k=Math.max(Math.min(j,n.lat),-j),i=n.lng*l,m=k*l;m=Math.log(Math.tan((Math.PI/4)+(m/2)));return new a.Point(i,m)},unproject:function(i){var l=a.LatLng.RAD_TO_DEG,j=i.x*l,k=(2*Math.atan(Math.exp(i.y))-(Math.PI/2))*l;return new a.LatLng(k,j)}};a.Projection.LonLat={project:function(i){return new a.Point(i.lng,i.lat)},unproject:function(i){return new a.LatLng(i.y,i.x)}};a.CRS={latLngToPoint:function(l,j){var i=this.projection.project(l),k=this.scale(j);return this.transformation._transform(i,k)},pointToLatLng:function(i,k){var l=this.scale(k),j=this.transformation.untransform(i,l);return this.projection.unproject(j)},project:function(i){return this.projection.project(i)},scale:function(i){return 256*Math.pow(2,i)},getSize:function(j){var i=this.scale(j);return a.point(i,i)}};a.CRS.Simple=a.extend({},a.CRS,{projection:a.Projection.LonLat,transformation:new a.Transformation(1,0,-1,0),scale:function(i){return Math.pow(2,i)}});a.CRS.EPSG3857=a.extend({},a.CRS,{code:"EPSG:3857",projection:a.Projection.SphericalMercator,transformation:new a.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(k){var j=this.projection.project(k),i=6378137;return j.multiplyBy(i)}});a.CRS.EPSG900913=a.extend({},a.CRS.EPSG3857,{code:"EPSG:900913"});a.CRS.EPSG4326=a.extend({},a.CRS,{code:"EPSG:4326",projection:a.Projection.LonLat,transformation:new a.Transformation(1/360,0.5,-1/360,0.5)});a.Map=a.Class.extend({includes:a.Mixin.Events,options:{crs:a.CRS.EPSG3857,fadeAnimation:a.DomUtil.TRANSITION&&!a.Browser.android23,trackResize:true,markerZoomAnimation:a.DomUtil.TRANSITION&&a.Browser.any3d},initialize:function(j,i){i=a.setOptions(this,i);this._initContainer(j);this._initLayout();this._onResize=a.bind(this._onResize,this);this._initEvents();if(i.maxBounds){this.setMaxBounds(i.maxBounds)}if(i.center&&i.zoom!==h){this.setView(a.latLng(i.center),i.zoom,{reset:true})}this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(i.layers)},setView:function(i,j){j=j===h?this.getZoom():j;this._resetView(a.latLng(i),this._limitZoom(j));return this},setZoom:function(j,i){if(!this._loaded){this._zoom=this._limitZoom(j);return this}return this.setView(this.getCenter(),j,{zoom:i})},zoomIn:function(j,i){return this.setZoom(this._zoom+(j||1),i)},zoomOut:function(j,i){return this.setZoom(this._zoom-(j||1),i)},setZoomAround:function(p,n,m){var o=this.getZoomScale(n),l=this.getSize().divideBy(2),k=p instanceof a.Point?p:this.latLngToContainerPoint(p),i=k.subtract(l).multiplyBy(1-1/o),j=this.containerPointToLatLng(l.add(i));return this.setView(j,n,{zoom:m})},fitBounds:function(j,q){q=q||{};j=j.getBounds?j.getBounds():a.latLngBounds(j);var l=a.point(q.paddingTopLeft||q.padding||[0,0]),k=a.point(q.paddingBottomRight||q.padding||[0,0]),p=this.getBoundsZoom(j,false,l.add(k)),n=k.subtract(l).divideBy(2),o=this.project(j.getSouthWest(),p),m=this.project(j.getNorthEast(),p),i=this.unproject(o.add(m).divideBy(2).add(n),p);p=q&&q.maxZoom?Math.min(q.maxZoom,p):p;return this.setView(i,p,q)},fitWorld:function(i){return this.fitBounds([[-90,-180],[90,180]],i)},panTo:function(i,j){return this.setView(i,this._zoom,{pan:j})},panBy:function(i){this.fire("movestart");this._rawPanBy(a.point(i));this.fire("move");return this.fire("moveend")},setMaxBounds:function(i){i=a.latLngBounds(i);this.options.maxBounds=i;if(!i){return this.off("moveend",this._panInsideMaxBounds,this)}if(this._loaded){this._panInsideMaxBounds()}return this.on("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(l,k){var i=this.getCenter(),j=this._limitCenter(i,this._zoom,l);if(i.equals(j)){return this}return this.panTo(j,k)},addLayer:function(i){var j=a.stamp(i);if(this._layers[j]){return this}this._layers[j]=i;if(i.options&&(!isNaN(i.options.maxZoom)||!isNaN(i.options.minZoom))){this._zoomBoundLayers[j]=i;this._updateZoomLevels()}if(this.options.zoomAnimation&&a.TileLayer&&(i instanceof a.TileLayer)){this._tileLayersNum++;this._tileLayersToLoad++;i.on("load",this._onTileLayerLoad,this)}if(this._loaded){this._layerAdd(i)}return this},removeLayer:function(i){var j=a.stamp(i);if(!this._layers[j]){return this}if(this._loaded){i.onRemove(this)}delete this._layers[j];if(this._loaded){this.fire("layerremove",{layer:i})}if(this._zoomBoundLayers[j]){delete this._zoomBoundLayers[j];this._updateZoomLevels()}if(this.options.zoomAnimation&&a.TileLayer&&(i instanceof a.TileLayer)){this._tileLayersNum--;this._tileLayersToLoad--;i.off("load",this._onTileLayerLoad,this)}return this},hasLayer:function(i){if(!i){return false}return(a.stamp(i) in this._layers)},eachLayer:function(l,k){for(var j in this._layers){l.call(k,this._layers[j])}return this},invalidateSize:function(k){if(!this._loaded){return this}k=a.extend({animate:false,pan:true},k===true?{animate:true}:k);var l=this.getSize();this._sizeChanged=true;this._initialCenter=null;var j=this.getSize(),n=l.divideBy(2).round(),i=j.divideBy(2).round(),m=n.subtract(i);if(!m.x&&!m.y){return this}if(k.animate&&k.pan){this.panBy(m)}else{if(k.pan){this._rawPanBy(m)}this.fire("move");if(k.debounceMoveend){clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(a.bind(this.fire,this,"moveend"),200)}else{this.fire("moveend")}}return this.fire("resize",{oldSize:l,newSize:j})},addHandler:function(i,k){if(!k){return this}var j=this[i]=new k(this);this._handlers.push(j);if(this.options[i]){j.enable()}return this},remove:function(){if(this._loaded){this.fire("unload")}this._initEvents("off");try{delete this._container._leaflet}catch(i){this._container._leaflet=h}this._clearPanes();if(this._clearControlPos){this._clearControlPos()}this._clearHandlers();return this},getCenter:function(){this._checkIfLoaded();if(this._initialCenter&&!this._moved()){return this._initialCenter}return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var j=this.getPixelBounds(),i=this.unproject(j.getBottomLeft()),k=this.unproject(j.getTopRight());return new a.LatLngBounds(i,k)},getMinZoom:function(){return this.options.minZoom===h?(this._layersMinZoom===h?0:this._layersMinZoom):this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===h?(this._layersMaxZoom===h?Infinity:this._layersMaxZoom):this.options.maxZoom},getBoundsZoom:function(i,j,n){i=a.latLngBounds(i);var p=this.getMinZoom()-(j?1:0),o=this.getMaxZoom(),r=this.getSize(),l=i.getNorthWest(),m=i.getSouthEast(),k=true,q;n=a.point(n||[0,0]);do{p++;q=this.project(m,p).subtract(this.project(l,p)).add(n);k=!j?r.contains(q):q.x<r.x||q.y<r.y}while(k&&p<=o);if(k&&j){return null}return j?p:p-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new a.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=false}return this._size.clone()},getPixelBounds:function(){var i=this._getTopLeftPoint();return new a.Bounds(i,i.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(j){var i=this.options.crs;return i.scale(j)/i.scale(this._zoom)},getScaleZoom:function(i){return this._zoom+(Math.log(i)/Math.LN2)},project:function(j,i){i=i===h?this._zoom:i;return this.options.crs.latLngToPoint(a.latLng(j),i)},unproject:function(i,j){j=j===h?this._zoom:j;return this.options.crs.pointToLatLng(a.point(i),j)},layerPointToLatLng:function(i){var j=a.point(i).add(this.getPixelOrigin());return this.unproject(j)},latLngToLayerPoint:function(j){var i=this.project(a.latLng(j))._round();return i._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(i){return a.point(i).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(i){return a.point(i).add(this._getMapPanePos())},containerPointToLatLng:function(i){var j=this.containerPointToLayerPoint(a.point(i));return this.layerPointToLatLng(j)},latLngToContainerPoint:function(i){return this.layerPointToContainerPoint(this.latLngToLayerPoint(a.latLng(i)))},mouseEventToContainerPoint:function(i){return a.DomEvent.getMousePosition(i,this._container)},mouseEventToLayerPoint:function(i){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(i))},mouseEventToLatLng:function(i){return this.layerPointToLatLng(this.mouseEventToLayerPoint(i))},_initContainer:function(j){var i=this._container=a.DomUtil.get(j);if(!i){throw new Error("Map container not found.")}else{if(i._leaflet){throw new Error("Map container is already initialized.")}}i._leaflet=true},_initLayout:function(){var j=this._container;a.DomUtil.addClass(j,"leaflet-container"+(a.Browser.touch?" leaflet-touch":"")+(a.Browser.retina?" leaflet-retina":"")+(a.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var i=a.DomUtil.getStyle(j,"position");if(i!=="absolute"&&i!=="relative"&&i!=="fixed"){j.style.position="relative"}this._initPanes();if(this._initControlPos){this._initControlPos()}},_initPanes:function(){var j=this._panes={};this._mapPane=j.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=j.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);j.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);j.shadowPane=this._createPane("leaflet-shadow-pane");j.overlayPane=this._createPane("leaflet-overlay-pane");j.markerPane=this._createPane("leaflet-marker-pane");j.popupPane=this._createPane("leaflet-popup-pane");var i=" leaflet-zoom-hide";if(!this.options.markerZoomAnimation){a.DomUtil.addClass(j.markerPane,i);a.DomUtil.addClass(j.shadowPane,i);a.DomUtil.addClass(j.popupPane,i)}},_createPane:function(j,i){return a.DomUtil.create("div",j,i||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(l){l=l?(a.Util.isArray(l)?l:[l]):[];for(var k=0,j=l.length;k<j;k++){this.addLayer(l[k])}},_resetView:function(k,m,j,l){var i=(this._zoom!==m);if(!l){this.fire("movestart");if(i){this.fire("zoomstart")}}this._zoom=m;this._initialCenter=k;this._initialTopLeftPoint=this._getNewTopLeftPoint(k);if(!j){a.DomUtil.setPosition(this._mapPane,new a.Point(0,0))}else{this._initialTopLeftPoint._add(this._getMapPanePos())}this._tileLayersToLoad=this._tileLayersNum;var n=!this._loaded;this._loaded=true;if(n){this.fire("load");this.eachLayer(this._layerAdd,this)}this.fire("viewreset",{hard:!j});this.fire("move");if(i||l){this.fire("zoomend")}this.fire("moveend",{hard:!j})},_rawPanBy:function(i){a.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(i))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var l,n=Infinity,j=-Infinity,m=this._getZoomSpan();for(l in this._zoomBoundLayers){var k=this._zoomBoundLayers[l];if(!isNaN(k.options.minZoom)){n=Math.min(n,k.options.minZoom)}if(!isNaN(k.options.maxZoom)){j=Math.max(j,k.options.maxZoom)}}if(l===h){this._layersMaxZoom=this._layersMinZoom=h}else{this._layersMaxZoom=j;this._layersMinZoom=n}if(m!==this._getZoomSpan()){this.fire("zoomlevelschange")}},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.")}},_initEvents:function(k){if(!a.DomEvent){return}k=k||"on";a.DomEvent[k](this._container,"click",this._onMouseClick,this);var m=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"],l,j;for(l=0,j=m.length;l<j;l++){a.DomEvent[k](this._container,m[l],this._fireMouseEvent,this)}if(this.options.trackResize){a.DomEvent[k](d,"resize",this._onResize,this)}},_onResize:function(){a.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=a.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:true})},this,false,this._container)},_onMouseClick:function(i){if(!this._loaded||(!i._simulated&&((this.dragging&&this.dragging.moved())||(this.boxZoom&&this.boxZoom.moved())))||a.DomEvent._skipped(i)){return}this.fire("preclick");this._fireMouseEvent(i)},_fireMouseEvent:function(l){if(!this._loaded||a.DomEvent._skipped(l)){return}var k=l.type;k=(k==="mouseenter"?"mouseover":(k==="mouseleave"?"mouseout":k));if(!this.hasEventListeners(k)){return}if(k==="contextmenu"){a.DomEvent.preventDefault(l)}var j=this.mouseEventToContainerPoint(l),i=this.containerPointToLayerPoint(j),m=this.layerPointToLatLng(i);this.fire(k,{latlng:m,layerPoint:i,containerPoint:j,originalEvent:l})},_onTileLayerLoad:function(){this._tileLayersToLoad--;if(this._tileLayersNum&&!this._tileLayersToLoad){this.fire("tilelayersload")}},_clearHandlers:function(){for(var k=0,j=this._handlers.length;k<j;k++){this._handlers[k].disable()}},whenReady:function(j,i){if(this._loaded){j.call(i||this,this)}else{this.on("load",j,i)}return this},_layerAdd:function(i){i.onAdd(this);this.fire("layeradd",{layer:i})},_getMapPanePos:function(){return a.DomUtil.getPosition(this._mapPane)},_moved:function(){var i=this._getMapPanePos();return i&&!i.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(i,k){var j=this.getSize()._divideBy(2);return this.project(i,k)._subtract(j)._round()},_latLngToNewLayerPoint:function(l,j,i){var k=this._getNewTopLeftPoint(i,j).add(this._getMapPanePos());return this.project(l,j)._subtract(k)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(i){return this.latLngToLayerPoint(i).subtract(this._getCenterLayerPoint())},_limitCenter:function(i,l,k){if(!k){return i}var o=this.project(i,l),j=this.getSize().divideBy(2),m=new a.Bounds(o.subtract(j),o.add(j)),n=this._getBoundsOffset(m,k,l);return this.unproject(o.add(n),l)},_limitOffset:function(l,i){if(!i){return l}var k=this.getPixelBounds(),j=new a.Bounds(k.min.add(l),k.max.add(l));return l.add(this._getBoundsOffset(j,i))},_getBoundsOffset:function(l,j,n){var m=this.project(j.getNorthWest(),n).subtract(l.min),o=this.project(j.getSouthEast(),n).subtract(l.max),k=this._rebound(m.x,-o.x),i=this._rebound(m.y,-o.y);return new a.Point(k,i)},_rebound:function(j,i){return j+i>0?Math.round(j-i)/2:Math.max(0,Math.ceil(j))-Math.max(0,Math.floor(i))},_limitZoom:function(k){var j=this.getMinZoom(),i=this.getMaxZoom();return Math.max(j,Math.min(i,k))}});a.map=function(j,i){return new a.Map(j,i)};a.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(k){var p=a.LatLng.DEG_TO_RAD,t=this.MAX_LATITUDE,q=Math.max(Math.min(t,k.lat),-t),i=this.R_MAJOR,l=this.R_MINOR,u=k.lng*p*i,s=q*p,n=l/i,m=Math.sqrt(1-n*n),j=m*Math.sin(s);j=Math.pow((1-j)/(1+j),m*0.5);var o=Math.tan(0.5*((Math.PI*0.5)-s))/j;s=-i*Math.log(o);return new a.Point(u,s)},unproject:function(w){var t=a.LatLng.RAD_TO_DEG,j=this.R_MAJOR,l=this.R_MINOR,v=w.x*t/j,p=l/j,m=Math.sqrt(1-(p*p)),u=Math.exp(-w.y/j),s=(Math.PI/2)-2*Math.atan(u),n=15,x=1e-7,o=n,q=0.1,k;while((Math.abs(q)>x)&&(--o>0)){k=m*Math.sin(s);q=(Math.PI/2)-2*Math.atan(u*Math.pow((1-k)/(1+k),0.5*m))-s;s+=q}return new a.LatLng(s*t,v)}};a.CRS.EPSG3395=a.extend({},a.CRS,{code:"EPSG:3395",projection:a.Projection.Mercator,transformation:(function(){var i=a.Projection.Mercator,j=i.R_MAJOR,k=0.5/(Math.PI*j);return new a.Transformation(k,0.5,-k,0.5)}())});a.TileLayer=a.Class.extend({includes:a.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:a.Browser.mobile,updateWhenIdle:a.Browser.mobile},initialize:function(k,j){j=a.setOptions(this,j);if(j.detectRetina&&a.Browser.retina&&j.maxZoom>0){j.tileSize=Math.floor(j.tileSize/2);j.zoomOffset++;if(j.minZoom>0){j.minZoom--}this.options.maxZoom--}if(j.bounds){j.bounds=a.latLngBounds(j.bounds)}this._url=k;var i=this.options.subdomains;if(typeof i==="string"){this.options.subdomains=i.split("")}},onAdd:function(i){this._map=i;this._animated=i._zoomAnimated;this._initContainer();i.on({viewreset:this._reset,moveend:this._update},this);if(this._animated){i.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){this._limitedUpdate=a.Util.limitExecByInterval(this._update,150,this);i.on("move",this._limitedUpdate,this)}this._reset();this._update()},addTo:function(i){i.addLayer(this);return this},onRemove:function(i){this._container.parentNode.removeChild(this._container);i.off({viewreset:this._reset,moveend:this._update},this);if(this._animated){i.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){i.off("move",this._limitedUpdate,this)}this._container=null;this._map=null},bringToFront:function(){var i=this._map._panes.tilePane;if(this._container){i.appendChild(this._container);this._setAutoZIndex(i,Math.max)}return this},bringToBack:function(){var i=this._map._panes.tilePane;if(this._container){i.insertBefore(this._container,i.firstChild);this._setAutoZIndex(i,Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(i){this.options.opacity=i;if(this._map){this._updateOpacity()}return this},setZIndex:function(i){this.options.zIndex=i;this._updateZIndex();return this},setUrl:function(i,j){this._url=i;if(!j){this.redraw()}return this},redraw:function(){if(this._map){this._reset({hard:true});this._update()}return this},_updateZIndex:function(){if(this._container&&this.options.zIndex!==h){this._container.style.zIndex=this.options.zIndex}},_setAutoZIndex:function(p,m){var n=p.children,l=-m(Infinity,-Infinity),o,k,j;for(k=0,j=n.length;k<j;k++){if(n[k]!==this._container){o=parseInt(n[k].style.zIndex,10);if(!isNaN(o)){l=m(l,o)}}}this.options.zIndex=this._container.style.zIndex=(isFinite(l)?l:0)+m(1,-1)},_updateOpacity:function(){var k,j=this._tiles;if(a.Browser.ielt9){for(k in j){a.DomUtil.setOpacity(j[k],this.options.opacity)}}else{a.DomUtil.setOpacity(this._container,this.options.opacity)}},_initContainer:function(){var i=this._map._panes.tilePane;if(!this._container){this._container=a.DomUtil.create("div","leaflet-layer");this._updateZIndex();if(this._animated){var j="leaflet-tile-container";this._bgBuffer=a.DomUtil.create("div",j,this._container);this._tileContainer=a.DomUtil.create("div",j,this._container)}else{this._tileContainer=this._container}i.appendChild(this._container);if(this.options.opacity<1){this._updateOpacity()}}},_reset:function(j){for(var i in this._tiles){this.fire("tileunload",{tile:this._tiles[i]})}this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles){this._unusedTiles=[]}this._tileContainer.innerHTML="";if(this._animated&&j&&j.hard){this._clearBgBuffer()}this._initContainer()},_getTileSize:function(){var l=this._map,j=l.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,k=this.options.tileSize;if(i&&j>i){k=Math.round(l.getZoomScale(j)/l.getZoomScale(i)*k)}return k},_update:function(){if(!this._map){return}var m=this._map,j=m.getPixelBounds(),i=m.getZoom(),k=this._getTileSize();if(i>this.options.maxZoom||i<this.options.minZoom){return}var l=a.bounds(j.min.divideBy(k)._floor(),j.max.divideBy(k)._floor());this._addTilesFromCenterOut(l);if(this.options.unloadInvisibleTiles||this.options.reuseTiles){this._removeOtherTiles(l)}},_addTilesFromCenterOut:function(q){var m=[],l=q.getCenter();var o,p,k;for(o=q.min.y;o<=q.max.y;o++){for(p=q.min.x;p<=q.max.x;p++){k=new a.Point(p,o);if(this._tileShouldBeLoaded(k)){m.push(k)}}}var r=m.length;if(r===0){return}m.sort(function(j,i){return j.distanceTo(l)-i.distanceTo(l)});var n=b.createDocumentFragment();if(!this._tilesToLoad){this.fire("loading")}this._tilesToLoad+=r;for(p=0;p<r;p++){this._addTile(m[p],n)}this._tileContainer.appendChild(n)},_tileShouldBeLoaded:function(n){if((n.x+":"+n.y) in this._tiles){return false}var m=this.options;if(!m.continuousWorld){var k=this._getWrapTileNum();if((m.noWrap&&(n.x<0||n.x>=k.x))||n.y<0||n.y>=k.y){return false}}if(m.bounds){var p=m.tileSize,l=n.multiplyBy(p),i=l.add([p,p]),j=this._map.unproject(l),o=this._map.unproject(i);if(!m.continuousWorld&&!m.noWrap){j=j.wrap();o=o.wrap()}if(!m.bounds.intersects([j,o])){return false}}return true},_removeOtherTiles:function(l){var k,i,m,j;for(j in this._tiles){k=j.split(":");i=parseInt(k[0],10);m=parseInt(k[1],10);if(i<l.min.x||i>l.max.x||m<l.min.y||m>l.max.y){this._removeTile(j)}}},_removeTile:function(i){var j=this._tiles[i];this.fire("tileunload",{tile:j,url:j.src});if(this.options.reuseTiles){a.DomUtil.removeClass(j,"leaflet-tile-loaded");this._unusedTiles.push(j)}else{if(j.parentNode===this._tileContainer){this._tileContainer.removeChild(j)}}if(!a.Browser.android){j.onload=null;j.src=a.Util.emptyImageUrl}delete this._tiles[i]},_addTile:function(k,i){var j=this._getTilePos(k);var l=this._getTile();a.DomUtil.setPosition(l,j,a.Browser.chrome);this._tiles[k.x+":"+k.y]=l;this._loadTile(l,k);if(l.parentNode!==this._tileContainer){i.appendChild(l)}},_getZoomForUrl:function(){var i=this.options,j=this._map.getZoom();if(i.zoomReverse){j=i.maxZoom-j}j+=i.zoomOffset;return i.maxNativeZoom?Math.min(j,i.maxNativeZoom):j},_getTilePos:function(j){var i=this._map.getPixelOrigin(),k=this._getTileSize();return j.multiplyBy(k).subtract(i)},getTileUrl:function(i){return a.Util.template(this._url,a.extend({s:this._getSubdomain(i),z:i.z,x:i.x,y:i.y},this.options))},_getWrapTileNum:function(){var i=this._map.options.crs,j=i.getSize(this._map.getZoom());return j.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(j){var i=this._getWrapTileNum();if(!this.options.continuousWorld&&!this.options.noWrap){j.x=((j.x%i.x)+i.x)%i.x}if(this.options.tms){j.y=i.y-j.y-1}j.z=this._getZoomForUrl()},_getSubdomain:function(j){var i=Math.abs(j.x+j.y)%this.options.subdomains.length;return this.options.subdomains[i]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var i=this._unusedTiles.pop();this._resetTile(i);return i}return this._createTile()},_resetTile:function(){},_createTile:function(){var i=a.DomUtil.create("img","leaflet-tile");i.style.width=i.style.height=this._getTileSize()+"px";i.galleryimg="no";i.onselectstart=i.onmousemove=a.Util.falseFn;if(a.Browser.ielt9&&this.options.opacity!==h){a.DomUtil.setOpacity(i,this.options.opacity)}if(a.Browser.mobileWebkit3d){i.style.WebkitBackfaceVisibility="hidden"}return i},_loadTile:function(j,i){j._layer=this;j.onload=this._tileOnLoad;j.onerror=this._tileOnError;this._adjustTilePoint(i);j.src=this.getTileUrl(i);this.fire("tileloadstart",{tile:j,url:j.src})},_tileLoaded:function(){this._tilesToLoad--;if(this._animated){a.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated")}if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(a.bind(this._clearBgBuffer,this),500)}}},_tileOnLoad:function(){var i=this._layer;if(this.src!==a.Util.emptyImageUrl){a.DomUtil.addClass(this,"leaflet-tile-loaded");i.fire("tileload",{tile:this,url:this.src})}i._tileLoaded()},_tileOnError:function(){var i=this._layer;i.fire("tileerror",{tile:this,url:this.src});var j=i.options.errorTileUrl;if(j){this.src=j}i._tileLoaded()}});a.tileLayer=function(j,i){return new a.TileLayer(j,i)};a.TileLayer.WMS=a.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false},initialize:function(l,k){this._url=l;var j=a.extend({},this.defaultWmsParams),n=k.tileSize||this.options.tileSize;if(k.detectRetina&&a.Browser.retina){j.width=j.height=n*2}else{j.width=j.height=n}for(var m in k){if(!this.options.hasOwnProperty(m)&&m!=="crs"){j[m]=k[m]}}this.wmsParams=j;a.setOptions(this,k)},onAdd:function(i){this._crs=this.options.crs||i.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var j=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[j]=this._crs.code;a.TileLayer.prototype.onAdd.call(this,i)},getTileUrl:function(k){var j=this._map,q=this.options.tileSize,p=k.multiplyBy(q),n=p.add([q,q]),l=this._crs.project(j.unproject(p,k.z)),m=this._crs.project(j.unproject(n,k.z)),o=this._wmsVersion>=1.3&&this._crs===a.CRS.EPSG4326?[m.y,l.x,l.y,m.x].join(","):[l.x,m.y,m.x,l.y].join(","),i=a.Util.template(this._url,{s:this._getSubdomain(k)});return i+a.Util.getParamString(this.wmsParams,i,true)+"&BBOX="+o},setParams:function(j,i){a.extend(this.wmsParams,j);if(!i){this.redraw()}return this}});a.tileLayer.wms=function(j,i){return new a.TileLayer.WMS(j,i)};a.TileLayer.Canvas=a.TileLayer.extend({options:{async:false},initialize:function(i){a.setOptions(this,i)},redraw:function(){if(this._map){this._reset({hard:true});this._update()}for(var j in this._tiles){this._redrawTile(this._tiles[j])}return this},_redrawTile:function(i){this.drawTile(i,i._tilePoint,this._map._zoom)},_createTile:function(){var i=a.DomUtil.create("canvas","leaflet-tile");i.width=i.height=this.options.tileSize;i.onselectstart=i.onmousemove=a.Util.falseFn;return i},_loadTile:function(j,i){j._layer=this;j._tilePoint=i;this._redrawTile(j);if(!this.options.async){this.tileDrawn(j)}},drawTile:function(){},tileDrawn:function(i){this._tileOnLoad.call(i)}});a.tileLayer.canvas=function(i){return new a.TileLayer.Canvas(i)};a.ImageOverlay=a.Class.extend({includes:a.Mixin.Events,options:{opacity:1},initialize:function(j,k,i){this._url=j;this._bounds=a.latLngBounds(k);a.setOptions(this,i)},onAdd:function(i){this._map=i;if(!this._image){this._initImage()}i._panes.overlayPane.appendChild(this._image);i.on("viewreset",this._reset,this);if(i.options.zoomAnimation&&a.Browser.any3d){i.on("zoomanim",this._animateZoom,this)}this._reset()},onRemove:function(i){i.getPanes().overlayPane.removeChild(this._image);i.off("viewreset",this._reset,this);if(i.options.zoomAnimation){i.off("zoomanim",this._animateZoom,this)}},addTo:function(i){i.addLayer(this);return this},setOpacity:function(i){this.options.opacity=i;this._updateOpacity();return this},bringToFront:function(){if(this._image){this._map._panes.overlayPane.appendChild(this._image)}return this},bringToBack:function(){var i=this._map._panes.overlayPane;if(this._image){i.insertBefore(this._image,i.firstChild)}return this},setUrl:function(i){this._url=i;this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=a.DomUtil.create("img","leaflet-image-layer");if(this._map.options.zoomAnimation&&a.Browser.any3d){a.DomUtil.addClass(this._image,"leaflet-zoom-animated")}else{a.DomUtil.addClass(this._image,"leaflet-zoom-hide")}this._updateOpacity();a.extend(this._image,{galleryimg:"no",onselectstart:a.Util.falseFn,onmousemove:a.Util.falseFn,onload:a.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(m){var i=this._map,k=this._image,j=i.getZoomScale(m.zoom),l=this._bounds.getNorthWest(),n=this._bounds.getSouthEast(),p=i._latLngToNewLayerPoint(l,m.zoom,m.center),q=i._latLngToNewLayerPoint(n,m.zoom,m.center)._subtract(p),o=p._add(q._multiplyBy((1/2)*(1-1/j)));k.style[a.DomUtil.TRANSFORM]=a.DomUtil.getTranslateString(o)+" scale("+j+") "},_reset:function(){var k=this._image,j=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(j);a.DomUtil.setPosition(k,j);k.style.width=i.x+"px";k.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){a.DomUtil.setOpacity(this._image,this.options.opacity)}});a.imageOverlay=function(j,k,i){return new a.ImageOverlay(j,k,i)};a.Icon=a.Class.extend({options:{className:""},initialize:function(i){a.setOptions(this,i)},createIcon:function(i){return this._createIcon("icon",i)},createShadow:function(i){return this._createIcon("shadow",i)},_createIcon:function(j,k){var l=this._getIconUrl(j);if(!l){if(j==="icon"){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var i;if(!k||k.tagName!=="IMG"){i=this._createImg(l)}else{i=this._createImg(l,k)}this._setIconStyles(i,j);return i},_setIconStyles:function(i,l){var k=this.options,m=a.point(k[l+"Size"]),j;if(l==="shadow"){j=a.point(k.shadowAnchor||k.iconAnchor)}else{j=a.point(k.iconAnchor)}if(!j&&m){j=m.divideBy(2,true)}i.className="leaflet-marker-"+l+" "+k.className;if(j){i.style.marginLeft=(-j.x)+"px";i.style.marginTop=(-j.y)+"px"}if(m){i.style.width=m.x+"px";i.style.height=m.y+"px"}},_createImg:function(j,i){i=i||b.createElement("img");i.src=j;return i},_getIconUrl:function(i){if(a.Browser.retina&&this.options[i+"RetinaUrl"]){return this.options[i+"RetinaUrl"]}return this.options[i+"Url"]}});a.icon=function(i){return new a.Icon(i)};a.Icon.Default=a.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(i){var j=i+"Url";if(this.options[j]){return this.options[j]}if(a.Browser.retina&&i==="icon"){i+="-2x"}var k=a.Icon.Default.imagePath;if(!k){throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.")}return k+"/marker-"+i+".png"}});a.Icon.Default.imagePath=(function(){var k=b.getElementsByTagName("script"),m=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;var l,j,p,n,o;for(l=0,j=k.length;l<j;l++){p=k[l].src;n=p.match(m);if(n){o=p.split(m)[0];return(o?o+"/":"")+"images"}}}());a.Marker=a.Class.extend({includes:a.Mixin.Events,options:{icon:new a.Icon.Default(),title:"",alt:"",clickable:true,draggable:false,keyboard:true,zIndexOffset:0,opacity:1,riseOnHover:false,riseOffset:250},initialize:function(j,i){a.setOptions(this,i);this._latlng=a.latLng(j)},onAdd:function(i){this._map=i;i.on("viewreset",this.update,this);this._initIcon();this.update();this.fire("add");if(i.options.zoomAnimation&&i.options.markerZoomAnimation){i.on("zoomanim",this._animateZoom,this)}},addTo:function(i){i.addLayer(this);return this},onRemove:function(i){if(this.dragging){this.dragging.disable()}this._removeIcon();this._removeShadow();this.fire("remove");i.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(i){this._latlng=a.latLng(i);this.update();return this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(i){this.options.zIndexOffset=i;this.update();return this},setIcon:function(i){this.options.icon=i;if(this._map){this._initIcon();this.update()}if(this._popup){this.bindPopup(this._popup)}return this},update:function(){if(this._icon){var i=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(i)}return this},_initIcon:function(){var p=this.options,i=this._map,l=(i.options.zoomAnimation&&i.options.markerZoomAnimation),k=l?"leaflet-zoom-animated":"leaflet-zoom-hide";var o=p.icon.createIcon(this._icon),m=false;if(o!==this._icon){if(this._icon){this._removeIcon()}m=true;if(p.title){o.title=p.title}if(p.alt){o.alt=p.alt}}a.DomUtil.addClass(o,k);if(p.keyboard){o.tabIndex="0"}this._icon=o;this._initInteraction();if(p.riseOnHover){a.DomEvent.on(o,"mouseover",this._bringToFront,this).on(o,"mouseout",this._resetZIndex,this)}var q=p.icon.createShadow(this._shadow),j=false;if(q!==this._shadow){this._removeShadow();j=true}if(q){a.DomUtil.addClass(q,k)}this._shadow=q;if(p.opacity<1){this._updateOpacity()}var n=this._map._panes;if(m){n.markerPane.appendChild(this._icon)}if(q&&j){n.shadowPane.appendChild(this._shadow)}},_removeIcon:function(){if(this.options.riseOnHover){a.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex)}this._map._panes.markerPane.removeChild(this._icon);this._icon=null},_removeShadow:function(){if(this._shadow){this._map._panes.shadowPane.removeChild(this._shadow)}this._shadow=null},_setPos:function(i){a.DomUtil.setPosition(this._icon,i);if(this._shadow){a.DomUtil.setPosition(this._shadow,i)}this._zIndex=i.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(i){this._icon.style.zIndex=this._zIndex+i},_animateZoom:function(i){var j=this._map._latLngToNewLayerPoint(this._latlng,i.zoom,i.center).round();this._setPos(j)},_initInteraction:function(){if(!this.options.clickable){return}var l=this._icon,k=["dblclick","mousedown","mouseover","mouseout","contextmenu"];a.DomUtil.addClass(l,"leaflet-clickable");a.DomEvent.on(l,"click",this._onMouseClick,this);a.DomEvent.on(l,"keypress",this._onKeyPress,this);for(var j=0;j<k.length;j++){a.DomEvent.on(l,k[j],this._fireMouseEvent,this)}if(a.Handler.MarkerDrag){this.dragging=new a.Handler.MarkerDrag(this);if(this.options.draggable){this.dragging.enable()}}},_onMouseClick:function(j){var i=this.dragging&&this.dragging.moved();if(this.hasEventListeners(j.type)||i){a.DomEvent.stopPropagation(j)}if(i){return}if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved()){return}this.fire(j.type,{originalEvent:j,latlng:this._latlng})},_onKeyPress:function(i){if(i.keyCode===13){this.fire("click",{originalEvent:i,latlng:this._latlng})}},_fireMouseEvent:function(i){this.fire(i.type,{originalEvent:i,latlng:this._latlng});if(i.type==="contextmenu"&&this.hasEventListeners(i.type)){a.DomEvent.preventDefault(i)}if(i.type!=="mousedown"){a.DomEvent.stopPropagation(i)}else{a.DomEvent.preventDefault(i)}},setOpacity:function(i){this.options.opacity=i;if(this._map){this._updateOpacity()}return this},_updateOpacity:function(){a.DomUtil.setOpacity(this._icon,this.options.opacity);if(this._shadow){a.DomUtil.setOpacity(this._shadow,this.options.opacity)}},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});a.marker=function(j,i){return new a.Marker(j,i)};a.DivIcon=a.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:false},createIcon:function(j){var k=(j&&j.tagName==="DIV")?j:b.createElement("div"),i=this.options;if(i.html!==false){k.innerHTML=i.html}else{k.innerHTML=""}if(i.bgPos){k.style.backgroundPosition=(-i.bgPos.x)+"px "+(-i.bgPos.y)+"px"}this._setIconStyles(k,"icon");return k},createShadow:function(){return null}});a.divIcon=function(i){return new a.DivIcon(i)};a.Map.mergeOptions({closePopupOnClick:true});a.Popup=a.Class.extend({includes:a.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:true,closeButton:true,offset:[0,7],autoPanPadding:[5,5],keepInView:false,className:"",zoomAnimation:true},initialize:function(i,j){a.setOptions(this,i);this._source=j;this._animated=a.Browser.any3d&&this.options.zoomAnimation;this._isOpen=false},onAdd:function(j){this._map=j;if(!this._container){this._initLayout()}var i=j.options.fadeAnimation;if(i){a.DomUtil.setOpacity(this._container,0)}j._panes.popupPane.appendChild(this._container);j.on(this._getEvents(),this);this.update();if(i){a.DomUtil.setOpacity(this._container,1)}this.fire("open");j.fire("popupopen",{popup:this});if(this._source){this._source.fire("popupopen",{popup:this})}},addTo:function(i){i.addLayer(this);return this},openOn:function(i){i.openPopup(this);return this},onRemove:function(i){i._panes.popupPane.removeChild(this._container);a.Util.falseFn(this._container.offsetWidth);i.off(this._getEvents(),this);if(i.options.fadeAnimation){a.DomUtil.setOpacity(this._container,0)}this._map=null;this.fire("close");i.fire("popupclose",{popup:this});if(this._source){this._source.fire("popupclose",{popup:this})}},getLatLng:function(){return this._latlng},setLatLng:function(i){this._latlng=a.latLng(i);if(this._map){this._updatePosition();this._adjustPan()}return this},getContent:function(){return this._content},setContent:function(i){this._content=i;this.update();return this},update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},_getEvents:function(){var i={viewreset:this._updatePosition};if(this._animated){i.zoomanim=this._zoomAnimation}if("closeOnClick" in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick){i.preclick=this._close}if(this.options.keepInView){i.moveend=this._adjustPan}return i},_close:function(){if(this._map){this._map.closePopup(this)}},_initLayout:function(){var k="leaflet-popup",l=k+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),i=this._container=a.DomUtil.create("div",l),j;if(this.options.closeButton){j=this._closeButton=a.DomUtil.create("a",k+"-close-button",i);j.href="#close";j.innerHTML="&#215;";a.DomEvent.disableClickPropagation(j);a.DomEvent.on(j,"click",this._onCloseButtonClick,this)}var m=this._wrapper=a.DomUtil.create("div",k+"-content-wrapper",i);a.DomEvent.disableClickPropagation(m);this._contentNode=a.DomUtil.create("div",k+"-content",m);a.DomEvent.disableScrollPropagation(this._contentNode);a.DomEvent.on(m,"contextmenu",a.DomEvent.stopPropagation);this._tipContainer=a.DomUtil.create("div",k+"-tip-container",i);this._tip=a.DomUtil.create("div",k+"-tip",this._tipContainer)},_updateContent:function(){if(!this._content){return}if(typeof this._content==="string"){this._contentNode.innerHTML=this._content}else{while(this._contentNode.hasChildNodes()){this._contentNode.removeChild(this._contentNode.firstChild)}this._contentNode.appendChild(this._content)}this.fire("contentupdate")},_updateLayout:function(){var j=this._contentNode,l=j.style;l.width="";l.whiteSpace="nowrap";var k=j.offsetWidth;k=Math.min(k,this.options.maxWidth);k=Math.max(k,this.options.minWidth);l.width=(k+1)+"px";l.whiteSpace="";l.height="";var i=j.offsetHeight,m=this.options.maxHeight,n="leaflet-popup-scrolled";if(m&&i>m){l.height=m+"px";a.DomUtil.addClass(j,n)}else{a.DomUtil.removeClass(j,n)}this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map){return}var k=this._map.latLngToLayerPoint(this._latlng),i=this._animated,j=a.point(this.options.offset);if(i){a.DomUtil.setPosition(this._container,k)}this._containerBottom=-j.y-(i?0:k.y);this._containerLeft=-Math.round(this._containerWidth/2)+j.x+(i?0:k.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(i){var j=this._map._latLngToNewLayerPoint(this._latlng,i.zoom,i.center);a.DomUtil.setPosition(this._container,j)},_adjustPan:function(){if(!this.options.autoPan){return}var j=this._map,s=this._container.offsetHeight,o=this._containerWidth,m=new a.Point(this._containerLeft,-s-this._containerBottom);if(this._animated){m._add(a.DomUtil.getPosition(this._container))}var l=j.layerPointToContainerPoint(m),n=a.point(this.options.autoPanPadding),k=a.point(this.options.autoPanPaddingTopLeft||n),i=a.point(this.options.autoPanPaddingBottomRight||n),r=j.getSize(),q=0,p=0;if(l.x+o+i.x>r.x){q=l.x+o-r.x+i.x}if(l.x-q-k.x<0){q=l.x-k.x}if(l.y+s+i.y>r.y){p=l.y+s-r.y+i.y}if(l.y-p-k.y<0){p=l.y-k.y}if(q||p){j.fire("autopanstart").panBy([q,p])}},_onCloseButtonClick:function(i){this._close();a.DomEvent.stop(i)}});a.popup=function(i,j){return new a.Popup(i,j)};a.Map.include({openPopup:function(i,l,j){this.closePopup();if(!(i instanceof a.Popup)){var k=i;i=new a.Popup(j).setLatLng(l).setContent(k)}i._isOpen=true;this._popup=i;return this.addLayer(i)},closePopup:function(i){if(!i||i===this._popup){i=this._popup;this._popup=null}if(i){this.removeLayer(i);i._isOpen=false}return this}});a.Marker.include({openPopup:function(){if(this._popup&&this._map&&!this._map.hasLayer(this._popup)){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup)}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},togglePopup:function(){if(this._popup){if(this._popup._isOpen){this.closePopup()}else{this.openPopup()}}return this},bindPopup:function(k,j){var i=a.point(this.options.icon.options.popupAnchor||[0,0]);i=i.add(a.Popup.prototype.options.offset);if(j&&j.offset){i=i.add(j.offset)}j=a.extend({offset:i},j);if(!this._popupHandlersAdded){this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this);this._popupHandlersAdded=true}if(k instanceof a.Popup){a.setOptions(k,j);this._popup=k}else{this._popup=new a.Popup(j,this).setContent(k)}return this},setPopupContent:function(i){if(this._popup){this._popup.setContent(i)}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this);this._popupHandlersAdded=false}return this},getPopup:function(){return this._popup},_movePopup:function(i){this._popup.setLatLng(i.latlng)}});a.LayerGroup=a.Class.extend({initialize:function(l){this._layers={};var k,j;if(l){for(k=0,j=l.length;k<j;k++){this.addLayer(l[k])}}},addLayer:function(i){var j=this.getLayerId(i);this._layers[j]=i;if(this._map){this._map.addLayer(i)}return this},removeLayer:function(i){var j=i in this._layers?i:this.getLayerId(i);if(this._map&&this._layers[j]){this._map.removeLayer(this._layers[j])}delete this._layers[j];return this},hasLayer:function(i){if(!i){return false}return(i in this._layers||this.getLayerId(i) in this._layers)},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(j){var k=Array.prototype.slice.call(arguments,1),m,l;for(m in this._layers){l=this._layers[m];if(l[j]){l[j].apply(l,k)}}return this},onAdd:function(i){this._map=i;this.eachLayer(i.addLayer,i)},onRemove:function(i){this.eachLayer(i.removeLayer,i);this._map=null},addTo:function(i){i.addLayer(this);return this},eachLayer:function(l,k){for(var j in this._layers){l.call(k,this._layers[j])}return this},getLayer:function(i){return this._layers[i]},getLayers:function(){var k=[];for(var j in this._layers){k.push(this._layers[j])}return k},setZIndex:function(i){return this.invoke("setZIndex",i)},getLayerId:function(i){return a.stamp(i)}});a.layerGroup=function(i){return new a.LayerGroup(i)};a.FeatureGroup=a.LayerGroup.extend({includes:a.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(i){if(this.hasLayer(i)){return this}if("on" in i){i.on(a.FeatureGroup.EVENTS,this._propagateEvent,this)}a.LayerGroup.prototype.addLayer.call(this,i);if(this._popupContent&&i.bindPopup){i.bindPopup(this._popupContent,this._popupOptions)}return this.fire("layeradd",{layer:i})},removeLayer:function(i){if(!this.hasLayer(i)){return this}if(i in this._layers){i=this._layers[i]}i.off(a.FeatureGroup.EVENTS,this._propagateEvent,this);a.LayerGroup.prototype.removeLayer.call(this,i);if(this._popupContent){this.invoke("unbindPopup")}return this.fire("layerremove",{layer:i})},bindPopup:function(j,i){this._popupContent=j;this._popupOptions=i;return this.invoke("bindPopup",j,i)},openPopup:function(j){for(var i in this._layers){this._layers[i].openPopup(j);break}return this},setStyle:function(i){return this.invoke("setStyle",i)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var i=new a.LatLngBounds();this.eachLayer(function(j){i.extend(j instanceof a.Marker?j.getLatLng():j.getBounds())});return i},_propagateEvent:function(i){i=a.extend({layer:i.target,target:this},i);this.fire(i.type,i)}});a.featureGroup=function(i){return new a.FeatureGroup(i)};a.Path=a.Class.extend({includes:[a.Mixin.Events],statics:{CLIP_PADDING:(function(){var i=a.Browser.mobile?1280:2000,j=(i/Math.max(d.outerWidth,d.outerHeight)-1)/2;return Math.max(0,Math.min(0.5,j))})()},options:{stroke:true,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:0.5,fill:false,fillColor:null,fillOpacity:0.2,clickable:true},initialize:function(i){a.setOptions(this,i)},onAdd:function(i){this._map=i;if(!this._container){this._initElements();this._initEvents()}this.projectLatlngs();this._updatePath();if(this._container){this._map._pathRoot.appendChild(this._container)}this.fire("add");i.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(i){i.addLayer(this);return this},onRemove:function(i){i._pathRoot.removeChild(this._container);this.fire("remove");this._map=null;if(a.Browser.vml){this._container=null;this._stroke=null;this._fill=null}i.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(i){a.setOptions(this,i);if(this._container){this._updateStyle()}return this},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath()}return this}});a.Map.include({_updatePathViewport:function(){var m=a.Path.CLIP_PADDING,l=this.getSize(),j=a.DomUtil.getPosition(this._mapPane),k=j.multiplyBy(-1)._subtract(l.multiplyBy(m)._round()),i=k.add(l.multiplyBy(1+m*2)._round());this._pathViewport=new a.Bounds(k,i)}});a.Path.SVG_NS="http://www.w3.org/2000/svg";a.Browser.svg=!!(b.createElementNS&&b.createElementNS(a.Path.SVG_NS,"svg").createSVGRect);a.Path=a.Path.extend({statics:{SVG:a.Browser.svg},bringToFront:function(){var i=this._map._pathRoot,j=this._container;if(j&&i.lastChild!==j){i.appendChild(j)}return this},bringToBack:function(){var i=this._map._pathRoot,j=this._container,k=i.firstChild;if(j&&k!==j){i.insertBefore(j,k)}return this},getPathString:function(){},_createElement:function(i){return b.createElementNS(a.Path.SVG_NS,i)},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle()},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");if(this.options.className){a.DomUtil.addClass(this._path,this.options.className)}this._container.appendChild(this._path)},_initStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke-linejoin","round");this._path.setAttribute("stroke-linecap","round")}if(this.options.fill){this._path.setAttribute("fill-rule","evenodd")}if(this.options.pointerEvents){this._path.setAttribute("pointer-events",this.options.pointerEvents)}if(!this.options.clickable&&!this.options.pointerEvents){this._path.setAttribute("pointer-events","none")}this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke",this.options.color);this._path.setAttribute("stroke-opacity",this.options.opacity);this._path.setAttribute("stroke-width",this.options.weight);if(this.options.dashArray){this._path.setAttribute("stroke-dasharray",this.options.dashArray)}else{this._path.removeAttribute("stroke-dasharray")}if(this.options.lineCap){this._path.setAttribute("stroke-linecap",this.options.lineCap)}if(this.options.lineJoin){this._path.setAttribute("stroke-linejoin",this.options.lineJoin)}}else{this._path.setAttribute("stroke","none")}if(this.options.fill){this._path.setAttribute("fill",this.options.fillColor||this.options.color);this._path.setAttribute("fill-opacity",this.options.fillOpacity)}else{this._path.setAttribute("fill","none")}},_updatePath:function(){var i=this.getPathString();if(!i){i="M0 0"}this._path.setAttribute("d",i)},_initEvents:function(){if(this.options.clickable){if(a.Browser.svg||!a.Browser.vml){a.DomUtil.addClass(this._path,"leaflet-clickable")}a.DomEvent.on(this._container,"click",this._onMouseClick,this);var k=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"];for(var j=0;j<k.length;j++){a.DomEvent.on(this._container,k[j],this._fireMouseEvent,this)}}},_onMouseClick:function(i){if(this._map.dragging&&this._map.dragging.moved()){return}this._fireMouseEvent(i)},_fireMouseEvent:function(l){if(!this.hasEventListeners(l.type)){return}var k=this._map,j=k.mouseEventToContainerPoint(l),i=k.containerPointToLayerPoint(j),m=k.layerPointToLatLng(i);this.fire(l.type,{latlng:m,layerPoint:i,containerPoint:j,originalEvent:l});if(l.type==="contextmenu"){a.DomEvent.preventDefault(l)}if(l.type!=="mousemove"){a.DomEvent.stopPropagation(l)}}});a.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=a.Path.prototype._createElement("svg");this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&a.Browser.any3d){a.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated");this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})}else{a.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide")}this.on("moveend",this._updateSvgViewport);this._updateSvgViewport()}},_animatePathZoom:function(i){var k=this.getZoomScale(i.zoom),j=this._getCenterOffset(i.center)._multiplyBy(-k)._add(this._pathViewport.min);this._pathRoot.style[a.DomUtil.TRANSFORM]=a.DomUtil.getTranslateString(j)+" scale("+k+") ";this._pathZooming=true},_endPathZoom:function(){this._pathZooming=false},_updateSvgViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var l=this._pathViewport,m=l.min,j=l.max,n=j.x-m.x,i=j.y-m.y,k=this._pathRoot,o=this._panes.overlayPane;if(a.Browser.mobileWebkit){o.removeChild(k)}a.DomUtil.setPosition(k,m);k.setAttribute("width",n);k.setAttribute("height",i);k.setAttribute("viewBox",[m.x,m.y,n,i].join(" "));if(a.Browser.mobileWebkit){o.appendChild(k)}}});a.Path.include({bindPopup:function(j,i){if(j instanceof a.Popup){this._popup=j}else{if(!this._popup||i){this._popup=new a.Popup(i,this)}this._popup.setContent(j)}if(!this._popupHandlersAdded){this.on("click",this._openPopup,this).on("remove",this.closePopup,this);this._popupHandlersAdded=true}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this._openPopup).off("remove",this.closePopup);this._popupHandlersAdded=false}return this},openPopup:function(i){if(this._popup){i=i||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)];this._openPopup({latlng:i})}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},_openPopup:function(i){this._popup.setLatLng(i.latlng);this._map.openPopup(this._popup)}});a.Browser.vml=!a.Browser.svg&&(function(){try{var k=b.createElement("div");k.innerHTML='<v:shape adj="1"/>';var i=k.firstChild;i.style.behavior="url(#default#VML)";return i&&(typeof i.adj==="object")}catch(j){return false}}());a.Path=a.Browser.svg||!a.Browser.vml?a.Path:a.Path.extend({statics:{VML:true,CLIP_PADDING:0.02},_createElement:(function(){try{b.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(j){return b.createElement("<lvml:"+j+' class="lvml">')}}catch(i){return function(j){return b.createElement("<"+j+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),_initPath:function(){var i=this._container=this._createElement("shape");a.DomUtil.addClass(i,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:""));if(this.options.clickable){a.DomUtil.addClass(i,"leaflet-clickable")}i.coordsize="1 1";this._path=this._createElement("path");i.appendChild(this._path);this._map._pathRoot.appendChild(i)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var l=this._stroke,k=this._fill,j=this.options,i=this._container;i.stroked=j.stroke;i.filled=j.fill;if(j.stroke){if(!l){l=this._stroke=this._createElement("stroke");l.endcap="round";i.appendChild(l)}l.weight=j.weight+"px";l.color=j.color;l.opacity=j.opacity;if(j.dashArray){l.dashStyle=a.Util.isArray(j.dashArray)?j.dashArray.join(" "):j.dashArray.replace(/( *, *)/g," ")}else{l.dashStyle=""}if(j.lineCap){l.endcap=j.lineCap.replace("butt","flat")}if(j.lineJoin){l.joinstyle=j.lineJoin}}else{if(l){i.removeChild(l);this._stroke=null}}if(j.fill){if(!k){k=this._fill=this._createElement("fill");i.appendChild(k)}k.color=j.fillColor||j.color;k.opacity=j.fillOpacity}else{if(k){i.removeChild(k);this._fill=null}}},_updatePath:function(){var i=this._container.style;i.display="none";this._path.v=this.getPathString()+" ";i.display=""}});a.Map.include(a.Browser.svg||!a.Browser.vml?{}:{_initPathRoot:function(){if(this._pathRoot){return}var i=this._pathRoot=b.createElement("div");i.className="leaflet-vml-container";this._panes.overlayPane.appendChild(i);this.on("moveend",this._updatePathViewport);this._updatePathViewport()}});a.Browser.canvas=(function(){return !!b.createElement("canvas").getContext}());a.Path=(a.Path.SVG&&!d.L_PREFER_CANVAS)||!a.Browser.canvas?a.Path:a.Path.extend({statics:{CANVAS:true,SVG:false},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate()}return this},setStyle:function(i){a.setOptions(this,i);if(this._map){this._updateStyle();this._requestUpdate()}return this},onRemove:function(i){i.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);if(this.options.clickable){this._map.off("click",this._onClick,this);this._map.off("mousemove",this._onMouseMove,this)}this._requestUpdate();this._map=null},_requestUpdate:function(){if(this._map&&!a.Path._updateRequest){a.Path._updateRequest=a.Util.requestAnimFrame(this._fireMapMoveEnd,this._map)}},_fireMapMoveEnd:function(){a.Path._updateRequest=null;this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var i=this.options;if(i.stroke){this._ctx.lineWidth=i.weight;this._ctx.strokeStyle=i.color}if(i.fill){this._ctx.fillStyle=i.fillColor||i.color}},_drawPath:function(){var p,o,l,m,k,n;this._ctx.beginPath();for(p=0,l=this._parts.length;p<l;p++){for(o=0,m=this._parts[p].length;o<m;o++){k=this._parts[p][o];n=(o===0?"move":"line")+"To";this._ctx[n](k.x,k.y)}if(this instanceof a.Polygon){this._ctx.closePath()}}},_checkIfEmpty:function(){return !this._parts.length},_updatePath:function(){if(this._checkIfEmpty()){return}var i=this._ctx,j=this.options;this._drawPath();i.save();this._updateStyle();if(j.fill){i.globalAlpha=j.fillOpacity;i.fill()}if(j.stroke){i.globalAlpha=j.opacity;i.stroke()}i.restore()},_initEvents:function(){if(this.options.clickable){this._map.on("mousemove",this._onMouseMove,this);this._map.on("click",this._onClick,this)}},_onClick:function(i){if(this._containsPoint(i.layerPoint)){this.fire("click",i)}},_onMouseMove:function(i){if(!this._map||this._map._animatingZoom){return}if(this._containsPoint(i.layerPoint)){this._ctx.canvas.style.cursor="pointer";this._mouseInside=true;this.fire("mouseover",i)}else{if(this._mouseInside){this._ctx.canvas.style.cursor="";this._mouseInside=false;this.fire("mouseout",i)}}}});a.Map.include((a.Path.SVG&&!d.L_PREFER_CANVAS)||!a.Browser.canvas?{}:{_initPathRoot:function(){var j=this._pathRoot,i;if(!j){j=this._pathRoot=b.createElement("canvas");j.style.position="absolute";i=this._canvasCtx=j.getContext("2d");i.lineCap="round";i.lineJoin="round";this._panes.overlayPane.appendChild(j);if(this.options.zoomAnimation){this._pathRoot.className="leaflet-zoom-animated";this.on("zoomanim",this._animatePathZoom);this.on("zoomend",this._endPathZoom)}this.on("moveend",this._updateCanvasViewport);this._updateCanvasViewport()}},_updateCanvasViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var j=this._pathViewport,l=j.min,k=j.max.subtract(l),i=this._pathRoot;a.DomUtil.setPosition(i,l);i.width=k.x;i.height=k.y;i.getContext("2d").translate(-l.x,-l.y)}});a.LineUtil={simplify:function(k,i){if(!i||!k.length){return k.slice()}var j=i*i;k=this._reducePoints(k,j);k=this._simplifyDP(k,j);return k},pointToSegmentDistance:function(j,k,i){return Math.sqrt(this._sqClosestPointOnSegment(j,k,i,true))},closestPointOnSegment:function(j,k,i){return this._sqClosestPointOnSegment(j,k,i)},_simplifyDP:function(n,k){var j=n.length,m=typeof Uint8Array!==h+""?Uint8Array:Array,p=new m(j);p[0]=p[j-1]=1;this._simplifyDPStep(n,p,k,0,j-1);var l,o=[];for(l=0;l<j;l++){if(p[l]){o.push(n[l])}}return o},_simplifyDPStep:function(r,k,j,o,q){var l=0,p,m,n;for(m=o+1;m<=q-1;m++){n=this._sqClosestPointOnSegment(r[m],r[o],r[q],true);if(n>l){p=m;l=n}}if(l>j){k[p]=1;this._simplifyDPStep(r,k,j,o,p);this._simplifyDPStep(r,k,j,p,q)}},_reducePoints:function(m,k){var o=[m[0]];for(var l=1,n=0,j=m.length;l<j;l++){if(this._sqDist(m[l],m[n])>k){o.push(m[l]);n=l}}if(n<j-1){o.push(m[j-1])}return o},clipSegment:function(q,o,i,r){var m=r?this._lastCode:this._getBitCode(q,i),k=this._getBitCode(o,i),l,j,n;this._lastCode=k;while(true){if(!(m|k)){return[q,o]}else{if(m&k){return false}else{l=m||k;j=this._getEdgeIntersection(q,o,l,i);n=this._getBitCode(j,i);if(l===m){q=j;m=n}else{o=j;k=n}}}}},_getEdgeIntersection:function(l,j,p,o){var m=j.x-l.x,k=j.y-l.y,n=o.min,i=o.max;if(p&8){return new a.Point(l.x+m*(i.y-l.y)/k,i.y)}else{if(p&4){return new a.Point(l.x+m*(n.y-l.y)/k,n.y)}else{if(p&2){return new a.Point(i.x,l.y+k*(i.x-l.x)/m)}else{if(p&1){return new a.Point(n.x,l.y+k*(n.x-l.x)/m)}}}}},_getBitCode:function(k,j){var i=0;if(k.x<j.min.x){i|=1}else{if(k.x>j.max.x){i|=2}}if(k.y<j.min.y){i|=4}else{if(k.y>j.max.y){i|=8}}return i},_sqDist:function(l,k){var j=k.x-l.x,i=k.y-l.y;return j*j+i*i},_sqClosestPointOnSegment:function(j,o,n,k){var m=o.x,l=o.y,s=n.x-m,r=n.y-l,i=s*s+r*r,q;if(i>0){q=((j.x-m)*s+(j.y-l)*r)/i;if(q>1){m=n.x;l=n.y}else{if(q>0){m+=s*q;l+=r*q}}}s=j.x-m;r=j.y-l;return k?s*s+r*r:new a.Point(m,l)}};a.Polyline=a.Path.extend({initialize:function(i,j){a.Path.prototype.initialize.call(this,j);this._latlngs=this._convertLatLngs(i)},options:{smoothFactor:1,noClip:false},projectLatlngs:function(){this._originalPoints=[];for(var k=0,j=this._latlngs.length;k<j;k++){this._originalPoints[k]=this._map.latLngToLayerPoint(this._latlngs[k])}},getPathString:function(){for(var k=0,j=this._parts.length,l="";k<j;k++){l+=this._getPathPartStr(this._parts[k])}return l},getLatLngs:function(){return this._latlngs},setLatLngs:function(i){this._latlngs=this._convertLatLngs(i);return this.redraw()},addLatLng:function(i){this._latlngs.push(a.latLng(i));return this.redraw()},spliceLatLngs:function(){var i=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,true);this.redraw();return i},closestLayerPoint:function(k){var t=Infinity,l=this._parts,v,u,r=null;for(var m=0,w=l.length;m<w;m++){var s=l[m];for(var n=1,q=s.length;n<q;n++){v=s[n-1];u=s[n];var o=a.LineUtil._sqClosestPointOnSegment(k,v,u,true);if(o<t){t=o;r=a.LineUtil._sqClosestPointOnSegment(k,v,u)}}}if(r){r.distance=Math.sqrt(t)}return r},getBounds:function(){return new a.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(k,l){var m,j,n=l?k:[];for(m=0,j=k.length;m<j;m++){if(a.Util.isArray(k[m])&&typeof k[m][0]!=="number"){return}n[m]=a.latLng(k[m])}return n},_initEvents:function(){a.Path.prototype._initEvents.call(this)},_getPathPartStr:function(m){var k=a.Path.VML;for(var l=0,i=m.length,o="",n;l<i;l++){n=m[l];if(k){n._round()}o+=(l?"L":"M")+n.x+" "+n.y}return o},_clipPoints:function(){var o=this._originalPoints,j=o.length,n,m,p;if(this.options.noClip){this._parts=[o];return}this._parts=[];var q=this._parts,l=this._map._pathViewport,r=a.LineUtil;for(n=0,m=0;n<j-1;n++){p=r.clipSegment(o[n],o[n+1],l,n);if(!p){continue}q[m]=q[m]||[];q[m].push(p[0]);if((p[1]!==o[n+1])||(n===j-2)){q[m].push(p[1]);m++}}},_simplifyPoints:function(){var l=this._parts,m=a.LineUtil;for(var k=0,j=l.length;k<j;k++){l[k]=m.simplify(l[k],this.options.smoothFactor)}},_updatePath:function(){if(!this._map){return}this._clipPoints();this._simplifyPoints();a.Path.prototype._updatePath.call(this)}});a.polyline=function(i,j){return new a.Polyline(i,j)};a.PolyUtil={};a.PolyUtil.clipPolygon=function(y,l){var v,s=[1,4,2,8],t,r,q,x,w,u,n,m,o=a.LineUtil;for(t=0,u=y.length;t<u;t++){y[t]._code=o._getBitCode(y[t],l)}for(q=0;q<4;q++){n=s[q];v=[];for(t=0,u=y.length,r=u-1;t<u;r=t++){x=y[t];w=y[r];if(!(x._code&n)){if(w._code&n){m=o._getEdgeIntersection(w,x,n,l);m._code=o._getBitCode(m,l);v.push(m)}v.push(x)}else{if(!(w._code&n)){m=o._getEdgeIntersection(w,x,n,l);m._code=o._getBitCode(m,l);v.push(m)}}}y=v}return y};a.Polygon=a.Polyline.extend({options:{fill:true},initialize:function(i,j){a.Polyline.prototype.initialize.call(this,i,j);this._initWithHoles(i)},_initWithHoles:function(k){var l,j,m;if(k&&a.Util.isArray(k[0])&&(typeof k[0][0]!=="number")){this._latlngs=this._convertLatLngs(k[0]);this._holes=k.slice(1);for(l=0,j=this._holes.length;l<j;l++){m=this._holes[l]=this._convertLatLngs(this._holes[l]);if(m[0].equals(m[m.length-1])){m.pop()}}}k=this._latlngs;if(k.length>=2&&k[0].equals(k[k.length-1])){k.pop()}},projectLatlngs:function(){a.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes){return}var n,m,k,l;for(n=0,k=this._holes.length;n<k;n++){this._holePoints[n]=[];for(m=0,l=this._holes[n].length;m<l;m++){this._holePoints[n][m]=this._map.latLngToLayerPoint(this._holes[n][m])}}},setLatLngs:function(i){if(i&&a.Util.isArray(i[0])&&(typeof i[0][0]!=="number")){this._initWithHoles(i);return this.redraw()}else{return a.Polyline.prototype.setLatLngs.call(this,i)}},_clipPoints:function(){var m=this._originalPoints,n=[];this._parts=[m].concat(this._holePoints);if(this.options.noClip){return}for(var l=0,k=this._parts.length;l<k;l++){var j=a.PolyUtil.clipPolygon(this._parts[l],this._map._pathViewport);if(j.length){n.push(j)}}this._parts=n},_getPathPartStr:function(i){var j=a.Polyline.prototype._getPathPartStr.call(this,i);return j+(a.Browser.svg?"z":"x")}});a.polygon=function(i,j){return new a.Polygon(i,j)};(function(){function i(j){return a.FeatureGroup.extend({initialize:function(k,l){this._layers={};this._options=l;this.setLatLngs(k)},setLatLngs:function(l){var m=0,k=l.length;this.eachLayer(function(n){if(m<k){n.setLatLngs(l[m++])}else{this.removeLayer(n)}},this);while(m<k){this.addLayer(new j(l[m++],this._options))}return this},getLatLngs:function(){var k=[];this.eachLayer(function(l){k.push(l.getLatLngs())});return k}})}a.MultiPolyline=i(a.Polyline);a.MultiPolygon=i(a.Polygon);a.multiPolyline=function(j,k){return new a.MultiPolyline(j,k)};a.multiPolygon=function(j,k){return new a.MultiPolygon(j,k)}}());a.Rectangle=a.Polygon.extend({initialize:function(j,i){a.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(j),i)},setBounds:function(i){this.setLatLngs(this._boundsToLatLngs(i))},_boundsToLatLngs:function(i){i=a.latLngBounds(i);return[i.getSouthWest(),i.getNorthWest(),i.getNorthEast(),i.getSouthEast()]}});a.rectangle=function(j,i){return new a.Rectangle(j,i)};a.Circle=a.Path.extend({initialize:function(k,i,j){a.Path.prototype.initialize.call(this,j);this._latlng=a.latLng(k);this._mRadius=i},options:{fill:true},setLatLng:function(i){this._latlng=a.latLng(i);return this.redraw()},setRadius:function(i){this._mRadius=i;return this.redraw()},projectLatlngs:function(){var k=this._getLngRadius(),j=this._latlng,i=this._map.latLngToLayerPoint([j.lat,j.lng-k]);this._point=this._map.latLngToLayerPoint(j);this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var k=this._getLngRadius(),i=(this._mRadius/40075017)*360,j=this._latlng;return new a.LatLngBounds([j.lat-i,j.lng-k],[j.lat+i,j.lng+k])},getLatLng:function(){return this._latlng},getPathString:function(){var j=this._point,i=this._radius;if(this._checkIfEmpty()){return""}if(a.Browser.svg){return"M"+j.x+","+(j.y-i)+"A"+i+","+i+",0,1,1,"+(j.x-0.1)+","+(j.y-i)+" z"}else{j._round();i=Math.round(i);return"AL "+j.x+","+j.y+" "+i+","+i+" 0,"+(65535*360)}},getRadius:function(){return this._mRadius},_getLatRadius:function(){return(this._mRadius/40075017)*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(a.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map){return false}var i=this._map._pathViewport,j=this._radius,k=this._point;return k.x-j>i.max.x||k.y-j>i.max.y||k.x+j<i.min.x||k.y+j<i.min.y}});a.circle=function(k,i,j){return new a.Circle(k,i,j)};a.CircleMarker=a.Circle.extend({options:{radius:10,weight:2},initialize:function(j,i){a.Circle.prototype.initialize.call(this,j,null,i);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){a.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius)},setLatLng:function(i){a.Circle.prototype.setLatLng.call(this,i);if(this._popup&&this._popup._isOpen){this._popup.setLatLng(i)}return this},setRadius:function(i){this.options.radius=this._radius=i;return this.redraw()},getRadius:function(){return this._radius}});a.circleMarker=function(j,i){return new a.CircleMarker(j,i)};a.Polyline.include(!a.Path.CANVAS?{}:{_containsPoint:function(l,s){var r,q,n,t,o,u,m,v=this.options.weight/2;if(a.Browser.touch){v+=10}for(r=0,t=this._parts.length;r<t;r++){m=this._parts[r];for(q=0,o=m.length,n=o-1;q<o;n=q++){if(!s&&(q===0)){continue}u=a.LineUtil.pointToSegmentDistance(l,m[n],m[q]);if(u<=v){return true}}}return false}});a.Polygon.include(!a.Path.CANVAS?{}:{_containsPoint:function(l){var n=false,m,v,u,s,r,q,t,o;if(a.Polyline.prototype._containsPoint.call(this,l,true)){return true}for(s=0,t=this._parts.length;s<t;s++){m=this._parts[s];for(r=0,o=m.length,q=o-1;r<o;q=r++){v=m[r];u=m[q];if(((v.y>l.y)!==(u.y>l.y))&&(l.x<(u.x-v.x)*(l.y-v.y)/(u.y-v.y)+v.x)){n=!n}}}return n}});a.Circle.include(!a.Path.CANVAS?{}:{_drawPath:function(){var i=this._point;this._ctx.beginPath();this._ctx.arc(i.x,i.y,this._radius,0,Math.PI*2,false)},_containsPoint:function(k){var j=this._point,i=this.options.stroke?this.options.weight/2:0;return(k.distanceTo(j)<=this._radius+i)}});a.CircleMarker.include(!a.Path.CANVAS?{}:{_updateStyle:function(){a.Path.prototype._updateStyle.call(this)}});a.GeoJSON=a.FeatureGroup.extend({initialize:function(j,i){a.setOptions(this,i);this._layers={};if(j){this.addData(j)}},addData:function(l){var p=a.Util.isArray(l)?l:l.features,o,j,n;if(p){for(o=0,j=p.length;o<j;o++){n=p[o];if(n.geometries||n.geometry||n.features||n.coordinates){this.addData(p[o])}}return this}var k=this.options;if(k.filter&&!k.filter(l)){return}var m=a.GeoJSON.geometryToLayer(l,k.pointToLayer,k.coordsToLatLng,k);m.feature=a.GeoJSON.asFeature(l);m.defaultOptions=m.options;this.resetStyle(m);if(k.onEachFeature){k.onEachFeature(l,m)}return this.addLayer(m)},resetStyle:function(i){var j=this.options.style;if(j){a.Util.extend(i.options,i.defaultOptions);this._setLayerStyle(i,j)}},setStyle:function(i){this.eachLayer(function(j){this._setLayerStyle(j,i)},this)},_setLayerStyle:function(i,j){if(typeof j==="function"){j=j(i.feature)}if(i.setStyle){i.setStyle(j)}}});a.extend(a.GeoJSON,{geometryToLayer:function(k,l,m,q){var s=k.type==="Feature"?k.geometry:k,t=s.coordinates,p=[],n,j,o,r;m=m||this.coordsToLatLng;switch(s.type){case"Point":n=m(t);return l?l(k,n):new a.Marker(n);case"MultiPoint":for(o=0,r=t.length;o<r;o++){n=m(t[o]);p.push(l?l(k,n):new a.Marker(n))}return new a.FeatureGroup(p);case"LineString":j=this.coordsToLatLngs(t,0,m);return new a.Polyline(j,q);case"Polygon":if(t.length===2&&!t[1].length){throw new Error("Invalid GeoJSON object.")}j=this.coordsToLatLngs(t,1,m);return new a.Polygon(j,q);case"MultiLineString":j=this.coordsToLatLngs(t,1,m);return new a.MultiPolyline(j,q);case"MultiPolygon":j=this.coordsToLatLngs(t,2,m);return new a.MultiPolygon(j,q);case"GeometryCollection":for(o=0,r=s.geometries.length;o<r;o++){p.push(this.geometryToLayer({geometry:s.geometries[o],type:"Feature",properties:k.properties},l,m,q))}return new a.FeatureGroup(p);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(i){return new a.LatLng(i[1],i[0],i[2])},coordsToLatLngs:function(n,m,p){var o,l,k,j=[];for(l=0,k=n.length;l<k;l++){o=m?this.coordsToLatLngs(n[l],m-1,p):(p||this.coordsToLatLng)(n[l]);j.push(o)}return j},latLngToCoords:function(j){var i=[j.lng,j.lat];if(j.alt!==h){i.push(j.alt)}return i},latLngsToCoords:function(m){var l=[];for(var k=0,j=m.length;k<j;k++){l.push(a.GeoJSON.latLngToCoords(m[k]))}return l},getFeature:function(j,i){return j.feature?a.extend({},j.feature,{geometry:i}):a.GeoJSON.asFeature(i)},asFeature:function(i){if(i.type==="Feature"){return i}return{type:"Feature",properties:{},geometry:i}}});var c={toGeoJSON:function(){return a.GeoJSON.getFeature(this,{type:"Point",coordinates:a.GeoJSON.latLngToCoords(this.getLatLng())})}};a.Marker.include(c);a.Circle.include(c);a.CircleMarker.include(c);a.Polyline.include({toGeoJSON:function(){return a.GeoJSON.getFeature(this,{type:"LineString",coordinates:a.GeoJSON.latLngsToCoords(this.getLatLngs())})}});a.Polygon.include({toGeoJSON:function(){var m=[a.GeoJSON.latLngsToCoords(this.getLatLngs())],k,j,l;m[0].push(m[0][0]);if(this._holes){for(k=0,j=this._holes.length;k<j;k++){l=a.GeoJSON.latLngsToCoords(this._holes[k]);l.push(l[0]);m.push(l)}}return a.GeoJSON.getFeature(this,{type:"Polygon",coordinates:m})}});(function(){function i(j){return function(){var k=[];this.eachLayer(function(l){k.push(l.toGeoJSON().geometry.coordinates)});return a.GeoJSON.getFeature(this,{type:j,coordinates:k})}}a.MultiPolyline.include({toGeoJSON:i("MultiLineString")});a.MultiPolygon.include({toGeoJSON:i("MultiPolygon")});a.LayerGroup.include({toGeoJSON:function(){var m=this.feature&&this.feature.geometry,l=[],k;if(m&&m.type==="MultiPoint"){return i("MultiPoint").call(this)}var j=m&&m.type==="GeometryCollection";this.eachLayer(function(n){if(n.toGeoJSON){k=n.toGeoJSON();l.push(j?k.geometry:a.GeoJSON.asFeature(k))}});if(j){return a.GeoJSON.getFeature(this,{geometries:l,type:"GeometryCollection"})}return{type:"FeatureCollection",features:l}}})}());a.geoJson=function(j,i){return new a.GeoJSON(j,i)};a.DomEvent={addListener:function(l,n,o,j){var i=a.stamp(o),p="_leaflet_"+n+i,q,m,k;if(l[p]){return this}q=function(r){return o.call(j||l,r||a.DomEvent._getEvent())};if(a.Browser.pointer&&n.indexOf("touch")===0){return this.addPointerListener(l,n,q,i)}if(a.Browser.touch&&(n==="dblclick")&&this.addDoubleTapListener){this.addDoubleTapListener(l,q,i)}if("addEventListener" in l){if(n==="mousewheel"){l.addEventListener("DOMMouseScroll",q,false);l.addEventListener(n,q,false)}else{if((n==="mouseenter")||(n==="mouseleave")){m=q;k=(n==="mouseenter"?"mouseover":"mouseout");q=function(r){if(!a.DomEvent._checkMouse(l,r)){return}return m(r)};l.addEventListener(k,q,false)}else{if(n==="click"&&a.Browser.android){m=q;q=function(r){return a.DomEvent._filterClick(r,m)};l.addEventListener(n,q,false)}else{l.addEventListener(n,q,false)}}}}else{if("attachEvent" in l){l.attachEvent("on"+n,q)}}l[p]=q;return this},removeListener:function(m,l,k){var n=a.stamp(k),i="_leaflet_"+l+n,j=m[i];if(!j){return this}if(a.Browser.pointer&&l.indexOf("touch")===0){this.removePointerListener(m,l,n)}else{if(a.Browser.touch&&(l==="dblclick")&&this.removeDoubleTapListener){this.removeDoubleTapListener(m,n)}else{if("removeEventListener" in m){if(l==="mousewheel"){m.removeEventListener("DOMMouseScroll",j,false);m.removeEventListener(l,j,false)}else{if((l==="mouseenter")||(l==="mouseleave")){m.removeEventListener((l==="mouseenter"?"mouseover":"mouseout"),j,false)}else{m.removeEventListener(l,j,false)}}}else{if("detachEvent" in m){m.detachEvent("on"+l,j)}}}}m[i]=null;return this},stopPropagation:function(i){if(i.stopPropagation){i.stopPropagation()}else{i.cancelBubble=true}a.DomEvent._skipped(i);return this},disableScrollPropagation:function(j){var i=a.DomEvent.stopPropagation;return a.DomEvent.on(j,"mousewheel",i).on(j,"MozMousePixelScroll",i)},disableClickPropagation:function(l){var k=a.DomEvent.stopPropagation;for(var j=a.Draggable.START.length-1;j>=0;j--){a.DomEvent.on(l,a.Draggable.START[j],k)}return a.DomEvent.on(l,"click",a.DomEvent._fakeStop).on(l,"dblclick",k)},preventDefault:function(i){if(i.preventDefault){i.preventDefault()}else{i.returnValue=false}return this},stop:function(i){return a.DomEvent.preventDefault(i).stopPropagation(i)},getMousePosition:function(k,i){if(!i){return new a.Point(k.clientX,k.clientY)}var j=i.getBoundingClientRect();return new a.Point(k.clientX-j.left-i.clientLeft,k.clientY-j.top-i.clientTop)},getWheelDelta:function(i){var j=0;if(i.wheelDelta){j=i.wheelDelta/120}if(i.detail){j=-i.detail/3}return j},_skipEvents:{},_fakeStop:function(i){a.DomEvent._skipEvents[i.type]=true},_skipped:function(j){var i=this._skipEvents[j.type];this._skipEvents[j.type]=false;return i},_checkMouse:function(i,l){var k=l.relatedTarget;if(!k){return true}try{while(k&&(k!==i)){k=k.parentNode}}catch(j){return false}return(k!==i)},_getEvent:function(){var j=d.event;if(!j){var i=arguments.callee.caller;while(i){j=i["arguments"][0];if(j&&d.Event===j.constructor){break}i=i.caller}}return j},_filterClick:function(l,k){var j=(l.timeStamp||l.originalEvent.timeStamp),i=a.DomEvent._lastClick&&(j-a.DomEvent._lastClick);if((i&&i>100&&i<1000)||(l.target._simulatedClick&&!l._simulated)){a.DomEvent.stop(l);return}a.DomEvent._lastClick=j;return k(l)}};a.DomEvent.on=a.DomEvent.addListener;a.DomEvent.off=a.DomEvent.removeListener;a.Draggable=a.Class.extend({includes:a.Mixin.Events,statics:{START:a.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(i,j){this._element=i;this._dragStartTarget=j||i},enable:function(){if(this._enabled){return}for(var j=a.Draggable.START.length-1;j>=0;j--){a.DomEvent.on(this._dragStartTarget,a.Draggable.START[j],this._onDown,this)}this._enabled=true},disable:function(){if(!this._enabled){return}for(var j=a.Draggable.START.length-1;j>=0;j--){a.DomEvent.off(this._dragStartTarget,a.Draggable.START[j],this._onDown,this)}this._enabled=false;this._moved=false},_onDown:function(i){this._moved=false;if(i.shiftKey||((i.which!==1)&&(i.button!==1)&&!i.touches)){return}a.DomEvent.stopPropagation(i);if(a.Draggable._disabled){return}a.DomUtil.disableImageDrag();a.DomUtil.disableTextSelection();if(this._moving){return}var j=i.touches?i.touches[0]:i;this._startPoint=new a.Point(j.clientX,j.clientY);this._startPos=this._newPos=a.DomUtil.getPosition(this._element);a.DomEvent.on(b,a.Draggable.MOVE[i.type],this._onMove,this).on(b,a.Draggable.END[i.type],this._onUp,this)},_onMove:function(j){if(j.touches&&j.touches.length>1){this._moved=true;return}var l=(j.touches&&j.touches.length===1?j.touches[0]:j),i=new a.Point(l.clientX,l.clientY),k=i.subtract(this._startPoint);if(!k.x&&!k.y){return}a.DomEvent.preventDefault(j);if(!this._moved){this.fire("dragstart");this._moved=true;this._startPos=a.DomUtil.getPosition(this._element).subtract(k);a.DomUtil.addClass(b.body,"leaflet-dragging");a.DomUtil.addClass((j.target||j.srcElement),"leaflet-drag-target")}this._newPos=this._startPos.add(k);this._moving=true;a.Util.cancelAnimFrame(this._animRequest);this._animRequest=a.Util.requestAnimFrame(this._updatePosition,this,true,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag");a.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},_onUp:function(k){a.DomUtil.removeClass(b.body,"leaflet-dragging");a.DomUtil.removeClass((k.target||k.srcElement),"leaflet-drag-target");for(var j in a.Draggable.MOVE){a.DomEvent.off(b,a.Draggable.MOVE[j],this._onMove).off(b,a.Draggable.END[j],this._onUp)}a.DomUtil.enableImageDrag();a.DomUtil.enableTextSelection();if(this._moved&&this._moving){a.Util.cancelAnimFrame(this._animRequest);this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})}this._moving=false}});a.Handler=a.Class.extend({initialize:function(i){this._map=i},enable:function(){if(this._enabled){return}this._enabled=true;this.addHooks()},disable:function(){if(!this._enabled){return}this._enabled=false;this.removeHooks()},enabled:function(){return !!this._enabled}});a.Map.mergeOptions({dragging:true,inertia:!a.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:a.Browser.touch?32:18,easeLinearity:0.25,worldCopyJump:false});a.Map.Drag=a.Handler.extend({addHooks:function(){if(!this._draggable){var i=this._map;this._draggable=new a.Draggable(i._mapPane,i._container);this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);if(i.options.worldCopyJump){this._draggable.on("predrag",this._onPreDrag,this);i.on("viewreset",this._onViewReset,this);i.whenReady(this._onViewReset,this)}}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var i=this._map;if(i._panAnim){i._panAnim.stop()}i.fire("movestart").fire("dragstart");if(i.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(){if(this._map.options.inertia){var i=this._lastTime=+new Date(),j=this._lastPos=this._draggable._newPos;this._positions.push(j);this._times.push(i);if(i-this._times[0]>200){this._positions.shift();this._times.shift()}}this._map.fire("move").fire("drag")},_onViewReset:function(){var j=this._map.getSize()._divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(j).x;this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var o=this._worldWidth,n=Math.round(o/2),j=this._initialWorldOffset,i=this._draggable._newPos.x,l=(i-n+j)%o+n-j,k=(i+n+j)%o-n-j,m=Math.abs(l+j)<Math.abs(k+j)?l:k;this._draggable._newPos.x=m},_onDragEnd:function(r){var j=this._map,v=j.options,q=+new Date()-this._lastTime,i=!v.inertia||q>v.inertiaThreshold||!this._positions[0];j.fire("dragend",r);if(i){j.fire("moveend")}else{var s=this._lastPos.subtract(this._positions[0]),o=(this._lastTime+q-this._times[0])/1000,n=v.easeLinearity,m=s.multiplyBy(n/o),l=m.distanceTo([0,0]),u=Math.min(v.inertiaMaxSpeed,l),t=m.multiplyBy(u/l),k=u/(v.inertiaDeceleration*n),p=t.multiplyBy(-k/2).round();if(!p.x||!p.y){j.fire("moveend")}else{p=j._limitOffset(p,j.options.maxBounds);a.Util.requestAnimFrame(function(){j.panBy(p,{duration:k,easeLinearity:n,noMoveStart:true})})}}}});a.Map.addInitHook("addHandler","dragging",a.Map.Drag);a.Map.mergeOptions({doubleClickZoom:true});a.Map.DoubleClickZoom=a.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(k){var j=this._map,i=j.getZoom()+(k.originalEvent.shiftKey?-1:1);if(j.options.doubleClickZoom==="center"){j.setZoom(i)}else{j.setZoomAround(k.containerPoint,i)}}});a.Map.addInitHook("addHandler","doubleClickZoom",a.Map.DoubleClickZoom);a.Map.mergeOptions({scrollWheelZoom:true});a.Map.ScrollWheelZoom=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);a.DomEvent.on(this._map._container,"MozMousePixelScroll",a.DomEvent.preventDefault);this._delta=0},removeHooks:function(){a.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll);a.DomEvent.off(this._map._container,"MozMousePixelScroll",a.DomEvent.preventDefault)},_onWheelScroll:function(j){var k=a.DomEvent.getWheelDelta(j);this._delta+=k;this._lastMousePos=this._map.mouseEventToContainerPoint(j);if(!this._startTime){this._startTime=+new Date()}var i=Math.max(40-(+new Date()-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(a.bind(this._performZoom,this),i);a.DomEvent.preventDefault(j);a.DomEvent.stopPropagation(j)},_performZoom:function(){var j=this._map,k=this._delta,i=j.getZoom();k=k>0?Math.ceil(k):Math.floor(k);k=Math.max(Math.min(k,4),-4);k=j._limitZoom(i+k)-i;this._delta=0;this._startTime=null;if(!k){return}if(j.options.scrollWheelZoom==="center"){j.setZoom(i+k)}else{j.setZoomAround(this._lastMousePos,i+k)}}});a.Map.addInitHook("addHandler","scrollWheelZoom",a.Map.ScrollWheelZoom);a.extend(a.DomEvent,{_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",_touchend:a.Browser.msPointer?"MSPointerUp":a.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(n,v,i){var u,q=false,o=250,m,k="_leaflet_",p=this._touchstart,t=this._touchend,s=[];function l(y){var x;if(a.Browser.pointer){s.push(y.pointerId);x=s.length}else{x=y.touches.length}if(x>1){return}var w=Date.now(),z=w-(u||w);m=y.touches?y.touches[0]:y;q=(z>0&&z<=o);u=w}function r(z){if(a.Browser.pointer){var x=s.indexOf(z.pointerId);if(x===-1){return}s.splice(x,1)}if(q){if(a.Browser.pointer){var w={},A;for(var y in m){A=m[y];if(typeof A==="function"){w[y]=A.bind(m)}else{w[y]=A}}m=w}m.type="dblclick";v(m);u=null}}n[k+p+i]=l;n[k+t+i]=r;var j=a.Browser.pointer?b.documentElement:n;n.addEventListener(p,l,false);j.addEventListener(t,r,false);if(a.Browser.pointer){j.addEventListener(a.DomEvent.POINTER_CANCEL,r,false)}return this},removeDoubleTapListener:function(j,k){var i="_leaflet_";j.removeEventListener(this._touchstart,j[i+this._touchstart+k],false);(a.Browser.pointer?b.documentElement:j).removeEventListener(this._touchend,j[i+this._touchend+k],false);if(a.Browser.pointer){b.documentElement.removeEventListener(a.DomEvent.POINTER_CANCEL,j[i+this._touchend+k],false)}return this}});a.extend(a.DomEvent,{POINTER_DOWN:a.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:a.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:a.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:a.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:false,addPointerListener:function(k,j,i,l){switch(j){case"touchstart":return this.addPointerListenerStart(k,j,i,l);case"touchend":return this.addPointerListenerEnd(k,j,i,l);case"touchmove":return this.addPointerListenerMove(k,j,i,l);default:throw"Unknown touch event type"}},addPointerListenerStart:function(o,m,l,p){var n="_leaflet_",j=this._pointers;var i=function(s){a.DomEvent.preventDefault(s);var r=false;for(var q=0;q<j.length;q++){if(j[q].pointerId===s.pointerId){r=true;break}}if(!r){j.push(s)}s.touches=j.slice();s.changedTouches=[s];l(s)};o[n+"touchstart"+p]=i;o.addEventListener(this.POINTER_DOWN,i,false);if(!this._pointerDocumentListener){var k=function(r){for(var q=0;q<j.length;q++){if(j[q].pointerId===r.pointerId){j.splice(q,1);break}}};b.documentElement.addEventListener(this.POINTER_UP,k,false);b.documentElement.addEventListener(this.POINTER_CANCEL,k,false);this._pointerDocumentListener=true}return this},addPointerListenerMove:function(n,k,j,o){var m="_leaflet_",l=this._pointers;function i(q){if((q.pointerType===q.MSPOINTER_TYPE_MOUSE||q.pointerType==="mouse")&&q.buttons===0){return}for(var p=0;p<l.length;p++){if(l[p].pointerId===q.pointerId){l[p]=q;break}}q.touches=l.slice();q.changedTouches=[q];j(q)}n[m+"touchmove"+o]=i;n.addEventListener(this.POINTER_MOVE,i,false);return this},addPointerListenerEnd:function(n,k,j,o){var m="_leaflet_",l=this._pointers;var i=function(q){for(var p=0;p<l.length;p++){if(l[p].pointerId===q.pointerId){l.splice(p,1);break}}q.touches=l.slice();q.changedTouches=[q];j(q)};n[m+"touchend"+o]=i;n.addEventListener(this.POINTER_UP,i,false);n.addEventListener(this.POINTER_CANCEL,i,false);return this},removePointerListener:function(l,j,m){var k="_leaflet_",i=l[k+j+m];switch(j){case"touchstart":l.removeEventListener(this.POINTER_DOWN,i,false);break;case"touchmove":l.removeEventListener(this.POINTER_MOVE,i,false);break;case"touchend":l.removeEventListener(this.POINTER_UP,i,false);l.removeEventListener(this.POINTER_CANCEL,i,false);break}return this}});a.Map.mergeOptions({touchZoom:a.Browser.touch&&!a.Browser.android23,bounceAtZoomLimits:true});a.Map.TouchZoom=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){a.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(l){var k=this._map;if(!l.touches||l.touches.length!==2||k._animatingZoom||this._zooming){return}var m=k.mouseEventToLayerPoint(l.touches[0]),j=k.mouseEventToLayerPoint(l.touches[1]),i=k._getCenterLayerPoint();this._startCenter=m.add(j)._divideBy(2);this._startDist=m.distanceTo(j);this._moved=false;this._zooming=true;this._centerOffset=i.subtract(this._startCenter);if(k._panAnim){k._panAnim.stop()}a.DomEvent.on(b,"touchmove",this._onTouchMove,this).on(b,"touchend",this._onTouchEnd,this);a.DomEvent.preventDefault(l)},_onTouchMove:function(k){var j=this._map;if(!k.touches||k.touches.length!==2||!this._zooming){return}var l=j.mouseEventToLayerPoint(k.touches[0]),i=j.mouseEventToLayerPoint(k.touches[1]);this._scale=l.distanceTo(i)/this._startDist;this._delta=l._add(i)._divideBy(2)._subtract(this._startCenter);if(this._scale===1){return}if(!j.options.bounceAtZoomLimits){if((j.getZoom()===j.getMinZoom()&&this._scale<1)||(j.getZoom()===j.getMaxZoom()&&this._scale>1)){return}}if(!this._moved){a.DomUtil.addClass(j._mapPane,"leaflet-touching");j.fire("movestart").fire("zoomstart");this._moved=true}a.Util.cancelAnimFrame(this._animRequest);this._animRequest=a.Util.requestAnimFrame(this._updateOnMove,this,true,this._map._container);a.DomEvent.preventDefault(k)},_updateOnMove:function(){var l=this._map,j=this._getScaleOrigin(),i=l.layerPointToLatLng(j),k=l.getScaleZoom(this._scale);l._animateZoom(i,k,this._startCenter,this._scale,this._delta)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return}var o=this._map;this._zooming=false;a.DomUtil.removeClass(o._mapPane,"leaflet-touching");a.Util.cancelAnimFrame(this._animRequest);a.DomEvent.off(b,"touchmove",this._onTouchMove).off(b,"touchend",this._onTouchEnd);var k=this._getScaleOrigin(),j=o.layerPointToLatLng(k),n=o.getZoom(),i=o.getScaleZoom(this._scale)-n,l=(i>0?Math.ceil(i):Math.floor(i)),m=o._limitZoom(n+l),p=o.getZoomScale(m)/this._scale;o._animateZoom(j,m,k,p)},_getScaleOrigin:function(){var i=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(i)}});a.Map.addInitHook("addHandler","touchZoom",a.Map.TouchZoom);a.Map.mergeOptions({tap:true,tapTolerance:15});a.Map.Tap=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){a.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(j){if(!j.touches){return}a.DomEvent.preventDefault(j);this._fireClick=true;if(j.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return}var k=j.touches[0],i=k.target;this._startPos=this._newPos=new a.Point(k.clientX,k.clientY);if(i.tagName&&i.tagName.toLowerCase()==="a"){a.DomUtil.addClass(i,"leaflet-active")}this._holdTimeout=setTimeout(a.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent("contextmenu",k)}},this),1000);a.DomEvent.on(b,"touchmove",this._onMove,this).on(b,"touchend",this._onUp,this)},_onUp:function(j){clearTimeout(this._holdTimeout);a.DomEvent.off(b,"touchmove",this._onMove,this).off(b,"touchend",this._onUp,this);if(this._fireClick&&j&&j.changedTouches){var k=j.changedTouches[0],i=k.target;if(i&&i.tagName&&i.tagName.toLowerCase()==="a"){a.DomUtil.removeClass(i,"leaflet-active")}if(this._isTapValid()){this._simulateEvent("click",k)}}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(i){var j=i.touches[0];this._newPos=new a.Point(j.clientX,j.clientY)},_simulateEvent:function(i,k){var j=b.createEvent("MouseEvents");j._simulated=true;k.target._simulatedClick=true;j.initMouseEvent(i,true,true,d,1,k.screenX,k.screenY,k.clientX,k.clientY,false,false,false,false,0,null);k.target.dispatchEvent(j)}});if(a.Browser.touch&&!a.Browser.pointer){a.Map.addInitHook("addHandler","tap",a.Map.Tap)}a.Map.mergeOptions({boxZoom:true});a.Map.BoxZoom=a.Handler.extend({initialize:function(i){this._map=i;this._container=i._container;this._pane=i._panes.overlayPane;this._moved=false},addHooks:function(){a.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){a.DomEvent.off(this._container,"mousedown",this._onMouseDown);this._moved=false},moved:function(){return this._moved},_onMouseDown:function(i){this._moved=false;if(!i.shiftKey||((i.which!==1)&&(i.button!==1))){return false}a.DomUtil.disableTextSelection();a.DomUtil.disableImageDrag();this._startLayerPoint=this._map.mouseEventToLayerPoint(i);a.DomEvent.on(b,"mousemove",this._onMouseMove,this).on(b,"mouseup",this._onMouseUp,this).on(b,"keydown",this._onKeyDown,this)},_onMouseMove:function(m){if(!this._moved){this._box=a.DomUtil.create("div","leaflet-zoom-box",this._pane);a.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";this._map.fire("boxzoomstart")}var l=this._startLayerPoint,k=this._box,i=this._map.mouseEventToLayerPoint(m),n=i.subtract(l),j=new a.Point(Math.min(i.x,l.x),Math.min(i.y,l.y));a.DomUtil.setPosition(k,j);this._moved=true;k.style.width=(Math.max(0,Math.abs(n.x)-4))+"px";k.style.height=(Math.max(0,Math.abs(n.y)-4))+"px"},_finish:function(){if(this._moved){this._pane.removeChild(this._box);this._container.style.cursor=""}a.DomUtil.enableTextSelection();a.DomUtil.enableImageDrag();a.DomEvent.off(b,"mousemove",this._onMouseMove).off(b,"mouseup",this._onMouseUp).off(b,"keydown",this._onKeyDown)},_onMouseUp:function(l){this._finish();var k=this._map,i=k.mouseEventToLayerPoint(l);if(this._startLayerPoint.equals(i)){return}var j=new a.LatLngBounds(k.layerPointToLatLng(this._startLayerPoint),k.layerPointToLatLng(i));k.fitBounds(j);k.fire("boxzoomend",{boxZoomBounds:j})},_onKeyDown:function(i){if(i.keyCode===27){this._finish()}}});a.Map.addInitHook("addHandler","boxZoom",a.Map.BoxZoom);a.Map.mergeOptions({keyboard:true,keyboardPanOffset:80,keyboardZoomOffset:1});a.Map.Keyboard=a.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(i){this._map=i;this._setPanOffset(i.options.keyboardPanOffset);this._setZoomOffset(i.options.keyboardZoomOffset)},addHooks:function(){var i=this._map._container;if(i.tabIndex===-1){i.tabIndex="0"}a.DomEvent.on(i,"focus",this._onFocus,this).on(i,"blur",this._onBlur,this).on(i,"mousedown",this._onMouseDown,this);this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var i=this._map._container;a.DomEvent.off(i,"focus",this._onFocus,this).off(i,"blur",this._onBlur,this).off(i,"mousedown",this._onMouseDown,this);this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(this._focused){return}var i=b.body,l=b.documentElement,k=i.scrollTop||l.scrollTop,j=i.scrollLeft||l.scrollLeft;this._map._container.focus();d.scrollTo(j,k)},_onFocus:function(){this._focused=true;this._map.fire("focus")},_onBlur:function(){this._focused=false;this._map.fire("blur")},_setPanOffset:function(n){var m=this._panKeys={},k=this.keyCodes,l,j;for(l=0,j=k.left.length;l<j;l++){m[k.left[l]]=[-1*n,0]}for(l=0,j=k.right.length;l<j;l++){m[k.right[l]]=[n,0]}for(l=0,j=k.down.length;l<j;l++){m[k.down[l]]=[0,n]}for(l=0,j=k.up.length;l<j;l++){m[k.up[l]]=[0,-1*n]}},_setZoomOffset:function(n){var m=this._zoomKeys={},k=this.keyCodes,l,j;for(l=0,j=k.zoomIn.length;l<j;l++){m[k.zoomIn[l]]=n}for(l=0,j=k.zoomOut.length;l<j;l++){m[k.zoomOut[l]]=-n}},_addHooks:function(){a.DomEvent.on(b,"keydown",this._onKeyDown,this)},_removeHooks:function(){a.DomEvent.off(b,"keydown",this._onKeyDown,this)},_onKeyDown:function(k){var i=k.keyCode,j=this._map;if(i in this._panKeys){if(j._panAnim&&j._panAnim._inProgress){return}j.panBy(this._panKeys[i]);if(j.options.maxBounds){j.panInsideBounds(j.options.maxBounds)}}else{if(i in this._zoomKeys){j.setZoom(j.getZoom()+this._zoomKeys[i])}else{return}}a.DomEvent.stop(k)}});a.Map.addInitHook("addHandler","keyboard",a.Map.Keyboard);a.Handler.MarkerDrag=a.Handler.extend({initialize:function(i){this._marker=i},addHooks:function(){var i=this._marker._icon;if(!this._draggable){this._draggable=new a.Draggable(i,i)}this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this);this._draggable.enable();a.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this);this._draggable.disable();a.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var i=this._marker,l=i._shadow,j=a.DomUtil.getPosition(i._icon),k=i._map.layerPointToLatLng(j);if(l){a.DomUtil.setPosition(l,j)}i._latlng=k;i.fire("move",{latlng:k}).fire("drag")},_onDragEnd:function(i){this._marker.fire("moveend").fire("dragend",i)}});a.Control=a.Class.extend({options:{position:"topright"},initialize:function(i){a.setOptions(this,i)},getPosition:function(){return this.options.position},setPosition:function(i){var j=this._map;if(j){j.removeControl(this)}this.options.position=i;if(j){j.addControl(this)}return this},getContainer:function(){return this._container},addTo:function(k){this._map=k;var i=this._container=this.onAdd(k),l=this.getPosition(),j=k._controlCorners[l];a.DomUtil.addClass(i,"leaflet-control");if(l.indexOf("bottom")!==-1){j.insertBefore(i,j.firstChild)}else{j.appendChild(i)}return this},removeFrom:function(j){var k=this.getPosition(),i=j._controlCorners[k];i.removeChild(this._container);this._map=null;if(this.onRemove){this.onRemove(j)}return this},_refocusOnMap:function(){if(this._map){this._map.getContainer().focus()}}});a.control=function(i){return new a.Control(i)};a.Map.include({addControl:function(i){i.addTo(this);return this},removeControl:function(i){i.removeFrom(this);return this},_initControlPos:function(){var k=this._controlCorners={},j="leaflet-",i=this._controlContainer=a.DomUtil.create("div",j+"control-container",this._container);function m(n,o){var l=j+n+" "+j+o;k[n+o]=a.DomUtil.create("div",l,i)}m("top","left");m("top","right");m("bottom","left");m("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}});a.Control.Zoom=a.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(j){var k="leaflet-control-zoom",i=a.DomUtil.create("div",k+" leaflet-bar");this._map=j;this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,k+"-in",i,this._zoomIn,this);this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,k+"-out",i,this._zoomOut,this);this._updateDisabled();j.on("zoomend zoomlevelschange",this._updateDisabled,this);return i},onRemove:function(i){i.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(i){this._map.zoomIn(i.shiftKey?3:1)},_zoomOut:function(i){this._map.zoomOut(i.shiftKey?3:1)},_createButton:function(l,p,n,i,m,k){var o=a.DomUtil.create("a",n,i);o.innerHTML=l;o.href="#";o.title=p;var j=a.DomEvent.stopPropagation;a.DomEvent.on(o,"click",j).on(o,"mousedown",j).on(o,"dblclick",j).on(o,"click",a.DomEvent.preventDefault).on(o,"click",m,k).on(o,"click",this._refocusOnMap,k);return o},_updateDisabled:function(){var j=this._map,i="leaflet-disabled";a.DomUtil.removeClass(this._zoomInButton,i);a.DomUtil.removeClass(this._zoomOutButton,i);if(j._zoom===j.getMinZoom()){a.DomUtil.addClass(this._zoomOutButton,i)}if(j._zoom===j.getMaxZoom()){a.DomUtil.addClass(this._zoomInButton,i)}}});a.Map.mergeOptions({zoomControl:true});a.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new a.Control.Zoom();this.addControl(this.zoomControl)}});a.control.zoom=function(i){return new a.Control.Zoom(i)};a.Control.Attribution=a.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(i){a.setOptions(this,i);this._attributions={}},onAdd:function(k){this._container=a.DomUtil.create("div","leaflet-control-attribution");a.DomEvent.disableClickPropagation(this._container);for(var j in k._layers){if(k._layers[j].getAttribution){this.addAttribution(k._layers[j].getAttribution())}}k.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(i){i.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(i){this.options.prefix=i;this._update();return this},addAttribution:function(i){if(!i){return}if(!this._attributions[i]){this._attributions[i]=0}this._attributions[i]++;this._update();return this},removeAttribution:function(i){if(!i){return}if(this._attributions[i]){this._attributions[i]--;this._update()}return this},_update:function(){if(!this._map){return}var l=[];for(var j in this._attributions){if(this._attributions[j]){l.push(j)}}var k=[];if(this.options.prefix){k.push(this.options.prefix)}if(l.length){k.push(l.join(", "))}this._container.innerHTML=k.join(" | ")},_onLayerAdd:function(i){if(i.layer.getAttribution){this.addAttribution(i.layer.getAttribution())}},_onLayerRemove:function(i){if(i.layer.getAttribution){this.removeAttribution(i.layer.getAttribution())}}});a.Map.mergeOptions({attributionControl:true});a.Map.addInitHook(function(){if(this.options.attributionControl){this.attributionControl=(new a.Control.Attribution()).addTo(this)}});a.control.attribution=function(i){return new a.Control.Attribution(i)};a.Control.Scale=a.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:true,imperial:true,updateWhenIdle:false},onAdd:function(l){this._map=l;var k="leaflet-control-scale",i=a.DomUtil.create("div",k),j=this.options;this._addScales(j,k,i);l.on(j.updateWhenIdle?"moveend":"move",this._update,this);l.whenReady(this._update,this);return i},onRemove:function(i){i.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(j,k,i){if(j.metric){this._mScale=a.DomUtil.create("div",k+"-line",i)}if(j.imperial){this._iScale=a.DomUtil.create("div",k+"-line",i)}},_update:function(){var l=this._map.getBounds(),m=l.getCenter().lat,k=6378137*Math.PI*Math.cos(m*Math.PI/180),o=k*(l.getNorthEast().lng-l.getSouthWest().lng)/180,j=this._map.getSize(),i=this.options,n=0;if(j.x>0){n=o*(i.maxWidth/j.x)}this._updateScales(i,n)},_updateScales:function(i,j){if(i.metric&&j){this._updateMetric(j)}if(i.imperial&&j){this._updateImperial(j)}},_updateMetric:function(j){var i=this._getRoundNum(j);this._mScale.style.width=this._getScaleWidth(i/j)+"px";this._mScale.innerHTML=i<1000?i+" m":(i/1000)+" km"},_updateImperial:function(m){var l=m*3.2808399,n=this._iScale,k,j,i;if(l>5280){k=l/5280;j=this._getRoundNum(k);n.style.width=this._getScaleWidth(j/k)+"px";n.innerHTML=j+" mi"}else{i=this._getRoundNum(l);n.style.width=this._getScaleWidth(i/l)+"px";n.innerHTML=i+" ft"}},_getScaleWidth:function(i){return Math.round(this.options.maxWidth*i)-10},_getRoundNum:function(j){var i=Math.pow(10,(Math.floor(j)+"").length-1),k=j/i;k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:1;return i*k}});a.control.scale=function(i){return new a.Control.Scale(i)};a.Control.Layers=a.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true},initialize:function(m,l,j){a.setOptions(this,j);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(var k in m){this._addLayer(m[k],k)}for(k in l){this._addLayer(l[k],k,true)}},onAdd:function(i){this._initLayout();this._update();i.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this);return this._container},onRemove:function(i){i.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(j,i){this._addLayer(j,i);this._update();return this},addOverlay:function(j,i){this._addLayer(j,i,true);this._update();return this},removeLayer:function(i){var j=a.stamp(i);delete this._layers[j];this._update();return this},_initLayout:function(){var j="leaflet-control-layers",i=this._container=a.DomUtil.create("div",j);i.setAttribute("aria-haspopup",true);if(!a.Browser.touch){a.DomEvent.disableClickPropagation(i).disableScrollPropagation(i)}else{a.DomEvent.on(i,"click",a.DomEvent.stopPropagation)}var l=this._form=a.DomUtil.create("form",j+"-list");if(this.options.collapsed){if(!a.Browser.android){a.DomEvent.on(i,"mouseover",this._expand,this).on(i,"mouseout",this._collapse,this)}var k=this._layersLink=a.DomUtil.create("a",j+"-toggle",i);k.href="#";k.title="Layers";if(a.Browser.touch){a.DomEvent.on(k,"click",a.DomEvent.stop).on(k,"click",this._expand,this)}else{a.DomEvent.on(k,"focus",this._expand,this)}a.DomEvent.on(l,"click",function(){setTimeout(a.bind(this._onInputClick,this),0)},this);this._map.on("click",this._collapse,this)}else{this._expand()}this._baseLayersList=a.DomUtil.create("div",j+"-base",l);this._separator=a.DomUtil.create("div",j+"-separator",l);this._overlaysList=a.DomUtil.create("div",j+"-overlays",l);i.appendChild(l)},_addLayer:function(k,j,i){var l=a.stamp(k);this._layers[l]={layer:k,name:j,overlay:i};if(this.options.autoZIndex&&k.setZIndex){this._lastZIndex++;k.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container){return}this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";var j=false,l=false,k,m;for(k in this._layers){m=this._layers[k];this._addItem(m);l=l||m.overlay;j=j||!m.overlay}this._separator.style.display=l&&j?"":"none"},_onLayerChange:function(k){var j=this._layers[a.stamp(k.layer)];if(!j){return}if(!this._handlingClick){this._update()}var i=j.overlay?(k.type==="layeradd"?"overlayadd":"overlayremove"):(k.type==="layeradd"?"baselayerchange":null);if(i){this._map.fire(i,j)}},_createRadioElement:function(i,l){var k='<input type="radio" class="leaflet-control-layers-selector" name="'+i+'"';if(l){k+=' checked="checked"'}k+="/>";var j=b.createElement("div");j.innerHTML=k;return j.firstChild},_addItem:function(n){var l=b.createElement("label"),j,m=this._map.hasLayer(n.layer);if(n.overlay){j=b.createElement("input");j.type="checkbox";j.className="leaflet-control-layers-selector";j.defaultChecked=m}else{j=this._createRadioElement("leaflet-base-layers",m)}j.layerId=a.stamp(n.layer);a.DomEvent.on(j,"click",this._onInputClick,this);var k=b.createElement("span");k.innerHTML=" "+n.name;l.appendChild(j);l.appendChild(k);var i=n.overlay?this._overlaysList:this._baseLayersList;i.appendChild(l);return l},_onInputClick:function(){var l,k,n,j=this._form.getElementsByTagName("input"),m=j.length;this._handlingClick=true;for(l=0;l<m;l++){k=j[l];n=this._layers[k.layerId];if(k.checked&&!this._map.hasLayer(n.layer)){this._map.addLayer(n.layer)}else{if(!k.checked&&this._map.hasLayer(n.layer)){this._map.removeLayer(n.layer)}}}this._handlingClick=false;this._refocusOnMap()},_expand:function(){a.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}});a.control.layers=function(k,j,i){return new a.Control.Layers(k,j,i)};a.PosAnimation=a.Class.extend({includes:a.Mixin.Events,run:function(j,i,k,l){this.stop();this._el=j;this._inProgress=true;this._newPos=i;this.fire("start");j.style[a.DomUtil.TRANSITION]="all "+(k||0.25)+"s cubic-bezier(0,0,"+(l||0.5)+",1)";a.DomEvent.on(j,a.DomUtil.TRANSITION_END,this._onTransitionEnd,this);a.DomUtil.setPosition(j,i);a.Util.falseFn(j.offsetWidth);this._stepTimer=setInterval(a.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress){return}a.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();a.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var i=this._getPos();if(!i){this._onTransitionEnd();return}this._el._leaflet_pos=i;this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var m,l,k,j=this._el,i=d.getComputedStyle(j);if(a.Browser.any3d){k=i[a.DomUtil.TRANSFORM].match(this._transformRe);if(!k){return}m=parseFloat(k[1]);l=parseFloat(k[2])}else{m=parseFloat(i.left);l=parseFloat(i.top)}return new a.Point(m,l,true)},_onTransitionEnd:function(){a.DomEvent.off(this._el,a.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress){return}this._inProgress=false;this._el.style[a.DomUtil.TRANSITION]="";this._el._leaflet_pos=this._newPos;clearInterval(this._stepTimer);this.fire("step").fire("end")}});a.Map.include({setView:function(i,l,j){l=l===h?this._zoom:this._limitZoom(l);i=this._limitCenter(a.latLng(i),l,this.options.maxBounds);j=j||{};if(this._panAnim){this._panAnim.stop()}if(this._loaded&&!j.reset&&j!==true){if(j.animate!==h){j.zoom=a.extend({animate:j.animate},j.zoom);j.pan=a.extend({animate:j.animate},j.pan)}var k=(this._zoom!==l)?this._tryAnimatedZoom&&this._tryAnimatedZoom(i,l,j.zoom):this._tryAnimatedPan(i,j.pan);if(k){clearTimeout(this._sizeTimer);return this}}this._resetView(i,l);return this},panBy:function(k,i){k=a.point(k).round();i=i||{};if(!k.x&&!k.y){return this}if(!this._panAnim){this._panAnim=new a.PosAnimation();this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}if(!i.noMoveStart){this.fire("movestart")}if(i.animate!==false){a.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var j=this._getMapPanePos().subtract(k);this._panAnim.run(this._mapPane,j,i.duration||0.25,i.easeLinearity)}else{this._rawPanBy(k);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){a.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(i,j){var k=this._getCenterOffset(i)._floor();if((j&&j.animate)!==true&&!this.getSize().contains(k)){return false}this.panBy(k,j);return true}});a.PosAnimation=a.DomUtil.TRANSITION?a.PosAnimation:a.PosAnimation.extend({run:function(j,i,k,l){this.stop();this._el=j;this._inProgress=true;this._duration=k||0.25;this._easeOutPower=1/Math.max(l||0.5,0.2);this._startPos=a.DomUtil.getPosition(j);this._offset=i.subtract(this._startPos);this._startTime=+new Date();this.fire("start");this._animate()},stop:function(){if(!this._inProgress){return}this._step();this._complete()},_animate:function(){this._animId=a.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(){var i=(+new Date())-this._startTime,j=this._duration*1000;if(i<j){this._runFrame(this._easeOut(i/j))}else{this._runFrame(1);this._complete()}},_runFrame:function(i){var j=this._startPos.add(this._offset.multiplyBy(i));a.DomUtil.setPosition(this._el,j);this.fire("step")},_complete:function(){a.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire("end")},_easeOut:function(i){return 1-Math.pow(1-i,this._easeOutPower)}});a.Map.mergeOptions({zoomAnimation:true,zoomAnimationThreshold:4});if(a.DomUtil.TRANSITION){a.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&a.DomUtil.TRANSITION&&a.Browser.any3d&&!a.Browser.android23&&!a.Browser.mobileOpera;if(this._zoomAnimated){a.DomEvent.on(this._mapPane,a.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}})}a.Map.include(!a.DomUtil.TRANSITION?{}:{_catchTransitionEnd:function(i){if(this._animatingZoom&&i.propertyName.indexOf("transform")>=0){this._onZoomTransitionEnd()}},_nothingToAnimate:function(){return !this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(i,l,k){if(this._animatingZoom){return true}k=k||{};if(!this._zoomAnimated||k.animate===false||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold){return false}var n=this.getZoomScale(l),m=this._getCenterOffset(i)._divideBy(1-1/n),j=this._getCenterLayerPoint()._add(m);if(k.animate!==true&&!this.getSize().contains(m)){return false}this.fire("movestart").fire("zoomstart");this._animateZoom(i,l,j,n,null,true);return true},_animateZoom:function(i,l,k,m,n,j){this._animatingZoom=true;a.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim");this._animateToCenter=i;this._animateToZoom=l;if(a.Draggable){a.Draggable._disabled=true}this.fire("zoomanim",{center:i,zoom:l,origin:k,scale:m,delta:n,backwards:j})},_onZoomTransitionEnd:function(){this._animatingZoom=false;a.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._resetView(this._animateToCenter,this._animateToZoom,true,true);if(a.Draggable){a.Draggable._disabled=false}}});a.TileLayer.include({_animateZoom:function(m){if(!this._animating){this._animating=true;this._prepareBgBuffer()}var k=this._bgBuffer,i=a.DomUtil.TRANSFORM,j=m.delta?a.DomUtil.getTranslateString(m.delta):k.style[i],l=a.DomUtil.getScaleString(m.scale,m.origin);k.style[i]=m.backwards?l+" "+j:j+" "+l},_endZoomAnim:function(){var j=this._tileContainer,i=this._bgBuffer;j.style.visibility="";j.parentNode.appendChild(j);a.Util.falseFn(i.offsetWidth);this._animating=false},_clearBgBuffer:function(){var i=this._map;if(i&&!i._animatingZoom&&!i.touchZoom._zooming){this._bgBuffer.innerHTML="";this._bgBuffer.style[a.DomUtil.TRANSFORM]=""}},_prepareBgBuffer:function(){var k=this._tileContainer,j=this._bgBuffer;var i=this._getLoadedTilesPercentage(j),l=this._getLoadedTilesPercentage(k);if(j&&i>0.5&&l<0.5){k.style.visibility="hidden";this._stopLoadingImages(k);return}j.style.visibility="hidden";j.style[a.DomUtil.TRANSFORM]="";this._tileContainer=j;j=this._bgBuffer=k;this._stopLoadingImages(j);clearTimeout(this._clearBgBufferTimer)},_getLoadedTilesPercentage:function(k){var l=k.getElementsByTagName("img"),m,j,n=0;for(m=0,j=l.length;m<j;m++){if(l[m].complete){n++}}return n/j},_stopLoadingImages:function(k){var l=Array.prototype.slice.call(k.getElementsByTagName("img")),m,j,n;for(m=0,j=l.length;m<j;m++){n=l[m];if(!n.complete){n.onload=a.Util.falseFn;n.onerror=a.Util.falseFn;n.src=a.Util.emptyImageUrl;n.parentNode.removeChild(n)}}}});a.Map.include({_defaultLocateOptions:{watch:false,setView:false,maxZoom:Infinity,timeout:10000,maximumAge:0,enableHighAccuracy:false},locate:function(i){i=this._locateOptions=a.extend(this._defaultLocateOptions,i);if(!navigator.geolocation){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var k=a.bind(this._handleGeolocationResponse,this),j=a.bind(this._handleGeolocationError,this);if(i.watch){this._locationWatchId=navigator.geolocation.watchPosition(k,j,i)}else{navigator.geolocation.getCurrentPosition(k,j,i)}return this},stopLocate:function(){if(navigator.geolocation){navigator.geolocation.clearWatch(this._locationWatchId)}if(this._locateOptions){this._locateOptions.setView=false}return this},_handleGeolocationError:function(i){var k=i.code,j=i.message||(k===1?"permission denied":(k===2?"position unavailable":"timeout"));if(this._locateOptions.setView&&!this._loaded){this.fitWorld()}this.fire("locationerror",{code:k,message:"Geolocation error: "+j+"."})},_handleGeolocationResponse:function(p){var o=p.coords.latitude,r=p.coords.longitude,k=new a.LatLng(o,r),q=180*p.coords.accuracy/40075017,l=q/Math.cos(a.LatLng.DEG_TO_RAD*o),j=a.latLngBounds([o-q,r-l],[o+q,r+l]),t=this._locateOptions;if(t.setView){var s=Math.min(this.getBoundsZoom(j),t.maxZoom);this.setView(k,s)}var n={latlng:k,bounds:j,timestamp:p.timestamp};for(var m in p.coords){if(typeof p.coords[m]==="number"){n[m]=p.coords[m]}}this.fire("locationfound",n)}})}(window,document));if(window.sc_require){sc_require("libraries/raphael")}if(!Raphael.fn.line){Raphael.fn.line=function(c,f,b,d){var a=this.path("M"+c+","+f+"L"+b+","+d);return a}}if(!Raphael.el.addClass){Raphael.el.addClass=function(c){var b=this.node.className;var a=b.baseVal;if(a.indexOf(c)<0){if(a.length>0){a+=" "}a+=c;b.baseVal=a}return this}}if(!Raphael.el.removeClass){Raphael.el.removeClass=function(b){var a=this.node.className.baseVal;a=a.replace(b,"").replace(/  +/," ").replace(/^ /,"").replace(/ $/,"");this.node.className.baseVal=a}}if(!Raphael.el.setId){Raphael.el.setId=function(a){this.node.id.baseVal=a;return this}}if(!Raphael.el.isHidden){Raphael.el.isHidden=function(){return(this.node.style.display==="none")}}(function(b){b.extend(true,window,{Slick:{Plugins:{HeaderMenu:a}}});function a(r){var m;var k=this;var o=new Slick.EventHandler();var d={buttonCssClass:null,buttonImage:"../images/down.gif"};var c;var f;function q(s){r=b.extend(true,{},d,r);m=s;o.subscribe(m.onHeaderCellRendered,i).subscribe(m.onBeforeHeaderCellDestroy,h);m.setColumns(m.getColumns());b(document.body).bind("mousedown",j)}function n(){o.unsubscribeAll();b(document.body).unbind("mousedown",j)}function j(s){if(c&&c[0]!=s.target&&!b.contains(c[0],s.target)){l()}}function l(){if(c){c.remove();c=null;f.removeClass("slick-header-column-active")}}function i(w,s){var v=s.column;var x=v.header&&v.header.menu;if(x){var u=r.buttonIsCell?'<div style="display:none"></div>':"<div></div>",t=b(u).addClass("slick-header-menubutton").data("column",v).data("menu",x);if(r.buttonCssClass){t.addClass(r.buttonCssClass)}if(r.buttonImage){t.css("background-image","url("+r.buttonImage+")")}if(x.tooltip){t.attr("title",x.tooltip)}t.appendTo(s.node);if(r.buttonIsCell){b(s.node).bind("click",p)}else{t.bind("click",p)}}}function h(u,s){var t=s.column;if(t.header&&t.header.menu){b(s.node).find(".slick-header-menubutton").remove()}}function p(x){var u=r.buttonIsCell?b(this).find(".slick-header-menubutton"):b(this);var y=u.data("menu");var t=u.data("column");if(k.onBeforeMenuShow.notify({grid:m,column:t,menu:y},x,k)==false){return}if(!c){c=b("<div class='slick-header-menu'></div>").appendTo(document.body)}c.empty();for(var v=0;v<y.items.length;v++){var w=y.items[v];var z=b("<div class='slick-header-menuitem'></div>").data("command",w.command||"").data("column",t).data("item",w).bind("click",g).appendTo(c);if(w.disabled){z.addClass("slick-header-menuitem-disabled")}if(w.tooltip){z.attr("title",w.tooltip)}var s=b("<div class='slick-header-menuicon'></div>").appendTo(z);if(w.iconCssClass){s.addClass(w.iconCssClass)}if(w.iconImage){s.css("background-image","url("+w.iconImage+")")}b("<span class='slick-header-menucontent'></span>").text(w.title).appendTo(z)}c.css("top",b(this).offset().top+b(this).height()).css("left",b(this).offset().left);f=u.closest(".slick-header-column");f.addClass("slick-header-column-active")}function g(u){var v=b(this).data("command");var s=b(this).data("column");var t=b(this).data("item");if(t.disabled){return}l();if(v!=null&&v!=""){k.onCommand.notify({grid:m,column:s,command:v,item:t},u,k)}u.preventDefault();u.stopPropagation()}b.extend(this,{init:q,destroy:n,onBeforeMenuShow:new Slick.Event(),onCommand:new Slick.Event()})}})(jQuery);(function(b){b.extend(true,window,{Slick:{RowSelectionModel:a}});function a(g){var s;var p=[];var j=this;var o=new Slick.EventHandler();var n;var r;var t={selectActiveRow:true};function u(y){r=b.extend(true,{},t,g);s=y;o.subscribe(s.onActiveCellChanged,f(w));o.subscribe(s.onKeyDown,f(m));o.subscribe(s.onClick,f(l))}function x(){o.unsubscribeAll()}function f(y){return function(){if(!n){n=true;y.apply(this,arguments);n=false}}}function h(y){var B=[];for(var A=0;A<y.length;A++){for(var z=y[A].fromRow;z<=y[A].toRow;z++){B.push(z)}}return B}function i(B){var z=[];var y=s.getColumns().length-1;for(var A=0;A<B.length;A++){z.push(new Slick.Range(B[A],0,B[A],y))}return z}function v(B,A){var y,z=[];for(y=B;y<=A;y++){z.push(y)}for(y=A;y<B;y++){z.push(y)}return z}function d(){return h(p)}function k(y){c(i(y))}function c(y){p=y;j.onSelectedRangesChanged.notify(p)}function q(){return p}function w(z,y){if(r.selectActiveRow&&y.row!=null){c([new Slick.Range(y.row,0,y.row,s.getColumns().length-1)])}}function m(D){var z=s.getActiveCell();if(z&&D.shiftKey&&!D.ctrlKey&&!D.altKey&&!D.metaKey&&(D.which==38||D.which==40)){var C=d();C.sort(function(E,F){return E-F});if(!C.length){C=[z.row]}var B=C[0];var y=C[C.length-1];var A;if(D.which==40){A=z.row<y||B==y?++y:++B}else{A=z.row<y?--y:--B}if(A>=0&&A<s.getDataLength()){s.scrollRowIntoView(A);p=i(v(B,y));c(p)}D.preventDefault();D.stopPropagation()}}function l(D){var z=s.getCellFromEvent(D);if(!z||!s.canCellBeActive(z.row,z.cell)){return false}var B=h(p);var y=b.inArray(z.row,B);if(!D.ctrlKey&&!D.shiftKey&&!D.metaKey){return false}else{if(s.getOptions().multiSelect){if(y===-1&&(D.ctrlKey||D.metaKey)){B.push(z.row);s.setActiveCell(z.row,z.cell)}else{if(y!==-1&&(D.ctrlKey||D.metaKey)){B=b.grep(B,function(H,G){return(H!==z.row)});s.setActiveCell(z.row,z.cell)}else{if(B.length&&D.shiftKey){var C=B.pop();var F=Math.min(z.row,C);var E=Math.max(z.row,C);B=[];for(var A=F;A<=E;A++){if(A!==C){B.push(A)}}B.push(C);s.setActiveCell(z.row,z.cell)}}}}}p=i(B);c(p);D.stopImmediatePropagation();return true}b.extend(this,{getSelectedRows:d,setSelectedRows:k,getSelectedRanges:q,setSelectedRanges:c,init:u,destroy:x,onSelectedRangesChanged:new Slick.Event()})}})(jQuery);(function(c){c.extend(true,window,{Slick:{Event:i,EventData:h,EventHandler:j,Range:b,NonDataRow:f,Group:g,GroupTotals:d,EditorLock:a,GlobalEditorLock:new a()}});function h(){var k=false;var l=false;this.stopPropagation=function(){k=true};this.isPropagationStopped=function(){return k};this.stopImmediatePropagation=function(){l=true};this.isImmediatePropagationStopped=function(){return l}}function i(){var k=[];this.subscribe=function(l){k.push(l)};this.unsubscribe=function(m){for(var l=k.length-1;l>=0;l--){if(k[l]===m){k.splice(l,1)}}};this.notify=function(l,p,o){p=p||new h();o=o||this;var n;for(var m=0;m<k.length&&!(p.isPropagationStopped()||p.isImmediatePropagationStopped());m++){n=k[m].call(o,p,l)}return n}}function j(){var k=[];this.subscribe=function(m,l){k.push({event:m,handler:l});m.subscribe(l);return this};this.unsubscribe=function(n,m){var l=k.length;while(l--){if(k[l].event===n&&k[l].handler===m){k.splice(l,1);n.unsubscribe(m);return}}return this};this.unsubscribeAll=function(){var l=k.length;while(l--){k[l].event.unsubscribe(k[l].handler)}k=[];return this}}function b(l,k,m,n){if(m===undefined&&n===undefined){m=l;n=k}this.fromRow=Math.min(l,m);this.fromCell=Math.min(k,n);this.toRow=Math.max(l,m);this.toCell=Math.max(k,n);this.isSingleRow=function(){return this.fromRow==this.toRow};this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell};this.contains=function(p,o){return p>=this.fromRow&&p<=this.toRow&&o>=this.fromCell&&o<=this.toCell};this.toString=function(){if(this.isSingleCell()){return"("+this.fromRow+":"+this.fromCell+")"}else{return"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}}function f(){this.__nonDataRow=true}function g(){this.__group=true;this.level=0;this.count=0;this.value=null;this.title=null;this.collapsed=false;this.totals=null;this.rows=null;this.groups=null;this.groupingKey=null}g.prototype=new f();g.prototype.equals=function(k){return this.value===k.value&&this.count===k.count&&this.collapsed===k.collapsed};function d(){this.__groupTotals=true;this.group=null}d.prototype=new f();function a(){var k=null;this.isActive=function(m){return(m?k===m:k!==null)};this.activate=function(m){if(m===k){return}if(k!==null){throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController"}if(!m.commitCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()"}if(!m.cancelCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()"}k=m};this.deactivate=function(m){if(k!==m){throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one"}k=null};this.commitCurrentEdit=function(){return(k?k.commitCurrentEdit():true)};this.cancelCurrentEdit=function l(){return(k?k.cancelCurrentEdit():true)}}})(jQuery);(function(d){d.extend(true,window,{Slick:{Data:{DataView:g,Aggregators:{Avg:c,Min:b,Max:a,Sum:f}}}});function g(ab){var aw=this;var N={groupItemMetadataProvider:null,inlineFilters:false,showExpandedGroupRows:true};var r="id";var ax=[];var X=[];var aD={};var ay=null;var w=null;var av=null;var F=false;var l=true;var aQ;var z;var ah={};var P={};var aJ;var o=[];var H;var A;var am=[];var aF={getter:null,formatter:null,comparer:function(aV,aU){return aV.value-aU.value},aggregators:[],aggregateCollapsed:false,aggregateChildGroups:false,collapsed:false};var at=[];var i=[];var k=[];var aM=":|:";var D=0;var E=0;var h=0;var aH=new Slick.Event();var O=new Slick.Event();var aR=new Slick.Event();ab=d.extend(true,{},N,ab);function q(){F=true}function s(){F=false;az()}function aB(aU){ah=aU}function Q(aU){aJ=aU}function aK(aW){aW=aW||0;var aX;for(var aV=aW,aU=ax.length;aV<aU;aV++){aX=ax[aV][r];if(aX===undefined){throw"Each data element must implement a unique 'id' property"}aD[aX]=aV}}function G(){var aW;for(var aV=0,aU=ax.length;aV<aU;aV++){aW=ax[aV][r];if(aW===undefined||aD[aW]!==aV){throw"Each data element must implement a unique 'id' property"}}}function aS(){return ax}function V(aV,aU){if(aU!==undefined){r=aU}ax=o=aV;aD={};aK();G();az()}function B(aU){if(aU.pageSize!=undefined){D=aU.pageSize;E=D?Math.min(E,Math.max(0,Math.ceil(h/D)-1)):0}if(aU.pageNum!=undefined){E=Math.min(aU.pageNum,Math.max(0,Math.ceil(h/D)-1))}aR.notify(an(),null,aw);az()}function an(){var aU=D?Math.max(1,Math.ceil(h/D)):1;return{pageSize:D,pageNum:E,totalRows:h,totalPages:aU}}function I(aV,aU){l=aU;z=aV;aQ=null;if(aU===false){ax.reverse()}ax.sort(aV);if(aU===false){ax.reverse()}aD={};aK();az()}function aL(aW,aV){l=aV;aQ=aW;z=null;var aU=Object.prototype.toString;Object.prototype.toString=(typeof aW=="function")?aW:function(){return this[aW]};if(aV===false){ax.reverse()}ax.sort();Object.prototype.toString=aU;if(aV===false){ax.reverse()}aD={};aK();az()}function y(){if(z){I(z,l)}else{if(aQ){aL(aQ,l)}}}function ad(aU){w=aU;if(ab.inlineFilters){H=al();A=C()}az()}function ai(){return at}function K(aX){if(!ab.groupItemMetadataProvider){ab.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider()}i=[];k=[];aX=aX||[];at=(aX instanceof Array)?aX:[aX];for(var aW=0;aW<at.length;aW++){var aV=at[aW]=d.extend(true,{},aF,at[aW]);aV.getterIsAFn=typeof aV.getter==="function";aV.compiledAccumulators=[];var aU=aV.aggregators.length;while(aU--){aV.compiledAccumulators[aU]=ap(aV.aggregators[aU])}k[aW]={}}az()}function ae(aU,aV,aW){if(aU==null){K([]);return}K({getter:aU,formatter:aV,comparer:aW})}function aO(aV,aU){if(!at.length){throw new Error("At least must setGrouping must be specified before calling setAggregators().")}at[0].aggregators=aV;at[0].aggregateCollapsed=aU;K(at)}function aC(aU){return ax[aU]}function J(aU){return aD[aU]}function v(){if(!ay){ay={};for(var aV=0,aU=X.length;aV<aU;aV++){ay[X[aV][r]]=aV}}}function aj(aU){v();return ay[aU]}function Z(aU){return ax[aD[aU]]}function aI(aV){var aW=[];v();for(var aU=0;aU<aV.length;aU++){var aX=ay[aV[aU]];if(aX!=null){aW[aW.length]=aX}}return aW}function U(aW){var aV=[];for(var aU=0;aU<aW.length;aU++){if(aW[aU]<X.length){aV[aV.length]=X[aW[aU]][r]}}return aV}function n(aV,aU){if(aD[aV]===undefined||aV!==aU[r]){throw"Invalid or non-matching id"}ax[aD[aV]]=aU;if(!av){av={}}av[aV]=true;az()}function aN(aU,aV){ax.splice(aU,0,aV);aK(aU);az()}function aq(aU){ax.push(aU);aK(ax.length-1);az()}function aT(aV){var aU=aD[aV];if(aU===undefined){throw"Invalid id"}delete aD[aV];ax.splice(aU,1);aK(aU);az()}function aA(){return X.length}function aG(aU){return X[aU]}function M(aU){var aV=X[aU];if(aV===undefined){return null}if(aV.__group){return ab.groupItemMetadataProvider.getGroupRowMetadata(aV)}if(aV.__groupTotals){return ab.groupItemMetadataProvider.getTotalsRowMetadata(aV)}return null}function aP(aW,aV){if(aW==null){for(var aU=0;aU<at.length;aU++){k[aU]={};at[aU].collapsed=aV}}else{k[aW]={};at[aW].collapsed=aV}az()}function R(aU){aP(aU,true)}function aE(aU){aP(aU,false)}function Y(aW,aU,aV){k[aW][aU]=at[aW].collapsed^aV;az()}function au(aX){var aV=Array.prototype.slice.call(arguments);var aW=aV[0];var aY;var aU;if(aV.length==1&&aW.indexOf(aM)!=-1){aY=aW.split(aM).length-1;aU=aW}else{aY=aV.length-1;aU=aV.join(aM)}return k[aY][aU]}function ak(aW){var aU=Array.prototype.slice.call(arguments);var aV=aU[0];if(aU.length==1&&aV.indexOf(aM)!=-1){Y(aV.split(aM).length-1,aV,true)}else{Y(aU.length-1,aU.join(aM),true)}}function af(aW){var aU=Array.prototype.slice.call(arguments);var aV=aU[0];if(aU.length==1&&aV.indexOf(aM)!=-1){Y(aV.split(aM).length-1,aV,false)}else{Y(aU.length-1,aU.join(aM),false)}}function ao(){return i}function aa(a4,a1){var a3;var aW;var aX=[];var a2=[];var aU;var aV=a1?a1.level+1:0;var a0=at[aV];for(var aZ=0,aY=a4.length;aZ<aY;aZ++){aU=a4[aZ];aW=a0.getterIsAFn?a0.getter(aU):aU[a0.getter];aW=aW||0;a3=a2[aW];if(!a3){a3=new Slick.Group();a3.count=0;a3.value=aW;a3.level=aV;a3.groupingKey=(a1?a1.groupingKey+aM:"")+aW;a3.rows=[];aX[aX.length]=a3;a2[aW]=a3}a3.rows[a3.count++]=aU}if(aV<at.length-1){for(var aZ=0;aZ<aX.length;aZ++){a3=aX[aZ];a3.groups=aa(a3.rows,a3)}}aX.sort(at[aV].comparer);return aX}function ar(aZ){var aW=at[aZ.level];var aY=(aZ.level==at.length);var aX=new Slick.GroupTotals();var aV,aU=aW.aggregators.length;while(aU--){aV=aW.aggregators[aU];aV.init();aW.compiledAccumulators[aU].call(aV,(!aY&&aW.aggregateChildGroups)?aZ.groups:aZ.rows);aV.storeResult(aX)}aX.group=aZ;aZ.totals=aX}function ag(aV,aY){aY=aY||0;var aW=at[aY];var aU=aV.length,aX;while(aU--){aX=aV[aU];if(aX.collapsed&&!aW.aggregateCollapsed){continue}if(aX.groups){ag(aX.groups,aY+1)}if(aW.aggregators.length){ar(aX)}}}function u(aV,a0){a0=a0||0;var aW=at[a0];var aX=aW.collapsed;var aZ=k[a0];var aU=aV.length,aY;while(aU--){aY=aV[aU];aY.collapsed=aX^aZ[aY.groupingKey];aY.title=aW.formatter?aW.formatter(aY):aY.value;if(aY.groups){u(aY.groups,a0+1);aY.rows=null}}}function j(aU){var aV=[],a2,aZ=0,a1;for(var aY=0,aW=aU.length;aY<aW;aY++){a1=aU[aY];if(ab.showExpandedGroupRows||a1.collapsed){aV[aZ++]=a1}if(!a1.collapsed){a2=a1.groups?j(a1.groups):a1.rows;for(var aX=0,a0=a2.length;aX<a0;aX++){aV[aZ++]=a2[aX]}}if(a1.totals&&(!a1.collapsed||at[a1.level].aggregateCollapsed)){aV[aZ++]=a1.totals}}return aV}function T(aV){var aU=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/;var aW=aV.toString().match(aU);return{params:aW[1].split(","),body:aW[2]}}function ap(aW){var aV=T(aW.accumulate);var aU=new Function("_items","for (var "+aV.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+aV.params[0]+" = _items[_i]; "+aV.body+"}");aU.displayName=aU.name="compiledAccumulatorLoop";return aU}function al(){var aX=T(w);var aU=aX.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }");var aV=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");aV=aV.replace(/\$filter\$/gi,aU);aV=aV.replace(/\$item\$/gi,aX.params[0]);aV=aV.replace(/\$args\$/gi,aX.params[1]);var aW=new Function("_items,_args",aV);aW.displayName=aW.name="compiledFilter";return aW}function C(){var aX=T(w);var aU=aX.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }");var aV=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");aV=aV.replace(/\$filter\$/gi,aU);aV=aV.replace(/\$item\$/gi,aX.params[0]);aV=aV.replace(/\$args\$/gi,aX.params[1]);var aW=new Function("_items,_args,_cache",aV);aW.displayName=aW.name="compiledFilterWithCaching";return aW}function p(aW,aX){var aV=[],aU=0;for(var aY=0,aZ=aW.length;aY<aZ;aY++){if(w(aW[aY],aX)){aV[aU++]=aW[aY]}}return aV}function S(aX,aY,aW){var aV=[],aU=0,a1;for(var aZ=0,a0=aX.length;aZ<a0;aZ++){a1=aX[aZ];if(aW[aZ]){aV[aU++]=a1}else{if(w(a1,aY)){aV[aU++]=a1;aW[aZ]=true}}}return aV}function x(aV){if(w){var aU=ab.inlineFilters?H:p;var aX=ab.inlineFilters?A:S;if(ah.isFilterNarrowing){o=aU(o,aJ)}else{if(ah.isFilterExpanding){o=aX(aV,aJ,am)}else{if(!ah.isFilterUnchanged){o=aU(aV,aJ)}}}}else{o=D?aV:aV.concat()}var aW;if(D){if(o.length<E*D){E=Math.floor(o.length/D)}aW=o.slice(D*E,D*E+D)}else{aW=o}return{totalRows:o.length,rows:aW}}function m(a3,aX){var a2,aU,aV,a1=[];var aZ=0,a0=aX.length;if(ah&&ah.ignoreDiffsBefore){aZ=Math.max(0,Math.min(aX.length,ah.ignoreDiffsBefore))}if(ah&&ah.ignoreDiffsAfter){a0=Math.min(aX.length,Math.max(0,ah.ignoreDiffsAfter))}for(var aW=aZ,aY=a3.length;aW<a0;aW++){if(aW>=aY){a1[a1.length]=aW}else{a2=aX[aW];aU=a3[aW];if((at.length&&(aV=(a2.__nonDataRow)||(aU.__nonDataRow))&&a2.__group!==aU.__group||a2.__group&&!a2.equals(aU))||(aV&&(a2.__groupTotals||aU.__groupTotals))||a2[r]!=aU[r]||(av&&av[a2[r]])){a1[a1.length]=aW}}}return a1}function t(aX){ay=null;if(ah.isFilterNarrowing!=P.isFilterNarrowing||ah.isFilterExpanding!=P.isFilterExpanding){am=[]}var aV=x(aX);h=aV.totalRows;var aU=aV.rows;i=[];if(at.length){i=aa(aU);if(i.length){ag(i);u(i);aU=j(i)}}var aW=m(X,aU);X=aU;return aW}function az(){if(F){return}var aU=X.length;var aV=h;var aW=t(ax,w);if(D&&h<E*D){E=Math.max(0,Math.ceil(h/D)-1);aW=t(ax,w)}av=null;P=ah;ah={};if(aV!=h){aR.notify(an(),null,aw)}if(aU!=X.length){aH.notify({previous:aU,current:X.length},null,aw)}if(aW.length>0){O.notify({rows:aW},null,aw)}}function W(aX,aW){var aV=this;var aU=aV.mapRowsToIds(aX.getSelectedRows());var aY;function aZ(){if(aU.length>0){aY=true;var a0=aV.mapIdsToRows(aU);if(!aW){aU=aV.mapRowsToIds(a0)}aX.setSelectedRows(a0);aY=false}}aX.onSelectedRowsChanged.subscribe(function(a1,a0){if(aY){return}aU=aV.mapRowsToIds(aX.getSelectedRows())});this.onRowsChanged.subscribe(aZ);this.onRowCountChanged.subscribe(aZ)}function ac(aW,aV){var aU;var aY;aX(aW.getCellCssStyles(aV));function aX(a0){aU={};for(var a1 in a0){var a2=X[a1][r];aU[a2]=a0[a1]}}function aZ(){if(aU){aY=true;v();var a0={};for(var a2 in aU){var a1=ay[a2];if(a1!=undefined){a0[a1]=aU[a2]}}aW.setCellCssStyles(aV,a0);aY=false}}aW.onCellCssStylesChanged.subscribe(function(a1,a0){if(aY){return}if(aV!=a0.key){return}if(a0.hash){aX(a0.hash)}});this.onRowsChanged.subscribe(aZ);this.onRowCountChanged.subscribe(aZ)}return{beginUpdate:q,endUpdate:s,setPagingOptions:B,getPagingInfo:an,getItems:aS,setItems:V,setFilter:ad,sort:I,fastSort:aL,reSort:y,setGrouping:K,getGrouping:ai,groupBy:ae,setAggregators:aO,collapseAllGroups:R,expandAllGroups:aE,isGroupCollapsed:au,collapseGroup:ak,expandGroup:af,getGroups:ao,getIdxById:J,getRowById:aj,getItemById:Z,getItemByIdx:aC,mapRowsToIds:U,mapIdsToRows:aI,setRefreshHints:aB,setFilterArgs:Q,refresh:az,updateItem:n,insertItem:aN,addItem:aq,deleteItem:aT,syncGridSelection:W,syncGridCellCssStyles:ac,getLength:aA,getItem:aG,getItemMetadata:M,onRowCountChanged:aH,onRowsChanged:O,onPagingInfoChanged:aR}}function c(h){this.field_=h;this.init=function(){this.count_=0;this.nonNullCount_=0;this.sum_=0};this.accumulate=function(i){var j=i[this.field_];this.count_++;if(j!=null&&j!==""&&j!==NaN){this.nonNullCount_++;this.sum_+=parseFloat(j)}};this.storeResult=function(i){if(!i.avg){i.avg={}}if(this.nonNullCount_!=0){i.avg[this.field_]=this.sum_/this.nonNullCount_}}}function b(h){this.field_=h;this.init=function(){this.min_=null};this.accumulate=function(i){var j=i[this.field_];if(j!=null&&j!==""&&j!==NaN){if(this.min_==null||j<this.min_){this.min_=j}}};this.storeResult=function(i){if(!i.min){i.min={}}i.min[this.field_]=this.min_}}function a(h){this.field_=h;this.init=function(){this.max_=null};this.accumulate=function(i){var j=i[this.field_];if(j!=null&&j!==""&&j!==NaN){if(this.max_==null||j>this.max_){this.max_=j}}};this.storeResult=function(i){if(!i.max){i.max={}}i.max[this.field_]=this.max_}}function f(h){this.field_=h;this.init=function(){this.sum_=null};this.accumulate=function(i){var j=i[this.field_];if(j!=null&&j!==""&&j!==NaN){this.sum_+=parseFloat(j)}};this.storeResult=function(i){if(!i.sum){i.sum={}}i.sum[this.field_]=this.sum_}}})(jQuery);(function(g){g.extend(true,window,{Slick:{Editors:{Text:i,Integer:b,Date:c,YesNoSelect:d,Checkbox:f,PercentComplete:a,LongText:h}}});function i(k){var m;var j;var l=this;this.init=function(){m=g("<INPUT type=text class='editor-text' />").appendTo(k.container).bind("keydown.nav",function(n){if(n.keyCode===g.ui.keyCode.LEFT||n.keyCode===g.ui.keyCode.RIGHT){n.stopImmediatePropagation()}}).focus().select()};this.destroy=function(){m.remove()};this.focus=function(){m.focus()};this.getValue=function(){return m.val()};this.setValue=function(n){m.val(n)};this.loadValue=function(n){j=n[k.column.field]||"";m.val(j);m[0].defaultValue=j;m.select()};this.serializeValue=function(){return m.val()};this.applyValue=function(n,o){n[k.column.field]=o};this.isValueChanged=function(){return(!(m.val()==""&&j==null))&&(m.val()!=j)};this.validate=function(){if(k.column.validator){var n=k.column.validator(m.val());if(!n.valid){return n}}return{valid:true,msg:null}};this.init()}function b(k){var m;var j;var l=this;this.init=function(){m=g("<INPUT type=text class='editor-text' />");m.bind("keydown.nav",function(n){if(n.keyCode===g.ui.keyCode.LEFT||n.keyCode===g.ui.keyCode.RIGHT){n.stopImmediatePropagation()}});m.appendTo(k.container);m.focus().select()};this.destroy=function(){m.remove()};this.focus=function(){m.focus()};this.loadValue=function(n){j=n[k.column.field];m.val(j);m[0].defaultValue=j;m.select()};this.serializeValue=function(){return parseInt(m.val(),10)||0};this.applyValue=function(n,o){n[k.column.field]=o};this.isValueChanged=function(){return(!(m.val()==""&&j==null))&&(m.val()!=j)};this.validate=function(){if(isNaN(m.val())){return{valid:false,msg:"Please enter a valid integer"}}return{valid:true,msg:null}};this.init()}function c(k){var n;var j;var l=this;var m=false;this.init=function(){n=g("<INPUT type=text class='editor-text' />");n.appendTo(k.container);n.focus().select();n.datepicker({showOn:"button",buttonImageOnly:true,buttonImage:"../images/calendar.gif",beforeShow:function(){m=true},onClose:function(){m=false}});n.width(n.width()-18)};this.destroy=function(){g.datepicker.dpDiv.stop(true,true);n.datepicker("hide");n.datepicker("destroy");n.remove()};this.show=function(){if(m){g.datepicker.dpDiv.stop(true,true).show()}};this.hide=function(){if(m){g.datepicker.dpDiv.stop(true,true).hide()}};this.position=function(o){if(!m){return}g.datepicker.dpDiv.css("top",o.top+30).css("left",o.left)};this.focus=function(){n.focus()};this.loadValue=function(o){j=o[k.column.field];n.val(j);n[0].defaultValue=j;n.select()};this.serializeValue=function(){return n.val()};this.applyValue=function(o,p){o[k.column.field]=p};this.isValueChanged=function(){return(!(n.val()==""&&j==null))&&(n.val()!=j)};this.validate=function(){return{valid:true,msg:null}};this.init()}function d(l){var k;var j;var m=this;this.init=function(){k=g("<SELECT tabIndex='0' class='editor-yesno'><OPTION value='yes'>Yes</OPTION><OPTION value='no'>No</OPTION></SELECT>");k.appendTo(l.container);k.focus()};this.destroy=function(){k.remove()};this.focus=function(){k.focus()};this.loadValue=function(n){k.val((j=n[l.column.field])?"yes":"no");k.select()};this.serializeValue=function(){return(k.val()=="yes")};this.applyValue=function(n,o){n[l.column.field]=o};this.isValueChanged=function(){return(k.val()!=j)};this.validate=function(){return{valid:true,msg:null}};this.init()}function f(l){var k;var j;var m=this;this.init=function(){k=g("<INPUT type=checkbox value='true' class='editor-checkbox' hideFocus>");k.appendTo(l.container);k.focus()};this.destroy=function(){k.remove()};this.focus=function(){k.focus()};this.loadValue=function(n){j=n[l.column.field];if(j){k.attr("checked","checked")}else{k.removeAttr("checked")}};this.serializeValue=function(){return k.attr("checked")};this.applyValue=function(n,o){n[l.column.field]=o};this.isValueChanged=function(){return(k.attr("checked")!=j)};this.validate=function(){return{valid:true,msg:null}};this.init()}function a(k){var n,m;var j;var l=this;this.init=function(){n=g("<INPUT type=text class='editor-percentcomplete' />");n.width(g(k.container).innerWidth()-25);n.appendTo(k.container);m=g("<div class='editor-percentcomplete-picker' />").appendTo(k.container);m.append("<div class='editor-percentcomplete-helper'><div class='editor-percentcomplete-wrapper'><div class='editor-percentcomplete-slider' /><div class='editor-percentcomplete-buttons' /></div></div>");m.find(".editor-percentcomplete-buttons").append("<button val=0>Not started</button><br/><button val=50>In Progress</button><br/><button val=100>Complete</button>");n.focus().select();m.find(".editor-percentcomplete-slider").slider({orientation:"vertical",range:"min",value:j,slide:function(o,p){n.val(p.value)}});m.find(".editor-percentcomplete-buttons button").bind("click",function(o){n.val(g(this).attr("val"));m.find(".editor-percentcomplete-slider").slider("value",g(this).attr("val"))})};this.destroy=function(){n.remove();m.remove()};this.focus=function(){n.focus()};this.loadValue=function(o){n.val(j=o[k.column.field]);n.select()};this.serializeValue=function(){return parseInt(n.val(),10)||0};this.applyValue=function(o,p){o[k.column.field]=p};this.isValueChanged=function(){return(!(n.val()==""&&j==null))&&((parseInt(n.val(),10)||0)!=j)};this.validate=function(){if(isNaN(parseInt(n.val(),10))){return{valid:false,msg:"Please enter a valid positive number"}}return{valid:true,msg:null}};this.init()}function h(k){var n,m;var j;var l=this;this.init=function(){var o=g("body");m=g("<DIV style='z-index:10000;position:absolute;background:white;padding:5px;border:3px solid gray; -moz-border-radius:10px; border-radius:10px;'/>").appendTo(o);n=g("<TEXTAREA hidefocus rows=5 style='backround:white;width:250px;height:80px;border:0;outline:0'>").appendTo(m);g("<DIV style='text-align:right'><BUTTON>Save</BUTTON><BUTTON>Cancel</BUTTON></DIV>").appendTo(m);m.find("button:first").bind("click",this.save);m.find("button:last").bind("click",this.cancel);n.bind("keydown",this.handleKeyDown);l.position(k.position);n.focus().select()};this.handleKeyDown=function(o){if(o.which==g.ui.keyCode.ENTER&&o.ctrlKey){l.save()}else{if(o.which==g.ui.keyCode.ESCAPE){o.preventDefault();l.cancel()}else{if(o.which==g.ui.keyCode.TAB&&o.shiftKey){o.preventDefault();k.grid.navigatePrev()}else{if(o.which==g.ui.keyCode.TAB){o.preventDefault();k.grid.navigateNext()}}}}};this.save=function(){k.commitChanges()};this.cancel=function(){n.val(j);k.cancelChanges()};this.hide=function(){m.hide()};this.show=function(){m.show()};this.position=function(o){m.css("top",o.top-5).css("left",o.left-5)};this.destroy=function(){m.remove()};this.focus=function(){n.focus()};this.loadValue=function(o){n.val(j=o[k.column.field]);n.select()};this.serializeValue=function(){return n.val()};this.applyValue=function(o,p){o[k.column.field]=p};this.isValueChanged=function(){return(!(n.val()==""&&j==null))&&(n.val()!=j)};this.validate=function(){return{valid:true,msg:null}};this.init()}})(jQuery);if(typeof jQuery==="undefined"){throw"SlickGrid requires jquery module to be loaded"}if(!jQuery.fn.drag){throw"SlickGrid requires jquery.event.drag module to be loaded"}if(typeof Slick==="undefined"){throw"slick.core.js not loaded"}(function($){$.extend(true,window,{Slick:{Grid:SlickGrid}});var scrollbarDimensions;var maxSupportedCssHeight;function SlickGrid(container,data,columns,options){var defaults={explicitInitialization:false,rowHeight:25,defaultColumnWidth:80,enableAddRow:false,leaveSpaceForNewRows:false,editable:false,autoEdit:true,enableCellNavigation:true,enableColumnReorder:true,asyncEditorLoading:false,asyncEditorLoadDelay:100,forceFitColumns:false,enableAsyncPostRender:false,asyncPostRenderDelay:50,autoHeight:false,editorLock:Slick.GlobalEditorLock,showHeaderRow:false,headerRowHeight:25,showTopPanel:false,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:true,enableTextSelectionOnCells:false,dataItemColumnValueExtractor:null,fullWidthRows:false,multiColumnSort:false,defaultFormatter:defaultFormatter,forceSyncScrolling:false};var columnDefaults={name:"",resizable:true,sortable:false,minWidth:30,rerenderOnResize:false,headerCssClass:null,defaultSortAsc:true,focusable:true,selectable:true};var th;var h;var ph;var n;var cj;var page=0;var offset=0;var vScrollDir=1;var initialized=false;var $container;var uid="slickgrid_"+Math.round(1000000*Math.random());var self=this;var $focusSink,$focusSink2;var $headerScroller;var $headers;var $headerRow,$headerRowScroller,$headerRowSpacer;var $topPanelScroller;var $topPanel;var $viewport;var $canvas;var $style;var $boundAncestors;var stylesheet,columnCssRulesL,columnCssRulesR;var viewportH,viewportW;var canvasWidth;var viewportHasHScroll,viewportHasVScroll;var headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0;var absoluteColumnMinWidth;var numberOfRows=0;var tabbingDirection=1;var activePosX;var activeRow,activeCell;var activeCellNode=null;var currentEditor=null;var serializedEditorValue;var editController;var rowsCache={};var renderedRows=0;var numVisibleRows;var prevScrollTop=0;var scrollTop=0;var lastRenderedScrollTop=0;var lastRenderedScrollLeft=0;var prevScrollLeft=0;var scrollLeft=0;var selectionModel;var selectedRows=[];var plugins=[];var cellCssClasses={};var columnsById={};var sortColumns=[];var columnPosLeft=[];var columnPosRight=[];var h_editorLoader=null;var h_render=null;var h_postrender=null;var postProcessedRows={};var postProcessToRow=null;var postProcessFromRow=null;var counter_rows_rendered=0;var counter_rows_removed=0;function init(){$container=$(container);if($container.length<1){throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.")}maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight();scrollbarDimensions=scrollbarDimensions||measureScrollbar();options=$.extend({},defaults,options);validateAndEnforceOptions();columnDefaults.width=options.defaultColumnWidth;columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;if(m.minWidth&&m.width<m.minWidth){m.width=m.minWidth}if(m.maxWidth&&m.width>m.maxWidth){m.width=m.maxWidth}}if(options.enableColumnReorder&&!$.fn.sortable){throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded")}editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit};$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget");if(!/relative|absolute|fixed/.test($container.css("position"))){$container.css("position","relative")}$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container);$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headers=$("<div class='slick-header-columns' style='left:-1000px' />").appendTo($headerScroller);$headers.width(getHeadersWidth());$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller);$headerRowSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($headerRowScroller);$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller);if(!options.showTopPanel){$topPanelScroller.hide()}if(!options.showHeaderRow){$headerRowScroller.hide()}$viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container);$viewport.css("overflow-y",options.autoHeight?"hidden":"auto");$canvas=$("<div class='grid-canvas' />").appendTo($viewport);$focusSink2=$focusSink.clone().appendTo($container);if(!options.explicitInitialization){finishInitialization()}}function finishInitialization(){if(!initialized){initialized=true;viewportW=parseFloat($.css($container[0],"width",true));measureCellPaddingAndBorder();disableSelection($headers);if(!options.enableTextSelectionOnCells){$viewport.bind("selectstart.ui",function(event){return $(event.target).is("input,textarea")})}updateColumnCaches();createColumnHeaders();setupColumnSort();createCssRules();resizeCanvas();bindAncestorScrollEvents();$container.bind("resize.slickgrid",resizeCanvas);$viewport.bind("scroll",handleScroll);$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave).bind("draginit",handleHeaderDragInit).bind("dragstart",handleHeaderDragStart).bind("drag",handleHeaderDrag).bind("dragend",handleHeaderDragEnd);$headerRowScroller.bind("scroll",handleHeaderRowScroll);$focusSink.add($focusSink2).bind("keydown",handleKeyDown);$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave)}}function registerPlugin(plugin){plugins.unshift(plugin);plugin.init(self)}function unregisterPlugin(plugin){for(var i=plugins.length;i>=0;i--){if(plugins[i]===plugin){if(plugins[i].destroy){plugins[i].destroy()}plugins.splice(i,1);break}}}function setSelectionModel(model){if(selectionModel){selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged);if(selectionModel.destroy){selectionModel.destroy()}}selectionModel=model;if(selectionModel){selectionModel.init(self);selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged)}}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var $c=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");var dim={width:$c.width()-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};$c.remove();return dim}function getHeadersWidth(){var headersWidth=0;for(var i=0,ii=columns.length;i<ii;i++){var width=columns[i].width;headersWidth+=width}headersWidth+=scrollbarDimensions.width;return Math.max(headersWidth,viewportW)+1000}function getCanvasWidth(){var availableWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;var rowWidth=0;var i=columns.length;while(i--){rowWidth+=columns[i].width}return options.fullWidthRows?Math.max(rowWidth,availableWidth):rowWidth}function updateCanvasWidth(forceColumnWidthsUpdate){var oldCanvasWidth=canvasWidth;canvasWidth=getCanvasWidth();viewportHasHScroll=(canvasWidth>viewportW-scrollbarDimensions.width);if(canvasWidth!=oldCanvasWidth){$canvas.width(canvasWidth);$headerRow.width(canvasWidth);$headers.width(getHeadersWidth());trigger(self.onCanvasWidthChanged,{width:canvasWidth})}$headerRowSpacer.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0));if(canvasWidth!=oldCanvasWidth||forceColumnWidthsUpdate){applyColumnWidths()}}function disableSelection($target){if($target&&$target.jquery){$target.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}}function getMaxSupportedCssHeight(){var supportedHeight=1000000;var testUpTo=navigator.userAgent.toLowerCase().match(/firefox/)?6000000:1000000000;var div=$("<div style='display:none' />").appendTo(document.body);while(true){var test=supportedHeight*2;div.css("height",test);if(test>testUpTo||div.height()!==test){break}else{supportedHeight=test}}div.remove();return supportedHeight}function bindAncestorScrollEvents(){var elem=$canvas[0];while((elem=elem.parentNode)!=document.body&&elem!=null){if(elem==$viewport[0]||elem.scrollWidth!=elem.clientWidth||elem.scrollHeight!=elem.clientHeight){var $elem=$(elem);if(!$boundAncestors){$boundAncestors=$elem}else{$boundAncestors=$boundAncestors.add($elem)}$elem.bind("scroll."+uid,handleActiveCellPositionChange)}}}function unbindAncestorScrollEvents(){if(!$boundAncestors){return}$boundAncestors.unbind("scroll."+uid);$boundAncestors=null}function updateColumnHeader(columnId,title,toolTip){if(!initialized){return}var idx=getColumnIndex(columnId);if(idx==null){return}var columnDef=columns[idx];var $header=$headers.children().eq(idx);if($header){if(title!==undefined){columns[idx].name=title}if(toolTip!==undefined){columns[idx].toolTip=toolTip}trigger(self.onBeforeHeaderCellDestroy,{node:$header[0],column:columnDef});$header.attr("title",toolTip||"").children().eq(0).html(title);trigger(self.onHeaderCellRendered,{node:$header[0],column:columnDef})}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(columnId){var idx=getColumnIndex(columnId);var $header=$headerRow.children().eq(idx);return $header&&$header[0]}function createColumnHeaders(){function onMouseEnter(){$(this).addClass("ui-state-hover")}function onMouseLeave(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var columnDef=$(this).data("column");if(columnDef){trigger(self.onBeforeHeaderCellDestroy,{node:this,column:columnDef})}});$headers.empty();$headers.width(getHeadersWidth());$headerRow.find(".slick-headerrow-column").each(function(){var columnDef=$(this).data("column");if(columnDef){trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:columnDef})}});$headerRow.empty();for(var i=0;i<columns.length;i++){var m=columns[i];var header=$("<div class='ui-state-default slick-header-column' id='"+uid+m.id+"' />").html("<span class='slick-column-name'>"+m.name+"</span>").width(m.width-headerColumnWidthDiff).attr("title",m.toolTip||"").data("column",m).addClass(m.headerCssClass||"").appendTo($headers);if(options.enableColumnReorder||m.sortable){header.on("mouseenter",onMouseEnter).on("mouseleave",onMouseLeave)}if(m.sortable){header.addClass("slick-header-sortable");header.append("<span class='slick-sort-indicator' />")}trigger(self.onHeaderCellRendered,{node:header[0],column:m});if(options.showHeaderRow){var headerRowCell=$("<div class='ui-state-default slick-headerrow-column l"+i+" r"+i+"'></div>").data("column",m).appendTo($headerRow);trigger(self.onHeaderRowCellRendered,{node:headerRowCell[0],column:m})}}setSortColumns(sortColumns);setupColumnResize();if(options.enableColumnReorder){setupColumnReorder()}}function setupColumnSort(){$headers.click(function(e){e.metaKey=e.metaKey||e.ctrlKey;if($(e.target).hasClass("slick-resizable-handle")){return}var $col=$(e.target).closest(".slick-header-column");if(!$col.length){return}var column=$col.data("column");if(column.sortable){if(!getEditorLock().commitCurrentEdit()){return}var sortOpts=null;var i=0;for(;i<sortColumns.length;i++){if(sortColumns[i].columnId==column.id){sortOpts=sortColumns[i];sortOpts.sortAsc=!sortOpts.sortAsc;break}}if(e.metaKey&&options.multiColumnSort){if(sortOpts){sortColumns.splice(i,1)}}else{if((!e.shiftKey&&!e.metaKey)||!options.multiColumnSort){sortColumns=[]}if(!sortOpts){sortOpts={columnId:column.id,sortAsc:column.defaultSortAsc};sortColumns.push(sortOpts)}else{if(sortColumns.length==0){sortColumns.push(sortOpts)}}}setSortColumns(sortColumns);if(!options.multiColumnSort){trigger(self.onSort,{multiColumnSort:false,sortCol:column,sortAsc:sortOpts.sortAsc},e)}else{trigger(self.onSort,{multiColumnSort:true,sortCols:$.map(sortColumns,function(col){return{sortCol:columns[getColumnIndex(col.columnId)],sortAsc:col.sortAsc}})},e)}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy");$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:true,start:function(e,ui){$(ui.helper).addClass("slick-header-column-active")},beforeStop:function(e,ui){$(ui.helper).removeClass("slick-header-column-active")},stop:function(e){if(!getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}var reorderedIds=$headers.sortable("toArray");var reorderedColumns=[];for(var i=0;i<reorderedIds.length;i++){reorderedColumns.push(columns[getColumnIndex(reorderedIds[i].replace(uid,""))])}setColumns(reorderedColumns);trigger(self.onColumnsReordered,{});e.stopPropagation();setupColumnResize()}})}function setupColumnResize(){var $col,j,c,pageX,columnElements,minPageX,maxPageX,firstResizable,lastResizable;columnElements=$headers.children();columnElements.find(".slick-resizable-handle").remove();columnElements.each(function(i,e){if(columns[i].resizable){if(firstResizable===undefined){firstResizable=i}lastResizable=i}});if(firstResizable===undefined){return}columnElements.each(function(i,e){if(i<firstResizable||(options.forceFitColumns&&i>=lastResizable)){return}$col=$(e);$("<div class='slick-resizable-handle' />").appendTo(e).css({width:"ontouchstart" in window?16:(i===lastResizable?8:4)}).bind("dragstart touchstart",function(e,dd){if(!getEditorLock().commitCurrentEdit()){return false}pageX=e.pageX;$(this).parent().addClass("slick-header-column-active");var shrinkLeewayOnRight=null,stretchLeewayOnRight=null;columnElements.each(function(i,e){columns[i].previousWidth=$(e).outerWidth()});if(options.forceFitColumns){shrinkLeewayOnRight=0;stretchLeewayOnRight=0;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnRight!==null){if(c.maxWidth){stretchLeewayOnRight+=c.maxWidth-c.previousWidth}else{stretchLeewayOnRight=null}}shrinkLeewayOnRight+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}}var shrinkLeewayOnLeft=0,stretchLeewayOnLeft=0;for(j=0;j<=i;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnLeft!==null){if(c.maxWidth){stretchLeewayOnLeft+=c.maxWidth-c.previousWidth}else{stretchLeewayOnLeft=null}}shrinkLeewayOnLeft+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}if(shrinkLeewayOnRight===null){shrinkLeewayOnRight=100000}if(shrinkLeewayOnLeft===null){shrinkLeewayOnLeft=100000}if(stretchLeewayOnRight===null){stretchLeewayOnRight=100000}if(stretchLeewayOnLeft===null){stretchLeewayOnLeft=100000}maxPageX=pageX+Math.min(shrinkLeewayOnRight,stretchLeewayOnLeft);minPageX=pageX-Math.min(shrinkLeewayOnLeft,stretchLeewayOnRight)}).bind("drag touchmove",function(e,dd){var actualMinWidth,d=Math.min(maxPageX,Math.max(minPageX,e.pageX))-pageX,x;if(d<0){x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}}}else{x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}}}applyColumnHeaderWidths();if(options.syncColumnCellResize){applyColumnWidths();updateCanvasWidth(true)}}).bind("dragend touchend",function(e,dd){var newWidth;$(this).parent().removeClass("slick-header-column-active");for(j=0;j<columnElements.length;j++){c=columns[j];newWidth=$(columnElements[j]).outerWidth();if(c.previousWidth!==newWidth&&c.rerenderOnResize){invalidateAllRows()}}updateCanvasWidth(true);render();trigger(self.onColumnsResized,{})}).bind("click",function(e){e.stopPropagation()})})}function getVBoxDelta($el){var p=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];var delta=0;$.each(p,function(n,val){delta+=parseFloat($el.css(val))||0});return delta}function measureCellPaddingAndBorder(){var el;var h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"];var v=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];el=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers);headerColumnWidthDiff=headerColumnHeightDiff=0;$.each(h,function(n,val){headerColumnWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){headerColumnHeightDiff+=parseFloat(el.css(val))||0});el.remove();var r=$("<div class='slick-row' />").appendTo($canvas);el=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(r);cellWidthDiff=cellHeightDiff=0;$.each(h,function(n,val){cellWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){cellHeightDiff+=parseFloat(el.css(val))||0});r.remove();absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));var rowHeight=(options.rowHeight-cellHeightDiff);var rules=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+rowHeight+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"];for(var i=0;i<columns.length;i++){rules.push("."+uid+" .l"+i+" { }");rules.push("."+uid+" .r"+i+" { }")}if($style[0].styleSheet){$style[0].styleSheet.cssText=rules.join(" ")}else{$style[0].appendChild(document.createTextNode(rules.join(" ")))}}function getColumnCssRules(idx){if(!stylesheet){var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){if((sheets[i].ownerNode||sheets[i].owningElement)==$style[0]){stylesheet=sheets[i];break}}if(!stylesheet){throw new Error("Cannot find stylesheet.")}columnCssRulesL=[];columnCssRulesR=[];var cssRules=(stylesheet.cssRules||stylesheet.rules);var matches,columnIdx;for(var i=0;i<cssRules.length;i++){var selector=cssRules[i].selectorText;if(matches=/\.l\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesL[columnIdx]=cssRules[i]}else{if(matches=/\.r\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesR[columnIdx]=cssRules[i]}}}}return{left:columnCssRulesL[idx],right:columnCssRulesR[idx]}}function removeCssRules(){$style.remove();stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit();trigger(self.onBeforeDestroy,{});var i=plugins.length;while(i--){unregisterPlugin(plugins[i])}if(options.enableColumnReorder&&$headers.sortable){$headers.sortable("destroy")}unbindAncestorScrollEvents();$container.unbind(".slickgrid");removeCssRules();$canvas.unbind("draginit dragstart dragend drag");$container.empty().removeClass(uid)}function trigger(evt,args,e){e=e||new Slick.EventData();args=args||{};args.grid=self;return evt.notify(args,e,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(id){return columnsById[id]}function autosizeColumns(){var i,c,widths=[],shrinkLeeway=0,total=0,prevTotal,availWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(i=0;i<columns.length;i++){c=columns[i];widths.push(c.width);total+=c.width;if(c.resizable){shrinkLeeway+=c.width-Math.max(c.minWidth,absoluteColumnMinWidth)}}prevTotal=total;while(total>availWidth&&shrinkLeeway){var shrinkProportion=(total-availWidth)/shrinkLeeway;for(i=0;i<columns.length&&total>availWidth;i++){c=columns[i];var width=widths[i];if(!c.resizable||width<=c.minWidth||width<=absoluteColumnMinWidth){continue}var absMinWidth=Math.max(c.minWidth,absoluteColumnMinWidth);var shrinkSize=Math.floor(shrinkProportion*(width-absMinWidth))||1;shrinkSize=Math.min(shrinkSize,width-absMinWidth);total-=shrinkSize;shrinkLeeway-=shrinkSize;widths[i]-=shrinkSize}if(prevTotal==total){break}prevTotal=total}prevTotal=total;while(total<availWidth){var growProportion=availWidth/total;for(i=0;i<columns.length&&total<availWidth;i++){c=columns[i];if(!c.resizable||c.maxWidth<=c.width){continue}var growSize=Math.min(Math.floor(growProportion*c.width)-c.width,(c.maxWidth-c.width)||1000000)||1;total+=growSize;widths[i]+=growSize}if(prevTotal==total){break}prevTotal=total}var reRender=false;for(i=0;i<columns.length;i++){if(columns[i].rerenderOnResize&&columns[i].width!=widths[i]){reRender=true}columns[i].width=widths[i]}applyColumnHeaderWidths();updateCanvasWidth(true);if(reRender){invalidateAllRows();render()}}function applyColumnHeaderWidths(){if(!initialized){return}var h;for(var i=0,headers=$headers.children(),ii=headers.length;i<ii;i++){h=$(headers[i]);if(h.width()!==columns[i].width-headerColumnWidthDiff){h.width(columns[i].width-headerColumnWidthDiff)}}updateColumnCaches()}function applyColumnWidths(){var x=0,w,rule;for(var i=0;i<columns.length;i++){w=columns[i].width;rule=getColumnCssRules(i);rule.left.style.left=x+"px";rule.right.style.right=(canvasWidth-x-w)+"px";x+=columns[i].width}}function setSortColumn(columnId,ascending){setSortColumns([{columnId:columnId,sortAsc:ascending}])}function setSortColumns(cols){sortColumns=cols;var headerColumnEls=$headers.children();headerColumnEls.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc");$.each(sortColumns,function(i,col){if(col.sortAsc==null){col.sortAsc=true}var columnIndex=getColumnIndex(col.columnId);if(columnIndex!=null){headerColumnEls.eq(columnIndex).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(col.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")}})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(e,ranges){selectedRows=[];var hash={};for(var i=0;i<ranges.length;i++){for(var j=ranges[i].fromRow;j<=ranges[i].toRow;j++){if(!hash[j]){selectedRows.push(j);hash[j]={}}for(var k=ranges[i].fromCell;k<=ranges[i].toCell;k++){if(canCellBeSelected(j,k)){hash[j][columns[k].id]=options.selectedCellCssClass}}}}setCellCssStyles(options.selectedCellCssClass,hash);trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},e)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[];columnPosRight=[];var x=0;for(var i=0,ii=columns.length;i<ii;i++){columnPosLeft[i]=x;columnPosRight[i]=x+columns[i].width;x+=columns[i].width}}function setColumns(columnDefinitions){columns=columnDefinitions;columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;if(m.minWidth&&m.width<m.minWidth){m.width=m.minWidth}if(m.maxWidth&&m.width>m.maxWidth){m.width=m.maxWidth}}updateColumnCaches();if(initialized){invalidateAllRows();createColumnHeaders();removeCssRules();createCssRules();resizeCanvas();applyColumnWidths();handleScroll()}}function getOptions(){return options}function setOptions(args){if(!getEditorLock().commitCurrentEdit()){return}makeActiveCellNormal();if(options.enableAddRow!==args.enableAddRow){invalidateRow(getDataLength())}options=$.extend(options,args);validateAndEnforceOptions();$viewport.css("overflow-y",options.autoHeight?"hidden":"auto");render()}function validateAndEnforceOptions(){if(options.autoHeight){options.leaveSpaceForNewRows=false}}function setData(newData,scrollToTop){data=newData;invalidateAllRows();updateRowCount();if(scrollToTop){scrollTo(0)}}function getData(){return data}function getDataLength(){if(data.getLength){return data.getLength()}else{return data.length}}function getDataItem(i){if(data.getItem){return data.getItem(i)}else{return data[i]}}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(visible){if(options.showTopPanel!=visible){options.showTopPanel=visible;if(visible){$topPanelScroller.slideDown("fast",resizeCanvas)}else{$topPanelScroller.slideUp("fast",resizeCanvas)}}}function setHeaderRowVisibility(visible){if(options.showHeaderRow!=visible){options.showHeaderRow=visible;if(visible){$headerRowScroller.slideDown("fast",resizeCanvas)}else{$headerRowScroller.slideUp("fast",resizeCanvas)}}}function scrollTo(y){y=Math.max(y,0);y=Math.min(y,th-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0));var oldOffset=offset;page=Math.min(n-1,Math.floor(y/ph));offset=Math.round(page*cj);var newScrollTop=y-offset;if(offset!=oldOffset){var range=getVisibleRange(newScrollTop);cleanupRows(range);updateRowPositions()}if(prevScrollTop!=newScrollTop){vScrollDir=(prevScrollTop+oldOffset<newScrollTop+offset)?1:-1;$viewport[0].scrollTop=(lastRenderedScrollTop=scrollTop=prevScrollTop=newScrollTop);trigger(self.onViewportChanged,{})}}function defaultFormatter(row,cell,value,columnDef,dataContext){if(value==null){return""}else{return value.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}function getFormatter(row,column){var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnOverrides=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[column.id]||rowMetadata.columns[getColumnIndex(column.id)]);return(columnOverrides&&columnOverrides.formatter)||(rowMetadata&&rowMetadata.formatter)||column.formatter||(options.formatterFactory&&options.formatterFactory.getFormatter(column))||options.defaultFormatter}function getEditor(row,cell){var column=columns[cell];var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[column.id]&&columnMetadata[column.id].editor!==undefined){return columnMetadata[column.id].editor}if(columnMetadata&&columnMetadata[cell]&&columnMetadata[cell].editor!==undefined){return columnMetadata[cell].editor}return column.editor||(options.editorFactory&&options.editorFactory.getEditor(column))}function getDataItemValueForColumn(item,columnDef){if(options.dataItemColumnValueExtractor){return options.dataItemColumnValueExtractor(item,columnDef)}return item[columnDef.field]}function appendRowHtml(stringArray,row,range){var d=getDataItem(row);var dataLoading=row<getDataLength()&&!d;var rowCss="slick-row"+(dataLoading?" loading":"")+(row===activeRow?" active":"")+(row%2==1?" odd":" even");var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(metadata&&metadata.cssClasses){rowCss+=" "+metadata.cssClasses}stringArray.push("<div class='ui-widget-content "+rowCss+"' style='top:"+(options.rowHeight*row-offset)+"px'>");var colspan,m;for(var i=0,ii=columns.length;i<ii;i++){m=columns[i];colspan=1;if(metadata&&metadata.columns){var columnData=metadata.columns[m.id]||metadata.columns[i];colspan=(columnData&&columnData.colspan)||1;if(colspan==="*"){colspan=ii-i}}if(columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx){if(columnPosLeft[i]>range.rightPx){break}appendCellHtml(stringArray,row,i,colspan)}if(colspan>1){i+=(colspan-1)}}stringArray.push("</div>")}function appendCellHtml(stringArray,row,cell,colspan){var m=columns[cell];var d=getDataItem(row);var cellCss="slick-cell l"+cell+" r"+Math.min(columns.length-1,cell+colspan-1)+(m.cssClass?" "+m.cssClass:"");if(row===activeRow&&cell===activeCell){cellCss+=(" active")}for(var key in cellCssClasses){if(cellCssClasses[key][row]&&cellCssClasses[key][row][m.id]){cellCss+=(" "+cellCssClasses[key][row][m.id])}}stringArray.push("<div class='"+cellCss+"'>");if(d){var value=getDataItemValueForColumn(d,m);stringArray.push(getFormatter(row,m)(row,cell,value,m,d))}stringArray.push("</div>");rowsCache[row].cellRenderQueue.push(cell);rowsCache[row].cellColSpans[cell]=colspan}function cleanupRows(rangeToKeep){for(var i in rowsCache){if(((i=parseInt(i,10))!==activeRow)&&(i<rangeToKeep.top||i>rangeToKeep.bottom)){removeRowFromCache(i)}}}function invalidate(){updateRowCount();invalidateAllRows();render()}function invalidateAllRows(){if(currentEditor){makeActiveCellNormal()}for(var row in rowsCache){removeRowFromCache(row)}}function removeRowFromCache(row){var cacheEntry=rowsCache[row];if(!cacheEntry){return}$canvas[0].removeChild(cacheEntry.rowNode);delete rowsCache[row];delete postProcessedRows[row];renderedRows--;counter_rows_removed++}function invalidateRows(rows){var i,rl;if(!rows||!rows.length){return}vScrollDir=0;for(i=0,rl=rows.length;i<rl;i++){if(currentEditor&&activeRow===rows[i]){makeActiveCellNormal()}if(rowsCache[rows[i]]){removeRowFromCache(rows[i])}}}function invalidateRow(row){invalidateRows([row])}function updateCell(row,cell){var cellNode=getCellNode(row,cell);if(!cellNode){return}var m=columns[cell],d=getDataItem(row);if(currentEditor&&activeRow===row&&activeCell===cell){currentEditor.loadValue(d)}else{cellNode.innerHTML=d?getFormatter(row,m)(row,cell,getDataItemValueForColumn(d,m),m,d):"";invalidatePostProcessingResults(row)}}function updateRow(row){var cacheEntry=rowsCache[row];if(!cacheEntry){return}ensureCellNodesInRowsCache(row);for(var columnIdx in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){continue}columnIdx=columnIdx|0;var m=columns[columnIdx],d=getDataItem(row),node=cacheEntry.cellNodesByColumnIdx[columnIdx];if(row===activeRow&&columnIdx===activeCell&&currentEditor){currentEditor.loadValue(d)}else{if(d){node.innerHTML=getFormatter(row,m)(row,columnIdx,getDataItemValueForColumn(d,m),m,d)}else{node.innerHTML=""}}}invalidatePostProcessingResults(row)}function getViewportHeight(){return parseFloat($.css($container[0],"height",true))-parseFloat($.css($container[0],"paddingTop",true))-parseFloat($.css($container[0],"paddingBottom",true))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function getContentSize(){var canvasWidth=$canvas.width(),canvasHeight=$canvas.height(),hasVScroll=canvasHeight>$viewport.height(),contentWidth=canvasWidth+(hasVScroll?scrollbarDimensions.width:0),hasHScroll=contentWidth>$viewport.width(),contentHeight=canvasHeight+(hasHScroll?scrollbarDimensions.height:0);return{width:contentWidth,height:contentHeight}}function getVisibleSize(){var width=$viewport.width(),height=$viewport.height(),hasHScroll=$canvas.width()>width-scrollbarDimensions.width,hasVScroll=$canvas.height()>height-scrollbarDimensions.height;width-=hasVScroll?scrollbarDimensions.width:0;height-=hasHScroll?scrollbarDimensions.height:0;return{width:width,height:height}}function resizeCanvas(){if(!initialized){return}if(options.autoHeight){viewportH=options.rowHeight*(getDataLength()+(options.enableAddRow?1:0))}else{viewportH=getViewportHeight()}numVisibleRows=Math.ceil(viewportH/options.rowHeight);viewportW=parseFloat($.css($container[0],"width",true));if(!options.autoHeight){$viewport.height(viewportH)}if(options.forceFitColumns){autosizeColumns()}cleanUpAndRenderCells(getRenderedRange());updateRowCount();handleScroll();render()}function updateRowCount(){if(!initialized){return}numberOfRows=getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var oldViewportHasVScroll=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&(numberOfRows*options.rowHeight>viewportH);var l=options.enableAddRow?getDataLength():getDataLength()-1;for(var i in rowsCache){if(i>=l){removeRowFromCache(i)}}if(activeCellNode&&activeRow>l){resetActiveCell()}var oldH=h;th=Math.max(options.rowHeight*numberOfRows,viewportH-scrollbarDimensions.height);if(th<maxSupportedCssHeight){h=ph=th;n=1;cj=0}else{h=maxSupportedCssHeight;ph=h/100;n=Math.floor(th/ph);cj=(th-h)/(n-1)}if(h!==oldH){$canvas.css("height",h);scrollTop=$viewport[0].scrollTop}var oldScrollTopInRange=(scrollTop+offset<=th-viewportH);if(th==0||scrollTop==0){page=offset=0}else{if(oldScrollTopInRange){scrollTo(scrollTop+offset)}else{scrollTo(th-viewportH)}}if(h!=oldH&&options.autoHeight){resizeCanvas()}if(options.forceFitColumns&&oldViewportHasVScroll!=viewportHasVScroll){autosizeColumns()}updateCanvasWidth(false)}function getVisibleRange(viewportTop,viewportLeft){if(viewportTop==null){viewportTop=scrollTop}if(viewportLeft==null){viewportLeft=scrollLeft}return{top:Math.floor((viewportTop+offset)/options.rowHeight),bottom:Math.ceil((viewportTop+offset+viewportH)/options.rowHeight),leftPx:viewportLeft,rightPx:viewportLeft+viewportW}}function getRenderedRange(viewportTop,viewportLeft){var range=getVisibleRange(viewportTop,viewportLeft);var buffer=Math.round(viewportH/options.rowHeight);var minBuffer=3;if(vScrollDir==-1){range.top-=buffer;range.bottom+=minBuffer}else{if(vScrollDir==1){range.top-=minBuffer;range.bottom+=buffer}else{range.top-=minBuffer;range.bottom+=minBuffer}}range.top=Math.max(0,range.top);range.bottom=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,range.bottom);range.leftPx-=viewportW;range.rightPx+=viewportW;range.leftPx=Math.max(0,range.leftPx);range.rightPx=Math.min(canvasWidth,range.rightPx);return range}function ensureCellNodesInRowsCache(row){var cacheEntry=rowsCache[row];if(cacheEntry){if(cacheEntry.cellRenderQueue.length){var lastChild=cacheEntry.rowNode.lastChild;while(cacheEntry.cellRenderQueue.length){var columnIdx=cacheEntry.cellRenderQueue.pop();cacheEntry.cellNodesByColumnIdx[columnIdx]=lastChild;lastChild=lastChild.previousSibling}}}}function cleanUpCells(range,row){var totalCellsRemoved=0;var cacheEntry=rowsCache[row];var cellsToRemove=[];for(var i in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(i)){continue}i=i|0;var colspan=cacheEntry.cellColSpans[i];if(columnPosLeft[i]>range.rightPx||columnPosRight[Math.min(columns.length-1,i+colspan-1)]<range.leftPx){if(!(row==activeRow&&i==activeCell)){cellsToRemove.push(i)}}}var cellToRemove;while((cellToRemove=cellsToRemove.pop())!=null){cacheEntry.rowNode.removeChild(cacheEntry.cellNodesByColumnIdx[cellToRemove]);delete cacheEntry.cellColSpans[cellToRemove];delete cacheEntry.cellNodesByColumnIdx[cellToRemove];if(postProcessedRows[row]){delete postProcessedRows[row][cellToRemove]}totalCellsRemoved++}}function cleanUpAndRenderCells(range){var cacheEntry;var stringArray=[];var processedRows=[];var cellsAdded;var totalCellsAdded=0;var colspan;for(var row=range.top;row<=range.bottom;row++){cacheEntry=rowsCache[row];if(!cacheEntry){continue}ensureCellNodesInRowsCache(row);cleanUpCells(range,row);cellsAdded=0;var metadata=data.getItemMetadata&&data.getItemMetadata(row);metadata=metadata&&metadata.columns;for(var i=0,ii=columns.length;i<ii;i++){if(columnPosLeft[i]>range.rightPx){break}if((colspan=cacheEntry.cellColSpans[i])!=null){i+=(colspan>1?colspan-1:0);continue}colspan=1;if(metadata){var columnData=metadata[columns[i].id]||metadata[i];colspan=(columnData&&columnData.colspan)||1;if(colspan==="*"){colspan=ii-i}}if(columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx){appendCellHtml(stringArray,row,i,colspan);cellsAdded++}i+=(colspan>1?colspan-1:0)}if(cellsAdded){totalCellsAdded+=cellsAdded;processedRows.push(row)}}if(!stringArray.length){return}var x=document.createElement("div");x.innerHTML=stringArray.join("");var processedRow;var node;while((processedRow=processedRows.pop())!=null){cacheEntry=rowsCache[processedRow];var columnIdx;while((columnIdx=cacheEntry.cellRenderQueue.pop())!=null){node=x.lastChild;cacheEntry.rowNode.appendChild(node);cacheEntry.cellNodesByColumnIdx[columnIdx]=node}}}function renderRows(range){var parentNode=$canvas[0],stringArray=[],rows=[],needToReselectCell=false;for(var i=range.top;i<=range.bottom;i++){if(rowsCache[i]){continue}renderedRows++;rows.push(i);rowsCache[i]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]};appendRowHtml(stringArray,i,range);if(activeCellNode&&activeRow===i){needToReselectCell=true}counter_rows_rendered++}if(!rows.length){return}var x=document.createElement("div");x.innerHTML=stringArray.join("");for(var i=0,ii=rows.length;i<ii;i++){rowsCache[rows[i]].rowNode=parentNode.appendChild(x.firstChild);rowsCache[rows[i]].rowNode.offsetWidth}if(needToReselectCell){activeCellNode=getCellNode(activeRow,activeCell)}}function startPostProcessing(){if(!options.enableAsyncPostRender){return}clearTimeout(h_postrender);h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay)}function invalidatePostProcessingResults(row){delete postProcessedRows[row];postProcessFromRow=Math.min(postProcessFromRow,row);postProcessToRow=Math.max(postProcessToRow,row);startPostProcessing()}function updateRowPositions(){for(var row in rowsCache){rowsCache[row].rowNode.style.top=(row*options.rowHeight-offset)+"px"}}function render(){if(!initialized){return}var visible=getVisibleRange();var rendered=getRenderedRange();cleanupRows(rendered);if(lastRenderedScrollLeft!=scrollLeft){cleanUpAndRenderCells(rendered)}renderRows(rendered);postProcessFromRow=visible.top;postProcessToRow=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,visible.bottom);startPostProcessing();lastRenderedScrollTop=scrollTop;lastRenderedScrollLeft=scrollLeft;h_render=null}function handleHeaderRowScroll(){var scrollLeft=$headerRowScroller[0].scrollLeft;if(scrollLeft!=$viewport[0].scrollLeft){$viewport[0].scrollLeft=scrollLeft}}function handleScroll(){scrollTop=$viewport[0].scrollTop;scrollLeft=$viewport[0].scrollLeft;var vScrollDist=Math.abs(scrollTop-prevScrollTop);var hScrollDist=Math.abs(scrollLeft-prevScrollLeft);if(hScrollDist){prevScrollLeft=scrollLeft;$headerScroller[0].scrollLeft=scrollLeft;$topPanelScroller[0].scrollLeft=scrollLeft;$headerRowScroller[0].scrollLeft=scrollLeft}if(vScrollDist){vScrollDir=prevScrollTop<scrollTop?1:-1;prevScrollTop=scrollTop;if(vScrollDist<viewportH){scrollTo(scrollTop+offset)}else{var oldOffset=offset;if(h==viewportH){page=n-1}else{page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph)))}offset=Math.round(page*cj);if(oldOffset!=offset){invalidateAllRows()}}}if(hScrollDist||vScrollDist){if(h_render){clearTimeout(h_render)}if(Math.abs(lastRenderedScrollTop-scrollTop)>20||Math.abs(lastRenderedScrollLeft-scrollLeft)>20){if(options.forceSyncScrolling||(Math.abs(lastRenderedScrollTop-scrollTop)<viewportH&&Math.abs(lastRenderedScrollLeft-scrollLeft)<viewportW)){render()}else{h_render=setTimeout(render,50)}trigger(self.onViewportChanged,{})}}trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){while(postProcessFromRow<=postProcessToRow){var row=(vScrollDir>=0)?postProcessFromRow++:postProcessToRow--;var cacheEntry=rowsCache[row];if(!cacheEntry||row>=getDataLength()){continue}if(!postProcessedRows[row]){postProcessedRows[row]={}}ensureCellNodesInRowsCache(row);for(var columnIdx in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){continue}columnIdx=columnIdx|0;var m=columns[columnIdx];if(m.asyncPostRender&&!postProcessedRows[row][columnIdx]){var node=cacheEntry.cellNodesByColumnIdx[columnIdx];if(node){m.asyncPostRender(node,row,getDataItem(row),m)}postProcessedRows[row][columnIdx]=true}}h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay);return}}function updateCellCssStylesOnRenderedRows(addedHash,removedHash){var node,columnId,addedRowHash,removedRowHash;for(var row in rowsCache){removedRowHash=removedHash&&removedHash[row];addedRowHash=addedHash&&addedHash[row];if(removedRowHash){for(columnId in removedRowHash){if(!addedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).removeClass(removedRowHash[columnId])}}}}if(addedRowHash){for(columnId in addedRowHash){if(!removedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).addClass(addedRowHash[columnId])}}}}}}function addCellCssStyles(key,hash){if(cellCssClasses[key]){throw"addCellCssStyles: cell CSS hash with key '"+key+"' already exists."}cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,null);trigger(self.onCellCssStylesChanged,{key:key,hash:hash})}function removeCellCssStyles(key){if(!cellCssClasses[key]){return}updateCellCssStylesOnRenderedRows(null,cellCssClasses[key]);delete cellCssClasses[key];trigger(self.onCellCssStylesChanged,{key:key,hash:null})}function setCellCssStyles(key,hash){var prevHash=cellCssClasses[key];cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,prevHash);trigger(self.onCellCssStylesChanged,{key:key,hash:hash})}function getCellCssStyles(key){return cellCssClasses[key]}function flashCell(row,cell,speed){speed=speed||100;if(rowsCache[row]){var $cell=$(getCellNode(row,cell));function toggleCellClass(times){if(!times){return}setTimeout(function(){$cell.queue(function(){$cell.toggleClass(options.cellFlashingCssClass).dequeue();toggleCellClass(times-1)})},speed)}toggleCellClass(4)}}function handleHeaderDragInit(e,dd){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");if(!column){return false}dd.column=column;retval=trigger(self.onHeaderDragInit,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleHeaderDragStart(e,dd){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");if(!column){return false}dd.column=column;var retval=trigger(self.onHeaderDragStart,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleHeaderDrag(e,dd){return trigger(self.onHeaderDrag,dd,e)}function handleHeaderDragEnd(e,dd){trigger(self.onHeaderDragEnd,dd,e)}function handleDragInit(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}retval=trigger(self.onDragInit,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDragStart(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}var retval=trigger(self.onDragStart,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDrag(e,dd){return trigger(self.onDrag,dd,e)}function handleDragEnd(e,dd){trigger(self.onDragEnd,dd,e)}function handleKeyDown(e){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},e);var handled=e.isImmediatePropagationStopped();if(!handled){if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){if(e.which==27){if(!getEditorLock().isActive()){return}cancelEditAndSetFocus()}else{if(e.which==37){handled=navigateLeft()}else{if(e.which==39){handled=navigateRight()}else{if(e.which==38){handled=navigateUp()}else{if(e.which==40){handled=navigateDown()}else{if(e.which==9){handled=navigateNext()}else{if(e.which==13){if(options.editable){if(currentEditor){if(activeRow===getDataLength()){navigateDown()}else{commitEditAndSetFocus()}}else{if(getEditorLock().commitCurrentEdit()){makeActiveCellEditable()}}}handled=true}}}}}}}}else{if(e.which==9&&e.shiftKey&&!e.ctrlKey&&!e.altKey){handled=navigatePrev()}}}if(handled){e.stopPropagation();e.preventDefault();try{e.originalEvent.keyCode=0}catch(error){}}}function handleClick(e){if(!currentEditor){if(e.target!=document.activeElement){setFocus()}}var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if((activeCell!=cell.cell||activeRow!=cell.row)&&canCellBeActive(cell.row,cell.cell)){if(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit()){scrollRowIntoView(cell.row,false);setActiveCellInternal(getCellNode(cell.row,cell.cell),(cell.row===getDataLength())||options.autoEdit)}}}function handleContextMenu(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if($cell.length===0){return}if(activeCellNode===$cell[0]&&currentEditor!==null){return}trigger(self.onContextMenu,{},e)}function handleDblClick(e){var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onDblClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if(options.editable){gotoCell(cell.row,cell.cell,true)}}function handleHeaderMouseEnter(e){trigger(self.onHeaderMouseEnter,{column:$(this).data("column")},e)}function handleHeaderMouseLeave(e){trigger(self.onHeaderMouseLeave,{column:$(this).data("column")},e)}function handleHeaderContextMenu(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");trigger(self.onHeaderContextMenu,{column:column},e)}function handleHeaderClick(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");if(column){trigger(self.onHeaderClick,{column:column},e)}}function handleMouseEnter(e){trigger(self.onMouseEnter,{},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{},e)}function cellExists(row,cell){return !(row<0||row>=getDataLength()||cell<0||cell>=columns.length)}function getCellFromPoint(x,y){var row=Math.floor((y+offset)/options.rowHeight);var cell=0;var w=0;for(var i=0;i<columns.length&&w<x;i++){w+=columns[i].width;cell++}if(cell<0){cell=0}return{row:row,cell:cell-1}}function getCellFromNode(cellNode){var cls=/l\d+/.exec(cellNode.className);if(!cls){throw"getCellFromNode: cannot get cell - "+cellNode.className}return parseInt(cls[0].substr(1,cls[0].length-1),10)}function getRowFromNode(rowNode){for(var row in rowsCache){if(rowsCache[row].rowNode===rowNode){return row|0}}return null}function getCellFromEvent(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if(!$cell.length){return null}var row=getRowFromNode($cell[0].parentNode);var cell=getCellFromNode($cell[0]);if(row==null||cell==null){return null}else{return{row:row,cell:cell}}}function getCellNodeBox(row,cell){if(!cellExists(row,cell)){return null}var y1=row*options.rowHeight-offset;var y2=y1+options.rowHeight-1;var x1=0;for(var i=0;i<cell;i++){x1+=columns[i].width}var x2=x1+columns[cell].width;return{top:y1,left:x1,bottom:y2,right:x2}}function resetActiveCell(){setActiveCellInternal(null,false)}function setFocus(){if(tabbingDirection==-1){$focusSink[0].focus()}else{$focusSink2[0].focus()}}function scrollCellIntoView(row,cell){var colspan=getColspan(row,cell);var left=columnPosLeft[cell],right=columnPosRight[cell+(colspan>1?colspan-1:0)],scrollRight=scrollLeft+viewportW;if(left<scrollLeft){$viewport.scrollLeft(left);handleScroll();render()}else{if(right>scrollRight){$viewport.scrollLeft(Math.min(left,right-$viewport[0].clientWidth));handleScroll();render()}}}function setActiveCellInternal(newCell,editMode){if(activeCellNode!==null){makeActiveCellNormal();$(activeCellNode).removeClass("active");if(rowsCache[activeRow]){$(rowsCache[activeRow].rowNode).removeClass("active")}}var activeCellChanged=(activeCellNode!==newCell);activeCellNode=newCell;if(activeCellNode!=null){activeRow=getRowFromNode(activeCellNode.parentNode);activeCell=activePosX=getCellFromNode(activeCellNode);$(activeCellNode).addClass("active");$(rowsCache[activeRow].rowNode).addClass("active");if(options.editable&&editMode&&isCellPotentiallyEditable(activeRow,activeCell)){clearTimeout(h_editorLoader);if(options.asyncEditorLoading){h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay)}else{makeActiveCellEditable()}}}else{activeRow=activeCell=null}if(activeCellChanged){trigger(self.onActiveCellChanged,getActiveCell())}}function clearTextSelection(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var sel=window.getSelection();if(sel&&sel.removeAllRanges){sel.removeAllRanges()}}}}function isCellPotentiallyEditable(row,cell){if(row<getDataLength()&&!getDataItem(row)){return false}if(columns[cell].cannotTriggerInsert&&row>=getDataLength()){return false}if(!getEditor(row,cell)){return false}return true}function makeActiveCellNormal(){if(!currentEditor){return}trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor});currentEditor.destroy();currentEditor=null;if(activeCellNode){var d=getDataItem(activeRow);$(activeCellNode).removeClass("editable invalid");if(d){var column=columns[activeCell];var formatter=getFormatter(activeRow,column);activeCellNode.innerHTML=formatter(activeRow,activeCell,getDataItemValueForColumn(d,column),column,getDataItem(activeRow));invalidatePostProcessingResults(activeRow)}}if($.browser.msie){clearTextSelection()}getEditorLock().deactivate(editController)}function makeActiveCellEditable(editor){if(!activeCellNode){return}if(!options.editable){throw"Grid : makeActiveCellEditable : should never get called when options.editable is false"}clearTimeout(h_editorLoader);if(!isCellPotentiallyEditable(activeRow,activeCell)){return}var columnDef=columns[activeCell];var item=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:item,column:columnDef})===false){setFocus();return}getEditorLock().activate(editController);$(activeCellNode).addClass("editable");if(!editor){activeCellNode.innerHTML=""}currentEditor=new (editor||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:columnDef,item:item||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus});if(item){currentEditor.loadValue(item)}serializedEditorValue=currentEditor.serializeValue();if(currentEditor.position){handleActiveCellPositionChange()}}function commitEditAndSetFocus(){if(getEditorLock().commitCurrentEdit()){setFocus();if(options.autoEdit){navigateDown()}}}function cancelEditAndSetFocus(){if(getEditorLock().cancelCurrentEdit()){setFocus()}}function absBox(elem){var box={top:elem.offsetTop,left:elem.offsetLeft,bottom:0,right:0,width:$(elem).outerWidth(),height:$(elem).outerHeight(),visible:true};box.bottom=box.top+box.height;box.right=box.left+box.width;var offsetParent=elem.offsetParent;while((elem=elem.parentNode)!=document.body){if(box.visible&&elem.scrollHeight!=elem.offsetHeight&&$(elem).css("overflowY")!="visible"){box.visible=box.bottom>elem.scrollTop&&box.top<elem.scrollTop+elem.clientHeight}if(box.visible&&elem.scrollWidth!=elem.offsetWidth&&$(elem).css("overflowX")!="visible"){box.visible=box.right>elem.scrollLeft&&box.left<elem.scrollLeft+elem.clientWidth}box.left-=elem.scrollLeft;box.top-=elem.scrollTop;if(elem===offsetParent){box.left+=elem.offsetLeft;box.top+=elem.offsetTop;offsetParent=elem.offsetParent}box.bottom=box.top+box.height;box.right=box.left+box.width}return box}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(!activeCellNode){return}trigger(self.onActiveCellPositionChanged,{});if(currentEditor){var cellBox=getActiveCellPosition();if(currentEditor.show&&currentEditor.hide){if(!cellBox.visible){currentEditor.hide()}else{currentEditor.show()}}if(currentEditor.position){currentEditor.position(cellBox)}}}function getCellEditor(){return currentEditor}function getActiveCell(){if(!activeCellNode){return null}else{return{row:activeRow,cell:activeCell}}}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(row,doPaging){var rowAtTop=row*options.rowHeight;var rowAtBottom=(row+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);if((row+1)*options.rowHeight>scrollTop+viewportH+offset){scrollTo(doPaging?rowAtTop:rowAtBottom);render()}else{if(row*options.rowHeight<scrollTop+offset){scrollTo(doPaging?rowAtBottom:rowAtTop);render()}}}function scrollRowToTop(row){scrollTo(row*options.rowHeight);render()}function getColspan(row,cell){var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(!metadata||!metadata.columns){return 1}var columnData=metadata.columns[columns[cell].id]||metadata.columns[cell];var colspan=(columnData&&columnData.colspan);if(colspan==="*"){colspan=columns.length-cell}else{colspan=colspan||1}return colspan}function findFirstFocusableCell(row){var cell=0;while(cell<columns.length){if(canCellBeActive(row,cell)){return cell}cell+=getColspan(row,cell)}return null}function findLastFocusableCell(row){var cell=0;var lastFocusableCell=null;while(cell<columns.length){if(canCellBeActive(row,cell)){lastFocusableCell=cell}cell+=getColspan(row,cell)}return lastFocusableCell}function gotoRight(row,cell,posX){if(cell>=columns.length){return null}do{cell+=getColspan(row,cell)}while(cell<columns.length&&!canCellBeActive(row,cell));if(cell<columns.length){return{row:row,cell:cell,posX:cell}}return null}function gotoLeft(row,cell,posX){if(cell<=0){return null}var firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell===null||firstFocusableCell>=cell){return null}var prev={row:row,cell:firstFocusableCell,posX:firstFocusableCell};var pos;while(true){pos=gotoRight(prev.row,prev.cell,prev.posX);if(!pos){return null}if(pos.cell>=cell){return prev}prev=pos}}function gotoDown(row,cell,posX){var prevCell;while(true){if(++row>=getDataLength()+(options.enableAddRow?1:0)){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoUp(row,cell,posX){var prevCell;while(true){if(--row<0){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoNext(row,cell,posX){if(row==null&&cell==null){row=cell=posX=0;if(canCellBeActive(row,cell)){return{row:row,cell:cell,posX:cell}}}var pos=gotoRight(row,cell,posX);if(pos){return pos}var firstFocusableCell=null;while(++row<getDataLength()+(options.enableAddRow?1:0)){firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell!==null){return{row:row,cell:firstFocusableCell,posX:firstFocusableCell}}}return null}function gotoPrev(row,cell,posX){if(row==null&&cell==null){row=getDataLength()+(options.enableAddRow?1:0)-1;cell=posX=columns.length-1;if(canCellBeActive(row,cell)){return{row:row,cell:cell,posX:cell}}}var pos;var lastSelectableCell;while(!pos){pos=gotoLeft(row,cell,posX);if(pos){break}if(--row<0){return null}cell=0;lastSelectableCell=findLastFocusableCell(row);if(lastSelectableCell!==null){pos={row:row,cell:lastSelectableCell,posX:lastSelectableCell}}}return pos}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(dir){if(!options.enableCellNavigation){return false}if(!activeCellNode&&dir!="prev"&&dir!="next"){return false}if(!getEditorLock().commitCurrentEdit()){return true}setFocus();var tabbingDirections={up:-1,down:1,left:-1,right:1,prev:-1,next:1};tabbingDirection=tabbingDirections[dir];var stepFunctions={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext};var stepFn=stepFunctions[dir];var pos=stepFn(activeRow,activeCell,activePosX);if(pos){var isAddNewRow=(pos.row==getDataLength());scrollRowIntoView(pos.row,!isAddNewRow);scrollCellIntoView(pos.row,pos.cell);setActiveCellInternal(getCellNode(pos.row,pos.cell),isAddNewRow||options.autoEdit);activePosX=pos.posX;return true}else{setActiveCellInternal(getCellNode(activeRow,activeCell),(activeRow==getDataLength())||options.autoEdit);return false}}function getCellNode(row,cell){if(rowsCache[row]){ensureCellNodesInRowsCache(row);return rowsCache[row].cellNodesByColumnIdx[cell]}return null}function setActiveCell(row,cell){if(!initialized){return}if(row>getDataLength()||row<0||cell>=columns.length||cell<0){return}if(!options.enableCellNavigation){return}scrollRowIntoView(row,false);scrollCellIntoView(row,cell);setActiveCellInternal(getCellNode(row,cell),false)}function canCellBeActive(row,cell){if(!options.enableCellNavigation||row>=getDataLength()+(options.enableAddRow?1:0)||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.focusable==="boolean"){return rowMetadata.focusable}var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[columns[cell].id]&&typeof columnMetadata[columns[cell].id].focusable==="boolean"){return columnMetadata[columns[cell].id].focusable}if(columnMetadata&&columnMetadata[cell]&&typeof columnMetadata[cell].focusable==="boolean"){return columnMetadata[cell].focusable}return columns[cell].focusable}function canCellBeSelected(row,cell){if(row>=getDataLength()||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.selectable==="boolean"){return rowMetadata.selectable}var columnMetadata=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[columns[cell].id]||rowMetadata.columns[cell]);if(columnMetadata&&typeof columnMetadata.selectable==="boolean"){return columnMetadata.selectable}return columns[cell].selectable}function gotoCell(row,cell,forceEdit){if(!initialized){return}if(!canCellBeActive(row,cell)){return}if(!getEditorLock().commitCurrentEdit()){return}scrollRowIntoView(row,false);scrollCellIntoView(row,cell);var newCell=getCellNode(row,cell);setActiveCellInternal(newCell,forceEdit||(row===getDataLength())||options.autoEdit);if(!currentEditor){setFocus()}}function commitCurrentEdit(){var item=getDataItem(activeRow);var column=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var validationResults=currentEditor.validate();if(validationResults.valid){if(activeRow<getDataLength()){var editCommand={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(item,this.serializedValue);updateRow(this.row)},undo:function(){this.editor.applyValue(item,this.prevSerializedValue);updateRow(this.row)}};if(options.editCommandHandler){makeActiveCellNormal();options.editCommandHandler(item,column,editCommand)}else{editCommand.execute();makeActiveCellNormal()}trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:item})}else{var newItem={};currentEditor.applyValue(newItem,currentEditor.serializeValue());makeActiveCellNormal();trigger(self.onAddNewRow,{item:newItem,column:column})}return !getEditorLock().isActive()}else{$(activeCellNode).addClass("invalid");$(activeCellNode).stop(true,true).effect("highlight",{color:"red"},300);trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:validationResults,row:activeRow,cell:activeCell,column:column});currentEditor.focus();return false}}makeActiveCellNormal()}return true}function cancelCurrentEdit(){makeActiveCellNormal();return true}function rowsToRanges(rows){var ranges=[];var lastCell=columns.length-1;for(var i=0;i<rows.length;i++){ranges.push(new Slick.Range(rows[i],0,rows[i],lastCell))}return ranges}function getSelectedRows(){if(!selectionModel){throw"Selection model is not set"}return selectedRows}function setSelectedRows(rows){if(!selectionModel){throw"Selection model is not set"}selectionModel.setSelectedRanges(rowsToRanges(rows))}this.debug=function(){var s="";s+=("\ncounter_rows_rendered:  "+counter_rows_rendered);s+=("\ncounter_rows_removed:  "+counter_rows_removed);s+=("\nrenderedRows:  "+renderedRows);s+=("\nnumVisibleRows:  "+numVisibleRows);s+=("\nmaxSupportedCssHeight:  "+maxSupportedCssHeight);s+=("\nn(umber of pages):  "+n);s+=("\n(current) page:  "+page);s+=("\npage height (ph):  "+ph);s+=("\nvScrollDir:  "+vScrollDir);alert(s)};this.eval=function(expr){return eval(expr)};$.extend(this,{slickGridVersion:"2.1",onScroll:new Slick.Event(),onSort:new Slick.Event(),onHeaderMouseEnter:new Slick.Event(),onHeaderMouseLeave:new Slick.Event(),onHeaderContextMenu:new Slick.Event(),onHeaderClick:new Slick.Event(),onHeaderCellRendered:new Slick.Event(),onBeforeHeaderCellDestroy:new Slick.Event(),onHeaderRowCellRendered:new Slick.Event(),onBeforeHeaderRowCellDestroy:new Slick.Event(),onMouseEnter:new Slick.Event(),onMouseLeave:new Slick.Event(),onClick:new Slick.Event(),onDblClick:new Slick.Event(),onContextMenu:new Slick.Event(),onKeyDown:new Slick.Event(),onAddNewRow:new Slick.Event(),onValidationError:new Slick.Event(),onCanvasWidthChanged:new Slick.Event(),onViewportChanged:new Slick.Event(),onColumnsReordered:new Slick.Event(),onColumnsResized:new Slick.Event(),onCellChange:new Slick.Event(),onBeforeEditCell:new Slick.Event(),onBeforeCellEditorDestroy:new Slick.Event(),onBeforeDestroy:new Slick.Event(),onActiveCellChanged:new Slick.Event(),onActiveCellPositionChanged:new Slick.Event(),onHeaderDragInit:new Slick.Event(),onHeaderDragStart:new Slick.Event(),onHeaderDrag:new Slick.Event(),onHeaderDragEnd:new Slick.Event(),onDragInit:new Slick.Event(),onDragStart:new Slick.Event(),onDrag:new Slick.Event(),onDragEnd:new Slick.Event(),onSelectedRowsChanged:new Slick.Event(),onCellCssStylesChanged:new Slick.Event(),registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,getContentSize:getContentSize,getVisibleSize:getVisibleSize,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,scrollRowToTop:scrollRowToTop,scrollCellIntoView:scrollCellIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,gotoCell:gotoCell,getTopPanel:getTopPanel,setTopPanelVisibility:setTopPanelVisibility,setHeaderRowVisibility:setHeaderRowVisibility,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController});init()}}(jQuery));(function(b){b.extend(true,window,{Slick:{Data:{GroupItemMetadataProvider:a}}});function a(n){var j;var g={groupCssClass:"slick-group",groupTitleCssClass:"slick-group-title",totalsCssClass:"slick-group-totals",groupSelectable:false,groupFocusable:true,totalsFocusable:false,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:true};n=b.extend(true,{},g,n);function i(t,o,s,p,r){if(!n.enableExpandCollapse){return r.title}var q=r.level*15+"px";return"<span class='"+n.toggleCssClass+" "+(r.collapsed?n.toggleCollapsedCssClass:n.toggleExpandedCssClass)+"' style='margin-left:"+q+"'></span><span class='"+n.groupTitleCssClass+"' level='"+r.level+"'>"+r.title+"</span>"}function d(s,o,r,p,q){return(p.groupTotalsFormatter&&p.groupTotalsFormatter(q,p))||""}function m(o){j=o;j.onClick.subscribe(f);j.onKeyDown.subscribe(k)}function l(){if(j){j.onClick.unsubscribe(f);j.onKeyDown.unsubscribe(k)}}function f(q,o){var p=this.getDataItem(o.row);if(p&&p instanceof Slick.Group&&b(q.target).hasClass(n.toggleCssClass)){if(p.collapsed){this.getData().expandGroup(p.groupingKey)}else{this.getData().collapseGroup(p.groupingKey)}q.stopImmediatePropagation();q.preventDefault()}}function k(r,p){if(n.enableExpandCollapse&&(r.which==b.ui.keyCode.SPACE)){var o=this.getActiveCell();if(o){var q=this.getDataItem(o.row);if(q&&q instanceof Slick.Group){if(q.collapsed){this.getData().expandGroup(q.groupingKey)}else{this.getData().collapseGroup(q.groupingKey)}r.stopImmediatePropagation();r.preventDefault()}}}}function c(o){return{selectable:n.groupSelectable,focusable:n.groupFocusable,cssClasses:n.groupCssClass,columns:{0:{colspan:"*",formatter:i,editor:null}}}}function h(o){return{selectable:false,focusable:n.totalsFocusable,cssClasses:n.totalsCssClass,formatter:d,editor:null}}return{init:m,destroy:l,getGroupRowMetadata:c,getTotalsRowMetadata:h}}})(jQuery);DG._guid=-1;DG.Record=SC.Record.extend({ignoreUnknownProperties:YES,recordType:function(){return this.constructor}.property().cacheable(),guid:SC.Record.attr(String,{defaultValue:function(){return DG._guid--}}),willSaveRecord:function(){},didLoadRecord:function(){},toLink:function(){var b=this.get("recordType"),a=DG.Record.stringFromRecordType(b);return{type:a,id:this.get("id")}},toArchive:function(){var a=this.get("store"),h=this.get("id"),g=this.get("recordType"),d=a.storeKeyFor(g,h),c=null,f=this;function b(j,i){if(i.isOwner){var k=f.get(j)||[],l=[];c[j]=[];k.forEach(function(n){var m=n&&n.get("status");if(m&&!(m&SC.Record.DESTROYED)&&(m!==SC.Record.BUSY_DESTROYING)){l.push(n)}});l.sort(function(n,m){var p=n.get("id"),o=m.get("id");if(p<o){return -1}if(p>o){return 1}return 0});l.forEach(function(m){var n=m.toArchive();if(n){delete n[i.inverse];c[j].push(n)}})}else{if(i.isMaster){delete c[j]}}}this.willSaveRecord();c=SC.copy(a.readDataHash(d),false)||{};this.forEachRelation(b);return c},forEachRelation:function(a){DG.Record.forEachRelation(this.get("recordType"),a)}});DG.Record.stringFromRecordType=function(a){return SC._object_className(a)||""};DG.Record.recordTypeFromString=function(d){var c=d.indexOf("."),a=c>=0?c+1:0,b=d.substr(a);return DG[b]};DG.Record.forEachRelation=function(c,h){var g=c.prototype,d,b,f,i,a;for(d in g){if(g.hasOwnProperty(d)){b=g[d];if(b&&b.typeClass&&b.inverse){f=b.typeClass();i=f.prototype;a=i[b.inverse];if(SC.typeOf(f)===SC.T_CLASS){h(d,b,a)}}}}};DG.Record._destroyRecordArrayWithExclusions=function(b,f){var c=[];b.flush();if(b.get("scheduledFlushCount")>0){window.setTimeout(function(){SC.run(function(){DG.Record._destroyRecordArrayWithExclusions(b,f)})},1);return}if(f){f.sort(DG.ArrayUtils.numericComparator)}var d=b.get("storeKeys");function g(h){var j=DG.store.idFor(h),i=DG.ArrayUtils.binarySearch(f,j,DG.ArrayUtils.numericComparator);return i===-1}var a=d.filter(g);a.forEach(function(h){c.push(DG.store.idFor(h))});DG.store.destroyRecords(undefined,undefined,a);b.destroy();return c};DG.Record.destroyAllRecordsOfType=function(b,c){var a;a=DG.store.find(b);return DG.Record._destroyRecordArrayWithExclusions(a,c)};sc_require("models/dg_record");DG.Attribute=DG.Record.extend({name:SC.Record.attr(String,{defaultValue:""}),formula:SC.Record.attr(String,{defaultValue:""}),colormap:SC.Record.attr(Object,{defaultValue:null}),description:SC.Record.attr(String,{defaultValue:""}),collection:SC.Record.toOne("DG.CollectionRecord",{inverse:"attrs",isOwner:NO,isMaster:NO}),precision:SC.Record.attr(Number,{defaultValue:2}),editable:SC.Record.attr(Boolean,{defaultValue:false}),_dgFormula:null,init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("formula");if(!SC.empty(a)&&!this._dgFormula){this.createDGFormula();this._dgFormula.set("source",a)}},destroy:function(){if(this._dgFormula){this.destroyDGFormula()}arguments.callee.base.apply(this,arguments)},createDGFormula:function(){this._dgFormula=DG.Formula.create({context:DG.CollectionFormulaContext.create({collection:this.get("collection")})});this._dgFormula.addObserver("dependentChange",this,"dependentDidChange")},destroyDGFormula:function(){this._dgFormula.removeObserver("dependentChange",this,"dependentDidChange");this._dgFormula.destroy();this._dgFormula=null},hasFormula:function(){return !SC.empty(this.get("formula"))}.property("formula").cacheable(),evalFormula:function(b){var d=this._dgFormula,a=NaN;try{a=d.evaluate({_case_:b,_id_:b&&b.get("id")})}catch(c){a=c}return a},formulaDidChange:function(){var a=this.get("formula");if(!SC.empty(a)){if(!this._dgFormula){this.createDGFormula()}this._dgFormula.set("source",a)}else{if(this._dgFormula){this.destroyDGFormula()}}}.observes("formula"),dependentDidChange:function(a,b){this.notifyPropertyChange(b)},didLoadRecord:function(){var a=this.get("id");DG.Attribute.idMap[a]=this}});DG.Attribute.idMap={};DG.Attribute.getAttributeByID=function(a){return DG.Attribute.idMap[a]};DG.Attribute.createAttribute=function(b){var a=DG.store.createRecord(DG.Attribute,b||{});DG.store.commitRecords();DG.Attribute.idMap[a.get("id")]=a;return a};DG.Attribute.destroyAttribute=function(a){var b=a&&a.get("id");if(!SC.none(b)){delete DG.Attribute.idMap[b]}a.destroy()};sc_require("models/dg_record");DG.Case=DG.Record.extend({revision:0,collection:SC.Record.toOne("DG.CollectionRecord",{inverse:"cases",isMaster:NO}),parent:SC.Record.toOne("DG.Case",{inverse:"children",isOwner:NO,isMaster:NO}),children:SC.Record.toMany("DG.Case",{inverse:"parent",isOwner:NO,isMaster:YES}),_id:null,_valuesMap:null,values:SC.Record.attr(Object,{defaultValue:{}}),init:function(){arguments.callee.base.apply(this,arguments);this._valuesMap={}},destroy:function(){this._valuesMap=null;arguments.callee.base.apply(this,arguments)},beginCaseValueChanges:function(){this.beginPropertyChanges()},endCaseValueChanges:function(){this.incrementProperty("revision");this.endPropertyChanges()},getValue:function(c){if(!SC.none(c)){var a=DG.Attribute.getAttributeByID(c);if(a&&a.get("hasFormula")&&(this.getPath("collection.id")===a.getPath("collection.id"))){return a.evalFormula(this)}if(this._valuesMap&&(this._valuesMap[c]!==undefined)){return this._valuesMap[c]}var b=this.get("parent");if(b){return b.getValue(c)}}},getNumValue:function(b,a){var c=this.getValue(b),d=typeof c;if(a){a.type=d;a.isNominal=(d==="boolean")||((d==="string")&&!SC.empty(String(c)))}switch(d){case"number":return c;case"string":return(c!==""?Number(c):NaN)}return NaN},getStrValue:function(b,a){var c=this.getValue(b),d=typeof c;if(a){a.type=d}switch(d){case"number":case"string":case"boolean":return String(c)}return""},hasValue:function(c){if(!SC.none(c)){var a=DG.Attribute.getAttributeByID(c);if(a&&a.get("hasFormula")){return true}if(this._valuesMap&&!SC.empty(this._valuesMap[c])){return true}var b=this.get("parent");return b&&b.hasValue(c)}},setValue:function(a,b){if(!this._valuesMap){return}this._valuesMap[a]=b},toArchive:function(){var a={};DG.ObjectMap.forEach(this._valuesMap,function(c,f){var b=DG.Attribute.getAttributeByID(c),d=b&&b.get("name");if(f!==undefined){a[d]=f}});this.set("values",a);return arguments.callee.base.apply(this,arguments)},didLoadRecord:function(){var b=this.get("collection"),a={};DG.ObjectMap.forEach(this.get("values"),function(d,g){if(g!==undefined){var c=b&&b.getAttributeByName(d),f=c&&c.get("id");if(!SC.none(f)){a[f]=g}}});this._valuesMap=a;this.set("values",null)},debugLog:function(a){DG.log("Case "+this.get("id"))}});DG.Case.createCase=function(b){var a=DG.store.createRecord(DG.Case,b||{});DG.store.commitRecords();a._id=a.get("id");return a};DG.Case.destroyCase=function(a){a.destroy()};DG.Collection=SC.Object.extend({collectionRecord:null,id:function(){return this.collectionRecord&&this.collectionRecord.get("id")}.property("collectionRecord").cacheable(),attrsQuery:null,attrsRecords:null,casesQuery:null,casesRecords:null,init:function(){arguments.callee.base.apply(this,arguments);function a(c,b){var f=c._id||c.get("id"),d=b._id||b.get("id");if(f<d){return -1}if(f>d){return 1}return 0}this.attrsQuery=SC.Query.local(DG.Attribute,{conditions:"collection = {collection}",collection:this.collectionRecord,orderBy:a});this.attrsRecords=DG.store.find(this.attrsQuery);this.casesQuery=SC.Query.local(DG.Case,{conditions:"collection = {collection}",collection:this.collectionRecord,orderBy:a});this.casesRecords=DG.store.find(this.casesQuery);this.updateCaseIDToIndexMap()},areParentChildLinksConfigured:function(){return this.getPath("collectionRecord.areParentChildLinksConfigured")}.property("collectionRecord.areParentChildLinksConfigured").cacheable(),isAncestorOf:function(a){var b=this.get("collectionRecord");return b&&b.isAncestorOf(a.get("collectionRecord"))},isDescendantOf:function(a){var b=this.get("collectionRecord");return b&&b.isDescendantOf(a.get("collectionRecord"))},createAttribute:function(a){a=a||{};a.collection=this.get("id");return DG.Attribute.createAttribute(a)},createCase:function(f){f=f||{};f.collection=this.get("id");var b=DG.Case.createCase(f),a=b.get("id"),g=b.getPath("parent.id"),d=this.collectionRecord.get("caseIDToIndexMap"),c=this.collectionRecord.get("caseCounts");if(c[g]==null){c[g]=0}d[a]=c[g]++;return b},deleteCase:function(a){DG.Case.destroyCase(a)},getAttributeIDs:function(){return this.attrsRecords.getEach("id")},getAttributeNames:function(){return this.attrsRecords.getEach("name")},getCaseIDs:function(){return this.casesRecords.getEach("id")},updateCaseIDToIndexMap:function(){var a={},b={};this.casesRecords.forEach(function(d){if(!d.get("isDestroyed")){var c=d.get("id"),f=d.getPath("parent.id");if(a[f]==null){a[f]=0}b[c]=a[f]++}});this.collectionRecord.set("caseIDToIndexMap",b);this.collectionRecord.set("caseCounts",a)},refresh:function(){this.attrsRecords.refresh();this.casesRecords.refresh()},debugLog:function(a){DG.log((a||"")+" Collection "+this.getPath("collectionRecord.id")+",  Attrs: ["+this.getAttributeIDs()+"],  Cases: ["+this.getCaseIDs()+"]")}});sc_require("models/dg_record");DG.CollectionRecord=DG.Record.extend((function(){return{name:SC.Record.attr(String,{defaultValue:""}),description:SC.Record.attr(String,{defaultValue:""}),context:SC.Record.toOne("DG.DataContextRecord",{inverse:"collections",isOwner:NO,isMaster:NO}),parent:SC.Record.toOne("DG.CollectionRecord",{inverse:"children",isOwner:NO,isMaster:NO}),children:SC.Record.toMany("DG.CollectionRecord",{inverse:"parent",isOwner:NO,isMaster:YES}),areParentChildLinksConfigured:false,attrs:SC.Record.toMany("DG.Attribute",{inverse:"collection",isOwner:YES,isMaster:YES}),cases:SC.Record.toMany("DG.Case",{inverse:"collection",isOwner:YES,isMaster:YES}),caseIDToIndexMap:null,caseCounts:null,destroy:function(){this.cases.forEach(function(a){DG.Case.destroyCase(a)});this.attrs.forEach(function(a){DG.Attribute.destroyAttribute(a)});arguments.callee.base.apply(this,arguments)},isAncestorOf:function(a){return a.isDescendantOf(this)},isDescendantOf:function(a){var b=this.get("parent");if(!b){return false}if(b===a){return true}return b.isDescendantOf(a)},getAttributeByName:function(c){var b=this.get("attrs"),d,f=b&&b.get("length");for(d=0;d<f;++d){var a=b.objectAt(d);if(a&&(a.get("name")===c)){return a}}return null}}}()));DG.CollectionRecord.createCollection=function(b){var a=DG.store.createRecord(DG.CollectionRecord,b||{});if(!SC.none(b.areParentChildLinksConfigured)){a.set("areParentChildLinksConfigured",b.areParentChildLinksConfigured)}DG.store.commitRecords();return a};DG.CollectionRecord.destroyCollection=function(a){a.destroy()};sc_require("models/dg_record");DG.Component=DG.Record.extend({document:SC.Record.toOne("DG.Document",{inverse:"components",isOwner:NO,isMaster:NO}),content:function(a,b){if(b!==undefined){DG.Component.setContent(this,b);return this}return DG.Component.getContent(this)}.property(),type:SC.Record.attr(String),layout:SC.Record.attr(Object,{defaultValue:null}),componentStorage:SC.Record.attr(Object,{defaultValue:null})});DG.Component.contentMap={};DG.Component.getContent=function(a){var b=a&&DG.store.idFor(a.get("storeKey"));return b?DG.Component.contentMap[b]:undefined};DG.Component.setContent=function(a,c){var b=a&&DG.store.idFor(a.get("storeKey"));if(!SC.none(b)){if(c===undefined){delete DG.Component.contentMap[b]}else{DG.Component.contentMap[b]=c}}};DG.Component.createComponent=function(a){var b=DG.store.createRecord(DG.Component,a||{});b.normalize();DG.store.commitRecords();return b};DG.Component.destroyComponent=function(a){a.destroy();DG.store.commitRecords()};sc_require("models/dg_record");DG.DataContextRecord=DG.Record.extend({type:SC.Record.attr(String,{defaultValue:"DG.DataContext"}),document:SC.Record.toOne("DG.Document",{inverse:"contexts",isOwner:NO,isMaster:NO}),collections:SC.Record.toMany("DG.CollectionRecord",{inverse:"context",isOwner:YES,isMaster:YES}),contextStorage:SC.Record.attr(Object,{defaultValue:null}),destroy:function(){this.collections.forEach(function(a){DG.CollectionRecord.destroy(a)});arguments.callee.base.apply(this,arguments)},createCollection:function(a){a=a||{};a.context=this.get("id");return DG.CollectionRecord.createCollection(a)}});DG.DataContextRecord.createContext=function(b){if(SC.none(b)){b={}}if(SC.none(b.type)){b.type="DG.DataContext"}var a=DG.store.createRecord(DG.DataContextRecord,b);DG.store.commitRecords();return a};DG.DataContextRecord.destroyContext=function(a){a.destroy()};SC.Query.orderStoreKeys=function(g,h,b){if(g){var f,a=g.get("length"),j=true,d=null;for(f=0;f<a;f++){var c=g.objectAt(f);if(d&&SC.Query.compareStoreKeys(h,b,d,c)>0){j=false;break}d=c}if(!j){g.sort(function(k,i){return SC.Query.compareStoreKeys(h,b,k,i)})}}return g};sc_require("models/dg_record");DG.Document=DG.Record.extend({name:SC.Record.attr(String,{defaultValue:""}),appName:SC.Record.attr(String,{defaultValue:""}),appVersion:SC.Record.attr(String,{defaultValue:""}),appBuildNum:SC.Record.attr(String,{defaultValue:""}),components:SC.Record.toMany("DG.Component",{inverse:"document",isOwner:YES,isMaster:YES}),contexts:SC.Record.toMany("DG.DataContextRecord",{inverse:"context",isOwner:YES,isMaster:YES}),globalValues:SC.Record.toMany("DG.GlobalValue",{inverse:"document",isOwner:YES,isMaster:YES}),contextRecords:null,init:function(){arguments.callee.base.apply(this,arguments);this.contextRecords=DG.store.find(DG.DataContextRecord)},destroy:function(){this.get("globalValues").forEach(function(a){DG.GlobalValue.destroy(a)});this.get("contexts").forEach(function(a){DG.DataContextRecord.destroy(a)});this.get("components").forEach(function(a){DG.Component.destroy(a)});arguments.callee.base.apply(this,arguments)},createContext:function(a){if(SC.none(a)){a={}}a.document=this.get("id");return DG.DataContextRecord.createContext(a)},willSaveRecord:function(){this.set("appName",DG.APPNAME);this.set("appVersion",DG.VERSION);this.set("appBuildNum",DG.BUILD_NUM)}});DG.Document.createDocument=function(d){var c="DG.MemoryDataSource",b=c;var a=SC.Store.create({document:this}).from(b);DG.assert(!DG.store,"Can't create another document without closing the first.");DG.store=a;var f=a.createRecord(DG.Document,d||{});DG.store.commitRecords();return f};DG.Document.destroyDocument=function(a){a.destroy();DG.store=null};sc_require("models/dg_record");DG.GlobalValue=DG.Record.extend({name:SC.Record.attr(String,{defaultValue:""}),value:SC.Record.attr(Number),document:SC.Record.toOne("DG.Document",{inverse:"globalValues",isOwner:NO,isMaster:NO})});DG.GlobalValue.createGlobalValue=function(b){var a=DG.store.createRecord(DG.GlobalValue,b||{});DG.store.commitRecords();return a};DG.GlobalValue.destroyGlobalValue=function(a){a.destroy()};SC.stringsFor("English",{"DG.mainPage.mainPane.logoutButton.title":"Logout","DG.mainPage.mainPane.logoutButton.toolTip":"Log out the current user","DG.mainPage.mainPane.versionString":"Version %@ (%@)","DG.mainPage.mainPane.messageView.value":"Unfortunately, DG is not currently supported on your browser. DG is supported on Internet Explorer 9+, Firefox 3.6+, Chrome 10+, and Safari 4+. DG is not actively supported on other browsers at this time.","DG.Authorization.guestUserName":"guest","DG.Authorization.guestPassword":"","DG.Authorization.loginPane.dialogTitle":"Data Games Login","DG.Authorization.loginPane.userLabel":"User","DG.Authorization.loginPane.passwordLabel":"Password","DG.Authorization.loginPane.loginAsGuest":"Login as guest","DG.Authorization.loginPane.login":"Login","DG.Authorization.loginPane.registerLink":"<a href='http://%@/user/register'>Create a new account</a>","DG.Authorization.loginPane.recoveryLink":"<a href='http://%@/user/password'>Forgot your password?</a>","DG.Authorization.loginPane.error.general":"Error occurred while logging in","DG.Authorization.loginPane.error.userDatabaseError":"Error connecting to the user database","DG.Authorization.loginPane.error.authFailed":"Invalid username or password","DG.Authorization.loginPane.error.noResponse":"Could not connect to login server","DG.Authorization.loginPane.error.sessionExpired":"Session expired, please login again","DG.Authorization.loginPane.error.invalidSession":"Session invalid, please login again","DG.mainPage.mainPane.versionString.IS_BUILD":"Version %@ (%@ IS)","DG.Authorization.loginPane.registerLink.IS_BUILD":"","DG.Authorization.loginPane.recoveryLink.IS_BUILD":"","DG.mainPage.mainPane.versionString.SRRI_BUILD":"Version %@ (%@.srri10)","DG.Authorization.loginPane.registerLink.SRRI_BUILD":"<a href='http://%@/user/register'>Create a new account</a>","DG.Authorization.loginPane.recoveryLink.SRRI_BUILD":"<a href='http://%@/user/password'>Forgot your password?</a>","DG.AppController.resetData.title":"Clear Data...","DG.AppController.resetData.toolTip":"Delete all data from completed games","DG.AppController.resetData.warnMessage":"Do you really want to delete all the completed game data?","DG.AppController.resetData.warnDescription":"This action is not undoable.","DG.AppController.resetData.okButtonTitle":"Yes, delete the data","DG.AppController.resetData.cancelButtonTitle":"No, keep the data","DG.AppController.fileMenuItems.openDocument":"Open Document...","DG.AppController.fileMenuItems.saveDocument":"Save Document...","DG.AppController.fileMenuItems.documentManager":"Manage Documents...","DG.AppController.fileMenuItems.closeDocument":"Close Document...","DG.AppController.fileMenuItems.importDocument":"Import JSON Document...","DG.AppController.fileMenuItems.exportDocument":"Export JSON Document...","DG.AppController.fileMenuItems.exportCaseData":"Export Case Data...","DG.AppController.closeDocument.warnMessage":"Close the current document without saving?","DG.AppController.closeDocument.warnDescription":"This action is not undoable.","DG.AppController.closeDocument.okButtonTitle":"Close","DG.AppController.closeDocument.cancelButtonTitle":"Cancel","DG.AppController.beforeUnload.confirmationMessage":"The document contains unsaved changes.","DG.AppController.optionMenuItems.reportProblem":"Report Problem...","DG.AppController.optionMenuItems.viewWebPage":"Display Web Page...","DG.AppController.optionMenuItems.configureGuide":"Configure Guide...","DG.AppController.optionMenuItems.about":"About Data Games...","DG.AppController.optionMenuItems.releaseNotes":"What's New?","DG.AppController.optionMenuItems.help":"Help...","DG.AppController.optionMenuItems.toWebSite":"Data Games website","DG.AppController.optionMenuItems.logout":"Logout","DG.AppController.openDocument.prompt":"Choose a document to open:","DG.AppController.openDocument.okTitle":"Open","DG.AppController.openDocument.okTooltip":"Open the specified document","DG.AppController.openDocument.error.unknown":"The document could not be opened because an unknown error occurred.","DG.AppController.openDocument.error.general":"The document could not be opened because an error occurred.","DG.AppController.openDocument.error.notFound":"The document could not be found.","DG.AppController.openDocument.error.documentDatabaseConnectFailed":"An error occurred while trying to connect to the database.","DG.AppController.openDocument.error.permissions":"The document could not be opened. Please have the owner make it a shared document in order to access it.","DG.AppController.saveDocument.error.writeFailed":"An error occurred when trying to save the document.","DG.AppController.saveDocument.error.documentDatabaseConnectFailed":"An error occurred while trying to connect to the database.","DG.AppController.saveDocument.error.general":"The document could not be saved because an error occurred.","DG.AppController.saveDocument.prompt":"Choose a name for the document:","DG.AppController.saveDocument.okTitle":"Save","DG.AppController.saveDocument.okTooltip":"Save the document with the specified name","DG.AppController.importDocument.prompt":"Paste a JSON document to import:","DG.AppController.importDocument.okTitle":"Import","DG.AppController.importDocument.okTooltip":"Import the specified JSON document","DG.AppController.exportDocument.prompt":"Copy the JSON document for export:","DG.AppController.exportCaseData.prompt":"Copy the case data, from:","DG.AppController.exportCaseData.okTitle":"Done","DG.AppController.exportCaseData.okTooltip":"Done with export","DG.AppController.exportDocument.okTitle":"Done","DG.AppController.exportDocument.okTooltip":"Done with JSON export","DG.AppController.reportProblem.dialogTitle":"Report Data Games Problem","DG.AppController.manageDocumentsURL":"/datagames_documents_manager","DG.AppController.showWebSiteURL":"/","DG.AppController.showHelpURL":"/support","DG.AppController.showHelpTitle":"Help with Data Games","DG.AppController.showAboutURL":"DataGames/WebPages/about/aboutDG.html","DG.AppController.showAboutTitle":"About Data Games","DG.AppController.showReleaseNotesURL":"http://play.ccssgames.com/release_notes","DG.AppController.showReleaseNotesTitle":"Data Games Release Notes","DG.OpenSaveDialog.promptView.value":"Choose a document/name","DG.OpenSaveDialog.documentNameView.prompt":"Document Name:","DG.OpenSaveDialog.okButton.title":"Open/Save","DG.OpenSaveDialog.okButton.toolTip":"Open/Save the specified document","DG.OpenSaveDialog.cancelButton.title":"Cancel","DG.OpenSaveDialog.cancelButton.toolTip":"Dismiss the dialog without making any changes","DG.OpenSaveDialog.documentPermissions.title":"Shared","DG.OpenSaveDialog.documentPermissions.toolTip":"Allow other users to access this document?","DG.OpenSaveDialog.loading":"Loading document list...","DG.OpenSaveDialog.noDocuments":"No documents found","DG.OpenSaveDialog.error.noResponse":"Error retrieving document list","DG.SingleTextDialog.okButton.title":"OK","DG.SingleTextDialog.cancelButton.title":"Cancel","DG.SingleTextDialog.cancelButton.toolTip":"Dismiss the dialog without making any changes","DG.DocumentController.calculatorTitle":"Calculator","DG.DocumentController.caseTableTitle":"Case Table","DG.DocumentController.graphTitle":"Graph","DG.DocumentController.sliderTitle":"Slider","DG.DocumentController.textTitle":"Text","DG.DocumentController.mapTitle":"Map","DG.DocumentController.saveDocument.errorMsg":"The document could not be saved because an error occurred.","DG.DocumentController.enterURLPrompt":"Enter the URL of a web page to display","DG.DocumentController.enterViewWebPageOKTip":"Displays the web page given by the URL","DG.DocumentListController.error.general":"There was an error retrieving documents","DG.DocumentListController.error.parseError":"Unable to parse response from server","DG.DocumentListController.error.documentDatabaseConnectFailed":"Error connecting to database","DG.Document.defaultDocumentName":"Untitled Document","DG.SliderView.thumbView.toolTip":"Drag to change the slider's value","DG.SliderView.startButton.toolTip":"Start/stop animation","DG.ToolButtonData.fileMenu.title":"File","DG.ToolButtonData.fileMenu.toolTip":"Save and open document (ctrl-s and ctrl-o)","DG.ToolButtonData.gameMenu.title":"Game","DG.ToolButtonData.gameMenu.toolTip":"Choose the game to play (ctrl-alt-shift-g)","DG.ToolButtonData.tableButton.title":"Table","DG.ToolButtonData.tableButton.toolTip":"Open/close the case table (ctrl-alt-t)","DG.ToolButtonData.graphButton.title":"Graph","DG.ToolButtonData.graphButton.toolTip":"Make a graph (ctrl-alt-g)","DG.ToolButtonData.sliderButton.title":"Slider","DG.ToolButtonData.sliderButton.toolTip":"Make a slider (ctrl-alt-s)","DG.ToolButtonData.calcButton.title":"Calc","DG.ToolButtonData.calcButton.toolTip":"Open/close the calculator (ctrl-alt-c)","DG.ToolButtonData.textButton.title":"Text","DG.ToolButtonData.textButton.toolTip":"Make a text object (ctrl-alt-shift-t)","DG.ToolButtonData.mapButton.title":"Map","DG.ToolButtonData.mapButton.toolTip":"Make a map","DG.ToolButtonData.optionMenu.title":"Options","DG.ToolButtonData.optionMenu.toolTip":"Help, activities, learn about Data Games, ...","DG.ToolButtonData.guideMenu.title":"Guide","DG.ToolButtonData.guideMenu.toolTip":"Show the guide for this activity and navigate within it","DG.ToolButtonData.guideMenu.showGuide":"Show Guide","DG.DataContext.singleCaseName":"case","DG.DataContext.pluralCaseName":"cases","DG.DataContext.caseCountString":"%@1 %@2","DG.DataContext.setOfCasesLabel":"a collection","DG.CollectionClient.cantEditFormulaErrorMsg":'The formula for attribute "%@" is not editable.',"DG.CollectionClient.cantEditFormulaErrorDesc":"Create a new attribute to be able to specify a formula.","DG.Formula.SyntaxErrorMiddle":"Syntax error: '%@'","DG.Formula.SyntaxErrorEnd":"Incomplete expression","DG.Formula.VarReferenceError.message":"'%@': unknown variable","DG.Formula.VarReferenceError.description":"Variable '%@' is unrecognized","DG.Formula.FuncReferenceError.message":"'%@': unknown function","DG.Formula.FuncReferenceError.description":"Function '%@' is unrecognized","DG.Formula.FuncArgsErrorSingle.message":"'%@' expects 1 argument","DG.Formula.FuncArgsErrorSingle.description":"The '%@' function expects 1 argument","DG.Formula.FuncArgsErrorPlural.message":"'%@' expects %@ arguments","DG.Formula.FuncArgsErrorPlural.description":"The '%@' function expects %@ arguments","DG.Formula.FuncArgsErrorRange.message":"'%@' expects %@-%@ arguments","DG.Formula.FuncArgsErrorRange.description":"The '%@' function expects %@-%@ arguments","DG.TableController.headerMenuItems.editAttribute":"Edit Formula...","DG.TableController.headerMenuItems.renameAttribute":"Rename Attribute...","DG.TableController.headerMenuItems.deleteAttribute":"Delete Attribute...","DG.TableController.gearMenuItems.newAttribute":"New Attribute in %@...","DG.TableController.gearMenuItems.setScoreFormula":"Set Score Formula...","DG.TableController.gearMenuItems.deleteCases":"Delete Selected Cases","DG.TableController.newAttrDlg.defaultAttrName":"new_attr","DG.TableController.newAttrDlg.attrNameHint":"Enter a name for the new attribute","DG.TableController.newAttrDlg.formulaHint":"If desired, type a formula for computing values of this attribute","DG.TableController.newAttrDlg.applyTooltip":"Define the new attribute using the name and (optional) formula","DG.TableController.newAttrDlg.mustEnterAttrNameMsg":"Please enter a name for the new attribute","DG.TableController.renameAttributePrompt":"Enter a new name for the attribute:","DG.TableController.renameAttributeOKTip":"Accept the new attribute name","DG.TableController.renameAttributeInvalidMsg":"Attribute names may not be empty","DG.TableController.renameAttributeInvalidDesc":"Please enter a valid attribute name","DG.TableController.renameAttributeDuplicateMsg":"An attribute with that name already exists","DG.TableController.renameAttributeDuplicateDesc":"Please enter a unique attribute name","DG.TableController.deleteAttribute.confirmMessage":"Delete the attribute '%@'?","DG.TableController.deleteAttribute.confirmDescription":"This action cannot be undone.","DG.TableController.deleteAttribute.okButtonTitle":"Delete Attribute","DG.TableController.deleteAttribute.cancelButtonTitle":"Cancel","DG.TableController.scoreAttrName":"score","DG.TableController.setScoreDlg.applyTooltip":"Set the formula for the '%@' attribute","DG.TableController.setScoreDlg.formulaHint":"Type a formula for computing values of this attribute","DG.AttrFormView.attrNamePrompt":"Attribute Name:","DG.AttrFormView.formulaPrompt":"Formula:","DG.AttrFormView.operandMenuTitle":"--- Insert Value ---","DG.AttrFormView.functionMenuTitle":"--- Insert Function ---","DG.AttrFormView.applyBtnTitle":"Apply","DG.AttrFormView.cancelBtnTitle":"Cancel","DG.AttrFormView.cancelBtnTooltip":"Dismiss the dialog without making any changes","DG.GuideConfigView.titlePrompt":"Guide Title","DG.GuideConfigView.titleHint":"Activity Name","DG.GuideConfigView.itemTitleHint":"Section Name","DG.GuideConfigView.itemURLHint":"URL of section","DG.GuideConfigView.okBtnTitle":"OK","DG.GuideConfigView.okBtnToolTip":"Accept the Guide menu items","DG.GuideConfigView.cancelBtnTitle":"Cancel","DG.GuideConfigView.cancelBtnTooltip":"Dismiss the dialog without making any changes","DG.CellLinearAxisView.midPanelTooltip":"Drag to translate axis scale","DG.CellLinearAxisView.lowerPanelTooltip":"Drag to change axis lower bound","DG.CellLinearAxisView.upperPanelTooltip":"Drag to change axis upper bound","DG.PlotModel.mixup":"Mix Up the Plot","DG.PlotModel.showCount":"Show Count","DG.PlotModel.hideCount":"Hide Count","DG.DotPlotModel.rescaleToData":"Rescale to Data","DG.DotPlotModel.showMovableValue":"Show Movable Value","DG.DotPlotModel.hideMovableValue":"Hide Movable Value","DG.DotPlotModel.showMean":"Show Mean","DG.DotPlotModel.hideMean":"Hide Mean","DG.DotPlotModel.showMedian":"Show Median","DG.DotPlotModel.hideMedian":"Hide Median","DG.DotPlotModel.showStDev":"Show Standard Deviation","DG.DotPlotModel.hideStDev":"Hide Standard Deviation","DG.DotPlotModel.showIQR":"Show Inter-Quartile Range","DG.DotPlotModel.hideIQR":"Hide Inter-Quartile Range","DG.DotPlotModel.hidePlottedValue":"Hide Plotted Value","DG.DotPlotModel.plotValue":"Plot Value","DG.ScatterPlotModel.ShowConnectingLine":"Show Connecting Lines","DG.ScatterPlotModel.HideConnectingLine":"Hide Connecting Lines","DG.ScatterPlotModel.UnlockIntercept":"Unlock Intercept","DG.ScatterPlotModel.LockIntercept":"Lock Intercept at Zero","DG.LegendView.attributeTooltip":"Click to change legend attribute","DG.NumberToggleView.showAll":"Show All","DG.NumberToggleView.overallTooltip":"Click numbers to show one. Click label to show all.","DG.PlottedAverageAdornment.meanValueTitle":"mean=%@","DG.PlottedAverageAdornment.medianValueTitle":"median=%@","DG.PlottedAverageAdornment.stDevValueTitle":"\xB11 SD, %@","DG.PlottedAverageAdornment.iqrValueTitle":"IQR=%@","DG.PlottedCountAdornment.title":"%@ %@, %@%","DG.GraphMenu.attribute_x":"X: %@","DG.GraphMenu.attribute_y":"Y: %@","DG.GraphMenu.attribute_legend":"Legend: %@","DG.GraphMenu.remove":"Remove Attribute","DG.GraphMenu.removeAttribute_x":"Remove X: %@","DG.GraphMenu.removeAttribute_y":"Remove Y: %@","DG.GraphMenu.removeAttribute_legend":"Remove Legend: %@","DG.GraphMenu.treatAsCategorical":"Treat as Categorical","DG.GraphMenu.treatAsNumeric":"Treat as Numeric","DG.GraphMenu.hide":"Hide and Show","DG.GraphMenu.hideSelectedPlural":"Hide Selected Cases","DG.GraphMenu.hideUnselectedPlural":"Hide Unselected Cases","DG.GraphMenu.hideSelectedSing":"Hide Selected Case","DG.GraphMenu.hideUnselectedSing":"Hide Unselected Case","DG.GraphMenu.showAll":"Show All Cases","DG.GraphView.replaceAttribute":"Replace %@ with %@","DG.GraphView.addAttribute":"Add attribute %@","DG.GraphView.addToEmptyPlace":"Create axis with %@","DG.GraphView.dropInPlot":"Color points by values of %@","DG.GraphView.zoomTip":"Double-click to zoom in.\nShift-double-click to zoom out","DG.GraphView.rescale":"Rescale to data","DG.DataTip.connectingLine":"%@: %@\nwith %@ %@"});DG.ToolButtonData=[{name:"fileMenu",desc:{title:"DG.ToolButtonData.fileMenu.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/folder.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/folder_depressed.png",target:"DG.appController.fileMenuPane",action:"popup",toolTip:"DG.ToolButtonData.fileMenu.toolTip",localize:true}},{name:"gameMenu",desc:{title:"DG.ToolButtonData.gameMenu.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/dg_ball.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/dg_ball_depressed.png",target:"DG.gameSelectionController.menuPane",action:"popup",toolTip:"DG.ToolButtonData.gameMenu.toolTip",localize:true}},{name:"tableButton",desc:{title:"DG.ToolButtonData.tableButton.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/table.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/table_depressed.png",target:"DG.mainPage",action:"toggleCaseTable",toolTip:"DG.ToolButtonData.tableButton.toolTip",localize:true}},{name:"graphButton",desc:{title:"DG.ToolButtonData.graphButton.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/graph.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/graph_depressed.png",target:"DG.mainPage",action:"addGraph",toolTip:"DG.ToolButtonData.graphButton.toolTip",localize:true}},{name:"mapButton",desc:{title:"DG.ToolButtonData.mapButton.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/map.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/map_depressed.png",target:"DG.mainPage",action:"toggleMap",toolTip:"DG.ToolButtonData.mapButton.toolTip",localize:true}},{name:"sliderButton",desc:{title:"DG.ToolButtonData.sliderButton.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/slider.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/slider_depressed.png",target:"DG.mainPage",action:"addSlider",toolTip:"DG.ToolButtonData.sliderButton.toolTip",localize:true}},{name:"calcButton",desc:{title:"DG.ToolButtonData.calcButton.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/calc.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/calc_depressed.png",target:"DG.mainPage",action:"toggleCalculator",toolTip:"DG.ToolButtonData.calcButton.toolTip",localize:true}},{name:"textButton",desc:{title:"DG.ToolButtonData.textButton.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/texttool.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/texttool_depressed.png",target:"DG.mainPage",action:"addText",toolTip:"DG.ToolButtonData.textButton.toolTip",localize:true}},{name:"optionButton",desc:{title:"DG.ToolButtonData.optionMenu.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/options.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/options_depressed.png",target:"DG.appController.optionMenuPane",action:"popup",toolTip:"DG.ToolButtonData.optionMenu.toolTip",localize:true}},{name:"guideButton",desc:{title:"DG.ToolButtonData.guideMenu.title",iconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/guide.png",depressedIconName:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/guide_depressed.png",target:"DG.appController.guideMenuPane",action:"popup",toolTip:"DG.ToolButtonData.guideMenu.toolTip",localize:true,isVisible:false}}];DG.Theme=SC.AceTheme.create({name:"dg"});SC.Theme.addTheme(DG.Theme);SC.defaultTheme="dg";DG.AnimationMath={kAnimationBias:0.7,kAnimationGain:0.3,Bias:function(c,b){var d;if(!b){b=this.kAnimationBias}if(b<=0.000001){d=0}else{if(b>=0.999999){d=1}else{d=c/((1/b-2)*(1-c)+1)}}return d},Gain:function(c,b){var d;if(!b){b=this.kAnimationGain}if(b<=0.000001){d=0}else{if(b>=0.999999){d=1}else{d=(1/b-2)*(1-2*c);if(c<0.5){d=c/(d+1)}else{d=(d-c)/(d-1)}}}return d},DefaultAnimationTween:function(a){return this.Gain(this.Bias(a))}};DG.ArrayUtils={indexOfMatch:function(b,d){var c,a=b.length;for(c=0;c<a;++c){if(d(b[c])){return c}}return -1},firstMatch:function(b,f){var d,a=b.length;for(d=0;d<a;++d){var c=b[d];if(f(c)){return c}}return null},numericComparator:function(a,b){var c=isNaN(a),d=isNaN(b);if(c&&d){return 0}if(c){return -1}if(d){return 1}if(a<b){return -1}if(a>b){return 1}return 0},binarySearch:function(b,h,d){if(!b||!d){return -1}var a=0,g=b.length-1,c,f;while(a<=g){c=Math.floor((a+g)/2);f=d(b[c],h);if(f<0){a=c+1}else{if(f>0){g=c-1}else{return c}}}return -1},subtract:function(a,d,b){var c=[],f={};if(!d||d.length===0){return a}a.forEach(function(g){f[b(g)]=g});d.forEach(function(g){delete f[b(g)]});DG.ObjectMap.forEach(f,function(g){c.push(f[g])});return c}};DG.CASE_VALUE_ANIMATOR_DISABLE_ANIMATION=false;DG.CaseValueAnimator=SC.Object.extend({dataContext:null,attributeIDs:null,deltas:null,cases:null,startingValues:null,isAnimating:false,startTime:null,destroy:function(){this.endAnimation();arguments.callee.base.apply(this,arguments)},changeValues:function(b){var h=this,f=this.get("dataContext"),d=[],a=[];if(!f){return}function c(j,i,k){return j-k*i}this.attributeIDs.forEach(function(i){a.push(i)});this.cases.forEach(function(i){d.push(i)});var g={operation:"updateCases",attributeIDs:a,cases:d,values:[]};this.cases.forEach(function(j,i){var k=h.startingValues[i];h.attributeIDs.forEach(function(m,l){if(!g.values[l]){g.values[l]=[]}g.values[l].push(c(k[l],h.deltas[l],b))})});f.applyChange(g)},animate:function(){var f=this,c=50,b=DG.PlotUtilities.kDefaultAnimationTime;function d(){f.startingValues=[];if(SC.none(f.cases)){return}f.cases.forEach(function(g){var h=[];f.attributeIDs.forEach(function(i){h.push(g.getValue(i))});f.startingValues.push(h)})}function a(){var g=(new Date()).valueOf(),h=(g-f.startTime)/b,i;function j(k){if(k>=1){return 1}else{return DG.AnimationMath.DefaultAnimationTween(k)}}i=j(h);if(h<1){DG.assert(!f.animationTimer.get("isPaused"));f.changeValues(i)}else{f.endAnimation()}}if(this.isAnimating){this.endAnimation()}d();this.isAnimating=true;if(DG.CASE_VALUE_ANIMATOR_DISABLE_ANIMATION){this.endAnimation();return}this.startTime=(new Date()).valueOf();if(SC.none(this.animationTimer)){this.animationTimer=SC.Timer.schedule({action:a,interval:c,repeats:YES,until:false})}this.animationTimer.set("isPaused",NO)},endAnimation:function(){if(!SC.none(this.animationTimer)){this.animationTimer.set("isPaused",YES)}if(this.get("isAnimating")){this.changeValues(1);this.set("isAnimating",false)}}});DG.ColorUtilities={kStartingHue:(2/3),kCatHueSpread:0.8,kCatSaturation:(2/3),kCatBrightness:1,kBrightnessDampenFactor:1,kStandardMacGammaCorrection:(1/1.8),kStandardWinGammaCorrection:(1/2.5),kBrightnessTable:[0.54,0.05,0.2,0.15,0.75,0.46],kBrightnessTableMaxK:0.75,kNoAttribCaseColor:{colorString:"#A6CAF0"},kMissingValueCaseColor:{colorString:"#808080"},kDefaultBorderColor:{colorString:"black"}};DG.ColorUtilities.Color=function(){return{colorString:""}};DG.ColorUtilities.rgbColor=function(){return{colorString:"",r:1,g:1,b:1}};DG.ColorUtilities.hsbColor=function(){return{colorString:"",h:1,s:1,b:1}};DG.ColorUtilities.calcAttributeColorFromIndex=function(g,a){DG.assert(g>=0&&g<a);var b=g/a;b+=DG.ColorUtilities.kStartingHue;b-=Math.floor(b);var c=1;var d=DG.ColorUtilities.dampenBrightnessByHue(1,b,DG.ColorUtilities.kBrightnessDampenFactor);var f=DG.ColorUtilities.hsb_to_PlatformColor(b,c,d);return f};DG.ColorUtilities.calcAttributeColor=function(d){var a=d.get("collectionClient"),b=d.get("attribute"),c=b&&b.get("colormap"),f=DG.ColorUtilities.getAttributeColorFromColorMap(c);if(!f){DG.assert(b!==DG.Analysis.kNullAttribute);var h=b.get("name"),g=a.getAttributeIndexByName(h),i=a.getAttributeCount();f=DG.ColorUtilities.calcAttributeColorFromIndex(g,i)}return f};DG.ColorUtilities.calcCaseColor=function(h,c,f){var g=null,k=c.get("attribute");if(k===DG.Analysis.kNullAttribute){g=f||DG.ColorUtilities.kNoAttribCaseColor}else{if(SC.none(h)){g=DG.ColorUtilities.kMissingValueCaseColor}else{var a=c.get("isNumeric"),d=k.get("colormap");if(!a){g=DG.ColorUtilities.getCategoryColorFromColorMap(d,h)}if(g===null){var b=DG.ColorUtilities.calcAttributeColor(c),j=c.get("attributeStats"),i=a?DG.ColorUtilities.calcContinuousColor:DG.ColorUtilities.calcCategoryColor;g=i(j,b,h)}}}return g};DG.ColorUtilities.getCategoryColorFromColorMap=function(c,b){if(c){var a=c[b];if(typeof a==="string"){return{colorString:a}}}return null};DG.ColorUtilities.getAttributeColorFromColorMap=function(b){if(b){var a=b["attribute-color"];if(typeof a==="string"){return DG.ColorUtilities.rgbColorString_to_PlatformColor(a,true)}}return null};DG.ColorUtilities.calcContinuousColor=function(c,a,h){var i=DG.ColorUtilities.kMissingValueCaseColor,f=c.get("minMax"),j=f.max-f.min,d=a.h,k=a.s,b=a.b,g;if(DG.isFinite(j)&&DG.isFinite(h)){g=(j>0)?((h-f.min)/j):1;k*=g;b=DG.ColorUtilities.gammaCorrect(1-((1-b)*g));i=DG.ColorUtilities.hsb_to_PlatformColor(d,k,b)}return i};DG.ColorUtilities.calcCategoryColor=function(c,a,i){var j,d=a.h,k=a.s,b=a.b,g=d,f=c.cellNameToCellNumber(i),h=c.numberOfCells();if(f>=0&&f<h){if(h>1){d=f*DG.ColorUtilities.kCatHueSpread/h;d+=g;d-=Math.floor(d)}k=DG.ColorUtilities.kCatSaturation;b=DG.ColorUtilities.kCatBrightness;j=DG.ColorUtilities.hsb_to_PlatformColor(d,k,b)}else{j=DG.ColorUtilities.kMissingValueCaseColor}return j};DG.ColorUtilities.calcCaseColorFromData=function(a,c){var b,d;if(c){d=c.stats.isNumeric?DG.ColorUtilities.calcContinuousColorFromData:DG.ColorUtilities.calcCategoryColorFromData;b=d(c.stats,c.color,a)}else{b=DG.ColorUtilities.kNoAttribCaseColor}return b};DG.ColorUtilities.calcContinuousColorFromData=function(c,a,g){var h=DG.ColorUtilities.kMissingValueCaseColor;var i=c.max-c.min;var d=a.h,j=a.s,b=a.b,f;if(isFinite(i)&&isFinite(g)){f=(i>0)?((g-c.min)/i):1;j*=f;b=DG.ColorUtilities.gammaCorrect(1-((1-b)*f));h=DG.ColorUtilities.hsb_to_PlatformColor(d,j,b)}return h};DG.ColorUtilities.calcCategoryColorFromData=function(c,a,i){var g=c.categories.indexOf(i);var h=c.categories.length;var j;var d=a.h,k=a.s,b=a.b;var f=d;if(g>=0){if(h>1){d=g*DG.ColorUtilities.kCatHueSpread/h;d+=f;d-=Math.floor(d)}k=DG.ColorUtilities.kCatSaturation;b=DG.ColorUtilities.kCatBrightness;j=DG.ColorUtilities.hsb_to_PlatformColor(d,k,b)}else{j=DG.ColorUtilities.kMissingValueCaseColor}return j};DG.ColorUtilities.hsb_to_PlatformColor=function(a,b,c){return{h:a,s:b,b:c,colorString:DG.ColorUtilities.hsb_to_rgb(a,b,c)}};DG.ColorUtilities.rgb_to_PlatformColor=function(c,b,a){return("rgb("+(c*255).toFixed(4)+","+(b*255).toFixed(4)+","+(a*255).toFixed(4)+")")};DG.ColorUtilities.hsb_to_rgb=function(g,d,k){var c,h,b,a,l,j;if(d===0){j=DG.ColorUtilities.rgb_to_PlatformColor(k,k,k)}else{h=(g>=1)?0:(g*6);c=Math.floor(h);h=h-c;b=k*(1-d);a=k*(1-(d*h));l=k*(1-(d*(1-h)));switch(c){case 0:j=DG.ColorUtilities.rgb_to_PlatformColor(k,l,b);break;case 1:j=DG.ColorUtilities.rgb_to_PlatformColor(a,k,b);break;case 2:j=DG.ColorUtilities.rgb_to_PlatformColor(b,k,l);break;case 3:j=DG.ColorUtilities.rgb_to_PlatformColor(b,a,k);break;case 4:j=DG.ColorUtilities.rgb_to_PlatformColor(l,b,k);break;case 5:j=DG.ColorUtilities.rgb_to_PlatformColor(k,b,a);break}}return j};DG.ColorUtilities.gammaCorrect=function(a){return Math.pow(a,DG.ColorUtilities.kStandardMacGammaCorrection)};DG.ColorUtilities.dampenBrightnessByHue=function(g,h,m){var n=DG.ColorUtilities.kBrightnessTable,i=DG.ColorUtilities.kBrightnessTableMaxK,l=n.length,a=h*l,j=Math.floor(a),b=Math.ceil(a),k=(j<b)?b-a:1,f=a-j,d,c;j=j%l;b=b%l;d=n[j]*k+n[b]*f;c=1-((i-d)*m);return(g*c)};DG.ColorUtilities.darker=function(c,a){var b=pv.color(c).darker(a).color;return b};DG.ColorUtilities.rgbColorString_to_PlatformColor=function(f,d){var b,a=DG.ColorUtilities.colorNameToHexColor(f);if(b=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(a)){b=[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]}else{if(b=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(a)){b=[parseInt(b[1],16)*17,parseInt(b[2],16)*17,parseInt(b[3],16)*17]}else{if(b=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(a)){b=[+b[1],+b[2],+b[3],+b[4]]}else{if(b=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(a)){b=[+b[1],+b[2],+b[3]]}else{throw new Error(a+" is not supported by parseColor")}}}}var c={r:b[0]/255,g:b[1]/255,b:b[2]/255,colorString:f};if(d){var g=Raphael.rgb2hsb(c.r,c.g,c.b);c.h=g.h;c.s=g.s;c.b=g.b}return c};DG.ColorUtilities.colorNameToHexColor=function(a){if(a.charAt(0)==="#"){a=a.substr(1,6)}a=a.replace(/ /g,"");a=a.toLowerCase();if(DG.ColorUtilities.simpleColorNames.hasOwnProperty(a)){a=DG.ColorUtilities.simpleColorNames[a]}a="#"+a;return a};DG.ColorUtilities.simpleColorNames={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};DG.DataUtilities={};DG.DataUtilities.getMissingValue=function(){return null};DG.DataUtilities.isMissingValue=function(a){switch(typeof a){case"string":return a==="";case"number":return !isFinite(a);case"boolean":return false}return true};DG.DataUtilities.canonicalizeInputValue=function(b){var a=b;if(a==="undefined"){a=null}return a};DG.DataUtilities.isEqualIgnoreCase=function(g,f){var d=typeof g,c=typeof f,b,a;if(d===c&&d==="string"){b=g.toLowerCase();a=f.toLowerCase();return b===a}else{return g===f}};DG.EditorLock=SC.Object.extend({isActive:function(a){return window.Slick.GlobalEditorLock.isActive(a)},activate:function(a){try{window.Slick.GlobalEditorLock.activate(a)}catch(b){DG.logWarn(b.replace("SlickGrid","DG"))}},deactivate:function(a){try{window.Slick.GlobalEditorLock.deactivate(a)}catch(b){DG.logWarn(b.replace("SlickGrid","DG"))}},commitCurrentEdit:function(){return window.Slick.GlobalEditorLock.commitCurrentEdit()},cancelCurrentEdit:function(){return window.Slick.GlobalEditorLock.cancelCurrentEdit()}});DG.globalEditorLock=new DG.EditorLock();DG.MathUtilities={roundToSignificantDigits:function(i,c){var d=1,f=0,h,b,a,g,j;DG.assert(c>0);if(isNaN(i)){return{roundedValue:i,decPlaces:0}}if(i===0){return{roundedValue:0,decPlaces:0}}if(i<0){d=-1;i=-i}h=Math.pow(10,c-1);b=h*10;while(i>b){i/=10;f++}while(i<h){i*=10;f--}a=Math.floor(i);if(i-a>0.5){a++}a=a*Math.pow(10,f);g=d*a;if(f>0){f=0}j=-f;return{roundedValue:g,decPlaces:j}},clipToIntegerRange:function(c,b,a){DG.assert(c===Math.round(c));if(c<b){return b}else{if(c>=a){return a-1}}return c},isInIntegerRange:function(c,b,a){DG.assert(c===Math.round(c));return(b<=c&&c<a)},clipToRange:function(c,b,a){DG.assert(typeof c==="number"&&isFinite(c));if(c<b){return b}else{if(c>a){return a}}return c},isInRange:function(c,b,a){DG.assert(typeof c==="number"&&isFinite(c));return(b<=c&&c<=a)},distance:function(d,c){var b=d.x-c.x,a=d.y-c.y;return Math.sqrt(b*b+a*a)},medianOfNumericArray:function(c){function b(f,d){return f-d}function a(d){var f=(d.length-1)/2,h=Math.floor(f),g=Math.ceil(f);if(f<0){return undefined}else{if(f===h){return d[f]}else{return(d[h]+d[g])/2}}}c.sort(b);return a(c)},quantileOfSortedArray:function(a,g){var h=a.length-1,b=h*g,f=Math.floor(b),d=Math.ceil(b),c=b-f;if(b<0){return undefined}else{if(b>=h){return a[h]}else{if(b===f){return a[f]}else{return(a[f]*c+a[d]*(1-c))}}}},isFinite:function(a){return(!SC.empty(a))&&isFinite(a)}};DG.isFinite=DG.MathUtilities.isFinite;sc_require("libraries/raphael");DG.RaphaelLayer=SC.Object.extend({_prevLayer:null,_firstElement:null,_lastElement:null,_paper:null,clear:function(){this.forEach(function(a){a.remove()});this._firstElement=this._lastElement=null},push:function(b){DG.assert(b);if(!this._lastElement){var a;for(a=this._prevLayer;a;a=a._prevLayer){if(a&&a._lastElement){break}}if(a){b.insertAfter(a._lastElement)}else{b.toBack()}}else{b.insertAfter(this._lastElement)}this._lastElement=b;if(!this._firstElement){this._firstElement=b}DG.assert(b.next||(b===this._lastElement));DG.assert(this.isValid());return b},prepareToMoveOrRemove:function(a){if(a===this._firstElement){if(this._firstElement===this._lastElement){this._firstElement=this._lastElement=null}else{this._firstElement=a.next}}else{if(a===this._lastElement){this._lastElement=a.prev}}},forEach:function(c){var b,a;for(b=this._firstElement;b;b=a){a=(b===this._lastElement)?null:b.next;c(b)}},contains:function(b){var a;for(a=this._firstElement;a&&a.prev!==this._lastElement;a=a.next){if(a===b){return true}}return false},isValid:function(){return(!this._firstElement&&!this._lastElement)||((this._firstElement&&this._lastElement)&&(!this._firstElement.removed&&!this._lastElement.removed))}});sc_require("libraries/raphael");DG.RenderingUtilities={_blankCanvas:Raphael(0,0,0,0),kTransparent:"rgba(255, 255, 255, 0)",kSeeThrough:"rgba(255, 255, 255, 0.001)",kCaptionFontHeight:18,kDefaultFontHeight:12,getExtentForTextElement:function(f,c){var d=f.getBBox(),b=d.height||c,a=d.width;if(!a){a=(b/2)*f.attr("text").length}return{width:a,height:b}},textExtentOnCanvas:function(a,b){return{x:6*b.length,y:12}},textExtent:function(a){return this.textExtentOnCanvas(this._blankCanvas,a)},updateLine:function(b,a,c){b.attr({path:"M"+a.x+" "+a.y+" L"+c.x+" "+c.y})},pathForFrame:function(a){return"M"+a.x+" "+a.y+" L"+(a.x+a.width)+" "+a.y+" L"+(a.x+a.width)+" "+(a.y+a.height)+" L"+a.x+" "+(a.y+a.height)+" L"+a.x+" "+a.y},rotateText:function(b,a,f,d){if(Raphael.version<"2.0"){b.rotate(a,f,d)}else{var c="r%@,%@,%@".fmt(a,f,d);b.attr({transform:c})}}};DG.sounds=SC.Object.extend({sounds:{create:{path:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/sounds/create.wav"},drag:{path:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/sounds/drag.wav"},mixup:{path:"/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/resources/sounds/mixup.wav"}},init:function(){arguments.callee.base.apply(this,arguments)},initAudio:function(){var a,b;for(a in this.sounds){if(this.sounds.hasOwnProperty(a)){b=this.sounds[a];if(b&&b.path&&!b.audio){b.audio=new Audio(b.path)}}}},playSound:function(a){var b=this.sounds[a];if(true){return}if(b&&b.path&&!b.audio){b.audio=new Audio(b.path)}if(b.audio){if(window.chrome){b.audio.load()}else{b.audio.currentTime=0}b.audio.play()}},playMixup:function(){this.playSound("mixup")},playCreate:function(){this.playSound("create")},playDrag:function(){this.playSound("drag")}}).create();DG.ValueAnimator=SC.Object.extend({valueHolder:null,incrementProvider:null,isAnimating:false,animate:function(){var d=this,c=50,a=this.get("valueHolder");function b(){var f=d.getPath("incrementProvider.increment");a.set("value",a.get("value")+f)}if(this.get("isAnimating")){this.endAnimation()}this.set("isAnimating",true);if(SC.none(this.animationTimer)){this.animationTimer=SC.Timer.schedule({action:b,interval:c,repeats:YES,until:false})}this.animationTimer.set("isPaused",NO)},endAnimation:function(){if(!SC.none(this.animationTimer)){this.animationTimer.set("isPaused",YES)}if(this.get("isAnimating")){this.set("isAnimating",false)}}});DG.ViewUtilities={kTitleBarHeight:20,kDragWidth:8,kBorderWidth:4,horizontalPadding:function(){return 2*DG.ViewUtilities.kDragWidth},verticalPadding:function(){return DG.ViewUtilities.kDragWidth+DG.ViewUtilities.kTitleBarHeight+DG.ViewUtilities.kBorderWidth},windowToViewCoordinates:function(c,b){var a;do{a=b.get("frame");c.x-=a.x;c.y-=a.y;c.x+=b.get("horizontalScrollOffset")||0;c.y+=b.get("verticalScrollOffset")||0;b=b.parentView}while(!SC.none(b));return c},viewToWindowCoordinates:function(c,b){var a;do{a=b.get("frame");c.x+=a.x;c.y+=a.y;c.x-=b.get("horizontalScrollOffset")||0;c.y-=b.get("verticalScrollOffset")||0;b=b.parentView}while(!SC.none(b));return c},convertViewLayoutToAbsolute:function(b){var a=b.get("layout");if(SC.none(a.left)||SC.none(a.top)||SC.none(a.width)||SC.none(a.height)){var c=b.get("layer");if(!SC.none(c)){b.set("layout",{left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight})}}},findEmptyLocationForRect:function(g,b,i){var h=5,a={x:h,y:h},d=false,j=i.map(function(k){return k.get("isVisible")?k.get("frame"):{x:0,y:0,width:0,height:0}});function f(l,k){var m=(!isNaN(l.x)&&!isNaN(l.y))&&!(k.x>l.x+l.width||k.x+k.width<l.x||k.y>l.y+l.height||k.y+k.height<l.y);return m}function c(k){return !j.every(function(l){return !f(l,{x:k.x,y:k.y,width:g.width,height:g.height})})}while(!d){a.x=h;while(!d){if(c(a)){a.x+=h;if(a.x+g.width>b.x+b.width){break}}else{d=true}}if(!d){a.y+=h}}return a},normalFormForRect:function(a){return{left:Math.min(a.left,a.right),top:Math.max(a.bottom,a.top),right:Math.max(a.left,a.right),bottom:Math.min(a.bottom,a.top)}},ptInRect:function(a,b){return(a.x>=b.x)&&(a.x<=b.x+b.width)&&(a.y>=b.y)&&(a.y<=b.y+b.height)}};DG.AlertPane={processArgs:function(a){if(a.localize){if(!SC.empty(a.message)){a.message=SC.String.loc(a.message)}if(!SC.empty(a.description)){a.description=SC.String.loc(a.description)}if(!SC.empty(a.caption)){a.caption=SC.String.loc(a.caption)}a.localize=false}return a},show:function(a){SC.AlertPane.show(DG.AlertPane.processArgs(a))},warn:function(a){SC.AlertPane.warn(DG.AlertPane.processArgs(a))},info:function(a){SC.AlertPane.info(DG.AlertPane.processArgs(a))},error:function(a){SC.AlertPane.error(DG.AlertPane.processArgs(a))},plain:function(a){SC.AlertPane.plain(DG.AlertPane.processArgs(a))}};sc_require("views/text_field_view");DG.FormulaTextEditView=DG.TextFieldView.extend({autoCorrect:false,autoCapitalize:false,names:[],_disableNextSelectRoot:false,_selectRootElement:function(){if(!this._disableNextSelectRoot){arguments.callee.base.apply(this,arguments)}this._disableNextSelectRoot=false},keyDown:function(b){var d=DG.UNICODE.MINUS_SIGN,c=this.get("value"),a=this.get("selection");if(b.getCharString()==="-"){if(!SC.none(c)){c=c.slice(0,a.get("start"))+d+c.slice(a.get("end"))}else{c=d}this.set("value",c);this.setSelection(a.start+1);return true}else{if((b.which===SC.Event.KEY_TAB)&&(a.start!==c.length)&&(a.end===c.length)){this.setSelection(c.length);return true}}return arguments.callee.base.apply(this,arguments)},keyUp:function(h){var j=this.get("selection"),f=this.get("value"),a=this.get("names"),l=/\b[a-zA-Z_][\w]*$/,g=typeof f==="string"&&!SC.empty(f)?f.match(l):null;if(!j){return NO}function b(m){return !(m<32||(m>=33&&m<=46)||(m>=112&&m<=123)||(m>=91&&m<=93))}function i(m){var p=m,n,o;for(n=0;n<a.length;n++){o=a[n];if(o.indexOf(m)===0){p=o;break}}return p}if((j.start>0)&&(j.end===f.length)&&b(h.keyCode)&&(a.length>0)&&!SC.none(g)){var k=g[0],c=i(k),d=f.replace(l,c);if(c!==k){this.set("value",d);this.setSelection(f.length,d.length)}}return arguments.callee.base.apply(this,arguments)},performValidateKeyDown:function(a){return(a.getCharString()!=="-")&&arguments.callee.base.apply(this,arguments)},formulaExpression:function(a,c){if(c===undefined){var b=this.get("value");return !SC.empty(b)?b.replace(/\u2212/g,"-"):b}else{this.set("value",!SC.empty(c)?c.replace(/-/g,DG.UNICODE.MINUS_SIGN):"")}}.property("value")});sc_require("formula/formula_context");sc_require("views/formula_text_edit_view");DG.AttributeFormulaView=SC.PalettePane.extend({isModal:YES,layout:{width:400,height:180,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"attrName equalsLabel formula operandPopup functionPopup apply cancel".w(),attrName:SC.TextFieldView.design({layout:{top:5,left:5,right:25,height:24},value:"",spellCheckEnabled:false,leftAccessoryView:SC.LabelView.create({layout:{left:1,width:95,height:22,centerY:0},value:"DG.AttrFormView.attrNamePrompt",backgroundColor:"lightgray",localize:true})}),equalsLabel:SC.LabelView.extend({layout:{top:5,right:5,width:12,height:24},value:"="}),formula:DG.FormulaTextEditView.design({layout:{top:34,left:5,right:5,height:72},value:"",isTextArea:true,spellCheckEnabled:false,hint:"",leftAccessoryView:SC.LabelView.create({layout:{left:1,width:55,height:70,top:1},value:"DG.AttrFormView.formulaPrompt",backgroundColor:"lightgray",localize:true})}),operandPopup:SC.PopupButtonView.extend({layout:{top:112,left:5,width:140,height:24},localize:true,title:"DG.AttrFormView.operandMenuTitle",menu:SC.MenuPane.extend({layout:{width:200},rawItems:function(b,a){var c=0;if(a!==undefined){var d=a.map(function(f){if(c<f.length){c=f.length}return{title:f,isSeparator:f==="--"}});this.set("items",d)}this.adjust("width",40+10*c)}.property()})}),functionPopup:SC.PopupButtonView.extend({layout:{top:112,left:150,width:140,height:24},localize:true,title:"DG.AttrFormView.functionMenuTitle",menu:SC.MenuPane.extend({layout:{width:100},items:null})}),apply:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,title:"DG.AttrFormView.applyBtnTitle",target:null,action:null,toolTip:"",localize:true,isDefault:true}),cancel:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,title:"DG.AttrFormView.cancelBtnTitle",target:null,action:null,toolTip:"DG.AttrFormView.cancelBtnTooltip",localize:true,isCancel:true})}),attributeName:function(a,b){return b===undefined?this.getPath("contentView.attrName.value"):this.setPath("contentView.attrName.value",b)}.property(),formula:function(a,b){return b===undefined?this.getPath("contentView.formula.formulaExpression"):this.setPath("contentView.formula.formulaExpression",b)}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancel.target",this);this.setPath("contentView.cancel.action","close");this.setPath("contentView.functionPopup.menu.items",DG.FormulaContext.getFunctionNamesWithParentheses())},userSelectedOperand:function(){var a=this.getPath("contentView.operandPopup.menu.selectedItem.title");if(!SC.empty(a)){var b=this.getPath("contentView.formula");if(b){b.replaceSelectionWithString(a)}}this.setPath("contentView.operandPopup.menu.selectedItem",null)}.observes(".contentView.operandPopup.menu.selectedItem"),userSelectedFunction:function(){var b=this.getPath("contentView.functionPopup.menu.selectedItem.title");if(!SC.empty(b)){var c=this.getPath("contentView.formula");if(c){var f=c.getPath("selection.start"),d=b.length,a=f+d-1;c.replaceSelectionWithString(b);c.setSelection(a)}}this.setPath("contentView.functionPopup.menu.selectedItem",null)}.observes(".contentView.functionPopup.menu.selectedItem"),close:function(){this.remove();this.destroy()}});DG.CreateAttributeFormulaView=function(f){var h=DG.AttributeFormulaView.create(f),g={attrNamePrompt:"attrName.leftAccessoryView.value",attrNameValue:"attrName.value",attrNameHint:"attrName.hint",attrNameIsEnabled:"attrName.isEnabled",formulaPrompt:"formula.leftAccessoryView.value",formulaValue:"formula.value",formulaExpression:"formula.formulaExpression",formulaNames:"formula.names",formulaHint:"formula.hint",formulaIsEnabled:"formula.isEnabled",formulaOperands:"operandPopup.menu.rawItems",applyTitle:"apply.title",applyTarget:"apply.target",applyAction:"apply.action",applyTooltip:"apply.toolTip",cancelTitle:"cancel.title",cancelTooltip:"cancel.toolTip"},d=h.get("contentView"),c=d.attrName,a=d.formula;DG.ObjectMap.forEach(f,function(i,j){var k=g[i];if(!SC.empty(k)){d.setPath(k,j)}});h.append();var b=c.get("isEnabled")?c:a;b.becomeFirstResponder();return h};DG.TitleBarButtonView=SC.ImageView.extend((function(){var a="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/closeicon.png",b="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/closeicon_cross.png",c="/static/dg/en/895ff1bb4cf056c5b27efed79e3c433ef86cb0ea/source/resources/images/closeicon_cross_dark.png";SC.imageQueue.loadImage(b);SC.imageQueue.loadImage(c);return{value:function(){if(this.get("isMouseOver")){if(this.get("isActive")){return c}else{return b}}else{if(this.get("isMouseDown")){return b}else{return a}}}.property("isMouseDown","isActive","isMouseOver").cacheable(),preloadIcons:function(){},isMouseDown:NO,isMouseOver:NO,isActive:NO,mouseMoved:function(d){this.mouseOver(d);return YES},mouseOver:function(d){if(this.get("isMouseDown")){this.set("isActive",YES)}this.set("isMouseOver",YES);return YES},mouseExited:function(d){this.set("isActive",NO);this.set("isMouseOver",NO);return YES},mouseDown:function(d){if(!this.get("isMouseDown")){this.set("isMouseDown",YES);this.set("isActive",YES)}return YES},mouseUp:function(d){if(this.get("isActive")){this.set("isActive",NO);this.set("isMouseOver",NO);this.set("isMouseDown",NO);this.closeIt()}else{this.set("isMouseDown",NO);this.mouseExited(d)}return YES},touchStart:function(d){return YES},touchEnd:function(d){this.closeIt()},closeIt:function(){var f=this.parentView.viewToDrag(),d=f.parentView;d.removeComponentView(f)}}}()));DG.TitleBarGearView=SC.ImageView.extend((function(){return{contentView:null,value:"sc-icon-options-16",menu:null,init:function(){arguments.callee.base.apply(this,arguments);this.menu=SC.MenuPane.create({layout:{width:200,height:150}})},controller:function(){return !SC.none(this.contentView)?this.contentView.get("controller"):null}.property("contentView","contentView.controller"),controllerItems:function(){var a=this.get("controller");return !SC.none(a)?a.get("gearMenuItems"):[]}.property("controller","controller.gearMenuItems"),updateVisibility:function(){var a=this.get("controllerItems"),b=a?a.length:0;this.set("isVisible",b>0)}.observes("controllerItems"),getDesiredMenuWidth:function(b){var c=0,a=5,d=60;b.forEach(function(f){if(f&&f.title){c=Math.max(c,f.title.length)}});return c*a+d},mouseDown:function(a){var b=this.get("controllerItems");this.menu.layout.width=this.getDesiredMenuWidth(b);this.menu.set("items",b);this.menu.popup(this);return YES},mouseUp:function(a){return YES},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},selectedItemDidChange:function(){var b=this.menu.get("selectedItem"),a=b.get("args")||[];b.get("itemAction").apply(b.get("target"),a)}.observes(".menu.selectedItem")}}()));sc_require("views/titlebar_button_view");sc_require("views/titlebar_gear_view");DG.DragBorderView=SC.View.extend((function(){return{dragCursor:null,cursor:function(){if(this.parentView.get("isResizable")){return this.dragCursor}else{return null}}.property("dragCursor").cacheable(),mouseDown:function(b){DG.globalEditorLock.commitCurrentEdit();var a=this.viewToDrag();DG.ViewUtilities.convertViewLayoutToAbsolute(a);a.bringToFront();if(!this.canBeDragged()){return NO}a.get("parentView").coverUpComponentViews("cover");var c=this.viewToDrag().get("layout");this._mouseDownInfo={pageX:b.pageX,pageY:b.pageY,left:c.left,top:c.top,height:c.height,width:c.width};return YES},mouseUp:function(a){var b=this.viewToDrag().get("parentView");this.mouseDragged(a);this._mouseDownInfo=null;b.coverUpComponentViews("uncover");b.set("frameNeedsUpdate",true);return YES},mouseDragged:function(a){var b=this._mouseDownInfo;if(b){this.dragAdjust(a,b);return YES}else{return NO}},canBeDragged:function(){return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},touchesDragged:function(a,b){return this.mouseDragged(a)},dragAdjust:function(a,b){},viewToDrag:function(){return DG.ComponentView.findComponentViewParent(this)},getContainerWidth:function(){return window.innerWidth},getContainerHeight:function(){var a=this.viewToDrag();while(!SC.none(a.parentView.parentView)){a=a.parentView}return window.innerHeight-a.get("frame").y}}}()));DG.ComponentView=SC.View.extend((function(){var i=DG.ViewUtilities.kTitleBarHeight,h=50,f=DG.ViewUtilities.kDragWidth,g=DG.ViewUtilities.kBorderWidth,a=SC.Cursor.create({cursorStyle:SC.E_RESIZE_CURSOR}),d=SC.Cursor.create({cursorStyle:SC.S_RESIZE_CURSOR}),c=SC.Cursor.create({cursorStyle:SC.W_RESIZE_CURSOR}),b=SC.Cursor.create({cursorStyle:SC.SE_RESIZE_CURSOR});return{classNames:["component-view"],isResizable:YES,isClosable:YES,contentView:SC.outlet("containerView.contentView"),childViews:"containerView borderRight borderBottom borderLeft borderTop borderCorner".w(),containerView:SC.View.design({layout:{left:f/2,bottom:f/2,right:f/2},gearView:SC.outlet("titlebar.gearView"),childViews:"titlebar coverSheet".w(),titlebar:DG.DragBorderView.design({layout:{height:i},backgroundColor:"gray",childViews:"titleView versionView closeBox gearView".w(),titleView:SC.LabelView.design({textAlign:SC.ALIGN_CENTER,value:""}),versionView:SC.LabelView.design({textAlign:SC.ALIGN_RIGHT,layout:{right:15},value:""}),closeBox:DG.TitleBarButtonView.design({layout:{left:0,top:0,width:i,height:i},scale:SC.SCALE_NONE}),gearView:DG.TitleBarGearView.design({layout:{right:5,centerY:0,width:16,height:16}}),dragAdjust:function(l,o){var n=this.viewToDrag(),j=o.left+(l.pageX-o.pageX),p=o.top+(l.pageY-o.pageY),k=this.getContainerWidth(),m=this.getContainerHeight();j=Math.min(Math.max(j,-o.width+h),k-h);n.adjust("left",j);p=Math.min(Math.max(p,-i/2),m-i/2);n.adjust("top",p)},canBeDragged:function(){return YES}}),coverSheet:SC.View.design({backgroundColor:DG.RenderingUtilities.kSeeThrough,isVisible:false}),classNames:["component-border"],setContentView:function(j){this.set("contentView",j);this.get("gearView").set("contentView",j)}}),borderRight:DG.DragBorderView.design({layout:{right:0,width:f},dragCursor:a,dragAdjust:function(j,l){var m=Math.max(j.pageX,h),k=l.width+(m-l.pageX);k=Math.max(k,h);this.parentView.adjust("width",k)},canBeDragged:function(){return this.parentView.get("isResizable")}}),borderBottom:DG.DragBorderView.design({layout:{bottom:0,height:f},dragCursor:d,dragAdjust:function(j,l){var k=l.height+(j.pageY-l.pageY);k=Math.max(k,h);this.parentView.adjust("height",k)},canBeDragged:function(){return this.parentView.get("isResizable")}}),borderLeft:DG.DragBorderView.design({layout:{left:0,width:f},dragCursor:c,dragAdjust:function(k,m){var j=this.getContainerWidth(),l=m.width-(k.pageX-m.pageX),n;l=Math.max(l,h);n=m.left+m.width-l;if(n<j-h){this.parentView.adjust("width",l);this.parentView.adjust("left",n)}},canBeDragged:function(){return this.parentView.get("isResizable")}}),borderTop:DG.DragBorderView.design({layout:{top:0,height:0},dragAdjust:function(j,k){},canBeDragged:function(){return false}}),borderCorner:DG.DragBorderView.design({layout:{right:0,width:3*f,bottom:0,height:3*f},dragCursor:b,dragAdjust:function(j,m){var n=Math.max(j.pageX,h),k=m.width+(n-m.pageX),l=m.height+(j.pageY-m.pageY);k=Math.max(k,h);this.parentView.adjust("width",k);l=Math.max(l,h);this.parentView.adjust("height",l)},canBeDragged:function(){return this.parentView.get("isResizable")}}),title:null,titleBinding:".containerView.titlebar.titleView.value",version:null,versionBinding:".containerView.titlebar.versionView.value",destroy:function(){DG.logUser("closeComponent: %@",this.get("title"));if(this.containerView.contentView){this.containerView.contentView.destroy()}arguments.callee.base.apply(this,arguments)},closeAction:function(){return this.getPath("contentView.closeAction")}.property(),addContent:function(k){var j=k.get("frame");if(j.width>0){this.adjust("width",j.width+2*g)}if(j.height>0){this.adjust("height",j.height+2*g+i)}k.set("layout",{top:i});this.containerView.appendChild(k);this.containerView.setContentView(k)},bringToFront:function(){this.parentView.bringToFront(this)},contentIsInstanceOf:function(j){return this.get("contentView") instanceof j},cover:function(j){var k=this.get("containerView"),l=k.get("coverSheet");k.removeChild(l);k.appendChild(l);l.set("isVisible",j==="cover")}}}()));DG.ComponentView._createComponent=function(f,d,h,a,c,g){var b=DG.ComponentView.create({layout:f});b.addContent(d.create(h));b.invokeLast(function(){if(!SC.empty(a)){b.set("title",a)}DG.logUser("componentCreated: %@",a)});if(!SC.none(c)){b.set("isResizable",c)}if(!SC.none(g)){b.set("isVisible",g)}return b};DG.ComponentView.restoreComponent=function(f,g,d,i,a,c,h){var b=this._createComponent(g,d,i,a,c,h);f.appendChild(b);f.set("frameNeedsUpdate",true);return b};DG.ComponentView.addComponent=function(a,b,c,f,h,d,i,j){i=i||false;if(!SC.none(b.width)){b.width+=DG.ViewUtilities.horizontalPadding()}if(!SC.none(b.height)){b.height+=DG.ViewUtilities.verticalPadding()}var g=this._createComponent(b,c,f,h,d,j);if(!i){a.positionNewComponent(g)}a.appendChild(g);a.set("frameNeedsUpdate",true);g.scrollToVisible();return g};DG.ComponentView.findComponentViewParent=function(a){while(a&&!(a instanceof DG.ComponentView)){a=a.get("parentView")}return a};DG.ContainerView=SC.View.extend((function(){var a=16;return{isResizable:YES,frameNeedsUpdate:true,isFixedLayout:function(){return false}.property(),componentViews:function(){return this.get("childViews").filter(function(b){return b instanceof DG.ComponentView})}.property("childViews"),frame:function(){var d=0,b=0,c=this.parentView.get("frame");this.get("componentViews").forEach(function(g){var f=g.get("layout");d=Math.max(d,(f.left||0)+(f.width||0));b=Math.max(b,(f.top||0)+(f.height||0))});d+=a;b+=a;this.frameNeedsUpdate=false;if(b>c.height){this.adjust("bottom",null);this.adjust("height",b)}else{this.adjust("height",null);this.adjust("bottom",0)}if(d>c.width){this.adjust("right",null);this.adjust("width",d)}else{this.adjust("width",null);this.adjust("right",0)}return{x:0,y:0,width:d,height:b}}.property("frameNeedsUpdate").cacheable(),removeComponentView:function(c){var b=c.get("closeAction");if(b){b.action.apply(b.target,b.args)}else{DG.currDocumentController().removeComponentAssociatedWithView(c);c.destroy()}},destroyAllChildren:function(){var c=this.get("childViews"),b;c.forEach(function(d){if(d&&d.willDestroy){d.willDestroy()}});while(!SC.none(b=c.objectAt(c.get("length")-1))){b.destroy()}return this},bringToFront:function(c){var b=c.layoutDidChange;c.layoutDidChange=null;this.removeChild(c);this.appendChild(c);c.layoutDidChange=b},sendToBack:function(d){var b=this.get("childViews"),c=d.layoutDidChange;if(b.length===1){return}d.layoutDidChange=null;this.removeChild(d);this.insertBefore(d,b[0]);d.layoutDidChange=c},positionNewComponent:function(b){var f=b.get("frame"),d=this.parentView.get("clippingFrame");var c=DG.ViewUtilities.findEmptyLocationForRect(f,d,this.get("componentViews"));b.adjust("left",c.x);b.adjust("top",c.y)},coverUpComponentViews:function(b){this.get("componentViews").forEach(function(c){c.cover(b)})}}}()));DG.ExportCaseDataDialog=SC.PalettePane.extend({isModal:true,layout:{width:400,height:120,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"promptView collectionPopup editView okButton".w(),promptView:SC.LabelView.extend({layerId:"export_case_data_prompt",layout:{top:10,left:10,right:210,height:24},localize:true,value:""}),collectionPopup:SC.PopupButtonView.extend({layout:{top:10,left:200,right:10,height:24},title:"",menu:SC.MenuPane.extend({layout:{width:250},items:null})}),editView:SC.TextFieldView.design({layout:{top:40,left:10,right:10,height:44},value:"",isTextArea:true,spellCheckEnabled:false}),okButton:SC.ButtonView.design({layout:{bottom:5,right:10,height:24,width:90},titleMinWidth:0,localize:true,title:"",target:null,action:null,isDefault:true})}),value:function(){return this.getPath("contentView.editView.value")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.okButton.target",this);this.setPath("contentView.okButton.action","close")},collectionSelected:function(){var b=this.getPath("contentView.collectionPopup.menu.selectedItem.title"),d=this.getPath("contentView.collectionPopup.itemAction");if(!SC.empty(b)){var c=d(b),a=c.length,f=this.getPath("contentView.editView");this.setPath("contentView.collectionPopup.title",b);if(f){f.set("value",c);f.set("selection",SC.TextSelection.create({start:0,end:a}))}}}.observes(".contentView.collectionPopup.menu.selectedItem"),close:function(){this.remove();this.destroy()}});DG.CreateExportCaseDataDialog=function(b){var f=DG.ExportCaseDataDialog.create(b),d={prompt:"promptView.value",textValue:"editView.value",textHint:"editView.hint",textLimit:"editView.maxLength",textIsMultiLine:"editView.isTextArea",okTitle:"okButton.title",okTooltip:"okButton.toolTip",collectionMenuTitle:"collectionPopup.title",collectionMenuItems:"collectionPopup.menu.items",collectionMenuItemAction:"collectionPopup.itemAction"},a=f.get("contentView"),c=a.editView;DG.ObjectMap.forEach(b,function(g,h){var i=d[g];if(!SC.empty(i)){a.setPath(i,h)}});f.append();c.becomeFirstResponder();return f};DG.FormulaObject=SC.View.extend((function(){var a="formula_object";return{destroy:function(){this.notifyPropertyChange("willDestroy");arguments.callee.base.apply(this,arguments)},descriptionView:null,formula:function(){var b=$('textarea[name|="'+this.get("outputSymbol")+'"]'),c=b&&b.val();return c}.property(),locals:function(){var b={},c=0;$("input").each(function(g,d){var f=d.value;c++;if(!SC.empty(f)){b[f]=$('[name="formula'+c+'"]').val()}});return b}.property(),formulas:function(){var c=this.get("locals"),d=this.get("outputSymbol"),b={};b[d]=this.get("formula");b.locals=c;return b}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.set("layout",{top:0,left:0,width:420,height:588});this.set("descriptionView",SC.StaticContentView.create({layerId:a,selectStart:function(){return true}}));this.appendChild(this.descriptionView);this.buildHTML();this.invokeLast(this.postProcessing)},buildHTML:function(){var c=this.get("nameSpaceSymbols"),j=this.get("outputSymbol"),d=this.get("variableDescriptions"),i='<table id="variables"><tr><th>Variable</th><th>Description</th></tr>',b=DG.gameSelectionController.getPath("currentGame.formulas"),h=(b&&b[j])?b[j]:"",f=(b&&b.locals)?b.locals:{},g=1;c.forEach(function(l,k){i+="<tr><td>"+l+"</td><td>"+d[k]+"</td></tr>"});i+="<tr><td>"+j+'</td><td><textarea autocapitalize="off" rows="2" cols="50" name="'+j+'" placeholder="Type your formula here">'+h+"</textarea></td></tr>";DG.ObjectMap.forEach(f,function(k,l){i+='<tr><td><input autocapitalize="off" type="text" name="local'+g+'" size="10" placeholder="Your variable" value ="'+k+'"/></td><td><textarea name="formula'+g+'" rows="2" cols="50" placeholder="Type your formula here">'+l+"</textarea></td></tr>";g++});if(this.get("allow_user_variables")){i+='<tr><td><input autocapitalize="off" type="text" name="local'+g+'" size="10" placeholder="Your variable"/></td><td><textarea name="formula'+g+'" rows="2" cols="50" placeholder="Type your formula here"></textarea></td></tr>'}i+="</table>";this.descriptionView.set("content",this.get("description")+i)},postProcessing:function(){var f=this;function d(){var g=f.getPath("parentView.parentView"),h=$("#"+a).height();g.adjust("height",h+DG.ViewUtilities.kTitleBarHeight+20)}function c(){var k=0,g=0,j=$("input");j.each(function(l){g++;if($(this).val()===""){k++}});if(k===0){g++;var i=!SC.browser.isIE,h=i?"Type your formula here":"";$("table").append('<tr><td><input autocapitalize="off" type="text" name="local'+g+'" size="10" placeholder="Your variable"/></td><td><textarea autocapitalize="off" name="formula'+g+'"rows="2" cols="50" placeholder="'+h+'"></textarea></td></tr>');f.invokeLast(f.postProcessing)}}var b=$("input");b.change(c);d()},updateContents:function(c,b,g,d,f){this.set("description",c);this.set("outputSymbol",b);this.set("nameSpaceSymbols",g);this.set("variableDescriptions",d);this.set("allow_user_variables",f);this.buildHTML();this.invokeLast(this.postProcessing)}}}()));DG.ImageView=SC.ImageView.extend({altText:null,localize:false,displayAltText:function(){var a=this.get("altText")||this.get("toolTip")||"";return !SC.empty(a)&&this.get("localize")?a.loc():a}.property("altText","toolTip","localize"),render:function(c){arguments.callee.base.apply(this,arguments);var a=this.get("displayAltText");if(!SC.empty(a)){c.attr("alt",a)}var b=this.get("displayToolTip");if(!SC.empty(b)){c.attr("title",b)}}});sc_require("views/image_view");DG.IconButton=SC.View.extend((function(){return{iconName:null,depressedIconName:null,title:null,iconExtent:{width:32,height:32},childViews:"iconView labelView".w(),iconView:DG.ImageView.design({classNames:"icon-button",textAlign:SC.ALIGN_CENTER,altTextBinding:".parentView.title",localizeBinding:".parentView.localize",value:function(){if(this.getPath("parentView.isMouseOver")&&this.getPath("parentView.isMouseDown")){return this.getPath("parentView.depressedIconName")}else{return this.getPath("parentView.iconName")}}.property("parentView.isMouseDown","parentView.isMouseOver","parentView.iconName","parentView.depressedIconName").cacheable()}),labelView:SC.LabelView.design({classNames:["icon-label"],layout:{bottom:0,height:15},textAlign:SC.ALIGN_CENTER,valueBinding:".parentView.title",localizeBinding:".parentView.localize"}),init:function(){arguments.callee.base.apply(this,arguments);this.iconView.set("layout",{top:0,centerX:0,height:this.iconExtent.width,width:this.iconExtent.height});this.labelView.set("isVisible",!SC.empty(this.get("title")));SC.imageQueue.loadImage(this.depressedIconName)},isEnabled:true,isMouseDown:NO,isMouseOver:NO,mouseMoved:function(a){this.mouseOver(a);return YES},mouseOver:function(a){this.set("isMouseOver",YES);return YES},mouseExited:function(a){this.set("isMouseOver",NO);return YES},mouseDown:function(a){if(this.get("isEnabled")){this.set("isMouseDown",YES);return YES}return NO},_lastMouseUpTime:0,mouseUp:function(b){var c=b.timeStamp;var a=this.$().within(b.target);if(a&&c-this._lastMouseUpTime>=500){this._action(b);this._lastMouseUpTime=b.timeStamp}this.set("isMouseDown",NO);return YES},_action:function(a){var c=this.get("action");var d=this.get("target")||null;var f=this.get("pane");var b=f?f.get("rootResponder"):null;if(b){b.sendAction(c,d,this,f)}},touchStart:function(a){this.beginPropertyChanges();this.set("isMouseOver",YES);this.set("isMouseDown",YES);this.endPropertyChanges();return YES},touchEnd:function(a){this._action(a);this.beginPropertyChanges();this.set("isMouseOver",NO);this.set("isMouseDown",NO);this.endPropertyChanges()},render:function(b){arguments.callee.base.apply(this,arguments);var a=this.get("displayToolTip");if(a){b.attr("title",a)}}}}()));DG.OpenSaveDialog=SC.PalettePane.extend({isModal:true,dialogType:null,layout:{width:400,height:120,centerX:0,centerY:0},contentView:SC.View.extend({dialogType:null,childViews:["promptView","documentListView","documentNameView","documentPermissionsView","okButton","cancelButton"],promptView:SC.LabelView.extend({layout:{top:10,left:5,right:5,height:24},localize:true,value:"DG.OpenSaveDialog.promptView.value"}),documentListView:SC.SelectFieldView.design({layout:{top:40,left:5,right:5,height:24},nameKey:"name",valueKey:"id",disableSort:true}),documentNameView:SC.TextFieldView.design({layout:{top:40,left:5,right:5,height:24},value:"",spellCheckEnabled:false,leftAccessoryView:SC.LabelView.create({layout:{left:1,width:105,height:22,centerY:0},localize:true,value:"DG.OpenSaveDialog.documentNameView.prompt",backgroundColor:"lightgray"})}),documentPermissionsView:SC.CheckboxView.design({value:0,toggleOnValue:1,toggleOffValue:0,localize:true,title:"DG.OpenSaveDialog.documentPermissions.title",toolTip:"DG.OpenSaveDialog.documentPermissions.toolTip",layout:{bottom:10,left:15,width:100,height:17}}),okButton:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.OpenSaveDialog.okButton.title",target:null,action:null,toolTip:"DG.OpenSaveDialog.okButton.toolTip",isDefault:true}),cancelButton:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.OpenSaveDialog.cancelButton.title",target:null,action:null,toolTip:"DG.OpenSaveDialog.cancelButton.toolTip",isCancel:true})}),documentName:function(){switch(this.get("dialogType")){case DG.OpenSaveDialog.kOpenDialog:var a=this.getPath("contentView.documentListView.objects"),f,d=a&&a.get("length"),b=this.getPath("contentView.documentListView.fieldValue");for(f=0;f<d;++f){var c=a.objectAt(f);if(c.id===b){return c.name}}return null;case DG.OpenSaveDialog.kSaveDialog:return this.getPath("contentView.documentNameView.value");default:}return""}.property(),documentID:function(){switch(this.get("dialogType")){case DG.OpenSaveDialog.kOpenDialog:return this.getPath("contentView.documentListView.fieldValue");default:}return null}.property(),documentPermissions:function(){return this.getPath("contentView.documentPermissionsView.value")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancelButton.target",this);this.setPath("contentView.cancelButton.action","close")},close:function(){this.remove();this.destroy()}});DG.OpenSaveDialog.kOpenDialog=1;DG.OpenSaveDialog.kSaveDialog=2;DG.CreateOpenSaveDialog=function(g){var i=DG.OpenSaveDialog.create(g),h={dialogType:"dialogType",prompt:"promptView.value",documentList:"documentListView.objects",documentNamePrompt:"documentNameView.leftAccessoryView.value",documentNameValue:"documentNameView.value",documentNameHint:"documentNameView.hint",documentNameIsEnabled:"documentNameView.isEnabled",documentPermissionValue:"documentPermissionsView.value",okTitle:"okButton.title",okTarget:"okButton.target",okAction:"okButton.action",okTooltip:"okButton.toolTip",cancelTitle:"cancelButton.title",cancelTooltip:"cancelButton.toolTip"},c=i.get("contentView"),b=c.get("documentListView"),f=c.get("documentNameView"),a=c.get("documentPermissionsView"),d=DG.supports("docSavePermissions")&&(i.get("dialogType")===DG.OpenSaveDialog.kSaveDialog);DG.ObjectMap.forEach(g,function(j,k){var l=h[j];if(!SC.empty(l)){c.setPath(l,k)}});b.set("isVisible",i.get("dialogType")===DG.OpenSaveDialog.kOpenDialog);f.set("isVisible",i.get("dialogType")===DG.OpenSaveDialog.kSaveDialog);a.set("isVisible",d);i.append();switch(i.get("dialogType")){case DG.OpenSaveDialog.kOpenDialog:b.becomeFirstResponder();break;case DG.OpenSaveDialog.kSaveDialog:f.becomeFirstResponder();break;default:}return i};DG.ScrollView=SC.ScrollView.extend({horizontalScrollerView:SC.ScrollerView.extend({buttonOverlap:0}),horizontalScrollerLayout:function(){var a=this.get("isVerticalScrollerVisible")?0:this.getPath("horizontalScrollerView.scrollbarThickness");return{left:0,bottom:0,right:a}}.property(),verticalScrollerView:SC.ScrollerView.extend({buttonOverlap:0}),verticalScrollerLayout:function(){var a=this.get("isHorizontalScrollerVisible")?0:this.getPath("verticalScrollerView.scrollbarThickness");return{left:0,bottom:a,right:0}}.property(),scrollToBottom:function(){this.scrollTo(null,this.get("maximumVerticalScrollOffset"))}});DG.SingleTextDialog=SC.PalettePane.extend({isModal:true,layout:{width:400,height:120,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"promptView editView okButton cancelButton".w(),promptView:SC.LabelView.extend({layout:{top:10,left:5,right:5,height:24},localize:true,value:""}),editView:SC.TextFieldView.design({layout:{top:40,left:5,right:5,height:24},value:"",isTextArea:false,spellCheckEnabled:false}),okButton:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.SingleTextDialog.okButton.title",target:null,action:null,isDefault:true}),cancelButton:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.SingleTextDialog.cancelButton.title",target:null,action:null,toolTip:"DG.SingleTextDialog.cancelButton.toolTip",isVisible:true,isCancel:true})}),value:function(){return this.getPath("contentView.editView.value")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancelButton.target",this);this.setPath("contentView.cancelButton.action","close")},close:function(){this.remove();this.destroy()}});DG.CreateSingleTextDialog=function(b){var f=DG.SingleTextDialog.create(b),d={prompt:"promptView.value",textValue:"editView.value",textHint:"editView.hint",textLimit:"editView.maxLength",textIsMultiLine:"editView.isTextArea",okTarget:"okButton.target",okAction:"okButton.action",okTooltip:"okButton.toolTip",cancelTitle:"cancelButton.title",cancelVisible:"cancelButton.isVisible",cancelTooltip:"cancelButton.toolTip"},a=f.get("contentView"),c=a.editView;DG.ObjectMap.forEach(b,function(g,h){var i=d[g];if(!SC.empty(i)){a.setPath(i,h)}});f.append();c.becomeFirstResponder();return f};DG.mainPage=SC.Page.design((function(){var a=44;return DG.Browser.isCompatibleBrowser()?{mainPane:SC.MainPane.design({childViews:"topView scrollView".w(),topView:SC.ToolbarView.design({classNames:"toolshelf-background".w(),layout:{top:0,height:a},childViews:"resetButton logoutButton versionLabel statusLabel".w(),anchorLocation:SC.ANCHOR_TOP,resetButton:SC.ButtonView.design({layout:{centerY:0,height:24,left:0,width:100},localize:true,title:"DG.AppController.resetData.title",target:"DG.appController",action:"deleteAllCaseData",toolTip:"DG.AppController.resetData.toolTip"}),logoutButton:SC.ButtonView.design({layout:{centerY:0,height:24,left:0,width:80},localize:true,title:"DG.mainPage.mainPane.logoutButton.title",target:"DG.appController",action:"logout",toolTip:"DG.mainPage.mainPane.logoutButton.toolTip"}),versionLabel:SC.LabelView.design({layout:{top:0,height:24,left:0,width:150},controlSize:SC.REGULAR_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,textAlign:SC.ALIGN_RIGHT,value:DG.getVariantString("DG.mainPage.mainPane.versionString").loc(DG.VERSION,DG.BUILD_NUM)}),statusLabel:SC.LabelView.design({layout:{bottom:5,left:0,width:150,height:18},textAlign:SC.ALIGN_RIGHT,valueBinding:"DG.authorizationController.currLogin.user"}),init:function(){arguments.callee.base.apply(this,arguments);function f(j,i){var g=j.get("layout"),h=i+g.width;g.left=i;j.set("layout",g);return h}var c=10,b=40,d=c;DG.ToolButtonData.forEach(function(g){this[g.name]=DG.IconButton.create(g.desc);this[g.name].set("layout",{left:d,width:b});this.appendChild(this[g.name]);d+=b+c}.bind(this));DG.currDocumentController().set("guideButton",this.guideButton);d+=c;d=c+f(this.resetButton,d);d=c+f(this.logoutButton,d);f(this.versionLabel,d);d=f(this.statusLabel,d)}}),scrollView:SC.ScrollView.design({layout:{top:a},classNames:"doc-background".w(),alwaysBounceVertical:false,contentView:DG.ContainerView.design({})}),flagsChanged:function(b){},init:function(){arguments.callee.base.apply(this,arguments);if(DG.componentMode==="yes"){var b=this.get("scrollView");this.setPath("topView.isVisible",false);b.adjust("top",0);b.set("hasHorizontalScroller",false);b.set("hasVerticalScroller",false)}},nextValidKeyView:function(){return this}.property(),performKeyEquivalent:function(c,b){var d=YES;switch(c){case"ctrl_o":if(DG.authorizationController.getPath("currLogin.isSaveEnabled")){DG.appController.openDocument()}break;case"ctrl_s":if(DG.authorizationController.getPath("currLogin.isSaveEnabled")){DG.appController.saveDocument()}break;case"alt_ctrl_shift_g":DG.gameSelectionController.menuPane.popup();break;case"alt_ctrl_c":DG.mainPage.toggleCalculator();break;case"alt_ctrl_t":DG.mainPage.toggleCaseTable();break;case"alt_ctrl_g":DG.mainPage.addGraph();break;case"alt_ctrl_s":DG.mainPage.addSlider();break;case"alt_ctrl_shift_t":DG.mainPage.addText();break;default:d=arguments.callee.base.apply(this,arguments)}return d},createComponentAndView:function(c,g){var d=g.type,f=d&&d.indexOf("."),i=f>=0?d.slice(f+1):null,h=i&&DG[i],b=h&&DG.mainPage.getComponentsOfType(h);if(!b||!b.length){DG.currDocumentController().createComponentAndView(null,g.type)}},addGame:function(){if(!DG.currDocumentController().get("gameView")){DG.currDocumentController().addGame(this.scrollView.contentView)}}}),docView:SC.outlet("mainPane.scrollView.contentView"),updateLayout:function(){var c=this.get("mainPane");if(!c){return}var f=DG.currDocumentController().get("gameView");if(f){var g=DG.gameSelectionController.get("requestedDimensions");if(!g){var h=DG.gameSelectionController.get("currentDimensions"),d=h.width+DG.ViewUtilities.horizontalPadding(),b=h.height+DG.ViewUtilities.verticalPadding();f.adjust("width",d);f.adjust("height",b)}}else{if(DG.gameSelectionController.getPath("menuPane.selectedItem")){this.addGameIfNotPresent()}}}.observes("DG.gameSelectionController.currentDimensions")}:{mainPane:SC.MainPane.design({childViews:"messageView".w(),messageView:SC.LabelView.design({layout:{centerX:0,centerY:0,width:400,height:300},controlSize:SC.LARGE_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,textAlign:SC.ALIGN_LEFT,localize:true,value:"DG.mainPage.mainPane.messageView.value"})})}}()));DG.mainPage.toggleCalculator=function(){DG.currDocumentController().toggleComponent(this.get("docView"),"calcView")};DG.mainPage.toggleCaseTable=function(){DG.currDocumentController().toggleComponent(this.get("docView"),"caseTableView")};DG.mainPage.toggleMap=function(){DG.currDocumentController().toggleComponent(this.get("docView"),"mapView")};DG.mainPage.addSlider=function(){return DG.currDocumentController().addSlider(this.get("docView"))};DG.mainPage.addGraph=function(){if(!DG.currGameController.get("gameIsReady")){DG.log("DocumentController:addGraph called before gameIsReady.");return}return DG.currDocumentController().addGraph(this.get("docView"))};DG.mainPage.addText=function(){return DG.currDocumentController().addText(this.get("docView"))};DG.mainPage.addMap=function(){return DG.currDocumentController().addMap(this.get("docView"))};DG.mainPage.getComponentsOfType=function(b){var c=this.get("docView"),a=c&&c.get("childViews"),d=a&&a.filter(function(f){return f.contentIsInstanceOf(b)});return d?d.getEach("contentView"):[]};DG.mainPage.closeAllComponents=function(){this.get("docView").destroyAllChildren()};DG.mainPage.addGameIfNotPresent=function(){if(DG.mainPage.mainPane.addGame&&(DG.mainPage.getComponentsOfType(DG.GameView).length===0)){DG.mainPage.mainPane.addGame()}DG.currDocumentController().updateSavedChangeCount()};DG.main=function main(){DG.Browser.init();SC.$("body").addClass("dg");DG.getPath("mainPage.mainPane").append();if(DG.componentMode!=="yes"){DG.authorizationController.requireLogin()}else{DG.currGameController.set("gameIsReady",false);DG.mainPage.addGameIfNotPresent();if(!SC.empty(DG.startingDocName)){var a=!SC.empty(DG.startingDocOwner)?DG.startingDocOwner:DG.iUser;DG.appController.openDocumentNamed(DG.startingDocName,a);DG.startingDocName=""}}};function main(){DG.main()};