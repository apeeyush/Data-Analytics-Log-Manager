/*!
 * jQuery JavaScript Library v1.6.2
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Thu Jun 30 14:16:56 2011 -0400
 */
(function(ba,K){var ar=ba.document,bs=ba.navigator,bj=ba.location;var b=(function(){var bD=function(bY,bZ){return new bD.fn.init(bY,bZ,bB)},bT=ba.jQuery,bF=ba.$,bB,bX=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,bL=/\S/,bH=/^\s+/,bC=/\s+$/,bG=/\d/,by=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,bM=/^[\],:{}\s]*$/,bV=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,bO=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,bI=/(?:^|:|,)(?:\s*\[)+/g,bw=/(webkit)[ \/]([\w.]+)/,bQ=/(opera)(?:.*version)?[ \/]([\w.]+)/,bP=/(msie) ([\w.]+)/,bR=/(mozilla)(?:.*? rv:([\w.]+))?/,bz=/-([a-z])/ig,bS=function(bY,bZ){return bZ.toUpperCase()},bW=bs.userAgent,bU,bA,e,bK=Object.prototype.toString,bE=Object.prototype.hasOwnProperty,bx=Array.prototype.push,bJ=Array.prototype.slice,bN=String.prototype.trim,bt=Array.prototype.indexOf,bv={};bD.fn=bD.prototype={constructor:bD,init:function(bY,b2,b1){var b0,b3,bZ,b4;if(!bY){return this}if(bY.nodeType){this.context=this[0]=bY;this.length=1;return this}if(bY==="body"&&!b2&&ar.body){this.context=ar;this[0]=ar.body;this.selector=bY;this.length=1;return this}if(typeof bY==="string"){if(bY.charAt(0)==="<"&&bY.charAt(bY.length-1)===">"&&bY.length>=3){b0=[null,bY,null]}else{b0=bX.exec(bY)}if(b0&&(b0[1]||!b2)){if(b0[1]){b2=b2 instanceof bD?b2[0]:b2;b4=(b2?b2.ownerDocument||b2:ar);bZ=by.exec(bY);if(bZ){if(bD.isPlainObject(b2)){bY=[ar.createElement(bZ[1])];bD.fn.attr.call(bY,b2,true)}else{bY=[b4.createElement(bZ[1])]}}else{bZ=bD.buildFragment([b0[1]],[b4]);bY=(bZ.cacheable?bD.clone(bZ.fragment):bZ.fragment).childNodes}return bD.merge(this,bY)}else{b3=ar.getElementById(b0[2]);if(b3&&b3.parentNode){if(b3.id!==b0[2]){return b1.find(bY)}this.length=1;this[0]=b3}this.context=ar;this.selector=bY;return this}}else{if(!b2||b2.jquery){return(b2||b1).find(bY)}else{return this.constructor(b2).find(bY)}}}else{if(bD.isFunction(bY)){return b1.ready(bY)}}if(bY.selector!==K){this.selector=bY.selector;this.context=bY.context}return bD.makeArray(bY,this)},selector:"",jquery:"1.6.2",length:0,size:function(){return this.length},toArray:function(){return bJ.call(this,0)},get:function(bY){return bY==null?this.toArray():(bY<0?this[this.length+bY]:this[bY])},pushStack:function(bZ,b1,bY){var b0=this.constructor();if(bD.isArray(bZ)){bx.apply(b0,bZ)}else{bD.merge(b0,bZ)}b0.prevObject=this;b0.context=this.context;if(b1==="find"){b0.selector=this.selector+(this.selector?" ":"")+bY}else{if(b1){b0.selector=this.selector+"."+b1+"("+bY+")"}}return b0},each:function(bZ,bY){return bD.each(this,bZ,bY)},ready:function(bY){bD.bindReady();bA.done(bY);return this},eq:function(bY){return bY===-1?this.slice(bY):this.slice(bY,+bY+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(bJ.apply(this,arguments),"slice",bJ.call(arguments).join(","))},map:function(bY){return this.pushStack(bD.map(this,function(b0,bZ){return bY.call(b0,bZ,b0)}))},end:function(){return this.prevObject||this.constructor(null)},push:bx,sort:[].sort,splice:[].splice};bD.fn.init.prototype=bD.fn;bD.extend=bD.fn.extend=function(){var b7,b0,bY,bZ,b4,b5,b3=arguments[0]||{},b2=1,b1=arguments.length,b6=false;if(typeof b3==="boolean"){b6=b3;b3=arguments[1]||{};b2=2}if(typeof b3!=="object"&&!bD.isFunction(b3)){b3={}}if(b1===b2){b3=this;--b2}for(;b2<b1;b2++){if((b7=arguments[b2])!=null){for(b0 in b7){bY=b3[b0];bZ=b7[b0];if(b3===bZ){continue}if(b6&&bZ&&(bD.isPlainObject(bZ)||(b4=bD.isArray(bZ)))){if(b4){b4=false;b5=bY&&bD.isArray(bY)?bY:[]}else{b5=bY&&bD.isPlainObject(bY)?bY:{}}b3[b0]=bD.extend(b6,b5,bZ)}else{if(bZ!==K){b3[b0]=bZ}}}}}return b3};bD.extend({noConflict:function(bY){if(ba.$===bD){ba.$=bF}if(bY&&ba.jQuery===bD){ba.jQuery=bT}return bD},isReady:false,readyWait:1,holdReady:function(bY){if(bY){bD.readyWait++}else{bD.ready(true)}},ready:function(bY){if((bY===true&&!--bD.readyWait)||(bY!==true&&!bD.isReady)){if(!ar.body){return setTimeout(bD.ready,1)}bD.isReady=true;if(bY!==true&&--bD.readyWait>0){return}bA.resolveWith(ar,[bD]);if(bD.fn.trigger){bD(ar).trigger("ready").unbind("ready")}}},bindReady:function(){if(bA){return}bA=bD._Deferred();if(ar.readyState==="complete"){return setTimeout(bD.ready,1)}if(ar.addEventListener){ar.addEventListener("DOMContentLoaded",e,false);ba.addEventListener("load",bD.ready,false)}else{if(ar.attachEvent){ar.attachEvent("onreadystatechange",e);ba.attachEvent("onload",bD.ready);var bY=false;try{bY=ba.frameElement==null}catch(bZ){}if(ar.documentElement.doScroll&&bY){bu()}}}},isFunction:function(bY){return bD.type(bY)==="function"},isArray:Array.isArray||function(bY){return bD.type(bY)==="array"},isWindow:function(bY){return bY&&typeof bY==="object"&&"setInterval" in bY},isNaN:function(bY){return bY==null||!bG.test(bY)||isNaN(bY)},type:function(bY){return bY==null?String(bY):bv[bK.call(bY)]||"object"},isPlainObject:function(bZ){if(!bZ||bD.type(bZ)!=="object"||bZ.nodeType||bD.isWindow(bZ)){return false}if(bZ.constructor&&!bE.call(bZ,"constructor")&&!bE.call(bZ.constructor.prototype,"isPrototypeOf")){return false}var bY;for(bY in bZ){}return bY===K||bE.call(bZ,bY)},isEmptyObject:function(bZ){for(var bY in bZ){return false}return true},error:function(bY){throw bY},parseJSON:function(bY){if(typeof bY!=="string"||!bY){return null}bY=bD.trim(bY);if(ba.JSON&&ba.JSON.parse){return ba.JSON.parse(bY)}if(bM.test(bY.replace(bV,"@").replace(bO,"]").replace(bI,""))){return(new Function("return "+bY))()}bD.error("Invalid JSON: "+bY)},parseXML:function(b0,bY,bZ){if(ba.DOMParser){bZ=new DOMParser();bY=bZ.parseFromString(b0,"text/xml")}else{bY=new ActiveXObject("Microsoft.XMLDOM");bY.async="false";bY.loadXML(b0)}bZ=bY.documentElement;if(!bZ||!bZ.nodeName||bZ.nodeName==="parsererror"){bD.error("Invalid XML: "+b0)}return bY},noop:function(){},globalEval:function(bY){if(bY&&bL.test(bY)){(ba.execScript||function(bZ){ba["eval"].call(ba,bZ)})(bY)}},camelCase:function(bY){return bY.replace(bz,bS)},nodeName:function(bZ,bY){return bZ.nodeName&&bZ.nodeName.toUpperCase()===bY.toUpperCase()},each:function(b1,b4,b0){var bZ,b2=0,b3=b1.length,bY=b3===K||bD.isFunction(b1);if(b0){if(bY){for(bZ in b1){if(b4.apply(b1[bZ],b0)===false){break}}}else{for(;b2<b3;){if(b4.apply(b1[b2++],b0)===false){break}}}}else{if(bY){for(bZ in b1){if(b4.call(b1[bZ],bZ,b1[bZ])===false){break}}}else{for(;b2<b3;){if(b4.call(b1[b2],b2,b1[b2++])===false){break}}}}return b1},trim:bN?function(bY){return bY==null?"":bN.call(bY)}:function(bY){return bY==null?"":bY.toString().replace(bH,"").replace(bC,"")},makeArray:function(b1,bZ){var bY=bZ||[];if(b1!=null){var b0=bD.type(b1);if(b1.length==null||b0==="string"||b0==="function"||b0==="regexp"||bD.isWindow(b1)){bx.call(bY,b1)}else{bD.merge(bY,b1)}}return bY},inArray:function(b0,b1){if(bt){return bt.call(b1,b0)}for(var bY=0,bZ=b1.length;bY<bZ;bY++){if(b1[bY]===b0){return bY}}return -1},merge:function(b2,b0){var b1=b2.length,bZ=0;if(typeof b0.length==="number"){for(var bY=b0.length;bZ<bY;bZ++){b2[b1++]=b0[bZ]}}else{while(b0[bZ]!==K){b2[b1++]=b0[bZ++]}}b2.length=b1;return b2},grep:function(bZ,b4,bY){var b0=[],b3;bY=!!bY;for(var b1=0,b2=bZ.length;b1<b2;b1++){b3=!!b4(bZ[b1],b1);if(bY!==b3){b0.push(bZ[b1])}}return b0},map:function(bY,b5,b6){var b3,b4,b2=[],b0=0,bZ=bY.length,b1=bY instanceof bD||bZ!==K&&typeof bZ==="number"&&((bZ>0&&bY[0]&&bY[bZ-1])||bZ===0||bD.isArray(bY));if(b1){for(;b0<bZ;b0++){b3=b5(bY[b0],b0,b6);if(b3!=null){b2[b2.length]=b3}}}else{for(b4 in bY){b3=b5(bY[b4],b4,b6);if(b3!=null){b2[b2.length]=b3}}}return b2.concat.apply([],b2)},guid:1,proxy:function(b2,b1){if(typeof b1==="string"){var b0=b2[b1];b1=b2;b2=b0}if(!bD.isFunction(b2)){return K}var bY=bJ.call(arguments,2),bZ=function(){return b2.apply(b1,bY.concat(bJ.call(arguments)))};bZ.guid=b2.guid=b2.guid||bZ.guid||bD.guid++;return bZ},access:function(bY,b6,b4,b0,b3,b5){var bZ=bY.length;if(typeof b6==="object"){for(var b1 in b6){bD.access(bY,b1,b6[b1],b0,b3,b4)}return bY}if(b4!==K){b0=!b5&&b0&&bD.isFunction(b4);for(var b2=0;b2<bZ;b2++){b3(bY[b2],b6,b0?b4.call(bY[b2],b2,b3(bY[b2],b6)):b4,b5)}return bY}return bZ?b3(bY[0],b6):K},now:function(){return(new Date()).getTime()},uaMatch:function(bZ){bZ=bZ.toLowerCase();var bY=bw.exec(bZ)||bQ.exec(bZ)||bP.exec(bZ)||bZ.indexOf("compatible")<0&&bR.exec(bZ)||[];return{browser:bY[1]||"",version:bY[2]||"0"}},sub:function(){function bY(b1,b2){return new bY.fn.init(b1,b2)}bD.extend(true,bY,this);bY.superclass=this;bY.fn=bY.prototype=this();bY.fn.constructor=bY;bY.sub=this.sub;bY.fn.init=function b0(b1,b2){if(b2&&b2 instanceof bD&&!(b2 instanceof bY)){b2=bY(b2)}return bD.fn.init.call(this,b1,b2,bZ)};bY.fn.init.prototype=bY.fn;var bZ=bY(ar);return bY},browser:{}});bD.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(bZ,bY){bv["[object "+bY+"]"]=bY.toLowerCase()});bU=bD.uaMatch(bW);if(bU.browser){bD.browser[bU.browser]=true;bD.browser.version=bU.version}if(bD.browser.webkit){bD.browser.safari=true}if(bL.test("\xA0")){bH=/^[\s\xA0]+/;bC=/[\s\xA0]+$/}bB=bD(ar);if(ar.addEventListener){e=function(){ar.removeEventListener("DOMContentLoaded",e,false);bD.ready()}}else{if(ar.attachEvent){e=function(){if(ar.readyState==="complete"){ar.detachEvent("onreadystatechange",e);bD.ready()}}}}function bu(){if(bD.isReady){return}try{ar.documentElement.doScroll("left")}catch(bY){setTimeout(bu,1);return}bD.ready()}return bD})();var a="done fail isResolved isRejected promise then always pipe".split(" "),aG=[].slice;b.extend({_Deferred:function(){var bv=[],bw,bt,bu,e={done:function(){if(!bu){var by=arguments,bz,bC,bB,bA,bx;if(bw){bx=bw;bw=0}for(bz=0,bC=by.length;bz<bC;bz++){bB=by[bz];bA=b.type(bB);if(bA==="array"){e.done.apply(e,bB)}else{if(bA==="function"){bv.push(bB)}}}if(bx){e.resolveWith(bx[0],bx[1])}}return this},resolveWith:function(by,bx){if(!bu&&!bw&&!bt){bx=bx||[];bt=1;try{while(bv[0]){bv.shift().apply(by,bx)}}finally{bw=[by,bx];bt=0}}return this},resolve:function(){e.resolveWith(this,arguments);return this},isResolved:function(){return !!(bt||bw)},cancel:function(){bu=1;bv=[];return this}};return e},Deferred:function(bt){var e=b._Deferred(),bv=b._Deferred(),bu;b.extend(e,{then:function(bx,bw){e.done(bx).fail(bw);return this},always:function(){return e.done.apply(e,arguments).fail.apply(this,arguments)},fail:bv.done,rejectWith:bv.resolveWith,reject:bv.resolve,isRejected:bv.isResolved,pipe:function(bx,bw){return b.Deferred(function(by){b.each({done:[bx,"resolve"],fail:[bw,"reject"]},function(bA,bD){var bz=bD[0],bC=bD[1],bB;if(b.isFunction(bz)){e[bA](function(){bB=bz.apply(this,arguments);if(bB&&b.isFunction(bB.promise)){bB.promise().then(by.resolve,by.reject)}else{by[bC](bB)}})}else{e[bA](by[bC])}})}).promise()},promise:function(bx){if(bx==null){if(bu){return bu}bu=bx={}}var bw=a.length;while(bw--){bx[a[bw]]=e[a[bw]]}return bx}});e.done(bv.cancel).fail(e.cancel);delete e.cancel;if(bt){bt.call(e,e)}return e},when:function(by){var bt=arguments,bu=0,bx=bt.length,bw=bx,e=bx<=1&&by&&b.isFunction(by.promise)?by:b.Deferred();function bv(bz){return function(bA){bt[bz]=arguments.length>1?aG.call(arguments,0):bA;if(!(--bw)){e.resolveWith(e,aG.call(bt,0))}}}if(bx>1){for(;bu<bx;bu++){if(bt[bu]&&b.isFunction(bt[bu].promise)){bt[bu].promise().then(bv(bu),e.reject)}else{--bw}}if(!bw){e.resolveWith(e,bt)}}else{if(e!==by){e.resolveWith(e,bx?[by]:[])}}return e.promise()}});b.support=(function(){var bD=ar.createElement("div"),bK=ar.documentElement,bw,bL,bE,bu,bC,bx,bA,bt,bB,bF,bz,bJ,bH,bv,by,bG,bM;bD.setAttribute("className","t");bD.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";bw=bD.getElementsByTagName("*");bL=bD.getElementsByTagName("a")[0];if(!bw||!bw.length||!bL){return{}}bE=ar.createElement("select");bu=bE.appendChild(ar.createElement("option"));bC=bD.getElementsByTagName("input")[0];bA={leadingWhitespace:(bD.firstChild.nodeType===3),tbody:!bD.getElementsByTagName("tbody").length,htmlSerialize:!!bD.getElementsByTagName("link").length,style:/top/.test(bL.getAttribute("style")),hrefNormalized:(bL.getAttribute("href")==="/a"),opacity:/^0.55$/.test(bL.style.opacity),cssFloat:!!bL.style.cssFloat,checkOn:(bC.value==="on"),optSelected:bu.selected,getSetAttribute:bD.className!=="t",submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};bC.checked=true;bA.noCloneChecked=bC.cloneNode(true).checked;bE.disabled=true;bA.optDisabled=!bu.disabled;try{delete bD.test}catch(bI){bA.deleteExpando=false}if(!bD.addEventListener&&bD.attachEvent&&bD.fireEvent){bD.attachEvent("onclick",function(){bA.noCloneEvent=false});bD.cloneNode(true).fireEvent("onclick")}bC=ar.createElement("input");bC.value="t";bC.setAttribute("type","radio");bA.radioValue=bC.value==="t";bC.setAttribute("checked","checked");bD.appendChild(bC);bt=ar.createDocumentFragment();bt.appendChild(bD.firstChild);bA.checkClone=bt.cloneNode(true).cloneNode(true).lastChild.checked;bD.innerHTML="";bD.style.width=bD.style.paddingLeft="1px";bB=ar.getElementsByTagName("body")[0];bz=ar.createElement(bB?"div":"body");bJ={visibility:"hidden",width:0,height:0,border:0,margin:0};if(bB){b.extend(bJ,{position:"absolute",left:-1000,top:-1000})}for(bG in bJ){bz.style[bG]=bJ[bG]}bz.appendChild(bD);bF=bB||bK;bF.insertBefore(bz,bF.firstChild);bA.appendChecked=bC.checked;bA.boxModel=bD.offsetWidth===2;if("zoom" in bD.style){bD.style.display="inline";bD.style.zoom=1;bA.inlineBlockNeedsLayout=(bD.offsetWidth===2);bD.style.display="";bD.innerHTML="<div style='width:4px;'></div>";bA.shrinkWrapBlocks=(bD.offsetWidth!==2)}bD.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";bH=bD.getElementsByTagName("td");bM=(bH[0].offsetHeight===0);bH[0].style.display="";bH[1].style.display="none";bA.reliableHiddenOffsets=bM&&(bH[0].offsetHeight===0);bD.innerHTML="";if(ar.defaultView&&ar.defaultView.getComputedStyle){bx=ar.createElement("div");bx.style.width="0";bx.style.marginRight="0";bD.appendChild(bx);bA.reliableMarginRight=(parseInt((ar.defaultView.getComputedStyle(bx,null)||{marginRight:0}).marginRight,10)||0)===0}bz.innerHTML="";bF.removeChild(bz);if(bD.attachEvent){for(bG in {submit:1,change:1,focusin:1}){by="on"+bG;bM=(by in bD);if(!bM){bD.setAttribute(by,"return;");bM=(typeof bD[by]==="function")}bA[bG+"Bubbles"]=bM}}bz=bt=bE=bu=bB=bx=bD=bC=null;return bA})();b.boxModel=b.support.boxModel;var aN=/^(?:\{.*\}|\[.*\])$/,ax=/([a-z])([A-Z])/g;b.extend({cache:{},uuid:0,expando:"jQuery"+(b.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(e){e=e.nodeType?b.cache[e[b.expando]]:e[b.expando];return !!e&&!U(e)},data:function(bv,bt,bx,bw){if(!b.acceptData(bv)){return}var bA=b.expando,bz=typeof bt==="string",by,bB=bv.nodeType,e=bB?b.cache:bv,bu=bB?bv[b.expando]:bv[b.expando]&&b.expando;if((!bu||(bw&&bu&&!e[bu][bA]))&&bz&&bx===K){return}if(!bu){if(bB){bv[b.expando]=bu=++b.uuid}else{bu=b.expando}}if(!e[bu]){e[bu]={};if(!bB){e[bu].toJSON=b.noop}}if(typeof bt==="object"||typeof bt==="function"){if(bw){e[bu][bA]=b.extend(e[bu][bA],bt)}else{e[bu]=b.extend(e[bu],bt)}}by=e[bu];if(bw){if(!by[bA]){by[bA]={}}by=by[bA]}if(bx!==K){by[b.camelCase(bt)]=bx}if(bt==="events"&&!by[bt]){return by[bA]&&by[bA].events}return bz?by[b.camelCase(bt)]||by[bt]:by},removeData:function(bw,bu,bx){if(!b.acceptData(bw)){return}var bz=b.expando,bA=bw.nodeType,bt=bA?b.cache:bw,bv=bA?bw[b.expando]:b.expando;if(!bt[bv]){return}if(bu){var by=bx?bt[bv][bz]:bt[bv];if(by){delete by[bu];if(!U(by)){return}}}if(bx){delete bt[bv][bz];if(!U(bt[bv])){return}}var e=bt[bv][bz];if(b.support.deleteExpando||bt!=ba){delete bt[bv]}else{bt[bv]=null}if(e){bt[bv]={};if(!bA){bt[bv].toJSON=b.noop}bt[bv][bz]=e}else{if(bA){if(b.support.deleteExpando){delete bw[b.expando]}else{if(bw.removeAttribute){bw.removeAttribute(b.expando)}else{bw[b.expando]=null}}}}},_data:function(bt,e,bu){return b.data(bt,e,bu,true)},acceptData:function(bt){if(bt.nodeName){var e=b.noData[bt.nodeName.toLowerCase()];if(e){return !(e===true||bt.getAttribute("classid")!==e)}}return true}});b.fn.extend({data:function(bw,by){var bx=null;if(typeof bw==="undefined"){if(this.length){bx=b.data(this[0]);if(this[0].nodeType===1){var e=this[0].attributes,bu;for(var bv=0,bt=e.length;bv<bt;bv++){bu=e[bv].name;if(bu.indexOf("data-")===0){bu=b.camelCase(bu.substring(5));a3(this[0],bu,bx[bu])}}}}return bx}else{if(typeof bw==="object"){return this.each(function(){b.data(this,bw)})}}var bz=bw.split(".");bz[1]=bz[1]?"."+bz[1]:"";if(by===K){bx=this.triggerHandler("getData"+bz[1]+"!",[bz[0]]);if(bx===K&&this.length){bx=b.data(this[0],bw);bx=a3(this[0],bw,bx)}return bx===K&&bz[1]?this.data(bz[0]):bx}else{return this.each(function(){var bB=b(this),bA=[bz[0],by];bB.triggerHandler("setData"+bz[1]+"!",bA);b.data(this,bw,by);bB.triggerHandler("changeData"+bz[1]+"!",bA)})}},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function a3(bv,bu,bw){if(bw===K&&bv.nodeType===1){var bt="data-"+bu.replace(ax,"$1-$2").toLowerCase();bw=bv.getAttribute(bt);if(typeof bw==="string"){try{bw=bw==="true"?true:bw==="false"?false:bw==="null"?null:!b.isNaN(bw)?parseFloat(bw):aN.test(bw)?b.parseJSON(bw):bw}catch(bx){}b.data(bv,bu,bw)}else{bw=K}}return bw}function U(bt){for(var e in bt){if(e!=="toJSON"){return false}}return true}function bf(bw,bv,by){var bu=bv+"defer",bt=bv+"queue",e=bv+"mark",bx=b.data(bw,bu,K,true);if(bx&&(by==="queue"||!b.data(bw,bt,K,true))&&(by==="mark"||!b.data(bw,e,K,true))){setTimeout(function(){if(!b.data(bw,bt,K,true)&&!b.data(bw,e,K,true)){b.removeData(bw,bu,true);bx.resolve()}},0)}}b.extend({_mark:function(bt,e){if(bt){e=(e||"fx")+"mark";b.data(bt,e,(b.data(bt,e,K,true)||0)+1,true)}},_unmark:function(bw,bv,bt){if(bw!==true){bt=bv;bv=bw;bw=false}if(bv){bt=bt||"fx";var e=bt+"mark",bu=bw?0:((b.data(bv,e,K,true)||1)-1);if(bu){b.data(bv,e,bu,true)}else{b.removeData(bv,e,true);bf(bv,bt,"mark")}}},queue:function(bt,e,bv){if(bt){e=(e||"fx")+"queue";var bu=b.data(bt,e,K,true);if(bv){if(!bu||b.isArray(bv)){bu=b.data(bt,e,b.makeArray(bv),true)}else{bu.push(bv)}}return bu||[]}},dequeue:function(bv,bu){bu=bu||"fx";var e=b.queue(bv,bu),bt=e.shift(),bw;if(bt==="inprogress"){bt=e.shift()}if(bt){if(bu==="fx"){e.unshift("inprogress")}bt.call(bv,function(){b.dequeue(bv,bu)})}if(!e.length){b.removeData(bv,bu+"queue",true);bf(bv,bu,"queue")}}});b.fn.extend({queue:function(e,bt){if(typeof e!=="string"){bt=e;e="fx"}if(bt===K){return b.queue(this[0],e)}return this.each(function(){var bu=b.queue(this,e,bt);if(e==="fx"&&bu[0]!=="inprogress"){b.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(bt,e){bt=b.fx?b.fx.speeds[bt]||bt:bt;e=e||"fx";return this.queue(e,function(){var bu=this;setTimeout(function(){b.dequeue(bu,e)},bt)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(bB,bu){if(typeof bB!=="string"){bu=bB;bB=K}bB=bB||"fx";var e=b.Deferred(),bt=this,bw=bt.length,bz=1,bx=bB+"defer",by=bB+"queue",bA=bB+"mark",bv;function bC(){if(!(--bz)){e.resolveWith(bt,[bt])}}while(bw--){if((bv=b.data(bt[bw],bx,K,true)||(b.data(bt[bw],by,K,true)||b.data(bt[bw],bA,K,true))&&b.data(bt[bw],bx,b._Deferred(),true))){bz++;bv.done(bC)}}bC();return e.promise()}});var aL=/[\n\t\r]/g,ad=/\s+/,aP=/\r/g,g=/^(?:button|input)$/i,D=/^(?:button|input|object|select|textarea)$/i,l=/^a(?:rea)?$/i,al=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,a6=/\:|^on/,a1,aV;b.fn.extend({attr:function(e,bt){return b.access(this,e,bt,true,b.attr)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,bt){return b.access(this,e,bt,true,b.prop)},removeProp:function(e){e=b.propFix[e]||e;return this.each(function(){try{this[e]=K;delete this[e]}catch(bt){}})},addClass:function(bw){var by,bu,bt,bv,bx,bz,e;if(b.isFunction(bw)){return this.each(function(bA){b(this).addClass(bw.call(this,bA,this.className))})}if(bw&&typeof bw==="string"){by=bw.split(ad);for(bu=0,bt=this.length;bu<bt;bu++){bv=this[bu];if(bv.nodeType===1){if(!bv.className&&by.length===1){bv.className=bw}else{bx=" "+bv.className+" ";for(bz=0,e=by.length;bz<e;bz++){if(!~bx.indexOf(" "+by[bz]+" ")){bx+=by[bz]+" "}}bv.className=b.trim(bx)}}}}return this},removeClass:function(bx){var by,bu,bt,bw,bv,bz,e;if(b.isFunction(bx)){return this.each(function(bA){b(this).removeClass(bx.call(this,bA,this.className))})}if((bx&&typeof bx==="string")||bx===K){by=(bx||"").split(ad);for(bu=0,bt=this.length;bu<bt;bu++){bw=this[bu];if(bw.nodeType===1&&bw.className){if(bx){bv=(" "+bw.className+" ").replace(aL," ");for(bz=0,e=by.length;bz<e;bz++){bv=bv.replace(" "+by[bz]+" "," ")}bw.className=b.trim(bv)}else{bw.className=""}}}}return this},toggleClass:function(bv,bt){var bu=typeof bv,e=typeof bt==="boolean";if(b.isFunction(bv)){return this.each(function(bw){b(this).toggleClass(bv.call(this,bw,this.className,bt),bt)})}return this.each(function(){if(bu==="string"){var by,bx=0,bw=b(this),bz=bt,bA=bv.split(ad);while((by=bA[bx++])){bz=e?bz:!bw.hasClass(by);bw[bz?"addClass":"removeClass"](by)}}else{if(bu==="undefined"||bu==="boolean"){if(this.className){b._data(this,"__className__",this.className)}this.className=this.className||bv===false?"":b._data(this,"__className__")||""}}})},hasClass:function(e){var bv=" "+e+" ";for(var bu=0,bt=this.length;bu<bt;bu++){if((" "+this[bu].className+" ").replace(aL," ").indexOf(bv)>-1){return true}}return false},val:function(bv){var e,bt,bu=this[0];if(!arguments.length){if(bu){e=b.valHooks[bu.nodeName.toLowerCase()]||b.valHooks[bu.type];if(e&&"get" in e&&(bt=e.get(bu,"value"))!==K){return bt}bt=bu.value;return typeof bt==="string"?bt.replace(aP,""):bt==null?"":bt}return K}var bw=b.isFunction(bv);return this.each(function(by){var bx=b(this),bz;if(this.nodeType!==1){return}if(bw){bz=bv.call(this,by,bx.val())}else{bz=bv}if(bz==null){bz=""}else{if(typeof bz==="number"){bz+=""}else{if(b.isArray(bz)){bz=b.map(bz,function(bA){return bA==null?"":bA+""})}}}e=b.valHooks[this.nodeName.toLowerCase()]||b.valHooks[this.type];if(!e||!("set" in e)||e.set(this,bz,"value")===K){this.value=bz}})}});b.extend({valHooks:{option:{get:function(e){var bt=e.attributes.value;return !bt||bt.specified?e.value:e.text}},select:{get:function(e){var by,bw=e.selectedIndex,bz=[],bA=e.options,bv=e.type==="select-one";if(bw<0){return null}for(var bt=bv?bw:0,bx=bv?bw+1:bA.length;bt<bx;bt++){var bu=bA[bt];if(bu.selected&&(b.support.optDisabled?!bu.disabled:bu.getAttribute("disabled")===null)&&(!bu.parentNode.disabled||!b.nodeName(bu.parentNode,"optgroup"))){by=b(bu).val();if(bv){return by}bz.push(by)}}if(bv&&!bz.length&&bA.length){return b(bA[bw]).val()}return bz},set:function(bt,bu){var e=b.makeArray(bu);b(bt).find("option").each(function(){this.selected=b.inArray(b(this).val(),e)>=0});if(!e.length){bt.selectedIndex=-1}return e}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attrFix:{tabindex:"tabIndex"},attr:function(by,bv,bz,bx){var bt=by.nodeType;if(!by||bt===3||bt===8||bt===2){return K}if(bx&&bv in b.attrFn){return b(by)[bv](bz)}if(!("getAttribute" in by)){return b.prop(by,bv,bz)}var bu,e,bw=bt!==1||!b.isXMLDoc(by);if(bw){bv=b.attrFix[bv]||bv;e=b.attrHooks[bv];if(!e){if(al.test(bv)){e=aV}else{if(a1&&bv!=="className"&&(b.nodeName(by,"form")||a6.test(bv))){e=a1}}}}if(bz!==K){if(bz===null){b.removeAttr(by,bv);return K}else{if(e&&"set" in e&&bw&&(bu=e.set(by,bz,bv))!==K){return bu}else{by.setAttribute(bv,""+bz);return bz}}}else{if(e&&"get" in e&&bw&&(bu=e.get(by,bv))!==null){return bu}else{bu=by.getAttribute(bv);return bu===null?K:bu}}},removeAttr:function(bt,e){var bu;if(bt.nodeType===1){e=b.attrFix[e]||e;if(b.support.getSetAttribute){bt.removeAttribute(e)}else{b.attr(bt,e,"");bt.removeAttributeNode(bt.getAttributeNode(e))}if(al.test(e)&&(bu=b.propFix[e]||e) in bt){bt[bu]=false}}},attrHooks:{type:{set:function(e,bt){if(g.test(e.nodeName)&&e.parentNode){b.error("type property can't be changed")}else{if(!b.support.radioValue&&bt==="radio"&&b.nodeName(e,"input")){var bu=e.value;e.setAttribute("type",bt);if(bu){e.value=bu}return bt}}}},tabIndex:{get:function(bt){var e=bt.getAttributeNode("tabIndex");return e&&e.specified?parseInt(e.value,10):D.test(bt.nodeName)||l.test(bt.nodeName)&&bt.href?0:K}},value:{get:function(bt,e){if(a1&&b.nodeName(bt,"button")){return a1.get(bt,e)}return e in bt?bt.value:null},set:function(bt,bu,e){if(a1&&b.nodeName(bt,"button")){return a1.set(bt,bu,e)}bt.value=bu}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(bx,bv,by){var bt=bx.nodeType;if(!bx||bt===3||bt===8||bt===2){return K}var bu,e,bw=bt!==1||!b.isXMLDoc(bx);if(bw){bv=b.propFix[bv]||bv;e=b.propHooks[bv]}if(by!==K){if(e&&"set" in e&&(bu=e.set(bx,by,bv))!==K){return bu}else{return(bx[bv]=by)}}else{if(e&&"get" in e&&(bu=e.get(bx,bv))!==K){return bu}else{return bx[bv]}}},propHooks:{}});aV={get:function(bt,e){return b.prop(bt,e)?e.toLowerCase():K},set:function(bt,bv,e){var bu;if(bv===false){b.removeAttr(bt,e)}else{bu=b.propFix[e]||e;if(bu in bt){bt[bu]=true}bt.setAttribute(e,e.toLowerCase())}return e}};if(!b.support.getSetAttribute){b.attrFix=b.propFix;a1=b.attrHooks.name=b.attrHooks.title=b.valHooks.button={get:function(bu,bt){var e;e=bu.getAttributeNode(bt);return e&&e.nodeValue!==""?e.nodeValue:K},set:function(bu,bv,bt){var e=bu.getAttributeNode(bt);if(e){e.nodeValue=bv;return bv}}};b.each(["width","height"],function(bt,e){b.attrHooks[e]=b.extend(b.attrHooks[e],{set:function(bu,bv){if(bv===""){bu.setAttribute(e,"auto");return bv}}})})}if(!b.support.hrefNormalized){b.each(["href","src","width","height"],function(bt,e){b.attrHooks[e]=b.extend(b.attrHooks[e],{get:function(bv){var bu=bv.getAttribute(e,2);return bu===null?K:bu}})})}if(!b.support.style){b.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||K},set:function(e,bt){return(e.style.cssText=""+bt)}}}if(!b.support.optSelected){b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(bt){var e=bt.parentNode;if(e){e.selectedIndex;if(e.parentNode){e.parentNode.selectedIndex}}}})}if(!b.support.checkOn){b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}})}b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,bt){if(b.isArray(bt)){return(e.checked=b.inArray(b(e).val(),bt)>=0)}}})});var aX=/\.(.*)$/,bc=/^(?:textarea|input|select)$/i,O=/\./g,bg=/ /g,aD=/[^\w\s.|`]/g,G=function(e){return e.replace(aD,"\\$&")};b.event={add:function(bv,bz,bE,bx){if(bv.nodeType===3||bv.nodeType===8){return}if(bE===false){bE=bi}else{if(!bE){return}}var bt,bD;if(bE.handler){bt=bE;bE=bt.handler}if(!bE.guid){bE.guid=b.guid++}var bA=b._data(bv);if(!bA){return}var bF=bA.events,by=bA.handle;if(!bF){bA.events=bF={}}if(!by){bA.handle=by=function(bG){return typeof b!=="undefined"&&(!bG||b.event.triggered!==bG.type)?b.event.handle.apply(by.elem,arguments):K}}by.elem=bv;bz=bz.split(" ");var bC,bw=0,e;while((bC=bz[bw++])){bD=bt?b.extend({},bt):{handler:bE,data:bx};if(bC.indexOf(".")>-1){e=bC.split(".");bC=e.shift();bD.namespace=e.slice(0).sort().join(".")}else{e=[];bD.namespace=""}bD.type=bC;if(!bD.guid){bD.guid=bE.guid}var bu=bF[bC],bB=b.event.special[bC]||{};if(!bu){bu=bF[bC]=[];if(!bB.setup||bB.setup.call(bv,bx,e,by)===false){if(bv.addEventListener){bv.addEventListener(bC,by,false)}else{if(bv.attachEvent){bv.attachEvent("on"+bC,by)}}}}if(bB.add){bB.add.call(bv,bD);if(!bD.handler.guid){bD.handler.guid=bE.guid}}bu.push(bD);b.event.global[bC]=true}bv=null},global:{},remove:function(bH,bC,bu,by){if(bH.nodeType===3||bH.nodeType===8){return}if(bu===false){bu=bi}var bK,bx,bz,bE,bF=0,bv,bA,bD,bw,bB,e,bJ,bG=b.hasData(bH)&&b._data(bH),bt=bG&&bG.events;if(!bG||!bt){return}if(bC&&bC.type){bu=bC.handler;bC=bC.type}if(!bC||typeof bC==="string"&&bC.charAt(0)==="."){bC=bC||"";for(bx in bt){b.event.remove(bH,bx+bC)}return}bC=bC.split(" ");while((bx=bC[bF++])){bJ=bx;e=null;bv=bx.indexOf(".")<0;bA=[];if(!bv){bA=bx.split(".");bx=bA.shift();bD=new RegExp("(^|\\.)"+b.map(bA.slice(0).sort(),G).join("\\.(?:.*\\.)?")+"(\\.|$)")}bB=bt[bx];if(!bB){continue}if(!bu){for(bE=0;bE<bB.length;bE++){e=bB[bE];if(bv||bD.test(e.namespace)){b.event.remove(bH,bJ,e.handler,bE);bB.splice(bE--,1)}}continue}bw=b.event.special[bx]||{};for(bE=by||0;bE<bB.length;bE++){e=bB[bE];if(bu.guid===e.guid){if(bv||bD.test(e.namespace)){if(by==null){bB.splice(bE--,1)}if(bw.remove){bw.remove.call(bH,e)}}if(by!=null){break}}}if(bB.length===0||by!=null&&bB.length===1){if(!bw.teardown||bw.teardown.call(bH,bA)===false){b.removeEvent(bH,bx,bG.handle)}bK=null;delete bt[bx]}}if(b.isEmptyObject(bt)){var bI=bG.handle;if(bI){bI.elem=null}delete bG.events;delete bG.handle;if(b.isEmptyObject(bG)){b.removeData(bH,K,true)}}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(e,bz,bx,bE){var bC=e.type||e,bu=[],bt;if(bC.indexOf("!")>=0){bC=bC.slice(0,-1);bt=true}if(bC.indexOf(".")>=0){bu=bC.split(".");bC=bu.shift();bu.sort()}if((!bx||b.event.customEvent[bC])&&!b.event.global[bC]){return}e=typeof e==="object"?e[b.expando]?e:new b.Event(bC,e):new b.Event(bC);e.type=bC;e.exclusive=bt;e.namespace=bu.join(".");e.namespace_re=new RegExp("(^|\\.)"+bu.join("\\.(?:.*\\.)?")+"(\\.|$)");if(bE||!bx){e.preventDefault();e.stopPropagation()}if(!bx){b.each(b.cache,function(){var bG=b.expando,bF=this[bG];if(bF&&bF.events&&bF.events[bC]){b.event.trigger(e,bz,bF.handle.elem)}});return}if(bx.nodeType===3||bx.nodeType===8){return}e.result=K;e.target=bx;bz=bz!=null?b.makeArray(bz):[];bz.unshift(e);var bD=bx,bv=bC.indexOf(":")<0?"on"+bC:"";do{var bA=b._data(bD,"handle");e.currentTarget=bD;if(bA){bA.apply(bD,bz)}if(bv&&b.acceptData(bD)&&bD[bv]&&bD[bv].apply(bD,bz)===false){e.result=false;e.preventDefault()}bD=bD.parentNode||bD.ownerDocument||bD===e.target.ownerDocument&&ba}while(bD&&!e.isPropagationStopped());if(!e.isDefaultPrevented()){var bw,bB=b.event.special[bC]||{};if((!bB._default||bB._default.call(bx.ownerDocument,e)===false)&&!(bC==="click"&&b.nodeName(bx,"a"))&&b.acceptData(bx)){try{if(bv&&bx[bC]){bw=bx[bv];if(bw){bx[bv]=null}b.event.triggered=bC;bx[bC]()}}catch(by){}if(bw){bx[bv]=bw}b.event.triggered=K}}return e.result},handle:function(bz){bz=b.event.fix(bz||ba.event);var bt=((b._data(this,"events")||{})[bz.type]||[]).slice(0),by=!bz.exclusive&&!bz.namespace,bw=Array.prototype.slice.call(arguments,0);bw[0]=bz;bz.currentTarget=this;for(var bv=0,e=bt.length;bv<e;bv++){var bx=bt[bv];if(by||bz.namespace_re.test(bx.namespace)){bz.handler=bx.handler;bz.data=bx.data;bz.handleObj=bx;var bu=bx.handler.apply(this,bw);if(bu!==K){bz.result=bu;if(bu===false){bz.preventDefault();bz.stopPropagation()}}if(bz.isImmediatePropagationStopped()){break}}}return bz.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(bw){if(bw[b.expando]){return bw}var bt=bw;bw=b.Event(bt);for(var bu=this.props.length,by;bu;){by=this.props[--bu];bw[by]=bt[by]}if(!bw.target){bw.target=bw.srcElement||ar}if(bw.target.nodeType===3){bw.target=bw.target.parentNode}if(!bw.relatedTarget&&bw.fromElement){bw.relatedTarget=bw.fromElement===bw.target?bw.toElement:bw.fromElement}if(bw.pageX==null&&bw.clientX!=null){var bv=bw.target.ownerDocument||ar,bx=bv.documentElement,e=bv.body;bw.pageX=bw.clientX+(bx&&bx.scrollLeft||e&&e.scrollLeft||0)-(bx&&bx.clientLeft||e&&e.clientLeft||0);bw.pageY=bw.clientY+(bx&&bx.scrollTop||e&&e.scrollTop||0)-(bx&&bx.clientTop||e&&e.clientTop||0)}if(bw.which==null&&(bw.charCode!=null||bw.keyCode!=null)){bw.which=bw.charCode!=null?bw.charCode:bw.keyCode}if(!bw.metaKey&&bw.ctrlKey){bw.metaKey=bw.ctrlKey}if(!bw.which&&bw.button!==K){bw.which=(bw.button&1?1:(bw.button&2?3:(bw.button&4?2:0)))}return bw},guid:100000000,proxy:b.proxy,special:{ready:{setup:b.bindReady,teardown:b.noop},live:{add:function(e){b.event.add(this,p(e.origType,e.selector),b.extend({},e,{handler:aj,guid:e.handler.guid}))},remove:function(e){b.event.remove(this,p(e.origType,e.selector),e)}},beforeunload:{setup:function(bu,bt,e){if(b.isWindow(this)){this.onbeforeunload=e}},teardown:function(bt,e){if(this.onbeforeunload===e){this.onbeforeunload=null}}}}};b.removeEvent=ar.removeEventListener?function(bt,e,bu){if(bt.removeEventListener){bt.removeEventListener(e,bu,false)}}:function(bt,e,bu){if(bt.detachEvent){bt.detachEvent("on"+e,bu)}};b.Event=function(bt,e){if(!this.preventDefault){return new b.Event(bt,e)}if(bt&&bt.type){this.originalEvent=bt;this.type=bt.type;this.isDefaultPrevented=(bt.defaultPrevented||bt.returnValue===false||bt.getPreventDefault&&bt.getPreventDefault())?i:bi}else{this.type=bt}if(e){b.extend(this,e)}this.timeStamp=b.now();this[b.expando]=true};function bi(){return false}function i(){return true}b.Event.prototype={preventDefault:function(){this.isDefaultPrevented=i;var bt=this.originalEvent;if(!bt){return}if(bt.preventDefault){bt.preventDefault()}else{bt.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=i;var bt=this.originalEvent;if(!bt){return}if(bt.stopPropagation){bt.stopPropagation()}bt.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i;this.stopPropagation()},isDefaultPrevented:bi,isPropagationStopped:bi,isImmediatePropagationStopped:bi};var ac=function(bu){var bv=bu.relatedTarget,e=false,bt=bu.type;bu.type=bu.data;if(bv!==this){if(bv){e=b.contains(this,bv)}if(!e){b.event.handle.apply(this,arguments);bu.type=bt}}},aS=function(e){e.type=e.data;b.event.handle.apply(this,arguments)};b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(bt,e){b.event.special[bt]={setup:function(bu){b.event.add(this,e,bu&&bu.selector?aS:ac,bt)},teardown:function(bu){b.event.remove(this,e,bu&&bu.selector?aS:ac)}}});if(!b.support.submitBubbles){b.event.special.submit={setup:function(bt,e){if(!b.nodeName(this,"form")){b.event.add(this,"click.specialSubmit",function(bw){var bv=bw.target,bu=bv.type;if((bu==="submit"||bu==="image")&&b(bv).closest("form").length){aU("submit",this,arguments)}});b.event.add(this,"keypress.specialSubmit",function(bw){var bv=bw.target,bu=bv.type;if((bu==="text"||bu==="password")&&b(bv).closest("form").length&&bw.keyCode===13){aU("submit",this,arguments)}})}else{return false}},teardown:function(e){b.event.remove(this,".specialSubmit")}}}if(!b.support.changeBubbles){var bl,k=function(bt){var e=bt.type,bu=bt.value;if(e==="radio"||e==="checkbox"){bu=bt.checked}else{if(e==="select-multiple"){bu=bt.selectedIndex>-1?b.map(bt.options,function(bv){return bv.selected}).join("-"):""}else{if(b.nodeName(bt,"select")){bu=bt.selectedIndex}}}return bu},aa=function aa(bv){var bt=bv.target,bu,bw;if(!bc.test(bt.nodeName)||bt.readOnly){return}bu=b._data(bt,"_change_data");bw=k(bt);if(bv.type!=="focusout"||bt.type!=="radio"){b._data(bt,"_change_data",bw)}if(bu===K||bw===bu){return}if(bu!=null||bw){bv.type="change";bv.liveFired=K;b.event.trigger(bv,arguments[1],bt)}};b.event.special.change={filters:{focusout:aa,beforedeactivate:aa,click:function(bv){var bu=bv.target,bt=b.nodeName(bu,"input")?bu.type:"";if(bt==="radio"||bt==="checkbox"||b.nodeName(bu,"select")){aa.call(this,bv)}},keydown:function(bv){var bu=bv.target,bt=b.nodeName(bu,"input")?bu.type:"";if((bv.keyCode===13&&!b.nodeName(bu,"textarea"))||(bv.keyCode===32&&(bt==="checkbox"||bt==="radio"))||bt==="select-multiple"){aa.call(this,bv)}},beforeactivate:function(bu){var bt=bu.target;b._data(bt,"_change_data",k(bt))}},setup:function(bu,bt){if(this.type==="file"){return false}for(var e in bl){b.event.add(this,e+".specialChange",bl[e])}return bc.test(this.nodeName)},teardown:function(e){b.event.remove(this,".specialChange");return bc.test(this.nodeName)}};bl=b.event.special.change.filters;bl.focus=bl.beforeactivate}function aU(bt,bv,e){var bu=b.extend({},e[0]);bu.type=bt;bu.originalEvent={};bu.liveFired=K;b.event.handle.call(bv,bu);if(bu.isDefaultPrevented()){e[0].preventDefault()}}if(!b.support.focusinBubbles){b.each({focus:"focusin",blur:"focusout"},function(bv,e){var bt=0;b.event.special[e]={setup:function(){if(bt++===0){ar.addEventListener(bv,bu,true)}},teardown:function(){if(--bt===0){ar.removeEventListener(bv,bu,true)}}};function bu(bw){var bx=b.event.fix(bw);bx.type=e;bx.originalEvent={};b.event.trigger(bx,null,bx.target);if(bx.isDefaultPrevented()){bw.preventDefault()}}})}b.each(["bind","one"],function(bt,e){b.fn[e]=function(bz,bA,by){var bx;if(typeof bz==="object"){for(var bw in bz){this[e](bw,bA,bz[bw],by)}return this}if(arguments.length===2||bA===false){by=bA;bA=K}if(e==="one"){bx=function(bB){b(this).unbind(bB,bx);return by.apply(this,arguments)};bx.guid=by.guid||b.guid++}else{bx=by}if(bz==="unload"&&e!=="one"){this.one(bz,bA,by)}else{for(var bv=0,bu=this.length;bv<bu;bv++){b.event.add(this[bv],bz,bx,bA)}}return this}});b.fn.extend({unbind:function(bw,bv){if(typeof bw==="object"&&!bw.preventDefault){for(var bu in bw){this.unbind(bu,bw[bu])}}else{for(var bt=0,e=this.length;bt<e;bt++){b.event.remove(this[bt],bw,bv)}}return this},delegate:function(e,bt,bv,bu){return this.live(bt,bv,bu,e)},undelegate:function(e,bt,bu){if(arguments.length===0){return this.unbind("live")}else{return this.die(bt,null,bu,e)}},trigger:function(e,bt){return this.each(function(){b.event.trigger(e,bt,this)})},triggerHandler:function(e,bt){if(this[0]){return b.event.trigger(e,bt,this[0],true)}},toggle:function(bv){var bt=arguments,e=bv.guid||b.guid++,bu=0,bw=function(bx){var by=(b.data(this,"lastToggle"+bv.guid)||0)%bu;b.data(this,"lastToggle"+bv.guid,by+1);bx.preventDefault();return bt[by].apply(this,arguments)||false};bw.guid=e;while(bu<bt.length){bt[bu++].guid=e}return this.click(bw)},hover:function(e,bt){return this.mouseenter(e).mouseleave(bt||e)}});var aQ={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};b.each(["live","die"],function(bt,e){b.fn[e]=function(bD,bA,bF,bw){var bE,bB=0,bC,bv,bH,by=bw||this.selector,bu=bw?this:b(this.context);if(typeof bD==="object"&&!bD.preventDefault){for(var bG in bD){bu[e](bG,bA,bD[bG],by)}return this}if(e==="die"&&!bD&&bw&&bw.charAt(0)==="."){bu.unbind(bw);return this}if(bA===false||b.isFunction(bA)){bF=bA||bi;bA=K}bD=(bD||"").split(" ");while((bE=bD[bB++])!=null){bC=aX.exec(bE);bv="";if(bC){bv=bC[0];bE=bE.replace(aX,"")}if(bE==="hover"){bD.push("mouseenter"+bv,"mouseleave"+bv);continue}bH=bE;if(aQ[bE]){bD.push(aQ[bE]+bv);bE=bE+bv}else{bE=(aQ[bE]||bE)+bv}if(e==="live"){for(var bz=0,bx=bu.length;bz<bx;bz++){b.event.add(bu[bz],"live."+p(bE,by),{data:bA,selector:by,handler:bF,origType:bE,origHandler:bF,preType:bH})}}else{bu.unbind("live."+p(bE,by),bF)}}return this}});function aj(bD){var bA,bv,bJ,bx,e,bF,bC,bE,bB,bI,bz,by,bH,bG=[],bw=[],bt=b._data(this,"events");if(bD.liveFired===this||!bt||!bt.live||bD.target.disabled||bD.button&&bD.type==="click"){return}if(bD.namespace){by=new RegExp("(^|\\.)"+bD.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")}bD.liveFired=this;var bu=bt.live.slice(0);for(bC=0;bC<bu.length;bC++){e=bu[bC];if(e.origType.replace(aX,"")===bD.type){bw.push(e.selector)}else{bu.splice(bC--,1)}}bx=b(bD.target).closest(bw,bD.currentTarget);for(bE=0,bB=bx.length;bE<bB;bE++){bz=bx[bE];for(bC=0;bC<bu.length;bC++){e=bu[bC];if(bz.selector===e.selector&&(!by||by.test(e.namespace))&&!bz.elem.disabled){bF=bz.elem;bJ=null;if(e.preType==="mouseenter"||e.preType==="mouseleave"){bD.type=e.preType;bJ=b(bD.relatedTarget).closest(e.selector)[0];if(bJ&&b.contains(bF,bJ)){bJ=bF}}if(!bJ||bJ!==bF){bG.push({elem:bF,handleObj:e,level:bz.level})}}}}for(bE=0,bB=bG.length;bE<bB;bE++){bx=bG[bE];if(bv&&bx.level>bv){break}bD.currentTarget=bx.elem;bD.data=bx.handleObj.data;bD.handleObj=bx.handleObj;bH=bx.handleObj.origHandler.apply(bx.elem,arguments);if(bH===false||bD.isPropagationStopped()){bv=bx.level;if(bH===false){bA=false}if(bD.isImmediatePropagationStopped()){break}}}return bA}function p(bt,e){return(bt&&bt!=="*"?bt+".":"")+e.replace(O,"`").replace(bg,"&")}b.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error").split(" "),function(bt,e){b.fn[e]=function(bv,bu){if(bu==null){bu=bv;bv=null}return arguments.length>0?this.bind(e,bv,bu):this.trigger(e)};if(b.attrFn){b.attrFn[e]=true}});
/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var bD=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,bE=0,bH=Object.prototype.toString,by=false,bx=true,bF=/\\/g,bL=/\W/;[0,0].sort(function(){bx=false;return 0});var bv=function(bQ,e,bT,bU){bT=bT||[];e=e||ar;var bW=e;if(e.nodeType!==1&&e.nodeType!==9){return[]}if(!bQ||typeof bQ!=="string"){return bT}var bN,bY,b1,bM,bX,b0,bZ,bS,bP=true,bO=bv.isXML(e),bR=[],bV=bQ;do{bD.exec("");bN=bD.exec(bV);if(bN){bV=bN[3];bR.push(bN[1]);if(bN[2]){bM=bN[3];break}}}while(bN);if(bR.length>1&&bz.exec(bQ)){if(bR.length===2&&bA.relative[bR[0]]){bY=bI(bR[0]+bR[1],e)}else{bY=bA.relative[bR[0]]?[e]:bv(bR.shift(),e);while(bR.length){bQ=bR.shift();if(bA.relative[bQ]){bQ+=bR.shift()}bY=bI(bQ,bY)}}}else{if(!bU&&bR.length>1&&e.nodeType===9&&!bO&&bA.match.ID.test(bR[0])&&!bA.match.ID.test(bR[bR.length-1])){bX=bv.find(bR.shift(),e,bO);e=bX.expr?bv.filter(bX.expr,bX.set)[0]:bX.set[0]}if(e){bX=bU?{expr:bR.pop(),set:bB(bU)}:bv.find(bR.pop(),bR.length===1&&(bR[0]==="~"||bR[0]==="+")&&e.parentNode?e.parentNode:e,bO);bY=bX.expr?bv.filter(bX.expr,bX.set):bX.set;if(bR.length>0){b1=bB(bY)}else{bP=false}while(bR.length){b0=bR.pop();bZ=b0;if(!bA.relative[b0]){b0=""}else{bZ=bR.pop()}if(bZ==null){bZ=e}bA.relative[b0](b1,bZ,bO)}}else{b1=bR=[]}}if(!b1){b1=bY}if(!b1){bv.error(b0||bQ)}if(bH.call(b1)==="[object Array]"){if(!bP){bT.push.apply(bT,b1)}else{if(e&&e.nodeType===1){for(bS=0;b1[bS]!=null;bS++){if(b1[bS]&&(b1[bS]===true||b1[bS].nodeType===1&&bv.contains(e,b1[bS]))){bT.push(bY[bS])}}}else{for(bS=0;b1[bS]!=null;bS++){if(b1[bS]&&b1[bS].nodeType===1){bT.push(bY[bS])}}}}}else{bB(b1,bT)}if(bM){bv(bM,bW,bT,bU);bv.uniqueSort(bT)}return bT};bv.uniqueSort=function(bM){if(bG){by=bx;bM.sort(bG);if(by){for(var e=1;e<bM.length;e++){if(bM[e]===bM[e-1]){bM.splice(e--,1)}}}}return bM};bv.matches=function(e,bM){return bv(e,null,null,bM)};bv.matchesSelector=function(e,bM){return bv(bM,null,null,[e]).length>0};bv.find=function(bS,e,bT){var bR;if(!bS){return[]}for(var bO=0,bN=bA.order.length;bO<bN;bO++){var bP,bQ=bA.order[bO];if((bP=bA.leftMatch[bQ].exec(bS))){var bM=bP[1];bP.splice(1,1);if(bM.substr(bM.length-1)!=="\\"){bP[1]=(bP[1]||"").replace(bF,"");bR=bA.find[bQ](bP,e,bT);if(bR!=null){bS=bS.replace(bA.match[bQ],"");break}}}}if(!bR){bR=typeof e.getElementsByTagName!=="undefined"?e.getElementsByTagName("*"):[]}return{set:bR,expr:bS}};bv.filter=function(bW,bV,bZ,bP){var bR,e,bN=bW,b1=[],bT=bV,bS=bV&&bV[0]&&bv.isXML(bV[0]);while(bW&&bV.length){for(var bU in bA.filter){if((bR=bA.leftMatch[bU].exec(bW))!=null&&bR[2]){var b0,bY,bM=bA.filter[bU],bO=bR[1];e=false;bR.splice(1,1);if(bO.substr(bO.length-1)==="\\"){continue}if(bT===b1){b1=[]}if(bA.preFilter[bU]){bR=bA.preFilter[bU](bR,bT,bZ,b1,bP,bS);if(!bR){e=b0=true}else{if(bR===true){continue}}}if(bR){for(var bQ=0;(bY=bT[bQ])!=null;bQ++){if(bY){b0=bM(bY,bR,bQ,bT);var bX=bP^!!b0;if(bZ&&b0!=null){if(bX){e=true}else{bT[bQ]=false}}else{if(bX){b1.push(bY);e=true}}}}}if(b0!==K){if(!bZ){bT=b1}bW=bW.replace(bA.match[bU],"");if(!e){return[]}break}}}if(bW===bN){if(e==null){bv.error(bW)}else{break}}bN=bW}return bT};bv.error=function(e){throw"Syntax error, unrecognized expression: "+e};var bA=bv.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(bR,bM){var bO=typeof bM==="string",bQ=bO&&!bL.test(bM),bS=bO&&!bQ;if(bQ){bM=bM.toLowerCase()}for(var bN=0,e=bR.length,bP;bN<e;bN++){if((bP=bR[bN])){while((bP=bP.previousSibling)&&bP.nodeType!==1){}bR[bN]=bS||bP&&bP.nodeName.toLowerCase()===bM?bP||false:bP===bM}}if(bS){bv.filter(bM,bR,true)}},">":function(bR,bM){var bQ,bP=typeof bM==="string",bN=0,e=bR.length;if(bP&&!bL.test(bM)){bM=bM.toLowerCase();for(;bN<e;bN++){bQ=bR[bN];if(bQ){var bO=bQ.parentNode;bR[bN]=bO.nodeName.toLowerCase()===bM?bO:false}}}else{for(;bN<e;bN++){bQ=bR[bN];if(bQ){bR[bN]=bP?bQ.parentNode:bQ.parentNode===bM}}if(bP){bv.filter(bM,bR,true)}}},"":function(bO,bM,bQ){var bP,bN=bE++,e=bJ;if(typeof bM==="string"&&!bL.test(bM)){bM=bM.toLowerCase();bP=bM;e=bt}e("parentNode",bM,bN,bO,bP,bQ)},"~":function(bO,bM,bQ){var bP,bN=bE++,e=bJ;if(typeof bM==="string"&&!bL.test(bM)){bM=bM.toLowerCase();bP=bM;e=bt}e("previousSibling",bM,bN,bO,bP,bQ)}},find:{ID:function(bM,bN,bO){if(typeof bN.getElementById!=="undefined"&&!bO){var e=bN.getElementById(bM[1]);return e&&e.parentNode?[e]:[]}},NAME:function(bN,bQ){if(typeof bQ.getElementsByName!=="undefined"){var bM=[],bP=bQ.getElementsByName(bN[1]);for(var bO=0,e=bP.length;bO<e;bO++){if(bP[bO].getAttribute("name")===bN[1]){bM.push(bP[bO])}}return bM.length===0?null:bM}},TAG:function(e,bM){if(typeof bM.getElementsByTagName!=="undefined"){return bM.getElementsByTagName(e[1])}}},preFilter:{CLASS:function(bO,bM,bN,e,bR,bS){bO=" "+bO[1].replace(bF,"")+" ";if(bS){return bO}for(var bP=0,bQ;(bQ=bM[bP])!=null;bP++){if(bQ){if(bR^(bQ.className&&(" "+bQ.className+" ").replace(/[\t\n\r]/g," ").indexOf(bO)>=0)){if(!bN){e.push(bQ)}}else{if(bN){bM[bP]=false}}}}return false},ID:function(e){return e[1].replace(bF,"")},TAG:function(bM,e){return bM[1].replace(bF,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){if(!e[2]){bv.error(e[0])}e[2]=e[2].replace(/^\+|\s*/g,"");var bM=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(bM[1]+(bM[2]||1))-0;e[3]=bM[3]-0}else{if(e[2]){bv.error(e[0])}}e[0]=bE++;return e},ATTR:function(bP,bM,bN,e,bQ,bR){var bO=bP[1]=bP[1].replace(bF,"");if(!bR&&bA.attrMap[bO]){bP[1]=bA.attrMap[bO]}bP[4]=(bP[4]||bP[5]||"").replace(bF,"");if(bP[2]==="~="){bP[4]=" "+bP[4]+" "}return bP},PSEUDO:function(bP,bM,bN,e,bQ){if(bP[1]==="not"){if((bD.exec(bP[3])||"").length>1||/^\w/.test(bP[3])){bP[3]=bv(bP[3],null,null,bM)}else{var bO=bv.filter(bP[3],bM,bN,true^bQ);if(!bN){e.push.apply(e,bO)}return false}}else{if(bA.match.POS.test(bP[0])||bA.match.CHILD.test(bP[0])){return true}}return bP},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(bN,bM,e){return !!bv(e[3],bN).length},header:function(e){return(/h\d/i).test(e.nodeName)},text:function(bN){var e=bN.getAttribute("type"),bM=bN.type;return bN.nodeName.toLowerCase()==="input"&&"text"===bM&&(e===bM||e===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(bM){var e=bM.nodeName.toLowerCase();return(e==="input"||e==="button")&&"submit"===bM.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(bM){var e=bM.nodeName.toLowerCase();return(e==="input"||e==="button")&&"reset"===bM.type},button:function(bM){var e=bM.nodeName.toLowerCase();return e==="input"&&"button"===bM.type||e==="button"},input:function(e){return(/input|select|textarea|button/i).test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(bM,e){return e===0},last:function(bN,bM,e,bO){return bM===bO.length-1},even:function(bM,e){return e%2===0},odd:function(bM,e){return e%2===1},lt:function(bN,bM,e){return bM<e[3]-0},gt:function(bN,bM,e){return bM>e[3]-0},nth:function(bN,bM,e){return e[3]-0===bM},eq:function(bN,bM,e){return e[3]-0===bM}},filter:{PSEUDO:function(bN,bS,bR,bT){var e=bS[1],bM=bA.filters[e];if(bM){return bM(bN,bR,bS,bT)}else{if(e==="contains"){return(bN.textContent||bN.innerText||bv.getText([bN])||"").indexOf(bS[3])>=0}else{if(e==="not"){var bO=bS[3];for(var bQ=0,bP=bO.length;bQ<bP;bQ++){if(bO[bQ]===bN){return false}}return true}else{bv.error(e)}}}},CHILD:function(e,bO){var bR=bO[1],bM=e;switch(bR){case"only":case"first":while((bM=bM.previousSibling)){if(bM.nodeType===1){return false}}if(bR==="first"){return true}bM=e;case"last":while((bM=bM.nextSibling)){if(bM.nodeType===1){return false}}return true;case"nth":var bN=bO[2],bU=bO[3];if(bN===1&&bU===0){return true}var bQ=bO[0],bT=e.parentNode;if(bT&&(bT.sizcache!==bQ||!e.nodeIndex)){var bP=0;for(bM=bT.firstChild;bM;bM=bM.nextSibling){if(bM.nodeType===1){bM.nodeIndex=++bP}}bT.sizcache=bQ}var bS=e.nodeIndex-bU;if(bN===0){return bS===0}else{return(bS%bN===0&&bS/bN>=0)}}},ID:function(bM,e){return bM.nodeType===1&&bM.getAttribute("id")===e},TAG:function(bM,e){return(e==="*"&&bM.nodeType===1)||bM.nodeName.toLowerCase()===e},CLASS:function(bM,e){return(" "+(bM.className||bM.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(bQ,bO){var bN=bO[1],e=bA.attrHandle[bN]?bA.attrHandle[bN](bQ):bQ[bN]!=null?bQ[bN]:bQ.getAttribute(bN),bR=e+"",bP=bO[2],bM=bO[4];return e==null?bP==="!=":bP==="="?bR===bM:bP==="*="?bR.indexOf(bM)>=0:bP==="~="?(" "+bR+" ").indexOf(bM)>=0:!bM?bR&&e!==false:bP==="!="?bR!==bM:bP==="^="?bR.indexOf(bM)===0:bP==="$="?bR.substr(bR.length-bM.length)===bM:bP==="|="?bR===bM||bR.substr(0,bM.length+1)===bM+"-":false},POS:function(bP,bM,bN,bQ){var e=bM[2],bO=bA.setFilters[e];if(bO){return bO(bP,bN,bM,bQ)}}}};var bz=bA.match.POS,bu=function(bM,e){return"\\"+(e-0+1)};for(var bw in bA.match){bA.match[bw]=new RegExp(bA.match[bw].source+(/(?![^\[]*\])(?![^\(]*\))/.source));bA.leftMatch[bw]=new RegExp(/(^(?:.|\r|\n)*?)/.source+bA.match[bw].source.replace(/\\(\d+)/g,bu))}var bB=function(bM,e){bM=Array.prototype.slice.call(bM,0);if(e){e.push.apply(e,bM);return e}return bM};try{Array.prototype.slice.call(ar.documentElement.childNodes,0)[0].nodeType}catch(bK){bB=function(bP,bO){var bN=0,bM=bO||[];if(bH.call(bP)==="[object Array]"){Array.prototype.push.apply(bM,bP)}else{if(typeof bP.length==="number"){for(var e=bP.length;bN<e;bN++){bM.push(bP[bN])}}else{for(;bP[bN];bN++){bM.push(bP[bN])}}}return bM}}var bG,bC;if(ar.documentElement.compareDocumentPosition){bG=function(bM,e){if(bM===e){by=true;return 0}if(!bM.compareDocumentPosition||!e.compareDocumentPosition){return bM.compareDocumentPosition?-1:1}return bM.compareDocumentPosition(e)&4?-1:1}}else{bG=function(bT,bS){if(bT===bS){by=true;return 0}else{if(bT.sourceIndex&&bS.sourceIndex){return bT.sourceIndex-bS.sourceIndex}}var bQ,bM,bN=[],e=[],bP=bT.parentNode,bR=bS.parentNode,bU=bP;if(bP===bR){return bC(bT,bS)}else{if(!bP){return -1}else{if(!bR){return 1}}}while(bU){bN.unshift(bU);bU=bU.parentNode}bU=bR;while(bU){e.unshift(bU);bU=bU.parentNode}bQ=bN.length;bM=e.length;for(var bO=0;bO<bQ&&bO<bM;bO++){if(bN[bO]!==e[bO]){return bC(bN[bO],e[bO])}}return bO===bQ?bC(bT,e[bO],-1):bC(bN[bO],bS,1)};bC=function(bM,e,bN){if(bM===e){return bN}var bO=bM.nextSibling;while(bO){if(bO===e){return -1}bO=bO.nextSibling}return 1}}bv.getText=function(e){var bM="",bO;for(var bN=0;e[bN];bN++){bO=e[bN];if(bO.nodeType===3||bO.nodeType===4){bM+=bO.nodeValue}else{if(bO.nodeType!==8){bM+=bv.getText(bO.childNodes)}}}return bM};(function(){var bM=ar.createElement("div"),bN="script"+(new Date()).getTime(),e=ar.documentElement;bM.innerHTML="<a name='"+bN+"'/>";e.insertBefore(bM,e.firstChild);if(ar.getElementById(bN)){bA.find.ID=function(bP,bQ,bR){if(typeof bQ.getElementById!=="undefined"&&!bR){var bO=bQ.getElementById(bP[1]);return bO?bO.id===bP[1]||typeof bO.getAttributeNode!=="undefined"&&bO.getAttributeNode("id").nodeValue===bP[1]?[bO]:K:[]}};bA.filter.ID=function(bQ,bO){var bP=typeof bQ.getAttributeNode!=="undefined"&&bQ.getAttributeNode("id");return bQ.nodeType===1&&bP&&bP.nodeValue===bO}}e.removeChild(bM);e=bM=null})();(function(){var e=ar.createElement("div");e.appendChild(ar.createComment(""));if(e.getElementsByTagName("*").length>0){bA.find.TAG=function(bM,bQ){var bP=bQ.getElementsByTagName(bM[1]);if(bM[1]==="*"){var bO=[];for(var bN=0;bP[bN];bN++){if(bP[bN].nodeType===1){bO.push(bP[bN])}}bP=bO}return bP}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){bA.attrHandle.href=function(bM){return bM.getAttribute("href",2)}}e=null})();if(ar.querySelectorAll){(function(){var e=bv,bO=ar.createElement("div"),bN="__sizzle__";bO.innerHTML="<p class='TEST'></p>";if(bO.querySelectorAll&&bO.querySelectorAll(".TEST").length===0){return}bv=function(bZ,bQ,bU,bY){bQ=bQ||ar;if(!bY&&!bv.isXML(bQ)){var bX=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(bZ);if(bX&&(bQ.nodeType===1||bQ.nodeType===9)){if(bX[1]){return bB(bQ.getElementsByTagName(bZ),bU)}else{if(bX[2]&&bA.find.CLASS&&bQ.getElementsByClassName){return bB(bQ.getElementsByClassName(bX[2]),bU)}}}if(bQ.nodeType===9){if(bZ==="body"&&bQ.body){return bB([bQ.body],bU)}else{if(bX&&bX[3]){var bT=bQ.getElementById(bX[3]);if(bT&&bT.parentNode){if(bT.id===bX[3]){return bB([bT],bU)}}else{return bB([],bU)}}}try{return bB(bQ.querySelectorAll(bZ),bU)}catch(bV){}}else{if(bQ.nodeType===1&&bQ.nodeName.toLowerCase()!=="object"){var bR=bQ,bS=bQ.getAttribute("id"),bP=bS||bN,b1=bQ.parentNode,b0=/^\s*[+~]/.test(bZ);if(!bS){bQ.setAttribute("id",bP)}else{bP=bP.replace(/'/g,"\\$&")}if(b0&&b1){bQ=bQ.parentNode}try{if(!b0||b1){return bB(bQ.querySelectorAll("[id='"+bP+"'] "+bZ),bU)}}catch(bW){}finally{if(!bS){bR.removeAttribute("id")}}}}}return e(bZ,bQ,bU,bY)};for(var bM in e){bv[bM]=e[bM]}bO=null})()}(function(){var e=ar.documentElement,bN=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(bN){var bP=!bN.call(ar.createElement("div"),"div"),bM=false;try{bN.call(ar.documentElement,"[test!='']:sizzle")}catch(bO){bM=true}bv.matchesSelector=function(bR,bT){bT=bT.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!bv.isXML(bR)){try{if(bM||!bA.match.PSEUDO.test(bT)&&!/!=/.test(bT)){var bQ=bN.call(bR,bT);if(bQ||!bP||bR.document&&bR.document.nodeType!==11){return bQ}}}catch(bS){}}return bv(bT,null,null,[bR]).length>0}}})();(function(){var e=ar.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}bA.order.splice(1,0,"CLASS");bA.find.CLASS=function(bM,bN,bO){if(typeof bN.getElementsByClassName!=="undefined"&&!bO){return bN.getElementsByClassName(bM[1])}};e=null})();function bt(bM,bR,bQ,bU,bS,bT){for(var bO=0,bN=bU.length;bO<bN;bO++){var e=bU[bO];if(e){var bP=false;e=e[bM];while(e){if(e.sizcache===bQ){bP=bU[e.sizset];break}if(e.nodeType===1&&!bT){e.sizcache=bQ;e.sizset=bO}if(e.nodeName.toLowerCase()===bR){bP=e;break}e=e[bM]}bU[bO]=bP}}}function bJ(bM,bR,bQ,bU,bS,bT){for(var bO=0,bN=bU.length;bO<bN;bO++){var e=bU[bO];if(e){var bP=false;e=e[bM];while(e){if(e.sizcache===bQ){bP=bU[e.sizset];break}if(e.nodeType===1){if(!bT){e.sizcache=bQ;e.sizset=bO}if(typeof bR!=="string"){if(e===bR){bP=true;break}}else{if(bv.filter(bR,[e]).length>0){bP=e;break}}}e=e[bM]}bU[bO]=bP}}}if(ar.documentElement.contains){bv.contains=function(bM,e){return bM!==e&&(bM.contains?bM.contains(e):true)}}else{if(ar.documentElement.compareDocumentPosition){bv.contains=function(bM,e){return !!(bM.compareDocumentPosition(e)&16)}}else{bv.contains=function(){return false}}}bv.isXML=function(e){var bM=(e?e.ownerDocument||e:0).documentElement;return bM?bM.nodeName!=="HTML":false};var bI=function(e,bS){var bQ,bO=[],bP="",bN=bS.nodeType?[bS]:bS;while((bQ=bA.match.PSEUDO.exec(e))){bP+=bQ[0];e=e.replace(bA.match.PSEUDO,"")}e=bA.relative[e]?e+"*":e;for(var bR=0,bM=bN.length;bR<bM;bR++){bv(e,bN[bR],bO)}return bv.filter(bP,bO)};b.find=bv;b.expr=bv.selectors;b.expr[":"]=b.expr.filters;b.unique=bv.uniqueSort;b.text=bv.getText;b.isXMLDoc=bv.isXML;b.contains=bv.contains})();var Z=/Until$/,an=/^(?:parents|prevUntil|prevAll)/,a8=/,/,bo=/^.[^:#\[\.,]*$/,Q=Array.prototype.slice,H=b.expr.match.POS,av={children:true,contents:true,next:true,prev:true};b.fn.extend({find:function(e){var bu=this,bw,bt;if(typeof e!=="string"){return b(e).filter(function(){for(bw=0,bt=bu.length;bw<bt;bw++){if(b.contains(bu[bw],this)){return true}}})}var bv=this.pushStack("","find",e),by,bz,bx;for(bw=0,bt=this.length;bw<bt;bw++){by=bv.length;b.find(e,this[bw],bv);if(bw>0){for(bz=by;bz<bv.length;bz++){for(bx=0;bx<by;bx++){if(bv[bx]===bv[bz]){bv.splice(bz--,1);break}}}}}return bv},has:function(bt){var e=b(bt);return this.filter(function(){for(var bv=0,bu=e.length;bv<bu;bv++){if(b.contains(this,e[bv])){return true}}})},not:function(e){return this.pushStack(aC(this,e,false),"not",e)},filter:function(e){return this.pushStack(aC(this,e,true),"filter",e)},is:function(e){return !!e&&(typeof e==="string"?b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(bC,bt){var bz=[],bw,bu,bB=this[0];if(b.isArray(bC)){var by,bv,bx={},e=1;if(bB&&bC.length){for(bw=0,bu=bC.length;bw<bu;bw++){bv=bC[bw];if(!bx[bv]){bx[bv]=H.test(bv)?b(bv,bt||this.context):bv}}while(bB&&bB.ownerDocument&&bB!==bt){for(bv in bx){by=bx[bv];if(by.jquery?by.index(bB)>-1:b(bB).is(by)){bz.push({selector:bv,elem:bB,level:e})}}bB=bB.parentNode;e++}}return bz}var bA=H.test(bC)||typeof bC!=="string"?b(bC,bt||this.context):0;for(bw=0,bu=this.length;bw<bu;bw++){bB=this[bw];while(bB){if(bA?bA.index(bB)>-1:b.find.matchesSelector(bB,bC)){bz.push(bB);break}else{bB=bB.parentNode;if(!bB||!bB.ownerDocument||bB===bt||bB.nodeType===11){break}}}}bz=bz.length>1?b.unique(bz):bz;return this.pushStack(bz,"closest",bC)},index:function(e){if(!e||typeof e==="string"){return b.inArray(this[0],e?b(e):this.parent().children())}return b.inArray(e.jquery?e[0]:e,this)},add:function(e,bt){var bv=typeof e==="string"?b(e,bt):b.makeArray(e&&e.nodeType?[e]:e),bu=b.merge(this.get(),bv);return this.pushStack(C(bv[0])||C(bu[0])?bu:b.unique(bu))},andSelf:function(){return this.add(this.prevObject)}});function C(e){return !e||!e.parentNode||e.parentNode.nodeType===11}b.each({parent:function(bt){var e=bt.parentNode;return e&&e.nodeType!==11?e:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(bt,e,bu){return b.dir(bt,"parentNode",bu)},next:function(e){return b.nth(e,2,"nextSibling")},prev:function(e){return b.nth(e,2,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(bt,e,bu){return b.dir(bt,"nextSibling",bu)},prevUntil:function(bt,e,bu){return b.dir(bt,"previousSibling",bu)},siblings:function(e){return b.sibling(e.parentNode.firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.makeArray(e.childNodes)}},function(e,bt){b.fn[e]=function(bx,bu){var bw=b.map(this,bt,bx),bv=Q.call(arguments);if(!Z.test(e)){bu=bx}if(bu&&typeof bu==="string"){bw=b.filter(bu,bw)}bw=this.length>1&&!av[e]?b.unique(bw):bw;if((this.length>1||a8.test(bu))&&an.test(e)){bw=bw.reverse()}return this.pushStack(bw,e,bv.join(","))}});b.extend({filter:function(bu,e,bt){if(bt){bu=":not("+bu+")"}return e.length===1?b.find.matchesSelector(e[0],bu)?[e[0]]:[]:b.find.matches(bu,e)},dir:function(bu,bt,bw){var e=[],bv=bu[bt];while(bv&&bv.nodeType!==9&&(bw===K||bv.nodeType!==1||!b(bv).is(bw))){if(bv.nodeType===1){e.push(bv)}bv=bv[bt]}return e},nth:function(bw,e,bu,bv){e=e||1;var bt=0;for(;bw;bw=bw[bu]){if(bw.nodeType===1&&++bt===e){break}}return bw},sibling:function(bu,bt){var e=[];for(;bu;bu=bu.nextSibling){if(bu.nodeType===1&&bu!==bt){e.push(bu)}}return e}});function aC(bv,bu,e){bu=bu||0;if(b.isFunction(bu)){return b.grep(bv,function(bx,bw){var by=!!bu.call(bx,bw,bx);return by===e})}else{if(bu.nodeType){return b.grep(bv,function(bx,bw){return(bx===bu)===e})}else{if(typeof bu==="string"){var bt=b.grep(bv,function(bw){return bw.nodeType===1});if(bo.test(bu)){return b.filter(bu,bt,!e)}else{bu=b.filter(bu,bt)}}}}return b.grep(bv,function(bx,bw){return(b.inArray(bx,bu)>=0)===e})}var ae=/ jQuery\d+="(?:\d+|null)"/g,ao=/^\s+/,T=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,d=/<([\w:]+)/,w=/<tbody/i,W=/<|&#?\w+;/,P=/<(?:script|object|embed|option|style)/i,n=/checked\s*(?:[^=]|=\s*.checked.)/i,bk=/\/(java|ecma)script/i,aK=/^\s*<!(?:\[CDATA\[|\-\-)/,au={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};au.optgroup=au.option;au.tbody=au.tfoot=au.colgroup=au.caption=au.thead;au.th=au.td;if(!b.support.htmlSerialize){au._default=[1,"div<div>","</div>"]}b.fn.extend({text:function(e){if(b.isFunction(e)){return this.each(function(bu){var bt=b(this);bt.text(e.call(this,bu,bt.text()))})}if(typeof e!=="object"&&e!==K){return this.empty().append((this[0]&&this[0].ownerDocument||ar).createTextNode(e))}return b.text(this)},wrapAll:function(e){if(b.isFunction(e)){return this.each(function(bu){b(this).wrapAll(e.call(this,bu))})}if(this[0]){var bt=b(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){bt.insertBefore(this[0])}bt.map(function(){var bu=this;while(bu.firstChild&&bu.firstChild.nodeType===1){bu=bu.firstChild}return bu}).append(this)}return this},wrapInner:function(e){if(b.isFunction(e)){return this.each(function(bt){b(this).wrapInner(e.call(this,bt))})}return this.each(function(){var bt=b(this),bu=bt.contents();if(bu.length){bu.wrapAll(e)}else{bt.append(e)}})},wrap:function(e){return this.each(function(){b(this).wrapAll(e)})},unwrap:function(){return this.parent().each(function(){if(!b.nodeName(this,"body")){b(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.appendChild(e)}})},prepend:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.insertBefore(e,this.firstChild)}})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(bt){this.parentNode.insertBefore(bt,this)})}else{if(arguments.length){var e=b(arguments[0]);e.push.apply(e,this.toArray());return this.pushStack(e,"before",arguments)}}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(bt){this.parentNode.insertBefore(bt,this.nextSibling)})}else{if(arguments.length){var e=this.pushStack(this,"after",arguments);e.push.apply(e,b(arguments[0]).toArray());return e}}},remove:function(e,bv){for(var bt=0,bu;(bu=this[bt])!=null;bt++){if(!e||b.filter(e,[bu]).length){if(!bv&&bu.nodeType===1){b.cleanData(bu.getElementsByTagName("*"));b.cleanData([bu])}if(bu.parentNode){bu.parentNode.removeChild(bu)}}}return this},empty:function(){for(var e=0,bt;(bt=this[e])!=null;e++){if(bt.nodeType===1){b.cleanData(bt.getElementsByTagName("*"))}while(bt.firstChild){bt.removeChild(bt.firstChild)}}return this},clone:function(bt,e){bt=bt==null?false:bt;e=e==null?bt:e;return this.map(function(){return b.clone(this,bt,e)})},html:function(bv){if(bv===K){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(ae,""):null}else{if(typeof bv==="string"&&!P.test(bv)&&(b.support.leadingWhitespace||!ao.test(bv))&&!au[(d.exec(bv)||["",""])[1].toLowerCase()]){bv=bv.replace(T,"<$1></$2>");try{for(var bu=0,bt=this.length;bu<bt;bu++){if(this[bu].nodeType===1){b.cleanData(this[bu].getElementsByTagName("*"));this[bu].innerHTML=bv}}}catch(bw){this.empty().append(bv)}}else{if(b.isFunction(bv)){this.each(function(bx){var e=b(this);e.html(bv.call(this,bx,e.html()))})}else{this.empty().append(bv)}}}return this},replaceWith:function(e){if(this[0]&&this[0].parentNode){if(b.isFunction(e)){return this.each(function(bv){var bu=b(this),bt=bu.html();bu.replaceWith(e.call(this,bv,bt))})}if(typeof e!=="string"){e=b(e).detach()}return this.each(function(){var bu=this.nextSibling,bt=this.parentNode;b(this).remove();if(bu){b(bu).before(e)}else{b(bt).append(e)}})}else{return this.length?this.pushStack(b(b.isFunction(e)?e():e),"replaceWith",e):this}},detach:function(e){return this.remove(e,true)},domManip:function(bz,bD,bC){var bv,bw,by,bB,bA=bz[0],bt=[];if(!b.support.checkClone&&arguments.length===3&&typeof bA==="string"&&n.test(bA)){return this.each(function(){b(this).domManip(bz,bD,bC,true)})}if(b.isFunction(bA)){return this.each(function(bF){var bE=b(this);bz[0]=bA.call(this,bF,bD?bE.html():K);bE.domManip(bz,bD,bC)})}if(this[0]){bB=bA&&bA.parentNode;if(b.support.parentNode&&bB&&bB.nodeType===11&&bB.childNodes.length===this.length){bv={fragment:bB}}else{bv=b.buildFragment(bz,this,bt)}by=bv.fragment;if(by.childNodes.length===1){bw=by=by.firstChild}else{bw=by.firstChild}if(bw){bD=bD&&b.nodeName(bw,"tr");for(var bu=0,e=this.length,bx=e-1;bu<e;bu++){bC.call(bD?a9(this[bu],bw):this[bu],bv.cacheable||(e>1&&bu<bx)?b.clone(by,true,true):by)}}if(bt.length){b.each(bt,bn)}}return this}});function a9(e,bt){return b.nodeName(e,"table")?(e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody"))):e}function t(e,bz){if(bz.nodeType!==1||!b.hasData(e)){return}var by=b.expando,bv=b.data(e),bw=b.data(bz,bv);if((bv=bv[by])){var bA=bv.events;bw=bw[by]=b.extend({},bv);if(bA){delete bw.handle;bw.events={};for(var bx in bA){for(var bu=0,bt=bA[bx].length;bu<bt;bu++){b.event.add(bz,bx+(bA[bx][bu].namespace?".":"")+bA[bx][bu].namespace,bA[bx][bu],bA[bx][bu].data)}}}}}function af(bt,e){var bu;if(e.nodeType!==1){return}if(e.clearAttributes){e.clearAttributes()}if(e.mergeAttributes){e.mergeAttributes(bt)}bu=e.nodeName.toLowerCase();if(bu==="object"){e.outerHTML=bt.outerHTML}else{if(bu==="input"&&(bt.type==="checkbox"||bt.type==="radio")){if(bt.checked){e.defaultChecked=e.checked=bt.checked}if(e.value!==bt.value){e.value=bt.value}}else{if(bu==="option"){e.selected=bt.defaultSelected}else{if(bu==="input"||bu==="textarea"){e.defaultValue=bt.defaultValue}}}}e.removeAttribute(b.expando)}b.buildFragment=function(bx,bv,bt){var bw,e,bu,by;if(bv&&bv[0]){by=bv[0].ownerDocument||bv[0]}if(!by.createDocumentFragment){by=ar}if(bx.length===1&&typeof bx[0]==="string"&&bx[0].length<512&&by===ar&&bx[0].charAt(0)==="<"&&!P.test(bx[0])&&(b.support.checkClone||!n.test(bx[0]))){e=true;bu=b.fragments[bx[0]];if(bu&&bu!==1){bw=bu}}if(!bw){bw=by.createDocumentFragment();b.clean(bx,by,bw,bt)}if(e){b.fragments[bx[0]]=bu?bw:1}return{fragment:bw,cacheable:e}};b.fragments={};b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,bt){b.fn[e]=function(bu){var bx=[],bA=b(bu),bz=this.length===1&&this[0].parentNode;if(bz&&bz.nodeType===11&&bz.childNodes.length===1&&bA.length===1){bA[bt](this[0]);return this}else{for(var by=0,bv=bA.length;by<bv;by++){var bw=(by>0?this.clone(true):this).get();b(bA[by])[bt](bw);bx=bx.concat(bw)}return this.pushStack(bx,e,bA.selector)}}});function bd(e){if("getElementsByTagName" in e){return e.getElementsByTagName("*")}else{if("querySelectorAll" in e){return e.querySelectorAll("*")}else{return[]}}}function aw(e){if(e.type==="checkbox"||e.type==="radio"){e.defaultChecked=e.checked}}function E(e){if(b.nodeName(e,"input")){aw(e)}else{if("getElementsByTagName" in e){b.grep(e.getElementsByTagName("input"),aw)}}}b.extend({clone:function(bw,by,bu){var bx=bw.cloneNode(true),e,bt,bv;if((!b.support.noCloneEvent||!b.support.noCloneChecked)&&(bw.nodeType===1||bw.nodeType===11)&&!b.isXMLDoc(bw)){af(bw,bx);e=bd(bw);bt=bd(bx);for(bv=0;e[bv];++bv){af(e[bv],bt[bv])}}if(by){t(bw,bx);if(bu){e=bd(bw);bt=bd(bx);for(bv=0;e[bv];++bv){t(e[bv],bt[bv])}}}e=bt=null;return bx},clean:function(bu,bw,bF,by){var bD;bw=bw||ar;if(typeof bw.createElement==="undefined"){bw=bw.ownerDocument||bw[0]&&bw[0].ownerDocument||ar}var bG=[],bz;for(var bC=0,bx;(bx=bu[bC])!=null;bC++){if(typeof bx==="number"){bx+=""}if(!bx){continue}if(typeof bx==="string"){if(!W.test(bx)){bx=bw.createTextNode(bx)}else{bx=bx.replace(T,"<$1></$2>");var bI=(d.exec(bx)||["",""])[1].toLowerCase(),bv=au[bI]||au._default,bB=bv[0],bt=bw.createElement("div");bt.innerHTML=bv[1]+bx+bv[2];while(bB--){bt=bt.lastChild}if(!b.support.tbody){var e=w.test(bx),bA=bI==="table"&&!e?bt.firstChild&&bt.firstChild.childNodes:bv[1]==="<table>"&&!e?bt.childNodes:[];for(bz=bA.length-1;bz>=0;--bz){if(b.nodeName(bA[bz],"tbody")&&!bA[bz].childNodes.length){bA[bz].parentNode.removeChild(bA[bz])}}}if(!b.support.leadingWhitespace&&ao.test(bx)){bt.insertBefore(bw.createTextNode(ao.exec(bx)[0]),bt.firstChild)}bx=bt.childNodes}}var bE;if(!b.support.appendChecked){if(bx[0]&&typeof(bE=bx.length)==="number"){for(bz=0;bz<bE;bz++){E(bx[bz])}}else{E(bx)}}if(bx.nodeType){bG.push(bx)}else{bG=b.merge(bG,bx)}}if(bF){bD=function(bJ){return !bJ.type||bk.test(bJ.type)};for(bC=0;bG[bC];bC++){if(by&&b.nodeName(bG[bC],"script")&&(!bG[bC].type||bG[bC].type.toLowerCase()==="text/javascript")){by.push(bG[bC].parentNode?bG[bC].parentNode.removeChild(bG[bC]):bG[bC])}else{if(bG[bC].nodeType===1){var bH=b.grep(bG[bC].getElementsByTagName("script"),bD);bG.splice.apply(bG,[bC+1,0].concat(bH))}bF.appendChild(bG[bC])}}}return bG},cleanData:function(bt){var bw,bu,e=b.cache,bB=b.expando,bz=b.event.special,by=b.support.deleteExpando;for(var bx=0,bv;(bv=bt[bx])!=null;bx++){if(bv.nodeName&&b.noData[bv.nodeName.toLowerCase()]){continue}bu=bv[b.expando];if(bu){bw=e[bu]&&e[bu][bB];if(bw&&bw.events){for(var bA in bw.events){if(bz[bA]){b.event.remove(bv,bA)}else{b.removeEvent(bv,bA,bw.handle)}}if(bw.handle){bw.handle.elem=null}}if(by){delete bv[b.expando]}else{if(bv.removeAttribute){bv.removeAttribute(b.expando)}}delete e[bu]}}}});function bn(e,bt){if(bt.src){b.ajax({url:bt.src,async:false,dataType:"script"})}else{b.globalEval((bt.text||bt.textContent||bt.innerHTML||"").replace(aK,"/*$0*/"))}if(bt.parentNode){bt.parentNode.removeChild(bt)}}var ai=/alpha\([^)]*\)/i,aq=/opacity=([^)]*)/,z=/([A-Z]|^ms)/g,bb=/^-?\d+(?:px)?$/i,bm=/^-?\d/,I=/^[+\-]=/,ah=/[^+\-\.\de]+/g,a5={position:"absolute",visibility:"hidden",display:"block"},ak=["Left","Right"],aZ=["Top","Bottom"],X,aF,aT;b.fn.css=function(e,bt){if(arguments.length===2&&bt===K){return this}return b.access(this,e,bt,true,function(bv,bu,bw){return bw!==K?b.style(bv,bu,bw):b.css(bv,bu)})};b.extend({cssHooks:{opacity:{get:function(bu,bt){if(bt){var e=X(bu,"opacity","opacity");return e===""?"1":e}else{return bu.style.opacity}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(bv,bu,bB,bw){if(!bv||bv.nodeType===3||bv.nodeType===8||!bv.style){return}var bz,bA,bx=b.camelCase(bu),bt=bv.style,bC=b.cssHooks[bx];bu=b.cssProps[bx]||bx;if(bB!==K){bA=typeof bB;if(bA==="number"&&isNaN(bB)||bB==null){return}if(bA==="string"&&I.test(bB)){bB=+bB.replace(ah,"")+parseFloat(b.css(bv,bu));bA="number"}if(bA==="number"&&!b.cssNumber[bx]){bB+="px"}if(!bC||!("set" in bC)||(bB=bC.set(bv,bB))!==K){try{bt[bu]=bB}catch(by){}}}else{if(bC&&"get" in bC&&(bz=bC.get(bv,false,bw))!==K){return bz}return bt[bu]}},css:function(bw,bv,bt){var bu,e;bv=b.camelCase(bv);e=b.cssHooks[bv];bv=b.cssProps[bv]||bv;if(bv==="cssFloat"){bv="float"}if(e&&"get" in e&&(bu=e.get(bw,true,bt))!==K){return bu}else{if(X){return X(bw,bv)}}},swap:function(bv,bu,bw){var e={};for(var bt in bu){e[bt]=bv.style[bt];bv.style[bt]=bu[bt]}bw.call(bv);for(bt in bu){bv.style[bt]=e[bt]}}});b.curCSS=b.css;b.each(["height","width"],function(bt,e){b.cssHooks[e]={get:function(bw,bv,bu){var bx;if(bv){if(bw.offsetWidth!==0){return o(bw,e,bu)}else{b.swap(bw,a5,function(){bx=o(bw,e,bu)})}return bx}},set:function(bu,bv){if(bb.test(bv)){bv=parseFloat(bv);if(bv>=0){return bv+"px"}}else{return bv}}}});if(!b.support.opacity){b.cssHooks.opacity={get:function(bt,e){return aq.test((e&&bt.currentStyle?bt.currentStyle.filter:bt.style.filter)||"")?(parseFloat(RegExp.$1)/100)+"":e?"1":""},set:function(bw,bx){var bv=bw.style,bt=bw.currentStyle;bv.zoom=1;var e=b.isNaN(bx)?"":"alpha(opacity="+bx*100+")",bu=bt&&bt.filter||bv.filter||"";bv.filter=ai.test(bu)?bu.replace(ai,e):bu+" "+e}}}b(function(){if(!b.support.reliableMarginRight){b.cssHooks.marginRight={get:function(bu,bt){var e;b.swap(bu,{display:"inline-block"},function(){if(bt){e=X(bu,"margin-right","marginRight")}else{e=bu.style.marginRight}});return e}}}});if(ar.defaultView&&ar.defaultView.getComputedStyle){aF=function(bw,bu){var bt,bv,e;bu=bu.replace(z,"-$1").toLowerCase();if(!(bv=bw.ownerDocument.defaultView)){return K}if((e=bv.getComputedStyle(bw,null))){bt=e.getPropertyValue(bu);if(bt===""&&!b.contains(bw.ownerDocument.documentElement,bw)){bt=b.style(bw,bu)}}return bt}}if(ar.documentElement.currentStyle){aT=function(bw,bu){var bx,bt=bw.currentStyle&&bw.currentStyle[bu],e=bw.runtimeStyle&&bw.runtimeStyle[bu],bv=bw.style;if(!bb.test(bt)&&bm.test(bt)){bx=bv.left;if(e){bw.runtimeStyle.left=bw.currentStyle.left}bv.left=bu==="fontSize"?"1em":(bt||0);bt=bv.pixelLeft+"px";bv.left=bx;if(e){bw.runtimeStyle.left=e}}return bt===""?"auto":bt}}X=aF||aT;function o(bu,bt,e){var bw=bt==="width"?bu.offsetWidth:bu.offsetHeight,bv=bt==="width"?ak:aZ;if(bw>0){if(e!=="border"){b.each(bv,function(){if(!e){bw-=parseFloat(b.css(bu,"padding"+this))||0}if(e==="margin"){bw+=parseFloat(b.css(bu,e+this))||0}else{bw-=parseFloat(b.css(bu,"border"+this+"Width"))||0}})}return bw+"px"}bw=X(bu,bt,bt);if(bw<0||bw==null){bw=bu.style[bt]||0}bw=parseFloat(bw)||0;if(e){b.each(bv,function(){bw+=parseFloat(b.css(bu,"padding"+this))||0;if(e!=="padding"){bw+=parseFloat(b.css(bu,"border"+this+"Width"))||0}if(e==="margin"){bw+=parseFloat(b.css(bu,e+this))||0}})}return bw+"px"}if(b.expr&&b.expr.filters){b.expr.filters.hidden=function(bu){var bt=bu.offsetWidth,e=bu.offsetHeight;return(bt===0&&e===0)||(!b.support.reliableHiddenOffsets&&(bu.style.display||b.css(bu,"display"))==="none")};b.expr.filters.visible=function(e){return !b.expr.filters.hidden(e)}}var j=/%20/g,am=/\[\]$/,br=/\r?\n/g,bp=/#.*$/,aA=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,aW=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,aJ=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/,aM=/^(?:GET|HEAD)$/,c=/^\/\//,M=/\?/,a4=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,q=/^(?:select|textarea)/i,h=/\s+/,bq=/([?&])_=[^&]*/,J=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,A=b.fn.load,Y={},r={},aB,s;try{aB=bj.href}catch(at){aB=ar.createElement("a");aB.href="";aB=aB.href}s=J.exec(aB.toLowerCase())||[];function f(e){return function(bw,by){if(typeof bw!=="string"){by=bw;bw="*"}if(b.isFunction(by)){var bv=bw.toLowerCase().split(h),bu=0,bx=bv.length,bt,bz,bA;for(;bu<bx;bu++){bt=bv[bu];bA=/^\+/.test(bt);if(bA){bt=bt.substr(1)||"*"}bz=e[bt]=e[bt]||[];bz[bA?"unshift":"push"](by)}}}}function aR(bt,bC,bx,bB,bz,bv){bz=bz||bC.dataTypes[0];bv=bv||{};bv[bz]=true;var by=bt[bz],bu=0,e=by?by.length:0,bw=(bt===Y),bA;for(;bu<e&&(bw||!bA);bu++){bA=by[bu](bC,bx,bB);if(typeof bA==="string"){if(!bw||bv[bA]){bA=K}else{bC.dataTypes.unshift(bA);bA=aR(bt,bC,bx,bB,bA,bv)}}}if((bw||!bA)&&!bv["*"]){bA=aR(bt,bC,bx,bB,"*",bv)}return bA}b.fn.extend({load:function(bu,bx,by){if(typeof bu!=="string"&&A){return A.apply(this,arguments)}else{if(!this.length){return this}}var bw=bu.indexOf(" ");if(bw>=0){var e=bu.slice(bw,bu.length);bu=bu.slice(0,bw)}var bv="GET";if(bx){if(b.isFunction(bx)){by=bx;bx=K}else{if(typeof bx==="object"){bx=b.param(bx,b.ajaxSettings.traditional);bv="POST"}}}var bt=this;b.ajax({url:bu,type:bv,dataType:"html",data:bx,complete:function(bA,bz,bB){bB=bA.responseText;if(bA.isResolved()){bA.done(function(bC){bB=bC});bt.html(e?b("<div>").append(bB.replace(a4,"")).find(e):bB)}if(by){bt.each(by,[bB,bz,bA])}}});return this},serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?b.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||q.test(this.nodeName)||aW.test(this.type))}).map(function(e,bt){var bu=b(this).val();return bu==null?null:b.isArray(bu)?b.map(bu,function(bw,bv){return{name:bt.name,value:bw.replace(br,"\r\n")}}):{name:bt.name,value:bu.replace(br,"\r\n")}}).get()}});b.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,bt){b.fn[bt]=function(bu){return this.bind(bt,bu)}});b.each(["get","post"],function(e,bt){b[bt]=function(bu,bw,bx,bv){if(b.isFunction(bw)){bv=bv||bx;bx=bw;bw=K}return b.ajax({type:bt,url:bu,data:bw,success:bx,dataType:bv})}});b.extend({getScript:function(e,bt){return b.get(e,K,bt,"script")},getJSON:function(e,bt,bu){return b.get(e,bt,bu,"json")},ajaxSetup:function(bu,e){if(!e){e=bu;bu=b.extend(true,b.ajaxSettings,e)}else{b.extend(true,bu,b.ajaxSettings,e)}for(var bt in {context:1,url:1}){if(bt in e){bu[bt]=e[bt]}else{if(bt in b.ajaxSettings){bu[bt]=b.ajaxSettings[bt]}}}return bu},ajaxSettings:{url:aB,isLocal:aJ.test(s[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":ba.String,"text html":true,"text json":b.parseJSON,"text xml":b.parseXML}},ajaxPrefilter:f(Y),ajaxTransport:f(r),ajax:function(bx,bv){if(typeof bx==="object"){bv=bx;bx=K}bv=bv||{};var bB=b.ajaxSetup({},bv),bQ=bB.context||bB,bE=bQ!==bB&&(bQ.nodeType||bQ instanceof b)?b(bQ):b.event,bP=b.Deferred(),bL=b._Deferred(),bz=bB.statusCode||{},bA,bF={},bM={},bO,bw,bJ,bC,bG,by=0,bu,bI,bH={readyState:0,setRequestHeader:function(bR,bS){if(!by){var e=bR.toLowerCase();bR=bM[e]=bM[e]||bR;bF[bR]=bS}return this},getAllResponseHeaders:function(){return by===2?bO:null},getResponseHeader:function(bR){var e;if(by===2){if(!bw){bw={};while((e=aA.exec(bO))){bw[e[1].toLowerCase()]=e[2]}}e=bw[bR.toLowerCase()]}return e===K?null:e},overrideMimeType:function(e){if(!by){bB.mimeType=e}return this},abort:function(e){e=e||"abort";if(bJ){bJ.abort(e)}bD(0,e);return this}};function bD(bW,bU,bX,bT){if(by===2){return}by=2;if(bC){clearTimeout(bC)}bJ=K;bO=bT||"";bH.readyState=bW?4:0;var bR,b1,b0,bV=bX?bh(bB,bH,bX):K,bS,bZ;if(bW>=200&&bW<300||bW===304){if(bB.ifModified){if((bS=bH.getResponseHeader("Last-Modified"))){b.lastModified[bA]=bS}if((bZ=bH.getResponseHeader("Etag"))){b.etag[bA]=bZ}}if(bW===304){bU="notmodified";bR=true}else{try{b1=F(bB,bV);bU="success";bR=true}catch(bY){bU="parsererror";b0=bY}}}else{b0=bU;if(!bU||bW){bU="error";if(bW<0){bW=0}}}bH.status=bW;bH.statusText=bU;if(bR){bP.resolveWith(bQ,[b1,bU,bH])}else{bP.rejectWith(bQ,[bH,bU,b0])}bH.statusCode(bz);bz=K;if(bu){bE.trigger("ajax"+(bR?"Success":"Error"),[bH,bB,bR?b1:b0])}bL.resolveWith(bQ,[bH,bU]);if(bu){bE.trigger("ajaxComplete",[bH,bB]);if(!(--b.active)){b.event.trigger("ajaxStop")}}}bP.promise(bH);bH.success=bH.done;bH.error=bH.fail;bH.complete=bL.done;bH.statusCode=function(bR){if(bR){var e;if(by<2){for(e in bR){bz[e]=[bz[e],bR[e]]}}else{e=bR[bH.status];bH.then(e,e)}}return this};bB.url=((bx||bB.url)+"").replace(bp,"").replace(c,s[1]+"//");bB.dataTypes=b.trim(bB.dataType||"*").toLowerCase().split(h);if(bB.crossDomain==null){bG=J.exec(bB.url.toLowerCase());bB.crossDomain=!!(bG&&(bG[1]!=s[1]||bG[2]!=s[2]||(bG[3]||(bG[1]==="http:"?80:443))!=(s[3]||(s[1]==="http:"?80:443))))}if(bB.data&&bB.processData&&typeof bB.data!=="string"){bB.data=b.param(bB.data,bB.traditional)}aR(Y,bB,bv,bH);if(by===2){return false}bu=bB.global;bB.type=bB.type.toUpperCase();bB.hasContent=!aM.test(bB.type);if(bu&&b.active++===0){b.event.trigger("ajaxStart")}if(!bB.hasContent){if(bB.data){bB.url+=(M.test(bB.url)?"&":"?")+bB.data}bA=bB.url;if(bB.cache===false){var bt=b.now(),bN=bB.url.replace(bq,"$1_="+bt);bB.url=bN+((bN===bB.url)?(M.test(bB.url)?"&":"?")+"_="+bt:"")}}if(bB.data&&bB.hasContent&&bB.contentType!==false||bv.contentType){bH.setRequestHeader("Content-Type",bB.contentType)}if(bB.ifModified){bA=bA||bB.url;if(b.lastModified[bA]){bH.setRequestHeader("If-Modified-Since",b.lastModified[bA])}if(b.etag[bA]){bH.setRequestHeader("If-None-Match",b.etag[bA])}}bH.setRequestHeader("Accept",bB.dataTypes[0]&&bB.accepts[bB.dataTypes[0]]?bB.accepts[bB.dataTypes[0]]+(bB.dataTypes[0]!=="*"?", */*; q=0.01":""):bB.accepts["*"]);for(bI in bB.headers){bH.setRequestHeader(bI,bB.headers[bI])}if(bB.beforeSend&&(bB.beforeSend.call(bQ,bH,bB)===false||by===2)){bH.abort();return false}for(bI in {success:1,error:1,complete:1}){bH[bI](bB[bI])}bJ=aR(r,bB,bv,bH);if(!bJ){bD(-1,"No Transport")}else{bH.readyState=1;if(bu){bE.trigger("ajaxSend",[bH,bB])}if(bB.async&&bB.timeout>0){bC=setTimeout(function(){bH.abort("timeout")},bB.timeout)}try{by=1;bJ.send(bF,bD)}catch(bK){if(status<2){bD(-1,bK)}else{b.error(bK)}}}return bH},param:function(e,bu){var bt=[],bw=function(bx,by){by=b.isFunction(by)?by():by;bt[bt.length]=encodeURIComponent(bx)+"="+encodeURIComponent(by)};if(bu===K){bu=b.ajaxSettings.traditional}if(b.isArray(e)||(e.jquery&&!b.isPlainObject(e))){b.each(e,function(){bw(this.name,this.value)})}else{for(var bv in e){v(bv,e[bv],bu,bw)}}return bt.join("&").replace(j,"+")}});function v(bu,bw,bt,bv){if(b.isArray(bw)){b.each(bw,function(by,bx){if(bt||am.test(bu)){bv(bu,bx)}else{v(bu+"["+(typeof bx==="object"||b.isArray(bx)?by:"")+"]",bx,bt,bv)}})}else{if(!bt&&bw!=null&&typeof bw==="object"){for(var e in bw){v(bu+"["+e+"]",bw[e],bt,bv)}}else{bv(bu,bw)}}}b.extend({active:0,lastModified:{},etag:{}});function bh(bB,bA,bx){var bt=bB.contents,bz=bB.dataTypes,bu=bB.responseFields,bw,by,bv,e;for(by in bu){if(by in bx){bA[bu[by]]=bx[by]}}while(bz[0]==="*"){bz.shift();if(bw===K){bw=bB.mimeType||bA.getResponseHeader("content-type")}}if(bw){for(by in bt){if(bt[by]&&bt[by].test(bw)){bz.unshift(by);break}}}if(bz[0] in bx){bv=bz[0]}else{for(by in bx){if(!bz[0]||bB.converters[by+" "+bz[0]]){bv=by;break}if(!e){e=by}}bv=bv||e}if(bv){if(bv!==bz[0]){bz.unshift(bv)}return bx[bv]}}function F(bF,bx){if(bF.dataFilter){bx=bF.dataFilter(bx,bF.dataType)}var bB=bF.dataTypes,bE={},by,bC,bu=bB.length,bz,bA=bB[0],bv,bw,bD,bt,e;for(by=1;by<bu;by++){if(by===1){for(bC in bF.converters){if(typeof bC==="string"){bE[bC.toLowerCase()]=bF.converters[bC]}}}bv=bA;bA=bB[by];if(bA==="*"){bA=bv}else{if(bv!=="*"&&bv!==bA){bw=bv+" "+bA;bD=bE[bw]||bE["* "+bA];if(!bD){e=K;for(bt in bE){bz=bt.split(" ");if(bz[0]===bv||bz[0]==="*"){e=bE[bz[1]+" "+bA];if(e){bt=bE[bt];if(bt===true){bD=e}else{if(e===true){bD=bt}}break}}}}if(!(bD||e)){b.error("No conversion from "+bw.replace(" "," to "))}if(bD!==true){bx=bD?bD(bx):e(bt(bx))}}}}return bx}var az=b.now(),u=/(\=)\?(&|$)|\?\?/i;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return b.expando+"_"+(az++)}});b.ajaxPrefilter("json jsonp",function(bB,by,bA){var bv=bB.contentType==="application/x-www-form-urlencoded"&&(typeof bB.data==="string");if(bB.dataTypes[0]==="jsonp"||bB.jsonp!==false&&(u.test(bB.url)||bv&&u.test(bB.data))){var bz,bu=bB.jsonpCallback=b.isFunction(bB.jsonpCallback)?bB.jsonpCallback():bB.jsonpCallback,bx=ba[bu],e=bB.url,bw=bB.data,bt="$1"+bu+"$2";if(bB.jsonp!==false){e=e.replace(u,bt);if(bB.url===e){if(bv){bw=bw.replace(u,bt)}if(bB.data===bw){e+=(/\?/.test(e)?"&":"?")+bB.jsonp+"="+bu}}}bB.url=e;bB.data=bw;ba[bu]=function(bC){bz=[bC]};bA.always(function(){ba[bu]=bx;if(bz&&b.isFunction(bx)){ba[bu](bz[0])}});bB.converters["script json"]=function(){if(!bz){b.error(bu+" was not called")}return bz[0]};bB.dataTypes[0]="json";return"script"}});b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){b.globalEval(e);return e}}});b.ajaxPrefilter("script",function(e){if(e.cache===K){e.cache=false}if(e.crossDomain){e.type="GET";e.global=false}});b.ajaxTransport("script",function(bu){if(bu.crossDomain){var e,bt=ar.head||ar.getElementsByTagName("head")[0]||ar.documentElement;return{send:function(bv,bw){e=ar.createElement("script");e.async="async";if(bu.scriptCharset){e.charset=bu.scriptCharset}e.src=bu.url;e.onload=e.onreadystatechange=function(by,bx){if(bx||!e.readyState||/loaded|complete/.test(e.readyState)){e.onload=e.onreadystatechange=null;if(bt&&e.parentNode){bt.removeChild(e)}e=K;if(!bx){bw(200,"success")}}};bt.insertBefore(e,bt.firstChild)},abort:function(){if(e){e.onload(0,1)}}}}});var B=ba.ActiveXObject?function(){for(var e in N){N[e](0,1)}}:false,y=0,N;function aI(){try{return new ba.XMLHttpRequest()}catch(bt){}}function ag(){try{return new ba.ActiveXObject("Microsoft.XMLHTTP")}catch(bt){}}b.ajaxSettings.xhr=ba.ActiveXObject?function(){return !this.isLocal&&aI()||ag()}:aI;(function(e){b.extend(b.support,{ajax:!!e,cors:!!e&&("withCredentials" in e)})})(b.ajaxSettings.xhr());if(b.support.ajax){b.ajaxTransport(function(e){if(!e.crossDomain||b.support.cors){var bt;return{send:function(bz,bu){var by=e.xhr(),bx,bw;if(e.username){by.open(e.type,e.url,e.async,e.username,e.password)}else{by.open(e.type,e.url,e.async)}if(e.xhrFields){for(bw in e.xhrFields){by[bw]=e.xhrFields[bw]}}if(e.mimeType&&by.overrideMimeType){by.overrideMimeType(e.mimeType)}if(!e.crossDomain&&!bz["X-Requested-With"]){bz["X-Requested-With"]="XMLHttpRequest"}try{for(bw in bz){by.setRequestHeader(bw,bz[bw])}}catch(bv){}by.send((e.hasContent&&e.data)||null);bt=function(bI,bC){var bD,bB,bA,bG,bF;try{if(bt&&(bC||by.readyState===4)){bt=K;if(bx){by.onreadystatechange=b.noop;if(B){delete N[bx]}}if(bC){if(by.readyState!==4){by.abort()}}else{bD=by.status;bA=by.getAllResponseHeaders();bG={};bF=by.responseXML;if(bF&&bF.documentElement){bG.xml=bF}bG.text=by.responseText;try{bB=by.statusText}catch(bH){bB=""}if(!bD&&e.isLocal&&!e.crossDomain){bD=bG.text?200:404}else{if(bD===1223){bD=204}}}}}catch(bE){if(!bC){bu(-1,bE)}}if(bG){bu(bD,bB,bG,bA)}};if(!e.async||by.readyState===4){bt()}else{bx=++y;if(B){if(!N){N={};b(ba).unload(B)}N[bx]=bt}by.onreadystatechange=bt}},abort:function(){if(bt){bt(0,1)}}}}})}var R={},a7,m,ay=/^(?:toggle|show|hide)$/,aO=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,a0,aE=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],a2,S=ba.webkitRequestAnimationFrame||ba.mozRequestAnimationFrame||ba.oRequestAnimationFrame;b.fn.extend({show:function(bv,by,bx){var bu,bw;if(bv||bv===0){return this.animate(aY("show",3),bv,by,bx)}else{for(var bt=0,e=this.length;bt<e;bt++){bu=this[bt];if(bu.style){bw=bu.style.display;if(!b._data(bu,"olddisplay")&&bw==="none"){bw=bu.style.display=""}if(bw===""&&b.css(bu,"display")==="none"){b._data(bu,"olddisplay",x(bu.nodeName))}}}for(bt=0;bt<e;bt++){bu=this[bt];if(bu.style){bw=bu.style.display;if(bw===""||bw==="none"){bu.style.display=b._data(bu,"olddisplay")||""}}}return this}},hide:function(bu,bx,bw){if(bu||bu===0){return this.animate(aY("hide",3),bu,bx,bw)}else{for(var bt=0,e=this.length;bt<e;bt++){if(this[bt].style){var bv=b.css(this[bt],"display");if(bv!=="none"&&!b._data(this[bt],"olddisplay")){b._data(this[bt],"olddisplay",bv)}}}for(bt=0;bt<e;bt++){if(this[bt].style){this[bt].style.display="none"}}return this}},_toggle:b.fn.toggle,toggle:function(bu,bt,bv){var e=typeof bu==="boolean";if(b.isFunction(bu)&&b.isFunction(bt)){this._toggle.apply(this,arguments)}else{if(bu==null||e){this.each(function(){var bw=e?bu:b(this).is(":hidden");b(this)[bw?"show":"hide"]()})}else{this.animate(aY("toggle",3),bu,bt,bv)}}return this},fadeTo:function(e,bv,bu,bt){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:bv},e,bu,bt)},animate:function(bw,bt,bv,bu){var e=b.speed(bt,bv,bu);if(b.isEmptyObject(bw)){return this.each(e.complete,[false])}bw=b.extend({},bw);return this[e.queue===false?"each":"queue"](function(){if(e.queue===false){b._mark(this)}var bA=b.extend({},e),bH=this.nodeType===1,bE=bH&&b(this).is(":hidden"),bx,bB,bz,bG,bF,bD,by,bC,bI;bA.animatedProperties={};for(bz in bw){bx=b.camelCase(bz);if(bz!==bx){bw[bx]=bw[bz];delete bw[bz]}bB=bw[bx];if(b.isArray(bB)){bA.animatedProperties[bx]=bB[1];bB=bw[bx]=bB[0]}else{bA.animatedProperties[bx]=bA.specialEasing&&bA.specialEasing[bx]||bA.easing||"swing"}if(bB==="hide"&&bE||bB==="show"&&!bE){return bA.complete.call(this)}if(bH&&(bx==="height"||bx==="width")){bA.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(b.css(this,"display")==="inline"&&b.css(this,"float")==="none"){if(!b.support.inlineBlockNeedsLayout){this.style.display="inline-block"}else{bG=x(this.nodeName);if(bG==="inline"){this.style.display="inline-block"}else{this.style.display="inline";this.style.zoom=1}}}}}if(bA.overflow!=null){this.style.overflow="hidden"}for(bz in bw){bF=new b.fx(this,bA,bz);bB=bw[bz];if(ay.test(bB)){bF[bB==="toggle"?bE?"show":"hide":bB]()}else{bD=aO.exec(bB);by=bF.cur();if(bD){bC=parseFloat(bD[2]);bI=bD[3]||(b.cssNumber[bz]?"":"px");if(bI!=="px"){b.style(this,bz,(bC||1)+bI);by=((bC||1)/bF.cur())*by;b.style(this,bz,by+bI)}if(bD[1]){bC=((bD[1]==="-="?-1:1)*bC)+by}bF.custom(by,bC,bI)}else{bF.custom(by,bB,"")}}}return true})},stop:function(bt,e){if(bt){this.queue([])}this.each(function(){var bv=b.timers,bu=bv.length;if(!e){b._unmark(true,this)}while(bu--){if(bv[bu].elem===this){if(e){bv[bu](true)}bv.splice(bu,1)}}});if(!e){this.dequeue()}return this}});function be(){setTimeout(ap,0);return(a2=b.now())}function ap(){a2=K}function aY(bt,e){var bu={};b.each(aE.concat.apply([],aE.slice(0,e)),function(){bu[this]=bt});return bu}b.each({slideDown:aY("show",1),slideUp:aY("hide",1),slideToggle:aY("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,bt){b.fn[e]=function(bu,bw,bv){return this.animate(bt,bu,bw,bv)}});b.extend({speed:function(bu,bv,bt){var e=bu&&typeof bu==="object"?b.extend({},bu):{complete:bt||!bt&&bv||b.isFunction(bu)&&bu,duration:bu,easing:bt&&bv||bv&&!b.isFunction(bv)&&bv};e.duration=b.fx.off?0:typeof e.duration==="number"?e.duration:e.duration in b.fx.speeds?b.fx.speeds[e.duration]:b.fx.speeds._default;e.old=e.complete;e.complete=function(bw){if(b.isFunction(e.old)){e.old.call(this)}if(e.queue!==false){b.dequeue(this)}else{if(bw!==false){b._unmark(this)}}};return e},easing:{linear:function(bu,bv,e,bt){return e+bt*bu},swing:function(bu,bv,e,bt){return((-Math.cos(bu*Math.PI)/2)+0.5)*bt+e}},timers:[],fx:function(bt,e,bu){this.options=e;this.elem=bt;this.prop=bu;e.orig=e.orig||{}}});b.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(b.fx.step[this.prop]||b.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var e,bt=b.css(this.elem,this.prop);return isNaN(e=parseFloat(bt))?!bt||bt==="auto"?0:bt:e},custom:function(by,bx,bv){var e=this,bu=b.fx,bw;this.startTime=a2||be();this.start=by;this.end=bx;this.unit=bv||this.unit||(b.cssNumber[this.prop]?"":"px");this.now=this.start;this.pos=this.state=0;function bt(bz){return e.step(bz)}bt.elem=this.elem;if(bt()&&b.timers.push(bt)&&!a0){if(S){a0=true;bw=function(){if(a0){S(bw);bu.tick()}};S(bw)}else{a0=setInterval(bu.tick,bu.interval)}}},show:function(){this.options.orig[this.prop]=b.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());b(this.elem).show()},hide:function(){this.options.orig[this.prop]=b.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(bw){var bv=a2||be(),e=true,bx=this.elem,bt=this.options,bu,bz;if(bw||bv>=bt.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();bt.animatedProperties[this.prop]=true;for(bu in bt.animatedProperties){if(bt.animatedProperties[bu]!==true){e=false}}if(e){if(bt.overflow!=null&&!b.support.shrinkWrapBlocks){b.each(["","X","Y"],function(bA,bB){bx.style["overflow"+bB]=bt.overflow[bA]})}if(bt.hide){b(bx).hide()}if(bt.hide||bt.show){for(var by in bt.animatedProperties){b.style(bx,by,bt.orig[by])}}bt.complete.call(bx)}return false}else{if(bt.duration==Infinity){this.now=bv}else{bz=bv-this.startTime;this.state=bz/bt.duration;this.pos=b.easing[bt.animatedProperties[this.prop]](this.state,bz,0,1,bt.duration);this.now=this.start+((this.end-this.start)*this.pos)}this.update()}return true}};b.extend(b.fx,{tick:function(){for(var bt=b.timers,e=0;e<bt.length;++e){if(!bt[e]()){bt.splice(e--,1)}}if(!bt.length){b.fx.stop()}},interval:13,stop:function(){clearInterval(a0);a0=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){b.style(e.elem,"opacity",e.now)},_default:function(e){if(e.elem.style&&e.elem.style[e.prop]!=null){e.elem.style[e.prop]=(e.prop==="width"||e.prop==="height"?Math.max(0,e.now):e.now)+e.unit}else{e.elem[e.prop]=e.now}}}});if(b.expr&&b.expr.filters){b.expr.filters.animated=function(e){return b.grep(b.timers,function(bt){return e===bt.elem}).length}}function x(bv){if(!R[bv]){var e=ar.body,bt=b("<"+bv+">").appendTo(e),bu=bt.css("display");bt.remove();if(bu==="none"||bu===""){if(!a7){a7=ar.createElement("iframe");a7.frameBorder=a7.width=a7.height=0}e.appendChild(a7);if(!m||!a7.createElement){m=(a7.contentWindow||a7.contentDocument).document;m.write((ar.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");m.close()}bt=m.createElement(bv);m.body.appendChild(bt);bu=b.css(bt,"display");e.removeChild(a7)}R[bv]=bu}return R[bv]}var V=/^t(?:able|d|h)$/i,ab=/^(?:body|html)$/i;if("getBoundingClientRect" in ar.documentElement){b.fn.offset=function(bG){var bw=this[0],bz;if(bG){return this.each(function(e){b.offset.setOffset(this,bG,e)})}if(!bw||!bw.ownerDocument){return null}if(bw===bw.ownerDocument.body){return b.offset.bodyOffset(bw)}try{bz=bw.getBoundingClientRect()}catch(bD){}var bF=bw.ownerDocument,bu=bF.documentElement;if(!bz||!b.contains(bu,bw)){return bz?{top:bz.top,left:bz.left}:{top:0,left:0}}var bA=bF.body,bB=aH(bF),by=bu.clientTop||bA.clientTop||0,bC=bu.clientLeft||bA.clientLeft||0,bt=bB.pageYOffset||b.support.boxModel&&bu.scrollTop||bA.scrollTop,bx=bB.pageXOffset||b.support.boxModel&&bu.scrollLeft||bA.scrollLeft,bE=bz.top+bt-by,bv=bz.left+bx-bC;return{top:bE,left:bv}}}else{b.fn.offset=function(bD){var bx=this[0];if(bD){return this.each(function(bE){b.offset.setOffset(this,bD,bE)})}if(!bx||!bx.ownerDocument){return null}if(bx===bx.ownerDocument.body){return b.offset.bodyOffset(bx)}b.offset.initialize();var bA,bu=bx.offsetParent,bt=bx,bC=bx.ownerDocument,bv=bC.documentElement,by=bC.body,bz=bC.defaultView,e=bz?bz.getComputedStyle(bx,null):bx.currentStyle,bB=bx.offsetTop,bw=bx.offsetLeft;while((bx=bx.parentNode)&&bx!==by&&bx!==bv){if(b.offset.supportsFixedPosition&&e.position==="fixed"){break}bA=bz?bz.getComputedStyle(bx,null):bx.currentStyle;bB-=bx.scrollTop;bw-=bx.scrollLeft;if(bx===bu){bB+=bx.offsetTop;bw+=bx.offsetLeft;if(b.offset.doesNotAddBorder&&!(b.offset.doesAddBorderForTableAndCells&&V.test(bx.nodeName))){bB+=parseFloat(bA.borderTopWidth)||0;bw+=parseFloat(bA.borderLeftWidth)||0}bt=bu;bu=bx.offsetParent}if(b.offset.subtractsBorderForOverflowNotVisible&&bA.overflow!=="visible"){bB+=parseFloat(bA.borderTopWidth)||0;bw+=parseFloat(bA.borderLeftWidth)||0}e=bA}if(e.position==="relative"||e.position==="static"){bB+=by.offsetTop;bw+=by.offsetLeft}if(b.offset.supportsFixedPosition&&e.position==="fixed"){bB+=Math.max(bv.scrollTop,by.scrollTop);bw+=Math.max(bv.scrollLeft,by.scrollLeft)}return{top:bB,left:bw}}}b.offset={initialize:function(){var e=ar.body,bt=ar.createElement("div"),bw,by,bx,bz,bu=parseFloat(b.css(e,"marginTop"))||0,bv="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";b.extend(bt.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});bt.innerHTML=bv;e.insertBefore(bt,e.firstChild);bw=bt.firstChild;by=bw.firstChild;bz=bw.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(by.offsetTop!==5);this.doesAddBorderForTableAndCells=(bz.offsetTop===5);by.style.position="fixed";by.style.top="20px";this.supportsFixedPosition=(by.offsetTop===20||by.offsetTop===15);by.style.position=by.style.top="";bw.style.overflow="hidden";bw.style.position="relative";this.subtractsBorderForOverflowNotVisible=(by.offsetTop===-5);this.doesNotIncludeMarginInBodyOffset=(e.offsetTop!==bu);e.removeChild(bt);b.offset.initialize=b.noop},bodyOffset:function(e){var bu=e.offsetTop,bt=e.offsetLeft;b.offset.initialize();if(b.offset.doesNotIncludeMarginInBodyOffset){bu+=parseFloat(b.css(e,"marginTop"))||0;bt+=parseFloat(b.css(e,"marginLeft"))||0}return{top:bu,left:bt}},setOffset:function(bv,bE,by){var bz=b.css(bv,"position");if(bz==="static"){bv.style.position="relative"}var bx=b(bv),bt=bx.offset(),e=b.css(bv,"top"),bC=b.css(bv,"left"),bD=(bz==="absolute"||bz==="fixed")&&b.inArray("auto",[e,bC])>-1,bB={},bA={},bu,bw;if(bD){bA=bx.position();bu=bA.top;bw=bA.left}else{bu=parseFloat(e)||0;bw=parseFloat(bC)||0}if(b.isFunction(bE)){bE=bE.call(bv,by,bt)}if(bE.top!=null){bB.top=(bE.top-bt.top)+bu}if(bE.left!=null){bB.left=(bE.left-bt.left)+bw}if("using" in bE){bE.using.call(bv,bB)}else{bx.css(bB)}}};b.fn.extend({position:function(){if(!this[0]){return null}var bu=this[0],bt=this.offsetParent(),bv=this.offset(),e=ab.test(bt[0].nodeName)?{top:0,left:0}:bt.offset();bv.top-=parseFloat(b.css(bu,"marginTop"))||0;bv.left-=parseFloat(b.css(bu,"marginLeft"))||0;e.top+=parseFloat(b.css(bt[0],"borderTopWidth"))||0;e.left+=parseFloat(b.css(bt[0],"borderLeftWidth"))||0;return{top:bv.top-e.top,left:bv.left-e.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||ar.body;while(e&&(!ab.test(e.nodeName)&&b.css(e,"position")==="static")){e=e.offsetParent}return e})}});b.each(["Left","Top"],function(bt,e){var bu="scroll"+e;b.fn[bu]=function(bx){var bv,bw;if(bx===K){bv=this[0];if(!bv){return null}bw=aH(bv);return bw?("pageXOffset" in bw)?bw[bt?"pageYOffset":"pageXOffset"]:b.support.boxModel&&bw.document.documentElement[bu]||bw.document.body[bu]:bv[bu]}return this.each(function(){bw=aH(this);if(bw){bw.scrollTo(!bt?bx:b(bw).scrollLeft(),bt?bx:b(bw).scrollTop())}else{this[bu]=bx}})}});function aH(e){return b.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:false}b.each(["Height","Width"],function(bt,e){var bu=e.toLowerCase();b.fn["inner"+e]=function(){var bv=this[0];return bv&&bv.style?parseFloat(b.css(bv,bu,"padding")):null};b.fn["outer"+e]=function(bw){var bv=this[0];return bv&&bv.style?parseFloat(b.css(bv,bu,bw?"margin":"border")):null};b.fn[bu]=function(bw){var bx=this[0];if(!bx){return bw==null?null:this}if(b.isFunction(bw)){return this.each(function(bB){var bA=b(this);bA[bu](bw.call(this,bB,bA[bu]()))})}if(b.isWindow(bx)){var by=bx.document.documentElement["client"+e];return bx.document.compatMode==="CSS1Compat"&&by||bx.document.body["client"+e]||by}else{if(bx.nodeType===9){return Math.max(bx.documentElement["client"+e],bx.body["scroll"+e],bx.documentElement["scroll"+e],bx.body["offset"+e],bx.documentElement["offset"+e])}else{if(bw===K){var bz=b.css(bx,bu),bv=parseFloat(bz);return b.isNaN(bv)?bz:bv}else{return this.css(bu,typeof bw==="string"?bw:bw+"px")}}}}});ba.jQuery=ba.$=b})(window);jQuery.Buffer=function(){var b=function(c){if(c){this.assign(c)}this._bufferedCommandList=[];this._bufferedCommands={}};b._buffers=[];b._pool=[];b.bufferForElement=function(c){if(c._jquery_buffer){return c._jquery_buffer}return this.bufferFromPool().assign(c)};b.bufferFromPool=function(){var c=null;if(this._pool.length===0){c=new b()}else{c=this._pool.pop()}b._buffers.push(c);if(!this.flushingScheduled){this.scheduleFlushing()}return c};b.returnToPool=function(c){c.unassign();this._pool.push(c)};b.scheduleFlushing=function(){this.flushingScheduled=true};b.flush=function(){var e=this._buffers,d,c=e.length;for(d=0;d<c;d++){e[d].flush();this.returnToPool(e[d])}this._buffers=[];this.flushingScheduled=false};b.prototype.assign=function(c){if(this._el){this.unassign()}this._el=c;this._el._jquery_buffer=this;return this};b.prototype.unassign=function(){if(!this._el){return}this._el._jquery_buffer=undefined;this._el=undefined;return this};b.prototype.flush=function(){var f=this._bufferedCommandList,e=f.length,d,g;for(d=0;d<e;d++){g=f[d];this[g](this._bufferedCommands[g]);delete this._bufferedCommands[g]}this._bufferedCommandList.length=0;this.unassign()};b.prototype.$=function(c,d){if(!d){d=this._el}if(c===""||c===undefined){c=d;d=undefined}return jQuery(c,d)};b.prototype.bufferedCommand=function(c){if(!this._bufferedCommands[c]){this._bufferedCommands[c]={};this._bufferedCommandList.push(c)}return this._bufferedCommands[c]};b.prototype.hasBufferedCommand=function(c){return !!this._bufferedCommands[c]};b.prototype.html=function(d){var c=this.bufferedCommand("flushContent");if(d===undefined){return c.text||c.html||this.$().html()}c.text=undefined;c.html=d};b.prototype.text=function(d){var c=this.bufferedCommand("flushContent");if(d===undefined){return c.text||c.html||this.$().text()}c.text=d;c.html=undefined};b.prototype.flushContent=function(c){if(c.text!==undefined){this.$().text(c.text)}else{if(c.html!==undefined){this.$().html(c.html)}}};b.prototype.attr=function(f,g){if(typeof f==="object"){for(var d in f){this.attr(d,f[d])}return}if(f==="class"){if(g===undefined){return this.setClass().join(" ")}else{if(typeof g==="string"||jQuery.isArray(g)){var c=this.bufferedCommand("flushClassNames");c.classNames=this._hashFromClassNames(g);return}else{return this.setClass(g)}}}else{if(f==="html"){return this.html(g)}else{if(f==="text"){return this.text(g)}else{if(f==="style"){return this.resetStyles(g)}}}}var e=this.bufferedCommand("flushAttributes");if(!e.attr){e.attr={}}e.attr[f]=g};b.prototype.flushAttributes=function(f){var c=f.attr,g=this.$(),d;for(var e in c){if(!c.hasOwnProperty(e)){continue}d=c[e];if(d!==null){g.attr(e,d)}else{g.removeAttr(e)}}};b.prototype._STYLE_REGEX=/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g;b.prototype._camelizeStyleName=function(c){var d=c.match(/^-(webkit|moz|o)-/),e=c.camelize();if(d){return e.substr(0,1).toUpperCase()+e.substr(1)}else{return e}};b.prototype._dasherizeStyleName=function(c){var d=SC.String.dasherize(c);if(d.match(/^(webkit|moz|ms|o)-/)){d="-"+d}return d};b.prototype._loadStyles=function(c){if(!c){c=this.$().attr("style")}if(c&&(c=c.toString()).length>0){if(SC.browser.isIE){c=c.toLowerCase()}var f={};var e=this._STYLE_REGEX,d;e.lastIndex=0;while(d=e.exec(c)){f[this._camelizeStyleName(d[1])]=d[2]}return f}else{return{}}};b.prototype.resetStyles=function(d){var c=this.bufferedCommand("flushStyles");c._styles=this._loadStyles(d||" ")};b.prototype.styles=function(){var c=this.bufferedCommand("flushStyles");if(!c._styles){c._styles=this._loadStyles()}return c._styles};b.prototype.css=function(e,f){if(typeof e==="object"){for(var c in e){this.css(c,e[c])}return}var d=this.bufferedCommand("flushStyles");if(!d._styles){d._styles=this._loadStyles()}d._styles[e]=f};b.prototype.flushStyles=function(e){var g=e._styles;var i="";var d,h,f=[],c=0;for(d in g){if(!g.hasOwnProperty(d)){continue}h=g[d];if(h===null){continue}if(typeof h==="number"&&d!=="zIndex"&&d!=="fontWeight"&&d!=="opacity"){h+="px"}f[c++]=this._dasherizeStyleName(d)+": "+h}this.$().attr("style",f.join("; "))};b.prototype._hashFromClassNames=function(f){if(typeof f==="string"){f=f.split(" ")}var d,c=f.length,e={};for(d=0;d<c;d++){e[f[d]]=true}return e};b.prototype.setClass=function(g,c){var f=this.bufferedCommand("flushClassNames"),e;if(g===undefined){if(!f.classNames){f.classNames=this._hashFromClassNames(this._el.className)}var h=f.classNames,d=[];for(e in h){if(e&&h[e]){d.push(e)}}return d}if(typeof g==="object"){if(!f.classNames){f.classNames=this._hashFromClassNames(this._el.className)}for(e in g){f.classNames[e]=g[e]}return}if(!f.classNames){f.classNames=this._hashFromClassNames(this._el.className)}f.classNames[g]=c||false};b.prototype.hasClass=function(d){var c=this.bufferedCommand("flushClassNames");if(!c.classNames){c.classNames=this._hashFromClassNames(this._el.className)}return !!c.classNames[d]};b.prototype.addClass=function(f){if(!f){return}var e=this.bufferedCommand("flushClassNames");if(!e.classNames){e.classNames=this._hashFromClassNames(this._el.className)}if(typeof f==="string"){f=f.split(" ")}var d,c=f.length;for(d=0;d<c;d++){e.classNames[jQuery.trim(f[d])]=true}};b.prototype.removeClass=function(d){var c=this.bufferedCommand("flushClassNames");if(d===undefined){c.classNames={}}else{if(!c.classNames){c.classNames=this._hashFromClassNames(this._el.className)}c.classNames[d]=false}};b.prototype.resetClassNames=function(d){var c=this.bufferedCommand("flushClassNames");c.classNames={}};b.prototype.flushClassNames=function(e){var f=[];var g=e.classNames,d;for(d in g){if(g[d]){f.push(d)}}this.$().attr("class",f.join(" "))};function a(d){for(var c in d){if(typeof d[c]==="function"){d[c].displayName=c}}}a(b);a(b.prototype);return b}();(function(){jQuery.buffer=jQuery.bufferedJQuery=jQuery.sub();jQuery.bufferedJQuery.fn.extend({html:function(d){if(d===undefined){if(this.length<1){return undefined}return jQuery.Buffer.bufferForElement(this[0]).html()}var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.html(d)}return this},text:function(d){if(d===undefined){if(this.length<1){return undefined}return jQuery.Buffer.bufferForElement(this[0]).text()}var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.text(d)}return this},attr:function(d,e){var b;if(typeof e==="undefined"&&typeof d==="string"){if(this.length<1){return false}b=jQuery.Buffer.bufferForElement(this[0]);return b.attr(d)}var a=this.length,c;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.attr(d,e)}return this},hasClass:function(a){if(this.length<1){return false}return jQuery.Buffer.bufferForElement(this[0]).hasClass(a)},setClass:function(e,c){var a=this.length,d,b;for(d=0;d<a;d++){b=jQuery.Buffer.bufferForElement(this[d]);b.setClass(e,c)}return this},addClass:function(d){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.addClass(d)}return this},removeClass:function(d){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.removeClass(d)}return this},resetClassNames:function(){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.resetClassNames()}return this},css:function(d,e){var a=this.length,c,b;for(c=0;c<a;c++){b=jQuery.Buffer.bufferForElement(this[c]);b.css(d,e)}return this},styles:function(){if(this.length<1){return null}return jQuery.Buffer.bufferForElement(this[0]).styles()},resetStyles:function(){if(this.length<1){return null}jQuery.Buffer.bufferForElement(this[0]).resetStyles();return this}})})();jQuery.Buffer._flush=function(){jQuery.Buffer.flush()};jQuery.Buffer.scheduleFlushing=function(){SC.RunLoop.currentRunLoop.invokeOnce(jQuery.Buffer._flush);this.flushingScheduled=true};if(!window.require){window.require=function require(){}}if(!window.sc_require){window.sc_require=require}if(!window.sc_resource){window.sc_resource=function sc_resource(){}}sc_require("license");window.YES=true;window.NO=false;if(typeof console==="undefined"){window.console={};console.log=console.info=console.warn=console.error=function(){}}window.SC=window.SC||{};window.SproutCore=window.SproutCore||SC;SC=window.SC;SC.VERSION="1.9.1";SC._baseMixin=function(c){var f=Array.prototype.slice.call(arguments,1),a,e=f[0]||{},g=1,d=f.length,i,b,h;if(d===1){e=this||{};g=0}for(;g<d;g++){if(!(i=f[g])){continue}for(h in i){if(!i.hasOwnProperty(h)){continue}b=i[h];if(e===b){continue}if(b!==undefined&&(c||(e[h]===undefined))){e[h]=b}}if(i.hasOwnProperty("toString")){e.toString=i.toString}}return e};SC.mixin=function(){var a=Array.prototype.slice.call(arguments);a.unshift(true);return SC._baseMixin.apply(this,a)};SC.supplement=function(){var a=Array.prototype.slice.call(arguments);a.unshift(false);return SC._baseMixin.apply(this,a)};SC.extend=SC.mixin;SC.mixin({T_ERROR:"error",T_OBJECT:"object",T_NULL:"null",T_CLASS:"class",T_HASH:"hash",T_FUNCTION:"function",T_UNDEFINED:"undefined",T_NUMBER:"number",T_BOOL:"boolean",T_ARRAY:"array",T_STRING:"string",T_DATE:"date",T_REGEXP:"regexp",typeOf:function(a){if(a===undefined){return SC.T_UNDEFINED}if(a===null){return SC.T_NULL}var b=jQuery.type(a);if(b==="function"){return a.isClass?SC.T_CLASS:SC.T_FUNCTION}else{if(b==="object"){if(SC.Error&&(a instanceof SC.Error)){return SC.T_ERROR}else{if(a instanceof SC.Object){return SC.T_OBJECT}else{return SC.T_HASH}}}}return b},none:function(a){return a==null},empty:function(a){return a===null||a===undefined||a===""},isArray:function(a){if(!a||a.setInterval){return false}if(Array.isArray&&Array.isArray(a)){return true}if(a.objectAt){return true}if(a.length!==undefined&&jQuery.type(a)==="object"){return true}return false},makeArray:function(a){return SC.isArray(a)?a:SC.A(a)},A:function(c){if(c===null||c===undefined){return[]}if(c.slice instanceof Function){if(typeof(c)==="string"){return[c]}else{return c.slice()}}if(c.toArray){return c.toArray()}if(!SC.isArray(c)){return[c]}var b=[],a=c.length;while(--a>=0){b[a]=c[a]}return b},guidKey:"SproutCore"+(SC.VERSION+Math.random()).replace(/\D/g,""),_guidPrefixes:{number:"nu",string:"st"},_guidCaches:{number:{},string:{}},_numberGuids:[],_stringGuids:{},_keyCache:{},guidFor:function(e){var b,c,d=typeof e;if(e===undefined){return"(undefined)"}if(e===null){return"(null)"}if(d===SC.T_NUMBER||d===SC.T_STRING){b=this._guidCaches[d];c=b[e];if(!c){c="st"+(jQuery.uuid++);b[e]=c}return c}else{if(d===SC.T_BOOL){return(e)?"(true)":"(false)"}}var a=this.guidKey;if(e[a]){return e[a]}if(e===Object){return"(Object)"}if(e===Array){return"(Array)"}return SC.generateGuid(e,"sc")},keyFor:function(d,c){var b,a=this._keyCache[d];if(!a){a=this._keyCache[d]={}}b=a[c];if(!b){b=a[c]=d+"_"+c}return b},generateGuid:function(c,b){var a=(b+(jQuery.uuid++));if(c){c[this.guidKey]=a}return a},hashFor:function(){var a=arguments.length,c="",e,d,b;for(b=0;b<a;++b){e=arguments[b];c+=(e&&(d=e.hash)&&(typeof d===SC.T_FUNCTION))?d.call(e):this.guidFor(e)}return c===""?null:c},isEqual:function(d,c){return this.hashFor(d)===this.hashFor(c)},compare:function(s,p){if(s===p){return 0}var j=SC.typeOf(s);var g=SC.typeOf(p);var b=SC.ORDER_DEFINITION_MAPPING;if(!b){var d=SC.ORDER_DEFINITION;b=SC.ORDER_DEFINITION_MAPPING={};var q,n;for(q=0,n=d.length;q<n;++q){b[d[q]]=q}delete SC.ORDER_DEFINITION}var t=b[j];var c=b[g];if(t<c){return -1}if(t>c){return 1}switch(j){case SC.T_BOOL:case SC.T_NUMBER:if(s<p){return -1}if(s>p){return 1}return 0;case SC.T_STRING:var k=s.localeCompare(p);if(k<0){return -1}if(k>0){return 1}return 0;case SC.T_ARRAY:var o=s.length;var m=p.length;var e=Math.min(o,m);var a=0;var h=0;var f=arguments.callee;while(a===0&&h<e){a=f(s[h],p[h]);h++}if(a!==0){return a}if(o<m){return -1}if(o>m){return 1}return 0;case SC.T_OBJECT:if(s.constructor.isComparable===YES){return s.constructor.compare(s,p)}return 0;default:return 0}},K:function(){return this},EMPTY_ARRAY:[],EMPTY_HASH:{},EMPTY_RANGE:{start:0,length:0},beget:function(c){if(c===null||c===undefined){return null}var a=SC.K;a.prototype=c;var b=new a();a.prototype=null;if(typeof c.didBeget==="function"){b=c.didBeget(b)}return b},copy:function(d,b){var c=d,a;if(d){if(d.isCopyable){return d.copy(b)}if(d.clone){return d.clone()}}switch(jQuery.type(d)){case"array":c=d.slice();if(b){a=c.length;while(a--){c[a]=SC.copy(c[a],true)}}break;case"object":c={};for(var e in d){c[e]=b?SC.copy(d[e],true):d[e]}}return c},merge:function(){var c={},b=arguments.length,a;for(a=0;a<b;a++){SC.mixin(c,arguments[a])}return c},keys:function(c){var a=[];for(var b in c){a.push(b)}return a},inspect:function(d){var a,b=[];for(var c in d){a=d[c];if(a==="toString"){continue}if(SC.typeOf(a)===SC.T_FUNCTION){a="function() { ... }"}b.push(c+": "+a)}return"{"+b.join(" , ")+"}"},tupleForPropertyPath:function(e,a){if(typeof e==="object"&&(e instanceof Array)){return e}var c;var b=e.indexOf("*");if(b<0){b=e.lastIndexOf(".")}c=(b>=0)?e.slice(b+1):e;var d=this.objectForPropertyPath(e,a,b);return(d&&c)?[d,c]:null},objectForPropertyPath:function(f,c,d){var g,b,e,a;if(!c){c=window}if(SC.typeOf(f)===SC.T_STRING){if(d===undefined){d=f.length}g=0;while((c)&&(g<d)){b=f.indexOf(".",g);if((b<0)||(b>d)){b=d}e=f.slice(g,b);c=c.get?c.get(e):c[e];g=b+1}if(g<d){c=undefined}}else{g=0;a=f.length;e=null;while((g<a)&&c){e=f[g++];if(e){c=(c.get)?c.get(e):c[e]}}if(g<a){c=undefined}}return c},requiredObjectForPropertyPath:function(c,a,b){var d=SC.objectForPropertyPath(c,a,b);if(!d){throw c+" could not be found"}return d}});SC.clone=SC.copy;SC.$A=SC.A;SC.didLoad=SC.K;SC.ORDER_DEFINITION=[SC.T_ERROR,SC.T_UNDEFINED,SC.T_NULL,SC.T_BOOL,SC.T_NUMBER,SC.T_STRING,SC.T_ARRAY,SC.T_HASH,SC.T_OBJECT,SC.T_FUNCTION,SC.T_CLASS];SC.Function={property:function(b,c){b.dependentKeys=SC.$A(c);var a=SC.guidFor(b);b.cacheKey="__cache__"+a;b.lastSetValueKey="__lastValue__"+a;b.isProperty=true;return b},cacheable:function(a,b){a.isProperty=true;if(!a.dependentKeys){a.dependentKeys=[]}a.isCacheable=(b===undefined)?true:b;return a},idempotent:function(a,b){a.isProperty=true;if(!a.dependentKeys){this.dependentKeys=[]}a.isVolatile=(b===undefined)?true:b;return a},enhance:function(a){a.isEnhancement=true;return a},observes:function(c,a){var f=a.length,b=null,e=null;while(--f>=0){var d=a[f];if((d.indexOf(".")<0)&&(d.indexOf("*")<0)){if(!b){b=c.localPropertyPaths=[]}b.push(d)}else{if(!e){e=c.propertyPaths=[]}e.push(d)}}return c}};sc_require("system/function");SC.mixin(Function.prototype,{property:function(){return SC.Function.property(this,arguments)},cacheable:function(a){return SC.Function.cacheable(this,a)},idempotent:function(a){return SC.Function.idempotent(this,a)},enhance:function(){return SC.Function.enhance(this)},observes:function(a){return SC.Function.observes(this,arguments)}});SC.ObserverSet={add:function(j,a,c){var b=SC.guidFor(j),f=SC.guidFor(a),i=this._members,d=this.members,g=i[b],h,e;if(!g){g=i[b]={}}h=g[f];if(h===undefined){g[f]=d.length;e=[j,a,c];d.push(e)}else{}},remove:function(g,h){var e=SC.guidFor(g),b=SC.guidFor(h);var d=this._members[e],a=this.members;if(!d){return false}var c=d[b];if(c===undefined){return false}if(c!==a.length-1){var f=(a[c]=a[a.length-1]);this._members[SC.guidFor(f[0])][SC.guidFor(f[1])]=c}a.pop();delete this._members[e][b];return true},invokeMethods:function(){var b=this.members,d;for(var c=0,a=b.length;c<a;c++){d=b[c];d[1].call(d[0])}},clone:function(){var c=SC.ObserverSet.create(),d=this.members;c._members=SC.clone(this._members);var e=c.members;for(var b=0,a=d.length;b<a;b++){e[b]=SC.clone(d[b]);e[b].length=3}return c},create:function(){return new SC.ObserverSet.constructor()},getMembers:function(){return this.members.slice(0)},constructor:function(){this._members={};this.members=[]}};SC.ObserverSet.constructor.prototype=SC.ObserverSet;SC.ObserverSet.slice=SC.ObserverSet.clone;SC.ObserverSet.copy=SC.ObserverSet.clone;SC._ChainObserver=function(b,a){this.property=b;this.root=a||this};SC._ChainObserver.createChain=function(f,m,g,a,b){var d=m.split("."),j=new SC._ChainObserver(d[0]),h=j;for(var e=1,c=d.length;e<c;e++){h=h.next=new SC._ChainObserver(d[e],j)}var k=j.tails=[h];j.objectDidChange(f);k.forEach(function(i){i.target=g;i.method=a;i.context=b});j.tails=null;return j};SC._ChainObserver.prototype={isChainObserver:true,object:null,property:null,next:null,root:null,target:null,method:null,tail:function(){if(this._tail){return this._tail}var a=this;while(a.next){a=a.next}this._tail=a;return a},objectDidChange:function(a){if(a===this.object){return}if(this.object){if(this.property==="@each"&&this.object._removeContentObserver){this.object._removeContentObserver(this)}else{if(this.object.removeObserver){this.object.removeObserver(this.property,this,this.propertyDidChange)}}}this.object=a;if(this.property==="@each"&&this.next){if(this.object&&this.object._addContentObserver){this.object._addContentObserver(this)}}else{if(this.object&&this.object.addObserver){this.object.addObserver(this.property,this,this.propertyDidChange)}this.propertyDidChange()}},propertyDidChange:function(){var b=this.object;var e=this.property;var d=(b&&b.get)?b.get(e):null;if(this.next){this.next.objectDidChange(d)}var f=this.target,g=this.method,c=this.context;if(f&&g){var a=b?b.propertyRevision:null;if(c){g.call(f,b,e,d,c,a)}else{g.call(f,b,e,d,a)}}},destroyChain:function(){var a=this.object;if(a){if(this.property==="@each"&&this.next&&a._removeContentObserver){a._removeContentObserver(this)}if(a.removeObserver){a.removeObserver(this.property,this,this.propertyDidChange)}}if(this.next){this.next.destroyChain()}this.next=this.target=this.method=this.object=this.context=null;return null}};sc_require("ext/function");sc_require("private/observer_set");sc_require("private/chain_observer");SC.LOG_OBSERVERS=NO;SC.OBSERVES_HANDLER_ADD=0;SC.OBSERVES_HANDLER_REMOVE=1;SC.Observable={isObservable:YES,automaticallyNotifiesObserversFor:function(a){return YES},get:function(c){var b=this[c],a;if(b===undefined){return this.unknownProperty(c)}else{if(b&&b.isProperty){if(b.isCacheable){a=this._kvo_cache;if(!a){a=this._kvo_cache={}}return(a[b.cacheKey]!==undefined)?a[b.cacheKey]:(a[b.cacheKey]=b.call(this,c))}else{return b.call(this,c)}}else{return b}}},set:function(i,g){var b=this[i],j=this.automaticallyNotifiesObserversFor(i),f=g,d,a,h,e;if(g===undefined&&SC.typeOf(i)===SC.T_HASH){var c=i;for(i in c){if(!c.hasOwnProperty(i)){continue}this.set(i,c[i])}return this}if(!j&&this._kvo_cacheable&&(a=this._kvo_cache)){d=this._kvo_cachedep;if(!d||(d=d[i])===undefined){d=this._kvo_computeCachedDependentsFor(i)}if(d){h=d.length;while(--h>=0){e=d[h];a[e.cacheKey]=a[e.lastSetValueKey]=undefined}}}if(b&&b.isProperty){a=this._kvo_cache;if(b.isVolatile||!a||(a[b.lastSetValueKey]!==g)){if(!a){a=this._kvo_cache={}}a[b.lastSetValueKey]=g;if(j){this.propertyWillChange(i)}f=b.call(this,i,g);if(b.isCacheable){a[b.cacheKey]=f}if(j){this.propertyDidChange(i,f,YES)}}}else{if(b===undefined){if(j){this.propertyWillChange(i)}this.unknownProperty(i,g);if(j){this.propertyDidChange(i,f)}}else{if(this[i]!==g){if(j){this.propertyWillChange(i)}f=this[i]=g;if(j){this.propertyDidChange(i,f)}}}}return this},unknownProperty:function(a,b){if(!(b===undefined)){this[a]=b}return b},beginPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;return this},endPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;var b=this._kvo_changeLevel,a=this._kvo_changes;if((b<=0)&&a&&(a.length>0)&&!SC.Observers.isObservingSuspended){this._notifyPropertyObservers()}return this},propertyWillChange:function(a){return this},propertyDidChange:function(n,l,c){this._kvo_revision=(this._kvo_revision||0)+1;var b=this._kvo_changeLevel||0,h,m,i,d,f=SC.LOG_OBSERVERS&&(this.LOG_OBSERVING!==NO);var j=this._kvo_property_chains;if(j){var g=j[n];if(g){this.beginPropertyChanges();g=SC.clone(g);g.forEach(function(o){o.notifyPropertyDidChange()});this.endPropertyChanges()}}var a=this._kvo_cache;if(a){if(!c){d=this[n];if(d&&d.isProperty){a[d.cacheKey]=a[d.lastSetValueKey]=undefined}}if(this._kvo_cacheable){h=this._kvo_cachedep;if(!h||(h=h[n])===undefined){h=this._kvo_computeCachedDependentsFor(n)}if(h){m=h.length;while(--m>=0){i=h[m];a[i.cacheKey]=a[i.lastSetValueKey]=undefined}}}}var e=SC.Observers.isObservingSuspended;if((b>0)||e){var k=this._kvo_changes;if(!k){k=this._kvo_changes=SC.CoreSet.create()}k.add(n);if(e){if(f){SC.Logger.log("%@%@: will not notify observers because observing is suspended".fmt(SC.KVO_SPACES,this))}SC.Observers.objectHasPendingChanges(this)}}else{this._notifyPropertyObservers(n)}return this},registerDependentKey:function(h,c){var e=this._kvo_dependents,i=this._kvo_chain_dependents,b=this[h],j,g,a,f,d;if(typeof c==="object"&&(c instanceof Array)){j=c;a=0}else{j=arguments;a=1}g=j.length;if(!e){this._kvo_dependents=e={}}while(--g>=a){f=j[g];if(f.indexOf(".")>=0){SC._PropertyChain.createChain(f,this,h).activate(this)}else{d=e[f];if(!d){d=e[f]=[]}d.push(h)}}},registerDependentKeyWithChain:function(c,a){var d=this._chainsFor(c),b;d.add(a)},removeDependentKeyWithChain:function(c,a){var d=this._chainsFor(c),b;d.remove(a);if(d.get("length")===0){delete this._kvo_property_chains[c]}},_chainsFor:function(a){this._kvo_property_chains=this._kvo_property_chains||{};var b=this._kvo_property_chains[a]||SC.CoreSet.create();this._kvo_property_chains[a]=b;return b},_kvo_addCachedDependents:function(b,f,h,c){var a=f.length,e,d,g;while(--a>=0){d=f[a];c.add(d);e=this[d];if(e&&(e instanceof Function)&&e.isProperty){if(e.isCacheable){b.push(e)}if((g=h[d])&&g.length>0){this._kvo_addCachedDependents(b,g,h,c)}}}},_kvo_computeCachedDependentsFor:function(c){var d=this._kvo_cachedep,f=this._kvo_dependents,e=f?f[c]:null,a,b;if(!d){d=this._kvo_cachedep={}}if(!e||e.length===0){return d[c]=null}a=d[c]=[];b=SC._TMP_SEEN_SET=(SC._TMP_SEEN_SET||SC.CoreSet.create());b.add(c);this._kvo_addCachedDependents(a,e,f,b);b.clear();if(a.length===0){a=d[c]=null}return a},_kvo_for:function(c,b){var a=this[c];if(!this._kvo_cloned){this._kvo_cloned={}}if(!a){a=this[c]=(b===undefined)?[]:b.create();this._kvo_cloned[c]=YES}else{if(!this._kvo_cloned[c]){a=this[c]=a.copy();this._kvo_cloned[c]=YES}}return a},addObserver:function(c,f,h,b){var d,a,e,g;if(h===undefined){h=f;f=this}if(!f){f=this}if(typeof h==="string"){h=f[h]}if(!h){throw"You must pass a method to addObserver()"}c=c.toString();if(c.indexOf(".")>=0){a=SC._ChainObserver.createChain(this,c,f,h,b);a.masterTarget=f;a.masterMethod=h;this._kvo_for(SC.keyFor("_kvo_chains",c)).push(a)}else{if((this[c]===undefined)&&(c.indexOf("@")===0)){this.get(c)}if(f===this){f=null}d=SC.keyFor("_kvo_observers",c);this._kvo_for(d,SC.ObserverSet).add(f,h,b);this._kvo_for("_kvo_observed_keys",SC.CoreSet).add(c)}if(this.didAddObserver){this.didAddObserver(c,f,h)}return this},removeObserver:function(c,f,h){var d,e,b,g,a;if(h===undefined){h=f;f=this}if(!f){f=this}if(typeof h==="string"){h=f[h]}if(!h){throw"You must pass a method to removeObserver()"}c=c.toString();if(c.indexOf(".")>=0){d=SC.keyFor("_kvo_chains",c);if(e=this[d]){e=this._kvo_for(d);a=e.length;while(--a>=0){b=e[a];if(b&&(b.masterTarget===f)&&(b.masterMethod===h)){e[a]=b.destroyChain()}}}}else{if(f===this){f=null}d=SC.keyFor("_kvo_observers",c);if(g=this[d]){g=this._kvo_for(d);g.remove(f,h);if(g.getMembers().length===0){this._kvo_for("_kvo_observed_keys",SC.CoreSet).remove(c)}}}if(this.didRemoveObserver){this.didRemoveObserver(c,f,h)}return this},hasObserverFor:function(b){SC.Observers.flush(this);var d=this[SC.keyFor("_kvo_observers",b)],c=this[SC.keyFor("_kvo_local",b)],a;if(c&&c.length>0){return YES}if(d&&d.getMembers().length>0){return YES}return NO},initObservable:function(){if(this._observableInited){return}this._observableInited=YES;var f,m,k,j,h,e,l,g,c,n,b,i,d,a;if(m=this._observers){g=m.length;for(f=0;f<g;f++){k=m[f];h=this[k];e=h.propertyPaths;l=(e)?e.length:0;for(c=0;c<l;c++){n=e[c];this.addObservesHandler(h,n)}}}this.bindings=[];if(m=this._bindings){for(f=0,a=m.length;f<a;f++){k=m[f];j=this[k];d=k.slice(0,-7);this[k]=this.bind(d,j)}}if(m=this._properties){for(f=0,a=m.length;f<a;f++){k=m[f];if(j=this[k]){if(j.isCacheable){this._kvo_cacheable=YES}if(j.dependentKeys&&(j.dependentKeys.length>0)){this.registerDependentKey(k,j.dependentKeys)}}}}delete this._observers;delete this._bindings;delete this._properties},addObservesHandler:function(a,b){this._configureObservesHandler(SC.OBSERVES_HANDLER_ADD,a,b);return this},removeObservesHandler:function(a,b){this._configureObservesHandler(SC.OBSERVES_HANDLER_REMOVE,a,b);return this},_configureObservesHandler:function(d,b,e){var c,a;switch(d){case SC.OBSERVES_HANDLER_ADD:d="addObserver";break;case SC.OBSERVES_HANDLER_REMOVE:d="removeObserver";break;default:throw"invalid action provided: "+d}c=e.indexOf(".");if(c<0){this[d](e,this,b)}else{if(e.indexOf("*")===0){this[d](e.slice(1),this,b)}else{a=null;if(c===0){a=this;e=e.slice(1)}else{if(c===4&&e.slice(0,5)==="this."){a=this;e=e.slice(5)}else{if(c<0&&e.length===4&&e==="this"){a=this;e=""}else{if(c>0&&e[0]===e.charAt(0).toLowerCase()){a=this}}}}SC.Observers[d](e,this,b,a)}}},observersForKey:function(a){SC.Observers.flush(this);var b=this[SC.keyFor("_kvo_observers",a)];return b?b.getMembers():[]},_notifyPropertyObservers:function(t){if(!this._observableInited){this.initObservable()}SC.Observers.flush(this);var g=SC.LOG_OBSERVERS&&!(this.LOG_OBSERVING===NO),o,r,m,d,n,l,q,p,j,a,f,s,c,i,e,b,h,k;if(g){h=SC.KVO_SPACES=(SC.KVO_SPACES||"")+"  ";SC.Logger.log('%@%@: notifying observers after change to key "%@"'.fmt(h,this,t))}d=this["_kvo_observers_*"];this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;while(((r=this._kvo_changes)&&(r.length>0))||t){q=++this.propertyRevision;if(!r){r=SC.CoreSet.create()}this._kvo_changes=null;if(t==="*"){r.add("*");r.addEach(this._kvo_for("_kvo_observed_keys",SC.CoreSet))}else{if(t){r.add(t)}}if(m=this._kvo_dependents){for(n=0;n<r.length;n++){t=r[n];l=m[t];if(l&&(i=l.length)){if(g){SC.Logger.log("%@...including dependent keys for %@: %@".fmt(h,t,l))}k=this._kvo_cache;if(!k){k=this._kvo_cache={}}while(--i>=0){r.add(t=l[i]);if(e=this[t]){this[e.cacheKey]=undefined;k[e.cacheKey]=k[e.lastSetValueKey]=undefined}}}}}while(r.length>0){t=r.pop();o=this[SC.keyFor("_kvo_observers",t)];if(o){p=SC.clone(o.getMembers());j=p.length;for(f=0;f<j;f++){a=p[f];if(a[3]===q){continue}if(!a[1]){SC.Logger.log(a)}s=a[0]||this;c=a[1];b=a[2];a[3]=q;if(g){SC.Logger.log('%@...firing observer on %@ for key "%@"'.fmt(h,s,t))}if(b!==undefined){c.call(s,this,t,null,b,q)}else{c.call(s,this,t,null,q)}}}p=this[SC.keyFor("_kvo_local",t)];if(p){j=p.length;for(f=0;f<j;f++){a=p[f];c=this[a];if(c){if(g){SC.Logger.log('%@...firing local observer %@.%@ for key "%@"'.fmt(h,this,a,t))}c.call(this,this,t,null,q)}}}if(d&&t!=="*"){p=SC.clone(d.getMembers());j=p.length;for(f=0;f<j;f++){a=p[f];s=a[0]||this;c=a[1];b=a[2];if(g){SC.Logger.log('%@...firing * observer on %@ for key "%@"'.fmt(h,s,t))}if(b!==undefined){c.call(s,this,t,null,b,q)}else{c.call(s,this,t,null,q)}}}if(this.propertyObserver){if(g){SC.Logger.log('%@...firing %@.propertyObserver for key "%@"'.fmt(h,this,t))}this.propertyObserver(this,t,null,q)}}if(r){r.destroy()}t=null}this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;if(g){SC.KVO_SPACES=h.slice(0,-2)}return YES},bind:function(a,c,e){var d,b;if(e!==undefined){c=[c,e]}b=typeof c;if(b==="string"||(b==="object"&&(c instanceof Array))){d=this[a+"BindingDefault"]||SC.Binding;d=d.beget().from(c)}else{d=c.beget()}d=d.to(a,this).connect();this.bindings.push(d);return d},didChangeFor:function(a){var b,f,e,j,d,c,h,i,g;a=SC.hashFor(a);b=this._kvo_didChange_valueCache;if(!b){b=this._kvo_didChange_valueCache={}}f=this._kvo_didChange_revisionCache;if(!f){f=this._kvo_didChange_revisionCache={}}e=b[a]||{};j=f[a]||{};d=false;c=this._kvo_revision||0;h=arguments.length;while(--h>=1){i=arguments[h];if(j[i]!=c){g=this.get(i);if(e[i]!==g){d=true;e[i]=g}}j[i]=c}b[a]=e;f[a]=j;return d},setIfChanged:function(a,b){if(b===undefined&&SC.typeOf(a)===SC.T_HASH){var c=a;for(a in c){if(!c.hasOwnProperty(a)){continue}this.setIfChanged(a,c[a])}return this}return(this.get(a)!==b)?this.set(a,b):this},getPath:function(b){var a=SC.tupleForPropertyPath(b,this);if(a===null||a[0]===null){return undefined}return SC.get(a[0],a[1])},setPath:function(c,b){if(c.indexOf(".")>=0){var a=SC.tupleForPropertyPath(c,this);if(!a||!a[0]){return null}a[0].set(a[1],b)}else{this.set(c,b)}return this},setPathIfChanged:function(c,b){if(c.indexOf(".")>=0){var a=SC.tupleForPropertyPath(c,this);if(!a||!a[0]){return null}if(a[0].get(a[1])!==b){a[0].set(a[1],b)}}else{this.setIfChanged(c,b)}return this},getEach:function(){var d=SC.A(arguments),c=[],a,b;for(a=0,b=d.length;a<b;a++){c[c.length]=this.getPath(d[a])}return c},incrementProperty:function(b,a){if(!a){a=1}this.set(b,(this.get(b)||0)+a);return this.get(b)},decrementProperty:function(b,a){if(!a){a=1}this.set(b,(this.get(b)||0)-a);return this.get(b)},toggleProperty:function(a,b,c){if(b===undefined){b=true}if(c===undefined){c=false}b=(this.get(a)==b)?c:b;this.set(a,b);return this.get(a)},notifyPropertyChange:function(a,b){this.propertyWillChange(a);this.propertyDidChange(a,b);return this},allPropertiesDidChange:function(){this._kvo_cache=null;this._notifyPropertyObservers("*");return this},addProbe:function(a){this.addObserver(a,SC.logChange)},removeProbe:function(a){this.removeObserver(a,SC.logChange)},logProperty:function(){var b=SC.$A(arguments),d,c,a;for(a=0,c=b.length;a<c;a++){d=b[a];SC.Logger.log("%@:%@: ".fmt(SC.guidFor(this),d),this.get(d))}},propertyRevision:1};SC.logChange=function logChange(c,a,b){SC.Logger.log("CHANGE: %@[%@] => %@".fmt(c,a,c.get(a)))};SC.mixin(SC,{get:function(a,b){if(!a){return undefined}if(b===undefined){return this[a]}if(a.get){return a.get(b)}return a[b]},getPath:function(a,b){if(b===undefined){b=a;a=window}return SC.objectForPropertyPath(b,a)}});SC.mixin(Array.prototype,SC.Observable);SC.Enumerator=function(a){this.enumerable=a;this.reset();return this};SC.Enumerator.prototype={nextObject:function(){var c=this._index;var a=this._length;if(c>=a){return undefined}var b=this.enumerable.nextObject(c,this._previousObject,this._context);this._previousObject=b;this._index=c+1;if(c>=a){this._context=SC.Enumerator._pushContext(this._context)}return b},reset:function(){var b=this.enumerable;if(!b){throw SC.$error("Enumerator has been destroyed")}this._length=b.get?b.get("length"):b.length;var a=this._length;this._index=0;this._previousObject=null;this._context=(a>0)?SC.Enumerator._popContext():null},destroy:function(){this.enumerable=this._length=this._index=this._previousObject=this._context=null}};SC.Enumerator.create=function(a){return new SC.Enumerator(a)};SC.Enumerator._popContext=function(){var a=this._contextCache?this._contextCache.pop():null;return a||{}};SC.Enumerator._pushContext=function(b){this._contextCache=this._contextCache||[];var a=this._contextCache;a.push(b);return null};sc_require("core");sc_require("ext/function");sc_require("system/enumerator");SC.Enumerable={isEnumerable:YES,nextObject:function(a,c,b){return this.objectAt?this.objectAt(a):this[a]},firstObject:function(){if(this.get("length")===0){return undefined}if(this.objectAt){return this.objectAt(0)}var b=SC.Enumerator._popContext(),a;a=this.nextObject(0,null,b);b=SC.Enumerator._pushContext(b);return a}.property().cacheable(),lastObject:function(){var a=this.get("length");if(a===0){return undefined}if(this.objectAt){return this.objectAt(a-1)}}.property().cacheable(),enumerator:function(){return SC.Enumerator.create(this)},forEach:function(g,f){if(typeof g!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(f===undefined){f=null}var e=null;var c=SC.Enumerator._popContext();for(var a=0;a<b;a++){var d=this.nextObject(a,e,c);g.call(f,d,a,this);e=d}e=null;c=SC.Enumerator._pushContext(c);return this},getEach:function(a){return this.map(function(b){return b?(b.get?b.get(a):b[a]):null},this)},setEach:function(a,b){this.forEach(function(c){if(c){if(c.set){c.set(a,b)}else{c[a]=b}}},this);return this},map:function(h,g){if(typeof h!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(g===undefined){g=null}var c=[];var f=null;var d=SC.Enumerator._popContext();for(var a=0;a<b;a++){var e=this.nextObject(a,f,d);c[a]=h.call(g,e,a,this);f=e}f=null;d=SC.Enumerator._pushContext(d);return c},mapProperty:function(a){return this.map(function(b){return b?(b.get?b.get(a):b[a]):null})},filter:function(h,g){if(typeof h!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(g===undefined){g=null}var c=[];var f=null;var d=SC.Enumerator._popContext();for(var a=0;a<b;a++){var e=this.nextObject(a,f,d);if(h.call(g,e,a,this)){c.push(e)}f=e}f=null;d=SC.Enumerator._pushContext(d);return c},sortProperty:function(b){var c=(typeof b===SC.T_STRING)?arguments:b,a=c.length,d;if(this instanceof Array){d=this}else{d=[];this.forEach(function(e){d.push(e)})}if(!d){return[]}return d.sort(function(g,f){var e,i,k,j,h=0;for(e=0;h===0&&e<a;e++){i=c[e];k=g?(g.get?g.get(i):g[i]):null;j=f?(f.get?f.get(i):f[i]):null;h=SC.compare(k,j)}return h})},filterProperty:function(j,f){var d=this.get?this.get("length"):this.length;var e=[];var i=null;var b=SC.Enumerator._popContext();for(var g=0;g<d;g++){var c=this.nextObject(g,i,b);var h=c?(c.get?c.get(j):c[j]):null;var a=(f===undefined)?!!h:SC.isEqual(h,f);if(a){e.push(c)}i=c}i=null;b=SC.Enumerator._pushContext(b);return e},find:function(h,d){var c=this.get?this.get("length"):this.length;if(d===undefined){d=null}var g=null,b,i=NO,e=null;var a=SC.Enumerator._popContext();for(var f=0;f<c&&!i;f++){b=this.nextObject(f,g,a);if(i=h.call(d,b,f,this)){e=b}g=b}b=g=null;a=SC.Enumerator._pushContext(a);return e},findProperty:function(i,f){var c=this.get?this.get("length"):this.length;var j=NO,d=null,h=null,b,g;var a=SC.Enumerator._popContext();for(var e=0;e<c&&!j;e++){b=this.nextObject(e,h,a);g=b?(b.get?b.get(i):b[i]):null;j=(f===undefined)?!!g:SC.isEqual(g,f);if(j){d=b}h=b}h=b=null;a=SC.Enumerator._pushContext(a);return d},every:function(h,g){if(typeof h!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(g===undefined){g=null}var c=YES;var f=null;var d=SC.Enumerator._popContext();for(var a=0;c&&(a<b);a++){var e=this.nextObject(a,f,d);if(!h.call(g,e,a,this)){c=NO}f=e}f=null;d=SC.Enumerator._pushContext(d);return c},everyProperty:function(i,e){var c=this.get?this.get("length"):this.length;var d=YES;var h=null;var a=SC.Enumerator._popContext();for(var f=0;d&&(f<c);f++){var b=this.nextObject(f,h,a);var g=b?(b.get?b.get(i):b[i]):null;d=(e===undefined)?!!g:SC.isEqual(g,e);h=b}h=null;a=SC.Enumerator._pushContext(a);return d},some:function(h,g){if(typeof h!=="function"){throw new TypeError()}var b=this.get?this.get("length"):this.length;if(g===undefined){g=null}var c=NO;var f=null;var d=SC.Enumerator._popContext();for(var a=0;(!c)&&(a<b);a++){var e=this.nextObject(a,f,d);if(h.call(g,e,a,this)){c=YES}f=e}f=null;d=SC.Enumerator._pushContext(d);return c},someProperty:function(i,e){var c=this.get?this.get("length"):this.length;var d=NO;var h=null;var a=SC.Enumerator._popContext();for(var f=0;!d&&(f<c);f++){var b=this.nextObject(f,h,a);var g=b?(b.get?b.get(i):b[i]):null;d=(e===undefined)?!!g:SC.isEqual(g,e);h=b}h=null;a=SC.Enumerator._pushContext(a);return d},reduce:function(g,h,i){if(typeof g!=="function"){throw new TypeError()}var c=this.get?this.get("length"):this.length;if(c===0&&h===undefined){throw new TypeError()}var d=h;var f=null;var a=SC.Enumerator._popContext();for(var e=0;e<c;e++){var b=this.nextObject(e,f,a);if(b!==null){if(d===undefined){d=b}else{d=g.call(null,d,b,e,this,i)}}f=b}f=null;a=SC.Enumerator._pushContext(a);if(d===undefined){throw new TypeError()}return d},invoke:function(h){var e=this.get?this.get("length"):this.length;if(e<=0){return[]}var i;var g=[];var c=arguments.length;if(c>1){for(i=1;i<c;i++){g.push(arguments[i])}}var f=[];var j=null;var b=SC.Enumerator._popContext();for(i=0;i<e;i++){var d=this.nextObject(i,j,b);var a=d?d[h]:null;if(a){f[i]=a.apply(d,g)}j=d}j=null;b=SC.Enumerator._pushContext(b);return f},invokeWhile:function(d,i){var f=this.get?this.get("length"):this.length;if(f<=0){return null}var j;var h=[];var c=arguments.length;if(c>2){for(j=2;j<c;j++){h.push(arguments[j])}}var g=d;var k=null;var b=SC.Enumerator._popContext();for(j=0;(g===d)&&(j<f);j++){var e=this.nextObject(j,k,b);var a=e?e[i]:null;if(a){g=a.apply(e,h)}k=e}k=null;b=SC.Enumerator._pushContext(b);return g},toArray:function(){var a=[];this.forEach(function(b){a.push(b)},this);return a},groupBy:function(i){var c=this.get?this.get("length"):this.length,d=[],h=null,a=SC.Enumerator._popContext(),e=[],j=[],f,b,g;for(f=0;f<c;f++){b=this.nextObject(f,h,a);g=b?(b.get?b.get(i):b[i]):null;if(SC.none(e[g])){e[g]=[];j.push(g)}e[g].push(b);h=b}h=null;a=SC.Enumerator._pushContext(a);for(f=0,c=j.length;f<c;f++){d.push(e[j[f]])}return d}};SC._buildReducerFor=function(a,b){return function(d,e){var f=this[a];if(SC.typeOf(f)!==SC.T_FUNCTION){return this.unknownProperty?this.unknownProperty(d,e):null}else{var c=SC.Enumerable.reduce.call(this,f,null,b);return c}}.property("[]")};SC.Reducers={"[]":function(a,b){return this}.property(),enumerableContentDidChange:function(c,a,b){if(!SC.none(c)){if(c===0){this.notifyPropertyChange("firstObject")}if(!SC.none(a)&&c+a===this.get("length")-1){this.notifyPropertyChange("lastObject")}}this.notifyPropertyChange("[]")},reducedProperty:function(i,g,f){if(!i||typeof i!==SC.T_STRING||i.charAt(0)!=="@"){return undefined}var d=i.match(/^@([^(]*)(\(([^)]*)\))?$/);if(!d||d.length<2){return undefined}var h=d[1];var j=d[3];h="reduce"+h.slice(0,1).toUpperCase()+h.slice(1);var a=this[h];if(SC.typeOf(a)!==SC.T_FUNCTION){return undefined}if(f===NO){return SC.Enumerable.reduce.call(this,a,null,j)}var c=SC._buildReducerFor(h,j);var b=this.constructor.prototype;if(b){b[i]=c;var e=b._properties||[];e.push(i);b._properties=e;this.registerDependentKey(i,"[]")}return SC.Enumerable.reduce.call(this,a,null,j)},reduceMax:function(a,d,b,f,c){if(c&&d){d=d.get?d.get(c):d[c]}if(a===null){return d}return(d>a)?d:a},reduceMaxObject:function(b,f,c,g,d){var a=b,h=f;if(d){if(f){h=f.get?f.get(d):f[d]}if(b){a=b.get?b.get(d):b[d]}}if(a===null){return f}return(h>a)?f:b},reduceMin:function(a,d,b,f,c){if(c&&d){d=d.get?d.get(c):d[c]}if(a===null){return d}return(d<a)?d:a},reduceMinObject:function(b,f,c,g,d){var a=b,h=f;if(d){if(f){h=f.get?f.get(d):f[d]}if(b){a=b.get?b.get(d):b[d]}}if(a===null){return f}return(h<a)?f:b},reduceAverage:function(b,g,d,h,f){if(f&&g){g=g.get?g.get(f):g[f]}var c=(b||0)+g;var a=h.get?h.get("length"):h.length;if(d>=a-1){c=c/a}return c},reduceSum:function(a,d,b,f,c){if(c&&d){d=d.get?d.get(c):d[c]}return(a===null)?d:a+d}};SC.mixin(SC.Enumerable,SC.Reducers);SC.mixin(Array.prototype,SC.Reducers);Array.prototype.isEnumerable=YES;(function(){var a={nextObject:SC.Enumerable.nextObject,enumerator:SC.Enumerable.enumerator,firstObject:SC.Enumerable.firstObject,lastObject:SC.Enumerable.lastObject,sortProperty:SC.Enumerable.sortProperty,mapProperty:function(g){var e=this.length;var f=[];for(var d=0;d<e;d++){var h=this[d];f[d]=h?(h.get?h.get(g):h[g]):null}return f},filterProperty:function(h,j){var f=this.length;var g=[];for(var e=0;e<f;e++){var i=this[e];var k=i?(i.get?i.get(h):i[h]):null;var d=(j===undefined)?!!k:SC.isEqual(k,j);if(d){g.push(i)}}return g},groupBy:function(h){var e=this.length,g=[],j=[],f=[],d,i,k;for(d=0;d<e;d++){i=this[d];k=i?(i.get?i.get(h):i[h]):null;if(SC.none(j[k])){j[k]=[];f.push(k)}j[k].push(i)}for(d=0,e=f.length;d<e;d++){g.push(j[f[d]])}return g},find:function(j,i){if(typeof j!=="function"){throw new TypeError()}var e=this.length;if(i===undefined){i=null}var g,f=null,h=NO;for(var d=0;d<e&&!h;d++){g=this[d];if(h=j.call(i,g,d,this)){f=g}}g=null;return f},findProperty:function(g,j){var e=this.length;var h,k,i=NO,f=null;for(var d=0;d<e&&!i;d++){k=(h=this[d])?(h.get?h.get(g):h[g]):null;i=(j===undefined)?!!k:SC.isEqual(k,j);if(i){f=h}}h=null;return f},everyProperty:function(g,i){var e=this.length;var f=YES;for(var d=0;f&&(d<e);d++){var h=this[d];var j=h?(h.get?h.get(g):h[g]):null;f=(i===undefined)?!!j:SC.isEqual(j,i)}return f},someProperty:function(g,i){var e=this.length;var f=NO;for(var d=0;!f&&(d<e);d++){var h=this[d];var j=h?(h.get?h.get(g):h[g]):null;f=(i===undefined)?!!j:SC.isEqual(j,i)}return f},invoke:function(f){var e=this.length;if(e<=0){return[]}var d;var h=[];var j=arguments.length;if(j>1){for(d=1;d<j;d++){h.push(arguments[d])}}var g=[];for(d=0;d<e;d++){var i=this[d];var k=i?i[f]:null;if(k){g[d]=k.apply(i,h)}}return g},invokeWhile:function(f,k){var h=this.length;if(h<=0){return null}var l;var j=[];var e=arguments.length;if(e>2){for(l=2;l<e;l++){j.push(arguments[l])}}var i=f;for(l=0;(i===f)&&(l<h);l++){var g=this[l];var d=g?g[k]:null;if(d){i=d.apply(g,j)}}return i},toArray:function(){var e=this.length;if(e<=0){return[]}var f=[];for(var d=0;d<e;d++){var g=this[d];f.push(g)}return f},getEach:function(g){var f=[];var e=this.length;for(var d=0;d<e;d++){var h=this[d];f[d]=h?(h.get?h.get(g):h[g]):null}return f},setEach:function(f,g){var e=this.length;for(var d=0;d<e;d++){var h=this[d];if(h){if(h.set){h.set(f,g)}else{h[f]=g}}}return this}};var c={forEach:function(h,g){if(typeof h!=="function"){throw new TypeError()}if(g===undefined){g=null}for(var e=0,d=this.length;e<d;e++){var f=this[e];h.call(g,f,e,this)}return this},map:function(j,h){if(typeof j!=="function"){throw new TypeError()}if(h===undefined){h=null}var e=[];for(var f=0,d=this.length;f<d;f++){var g=this[f];e[f]=j.call(h,g,f,this)}return e},filter:function(j,h){if(typeof j!=="function"){throw new TypeError()}if(h===undefined){h=null}var e=[];for(var f=0,d=this.length;f<d;f++){var g=this[f];if(j.call(h,g,f,this)){e.push(g)}}return e},every:function(i,h){if(typeof i!=="function"){throw new TypeError()}var e=this.length;if(h===undefined){h=null}var f=YES;for(var d=0;f&&(d<e);d++){var g=this[d];if(!i.call(h,g,d,this)){f=NO}}return f},some:function(i,h){if(typeof i!=="function"){throw new TypeError()}var e=this.length;if(h===undefined){h=null}var f=NO;for(var d=0;(!f)&&(d<e);d++){var g=this[d];if(i.call(h,g,d,this)){f=YES}}return f},reduce:function(j,f,i){if(typeof j!=="function"){throw new TypeError()}var e=this.length;if(e===0&&f===undefined){throw new TypeError()}var g=f;for(var d=0;d<e;d++){var h=this[d];if(h!==null){if(g===undefined){g=h}else{g=j.call(null,g,h,d,this,i)}}}if(g===undefined){throw new TypeError()}return g}};for(var b in c){if(!c.hasOwnProperty(b)){continue}if(!Array.prototype[b]||((typeof Prototype==="object")&&Prototype.Version.match(/^1\.6/))){Array.prototype[b]=c[b]}}SC.mixin(Array.prototype,a)})();SC.RangeObserver={isRangeObserver:YES,toString:function(){var a=this.indexes?this.indexes.toString():"SC.IndexSet<..>";return a.replace("IndexSet","RangeObserver(%@)".fmt(SC.guidFor(this)))},create:function(d,f,e,g,c,a){var b=SC.beget(this);b.source=d;b.indexes=f?f.frozenCopy():null;b.target=e;b.method=(typeof g==="string")?e[g]:g;b.context=c;b.isDeep=a||false;b.beginObserving();return b},extend:function(d){var c=SC.beget(this),b=arguments;for(var e=0,a=b.length;e<a;e++){SC.mixin(c,b[e])}return c},destroy:function(a){this.endObserving();return this},update:function(a,b){if(this.indexes&&this.indexes.isEqual(b)){return this}this.indexes=b?b.frozenCopy():null;this.endObserving().beginObserving();return this},beginObserving:function(){if(!this.isDeep){return this}var c=this.observing=this.observing||SC.CoreSet.create();var a=this._beginObservingForEach,b=this.source;if(!a){a=this._beginObservingForEach=function(d){var e=b.objectAt(d);if(e&&e.addObserver){c.push(e);e._kvo_needsRangeObserver=true}}}this.indexes.forEach(a);this.isObserving=false;SC.Observers.addPendingRangeObserver(this);return this},setupPending:function(b){var e=this.observing;if(this.isObserving||!e||(e.get("length")===0)){return true}if(e.contains(b)){this.isObserving=true;var c=this._setupPendingForEach;if(!c){var d=this.source,f=this.objectPropertyDidChange,a=this;c=this._setupPendingForEach=function(g){var j=d.objectAt(g),h=SC.guidFor(j),i;if(j&&j.addObserver){e.push(j);j.addObserver("*",a,f);i=a[h];if(i==null){a[h]=g}else{if(i.isIndexSet){i.add(g)}else{a[h]=SC.IndexSet.create(i).add(g)}}}}}this.indexes.forEach(c);return true}else{return false}},endObserving:function(){if(!this.isDeep){return this}var e=this.observing;if(this.isObserving){var b=this.objectPropertyDidChange,c=this.source,a,f,d;if(e){f=e.length;for(a=0;a<f;a++){d=e[a];d.removeObserver("*",this,b);this[SC.guidFor(d)]=null}e.length=0}this.isObserving=false}if(e){e.clear()}return this},rangeDidChange:function(b){var a=this.indexes;if(!b||!a||a.intersects(b)){this.endObserving();this.method.call(this.target,this.source,null,"[]",b,this.context);this.beginObserving()}return this},objectPropertyDidChange:function(d,f,g,a){var e=this.context,h=this.method,c=SC.guidFor(d),b=this[c];if(b&&!b.isIndexSet){b=this[c]=SC.IndexSet.create(b).freeze()}h.call(this.target,this.source,d,f,b,e||a,a)}};sc_require("ext/function");sc_require("mixins/observable");sc_require("mixins/enumerable");sc_require("system/range_observer");SC.OUT_OF_RANGE_EXCEPTION="Index out of range";SC.CoreArray={isSCArray:YES,replace:function(a,c,b){throw"replace() must be implemented to support SC.Array"},indexOf:function(d,c){var b,a=this.get("length");if(c===undefined){c=0}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b<a;b++){if(this.objectAt(b,YES)===d){return b}}return -1},lastIndexOf:function(d,c){var b,a=this.get("length");if(c===undefined){c=a-1}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b>=0;b--){if(this.objectAt(b)===d){return b}}return -1},objectAt:function(a){if(a<0){return undefined}if(a>=this.get("length")){return undefined}return this.get(a)},"[]":function(a,b){if(b!==undefined){this.replace(0,this.get("length"),b)}return this}.property(),insertAt:function(a,b){if(a>this.get("length")){throw SC.OUT_OF_RANGE_EXCEPTION}this.replace(a,0,[b]);return this},removeAt:function(d,a){var c=0,b=[];if(typeof d===SC.T_NUMBER){if((d<0)||(d>=this.get("length"))){throw SC.OUT_OF_RANGE_EXCEPTION}if(a===undefined){this.replace(d,1,b);return this}else{d=SC.IndexSet.create(d,a)}}this.beginPropertyChanges();d.forEachRange(function(f,e){f-=c;c+=e;this.replace(f,e,b)},this);this.endPropertyChanges();return this},removeObject:function(b){var c=this.get("length")||0;while(--c>=0){var a=this.objectAt(c);if(a==b){this.removeAt(c)}}return this},removeObjects:function(a){this.beginPropertyChanges();a.forEach(function(b){this.removeObject(b)},this);this.endPropertyChanges();return this},slice:function(b,d){var a=[];var c=this.get("length");if(SC.none(b)){b=0}if(SC.none(d)||(d>c)){d=c}while(b<d){a[a.length]=this.objectAt(b++)}return a},pushObject:function(a){this.insertAt(this.get("length"),a);return a},pushObjects:function(a){this.beginPropertyChanges();a.forEach(function(b){this.pushObject(b)},this);this.endPropertyChanges();return this},popObject:function(){var a=this.get("length");if(a===0){return null}var b=this.objectAt(a-1);this.removeAt(a-1);return b},shiftObject:function(){if(this.get("length")===0){return null}var a=this.objectAt(0);this.removeAt(0);return a},unshiftObject:function(a){this.insertAt(0,a);return a},unshiftObjects:function(a){this.beginPropertyChanges();a.forEach(function(b){this.unshiftObject(b)},this);this.endPropertyChanges();return this},isEqual:function(a){if(!a){return false}if(a==this){return true}var b=a.get("length");if(b!=this.get("length")){return false}while(--b>=0){if(!SC.isEqual(a.objectAt(b),this.objectAt(b))){return false}}return true},compact:function(){return this.without(null)},without:function(b){if(this.indexOf(b)<0){return this}var a=[];this.forEach(function(c){if(c!==b){a[a.length]=c}});return a},uniq:function(){var a=[];this.forEach(function(b){if(a.indexOf(b)<0){a[a.length]=b}});return a},flatten:function(){var a=[];this.forEach(function(b){if(b&&b.isEnumerable){a=a.pushObjects(b.flatten())}else{a.pushObject(b)}});return a},max:function(){return Math.max.apply(Math,this)},min:function(){return Math.min.apply(Math,this)},rangeObserverClass:SC.RangeObserver,contains:function(a){return this.indexOf(a)>=0},addRangeObserver:function(d,f,h,e){var a=this._array_rangeObservers;if(!a){a=this._array_rangeObservers=SC.CoreSet.create()}if(this._array_oldLength===undefined){this._array_oldLength=this.get("length")}var g=this.rangeObserverClass;var b=NO;var c=g.create(this,d,f,h,e,b);a.add(c);if(!this._array_isNotifyingRangeObservers){this._array_isNotifyingRangeObservers=YES;this.addObserver("[]",this,this._array_notifyRangeObservers)}return c},updateRangeObserver:function(b,a){return b.update(this,a)},removeRangeObserver:function(c){var b=c.destroy(this);var a=this._array_rangeObservers;if(a){a.remove(c)}return b},addArrayObservers:function(a){this._modifyObserverSet("add",a)},removeArrayObservers:function(a){this._modifyObserverSet("remove",a)},_modifyObserverSet:function(h,c){var e,b;var g=c.target||this;var a=c.willChange||"arrayWillChange";var f=c.didChange||"arrayDidChange";var d=c.context;if(typeof a==="string"){a=g[a]}if(typeof f==="string"){f=g[f]}e=this._kvo_for("_kvo_array_will_change",SC.ObserverSet);b=this._kvo_for("_kvo_array_did_change",SC.ObserverSet);e[h](g,a,d);b[h](g,f,d)},arrayContentWillChange:function(b,i,a){this._teardownContentObservers(b,i);var f,d,h,j;var g,c;var e=this._kvo_array_will_change;if(e){d=e.members;h=d.length;for(j=0;j<h;j++){f=d[j];g=f[0];c=f[1];c.call(g,b,i,a,this)}}},arrayContentDidChange:function(b,n,a){var d=this._array_rangeObservers,h,c,l;this.beginPropertyChanges();this.notifyPropertyChange("length");if(d&&d.length>0){l=this._array_rangeChanges;if(!l){l=this._array_rangeChanges=SC.IndexSet.create()}if(n===a){c=n}else{c=this.get("length")-b;if(n>a){c+=(n-a)}}l.add(b,c)}this._setupContentObservers(b,a);var g,f,k,m;var i,e;var j=this._kvo_array_did_change;if(j){if(b===undefined){b=0;n=this.get("length");a=0}f=j.members;k=f.length;for(m=0;m<k;m++){g=f[m];i=g[0];e=g[1];e.call(i,b,n,a,this)}}this.notifyPropertyChange("[]");this.endPropertyChanges();return this},_setupContentObservers:function(f,e){var c=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet);var d;var b;if(c.get("length")>0){d=this.slice(f,f+e);var a=this;c.forEach(function(g){b=SC.keyFor("_kvo_content_observers",g);a._kvo_for(b).forEach(function(h){d.forEach(function(i){a._resumeChainObservingForItemWithChainObserver(i,h)})})})}},_teardownContentObservers:function(e,a){var c=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet);var d;var b;if(c.get("length")>0){d=this.slice(e,e+a);c.forEach(function(f){b=SC.keyFor("_kvo_content_observers",f);d.forEach(function(g){g._kvo_for(b).forEach(function(h){h.destroyChain()})})})}},teardownEnumerablePropertyChains:function(b){var a=this._kvo_enumerable_property_chains;if(a){a.forEach(function(g){var d,c=b.get("length"),i=SC.guidFor(g),f,h,e="_kvo_enumerable_property_clones";g.notifyPropertyDidChange();for(d=0;d<c;d++){h=b.objectAt(d);f=h[e][i];f.deactivate();delete h[e][i]}},this)}return this},setupEnumerablePropertyChains:function(b){var a=this._kvo_enumerable_property_chains;if(a){a.forEach(function(e){var d,c=b.get("length");e.notifyPropertyDidChange();c=b.get("length");for(d=0;d<c;d++){this._clonePropertyChainToItem(e,b.objectAt(d))}},this)}return this},registerDependentKeyWithChain:function(e,c){var b="_kvo_enumerable_property_chains",f,d,g,a;f=this._kvo_for(b,SC.CoreSet);f.add(c);this.forEach(function(h){this._clonePropertyChainToItem(c,h)},this)},_clonePropertyChainToItem:function(c,d){var e=SC.clone(c),b="_kvo_enumerable_property_clones",a;e.object=d;a=d[b]=d[b]||{};a[SC.guidFor(c)]=e;e.activate(d)},removeDependentKeyWithChain:function(f,d){var b="_kvo_enumerable_property_chains",c="_kvo_enumerable_property_clones",g,e,h,a;this.forEach(function(i){i.removeDependentKeyWithChain(f,d);a=i[c];h=a[SC.guidFor(d)];h.deactivate(i)},this)},_resumeChainObservingForItemWithChainObserver:function(d,a){var b=SC.clone(a.next);var c=b.property;b.object=d;d.addObserver(c,b,b.propertyDidChange);if(a.root.tails){a.root.tails.pushObject(b.tail())}b.propertyDidChange();d._kvo_for(SC.keyFor("_kvo_content_observers",c)).push(b)},_addContentObserver:function(a){var b=a.next.property;this._kvo_for("_kvo_content_observed_keys",SC.CoreSet).push(b);var c=SC.keyFor("_kvo_content_observers",b);this._kvo_for(c).push(a);this._setupContentObservers(0,a.object.get("length"))},_removeContentObserver:function(a){var e,c;var d=this._kvo_content_observed_keys;var b=a.next.property;if(d.contains(b)){c=SC.keyFor("_kvo_content_observers",b);e=this._kvo_for(c);e.removeObject(a);this._teardownContentObservers(0,a.object.get("length"));if(e.length===0){this._kvo_for("_kvo_content_observed_keys").remove(b)}}},_array_notifyRangeObservers:function(){var c=this._array_rangeObservers,d=this._array_rangeChanges,b=c?c.length:0,a,e;if(b>0&&d&&d.length>0){for(a=0;a<b;a++){c[a].rangeDidChange(d)}d.clear()}}};SC.Array=SC.mixin({},SC.Enumerable,SC.CoreArray);sc_require("mixins/array");SC.supplement(Array.prototype,SC.CoreArray);SC.mixin(Array.prototype,{replace:function(b,e,d){if(this.isFrozen){throw SC.FROZEN_ERROR}var c;var a=d?(d.get?d.get("length"):d.length):0;this.arrayContentWillChange(b,e,a);if(a===0){this.splice(b,e)}else{c=[b,e].concat(d);this.splice.apply(this,c)}this.beginPropertyChanges();this.arrayContentDidChange(b,e,a);this.enumerableContentDidChange(b,e,a-e);this.endPropertyChanges();return this},unknownProperty:function(b,c){var a=this.reducedProperty(b,c);if((c!==undefined)&&a===undefined){a=this[b]=c}return a}});if(Array.prototype.indexOf===SC.CoreArray.indexOf){Array.prototype.indexOf=function(d,c){var b,a=this.length;if(c===undefined){c=0}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b<a;b++){if(this[b]===d){return b}}return -1}}if(Array.prototype.lastIndexOf===SC.CoreArray.lastIndexOf){Array.prototype.lastIndexOf=function(d,c){var b,a=this.length;if(c===undefined){c=a-1}else{c=(c<0)?Math.ceil(c):Math.floor(c)}if(c<0){c+=a}for(b=c;b>=0;b--){if(this[b]===d){return b}}return -1}}if(!Date.now){Date.now=function(){return new Date().getTime()}}SC.String={_scs_valueForKey:function(e,g,c){var a,f,d,b=e.indexOf(":");if(b>-1){a=e.substr(b+1);e=e.substr(0,b)}f=g[e];d=g[e+"Formatter"];if(d){f=d(f,a)}else{if(a){throw"String.fmt was given a formatting string, but key `"+e+"` has no formatter! String: "+c}}return f},fmt:function(b,a){var c=0,d=undefined,e;if(a){d=a[0]}return b.replace(/%\{(.*?)\}/g,function(f,g){e=YES;if(!d){throw"Cannot use named parameters with `fmt` without a data hash. String: '"+b+"'"}return SC.String._scs_valueForKey(g,d,b)}).replace(/%@([0-9]+)?/g,function(g,f){if(e){throw"Invalid attempt to use both named parameters and indexed parameters. String: '"+b+"'"}f=f?parseInt(f,10)-1:c++;if(a[f]!==undefined){return a[f]}else{return""}})},w:function(f){var d=[],e=f.split(" "),b=e.length,c,a=0;for(a=0;a<b;++a){c=e[a];if(c.length!==0){d.push(c)}}return d}};sc_require("system/string");SC.mixin(String.prototype,{fmt:function(){return SC.String.fmt(this,arguments)},w:function(){return SC.String.w(this)}});SC.Comparable={isComparable:YES,compare:function(d,c){throw"%@.compare() is not implemented".fmt(this.toString())}};SC.Copyable={isCopyable:YES,copy:function(a){var b=SC._object_className(this.constructor);throw"%@.copy() is not implemented".fmt(b)},frozenCopy:function(){var a=this.get?this.get("isFrozen"):this.isFrozen;if(a===YES){return this}else{if(a===undefined){throw"%@ does not support freezing".fmt(this)}else{return this.copy().freeze()}}}};SC.mixin(Array.prototype,SC.Copyable);Array.prototype.copy=function(b){var c=this.slice(),a;if(b){a=c.length;while(a--){c[a]=SC.copy(c[a],true)}}return c};SC.FROZEN_ERROR=new Error("Cannot modify a frozen object");SC.Freezable={isFreezable:YES,isFrozen:NO,freeze:function(){if(this.set){this.set("isFrozen",YES)}else{this.isFrozen=YES}return this}};SC.mixin(Array.prototype,SC.Freezable);sc_require("mixins/enumerable");sc_require("mixins/observable");sc_require("mixins/freezable");sc_require("mixins/copyable");SC.Set=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,{create:function(c){var d,b,e=SC.Set._pool,f=this.isObservable,a;if(!f&&c===undefined&&e.length>0){return e.pop()}else{d=SC.beget(this);if(f){d.initObservable()}if(c&&c.isEnumerable&&c.get("length")>0){d.isObservable=NO;if(c.isSCArray){a=c.get("length");for(b=0;b<a;b++){d.add(c.objectAt(b))}}else{if(c.isSet){a=c.length;for(b=0;b<a;b++){d.add(c[b])}}else{c.forEach(function(g){d.add(g)},this)}}d.isObservable=f}}return d},isSet:YES,length:0,firstObject:function(){return(this.length>0)?this[0]:undefined}.property(),clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}this.length=0;return this},contains:function(b){if(b===null){return NO}var a=this[SC.hashFor(b)];return(!SC.none(a)&&(a<this.length)&&(this[a]===b))},isEqual:function(a){if(!a||!a.isSet||(a.get("length")!==this.get("length"))){return NO}var b=this.get("length");while(--b>=0){if(!a.contains(this[b])){return NO}}return YES},addSetObserver:function(a){if(!this.setObservers){this.setObservers=SC.CoreSet.create()}this.setObservers.add(a)},removeSetObserver:function(a){if(!this.setObservers){return}this.setObservers.remove(a)},add:function(e){if(this.isFrozen){throw SC.FROZEN_ERROR}if(SC.none(e)){return this}var c,d=((c=e.hash)&&(typeof c==="function"))?c.call(e):SC.guidFor(e),b=this[d],a=this.length;if((b>=a)||(this[b]!==e)){this[a]=e;this[d]=a;this.length=a+1;if(this.setObservers){this.didAddItem(e)}}if(this.isObservable){this.enumerableContentDidChange()}return this},addEach:function(c){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!c||!c.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)}var a,b=this.isObservable;if(b){this.beginPropertyChanges()}if(c.isSCArray){a=c.get("length");while(--a>=0){this.add(c.objectAt(a))}}else{if(c.isSet){a=c.length;while(--a>=0){this.add(c[a])}}else{c.forEach(function(d){this.add(d)},this)}}if(b){this.endPropertyChanges()}return this},remove:function(f){if(this.isFrozen){throw SC.FROZEN_ERROR}if(f===null||f===undefined){return this}var c,d=(f&&(c=f.hash)&&(typeof c===SC.T_FUNCTION))?c.call(f):SC.guidFor(f),b=this[d],a=this.length,e;if((b===null||b===undefined)||(b>=a)||(this[b]!==f)){return this}delete this[d];if(b<(a-1)){e=this[b]=this[a-1];d=(e&&(c=e.hash)&&(typeof c===SC.T_FUNCTION))?c.call(e):SC.guidFor(e);this[d]=b}this.length=a-1;if(this.isObservable){this.enumerableContentDidChange()}if(this.setObservers){this.didRemoveItem(f)}return this},pop:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}var a=(this.length>0)?this[this.length-1]:null;this.remove(a);return a},removeEach:function(c){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!c||!c.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)}var a,b=this.isObservable;if(b){this.beginPropertyChanges()}if(c.isSCArray){a=c.get("length");while(--a>=0){this.remove(c.objectAt(a))}}else{if(c.isSet){a=c.length;while(--a>=0){this.remove(c[a])}}else{c.forEach(function(d){this.remove(d)},this)}}if(b){this.endPropertyChanges()}return this},copy:function(){return this.constructor.create(this)},destroy:function(){this.isFrozen=NO;if(!this.isObservable){SC.Set._pool.push(this.clear())}return this},forEach:function(c,d){var b=this.length;if(!d){d=this}for(var a=0;a<b;a++){c.call(d,this[a],a,this)}return this},toString:function(){var b=this.length,a,c=[];for(a=0;a<b;a++){c[a]=this[a]}return"SC.Set<%@>".fmt(c.join(","))},didAddItem:function(c){var d=this.setObservers;if(!d){return}var b=d.length,a;for(a=0;a<b;a++){d[a].didAddItem(this,c)}},didRemoveItem:function(c){var d=this.setObservers;if(!d){return}var b=d.length,a;for(a=0;a<b;a++){d[a].didRemoveItem(this,c)}},_pool:[],isObservable:YES});SC.Set.constructor=SC.Set;SC.Set.clone=SC.Set.copy;SC.Set.push=SC.Set.unshift=SC.Set.add;SC.Set.shift=SC.Set.pop;SC.Set.addObject=SC.Set.add;SC.Set.removeObject=SC.Set.remove;SC.Set._pool=[];SC.CoreSet=SC.beget(SC.Set);SC.CoreSet.isObservable=NO;SC.CoreSet.constructor=SC.CoreSet;sc_require("mixins/observable");sc_require("system/set");SC.Observers={queue:[],addObserver:function(c,d,e,b){var a;if(typeof c==="string"){a=SC.tupleForPropertyPath(c,b)}else{a=c}if(a&&a[0].addObserver){a[0].addObserver(a[1],d,e)}else{this.queue.push([c,d,e,b])}},removeObserver:function(f,g,h,d){var c,b,a,e;a=SC.tupleForPropertyPath(f,d);if(a){a[0].removeObserver(a[1],g,h)}c=this.queue.length;b=this.queue,newQueue=undefined;while(--c>=0){e=b[c];if(e[0]!==f||e[1]!==g||e[2]!==h||e[3]!==d){if(!newQueue){newQueue=[]}newQueue.push(e)}}this.queue=newQueue||this.queue},addPendingRangeObserver:function(a){var b=this.rangeObservers;if(!b){b=this.rangeObservers=SC.CoreSet.create()}b.add(a);return this},_TMP_OUT:[],flush:function(b){var g=this.queue,d,a=g.length;if(g&&a>0){var k=(this.queue=[]);for(d=0;d<a;d++){var l=g[d];if(!l){continue}var h=SC.tupleForPropertyPath(l[0],l[3]);if(h&&h[0].addObserver){h[0].addObserver(h[1],l[1],l[2])}else{k.push(l)}}}if(b._kvo_needsRangeObserver){var j=this.rangeObservers,f=j?j.get("length"):0,c=this._TMP_OUT,e;for(d=0;d<f;d++){e=j[d];if(e.setupPending(b)){c.push(e)}}if(c.length>0){j.removeEach(c)}c.length=0;b._kvo_needsRangeObserver=false}},isObservingSuspended:0,_pending:SC.CoreSet.create(),objectHasPendingChanges:function(a){this._pending.add(a)},suspendPropertyObserving:function(){this.isObservingSuspended++},resumePropertyObserving:function(){var c;if(--this.isObservingSuspended<=0){c=this._pending;this._pending=SC.CoreSet.create();var b,a=c.length;for(b=0;b<a;b++){c[b]._notifyPropertyObservers()}c.clear();c=null}}};sc_require("core");sc_require("mixins/observable");sc_require("private/observer_queue");sc_require("mixins/array");sc_require("system/set");SC.BENCHMARK_OBJECTS=NO;SC._detect_base=function _detect_base(c,b,a){return function d(){var f=b[a],e;if(!f){throw new Error("No '"+a+"' method was found on the superclass")}if(c.isEnhancement){e=Array.prototype.slice.call(arguments,1)}else{e=arguments}return f.apply(this,e)}};SC._object_extend=function _object_extend(g,f,n){if(!f){throw"SC.Object.extend expects a non-null value.  Did you forget to 'sc_require' something?  Or were you passing a Protocol to extend() as if it were a mixin?"}g._kvo_cloned=null;var x,m,t,e,h=g.concatenatedProperties,k=SC.K,c,b;m=(h)?h.length:0;var a=(m>0)?{}:null;while(--m>=0){x=h[m];c=g[x];b=f[x];if(c){if(!(c instanceof Array)){c=SC.$A(c)}a[x]=(b)?c.concat(b):b}else{if(!(b instanceof Array)){b=SC.$A(b)}a[x]=b}}var w=g._bindings,l=NO,u=g._observers,v=NO,i=g._properties,d=NO,q,j,o,p;var s=g.outlets,r=NO;if(f.outlets){s=(s||SC.EMPTY_ARRAY).concat(f.outlets);r=YES}for(x in f){if(x==="_kvo_cloned"){continue}if(!f.hasOwnProperty(x)){continue}p=(a.hasOwnProperty(x)?a[x]:null)||f[x];if(x.length>7&&x.slice(-7)==="Binding"){if(!l){w=(w||SC.EMPTY_ARRAY).slice();l=YES}if(w===null){w=(g._bindings||SC.EMPTY_ARRAY).slice()}w[w.length]=x}else{if(p&&(p instanceof Function)){if(!p.superclass&&(p!==(e=g[x]))){p.superclass=e||k;p.base=n?SC._detect_base(p,n,x):e||k}if(p.propertyPaths){if(!v){u=(u||SC.EMPTY_ARRAY).slice();v=YES}u[u.length]=x}if(q=p.localPropertyPaths){j=q.length;while(--j>=0){o=g._kvo_for(SC.keyFor("_kvo_local",q[j]),SC.CoreSet);o.add(x);g._kvo_for("_kvo_observed_keys",SC.CoreSet).add(q[j])}}if(p.dependentKeys){if(!d){i=(i||SC.EMPTY_ARRAY).slice();d=YES}i[i.length]=x}if(p.autoconfiguredOutlet){if(!r){s=(s||SC.EMPTY_ARRAY).slice();r=YES}s[s.length]=x}if(p.isEnhancement){p=SC._enhance(g[x]||k,p)}}}g[x]=p}if(f.hasOwnProperty("toString")){x="toString";p=(a.hasOwnProperty(x)?a[x]:null)||f[x];if(!p.superclass&&(p!==(e=g[x]))){p.superclass=p.base=e||k}g[x]=p}g._bindings=w||[];g._observers=u||[];g._properties=i||[];g.outlets=s||[];return g};SC._enhance=function(b,a){return function(){var d=Array.prototype.slice.call(arguments,0),c=this;d.unshift(function(){return b.apply(c,arguments)});return a.apply(this,d)}};SC.Object=function(a){this.__sc_super__=SC.Object.prototype;return this._object_init(a)};SC.mixin(SC.Object,{mixin:function(b){var a=arguments.length,c;for(c=0;c<a;c++){SC.mixin(this,arguments[c])}return this},superclass:null,extend:function(e){var d=SC.BENCHMARK_OBJECTS;if(d){SC.Benchmark.start("SC.Object.extend")}var g,c=function(h){this.__sc_super__=c.prototype;return this._object_init(h)};for(g in this){if(!this.hasOwnProperty(g)){continue}c[g]=this[g]}if(this.hasOwnProperty("toString")){c.toString=this.toString}c.superclass=this;c.__sc_super__=this.prototype;SC.generateGuid(c,"sc");c.subclasses=SC.Set.create();this.subclasses.add(c);var f=(c.prototype=SC.beget(this.prototype)),b,a=arguments.length;for(b=0;b<a;b++){SC._object_extend(f,arguments[b],c.__sc_super__)}f.constructor=c;if(d){SC.Benchmark.end("SC.Object.extend")}return c},reopen:function(b){var a;a=SC._object_extend(this.prototype,b,this.__sc_super__);if(this.subclasses){this.subclasses.forEach(function(d,c){var e,f;for(e in b){if(!b.hasOwnProperty(e)){continue}f=b[e];if(d.prototype.hasOwnProperty(e)){delete b[e]}if(f&&(f instanceof Function)&&(f.isEnhancement)){delete b[e]}}d.reopen(b)},this)}return a},create:function(){var b=this,a=new b(arguments);if(SC.ObjectDesigner){SC.ObjectDesigner.didCreateObject(a,SC.$A(arguments))}return a},isClass:YES,subclasses:SC.Set.create(),toString:function(){return SC._object_className(this)},subclassOf:function(b){if(this===b){return NO}var a=this;while(a=a.superclass){if(a===b){return YES}}return NO},hasSubclass:function(a){return(a&&a.subclassOf)?a.subclassOf(this):NO},kindOf:function(a){return(this===a)||this.subclassOf(a)},design:function(){if(this.isDesign){return this}var a=this.extend.apply(this,arguments);a.isDesign=YES;if(SC.ObjectDesigner){SC.ObjectDesigner.didLoadDesign(a,this,SC.A(arguments))}return a}});SC.Object.prototype={_kvo_enabled:YES,_object_init:function(c){var b,a=(c)?c.length:0;for(b=0;b<a;b++){SC._object_extend(this,c[b],this.__sc_super__)}SC.generateGuid(this,"sc");this.init();var d=this.initMixin;a=(d)?d.length:0;for(b=0;b<a;b++){d[b].call(this)}return this},mixin:function(){var b,a=arguments.length,c;for(b=0;b<a;b++){SC._object_extend(this,arguments[b])}this._observableInited=NO;this.initObservable();for(b=0;b<a;b++){c=arguments[b].initMixin;if(c){c.call(this)}}return this},init:function(){this.initObservable();return this},isDestroyed:NO,destroy:function(){if(this.get("isDestroyed")){return this}this.set("isDestroyed",YES);var b,c=this.destroyMixin,a=(c)?c.length:0;for(b=0;b<a;b++){c[b].call(this)}this.bindings.invoke("disconnect");this.bindings=null;return this},isObject:true,respondsTo:function(a){return !!(this[a] instanceof Function)},tryToPerform:function(b,c,a){return this.respondsTo(b)&&(this[b](c,a)!==NO)},superclass:function(b){var a=arguments.callee.caller;if(!a){throw"superclass cannot determine the caller method"}return a.superclass?a.superclass.apply(this,arguments):null},instanceOf:function(a){return this.constructor===a},kindOf:function(a){return this.constructor.kindOf(a)},toString:function(){if(!this._object_toString){var a=SC._object_className(this.constructor),b=a+":"+SC.guidFor(this);if(a){this._object_toString=b}else{return b}}return this._object_toString},awake:function(){var d=this.outlets,b,a,c;for(b=0,a=d.length;b<a;++b){c=d[b];this.get(c)}this.bindings.invoke("sync")},invokeOnce:function(a){SC.RunLoop.currentRunLoop.invokeOnce(this,a);return this},invokeLast:function(a){SC.RunLoop.currentRunLoop.invokeLast(this,a);return this},invokeNext:function(a){SC.RunLoop.currentRunLoop.invokeNext(this,a);return this},concatenatedProperties:["concatenatedProperties","initMixin","destroyMixin"]};SC.Object.prototype.constructor=SC.Object;SC.mixin(SC.Object.prototype,SC.Observable);function findClassNames(){if(SC._object_foundObjectClassNames){return}SC._object_foundObjectClassNames=true;var b=[],c=false;var a=function(d,f,j){var l,i,h;j--;if(b.indexOf(f)>=0){return}b.push(f);for(var g in f){if(g=="__scope__"){continue}if(g=="superclass"){continue}if(g=="__SC__"){g="SC"}if(!g.match(/^[A-Z0-9]/)){continue}if(g=="SC"){if(c){continue}c=true}l=(d)?[d,g].join("."):g;i=f[g];try{h=SC.typeOf(i)}catch(k){break}switch(h){case SC.T_CLASS:if(!i._object_className){i._object_className=l}if(j>=0){a(l,i,j)}break;case SC.T_OBJECT:if(j>=0){a(l,i,j)}break;case SC.T_HASH:if(((d)||(l==="SC"))&&(j>=0)){a(l,i,j)}break;default:break}}};window.__SC__=SC;a(null,window,2)}SC.instanceOf=function(a,b){return !!(a&&a.constructor===b)};SC.kindOf=function(a,b){if(a&&!a.isClass){a=a.constructor}return !!(a&&a.kindOf&&a.kindOf(b))};SC._object_className=function(b){if(SC.isReady===NO){return""}if(!b._object_className){findClassNames()}if(b._object_className){return b._object_className}var a=b;while(a&&!a._object_className){a=a.superclass}return(a&&a._object_className)?a._object_className:"Anonymous"};sc_require("system/object");SC._PropertyChain=SC.Object.extend({object:null,property:null,target:null,toInvalidate:null,nextProperty:null,activate:function(b){var a=this.get("object"),c=this.get("property"),d;if(a&&a!==b){this.deactivate()}this.set("object",b);if(b&&c!=="@each"){b.registerDependentKeyWithChain(c,this)}if(this.next){d=b?b.get(c):undefined;this.next.activate(d)}return this},deactivate:function(){var a=this.get("object"),b=this.get("property");if(a){a.removeDependentKeyWithChain(b,this)}if(this.next){this.next.deactivate()}return this},notifyPropertyDidChange:function(){var d=this.get("target"),c=this.get("toInvalidate"),b,a;d.propertyDidChange(c);if(this.next){b=this.get("object");a=b.get(this.get("property"));this.next.activate(a)}}});SC._PropertyChain.createChain=function(h,g,e){var f=h.split(".");var a=f.length,d=1;var b=SC._PropertyChain.create({property:f[0],target:g,toInvalidate:e,nextProperty:f[1]});b.set("length",a);var c=b;while(--a>=1){c=c.next=SC._PropertyChain.create({property:f[d],target:g,toInvalidate:e,nextProperty:f[++d]});c.set("length",a)}return b};sc_require("ext/function");sc_require("system/object");SC.LOG_BINDINGS=NO;SC.BENCHMARK_BINDING_NOTIFICATIONS=NO;SC.BENCHMARK_BINDING_SETUP=NO;SC.MULTIPLE_PLACEHOLDER="@@MULT@@";SC.NULL_PLACEHOLDER="@@NULL@@";SC.EMPTY_PLACEHOLDER="@@EMPTY@@";SC.Binding={beget:function(b){var a=SC.beget(this);a.parentBinding=this;if(b!==undefined){a=a.from(b)}return a},builder:function(){var b=this,a=function(c){return b.beget().from(c)};a.beget=function(){return b.beget()};return a},from:function(b,a){if(!b){return this}var c=(this===SC.Binding)?this.beget():this;c._fromPropertyPath=b;c._fromRoot=a;c._fromTuple=null;return c},to:function(b,a){var c=(this===SC.Binding)?this.beget():this;c._toPropertyPath=b;c._toRoot=a;c._toTuple=null;return c},connect:function(){if(this.isConnected){return this}this.isConnected=YES;this._connectionPending=YES;this._syncOnConnect=YES;SC.Binding._connectQueue.add(this);if(!SC.RunLoop.isRunLoopInProgress()){this._scheduleSync()}return this},_connect:function(){if(!this._connectionPending){return}this._connectionPending=NO;var c,a,b=SC.BENCHMARK_BINDING_SETUP;if(b){SC.Benchmark.start("SC.Binding.connect()")}c=this._fromPropertyPath;a=this._fromRoot;if(typeof c==="string"){if(c.indexOf(".")===0){c=c.slice(1);if(!a){a=this._toRoot}}else{if(c.indexOf("*")===0){c=[this._fromRoot||this._toRoot,c.slice(1)];a=null}}}this._fromObserverData=[c,this,this.fromPropertyDidChange,a];SC.Observers.addObserver.apply(SC.Observers,this._fromObserverData);if(!this._oneWay){c=this._toPropertyPath;a=this._toRoot;this._toObserverData=[c,this,this.toPropertyDidChange,a];SC.Observers.addObserver.apply(SC.Observers,this._toObserverData)}if(b){SC.Benchmark.end("SC.Binding.connect()")}if(this._syncOnConnect){this._syncOnConnect=NO;if(b){SC.Benchmark.start("SC.Binding.connect().sync")}this.sync();if(b){SC.Benchmark.end("SC.Binding.connect().sync")}}},disconnect:function(){if(!this.isConnected){return this}if(this._connectionPending){this._connectionPending=NO}else{SC.Observers.removeObserver.apply(SC.Observers,this._fromObserverData);if(!this._oneWay){SC.Observers.removeObserver.apply(SC.Observers,this._toObserverData)}}this.isConnected=NO;return this},fromPropertyDidChange:function(c,b){var a=c?c.get(b):null;if(a!==this._bindingValue||b==="[]"){this._setBindingValue(c,b);this._changePending=YES;SC.Binding._changeQueue.add(this);this._scheduleSync()}},toPropertyDidChange:function(c,b){if(this._oneWay){return}var a=c.get(b);if(a!==this._transformedBindingValue){this._setBindingValue(c,b);this._changePending=YES;SC.Binding._changeQueue.add(this);this._scheduleSync()}},_scheduleSync:function(){if(SC.RunLoop.isRunLoopInProgress()||SC.Binding._syncScheduled){return}SC.Binding._syncScheduled=YES;setTimeout(function(){SC.run();SC.Binding._syncScheduled=NO},1)},_setBindingValue:function(b,a){this._bindingSource=b;this._bindingKey=a},_computeBindingValue:function(){var g=this._bindingSource,e=this._bindingKey,c,b;this._bindingValue=c=(g?g.getPath(e):null);var f=this._transforms;if(f){var a=f.length,d;for(b=0;b<a;b++){d=f[b];c=d(c,this)}}if(this._noError&&SC.typeOf(c)===SC.T_ERROR){c=null}this._transformedBindingValue=c},_connectQueue:SC.CoreSet.create(),_alternateConnectQueue:SC.CoreSet.create(),_changeQueue:SC.CoreSet.create(),_alternateChangeQueue:SC.CoreSet.create(),_changePending:NO,flushPendingChanges:function(){if(this._isFlushing){return NO}this._isFlushing=YES;SC.Observers.suspendPropertyObserving();var b=NO,c=SC.LOG_BINDINGS,a,d;while((a=this._connectQueue).length>0){this._connectQueue=this._alternateConnectQueue;this._alternateConnectQueue=a;while(d=a.pop()){d._connect()}}while((a=this._changeQueue).length>0){if(c){SC.Logger.log("Begin: Trigger changed bindings")}b=YES;this._changeQueue=this._alternateChangeQueue;this._alternateChangeQueue=a;while(d=a.pop()){d.applyBindingValue()}if(c){SC.Logger.log("End: Trigger changed bindings")}}this._isFlushing=NO;SC.Observers.resumePropertyObserving();return b},applyBindingValue:function(){this._changePending=NO;this._computeBindingTargets();this._computeBindingValue();var a=this._bindingValue,b=this._transformedBindingValue,c=SC.BENCHMARK_BINDING_NOTIFICATIONS,d=SC.LOG_BINDINGS;if(!this._oneWay&&this._fromTarget){if(d){SC.Logger.log("%@: %@ -> %@".fmt(this,a,b))}if(c){SC.Benchmark.start(this.toString()+"->")}this._fromTarget.setPathIfChanged(this._fromPropertyKey,a);if(c){SC.Benchmark.end(this.toString()+"->")}}if(this._toTarget){if(d){SC.Logger.log("%@: %@ <- %@".fmt(this,a,b))}if(c){SC.Benchmark.start(this.toString()+"<-")}this._toTarget.setPathIfChanged(this._toPropertyKey,b);if(c){SC.Benchmark.start(this.toString()+"<-")}}},sync:function(){if(!this.isConnected){return this}if(this._connectionPending){this._syncOnConnect=YES}else{this._computeBindingTargets();var c=this._fromTarget,b=this._fromPropertyKey;if(!c||!b){return this}if(!c.isObservable){SC.Logger.warn("Cannot bind '%@' to property '%@' on non-observable '%@'".fmt(this._toPropertyPath,b,c));return this}var a=c.getPath(b);if(a!==this._bindingValue||b==="[]"){this._setBindingValue(c,b);this._changePending=YES;SC.Binding._changeQueue.add(this)}}return this},_syncOnConnect:NO,_computeBindingTargets:function(){if(!this._fromTarget){var c,b,a;c=this._fromPropertyPath;b=this._fromRoot;if(typeof c==="string"){if(c.indexOf(".")===0){c=c.slice(1);if(!b){b=this._toRoot}}else{if(c.indexOf("*")===0){c=[b||this._toRoot,c.slice(1)];b=null}}}a=SC.tupleForPropertyPath(c,b);if(a){this._fromTarget=a[0];this._fromPropertyKey=a[1]}}if(!this._toTarget){c=this._toPropertyPath;b=this._toRoot;a=SC.tupleForPropertyPath(c,b);if(a){this._toTarget=a[0];this._toPropertyKey=a[1]}}},oneWay:function(c,a){if((a===undefined)&&(SC.typeOf(c)===SC.T_BOOL)){a=c;c=null}var b=this.from(c);if(b===SC.Binding){b=b.beget()}b._oneWay=(a===undefined)?YES:a;return b},transform:function(b){var c=(this===SC.Binding)?this.beget():this;var a=c._transforms;if(a&&(a===c.parentBinding._transform)){a=c._transforms=a.slice()}if(!a){a=c._transforms=[]}a.push(b);return c},resetTransforms:function(){var a=(this===SC.Binding)?this.beget():this;a._transforms=null;return a},noError:function(c,a){if((a===undefined)&&(SC.typeOf(c)===SC.T_BOOL)){a=c;c=null}var b=this.from(c);if(b===SC.Binding){b=b.beget()}b._noError=(a===undefined)?YES:a;return b},single:function(b,a){if(a===undefined){a=SC.MULTIPLE_PLACEHOLDER}return this.from(b).transform(function(e,d){if(e&&e.isEnumerable){var c=e.get("length");e=(c>1)?a:(c<=0)?null:e.firstObject()}return e})},notEmpty:function(b,a){if(a===undefined){a=SC.EMPTY_PLACEHOLDER}return this.from(b).transform(function(d,c){if(SC.none(d)||(d==="")||(SC.isArray(d)&&(d.get?d.get("length"):d.length)===0)){d=a}return d})},notNull:function(b,a){if(a===undefined){a=SC.EMPTY_PLACEHOLDER}return this.from(b).transform(function(d,c){if(SC.none(d)){d=a}return d})},multiple:function(a){return this.from(a).transform(function(b){if(!SC.isArray(b)){b=(b==null)?[]:[b]}return b})},bool:function(a){return this.from(a).transform(function(b){var c=SC.typeOf(b);if(c===SC.T_ERROR){return b}return(c==SC.T_ARRAY)?(b.length>0):(b==="")?NO:!!b})},and:function(b,a){var c=SC.Object.create({valueABinding:b,valueBBinding:a,and:function(){return(this.get("valueA")&&this.get("valueB"))}.property("valueA","valueB").cacheable()});return this.from("and",c).oneWay()},or:function(b,a){var c=SC.Object.create({valueABinding:b,valueBBinding:a,or:function(){return(this.get("valueA")||this.get("valueB"))}.property("valueA","valueB").cacheable()});return this.from("or",c).oneWay()},not:function(a){return this.from(a).transform(function(b){var c=SC.typeOf(b);if(c===SC.T_ERROR){return b}return !((c==SC.T_ARRAY)?(b.length>0):(b==="")?NO:!!b)})},isNull:function(a){return this.from(a).transform(function(b){var c=SC.typeOf(b);return(c===SC.T_ERROR)?b:SC.none(b)})},toString:function(){var c=this._fromRoot?"<%@>:%@".fmt(this._fromRoot,this._fromPropertyPath):this._fromPropertyPath;var b=this._toRoot?"<%@>:%@".fmt(this._toRoot,this._toPropertyPath):this._toPropertyPath;var a=this._oneWay?"[oneWay]":"";return"SC.Binding%@(%@ -> %@)%@".fmt(SC.guidFor(this),c,b,a)}};SC.binding=function(b,a){return SC.Binding.from(b,a)};sc_require("ext/function");SC.Error=SC.Object.extend({code:-1,message:"",errorValue:null,errorObject:function(){return this}.property().cacheable(),label:null,toString:function(){return"SC.Error:%@:%@ (%@)".fmt(SC.guidFor(this),this.get("message"),this.get("code"))},isError:YES});SC.Error.desc=function(d,a,e,c){var b={message:d};if(a!==undefined){b.label=a}if(c!==undefined){b.code=c}if(e!==undefined){b.errorValue=e}return this.create(b)};SC.$error=function(b,a,d,e){return SC.Error.desc(b,a,d,e)};SC.ok=function(a){return(a!==false)&&!(a&&a.isError)};SC.$ok=SC.ok;SC.val=function(a){if(a&&a.isError){return a.get?a.get("errorValue"):null}else{return a}};SC.$val=SC.val;SC.Error.HAS_MULTIPLE_VALUES=-100;sc_require("mixins/enumerable");sc_require("mixins/observable");sc_require("mixins/freezable");sc_require("mixins/copyable");SC.IndexSet=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,SC.Copyable,{_sc_sliceContent:function(e){if(e.length<1000){return e.slice()}var d=0,a=[],b=e[0];while(b!==0){a[d]=b;d=(b<0)?(0-b):b;b=e[d]}a[d]=0;this._hint(0,d,a);return a},create:function(c,b){var a=SC.beget(this);a.initObservable();a.registerDependentKey("min","[]");if(c&&c.isIndexSet){a._content=this._sc_sliceContent(c._content);a.max=c.max;a.length=c.length;a.source=c.source}else{a._content=[0];if(c!==undefined){a.add(c,b)}}return a},isIndexSet:YES,HINT_SIZE:256,length:0,max:0,min:function(){var a=this._content,b=a[0];return(b===0)?-1:(b>0)?0:Math.abs(b)}.property("[]").cacheable(),firstObject:function(){return(this.get("length")>0)?this.get("min"):undefined}.property(),rangeStartForIndex:function(c){var f=this._content,a=this.get("max"),b,e,d;if(c>=a){return a}if(Math.abs(f[c])>c){return c}d=c-(c%SC.IndexSet.HINT_SIZE);b=f[d];if(b<0||b>c){b=d}e=f[b];if(e===undefined){e=this.rangeStartForIndex(b)}else{e=Math.abs(e)}while(e<c){b=e;e=Math.abs(f[b])}return b},isEqual:function(c){if(c===this){return YES}if(!c||!c.isIndexSet||(c.max!==this.max)||(c.length!==this.length)){return NO}var e=this._content,b=c._content,d=0,a=e[d];do{if(b[d]!==a){return NO}d=Math.abs(a);a=e[d]}while(d!==0);return YES},indexBefore:function(b){if(b===0){return -1}b--;var c=this._content,a=this.get("max"),d=this.rangeStartForIndex(b);if(!c){return null}while((d===a)||(c[d]<0)){if(d===0){return -1}b=d-1;d=this.rangeStartForIndex(b)}return b},indexAfter:function(b){var d=this._content,a=this.get("max"),e,c;if(!d||(b>=a)){return -1}b++;e=this.rangeStartForIndex(b);c=d[e];while(c<0){if(c===0){return -1}b=e=Math.abs(c);c=d[e]}return b},contains:function(g,c){var b,f,a,e,d;if(c===undefined){if(g===null||g===undefined){return NO}if(typeof g===SC.T_NUMBER){c=1}else{if(g&&g.isIndexSet){if(g===this){return YES}b=g._content;f=0;a=b[f];while(a!==0){if((a>0)&&!this.contains(f,a-f)){return NO}f=Math.abs(a);a=b[f]}return YES}else{c=g.length;g=g.start}}}e=this.rangeStartForIndex(g);d=this._content[e];return(d>0)&&(e<=g)&&(d>=(g+c))},intersects:function(f,c){var b,e,a,d;if(c===undefined){if(typeof f===SC.T_NUMBER){c=1}else{if(f&&f.isIndexSet){if(f===this){return YES}b=f._content;e=0;a=b[e];while(a!==0){if((a>0)&&this.intersects(e,a-e)){return YES}e=Math.abs(a);a=b[e]}return NO}else{c=f.length;f=f.start}}}e=this.rangeStartForIndex(f);b=this._content;a=b[e];d=f+c;while(e<d){if(a===0){return NO}if((a>0)&&(a>f)){return YES}e=Math.abs(a);a=b[e]}return NO},without:function(b,a){if(b===this){return SC.IndexSet.create()}return this.clone().remove(b,a)},replace:function(c,a){if(a===undefined){if(typeof c===SC.T_NUMBER){a=1}else{if(c&&c.isIndexSet){this._content=this._sc_sliceContent(c._content);this.beginPropertyChanges().set("max",c.max).set("length",c.length).set("source",c.source).enumerableContentDidChange();this.endPropertyChanges();return this}else{a=c.length;c=c.start}}}var b=this.length;this._content.length=1;this._content[0]=0;this.length=this.max=0;return this.add(c,a)},add:function(a,b){if(this.isFrozen){throw SC.FROZEN_ERROR}var e,i,d;if(a&&a.isIndexSet){e=a._content;if(!e){return this}i=0;d=e[0];while(d!==0){if(d>0){this.add(i,d-i)}i=d<0?0-d:d;d=e[i]}return this}else{if(b===undefined){if(a===null||a===undefined){return this}else{if(typeof a===SC.T_NUMBER){b=1}else{b=a.length;a=a.start}}}else{if(b===null){b=1}}}if(b<=0){return this}var f=this.get("max"),c=f,h,g;e=this._content;if(a===f){if(a>0){i=this.rangeStartForIndex(a-1);d=e[i];if(d>0){delete e[f];e[i]=f=a+b;a=i}else{e[f]=f=a+b}}else{e[a]=f=b}e[f]=0;this.set("max",f);this.set("length",this.length+b);b=f-a}else{if(a>f){e[f]=0-a;e[a]=a+b;e[a+b]=0;this.set("max",a+b);this.set("length",this.length+b);b=a+b-f;a=f}else{i=this.rangeStartForIndex(a);d=e[i];f=a+b;h=0;if((a>0)&&(i===a)&&(d<=0)){i=this.rangeStartForIndex(a-1);d=e[i]}if(d<0){e[i]=0-a;if(Math.abs(d)>f){e[a]=0-f;e[f]=d}else{e[a]=d}}else{a=i;if(d>f){f=d}}i=a;while(i<f){g=e[i];if(g===0){e[f]=0;d=f;h+=f-i}else{d=Math.abs(g);if(d>f){e[f]=g;d=f}if(g<0){h+=d-i}}delete e[i];i=d}if((i=e[f])>0){delete e[f];f=i}e[a]=f;if(f>c){this.set("max",f)}this.set("length",this.get("length")+h);b=f-a}}this._hint(a,b);if(h!==0){this.enumerableContentDidChange()}return this},remove:function(a,b){if(this.isFrozen){throw SC.FROZEN_ERROR}if(b===undefined){if(a===null||a===undefined){return this}else{if(typeof a===SC.T_NUMBER){b=1}else{if(a.isIndexSet){a.forEachRange(this.remove,this);return this}else{b=a.length;a=a.start}}}}if(b<=0){return this}var f=this.get("max"),c=f,e=this._content,j,d,i,g,h;if(a>=f){return this}j=this.rangeStartForIndex(a);d=e[j];h=a+b;i=0;if((a>0)&&(j===a)&&(d>0)){j=this.rangeStartForIndex(a-1);d=e[j]}if(d>0){e[j]=a;if(d>h){e[a]=h;e[h]=d}else{e[a]=d}}else{a=j;d=Math.abs(d);if(d>h){h=d}}j=a;while(j<h){g=e[j];if(g===0){e[h]=0;d=h}else{d=Math.abs(g);if(d>h){e[h]=g;d=h}if(g>0){i+=d-j}}delete e[j];j=d}if((j=e[h])<0){delete e[h];h=Math.abs(j)}if(e[h]===0){delete e[h];e[a]=0;this.set("max",a)}else{e[a]=0-h}this.set("length",this.get("length")-i);b=h-a;this._hint(a,b);if(i!==0){this.enumerableContentDidChange()}return this},_hint:function(g,d,c){if(c===undefined){c=this._content}var b=SC.IndexSet.HINT_SIZE,a=Math.abs(c[g]),f=g-(g%b)+b,e=g+d;while(f<e){while((a!==0)&&(a<=f)){g=a;a=Math.abs(c[g])}if(a===0){delete c[f]}else{if(f!==g){c[f]=g}}f+=b}},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}var a=this.length;this._content.length=1;this._content[0]=0;this.set("length",0).set("max",0);if(a>0){this.enumerableContentDidChange()}},addEach:function(b){if(this.isFrozen){throw SC.FROZEN_ERROR}this.beginPropertyChanges();var a=b.get("length");if(b.isSCArray){while(--a>=0){this.add(b.objectAt(a))}}else{if(b.isEnumerable){b.forEach(function(c){this.add(c)},this)}}this.endPropertyChanges();return this},removeEach:function(b){if(this.isFrozen){throw SC.FROZEN_ERROR}this.beginPropertyChanges();var a=b.get("length");if(b.isSCArray){while(--a>=0){this.remove(b.objectAt(a))}}else{if(b.isEnumerable){b.forEach(function(c){this.remove(c)},this)}}this.endPropertyChanges();return this},clone:function(){return SC.IndexSet.create(this)},inspect:function(){var e=this._content,b=e.length,a=0,c=[],d;for(a=0;a<b;a++){d=e[a];if(d!==undefined){c.push("%@:%@".fmt(a,d))}}return"SC.IndexSet<%@>".fmt(c.join(" , "))},forEachRange:function(f,d){var b=this._content,e=0,a=b[e],c=this.source;if(d===undefined){d=null}while(a!==0){if(a>0){f.call(d,e,a-e,this,c)}e=Math.abs(a);a=b[e]}return this},forEachIn:function(b,c,j,f){var g=this._content,i=0,h=0,d=b+c,a=this.source,e=g[i];if(f===undefined){f=null}while(e!==0){if(i<b){i=b}while((i<e)&&(i<d)){j.call(f,i++,h++,this,a)}if(i>=d){i=e=0}else{i=Math.abs(e);e=g[i]}}return this},lengthIn:function(g,d){var a=0;if(d===undefined){if(g===null||g===undefined){return 0}else{if(typeof g===SC.T_NUMBER){d=1}else{if(g.isIndexSet){g.forEachRange(function(i,h){a+=this.lengthIn(i,h)},this);return a}else{d=g.length;g=g.start}}}}if(this.get("length")===0){return 0}var c=this._content,f=0,b=c[f],e=g+d;while(f<e&&b!==0){if(b>0){a+=(b>e)?e-f:b-f}f=Math.abs(b);b=c[f]}return a},source:null,indexOf:function(d,c){var f=this.source;if(!f){throw"%@.indexOf() requires source".fmt(this)}var b=f.get("length"),e=this._content,g=e[0]<0?Math.abs(e[0]):0,a;while(g>=0&&g<b){a=f.indexOf(d,g);if(a<0){return -1}if(this.contains(a)){return a}g=a+1}return -1},lastIndexOf:function(d,c){var e=this.source;if(!e){throw"%@.lastIndexOf() requires source".fmt(this)}var b=e.get("length"),f=this.max-1,a;if(f>=b){f=b-1}while(f>=0){a=e.lastIndexOf(d,f);if(a<0){return -1}if(this.contains(a)){return a}f=a+1}return -1},forEachObject:function(g,e){var d=this.source;if(!d){throw"%@.forEachObject() requires source".fmt(this)}var c=this._content,f=0,a=0,b=c[f];if(e===undefined){e=null}while(b!==0){while(f<b){g.call(e,d.objectAt(f),f,d,this);f++}f=Math.abs(b);b=c[f]}return this},addObject:function(c,d){var e=this.source;if(!e){throw"%@.addObject() requires source".fmt(this)}var b=e.get("length"),f=0,a;while(f>=0&&f<b){a=e.indexOf(c,f);if(a>=0){this.add(a);if(d){return this}f=a++}else{return this}}return this},addObjects:function(b,a){b.forEach(function(c){this.addObject(c,a)},this);return this},removeObject:function(c,d){var e=this.source;if(!e){throw"%@.removeObject() requires source".fmt(this)}var b=e.get("length"),f=0,a;while(f>=0&&f<b){a=e.indexOf(c,f);if(a>=0){this.remove(a);if(d){return this}f=a+1}else{return this}}return this},removeObjects:function(b,a){b.forEach(function(c){this.removeObject(c,a)},this);return this},LOG_OBSERVING:NO,forEach:function(g,e){var c=this._content,f=0,a=0,d=this.source,b=c[f];if(e===undefined){e=null}while(b!==0){while(f<b){g.call(e,f++,a++,this,d)}f=Math.abs(b);b=c[f]}return this},nextObject:function(f,b,c){var e=this._content,d=c.next,a=this.get("max");if(b===null){b=d=0}else{if(b>=a){delete c.next;return null}else{b++}}if(b===d){do{b=Math.abs(d);d=e[b]}while(d<0);c.next=d}return b},toString:function(){var a=[];this.forEachRange(function(c,b){a.push(b===1?c:"%@..%@".fmt(c,c+b-1))},this);return"SC.IndexSet<%@>".fmt(a.join(","))},max:0});SC.IndexSet.slice=SC.IndexSet.copy=SC.IndexSet.clone;SC.IndexSet.EMPTY=SC.IndexSet.create().freeze();SC.json={encode:function(a){return JSON.stringify(a)},decode:function(a){return JSON.parse(a)}};if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());sc_require("ext/function");SC.LOGGER_LOG_DELIMITER=", ";SC.LOGGER_LOG_ERROR="ERROR: ";SC.LOGGER_LOG_INFO="INFO:  ";SC.LOGGER_LOG_WARN="WARN:  ";SC.LOGGER_LOG_DEBUG="DEBUG: ";SC.LOGGER_LOG_GROUP_HEADER="** %@";SC.LOGGER_LOG_GROUP_INDENTATION="    ";SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX="%@:  ";SC.LOGGER_LEVEL_DEBUG="debug";SC.LOGGER_LEVEL_INFO="info";SC.LOGGER_LEVEL_WARN="warn";SC.LOGGER_LEVEL_ERROR="error";SC.LOGGER_LEVEL_NONE="none";SC.Logger=SC.Object.create({messagePrefix:null,outputMessagePrefix:null,recordedMessagePrefix:null,logOutputLevel:null,logRecordingLevel:SC.LOGGER_LEVEL_NONE,recordedLogMessages:null,recordedLogMessagesMaximumLength:500,recordedLogMessagesPruningMinimumLength:100,debugEnabled:NO,exists:function(){return !SC.none(this.get("reporter"))}.property("reporter").cacheable(),fallBackOnAlert:NO,reporter:console,debug:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_DEBUG,YES,a,arguments)},debugWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_DEBUG,NO,null,arguments)},debugGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_DEBUG,a,arguments)},debugGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_DEBUG)},info:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_INFO,YES,a,arguments)},infoWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_INFO,NO,null,arguments)},infoGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_INFO,a,arguments)},infoGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_INFO)},warn:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_WARN,YES,a,arguments)},warnWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_WARN,NO,null,arguments)},warnGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_WARN,a,arguments)},warnGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_WARN)},error:function(a,b){SC.Logger._handleMessage(SC.LOGGER_LEVEL_ERROR,YES,a,arguments)},errorWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_ERROR,NO,null,arguments)},errorGroup:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_ERROR,a,arguments)},errorGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_ERROR)},outputRecordedLogMessages:function(n){if(!this.get("exists")){return}var r=this.get("reporter"),k=this.get("recordedLogMessages"),a=0,d=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX,q,o,b,c,g,h,e,f,t,m,l,p,s;if(k){for(q=0,o=k.length;q<o;++q){b=k[q];c=b.type;if(n){g=d.fmt(b.timestamp.toUTCString())}h=b.message;if(h){e=b.originalArguments;this._outputMessage(c,g,a,h,e)}else{m=b.indentation;t=b.title;l=m-a;if(r.group){if(Math.abs(l)>1){for(p=0,s=(l-1);p<s;++p){if(l>0){r.group()}else{r.groupEnd()}}}if(l>0){f=g?g:"";f+=t;r.group(f)}else{r.groupEnd()}}else{if(l>0){this._outputGroup(c,g,m-1,t)}}a=m}}}},stringifyRecordedLogMessages:function(){var j="",f=this.get("recordedLogMessages"),m=0,h=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX,d=this._LOG_FALLBACK_PREFIX_MAPPING,c=SC.LOGGER_LOG_GROUP_HEADER,e,a,o,l,r,q,g,p,n,k,b;if(f){for(e=0,a=f.length;e<a;++e){o=f[e];l=o.type;g=h.fmt(o.timestamp.toUTCString());g+=d[l]||"";r=o.message;if(r){q=o.originalArguments;p=g+this._indentation(m);p+=q?this._argumentsToString(q):r}else{k=o.indentation;n=o.title;b=k-m;if(b>0){p=g+this._indentation(m)+c.fmt(n)}m=k}j+=p+"\n"}}return j},log:function(){var a=this.get("reporter"),c=arguments[0],d=this.get("messagePrefix"),e=this.get("outputMessagePrefix"),b=NO;if(c&&SC.typeOf(c)===SC.T_STRING){if(d||e){if(d){c=d+c}if(e){c=e+c}arguments[0]=c}}if(this.get("exists")){if(typeof a.log==="function"){a.log.apply(a,arguments);b=YES}else{if(a.log){a.log(this._argumentsToArray(arguments));b=YES}}}if(!b&&this.get("fallBackOnAlert")){if(this.get("exists")&&(typeof a.alert==="function")){a.alert(arguments);b=YES}else{alert(arguments);b=YES}}return b},group:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.group==="function")){a.group(b)}},groupEnd:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.groupEnd==="function")){a.groupEnd()}},dir:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.dir==="function")){a.dir.apply(a,arguments)}else{this.log.apply(this,arguments)}},dirxml:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.dirxml==="function")){a.dirxml.apply(a,arguments)}else{this.log.apply(this,arguments)}},profile:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.profile==="function")){a.profile(b);return YES}return NO},profileEnd:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.profileEnd==="function")){a.profileEnd(b);return YES}return NO},time:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.time==="function")){a.time(b);return YES}return NO},timeEnd:function(b){var a=this.get("reporter");if(this.get("exists")&&(typeof a.timeEnd==="function")){a.timeEnd(b);return YES}return NO},trace:function(){var a=this.get("reporter");if(this.get("exists")&&(typeof a.trace==="function")){a.trace();return YES}return NO},init:function(){arguments.callee.base.apply(this,arguments);if(!this.get("logOutputLevel")){if(SC.buildMode==="debug"){this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG)}else{this.set("logOutputLevel",SC.LOGGER_LEVEL_INFO)}}this.debugEnabledDidChange()},debugEnabledDidChange:function(){if(this.get("debugEnabled")){this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG)}}.observes("debugEnabled"),_handleMessage:function(l,n,p,o){var a=this._shouldOutputType(l),d=this._shouldRecordType(l),e,f,j,k,b,m,h,c,g;if(!(a||d)){return}e=(o&&o.length>1);if(n&&(SC.none(p)||(typeof p!=="string"))){n=NO}if(n){if(e){k=[];for(f=1,j=o.length;f<j;++f){k.push(o[f])}p=p.fmt.apply(p,k)}}h=this.get("messagePrefix");if(h){p=h+p}if(a){c=this.get("outputMessagePrefix");k=n?null:o;this._outputMessage(l,null,this._outputIndentationLevel,(c?c+p:p),k)}if(d){g=this.get("recordedMessagePrefix");m={type:l,message:p?(g?g+p:p):YES,timestamp:new Date()};if(!n&&e){m.originalArguments=o}this._addRecordedMessageEntry(m)}},_handleGroup:function(l,n,q){var a=this._shouldOutputType(l),e=this._shouldRecordType(l),f,g,j,k,p,d,c,h,b,m,o;if(!(a||e)){return}f=(q&&q.length>1);if(n&&f){k=[];for(g=1,j=q.length;g<j;++g){k.push(q[g])}n=n.fmt.apply(n,k)}if(a){this._outputGroup(l,null,this._outputIndentationLevel,n);this._outputIndentationLevel++}if(e){m=++this._recordingIndentationLevel;o={type:l,indentation:m,beginGroup:YES,title:n,timestamp:new Date()};this._addRecordedMessageEntry(o)}},_handleGroupEnd:function(d){var g=this._shouldOutputType(d),c=this._shouldRecordType(d),a,f,b,e;if(!(g||c)){return}if(g){this._outputIndentationLevel--;if(this.get("exists")){a=this.get("reporter");f=a.groupEnd;if(f){f.call(a)}}}if(c){b=--this._recordingIndentationLevel;e={type:d,indentation:b,timestamp:new Date()};this._addRecordedMessageEntry(e)}},_shouldOutputType:function(a){var c=this._LOG_LEVEL_MAPPING,d=c[a]||0,b=c[this.get("logOutputLevel")]||0;return(d<=b)},_shouldRecordType:function(a){var c=this._LOG_LEVEL_MAPPING,d=c[a]||0,b=c[this.get("logRecordingLevel")]||0;return(d<=b)},_outputMessage:function(h,g,i,l,k){if(!this.get("exists")){return}var d=this.get("reporter"),b,a,c,e,f,j;a=!d.group;c=d[h];if(c){if(!k){b=g?g:"";if(a){b+=this._indentation(i)}b+=l;d[h](b)}else{f=this._argumentsToArray(k);e="";if(g){e=g}if(a){e+=this._indentation(i)}if(e){f.splice(0,0,e)}if(c.apply){c.apply(d,f)}else{d[h](f)}}}else{if(d.log){e="";if(g){e=g}e+=this._LOG_FALLBACK_PREFIX_MAPPING[h]||"";if(a){e+=this._indentation(i)}if(!k){d.log(e+l)}else{f=this._argumentsToArray(k);if(e){f.splice(0,0,e)}d.log(f)}}}},_outputGroup:function(d,f,c,g){if(!this.get("exists")){return}var b=this.get("reporter"),e=b.group,a;if(e){a=f?f:"";a+=g;e.call(b,a)}else{if(b.log){a="";if(f){a=f}a+=this._LOG_FALLBACK_PREFIX_MAPPING[d]||"";a+=this._indentation(c);a+=SC.LOGGER_LOG_GROUP_HEADER.fmt(g);b.log(a)}}},_addRecordedMessageEntry:function(c){var b=this.get("recordedLogMessages"),a;if(!b){b=[];this.set("recordedLogMessages",b)}b.push(c);a=b.length;if(a>this.get("recordedLogMessagesMaximumLength")){b.splice(0,(a-this.get("recordedLogMessagesPruningMinimumLength")))}b.enumerableContentDidChange()},_argumentsToArray:function(c){var b=[],d,a;if(c){for(d=0,a=c.length;d<a;++d){b[d]=c[d]}}return b},_argumentsToString:function(){var c="",b=SC.LOGGER_LOG_DELIMITER,d,a;for(d=0,a=(arguments.length-1);d<a;++d){c+=arguments[d]+b}c+=arguments[a];return c},_indentation:function(d){if(!d||d<0){d=0}var b="",a=SC.LOGGER_LOG_GROUP_INDENTATION,c;for(c=0;c<d;++c){b+=a}return b},_outputIndentationLevel:0,_recordingIndentationLevel:0,_LOG_LEVEL_MAPPING:{debug:4,info:3,warn:2,error:1,none:0},_LOG_FALLBACK_PREFIX_MAPPING:{debug:SC.LOGGER_LOG_DEBUG,info:SC.LOGGER_LOG_INFO,warn:SC.LOGGER_LOG_WARN,error:SC.LOGGER_LOG_ERROR}});SC.debug=SC.Logger.debug;SC.info=SC.Logger.info;SC.warn=SC.Logger.warn;SC.error=SC.Logger.error;sc_require("ext/function");sc_require("private/observer_set");SC.RunLoop=SC.Object.extend({beginRunLoop:function(){this._start=new Date().getTime();if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.beginRunLoop at %@".fmt(this._start))}this._runLoopInProgress=YES;this._flushinvokeNextQueue();return this},isRunLoopInProgress:function(){return this._runLoopInProgress}.property(),endRunLoop:function(){if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.endRunLoop ~ flushing application queues")}this.flushAllPending();this._start=null;if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.endRunLoop ~ End")}SC.RunLoop.lastRunLoopEnd=Date.now();this._runLoopInProgress=NO;return this},flushAllPending:function(){var a;do{a=this.flushApplicationQueues();if(!a){a=this._flushinvokeLastQueue()}}while(a)},invokeOnce:function(b,c){if(c===undefined){c=b;b=this}var a;if(typeof c==="string"){c=b[c]}if(!this._invokeQueue){this._invokeQueue=SC.ObserverSet.create()}if(c){this._invokeQueue.add(b,c,undefined,a)}return this},invokeLast:function(b,c){if(c===undefined){c=b;b=this}var a;if(typeof c==="string"){c=b[c]}if(!this._invokeLastQueue){this._invokeLastQueue=SC.ObserverSet.create()}this._invokeLastQueue.add(b,c,undefined,a);return this},invokeNext:function(a,b){if(b===undefined){b=a;a=this}if(typeof b==="string"){b=a[b]}if(!this._invokeNextQueue){this._invokeNextQueue=SC.ObserverSet.create()}this._invokeNextQueue.add(a,b);return this},flushApplicationQueues:function(){var b=NO,a=this._invokeQueue;if(a&&a.getMembers().length){this._invokeQueue=null;b=YES;a.invokeMethods()}return SC.Binding.flushPendingChanges()||b},_flushinvokeLastQueue:function(){var a=this._invokeLastQueue,b=NO;if(a&&a.getMembers().length){this._invokeLastQueue=null;b=YES;if(b){a.invokeMethods()}}return b},_flushinvokeNextQueue:function(){var a=this._invokeNextQueue,b=NO;if(a&&a.getMembers().length){this._invokeNextQueue=null;b=YES;if(b){a.invokeMethods()}}return b}});SC.RunLoop.currentRunLoop=null;SC.RunLoop.runLoopClass=SC.RunLoop;SC.RunLoop.begin=function(){var a=this.currentRunLoop;if(!a){a=this.currentRunLoop=this.runLoopClass.create()}a.beginRunLoop();return this};SC.RunLoop.end=function(){var a=this.currentRunLoop;if(!a){throw"SC.RunLoop.end() called outside of a runloop!"}a.endRunLoop();return this};SC.RunLoop.kill=function(){this.currentRunLoop=this.runLoopClass.create();return this};SC.RunLoop.isRunLoopInProgress=function(){if(this.currentRunLoop){return this.currentRunLoop.get("isRunLoopInProgress")}return NO};SC.run=function(g,f,b){var a=SC.RunLoop.isRunLoopInProgress();if(SC.ExceptionHandler&&SC.ExceptionHandler.enabled){try{if(b||!a){SC.RunLoop.begin()}if(g){g.call(f)}if(b||!a){SC.RunLoop.end()}}catch(d){var c=SC.ExceptionHandler.handleException(d);if(!c&&!SC.browser.isIE){throw d}}}else{if(b||!a){SC.RunLoop.begin()}if(g){g.call(f)}if(b||!a){SC.RunLoop.end()}}};SC.RunLoop.wrapFunction=function(b){var a=function(){var c=SC.RunLoop.isRunLoopInProgress();if(!c){SC.RunLoop.begin()}var d=arguments.callee.wrapped.apply(this,arguments);if(!c){SC.RunLoop.end()}return d};a.wrapped=b;return a};SC.DROP_ON=1;SC.DROP_BEFORE=2;SC.DROP_AFTER=4;SC.DROP_ANY=7;SC.ALIGN_LEFT="left";SC.ALIGN_RIGHT="right";SC.ALIGN_CENTER="center";SC.ALIGN_TOP="top";SC.ALIGN_MIDDLE="middle";SC.ALIGN_BOTTOM="bottom";SC.ALIGN_TOP_LEFT="top-left";SC.ALIGN_TOP_RIGHT="top-right";SC.ALIGN_BOTTOM_LEFT="bottom-left";SC.ALIGN_BOTTOM_RIGHT="bottom-right";SC.mixin({data:$.data,removeData:$.removeData,STRINGS:{},stringsFor:function(b,a){SC.mixin(SC.STRINGS,a);return this}});SC.Controller=SC.Object.extend({isEditable:YES,destroyContentOnReplace:NO,contentObjectDidChanged:function(){var b,a;if(!this.get("destroyContentOnReplace")){return}b=this._oldContent;a=this.get("content");if(b&&a!==b&&b.destroy){b.destroy()}this._oldContent=a}.observes("content")});SC.SelectionSupport={hasSelectionSupport:YES,allowsSelection:YES,allowsMultipleSelection:YES,allowsEmptySelection:YES,firstSelectableObject:function(){return this.get("firstObject")}.property(),selection:function(d,f){var c=this._scsel_selection,g=c?c.get("length"):0,e,b=this.get("arrangedObjects"),a;if((f===undefined)||!this.get("allowsSelection")){f=c}a=(f&&f.isEnumerable)?f.get("length"):0;if((a>1)&&!this.get("allowsMultipleSelection")){if(g>1){f=SC.SelectionSet.create().addObject(c.get("firstObject")).freeze();a=1}else{f=c;a=g}}if((a===0)&&!this.get("allowsEmptySelection")&&b&&b.get("length")!==0){if(g===0){f=this.get("firstSelectableObject");if(f){f=SC.SelectionSet.create().addObject(f).freeze()}else{f=SC.SelectionSet.EMPTY}a=f.get("length")}else{f=c;a=g}}if(a===0){f=SC.SelectionSet.EMPTY}if(f!==c){f=f.frozenCopy()}this._scsel_selection=f;return f}.property("arrangedObjects","allowsEmptySelection","allowsMultipleSelection","allowsSelection").cacheable(),hasSelection:function(){var a=this.get("selection");return !!a&&(a.get("length")>0)}.property("selection").cacheable(),selectObjects:function(b,c){if(!b||b.get("length")===0){if(!c){this.set("selection",SC.SelectionSet.EMPTY)}return this}var a=this.get("selection");if(c&&a){a=a.copy()}else{a=SC.SelectionSet.create()}a.addObjects(b).freeze();this.set("selection",a);return this},selectObject:function(a,b){if(a===null){if(!b){this.set("selection",null)}return this}else{return this.selectObjects([a],b)}},deselectObjects:function(b){if(!b||b.get("length")===0){return this}var a=this.get("selection");if(!a||a.get("length")===0){return this}a=a.copy().removeObjects(b).freeze();this.set("selection",a.freeze());return this},deselectObject:function(a){if(!a){return this}else{return this.deselectObjects([a])}},updateSelectionAfterContentChange:function(){var a=this.get("arrangedObjects");var b=this.get("selection");var d=this.get("allowsEmptySelection");var c;if(!b){return this}c=b.indexSetForSource(a);if((c&&(c.get("length")!==b.get("length")))||(!c&&(b.get("length")>0))){b=b.copy().constrain(a).freeze();this.set("selection",b)}if((b.get("length")===0)&&a&&(a.get("length")>0)&&!d){this.selectObject(this.get("firstSelectableObject"),NO)}return this}};sc_require("controllers/controller");sc_require("mixins/selection_support");SC.ArrayController=SC.Controller.extend(SC.Array,SC.SelectionSupport,{content:null,isEditable:YES,orderBy:null,allowsSingleContent:YES,destroyOnRemoval:NO,arrangedObjects:function(){return this}.property().cacheable(),canRemoveContent:function(){var b=this.get("content"),a;a=!!b&&this.get("isEditable")&&this.get("hasContent");if(a){return !b.isEnumerable||(SC.typeOf(b.removeObject)===SC.T_FUNCTION)}else{return NO}}.property("content","isEditable","hasContent"),canReorderContent:function(){var b=this.get("content"),a;a=!!b&&this.get("isEditable")&&!this.get("orderBy");return a&&!!b.isSCArray}.property("content","isEditable","orderBy"),canAddContent:function(){var b=this.get("content"),a;a=b&&this.get("isEditable")&&b.isEnumerable;if(a){return(SC.typeOf(b.addObject)===SC.T_FUNCTION)||(SC.typeOf(b.pushObject)===SC.T_FUNCTION)}else{return NO}}.property("content","isEditable"),hasContent:function(){var a=this.get("content");return !!a&&(!!a.isEnumerable||!!this.get("allowsSingleContent"))}.property("content","allowSingleContent"),status:function(){var b=this.get("content"),a=b?b.get("status"):null;return a?a:SC.Record.READY}.property().cacheable(),addObject:function(a){if(!this.get("canAddContent")){throw"%@ cannot add content".fmt(this)}var b=this.get("content");if(b.isSCArray){b.pushObject(a)}else{if(b.addObject){b.addObject(a)}else{throw"%@.content does not support addObject".fmt(this)}}return this},removeObject:function(a){if(!this.get("canRemoveContent")){throw"%@ cannot remove content".fmt(this)}var b=this.get("content");if(b.isEnumerable){b.removeObject(a)}else{this.set("content",null)}if(this.get("destroyOnRemoval")&&a.destroy){a.destroy()}return this},length:function(){var a=this._scac_observableContent();return a?a.get("length"):0}.property().cacheable(),objectAt:function(a){var b=this._scac_observableContent();return b?b.objectAt(a):undefined},replace:function(g,f,d){if(!d||d.get("length")===0){if(!this.get("canRemoveContent")){throw"%@ cannot remove objects from the current content".fmt(this)}}else{if(!this.get("canReorderContent")){throw"%@ cannot add or reorder the current content".fmt(this)}}var c=this.get("content");var b=[],a,e;if(this.get("destroyOnRemoval")){for(a=0;a<f;a++){b.push(c.objectAt(a+g))}}if(c){c.replace(g,f,d)}for(a=0,e=b.length;a<e;a++){b[a].destroy()}b=null;return this},indexOf:function(b,a){var c=this._scac_observableContent();return c?c.indexOf(b,a):-1},init:function(){arguments.callee.base.apply(this,arguments);this._scac_contentDidChange()},_scac_cached:NO,_scac_observableContent:function(){var c=this._scac_cached;if(c){return c}var f=this.get("content"),e,b,a;if(SC.none(f)){return(this._scac_cached=[])}if(!f.isEnumerable){c=this.get("allowsSingleContent")?[f]:[];return(this._scac_cached=c)}var g=this.get("orderBy");if(!g){if(f.isSCArray){return(this._scac_cached=f)}else{throw"%@.orderBy is required for unordered content".fmt(this)}}var d=SC.typeOf(g);if(d===SC.T_STRING){g=[g]}else{if(d===SC.T_FUNCTION){e=g}else{if(d!==SC.T_ARRAY){throw"%@.orderBy must be Array, String, or Function".fmt(this)}}}e=e||function(p,o){var k,q,n,h,r;for(var m=0,j=g.get("length");m<j&&!k;m++){q=g.objectAt(m);if(q.search(/(ASC|DESC)/)===0){n=q.match(/^(ASC )?(DESC )?(.*)$/);q=n[3]}else{n=q.match(/^(\S*)\s*(DESC)?(?:ASC)?$/);q=n[1]}a=n[2]?-1:1;if(p){h=p.isObservable?p.get(q):p[q]}if(o){r=o.isObservable?o.get(q):o[q]}k=SC.compare(h,r)*a}return k};return(this._scac_cached=f.toArray().sort(e))},propertyWillChange:function(a){if(a==="content"){this.arrayContentWillChange(0,this.get("length"),0)}else{return arguments.callee.base.apply(this,arguments)}},_scac_arrayContentWillChange:function(d,c,a){this.arrayContentWillChange(d,c,a);if(this._kvo_enumerable_property_chains){var b=this.slice(d,d+c);this.teardownEnumerablePropertyChains(b)}},_scac_arrayContentDidChange:function(d,c,a){this._scac_cached=NO;this.arrayContentDidChange(d,c,a);if(this._kvo_enumerable_property_chains){var b=this.slice(d,d+a);this.setupEnumerablePropertyChains(b)}this.updateSelectionAfterContentChange()},_scac_contentDidChange:function(){this._scac_cached=NO;var h=this.get("content"),d=!!this.get("orderBy"),i=this._scac_content,a=this._scac_length||0,g=this._scac_arrayContentDidChange,c=this._scac_arrayContentWillChange,b=this._scac_contentStatusDidChange,f=this._scac_enumerableDidChange,e;if(h===i){return this}if(i){if(i.isSCArray){i.removeArrayObservers({target:this,didChange:g,willChange:c})}else{if(i.isEnumerable){i.removeObserver("[]",this,f)}}i.removeObserver("status",this,b);this.teardownEnumerablePropertyChains(i)}this._scac_cached=NO;this._scac_content=h;if(h){if(h.isSCArray){h.addArrayObservers({target:this,didChange:g,willChange:c});e=h.get("length")}else{if(h.isEnumerable){h.addObserver("[]",this,f);e=h.get("length")}else{e=1}}h.addObserver("status",this,b);this.setupEnumerablePropertyChains(h)}else{e=SC.none(h)?0:1}this._scac_length=e;this._scac_contentStatusDidChange();this.arrayContentDidChange(0,0,e);this.updateSelectionAfterContentChange()}.observes("content"),_scac_enumerableDidChange:function(){var a=this.get("content"),c=a?a.get("length"):0,b=this._scac_length;this._scac_length=c;this.beginPropertyChanges();this._scac_cached=NO;this.arrayContentDidChange(0,b,c);this.enumerableContentDidChange(0,b-1);this.endPropertyChanges();this.updateSelectionAfterContentChange()}.observes("orderBy"),_scac_contentStatusDidChange:function(){this.notifyPropertyChange("status")}});sc_require("controllers/controller");SC.ObjectController=SC.Controller.extend({content:null,allowsMultipleContent:NO,hasContent:function(){return !SC.none(this.get("observableContent"))}.property("observableContent"),isEditable:YES,observableContent:function(){var b=this.get("content"),a,c;if(b&&b.isEnumerable){a=b.get("length");c=this.get("allowsMultipleContent");if(a===1){b=b.firstObject()}else{if(a===0||!c){b=null}}if(b&&!c&&b.isEnumerable){b=null}}return b}.property("content","allowsMultipleContent").cacheable(),destroy:function(){var a=this.get("observableContent");if(a&&SC.typeOf(a.destroy)===SC.T_FUNCTION){a.destroy()}this.set("content",null);return this},contentPropertyDidChange:function(b,a){if(a==="*"){this.allPropertiesDidChange()}else{this.notifyPropertyChange(a)}},unknownProperty:function(b,d){if(b==="content"){if(d!==undefined){this.content=d}return this.content}var c=this.get("observableContent"),f,e,a;if(c===null||c===undefined){return undefined}if(d===undefined){if(c.isEnumerable){d=c.getEach(b);f=d.get("length");if(f>0){a=YES;e=d.objectAt(0);while((--f>0)&&a){if(e!==d.objectAt(f)){a=NO}}if(a){d=e}}else{d=undefined}}else{d=(c.isObservable)?c.get(b):c[b]}}else{if(!this.get("isEditable")){throw"%@.%@ is not editable".fmt(this,b)}if(c.isEnumerable){c.setEach(b,d)}else{if(c.isObservable){c.set(b,d)}else{c[b]=d}}}return d},init:function(){arguments.callee.base.apply(this,arguments);if(this.get("content")){this._scoc_contentDidChange()}if(this.get("observableContent")){this._scoc_observableContentDidChange()}},_scoc_contentDidChange:function(){var b=this._scoc_content,c=this.get("content");if(b!==c){this._scoc_content=c;var a=this._scoc_enumerableContentDidChange;if(b&&b.isEnumerable){b.removeObserver("[]",this,a)}if(c&&c.isEnumerable){c.addObserver("[]",this,a)}}}.observes("content"),_scoc_observableContentDidChange:function(){var b=this._scoc_observableContent,d=this.get("observableContent"),a=this.contentPropertyDidChange,c=this._scoc_enumerableContentDidChange;if(b===d){return this}this._scoc_observableContent=d;if(b){if(b.isEnumerable){b.removeObserver("[]",this,c)}else{if(b.isObservable){b.removeObserver("*",this,a)}}}if(d){if(d.isEnumerable){d.addObserver("[]",this,c)}else{if(d.isObservable){d.addObserver("*",this,a)}}}if((b&&b.isEnumerable)||(d&&d.isEnumerable)){this._scoc_enumerableContentDidChange()}else{this.contentPropertyDidChange(d,"*")}}.observes("observableContent"),_scoc_enumerableContentDidChange:function(){var b=this.get("observableContent"),c=this._scoc_observableContentItems,a=this.contentPropertyDidChange;if(c){c.forEach(function(d){if(d.isObservable){d.removeObserver("*",this,a)}},this);c.clear()}if(b&&b.isEnumerable){if(!c){c=SC.Set.create()}b.forEach(function(d){if(c.contains(d)){return}c.add(d);if(d.isObservable){d.addObserver("*",this,a)}},this)}else{c=null}this._scoc_observableContentItems=c;this.contentPropertyDidChange(b,"*");return this}});SC.mixin(Function.prototype,{invokeLater:function(e,a){if(a===undefined){a=1}var d=this;if(arguments.length>2){var b=SC.$A(arguments).slice(2,arguments.length);b.unshift(e);var c=d;d=function(){return c.apply(this,b.slice(1))}}return SC.Timer.schedule({target:e,action:d,interval:a})}});SC.mixin(SC.Object.prototype,{invokeLater:function(d,a){var c,b;if(SC.typeOf(d)===SC.T_STRING){d=this[d]}if(a===undefined){a=1}if(arguments.length>2){b=SC.$A(arguments).slice(2);c=function(){return d.apply(this,b)}}else{c=d}return SC.Timer.schedule({target:this,action:c,interval:a})},invokeOnceLater:function(i,c){var d,g,b,e=this._sc_invokeOnceLaterTimers,h,a;if(SC.typeOf(i)===SC.T_STRING){i=this[i]}if(c===undefined){c=1}if(!e){e=this._sc_invokeOnceLaterTimers={}}b=SC.guidFor(i);h=e[b];if(h){h.invalidate()}if(arguments.length>2){d=SC.$A(arguments).slice(2)}else{d=arguments}g=function(){delete e[b];return i.apply(this,d)};a=SC.Timer.schedule({target:this,action:g,interval:c});e[b]=a;return a},invokeWith:function(b,c,d){if(d===undefined){d=c;c=this}if(!c){c=this}if(SC.typeOf(d)===SC.T_STRING){d=c[d]}var a=this.getPath(b);d.call(c,a,this);return this}});SC.RunLoop=SC.RunLoop.extend({startTime:function(){if(!this._start){this._start=Date.now()}return this._start}.property(),endRunLoop:function(){this.fireExpiredTimers();var a=arguments.callee.base.apply(this,arguments);this.scheduleNextTimeout();return a},scheduleTimer:function(b,a){this._timerQueue=b.removeFromTimerQueue(this._timerQueue);this._timerQueue=b.scheduleInTimerQueue(this._timerQueue,a);return this},cancelTimer:function(a){this._timerQueue=a.removeFromTimerQueue(this._timerQueue);return this},TIMER_ARRAY:[],fireExpiredTimers:function(){if(!this._timerQueue||this._firing){return NO}var d=this.get("startTime"),e=this.TIMER_ARRAY,c,b,a;this._firing=YES;this._timerQueue=this._timerQueue.collectExpiredTimers(e,d);b=e.length;for(c=0;c<b;c++){e[c].fire()}a=e.length>0;e.length=0;this._firing=NO;return a},scheduleNextTimeout:function(){var d=this._timerQueue;var b=NO;if(!d){if(this._timeout){clearTimeout(this._timeout)}}else{var c=d._timerQueueRunTime;if(this._timeoutAt!==c){if(this._timeout){clearTimeout(this._timeout)}var a=Math.max(0,c-Date.now());this._timeout=setTimeout(this._timeoutDidFire,a);this._timeoutAt=c}b=YES}return b},_timeoutDidFire:function(){var a=SC.RunLoop.currentRunLoop;a._timeout=a._timeoutAt=null;SC.run()}});SC.RunLoop.currentRunLoop=SC.RunLoop.create();SC.RunLoop.runLoopClass=SC.RunLoop;SC.Locale=SC.Object.extend({init:function(){if(!this.language){SC.Locale._assignLocales()}if(!this.hasStrings){var c=this._deprecatedLanguageCodes||[];c.push(this.language);var b=c.length;var a=null;while(!a&&--b>=0){a=String[c[b]]}if(a){this.hasStrings=YES;this.strings=a}}},hasStrings:NO,strings:{},metrics:{},toString:function(){if(!this.language){SC.Locale._assignLocales()}return"SC.Locale["+this.language+"]"+SC.guidFor(this)},locWithDefault:function(b,c){var a=this.strings[b];if(SC.typeOf(a)===SC.T_STRING){return a}else{if(SC.typeOf(c)===SC.T_STRING){return c}}return b},locMetric:function(b){var a=this.metrics[b];if(SC.typeOf(a)===SC.T_NUMBER){return a}else{if(a===undefined){SC.warn('No localized metric found for key "'+b+'"');return undefined}else{SC.warn('Unexpected metric type for key "'+b+'"');return undefined}}},locLayout:function(c,b){var e,g,f,m,l,a=SC.Locale.layoutKeys,k=this.metrics,j=SC.typeOf,d=SC.T_NUMBER,h={};if(b){SC.mixin(h,b)}for(e=0,g=a.length;e<g;++e){f=a[e];m=c+"."+f;l=k[m];if(j(l)===d){if(b&&b[f]){throw"locLayout():  There is a localized value for the key '"+m+"' but a value for '"+f+"' was also specified in the non-localized hash"}h[f]=l}}return h}});SC.Locale.mixin({useAutodetectedLanguage:NO,preferredLanguage:null,layoutKeys:["left","top","right","bottom","width","height","minWidth","minHeight","centerX","centerY"],createCurrentLocale:function(){var c=(String.useAutodetectedLanguage!==undefined)?String.useAutodetectedLanguage:this.useAutodetectedLanguage;var b=(String.preferredLanguage!==undefined)?String.preferredLanguage:this.preferredLanguage;var d=((c)?SC.browser.language:null)||b||SC.browser.language||"en";d=SC.Locale.normalizeLanguage(d);var a=this.localeClassFor(d);if(d!=this.currentLanguage){this.currentLanguage=d;this.currentLocale=a.create()}return this.currentLocale},localeClassFor:function(c){c=SC.Locale.normalizeLanguage(c);var b,a=this.locales[c];if(!a&&((b=c.split("-")[0])!==c)&&(a=this.locales[b])){a=this.locales[c]=a.extend()}if(!a){a=this.locales[c]=this.locales.en.extend()}return a},define:function(b,c){var a;if(c===undefined&&(SC.typeOf(b)!==SC.T_STRING)){a=this;c=b}else{a=SC.Locale.localeClassFor(b)}SC.mixin(a.prototype,c);return a},options:function(){return this.prototype},addStrings:function(b){var a=this.prototype.strings;if(a){if(!this.prototype.hasOwnProperty("strings")){a=this.prototype.strings=SC.clone(a)}}else{a=this.prototype.strings={}}if(b){this.prototype.strings=SC.mixin(a,b)}this.prototype.hasStrings=YES;return this},addMetrics:function(b){var a=this.prototype.metrics;if(a){if(!this.prototype.hasOwnProperty(a)){a=this.prototype.metrics=SC.clone(a)}}else{a=this.prototype.metrics={}}if(b){this.prototype.metrics=SC.mixin(a,b)}return this},_map:{english:"en",french:"fr",german:"de",japanese:"ja",jp:"ja",spanish:"es"},normalizeLanguage:function(a){if(!a){return"en"}return SC.Locale._map[a.toLowerCase()]||a},_assignLocales:function(){for(var a in this.locales){this.locales[a].prototype.language=a}},toString:function(){if(!this.prototype.language){SC.Locale._assignLocales()}return"SC.Locale["+this.prototype.language+"]"},extend:function(){var a=SC.Object.extend.apply(this,arguments);a.addStrings=SC.Locale.addStrings;a.define=SC.Locale.define;a.options=SC.Locale.options;a.toString=SC.Locale.toString;return a}});SC.Locale.locales={en:SC.Locale.extend({_deprecatedLanguageCodes:["English"]}),fr:SC.Locale.extend({_deprecatedLanguageCodes:["French"]}),de:SC.Locale.extend({_deprecatedLanguageCodes:["German"]}),ja:SC.Locale.extend({_deprecatedLanguageCodes:["Japanese","jp"]}),es:SC.Locale.extend({_deprecatedLanguageCodes:["Spanish"]})};SC.stringsFor=function(c,b){var a=SC.Locale.localeClassFor(c);a.addStrings(b);return this};SC.metricsFor=function(c,b){var a=SC.Locale.localeClassFor(c);a.addMetrics(b);return this};sc_require("system/locale");SC.STRING_TITLEIZE_REGEXP=(/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g);SC.STRING_DECAMELIZE_REGEXP=(/([a-z])([A-Z])/g);SC.STRING_DASHERIZE_REGEXP=(/[ _]/g);SC.STRING_DASHERIZE_CACHE={};SC.STRING_TRIM_LEFT_REGEXP=(/^\s+/g);SC.STRING_TRIM_RIGHT_REGEXP=(/\s+$/g);SC.mixin(SC.String,{capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},camelize:function(d){var b=d.replace(SC.STRING_TITLEIZE_REGEXP,function(f,g,e){return e?e.toUpperCase():""});var c=b.charAt(0),a=c.toLowerCase();return c!==a?a+b.slice(1):b},decamelize:function(a){return a.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase()},dasherize:function(c){var a=SC.STRING_DASHERIZE_CACHE,b=a[c];if(b){return b}else{b=SC.String.decamelize(c).replace(SC.STRING_DASHERIZE_REGEXP,"-");a[c]=b}return b},loc:function(d){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()}var b=SC.Locale.currentLocale.locWithDefault(d);if(SC.typeOf(b)!==SC.T_STRING){b=d}var a=SC.$A(arguments);a.shift();if(a.length>0&&a[0]&&a[0].isSCArray){a=a[0]}try{return SC.String.fmt(b,a)}catch(c){SC.error("Error processing string with key: "+d);SC.error("Localized String: "+b);SC.error("Error: "+c)}},locMetric:function(b){var a=SC.Locale,c=a.currentLocale;if(!c){a.createCurrentLocale();c=a.currentLocale}return c.locMetric(b)},locLayout:function(b,c){var a=SC.Locale,d=a.currentLocale;if(!d){a.createCurrentLocale();d=a.currentLocale}return d.locLayout(b,c)},locWithDefault:function(d,c){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()}var b=SC.Locale.currentLocale.locWithDefault(d,c);if(SC.typeOf(b)!==SC.T_STRING){b=d}var a=SC.$A(arguments);a.shift();a.shift();return SC.String.fmt(b,a)},trim:jQuery.trim,trimLeft:function(a){return a.replace(SC.STRING_TRIM_LEFT_REGEXP,"")},trimRight:function(a){return a.replace(SC.STRING_TRIM_RIGHT_REGEXP,"")},mult:function(d,c){if(SC.typeOf(c)!==SC.T_NUMBER||c<1){return null}var a="";for(var b=0;b<c;b+=1){a+=d}return a}});if(String.prototype.trim){SC.supplement(String.prototype,{trim:function(){return SC.String.trim(this,arguments)},trimLeft:function(){return SC.String.trimLeft(this,arguments)},trimRight:function(){return SC.String.trimRight(this,arguments)}})}SC.mixin(String.prototype,{loc:function(){return SC.String.loc(this.toString(),SC.$A(arguments))},locMetric:function(){return SC.String.locMetric(this.toString())},locLayout:function(a){return SC.String.locLayout(this.toString(),a)}});sc_require("system/string");SC.supplement(String.prototype,{capitalize:function(){return SC.String.capitalize(this,arguments)},camelize:function(){return SC.String.camelize(this,arguments)},decamelize:function(){return SC.String.decamelize(this,arguments)},dasherize:function(){return SC.String.dasherize(this,arguments)},loc:function(){var a=SC.$A(arguments);a.unshift(this);return SC.String.loc.apply(SC.String,a)},locWithDefault:function(b){var a=SC.$A(arguments);a.unshift(this);return SC.String.locWithDefault.apply(SC.String,a)},mult:function(a){return SC.String.mult(this,a)}});SC.ActionSupport={target:null,action:null,actionContext:null,fireAction:function(b){var c=this.get("target")||null,a=this.getPath("pane.rootResponder");if(b===undefined){b=this.get("action")}if(b&&a){return a.sendAction(b,c,this,this.get("pane"),this.get("actionContext"),this)}return false}};SC.DelegateSupport={delegateFor:function(c){var b=1,a=arguments.length,d;while(b<a){d=arguments[b];if(d&&d[c]!==undefined){return d}b++}return(this[c]!==undefined)?this:null},invokeDelegateMethod:function(c,a,b){b=SC.A(arguments);b=b.slice(2,b.length);if(!c||!c[a]){c=this}var d=c[a];return d?d.apply(c,b):null},getDelegateProperty:function(d,e){var b=1,a=arguments.length,c;while(b<a){c=arguments[b++];if(c&&c[d]!=undefined){return c.get?c.get(d):c[d]}}return(this[d]!=undefined)?this.get(d):undefined}};SC.Responder=SC.Object.extend({isResponder:YES,pane:null,responderContext:null,nextResponder:null,isFirstResponder:NO,hasFirstResponder:NO,acceptsFirstResponder:YES,becomingFirstResponder:NO,becomeFirstResponder:function(){var a=this.get("pane")||this.get("responderContext")||this.pane();if(a&&this.get("acceptsFirstResponder")){if(a.get("firstResponder")!==this){a.makeFirstResponder(this)}}return this},resignFirstResponder:function(a){var b=this.get("pane")||this.get("responderContext");if(b&&(b.get("firstResponder")===this)){b.makeFirstResponder(null,a)}return YES},willLoseFirstResponder:function(a){},didBecomeFirstResponder:function(a){}});sc_require("system/responder");SC.ResponderContext={isResponderContext:YES,trace:NO,defaultResponder:null,nextResponder:function(){return this.get("defaultResponder")}.property("defaultResponder").cacheable(),firstResponder:null,nextResponderFor:function(a){var b=a.get("nextResponder");if(typeof b===SC.T_STRING){b=SC.objectForPropertyPath(b,this)}else{if(!b&&(a!==this)){b=this}}return b},responderNameFor:function(a){if(!a){return"(No Responder)"}else{if(a._scrc_name){return a._scrc_name}}var b=this.NAMESPACE;this._findResponderNamesFor(this,3,b?[this.NAMESPACE]:[]);return a._scrc_name||a.toString()},_findResponderNamesFor:function(a,e,d){var b,c;for(b in a){if(b==="nextResponder"){continue}c=a[b];if(c&&c.isResponder){if(c._scrc_name){continue}d.push(b);c._scrc_name=d.join(".");if(e>0){this._findResponderNamesFor(c,e-1,d)}d.pop()}}},makeFirstResponder:function(b,a){var f=this.get("firstResponder"),d=this.get("nextResponder"),e=this.get("trace"),c;if(this._locked){if(e){SC.Logger.log("%@: AFTER ACTION: makeFirstResponder => %@".fmt(this,this.responderNameFor(b)))}this._pendingResponder=b;return}if(e){SC.Logger.log("%@: makeFirstResponder => %@".fmt(this,this.responderNameFor(b)))}if(b){b.set("becomingFirstResponder",YES)}this._locked=YES;this._pendingResponder=null;c=b?b:null;while(c){if(c.get("hasFirstResponder")){break}c=(c===d)?null:this.nextResponderFor(c)}if(!c){c=d}this._notifyWillLoseFirstResponder(f,f,c,a);if(f){f.set("isFirstResponder",NO)}this.beginPropertyChanges();this.set("firstResponder",b);if(b){b.set("isFirstResponder",YES)}this._notifyDidBecomeFirstResponder(b,b,c);this.endPropertyChanges();this._locked=NO;if(this._pendingResponder){this.makeFirstResponder(this._pendingResponder);this._pendingResponder=null}if(b){b.set("becomingFirstResponder",NO)}return this},_notifyWillLoseFirstResponder:function(c,e,b,a){if(!e||e===b){return}e.willLoseFirstResponder(c,a);e.set("hasFirstResponder",NO);var d=this.nextResponderFor(e);if(d){this._notifyWillLoseFirstResponder(c,d,b)}},_notifyDidBecomeFirstResponder:function(b,d,a){if(!d||d===a){return}var c=this.nextResponderFor(d);if(c){this._notifyDidBecomeFirstResponder(b,c,a)}d.set("hasFirstResponder",YES);d.didBecomeFirstResponder(b)},resetFirstResponder:function(){var a=this.get("firstResponder");if(!a){return}a.willLoseFirstResponder();a.didBecomeFirstResponder()},sendAction:function(g,d,c){var a=this.get("firstResponder"),e=this.get("nextResponder"),f=this.get("trace"),h=NO,b;this._locked=YES;if(f){SC.Logger.log("%@: begin action '%@' (%@, %@)".fmt(this,g,d,c))}if(!h&&!a&&this.tryToPerform){h=this.tryToPerform(g,d,c)}while(!h&&a){if(a.tryToPerform){h=a.tryToPerform(g,d,c)}if(!h){a=(a===e)?null:this.nextResponderFor(a)}}if(f){if(!h){SC.Logger.log("%@:  action '%@' NOT HANDLED".fmt(this,g))}else{SC.Logger.log("%@: action '%@' handled by %@".fmt(this,g,this.responderNameFor(a)))}}this._locked=NO;if(b=this._pendingResponder){this._pendingResponder=null;this.makeFirstResponder(b)}return a}};SC.bodyOverflowArbitrator=SC.Object.create({requestHidden:function(b,a){this._makeRequest(b,-1-9*!!a)},requestVisible:function(b,a){this._makeRequest(b,1+9*!!a)},withdrawRequest:function(b){if(!b){return}var a=SC.guidFor(b);if(this._requests[a]){delete this._requests[a]}this.setOverflow()},setOverflow:function(){var a=this._decideOverflow();if(a!==undefined){document.body.style.overflow=a?"auto":"hidden"}},_makeRequest:function(c,b){if(!c){return}var a=SC.guidFor(c);this._requests[a]=b;this.setOverflow()},_requests:{},_decideOverflow:function(){var a,e,c,f,b=this._requests,g;for(var d in b){if((g=b[d])<0){a=YES}if(g<-1){c=YES}if(g>0){e=YES}if(g>1){f=YES}}if(f){return YES}if(e&&c){return NO}if(e){return YES}if(a){return NO}return undefined}});SC.mixin(SC.browser,{compare:function(c,a){var f,g,e;if(typeof c==="number"||typeof a==="number"){SC.warn("SC.browser.compare(): Versions compared against Numbers may not provide accurate results.  Use a String of decimal separated Numbers instead.");c=String(c);a=String(a)}f=function(h){return Number(h.match(/^[0-9]+/))};g=SC.A(c.split(".")).map(f);e=SC.A(a.split(".")).map(f);for(var d=0;d<e.length;d++){var b=g[d]-e[d];if(isNaN(b)){return 0}if(b!==0){return b}}return 0},compareVersion:function(){SC.warn("SC.browser.compareVersion() has been deprecated.  Please use SC.browser.compare() instead.  Example: SC.browser.compareVersion(16,0,912) < 0 becomes SC.browser.compare(SC.browser.engineVersion, '16.0.912').");if(this._versionSplit===undefined){var d=function(e){return Number(e.match(/^[0-9]+/))};this._versionSplit=SC.A(this.version.split(".")).map(d)}var c=SC.A(arguments).map(Number);for(var b=0;b<c.length;b++){var a=this._versionSplit[b]-c[b];if(isNaN(a)){return 0}if(a!==0){return a}}return 0}});SC.Builder=function(a){return SC.Builder.create(a)};SC.Builder.create=function create(c){var b=SC.mixin(SC.beget(this.fn),c||{});if(c.hasOwnProperty("toString")){b.toString=c.toString}var a=function(){var d=SC.beget(b);d.defaultClass=this;d.constructor=a;return d.init.apply(d,arguments)};a.fn=a.prototype=b;a.extend=SC.Builder.create;a.mixin=SC.Builder.mixin;return a};SC.Builder.mixin=function(){var b=arguments.length,a;for(a=0;a<b;a++){SC.mixin(this,arguments[a])}return this};SC.Builder.fn={init:function(a){if(a!==undefined){if(SC.typeOf(a)===SC.T_ARRAY){var b=a.length;while(--b>=0){this[b]=a.objectAt?a.objectAt(b):a[b]}this.length=a.length}else{this[0]=a;this.length=1}}return this},size:function(){return this.length},pushStack:function(){var a=this.constructor.apply(this,arguments);a.prevObject=this;return a},end:function(){return this.prevObject||this.constructor()},toString:function(){return"%@$(%@)".fmt(this.defaultClass.toString(),SC.A(this).invoke("toString").join(","))},mixin:SC.Builder.mixin};(function(){var a=SC.Enumerable,c=SC.Builder.fn,b,d;for(b in a){if(!a.hasOwnProperty(b)){continue}d=Array.prototype[b]||a[b];c[b]=d}})();sc_require("system/builder");SC.$=SC.CoreQuery=jQuery;SC.mixin(SC.$.fn,{isCoreQuery:YES,toString:function(){var c=[],b=this.length,a=0;for(a=0;a<b;a++){c[a]="%@: %@".fmt(a,this[a]?this[a].toString():"(null)")}return"<$:%@>(%@)".fmt(SC.guidFor(this),c.join(" , "))},isVisible:function(){return Array.prototype.every.call(this,function(a){return SC.$.isVisible(a)})},view:function(){return this.map(function(){var b=null,a=SC.viewKey,d=this,c;while(!b&&d&&(d!==document)){if(d.nodeType===1&&(c=d.getAttribute("id"))){b=SC.View.views[c]}d=d.parentNode}d=null;return b})},within:function(a){if(this.filter(a).length){return true}return !!this.has(a).length}});(function(){var c={},f={find:function(h,g){return(g!==undefined)?SC.Enumerable.find.call(this,h,g):c.find.call(this,h)},filter:function(h,g){return(g!==undefined)?this.pushStack(SC.Enumerable.filter.call(this,h,g)):c.filter.call(this,h)},filterProperty:function(g,h){return this.pushStack(SC.Enumerable.filterProperty.call(this,g,h))},indexOf:SC.$.index,map:function(h,g){return(g!==undefined)?SC.Enumerable.map.call(this,h,g):c.map.call(this,h)}};var d=SC.$.fn,a=SC.Enumerable,e;for(var b in a){if(a.hasOwnProperty(b)){e=a[b];if(b in f){c[b]=d[b];e=f[b]}d[b]=e}}})();SC.mixin(SC.$,{isVisible:function(a){var b=SC.$;return("hidden"!=a.type)&&(b.css(a,"display")!="none")&&(b.css(a,"visibility")!="hidden")}});sc_require("system/core_query");SC.Event=function(d){var c,b;if(d){this.originalEvent=d;var g=SC.Event._props,f;b=g.length;c=b;while(--c>=0){f=g[c];this[f]=d[f]}}this.timeStamp=this.timeStamp||Date.now();if(!this.target){this.target=this.srcElement||document}if(this.target.nodeType===3){this.target=this.target.parentNode}if(!this.relatedTarget&&this.fromElement){this.relatedTarget=(this.fromElement===this.target)?this.toElement:this.fromElement}if(SC.none(this.pageX)&&!SC.none(this.clientX)){var h=document.documentElement,a=document.body;this.pageX=this.clientX+(h&&h.scrollLeft||a&&a.scrollLeft||0)-(h.clientLeft||0);this.pageY=this.clientY+(h&&h.scrollTop||a&&a.scrollTop||0)-(h.clientTop||0)}if(!this.which&&((this.charCode||d.charCode===0)?this.charCode:this.keyCode)){this.which=this.charCode||this.keyCode}if(!this.metaKey&&this.ctrlKey){this.metaKey=this.ctrlKey}if(!this.which&&this.button){this.which=((this.button&1)?1:((this.button&2)?3:((this.button&4)?2:0)))}if(this.type==="mousewheel"||this.type==="DOMMouseScroll"||this.type==="MozMousePixelScroll"){var e=SC.Event.MOUSE_WHEEL_MULTIPLIER;if(SC.browser.isWebkit&&d.wheelDelta!==undefined){this.wheelDelta=0-(d.wheelDeltaY||d.wheelDeltaX);this.wheelDeltaY=0-(d.wheelDeltaY||0);this.wheelDeltaX=0-(d.wheelDeltaX||0)}else{if(!SC.none(d.detail)&&SC.browser.isMozilla){if(d.axis&&(d.axis===d.HORIZONTAL_AXIS)){this.wheelDeltaX=d.detail;this.wheelDeltaY=this.wheelDelta=0}else{this.wheelDeltaY=this.wheelDelta=d.detail;this.wheelDeltaX=0}}else{this.wheelDelta=this.wheelDeltaY=SC.browser.isIE||SC.browser.isOpera?0-d.wheelDelta:d.wheelDelta;this.wheelDeltaX=0}}this.wheelDelta*=e;this.wheelDeltaX*=e;this.wheelDeltaY*=e}return this};SC.mixin(SC.Event,{MOUSE_WHEEL_MULTIPLIER:function(){var b=1,a=SC.browser.engineVersion;if(SC.browser.name===SC.BROWSER.safari){b=0.4;if(SC.browser.compare(a,"533.17")>0&&SC.browser.compare(a,"534")<0){b=0.004}else{if(SC.browser.compare(a,"533")<0){b=40}}}else{if(SC.browser.name===SC.BROWSER.ie){b=0.3}else{if(SC.browser.name===SC.BROWSER.chrome){b=0.4}}}return b}(),MOUSE_WHEEL_DELTA_LIMIT:1000,_MOUSE_WHEEL_LIMIT_INVALIDATED:NO,create:function(a){return new SC.Event(a)},add:function(f,e,g,h,d,a){if(f&&f.isCoreQuery){if(f.length>0){f.forEach(function(i){this.add(i,e,g,h,d)},this);return this}else{f=f[0]}}if(!f){return this}if(!a){a=NO}if(f.nodeType===3||f.nodeType===8){return SC.Event}if(SC.browser.name===SC.BROWSER.ie&&f.setInterval){f=window}if(SC.typeOf(g)===SC.T_FUNCTION){d=h;h=g;g=null}else{if(g&&SC.typeOf(h)===SC.T_STRING){h=g[h]}}var c=SC.data(f,"sc_events")||SC.data(f,"sc_events",{}),b=c[e];if(!b){b=c[e]={};this._addEventListener(f,e,a)}b[SC.hashFor(g,h)]=[g,h,d];SC.Event._global[e]=YES;f=c=b=null;return this},remove:function(f,e,g,h){if(f&&f.isCoreQuery){if(f.length>0){f.forEach(function(i){this.remove(i,e,g,h)},this);return this}else{f=f[0]}}if(!f){return this}if(f.nodeType===3||f.nodeType===8){return SC.Event}var a,d,c=SC.data(f,"sc_events");if(!c){return this}if(e===undefined){for(e in c){this.remove(f,e)}}else{if(a=c[e]){var b=NO;if(g||h){if(SC.typeOf(g)===SC.T_FUNCTION){h=g;g=null}else{if(SC.typeOf(h)===SC.T_STRING){h=g[h]}}delete a[SC.hashFor(g,h)];d=null;for(d in a){break}if(d===null){b=YES}}else{b=YES}if(b){delete c[e];this._removeEventListener(f,e)}d=null;for(d in c){break}if(!d){SC.removeData(f,"sc_events");delete this._elements[SC.guidFor(f)]}}}f=c=a=null;return this},NO_BUBBLE:["blur","focus","change"],simulateEvent:function(d,c,b){var a=SC.Event.create({type:c,target:d,preventDefault:function(){this.cancelled=YES},stopPropagation:function(){this.bubbles=NO},allowDefault:function(){this.hasCustomEventHandling=YES},timeStamp:Date.now(),bubbles:(this.NO_BUBBLE.indexOf(c)<0),cancelled:NO,normalized:YES});if(b){SC.mixin(a,b)}return a},trigger:function(c,b,i,j){if(c&&c.isCoreQuery){if(c.length>0){c.forEach(function(m){this.trigger(m,b,i,j)},this);return this}else{c=c[0]}}if(!c){return this}if(c.nodeType===3||c.nodeType===8){return undefined}i=SC.A(i);var h,k=SC.typeOf(c[b]||null)===SC.T_FUNCTION,a,g,d,l;a=i[0];if(!a||!a.preventDefault){a=this.simulateEvent(c,b);i.unshift(a)}a.type=b;g=c;do{h=SC.Event.handle.apply(g,i);g=(g===document)?null:(g.parentNode||document)}while(!h&&a.bubbles&&g);g=null;d=c["on"+b];l=SC.$.nodeName(c,"a")&&b==="click";if((!k||l)&&d&&d.apply(c,i)===NO){h=NO}if(k&&j!==NO&&h!==NO&&!l){this.triggered=YES;try{c[b]()}catch(f){}}this.triggered=NO;return h},handle:function(b){if((typeof SC==="undefined")||SC.Event.triggered){return YES}var c,g,e,i,d,h,j,k,a,f;h=SC.A(arguments);h[0]=b=SC.Event.normalizeEvent(b||window.event);d=(SC.data(this,"sc_events")||{})[b.type];if(!d){return NO}for(j in d){k=d[j];a=k[1];b.handler=a;b.data=b.context=k[2];f=k[0]||this;g=a.apply(f,h);if(c!==NO){c=g}if(g===NO){b.preventDefault();b.stopPropagation()}}return c},unload:function(){var a,b=this._elements;for(a in b){this.remove(b[a])}for(a in b){delete b[a]}delete this._elements},special:{ready:{setup:function(){SC._bindReady();return},teardown:function(){return}},mouseenter:{setup:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.add(this,"mouseover",SC.Event.special.mouseenter.handler);return YES},teardown:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.remove(this,"mouseover",SC.Event.special.mouseenter.handler);return YES},handler:function(a){if(SC.Event._withinElement(a,this)){return YES}a.type="mouseenter";return SC.Event.handle.apply(this,arguments)}},mouseleave:{setup:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.add(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},teardown:function(){if(SC.browser.name===SC.BROWSER.ie){return NO}SC.Event.remove(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},handler:function(a){if(SC.Event._withinElement(a,this)){return YES}a.type="mouseleave";return SC.Event.handle.apply(this,arguments)}}},KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,_withinElement:function(d,c){var b=d.relatedTarget;while(b&&b!==c){try{b=b.parentNode}catch(a){b=c}}return b===c},_addEventListener:function(e,d,a){var f,c=this.special[d];if(!a){a=NO}if(!c||c.setup.call(e)===NO){var b=SC.guidFor(e);this._elements[b]=e;f=SC.data(e,"listener")||SC.data(e,"listener",function(){return SC.Event.handle.apply(SC.Event._elements[b],arguments)});if(e.addEventListener){e.addEventListener(d,f,a)}else{if(e.attachEvent){e.attachEvent("on"+d,f)}}}e=c=f=null},_removeEventListener:function(c,b){var d,a=SC.Event.special[b];if(!a||(a.teardown.call(c)===NO)){d=SC.data(c,"listener");if(d){if(c.removeEventListener){c.removeEventListener(b,d,NO)}else{if(c.detachEvent){c.detachEvent("on"+b,d)}}}}c=a=d=null},_elements:{},normalizeEvent:function(a){if(a===window.event){return SC.Event.create(a)}else{return a.normalized?a:SC.Event.create(a)}},_global:{},_props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view which touches targetTouches changedTouches animationName elapsedTime dataTransfer".split(" ")});SC.Event.prototype={hasCustomEventHandling:NO,touchesForView:function(a){if(this.touchContext){return this.touchContext.touchesForView(a)}},touchesForResponder:function(a){if(this.touchContext){return this.touchContext.touchesForView(a)}},averagedTouchesForView:function(a){if(this.touchContext){return this.touchContext.averagedTouchesForView(a)}return null},allowDefault:function(){this.hasCustomEventHandling=YES;return this},preventDefault:function(){var a=this.originalEvent;if(a){if(a.preventDefault){a.preventDefault()}a.returnValue=NO}this.hasCustomEventHandling=YES;return this},stopPropagation:function(){var a=this.originalEvent;if(a){if(a.stopPropagation){a.stopPropagation()}a.cancelBubble=YES}this.hasCustomEventHandling=YES;return this},stop:function(){return this.preventDefault().stopPropagation()},normalized:YES,getCharString:function(){if(SC.browser.name===SC.BROWSER.ie&&SC.browser.compare(SC.browser.version,"9.0")<0){if(this.keyCode==8||this.keyCode==9||(this.keyCode>=37&&this.keyCode<=40)){return String.fromCharCode(0)}else{return(this.keyCode>0)?String.fromCharCode(this.keyCode):null}}else{return(this.charCode>0)?String.fromCharCode(this.charCode):null}},commandCodes:function(){var e=this.keyCode,b=null,c=null,a="",d;if(e&&e!==this.charCode){b=SC.FUNCTION_KEYS[e];if(!b&&(this.altKey||this.ctrlKey||this.metaKey)){b=SC.PRINTABLE_KEYS[e]}if(b){if(this.altKey){a+="alt_"}if(this.ctrlKey||this.metaKey){a+="ctrl_"}if(this.shiftKey){a+="shift_"}}}if(!b){e=this.which;c=b=String.fromCharCode(e);d=b.toLowerCase();if(this.metaKey){a="meta_";b=d}else{b=null}}if(b){b=a+b}return[b,c]}};SC.Event.observe=SC.Event.add;SC.Event.stopObserving=SC.Event.remove;SC.Event.fire=SC.Event.trigger;if(SC.browser.name===SC.BROWSER.ie){SC.Event.add(window,"unload",SC.Event.prototype,SC.Event.unload)}SC.MODIFIER_KEYS={16:"shift",17:"ctrl",18:"alt"};SC.FUNCTION_KEYS={8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"};SC.PRINTABLE_KEYS={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'};SC.SYSTEM_CURSOR="default";SC.AUTO_CURSOR=SC.DEFAULT_CURSOR="auto";SC.CROSSHAIR_CURSOR="crosshair";SC.HAND_CURSOR=SC.POINTER_CURSOR="pointer";SC.MOVE_CURSOR="move";SC.E_RESIZE_CURSOR="e-resize";SC.NE_RESIZE_CURSOR="ne-resize";SC.NW_RESIZE_CURSOR="nw-resize";SC.N_RESIZE_CURSOR="n-resize";SC.SE_RESIZE_CURSOR="se-resize";SC.SW_RESIZE_CURSOR="sw-resize";SC.S_RESIZE_CURSOR="s-resize";SC.W_RESIZE_CURSOR="w-resize";SC.IBEAM_CURSOR=SC.TEXT_CURSOR="text";SC.WAIT_CURSOR="wait";SC.HELP_CURSOR="help";SC.Cursor=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("cursorStyle")||SC.DEFAULT_CURSOR,c=this.constructor.sharedStyleSheet(),b=SC.guidFor(this);if(c.insertRule){c.insertRule("."+b+" {cursor: "+a+";}",c.cssRules?c.cssRules.length:0)}else{if(c.addRule){c.addRule("."+b,"cursor: "+a)}}this.cursorStyle=a;this.className=b;return this},className:null,cursorStyle:SC.DEFAULT_CURSOR,cursorStyleDidChange:function(){var d,f,c,e,g,b,a;d=this.get("cursorStyle")||SC.DEFAULT_CURSOR;f=this._rule;if(f){f.style.cursor=d;return}c="."+this.get("className");e=this.constructor.sharedStyleSheet();g=(e.cssRules?e.cssRules:e.rules)||[];for(b=0,a=g.length;b<a;++b){f=g[b];if(f.selectorText===c){this._rule=f;f.style.cursor=d;break}}}.observes("cursorStyle")});SC.Cursor.sharedStyleSheet=function(){var b,a=this._styleSheet;if(!a){a=document.createElement("style");a.type="text/css";b=document.getElementsByTagName("head")[0];if(!b){b=document.documentElement}b.appendChild(a);a=document.styleSheets[document.styleSheets.length-1];this._styleSheet=a}return a};SC.Theme={isTheme:YES,classNames:SC.CoreSet.create(),_extend_class_names:function(b){if(b){if(SC.typeOf(b)===SC.T_HASH&&!b.isSet){for(var a in b){if(b[a]){this.classNames.add(a)}else{this.classNames.remove(a)}}}else{if(typeof b==="string"){this.classNames.addEach(b.split(" "))}else{this.classNames.addEach(b)}}}},_extend_self:function(b){if(b.classNames){this._extend_class_names(b.classNames)}var a,c,d;for(a in b){if(a==="classNames"){continue}if(!b.hasOwnProperty(a)){continue}c=b[a];if(c instanceof Function&&!c.base&&(c!==(d=this[a]))){c.base=d}this[a]=c}},create:function(){var c=SC.beget(this);c.baseTheme=this;if(this.themes===SC.Theme.themes){c.themes={}}else{c.themes=SC.beget(this.themes)}c._privateThemes={};c._specializedThemes={};c.classNames=SC.clone(this.classNames);var e=arguments,b=e.length,a,d;for(a=0;a<b;a++){c._extend_self(e[a])}if(c.name){c.classNames.add(c.name)}return c},subtheme:function(a){var b=this.create({name:a});this.addTheme(b);return b},invisibleSubtheme:function(a){var b=this.create({name:a});this._privateThemes[a]=b;return b},themes:{},find:function(a){if(this===SC.Theme){return this.themes[a]}var b;b=this._privateThemes[a];if(b){return b}b=this._specializedThemes[a];if(b){return b}b=this.themes[a];if(b&&!this._specializedThemes[a]){return(this._specializedThemes[a]=b.create({classNames:this.classNames}))}b=SC.Theme.themes[a];if(b){return b}return null},addTheme:function(a){this.themes[a.name]=a}};SC.BaseTheme=SC.Theme.create({name:""});SC.Theme.themes["sc-base"]=SC.BaseTheme;SC.defaultTheme="sc-base";sc_require("mixins/delegate_support");SC.CoreView=SC.Responder.extend(SC.DelegateSupport);sc_require("system/browser");sc_require("system/event");sc_require("system/cursor");sc_require("system/responder");sc_require("system/theme");sc_require("system/string");sc_require("views/view/base");SC.CONTEXT_MENU_ENABLED=YES;SC.TABBING_ONLY_INSIDE_DOCUMENT=NO;SC.FROM_THEME="__FROM_THEME__";SC.EMPTY_CHILD_VIEWS_ARRAY=[];SC.EMPTY_CHILD_VIEWS_ARRAY.needsClone=YES;SC.CoreView.reopen({concatenatedProperties:["outlets","displayProperties","classNames","renderMixin","didCreateLayerMixin","willDestroyLayerMixin","classNameBindings","attributeBindings"],ariaRole:null,ariaHidden:null,pane:function(){var a=this;while(a&&!a.isPane){a=a.get("parentView")}return a}.property("parentView").cacheable(),page:null,parentView:null,isVisible:YES,isVisibleBindingDefault:SC.Binding.bool(),isVisibleInWindow:YES,childViews:SC.EMPTY_CHILD_VIEWS_ARRAY,layer:function(a,c){if(c!==undefined){this._view_layer=c}else{c=this._view_layer;if(!c){var b=this.get("parentView");if(b){b=b.get("layer")}this._view_layer=c=this.findLayerInParentLayer(b)}}return c}.property("isVisibleInWindow").cacheable(),$:function(b){var a=this.get("layer");if(!a){return SC.$()}else{if(b===undefined){return SC.$(a)}else{return SC.$(b,a)}}},containerLayer:function(){return this.get("layer")}.property("layer").cacheable(),layerId:function(a,b){if(b){this._layerId=b}if(this._layerId){return this._layerId}return SC.guidFor(this)}.property().cacheable(),findLayerInParentLayer:function(a){var b="#"+this.get("layerId");return jQuery(b,a)[0]||jQuery(b)[0]},isDescendantOf:function(a){var b=this.get("parentView");if(this===a){return YES}else{if(b){return b.isDescendantOf(a)}else{return NO}}},displayDidChange:function(){this.set("layerNeedsUpdate",YES);return this},_sc_isVisibleDidChange:function(){this.displayDidChange()}.observes("isVisible"),layerNeedsUpdate:NO,_view_layerNeedsUpdateDidChange:function(){if(this.get("layerNeedsUpdate")){this.invokeOnce(this.updateLayerIfNeeded)}}.observes("layerNeedsUpdate"),updateLayerIfNeeded:function(b){var c=this.get("layerNeedsUpdate"),a=c&&(b||this.get("isVisibleInWindow"));if(a){if(this.get("layer")){this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);this.updateLayer();this.endPropertyChanges()}}return this},updateLayer:function(f){var c,b,a,d;var e=f||this.renderContext(this.get("layer"));this._renderLayerSettings(e,NO);d=!this.update;if(d){this.render(e,NO)}else{this.update(e.$())}if(c=this.renderMixin){a=c.length;for(b=0;b<a;++b){c[b].call(this,e,NO)}}e.update();if(e._innerHTMLReplaced){var g=this.get("pane");if(g&&g.get("isPaneAttached")){this._notifyDidAppendToDocument()}}if(this.useStaticLayout){this.viewDidResize()}if(this.didUpdateLayer){this.didUpdateLayer()}if(this.designer&&this.designer.viewDidUpdateLayer){this.designer.viewDidUpdateLayer()}return this},parentViewDidResize:function(){if(!this.get("hasLayout")){this.notifyPropertyChange("frame")}this.viewDidResize()},viewDidResize:function(){},renderContext:function(a){return SC.RenderContext(a)},createLayer:function(){if(this.get("layer")){return this}var a=this.renderContext(this.get("tagName"));this.renderToContext(a);this.set("layer",a.element());this._notifyDidCreateLayer();return this},_notifyDidCreateLayer:function(){this.notifyPropertyChange("layer");if(this.get("useStaticLayout")){this.viewDidResize()}if(this.didCreateLayer){this.didCreateLayer()}var c=this.didCreateLayerMixin,b,a,d=this.get("childViews"),e;if(c){b=c.length;for(a=0;a<b;++a){c[a].call(this)}}b=d.length;for(a=0;a<b;++a){e=d[a];if(!e){continue}e.notifyPropertyChange("layer");if(this.get("useStaticLayout")){if(!e.get("isFixedLayout")){e.viewDidResize()}}e._notifyDidCreateLayer()}},destroyLayer:function(){var a=this.get("layer");if(a){this._notifyWillDestroyLayer();if(a.parentNode){a.parentNode.removeChild(a)}a=null}return this},replaceLayer:function(){this.destroyLayer();this.set("layerLocationNeedsUpdate",YES);this.invokeOnce(this.updateLayerLocationIfNeeded)},parentViewDidChange:function(){this.parentViewDidResize();this.updateLayerLocation()},layerLocationNeedsUpdate:NO,updateLayerLocationIfNeeded:function(a){if(this.get("layerLocationNeedsUpdate")){this.updateLayerLocation()}return this},updateLayerLocation:function(){var e=this.get("layer"),d=this.get("parentView"),b=d?d.get("containerLayer"):null;if(e&&e.parentNode&&e.parentNode!==b){e.parentNode.removeChild(e)}if(!d){if(e&&e.parentNode){e.parentNode.removeChild(e)}}else{if(!b){if(e){if(e.parentNode){e.parentNode.removeChild(e)}this.destroyLayer()}}else{if(!e){this.createLayer();e=this.get("layer");if(!e){return}}var f=d.get("childViews"),c=f.objectAt(f.indexOf(this)+1),a=(c)?c.get("layer"):null;if(c&&(!a||a.parentNode!==b)){c.updateLayerLocationIfNeeded();a=c.get("layer")||null}if((e.parentNode!==b)||(e.nextSibling!==a)){b.insertBefore(e,a)}}}b=d=e=a=null;this.set("layerLocationNeedsUpdate",NO);return this},_notifyWillDestroyLayer:function(){if(this.willDestroyLayer){this.willDestroyLayer()}var c=this.willDestroyLayerMixin,b,a,d=this.get("childViews");if(c){b=c.length;for(a=0;a<b;++a){c[a].call(this)}}b=d.length;for(a=0;a<b;++a){d[a]._notifyWillDestroyLayer()}this.set("layer",null)},renderToContext:function(e,f){var d,c,b,a;this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);if(SC.none(f)){f=YES}this._renderLayerSettings(e,f);d=!this.update;if(d){this.render(e,f)}else{if(f){this.render(e)}else{this.update(e.$())}}if(f&&!this._didRenderChildViews){this.renderChildViews(e,f)}this._didRenderChildViews=NO;if(c=this.renderMixin){a=c.length;for(b=0;b<a;++b){c[b].call(this,e,f)}}this.endPropertyChanges()},_renderLayerSettings:function(a,b){a.resetClassNames();a.resetStyles();this.applyAttributesToContext(a)},applyAttributesToContext:function(a){if(!this.get("layer")){this._applyClassNameBindings();this._applyAttributeBindings(a)}a.addClass(this.get("classNames"));if(this.get("isTextSelectable")){a.addClass("allow-select")}if(!this.get("isVisible")){a.addClass("sc-hidden")}if(this.get("isFirstResponder")){a.addClass("focus")}a.id(this.get("layerId"));a.attr("role",this.get("ariaRole"));var b=this.get("ariaHidden");if(b!==null){if(b===NO){a.removeAttr("aria-hidden")}else{a.attr("aria-hidden",b)}}},_applyClassNameBindings:function(){var a=this.get("classNameBindings"),b=this.get("classNames"),c;if(!a){return}a.forEach(function(f){var e;var d=function(){var h=this._classStringForProperty(f);var g=this.$();if(e){g.removeClass(e);b.removeObject(e)}if(h){g.addClass(h);b.push(h);e=h}else{e=null}};this.addObserver(f.split(":")[0],this,d);c=this._classStringForProperty(f);if(c){b.push(c);e=c}},this)},_applyAttributeBindings:function(a){var e=this.get("attributeBindings"),c,d,b;if(!e){return}e.forEach(function(g){var f=function(){d=this.$();var h=d.attr(g);c=this.get(g);b=typeof c;if((b==="string"||b==="number")&&c!==h){d.attr(g,c)}else{if(c&&b==="boolean"){d.attr(g,g)}else{if(c===NO){d.removeAttr(g)}}}};this.addObserver(g,this,f);c=this.get(g);b=typeof c;if(b==="string"||b==="number"){a.attr(g,c)}else{if(c&&b==="boolean"){a.attr(g,g)}}},this)},_classStringForProperty:function(c){var a=c.split(":"),b=a[1];c=a[0];var d=SC.getPath(this,c);if(d===YES){if(b){return b}return SC.String.dasherize(c.split(".").get("lastObject"))}else{if(d!==NO&&d!==undefined&&d!==null){return d}else{return null}}},prepareContext:function(a,b){if(b!==false){b=YES}if(b){this.renderToContext(a)}else{this.updateLayer(a)}},renderChildViews:function(e,f){var d=this.get("childViews"),b=d.length,a,c;for(a=0;a<b;++a){c=d[a];if(!c){continue}e=e.begin(c.get("tagName"));c.renderToContext(e,f);e=e.end()}this._didRenderChildViews=YES;return e},render:function(){},_notifyDidAppendToDocument:function(){if(!this.get("hasLayout")){this.notifyPropertyChange("frame")}if(this.didAppendToDocument){this.didAppendToDocument()}var c=0,d,a,b=this.get("childViews");for(c=0,a=b.length;c<a;c++){d=b[c];if(d._notifyDidAppendToDocument){d._notifyDidAppendToDocument()}}},childViewsObserver:function(){var c=this.get("childViews"),b,a,d;for(b=0,a=c.length;b<a;b++){d=c[b];if(d._notifyDidAppendToDocument){d._notifyDidAppendToDocument()}}}.observes("childViews"),attributeBindings:null,tagName:"div",classNames:[],classNameBindings:null,toolTip:null,displayToolTip:function(){var a=this.get("toolTip");return(a&&this.get("localize"))?SC.String.loc(a):(a||"")}.property("toolTip","localize").cacheable(),isTextSelectable:NO,displayProperties:["ariaHidden"],nextResponder:function(){return this.get("parentView")}.property("parentView").cacheable(),acceptsFirstResponder:NO,init:function(){var e=this.get("parentView"),g,b,d,f;arguments.callee.base.apply(this,arguments);SC.View.views[this.get("layerId")]=this;this.classNames=this.get("classNames").slice();this.childViews=this.get("childViews").slice();this.createChildViews();f=this.get("displayProperties");for(var c=0,a=f.length;c<a;c++){this.addObserver(f[c],this,this.displayDidChange)}},awake:function(){arguments.callee.base.apply(this,arguments);var c=this.get("childViews"),b=c.length,a;for(a=0;a<b;++a){if(!c[a]){continue}c[a].awake()}},frame:function(){return this.computeFrameWithParentFrame(null)}.property("useStaticLayout").cacheable(),computeFrameWithParentFrame:function(){var a,b=this.get("parentView"),c;if(a=this.get("layer")){c=SC.offset(a);if(b){c=b.convertFrameFromView(c,null)}c.width=a.offsetWidth;c.height=a.offsetHeight;return c}if(this.get("hasLayout")){return null}else{return{x:0,y:0,width:0,height:0}}},clippingFrame:function(){var e=this.get("frame"),a=e,c,d,b;if(!e){return null}c=this.get("parentView");if(c){d=c.get("clippingFrame");if(!d){return{x:0,y:0,width:e.width,height:e.height}}b=c.convertFrameToView(e,null);b.x+=c.get("horizontalScrollOffset")||0;b.y+=c.get("verticalScrollOffset")||0;d=c.convertFrameToView(d,null);a=SC.intersectRects(d,b);a=this.convertFrameFromView(a,null,true)}else{a.x-=e.x;a.y-=e.y}return a}.property("parentView","frame","horizontalScrollOffset","verticalScrollOffset").cacheable(),_sc_view_clippingFrameDidChange:function(){var d=this.get("childViews"),b=d.length,a,c;for(a=0;a<b;++a){c=d[a];c.notifyPropertyChange("clippingFrame");c._sc_view_clippingFrameDidChange()}},removeChild:function(b){b.set("parentView",null);var c=this.get("childViews"),a=c.indexOf(b);if(a>=0){c.removeAt(a)}return this},removeAllChildren:function(){var b=this.get("childViews"),a;while(a=b.objectAt(b.get("length")-1)){this.removeChild(a)}return this},removeFromParent:function(){var a=this.get("parentView");if(a){a.removeChild(this)}return this},destroy:function(){if(this.get("isDestroyed")){return this}this._destroy();return arguments.callee.base.apply(this,arguments)},_destroy:function(){this.destroyLayer();var c=this.get("childViews"),b=c.length,a;if(b){c=c.slice();for(a=0;a<b;++a){c[a].destroy()}}delete SC.View.views[this.get("layerId")];delete this._CQ;delete this.page;if(this.get("parentView")){this.removeFromParent()}this.set("owner",null);return this},createChildViews:function(){var f=this.get("childViews"),b=f.length,a,e,d,c;this.beginPropertyChanges();for(a=0;a<b;++a){if(e=(c=f[a])){if(typeof e===SC.T_STRING){c=this[e]}else{e=null}if(!c){SC.Logger.error("No view with name "+e+" has been found in "+this.toString());continue}c=this.createChildView(c);if(e){this[e]=c}}f[a]=c}this.endPropertyChanges();return this},createChildView:function(a,b){if(!a.isClass){b=a}else{if(!b){b={}}else{b=SC.clone(b)}}b.owner=b.parentView=this;if(a.isClass&&a.prototype.hasVisibility){b.isVisibleInWindow=this.get("isVisibleInWindow")}if(!b.page){b.page=this.page}if(a.isClass){a=a.create(b)}return a},isView:YES,selectStart:function(a){return this.get("isTextSelectable")},contextMenu:function(a){if(this.get("isContextMenuEnabled")){return YES}}});SC.CoreView.mixin({isViewClass:YES,design:function(){if(this.isDesign){return this}var a=this.extend.apply(this,arguments);a.isDesign=YES;if(SC.ViewDesigner){SC.ViewDesigner.didLoadDesign(a,this,SC.A(arguments))}return a},extend:function(){var a=arguments[arguments.length-1];if(a&&!SC.none(a.theme)){a.themeName=a.theme;delete a.theme}return SC.Object.extend.apply(this,arguments)},layout:function(a){this.prototype.layout=a;return this},classNames:function(a){a=(this.prototype.classNames||[]).concat(a);this.prototype.classNames=a;return this},tagName:function(a){this.prototype.tagName=a;return this},childView:function(a){var b=this.prototype.childViews||[];if(b===this.superclass.prototype.childViews){b=b.slice()}b.push(a);this.prototype.childViews=b;return this},bind:function(b,d){var c=this.prototype,a=this.superclass.prototype;var e=c._bindings;if(!e||e===a._bindings){e=c._bindings=(e||[]).slice()}b=b+"Binding";c[b]=d;e.push(b);return this},prop:function(a,b){this.prototype[a]=b;return this},localization:function(b,a){if(a){b.rootElement=SC.$(a)[0]}return b},viewFor:function(d,c){var b=SC.$A(arguments);if(SC.none(d)){b.shift()}else{b[0]={rootElement:SC.$(d)[0]}}var a=this.create.apply(this,arguments);b=b[0]=null;return a},create:function(){var b=arguments[arguments.length-1];if(b&&b.theme){b.themeName=b.theme;delete b.theme}var c=this,a=new c(arguments);if(SC.ViewDesigner){SC.ViewDesigner.didCreateView(a,SC.$A(arguments))}return a},loc:function(e){var b=e.childViews;delete e.childViews;this.applyLocalizedAttributes(e);if(SC.ViewDesigner){SC.ViewDesigner.didLoadLocalization(this,SC.$A(arguments))}var d=this.prototype.childViews,a=d.length,c;while(--a>=0){c=d[a];e=b[a];if(e&&c&&typeof c===SC.T_STRING){SC.String.loc(c,e)}}return this},applyLocalizedAttributes:function(a){SC.mixin(this.prototype,a)},views:{}});SC.outlet=function(b,a){return function(c){return(this[c]=SC.objectForPropertyPath(b,(a!==undefined)?a:this))}.property()};SC.CoreView.unload=function(){var a=SC.View.views;if(a){for(var b in a){if(!a.hasOwnProperty(b)){continue}delete a[b]}}};SC.View=SC.CoreView.extend({classNames:["sc-view"],displayProperties:["isFirstResponder"]});if(SC.browser.isIE){SC.Event.add(window,"unload",SC.View,SC.View.unload)}sc_require("views/view");sc_require("views/view/layout_style");SC.ANIMATABLE_PROPERTIES={top:YES,left:YES,bottom:YES,right:YES,width:YES,height:YES,centerX:YES,centerY:YES,opacity:YES,scale:YES,rotate:YES,rotateX:YES,rotateY:YES,rotateZ:YES};SC.View.reopen({didCreateLayerMixin:function(){if(SC.platform.supportsCSSTransitions){this.resetAnimation()}},animate:function(o,k,d,n){var f,p;if(typeof o===SC.T_STRING){f={};f[o]=k;p=d}else{f=o;p=k;n=d}var c=SC.typeOf(p);if(c===SC.T_NUMBER){p={duration:p}}else{if(c!==SC.T_HASH){throw"Must provide options hash or duration!"}}if(n){p.callback=n}else{if(p.callback){n=p.callback}}if(p.duration===0){var i=this.adjust(f);if(n){this.layoutStyleCalculator.invokeOnceLater("runAnimationCallback",1,n,null,NO)}return i}var a=p.timing;if(a){if(typeof a!==SC.T_STRING){p.timing="cubic-bezier("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}}else{p.timing="linear"}var g=SC.clone(this.get("layout")),h=NO,j,m,b,e,l;if(!g.animate){g.animate={}}for(l in f){if(!f.hasOwnProperty(l)||!SC.ANIMATABLE_PROPERTIES[l]){continue}j=f[l];m=g[l];e=g.animate[l];if(SC.none(j)){throw"Can only animate to an actual value!"}if(m!==j||(e&&e.duration!==p.duration)){h=YES;g.animate[l]=p;g[l]=j}}if(h){this.set("layout",g)}else{if(n){this.layoutStyleCalculator.invokeOnceLater("runAnimationCallback",1,n,null,NO)}}return this},resetAnimation:function(){var c=this.get("layout"),e=c.animate,d=NO,b;if(!e){return}var a;for(b in e){d=YES;delete e[b]}if(d){this.set("layout",c);this.notifyPropertyChange("layout")}return this},transitionDidEnd:function(a){this.get("layoutStyleCalculator").transitionDidEnd(a)}});sc_require("ext/string");sc_require("views/view");sc_require("views/view/animation");SC.CSS_TRANSFORM_MAP={rotate:function(a){return null},rotateX:function(a){if(SC.typeOf(a)===SC.T_NUMBER){a+="deg"}return"rotateX("+a+")"},rotateY:function(a){if(SC.typeOf(a)===SC.T_NUMBER){a+="deg"}return"rotateY("+a+")"},rotateZ:function(a){if(SC.typeOf(a)===SC.T_NUMBER){a+="deg"}return"rotateZ("+a+")"},scale:function(a){if(SC.typeOf(a)===SC.T_ARRAY){a=a.join(", ")}return"scale("+a+")"}};SC.View.reopen({layoutStyleCalculator:null,layoutStyle:function(){var a={layout:this.get("layout"),turbo:this.get("hasAcceleratedLayer"),staticLayout:this.get("useStaticLayout")};var b=this.get("layoutStyleCalculator");b.set(a);return b.calculate()}.property().cacheable()});SC.View.LayoutStyleCalculator=SC.Object.extend({_layoutDidUpdate:function(){var g=this.get("layout");if(!g){return}this.dims=SC._VIEW_DEFAULT_DIMS;this.loc=this.dims.length;var n=(this.right=g.right);this.hasRight=(n!=null);var c=(this.left=g.left);this.hasLeft=(c!=null);var j=(this.top=g.top);this.hasTop=(j!=null);var a=(this.bottom=g.bottom);this.hasBottom=(a!=null);var b=(this.width=g.width);this.hasWidth=(b!=null);var o=(this.height=g.height);this.hasHeight=(o!=null);this.minWidth=((g.minWidth===undefined)?null:g.minWidth);var m=(this.maxWidth=(g.maxWidth===undefined)?null:g.maxWidth);this.hasMaxWidth=(m!=null);this.minHeight=(g.minHeight===undefined)?null:g.minHeight;var l=(this.maxHeight=(g.maxHeight===undefined)?null:g.maxHeight);this.hasMaxHeight=(l!=null);var f=(this.centerX=g.centerX);this.hasCenterX=(f!=null);var e=(this.centerY=g.centerY);this.hasCenterY=(e!=null);var d=(this.borderTop=((g.borderTop!==undefined)?g.borderTop:g.border)||0);var k=(this.borderRight=((g.borderRight!==undefined)?g.borderRight:g.border)||0);var i=(this.borderBottom=((g.borderBottom!==undefined)?g.borderBottom:g.border)||0);var h=(this.borderLeft=((g.borderLeft!==undefined)?g.borderLeft:g.border)||0);this.zIndex=(g.zIndex!=null)?g.zIndex.toString():null;this.opacity=(g.opacity!=null)?g.opacity.toString():null;this.backgroundPosition=(g.backgroundPosition!=null)?g.backgroundPosition:null;this.ret={marginTop:null,marginLeft:null}}.observes("layout"),_invalidAutoValue:function(b){var a=SC.Error.desc("%@.layout() you cannot use %@:auto if staticLayout is disabled".fmt(this.get("view"),b),"%@".fmt(this.get("view")),-1);SC.Logger.error(a.toString());throw a},_handleMistakes:function(){var c=this.get("layout");if(!this.staticLayout){if(this.width===SC.LAYOUT_AUTO){this._invalidAutoValue("width")}if(this.height===SC.LAYOUT_AUTO){this._invalidAutoValue("height")}}if(SC.platform.supportsCSSTransforms){var d=c.animate,a,b;if(d){for(b in d){if(SC.CSS_TRANSFORM_MAP[b]){if(this._pendingAnimations&&this._pendingAnimations["-"+SC.platform.cssPrefix+"-transform"]){throw"Animations of transforms must be executed simultaneously!"}if(a&&d[b].duration!==a){SC.Logger.warn("Can't animate transforms with different durations! Using first duration specified.");d[b].duration=a}a=d[b].duration}}}}},_calculatePosition:function(n){var g=null,a=this.get("turbo"),r=this.ret;var d,k,j,c,i,m,b,f,e,l,q,h,o,p;if(n==="x"){d="left";k="right";j="width";c="maxWidth";i="marginLeft";l="borderLeft";h="borderRight";m=this.hasLeft;b=this.hasRight;f=this.hasWidth;e=this.hasMaxWidth}else{d="top";k="bottom";j="height";c="maxHeight";i="marginTop";l="borderTop";h="borderBottom";m=this.hasTop;b=this.hasBottom;f=this.hasHeight;e=this.hasMaxHeight}r[d]=this._cssNumber(this[d]);r[k]=this._cssNumber(this[k]);q=this._cssNumber(this[l]);o=this._cssNumber(this[h]);r[l+"Width"]=q||null;r[h+"Width"]=o||null;p=this[j];if(p>=1){p-=(q+o)}r[j]=this._cssNumber(p);if(m){if(a){g=r[d];r[d]=0}if(b&&f){r[k]=null}}else{if(!b||(b&&!f&&!e)){r[d]=0}}if(!f&&!b){r[k]=0}return g},_calculateCenter:function(n){var i=this.ret,q,a,c,o,f,g,l,m,e;if(n==="x"){q="width";a="centerX";c="left";o="right";f="marginLeft";g="borderLeft";m="borderRight"}else{q="height";a="centerY";c="top";o="bottom";f="marginTop";g="borderTop";m="borderBottom"}i[c]="50%";l=this._cssNumber(this[g]);e=this._cssNumber(this[m]);i[g+"Width"]=l||null;i[m+"Width"]=e||null;var k=this[q],j=this[a],b=this[c];var h=SC.isPercentage(k),d=SC.isPercentage(j,YES);if(k>1){k-=(l+e)}if((h&&d)||(!h&&!d)){var p=j-k/2;i[f]=(h)?Math.floor(p*100)+"%":Math.floor(p)}else{SC.Logger.warn("You have to set "+q+" and "+a+" using both percentages or pixels");i[f]="50%"}i[q]=this._cssNumber(k)||0;i[o]=null},_calculateTransforms:function(e,h){if(SC.platform.supportsCSSTransforms){var g=this.get("layout");var b=SC.platform.domCSSPrefix+"Transform";var d=[];if(this.turbo){d.push("translateX("+(e||0)+"px)","translateY("+(h||0)+"px)");if(SC.platform.supportsCSS3DTransforms){d.push("translateZ(0px)")}}var f=SC.CSS_TRANSFORM_MAP;for(var a in f){var c=g[a];if(c!=null){d.push(f[a](c))}}this.ret[b]=d.length>0?d.join(" "):null}},_calculateAnimations:function(e,c){var d=this.layout,h=d.animate,g;if(!h){return}if(this.getPath("view.isAnimatable")){return}var f=[],b;this._animatedTransforms=[];if(!this._pendingAnimations){this._pendingAnimations={}}var i="-"+SC.platform.cssPrefix+"-transform";if(SC.platform.supportsCSSTransitions){for(g in h){b=h[g];var j=SC.CSS_TRANSFORM_MAP[g];var a=(g==="top"&&c!=null)||(g==="left"&&e!=null);if(SC.platform.supportsCSSTransforms&&(a||j)){this._animatedTransforms.push(g);g=i}b.css=g+" "+b.duration+"s "+b.timing;if(!this._pendingAnimations[g]){this._pendingAnimations[g]=b;f.push(b.css)}}this.ret[SC.platform.domCSSPrefix+"Transition"]=f.join(", ")}else{for(g in h){this._pendingAnimations[g]=h[g]}}delete d.animate},_cssNumber:function(a){if(a==null){return null}else{if(a===SC.LAYOUT_AUTO){return SC.LAYOUT_AUTO}else{if(SC.isPercentage(a)){return(a*100)+"%"}else{return Math.floor(a)}}}},calculate:function(){var d=this.get("layout"),b=null,l=this.get("staticLayout"),c=null,e=null,a=this.get("turbo"),g=this.ret,j=this.dims,f=this.loc,h=this.get("view"),k,i;this._handleMistakes(d);if(l&&d===SC.View.prototype.layout){return{}}if(this.hasLeft||this.hasRight||!this.hasCenterX){e=this._calculatePosition("x")}else{this._calculateCenter("x")}if(this.hasTop||this.hasBottom||!this.hasCenterY){c=this._calculatePosition("y")}else{this._calculateCenter("y")}g.minWidth=this.minWidth;g.maxWidth=this.maxWidth;g.minHeight=this.minHeight;g.maxHeight=this.maxHeight;g.zIndex=this.zIndex;g.opacity=this.opacity;g.backgroundPosition=this.backgroundPosition;this._calculateTransforms(e,c);this._calculateAnimations(e,c);for(k in g){i=g[k];if(typeof i===SC.T_NUMBER){g[k]=(i+"px")}}return g},willRenderAnimations:function(){if(SC.platform.supportsCSSTransitions){var h=this.get("view"),f=h.get("layer"),a=f?f.style:null,b=h.get("layoutStyle"),l=this._activeAnimations,c,e=this._pendingAnimations,d,n=this._animatedTransforms,g=n?n.length:0,k,o=[],m,j,i;if(e){if(!l){l={}}for(k in e){if(!e.hasOwnProperty(k)){continue}d=e[k];c=l[k];i=NO;if(b[k]!==(a?a[k]:null)){i=YES}if(c&&(c.duration!==d.duration||c.timing!==d.timing)){i=YES}if(i&&c){if(m=c.callback){if(g>0){this.runAnimationCallback(m,null,YES);this._animatedTransforms=null}else{this.runAnimationCallback(m,null,YES)}}this.removeAnimationFromLayout(k,YES)}l[k]=d;o.push(k)}if(!this._groupedAnimations){this._groupedAnimations={}}this._groupedAnimations[k]=o;this._activeAnimations=l;this._pendingAnimations=null}}},didRenderAnimations:function(){if(!SC.platform.supportsCSSTransitions){var a,b;for(a in this._pendingAnimations){b=this._pendingAnimations[a].callback;if(b){this.invokeOnceLater("runAnimationCallback",1,b,null,NO)}this.removeAnimationFromLayout(a,NO,YES)}this._activeAnimations=this._pendingAnimations=null}},runAnimationCallback:function(d,b,c){var a=this.get("view");if(d){if(SC.typeOf(d)!==SC.T_HASH){d={action:d}}d.source=a;if(!d.target){d.target=this}}SC.View.runCallback(d,{event:b,view:a,isCancelled:c})},transitionDidEnd:function(c){var e=c.originalEvent.propertyName,d,h,b;h=this._activeAnimations?this._activeAnimations[e]:null;if(h){if(h.callback){this.invokeOnceLater("runAnimationCallback",1,h.callback,c,NO)}this.removeAnimationFromLayout(e,YES);var g;d=this._groupedAnimations&&this._groupedAnimations[e];if(d){for(var f=0,a=d.length;f<a;f++){g=d[f];delete this._activeAnimations[g]}delete this._groupedAnimations[e]}}},removeAnimationFromLayout:function(c,h,b){if(h){var e=this.getPath("view.layer"),g=[],d;for(d in this._activeAnimations){if(d!==c){g.push(this._activeAnimations[d].css)}}if(e){e.style[SC.platform.domCSSPrefix+"Transition"]=g.join(", ")}}var f=this.getPath("view.layout"),a;if(c==="-"+SC.platform.cssPrefix+"-transform"&&this._animatedTransforms&&this._animatedTransforms.length>0){for(a=0;a<this._animatedTransforms.length;a++){delete f["animate"+SC.String.capitalize(this._animatedTransforms[a])]}this._animatedTransforms=null}delete f["animate"+SC.String.capitalize(c)]}});SC.CoreView.runCallback=function(g){var b=SC.$A(arguments).slice(1),a=SC.typeOf(g.action);if(a==SC.T_FUNCTION){g.action.apply(g.target,b)}else{if(a===SC.T_STRING){if(g.action.indexOf(".")>=0){var f=g.action.split(".");var d=f.pop();var e=SC.objectForPropertyPath(f,window);var c=e.get?e.get(d):e[d];if(c&&SC.typeOf(c)==SC.T_FUNCTION){c.apply(e,b)}else{throw"SC.runCallback could not find a function at %@".fmt(g.action)}}}}};SC.View.runCallback=SC.CoreView.runCallback;sc_require("views/view");sc_require("views/view/layout_style");SC.LAYOUT_HORIZONTAL="sc-layout-horizontal";SC.LAYOUT_VERTICAL="sc-layout-vertical";SC._VIEW_DEFAULT_DIMS=["marginTop","marginLeft"];SC.FULL_WIDTH={left:0,right:0};SC.FULL_HEIGHT={top:0,bottom:0};SC.ANCHOR_CENTER={centerX:0,centerY:0};SC.LAYOUT_AUTO="auto";SC.View.reopen({hasLayout:YES,concatenatedProperties:["layoutProperties"],backgroundColor:null,displayProperties:["backgroundColor"],useStaticLayout:NO,init:function(a){a();this.layoutStyleCalculator=SC.View.LayoutStyleCalculator.create({view:this});this._previousLayout=this.get("layout")}.enhance(),propertyDidChange:function(b,d,c){var a=false;if(typeof this.layout==="function"&&this._kvo_dependents){var e=this._kvo_dependents[b];if(e&&e.indexOf("layout")!=-1){a=true}}if(b==="layout"||a){this.layoutDidChange()}arguments.callee.base.apply(this,arguments)},adjust:function(a,d){var b=this.get("layout"),c=NO,f,e;if(a===undefined){return this}if(SC.typeOf(a)===SC.T_STRING){f=b[a];if(d===undefined||f==d){return this}b=SC.clone(b);if(d===null){delete b[a]}else{b[a]=d}c=YES}else{e=a;for(a in e){if(!e.hasOwnProperty(a)){continue}d=e[a];f=b[a];if(d===undefined||f==d){continue}if(!c){b=SC.clone(b)}if(d===null){delete b[a]}else{b[a]=d}c=YES}}if(c){this.set("layout",b)}return this},layout:{top:0,left:0,bottom:0,right:0},isFixedLayout:function(){return this.get("isFixedPosition")&&this.get("isFixedSize")}.property("isFixedPosition","isFixedSize").cacheable(),isFixedPosition:function(){var b=this.get("layout"),a;a=(((b.left!==undefined)&&(b.top!==undefined))&&((b.left!==SC.LAYOUT_AUTO)&&(b.top!==SC.LAYOUT_AUTO)));if(a){a=(!SC.isPercentage(b.top)&&!SC.isPercentage(b.left))}return a}.property("layout").cacheable(),isFixedSize:function(){var b=this.get("layout"),a;a=(((b.width!==undefined)&&(b.height!==undefined))&&((b.width!==SC.LAYOUT_AUTO)&&(b.height!==SC.LAYOUT_AUTO)));if(a){a=(!SC.isPercentage(b.width)&&!SC.isPercentage(b.height))}return a}.property("layout").cacheable(),convertFrameToView:function(i,d){var c=0,b=0,g=0,e=0,a=this,h;while(a){h=a.get("frame");c+=h.x;b+=h.y;c-=a.get("horizontalScrollOffset")||0;b-=a.get("verticalScrollOffset")||0;a=a.get("layoutView")}if(d){a=d;while(a){h=a.get("frame");g+=h.x;e+=h.y;g-=a.get("horizontalScrollOffset")||0;e-=a.get("verticalScrollOffset")||0;a=a.get("layoutView")}}c=i.x+c-g;b=i.y+b-e;return{x:c,y:b,width:i.width,height:i.height}},convertFrameFromView:function(b,a,j){var i=0,g=0,e=0,d=0,h=this,c;while(h&&(c=h.get("frame"))){i+=c.x;g+=c.y;if(j){i-=h.get("horizontalScrollOffset")||0;g-=h.get("verticalScrollOffset")||0}h=h.get("parentView")}if(a){h=a;while(h){c=h.get("frame");e+=c.x;d+=c.y;if(j){e-=h.get("horizontalScrollOffset")||0;d-=h.get("verticalScrollOffset")||0}h=h.get("parentView")}}i=b.x-i+e;g=b.y-g+d;return{x:i,y:g,width:b.width,height:b.height}},scrollToVisible:function(){var a=this.get("parentView");while(a&&!a.get("isScrollable")){a=a.get("parentView")}if(a){a.scrollToVisible();return a.scrollToVisible(this)}else{return NO}},_adjustForBorder:function(e,c){var f=((c.borderTop!==undefined)?c.borderTop:c.border)||0,d=((c.borderLeft!==undefined)?c.borderLeft:c.border)||0,b=((c.borderBottom!==undefined)?c.borderBottom:c.border)||0,a=((c.borderRight!==undefined)?c.borderRight:c.border)||0;e.x+=d;e.y+=f;e.width-=(d+a);e.height-=(f+b);return e},computeFrameWithParentFrame:function(m,g){var o,p=this.get("layout");if(this.get("useStaticLayout")){o=m();return o?this._adjustForBorder(o,p):null}else{o={}}var n,s,l=SC.LAYOUT_AUTO,k=this.get("parentView"),h,c,a=p.right,b=p.left,r=p.top,e=p.bottom,q=p.width,d=p.height,j=p.centerX,i=p.centerY;if(q===l){n=SC.Error.desc(("%@.layout() cannot use width:auto if staticLayout is disabled").fmt(this),"%@".fmt(this),-1);SC.Logger.error(n.toString());throw n}if(d===l){n=SC.Error.desc(("%@.layout() cannot use height:auto if staticLayout is disabled").fmt(this),"%@".fmt(this),-1);SC.Logger.error(n.toString());throw n}if(!g){g=this.computeParentDimensions(p)}h=g.height;c=g.width;if(!SC.none(b)){if(SC.isPercentage(b)){o.x=c*b}else{o.x=b}if(q!==undefined){if(q===l){o.width=l}else{if(SC.isPercentage(q)){o.width=c*q}else{o.width=q}}}else{o.width=c-o.x;if(a&&SC.isPercentage(a)){o.width=o.width-(a*c)}else{o.width=o.width-(a||0)}}}else{if(!SC.none(a)){if(SC.none(q)){if(SC.isPercentage(a)){o.width=c-(c*a)}else{o.width=c-a}o.x=0}else{if(q===l){o.width=l}else{if(SC.isPercentage(q)){o.width=c*q}else{o.width=(q||0)}}if(SC.isPercentage(q)){o.x=c-(a*c)-o.width}else{o.x=c-a-o.width}}}else{if(!SC.none(j)){if(q===l){o.width=l}else{if(SC.isPercentage(q)){o.width=q*c}else{o.width=(q||0)}}if(SC.isPercentage(j)){o.x=(c-o.width)/2+(j*c)}else{o.x=(c-o.width)/2+j}}else{o.x=0;if(SC.none(q)){o.width=c}else{if(q===l){o.width=l}if(SC.isPercentage(q)){o.width=q*c}else{o.width=(q||0)}}}}}if(!SC.none(r)){if(SC.isPercentage(r)){o.y=r*h}else{o.y=r}if(d!==undefined){if(d===l){o.height=l}else{if(SC.isPercentage(d)){o.height=d*h}else{o.height=d}}}else{if(e&&SC.isPercentage(e)){o.height=h-o.y-(e*h)}else{o.height=h-o.y-(e||0)}}}else{if(!SC.none(e)){if(SC.none(d)){if(SC.isPercentage(e)){o.height=h-(e*h)}else{o.height=h-e}o.y=0}else{if(d===l){o.height=l}if(d&&SC.isPercentage(d)){o.height=d*h}else{o.height=(d||0)}if(SC.isPercentage(e)){o.y=h-(e*h)-o.height}else{o.y=h-e-o.height}}}else{if(!SC.none(i)){if(d===l){o.height=l}if(d&&SC.isPercentage(d)){o.height=d*h}else{o.height=(d||0)}if(SC.isPercentage(i)){o.y=(h-o.height)/2+(i*h)}else{o.y=(h-o.height)/2+i}}else{o.y=0;if(SC.none(d)){o.height=h}else{if(d===l){o.height=l}if(SC.isPercentage(d)){o.height=d*h}else{o.height=d||0}}}}}o.x=Math.floor(o.x);o.y=Math.floor(o.y);if(o.height!==l){o.height=Math.floor(o.height)}if(o.width!==l){o.width=Math.floor(o.width)}if(o.height===l||o.width===l){s=this.get("layer");if(o.height===l){o.height=s?s.clientHeight:0}if(o.width===l){o.width=s?s.clientWidth:0}}o=this._adjustForBorder(o,p);if(k&&k.isScrollContainer){k=k.get("parentView");o.x-=k.get("horizontalScrollOffset");o.y-=k.get("verticalScrollOffset")}if(!SC.none(p.maxHeight)&&(o.height>p.maxHeight)){o.height=p.maxHeight}if(!SC.none(p.minHeight)&&(o.height<p.minHeight)){o.height=p.minHeight}if(!SC.none(p.maxWidth)&&(o.width>p.maxWidth)){o.width=p.maxWidth}if(!SC.none(p.minWidth)&&(o.width<p.minWidth)){o.width=p.minWidth}if(o.height<0){o.height=0}if(o.width<0){o.width=0}return o}.enhance(),computeParentDimensions:function(e){var b,c=this.get("parentView"),a=(c)?c.get("frame"):null;if(a){b={width:a.width,height:a.height}}else{var d=e||{};b={width:(d.left||0)+(d.width||0)+(d.right||0),height:(d.top||0)+(d.height||0)+(d.bottom||0)}}return b},borderFrame:function(){var d=this.get("layout"),f=this.get("frame"),a=d.border,e=((d.topBorder!==undefined)?d.topBorder:d.border)||0,c=((d.rightBorder!==undefined)?d.rightBorder:d.border)||0,g=((d.bottomBorder!==undefined)?d.bottomBorder:d.border)||0,b=((d.leftBorder!==undefined)?d.leftBorder:d.border)||0;return{x:f.x-b,y:f.y-e,width:f.width+b+c,height:f.height+e+g}}.property("frame").cacheable(),parentViewDidResize:function(){var b,a;a=this.useStaticLayout||!this.get("isFixedSize");b=!this.get("isFixedPosition");if(a){this.viewDidResize()}else{if(b){this._viewFrameDidChange()}}},viewDidResize:function(){this._viewFrameDidChange();var d=this.childViews,b,a,c;for(a=0;a<(b=d.length);++a){c=d[a];c.tryToPerform("parentViewDidResize")}},_viewFrameDidChange:function(){this.notifyPropertyChange("frame");this._sc_view_clippingFrameDidChange()},beginLiveResize:function(){if(this.willBeginLiveResize){this.willBeginLiveResize()}var d=this.get("childViews"),b=d.length,a,c;for(a=0;a<b;++a){c=d[a];if(c.beginLiveResize){c.beginLiveResize()}}return this},endLiveResize:function(){var d=this.get("childViews"),b=d.length,a,c;for(a=b-1;a>=0;--a){c=d[a];if(c.endLiveResize){c.endLiveResize()}}if(this.didEndLiveResize){this.didEndLiveResize()}return this},layoutView:function(){return this.get("parentView")}.property("parentView").cacheable(),layoutDidChange:function(){var g=this._previousLayout,f=this.get("layout"),i=YES,d,c,a,b;if(!SC.none(f.rotate)){if(SC.none(f.rotateX)){f.rotateX=f.rotate;SC.Logger.warn("Please set rotateX instead of rotate")}}if(!SC.none(f.rotateX)){f.rotate=f.rotateX}else{delete f.rotate}var h=f.animations;if(h){if(!SC.none(h.rotate)){if(SC.none(h.rotateX)){h.rotateX=h.rotate;SC.Logger.warn("Please animate rotateX instead of rotate")}}if(!SC.none(h.rotateX)){h.rotate=h.rotateX}else{delete h.rotate}}if(g&&g!==f){d=g.width;if(d!==undefined){a=f.width;if(d===a){c=g.height;if(g!==undefined){b=f.height;if(c===b){i=NO}}}}}this.beginPropertyChanges();this.notifyPropertyChange("hasAcceleratedLayer");this.notifyPropertyChange("layoutStyle");if(i){this.viewDidResize()}else{this._viewFrameDidChange()}this.endPropertyChanges();var e=this.get("layoutView");if(e){e.set("childViewsNeedLayout",YES);e.layoutDidChangeFor(this);if(e.get("childViewsNeedLayout")){e.invokeOnce(e.layoutChildViewsIfNeeded)}}this._previousLayout=f;return this},childViewsNeedLayout:NO,layoutDidChangeFor:function(b){var a=this._needLayoutViews;if(!a){a=this._needLayoutViews=SC.CoreSet.create()}a.add(b)},layoutChildViewsIfNeeded:function(a){if(!a){a=this.get("isVisibleInWindow")}if(a&&this.get("childViewsNeedLayout")){this.set("childViewsNeedLayout",NO);this.layoutChildViews()}return this},layoutChildViews:function(){var c=this._needLayoutViews,a=c?c.length:0,b;for(b=0;b<a;++b){c[b].updateLayout()}c.clear()},updateLayout:function(){var b=this.get("layer"),a;if(b){a=this.renderContext(b);this.renderLayout(a,NO);a.update();if(this.useStaticLayout){this.viewDidResize()}}b=null;return this},renderLayout:function(a,b){this.get("layoutStyleCalculator").willRenderAnimations();a.addStyle(this.get("layoutStyle"));this.get("layoutStyleCalculator").didRenderAnimations()},_renderLayerSettings:function(b,a,c){b(a,c);this.renderLayout(a,c)}.enhance(),applyAttributesToContext:function(b,a){b(a);if(this.get("useStaticLayout")){a.addClass("sc-static-layout")}if(this.get("backgroundColor")){a.css("backgroundColor",this.get("backgroundColor"))}}.enhance()});SC.View.mixin({convertLayoutToAnchoredLayout:function(f,m){var h={top:0,left:0,width:m.width,height:m.height},d=m.width,k=m.height,l=f.right,a=f.left,j=f.top,g=f.bottom,i=f.width,e=f.height,c=f.centerX,b=f.centerY;if(!SC.none(a)){if(SC.isPercentage(a)){h.left=a*d}else{h.left=a}if(i!==undefined){if(i===SC.LAYOUT_AUTO){h.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(i)){h.width=i*d}else{h.width=i}}}else{if(l&&SC.isPercentage(l)){h.width=d-h.left-(l*d)}else{h.width=d-h.left-(l||0)}}}else{if(!SC.none(l)){if(SC.none(i)){h.left=0;if(l&&SC.isPercentage(l)){h.width=d-(l*d)}else{h.width=d-(l||0)}}else{if(i===SC.LAYOUT_AUTO){h.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(i)){h.width=i*d}else{h.width=i}if(SC.isPercentage(l)){h.left=d-(h.width+l)}else{h.left=d-(h.width+l)}}}}else{if(!SC.none(c)){if(i&&SC.isPercentage(i)){h.width=(i*d)}else{h.width=(i||0)}h.left=((d-h.width)/2);if(SC.isPercentage(c)){h.left=h.left+c*d}else{h.left=h.left+c}}else{if(!SC.none(i)){h.left=0;if(i===SC.LAYOUT_AUTO){h.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(i)){h.width=i*d}else{h.width=i}}}else{h.left=0;h.width=0}}}}if(f.minWidth!==undefined){h.minWidth=f.minWidth}if(f.maxWidth!==undefined){h.maxWidth=f.maxWidth}if(!SC.none(j)){if(SC.isPercentage(j)){h.top=j*k}else{h.top=j}if(e!==undefined){if(e===SC.LAYOUT_AUTO){h.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(e)){h.height=e*k}else{h.height=e}}}else{h.height=k-h.top;if(g&&SC.isPercentage(g)){h.height=h.height-(g*k)}else{h.height=h.height-(g||0)}}}else{if(!SC.none(g)){if(SC.none(e)){h.top=0;if(g&&SC.isPercentage(g)){h.height=k-(g*k)}else{h.height=k-(g||0)}}else{if(e===SC.LAYOUT_AUTO){h.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(e)){h.height=e*k}else{h.height=e}h.top=k-h.height;if(SC.isPercentage(g)){h.top=h.top-(g*k)}else{h.top=h.top-g}}}}else{if(!SC.none(b)){if(e&&SC.isPercentage(e)){h.height=(e*k)}else{h.height=(e||0)}h.top=((k-h.height)/2);if(SC.isPercentage(b)){h.top=h.top+b*k}else{h.top=h.top+b}}else{if(!SC.none(e)){h.top=0;if(e===SC.LAYOUT_AUTO){h.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(e)){h.height=e*k}else{h.height=e}}}else{h.top=0;h.height=0}}}}if(h.top){h.top=Math.floor(h.top)}if(h.bottom){h.bottom=Math.floor(h.bottom)}if(h.left){h.left=Math.floor(h.left)}if(h.right){h.right=Math.floor(h.right)}if(h.width!==SC.LAYOUT_AUTO){h.width=Math.floor(h.width)}if(h.height!==SC.LAYOUT_AUTO){h.height=Math.floor(h.height)}if(f.minHeight!==undefined){h.minHeight=f.minHeight}if(f.maxHeight!==undefined){h.maxHeight=f.maxHeight}return h},convertLayoutToCustomLayout:function(b,a,c){}});sc_require("views/view");sc_require("views/view/layout");sc_require("views/view/layout_style");SC.View.reopen({wantsAcceleratedLayer:NO,hasAcceleratedLayer:function(){if(this.get("wantsAcceleratedLayer")&&SC.platform.supportsAcceleratedLayers){var c=this.get("layout"),d=c.animate,b=SC.LAYOUT_AUTO,a;if(d&&(d.top||d.left)){for(a in d){if(SC.CSS_TRANSFORM_MAP[a]&&((d.top&&d.top.duration!==d[a].duration)||(d.left&&d.left.duration!==d[a].duration))){return NO}}}return this.get("isFixedLayout")}return NO}.property("wantsAcceleratedLayer").cacheable()});sc_require("views/view");SC.View.reopen({cursor:function(a,c){var b;if(c){this._setCursor=c}if(this._setCursor!==undefined){return this._setCursor}b=this.get("parentView");if(this.get("shouldInheritCursor")&&b){return b.get("cursor")}return null}.property("parentView","shouldInheritCursor").cacheable(),applyAttributesToContext:function(b,a){var c=this.get("cursor");if(c){a.addClass(c.get("className"))}b(a)}.enhance(),shouldInheritCursor:YES});sc_require("views/view");SC.View.reopen({isEnabled:YES,isEnabledBindingDefault:SC.Binding.oneWay().bool(),isEnabledInPane:function(){var a=this.get("isEnabled"),b;if(a&&(b=this.get("parentView"))){a=b.get("isEnabledInPane")}return a}.property("parentView","isEnabled"),_sc_view_isEnabledDidChange:function(){if(!this.get("isEnabled")&&this.get("isFirstResponder")){this.resignFirstResponder()}}.observes("isEnabled"),applyAttributesToContext:function(b,a){var c=this.get("isEnabled");b(a);a.setClass("disabled",!c);a.attr("aria-disabled",!c?"true":null)}.enhance()});sc_require("views/view");SC.View.reopen({isKeyResponder:NO,willLoseKeyResponderTo:function(a){},willBecomeKeyResponderFrom:function(a){},didLoseKeyResponderTo:function(a){},didBecomeKeyResponderFrom:function(a){},interpretKeyEvents:function(b){var a=b.commandCodes(),d=a[0],e=a[1],g;if(!d&&!e){return null}if(d){var h=SC.MODIFIED_KEY_BINDINGS[d]||SC.BASE_KEY_BINDINGS[d.match(/[^_]+$/)[0]];if(h){var f=this,c=this.get("pane"),i=null;while(f&&!(i=f.tryToPerform(h,b))){f=(f===c)?null:f.get("nextResponder")}return i}}if(e&&this.respondsTo("insertText")){g=this.insertText(e,b);return g?(g===YES?this:g):null}return null},insertText:function(a){return NO},performKeyEquivalent:function(f,d){var e=NO,g=this.get("childViews"),b=g.length,a=-1,c;while(!e&&(++a<b)){c=g[a];e=c.tryToPerform("performKeyEquivalent",f,d)}return e},firstKeyView:null,_getFirstKeyView:function(){var a=this.get("firstKeyView");if(a){return a}var b=this.get("childViews");if(b){return b[0]}},lastKeyView:null,_getLastKeyView:function(){var d=this.get("lastKeyView");if(d){return d}var a,b=this.get("firstKeyView");if(b){while(a=b._getNextKeyView()){b=a}return b}else{var c=this.get("childViews");if(c){return c[c.length-1]}}},nextKeyView:undefined,_getNextKeyView:function(){var b=this.get("parentView"),a=this.get("nextKeyView");if(b&&b.get("lastKeyView")===this){return null}if(a!==undefined){return a}if(b){var c=b.get("childViews");return c[c.indexOf(this)+1]}},nextValidKeyView:function(){var b=this,a;while(a!==this){a=null;if(b.get("isVisibleInWindow")){a=b._getFirstKeyView()}if(!a){a=b._getNextKeyView()}if(!a){while(b=b.get("parentView")){if(a=b._getNextKeyView()){break}}}if(!a){if(!SC.TABBING_ONLY_INSIDE_DOCUMENT){break}else{a=this.get("pane")}}if(a.get("isVisibleInWindow")&&a.get("acceptsFirstResponder")){return a}b=a}return null}.property("nextKeyView"),previousKeyView:undefined,_getPreviousKeyView:function(){var b=this.get("parentView"),a=this.get("previousKeyView");if(b&&b.get("firstKeyView")===this){return null}if(a!==undefined){return a}if(b){var c=b.get("childViews");return c[c.indexOf(this)-1]}},previousValidKeyView:function(){var b=this,a;while(a!==this){if(b.get("parentView")){a=b._getPreviousKeyView()}else{if(!SC.TABBING_ONLY_INSIDE_DOCUMENT){break}else{a=b}}if(a){do{b=a;a=a._getLastKeyView()}while(a&&a.get("isVisibleInWindow"));if(!a){a=b}}else{a=b.get("parentView")}if(a.get("isVisibleInWindow")&&a.get("acceptsFirstResponder")){return a}b=a}return null}.property("previousKeyView")});sc_require("views/view");SC.View.reopen({_lastLayerId:null,layerIdDidChange:function(){var a=this.get("layer"),b=this.get("layerId"),c=this._lastLayerId;if(b!==c){if(c&&SC.View.views[c]===this){delete SC.View.views[c]}this._lastLayerId=b;SC.View.views[b]=this;if(a){a.id=b}}}.observes("layerId"),parentViewDidChange:function(){this.recomputeIsVisibleInWindow();this.resetBuildState();this.set("layerLocationNeedsUpdate",YES);this.invokeOnce(this.updateLayerLocationIfNeeded);this._invalidatePaneCacheForSelfAndAllChildViews();return this},_invalidatePaneCacheForSelfAndAllChildViews:function(){var d,c=this.get("childViews"),b=c.length,a;this.notifyPropertyChange("pane");for(a=0;a<b;++a){d=c[a];if(d._invalidatePaneCacheForSelfAndAllChildViews){d._invalidatePaneCacheForSelfAndAllChildViews()}}},insertBefore:function(b,d){b.beginPropertyChanges();if(b.get("parentView")){b.removeFromParent()}if(this.willAddChild){this.willAddChild(b,d)}if(b.willAddToParent){b.willAddToParent(this,d)}b.set("parentView",this);var a,c=this.get("childViews");if(c.needsClone){this.set(c=[])}a=(d)?c.indexOf(d):c.length;if(a<0){a=c.length}c.insertAt(a,b);if(b.parentViewDidChange){b.parentViewDidChange()}if(b.layoutDidChange){b.layoutDidChange()}b.endPropertyChanges();this.invokeLast(function(){var e=b.get("pane");if(e&&e.get("isPaneAttached")){b._notifyDidAppendToDocument()}});if(this.didAddChild){this.didAddChild(b,d)}if(b.didAddToParent){b.didAddToParent(this,d)}return this},removeChild:function(b,a){if(!a){return this}if(a.parentView!==this){throw"%@.removeChild(%@) must belong to parent".fmt(this,a)}if(a.willRemoveFromParent){a.willRemoveFromParent()}if(this.willRemoveChild){this.willRemoveChild(a)}b(a);if(a.parentViewDidChange){a.parentViewDidChange()}if(this.didRemoveChild){this.didRemoveChild(a)}if(a.didRemoveFromParent){a.didRemoveFromParent(this)}return this}.enhance(),replaceChild:function(a,b){a.beginPropertyChanges();b.beginPropertyChanges();this.beginPropertyChanges();this.insertBefore(a,b).removeChild(b);this.endPropertyChanges();b.endPropertyChanges();a.endPropertyChanges();return this},replaceAllChildren:function(c){var b=c.get("length"),a;this.beginPropertyChanges();this.destroyLayer().removeAllChildren();for(a=0;a<b;a++){this.appendChild(c.objectAt(a))}this.replaceLayer();this.endPropertyChanges();return this},appendChild:function(a){return this.insertBefore(a,null)},buildInChild:function(a){a.willBuildInToView(this);this.appendChild(a);a.buildInToView(this)},buildOutChild:function(a){a.buildOutFromView(this)},buildInDidFinishFor:function(a){},buildOutDidFinishFor:function(a){this.removeChild(a)},isBuildingIn:NO,isBuildingOut:NO,buildIn:function(){this.buildInDidFinish()},buildOut:function(){this.buildOutDidFinish()},resetBuild:function(){},buildOutDidCancel:function(){},buildInDidCancel:function(){},buildInDidFinish:function(){this.isBuildingIn=NO;this._buildingInTo.buildInDidFinishFor(this);this._buildingInTo=null},buildOutDidFinish:function(){this.isBuildingOut=NO;this._buildingOutFrom.buildOutDidFinishFor(this);this._buildingOutFrom=null},resetBuildState:function(){if(this.isBuildingIn){this.buildInDidCancel();this.isBuildingIn=NO}if(this.isBuildingOut){this.buildOutDidCancel();this.isBuildingOut=NO}this.buildingInTo=null;this.buildingOutFrom=null;this.resetBuild()},willBuildInToView:function(a){if(this.isBuildingOut){this.buildOutDidCancel()}},buildInToView:function(a){if(this.isBuildingIn){return}this._buildingInTo=a;this.isBuildingOut=NO;this.isBuildingIn=YES;this.buildIn()},buildOutFromView:function(a){if(this.isBuildingOut){return}if(this.isBuildingIn){this.buildInDidCancel()}this.isBuildingOut=YES;this.isBuildingIn=NO;this._buildingOutFrom=a;this.buildOut()}});sc_require("views/view");SC.View.reopen({init:function(a){a();this._lastTheme=this.get("theme")}.enhance(),themeName:null,baseThemeName:null,theme:function(){var b=this.get("baseTheme"),a=this.get("themeName");if(a){var c;if(b){c=b.find(a);if(c){return c}}c=SC.Theme.find(a);if(c){return c}return b.invisibleSubtheme(a)}return b}.property("baseTheme","themeName").cacheable(),_sc_view_themeDidChange:function(){if(this._lastTheme===this.get("theme")){return}this._lastTheme=this.get("theme");var c=this.childViews,b=c.length,a;for(a=0;a<b;a++){c[a].notifyPropertyChange("baseTheme")}if(this.get("layer")){this.replaceLayer()}}.observes("theme"),baseTheme:function(){var b;var a=this.get("baseThemeName");if(a){return SC.Theme.find(a)}else{b=this.get("parentView");var c=b&&b.get("theme");return c||SC.Theme.find(SC.defaultTheme)}}.property("baseThemeName","parentView").cacheable(),renderDelegate:function(c,d){if(d){this._setRenderDelegate=d}if(this._setRenderDelegate){return this._setRenderDelegate}var a=this.get("renderDelegateName"),b;if(a){b=this.get("theme")[a];if(!b){throw'%@: Unable to locate render delegate "%@" in theme.'.fmt(this,a)}return b}return null}.property("renderDelegateName","theme"),renderDelegateName:null,renderDelegateProxy:function(){return SC.View._RenderDelegateProxy.createForView(this)}.property("renderDelegate").cacheable(),render:function(b,c){var a=this.get("renderDelegate");if(a){if(c){a.render(this.get("renderDelegateProxy"),b)}else{a.update(this.get("renderDelegateProxy"),b.$())}}},applyAttributesToContext:function(f,e){var g=this.get("theme");var c=g.classNames,b,a=c.length;for(b=0;b<a;b++){e.addClass(c[b])}f(e);var d=this.get("renderDelegate");if(d&&d.className){e.addClass(d.className)}}.enhance(),invokeRenderDelegateMethod:function(c,b){var a=this.get("renderDelegate");if(!a){return undefined}if(SC.typeOf(a[c])!==SC.T_FUNCTION){return undefined}b=SC.$A(arguments);b.shift();b.unshift(this.get("renderDelegateProxy"));return a[c].apply(a,b)}});SC.View._RenderDelegateProxy={isViewRenderDelegateProxy:YES,createForView:function(c){var d=SC.beget(this);var f=c.get("displayProperties"),e={};for(var b=0,a=f.length;b<a;b++){e[f[b]]=YES}e.theme=YES;d._displayPropertiesLookup=e;d.renderState={};d._view=c;return d},get:function(b){if(this[b]!==undefined){return this[b]}var a="display"+b.capitalize();if(this._displayPropertiesLookup[a]){return this._view.get(a)}else{if(this._displayPropertiesLookup[b]){return this._view.get(b)}}return undefined},didChangeFor:function(d){var b=arguments.length,a;for(a=1;a<b;a++){var e=arguments[a],c="display"+e.capitalize();if(this._displayPropertiesLookup[c]){if(this._view.didChangeFor(d,c)){return YES}}else{if(this._displayPropertiesLookup[e]){if(this._view.didChangeFor(d,e)){return YES}}}}return NO}};SC.propertyFromRenderDelegate=function(a,b){return function(f,g){if(g!==undefined){this["_set_rd_"+f]=g}var d=this["_set_rd_"+f];if(d!==undefined){return d}var c=this.get("renderDelegate");if(c&&c.get){var e=this.get("renderDelegateProxy");d=c.getPropertyFor(e,a)}if(d!==undefined){return d}return b}.property("renderDelegate").cacheable()};sc_require("views/view");SC.View.reopen({acceptsMultitouch:NO,hasTouch:NO,touchBoundary:{left:25,right:25,top:25,bottom:25},_touchBoundaryFrame:function(){var b=this.get("touchBoundary"),a;a=this.get("parentView").convertFrameToView(this.get("frame"),null);a.x-=b.left;a.y-=b.top;a.width+=b.left+b.right;a.height+=b.top+b.bottom;return a}.property("touchBoundary","clippingFrame").cacheable(),touchIsInBoundary:function(a){return SC.pointInRect({x:a.pageX,y:a.pageY},this.get("_touchBoundaryFrame"))}});sc_require("views/view");SC.View.reopen({hasVisibility:YES,isVisibleInWindow:NO,isContextMenuEnabled:function(){return SC.CONTEXT_MENU_ENABLED}.property(),recomputeIsVisibleInWindow:function(d){var f=this.get("isVisibleInWindow"),h=this.get("isVisible"),e;if(h){if(d===undefined){e=this.get("parentView");d=e?e.get("isVisibleInWindow"):NO}h=h&&d}if(f!==h){this.set("isVisibleInWindow",h);var g=this.get("childViews"),b=g.length,a,c;for(a=0;a<b;a++){c=g[a];if(c.recomputeIsVisibleInWindow){c.recomputeIsVisibleInWindow(h)}}if(h){if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)}}else{if(this.get("isFirstResponder")){this.resignFirstResponder()}}}this.updateLayerIfNeeded(YES);return this},_sc_isVisibleDidChange:function(){this.displayDidChange();this.recomputeIsVisibleInWindow()}.observes("isVisible")});sc_require("views/view");sc_require("views/view/acceleration");sc_require("views/view/cursor");sc_require("views/view/enabled");sc_require("views/view/keyboard");sc_require("views/view/layout");sc_require("views/view/manipulation");sc_require("views/view/theming");sc_require("views/view/touch");sc_require("views/view/visibility");sc_require("mixins/responder_context");SC.MIXED_STATE="__MIXED__";SC.Pane=SC.View.extend(SC.ResponderContext,{isPane:YES,page:null,rootResponder:null,sendEvent:function(c,a,d){var b;if(!d){d=this.get("firstResponder")}while(d){if(c==="touchStart"){if(a.touchResponder===d){d=null;break}if(!d.get("hasTouch")||d.get("acceptsMultitouch")){if(d.tryToPerform("touchStart",a)){break}}}else{if(c==="touchEnd"&&!d.get("acceptsMultitouch")){if(!d.get("hasTouch")){if(d.tryToPerform("touchEnd",a)){break}}}else{if(d.tryToPerform(c,a)){break}}}d=(d===this)?null:d.get("nextResponder")}if(!d&&(d=this.get("defaultResponder"))){if(typeof d===SC.T_STRING){d=SC.objectForPropertyPath(d)}if(!d){d=null}else{d=d.tryToPerform(c,a)?d:null}}else{if(!d&&!(d=this.get("defaultResponder"))){d=this.tryToPerform(c,a)?this:null}}return a.mouseHandler||d},nextResponder:function(){return null}.property().cacheable(),firstResponder:null,acceptsKeyPane:YES,isKeyPane:NO,becomeKeyPane:function(){if(this.get("isKeyPane")){return this}if(this.rootResponder){this.rootResponder.makeKeyPane(this)}return this},resignKeyPane:function(){if(!this.get("isKeyPane")){return this}if(this.rootResponder){this.rootResponder.makeKeyPane(null)}return this},makeFirstResponder:function(c,b,a){if(!b){b=this}var e=this.get("firstResponder"),d=this.get("isKeyPane");if(e===b){return this}if(SC.platform.touch&&b&&b.kindOf(SC.TextFieldView)&&!b.get("focused")){return this}if(d){if(e){e.tryToPerform("willLoseKeyResponderTo",b)}if(b){b.tryToPerform("willBecomeKeyResponderFrom",e)}}if(e){e.beginPropertyChanges();e.set("isKeyResponder",NO)}if(b){b.beginPropertyChanges();b.set("isKeyResponder",d)}c(b,a);if(e){e.endPropertyChanges()}if(b){b.endPropertyChanges()}if(d){if(b){b.tryToPerform("didBecomeKeyResponderFrom",e)}if(e){e.tryToPerform("didLoseKeyResponderTo",b)}}return this}.enhance(),willLoseKeyPaneTo:function(a){this._forwardKeyChange(this.get("isKeyPane"),"willLoseKeyResponderTo",a,NO);return this},willBecomeKeyPaneFrom:function(a){this._forwardKeyChange(!this.get("isKeyPane"),"willBecomeKeyResponderFrom",a,YES);return this},didBecomeKeyResponderFrom:function(a){},didLoseKeyPaneTo:function(b){var a=this.get("isKeyPane");this.set("isKeyPane",NO);this._forwardKeyChange(a,"didLoseKeyResponderTo",b);return this},didBecomeKeyPaneFrom:function(b){var a=this.get("isKeyPane");this.set("isKeyPane",YES);this._forwardKeyChange(!a,"didBecomeKeyResponderFrom",b,YES);return this},isMainPane:NO,focusFrom:function(a){},blurTo:function(a){},blurMainTo:function(a){this.set("isMainPane",NO)},focusMainFrom:function(a){this.set("isMainPane",YES)},append:function(){return this.appendTo(document.body)},remove:function(){if(!this.get("isVisibleInWindow")){return this}if(!this.get("isPaneAttached")){return this}var b=this.get("layer");if(b&&b.parentNode){b.parentNode.removeChild(b)}b=null;this._removeIntercept();this.resignKeyPane();var a=this.rootResponder;if(this.get("isMainPane")){a.makeMainPane(null)}a.panes.remove(this);this.rootResponder=null;this.set("isPaneAttached",NO);this.parentViewDidChange();return this},insert:function(b){var a=this.get("layer");if(!a){a=this.createLayer().get("layer")}b(a);if(!this.get("isPaneAttached")){this.paneDidAttach()}return this},appendTo:function(a){return this.insert(function(b){jQuery(a).append(b)})},paneDidAttach:function(){var a=(this.rootResponder=SC.RootResponder.responder);a.panes.add(this);this.set("isPaneAttached",YES);this.recomputeDependentProperties();this._notifyDidAppendToDocument();this._addIntercept();return this},recomputeDependentProperties:function(){},isPaneAttached:NO,wantsTouchIntercept:NO,hasTouchIntercept:function(){return this.get("wantsTouchIntercept")&&SC.platform.touch}.property("wantsTouchIntercept").cacheable(),zIndex:0,touchZ:99,_addIntercept:function(){if(this.get("hasTouchIntercept")){var b=document.createElement("div");var a=b.style;a.position="absolute";a.left="0px";a.top="0px";a.right="0px";a.bottom="0px";a.webkitTransform="translateZ(0px)";a.zIndex=this.get("zIndex")+this.get("touchZ");b.className="touch-intercept";b.id="touch-intercept-"+SC.guidFor(this);this._touchIntercept=b;document.body.appendChild(b)}},_removeIntercept:function(){if(this._touchIntercept){document.body.removeChild(this._touchIntercept);this._touchIntercept=null}},hideTouchIntercept:function(){if(this._touchIntercept){this._touchIntercept.style.display="none"}},showTouchIntercept:function(){if(this._touchIntercept){this._touchIntercept.style.display="block"}},recomputeIsVisibleInWindow:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}var d=this.get("isVisibleInWindow"),f=this.get("isVisible")&&this.get("isPaneAttached");if(d!==f){this.set("isVisibleInWindow",f);var e=this.get("childViews"),b=e.length,a,c;for(a=0;a<b;a++){c=e[a];if(c.recomputeIsVisibleInWindow){c.recomputeIsVisibleInWindow(f)}}if(f){if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)}}else{if(this.get("isKeyPane")){this.resignKeyPane()}}}this.updateLayerIfNeeded(YES);return this},updateLayerLocation:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}return this},init:function(){if(this.hasTouchIntercept===YES){SC.Logger.warn("Do not set hasTouchIntercept directly. Use wantsTouchIntercept instead.");this.hasTouchIntercept=SC.platform.touch}var a=!!this.get("layer");arguments.callee.base.apply(this,arguments);if(a){this.paneDidAttach()}},classNames:["sc-pane"]});sc_require("panes/pane");SC.Pane.reopen({performKeyEquivalent:function(c,a){var b=arguments.callee.base.apply(this,arguments);if(!b){var d=this.get("defaultResponder");if(d){if(d.performKeyEquivalent){b=d.performKeyEquivalent(c,a)}if(!b&&d.tryToPerform){b=d.tryToPerform(c,a)}}}return b},keyDown:function(a){var b;if(a.keyCode===9&&!this.get("firstResponder")){if(a.shiftKey){b=this.get("previousValidKeyView")}else{b=this.get("nextValidKeyView")}if(b){this.makeFirstResponder(b);return YES}else{if(!SC.TABBING_ONLY_INSIDE_DOCUMENT){a.allowDefault()}}}return NO},_forwardKeyChange:function(d,b,g,f){var c,a,e;if(d&&(a=this.get("firstResponder"))){e=(g)?g.get("firstResponder"):null;c=this.get("firstResponder");if(c&&c[b]){c[b](e)}if((f!==undefined)&&a){a.set("isKeyResponder",f)}}}});sc_require("panes/pane");SC.Pane.reopen({currentWindowSize:null,computeParentDimensions:function(c){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}var d={x:0,y:0,width:1000,height:1000},b=this.get("layout");if(document&&document.body){d.width=document.body.clientWidth;d.height=document.body.clientHeight;if(SC.browser.name===SC.BROWSER.ie&&SC.browser.compareVersion(SC.browser.version,"7")===0){var a=SC.platform.get("scrollbarSize");if(document.body.scrollWidth>d.width){d.width-=a}if(document.body.scrollHeight>d.height){d.height-=a}}}if(b.minHeight||b.minWidth){if(b.minHeight){d.height=Math.max(d.height,b.minHeight)}if(b.minWidth){d.width=Math.max(d.width,b.minWidth)}}return d},frame:function(){if(this.get("designer")&&SC.suppressMain){return arguments.callee.base.apply(this,arguments)}return this.computeFrameWithParentFrame(null)}.property(),windowSizeDidChange:function(b,a){this.set("currentWindowSize",a);this.setBodyOverflowIfNeeded();this.parentViewDidResize();return this},setBodyOverflowIfNeeded:function(e){var d=this.get("layout"),b=this.get("currentWindowSize");if(!d||!b||!b.width||!b.height){return}var a=d.minWidth,c=d.minHeight;if(e===true||a||c){if((c&&b.height<c)||(a&&b.width<a)){SC.bodyOverflowArbitrator.requestVisible(this)}else{SC.bodyOverflowArbitrator.requestHidden(this)}}},paneLayoutDidChange:function(){this.invokeOnce(this.updateLayout);this.setBodyOverflowIfNeeded()}.observes("layout"),recomputeDependentProperties:function(a){this.set("currentWindowSize",this.rootResponder.computeWindowSize());a()}.enhance()});sc_require("panes/pane");SC.Pane.reopen({prependTo:function(a){return this.insert(function(b){jQuery(a).prepend(b)})},removeFromParent:function(){throw SC.Error.desc("SC.Pane cannot be removed from its parent, since it's the root. Did you mean remove()?")}});sc_require("panes/pane");SC.Pane.reopen({recomputeDependentProperties:function(a){this.recomputeIsVisibleInWindow();a()}.enhance()});SC.Application=SC.Responder.extend(SC.ResponderContext,{});SC.Color=SC.Object.extend(SC.Copyable,{original:null,a:1,r:0,g:0,b:0,hue:function(c,d){var e=SC.Color.clampToDeviceGamut,a=SC.Color.rgbToHsl(e(this.get("r")),e(this.get("g")),e(this.get("b"))),b;if(d!==undefined){a[0]=(d%360+360)%360;b=SC.Color.hslToRgb(a[0],a[1],a[2]);this.beginPropertyChanges();this.set("r",b[0]);this.set("g",b[1]);this.set("b",b[2]);this.endPropertyChanges()}return a[0]}.property("r","g","b").cacheable(),saturation:function(c,d){var e=SC.Color.clampToDeviceGamut,a=SC.Color.rgbToHsl(e(this.get("r")),e(this.get("g")),e(this.get("b"))),b;if(d!==undefined){a[1]=SC.Color.clamp(d,0,1);b=SC.Color.hslToRgb(a[0],a[1],a[2]);this.beginPropertyChanges();this.set("r",b[0]);this.set("g",b[1]);this.set("b",b[2]);this.endPropertyChanges()}return a[1]}.property("r","g","b").cacheable(),luminosity:function(c,d){var e=SC.Color.clampToDeviceGamut,a=SC.Color.rgbToHsl(e(this.get("r")),e(this.get("g")),e(this.get("b"))),b;if(d!==undefined){a[2]=SC.Color.clamp(d,0,1);b=SC.Color.hslToRgb(a[0],a[1],a[2]);this.beginPropertyChanges();this.set("r",b[0]);this.set("g",b[1]);this.set("b",b[2]);this.endPropertyChanges()}return a[2]}.property("r","g","b").cacheable(),isEqualTo:function(a){return this.get("r")===a.get("r")&&this.get("g")===a.get("g")&&this.get("b")===a.get("b")&&this.get("a")===a.get("a")},toArgb:function(){var a=SC.Color.clampToDeviceGamut;return"#"+[a(255*this.get("a")),a(this.get("r")),a(this.get("g")),a(this.get("b"))].map(function(b){b=b.toString(16);return b.length===1?"0"+b:b}).join("")},toHex:function(){var a=SC.Color.clampToDeviceGamut;return"#"+[a(this.get("r")),a(this.get("g")),a(this.get("b"))].map(function(b){b=b.toString(16);return b.length===1?"0"+b:b}).join("")},toRgb:function(){var a=SC.Color.clampToDeviceGamut;return"rgb("+a(this.get("r"))+","+a(this.get("g"))+","+a(this.get("b"))+")"},toRgba:function(){var a=SC.Color.clampToDeviceGamut;return"rgba("+a(this.get("r"))+","+a(this.get("g"))+","+a(this.get("b"))+","+this.get("a")+")"},toHsl:function(){var a=Math.round;return"hsl("+a(this.get("hue"))+","+a(this.get("saturation")*100)+"%,"+a(this.get("luminosity")*100)+"%)"},toHsla:function(){var a=Math.round;return"hsla("+a(this.get("hue"))+","+a(this.get("saturation")*100)+"%,"+a(this.get("luminosity")*100)+"%,"+this.get("a")+")"},cssText:function(){var a=SC.Color.supportsRgba||SC.Color.supportsArgb;return(this.a===1||!a)?this.toHex():SC.Color.supportsRgba?this.toRgba():this.toArgb()}.property("r","g","b","a").cacheable(),copy:function(){return SC.Color.create({original:this.get("original"),r:this.get("r"),g:this.get("g"),b:this.get("b"),a:this.get("a")})},sub:function(a){return SC.Color.create({r:this.get("r")-a.get("r"),g:this.get("g")-a.get("g"),b:this.get("b")-a.get("b"),a:this.get("a")-a.get("a")})},add:function(a){return SC.Color.create({r:this.get("r")+a.get("r"),g:this.get("g")+a.get("g"),b:this.get("b")+a.get("b"),a:this.get("a")+a.get("a")})},mult:function(b){var a=Math.round;return SC.Color.create({r:a(this.get("r")*b),g:a(this.get("g")*b),b:a(this.get("b")*b),a:this.get("a")*b})}});SC.Color.mixin({supportsRgba:(function(){var c=document.getElementsByTagName("script")[0].style,b=c.cssText,a;c.cssText="background-color:rgba(5,2,1,.5)";a=c.backgroundColor.indexOf("rgba")!==-1;c.cssText=b;return a}()),supportsArgb:(function(){var c=document.getElementsByTagName("script")[0].style,b=c.cssText,a;c.cssText='filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#55000000", endColorstr="#55000000");';a=c.backgroundColor.indexOf("#55000000")!==-1;c.cssText=b;return a}()),clamp:function(c,b,a){return Math.max(Math.min(c,a),b)},clampInt:function(c,b,a){return Math.round(SC.Color.clamp(c,b,a))},clampToDeviceGamut:function(a){return SC.Color.clampInt(a,0,255)},hsvToRgb:function(j,x,u){j/=360;var a,l,o,e=Math.floor(j*6),m=j*6-e,d=u*(1-x),c=u*(1-(x*m)),w=u*(1-(x*(1-m))),n=[[u,w,d],[c,u,d],[d,u,w],[d,c,u],[w,d,u],[u,d,c]],k=SC.Color.clampToDeviceGamut;e=e%6;a=k(n[e][0]*255);l=k(n[e][1]*255);o=k(n[e][2]*255);return[a,l,o]},rgbToHsv:function(a,f,j){a/=255;f/=255;j/=255;var k=Math.max(a,f,j),c=Math.min(a,f,j),i=k-c,e,m=k===0?0:i/k,l=k;if(k===c){e=0}else{switch(k){case a:e=(f-j)/i+(f<j?6:0);break;case f:e=(j-a)/i+2;break;case j:e=(a-f)/i+4;break}e/=6}e*=360;return[e,m,l]},hslToRgb:function(f,e,b){f/=360;var d,c,a=SC.Color.hueToRgb,g=SC.Color.clampToDeviceGamut;c=b<=0.5?b*(e+1):b+e-b*e;d=b*2-c;return[g(a(d,c,f+1/3)*255),g(a(d,c,f)*255),g(a(d,c,f-1/3)*255)]},hueToRgb:function(b,a,c){if(c<0){c++}if(c>1){c--}if(c<1/6){return b+(a-b)*c*6}if(c<1/2){return a}if(c<2/3){return b+(a-b)*(2/3-c)*6}return b},rgbToHsl:function(a,i,k){a/=255;i/=255;k/=255;var m=Math.max(a,i,k),e=Math.min(a,i,k),f,n,c=(m+e)/2,j=m-e;if(m===e){f=n=0}else{n=c>0.5?j/(2-m-e):j/(m+e);switch(m){case a:f=(i-k)/j+(i<k?6:0);break;case i:f=(k-a)/j+2;break;case k:f=(a-i)/j+4;break}f/=6}f*=360;return[f,n,c]},PARSE_RGBA:/^rgba\(\s*([\d]+%?)\s*,\s*([\d]+%?)\s*,\s*([\d]+%?)\s*,\s*([.\d]+)\s*\)$/,PARSE_RGB:/^rgb\(\s*([\d]+%?)\s*,\s*([\d]+%?)\s*,\s*([\d]+%?)\s*\)$/,PARSE_HSLA:/^hsla\(\s*(-?[\d]+)\s*\s*,\s*([\d]+)%\s*,\s*([\d]+)%\s*,\s*([.\d]+)\s*\)$/,PARSE_HSL:/^hsl\(\s*(-?[\d]+)\s*,\s*([\d]+)%\s*,\s*([\d]+)%\s*\)$/,PARSE_HEX:/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,PARSE_ARGB:/^#[0-9a-fA-F]{8}$/,KEYWORDS:{aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},from:function(f){var k=SC.Color,j=f,i,h,c,d=1,e=function(b){var a=parseInt(b,10);return b.slice(-1)==="%"?k.clampInt(a*2.55,0,255):k.clampInt(a,0,255)};if(k.KEYWORDS.hasOwnProperty(f)){f=k.KEYWORDS[f]}if(k.PARSE_RGB.test(f)){f=f.match(k.PARSE_RGB);i=e(f[1]);h=e(f[2]);c=e(f[3])}else{if(k.PARSE_RGBA.test(f)){f=f.match(k.PARSE_RGBA);i=e(f[1]);h=e(f[2]);c=e(f[3]);d=parseFloat(f[4],10)}else{if(k.PARSE_HEX.test(f)){if(f.length===4){f="#"+f.charAt(1)+f.charAt(1)+f.charAt(2)+f.charAt(2)+f.charAt(3)+f.charAt(3)}i=parseInt(f.slice(1,3),16);h=parseInt(f.slice(3,5),16);c=parseInt(f.slice(5,7),16)}else{if(k.PARSE_ARGB.test(f)){i=parseInt(f.slice(3,5),16);h=parseInt(f.slice(5,7),16);c=parseInt(f.slice(7,9),16);d=parseInt(f.slice(1,3),16)/255}else{if(k.PARSE_HSL.test(f)){f=f.match(k.PARSE_HSL);f=k.hslToRgb(((parseInt(f[1],10)%360+360)%360),k.clamp(parseInt(f[2],10)/100,0,1),k.clamp(parseInt(f[3],10)/100,0,1));i=f[0];h=f[1];c=f[2]}else{if(k.PARSE_HSLA.test(f)){f=f.match(k.PARSE_HSLA);d=parseFloat(f[4],10);f=k.hslToRgb(((parseInt(f[1],10)%360+360)%360),k.clamp(parseInt(f[2],10)/100,0,1),k.clamp(parseInt(f[3],10)/100,0,1));i=f[0];h=f[1];c=f[2]}else{if(f==="transparent"){i=h=c=0;d=0}else{return NO}}}}}}}return SC.Color.create({original:j,r:k.clampInt(i,0,255),g:k.clampInt(h,0,255),b:k.clampInt(c,0,255),a:k.clamp(d,0,1)})}});SC.BENCHMARK_LOG_READY=YES;sc_require("system/event");SC.mixin({isReady:NO,suppressOnReady:SC.suppressOnReady?YES:NO,suppressMain:SC.suppressMain?YES:NO,ready:function(b,c){var a=SC._readyQueue;if(c===undefined){c=b;b=null}else{if(SC.typeOf(c)===SC.T_STRING){c=b[c]}}if(SC.isReady){jQuery(document).ready(function(){c.call(b)})}else{if(!a){SC._readyQueue=[]}SC._readyQueue.push(function(){c.call(b)})}return this},onReady:{done:function(){if(SC.isReady){return}SC.isReady=true;SC.RunLoop.begin();SC.Locale.createCurrentLocale();var d=SC.Locale.currentLanguage.toLowerCase();jQuery("body").addClass(d);jQuery("html").attr("lang",d);jQuery("#loading").remove();var c=SC._readyQueue,b,a;if(c){for(b=0,a=c.length;b<a;b++){c[b].call()}SC._readyQueue=null}if(window.main&&!SC.suppressMain&&(SC.mode===SC.APP_MODE)){window.main()}SC.RunLoop.end()}}});if(!SC.suppressOnReady){jQuery.event.special.ready._default=SC.onReady.done}SC.APP_MODE="APP_MODE";SC.TEST_MODE="TEST_MODE";SC.mode=SC.APP_MODE;SC.platform=SC.Object.create({scrollbarSize:function(){var a=document.createElement("DIV"),d;a.innerHTML="<div style='height:1px;'></div>";a.style.cssText="position:absolute;width:100px;height:100px;overflow-y:visible;";d=a.childNodes[0];document.body.appendChild(a);var b=d.innerWidth||d.clientWidth;a.style.overflowY="scroll";var c=d.innerWidth||d.clientWidth;document.body.removeChild(a);return b-c}.property().cacheable(),touch:"ontouchstart" in window||SC.browser.name===SC.BROWSER.android,bounceOnScroll:SC.browser.os===SC.OS.ios,pinchToZoom:SC.browser.os===SC.OS.ios,input:{placeholder:("placeholder" in document.createElement("input"))},input:function(d){var e={},c=d.length,f=document.createElement("input"),b,a;for(a=0;a<c;a++){b=d[a];e[b]=!!(b in f)}return e}(["autocomplete","readonly","list","size","required","multiple","maxlength","pattern","min","max","step","placeholder"]),standalone:!!navigator.standalone,cssPrefix:null,domCSSPrefix:null,simulateTouchEvents:function(){if(this.touch){return}SC.Logger.log("Simulating touch events");SC.platform.touch=YES;SC.platform.bounceOnScroll=YES;document.body.className=document.body.className+" touch";this._simtouch_counter=1;this.removeEvents(["click","dblclick","mouseout","mouseover","mousewheel"]);this.replaceEvent("mousemove",this._simtouch_mousemove);this.replaceEvent("mousedown",this._simtouch_mousedown);this.replaceEvent("mouseup",this._simtouch_mouseup);SC.platform.windowSizeDeterminesOrientation=YES;SC.device.orientationHandlingShouldChange()},removeEvents:function(d){var b,a=d.length,c;for(b=0;b<a;b++){c=d[b];SC.Event.remove(document,c,SC.RootResponder.responder,SC.RootResponder.responder[c])}},replaceEvent:function(a,b){SC.Event.remove(document,a,SC.RootResponder.responder,SC.RootResponder.responder[a]);SC.Event.add(document,a,this,b)},_simtouch_mousemove:function(a){if(!this._mousedown){if(a.altKey&&this._pinchCenter===null){this._pinchCenter={pageX:a.pageX,pageY:a.pageY,screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY}}else{if(!a.altKey&&this._pinchCenter!==null){this._pinchCenter=null}}return NO}var b=this.manufactureTouchEvent(a,"touchmove");return SC.RootResponder.responder.touchmove(b)},_simtouch_mousedown:function(a){this._mousedown=YES;var b=this.manufactureTouchEvent(a,"touchstart");return SC.RootResponder.responder.touchstart(b)},_simtouch_mouseup:function(a){var c=this.manufactureTouchEvent(a,"touchend"),b=SC.RootResponder.responder.touchend(c);this._mousedown=NO;this._simtouch_counter++;return b},manufactureTouchEvent:function(k,j){var c,l,f=this._simtouch_counter;c={type:j,target:k.target,identifier:f,pageX:k.pageX,pageY:k.pageY,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY};k.touches=[c];if(k.altKey&&this._pinchCenter!==null){var h=this._pinchCenter.pageX+this._pinchCenter.pageX-k.pageX,g=this._pinchCenter.pageY+this._pinchCenter.pageY-k.pageY,e=this._pinchCenter.screenX+this._pinchCenter.screenX-k.screenX,d=this._pinchCenter.screenY+this._pinchCenter.screenY-k.screenY,b=this._pinchCenter.clientX+this._pinchCenter.clientX-k.clientX,a=this._pinchCenter.clientY+this._pinchCenter.clientY-k.clientY,i=this._simtouch_counter+1;l={type:j,target:k.target,identifier:i,pageX:h,pageY:g,screenX:e,screenY:d,clientX:b,clientY:a};k.touches=[c,l]}k.changedTouches=k.touches;return k},supportsCSSTransitions:NO,supportsCSSTransforms:NO,understandsCSS3DTransforms:NO,supportsCSS3DTransforms:NO,supportsAcceleratedLayers:NO,supportsHashChange:function(){return("onhashchange" in window)&&(document.documentMode===undefined||document.documentMode>7)}(),supportsHistory:function(){return !!(window.history&&window.history.pushState)}(),supportsCanvas:function(){return !!document.createElement("canvas").getContext}(),supportsOrientationChange:("onorientationchange" in window),windowSizeDeterminesOrientation:SC.browser.os===SC.OS.ios||!("onorientationchange" in window)});(function(){var a=navigator.userAgent.toLowerCase();if((/webkit/).test(a)){SC.platform.cssPrefix="webkit";SC.platform.domCSSPrefix="Webkit"}else{if((/opera/).test(a)){SC.platform.cssPrefix="opera";SC.platform.domCSSPrefix="O"}else{if((/msie/).test(a)&&!(/opera/).test(a)){SC.platform.cssPrefix="ms";SC.platform.domCSSPrefix="ms"}else{if((/mozilla/).test(a)&&!(/(compatible|webkit)/).test(a)){SC.platform.cssPrefix="moz";SC.platform.domCSSPrefix="Moz"}}}}})();(function(){var b=document.createElement("div");var a=["-moz-","-moz-","-o-","-ms-","-webkit-"],h=["moz","Moz","o","ms","webkit"];var f="",d=null,j,c;for(d=0,c=a.length;d<c;d++){j=a[d];f+=j+"transition:all 1s linear;";f+=j+"transform: translate(1px, 1px);";f+=j+"perspective: 500px;"}b.style.cssText=f;var k;for(d=0,c=h.length;d<c;d++){k=h[d];if(b.style[k+"TransitionProperty"]!==undefined){SC.platform.supportsCSSTransitions=YES}if(b.style[k+"Transform"]!==undefined){SC.platform.supportsCSSTransforms=YES}if(b.style[k+"Perspective"]!==undefined||b.style[k+"PerspectiveProperty"]!==undefined){SC.platform.understandsCSS3DTransforms=YES;SC.platform.supportsCSS3DTransforms=YES}}try{if(window.media&&window.media.matchMedium){if(!window.media.matchMedium("(-webkit-transform-3d)")){SC.platform.supportsCSS3DTransforms=NO}}else{if(window.styleMedia&&window.styleMedia.matchMedium){if(!window.styleMedia.matchMedium("(-webkit-transform-3d)")){SC.platform.supportsCSS3DTransforms=NO}}}}catch(g){SC.platform.supportsCSS3DTransforms=NO}if(SC.platform.supportsCSSTransforms&&SC.platform.cssPrefix==="webkit"){SC.platform.supportsAcceleratedLayers=YES}})();sc_require("system/ready");sc_require("system/platform");SC.CAPTURE_BACKSPACE_KEY=NO;SC.RootResponder=SC.Object.extend({panes:null,init:function(){arguments.callee.base.apply(this,arguments);this.panes=SC.Set.create();if(SC.platform.supportsCSSTransitions){this[SC.platform.cssPrefix+"TransitionEnd"]=this.transitionEnd;this["transitionend"]=this.transitionEnd}},mainPane:null,makeMainPane:function(b){var a=this.get("mainPane");if(a===b){return this}this.beginPropertyChanges();if(this.get("keyPane")===a){this.makeKeyPane(b)}this.set("mainPane",b);if(a){a.blurMainTo(b)}if(b){b.focusMainFrom(a)}this.endPropertyChanges();return this},menuPane:null,makeMenuPane:function(b){if(b&&!b.get("acceptsMenuPane")){return this}else{var a=this.get("menuPane");if(a===b){return this}this.set("menuPane",b)}return this},keyPane:null,previousKeyPanes:[],makeKeyPane:function(f){var e,a,d;if(f){if(!f.get("acceptsKeyPane")){return this}else{a=this.get("keyPane");if(a===f){return this}else{if(a){d=this.get("previousKeyPanes");d.push(a)}e=f}}}else{a=this.get("keyPane");d=this.get("previousKeyPanes");e=null;var c;while(d.length>0){c=d.pop();if(c.get("isPaneAttached")&&c.get("acceptsKeyPane")){e=c;break}}}if(!e){var b=this.get("mainPane");if(b&&b.get("acceptsKeyPane")){e=b}}if(a){a.willLoseKeyPaneTo(e)}if(e){e.willBecomeKeyPaneFrom(a)}this.set("keyPane",e);if(e){e.didBecomeKeyPaneFrom(a)}if(a){a.didLoseKeyPaneTo(e)}return this},currentWindowSize:null,computeWindowSize:function(){var c,b,a;if(!this._bod||!this._docElement){b=document.body;a=document.documentElement;this._bod=b;this._docElement=a}else{b=this._bod;a=this._docElement}if(window.innerHeight){c={width:window.innerWidth,height:window.innerHeight}}else{if(a&&a.clientHeight){c={width:a.clientWidth,height:a.clientHeight}}else{if(b){c={width:b.clientWidth,height:b.clientHeight}}}}return c},resize:function(){this._resize();return YES},_resize:function(){var a=this.computeWindowSize(),b=this.get("currentWindowSize");this.set("currentWindowSize",a);if(!SC.rectsEqual(a,b)){SC.device.windowSizeDidChange(a);if(this.panes){SC.run(function(){this.panes.invoke("windowSizeDidChange",b,a)},this)}}},hasFocus:NO,focus:function(b){if(!this.get("hasFocus")){SC.$("body").addClass("sc-focus").removeClass("sc-blur");if(!SC.TABBING_ONLY_INSIDE_DOCUMENT&&!SC.browser.isIE8OrLower){var a=SC.RootResponder.responder.get("keyPane");if(a){var c=a.get("nextValidKeyView");if(c){a.makeFirstResponder(c)}}}SC.run(function(){this.set("hasFocus",YES)},this)}return YES},focusin:function(a){if(this._focusTimeout){clearTimeout(this._focusTimeout)}this.focus(a)},focusout:function(a){var b=this;this._focusTimeout=setTimeout(function(){b.blur(a)},300)},blur:function(a){if(this.get("hasFocus")){SC.$("body").addClass("sc-blur").removeClass("sc-focus");SC.run(function(){this.set("hasFocus",NO)},this)}return YES},dragDidStart:function(a){this._mouseDownView=a;this._drag=a},defaultResponder:null,sendAction:function(d,e,c,f,b,a){e=this.targetForAction(d,e,c,f,a);if(e&&e.isResponderContext){return !!e.sendAction(d,c,b,a)}else{return e&&e.tryToPerform(d,c)}},_responderFor:function(d,b,a){var c=d?d.get("defaultResponder"):null;if(d){d=a||d.get("firstResponder")||d;do{if(d.respondsTo(b)){return d}}while((d=d.get("nextResponder")))}if(typeof c===SC.T_STRING){c=SC.objectForPropertyPath(c)}if(!c){return null}else{if(c.isResponderContext){return c}else{if(c.respondsTo(b)){return c}else{return null}}}},targetForAction:function(c,f,e,g,a){if(!c||(SC.typeOf(c)!==SC.T_STRING)){return null}if(f){if(SC.typeOf(f)===SC.T_STRING){f=SC.objectForPropertyPath(f)||SC.objectForPropertyPath(f,e)}if(f&&!f.isResponderContext){if(f.respondsTo&&!f.respondsTo(c)){f=null}else{if(SC.typeOf(f[c])!==SC.T_FUNCTION){f=null}}}return f}if(g){f=this._responderFor(g,c,a);if(f){return f}}var b=this.get("keyPane"),d=this.get("mainPane");if(b&&(b!==g)){f=this._responderFor(b,c)}if(!f&&d&&(d!==b)){f=this._responderFor(d,c)}if(!f&&(f=this.get("defaultResponder"))){if(SC.typeOf(f)===SC.T_STRING){f=SC.objectForPropertyPath(f);if(f){this.set("defaultResponder",f)}}if(f&&!f.isResponderContext){if(f.respondsTo&&!f.respondsTo(c)){f=null}else{if(SC.typeOf(f[c])!==SC.T_FUNCTION){f=null}}}}return f},targetViewForEvent:function(a){return a.target?SC.$(a.target).view()[0]:null},sendEvent:function(c,a,d){var e,b;SC.run(function(){if(d){e=d.get("pane")}else{e=this.get("menuPane")||this.get("keyPane")||this.get("mainPane")}b=(e)?e.sendEvent(c,a,d):null},this);return b},listenFor:function(d,c,b,a){b=b?b:this;d.forEach(function(e){var f=b[e];if(f){SC.Event.add(c,e,b,f,null,a)}},this);c=null;return b},setup:function(){this.listenFor(["touchstart","touchmove","touchend","touchcancel"],document);this.listenFor(["keydown","keyup","beforedeactivate","mousedown","mouseup","click","dblclick","mousemove","selectstart","contextmenu"],document).listenFor(["resize"],window);if(SC.browser.isIE8OrLower){this.listenFor(["focusin","focusout"],document)}else{this.listenFor(["focus","blur"],window)}this.listenFor(["webkitAnimationStart","webkitAnimationIteration","webkitAnimationEnd"],document);if(SC.platform.supportsCSSTransitions){this.listenFor(["transitionend",SC.platform.cssPrefix+"TransitionEnd"],document)}if(this.keypress){if(SC.CAPTURE_BACKSPACE_KEY&&SC.browser.isMozilla){var b=this;document.onkeypress=function(f){f=SC.Event.normalizeEvent(f);return b.keypress.call(b,f)}}else{SC.Event.add(document,"keypress",this,this.keypress)}}["drag","selectstart"].forEach(function(f){var g=this[f];if(g){if(SC.browser.isIE){var e=this;document.body["on"+f]=function(h){return g.call(e,SC.Event.normalizeEvent(event||window.event))};SC.Event.add(window,"unload",this,function(){document.body["on"+f]=null})}else{SC.Event.add(document,f,this,g)}}},this);var a="mousewheel";if(SC.browser.isMozilla){if(SC.browser.compare(SC.browser.engineVersion,"1.9.1")<0){a="DOMMouseScroll"}else{a="MozMousePixelScroll"}}SC.Event.add(document,a,this,this.mousewheel);this.set("currentWindowSize",this.computeWindowSize());if(SC.browser.os===SC.OS.ios&&SC.browser.name===SC.BROWSER.safari){if(SC.platform&&!SC.platform.touch){SC.platform.simulateTouchEvents()}var c=SC.RunLoop.prototype.endRunLoop,d;d=function(){if(c){c.apply(this,arguments)}var i=SC.RootResponder.responder._touches,h,e,j,f,l,m=NO;if(i){for(h in i){if(i[h]._rescuedElement){continue}j=e=i[h].target;while(e&&(e=e.parentNode)&&!m){m=(e===document.body)}if(!m&&j){if(j.parentNode&&j.cloneNode){var k=j.cloneNode(true);j.parentNode.replaceChild(k,j);j.swapNode=k}var g=SC.touchHoldingPen;if(!g){g=SC.touchHoldingPen=document.createElement("div");g.style.display="none";document.body.appendChild(g)}g.appendChild(j);i[h]._rescuedElement=j}}}};SC.RunLoop.prototype.endRunLoop=d}},_touchedViews:{},_touches:{},touchesForView:function(a){if(this._touchedViews[SC.guidFor(a)]){return this._touchedViews[SC.guidFor(a)].touches}},averagedTouchesForView:function(h,g){var m=this.touchesForView(h),b=h._scrr_averagedTouches||(h._scrr_averagedTouches={});if((!m||m.length===0)&&!g){b.x=0;b.y=0;b.d=0;b.touchCount=0}else{var e=this._averagedTouches_touches||(this._averagedTouches_touches=[]);e.length=0;if(m){var d,f=m.length;for(d=0;d<f;d++){e.push(m[d])}}if(g){e.push(g)}var j,c,a=0,o=0,n,l,k=0;f=e.length;for(j=0;j<f;j++){c=e[j];a+=c.pageX;o+=c.pageY}a/=f;o/=f;for(j=0;j<f;j++){c=e[j];n=Math.abs(c.pageX-a);l=Math.abs(c.pageY-o);k+=Math.pow(n*n+l*l,0.5)}k/=f;b.x=a;b.y=o;b.d=k;b.touchCount=f}return b},assignTouch:function(b,a){if(b.hasEnded){throw"Attempt to assign a touch that is already finished."}if(b.view===a){return}if(b.view){this.unassignTouch(b)}if(!this._touchedViews[SC.guidFor(a)]){this._touchedViews[SC.guidFor(a)]={view:a,touches:SC.CoreSet.create([]),touchCount:0};a.set("hasTouch",YES)}b.view=a;this._touchedViews[SC.guidFor(a)].touches.add(b);this._touchedViews[SC.guidFor(a)].touchCount++},unassignTouch:function(c){var a,b;if(!c.view){return}a=c.view;b=this._touchedViews[SC.guidFor(a)];b.touches.remove(c);b.touchCount--;if(b.touchCount<1){a.set("hasTouch",NO);b.view=null;delete this._touchedViews[SC.guidFor(a)]}c.view=undefined},_flushQueuedTouchResponder:function(){if(this._queuedTouchResponder){var a=this._queuedTouchResponder;this._queuedTouchResponder=null;this.makeTouchResponder.apply(this,a)}},makeTouchResponder:function(f,d,c,k){if(this._isMakingTouchResponder){this._queuedTouchResponder=[f,d,c,k];return}this._isMakingTouchResponder=YES;var h=f.touchResponders,b;if(f.touchResponder===d){this._isMakingTouchResponder=NO;this._flushQueuedTouchResponder();return}var a;if(d){a=d.get("pane")}else{a=this.get("keyPane")||this.get("mainPane")}if(h.indexOf(d)<0){if(k){try{d=(a)?a.sendEvent("touchStart",f,d):null}catch(g){SC.Logger.error("Error in touchStart: "+g);d=null}}else{if(d&&((d.get?d.get("acceptsMultitouch"):d.acceptsMultitouch)||!d.hasTouch)){if(!d.touchStart(f)){d=null}}else{}}}if(!c||(h.indexOf(d)>-1&&h[h.length-1]!==d)){this.unassignTouch(f);var i=h.length-1,j=h[i];while(j&&j!==d){b=this.touchesForView(j);if((j.get?j.get("acceptsMultitouch"):j.acceptsMultitouch)||!b){if(j.touchCancelled){j.touchCancelled(f)}}i--;j=h[i];h.pop();f.touchResponder=h[i];f.nextTouchResponder=h[i-1]}}if(d){this.assignTouch(f,d);if(d!==f.touchResponder){h.push(d);f.touchResponder=d;f.nextTouchResponder=h[h.length-2]}}this._isMakingTouchResponder=NO;this._flushQueuedTouchResponder()},captureTouch:function(h,e,g){if(!e){e=this}var f=h.targetView,c=f,d=[],b,a;if(f.get("touchPriority")){this.makeTouchResponder(h,f,g,YES);return}if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("  -- Received one touch on %@".fmt(f.toString()))}while(c&&(c!==e)){d.unshift(c);c=c.get("nextResponder")}for(a=d.length,b=0;b<a;b++){c=d[b];if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("  -- Checking %@ for captureTouch response…".fmt(c.toString()))}if(c.tryToPerform("captureTouch",h)){if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("   -- Making %@ touch responder because it returns YES to captureTouch".fmt(c.toString()))}this.makeTouchResponder(h,c,g,YES);return}}if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("   -- Didn't find a view that returned YES to captureTouch, so we're calling touchStart")}this.makeTouchResponder(h,f,g,YES)},endMissingTouches:function(e){var b,a=e.length,d={},c=[];for(b=0;b<a;b++){d[e[b].identifier]=YES}for(b in this._touches){var f=this._touches[b].identifier;if(!d[f]){c.push(this._touches[b])}}for(b=0,a=c.length;b<a;b++){this.endTouch(c[b]);this.finishTouch(c[b])}},_touchCount:0,endTouch:function(b,g,c){if(!g){g="touchEnd"}var a,f,d,e;this.unassignTouch(b);if(b.touchResponder){e=b.touchResponder;f=b.touchResponders;a=f.length-1;d=f[a];while(d){if(d[g]){d[g](b,c)}if(b.touchResponder!==e){break}a--;d=f[a];g="touchCancelled"}}},finishTouch:function(b){var a;this.unassignTouch(b);if(a=b._rescuedElement){if(a.swapNode&&a.swapNode.parentNode){a.swapNode.parentNode.replaceChild(a,a.swapNode)}else{if(a.parentNode===SC.touchHoldingPen){SC.touchHoldingPen.removeChild(a)}}delete b._rescuedElement;a.swapNode=null;a=null}b.touchResponders=null;b.touchResponder=null;b.nextTouchResponder=null;b.hasEnded=YES;if(this._touches[b.identifier]){delete this._touches[b.identifier]}},touchstart:function(a){if(this.ignoreTouchHandle(a)){return YES}var b=NO;SC.run(function(){this.endMissingTouches(a.touches);var e,h=a.changedTouches,d=h.length,g,f,i,c;a.touchContext=this;for(e=0;e<d;e++){i=h[e];c=SC.Touch.create(i,this);if(!c.targetView){continue}if(c.hidesTouchIntercept){b=YES}c.timeStamp=a.timeStamp;this._touches[i.identifier]=c;c.event=a;this.captureTouch(c,this);c.event=null}},this);if(b){return YES}return a.hasCustomEventHandling},touchmove:function(a){if(this.ignoreTouchHandle(a)){return YES}SC.run(function(){var c=a.changedTouches,b,n,l,f=c.length,k,j,i,m,g={},e,h,d=NO;if(this._drag){b=SC.Touch.create(a.changedTouches[0],this);this._drag.tryToPerform("mouseDragged",b)}for(l=0;l<f;l++){b=c[l];n=this._touches[b.identifier];if(!n){continue}if(n.hidesTouchIntercept){d=YES}n.pageX=b.pageX;n.pageY=b.pageY;n.clientX=b.clientX;n.clientY=b.clientY;n.screenX=b.screenX;n.screenY=b.screenY;n.timeStamp=a.timeStamp;n.event=a;if(n.touchResponder){k=n.touchResponder;h=SC.guidFor(k);if(!g[h]){g[h]={view:k,touches:[]}}g[h].touches.push(n)}}if(d){a.allowDefault();return YES}for(l in g){k=g[l].view;j=g[l].touches;a.viewChangedTouches=j;i=this.touchesForView(k);m=i.firstObject();a.pageX=m.pageX;a.pageY=m.pageY;a.clientX=m.clientX;a.clientY=m.clientY;a.screenX=m.screenX;a.screenY=m.screenY;a.touchContext=this;k.tryToPerform("touchesDragged",a,i)}c=a.changedTouches;f=c.length;for(l=0;l<f;l++){b=c[l];n=this._touches[b.identifier];if(n){n.event=null}}},this);return a.hasCustomEventHandling},touchend:function(a){var b=NO;if(this.ignoreTouchHandle(a)){return YES}SC.run(function(){var h=a.changedTouches,g,n,l,i=h.length,j,c,f=a.isCancel?"touchCancelled":"touchEnd",k,m,d,e;for(l=0;l<i;l++){g=h[l];g.type="touchend";n=this._touches[g.identifier];if(!n){continue}n.timeStamp=a.timeStamp;n.pageX=g.pageX;n.pageY=g.pageY;n.clientX=g.clientX;n.clientY=g.clientY;n.screenX=g.screenX;n.screenY=g.screenY;n.type="touchend";n.event=a;if(SC.LOG_TOUCH_EVENTS){SC.Logger.info("-- Received touch end")}if(n.hidesTouchIntercept){n.unhideTouchIntercept();b=YES}if(this._drag){this._drag.tryToPerform("mouseUp",g);this._drag=null}this.endTouch(n,f,a);this.finishTouch(n)}},this);if(b){return YES}return a.hasCustomEventHandling},touchcancel:function(a){a.isCancel=YES;this.touchend(a)},ignoreTouchHandle:function(b){if(SC.browser.isMobileSafari){var a=b.target.tagName;if(a==="INPUT"||a==="TEXTAREA"||a==="A"||a==="SELECT"){b.allowDefault();return YES}}return NO},attemptKeyEquivalent:function(b){var d=null;var c=b.commandCodes()[0];if(!c){return NO}var f=this.get("menuPane"),a=this.get("keyPane"),e=this.get("mainPane");if(f){d=f.performKeyEquivalent(c,b);if(d){return d}}if(a){d=a.performKeyEquivalent(c,b);if(d||a.get("isModal")){return d}}if(!d&&e&&(e!==a)){d=e.performKeyEquivalent(c,b);if(d||e.get("isModal")){return d}}return d},_lastModifiers:null,_handleModifierChanges:function(b){var a;a=this._lastModifiers=(this._lastModifiers||{alt:false,ctrl:false,shift:false});var c=false;if(b.altKey!==a.alt){a.alt=b.altKey;c=true}if(b.ctrlKey!==a.ctrl){a.ctrl=b.ctrlKey;c=true}if(b.shiftKey!==a.shift){a.shift=b.shiftKey;c=true}b.modifiers=a;return(c)?(this.sendEvent("flagsChanged",b)?b.hasCustomEventHandling:YES):YES},_isFunctionOrNonPrintableKey:function(a){return !!(a.altKey||a.ctrlKey||a.metaKey||((a.charCode!==a.which)&&SC.FUNCTION_KEYS[a.which]))},_isModifierKey:function(a){return !!SC.MODIFIER_KEYS[a.charCode]},keydown:function(a){if(SC.none(a)){return YES}var e=a.keyCode;if(SC.browser.isMozilla&&a.keyCode===9){this.keydownCounter=1}if(e===229){this._IMEInputON=YES;return this.sendEvent("keyDown",a)}if(e===27&&this._drag){this._drag.cancelDrag();this._drag=null;this._mouseDownView=null;return YES}if(SC.browser.isMozilla&&(a.which===8)){return true}var b=this._handleModifierChanges(a),d=a.target||a.srcElement,c=(a.which===8)&&!SC.allowsBackspaceToPreviousPage&&(d===document.body);if(this._isModifierKey(a)){return(c?NO:b)}b=YES;if(this._isFunctionOrNonPrintableKey(a)){if(e>=37&&e<=40&&SC.browser.isMozilla){return YES}b=this.sendEvent("keyDown",a);if(!b){b=!this.attemptKeyEquivalent(a)}else{b=a.hasCustomEventHandling;if(b){c=NO}}}return c?NO:b},keypress:function(b){var c,e=b.keyCode,f=SC.browser.isMozilla;if(f&&b.keyCode===9){this.keydownCounter++;if(this.keydownCounter==2){return YES}}if(f&&(b.which===8)){b.which=e;c=this.sendEvent("keyDown",b);return c?(SC.allowsBackspaceToPreviousPage||b.hasCustomEventHandling):YES}else{var d=(e>=37&&e<=40&&f),a=b.charCode;if((a!==undefined&&a===0&&b.keyCode!==9)&&!d){return YES}if(d){b.which=e}if(d||!this._isFunctionOrNonPrintableKey(b)){return this.sendEvent("keyDown",b)?b.hasCustomEventHandling:YES}}},keyup:function(a){if(this._ffevt){this._ffevt=null}var b=this._handleModifierChanges(a);if(this._isModifierKey(a)){return b}if(this._IMEInputON&&a.keyCode===13){a.isIMEInput=YES;this.sendEvent("keyDown",a);this._IMEInputON=NO}return this.sendEvent("keyUp",a)?a.hasCustomEventHandling:YES},beforedeactivate:function(c){var b=c.toElement;if(b&&b.tagName&&b.tagName!=="IFRAME"){var a=SC.$(b).view()[0];if(a&&a.get("blocksIEDeactivate")){return NO}}return YES},mousedown:function(e){var d;if(SC.platform.touch){e.allowDefault();this._lastMouseDownCustomHandling=YES;return YES}this._clickCount+=1;if(!this._lastMouseUpAt||((Date.now()-this._lastMouseUpAt)>250)){this._clickCount=1}else{var c=this._lastMouseDownX-e.clientX,a=this._lastMouseDownY-e.clientY,g=Math.sqrt(c*c+a*a);if(g>8){this._clickCount=1}}e.clickCount=this._clickCount;this._lastMouseDownX=e.clientX;this._lastMouseDownY=e.clientY;var b=this.targetViewForEvent(e);if(b){d=b.getPath("pane.firstResponder")}if(d&&d.get("blurOnMouseDown")&&d!==b){d.resignFirstResponder(e)}b=this._mouseDownView=this.sendEvent("mouseDown",e,b);if(b&&b.respondsTo("mouseDragged")){this._mouseCanDrag=YES}var f=b?e.hasCustomEventHandling:YES;this._lastMouseDownCustomHandling=f;return f},mouseup:function(b){var f=NO;if(SC.platform.touch){b.allowDefault();this._lastMouseUpCustomHandling=YES;return YES}if(this._drag){this._drag.tryToPerform("mouseUp",b);this._drag=null}var e=null,a=this._mouseDownView,d=this.targetViewForEvent(b);b.clickCount=this._clickCount;if(a){e=this.sendEvent("mouseUp",b,a);if(!e&&(this._clickCount===2)){e=this.sendEvent("doubleClick",b,a);f=YES}if(!e){e=this.sendEvent("click",b,a);f=YES}}if(!e&&!f){if(this._clickCount===2){e=this.sendEvent("doubleClick",b,d)}if(!e){e=this.sendEvent("click",b,d)}}this._mouseCanDrag=NO;this._mouseDownView=null;this._lastMouseUpAt=Date.now();var c=e?b.hasCustomEventHandling:YES;this._lastMouseUpCustomHandling=c;return c},click:function(a){if(!this._lastMouseUpCustomHandling||!this._lastMouseDownCustomHandling){a.preventDefault();a.stopPropagation();return NO}return YES},dblclick:function(a){if(SC.browser.isIE8OrLower){this._clickCount=2;this.mouseup(a)}},mousewheel:function(b){var a=this.targetViewForEvent(b),c=this.sendEvent("mouseWheel",b,a);return(c)?b.hasCustomEventHandling:YES},_lastHovered:null,mousemove:function(a){if(SC.platform.touch){a.allowDefault();return YES}if(SC.browser.isIE){if(this._lastMoveX===a.clientX&&this._lastMoveY===a.clientY){return}}this._lastMoveX=a.clientX;this._lastMoveY=a.clientY;SC.run(function(){if(this._drag){if(SC.browser.isIE){if(this._lastMouseDownX!==a.clientX||this._lastMouseDownY!==a.clientY){this._drag.tryToPerform("mouseDragged",a)}}else{this._drag.tryToPerform("mouseDragged",a)}}else{var d=this._lastHovered||[],e=[],g,f,b,c=this.targetViewForEvent(a);while(c&&(c!==this)){e.push(c);c=c.get("nextResponder")}for(f=0,b=d.length;f<b;f++){c=d[f];g=c.respondsTo("mouseExited");if(g&&e.indexOf(c)===-1){c.tryToPerform("mouseExited",a)}}for(f=0,b=e.length;f<b;f++){c=e[f];if(d.indexOf(c)!==-1){c.tryToPerform("mouseMoved",a)}else{c.tryToPerform("mouseEntered",a)}}this._lastHovered=e;if(this._mouseDownView){if(SC.browser.isIE){if(this._lastMouseDownX!==a.clientX&&this._lastMouseDownY!==a.clientY){this._mouseDownView.tryToPerform("mouseDragged",a)}}else{this._mouseDownView.tryToPerform("mouseDragged",a)}}}},this)},_mouseCanDrag:YES,selectstart:function(b){var c=this.targetViewForEvent(b),a=this.sendEvent("selectStart",b,c);if(c&&c.respondsTo("mouseDragged")){return(a!==null?YES:NO)&&!this._mouseCanDrag}else{return(a!==null?YES:NO)}},drag:function(){return false},contextmenu:function(b){var a=this.targetViewForEvent(b);return this.sendEvent("contextMenu",b,a)},webkitAnimationStart:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("animationDidStart",b,a)}catch(c){SC.Logger.warn("Exception during animationDidStart: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES},webkitAnimationIteration:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("animationDidIterate",b,a)}catch(c){SC.Logger.warn("Exception during animationDidIterate: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES},webkitAnimationEnd:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("animationDidEnd",b,a)}catch(c){SC.Logger.warn("Exception during animationDidEnd: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES},transitionEnd:function(b){try{var a=this.targetViewForEvent(b);this.sendEvent("transitionDidEnd",b,a)}catch(c){SC.Logger.warn("Exception during transitionDidEnd: %@".fmt(c));throw c}return a?b.hasCustomEventHandling:YES}});SC.Touch=function(d,a){this.touchContext=a;this.identifier=d.identifier;var c=d.target,b;if(c&&SC.$(c).hasClass("touch-intercept")){d.target.style.webkitTransform="translate3d(0px,-5000px,0px)";c=document.elementFromPoint(d.pageX,d.pageY);if(c){b=SC.$(c).view()[0]}this.hidesTouchIntercept=NO;if(c.tagName==="INPUT"){this.hidesTouchIntercept=d.target}else{d.target.style.webkitTransform="translate3d(0px,0px,0px)"}}else{b=d.target?SC.$(d.target).view()[0]:null}this.targetView=b;this.target=c;this.hasEnded=NO;this.type=d.type;this.clickCount=1;this.view=undefined;this.touchResponder=this.nextTouchResponder=undefined;this.touchResponders=[];this.startX=this.pageX=d.pageX;this.startY=this.pageY=d.pageY;this.clientX=d.clientX;this.clientY=d.clientY;this.screenX=d.screenX;this.screenY=d.screenY};SC.Touch.prototype={unhideTouchIntercept:function(){var a=this.hidesTouchIntercept;if(a){setTimeout(function(){a.style.webkitTransform="translate3d(0px,0px,0px)"},500)}},allowDefault:function(){if(this.event){this.event.hasCustomEventHandling=YES}},preventDefault:function(){if(this.event){this.event.preventDefault()}},stopPropagation:function(){if(this.event){this.event.stopPropagation()}},stop:function(){if(this.event){this.event.stop()}},end:function(){this.touchContext.endTouch(this)},makeTouchResponder:function(b,c,a){this.touchContext.makeTouchResponder(this,b,c,a)},captureTouch:function(a,b){this.touchContext.captureTouch(this,a,b)},touchesForView:function(a){return this.touchContext.touchesForView(a)},touchesForResponder:function(a){return this.touchContext.touchesForView(a)},averagedTouchesForView:function(a,b){return this.touchContext.averagedTouchesForView(a,(b?this:null))}};SC.mixin(SC.Touch,{create:function(b,a){return new SC.Touch(b,a)}});SC.ready(SC.RootResponder,SC.RootResponder.ready=function(){var a;a=SC.RootResponder.responder=SC.RootResponder.create();a.setup()});sc_require("system/core_query");sc_require("system/ready");sc_require("system/root_responder");sc_require("system/platform");SC.PORTRAIT_ORIENTATION="portrait";SC.LANDSCAPE_ORIENTATION="landscape";SC.NO_ORIENTATION="desktop";SC.device=SC.Object.create({orientation:SC.NO_ORIENTATION,isOffline:NO,mouseLocation:function(){var a=SC.RootResponder.responder,c=a._lastMoveX,b=a._lastMoveY;if(SC.empty(c)||SC.empty(b)){return null}return{x:c,y:b}}.property(),init:function(){arguments.callee.base.apply(this,arguments);if(navigator&&navigator.onLine===false){this.set("isOffline",YES)}},setup:function(){var a=SC.RootResponder.responder;a.listenFor(["online","offline"],window,this);this.orientationHandlingShouldChange()},orientationHandlingShouldChange:function(){if(SC.platform.windowSizeDeterminesOrientation){SC.Event.remove(window,"orientationchange",this,this.orientationchange);this.windowSizeDidChange(SC.RootResponder.responder.get("currentWindowSize"))}else{if(SC.platform.supportsOrientationChange){SC.Event.add(window,"orientationchange",this,this.orientationchange);this.orientationchange()}}},windowSizeDidChange:function(a){if(SC.platform.windowSizeDeterminesOrientation){if(!SC.browser.iOS){SC.run(function(){if(SC.platform.touch){if(a.height>=a.width){SC.device.set("orientation",SC.PORTRAIT_ORIENTATION)}else{SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}}else{SC.device.set("orientation",SC.NO_ORIENTATION)}})}else{SC.run(function(){if(a.width===window.screen.width){SC.device.set("orientation",SC.PORTRAIT_ORIENTATION)}else{SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}})}return YES}return NO},orientationchange:function(a){SC.run(function(){if(window.orientation===0||window.orientation===180){SC.device.set("orientation",SC.PORTRAIT_ORIENTATION)}else{SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}})},orientationObserver:function(){var a=SC.$(document.body),b=this.get("orientation");if(b===SC.PORTRAIT_ORIENTATION){a.addClass("portrait")}else{a.removeClass("portrait")}if(b===SC.LANDSCAPE_ORIENTATION){a.addClass("landscape")}else{a.removeClass("landscape")}}.observes("orientation"),online:function(a){this.set("isOffline",NO)},offline:function(a){this.set("isOffline",YES)}});SC.ready(function(){SC.device.setup()});SC.MODIFIED_KEY_BINDINGS={"ctrl_.":"cancel",shift_tab:"insertBacktab",shift_left:"moveLeftAndModifySelection",shift_right:"moveRightAndModifySelection",shift_up:"moveUpAndModifySelection",shift_down:"moveDownAndModifySelection",alt_left:"moveLeftAndModifySelection",alt_right:"moveRightAndModifySelection",alt_up:"moveUpAndModifySelection",alt_down:"moveDownAndModifySelection",ctrl_a:"selectAll"};SC.BASE_KEY_BINDINGS={escape:"cancel",backspace:"deleteBackward","delete":"deleteForward","return":"insertNewline",tab:"insertTab",left:"moveLeft",right:"moveRight",up:"moveUp",down:"moveDown",home:"moveToBeginningOfDocument",end:"moveToEndOfDocument",pagedown:"pageDown",pageup:"pageUp"};SC.Page=SC.Object.extend({owner:null,get:function(a){var b=this[a];if(b&&b.isClass){this[a]=b=b.create({page:this});if(!this.get("inDesignMode")){b.awake()}return b}else{return arguments.callee.base.apply(this,arguments)}},awake:function(){var b,a;for(a in this){if(!this.hasOwnProperty(a)){continue}b=this[a];if(b&&b.isViewClass){this[a]=b=b.create({page:this})}}return this},getIfConfigured:function(b){var a=this[b];return(a&&a.isViewClass)?null:this.get(b)},loc:function(c){var a,b;for(b in c){if(!c.hasOwnProperty(b)){continue}a=this[b];if(!a||!a.isViewClass){continue}a.loc(c[b])}return this}});SC.Page.design=SC.Page.create;SC.Page.localization=function(a){return a};sc_require("system/builder");SC.MODE_REPLACE="replace";SC.MODE_APPEND="append";SC.MODE_PREPEND="prepend";SC.NON_PIXEL_PROPERTIES=["zIndex","fontWeight","opacity"];SC.COMBO_STYLES={WebkitTransition:["WebkitTransitionProperty","WebkitTransitionDuration","WebkitTransitionDelay","WebkitTransitionTimingFunction"]};SC.RenderContext=SC.Builder.create({SELF_CLOSING:SC.CoreSet.create().addEach(["area","base","basefront","br","hr","input","img","link","meta"]),init:function(e,d){var b,a;if(d){this.prevObject=d;this.strings=d.strings;this.offset=d.length+d.offset}if(!this.strings){this.strings=[]}if(e===undefined){e="div";a=YES}else{if(e==="div"||e==="label"||e==="a"){a=YES}else{if(SC.typeOf(e)===SC.T_STRING){e=e.toLowerCase();a=YES}}}if(a){this._tagName=e;this._needsTag=YES;this.needsContent=YES;var f=this;while(f){f.length++;f=f.prevObject}this.strings.push(null);this._selfClosing=this.SELF_CLOSING.contains(e)}else{this._elem=e;this._needsTag=NO;this.length=0;this.needsContent=NO}return this},strings:null,offset:0,length:0,updateMode:SC.MODE_REPLACE,needsContent:NO,get:function(b){var a=this.strings||[];return(b===undefined)?a.slice(this.offset,this.length):a[b+this.offset]},push:function(d){var b=this.strings,a=arguments.length;if(!b){this.strings=b=[]}if(a>1){b.push.apply(b,arguments)}else{b.push(d)}var e=this;while(e){e.length+=a;e=e.prevObject}this.needsContent=YES;return this},text:function(c){var b=arguments.length,a=0;for(a=0;a<b;a++){this.push(SC.RenderContext.escapeHTML(arguments[a]))}return this},join:function(b){if(this._needsTag){this.end()}var a=this.strings;return a?a.join(b||""):""},begin:function(a){return SC.RenderContext(a,this)},element:function(){return this._elem?this._elem:SC.$(this.join())[0]},remove:function(a){if(!a){return}var b,c=this._elem;if(!c||!c.removeChild){return}b=document.getElementById(a);if(b){b=c.removeChild(b);b=null}},update:function(){var c=this._elem,g=this.updateMode,e,d,a,f,b;this._innerHTMLReplaced=NO;if(!c){return}e=this.$();if(this.length>0){this._innerHTMLReplaced=YES;if(g===SC.MODE_REPLACE){e.html(this.join())}else{a=c.cloneNode(false);a.innerHTML=this.join();f=a.firstChild;while(f){b=f.nextSibling;c.insertBefore(f,b);f=b}f=b=a=null}}if(this._idDidChange&&(d=this._id)){e.attr("id",d)}jQuery.Buffer.flush();c=this._elem=null;return this.prevObject||this},_DEFAULT_ATTRS:{},end:function(){var n="",b="",d,l,j,h,k=this._attrs,e=this._classNames,a=this._id,m=this._styles,i,g;n="<"+this._tagName;if(k||e||m||a){if(!k){k=this._DEFAULT_ATTRS}if(a){k.id=a}if(e){k["class"]=e.join(" ")}if(m){for(j in m){if(!m.hasOwnProperty(j)){continue}h=m[j];if(h===null){continue}if(typeof h===SC.T_NUMBER&&!SC.NON_PIXEL_PROPERTIES.contains(j)){h+="px"}b=b+this._dasherizeStyleName(j)+": "+h+"; "}k.style=b}n=n+" ";for(j in k){if(!k.hasOwnProperty(j)){continue}h=k[j];if(h===null){continue}n=n+j+'="'+h+'" '}if(k===this._DEFAULT_ATTRS){delete k.style;delete k["class"];delete k.id}}i=this.strings;g=(this._selfClosing===NO)?NO:(this.length===1);n=n+(g?" />":">");i[this.offset]=n;if(!g){i.push("</"+this._tagName+">");var f=this;while(f){f.length++;f=f.prevObject}}this._elem=null;return this.prevObject||this},tag:function(a,b){return this.begin(a,b).end()},tagName:function(a){if(a===undefined){if(!this._tagName&&this._elem){this._tagName=this._elem.tagName}return this._tagName}else{this._tagName=a;this._tagNameDidChange=YES;return this}},id:function(a){if(a===undefined){if(!this._id&&this._elem){this._id=this._elem.id}return this._id}else{this._id=a;this._idDidChange=YES;return this}},classNames:function(b,a){if(this._elem){if(b){this.$().resetClassNames().addClass(b);return this}else{return this.$().attr("class").split(" ")}}if(b===undefined){if(this._cloneClassNames){this._classNames=(this._classNames||[]).slice();this._cloneClassNames=NO}if(!this._classNames){this._classNames=[]}return this._classNames}else{this._classNames=b;this._cloneClassNames=a||NO;this._classNamesDidChange=YES;return this}},hasClass:function(a){if(this._elem){return this.$().hasClass(a)}return this.classNames().indexOf(a)>=0},addClass:function(f){if(f===undefined||f===null){SC.Logger.warn("You are adding an undefined or empty class"+this.toString());return this}if(this._elem){if(SC.typeOf(f)===SC.T_STRING){this.$().addClass(f)}else{var c,b=f.length;for(c=0;c<b;c++){this.$().addClass(f[c])}}return this}var g=this.classNames();if(SC.typeOf(f)===SC.T_STRING){if(g.indexOf(f)<0){g.push(f);this._classNamesDidChange=YES}}else{var d;for(var e=0,a=f.length;e<a;e++){d=f[e];if(g.indexOf(d)<0){g.push(d);this._classNamesDidChange=YES}}}return this},removeClass:function(b){if(this._elem){this.$().removeClass(b);return this}var c=this._classNames,a;if(c&&(a=c.indexOf(b))>=0){if(this._cloneClassNames){c=this._classNames=c.slice();this._cloneClassNames=NO}c[a]=null;this._classNamesDidChange=YES}return this},resetClassNames:function(){if(this._elem){this.$().resetClassNames();return this}this._classNames=[];this._classNamesDidChange=YES;return this},setClass:function(d,c){if(this._elem){this.$().setClass(d,c);return this}var f,a,b,e;if(c!==undefined){return c?this.addClass(d):this.removeClass(d)}else{f=this._classNames;if(!f){f=this._classNames=[]}if(this._cloneClassNames){f=this._classNames=f.slice();this._cloneClassNames=NO}e=NO;for(b in d){if(!d.hasOwnProperty(b)){continue}a=f.indexOf(b);if(d[b]){if(a<0){f.push(b);e=YES}}else{if(a>=0){f[a]=null;e=YES}}}if(e){this._classNamesDidChange=YES}}return this},_STYLE_REGEX:/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,styles:function(d,e){if(this._elem){if(d){this.$().resetStyles().css(d)}return this.$().styles()}var a,c,b;if(d===undefined){if(!this._styles&&this._elem){a=this.$().attr("style");if(a&&(a=a.toString()).length>0){if(SC.browser.name===SC.BROWSER.ie){a=a.toLowerCase()}d={};c=this._STYLE_REGEX;c.lastIndex=0;while(b=c.exec(a)){d[this._camelizeStyleName(b[1])]=b[2]}this._styles=d;this._cloneStyles=NO}else{this._styles={}}}else{if(!this._styles){this._styles={}}else{if(this._cloneStyles){this._styles=SC.clone(this._styles);this._cloneStyles=NO}}}return this._styles}else{this._styles=d;this._cloneStyles=e||NO;this._stylesDidChange=YES;return this}},_deleteComboStyles:function(e,d){var g=SC.COMBO_STYLES[d],f=NO,c;if(g){for(var a=0,b=g.length;a<b;a++){c=g[a];if(e[c]){delete e[c];f=YES}}}return f},resetStyles:function(){this.styles({});return this},addStyle:function(a,e){if(this._elem){this.$().css(a,e);return this}var b,d=NO,c=this.styles();if(typeof a===SC.T_STRING){if(e===undefined){return c[a]}else{d=this._deleteComboStyles(c,a);if(c[a]!==e){c[a]=e;d=YES}if(d){this._stylesDidChange=YES}}}else{for(b in a){if(!a.hasOwnProperty(b)){continue}d=d||this._deleteComboStyles(c,b);e=a[b];if(c[b]!==e){c[b]=e;d=YES}}if(d){this._stylesDidChange=YES}}return this},removeStyle:function(a){if(this._elem){this.$().css(a,null);return this}if(!this._styles){return this}var b=this.styles();if(b[a]){b[a]=null;this._stylesDidChange=YES}},attr:function(a,e){if(this._elem){this.$().attr(a,e);return this}var c,b=this._attrs,d=NO;if(!b){this._attrs=b={}}if(typeof a===SC.T_STRING){if(e===undefined){return b[a]}else{if(b[a]!==e){b[a]=e;this._attrsDidChange=YES}}}else{for(c in a){if(!a.hasOwnProperty(c)){continue}e=a[c];if(b[c]!==e){b[c]=e;d=YES}}if(d){this._attrsDidChange=YES}}return this},removeAttr:function(a){if(this._elem){this.$().removeAttr(a);return this}},$:function(c){var a,b=this._elem;a=!b?SC.$.buffer([]):(c===undefined)?SC.$.buffer(b):SC.$.buffer(c,b);b=null;return a},_camelizeStyleName:function(a){var b=a.match(/^-(webkit|moz|o)-/),c=SC.String.camelize(a);if(b){return c.substr(0,1).toUpperCase()+c.substr(1)}else{return c}},_dasherizeStyleName:function(a){var b=SC.String.dasherize(a);if(b.match(/^(webkit|moz|ms|o)-/)){b="-"+b}return b}});SC.RenderContext.fn.html=SC.RenderContext.fn.push;SC.RenderContext.fn.css=SC.RenderContext.fn.addStyle;(function(){var b=/[&<>]/g,a=function(c){switch(c){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;"}};SC.RenderContext.escapeHTML=function(c){if(!c){return""}if(SC.typeOf(c)===SC.T_NUMBER){c=c.toString()}return c.replace(b,a)}})();(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelRequestAnimationFrame=window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());SC.SelectionSet=SC.Object.extend(SC.Enumerable,SC.Freezable,SC.Copyable,{isSelectionSet:YES,length:function(){var a=0,b=this._sets,c=this._objects;if(c){a+=c.get("length")}if(b){b.forEach(function(d){a+=d.get("length")})}return a}.property().cacheable(),sources:function(){var c=[],d=this._sets,b=d?d.length:0,a,f,e;for(a=0;a<b;a++){f=d[a];if(f&&f.get("length")>0&&f.source){c.push(f.source)}}return c}.property().cacheable(),indexSetForSource:function(e){if(!e||!e.isSCArray){return null}var b=this._indexSetCache,d=this._objects,c,a;if(!b){b=this._indexSetCache={}}c=b[SC.guidFor(e)];if(c&&c._sourceRevision&&(c._sourceRevision!==e.propertyRevision)){c=null}if(!c){c=this._indexSetForSource(e,NO);if(c&&c.get("length")===0){c=null}if(d){if(c){c=c.copy()}d.forEach(function(f){if((a=e.indexOf(f))>=0){if(!c){c=SC.IndexSet.create()}c.add(a)}},this)}if(c){c=b[SC.guidFor(e)]=c.frozenCopy();c._sourceRevision=e.propertyRevision}}return c},_indexSetForSource:function(f,g){if(g===undefined){g=YES}var d=SC.guidFor(f),c=this[d],e=this._sets,a=e?e.length:0,b=null;if(c>=a){c=null}if(SC.none(c)){if(g&&!this.isFrozen){this.propertyWillChange("sources");if(!e){e=this._sets=[]}b=e[a]=SC.IndexSet.create();b.source=f;this[d]=a;this.propertyDidChange("sources")}}else{b=e?e[c]:null}return b},add:function(a,b,d){if(this.isFrozen){throw SC.FROZEN_ERROR}var g,f,j,i,c,e,h,k;if(b===undefined&&d===undefined){if(!a){throw"Must pass params to SC.SelectionSet.add()"}if(a.isIndexSet){return this.add(a.source,a)}if(a.isSelectionSet){g=a._sets;k=a._objects;f=g?g.length:0;this.beginPropertyChanges();for(j=0;j<f;j++){i=g[j];if(i&&i.get("length")>0){this.add(i.source,i)}}if(k){this.addObjects(k)}this.endPropertyChanges();return this}}i=this._indexSetForSource(a,YES);c=this.get("length");h=i.get("length");e=c-h;i.add(b,d);this._indexSetCache=null;e+=i.get("length");if(e!==c){this.propertyDidChange("length");this.enumerableContentDidChange();if(h===0){this.notifyPropertyChange("sources")}}return this},remove:function(a,b,d){if(this.isFrozen){throw SC.FROZEN_ERROR}var g,f,j,i,c,e,h,k;if(b===undefined&&d===undefined){if(!a){throw"Must pass params to SC.SelectionSet.remove()"}if(a.isIndexSet){return this.remove(a.source,a)}if(a.isSelectionSet){g=a._sets;k=a._objects;f=g?g.length:0;this.beginPropertyChanges();for(j=0;j<f;j++){i=g[j];if(i&&i.get("length")>0){this.remove(i.source,i)}}if(k){this.removeObjects(k)}this.endPropertyChanges();return this}}i=this._indexSetForSource(a,YES);c=this.get("length");e=c-i.get("length");if(i&&(k=this._objects)){if(d!==undefined){b=SC.IndexSet.create(b,d);d=undefined}k.forEach(function(l){j=a.indexOf(l);if(b.contains(j)){k.remove(l);e--}},this)}i.remove(b,d);h=i.get("length");e+=h;this._indexSetCache=null;if(e!==c){this.propertyDidChange("length");this.enumerableContentDidChange();if(h===0){this.notifyPropertyChange("sources")}}return this},contains:function(b,d,a){if(d===undefined&&a===undefined){return this.containsObject(b)}var c=this.indexSetForSource(b);if(!c){return NO}return c.contains(d,a)},intersects:function(b,d,a){var c=this.indexSetForSource(b,NO);if(!c){return NO}return c.intersects(d,a)},_TMP_ARY:[],addObject:function(b){var c=this._TMP_ARY,a;c[0]=b;a=this.addObjects(c);c.length=0;return a},addObjects:function(a){var d=this._objects,b,c;if(!d){d=this._objects=SC.CoreSet.create()}b=d.get("length");d.addEach(a);c=d.get("length");this._indexSetCache=null;if(c!==b){this.propertyDidChange("length");this.enumerableContentDidChange()}return this},removeObject:function(b){var c=this._TMP_ARY,a;c[0]=b;a=this.removeObjects(c);c.length=0;return a},removeObjects:function(b){var e=this._objects,c,d,a;if(!e){return this}c=e.get("length");e.removeEach(b);d=e.get("length");if(a=this._sets){a.forEach(function(f){c+=f.get("length");f.removeObjects(b);d+=f.get("length")},this)}this._indexSetCache=null;if(d!==c){this.propertyDidChange("length");this.enumerableContentDidChange()}return this},containsObject:function(c){var e=this._objects;if(e&&e.contains(c)){return YES}var d=this._sets,b=d?d.length:0,a,f;for(a=0;a<b;a++){f=d[a];if(f&&f.indexOf(c)>=0){return YES}}return NO},constrain:function(e){var g,b,a,d;this.beginPropertyChanges();this.get("sources").forEach(function(h){if(h===e){return}var i=this._indexSetForSource(e,NO);if(i){this.remove(e,i)}},this);g=this._indexSetForSource(e,NO);if(g&&((a=g.get("max"))>(b=e.get("length")))){this.remove(e,b,a-b)}if(d=this._objects){var c,f;for(c=d.length-1;c>=0;c--){f=d[c];if(e.indexOf(f)<0){this.removeObject(f)}}}this.endPropertyChanges();return this},isEqual:function(g){var f,d,b,a,c,e;if(!g||!g.isSelectionSet){return NO}if(g===this){return YES}if((this._sets===g._sets)&&(this._objects===g._objects)){return YES}if(this.get("length")!==g.get("length")){return NO}f=this._objects;d=g._objects;if(f||d){if((f?f.get("length"):0)!==(d?d.get("length"):0)){return NO}if(f&&!f.isEqual(d)){return NO}}c=this.get("sources");a=c.get("length");for(b=0;b<a;b++){e=c.objectAt(b);f=this._indexSetForSource(e,NO);d=this._indexSetForSource(e,NO);if(!!d!==!!f){return NO}if(f&&!f.isEqual(d)){return NO}}return YES},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}if(this._sets){this._sets.length=0}if(this._objects){this._objects=null}this._indexSetCache=null;this.propertyDidChange("length");this.enumerableContentDidChange();this.notifyPropertyChange("sources");return this},copy:function(){var c=this.constructor.create(),d=this._sets,b=d?d.length:0,a,e;if(d&&b>0){d=c._sets=d.slice();for(a=0;a<b;a++){if(!(e=d[a])){continue}e=d[a]=e.copy();c[SC.guidFor(e.source)]=a}}if(this._objects){c._objects=this._objects.copy()}return c},freeze:function(){if(this.get("isFrozen")){return this}var a=this._sets,b=a?a.length:0,c;while(--b>=0){c=a[b];if(c){c.freeze()}}if(this._objects){this._objects.freeze()}this.set("isFrozen",YES);return this},toString:function(){var a=this._sets||[];a=a.map(function(b){return b.toString().replace("SC.IndexSet",SC.guidFor(b.source))},this);if(this._objects){a.push(this._objects.toString())}return"SC.SelectionSet:%@<%@>".fmt(SC.guidFor(this),a.join(","))},firstObject:function(){var b=this._sets,c=this._objects;if(b&&b.get("length")>0){var e=b?b[0]:null,d=e?e.source:null,a=e?e.firstObject():-1;if(d&&a>=0){return d.objectAt(a)}}return c?c.firstObject():undefined}.property(),nextObject:function(c,e,b){var d,a;if(c===0){d=b.objects=[];this.forEach(function(f){d.push(f)},this);b.max=d.length}d=b.objects;a=d[c];if(c+1>=b.max){b.objects=b.max=null}return a},forEach:function(g,e){var c=this._sets,d=this._objects,b=c?c.length:0,f,a;for(a=0;a<b;a++){f=c[a];if(f){f.forEachObject(g,e)}}if(d){d.forEach(g,e)}return this}});SC.SelectionSet.prototype.clone=SC.SelectionSet.prototype.copy;SC.SelectionSet.EMPTY=SC.SelectionSet.create().freeze();sc_require("mixins/delegate_support");SC.SparseArray=SC.Object.extend(SC.Observable,SC.Enumerable,SC.Array,SC.DelegateSupport,{_requestingLength:0,_requestingIndex:0,length:function(){var a=this.delegate;if(a&&SC.none(this._length)&&a.sparseArrayDidRequestLength){this._requestingLength++;a.sparseArrayDidRequestLength(this);this._requestingLength--}return this._length||0}.property().cacheable(),provideLength:function(b){var a;if(SC.none(b)){this._sa_content=null}if(b!==this._length){a=this._length;this._length=b;if(this._requestingLength<=0){this.arrayContentDidChange(0,a||0,b||0)}}return this},rangeWindowSize:1,requestedRangeIndex:null,init:function(){arguments.callee.base.apply(this,arguments);this.requestedRangeIndex=[];this._TMP_PROVIDE_ARRAY=[];this._TMP_PROVIDE_RANGE={length:1};this._TMP_RANGE={}},objectAt:function(a,d){var c=this._sa_content,b;if(!c){c=this._sa_content=[]}if((b=c[a])===undefined){if(!d){this.requestIndex(a)}b=c[a]}return b},definedIndexes:function(d){var c=SC.IndexSet.create(),e=this._sa_content,b,a;if(!e){return c.freeze()}if(d){d.forEach(function(f){if(e[f]!==undefined){c.add(f)}})}else{a=e.length;for(b=0;b<a;b++){if(e[b]!==undefined){c.add(b)}}}return c.freeze()},_TMP_RANGE:{},requestIndex:function(b){var c=this.delegate;if(!c){return this}var a=this.get("rangeWindowSize"),e=b;if(a>1){e=e-Math.floor(e%a)}if(a<1){a=1}this._requestingIndex++;if(c.sparseArrayDidRequestRange){var d=this._TMP_RANGE;if(this.wasRangeRequested(e)===-1){d.start=e;d.length=a;this.requestedRangeIndex.push(e);c.sparseArrayDidRequestRange(this,d)}}else{if(c.sparseArrayDidRequestIndex){while(--a>=0){c.sparseArrayDidRequestIndex(this,e+a)}}}this._requestingIndex--;return this},wasRangeRequested:function(c){var b,a;for(b=0,a=this.requestedRangeIndex.length;b<a;b++){if(this.requestedRangeIndex[b]===c){return b}}return -1},rangeRequestCompleted:function(b){var a=this.wasRangeRequested(b);if(a>=0){this.requestedRangeIndex.removeAt(a,1);return YES}return NO},provideObjectsInRange:function(b,e){var c=this._sa_content;if(!c){c=this._sa_content=[]}var d=b.start,a=b.length;while(--a>=0){c[d+a]=e.objectAt(a)}if(this._requestingIndex<=0){this.arrayContentDidChange(b.start,b.length,b.length)}return this},provideObjectAtIndex:function(c,b){var d=this._TMP_PROVIDE_ARRAY,a=this._TMP_PROVIDE_RANGE;d[0]=b;a.start=c;return this.provideObjectsInRange(a,d)},objectsDidChangeInRange:function(a){var b=this._sa_content;if(b){if(a.start===0&&SC.maxRange(a)>=b.length){this._sa_content=null}else{var d=a.start,c=Math.min(d+a.length,b.length);while(--c>=d){b[c]=undefined}}}this.arrayContentDidChange(a.start,a.length,a.length);return this},indexOf:function(d){var e,b,a=this.delegate;if(a&&a.sparseArrayDidRequestIndexOf){b=a.sparseArrayDidRequestIndexOf(this,d)}if(SC.none(b)){e=this._sa_content;if(!e){e=this._sa_content=[]}b=e.indexOf(d)}return b},replace:function(b,g,e){e=e||[];var c=this.delegate;if(c){if(!c.sparseArrayShouldReplace||!c.sparseArrayShouldReplace(this,b,g,e)){return this}}var d=this._sa_content;if(!d){d=this._sa_content=[]}d.replace(b,g,e);var a=e?(e.get?e.get("length"):e.length):0;var f=a-g;this.arrayContentWillChange(b,g,a);if(!SC.none(this._length)){this.propertyWillChange("length");this._length+=f;this.propertyDidChange("length")}this.beginPropertyChanges();this.arrayContentDidChange(b,g,a);this.enumerableContentDidChange(b,g,f);this.endPropertyChanges();return this},reset:function(){var a;this._sa_content=null;a=this._length;this._length=null;this.arrayContentDidChange(0,a,0);this.invokeDelegateMethod(this.delegate,"sparseArrayDidReset",this);return this}});SC.SparseArray.array=function(a){return this.create({_length:a||0})};SC.Timer=SC.Object.extend({target:null,action:null,isPooled:NO,interval:0,startTime:null,repeats:NO,until:null,isPaused:NO,isScheduled:NO,isValid:YES,lastFireTime:0,fireTime:function(){if(!this.get("isValid")){return -1}var e=this.get("startTime");if(!e||e===0){return -1}var a=this.get("interval"),c=this.get("lastFireTime");if(c<e){c=e}var b;if(this.get("repeats")){if(a===0){b=c}else{b=e+(Math.floor((c-e)/a)+1)*a}}else{b=e+a}var d=this.get("until");if(d&&d>0&&b>d){b=d}return b}.property("interval","startTime","repeats","until","isValid","lastFireTime").cacheable(),schedule:function(){if(!this.get("isValid")){return this}this.beginPropertyChanges();if(!this.startTime){this.set("startTime",SC.RunLoop.currentRunLoop.get("startTime"))}var a=this.get("fireTime"),b=this.get("lastFireTime");if(a>=b){this.set("isScheduled",YES);SC.RunLoop.currentRunLoop.scheduleTimer(this,a)}this.endPropertyChanges();return this},invalidate:function(){this.beginPropertyChanges();this.set("isValid",NO);var a=SC.RunLoop.currentRunLoop;if(a){a.cancelTimer(this)}this.action=this.target=null;this.endPropertyChanges();if(this.get("isPooled")){SC.Timer.returnTimerToPool(this)}return this},fire:function(){var b=Date.now();this.set("lastFireTime",b);var a=this.get("fireTime");if(!this.get("isPaused")){this.performAction()}if(a>b){this.schedule()}else{this.invalidate()}},performAction:function(){var a=SC.typeOf(this.action);if(a==SC.T_FUNCTION){this.action.call((this.target||this),this)}else{if(a===SC.T_STRING){if(this.action.indexOf(".")>=0){var e=this.action.split(".");var c=e.pop();var d=SC.objectForPropertyPath(e,window);var b=d.get?d.get(c):d[c];if(b&&SC.typeOf(b)==SC.T_FUNCTION){b.call(d,this)}else{throw"%@: Timer could not find a function at %@".fmt(this,this.action)}}else{SC.RootResponder.responder.sendAction(this.action,this.target,this)}}}},init:function(){arguments.callee.base.apply(this,arguments);if(this.startTime instanceof Date){this.startTime=this.startTime.getTime()}if(this.until instanceof Date){this.until=this.until.getTime()}},RESET_DEFAULTS:{target:null,action:null,isPooled:NO,isPaused:NO,isScheduled:NO,isValid:YES,interval:0,repeats:NO,until:null,startTime:null,lastFireTime:0},reset:function(b){if(!b){b=SC.EMPTY_HASH}this.propertyWillChange("fireTime");var c=this.RESET_DEFAULTS;for(var a in c){if(!c.hasOwnProperty(a)){continue}this[a]=SC.none(b[a])?c[a]:b[a]}this.propertyDidChange("fireTime");return this},removeFromTimerQueue:function(c){var b=this._timerQueuePrevious,a=this._timerQueueNext;if(!b&&!a&&c!==this){return c}if(b){b._timerQueueNext=a}if(a){a._timerQueuePrevious=b}this._timerQueuePrevious=this._timerQueueNext=null;return(c===this)?a:c},scheduleInTimerQueue:function(c,b){this._timerQueueRunTime=b;var a=c;var d=null;while(a&&a._timerQueueRunTime<b){d=a;a=a._timerQueueNext}if(d){d._timerQueueNext=this;this._timerQueuePrevious=d}if(a){a._timerQueuePrevious=this;this._timerQueueNext=a}return(a===c)?this:c},collectExpiredTimers:function(c,a){if(this._timerQueueRunTime>a){return this}c.push(this);var b=this._timerQueueNext;this._timerQueueNext=null;if(b){b._timerQueuePrevious=null}return b?b.collectExpiredTimers(c,a):null}});SC.Timer.schedule=function(a){var b;if(!a||SC.none(a.isPooled)||a.isPooled){b=this.timerFromPool(a)}else{b=this.create(a)}return b.schedule()};SC.Timer.timerFromPool=function(a){var b=this._timerPool;if(!b){b=this._timerPool=[]}var c=b.pop();if(!c){c=this.create()}return c.reset(a)};SC.Timer.returnTimerToPool=function(a){if(!this._timerPool){this._timerPool=[]}this._timerPool.push(a);return this};sc_require("system/browser");SC.mixin({normalizeURL:function(a){if(a.slice(0,1)=="/"){a=window.location.protocol+"//"+window.location.host+a}else{if((a.slice(0,5)=="http:")||(a.slice(0,6)=="https:")){}else{a=window.location.href+"/"+a}}return a},isPercentage:function(a){return(a<1&&a>0)},minX:function(a){return a.x||0},maxX:function(a){return(a.x||0)+(a.width||0)},midX:function(a){return(a.x||0)+((a.width||0)/2)},minY:function(a){return a.y||0},maxY:function(a){return(a.y||0)+(a.height||0)},midY:function(a){return(a.y||0)+((a.height||0)/2)},centerX:function(b,a){return(a.width-b.width)/2},centerY:function(b,a){return(a.height-b.height)/2},offset:function(d,c){var f,b,h,a;c=c||"document";if(c==="parent"){a=jQuery(d).position()}else{a=jQuery(d).offset();if(SC.browser.isMobileSafari){f=navigator.userAgent;b=f.indexOf("Mobile/");h=f.substring(b+7,b+9);if(parseInt(SC.browser.mobileSafari,0)<=532||(h<="8A")){a.left-=window.pageXOffset;a.top-=window.pageYOffset}}if(c==="viewport"){if(SC.browser.isIE8OrLower){a.left-=$(window).scrollLeft();a.top-=$(window).scrollTop()}else{a.left-=window.pageXOffset;a.top-=window.pageYOffset}}}try{a.x=a.left;a.y=a.top}catch(g){a={x:a.left,y:a.top}}delete a.left;delete a.top;return a},viewportOffset:function(b){var a=SC.offset(b,"viewport");return{x:a.left,y:a.top}}});SC.mixin({ZERO_POINT:{x:0,y:0},pointInRect:function(a,b){return(a.x>=SC.minX(b))&&(a.y>=SC.minY(b))&&(a.x<=SC.maxX(b))&&(a.y<=SC.maxY(b))},rectsEqual:function(b,a,c){if(!b||!a){return(b==a)}if(!c&&c!==0){c=0.1}if((b.y!=a.y)&&(Math.abs(b.y-a.y)>c)){return NO}if((b.x!=a.x)&&(Math.abs(b.x-a.x)>c)){return NO}if((b.width!=a.width)&&(Math.abs(b.width-a.width)>c)){return NO}if((b.height!=a.height)&&(Math.abs(b.height-a.height)>c)){return NO}return YES},intersectRects:function(b,a){var c={x:Math.max(SC.minX(b),SC.minX(a)),y:Math.max(SC.minY(b),SC.minY(a)),width:Math.min(SC.maxX(b),SC.maxX(a)),height:Math.min(SC.maxY(b),SC.maxY(a))};c.width=Math.max(0,c.width-c.x);c.height=Math.max(0,c.height-c.y);return c},unionRects:function(b,a){var c={x:Math.min(SC.minX(b),SC.minX(a)),y:Math.min(SC.minY(b),SC.minY(a)),width:Math.max(SC.maxX(b),SC.maxX(a)),height:Math.max(SC.maxY(b),SC.maxY(a))};c.width=Math.max(0,c.width-c.x);c.height=Math.max(0,c.height-c.y);return c},cloneRect:function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}},stringFromRect:function(a){if(!a){return"(null)"}else{return"{x:"+a.x+", y:"+a.y+", width:"+a.width+", height:"+a.height+"}"}}});sc_require("panes/pane");sc_require("panes/keyboard");sc_require("panes/layout");sc_require("panes/manipulation");sc_require("panes/visibility");SC.MainPane=SC.Pane.extend({layout:{top:0,left:0,bottom:0,right:0,minHeight:200,minWidth:200},init:function(){var c={x:0,y:0,width:1000,height:1000},a=this.get("layout"),b=false;if(document&&document.body){c.width=document.body.clientWidth;c.height=document.body.clientHeight;if(a.minHeight||a.minWidth){if((a.minHeight&&c.height<a.minHeight)||(a.minWidth&&c.width<a.minWidth)){SC.bodyOverflowArbitrator.requestVisible(this)}else{SC.bodyOverflowArbitrator.requestHidden(this)}}}arguments.callee.base.apply(this,arguments)},paneDidAttach:function(){var b=arguments.callee.base.apply(this,arguments),a=this.rootResponder;a.makeMainPane(this);if(!a.get("keyRootView")){a.makeKeyPane(this)}return b},acceptsKeyPane:YES,classNames:["sc-main"]});SC.routes=SC.Object.create({wantsHistory:NO,usesHistory:null,baseURI:document.baseURI,_didSetup:NO,_location:null,_firstRoute:null,_extractParametersAndRoute:function(d,b){var a={},j=d.route||"",f,c,e,h,g,k;f=(j.indexOf("?")<0&&j.indexOf("&")>=0)?"&":"?";c=j.split(f);j=c.shift();a=this.deparam(c.join("&"),b||false);for(k in d){if(d.hasOwnProperty(k)&&k!=="route"){a[k]=""+d[k]}}a.params=f+$.param(a);a.route=j;return a},location:function(a,b){this._skipRoute=NO;return this._extractLocation(a,b)}.property(),informLocation:function(a,b){this._skipRoute=YES;var c=this.location.lastSetValueKey;if(c&&this._kvo_cache){this._kvo_cache[c]=b}return this._extractLocation(a,b)}.property(),_extractLocation:function(c,d){var a,b;if(d!==undefined){if(d===null){d=""}if(typeof(d)==="object"){a=this._extractParametersAndRoute(d);d=a.route+a.params}if(!SC.empty(d)||(this._location&&this._location!==d)){b=encodeURI(d);if(this.usesHistory){if(b.length>0){b="/"+b}window.history.pushState(null,null,this.get("baseURI")+b)}else{window.location.hash=b}}this._location=d}return this._location},ping:function(){var a;if(!this._didSetup){this._didSetup=YES;if(this.get("wantsHistory")&&SC.platform.supportsHistory){this.usesHistory=YES;this.popState();SC.Event.add(window,"popstate",this,this.popState)}else{this.usesHistory=NO;if(SC.platform.supportsHashChange){this.hashChange();SC.Event.add(window,"hashchange",this,this.hashChange)}else{a=this;this._invokeHashChange=function(){a.hashChange();setTimeout(a._invokeHashChange,100)};this._invokeHashChange()}}}},hashChange:function(a){var b=window.location.hash;b=(b&&b.length>0)?b.slice(1,b.length):"";if(!SC.browser.isMozilla){b=decodeURI(b)}if(this.get("location")!==b&&!this._skipRoute){SC.run(function(){this.set("location",b)},this)}this._skipRoute=false},popState:function(a){var b=this.get("baseURI"),c=document.location.href;if(c.slice(0,b.length)===b){c=c.slice(b.length+1,c.length);if(this.get("location")!==c&&!this._skipRoute){SC.run(function(){this.set("location",c)},this)}}this._skipRoute=false},add:function(a,b,c){if(!this._didSetup){this.invokeLast(this.ping)}if(c===undefined&&SC.typeOf(b)===SC.T_FUNCTION){c=b;b=null}else{if(SC.typeOf(c)===SC.T_STRING){c=b[c]}}if(!this._firstRoute){this._firstRoute=this._Route.create()}this._firstRoute.add(a.split("/"),b,c);return this},locationDidChange:function(){this.trigger()}.observes("location"),trigger:function(){var a=this._firstRoute,b=this.get("location"),d,c;if(a){d=this._extractParametersAndRoute({route:b});b=d.route;delete d.route;delete d.params;c=a.routeForParts(b.split("/"),d);if(c&&c.method){c.method.call(c.target||this,d)}}},deparam:function(k,g){var j={},b={"true":!0,"false":!1,"null":null},f=k.replace(/\+/g," ").split("&"),l=f.length,n,d,p,c,o,h,q,m,e=decodeURIComponent,a=Object.prototype.toString;for(n=0;n<l;++n){d=f[n].split("="),p=e(d[0]),o=j,q=p.split("]["),m=p.length-1;if(/\[/.test(q[0])&&/\]$/.test(q[m])){q[m]=q[m].replace(/\]$/,"");q=q.shift().split("[").concat(q);m=q.length-1}else{m=0}if(d.length===2){c=e(d[1]);if(g){c=c&&!isNaN(c)?+c:c==="undefined"?undefined:b[c]!==undefined?b[c]:c}if(m){for(h=0;h<m;++h){p=q[h]===""?o.length:q[h];o=o[p]=h<m?o[p]||(q[h+1]&&isNaN(q[h+1])?{}:[]):c}}else{if(a.apply(j[p])==="[object Array]"){j[p].push(c)}else{if(j[p]!==undefined){j[p]=[j[p],c]}else{j[p]=c}}}}else{if(p){j[p]=g?undefined:""}}}return j},_Route:SC.Object.extend({target:null,method:null,staticRoutes:null,dynamicRoutes:null,wildcardRoutes:null,add:function(c,b,e){var a,d;c=SC.clone(c);if(!c||c.length===0){this.target=b;this.method=e}else{a=c.shift();switch(a.slice(0,1)){case":":a=a.slice(1,a.length);if(!this.dynamicRoutes){this.dynamicRoutes={}}if(!this.dynamicRoutes[a]){this.dynamicRoutes[a]=this.constructor.create()}d=this.dynamicRoutes[a];break;case"*":a=a.slice(1,a.length);if(!this.wildcardRoutes){this.wildcardRoutes={}}d=this.wildcardRoutes[a]=this.constructor.create();break;default:if(!this.staticRoutes){this.staticRoutes={}}if(!this.staticRoutes[a]){this.staticRoutes[a]=this.constructor.create()}d=this.staticRoutes[a]}if(d){d.add(c,b,e)}}},routeForParts:function(d,e){var b,c,a;d=SC.clone(d);if(!d||d.length===0){return this.method?this:null}else{b=d.shift();if(this.staticRoutes&&this.staticRoutes[b]){return this.staticRoutes[b].routeForParts(d,e)}else{for(c in this.dynamicRoutes){a=this.dynamicRoutes[c].routeForParts(d,e);if(a){e[c]=b;return a}}for(c in this.wildcardRoutes){d.unshift(b);e[c]=d.join("/");return this.wildcardRoutes[c].routeForParts(null,e)}return null}}}})});SC.SCANNER_OUT_OF_BOUNDS_ERROR=new Error("Out of bounds.");SC.SCANNER_INT_ERROR=new Error("Not an int.");SC.SCANNER_SKIP_ERROR=new Error("Did not find the string to skip.");SC.SCANNER_SCAN_ARRAY_ERROR=new Error("Did not find any string of the given array to scan.");SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR=new Error("Can't compare the dates of two DateTimes that don't have the same timezone.");SC.DATETIME_ISO8601="%Y-%m-%dT%H:%M:%S%Z";SC.Scanner=SC.Object.extend({string:null,scanLocation:0,scan:function(a){if(this.scanLocation+a>this.length){throw SC.SCANNER_OUT_OF_BOUNDS_ERROR}var b=this.string.substr(this.scanLocation,a);this.scanLocation+=a;return b},scanInt:function(c,e){if(e===undefined){e=c}var d=this.scan(e);var b=new RegExp("^\\d{"+c+","+e+"}");var a=d.match(b);if(!a){throw SC.SCANNER_INT_ERROR}if(a[0].length<e){this.scanLocation+=a[0].length-e}return parseInt(a[0],10)},skipString:function(a){if(this.scan(a.length)!==a){throw SC.SCANNER_SKIP_ERROR}return YES},scanArray:function(c){for(var b=0,a=c.length;b<a;b++){if(this.scan(c[b].length)===c[b]){return b}this.scanLocation-=c[b].length}throw SC.SCANNER_SCAN_ARRAY_ERROR}});SC.DateTime=SC.Object.extend(SC.Freezable,SC.Copyable,{_ms:0,timezone:0,isFrozen:YES,adjust:function(b,a){var c;b=b?SC.clone(b):{};c=(b.timezone!==undefined)?b.timezone:(this.timezone!==undefined)?this.timezone:0;return this.constructor._adjust(b,this._ms,c,a)._createFromCurrentState()},advance:function(a){return this.constructor._advance(a,this._ms,this.timezone)._createFromCurrentState()},unknownProperty:function(a){return this.constructor._get(a,this._ms,this.timezone)},toFormattedString:function(a){return this.constructor._toFormattedString(a,this._ms,this.timezone)},toISO8601:function(){return this.constructor._toFormattedString(SC.DATETIME_ISO8601,this._ms,this.timezone)},toString:function(){return"UTC: "+new Date(this._ms).toUTCString()+", timezone: "+this.timezone},isEqual:function(a){return this.constructor.compare(this,a)===0},copy:function(){return this},toTimezone:function(a){if(a===undefined){a=0}return this.advance({timezone:a-this.timezone})}});SC.DateTime.mixin(SC.Comparable,{recordFormat:SC.DATETIME_ISO8601,dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],_englishDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AMPMNames:["AM","PM"],_date:new Date(),_tz:0,timezone:new Date().getTimezoneOffset(),_dt_cache:{},_dt_cache_index:-1,_DT_CACHE_MAX_LENGTH:1000,_setCalcState:function(a,c){var b={milliseconds:this._date.getTime(),timezone:this._tz};if(a!==undefined){this._date.setTime(a)}if(c!==undefined){this._tz=c}return b},_setCalcStateFromHash:function(c,b){var d=(b!==undefined)?b:this._tz;var a=this._toMilliseconds(c,this._ms,d);return this._setCalcState(a,d)},_get:function(u,b,n){var l,s,h,o,e,j,k,f,p,a;var c,i;var r=this._date;var q,g=null;q=this._setCalcState(b,n);if(u==="milliseconds"){g=r.getTime()}else{if(u==="timezone"){g=this._tz}}if(g===null){p=u.slice(0,4);a=u.slice(4);if(p==="last"||p==="next"){c=this._get("dayOfWeek",b,n);i=this._englishDayNames.indexOf(a);if(i>=0){var t=i-c;if(p==="last"&&t>=0){t-=7}if(p==="next"&&t<0){t+=7}this._advance({day:t},b,n);g=this._createFromCurrentState()}}}if(g===null){if(n!==undefined){this._setCalcState(r.getTime()-(n*60000),0)}switch(u){case"year":g=r.getUTCFullYear();break;case"month":g=r.getUTCMonth()+1;break;case"day":g=r.getUTCDate();break;case"dayOfWeek":g=r.getUTCDay();break;case"hour":g=r.getUTCHours();break;case"minute":g=r.getUTCMinutes();break;case"second":g=r.getUTCSeconds();break;case"millisecond":g=r.getUTCMilliseconds();break}if((g===null)&&(u==="isLeapYear")){e=this._get("year");g=(e%4===0&&e%100!==0)||e%400===0}if((g===null)&&(u==="daysInMonth")){switch(this._get("month")){case 4:case 6:case 9:case 11:g=30;break;case 2:g=this._get("isLeapYear")?29:28;break;default:g=31;break}}if((g===null)&&(u==="dayOfYear")){l=r.getTime();h=this._get("day");this._setCalcStateFromHash({day:1});for(o=this._get("month")-1;o>0;o--){this._setCalcStateFromHash({month:o});h+=this._get("daysInMonth")}r.setTime(l);g=h}if((g===null)&&(u.slice(0,4)==="week")){j=u.length===4?1:parseInt(u.slice("4"),10);k=this._get("dayOfWeek");f=this._get("dayOfYear")-1;if(j===0){g=parseInt((f-k+7)/7,10)}else{g=parseInt((f-(k-1+7)%7+7)/7,10)}}}this._setCalcState(q.milliseconds,q.timezone);return g},_adjust:function(c,f,e,a){var d=c?SC.clone(c):{};var b=this._toMilliseconds(c,f,e,a);this._setCalcState(b,e);return this},_advance:function(a,f,d){var c=a?SC.clone(a):{};var e;for(var b in c){c[b]+=this._get(b,f,d)}e=(c.timezone!==undefined)?c.timezone:d;return this._adjust(c,f,e,NO)},_toMilliseconds:function(j,c,h,f){var a=j?SC.clone(j):{};var i=this._date;var g=i.getTime();var b,e;if(!SC.none(c)){i.setTime(c)}e=(h!==undefined)?h:(this.timezone!==undefined)?this.timezone:0;i.setTime(i.getTime()-(e*60000));if(f===undefined||f===YES){if(!SC.none(a.hour)&&SC.none(a.minute)){a.minute=0}if(!(SC.none(a.hour)&&SC.none(a.minute))&&SC.none(a.second)){a.second=0}if(!(SC.none(a.hour)&&SC.none(a.minute)&&SC.none(a.second))&&SC.none(a.millisecond)){a.millisecond=0}}if(SC.none(a.year)){a.year=i.getUTCFullYear()}if(SC.none(a.month)){a.month=i.getUTCMonth()+1}if(SC.none(a.day)){a.day=i.getUTCDate()}if(SC.none(a.hour)){a.hour=i.getUTCHours()}if(SC.none(a.minute)){a.minute=i.getUTCMinutes()}if(SC.none(a.second)){a.second=i.getUTCSeconds()}if(SC.none(a.millisecond)){a.millisecond=i.getUTCMilliseconds()}b=Date.UTC(a.year,a.month-1,a.day,a.hour,a.minute,a.second,a.millisecond);i.setTime(b+(e*60000));b=i.getTime();i.setTime(g);return b},create:function(){var i=arguments.length===0?{}:arguments[0];var d;if(SC.typeOf(i)===SC.T_NUMBER){i={milliseconds:i}}d=(i.timezone!==undefined)?i.timezone:this.timezone;if(d===undefined){d=0}if(!SC.none(i.milliseconds)){var h="nu"+i.milliseconds+d,a=this._dt_cache;var e=a[h];if(!e){var f,g=this._dt_cache_index,b=this;e=a[h]=new b([{_ms:i.milliseconds,timezone:d}]);g=this._dt_cache_index=(g+1)%this._DT_CACHE_MAX_LENGTH;f=a[g];if(f!==undefined&&a[f]){delete a[f]}a[g]=h}return e}else{var c=new Date();return this.create({milliseconds:this._toMilliseconds(i,c.getTime(),d,i.resetCascadingly),timezone:d})}},_createFromCurrentState:function(){return this.create({milliseconds:this._date.getTime(),timezone:this._tz})},parse:function(o,c){var p=new RegExp("(?:%([aAbBcdDhHiIjmMpsSUWwxXyYZ%])|(.))","g");var n,j,a={},b={},i=SC.Scanner.create({string:o});if(SC.none(c)){c=SC.DATETIME_ISO8601}try{while((j=p.exec(c))!==null){switch(j[1]){case"a":b.dayOfWeek=i.scanArray(this.abbreviatedDayNames);break;case"A":b.dayOfWeek=i.scanArray(this.dayNames);break;case"b":a.month=i.scanArray(this.abbreviatedMonthNames)+1;break;case"B":a.month=i.scanArray(this.monthNames)+1;break;case"c":throw"%c is not implemented";case"d":case"D":a.day=i.scanInt(1,2);break;case"h":case"H":a.hour=i.scanInt(1,2);break;case"i":case"I":a.hour=i.scanInt(1,2);break;case"j":throw"%j is not implemented";case"m":a.month=i.scanInt(1,2);break;case"M":a.minute=i.scanInt(1,2);break;case"p":a.meridian=i.scanArray(this.AMPMNames);break;case"S":a.second=i.scanInt(1,2);break;case"s":a.millisecond=i.scanInt(1,3);break;case"U":throw"%U is not implemented";case"W":throw"%W is not implemented";case"w":throw"%w is not implemented";case"x":throw"%x is not implemented";case"X":throw"%X is not implemented";case"y":a.year=i.scanInt(2);a.year+=(a.year>70?1900:2000);break;case"Y":a.year=i.scanInt(4);break;case"Z":var g=i.scan(1);if(g==="Z"){a.timezone=0}else{if(g==="+"||g==="-"){var k=i.scanInt(2);if(i.scan(1)!==":"){i.scan(-1)}var f=i.scanInt(2);a.timezone=(g==="+"?-1:1)*(k*60+f)}}break;case"%":i.skipString("%");break;default:i.skipString(j[0]);break}}}catch(l){SC.Logger.log("SC.DateTime.createFromString "+l.toString());return null}if(!SC.none(a.meridian)&&!SC.none(a.hour)){if((a.meridian===1&&a.hour!==12)||(a.meridian===0&&a.hour===12)){a.hour=(a.hour+12)%24}delete a.meridian}n=this.create(a);if(!SC.none(b.dayOfWeek)&&n.get("dayOfWeek")!==b.dayOfWeek){return null}return n},_pad:function(b,a){var c=""+b;if(a===undefined){a=2}while(c.length<a){c="0"+c}return c},__toFormattedString:function(b,e,c){var a,d;switch(b[1]){case"a":return this.abbreviatedDayNames[this._get("dayOfWeek")];case"A":return this.dayNames[this._get("dayOfWeek")];case"b":return this.abbreviatedMonthNames[this._get("month")-1];case"B":return this.monthNames[this._get("month")-1];case"c":return this._date.toString();case"d":return this._pad(this._get("day"));case"D":return this._get("day");case"h":return this._get("hour");case"H":return this._pad(this._get("hour"));case"i":a=this._get("hour");return(a===12||a===0)?12:(a+12)%12;case"I":a=this._get("hour");return this._pad((a===12||a===0)?12:(a+12)%12);case"j":return this._pad(this._get("dayOfYear"),3);case"m":return this._pad(this._get("month"));case"M":return this._pad(this._get("minute"));case"p":return this._get("hour")>11?this.AMPMNames[1]:this.AMPMNames[0];case"S":return this._pad(this._get("second"));case"s":return this._pad(this._get("millisecond"),3);case"u":return this._pad(this._get("utc"));case"U":return this._pad(this._get("week0"));case"W":return this._pad(this._get("week1"));case"w":return this._get("dayOfWeek");case"x":return this._date.toDateString();case"X":return this._date.toTimeString();case"y":return this._pad(this._get("year")%100);case"Y":return this._get("year");case"Z":d=-1*c;return(d>=0?"+":"-")+this._pad(parseInt(Math.abs(d)/60,10))+":"+this._pad(Math.abs(d)%60);case"%":return"%"}},_toFormattedString:function(c,e,b){var a=this;var d=(b!==undefined)?b:(this.timezone!==undefined)?this.timezone:0;this._setCalcState(e-(b*60000),0);return c.replace(/\%([aAbBcdDhHiIjmMpsSUWwxXyYZ\%])/g,function(){var f=a.__toFormattedString.call(a,arguments,e,b);return f})},compare:function(d,c){var f=d.get("milliseconds");var e=c.get("milliseconds");return f<e?-1:f===e?0:1},compareDate:function(d,c){if(d.get("timezone")!==c.get("timezone")){throw SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR}var f=d.adjust({hour:0}).get("milliseconds");var e=c.adjust({hour:0}).get("milliseconds");return f<e?-1:f===e?0:1}});SC.Binding.dateTime=function(a){return this.transform(function(b,c){return b?b.toFormattedString(a):null})};SC.stringsFor("English",{"_SC.DateTime.dayNames":"Sunday Monday Tuesday Wednesday Thursday Friday Saturday","_SC.DateTime.abbreviatedDayNames":"Sun Mon Tue Wed Thu Fri Sat","_SC.DateTime.monthNames":"January February March April May June July August September October November December","_SC.DateTime.abbreviatedMonthNames":"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec","_SC.DateTime.AMPMNames":"AM PM"});SC.DateTime.mixin({_setup:function(){SC.DateTime.dayNames=SC.String.w(SC.String.loc("_SC.DateTime.dayNames"));SC.DateTime.abbreviatedDayNames=SC.String.w(SC.String.loc("_SC.DateTime.abbreviatedDayNames"));SC.DateTime.monthNames=SC.String.w(SC.String.loc("_SC.DateTime.monthNames"));SC.DateTime.abbreviatedMonthNames=SC.String.w(SC.String.loc("_SC.DateTime.abbreviatedMonthNames"));SC.DateTime.AMPMNames=SC.String.w(SC.String.loc("_SC.DateTime.AMPMNames"))}});jQuery(document).ready(function(){SC.DateTime._setup()});SC.Response=SC.Object.extend({isResponse:YES,isError:NO,errorValue:function(){return this}.property().cacheable(),errorObject:null,request:null,originalRequest:function(){var a=this.get("request");while(a.get("source")){a=a.get("source")}return a}.property("request").cacheable(),type:function(){return this.getPath("request.type")}.property("request").cacheable(),address:function(){return this.getPath("request.address")}.property("request").cacheable(),isJSON:function(){return this.getPath("request.isJSON")||NO}.property("request").cacheable(),isXML:function(){return this.getPath("request.isXML")||NO}.property("request").cacheable(),listeners:function(){return this.getPath("request.listeners")}.property("request").cacheable(),status:-100,headers:null,body:function(){var a=this.get("encodedBody");if(a&&this.get("isJSON")){try{a=SC.json.decode(a)}catch(b){return SC.Error.create({message:b.name+": "+b.message,label:"Response",errorValue:this})}}return a}.property("encodedBody").cacheable(),response:function(){return this.get("body")}.property("body").cacheable(),isCancelled:NO,timedOut:null,timeoutTimer:null,fire:function(){var a=this.get("request"),c=a?a.get("source"):null;if(c&&c.willSend){c.willSend(a,this)}a.freeze();if(!this.get("isCancelled")){this.invokeTransport()}var b=a.get("timeout");if(b){var d=SC.Timer.schedule({target:this,action:"timeoutReached",interval:b,repeats:NO});this.set("timeoutTimer",d)}if(!this.get("isCancelled")&&c&&c.didSend){c.didSend(a,this)}},invokeTransport:function(){this.receive(function(a){this.set("status",200)},this)},receive:function(e,a){if(!this.get("timedOut")){var d=this.get("timeoutTimer");if(d){d.invalidate()}this.set("timedOut",NO)}var b=this.get("request");var c=b?b.get("source"):null;SC.run(function(){if(c&&c.willReceive){c.willReceive(b,this)}e.call(a,!this.get("isCancelled"));if(!this.get("isCancelled")&&c&&c.didReceive){c.didReceive(b,this)}if(!this.get("isCancelled")){this.notify()}},this);SC.Request.manager.transportDidClose(this);return this},cancel:function(){if(!this.get("isCancelled")){this.set("isCancelled",YES);this.cancelTransport();SC.Request.manager.transportDidClose(this)}},timeoutReached:function(){if(this.get("timedOut")===null){this.set("timedOut",YES);this.cancelTransport();this.receive(function(b){if(!b){return}var a=SC.$error("HTTP Request timed out","Request",0);a.set("errorValue",this);this.set("isError",YES);this.set("errorObject",a);this.set("status",0)},this);return YES}return NO},cancelTransport:function(){},_notifyListeners:function(h,b){var j=h[b],g,f,a;if(!j){return NO}var d=NO;var e=j.length;for(var c=0;c<e;c++){var k=j[c];g=(k.args||[]).copy();g.unshift(this);f=k.target;a=k.action;if(SC.typeOf(a)===SC.T_STRING){a=f[a]}d=a.apply(f,g)}return d},notify:function(){var b=this.get("listeners"),a=this.get("status"),c=Math.floor(a/100)*100,d=NO;if(!b){return this}d=this._notifyListeners(b,a);if(!d&&c!==a){d=this._notifyListeners(b,c)}if(!d&&a!==0){d=this._notifyListeners(b,0)}return this},toString:function(){var a=arguments.callee.base.apply(this,arguments);return"%@<%@ %@, status=%@".fmt(a,this.get("type"),this.get("address"),this.get("status"))}});SC.XHRResponse=SC.Response.extend({headers:function(){var c=this.get("rawRequest"),b=c?c.getAllResponseHeaders():null,a={};if(!b){return a}b.split("\n").forEach(function(g){var d=g.indexOf(":"),e,f;if(d>=0){e=g.slice(0,d);f=g.slice(d+1).trim();a[e]=f}},this);return a}.property("status").cacheable(),header:function(a){var b=this.get("rawRequest");return b?b.getResponseHeader(a):null},encodedBody:function(){var a=this.get("rawRequest");if(!a){return null}if(this.get("isXML")){return a.responseXML}return a.responseText}.property("status").cacheable(),cancelTransport:function(){var a=this.get("rawRequest");if(a){a.abort()}this.set("rawRequest",null)},invokeTransport:function(){var d,n,b,g,h=this.get("request"),e,a,f,c;g=this.createRequest();this.set("rawRequest",g);f=!!h.get("isAsynchronous");if(f){if(window.XMLHttpRequestProgressEvent){n=h.get("listeners");if(n){for(var o in n){if(isNaN(parseInt(o,10))){b=n[o];for(var k=0,l=b.length;k<l;k++){d=b[k];var m=o.split(".");if(SC.none(m[1])){SC.Event.add(g,m[0],d.target,d.action,d.args)}else{SC.Event.add(g[m[0]],m[1],d.target,d.action,d.args)}}}}}SC.Event.add(g,"loadend",this,this.finishRequest)}else{if(window.XMLHttpRequest){SC.Event.add(g,"readystatechange",this,this.finishRequest)}else{e=this;a=function(){if(!e){return null}var i=e.finishRequest();if(i){e=null}return i};g.onreadystatechange=a}}}g.open(this.get("type"),this.get("address"),f);c=this.getPath("request.headers");for(var j in c){g.setRequestHeader(j,c[j])}g.send(this.getPath("request.encodedBody"));if(!f){this.finishRequest()}return g},createRequest:function(){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{try{a=new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(b){}try{if(!a){a=new ActiveXObject("MSXML2.XMLHTTP")}}catch(b){}}return a},finishRequest:function(o){var c,l,a,e=this.get("rawRequest"),h=e.readyState,f,m,d,b;if(h===4&&!this.get("timedOut")){this.receive(function(i){if(!i){return}d=-1;try{d=e.status||0}catch(q){}if((d<200)||(d>=300)){try{b=e.statusText||""}catch(p){b=""}m=SC.$error(b||"HTTP Request failed","Request",d);m.set("errorValue",this);this.set("isError",YES);this.set("errorObject",m)}this.set("status",d)},this);if(window.XMLHttpRequestProgressEvent){SC.Event.remove(e,"loadend",this,this.finishRequest);f=this.get("request");l=f.get("listeners");if(l){for(var n in l){if(isNaN(parseInt(n,10))){a=l[n];for(var g=0,j=a.length;g<j;g++){c=a[g];var k=n.split(".");if(SC.none(k[1])){SC.Event.remove(e,k[0],c.target,c.action,c.args)}else{SC.Event.remove(e[k[0]],k[1],c.target,c.action,c.args)}}}}}}else{if(window.XMLHttpRequest){SC.Event.remove(e,"readystatechange",this,this.finishRequest)}else{e.onreadystatechange=null}}return YES}return NO}});sc_require("system/response");SC.Request=SC.Object.extend(SC.Copyable,SC.Freezable,{isAsynchronous:YES,isJSON:NO,isXML:NO,attachIdentifyingHeaders:YES,headers:function(){var a=this._headers;if(!a){a=this._headers={}}return a}.property().cacheable(),responseClass:SC.XHRResponse,source:null,address:null,type:"GET",timeout:null,body:null,encodedBody:function(){var a=this.get("body");if(a&&this.get("isJSON")){a=SC.json.encode(a)}return a}.property("isJSON","isXML","body").cacheable(),willSend:function(b,a){},didSend:function(b,a){},willReceive:function(b,a){},didReceive:function(b,a){},concatenatedProperties:"COPY_KEYS",COPY_KEYS:["attachIdentifyingHeaders","isAsynchronous","isJSON","isXML","address","type","timeout","body","responseClass","willSend","didSend","willReceive","didReceive"],copy:function(){var a={},d=this.COPY_KEYS,f=d.length,b,c,e;while(--f>=0){b=d[f];if(this.hasOwnProperty(b)){a[b]=this.get(b)}}if(this.hasOwnProperty("listeners")){a.listeners=SC.copy(this.get("listeners"))}if(this.hasOwnProperty("_headers")){a._headers=SC.copy(this._headers)}a.source=this.get("source")||this;return this.constructor.create(a)},header:function(a,b){var d,c;if(SC.typeOf(a)===SC.T_STRING){c=this._headers;if(arguments.length===1){return c?c[a]:null}else{this.propertyWillChange("headers");if(!c){c=this._headers={}}c[a]=b;this.propertyDidChange("headers");return this}}else{if(b===undefined){c=a;this.beginPropertyChanges();for(d in c){if(!c.hasOwnProperty(d)){continue}this.header(d,c[d])}this.endPropertyChanges();return this}}return this},clearHeaders:function(){this.propertyWillChange("headers");this._headers={};this.propertyDidChange("headers")},async:function(a){if(a===undefined){a=YES}return this.set("isAsynchronous",a)},timeoutAfter:function(a){return this.set("timeout",a)},json:function(a){if(a===undefined){a=YES}if(a){this.set("isXML",NO)}return this.set("isJSON",a)},xml:function(a){if(a===undefined){a=YES}if(a){this.set("isJSON",NO)}return this.set("isXML",a)},_prep:function(){var a=!!this.header("Content-Type");if(this.get("attachIdentifyingHeaders")){this.header("X-Requested-With","XMLHttpRequest");this.header("X-SproutCore-Version",SC.VERSION)}if(!a&&!!this.get("body")){if(this.get("isJSON")){this.header("Content-Type","application/json")}else{if(this.get("isXML")){this.header("Content-Type","text/xml")}}}return this},send:function(a){var b=this.get("timeout");if(b&&!this.get("isAsynchronous")){throw"Timeout values cannot be used with synchronous requests"}else{if(b===0){throw"The timeout value must either not be specified or must be greater than 0"}}if(a){this.set("body",a)}return SC.Request.manager.sendRequest(this.copy()._prep())},resend:function(){var a=this.get("source")?this:this.copy()._prep();return SC.Request.manager.sendRequest(a)},notify:function(e,d,c){var a;if(SC.typeOf(e)!==SC.T_NUMBER&&SC.typeOf(e)!==SC.T_STRING){a=SC.A(arguments).slice(2);c=d;d=e;e=0}else{a=SC.A(arguments).slice(3)}var b=this.get("listeners");if(!b){this.set("listeners",b={})}if(!b[e]){b[e]=[]}b[e].push({target:d,action:c,args:a});return this}});SC.Request.mixin({getUrl:function(a){return this.create().set("address",a).set("type","GET")},postUrl:function(b,a){var c=this.create().set("address",b).set("type","POST");if(a){c.set("body",a)}return c},deleteUrl:function(a){return this.create().set("address",a).set("type","DELETE")},putUrl:function(b,a){var c=this.create().set("address",b).set("type","PUT");if(a){c.set("body",a)}return c},patchUrl:function(b,a){var c=this.create().set("address",b).set("type","PATCH");if(a){c.set("body",a)}return c}});SC.Request.manager=SC.Object.create({maxRequests:6,inflight:[],pending:[],sendRequest:function(b){if(!b){return null}var a=b.get("responseClass").create({request:b});this.get("pending").pushObject(a);this.fireRequestIfNeeded();return a},cancel:function(b){var d=this.get("pending"),c=this.get("inflight"),a;if(d.indexOf(b)>=0){this.propertyWillChange("pending");d.removeObject(b);this.propertyDidChange("pending");return YES}else{if(c.indexOf(b)>=0){b.cancel();c.removeObject(b);this.fireRequestIfNeeded();return YES}}return NO},cancelAll:function(){if(this.get("pending").length||this.get("inflight").length){this.set("pending",[]);this.get("inflight").forEach(function(a){a.cancel()});this.set("inflight",[]);return YES}return NO},fireRequestIfNeeded:function(){var d=this.get("pending"),c=this.get("inflight"),a=this.get("maxRequests"),b;if((d.length>0)&&(c.length<a)){b=d.shiftObject();c.pushObject(b);b.fire()}},transportDidClose:function(a){this.get("inflight").removeObject(a);this.fireRequestIfNeeded()}});SC.FOCUS_ALL_CONTROLS=NO;SC.ready(function(){var a=SC.SAFARI_FOCUS_BEHAVIOR;if(a!==null&&a!==undefined){SC.FOCUS_ALL_CONTROLS=SC.SAFARI_FOCUS_BEHAVIOR}});SC.TreeItemContent={isTreeItemContent:YES,treeItemChildren:null,treeItemIsExpanded:YES,treeItemIsGrouped:NO,treeItemDisclosureState:function(b,a){return this.get("treeItemIsExpanded")?SC.BRANCH_OPEN:SC.BRANCH_CLOSED},treeItemCollapse:function(b,a){this.setIfChanged("treeItemIsExpanded",NO)},treeItemExpand:function(b,a){this.setIfChanged("treeItemIsExpanded",YES)},treeItemBranchIndexes:function(e,c){var d=this.get("treeItemChildren"),b,g,a,f;if(!d){return null}b=SC.IndexSet.create();g=d.get("length");for(a=0;a<g;a++){if(!(f=d.objectAt(a))){continue}if(!f.get("treeItemChildren")){continue}if(f.treeItemDisclosureState(this,a)!==SC.LEAF_NODE){b.add(a)}}return b.get("length")>0?b:null}};SC.BRANCH_OPEN=17;SC.BRANCH_CLOSED=18;SC.LEAF_NODE=32;SC.CollectionContent={isCollectionContent:YES,contentIndexIsSelected:function(b,c,a){var d=b.get("selection");return d?d.contains(c,a):NO},contentIndexIsEnabled:function(b,c,a){return b.get("isEnabled")},contentGroupIndexes:function(a,b){return null},contentIndexIsGroup:function(b,c,a){return NO},contentIndexOutlineLevel:function(b,c,a){return -1},contentIndexDisclosureState:function(b,c,a){return SC.LEAF_NODE},contentIndexExpand:function(b,c,a){SC.Logger.log("contentIndexExpand(%@, %@, %@)".fmt(b,c,a))},contentIndexCollapse:function(b,c,a){SC.Logger.log("contentIndexCollapse(%@, %@, %@)".fmt(b,c,a))}};sc_require("mixins/tree_item_content");sc_require("mixins/collection_content");SC.TreeItemObserver=SC.Object.extend(SC.Array,SC.CollectionContent,{item:null,delegate:null,parentObserver:null,parentItem:function(){var a=this.get("parentObserver");return a?a.get("item"):null}.property("parentObserver").cacheable(),index:null,outlineLevel:0,children:null,disclosureState:SC.BRANCH_OPEN,branchIndexes:function(){var e=this.get("item"),b,f,a,d,c;if(!e){return SC.IndexSet.EMPTY}else{if(e.isTreeItemContent){f=this.get("parentItem");a=this.get("index");return e.treeItemBranchIndexes(f,a)}else{d=this.get("children");if(!d){return null}c=SC.IndexSet.create();b=d.get("length");f=e;for(a=0;a<b;a++){if(!(e=d.objectAt(a))){continue}if(!this._computeChildren(e,f,a)){continue}if(this._computeDisclosureState(e,f,a)!==SC.LEAF_NODE){c.add(a)}}return c.get("length")>0?c:null}}}.property("children").cacheable(),isHeaderVisible:function(){return !!this.get("parentObserver")}.property("parentObserver").cacheable(),length:0,objectAt:function(f,c){var g=this.get("length"),i=this.get("item"),a=this._objectAtCache,h=f,e=0,d,b;if(f>=g){return undefined}if(this.get("isHeaderVisible")){if(f===0){return i}else{h--}}i=null;if(!a){a=this._objectAtCache=[]}if((i=a[f])!==undefined){return i}b=this.get("children");if(!b){return undefined}if(d=this.get("branchIndexes")){d.forEach(function(l){if(i||(l>h)){return}var k=this.branchObserverAt(l),j;if(!k){return}j=k.get("length");if(l+j>h){i=k.objectAt(h-l,c);h=-1}else{h-=j-1}},this)}if(h>=0){i=b.objectAt(h,c)}a[f]=i;return i},replace:function(a,b,j,d){var i=a,g=null,e,f,h;if(d===undefined){d=SC.DROP_BEFORE}if(this.get("isHeaderVisible")){i--}if(i<0){throw"Tree Item cannot replace itself"}if(e=this.get("branchIndexes")){e.forEach(function(k){if(g||(k>=i)){return}if(!(g=this.branchObserverAt(k))){return}f=g.get("length");if((k+f===i)&&d===SC.DROP_AFTER){i-=k}else{if(k+f>i){i-=k}else{i-=f-1;g=null}}},this)}if(g){g.replace(i,b,j,d);return this}h=i+b;if(b>1&&e){e.forEachIn(i,e.get("max")-i,function(k){if(k>h){return}if(!(g=this.branchObserverAt(k))){return}f=g.get("length");h-=f-1},this)}b=h-i;var c=this.get("children");if(!c){throw"cannot replace() tree item with no children"}if((b<0)||(h>c.get("length"))){throw"replace() range must lie within a single tree item"}c.replace(i,b,j,d);return this},observerContentDidChange:function(b,c,i){this.invalidateBranchObserversAt(b);this._objectAtCache=this._outlineLevelCache=null;this._disclosureStateCache=null;this._contentGroupIndexes=NO;this.notifyPropertyChange("branchIndexes");var d=this.get("length"),e=this._computeLength(),g=this.get("parentObserver"),f;if(d!==e){this.set("length",e)}if(!this._notifyParent){return this}if(g){f=SC.IndexSet.create(this.get("index"));g._childrenRangeDidChange(g.get("children"),null,"[]",f)}else{if(d===e){c=this.expandChildIndex(b+c);b=this.expandChildIndex(b);c=c-b;i=0}else{b=this.expandChildIndex(b);c=e-b;i=e-d}var h=c;var a=i+h;this.arrayContentDidChange(b,h,a)}},expandChildIndex:function(c){var b=c;if(this.get("isHeaderVisible")){c++}var a=this.get("branchIndexes");if(!a||a.get("length")===0){return b}a.forEachIn(0,c,function(d){b+=this.branchObserverAt(d).get("length")-1},this);return b},_contentGroupIndexes:NO,contentGroupIndexes:function(a,e){if(e!==this){return null}var c=this._contentGroupIndexes;if(c!==NO){return c}if(this.get("parentObserver")){return null}var d=this.get("item"),g,b,h,f;if(d&&d.isTreeItemContent){g=d.get("treeItemIsGrouped")}else{g=!!this.delegate.get("treeItemIsGrouped")}if(g){c=SC.IndexSet.create();b=this.get("branchIndexes");if(b){h=b.min();f=0;b.forEach(function(k){c.add(k+f,1);var j=this.branchObserverAt(k);if(j){f+=j.get("length")-1;h+=f}},this)}}else{c=null}this._contentGroupIndexes=c;return c},contentIndexIsGroup:function(b,d,a){var c=this.contentGroupIndexes(b,d);return c?c.contains(a):NO},contentIndexOutlineLevel:function(j,g,e){if(g!==this){return -1}var a=this._outlineLevelCache;if(a&&(a[e]!==undefined)){return a[e]}if(!a){a=this._outlineLevelCache=[]}var f=this.get("length"),k=e,d=0,h=null,c,b,i;if(e>=f){return -1}if(this.get("isHeaderVisible")){if(e===0){return a[0]=this.get("outlineLevel")-1}else{k--}}if(c=this.get("branchIndexes")){c.forEach(function(n){if((h!==null)||(n>k)){return}var m=this.branchObserverAt(n),l;if(!m){return}l=m.get("length");if(n+l>k){h=m.contentIndexOutlineLevel(j,m,k-n);k=-1}else{k-=l-1}},this)}if(k>=0){h=this.get("outlineLevel")}a[e]=h;return h},contentIndexDisclosureState:function(j,g,e){if(g!==this){return -1}var a=this._disclosureStateCache;if(a&&(a[e]!==undefined)){return a[e]}if(!a){a=this._disclosureStateCache=[]}var f=this.get("length"),k=e,d=0,h=null,c,b,i;if(e>=f){return SC.LEAF_NODE}if(this.get("isHeaderVisible")){if(e===0){return a[0]=this.get("disclosureState")}else{k--}}if(c=this.get("branchIndexes")){c.forEach(function(n){if((h!==null)||(n>k)){return}var m=this.branchObserverAt(n),l;if(!m){return}l=m.get("length");if(n+l>k){h=m.contentIndexDisclosureState(j,m,k-n);k=-1}else{k-=l-1}},this)}if(k>=0){h=SC.LEAF_NODE}a[e]=h;return h},contentIndexExpand:function(b,f,a){var c,g=a,d,e;if(f!==this){return}if(this.get("isHeaderVisible")){if(a===0){this._expand(this.get("item"));return}else{g--}}if(c=this.get("branchIndexes")){c.forEach(function(k){if(k>=g){return}var j=this.branchObserverAt(k),h;if(!j){return}h=j.get("length");if(k+h>g){j.contentIndexExpand(b,j,g-k);g=-1}else{g-=h-1}},this)}if(g>=0){d=this.get("children");e=d?d.objectAt(g):null;if(e){this._expand(e,this.get("item"),g)}}},contentIndexCollapse:function(b,f,a){var c,d,e,g=a;if(f!==this){return}if(this.get("isHeaderVisible")){if(a===0){this._collapse(this.get("item"));return}else{g--}}if(c=this.get("branchIndexes")){c.forEach(function(k){if(k>=g){return}var j=this.branchObserverAt(k),h;if(!j){return}h=j.get("length");if(k+h>g){j.contentIndexCollapse(b,j,g-k);g=-1}else{g-=h-1}},this)}if(g>=0){d=this.get("children");e=d?d.objectAt(g):null;if(e){this._collapse(e,this.get("item"),g)}}},branchObserverAt:function(d){var g=this._branchObserversByIndex,c=this._branchObserverIndexes,e,h,b,j,a,f,i;if(!g){g=this._branchObserversByIndex=[]}if(!c){c=this._branchObserverIndexes=SC.IndexSet.create()}if(e=g[d]){return e}a=this.get("children");j=a?a.objectAt(d):null;if(!j){return null}g[d]=e=SC.TreeItemObserver.create({item:j,delegate:this.get("delegate"),parentObserver:this,index:d,outlineLevel:this.get("outlineLevel")+1});c.add(d);return e},invalidateBranchObserversAt:function(c){var b=this._branchObserversByIndex,a=this._branchObserverIndexes;if(!b||b.length<=c){return this}if(c<0){c=0}a.forEachIn(c,a.get("max")-c,function(e){var d=b[e];if(d){d.destroy()}},this);b.length=c;return this},init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("item");if(!a){throw"SC.TreeItemObserver.item cannot be null"}a.addObserver("*",this,this._itemPropertyDidChange);this._itemPropertyDidChange(a,"*");this._notifyParent=YES},destroy:function(){this.invalidateBranchObserversAt(0);this._objectAtCache=null;this._notifyParent=NO;var c=this.get("item");if(c){c.removeObserver("*",this,this._itemPropertyDidChange)}var a=this._children,b=this._childrenRangeObserver;if(a&&b){a.removeRangeObserver(b)}this.set("length",0);arguments.callee.base.apply(this,arguments)},_itemPropertyDidChange:function(f,b){var a=this.get("children"),e=this.get("disclosureState"),d=this.get("item"),c;this.beginPropertyChanges();c=this._computeDisclosureState(d);if(e!==c){this.set("disclosureState",c)}c=this._computeChildren(d);if(a!==c){this.set("children",c)}this.endPropertyChanges()},_childrenDidChange:function(){var c=this.get("disclosureState"),d=c===SC.BRANCH_OPEN?this.get("children"):null,b=this._children,a=this._childrenRangeObserver;if(b===d){return this}if(a){b.removeRangeObserver(a)}if(d){this._childrenRangeObserver=d.addRangeObserver(null,this,this._childrenRangeDidChange)}else{this._childrenRangeObserver=null}this._children=d;this._childrenRangeDidChange(d,null,"[]",null)}.observes("children","disclosureState"),_childrenRangeDidChange:function(f,i,h,d){var a=this.get("children"),e=a?a.get("length"):0,c=d?d.get("min"):0,g=d?d.get("max"):e,b=this._childrenLen||0;this._childrenLen=e;this.observerContentDidChange(c,g-c,e-b)},_computeDisclosureState:function(d,e,b){var c,a;if(!d||!this._computeChildren(d)){return SC.LEAF_NODE}else{if(d.isTreeItemContent){if(e===undefined){e=this.get("parentItem")}if(b===undefined){b=this.get("index")}return d.treeItemDisclosureState(e,b)}else{c=this._treeItemIsExpandedKey;if(!c){a=this.get("delegate");c=a?a.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=c}return d.get(c)?SC.BRANCH_OPEN:SC.BRANCH_CLOSED}}},_collapse:function(d,e,b){var c,a;if(!d||!this._computeChildren(d)){return this}else{if(d.isTreeItemContent){if(e===undefined){e=this.get("parentItem")}if(b===undefined){b=this.get("index")}d.treeItemCollapse(e,b)}else{c=this._treeItemIsExpandedKey;if(!c){a=this.get("delegate");c=a?a.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=c}d.setIfChanged(c,NO)}}return this},_expand:function(d,e,b){var c,a;if(!d||!this._computeChildren(d)){return this}else{if(d.isTreeItemContent){if(e===undefined){e=this.get("parentItem")}if(b===undefined){b=this.get("index")}d.treeItemExpand(e,b)}else{c=this._treeItemIsExpandedKey;if(!c){a=this.get("delegate");c=a?a.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=c}d.setIfChanged(c,YES)}}return this},_computeChildren:function(c){var a,b;if(!c){return null}else{if(c.isTreeItemContent){return c.get("treeItemChildren")}else{b=this._treeItemChildrenKey;if(!b){a=this.get("delegate");b=a?a.get("treeItemChildrenKey"):"treeItemChildren";this._treeItemChildrenKey=b}return c.get(b)}}},_computeLength:function(){var b=this.get("isHeaderVisible")?1:0,d=this.get("disclosureState"),c=this.get("children"),a;if((d===SC.BRANCH_OPEN)&&c){b+=c.get("length");if(a=this.get("branchIndexes")){a.forEach(function(e){var f=this.branchObserverAt(e);b+=f.get("length")-1},this)}}return b}});sc_require("private/tree_item_observer");SC.TreeController=SC.ObjectController.extend(SC.SelectionSupport,{treeItemIsGrouped:NO,treeItemIsExpandedKey:"treeItemIsExpanded",treeItemChildrenKey:"treeItemChildren",arrangedObjects:function(){var a,b=this.get("content");if(b){a=SC.TreeItemObserver.create({item:b,delegate:this});a.bind("allowsSelection",this,"allowsSelection");a.bind("allowsMultipleSelection",this,"allowsMultipleSelection");a.bind("allowsEmptySelection",this,"allowsEmptySelection")}else{a=null}this._sctc_arrangedObjects=a;return a}.property().cacheable(),_sctc_invalidateArrangedObjects:function(){this.propertyWillChange("arrangedObjects");var a=this._sctc_arrangedObjects;if(a){a.destroy()}this._sctc_arrangedObjects=null;this.propertyDidChange("arrangedObjects")}.observes("content","treeItemIsExpandedKey","treeItemChildrenKey","treeItemIsGrouped"),_sctc_arrangedObjectsContentDidChange:function(){this.updateSelectionAfterContentChange()}.observes("*arrangedObjects.[]"),canSelectGroups:NO,firstSelectableObject:function(){var d=this.get("arrangedObjects"),c,b,a=0;if(!d){return null}if(this.get("canSelectGroups")){return d.get("firstObject")}c=d.contentGroupIndexes(null,d);b=d.get("length");while(c.contains(a)&&(a<b)){a++}return a>=b?null:d.objectAt(a)}.property()});SC.InlineTextFieldDelegate={editor:null,acquireEditor:function(a){var b=this.editor;if(b){if(b.get("isEditing")&&!b.commitEditing()&&!b.discardEditing()){return null}this.releaseEditor(b)}var c=a.exampleEditor?a.exampleEditor:SC.InlineTextFieldView,d=a.get("pane");b=this.editor=d.createChildView(c,{inlineEditorDelegate:this});d.appendChild(b);return b},releaseEditor:function(a){a.removeFromParent();this.editor=null;return YES}};SC.STRING_TITLEIZE_REGEXP=(/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g);SC.STRING_HUMANIZE_REGEXP=(/[\-_]/g);SC.STRING_REGEXP_ESCAPED_REGEXP=(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g);SC.STRING_DASHERIZE_CACHE={top:"top",left:"left",right:"right",bottom:"bottom",width:"width",height:"height",minWidth:"min-width",maxWidth:"max-width"};SC.INFLECTION_CONSTANTS={PLURAL:[[/(quiz)$/i,"$1zes"],[/^(ox)$/i,"$1en"],[/([m|l])ouse$/i,"$1ice"],[/(matr|vert|ind)ix|ex$/i,"$1ices"],[/(x|ch|ss|sh)$/i,"$1es"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(hive)$/i,"$1s"],[/(?:([^f])fe|([lr])f)$/i,"$1$2ves"],[/sis$/i,"ses"],[/([ti])um$/i,"$1a"],[/(buffal|tomat)o$/i,"$1oes"],[/(bu)s$/i,"$1ses"],[/(alias|status)$/i,"$1es"],[/(octop|vir)us$/i,"$1i"],[/(ax|test)is$/i,"$1es"],[/s$/i,"s"],[/$/,"s"]],SINGULAR:[[/(quiz)zes$/i,"$1"],[/(matr)ices$/i,"$1ix"],[/(vert|ind)ices$/i,"$1ex"],[/^(ox)en/i,"$1"],[/(alias|status)es$/i,"$1"],[/(octop|vir)i$/i,"$1us"],[/(cris|ax|test)es$/i,"$1is"],[/(shoe)s$/i,"$1"],[/(o)es$/i,"$1"],[/(bus)es$/i,"$1"],[/([m|l])ice$/i,"$1ouse"],[/(x|ch|ss|sh)es$/i,"$1"],[/(m)ovies$/i,"$1ovie"],[/(s)eries$/i,"$1eries"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/([lr])ves$/i,"$1f"],[/(tive)s$/i,"$1"],[/(hive)s$/i,"$1"],[/([^f])ves$/i,"$1fe"],[/(^analy)ses$/i,"$1sis"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"],[/([ti])a$/i,"$1um"],[/(n)ews$/i,"$1ews"],[/s$/i,""]],IRREGULAR:[["move","moves"],["sex","sexes"],["child","children"],["man","men"],["person","people"]],UNCOUNTABLE:["sheep","fish","series","species","money","rice","information","info","equipment"]};SC.mixin(SC.String,{capitalizeEach:function(a){return a.replace(SC.STRING_TITLEIZE_REGEXP,function(c,b,d){return(d)?(b+d.toUpperCase()):b}).capitalize()},titleize:function(b){var a=b.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2");return a.replace(SC.STRING_TITLEIZE_REGEXP,function(c,e,d){return d?" "+d.toUpperCase():" "}).capitalize()},classify:function(d){var a=d.replace(SC.STRING_TITLEIZE_REGEXP,function(e,g,f){return f?f.toUpperCase():""});var c=a.charAt(0),b=c.toUpperCase();return c!==b?b+a.slice(1):a},humanize:function(a){return SC.String.decamelize(a).replace(SC.STRING_HUMANIZE_REGEXP," ")},escapeForRegExp:function(a){return a.replace(SC.STRING_REGEXP_ESCAPED_REGEXP,"\\$1")},removeDiacritics:function(g){var a=SC.diacriticMappingTable;if(!a){SC.diacriticMappingTable={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ā":"A","Ă":"A","Ą":"A","Ǎ":"A","Ǟ":"A","Ǡ":"A","Ǻ":"A","Ȁ":"A","Ȃ":"A","Ȧ":"A","Ḁ":"A","Ạ":"A","Ả":"A","Ấ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ậ":"A","Ắ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ặ":"A","Å":"A","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ç":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ḉ":"C","Ď":"D","Ḋ":"D","Ḍ":"D","Ḏ":"D","Ḑ":"D","Ḓ":"D","È":"E","É":"E","Ê":"E","Ë":"E","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ȩ":"E","Ḕ":"E","Ḗ":"E","Ḙ":"E","Ḛ":"E","Ḝ":"E","Ẹ":"E","Ẻ":"E","Ẽ":"E","Ế":"E","Ề":"E","Ể":"E","Ễ":"E","Ệ":"E","Ḟ":"F","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","Ǧ":"G","Ǵ":"G","Ḡ":"G","Ĥ":"H","Ȟ":"H","Ḣ":"H","Ḥ":"H","Ḧ":"H","Ḩ":"H","Ḫ":"H","Ì":"I","Í":"I","Î":"I","Ï":"I","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ḭ":"I","Ḯ":"I","Ỉ":"I","Ị":"I","Ĵ":"J","Ķ":"K","Ǩ":"K","Ḱ":"K","Ḳ":"K","Ḵ":"K","Ĺ":"L","Ļ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ḻ":"L","Ḽ":"L","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ñ":"N","Ń":"N","Ņ":"N","Ň":"N","Ǹ":"N","Ṅ":"N","Ṇ":"N","Ṉ":"N","Ṋ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ō":"O","Ŏ":"O","Ő":"O","Ơ":"O","Ǒ":"O","Ǫ":"O","Ǭ":"O","Ȍ":"O","Ȏ":"O","Ȫ":"O","Ȭ":"O","Ȯ":"O","Ȱ":"O","Ṍ":"O","Ṏ":"O","Ṑ":"O","Ṓ":"O","Ọ":"O","Ỏ":"O","Ố":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ộ":"O","Ớ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ợ":"O","Ṕ":"P","Ṗ":"P","Ŕ":"R","Ŗ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ṟ":"R","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṥ":"S","Ṧ":"S","Ṩ":"S","Ţ":"T","Ť":"T","Ț":"T","Ṫ":"T","Ṭ":"T","Ṯ":"T","Ṱ":"T","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","Ư":"U","Ǔ":"U","Ǖ":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ȕ":"U","Ȗ":"U","Ṳ":"U","Ṵ":"U","Ṷ":"U","Ṹ":"U","Ṻ":"U","Ụ":"U","Ủ":"U","Ứ":"U","Ừ":"U","Ử":"U","Ữ":"U","Ự":"U","Ṽ":"V","Ṿ":"V","Ŵ":"W","Ẁ":"W","Ẃ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẋ":"X","Ẍ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ȳ":"Y","Ẏ":"Y","Ỳ":"Y","Ỵ":"Y","Ỷ":"Y","Ỹ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","Ẑ":"Z","Ẓ":"Z","Ẕ":"Z","`":"`","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ā":"a","ă":"a","ą":"a","ǎ":"a","ǟ":"a","ǡ":"a","ǻ":"a","ȁ":"a","ȃ":"a","ȧ":"a","ḁ":"a","ạ":"a","ả":"a","ấ":"a","ầ":"a","ẩ":"a","ẫ":"a","ậ":"a","ắ":"a","ằ":"a","ẳ":"a","ẵ":"a","ặ":"a","ḃ":"b","ḅ":"b","ḇ":"b","ç":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ḉ":"c","ď":"d","ḋ":"d","ḍ":"d","ḏ":"d","ḑ":"d","ḓ":"d","è":"e","é":"e","ê":"e","ë":"e","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","ȅ":"e","ȇ":"e","ȩ":"e","ḕ":"e","ḗ":"e","ḙ":"e","ḛ":"e","ḝ":"e","ẹ":"e","ẻ":"e","ẽ":"e","ế":"e","ề":"e","ể":"e","ễ":"e","ệ":"e","ḟ":"f","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","ǧ":"g","ǵ":"g","ḡ":"g","ĥ":"h","ȟ":"h","ḣ":"h","ḥ":"h","ḧ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ì":"i","í":"i","î":"i","ï":"i","ĩ":"i","ī":"i","ĭ":"i","į":"i","ǐ":"i","ȉ":"i","ȋ":"i","ḭ":"i","ḯ":"i","ỉ":"i","ị":"i","ĵ":"j","ǰ":"j","ķ":"k","ǩ":"k","ḱ":"k","ḳ":"k","ḵ":"k","ĺ":"l","ļ":"l","ľ":"l","ḷ":"l","ḹ":"l","ḻ":"l","ḽ":"l","ḿ":"m","ṁ":"m","ṃ":"m","ñ":"n","ń":"n","ņ":"n","ň":"n","ǹ":"n","ṅ":"n","ṇ":"n","ṉ":"n","ṋ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ō":"o","ŏ":"o","ő":"o","ơ":"o","ǒ":"o","ǫ":"o","ǭ":"o","ȍ":"o","ȏ":"o","ȫ":"o","ȭ":"o","ȯ":"o","ȱ":"o","ṍ":"o","ṏ":"o","ṑ":"o","ṓ":"o","ọ":"o","ỏ":"o","ố":"o","ồ":"o","ổ":"o","ỗ":"o","ộ":"o","ớ":"o","ờ":"o","ở":"o","ỡ":"o","ợ":"o","ṕ":"p","ṗ":"p","ŕ":"r","ŗ":"r","ř":"r","ȑ":"r","ȓ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ṟ":"r","ś":"s","ŝ":"s","ş":"s","š":"s","ș":"s","ṡ":"s","ṣ":"s","ṥ":"s","ṧ":"s","ṩ":"s","ţ":"t","ť":"t","ț":"t","ṫ":"t","ṭ":"t","ṯ":"t","ṱ":"t","ẗ":"t","ù":"u","ú":"u","û":"u","ü":"u","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","ư":"u","ǔ":"u","ǖ":"u","ǘ":"u","ǚ":"u","ǜ":"u","ȕ":"u","ȗ":"u","ṳ":"u","ṵ":"u","ṷ":"u","ṹ":"u","ṻ":"u","ụ":"u","ủ":"u","ứ":"u","ừ":"u","ử":"u","ữ":"u","ự":"u","ṽ":"v","ṿ":"v","ŵ":"w","ẁ":"w","ẃ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẘ":"w","ẋ":"x","ẍ":"x","ý":"y","ÿ":"y","ŷ":"y","ȳ":"y","ẏ":"y","ẙ":"y","ỳ":"y","ỵ":"y","ỷ":"y","ỹ":"y","ź":"z","ż":"z","ž":"z","ẑ":"z","ẓ":"z","ẕ":"z"};a=SC.diacriticMappingTable}var d,e,b="",f=g.length;for(var c=0;c<=f;++c){d=g.charAt(c);e=a[d];b+=e||d}return b},pluralize:function(g){var k,e,b=g.split(/\s/).pop(),h=g.replace(b,""),a=b.charAt(0).match(/[A-Z]/)?true:false;b=b.toLowerCase();for(k=0,e=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;k<e;k++){var f=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[k];if(b==f){return g.toString()}}for(k=0,e=SC.INFLECTION_CONSTANTS.IRREGULAR.length;k<e;k++){var c=SC.INFLECTION_CONSTANTS.IRREGULAR[k][0],j=SC.INFLECTION_CONSTANTS.IRREGULAR[k][1];if((b==c)||(b==j)){if(a){j=j.capitalize()}return h+j}}for(k=0,e=SC.INFLECTION_CONSTANTS.PLURAL.length;k<e;k++){var i=SC.INFLECTION_CONSTANTS.PLURAL[k][0],d=SC.INFLECTION_CONSTANTS.PLURAL[k][1];if(i.test(b)){return g.replace(i,d)}}},singularize:function(g){var k,e,b=g.split(/\s/).pop(),h=g.replace(b,""),a=b.charAt(0).match(/[A-Z]/)?true:false;b=b.toLowerCase();for(k=0,e=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;k<e;k++){var f=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[k];if(b==f){return g.toString()}}for(k=0,e=SC.INFLECTION_CONSTANTS.IRREGULAR.length;k<e;k++){var c=SC.INFLECTION_CONSTANTS.IRREGULAR[k][0],j=SC.INFLECTION_CONSTANTS.IRREGULAR[k][1];if((b==c)||(b==j)){if(a){c=c.capitalize()}return h+c}}for(k=0,e=SC.INFLECTION_CONSTANTS.SINGULAR.length;k<e;k++){var i=SC.INFLECTION_CONSTANTS.SINGULAR[k][0],d=SC.INFLECTION_CONSTANTS.SINGULAR[k][1];if(i.test(b)){return g.replace(i,d)}}}});SC.String.strip=SC.String.trim;sc_require("system/string");SC.supplement(String.prototype,{capitalizeEach:function(){return SC.String.capitalizeEach(this,arguments)},titleize:function(a){return SC.String.titleize(this,arguments)},classify:function(a){return SC.String.classify(this,arguments)},humanize:function(a){return SC.String.humanize(this,arguments)},escapeForRegExp:function(a){return SC.String.escapeForRegExp(this,arguments)},removeDiacritics:function(a){return SC.String.removeDiacritics(this,arguments)},trim:function(a){return SC.String.trim(this,arguments)},trimLeft:function(a){return SC.String.trimLeft(this,arguments)},trimRight:function(a){return SC.String.trimRight(this,arguments)},pluralize:function(a){return SC.String.pluralize(this,arguments)},singularize:function(a){return SC.String.singularize(this,arguments)}});SC.Gesture=SC.Object.extend({name:"gesture",touchIsInGesture:function(b,a){return NO},touchStart:function(a){},touchesDragged:function(a,b){},touchEnd:function(a){},start:function(){if(!this.get("isActive")){this.set("isActive",YES);var b=SC.$A(arguments);b.unshift(this);var a=this.name+"Start";if(this.view[a]){this.view[a].apply(this.view,b)}}},end:function(){if(this.get("isActive")){this.set("isActive",NO);var b=SC.$A(arguments);b.unshift(this);var a=this.name+"End";if(this.view[a]){this.view[a].apply(this.view,b)}}},change:function(){if(this.get("isActive")){var b=SC.$A(arguments);b.unshift(this);var a=this.name+"Changed";if(this.view[a]){this.view[a].apply(this.view,b)}}},cancel:function(){if(this.get("isActive")){this.set("isActive",NO);var b=SC.$A(arguments);b.unshift(this);var a=this.name+"Cancelled";if(this.view[a]){this.view[a].apply(this.view,b)}}},trigger:function(){var b=SC.$A(arguments);b.unshift(this);var a=this.name;if(this.view[a]){this.view[a].apply(this.view,b)}},take:function(a){a.isTaken=YES;if(SC.none(a.touchResponder)||a.touchResponder!==this){a.makeTouchResponder(this,YES)}},release:function(a){a.isTaken=NO;if(a.nextTouchResponder){a.makeTouchResponder(a.nextTouchResponder)}},discardTouch:function(a){a.isTaken=YES;a.makeTouchResponder(null)},statusForTouch:function(c){var b=SC.guidFor(c.view)+this.name;var a=c[b];if(!a){a=c[b]={}}return a},unassignedTouchDidStart:function(a){if(a.isTaken){return}if(this.touchIsInGesture(a,this.statusForTouch(a))){this.take(a)}},unassignedTouchesDidChange:function(a,b){b.forEach(function(c){if(c.isTaken){return}if(this.touchIsInGesture(c,this.statusForTouch(c))){this.take(c)}},this)},unassignedTouchDidEnd:function(a){},interestedInTouch:function(b){var a=this.statusForTouch(b);if(a.isInterested){return}a.isInterested=YES;b.isInteresting++},uninterestedInTouch:function(b){var a=this.statusForTouch(b);if(!a.isInterested){return}a.isInterested=NO;b.isInteresting--}});sc_require("system/gesture");SC.PinchGesture=SC.Gesture.extend({name:"pinch",acceptsMultitouch:YES,scale:1,unassignedTouchesDidChange:function(a,b){if(b.length==2){this.take(b[0]);this.take(b[1])}},touchStart:function(b){var a=b.touchesForResponder(this);if(!a||a.length===0){return YES}else{if(a.length==1){this.start([a[0],b]);return YES}else{return NO}}},touchesDragged:function(a,c){var d=c.firstObject(),b=d.averagedTouchesForView(this);if(b.touchCount==2){if(!this._startDistance){this._startDistance=b.d}this.scale=b.d/this._startDistance;this.change(c,this.scale)}},touchEnd:function(b){this._startDistance=null;var a=b.touchesForResponder(this);this.trigger(a,this.scale);this.end(a,this.scale);if(a){a.forEach(function(c){this.release(c)},this)}}});sc_require("system/gesture");SC.SWIPE_HORIZONTAL="X";SC.SWIPE_VERTICAL="Y";SC.SWIPE_ANY="XY";SC.SWIPE_LEFT="LEFT";SC.SWIPE_RIGHT="RIGHT";SC.SWIPE_UP="UP";SC.SWIPE_DOWN="DOWN";SC.SwipeGesture=SC.Gesture.extend({name:"swipe",acceptsMultitouch:YES,direction:SC.SWIPE_HORIZONTAL,currentDirection:null,startDistance:5,swipeDistance:40,tolerance:0.5,touchIsInGesture:function(i,g){if(!g.flunked){var j=this.get("direction"),e=this.get("currentDirection"),a=this.get("startDistance"),h=i.pageX-i.startX,f=i.pageY-i.startY,c=Math.abs(h),b=Math.abs(f);if(Math.abs(h)>a||Math.abs(f)>a){if(!e){if(j==SC.SWIPE_ANY){if(c>b){e=SC.SWIPE_HORIZONTAL}else{if(b>c){e=SC.SWIPE_VERTICAL}else{return NO}}}else{e=j}this.set("currentDirection",e)}var l=(e==SC.SWIPE_HORIZONTAL)?h:f,k=(e==SC.SWIPE_HORIZONTAL)?f:h;if(Math.abs(l)*this.get("tolerance")>Math.abs(k)){return YES}}}return NO},touchStart:function(e){var b=this.get("currentDirection"),c=e["page"+b]-e["start"+b],a;if(c<0){a=(b===SC.SWIPE_HORIZONTAL)?SC.SWIPE_LEFT:SC.SWIPE_UP}else{a=(b===SC.SWIPE_HORIZONTAL)?SC.SWIPE_RIGHT:SC.SWIPE_DOWN}this.start(e,a,c);return YES},touchesDragged:function(j,e){var c=e.firstObject();var f=this.get("currentDirection"),a=(f===SC.SWIPE_HORIZONTAL?"Y":"X"),i=c["page"+f]-c["start"+f],g=c["page"+a]-c["start"+a],h;if(i<0){h=(f===SC.SWIPE_HORIZONTAL)?SC.SWIPE_LEFT:SC.SWIPE_UP}else{h=(f===SC.SWIPE_HORIZONTAL)?SC.SWIPE_RIGHT:SC.SWIPE_DOWN}if(Math.abs(i)<this.get("startDistance")||Math.abs(i)*this.get("tolerance")<Math.abs(g)){this.release(c);var b=c.touchesForResponder(this);if(!b||b.length===0){this.cancel(c,h,i)}}else{this.change(c,h,i)}},touchEnd:function(h){var f=this.get("currentDirection"),e=(f===SC.SWIPE_HORIZONTAL?"Y":"X"),g=h["page"+f]-h["start"+f],b=h["page"+e]-h["start"+e],a;if(g<0){a=(f===SC.SWIPE_HORIZONTAL)?SC.SWIPE_LEFT:SC.SWIPE_UP}else{a=(f===SC.SWIPE_HORIZONTAL)?SC.SWIPE_RIGHT:SC.SWIPE_DOWN}if(Math.abs(g)>this.get("swipeDistance")||Math.abs(g)*this.get("tolerance")<Math.abs(b)){this.trigger(h,a)}this.end(h,a,g);this.set("currentDirection",null);var c=h.touchesForResponder(this);if(c){c.forEach(function(d){this.release(d)},this)}},cancel:function(){arguments.callee.base.apply(this,arguments);this.set("currentDirection",null)}});sc_require("system/gesture");SC.TapGesture=SC.Gesture.extend({name:"tap",acceptsMultitouch:NO,_tapCount:null,_candidateTouch:null,_eventTimer:null,tapWiggle:10,tapDelay:200,touchIsInGesture:function(b,a){return !b.tapFlunked},touchStart:function(a){if(this._eventTimer){this._eventTimer.invalidate()}if(this._candidateTouch&&this._candidateTouch.touch.identifier!==a.identifier){this._cancelTap(a);return NO}this._candidateTouch={startTime:Date.now(),touch:a};this.start(a);return YES},touchesDragged:function(a,c){var e=c[0];var b=(c.length>1||!this._candidateTouch||e.identifier!==this._candidateTouch.touch.identifier);var d=this._calculateDragDistance(e)>this.get("tapWiggle");if(b||d){this._cancelTap(e)}},touchEnd:function(a){if(this._calculateDragDistance(a)>this.get("tapWiggle")||Date.now()-this._candidateTouch.startTime>this.get("tapDelay")){this._cancelTap(a)}else{this._addTap(a)}},_addTap:function(b){var a=this;if(this._eventTimer){this._eventTimer.invalidate()}this._tapCount=(this._tapCount||0)+1;this._candidateTouch=null;this._eventTimer=SC.Timer.schedule({target:a,action:function(){this._triggerTap(b)},interval:this.get("tapDelay")});this.change(b,this._tapCount);this.trigger(b,this._tapCount)},_cancelTap:function(a){a.tapFlunked=YES;this.release(a);this.cancel(a,this._tapCount);if(this._eventTimer){this._eventTimer.invalidate()}this._tapCount=null;this._candidateTouch=null;this._eventTimer=null},_triggerTap:function(a){this.end(a,this._tapCount);this._tapCount=null;this._candidateTouch=null;this._eventTimer=null},_calculateDragDistance:function(a){return Math.sqrt(Math.pow(a.pageX-a.startX,2)+Math.pow(a.pageY-a.startY,2))}});SC.AutoMixin={autoMixins:[],createChildView:function(b,c){if(!c){c={}}c.owner=c.parentView=this;c.isVisibleInWindow=this.get("isVisibleInWindow");if(!c.page){c.page=this.page}var a=this.get("autoMixins");a.push(c);b=b.create.apply(b,a);return b}};SC.mixin({_copy_computed_props:["maxWidth","maxHeight","paddingLeft","paddingRight","paddingTop","paddingBottom","fontFamily","fontSize","fontStyle","fontWeight","fontVariant","lineHeight","whiteSpace","letterSpacing","wordWrap"],stringFromLayout:function(e){var d=["maxHeight","maxWidth","minHeight","minWidth","centerY","centerX","width","height","bottom","right","top","left","zIndex","opacity","border","borderLeft","borderRight","borderTop","borderBottom"],a=[],c,b=d.length;while(--b>=0){c=d[b];if(e.hasOwnProperty(c)){a.push(c+":"+e[c])}}return"{"+a.join(", ")+"}"},heightForString:function(h,c,b,a,g){var e=this._heightCalcElement,f,i;if(!g){h=SC.RenderContext.escapeHTML(h)}f=(a&&SC.typeOf(a)===SC.T_ARRAY)?a.join(" "):"";if(!c){c=100}if(!e){e=this._heightCalcElement=document.createElement("div");document.body.insertBefore(e,null)}b=b+"; width: "+c+"px; left: "+(-1*c)+"px; position: absolute";var d=SC.$(e);d.attr("style",b);if(f!==""){d.attr("class",f)}e.innerHTML=h;i=e.clientHeight;e=null;return i},prepareStringMeasurement:function(o,a){var k=this._metricsCalculationElement,h,p,c,d;h=SC.A(a).join(" ");if(!k){var n=document.createElement("div");n.style.cssText="position:absolute; left:-10010px; top:-10px;width:10000px; height:0px; overflow:hidden;visibility:hidden;";k=this._metricsCalculationElement=document.createElement("div");n.appendChild(k);document.body.insertBefore(n,null)}d=SC.$(k);if(SC.typeOf(o)!=SC.T_STRING){var g=null;if(document.defaultView&&document.defaultView.getComputedStyle){g=document.defaultView.getComputedStyle(o,null)}else{g=o.currentStyle}var m=this._copy_computed_props;for(var j=0;j<m.length;j++){var b=m[j],f=g[b];k.style[b]=f}var l=k.style;if(l.font===""){var e="";if(l.fontStyle){e+=l.fontStyle+" "}if(l.fontVariant){e+=l.fontVariant+" "}if(l.fontWeight){e+=l.fontWeight+" "}if(l.fontSize){e+=l.fontSize}else{e+="10px"}if(l.lineHeight){e+="/"+l.lineHeight}e+=" ";if(l.fontFamily){e+=l.fontFamily}else{l+="sans-serif"}k.style.font=e}SC.mixin(k.style,{left:"0px",top:"0px",position:"absolute",bottom:"auto",right:"auto",width:"auto",height:"auto"});g=null}else{c=o;d.attr("style",c+"; position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;")}k.className=h;k=null},teardownStringMeasurement:function(){var a=this._metricsCalculationElement;a.innerHTML="";a.className="";a.setAttribute("style","");a=null},measureString:function(c,b){var d=this._metricsCalculationElement,e=0;if(!d){throw"measureString requires a string measurement environment to be set up. Did you mean metricsForString?"}if(b){d.innerHTML=c}else{if(typeof d.innerText!="undefined"){d.innerText=c}else{d.textContent=c}}if(SC.browser.isIE){e=1}var a={width:d.clientWidth+e,height:d.clientHeight};if(SC.browser.isMozilla){a.width+=1}d=null;return a},metricsForString:function(c,d,e,b){SC.prepareStringMeasurement(d,e);var a=SC.measureString(c,b);SC.teardownStringMeasurement();return a}});sc_require("system/utils/string_measurement");SC.AutoResize={shouldAutoResize:YES,shouldMeasureSize:YES,shouldCacheSizes:NO,shouldResizeWidth:YES,shouldResizeHeight:NO,measuredSize:{width:0,height:0},maxWidth:null,maxHeight:null,shouldAutoFitText:NO,autoFitDiscreteFontSizes:NO,minFontSize:12,maxFontSize:20,calculatedFontSize:20,fontPropertyDidChange:function(){if(this.get("shouldAutoFitText")){this.invokeLast(this.fitTextToFrame)}}.observes("shouldAutoFitText","minFontSize","maxFontSize","measuredSize"),measuredSizeDidChange:function(){var c=this.get("measuredSize"),b=c.width,h=c.height,g,a,d=this.get("autoResizePadding")||0,f=this.get("maxWidth"),e=this.get("maxHeight");if(SC.typeOf(d)===SC.T_NUMBER){g=a=d}else{g=d.height;a=d.width}h+=g;b+=a;if(this.get("shouldAutoResize")){if(this.get("shouldResizeWidth")){if(f&&b>f){b=f}this.set("calculatedWidth",b);this.adjust("width",b)}if(this.get("shouldResizeHeight")){if(e&&h>e){h=e}this.set("calculatedHeight",h);this.adjust("height",h)}}}.observes("shouldAutoResize","measuredSize","autoResizePadding","maxWidth","minWidth","shouldResizeWidth","shouldResizeHeight"),initMixin:function(){},batchResizeId:null,scheduleMeasurement:function(){var a=this.get("batchResizeId");if(!this.get("shouldMeasureSize")||!this.get("isVisibleInWindow")||(this.get("autoResizeText")===this._lastMeasuredText&&a===this._lastMeasuredId)){return}SC.AutoResizeManager.scheduleMeasurementForView(this,a)}.observes("isVisibleInWindow","shouldMeasureSize","autoResizeText","batchResizeId"),_lastMeasuredText:null,_cachedMetrics:function(c,d){if(!this.get("shouldCacheSizes")){return}var b=SC.cacheSlotFor(this.get("batchResizeId")||this),a=this.get("autoResizeText");if(d){b[a]=d}else{d=b[a]}return d}.property("shouldCacheSizes","autoResizeText","batchResizeId").cacheable(),measureSize:function(d){var h,e=this.get("autoResizeLayer"),c=this.get("autoResizeText"),b=!this.get("escapeHTML"),g=this.get("batchResizeId"),a=this.get("_cachedMetrics"),f=this.get("maxFontSize");if(!e){return}if(a){h=a}else{if(SC.none(c)||c===""){h={width:0,height:0}}else{if(d){h=SC.measureString(c,b)}else{this.prepareLayerForStringMeasurement(e);h=SC.metricsForString(c,e,this.get("classNames"),b)}}}this.set("measuredSize",h);if(this.get("shouldCacheSizes")){this.setIfChanged("_cachedMetrics",h)}this._lastMeasuredText=c;this._lastMeasuredId=g;return h},prepareLayerForStringMeasurement:function(a){var b=this.get("maxFontSize");if(this.get("shouldAutoFitText")&&this.get("calculatedFontSize")!==b){a.style.fontSize=b+"px"}},viewDidResize:function(a){a();this.fontPropertyDidChange()}.enhance(),fitTextToFrame:function(){var q=this.get("autoResizeLayer");if(!q){return}var c=this.get("maxFontSize"),d=this.get("minFontSize");this.prepareLayerForStringMeasurement(q);var e=this.get("frame"),f=this.get("autoResizePadding")||0,j=e.width-1,g=e.height-1,p=this.get("measuredSize"),a=p.width,r=p.height;if(SC.typeOf(f)===SC.T_NUMBER){j-=f;g-=f}else{j-=f.width;g-=f.height}if(a<=j&&r<=g){return}if(this.get("autoFitDiscreteFontSizes")){h=d}else{var b=j/a,i=g/r,l=Math.floor(c*Math.min(b,i)),h,o=this.get("classNames"),n=!this.get("escapeHTML"),k=this.get("autoResizeText"),m;l=h=Math.min(c,Math.max(d,l));q.style.fontSize=l+"px";m=SC.metricsForString(k,q,o,n);if(m.width>j||m.height>g){for(l=l-1;l>=d;l--){q.style.fontSize=l+"px";m=SC.metricsForString(k,q,o,n);h=l;if(m.width<=j&&m.height<=g){break}}}else{if(m.width<j||m.height<g){for(l=l+1;l<=c;l++){q.style.fontSize=l+"px";m=SC.metricsForString(k,q,o,n);if(m.width<=j&&m.height<=g){h=l}if(m.width>=j||m.height>=g){break}}}}}q.style.fontSize=h+"px";this.set("calculatedFontSize",h)},applyAttributesToContext:function(b,a){b(a);if(this.get("shouldAutoFitText")){a.css("font-size",this.get("calculatedFontSize")+"px")}}.enhance(),didCreateLayer:function(a){a();this.scheduleMeasurement()}.enhance()};SC.AutoResizeManager={measurementQueue:SC.CoreSet.create(),scheduleMeasurementForView:function(a){this.measurementQueue.add(a);SC.RunLoop.currentRunLoop.invokeLast(this.doBatchResize)},cancelMeasurementForView:function(a,b){this.measurementQueue.remove(a)},doBatchResize:function(){if(this!==SC.AutoResizeManager){return SC.AutoResizeManager.doBatchResize()}var b,d,f,g=this.measurementQueue,h,c,e,a;while((a=g.get("length"))>0){h=NO;b=g[a-1].get("batchResizeId");for(e=a-1;e>=0;--e){d=g[e];if(d.get("batchResizeId")!==b){continue}if(d.get("isVisibleInWindow")&&d.get("shouldMeasureSize")&&(f=d.get("autoResizeLayer"))){c=d.get("autoResizeText");if(!SC.none(c)&&c!==""&&!d.get("_cachedMetrics")&&!h){d.prepareLayerForStringMeasurement(f);SC.prepareStringMeasurement(f,d.get("classNames"));h=YES}d.measureSize(YES)}g.remove(d);if(!b){break}}if(h){SC.teardownStringMeasurement()}}}};if(SC.Button){SC.Button.initMixin=function(){throw"SC.Button is deprecated as a mixin and is now a subclass of SC.TemplateView. Subclass SC.ButtonView instead."}}SC.ContentDisplay={concatenatedProperties:"contentDisplayProperties",displayProperties:["content"],contentDisplayProperties:[],initMixin:function(){this._display_contentDidChange()},destroyMixin:function(){if(!this._display_content){return}this._display_stopObservingContent(this._display_content);this._display_content=null},_display_beginObservingContent:function(a){var b=this._display_contentPropertyDidChange;if(SC.isArray(a)){a.invoke("addObserver","*",this,b)}else{if(a.addObserver){a.addObserver("*",this,b)}}},_display_stopObservingContent:function(a){var b=this._display_contentPropertyDidChange;if(SC.isArray(a)){a.invoke("removeObserver","*",this,b)}else{if(a.removeObserver){a.removeObserver("*",this,b)}}},_display_contentDidChange:function(d,a,c){if((c=this.get("content"))===this._display_content){return}var b=this._display_content;if(b){this._display_stopObservingContent(b)}b=this._display_content=c;if(b){this._display_beginObservingContent(b)}this.displayDidChange()}.observes("content","contentDisplayProperties"),_display_contentPropertyDidChange:function(e,c,d,b){if(c==="*"){this.displayDidChange()}else{var a=this.get("contentDisplayProperties");if(a&&a.indexOf(c)>=0){this.displayDidChange()}}}};SC.ContentValueSupport={hasContentValueSupport:YES,initMixin:function(){this._control_contentKeysDidChange()},value:null,content:null,contentKeys:null,_default_contentKeys:{contentValueKey:"value"},contentValueKey:null,contentPropertyDidChange:function(c,b){var a=this.get("contentKeys");if(a){var d;for(d in a){if(b==="*"||b===this.getDelegateProperty(d,this,this.get("displayDelegate"),a)){return this.updatePropertyFromContent(a[d],b,d,c)}}}else{return this.updatePropertyFromContent("value",b,"contentValueKey",c)}},updatePropertyFromContent:function(f,c,e,d){var a,b;if(e===undefined){e="content"+f.capitalize()+"Key"}if(this[e]){e=this.get(e)}else{if((a=this.get("displayDelegate"))&&(b=a[e])){e=a.get?a.get(e):b}else{return this}}if(c==="*"||c===e){if(d===undefined){d=this.get("content")}if(d){b=d.get?d.get(e):d[e]}else{b=null}this.setIfChanged(f,b)}return this},updateContentWithValueObserver:function(d,a){var f=this._reverseContentKeys;if(!a||a==="*"){for(a in f){this.updateContentWithValueObserver(this,a)}}var c=this.get(a);var b=this.get("content"),e=this.getDelegateProperty(f[a],this,this.displayDelegate);if(!e||!b){return this}if(typeof b.setIfChanged===SC.T_FUNCTION){b.setIfChanged(e,c)}else{if(b[e]!==c){b[e]=c}}},_control_content:null,_old_contentValueKeys:null,_old_contentKeys:null,_control_contentDidChange:function(h,l){var j=this.get("content"),b=this.get("contentKeys"),a,c=this._control_content,m=this._old_contentValueKeys,k=SC.typeOf(m),g=this.contentPropertyDidChange;if(c&&c.removeObserver&&m){if(k===SC.T_STRING){c.removeObserver(m,this,g);m=null}else{var d,e=m.get("length");for(d=0;d<e;d++){a=m[d];c.removeObserver(a,this,g)}m.clear()}}if(j&&j.addObserver){if(b){if(!m){m=SC.CoreSet.create()}for(a in b){a=this.getDelegateProperty(a,this,this.get("displayDelegate"));if(a){j.addObserver(a,this,g);m.add(a)}}}else{a=this.getDelegateProperty("contentValueKey",this,this.get("displayDelegate"));if(a){j.addObserver(a,this,g);if(m){m.add(a)}else{m=a}}}}this._control_content=j;this._old_contentValueKeys=m;l=(!l||l==="content")?"*":this.get(l);if(l){this.contentPropertyDidChange(j,l)}}.observes("content"),_old_contentKeys:null,_control_contentKeysDidChange:function(){var d,c={},a=this.get("contentKeys")||this._default_contentKeys,h,b=this._old_contentKeys,g=this._control_contentDidChange,e=this.updateContentWithValueObserver;for(d in b){h=b[d];this.removeObserver(h,this,e);this.removeObserver(d,this,g)}for(d in a){h=a[d];c[h]=d;this.addObserver(h,this,e);this.addObserver(d,this,g)}this._reverseContentKeys=c;this._old_contentKeys=a;this._control_contentDidChange()}.observes("contentKeys")};sc_require("mixins/content_value_support");sc_require("system/string");SC.AUTO_CONTROL_SIZE="__AUTO__";SC.JUMBO_CONTROL_SIZE="sc-jumbo-size";SC.HUGE_CONTROL_SIZE="sc-huge-size";SC.LARGE_CONTROL_SIZE="sc-large-size";SC.REGULAR_CONTROL_SIZE="sc-regular-size";SC.SMALL_CONTROL_SIZE="sc-small-size";SC.TINY_CONTROL_SIZE="sc-tiny-size";SC.Control=SC.mixin(SC.clone(SC.ContentValueSupport),{isControl:YES,isSelected:NO,isSelectedBindingDefault:SC.Binding.oneWay().bool(),isActive:NO,isActiveBindingDefault:SC.Binding.oneWay().bool(),fieldKey:null,fieldLabel:null,errorLabel:function(){var a,d,c,b;if(a=this.get("fieldLabel")){return a}d=this.get("fieldKey")||this.constructor.toString();c=d?SC.String.capitalize(SC.String.humanize(d)):"";b=SC.String.locWithDefault("FieldKey."+d,c);return SC.String.locWithDefault("ErrorLabel."+d,b)}.property("fieldLabel","fieldKey").cacheable(),controlSize:SC.REGULAR_CONTROL_SIZE,displayProperties:["isEnabled","isSelected","isActive","controlSize"],_CONTROL_TMP_CLASSNAMES:{},renderMixin:function(b,g){var d=this.get("isSelected"),c=!this.get("isEnabled"),e=this._CONTROL_TMP_CLASSNAMES;e.mixed=d===SC.MIXED_STATE;e.sel=d&&(d!==SC.MIXED_STATE);e.active=this.get("isActive");var f=this.get("controlSize");if(!f){f=SC.REGULAR_CONTROL_SIZE}if(g){b.setClass(e);if(!this.get("renderDelegate")){b.addClass(f)}}else{b.$().setClass(e);if(!this.get("renderDelegate")){b.$().addClass(f)}}if(!g&&this.$input){var a=this.$input();if(a.attr("type")!=="radio"){this.$input().attr("disabled",c)}}}});SC.Editable={isEditable:NO,isEditing:NO,beginEditing:function(){if(!this.get("isEditable")){return NO}if(this.get("isEditing")){return YES}this.beginPropertyChanges();this.set("isEditing",YES);this.becomeFirstResponder();this.endPropertyChanges();return YES},discardEditing:function(){return !this.get("isEditing")},commitEditing:function(){if(!this.get("isEditing")){return YES}this.set("isEditing",NO);this.resignFirstResponder();return YES}};SC.ALIGN_JUSTIFY="justify";SC.FlowedLayout={isFlowedLayout:YES,layoutDirection:SC.LAYOUT_HORIZONTAL,autoResize:YES,shouldResizeWidth:YES,shouldResizeHeight:YES,align:SC.ALIGN_LEFT,canWrap:YES,defaultFlowSpacing:{left:0,bottom:0,top:0,right:0},flowPadding:{left:0,bottom:0,right:0,top:0},_scfl_validFlowPadding:function(){var b=this.get("flowPadding")||{},a={};a.left=b.left||0;a.top=b.top||0;a.bottom=b.bottom||0;a.right=b.right||0;return a}.property("flowPadding").cacheable(),concatenatedProperties:["childMixins"],initMixin:function(){this._scfl_tileOnce()},_scfl_childViewsDidChange:function(a){this._scfl_tileOnce()}.observes("childViews"),_scfl_layoutPropertyDidChange:function(a){this._scfl_tileOnce()}.observes("layoutDirection","align","flowPadding","canWrap","defaultFlowSpacing","isVisibleInWindow"),layoutDidChangeFor:function(g){var b=g._scfl_lastLayout,a=g.get("layout"),d=g.get("frame");if(!b){return arguments.callee.base.apply(this,arguments)}var e=YES;if(b.left&&b.left!==a.left){e=NO}else{if(b.top&&b.top!==a.top){e=NO}else{if(!g.get("fillWidth")&&b.width&&b.width!==a.width){e=NO}else{if(!b.width&&!g.get("fillWidth")&&d.width!==g._scfl_lastFrame.width){e=NO}else{if(!g.get("fillHeight")&&b.height&&b.height!==a.height){e=NO}else{if(!b.height&&!g.get("fillHeight")&&d.height!==g._scfl_lastFrame.height){e=NO}}}}}}if(e){return arguments.callee.base.apply(this,arguments)}this._scfl_tileOnce();arguments.callee.base.apply(this,arguments)},observeChildLayout:function(a){if(a._scfl_isBeingObserved){return}a._scfl_isBeingObserved=YES;a.addObserver("flowSpacing",this,"_scfl_tileOnce");a.addObserver("isVisible",this,"_scfl_tileOnce");a.addObserver("useAbsoluteLayout",this,"_scfl_tileOnce");a.addObserver("calculatedWidth",this,"_scfl_tileOnce");a.addObserver("calculatedHeight",this,"_scfl_tileOnce");a.addObserver("startsNewRow",this,"_scfl_tileOnce");a.addObserver("isSpacer",this,"_scfl_tileOnce");a.addObserver("maxSpacerLength",this,"_scfl_tileOnce");a.addObserver("fillWidth",this,"_scfl_tileOnce");a.addObserver("fillHeight",this,"_scfl_tileOnce")},unobserveChildLayout:function(a){a._scfl_isBeingObserved=NO;a.removeObserver("flowSpacing",this,"_scfl_tileOnce");a.removeObserver("isVisible",this,"_scfl_tileOnce");a.removeObserver("useAbsoluteLayout",this,"_scfl_tileOnce");a.removeObserver("calculatedWidth",this,"_scfl_tileOnce");a.removeObserver("calculatedHeight",this,"_scfl_tileOnce");a.removeObserver("startsNewRow",this,"_scfl_tileOnce");a.removeObserver("isSpacer",this,"_scfl_tileOnce");a.removeObserver("maxSpacerLength",this,"_scfl_tileOnce");a.removeObserver("fillWidth",this,"_scfl_tileOnce");a.removeObserver("fillHeight",this,"_scfl_tileOnce")},shouldIncludeChildInFlow:function(a,b){return b.get("isVisible")&&!b.get("useAbsoluteLayout")},flowSpacingForChild:function(a,b){var c=b.get("flowSpacing");if(SC.none(c)){c=this.get("defaultFlowSpacing")}if(SC.none(c)){c=0}if(SC.typeOf(c)===SC.T_NUMBER){c={left:c,right:c,bottom:c,top:c}}else{c.left=c.left||0;c.right=c.right||0;c.top=c.top||0;c.bottom=c.bottom||0}return c},flowSizeForChild:function(a,d){var c=d.get("calculatedWidth"),g=d.get("calculatedHeight"),i=this.get("layoutDirection"),e={},h=d.get("frame"),b=d.get("layout");d._scfl_lastFrame=h;if(c){e.width=c}else{e.width=b.width||h.width}if(g){e.height=g}else{e.height=b.height||h.height}if(d.get("isSpacer")){e.maxSpacerLength=d.get("maxSpacerLength");if(i===SC.LAYOUT_HORIZONTAL){e.width=b.minWidth||0}else{e.height=b.minHeight||0}}if(i===SC.LAYOUT_HORIZONTAL&&d.get("fillHeight")){e.height=b.minHeight||0}else{if(i===SC.LAYOUT_VERTICAL&&d.get("fillWidth")){e.width=b.minWidth||0}}return e},clippingFrame:function(){return{left:0,top:0,width:this.get("calculatedWidth"),height:this.get("calculatedHeight")}}.property("calculatedWidth","calculatedHeight"),_scfl_maxCollapsedRowLength:0,_scfl_totalCollapsedRowSize:0,_scfl_calculatedSizeDidChange:function(){if(this.get("autoResize")){if(this.get("layoutDirection")==SC.LAYOUT_VERTICAL){if(this.get("shouldResizeHeight")){this.adjust("minHeight",this.get("_scfl_maximumCollapsedRowLength"))}if(this.get("shouldResizeWidth")){this.adjust("minWidth",this.get("_scfl_totalCollapsedRowSize"))}}else{if(this.get("shouldResizeWidth")){this.adjust("minWidth",this.get("_scfl_maximumCollapsedRowLength"))}if(this.get("shouldResizeHeight")){this.adjust("minHeight",this.get("_scfl_totalCollapsedRowSize"))}}}}.observes("autoResize","shouldResizeWidth","_scfl_maximumCollapsedRowLength","_scfl_totalCollapsedRowSize","shouldResizeHeight"),_scfl_createPlan:function(){var e=this.get("layoutDirection"),a=this.get("_scfl_validFlowPadding"),d=this.get("frame");var c=(e===SC.LAYOUT_VERTICAL);var b={rows:undefined,maximumCollapsedRowLength:0,totalCollapsedRowSize:0,isVertical:e===SC.LAYOUT_VERTICAL,isHorizontal:e===SC.LAYOUT_HORIZONTAL,flowPadding:a,planStartPadding:a[c?"left":"top"],planEndPadding:a[c?"right":"bottom"],rowStartPadding:a[c?"top":"left"],rowEndPadding:a[c?"bottom":"right"],maximumRowLength:undefined,fitToPlanSize:undefined,align:this.get("align")};if(c){b.maximumRowLength=d.height-b.rowStartPadding-b.rowEndPadding;b.fitToPlanSize=d.width-b.planStartPadding-b.planEndPadding}else{b.maximumRowLength=d.width-b.rowStartPadding-b.rowEndPadding;b.fitToPlanSize=d.height-b.planStartPadding-b.planEndPadding}return b},_scfl_distributeChildrenIntoRows:function(d){var b=this.get("childViews"),a,g,c=b.length,e=d.isVertical,i=[],f;f=-1;g=0;while(g<c&&g!==f){f=g;var h={plan:d,rowLength:undefined,rowSize:undefined,shouldExpand:undefined,items:undefined,position:undefined};g=this._scfl_distributeChildrenIntoRow(b,g,h);i.push(h)}d.rows=i},_scfl_distributeChildrenIntoRow:function(e,m,i){var o,t=e.length,b=i.plan,g,a,d,p=[],k=0,l=b.isVertical,j,f,c,n=this.get("canWrap"),h=NO,q=0,s=i.plan.maximumRowLength;for(o=m;o<t;o++){g=e[o];h=h||(p.length>0&&g.get("startsNewRow"));if(!this.shouldIncludeChildInFlow(o,g)){continue}a=this.flowSizeForChild(o,g);d=this.flowSpacingForChild(o,g);a.width+=d.left+d.right;a.height+=d.top+d.bottom;f=a[l?"height":"width"];if(!SC.none(a.maxSpacerLength)){c=a.maxSpacerLength+(l?d.top+d.bottom:d.left+d.right)}j=a[l?"width":"height"];if((h||(n&&k+f>s))&&p.length>0){break}var u={child:g,itemLength:f,maxSpacerLength:c,itemSize:j,spacing:d,position:undefined,fillRow:l?g.get("fillWidth"):g.get("fillHeight"),isSpacer:g.get("isSpacer"),left:undefined,top:undefined,width:undefined,height:undefined};p.push(u);k+=f;q=Math.max(f,q)}i.rowLength=k;var r=n?q:i.rowLength;i.plan.maximumCollapsedRowLength=Math.max(r,i.plan.maximumCollapsedRowLength);i.items=p;return o},_scfl_positionChildrenInRows:function(d){var c=d.rows,b=c.length,a;for(a=0;a<b;a++){this._scfl_positionChildrenInRow(c[a])}},_scfl_positionChildrenInRow:function(m){var g=m.items,e=g.length,j,l,d,k=0,a=0,c,f=m.plan.align,i=YES,b=0,h=NO;for(j=0;j<e;j++){l=g[j];if(l.isSpacer){a+=l.child.get("spaceUnits")||1}}if(f===SC.ALIGN_JUSTIFY){a+=e-1}c=Math.max(0,m.plan.maximumRowLength-m.rowLength)/a;while(c>0){for(j=0;j<e;j++){l=g[j];if(l.isSpacer){l.itemLength+=c*(l.child.get("spaceUnits")||1);if(l.itemLength>l.maxSpacerLength){b+=l.itemLength-l.maxSpacerLength;l.itemLength=l.maxSpacerLength}else{h=YES}}}if(!h){break}c=Math.round(b/a);b=0}d=0;if(a===0&&(f===SC.ALIGN_RIGHT||f===SC.ALIGN_BOTTOM)){d=m.plan.maximumRowLength-m.rowLength}else{if(a===0&&(f===SC.ALIGN_CENTER||f===SC.ALIGN_MIDDLE)){d=(m.plan.maximumRowLength/2)-(m.rowLength/2)}}d+=m.plan.rowStartPadding;for(j=0;j<e;j++){l=g[j];if(!l.fillRow){i=NO}k=Math.max(l.itemSize,k);l.position=d;d+=l.itemLength;if(f===SC.ALIGN_JUSTIFY&&j<e-1){d+=c}}m.shouldExpand=e>0?i:NO;m.rowLength=d-m.plan.rowStartPadding;m.rowSize=k;m.plan.totalCollapsedRowSize+=m.rowSize},_scfl_positionRows:function(d){var i=d.rows,c=i.length,f,h,b,a=0,g=0,e;for(f=0;f<c;f++){if(i[f].shouldExpand){a++}g+=i[f].rowSize}e=d.fitToPlanSize-g;b=d.planStartPadding;for(f=0;f<c;f++){h=i[f];if(h.shouldExpand&&e>0){h.rowSize+=e/a;a--}h.position=b;b+=h.rowSize}},_scfl_applyPlan:function(h){var n=h.rows,b,c,m,e=0,j=0,g,a,d,l,f,k,i=h.isVertical;c=n.length;for(b=0;b<c;b++){m=n[b];e=Math.max(e,m.rowLength);j+=m.rowSize;g=m.items;d=g.length;for(a=0;a<d;a++){l=g[a];l.child.beginPropertyChanges();k=l.fillRow?m.rowSize:l.itemSize;f={left:l.spacing.left+(i?m.position:l.position),top:l.spacing.top+(i?l.position:m.position),width:i?k:l.itemLength,height:i?l.itemLength:k};f.width-=l.spacing.left+l.spacing.right;f.height-=l.spacing.top+l.spacing.bottom;this.applyPlanToView(l.child,f);l.child._scfl_lastLayout=f;l.child.endPropertyChanges()}}j+=h.planStartPadding+h.planEndPadding;e+=h.rowStartPadding+h.rowEndPadding;this.beginPropertyChanges();this.set("calculatedHeight",i?e:j);this.set("calculatedWidth",i?j:e);this.set("_scfl_maximumCollapsedRowLength",h.maximumCollapsedRowLength);this.set("_scfl_totalCollapsedRowSize",h.totalCollapsedRowSize);this.endPropertyChanges()},applyPlanToView:function(a,b){a.adjust(b)},_scfl_tileOnce:function(){this.invokeLast(this._scfl_tile)},_scfl_tile:function(){if(!this.get("isVisibleInWindow")){return}var f=this._scfl_createPlan();this._scfl_distributeChildrenIntoRows(f);this._scfl_positionChildrenInRows(f);this._scfl_positionRows(f);this._scfl_applyPlan(f);this.setIfChanged("numberOfRows",f.rows.length);var d=this._scfl_isObserving||SC.CoreSet.create(),c=SC.CoreSet.create();var e=this.get("childViews"),b=e.length,a,g;for(a=0;a<b;a++){g=e[a];if(!d.contains(g)){this.observeChildLayout(g)}else{d.remove(g)}c.add(g)}b=d.length;for(a=0;a<b;a++){this.unobserveChildLayout(d[a])}},_scfl_frameDidChange:function(){var b=this.get("frame"),a=this._scfl_lastFrameSize||{};this._scfl_lastFrameSize=SC.clone(b);if(a.width==b.width&&a.height==b.height){return}this._scfl_tileOnce()}.observes("frame"),destroyMixin:function(){var c=this._scfl_isObserving;if(!c){return}var b=c.length,a;for(a=0;a<b;a++){this.unobserveChildLayout(c[a])}},reorder:function(b){if(!SC.typeOf(b)===SC.T_ARRAY){b=arguments}var c=b.length,d=this.childViews,a;this.beginPropertyChanges();while(c-->0){a=b[c];if(SC.typeOf(a)===SC.T_STRING){a=this.get(a)}d.removeObject(a);d.unshiftObject(a)}this.endPropertyChanges();this._scfl_childViewsDidChange();return this}};SC.Gesturable={concatenatedProperties:["gestures"],gestures:[],initMixin:function(){this.createGestures()},createGestures:function(){var e=this.get("gestures"),b,a=e.length,c,d=[];for(b=0;b<a;b++){if(SC.typeOf(e[b])===SC.T_STRING){c=this.get(e[b])}else{c=e[b]}if(!c){throw"Could not find gesture named '"+e[b]+"' on view."}if(c.isClass){c=c.create({view:this})}if(SC.typeOf(e[b])===SC.T_STRING){this[e[b]]=c}d.push(c)}this.set("gestures",d)},touchStart:function(a){this.gestureTouchStart(a)},touchesDragged:function(a,b){this.gestureTouchesDragged(a,b)},touchEnd:function(a){this.gestureTouchEnd(a)},gestureTouchStart:function(e){e.isInteresting=0;var d=this.get("gestures"),b,a=d.length,c;for(b=0;b<a;b++){c=d[b];c.unassignedTouchDidStart(e)}},gestureTouchesDragged:function(c,e){var f=this.get("gestures"),b,a=f.length,d;for(b=0;b<a;b++){d=f[b];d.unassignedTouchesDidChange(c,e)}},gestureTouchEnd:function(e){var d=this.get("gestures"),b,a=d.length,c;for(b=0;b<a;b++){c=d[b];c.unassignedTouchDidEnd(e)}}};SC.InlineEditable={isInlineEditable:YES,isEditable:YES,exampleEditor:SC.InlineTextFieldView,isEditing:NO,inlineEditorDelegate:SC.InlineTextFieldDelegate,_editor:null,beginEditing:function(){var a;a=this.delegateFor("inlineEditorShouldBeginEditing",this.inlineEditorDelegate);if(a&&!a.inlineEditorShouldBeginEditing(this,this.get("value"))){return NO}this._editor=this.invokeDelegateMethod(this.inlineEditorDelegate,"acquireEditor",this);if(this._editor){return this._editor.beginEditing(this)}else{return NO}},commitEditing:function(){return this._editor?this._editor.commitEditing():NO},discardEditing:function(){return this._editor?this._editor.discardEditing():NO},inlineEditorShouldBeginEditing:function(){return !this.get("isEditing")&&this.get("isEditable")},inlineEditorWillBeginEditing:function(b,c,a){b.set("value",this.get("value"))},inlineEditorDidBeginEditing:function(b,c,a){this.set("isEditing",YES)},inlineEditorWillCommmitEditing:function(b,c,a){if(this.inlineEditorWillEndEditing){this.inlineEditorWillEndEditing(b,c)}},inlineEditorDidCommitEditing:function(b,c,a){a.setIfChanged("value",c);if(this.inlineEditorDidEndEditing){this.inlineEditorDidEndEditing(b,c)}this._endEditing()},inlineEditorWillDiscardEditing:function(b,a){if(this.inlineEditorWillEndEditing){this.inlineEditorWillEndEditing(b,this.get("value"))}},inlineEditorDidDiscardEditing:function(b,a){if(this.inlineEditorDidEndEditing){this.inlineEditorDidEndEditing(b,this.get("value"))}this._endEditing()},_endEditing:function(){if(this._editor){this.invokeDelegateMethod(this.inlineEditorDelegate,"releaseEditor",this._editor);this._editor=null}this.set("isEditing",NO)}};SC.InlineEditor={isInlineEditor:YES,isEditing:NO,inlineEditorDelegate:null,_target:null,beginEditing:function(b){if(this.get("isEditing")||!b||!b.isInlineEditable){return NO}var a,c;c=this._target=b;a=this.delegateFor("inlineEditorWillBeginEditing",this.inlineEditorDelegate,c);if(a){a.inlineEditorWillBeginEditing(this,this.get("value"),c)}this.set("isEditing",YES);this.invokeLast(this._callDidBegin);this._didBeginInvoked=YES;return YES},_callDidBegin:function(){if(!this.get("isEditing")){return NO}this._didBeginInvoked=NO;var b=this._target,a;a=this.delegateFor("inlineEditorDidBeginEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorDidBeginEditing(this,this.get("value"),b)}},commitEditing:function(){if(!this.get("isEditing")){return NO}if(this._didBeginInvoked){this._callDidBegin()}var a,b=this._target;a=this.delegateFor("inlineEditorShouldCommitEditing",this.inlineEditorDelegate,b);if(a&&!a.inlineEditorShouldCommitEditing(this,this.get("value"),b)){return NO}a=this.delegateFor("inlineEditorWillCommitEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorWillCommitEditing(this,this.get("value"),b)}this._endEditing();a=this.delegateFor("inlineEditorDidCommitEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorDidCommitEditing(this,this.get("value"),b)}return YES},discardEditing:function(){if(!this.get("isEditing")){return NO}if(this._didBeginInvoked){this._callDidBegin()}var a,b=this._target;a=this.delegateFor("inlineEditorShouldDiscardEditing",this.inlineEditorDelegate,b);if(a&&!a.inlineEditorShouldDiscardEditing(this,b)){return NO}a=this.delegateFor("inlineEditorWillDiscardEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorWillDiscardEditing(this,b)}this._endEditing();a=this.delegateFor("inlineEditorDidDiscardEditing",this.inlineEditorDelegate,b);if(a){a.inlineEditorDidDiscardEditing(this,b)}return YES},_endEditing:function(){this.set("isEditing",NO);this._target=null}};SC.InlineEditorDelegate={acquireEditor:function(a){},releaseEditor:function(a){},inlineEditorShouldBeginEditing:function(a,b){},inlineEditorWillBeginEditing:function(b,c,a){},inlineEditorDidBeginEditing:function(b,c,a){},inlineEditorShouldCommitEditing:function(b,c,a){},inlineEditorWillCommitEditing:function(b,c,a){},inlineEditorDidCommitEditing:function(b,c,a){},inlineEditorShouldDiscardEditing:function(b,a){},inlineEditorWillDiscardEditing:function(b,a){},inlineEditorDidDiscardEditing:function(b,a){},inlineEditorWillEndEditing:function(b,c,a){},inlineEditorDidEndEditing:function(b,c,a){}};SC.SCALE_NONE="none";SC.FILL="fill";SC.FILL_PROPORTIONALLY="fillProportionally";SC.BEST_FIT="fitBest";SC.BEST_FIT_DOWN_ONLY="fitBestDown";SC.InnerFrame={align:SC.ALIGN_CENTER,innerFrameForSize:function(a,c,h,b){var e=this.get("align"),d=this.get("scale"),g,f,i;i={x:0,y:0,width:h,height:b};if(d===SC.FILL){return i}g=h/a;f=b/c;switch(d){case SC.FILL_PROPORTIONALLY:d=g>f?g:f;break;case SC.BEST_FIT:d=g<f?g:f;break;case SC.BEST_FIT_DOWN_ONLY:if((a>h)||(c>b)){d=g<f?g:f}else{d=1}break;case SC.SCALE_NONE:d=1;break;default:if(isNaN(window.parseFloat(d))||(window.parseFloat(d)<=0)){SC.Logger.warn("SC.InnerFrame: The scale '%@' was not understood.  Scale must be one of SC.FILL, SC.FILL_PROPORTIONALLY, SC.BEST_FIT, SC.BEST_FIT_DOWN_ONLY or a positive number greater than 0.00.".fmt(d));return i}}a*=d;c*=d;i.width=Math.round(a);i.height=Math.round(c);switch(e){case SC.ALIGN_LEFT:i.x=0;i.y=(b/2)-(c/2);break;case SC.ALIGN_RIGHT:i.x=h-a;i.y=(b/2)-(c/2);break;case SC.ALIGN_TOP:i.x=(h/2)-(a/2);i.y=0;break;case SC.ALIGN_BOTTOM:i.x=(h/2)-(a/2);i.y=b-c;break;case SC.ALIGN_TOP_LEFT:i.x=0;i.y=0;break;case SC.ALIGN_TOP_RIGHT:i.x=h-a;i.y=0;break;case SC.ALIGN_BOTTOM_LEFT:i.x=0;i.y=b-c;break;case SC.ALIGN_BOTTOM_RIGHT:i.x=h-a;i.y=b-c;break;default:if(e!==SC.ALIGN_CENTER&&e!==SC.ALIGN_MIDDLE){SC.Logger.warn("SC.InnerFrame: The align '%@' was not understood.  Align must be one of SC.ALIGN_CENTER/SC.ALIGN_MIDDLE, SC.ALIGN_LEFT, SC.ALIGN_RIGHT, SC.ALIGN_TOP, SC.ALIGN_BOTTOM, SC.ALIGN_TOP_LEFT, SC.ALIGN_TOP_RIGHT, SC.ALIGN_BOTTOM_LEFT or SC.ALIGN_BOTTOM_RIGHT.".fmt(e))}i.x=(h/2)-(a/2);i.y=(b/2)-(c/2)}return i},scale:SC.FILL};SC.StaticLayout={hasStaticLayout:YES};SC.Validatable={initMixin:function(){this._validatable_validatorDidChange()},validator:null,errorLabel:null,isValid:function(){return SC.typeOf(this.get("value"))!==SC.T_ERROR}.property("value"),ownerForm:null,performValidate:function(c){var a=SC.VALIDATE_OK;if(this._validator){var b=this.get("ownerForm");if(c){a=this._validator.validatePartial(b,this);if((a==SC.VALIDATE_NO_CHANGE)&&(this._validator.validateChange(b,this)==SC.VALIDATE_OK)){a=SC.VALIDATE_OK}}else{a=this._validator.validateChange(b,this)}}return a},performValidateSubmit:function(){return this._validator?this._validator.validateSubmit(this.get("ownerForm"),this):SC.VALIDATE_OK},performValidateKeyDown:function(a){var b=a.getCharString();if(!b){return YES}return this._validator?this._validator.validateKeyDown(this.get("ownerForm"),this,b):YES},validatorObject:function(){return this._validator}.property(),validateSubmit:function(){return this.performValidateSubmit()},objectForFieldValue:function(b,a){return this._validator?this._validator.objectForFieldValue(b,this.get("ownerForm"),this):b},fieldValueForObject:function(a){return this._validator?this._validator.fieldValueForObject(a,this.get("ownerForm"),this):a},_validatable_displayObserver:function(){this.displayDidChange()}.observes("isValid"),renderMixin:function(a){a.setClass("invalid",!this.get("isValid"))},_validatable_validatorDidChange:function(){var a=this.get("ownerForm");var b=SC.Validator.findFor(a,this,this.get("validator"));if(b!=this._validator){this.propertyWillChange("validatorObject");if(this._validator){this._validator.detachFrom(a,this)}this._validator=b;if(this._validator){this._validator.attachTo(a,this)}this.propertyDidChange("validatorObject")}}.observes("validator","ownerForm")};SC.RenderDelegate={create:function(){var c=SC.beget(this);var b,a=arguments.length;for(b=0;b<a;b++){c.mixin(arguments[b])}return c},reopen:function(b){var c,a;for(c in b){a=b[c];if(!b.hasOwnProperty(c)){continue}if(typeof a==="function"&&a!==this[c]){a.base=this[c]||SC.K}if(a&&a.isEnhancement&&a!==this[c]){a=SC._enhance(this[c]||SC.K,a)}this[c]=a}},get:function(a){return this[a]},getPropertyFor:function(b,a){if(this[a+"For"]){return this[a+"For"](b,a)}return this[a]},className:undefined,render:function(b,a){},update:function(b,a){}};SC.RenderDelegate.extend=SC.RenderDelegate.create;SC.RenderDelegate.mixin=SC.RenderDelegate.reopen;sc_require("render_delegates/render_delegate");SC.BaseTheme.canvasImageRenderDelegate=SC.RenderDelegate.create({className:"canvasImage",render:function(d,b){var c=d.get("width")||0,a=d.get("height")||0;b.attr("width",c);b.attr("height",a)},update:function(a,e){var g=e[0],i=a.get("image"),d=a.get("frame"),l=d.width,j=d.height,k=a.get("innerFrame"),m=a.get("backgroundColor"),o=a.get("renderState"),b;var n=![k.x,k.y,k.width,k.height].isEqual(o._lastInnerFrameValues),h=![g.width,g.height].isEqual(o._lastElemSizeValues),f=a.didChangeFor("canvasImageRenderDelegate","backgroundColor"),c=a.didChangeFor("canvasImageRenderDelegate","image")||(i&&i.complete)!==o._lastImageComplete;if(h||n||f||c){if(g&&g.getContext){g.height=j;g.width=l;b=g.getContext("2d");b.clearRect(0,0,l,j);if(m){b.fillStyle=m;b.fillRect(0,0,l,j)}if(i&&i.complete){b.drawImage(i,Math.floor(k.x),Math.floor(k.y),Math.floor(k.width),Math.floor(k.height))}}o._lastInnerFrameValues=[k.x,k.y,k.width,k.height];o._lastElemSizeValues=[g.width,g.height];o._lastImageComplete=i&&i.complete}}});sc_require("render_delegates/render_delegate");SC.BaseTheme.containerRenderDelegate=SC.RenderDelegate.create({render:function(b,a){},update:function(){}});sc_require("render_delegates/render_delegate");SC.RenderDelegate.reopen({sizes:[SC.TINY_CONTROL_SIZE,SC.SMALL_CONTROL_SIZE,SC.REGULAR_CONTROL_SIZE,SC.LARGE_CONTROL_SIZE,SC.HUGE_CONTROL_SIZE,SC.JUMBO_CONTROL_SIZE],sizeFor:function(f){var e=f.get("controlSize"),c,b,a;if(e){if(!this[e]){this[e]={}}c=this[e];if(!c.name){c.name=e}return c}var d=f.get("frame");if(!d){c=this["sc-regular-size"];if(!c){c=this["sc-regular-size"]={}}if(!c.name){c.name="sc-regular-size"}return c}for(b=0;b<a;b++){key=sizes[b];c=this[key];if(!c){continue}if((c.width===undefined&&c.height===undefined&&c.minHeight===undefined&&c.minWidth===undefined&&c.maxHeight===undefined&&c.maxWidth===undefined)||(c.width!==undefined&&d.width!==c.width)||(c.minWidth!==undefined&&d.width<c.minWidth)||(c.maxWidth!==undefined&&d.width>c.maxWidth)||(c.height!==undefined&&d.height!==c.height)||(c.minHeight!==undefined&&d.height<c.minHeight)||(c.maxHeight!==undefined&&d.height<c.maxHeight)){continue}if(!c.name){c.name=key}return c}c=this["sc-regular-size"];if(!c){c=this["sc-regular-size"]={}}if(!c.name){c.name="sc-regular-size"}return c},addSizeClassName:function(c,b){var a=this.sizeFor(c);if(a){b.addClass(a.name)}},updateSizeClassName:function(c,a){var b=this.sizeFor(c);if(b){a.addClass(b.name)}},getPropertyFor:function(c,a){var b=this.sizeFor(c);if(b){if(b[a+"For"]){return b[a+"For"](c,a)}else{if(b[a]!==undefined){return b[a]}}}if(this[a+"For"]){return this[a+"For"]}return this[a]}});sc_require("render_delegates/render_delegate");SC.BaseTheme.imageRenderDelegate=SC.RenderDelegate.create({className:"image",render:function(f,c){var e=f.get("image"),b=f.get("imageValue"),d=f.get("type")||SC.IMAGE_TYPE_URL,a=f.get("toolTip");c=c.begin("img");c.attr("src",e.src);if(b&&d===SC.IMAGE_TYPE_CSS_CLASS){c.addClass(b);this._last_class=b}if(a){c.attr("title",a);c.attr("alt",a)}c.addStyle(this.imageStyles(f));c=c.end()},update:function(e,a){var d=e.get("image"),c=e.get("imageValue"),b=e.get("toolTip");a=a.find("img");a.attr("src",d.src);if(c!==this._last_class){a.setClass(this._last_class,NO)}if(c){a.addClass(c);this._last_class=c}if(b){a.attr("title",b);a.attr("alt",b)}a.css(this.imageStyles(e))},imageStyles:function(b){var a=b.get("innerFrame");return{position:"absolute",left:Math.round(a.x),top:Math.round(a.y),width:Math.round(a.width),height:Math.round(a.height)}}});sc_require("render_delegates/render_delegate");SC.BaseTheme.labelRenderDelegate=SC.RenderDelegate.create({className:"label",render:function(d,c){this.addSizeClassName(d,c);var a=d.get("toolTip");if(a){c.attr("title",a)}c.addStyle({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});c.setClass("ellipsis",d.get("needsEllipsis")||NO);c.setClass("icon",d.get("icon")||NO);var b=this.htmlForTitleAndIcon(d);c.push(b);d.get("renderState")._lastHTMLForTitleAndIcon=b},update:function(d,a){this.updateSizeClassName(d,a);a.css({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});var b=d.get("toolTip");if(b){a.attr("title",b)}else{a.removeAttr("title")}a.setClass("ellipsis",d.get("needsEllipsis")||NO);var c=this.htmlForTitleAndIcon(d);if(d.get("renderState")._lastHTMLForTitleAndIcon!==c){a.html(c);d.get("renderState")._lastHTMLForTitleAndIcon=c}},htmlForTitleAndIcon:function(f){var e=f.get("title"),d=f.get("hint"),a=f.get("hintEnabled"),c=f.get("escapeHTML"),b=f.get("icon")||"";if(e&&c){e=SC.RenderContext.escapeHTML(e)}if(a&&d&&!e){if(c){d=SC.RenderContext.escapeHTML(d)}e="<span class='sc-hint'>"+d+"</span>"}if(b){if(b.indexOf("/")>=0){b='<img src="'+b+'" alt="" class="icon" />'}else{b='<img src="'+SC.BLANK_IMAGE_URL+'" alt="" class="icon '+b+'" />'}}return b+(SC.none(e)?"":e)}});sc_require("core");SC.Benchmark={verbose:NO,enabled:YES,events:{},stats:{},globalStartTime:null,addEvent:function(a,b){if(!b){b=new Date().getTime()}this.events[a]=b},start:function(b,a,e,d){if(!this.enabled){return}var f=(e||Date.now()),c;if(a){c=this._subStatFor(b,a)}else{c=this._statFor(b)}if(d&&c._starts.length>0){c._starts.push("ignore")}else{c._starts.push(f)}c._times.push({start:f,_subStats:{}});return b},end:function(c,b,f){var e;if(!this.enabled){return}if(b){e=this._subStatFor(c,b)}else{e=this._statFor(c)}var g=e._starts.pop();if(!g){SC.Logger.log('SC.Benchmark "%@" ended without a matching start.  No information was saved.'.fmt(c));return}if(g=="ignore"){return}var a=(f||Date.now());var d=a-g;e._times[e._times.length-1].end=a;e._times[e._times.length-1].dur=d;e.amt+=d;e.runs++;if(this.verbose){this.log(c)}},setGlobalStartTime:function(a){this.globalStartTime=a},bench:function(e,d,a){if(!d){d="bench%@".fmt(this._benchCount++)}if(!a){a=1}var b;while(--a>=0){var c=SC.Benchmark.start(d);b=e();SC.Benchmark.end(c)}return b},install:function(a,d,b){a["b__"+d]=a[d];var c=a["b__"+d];a[d]=function(){var f="%@(%@)".fmt(d,$A(arguments).join(", "));SC.Benchmark.start(f,b);var e=c.apply(this,arguments);SC.Benchmark.end(f);return e}},restore:function(a,b){a[b]=a["b__"+b]},report:function(c){if(c){return this._genReport(c)}var b=[];for(var a in this.stats){if(!this.stats.hasOwnProperty(a)){continue}b.push(this._genReport(a))}return b.join("\n")},timelineReport:function(a){a=(a)?"SproutCore Application":a;var b=[a,"User-Agent: %@".fmt(navigator.userAgent),"Report Generated: %@ (%@)".fmt(new Date().toString(),Date.now()),""];var d=this._compileChartData(true);for(var c=0;c<d.length;c++){if(d[c][4]){b.push(this._timelineGenSubReport(d[c]))}else{b.push(this._timelineGenReport(d[c]))}}return b.join("\n")},getTimelineChartContent:function(){var l=this._compileChartData(false);var g=l.length;if(g===0){return}var c=this.globalStartTime?this.globalStartTime:l[0][1];var d=l[g-1][2]-c;var n=25+g*30;var q=Math.ceil(d/200)+1;var r=q*50;var m=10,s=300;var o="<div class = 'sc-benchmark-timeline-chart' style = 'position:relative;'>";o+="<div class = 'sc-benchmark-top'></div>";for(var p=0;p<q;p++){o+="<div class = 'sc-benchmark-tick' style = '";o+="left: "+(m+p*50)+"px; ";o+="height: "+n+"px;";o+="'></div>";o+="<div class = 'sc-benchmark-tick-label' style = '";o+="left: "+(m+p*50)+"px; ";o+="'>"+(p*200)+"ms</div>"}for(p=0;p<g;p++){o+="<div class = 'sc-benchmark-row ";o+=(p%2===0)?"even":"odd";o+="' style = '";o+="top: "+(50+(p*30))+"px; ";o+="'></div>";var j=document.createElement("div");var f=l[p][1];var e=l[p][2];var a=l[p][3];o+="<div class = 'sc-benchmark-bar' style = '";o+="left:"+(m+((f-c)/4))+"px; width: "+((a/4))+"px;";o+="top: "+(28+(p*30))+"px;";o+="' title = 'start: "+(f-c)+" ms, end: "+(e-c)+" ms, duration: "+a+" ms'";o+=">";o+="&nbsp;"+l[p][0]+" <span class='sc-benchmark-emphasis'>";o+=a+"ms (start: "+(f-c)+"ms)";o+="</span>";o+="</div>"}var b=this.events,k=0;for(p in b){var h=b[p]-c;o+="<div class = 'sc-benchmark-event idx"+(k%10)+"' style = '";o+="left: "+(m+h/4)+"px; height: "+n+"px; top: 20px;";o+="' title = '"+p+": "+h+"'></div>";k++}o+="</div>";return{html:o,totalCapturedTime:d,pointsCaptured:g,width:r+m+s,height:n}},getTimelineChartView:function(){var a=SC.ScrollView.create({contentView:SC.StaticContentView.extend({}),reload:function(){var b=SC.Benchmark.getTimelineChartContent();this.contentView.set("content",b.html);this.contentView.adjust({width:b.width,height:b.height});this.chartContent=b;SC.RunLoop.invokeLater(SC.Benchmark,function(){this.contentView.notifyPropertyChange("frame")})}});a.reload();return a},timelineChart:function(a){SC.RunLoop.begin();var c=0;this.hideChart();var b=this.getTimelineChartView();var e=b.chartContent.pointsCaptured,d=b.chartContent.totalCapturedTime;this._benchmarkChart=SC.Pane.create({classNames:["sc-benchmark-pane"],layout:{left:20,right:20,bottom:20,top:20},childViews:["title","exit"],exit:SC.ButtonView.extend({layout:{right:20,top:20,width:100,height:30},title:"Hide Chart",target:this,action:"hideChart"}),title:SC.LabelView.extend({classNames:["sc-benchmark-title"],layout:{left:20,top:23,right:200,height:30},value:((a)?a:"SproutCore Application")+(" - Total Captured Time: "+d+" ms - Points Captured: "+e),fontWeight:"bold"})}).append();b.set("layout",{left:20,top:60,bottom:20,right:20});this._benchmarkChart.appendChild(b);SC.RunLoop.end()},hideChart:function(){if(this._benchmarkChart){this._benchmarkChart.remove();this._benchmarkChart=null}return YES},tryToPerform:function(b,a){if(this[b]){return this[b](a)}return NO},log:function(d){var c=this.report(d).split("\n"),b=c.length,a;for(a=0;a<b;a++){SC.Logger.log(c[a])}},startProfile:function(a){if(!this.enabled){return}SC.Logger.profile(a)},endProfile:function(a){if(!this.enabled){return}SC.Logger.profileEnd(a)},loadPreloadEvents:function(){var f=SC.benchmarkPreloadEvents,e=[],b,a,c;if(typeof webkitPerformnce!=="undefined"){SC.mixin(f,webkitPerformane.timing)}if(!this.globalStartTime){var d=["navigation","navigationStart","headStart"];a=d.length;for(b=0;b<a;b++){if(f[d[b]]){this.globalStartTime=f[d[b]];break}}}this.javascriptStartTime=f.headStart;SC.mixin(this.events,f);this._hasLoadedPreloadEvents=true},_loadBenchmarksFromEvents:function(){if(!this._hasLoadedPreloadEvents){this.loadPreloadEvents()}var b=this.events;for(var a in b){if(a.substr(-3)!=="End"){continue}var c=a.substr(0,a.length-3);if(!b[c+"Start"]){continue}SC.Benchmark.start(c,undefined,b[c+"Start"]);SC.Benchmark.end(c,undefined,b[c+"End"]);delete b[c+"Start"];delete b[c+"End"]}},_compileChartData:function(g){this._loadBenchmarksFromEvents();var l=[],a;for(var m in this.stats){var e=this.stats[m];for(var f=0;f<e._times.length;f++){var n=e._times[f];a=(e._times.length>1)?(f+1)+" - "+m:m;l.push([a,n.start,n.end,n.dur,false]);if(g){var b=n._subStats;for(var c in b){var h=b[c];for(var d=0;d<h._times.length;d++){var o=h._times[d];a=(h._times.length>1)?(d+1)+" - "+c:c;l.push([a,o.start,o.end,o.dur,true])}}}}}l.sort(function(j,i){if(j[1]<i[1]){return -1}else{if(j[1]==i[1]){if(j[3]&&!i[3]){return -1}if(!j[3]&&i[3]){return 1}return 0}}return 1});return l},_genReport:function(a){var b=this._statFor(a);var d=(b.runs>0)?(Math.floor(b.amt*1000/b.runs)/1000):0;var c=b._times[b._times.length-1];return"BENCH %@ msec: %@ (%@x); latest: %@".fmt(d,(b.name||a),b.runs,c.end-c.start)},_timelineGenReport:function(a){if(this.globalStartTime){return"BENCH start: %@ msec, duration: %@ msec,  %@".fmt((a[1]-this.globalStartTime),a[3],a[0])}else{return"BENCH duration: %@ msec, %@".fmt(a[3],a[0])}},_timelineGenSubReport:function(a){if(this.globalStartTime){return"   CHECKPOINT BENCH start: %@ msec, duration: %@ msec,  %@".fmt((a[1]-this.globalStartTime),a[3],a[0])}else{return"   CHECKPOINT BENCH duration: %@ msec, %@".fmt(a[3],a[0])}},_subStatFor:function(d,c){var e=this.stats[c]._times.length;if(e===0){return}var a=this.stats[c]._times[this.stats[c]._times.length-1]._subStats;var b=a[d];if(!b){a[d]={runs:0,amt:0,name:d,_starts:[],_times:[]};b=a[d]}return b},_statFor:function(b){var a=this.stats[b];if(!a){a=this.stats[b]={runs:0,amt:0,name:b,_starts:[],_times:[]};a=this.stats[b]}return a},reset:function(){this.stats={}},_bench:function(b,a){SC.Benchmark.bench(b,a,1)},_benchCount:1};SC.Benchmark=SC.Benchmark;SC.Cookie=SC.Object.extend({name:null,value:"",expires:null,path:null,domain:null,secure:NO,isCookie:YES,destroy:function(){this.set("expires",-1);this.write();arguments.callee.base.apply(this,arguments)},write:function(){var d=this.get("name"),f=this.get("value"),a=this.get("expires"),h=this.get("path"),e=this.get("domain"),g=this.get("secure"),b="",c;if(a){if(typeof a===SC.T_NUMBER){c=new Date();c.setTime(c.getTime()+(a*24*60*60*1000))}else{if(SC.DateTime&&a.get&&a.get("milliseconds")){c=new Date(a.get("milliseconds"))}else{if(a.toUTCString&&a.toUTCString.apply){c=a}}}if(c){b="; expires="+c.toUTCString()}}if(!SC.none(h)){b+="; path="+h}if(!SC.none(e)){b+="; domain="+e}if(g===YES){b+="; secure"}document.cookie=d+"="+encodeURIComponent(f)+b;return this}});SC.Cookie.mixin({find:function(a){if(document.cookie&&document.cookie!==""){var d=document.cookie.split(";");for(var c=0;c<d.length;c++){var b=SC.String.trim(String(d[c]));if(b.substring(0,a.length+1)===(a+"=")){return SC.Cookie.create({name:a,value:decodeURIComponent(b.substring(a.length+1))})}}}return null}});SC.CookieMonster={nomNomNom:function(b){var a=SC.kindOf(b,SC.Cookie);if(a){SC.Logger.log("YUM!");return b.destroy()}SC.Logger.error("Y U PASS ME NO COOKIE? %@",b);return NO}};SC.mixin(SC.$.fn,{setClass:function(d,c){if(SC.none(d)){return this}var e=SC.typeOf(d)!==SC.T_STRING,a=this._fixupClass,b;this.each(function(){if(this.nodeType!==1){return}var h=this.className.split(/\s+/),g=NO;if(e){for(var f in d){if(d.hasOwnProperty(f)){g=a(h,f,d[f])||g}}}else{g=a(h,d,c)}if(g){this.className=h.join(" ")}});return this},_fixupClass:function(d,a,c){var b=d.indexOf(a);if(c){if(b<0){d.push(a);return YES}}else{if(b>=0){d[b]=null;return YES}}return NO}});SC.ExceptionHandler={enabled:(SC.buildMode!=="debug"),handleException:function(a){if(this.isShowingErrorDialog){return NO}this._displayErrorDialog(a);return NO},_displayErrorDialog:function(b){var a=this._errorDialogHTMLForException(b),c=document.createElement("div");c.style.cssText="left: 0px; right: 0px; top: 0px; bottom: 0px; position: absolute; background-color: white; background-color: rgba(255,255,255,0.6); z-index:100;";c.innerHTML=a;document.body.appendChild(c);this.isShowingErrorDialog=YES},_errorDialogHTMLForException:function(b){var a;a=['<div id="sc-error-dialog" style="position: absolute; width: 500px; left: 50%; top: 50%; margin-left: -250px; background-color: white; border: 1px solid black; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; padding: 10px">',"An error has occurred which prevents the application from running:","<br><br>",b.message,'<div id="sc-error-dialog-reload-button" onclick="window.location.reload();" style="float: right; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; border: 1px solid black; padding: 3px; clear: both; margin-top: 20px; cursor: pointer;">',"Reload","</div>","</div>"];return a.join("")},isShowingErrorDialog:NO};SC.IMAGE_ABORTED_ERROR=SC.$error("SC.Image.AbortedError","Image",-100);SC.IMAGE_FAILED_ERROR=SC.$error("SC.Image.FailedError","Image",-101);SC.imageQueue=SC.Object.create({loadLimit:4,activeRequests:0,loadImage:function(a,e,f,d){var b=SC.typeOf(e);if(SC.none(f)&&SC.typeOf(e)===SC.T_FUNCTION){e=null;f=e}if(SC.typeOf(f)===SC.T_STRING){f=e[f]}if(SC.none(d)){d=SC.none(e)&&SC.none(f)}var c=this._imageEntryFor(a);if(c.status===this.IMAGE_LOADED){if(f){f.call(e||c.image,c.url,c.image)}}else{if(e||f){this._addCallback(c,e,f)}c.retainCount++;this._scheduleImageEntry(c,d)}},releaseImage:function(a,d,e){var c=this._imageEntryFor(a,NO);if(!c){return this}if(--c.retainCount<=0){this._deleteEntry(c)}else{if(d||e){var b=SC.typeOf(d);if(SC.none(e)&&SC.typeOf(d)===SC.T_FUNCTION){d=null;e=d}if(SC.typeOf(e)===SC.T_STRING){e=d[e]}this._removeCallback(c,d,e)}}},reloadImage:function(a){var b=this._imageEntryFor(a,NO);if(b&&b.status===this.IMAGE_LOADED){b.status=this.IMAGE_WAITING}},loadNextImage:function(){var c=null,a;if(this.get("activeRequests")>=this.get("loadLimit")){return}a=this._foregroundQueue;while(a.length>0&&!c){c=a.shift()}if(!c){a=this._backgroundQueue;while(a.length>0&&!c){c=a.shift()}}this.set("isLoading",!!c);if(c){var b=c.image;if(!b){return}$(b).bind("abort",this._imageDidAbort);$(b).bind("error",this._imageDidError);$(b).bind("load",this._imageDidLoad);b.src=c.url;this._loading.push(c);this.incrementProperty("activeRequests");this.loadNextImage()}},_imageEntryFor:function(c,a){if(a===undefined){a=YES}var d=this._images[c];if(!d&&a){var b=new Image();d=this._images[c]={url:c,status:this.IMAGE_WAITING,callbacks:[],retainCount:0,image:b};b.entry=d}else{if(d&&d.image===null){d.image=new Image();d.image.entry=d}}return d},_deleteEntry:function(a){this._unscheduleImageEntry(a);delete this._images[a.url]},_addCallback:function(c,d,e){var b=c.callbacks;var a=b.find(function(f){return f[0]===d&&f[1]===e},this);if(!a){b.push([d,e])}b=null;return this},_removeCallback:function(b,c,d){var a=b.callbacks;a.forEach(function(f,e){if(f[0]===c&&f[1]===d){a[e]=null}},this);a=null;return this},_scheduleImageEntry:function(d,c){var b=this._backgroundQueue;var e=this._foregroundQueue;if(d.status===this.IMAGE_LOADED){return this}if((d.status===this.IMAGE_QUEUED)&&!c&&d.isBackground){b[b.indexOf(d)]=null;d.status=this.IMAGE_WAITING}if(d.status!==this.IMAGE_QUEUED){var a=(c)?b:e;a.push(d);d.status=this.IMAGE_QUEUED;d.isBackground=c}if(!this.isLoading){this.invokeLater(this.loadNextImage,100)}this.set("isLoading",YES);return this},_unscheduleImageEntry:function(b){if(b.status!==this.IMAGE_QUEUED){return this}var a=b.isBackground?this._backgroundQueue:this._foregroundQueue;a[a.indexOf(b)]=null;if(this._loading.indexOf(b)>=0){if(a.image){a.image.abort()}this.imageStatusDidChange(b,this.ABORTED)}return this},_imageDidAbort:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ABORTED)},this)},_imageDidError:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ERROR)},this)},_imageDidLoad:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.LOADED)},this)},imageStatusDidChange:function(c,a){if(!c){return}var b=c.url;var d;switch(a){case this.LOADED:d=c.image;break;case this.ABORTED:d=SC.IMAGE_ABORTED_ERROR;break;case this.ERROR:d=SC.IMAGE_FAILED_ERROR;break;default:d=SC.IMAGE_FAILED_ERROR;break}c.callbacks.forEach(function(f){var g=f[0],h=f[1];h.call(g,b,d)},this);c.callbacks=[];c.status=(a===this.LOADED)?this.IMAGE_LOADED:this.IMAGE_WAITING;var e=c.image;if(e){e.onload=e.onerror=e.onabort=null;if(a!==this.LOADED){c.image=null}}this._loading[this._loading.indexOf(c)]=null;if(this._loading.length>this.loadLimit*2){this._loading=this._loading.compact()}this.decrementProperty("activeRequests");this.loadNextImage()},init:function(){arguments.callee.base.apply(this,arguments);this._images={};this._loading=[];this._foregroundQueue=[];this._backgroundQueue=[]},IMAGE_LOADED:"loaded",IMAGE_QUEUED:"queued",IMAGE_WAITING:"waiting",ABORTED:"aborted",ERROR:"error",LOADED:"loaded"});SC.Math=SC.Object.create({near:function(c,b,a){if(!a){a=0.00001}return Math.abs(c-b)<=a},round:function(d,a){if(!a){a=0}var b=Math.pow(10,a);if(a<0){var c=b.toString();b=c.substring(0,c.indexOf("1")+1)}d=d.valueOf();return Math.round(d*b)/b}});SC.Task=SC.Object.extend({run:function(a){}});sc_require("tasks/task");SC.LOG_MODULE_LOADING=YES;SC.Module=SC.Object.create({isModuleReady:function(a){var b=SC.MODULE_INFO[a];return b?!!b.isReady:NO},loadModule:function(b,g,a){var c=SC.MODULE_INFO[b],h,f,i=SC.A(arguments).slice(3),d=SC.LOG_MODULE_LOADING,j,e;if(a===undefined&&SC.typeOf(g)===SC.T_FUNCTION){a=g;g=null}if(d){SC.debug("SC.Module: Attempting to load '%@'",b)}if(!c){throw"SC.Module: could not find module '%@'".fmt(b)}c.isPrefetching=NO;if(c.isLoaded&&!c.isWaitingForRunLoop){if(d){SC.debug("SC.Module: Module '%@' already loaded.",b)}if(!this._dependenciesMetForModule(b)){this._addCallbackForModule(b,g,a,i);this._loadDependenciesForModule(b);return NO}if(c.source){if(d){SC.debug("SC.Module: Evaluating JavaScript for module '%@'.",b)}this._evaluateStringLoadedModule(c);this._addCallbackForModule(b,g,a,i);this.invokeLast(function(){c.isReady=YES;this._moduleDidBecomeReady(b)});return NO}if(a){if(SC.isReady){SC.Module._invokeCallback(b,g,a,i)}else{SC.ready(SC.Module,function(){SC.Module._invokeCallback(b,g,a,i)})}}return YES}else{if(c.isWaitingForRunLoop){this._addCallbackForModule(b,g,a,i)}else{if(d){SC.debug("SC.Module: Module '%@' is not loaded, loading now.",b)}this._addCallbackForModule(b,g,a,i);if(!c.isLoading){this._loadDependenciesForModule(b);this._loadCSSForModule(b);this._loadJavaScriptForModule(b);c.isLoading=YES}return NO}}},_addCallbackForModule:function(b,e,f,a){var c=SC.MODULE_INFO[b];var d=c.callbacks||[];if(f){d.push(function(){SC.Module._invokeCallback(b,e,f,a)})}c.callbacks=d},prefetchModule:function(a){var b=SC.MODULE_INFO[a];if(b.isLoading||b.isLoaded){return}if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Prefetching module '%@'.",a)}this._loadDependenciesForModule(a);this._loadCSSForModule(a);this._loadJavaScriptForModule(a);b.isLoading=YES;b.isPrefetching=YES},_executeLazilyInstantiatedModule:function(b,c,i){var h=SC.LAZY_INSTANTIATION[b];var g;var a;var j,d;if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Module '%@' is marked for lazy instantiation, instantiating it now…",b)}d=h.length;for(j=0;j<d;j++){try{h[j]()}catch(f){SC.Logger.error("SC.Module: Failed to lazily instatiate entry for  '%@'".fmt(b))}}delete SC.LAZY_INSTANTIATION[b];g=this._targetForTargetName(c);a=this._methodForMethodNameInTarget(i,g);if(!a){throw"SC.Module: could not find callback for lazily instantiated module '%@'".fmt(b)}},_evaluateStringLoadedModule:function(b){var a=b.source;jQuery.globalEval(a);delete b.source;if(b.cssSource){var c=document.createElement("style");c.setAttribute("type","text/css");if(c.styleSheet){c.styleSheet.cssText=b.cssSource}else{var d=document.createTextNode(b.cssSource);c.appendChild(d)}document.getElementsByTagName("head")[0].appendChild(c)}b.isReady=YES},_loadCSSForModule:function(d){var f=document.getElementsByTagName("head")[0];var e=SC.MODULE_INFO[d];var h=e.styles||[];var b=h.length;var c;var g;var a;if(!f){f=document.documentElement}b=h.length;for(a=0;a<b;a++){c=h[a];if(c.length>0){if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Loading CSS file in '%@' -> '%@'",d,c)}g=document.createElement("link");g.setAttribute("href",c);g.setAttribute("rel","stylesheet");g.setAttribute("type","text/css");f.appendChild(g)}}g=null},_loadJavaScriptForModule:function(b){var c=SC.MODULE_INFO[b];var d;var a;var e=c.dependencies;var f=YES;if(e&&e.length>0){f=this._dependenciesMetForModule(b)}if(c.isPrefetched){a=c.stringURL}else{if(f){a=c.scriptURL}else{a=c.stringURL}}if(a.length>0){if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Loading JavaScript file in '%@' -> '%@'",b,a)}d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",a);if(SC.browser.isIE){d.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){SC.run(function(){SC.Module._moduleDidLoad(b)})}}}else{d.onload=function(){SC.run(function(){SC.Module._moduleDidLoad(b)})}}document.body.appendChild(d)}},_dependenciesMetForModule:function(c){var e=SC.MODULE_INFO[c].dependencies||[];var b,a=e.length;var f;var d;for(b=0;b<a;b++){f=e[b];d=SC.MODULE_INFO[f];if(!d){throw"SC.loadModule: Unable to find dependency %@ for module %@.".fmt(f,c)}if(!d.isReady){return NO}}return YES},_loadDependenciesForModule:function(a){var b=SC.MODULE_INFO[a];var e=SC.LOG_MODULE_LOADING;var i=b.dependencies||[];var f=YES;var g=i.length;var j;var d;var c;var h;for(j=0;j<g;j++){d=i[j];c=SC.MODULE_INFO[d];if(!c){throw"SC.Module: could not find required module '%@' for module '%@'".fmt(d,a)}else{if(c.isLoading){f=NO;h=c.dependents;if(!h){c.dependents=h=[]}h.push(a)}else{if(c.isReady){continue}else{f=NO;h=c.dependents;if(!h){c.dependents=h=[]}h.push(a);if(e){SC.debug("SC.Module: '%@' depends on '%@', loading dependency…",a,d)}SC.Module.loadModule(d)}}}}},_invokeCallback:function(c,d,a,b){var g;var f;f=this._targetForTargetName(d);g=this._methodForMethodNameInTarget(a,f);if(!g){if(SC.LAZY_INSTANTIATION[c]){this._executeLazilyInstantiatedModule(c,d,a);f=this._targetForTargetName(d);g=this._methodForMethodNameInTarget(a,f)}else{throw"SC.Module: could not find callback for '%@'".fmt(c)}}if(!b){b=[]}b.unshift(c);var e=!!SC.RunLoop.currentRunLoop;if(e){SC.run(function(){g.apply(f,b)})}else{g.apply(f,b)}},_invokeCallbacksForModule:function(c){var e=SC.MODULE_INFO[c],d;if(!e){return}if(SC.LOG_MODULE_LOADING){SC.debug("SC.Module: Module '%@' has completed loading, invoking callbacks.",c)}d=e.callbacks||[];for(var b=0,a=d.length;b<a;++b){d[b]()}},_evaluateAndInvokeCallbacks:function(a){var d=SC.MODULE_INFO;var b=d[a];var c=SC.LOG_MODULE_LOADING;if(c){SC.debug("SC.Module: Evaluating and invoking callbacks for '%@'.",a)}if(b.source){this._evaluateStringLoadedModule(b)}b.isWaitingForRunLoop=YES;this.invokeLast(function(){b.isReady=YES;this._moduleDidBecomeReady(a)})},_moduleDidBecomeReady:function(a){var c=SC.MODULE_INFO;var b=c[a];var d=SC.LOG_MODULE_LOADING;b.isWaitingForRunLoop=NO;if(SC.isReady){SC.Module._invokeCallbacksForModule(a);delete b.callbacks}else{SC.ready(SC,function(){SC.Module._invokeCallbacksForModule(a);delete b.callbacks})}var g=b.dependents||[];var e,i;for(var h=0,f=g.length;h<f;h++){e=g[h];i=c[e];if(i.isLoaded&&this._dependenciesMetForModule(e)){if(d){SC.debug("SC.Module: Now that %@ has loaded, all dependencies for a dependent %@ are met.",a,e)}this._evaluateAndInvokeCallbacks(e)}}},_moduleDidLoad:function(b){var c=SC.MODULE_INFO[b];var e=SC.LOG_MODULE_LOADING;var d;var f,a;if(e){SC.debug("SC.Module: Module '%@' finished loading.",b)}if(!c){if(e){SC.debug("SC._moduleDidLoad() called for unknown module '@'.",b)}c=SC.MODULE_INFO[b]={isLoaded:YES,isReady:YES};return}if(c.isLoaded){if(e){SC.debug("SC._moduleDidLoad() called more than once for module '%@'. Skipping.",b)}return}delete c.isLoading;c.isLoaded=YES;if(!c.isPrefetching){d=this._dependenciesMetForModule(b);if(d){this._evaluateAndInvokeCallbacks(b)}else{if(e){SC.debug("SC.Module: Dependencies for '%@' not met yet, waiting to evaluate.",b)}}}else{delete c.isPrefetching;if(e){SC.debug("SC.Module: Module '%@' was prefetched, not evaluating until needed.",b)}}},_targetForTargetName:function(a){if(SC.typeOf(a)===SC.T_STRING){return SC.objectForPropertyPath(a)}return a},_methodForMethodNameInTarget:function(a,b){if(SC.typeOf(a)===SC.T_STRING){return SC.objectForPropertyPath(a,b)}return a},methodsForSuspend:"loadModule _moduleDidLoad prefetchModule _moduleDidBecomeReady".w(),suspend:function(){this._suspendCount=(this._suspendCount||0)+1;if(this._suspendCount!==1){return}var a=this.get("methodsForSuspend"),e,d,c,b;for(b=0;c=a[b];b++){if(!this[e="__replacement_"+c+"__"]){(this[e]=function(){(this._bufferedCalls||(this._bufferedCalls=[])).push({method:arguments.callee.methodName,arguments:arguments})}).methodName=c}if(!this[d="__saved_"+c+"__"]){this[d]=this[c]}this[c]=this[e]}},resume:function(){this._suspendCount=(this._suspendCount||0)-1;if(this._suspendCount<0){SC.warn("SC.Module.resume() was called without SC.Module having been in a suspended state. Call aborted.");this._suspendCount=0;return}if(this._suspendCount>0){return}var a=this.get("methodsForSuspend"),d=this._bufferedCalls,c,b,f,e;for(b=0;(c=a[b]);b++){this[c]=this["__saved_"+c+"__"]}for(b=0;e=d&&d[b];b++){this[e.method].apply(this,e.arguments)}if(d){d.length=0}}});SC.ready(function(){var d=SC.MODULE_INFO;var b;var c;var a;for(b in d){c=d[b];if(c.isPrefetched){a=SC.Module.PrefetchModuleTask.create({prefetchedModuleName:b});SC.backgroundTaskQueue.push(a)}}});SC.Module.PrefetchModuleTask=SC.Task.extend({prefetchedModuleName:null,run:function(){SC.Module.prefetchModule(this.prefetchedModuleName)}});sc_require("tasks/task");SC.TaskQueue=SC.Task.extend({init:function(){var a=this;this._doIdleEntry=function(){a._idleEntry()};this._suspendCount=0;this._tasks=[]},runWhenIdle:NO,runLimit:50,interval:50,isRunning:NO,minimumIdleDuration:500,_tasks:null,hasTasks:function(){return this._tasks.length>0}.property("taskCount").cacheable(),taskCount:function(){return this._tasks.length}.property().cacheable(),push:function(a){this._tasks.push(a);this.notifyPropertyChange("taskCount")},next:function(){if(this._tasks.length<1){return null}var a=this._tasks.shift();this.notifyPropertyChange("taskCount");return a},suspend:function(){this._suspendCount++},resume:function(){this._suspendCount--;if(this._suspendCount<=0){this._setupIdle()}},_taskCountDidChange:function(){this._setupIdle()}.observes("taskCount"),_runWhenIdleDidChange:function(){this._setupIdle()}.observes("runWhenIdle"),_setupIdle:function(){if(!this._suspendCount&&this.get("runWhenIdle")&&!this._idleIsScheduled&&this.get("taskCount")>0){setTimeout(this._doIdleEntry,this.get("interval"));this._idleIsScheduled=YES}},_idleEntry:function(){this._idleIsScheduled=NO;var a=SC.RunLoop.lastRunLoopEnd;if(!this.get("runWhenIdle")&&!this._suspendCount){return}if(Date.now()-a>this.get("minimumIdleDuration")){SC.run(this.run,this);SC.RunLoop.lastRunLoopEnd=a}this._setupIdle()},run:function(a){this.set("isRunning",YES);if(!a){a=this.get("runLimit")}var b,c=Date.now();while(b=this.next()){b.run(this);if(Date.now()-c>a){break}}this.set("isRunning",NO)}});SC.backgroundTaskQueue=SC.TaskQueue.create({runWhenIdle:YES});SC.TextSelection=SC.Object.extend(SC.Copyable,SC.Freezable,{start:-1,end:-1,length:function(){var b=this.get("start");var a=this.get("end");if((b)===-1||(a===-1)){return -1}else{return a-b}}.property("start","end").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);this.freeze()},copy:function(){return SC.TextSelection.create({start:this.get("start"),end:this.get("end")})},toString:function(){var a=this.get("length");if(a&&a>0){if(a===1){return"[%@ character selected: {%@, %@}]".fmt(a,this.get("start"),this.get("end"))}else{return"[%@ characters selected: {%@, %@}]".fmt(a,this.get("start"),this.get("end"))}}else{return"[no text selected; caret at %@]".fmt(this.get("start"))}}});SC.UserDefaults=SC.Object.extend({ready:NO,userDomain:null,appDomain:null,_defaults:null,_safari3DB:null,defaults:function(a){this._defaults=a;this.allPropertiesDidChange()},readDefault:function(i){var a,d,b,j,h,k,g;i=this._normalizeKeyName(i);b=this._userKeyName(i);if(this._written){d=this._written[b]}a=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(a){j=document.body;try{j.load("SC.UserDefaults")}catch(c){SC.Logger.error("Couldn't load userDefaults in IE7: "+c.description)}}else{if(this.HTML5DB_noLocalStorage){g=this._safari3DB}else{j=window.localStorage;if(!j&&window.globalStorage){j=window.globalStorage[window.location.hostname]}}}if(j||g){h=["SC.UserDefaults",b].join("-at-");if(a){d=j.getAttribute(h.replace(/\W/gi,""))}else{if(g){d=this.dataHash[h]}else{d=j[h]}}if(!SC.none(d)){try{d=SC.json.decode(d)}catch(f){}}}k=this.delegate;if(k&&k.userDefaultsNeedsDefault){d=k.userDefaultsNeedsDefault(this,i,b)}if(SC.none(d)&&this._defaults){d=this._defaults[b]||this._defaults[i]}return d},writeDefault:function(k,i){var b,f,c,l,j,m,h;k=this._normalizeKeyName(k);f=this._userKeyName(k);c=this._written;if(!c){c=this._written={}}c[f]=i;b=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(b){l=document.body}else{if(this.HTML5DB_noLocalStorage){h=this._safari3DB}else{l=window.localStorage;if(!l&&window.globalStorage){l=window.globalStorage[window.location.hostname]}}}j=["SC.UserDefaults",f].join("-at-");if(l||h){var a=SC.json.encode(i);if(b){l.setAttribute(j.replace(/\W/gi,""),a);l.save("SC.UserDefaults")}else{if(h){var d=this;h.transaction(function(e){e.executeSql("delete from SCLocalStorage where key = ?",[j],function(){e.executeSql("insert into SCLocalStorage(key, value) VALUES ('"+j+"', '"+a+"');",[],d._nullDataHandler,d.killTransaction)})});this.dataHash[j]=a}else{try{l[j]=a}catch(g){SC.Logger.error("Failed using localStorage. "+g)}}}}m=this.delegate;if(m&&m.userDefaultsDidChange){m.userDefaultsDidChange(this,k,i,f)}return this},resetDefault:function(j){var b,a,f,c,k,i,h;b=this._normalizeKeyName(j);f=this._userKeyName(b);this.propertyWillChange(j);this.propertyWillChange(b);c=this._written;if(c){delete c[f]}a=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(a){k=document.body}else{if(this.HTML5DB_noLocalStorage){h=this._safari3DB}else{k=window.localStorage;if(!k&&window.globalStorage){k=window.globalStorage[window.location.hostname]}}}i=["SC.UserDefaults",f].join("-at-");if(k){if(a){k.setAttribute(i.replace(/\W/gi,""),null);k.save("SC.UserDefaults")}else{if(h){var d=this;h.transaction(function(e){e.executeSql("delete from SCLocalStorage where key = ?",[i],null)});delete this.dataHash[i]}else{try{delete k[i]}catch(g){SC.Logger.warn("Deleting local storage encountered a problem. "+g)}}}}this.propertyDidChange(j);this.propertyDidChange(b);return this},unknownProperty:function(a,b){if(b===undefined){return this.readDefault(a)}else{this.writeDefault(a,b);return b}},_normalizeKeyName:function(a){if(a.indexOf(":")<0){var b=this.get("appDomain")||"app";a=[b,a].join(":")}return a},_userKeyName:function(b){var a=this.get("userDomain")||"(anonymous)";return[a,b].join("-at-")},_domainDidChange:function(){var a=NO;if(this.get("userDomain")!==this._scud_userDomain){this._scud_userDomain=this.get("userDomain");a=YES}if(this.get("appDomain")!==this._scud_appDomain){this._scud_appDomain=this.get("appDomain");a=YES}if(a){this.allPropertiesDidChange()}}.observes("userDomain","appDomain"),init:function(){arguments.callee.base.apply(this,arguments);var a;jQuery.readyWait++;if(SC.userDefaults&&SC.userDefaults.get("dataHash")){var g=SC.userDefaults.get("dataHash");if(g){this.dataHash=SC.userDefaults.get("dataHash")}}this._scud_userDomain=this.get("userDomain");this._scud_appDomain=this.get("appDomain");a=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(a){document.body.addBehavior("#default#userData")}this.HTML5DB_noLocalStorage=SC.browser.isWebkit&&SC.browser.compare(SC.browser.engineVersion,"523")>0&&SC.browser.compare(SC.browser.engineVersion,"528")<0;if(this.HTML5DB_noLocalStorage){var b;try{if(!window.openDatabase){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}else{var h="scdb",f="1.0",i="SproutCore database",j=65536;b=openDatabase(h,f,i,j)}}catch(d){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}if(b){var c=this;b.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS SCLocalStorage(key TEXT NOT NULL PRIMARY KEY, value TEXT NOT NULL);",[],c._nullDataHandler,c.killTransaction)});b.transaction(function(e){e.parent=c;e.executeSql("SELECT * from SCLocalStorage;",[],function(p,m){var n={},o;for(var l=0,k=m.rows.length;l<k;l++){o=m.rows.item(l);n[o.key]=o.value}p.parent.dataHash=n;SC.run(function(){jQuery.ready(true)})},c.killTransaction)});this._safari3DB=b}}else{jQuery.ready(true)}},_killTransaction:function(b,a){return true},_nullDataHandler:function(b,a){}});SC.userDefaults=SC.UserDefaults.create();SC.mixin({convertHsvToHex:function(d,c,a){var b=SC.Color.hsvToRgb(d,c,a);return SC.Color.create({r:b[0],g:b[1],b:b[2]}).toHex()},convertHexToHsv:function(b){var a=SC.Color.from(b);return a&&SC.Color.rgbToHsv(a.r,a.g,a.b)},PARSE_COLOR_RGBRE:/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,PARSE_COLOR_HEXRE:/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,expandColor:function(b){var c,e,d,a;c=this.parseColor(b);if(c){e=parseInt(c.slice(1,3),16);d=parseInt(c.slice(3,5),16);a=parseInt(c.slice(5,7),16);return[e,d,a]}},parseColor:function(d){var e=0,a="#",c,b;if(c=this.PARSE_COLOR_RGBRE.exec(d)){for(e=1;e<=3;e++){b=Math.max(0,Math.min(255,parseInt(c[e],0)));a+=this.toColorPart(b)}return a}if(c=this.PARSE_COLOR_HEXRE.exec(d)){if(c[1].length==3){for(e=0;e<3;e++){a+=c[1].charAt(e)+c[1].charAt(e)}return a}return"#"+c[1]}return false},toColorPart:function(a){if(a>255){a=255}var b=a.toString(16);if(a<16){return"0"+b}return b}});SC.mixin({_downloadFrames:0,download:function(d){var a=document.createElement("iframe"),c="DownloadFrame_"+this._downloadFrames;SC.$(a).attr("id",c);a.style.border="10px";a.style.width="0px";a.style.height="0px";a.style.position="absolute";a.style.top="-10000px";a.style.left="-10000px";if(!SC.browser.isSafari){SC.$(a).attr("src",d)}document.getElementsByTagName("body")[0].appendChild(a);if(SC.browser.isSafari){SC.$(a).attr("src",d)}this._downloadFrames=this._downloadFrames+1;if(!SC.browser.isSafari){var b=function(){document.body.removeChild(document.getElementById(c));c=null};b.invokeLater(null,2000)}a=null},getStyle:function(a,b){var c="";if(document.defaultView&&document.defaultView.getComputedStyle){c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b)}else{if(a.currentStyle){b=b.replace(/\-(\w)/g,function(d,e){return e.toUpperCase()});c=a.currentStyle[b]}}return c},uniJapaneseConvert:function(e){var a,c="",b,d;for(b=0,d=e.length;b<d;b++){a=e.charCodeAt(b);a=((a>=65281&&a<=65392)?a-65248:a);a=(a===12540?45:a);c=c+String.fromCharCode(a)}return c},pointInElement:function(b,g,c,f){var h,d,a,e;g=jQuery(g);c=c||"border";h=SC.offset(g,f);if(c==="padding"){d=g.innerWidth();a=g.innerHeight();h.x+=window.parseInt(g.css("border-left-width").replace("px",""));h.y+=window.parseInt(g.css("border-top-width").replace("px",""))}else{d=g.outerWidth(c==="margin");a=g.outerHeight(c==="margin");if(c==="margin"){h.x-=window.parseInt(g.css("margin-left").replace("px",""));h.y-=window.parseInt(g.css("margin-top").replace("px",""))}}e={x:h.x,y:h.y,width:d,height:a};return SC.pointInRect(b,e)},switchScale:function(){$("head meta[name=viewport]").remove();if(window.innerWidth===window.screen.width){$("head").prepend('<meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5, user-scalable=0" />')}else{$("head").prepend('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0" />')}}});SC.mixin({ZERO_RANGE:{start:0,length:0},RANGE_NOT_FOUND:{start:0,length:-1},valueInRange:function(b,a){return(b>=0)&&(b>=a.start)&&(b<(a.start+a.length))},minRange:function(a){return a.start},maxRange:function(a){return(a.length<0)?-1:(a.start+a.length)},unionRanges:function(c,b){if((c==null)||(c.length<0)){return b}if((b==null)||(b.length<0)){return c}var d=Math.min(c.start,b.start),a=Math.max(SC.maxRange(c),SC.maxRange(b));return{start:d,length:a-d}},intersectRanges:function(c,b){if((c==null)||(b==null)){return SC.RANGE_NOT_FOUND}if((c.length<0)||(b.length<0)){return SC.RANGE_NOT_FOUND}var d=Math.max(SC.minRange(c),SC.minRange(b)),a=Math.min(SC.maxRange(c),SC.maxRange(b));if(a<d){return SC.RANGE_NOT_FOUND}return{start:d,length:a-d}},subtractRanges:function(c,b){if((c==null)||(b==null)){return SC.RANGE_NOT_FOUND}if((c.length<0)||(b.length<0)){return SC.RANGE_NOT_FOUND}var a=Math.max(SC.minRange(c),SC.minRange(b)),d=Math.min(SC.maxRange(c),SC.maxRange(b));if(a<d){return SC.RANGE_NOT_FOUND}return{start:d,length:a-d}},cloneRange:function(a){return{start:a.start,length:a.length}},rangesEqual:function(b,a){if(b===a){return true}if(b==null){return a.length<0}if(a==null){return b.length<0}return(b.start==a.start)&&(b.length==a.length)}});SC.mixin({bestStringMetricsForMaxWidth:function(a,x,n,z,w){if(!x){SC.warn("When calling bestMetricsForWidth, the second argument, maxWidth, is required. There's no reason to call this without a maxWidth.");return undefined}x=Math.ceil(parseFloat(x));var A=arguments.callee,h=SC.typeOf(n||(n=""))!==SC.T_STRING,m=h?n.style.maxWidth:undefined,o=(!h||n.cacheableForMetrics)?SC.cacheSlotFor(n,z,w,a):undefined,r=h?(A._applyMaxToEl||(A._applyMaxToEl=function(l,i){l.style.maxWidth=i+"px";return l})):(A._applyMaxToStr||(A._applyMaxToStr=function(l,i){return l.replace(/max-width:[^;]*;/g,"")+" max-width:"+i+"px"})),u=h?(A._removeMaxFromEl||(A._removeMaxFromEl=function(i){i.style.maxWidth="none";return i})):(A._removeMaxFromStr||(A._removeMaxFromStr=function(i){return i.replace(/max-width:[^;]*;/g,"")+" max-width:none"})),p=false;if(o){o.list||(o.list=[{width:Infinity,height:0}]);for(var v=1,t=o.list.length,C,b,D;v<t&&!D;v++){C=o.list[v];b=o.list[v-1];if(!C||!C.width){continue}if(x>=C.width){if((b&&b.width)||(x<=C.maxWidth)){return C}D=C}}}var q=r(n,x),s=SC.metricsForString(a,q,z,w),y=s.height,d=o?o.parent.height||(o.parent.height=SC.metricsForString("W",q,z).height):SC.metricsForString("W",q,z).height,c=Math.round(y/d);if(p){c--;y=c*d}if(y>d){var g=p?Math.ceil(s.width*2.5):s.width,k=p?s.width:Math.floor(s.width/2.5),B,f=new Date()*1,j=0;while(g-k>1||(s.height>y&&!p)||(s.height<y&&p)){j++;B=(g+k)/2;q=r(q,B);s=SC.metricsForString(a,q,z,w);if(s.height>y){k=B}else{g=B}}s.width=Math.ceil(B);s.height=y;s.maxWidth=x;s.lineHeight=d;s.lines=c;s.searchPerformed=true;s.searchTime=new Date()*1-f;s.searchCount=j}else{if(p){s=SC.metricsForString(a,q=u(q),z,w)}s.maxWidth=x;s.lineHeight=d;s.lines=c;s.searchPerformed=false}s.browserCorrection=0;if(SC.browser.isIE){s.browserCorrection=1}if(SC.browser.isMozilla){s.browserCorrection=1}s.width=Math.min(x,s.width+s.browserCorrection);if(o){var e=o.list[c];if(e&&e.maxWidth<x){e.maxWidth=x}if(!e){e=o.list[c]=s}}if(h){q.style.maxWidth=m}D=p?D:s;return D},cacheSlotFor:function(){var e=arguments.callee.caller,f=e.cache||(e.cache={});if(!arguments[0]){return f}var b=(arguments[0] instanceof Array||arguments[0].callee)?arguments[0]:arguments,d=b.length,a,c;for(c=0;c<d;c++){if(typeof(a=b[c])==="object"){a=SC.guidFor(a)}f=f[a]||(f[a]={parent:f})}return f},cachedVersionOf:function(){var a=function(c){var b=function(){var d=SC.cacheSlotFor(arguments);return d.result||(d.result=arguments.callee.func.apply(this,arguments))};b.func=c;return b};return a(a)}()});sc_require("tasks/task");SC.didPreloadBundle=function(){};SC.PreloadBundleTask=SC.Task.extend({bundle:null,target:"SC",action:"preloaded",run:function(a){var b;if(b=this.get("bundle")){var c=Date.now();SC.Module.loadModule(this.get("bundle"),this.get("target"),this.get("action"))}}});sc_require("system/string");SC.VALIDATE_OK=YES;SC.VALIDATE_NO_CHANGE=NO;SC.Validator=SC.Object.extend({fieldValueForObject:function(b,c,a){return b},objectForFieldValue:function(c,b,a){return c},validate:function(a,b){return true},validateError:function(a,b){return SC.$error(SC.String.loc("Invalid.General(%@)",b.get("fieldValue")),b.get("fieldKey"))},validateChange:function(b,c,a){return this.validate(b,c)?SC.VALIDATE_OK:this.validateError(b,c)},validateSubmit:function(a,b){return this.validate(a,b)?SC.VALIDATE_OK:this.validateError(a,b)},validatePartial:function(a,b){if(!b.get("isValid")){return this.validate(a,b)?SC.VALIDATE_OK:this.validateError(a,b)}else{return SC.VALIDATE_NO_CHANGE}},validateKeyDown:function(b,c,a){return true},attachTo:function(a,b){},detachFrom:function(a,b){}});SC.Validator.mixin({OK:true,NO_CHANGE:false,findFor:function(e,g,f){var c;if(!f){return}if(f instanceof SC.Validator){c=f}else{if(f.isClass){c=f.create()}else{if(SC.typeOf(f)===SC.T_STRING){var b=null;var a=f.match(/^(.+)\[(.*)\]/);if(a){f=a[1];b=a[2]}f=SC.String.classify(f);var d=SC.Validator[f];if(SC.none(d)){throw"validator %@ not found for %@".fmt(f,g)}else{if(b){if(!e){throw"named validator (%@) could not be found for field %@ because the field does not belong to a form".fmt(b,g)}if(!e._validatorHash){e._validatorHash={}}c=(b)?e._validatorHash[b]:null;if(!c){c=d.create()}if(b){e._validatorHash[b]=c}}else{c=d.create()}}}}}return c},fieldValueForObject:function(a,b,c){if(this.prototype&&this.prototype.fieldValueForObject){return this.prototype.fieldValueForObject(a,b,c)}else{return null}},objectForFieldValue:function(b,a,c){if(this.prototype&&this.prototype.objectForFieldValue){return this.prototype.objectForFieldValue(b,a,c)}else{return null}}});sc_require("validators/validator");SC.Validator.CreditCard=SC.Validator.extend({fieldValueForObject:function(a,b,c){if(typeof(a)=="string"&&a.length==16){a=[a.slice(0,4),a.slice(4,8),a.slice(8,12),a.slice(12,16)].join(" ")}return a},objectForFieldValue:function(b,a,c){return b.replace(/[\s-\.\:]/g,"")},validate:function(a,b){return this.checkNumber(b.get("fieldValue"))},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.CreditCard(%@)",a),a)},validateKeyDown:function(b,c,a){return !!a.match(/[0-9\- ]/)},checkNumber:function(h){if(!h||h.length===0){return YES}h=h.replace(/[^0-9]/g,"");var a="0123456789";var g=h.length;var f=parseInt(h,0);var l=h.toString();l=l.replace(/^\s+|\s+$/g,"");var k=0;var n=true;var b=false;var m;var d;for(var c=0;c<g;c++){m=""+l.substring(c,c+1);if(a.indexOf(m)=="-1"){n=false}}if(!n){b=false}if((g===0)&&(b)){b=false}else{if(g>=15){for(var e=g;e>0;e--){d=parseInt(f,0)%10;d=parseInt(d,0);k+=d;e--;f=f/10;d=parseInt(f,0)%10;d=d*2;switch(d){case 10:d=1;break;case 12:d=3;break;case 14:d=5;break;case 16:d=7;break;case 18:d=9;break;default:d=d}f=f/10;k+=d}if((k%10)===0){b=true}else{b=false}}}return b}});sc_require("validators/validator");SC.Validator.Date=SC.Validator.extend({format:"%b %d, %Y %i:%M:%S %p",fieldValueForObject:function(a,b,e){var d=this.get("format"),c;if(SC.typeOf(a)===SC.T_NUMBER){c=SC.DateTime.create(a)}else{if(a instanceof Date){c=a.getTime()}}if(c){a=c.toFormattedString(d)}return a},objectForFieldValue:function(c,a,e){var d=this.get("format"),b;if(c){b=SC.DateTime.parse(c,d);c=b?b._ms:null}return c}});sc_require("validators/validator");SC.Validator.DateTime=SC.Validator.extend({format:"%d/%m/%Y",fieldValueForObject:function(a,b,c){if(SC.kindOf(a,SC.DateTime)){a=a.toFormattedString(this.get("format"))}else{a=null}return a},objectForFieldValue:function(b,a,c){if(b){b=SC.DateTime.parse(b,this.get("format"))}return b}});sc_require("validators/validator");SC.Validator.Email=SC.Validator.extend({validate:function(a,b){return(b.get("fieldValue")||"").match(/.+@.+\...+/)},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Email(%@)",a),a)}});SC.Validator.EmailOrEmpty=SC.Validator.Email.extend({validate:function(a,c){var b=c.get("fieldValue");return(b&&b.length>0)?b.match(/.+@.+\...+/):true}});sc_require("validators/validator");SC.Validator.NotEmpty=SC.Validator.extend({validate:function(a,c){var b=c.get("fieldValue");if(SC.none(b)){return NO}if(!SC.none(b.length)){return b.length>0}return YES},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.NotEmpty(%@)",SC.String.capitalize(a)),c.get("errorLabel"))}});sc_require("validators/validator");sc_require("system/utils/misc");SC.Validator.Number=SC.Validator.extend({places:0,fieldValueForObject:function(a,b,c){switch(SC.typeOf(a)){case SC.T_NUMBER:a=a.toFixed(this.get("places"));break;case SC.T_NULL:case SC.T_UNDEFINED:a="";break}return a},objectForFieldValue:function(c,b,d){var a;c=c.replace(/,/g,"");switch(SC.typeOf(c)){case SC.T_STRING:if(c.length===0){c=null}else{if(this.get("places")>0){c=parseFloat(c)}else{if(c.length===1&&c.match(/-/)){c=null}else{a=parseInt(c,0);if(isNaN(a)){c=SC.uniJapaneseConvert(c);c=parseInt(c,0);if(isNaN(c)){c=""}}else{c=a}}}}break;case SC.T_NULL:case SC.T_UNDEFINED:c=null;break}return c},validate:function(a,c){var b=c.get("fieldValue");return(b==="")||!(isNaN(b)||isNaN(parseFloat(b)))},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Number(%@)",a),a)},validateKeyDown:function(b,c,a){if(!a){a=""}var d=c.$input().val();if(!d){d=""}d+=a;if(this.get("places")===0){if(a.length===0){return true}else{return d.match(/^[\-{0,1}]?[0-9,\0]*/)[0]===d}}else{if(a.length===0){return true}else{return d.match(/^[\-{0,1}]?[0-9,\0]*\.?[0-9\0]+/)===d}}}});sc_require("validators/validator");SC.Validator.Password=SC.Validator.extend({attachTo:function(a,b){arguments.callee.base.apply(this,arguments);if(!this.fields){this.fields=[]}this.fields.push(b)},validate:function(e){if(!this.fields||this.fields.length===0){return true}var d=false;var b=false;var a=true;var c=this.fields[0].get("fieldValue");this.fields.forEach(function(g){var f=g.get("fieldValue");if(f!=c){a=false}if(!f||f.length===0){d=true}if(f&&f.length>0){b=true}});if(e){return(b===false)?false:a}else{return(d===true)?true:a}},updateFields:function(c,b){if(!this.fields||this.fields.length===0){return true}var a=SC.String.loc("Invalid.Password");var d=this._field;this.fields.forEach(function(e){var g=(b)?null:((e==d)?a:"");c.setErrorFor(e,g)});return(b)?SC.VALIDATE_OK:a},validateChange:function(b,c,a){return this.updateFields(b,this.validate(false))},validateSubmit:function(a,b){return this.updateFields(a,this.validate(true))},validatePartial:function(b,c){var a=!this._field.get("isValid");if(a){return this.updateFields(b,this.validate(false))}else{return SC.VALIDATE_NO_CHANGE}}});sc_require("validators/validator");SC.Validator.PositiveInteger=SC.Validator.extend({defaultValue:null,fieldValueForObject:function(a,b,c){switch(SC.typeOf(a)){case SC.T_NUMBER:a=a.toFixed(0);break;case SC.T_NULL:case SC.T_UNDEFINED:a=this.get("defaultValue");break}return a},objectForFieldValue:function(b,a,c){b=b.replace(/,/g,"");switch(SC.typeOf(b)){case SC.T_STRING:if(b.length===0){b=this.get("defaultValue")}else{b=parseInt(b,0)}break;case SC.T_NULL:case SC.T_UNDEFINED:b=this.get("defaultValue");break}if(isNaN(b)){return this.get("defaultValue")}return b},validate:function(a,c){var b=c.get("fieldValue");return(b==="")||!isNaN(b)},validateError:function(b,c){var a=c.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Number(%@)",a),a)},validateKeyDown:function(b,c,a){var d=c.$input().val();if(!d){d=""}d+=a;if(a.length===0){return true}else{return d.match(/^[0-9\0]*/)[0]===d}}});SC.ContainerView=SC.View.extend({classNames:["sc-container-view"],renderDelegateName:"containerRenderDelegate",nowShowing:null,contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(a){this.removeAllChildren();if(a){this.appendChild(a)}},createChildViews:function(){var a=this.get("contentView");if(a){a=this.contentView=this.createChildView(a);this.childViews=[a]}},awake:function(){arguments.callee.base.apply(this,arguments);var a=this.get("nowShowing");if(a&&a.length>0){this.nowShowingDidChange()}},nowShowingDidChange:function(){var c=this.get("nowShowing");if(c===SC.CONTENT_SET_DIRECTLY){return}var a=(this._instantiatedLastView===YES)?this.get("contentView"):null;this._instantiatedLastView=NO;if(SC.typeOf(c)===SC.T_STRING&&c.length>0){if(c.indexOf(".")>0){c=SC.objectForPropertyPath(c)}else{var b=this.getPath(c);c=SC.kindOf(b,SC.CoreView)?b:SC.objectForPropertyPath(c,this.get("page"))}}if(SC.typeOf(c)===SC.T_CLASS){if(c.kindOf(SC.CoreView)){c=this.createChildView(c);this._instantiatedLastView=YES}else{c=null}}if(c&&!(c instanceof SC.CoreView)){c=null}this.set("contentView",c);if(a){a.destroy()}}.observes("nowShowing"),contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView")});sc_require("mixins/validatable");SC.FieldView=SC.View.extend(SC.Control,SC.Validatable,{fieldValue:function(){var a=this.get("value");if(SC.typeOf(a)===SC.T_ERROR){a=a.get("errorValue")}return this.fieldValueForObject(a)}.property("value","validator").cacheable(),$input:function(){var a=this._inputElementTagName();return this.$(a).andSelf().filter(a)},_inputElementTagName:function(){return"input"},setFieldValue:function(b){if(SC.none(b)){b=""}var a=this.$input();if(a.val()!==b){a.val(b)}return this},getFieldValue:function(){return this.$input().val()},_field_fieldValueDidChange:function(a){SC.run(function(){this.fieldValueDidChange(NO)},this)},fieldValueDidChange:function(a){var c=this.getFieldValue();var b=this.objectForFieldValue(c,a);this.setIfChanged("value",b)},_field_valueDidChange:function(){this.setFieldValue(this.get("fieldValue"))}.observes("fieldValue"),didCreateLayer:function(){this.setFieldValue(this.get("fieldValue"));this._addChangeEvent()},willDestroyLayer:function(){SC.Event.remove(this.$input(),"change",this,this._field_fieldValueDidChange)},mouseDown:function(a){this._field_isMouseDown=YES;a.allowDefault();return YES},mouseExited:function(a){if(this._field_isMouseDown){this.set("isActive",NO)}a.allowDefault();return YES},mouseEntered:function(a){this.set("isActive",this._field_isMouseDown);a.allowDefault();return YES},mouseUp:function(a){if(this._field_isMouseDown){this.set("isActive",NO)}this._field_isMouseDown=NO;a.allowDefault();return YES},keyDown:function(b){if(b.which===9||b.keyCode===9){var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES}if(this.performValidateKeyDown(b)){this._isKeyDown=YES;b.allowDefault()}else{b.stop()}return YES},acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),_addChangeEvent:function(){SC.Event.add(this.$input(),"change",this,this._field_fieldValueDidChange)},_field_setFieldValue:function(b){this.propertyWillChange("fieldValue");if(this.fieldValueForObject){b=this.fieldValueForObject(b)}var a=this.setFieldValue(b);this.propertyDidChange("fieldValue");return a},_field_getFieldValue:function(){var a=this.getFieldValue();if(this.objectForFieldValue){a=this.objectForFieldValue(a)}return a}});SC.IMAGE_STATE_NONE="none";SC.IMAGE_STATE_LOADING="loading";SC.IMAGE_STATE_LOADED="loaded";SC.IMAGE_STATE_FAILED="failed";SC.IMAGE_TYPE_NONE="NONE";SC.IMAGE_TYPE_URL="URL";SC.IMAGE_TYPE_CSS_CLASS="CSS_CLASS";SC.BLANK_IMAGE_DATAURL="data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw==";SC.BLANK_IMAGE_URL=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"8")<0?"/static/sproutcore/foundation/en/10d3bc350f4f17581da3a45c0875ecac95f83355/source/resources/blank.gif":SC.BLANK_IMAGE_DATAURL;SC.BLANK_IMAGE=new Image();SC.BLANK_IMAGE.src=SC.BLANK_IMAGE_URL;SC.BLANK_IMAGE.width=SC.BLANK_IMAGE.height=1;SC.ImageView=SC.View.extend(SC.Control,SC.InnerFrame,{classNames:"sc-image-view",displayProperties:["frame","image","innerFrame","toolTip","imageValue","type"],renderDelegateName:function(){return(this.get("useCanvas")?"canvasImage":"image")+"RenderDelegate"}.property("useCanvas").cacheable(),tagName:function(){return this.get("useCanvas")?"canvas":"div"}.property("useCanvas").cacheable(),canLoadInBackground:NO,image:SC.BLANK_IMAGE,imageValue:function(){var a=this.get("value");return a&&a.isEnumerable?a.firstObject():a}.property("value").cacheable(),innerFrame:function(){var c=this.get("image"),b=c.width,a=c.height,d=this.get("frame");if(SC.none(d)){return{x:0,y:0,width:0,height:0}}return this.innerFrameForSize(b,a,d.width,d.height)}.property("align","image","scale","frame").cacheable(),localize:YES,status:SC.IMAGE_STATE_NONE,type:function(){var a=this.get("imageValue");if(SC.ImageView.valueIsUrl(a)){return SC.IMAGE_TYPE_URL}else{if(!SC.none(a)){return SC.IMAGE_TYPE_CSS_CLASS}}return SC.IMAGE_TYPE_NONE}.property("imageValue").cacheable(),useCanvas:function(){return SC.platform.supportsCanvas&&!this.get("useStaticLayout")&&this.get("type")!==SC.IMAGE_TYPE_CSS_CLASS}.property("useStaticLayout","type").cacheable(),useImageQueue:YES,value:null,viewDidResize:function(){var b=this.get("layer"),c,a;if(b){c=b.offsetWidth;a=b.offsetHeight;if(this._cachedWidth!==c||this._cachedHeight!==a){this.notifyPropertyChange("frame");this._cachedWidth=c;this._cachedHeight=a}}},init:function(){arguments.callee.base.apply(this,arguments);this._image_valueDidChange();if(this.get("useImageCache")!==undefined){SC.Logger.warn("%@ has useImageCache set, please set useImageQueue instead".fmt(this));this.set("useImageQueue",this.get("useImageCache"))}},layerDidChange:function(){if(this.get("useCanvas")){this.set("layerNeedsUpdate",YES)}}.observes("layer"),_image_valueDidChange:function(){var b=this.get("imageValue"),a=this.get("type");if(b!==this._iv_value){this._iv_value=b;this.set("image",SC.BLANK_IMAGE);if(a!==SC.IMAGE_TYPE_CSS_CLASS){this.set("status",SC.IMAGE_STATE_LOADING);if(!this._loadImageUsingCache()){this._loadImage()}}}}.observes("imageValue"),_loadImageUsingCache:function(){var c=this.get("imageValue"),b=this.get("type");if(b===SC.IMAGE_TYPE_URL&&this.get("useImageQueue")){var a=this.get("isVisibleInWindow")||this.get("canLoadInBackground");SC.imageQueue.loadImage(c,this,this._loadImageUsingCacheDidComplete,a);return YES}return NO},_loadImageUsingCacheDidComplete:function(a,c){var b=this.get("imageValue");if(b===a){if(SC.ok(c)){this.didLoad(c)}else{this.didError(c)}}},_loadImage:function(){var d=this.get("imageValue"),b=this.get("type"),c=this,f,a;if(b===SC.IMAGE_TYPE_URL){f=new Image();var e=function(){SC.run(function(){c._loadImageDidComplete(d,SC.$error("SC.Image.FailedError","Image",-101))})};var g=function(){SC.run(function(){c._loadImageDidComplete(d,f)})};a=$(f);a.bind("error",e);a.bind("abort",e);a.bind("load",g);f.src=d;return YES}return NO},_loadImageDidComplete:function(a,c){var b=this.get("imageValue");if(b===a){if(SC.ok(c)){this.didLoad(c)}else{this.didError(c)}}},didLoad:function(a){this.set("status",SC.IMAGE_STATE_LOADED);if(!a){a=SC.BLANK_IMAGE}this.set("image",a)},didError:function(a){this.set("status",SC.IMAGE_STATE_FAILED);this.set("image",SC.BLANK_IMAGE)}});SC.ImageView.valueIsUrl=function(a){return a&&SC.typeOf(a)===SC.T_STRING?a.indexOf("/")>=0:NO};sc_require("views/field");sc_require("system/text_selection");sc_require("mixins/static_layout");sc_require("mixins/editable");SC.TextFieldView=SC.FieldView.extend(SC.StaticLayout,SC.Editable,{classNames:["sc-text-field-view"],isTextField:YES,applyImmediately:YES,commitOnBlur:YES,isPassword:NO,isTextArea:NO,focused:NO,hint:"",type:"text",isBrowserFocusable:YES,autoCorrect:YES,autoCapitalize:YES,formattedHint:function(){var a=this.get("hint");return typeof(a)==="string"&&this.get("localize")?SC.String.loc(a):a}.property("hint","localize").cacheable(),hintOnFocus:YES,localize:YES,isEditing:NO,defaultTabbingEnabled:YES,isContextMenuEnabled:YES,continuouslyUpdatesValue:null,allowsErrorAsValue:YES,leftAccessoryView:null,rightAccessoryView:null,spellCheckEnabled:YES,maxLength:5096,shouldRenderBorder:YES,supportsAutoResize:YES,autoResizeLayer:function(){return this.$input()[0]}.property("layer").cacheable(),autoResizeText:function(){return this.get("value")}.property("value").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",20),_hintON:YES,init:function(){var a=this.get("value");this._hintON=((!a||a&&a.length===0)&&!this.get("hintOnFocus"))?YES:NO;var b=this.get("continouslyUpdatesValue");if(b!==null&&b!==undefined){this.set("applyImmediately",b)}return arguments.callee.base.apply(this,arguments)},isEditable:YES,selection:function(l,j){var d=this.$input()[0],f,a,c;if(j===undefined){if(d){a=null;c=null;if(!d.value){a=c=0}else{try{if("selectionStart" in d){a=d.selectionStart}if("selectionEnd" in d){c=d.selectionEnd}}catch(g){return null}if(a===null||c===null){var k=document.selection;if(k){var i=k.type;if(i&&(i==="None"||i==="Text")){f=k.createRange();if(!this.get("isTextArea")){var b=f.text.length;a=Math.abs(f.moveStart("character",0-(d.value.length+1)));c=a+b}else{var h=f.duplicate();h.moveToElementText(d);h.setEndPoint("EndToStart",f);a=h.text.length;c=a+f.text.length}}}}}return SC.TextSelection.create({start:a,end:c})}else{return null}}else{if(!j||!j.kindOf||!j.kindOf(SC.TextSelection)){throw"When setting the selection, you must specify an SC.TextSelection instance."}if(d){if(d.setSelectionRange){d.setSelectionRange(j.get("start"),j.get("end"))}else{f=d.createTextRange();a=j.get("start");f.move("character",a);f.moveEnd("character",j.get("end")-a);f.select()}}return j}}.property("fieldValue").cacheable(),displayProperties:["isBrowserFocusable","formattedHint","fieldValue","isEditing","isEditable","leftAccessoryView","rightAccessoryView","isTextArea"],createChildViews:function(){arguments.callee.base.apply(this,arguments);this.accessoryViewObserver()},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),accessoryViewObserver:function(){var f,h=["leftAccessoryView","rightAccessoryView"],a=h.length,b,e,d,g;for(b=0;b<a;b++){e=h[b];d=this["_"+e];g=this.get(e);if(!(d&&g&&(d===g))){if(d){f=d.get("classNames");f=f.without("sc-text-field-accessory-view");d.set("classNames",f);this.removeChild(d);d=null;this["_"+e]=null}if(g){if(g.isClass){g=g.create({layoutView:this})}f=g.get("classNames");var c="sc-text-field-accessory-view";if(f.indexOf(c)<0){f=SC.clone(f);f.push(c);g.set("classNames",f)}this.appendChild(g);this["_"+e]=g}}}}.observes("leftAccessoryView","rightAccessoryView"),layoutChildViewsIfNeeded:function(a){if(!a){a=this.get("isVisibleInWindow")}if(a&&this.get("childViewsNeedLayout")){var b=this.get("rightAccessoryView");if(b&&b.get){var c=b.get("layout");if(c){c.left=null;if(!c.right){c.right=0}b.adjust({layout:c})}}}arguments.callee.base.apply(this,arguments)},render:function(e,f){arguments.callee.base.apply(this,arguments);var a,d,c,b;a=this.get("fieldValue");if(SC.none(a)){a=""}a=String(a);e.setClass("not-empty",a.length>0);d=this._getAccessoryViewWidths();c=d.left;b=d.right;if(c){c+="px"}if(b){b+="px"}this._renderField(e,f,a,c,b)},_forceRenderFirstTime:NO,_renderFieldLikeFirstTime:function(){this.set("_forceRenderFirstTime",YES)}.observes("isTextArea"),_renderField:function(f,k,w,i,q){var r=this.get("formattedHint"),b=this.get("hintOnFocus"),n="",j=this.get("maxLength"),u=this.get("isTextArea"),B=this.get("isEnabled"),o=this.get("isEditable"),s=this.get("autoCorrect"),C=this.get("autoCapitalize"),l=this.get("isBrowserFocusable"),F="",e="",d="",E,x,g,A,c,m,h,a,v,t;f.setClass("text-area",u);a=SC.browser.isWebkit&&SC.browser.compare(SC.browser.engineVersion,"532")<0;f.setClass("oldWebKitFieldPadding",a);if(k||this._forceRenderFirstTime){this._forceRenderFirstTime=NO;v=B?(o?"":'readonly="readonly"'):'disabled="disabled"';E=this.get("layerId");F=this.get("spellCheckEnabled")?' spellcheck="true"':' spellcheck="false"';if(s!=null){d=" autocorrect="+(!s?'"off"':'"true"')}if(s!=null){e=" autocapitalize="+(!C?'"off"':'"true"')}if(l){t='tabindex="-1"'}if(SC.platform.input.placeholder&&!b){n=' placeholder="'+r+'"'}if(this.get("shouldRenderBorder")){f.push('<div class="border"></div>')}x="";if(i||q){x='style="';if(i){x+="left:"+i+";"}if(q){x+="right:"+q+";"}x+='"'}f.push('<div class="padding" '+x+">");w=this.get("escapeHTML")?SC.RenderContext.escapeHTML(w):w;if(this._hintON&&!SC.platform.input.placeholder&&(!w||(w&&w.length===0))){w=r;f.setClass("sc-hint",YES)}if(b){var y='<div aria-hidden="true" class="hint '+(u?"":"ellipsis")+'%@">'+r+"</div>";f.push(y.fmt(w?" sc-hidden":""))}h="field";if(u){f.push('<textarea aria-label="'+r+'" aria-multiline="true" class="'+h+'" name="'+E+'" '+v+n+F+d+t+e+' maxlength="'+j+'">'+w+"</textarea></div>")}else{g=this.get("type");if(this.get("isPassword")){g="password"}f.push('<input aria-label="'+r+'" class="'+h+'" type="'+g+'" name="'+E+'" '+v+' value="'+w+'"'+n+F+t+' maxlength="'+j+'" '+d+" "+e+"/></div>")}}else{var p=this.$input(),z=p[0],D=this.get("value");if(b){this.$(".hint")[0].innerHTML=r}else{if(!b){z.placeholder=r}}if(SC.browser.name===SC.BROWSER.ie&&SC.browser.version<=8&&!u){p.css("line-height",this.get("frame").height+"px")}if(!D||(D&&D.length===0)){if(this.get("isPassword")){z.type="password"}if(!SC.platform.input.placeholder&&this._hintON){if(!this.get("isFirstResponder")){f.setClass("sc-hint",YES);p.val(r)}else{f.setClass("sc-hint",NO);p.val("")}}}if(s!=null){p.attr("autoCorrect",!s?"off":"true")}else{p.attr("autoCorrect",null)}if(C!=null){p.attr("autoCapitalize",!C?"off":"true")}else{p.attr("autoCapitalize",null)}if(!b&&SC.platform.input.placeholder){p.attr("placeholder",r)}if(l){p.removeAttr("tabindex")}else{p.attr("tabindex","-1")}c=p[0];if(c){if(!B){c.disabled="true";c.readOnly=null}else{if(!o){c.disabled=null;c.readOnly="true"}else{c.disabled=null;c.readOnly=null}}m=c.parentNode.style;if(i){if(m.left!==i){m.left=i}}else{m.left=null}if(q){if(m.right!==q){m.right=q}}else{m.right=null}}}},_getAccessoryViewWidths:function(){var c={},k=["left","right"],d=k.length,f,g,l,j,a,h,e,b;for(f=0;f<d;f++){g=k[f];l=this["_"+g+"AccessoryView"];if(l&&l.isObservable){b=l.get("frame");if(b){a=b.width;if(a){h=l.get("layout");if(h){e=h[g];a+=e}c[g]=a}}}}return c},didCreateLayer:function(){arguments.callee.base.apply(this,arguments);if(!SC.platform.input.placeholder){this.invokeLast(this._setInitialPlaceHolderIE)}if(this.get("isTextArea")){this.invokeLast(this._addTextAreaEvents)}else{this._addTextAreaEvents();if(SC.browser.isMozilla){var a=this.$input();SC.Event.add(a,"keypress",this,this._firefox_dispatch_keypress)}}if(this.get("hintOnFocus")||(SC.browser.name===SC.BROWSER.ie&&SC.browser.version<=8&&!this.get("isTextArea"))){this.invokeLast(this._fixupTextLayout)}},_fixupTextLayout:function(){var a=this.get("frame").height;if(SC.browser.name===SC.BROWSER.ie&&SC.browser.version<=8&&!this.get("isTextArea")){this.$input().css("line-height",a+"px")}if(this.get("hintOnFocus")&&!this.get("isTextArea")){this.$(".hint").css("line-height",this.$(".hint").outerHeight()+"px")}},_setInitialPlaceHolderIE:function(){if(!SC.platform.input.placeholder&&this._hintON){var a=this.$input(),b=a.val();if(!b||(b&&b.length===0)){a.val(this.get("formattedHint"))}}},_addTextAreaEvents:function(){var a=this.$input();SC.Event.add(a,"focus",this,this._textField_fieldDidFocus);SC.Event.add(a,"blur",this,this._textField_fieldDidBlur);SC.Event.add(a,"select",this,this._textField_selectionDidChange);SC.Event.add(a,"input",this,this._textField_inputDidChange)},willDestroyLayer:function(){arguments.callee.base.apply(this,arguments);var a=this.$input();SC.Event.remove(a,"focus",this,this._textField_fieldDidFocus);SC.Event.remove(a,"blur",this,this._textField_fieldDidBlur);SC.Event.remove(a,"select",this,this._textField_selectionDidChange);SC.Event.remove(a,"keypress",this,this._firefox_dispatch_keypress);SC.Event.remove(a,"input",this,this._textField_inputDidChange)},_textField_fieldDidFocus:function(a){SC.run(function(){this.set("focused",YES);this.fieldDidFocus(a);var b=this.get("value");if(!SC.platform.input.placeholder&&((!b)||(b&&b.length===0))){this._hintON=NO}},this)},_textField_fieldDidBlur:function(a){SC.run(function(){this.set("focused",NO);this.fieldDidBlur(this._origEvent||a);var b=this.get("value");if(!SC.platform.input.placeholder&&!this.get("hintOnFocus")&&((!b)||(b&&b.length===0))){this._hintON=YES}},this)},fieldDidFocus:function(a){this.becomeFirstResponder();this.beginEditing(a);if(this._didHideInterceptForPane){this._didHideInterceptForPane.showTouchIntercept();this._didHideInterceptForPane=null}var b=this.get("pane");if(b&&b.get("hasTouchIntercept")){b.hideTouchIntercept();this._didHideInterceptForPane=this.get("pane")}},fieldDidBlur:function(a){this.resignFirstResponder(a);if(this.get("commitOnBlur")){this.commitEditing(a)}var b=this._didHideInterceptForPane;if(b){b.showTouchIntercept();b=null}},_field_fieldValueDidChange:function(a){if(this.get("focused")){SC.run(function(){this.fieldValueDidChange(NO)},this)}this.updateHintOnFocus()},_textField_inputDidChange:function(){var a=SC.empty(this._fieldValueDidChangeTimer)||!this._fieldValueDidChangeTimer.get("isValid");if(this.get("applyImmediately")&&a){this.invokeLater(this.fieldValueDidChange,10)}},updateHintOnFocus:function(){var a=this.get("hintOnFocus");if(!a){return}if(this.getFieldValue()){this.$(".hint").addClass("sc-hidden")}else{this.$(".hint").removeClass("sc-hidden")}}.observes("value"),_topOffsetForFirefoxCursorFix:3,_firefox_dispatch_keypress:function(a){var d=this.get("selection"),e=this.get("value"),c=e?e.length:0,b;if(!d||((d.get("length")===0&&(d.get("start")===0)||d.get("end")===c))){b=SC.RootResponder.responder;if(a.keyCode===9){return}b.keypress.call(b,a);a.stopPropagation()}},_textField_selectionDidChange:function(){this.notifyPropertyChange("selection")},didBecomeKeyResponderFrom:function(a){if(this.get("isVisibleInWindow")){var b=this.$input()[0];try{if(b){b.focus()}}catch(c){}if(!this._txtFieldMouseDown){this.invokeLast(this._selectRootElement)}}},_selectRootElement:function(){var b=this.$input()[0],a;if(b){a=SC.browser.os===SC.OS.mac&&SC.browser.compare(SC.browser.osVersion,"10.7")===0;if(!(SC.browser.name===SC.BROWSER.safari&&a&&SC.buildLocale==="ko-kr")){b.select()}}else{this._textField_selectionDidChange()}},didLoseKeyResponderTo:function(a){var b=this.$input()[0];if(b){b.blur()}this.invokeLater("scrollToOriginIfNeeded",100)},scrollToOriginIfNeeded:function(){var b=this.get("pane");if(!b){return}var a=b.get("firstResponder");if(!a||!a.get("isTextField")){document.body.scrollTop=document.body.scrollLeft=0}},keyDown:function(a){return this.interpretKeyEvents(a)||NO},insertText:function(c,a){var f=a.which,d=a.keyCode,b=false;if(!SC.platform.input.maxlength&&this.get("isTextArea")){var e=this.get("value");if(e&&((!SC.browser.isMozilla&&f>47)||(SC.browser.isMozilla&&((f>32&&f<43)||f>47)&&!(d>36&&d<41)))&&(e.length>=this.get("maxLength"))){b=true}}if((this.performValidateKeyDown(a)||SC.platform.touch)&&!b){this._isKeyDown=YES;a.allowDefault()}else{a.stop()}if(this.get("applyImmediately")){this._fieldValueDidChangeTimer=this.invokeLater(this.fieldValueDidChange,10)}return YES},insertTab:function(b){if(!this.get("defaultTabbingEnabled")){return NO}var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},keyUp:function(a){if(SC.browser.isMozilla&&a.keyCode===SC.Event.KEY_RETURN){this.fieldValueDidChange()}this.notifyPropertyChange("selection");this._isKeyDown=NO;a.allowDefault();return YES},mouseDown:function(a){var b=this.get("fieldValue");this._txtFieldMouseDown=YES;this.becomeFirstResponder();if(!this.get("isEnabled")){a.stop();return YES}else{return arguments.callee.base.apply(this,arguments)}},mouseUp:function(a){this._txtFieldMouseDown=NO;this.notifyPropertyChange("selection");if(!this.get("isEnabled")){a.stop();return YES}return arguments.callee.base.apply(this,arguments)},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},mouseWheel:function(a){if(this.get("isTextArea")){a.allowDefault();return YES}else{return NO}},selectStart:function(a){return YES},_inputElementTagName:function(){if(this.get("isTextArea")){return"textarea"}else{return"input"}},_valueObserver:function(){var b=this.get("value"),a;if(b&&b.length>0){this._hintON=NO;a=this.get("maxLength");if(!SC.platform.input.maxlength&&b.length>a){this.set("value",b.substr(0,a))}}else{if(!this.get("hintOnFocus")){this._hintON=YES}}}.observes("value")});sc_require("views/text_field");sc_require("system/utils/misc");sc_require("delegates/inline_text_field");sc_require("mixins/inline_editor");SC.InlineTextFieldView=SC.TextFieldView.extend(SC.InlineEditor,{classNames:["inline-editor"],_topOffsetForFirefoxCursorFix:0,blurOnMouseDown:YES,_updateViewStyle:function(b){var c="",a=SC.getStyle(b,"font-size");if(a&&a.length>0){c=c+"font-size: "+a+" !important; "}a=SC.getStyle(b,"font-family");if(a&&a.length>0){c=c+"font-family: "+a+" !important; "}a=SC.getStyle(b,"font-weight");if(a&&a.length>0){c=c+"font-weight: "+a+" !important; "}a=SC.getStyle(b,"z-index");if(a&&a.length>0){c=c+"z-index: "+a+" !important; "}a=SC.getStyle(b,"line-height");if(a&&a.length>0){c=c+"line-height: "+a+" !important; "}a=SC.getStyle(b,"text-align");if(a&&a.length>0){c=c+"text-align: "+a+" !important; "}a=SC.getStyle(b,"top-margin");if(a&&a.length>0){c=c+"top-margin: "+a+" !important; "}a=SC.getStyle(b,"bottom-margin");if(a&&a.length>0){c=c+"bottom-margin: "+a+" !important; "}a=SC.getStyle(b,"left-margin");if(a&&a.length>0){c=c+"left-margin: "+a+" !important; "}a=SC.getStyle(b,"right-margin");if(a&&a.length>0){c=c+"right-margin: "+a+" !important; "}return c},_updateViewPaddingStyle:function(b){var c="",a=SC.getStyle(b,"padding-top");if(a&&a.length>0){c=c+"top: "+a+" !important; "}a=SC.getStyle(b,"padding-bottom");if(a&&a.length>0){c=c+"bottom: "+a+" !important; "}a=SC.getStyle(b,"padding-left");if(a&&a.length>0){c=c+"left: "+a+" !important; "}a=SC.getStyle(b,"padding-right");if(a&&a.length>0){c=c+"right: "+a+" !important; "}return c},updateStyle:function(d){if(d.length){d=d[0]}var a=document.getElementById("sc-inline-text-field-style"),c=this._updateViewStyle(d),e=this._updateViewPaddingStyle(d),f=".inline-editor input{"+c+"}.inline-editor textarea{"+c+"}.inline-editor .padding{"+e+"}";if(!a){var b=document.getElementsByTagName("head")[0];a=document.createElement("style");a.type="text/css";a.media="screen";a.id="sc-inline-text-field-style";b.appendChild(a)}if(a.styleSheet){a.styleSheet.cssText=f}else{a.innerHTML=f}},positionOverTargetView:function(j,d,c,b,e){var g;if(!c){c=j.get("pane")}if(!e){e=j.$()[0]}if(!b){var h=j.get("frame");b=SC.offset(e);b.height=h.height;b.width=h.width}var i={},a=c.$()[0],f=j.get("layout");i.height=b.height;i.width=b.width;g=SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0;if(d&&f.left){i.left=b.x-f.left-a.offsetLeft-1;if(g){i.left--}}else{i.left=b.x-a.offsetLeft-1;if(g){i.left--}}if(d&&f.top){i.top=b.y-f.top-a.offsetTop;if(g){i.top=i.top-2}}else{i.top=b.y-a.offsetTop;if(g){i.top=i.top-2}}this.set("layout",i)},multiline:NO,isTextArea:function(){return this.get("multiline")}.property("multiline").cacheable(),beginEditing:function(b,a){if(!b(a)){return NO}var d=a.get("pane"),c=this.get("exampleElement");this.beginPropertyChanges();if(c){if(c.length){c=c[0]}}else{c=a.$()[0]}this.updateStyle(c);this.positionOverTargetView(a,this.get("isCollection"),d,this.get("exampleFrame"),c);this._previousFirstResponder=d?d.get("firstResponder"):null;this.becomeFirstResponder();this.endPropertyChanges();return YES}.enhance(),blurEditor:function(a){if(!this.get("isEditing")){return YES}return this.commitOnBlur?this.commitEditing():this.discardEditing()},_endEditing:function(b){var a=b();if(this.get("isFirstResponder")){var c=this.get("pane");if(c&&this._previousFirstResponder){c.makeFirstResponder(this._previousFirstResponder)}else{this.resignFirstResponder()}}this._previousFirstResponder=null;return a}.enhance(),mouseDown:function(a){arguments.callee.base.call(this,a);return this.get("isEditing")},touchStart:function(a){this.mouseDown(a)},keyDown:function(a){var b=this.interpretKeyEvents(a);this.fieldValueDidChange(true);return !b?NO:b},insertText:null,_scitf_blurInput:function(){var a=this.$input()[0];if(a){a.blur()}a=null},willRemoveFromParent:function(){return this._scitf_blurInput()},willLoseFirstResponder:function(b,a){if(b!==this){return}this._previousFirstResponder=null;this._origEvent=a;this._scitf_blurInput();return this.blurEditor(a)},cancel:function(){this.discardEditing();return YES},fieldValueDidChange:function(a){arguments.callee.base.call(this,a)},insertNewline:function(a){if(this.get("isTextArea")){a.allowDefault();return arguments.callee.base.call(this,a)}else{if(this.get("value")!=this.$input().val()){this.set("value",this.$input().val())}this.commitEditing();return YES}},insertTab:function(a){var c=this.target;this.resignFirstResponder();this.commitEditing();if(c){var b=c.get("nextValidKeyView");if(b&&b.beginEditing){b.beginEditing()}}return YES},insertBacktab:function(a){var c=this.target;this.resignFirstResponder();this.commitEditing();if(c){var b=c.get("previousValidKeyView");if(b&&b.beginEditing){b.beginEditing()}}return YES},deleteForward:function(a){a.allowDefault();return YES},deleteBackward:function(a){a.allowDefault();return YES}});SC.mixin(SC.InlineTextFieldView,{inlineEditorDelegate:SC.InlineTextFieldDelegate,label:null,editor:null,beginEditing:function(c){var a,d,b,e,f;if(SC.typeOf(c)===SC.T_HASH){b=c;if(!b.delegate||!b.exampleElement||!b.frame){SC.error("Delegate, exampleElement, and frame options are required.");return NO}c=b.delegate;e=b.value}else{e=c.get("value")}f=SC.beget(c);f.mixin({inlineEditorWillBeginEditing:function(){if(c.inlineEditorWillBeginEditing){c.inlineEditorWillBeginEditing.apply(c,arguments)}},inlineEditorDidBeginEditing:function(){if(c.inlineEditorDidBeginEditing){c.inlineEditorDidBeginEditing.apply(c,arguments)}},inlineEditorWillCommitEditing:function(h,i,g){if(c.inlineEditorWillCommitEditing){c.inlineEditorWillCommitEditing(h,i,g)}if(c.inlineEditorWillEndEditing){c.inlineEditorWillEndEditing(h,i)}},inlineEditorDidCommitEditing:function(h,i,g){if(c.inlineEditorDidCommitEditing){c.inlineEditorDidCommitEditing(h,i,g)}if(c.inlineEditorDidEndEditing){c.inlineEditorDidEndEditing(h,i)}SC.InlineTextFieldView._endEditing()},inlineEditorWillDiscardEditing:function(h,g){if(c.inlineEditorWillDiscardEditing){c.inlineEditorWillDiscardEditing(h,g)}if(c.inlineEditorWillEndEditing){c.inlineEditorWillEndEditing(h,this.get("value"))}},inlineEditorDidDiscardEditing:function(h,g){if(c.inlineEditorDidDiscardEditing){c.inlineEditorDidDiscardEditing(h,g)}if(c.inlineEditorDidEndEditing){c.inlineEditorDidEndEditing(h,this.get("value"))}SC.InlineTextFieldView._endEditing()}});if(c.inlineEditorShouldBeginEditing&&!c.inlineEditorShouldBeginEditing(c,e)){return NO}this.editor=d=this.inlineEditorDelegate.acquireEditor(c);d.set("value",e);if(b){d.set("exampleElement",b.exampleElement);d.set("exampleFrame",b.frame);d.set("multiline",b.multiline);d.set("escapeHTML",b.escapeHTML);d.set("isCollection",b.isCollection);d.set("commitOnBLur",b.commitOnBlur);d.set("validator",b.validator)}if(d){return d.beginEditing(f)}else{return NO}},commitEditing:function(){return this.inlineEditorDelegate.editor?this.inlineEditorDelegate.editor.commitEditing():NO},discardEditing:function(){return this.inlineEditorDelegate.editor?this.inlineEditorDelegate.editor.discardEditing():NO},_endEditing:function(){this.inlineEditorDelegate.releaseEditor(this.editor);this.editor=null}});sc_require("mixins/inline_editable");sc_require("mixins/inline_editor_delegate");sc_require("delegates/inline_text_field");SC.REGULAR_WEIGHT="normal";SC.BOLD_WEIGHT="bold";SC.LabelView=SC.View.extend(SC.Control,SC.InlineEditable,{classNames:["sc-label-view"],displayProperties:["displayTitle","textAlign","fontWeight","icon","escapeHTML","needsEllipsis","hint","toolTip"],inlineEditorDelegate:SC.InlineTextFieldDelegate,isEditable:NO,exampleEditor:SC.InlineTextFieldView,fontWeight:null,escapeHTML:YES,escapeHTMLBindingDefault:SC.Binding.oneWay().bool(),localize:NO,localizeBindingDefault:SC.Binding.oneWay().bool(),formatter:null,value:"",hint:null,hintEnabled:function(){return this.get("isEditable")}.property("isEditable").cacheable(),icon:null,textAlign:null,supportsAutoResize:YES,autoResizeLayer:function(){return this.get("layer")}.property("layer").cacheable(),autoResizeText:function(){return this.get("displayTitle")}.property("displayTitle").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",10),renderDelegateName:"labelRenderDelegate",displayTitle:function(){var g,e;g=this.get("value");e=this.getDelegateProperty("formatter",this.displayDelegate);if(e){var f=(SC.typeOf(e)===SC.T_FUNCTION)?e(g,this):e.fieldValueForObject(g,this);if(!SC.none(f)){g=f}}if(SC.typeOf(g)===SC.T_ARRAY){var d=[];for(var b=0,c=g.get("length");b<c;b++){var a=g.objectAt(b);if(!SC.none(a)&&a.toString){a=a.toString()}d.push(a)}g=d.join(",")}if(!SC.none(g)&&g.toString){g=g.toString()}if(g&&this.getDelegateProperty("localize",this.displayDelegate)){g=SC.String.loc(g)}return g}.property("value","localize","formatter").cacheable(),hintValue:function(){var a=this.get("hint");return a}.property("hint").cacheable(),doubleClick:function(a){return this.beginEditing()},inlineEditorDidBeginEditing:function(b,c,d,a){this._oldOpacity=this.get("layout").opacity||1;this.adjust("opacity",0);b(c,d,a)}.enhance(),inlineEditorDidEndEditing:function(){this.adjust("opacity",this._oldOpacity);this._oldOpacity=null}});SC.allowsBackspaceToPreviousPage=NO;SC.HORIZONTAL_ORIENTATION="horizontal";SC.VERTICAL_ORIENTATION="vertical";SC.BORDER_BEZEL="sc-bezel-border";SC.BORDER_BLACK="sc-black-border";SC.BORDER_GRAY="sc-gray-border";SC.BORDER_TOP="sc-top-border";SC.BORDER_BOTTOM="sc-bottom-border";SC.BORDER_NONE=null;SC.Border={borderTop:0,borderRight:0,borderBottom:0,borderLeft:0,borderStyle:SC.BORDER_GRAY,hasBorder:YES,displayProperties:["borderStyle"],_BORDER_REGEXP:(/-border$/),initMixin:function(){this._sc_border_borderStyleDidChange();this._sc_border_borderDimensionsDidChange()},renderMixin:function(a,c){var b=this.get("borderStyle");if(b){if(this._BORDER_REGEXP.exec(b)){a.addClass(b)}else{a.addStyle("border","1px "+b+" solid")}}},_sc_border_borderStyleDidChange:function(){var a=this.get("borderStyle"),b=SC.Border.dimensions[a];if(b){this.beginPropertyChanges();this.set("borderTop",b);this.set("borderRight",b);this.set("borderBottom",b);this.set("borderLeft",b);this.endPropertyChanges()}},_sc_border_borderDimensionsDidChange:function(){var d=this.get("borderTop"),a=this.get("borderRight"),b=this.get("borderBottom"),c=this.get("borderLeft");this.adjust({borderTop:d,borderRight:a,borderBottom:b,borderLeft:c})}.observes("borderTop","borderRight","borderBottom","borderLeft")};SC.mixin(SC.Border,{dimensions:{"sc-bezel-border":1,"sc-black-border":1,"sc-gray-border":1,"sc-top-border":1,"sc-bottom-border":1}});SC.CollectionFastPath={initMixin:function(){this._indexMap={};this._viewMap={}},poolForExampleView:function(a){var b="_pool_"+SC.guidFor(a);if(!this[b]){this[b]=[]}return this[b]},createItemViewFromExampleView:function(c,b){var a=this.createItemView(c,null,b);if(a.isPoolable){a.owningPool=this.poolForExampleView(c)}a.createdFromExampleView=c;return a},configureItemView:function(b,a){b.beginPropertyChanges();b.setIfChanged("content",a.content);b.setIfChanged("contentIndex",a.contentIndex);b.setIfChanged("parentView",a.parentView);b.setIfChanged("layerId",a.layerId);b.setIfChanged("isEnabled",a.isEnabled);b.setIfChanged("isSelected",a.isSelected);b.setIfChanged("outlineLevel",a.outlineLevel);b.setIfChanged("layout",a.layout);b.setIfChanged("disclosureState",a.disclosureState);b.setIfChanged("isVisibleInWindow",a.isVisibleInWindow);b.setIfChanged("isGroupView",a.isGroupView);b.setIfChanged("page",this.page);b.endPropertyChanges()},wakePooledView:function(b,a){this.configureItemView(b,a);if(b.awakeFromPool){b.awakeFromPool(b.owningPool,this)}},allocateItemView:function(d,b){var a;if(d.prototype.isPoolable){var c=this.poolForExampleView(d);if(c.length>0){a=c.pop();this.wakePooledView(a,b)}}if(!a){a=this.createItemViewFromExampleView(d,b)}return a},releaseItemView:function(b){if(!b.isPoolable){b.destroy();return}var a=b.owningPool;a.push(b);if(b.hibernateInPool){b.hibernateInPool(a,this)}},contentIndexIsGroup:function(a,d,c){var e=this.get("contentDelegate");var b=this.get("_contentGroupIndexes"),f=NO;f=b&&b.contains(c);if(f){f=e.contentIndexIsGroup(this,this.get("content"),c)}return f},exampleViewForItem:function(f,d){var b=this.get("contentDelegate"),c=this.get("_contentGroupIndexes"),e,a,g=this.contentIndexIsGroup(this,this.get("content"),d);if(g){e=this.get("contentGroupExampleViewKey");if(e&&f){a=f.get(e)}if(!a){a=this.get("groupExampleView")||this.get("exampleView")}}else{e=this.get("contentExampleViewKey");if(e&&f){a=f.get(e)}if(!a){a=this.get("exampleView")}}return a},setAttributesForItem:function(f,d,c){var b=this.get("contentDelegate"),g=this.contentIndexIsGroup(this,this.get("content"),d),a=this.exampleViewForItem(f,d),e=this.get("content");c.createdFromExampleView=a;c.parentView=this.get("containerView")||this;c.contentIndex=d;c.owner=c.displayDelegate=this;c.content=f;c.page=this.page;c.layerId=this.layerIdFor(d);c.isEnabled=b.contentIndexIsEnabled(this,e,d);c.isSelected=b.contentIndexIsSelected(this,e,d);c.outlineLevel=b.contentIndexOutlineLevel(this,e,d);c.disclosureState=b.contentIndexDisclosureState(this,e,d);c.isVisibleInWindow=this.get("isVisibleInWindow");c.isGroupView=g;c.layout=this.layoutForContentIndex(d);if(!c.layout){c.layout=a.prototype.layout}},mappedViewsForItem:function(a,b){if(!b){b=this._viewMap}return b[SC.guidFor(a)]},mappedViewForItem:function(c,b,d){if(!d){d=this._viewMap}var a=d[SC.guidFor(c)];if(!a){return undefined}return a[b]},mapView:function(e,c,b,f){if(!f){f=this._viewMap}var d=SC.guidFor(e),a=f[d];if(!a){a=f[d]={_length:0}}a[c]=b;a._length++},unmapView:function(e,c,f){if(!f){f=this._viewMap}var d=SC.guidFor(e),a=f[d];if(!a){return}if(a[c]){var b=a[c];delete a[c];a._length--;if(a._length<=0){delete f[d]}}},itemViewForContentIndex:function(b){var d=this.get("content");if(!d){return}var c=d.objectAt(b);var e=this.exampleViewForItem(c,b),a=this._indexMap[b];if(a&&a.createdFromExampleView!==e){this.removeItemView(a);this.unmapView(c,b);a=null}if(!a){a=this.addItemView(e,c,b)}return a},nearestMappedViewIndexForItem:function(e,c,f){var b=this.mappedViewsForItem(e,f);if(!b){return null}var d=null,h=-1,g=0;for(var a in b){a=parseInt(a,10);if(isNaN(a)){continue}g=Math.abs(c-a);if(h<0||g<h){h=g;d=a}}return d},remapItemViews:function(b){var j=this._viewMap,a=(this._viewMap={}),i=(this._indexMap={}),k=[],h=this.get("content"),n;if(!h){return}var f=this._itemsToAdd;b.forEach(function(o){n=h.objectAt(o);var q=this.mappedViewsForItem(n,j);if(q){if(q[o]){var p=q[o];this.unmapView(n,o,j);this.mapView(n,o,p,a);i[o]=p}else{k.push(o)}}else{f.push(o)}},this);for(var m=0,g=k.length;m<g;m++){var l=k[m];n=h.objectAt(l);var e=this.nearestMappedViewIndexForItem(n,l,j),c;if(!SC.none(e)){c=this.mappedViewForItem(n,e,j);var d=this.exampleViewForItem(n,l);if(d===c.createdFromExampleView){this.unmapView(n,e,j);this.mapView(n,l,c,a);i[l]=c}else{f.push(l)}}else{f.push(l)}}return j},reloadIfNeeded:function(f,b){var d=this.get("content"),e;if(!f||!f.isIndexSet){f=this.get("nowShowing")}if(!b){e=this._invalidIndexes;if(!e||!this.get("isVisibleInWindow")){return this}this._invalidIndexes=NO;if(e.isIndexSet&&e.contains(f)){e=YES}if(this.willReload){this.willReload(e===YES?null:e)}}var g=this._itemsToAdd||(this._itemsToAdd=[]);var a=this.remapItemViews(f);this.processRemovals(a);if(e){this.processUpdates(e===YES?f:e)}this.processAdds();if(!b){this.clearDOMPools()}g.length=0;if(!b){var c=this.computeLayout();if(c){this.adjust(c)}if(this.didReload){this.didReload(e===YES?null:e)}}return this},processRemovals:function(c){var f=this.get("content");for(var d in c){var b=c[d];for(var e in b){e=parseInt(e,10);if(isNaN(e)){continue}var a=b[e];if(this._indexMap[e]===a){delete this._indexMap[e]}a._isInCollection=NO;this.removeItemView(a)}}},processUpdates:function(e){var b=this._itemsToUpdate,d=this.get("content"),c,a;e.forEach(function(f){c=d.objectAt(f);if(a=this.mappedViewForItem(c,f)){if(!a._isInCollection){return}var g=this.exampleViewForItem(c,f);this.updateItemView(a,g,c,f)}},this)},processAdds:function(){var f=this.get("content");var g=this._itemsToAdd,b,a=g.length,e,d;for(b=0;b<a;b++){e=g[b];d=f.objectAt(e);var h=this.exampleViewForItem(d,e);var c=this.addItemView(h,d,e)}},clearDOMPools:function(){var a=this._domPools||(this._domPools={});for(var b in a){this.clearDOMPool(a[b])}},domPoolSize:10,clearDOMPool:function(c){var b,a=c.length,d;for(b=this.domPoolSize;b<a;b++){d=c[b];this.removeChild(d);this.releaseItemView(d)}c.length=Math.min(c.length,this.domPoolSize)},domPoolForExampleView:function(d){var c=this._domPools||(this._domPools={}),a=SC.guidFor(d);var b=c[a];if(!b){b=c[a]=[]}return b},itemFromDOMPool:function(c){var b=this.domPoolForExampleView(c);if(b.length<1){return null}var a=b.shift();if(a.wakeFromDOMPool){a.wakeFromDOMPool()}return a},sendToDOMPool:function(a){var b=this.domPoolForExampleView(a.createdFromExampleView);b.push(a);var c=a.get("frame");a.adjust({top:-c.height});a.set("layerId",SC.guidFor(a));if(a.sleepInDOMPool){a.sleepInDOMPool()}},addItemView:function(e,d,c){var a,b=this._TMP_ATTRS||(this._TMP_ATTRS={});this.setAttributesForItem(d,c,b);if(a=this.itemFromDOMPool(e)){this.configureItemView(a,b);a._isInCollection=YES;this.mapView(d,c,a);this._indexMap[c]=a;return a}a=this.allocateItemView(e,b);this.appendChild(a);a._isInCollection=YES;this.mapView(d,c,a);this._indexMap[c]=a;return a},removeItemView:function(a){if(a.get("layerIsCacheable")){this.sendToDOMPool(a)}else{this.removeChild(a)}a._isInCollection=NO},updateItemView:function(d,e,c,b){if(!d.get("layerIsCacheable")||d.createdFromExampleView!==e){this.unmapView(d,b);delete this._indexMap[b];this.removeItemView(d,c,b);var f=this.addItemView(e,c,b)}else{var a=this._TMP_ATTRS||(this._TMP_ATTRS={});this.setAttributesForItem(c,b,a);this.configureItemView(d,a)}},_lastTopUpdate:0,_lastLeftUpdate:0,_tolerance:100,touchScrollDidChange:function(g,f){if(Date.now()-this._lastTouchScrollTime<25){return}var h=this.get("clippingFrame");var e=this._inScrollClippingFrame||(this._inScrollClippingFrame={x:0,y:0,width:0,height:0});e.x=h.x;e.y=h.y;e.width=h.width;e.height=h.height;e.x=g;e.y=f;var d=this.contentIndexesInRect(e);if(!d){return}var b=this.get("length"),a=d.get("max"),c=d.get("min");if(a>b||c<0){d=d.copy();d.remove(b,a-b).remove(c,0-c).freeze()}if(this._lastNowShowing){if(d.contains(this._lastNowShowing)&&this._lastNowShowing.contains(d)){return}}this._lastNowShowing=d;this.reloadIfNeeded(d,YES);this._lastTouchScrollTime=Date.now()}};SC.CollectionGroup={classNames:["sc-collection-group"]};SC.CollectionRowDelegate={isCollectionRowDelegate:YES,itemHeight:24,rowSpacing:0,rowPadding:0,rowHeight:function(b,c){var a=this.get("rowPadding");var d=this.get("itemHeight");if(c!==undefined){this.set("itemHeight",c-a*2);return c}return d+a*2}.property("itemHeight","rowPadding"),customRowHeightIndexes:null,contentIndexRowHeight:function(a,b,c){return this.get("rowHeight")}};SC.CollectionViewDelegate={isCollectionViewDelegate:YES,collectionViewSelectionForProposedSelection:function(a,b){return b},collectionViewShouldSelectIndexes:function(a,b,c){return b},collectionViewShouldDeselectIndexes:function(a,b){return b},collectionViewShouldDeleteIndexes:function(a,b){return b},collectionViewDeleteContent:function(a,c,b){if(!c){return NO}if(SC.typeOf(c.destroyAt)===SC.T_FUNCTION){c.destroyAt(b);a.selectPreviousItem(NO,1);return YES}else{if(SC.typeOf(c.removeAt)===SC.T_FUNCTION){c.removeAt(b);a.selectPreviousItem(NO,1);return YES}else{return NO}}},collectionViewShouldBeginDrag:function(a){return YES},collectionViewDragDataTypes:function(a){return[]},collectionViewDragDataForType:function(a,c,b){return null},collectionViewComputeDragOperations:function(a,b,c){return c},collectionViewValidateDragOperation:function(b,d,e,c,a){return(a&SC.DROP_ON)?SC.DRAG_NONE:e},collectionViewPerformDragOperation:function(b,d,e,c,a){return SC.DRAG_NONE},collectionViewDragViewFor:function(a,b){return null},ghostActsLikeCursor:NO};SC.NavigationBuilder={isNavigationBuilder:YES,navigationTransitions:NO,initMixin:function(){var b=SC.Animatable;if(b&&!this.isAnimatable){this.mixin(b)}else{if(!b){SC.Logger.error("SC.NavigationView and SC.NavigationBuilder require SC.Animatable to perform animations, but it is not present. Please ensure your app or framework references it.")}}var a=this.get("navigationTransitions");if(!a&&SC.Animatable){a={left:{duration:0.25,timing:SC.Animatable.TRANSITION_EASE_IN_OUT,action:"navigationBuildDidFinish"},transform:{duration:0.25,timing:SC.Animatable.TRANSITION_EASE_IN_OUT,action:"navigationBuildDidFinish"}}}if(SC.Animatable){SC.mixin(this.transitions,a)}},metrics:function(){var a=this.computeFrameWithParentFrame();return a},transform:function(a){if(SC.platform.supportsCSS3DTransforms){this.adjust("transform","translate3d("+a+"px,0px,0px)")}else{this.adjust("transform","translate("+a+"px,0px)")}},buildInNavigation:function(){var a=this.metrics();this.disableAnimation();this.transform(this.get("buildDirection")===SC.TO_LEFT?a.width:-a.width);this.enableAnimation();this.invokeLater("transform",10,0)},buildOutNavigation:function(){var a=this.metrics();this.transform(this.get("buildDirection")===SC.TO_LEFT?-a.width:a.width)},buildIn:function(){this.buildInNavigation()},buildOut:function(){this.buildOutNavigation()},resetBuild:function(){this.transform(0)},navigationBuildDidFinish:function(){if(this.isBuildingIn){this.buildInDidFinish()}else{if(this.isBuildingOut){this.buildOutDidFinish()}}}};SC.Scrollable={isScrollable:true,verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("innerFrame").height}.property("innerFrame"),horizontalPageScroll:function(){return this.get("innerFrame").width}.property("innerFrame"),hasVerticalScroller:function(){return this.get("scrollFrame").height>this.get("innerFrame").height}.property("scrollFrame"),hasHorizontalScroller:function(){return this.get("scrollFrame").width>this.get("innerFrame").width}.property("scrollFrame"),scrollBy:function(a){var b=this.get("scrollFrame");var c=this.get("innerFrame");if(!this.get("hasVerticalScroller")){a.y=0}if(b.height<=c.height){a.y=0}if(!this.get("hasHorizontalScroller")){a.x=0}if(b.width<=c.width){a.x=0}var d={x:b.x-(a.x||0),y:b.y-(a.y||0)};this.set("scrollFrame",d);d=this.get("scrollFrame");return{x:d.x-b.x,y:d.y-b.y}},scrollTo:function(a,b){this.set("scrollFrame",{x:0-a,y:0-b})},scrollToVisible:function(b){var e=this.get("innerFrame");var d=this.get("scrollFrame");var a=this.convertFrameFromView(b.get("frame"),b);a.x-=(e.x+d.x);a.y-=(e.y+d.y);var c={x:0-d.x,y:0-d.y,width:e.width,height:e.height};c.y-=Math.max(0,SC.minY(c)-SC.minY(a));c.x-=Math.max(0,SC.minX(c)-SC.minX(a));c.y+=Math.max(0,SC.maxY(a)-SC.maxY(c));c.x+=Math.max(0,SC.maxX(a)-SC.maxX(c));this.scrollTo(c.x,c.y)},scrollDownLine:function(a){if(a===undefined){a=1}return this.scrollBy({y:this.get("verticalLineScroll")*a}).y},scrollUpLine:function(a){if(a===undefined){a=1}return 0-this.scrollBy({y:0-this.get("verticalLineScroll")*a}).y},scrollRightLine:function(a){if(a===undefined){a=1}return this.scrollTo({y:this.get("horizontalLineScroll")*a}).x},scrollLeftLine:function(a){if(a===undefined){a=1}return 0-this.scrollTo({y:0-this.get("horizontalLineScroll")*a}).x},scrollDownPage:function(a){if(a===undefined){a=1}return this.scrollBy({y:this.get("verticalPageScroll")*a}).y},scrollUpPage:function(a){if(a===undefined){a=1}return 0-this.scrollBy({y:0-this.get("verticalPageScroll")*a}).y},scrollRightPage:function(a){if(a===undefined){a=1}return this.scrollTo({y:this.get("horizontalPageScroll")*a}).x},scrollLeftPage:function(a){if(a===undefined){a=1}return 0-this.scrollTo({y:0-this.get("horizontalPageScroll")*a}).x}};SC.ModalPane=SC.Pane.extend({classNames:"sc-modal",_openPaneCount:0,paneWillAppend:function(e){var d;this._openPaneCount++;if(!this.get("isVisibleInWindow")){this.append()}var c=SC.RootResponder.responder.panes;for(var b=0,a=c.length;b<a;b++){d=c[b];if(d!==e){this._hideShowTextfields(d,NO)}}return this},paneDidRemove:function(e){var d;this._openPaneCount--;var c=SC.RootResponder.responder.panes;for(var b=0,a=c.length;b<a;b++){d=c[b];if(d!==e){this._hideShowTextfields(d,YES)}}if(this._openPaneCount<=0){this._openPaneCount=0;if(this.get("isVisibleInWindow")){this.remove()}}},_hideShowTextfields:function(c,b){var a;for(a in SC.View.views){a=SC.View.views[a];if(a!==c&&a.get("pane")===c&&a.get("isTextField")){if(b){if(a._scmp_isBrowserFocusable!==undefined){b=a._scmp_isBrowserFocusable;delete a._scmp_isBrowserFocusable}}else{a._scmp_isBrowserFocusable=a.get("isBrowserFocusable")}a.set("isBrowserFocusable",b)}}},mouseDown:function(b){var a=this.get("owner");if(a&&a.modalPaneDidClick){a.modalPaneDidClick(b)}},touchStart:function(a){this.mouseDown(a)}});sc_require("panes/modal");SC.PanelPane=SC.Pane.extend({isPanelPane:YES,classNames:["sc-panel"],acceptsKeyPane:YES,ariaRole:"dialog",ariaLabel:null,ariaLabelledBy:null,ariaDescribedBy:null,isModal:YES,modalPane:SC.ModalPane.extend({classNames:"for-sc-panel"}),contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(a){this.removeAllChildren();if(a){this.appendChild(a)}},createChildViews:function(){var a=this.contentView;if(a){a=this.contentView=this.createChildView(a);this.childViews=[a]}},contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView"),renderDelegateName:"panelRenderDelegate",_modalPane:function(){var a=this.get("modalPane");if(a&&a.isClass){a=a.create({owner:this});this.set("modalPane",a)}return a},appendTo:function(a){var b;if(!this.get("isVisibleInWindow")&&this.get("isModal")&&(b=this._modalPane())){this._isShowingModal=YES;b.paneWillAppend(this)}return arguments.callee.base.apply(this,arguments)},remove:function(){var b,a=arguments.callee.base.apply(this,arguments);if(this._isShowingModal){this._isShowingModal=NO;if(b=this._modalPane()){b.paneDidRemove(this)}}return a},destroy:function(){var a=this.get("modalPane");if(a&&!a.isClass){a.destroy()}arguments.callee.base.apply(this,arguments)},_isModalDidChange:function(){var b,a=this.get("isModal");if(a){if(!this._isShowingModal&&this.get("isVisibleInWindow")&&(b=this._modalPane())){this._isShowingModal=YES;b.paneWillAppend(this)}}else{if(this._isShowingModal&&(b=this._modalPane())){this._isShowingModal=NO;b.paneDidRemove(this)}}}.observes("isModal"),paneDidAttach:function(){var a=arguments.callee.base.apply(this,arguments);this.becomeKeyPane();return a},displayProperties:["ariaLabel","ariaLabelledBy","ariaDescribedBy"]});SC.TOGGLE_BEHAVIOR="toggle";SC.PUSH_BEHAVIOR="push";SC.TOGGLE_ON_BEHAVIOR="on";SC.TOGGLE_OFF_BEHAVIOR="off";SC.HOLD_BEHAVIOR="hold";SC.ButtonView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),classNames:["sc-button-view"],themeName:"square",value:null,toggleOnValue:YES,toggleOffValue:NO,localize:NO,localizeBindingDefault:SC.Binding.bool(),title:"",tooltip:"",contentTitleKey:null,icon:null,contentIconKey:null,needsEllipsis:YES,displayTitle:function(){var a=this.get("title");return(a&&this.get("localize"))?SC.String.loc(a):(a||"")}.property("title","localize").cacheable(),keyEquivalent:null,buttonBehavior:SC.PUSH_BEHAVIOR,holdInterval:100,isDefault:NO,isDefaultBindingDefault:SC.Binding.oneWay().bool(),isCancel:NO,isCancelBindingDefault:SC.Binding.oneWay().bool(),action:null,target:null,supportFocusRing:NO,supportsAutoResize:YES,autoResizeLayer:function(){var a=this.invokeRenderDelegateMethod("getRenderedAutoResizeLayer",this.$());return a||this.get("layer")}.property("layer").cacheable(),autoResizeText:function(){return this.get("displayTitle")}.property("displayTitle").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",10),_labelMinWidthIE7:0,triggerActionAfterDelay:function(a){if(!this.get("isEnabled")){return NO}this.set("isActive",YES);this.invokeLater("triggerAction",200,a);return YES},triggerAction:function(a){this._action(a,YES);this.didTriggerAction();this.set("isActive",NO)},didTriggerAction:function(){},init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("keyEquivalent");if(a){this._defaultKeyEquivalent=a}if(!SC.none(this.get("value"))){this._button_valueDidChange()}},ariaRole:"button",displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","escapeHTML","needsEllipsis","tooltip","supportFocusRing","buttonBehavior"],renderDelegateName:"buttonRenderDelegate",contentKeys:{contentValueKey:"value",contentTitleKey:"title",contentIconKey:"icon"},_button_displayObserver:function(){this.displayDidChange()}.observes("title","icon","value"),performKeyEquivalent:function(c,b){if(!this.get("isVisibleInWindow")){return NO}if(!this.get("isEnabled")){return NO}var a=this.get("keyEquivalent");if(a){if(a===c){return this.triggerAction(b)}}else{if((this.get("isDefault")&&(c==="return"))||(this.get("isCancel")&&(c==="escape"))){return this.triggerAction(b)}}return NO},computeIsSelectedForValue:function(d){var b=this.get("toggleOnValue"),c,a;if(SC.typeOf(d)===SC.T_ARRAY){if(d.length===1){c=(d[0]==b)}else{c=null;d.find(function(e){a=(e==b);if(c===null){c=a}else{if(a!==c){c=SC.MIXED_STATE}}return c===SC.MIXED_STATE})}}else{if(d===SC.MIXED_STATE){c=SC.MIXED_STATE}else{c=(d===b)}}return c},_button_valueDidChange:function(){var b=this.get("value"),a=this.computeIsSelectedForValue(b);this.set("isSelected",a)}.observes("value"),_button_isSelectedDidChange:function(){var c=this.get("isSelected"),b=this.computeIsSelectedForValue(this.get("value"));if((c!==SC.MIXED_STATE)&&(b!==c)){var a=(c)?"toggleOnValue":"toggleOffValue";this.set("value",this.get(a))}}.observes("isSelected"),_defaultKeyEquivalent:null,_isDefaultOrCancelDidChange:function(){var b=!!this.get("isDefault"),a=!b&&this.get("isCancel");if(b){this.set("keyEquivalent","return")}else{if(a){this.set("keyEquivalent","escape")}else{this.set("keyEquivalent",this._defaultKeyEquivalent)}}}.observes("isDefault","isCancel"),mouseDown:function(a){var b=this.get("buttonBehavior");if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;if(b===SC.HOLD_BEHAVIOR){this._action(a)}else{if(!this._isFocused&&(b!==SC.PUSH_BEHAVIOR)){this._isFocused=YES;this.becomeFirstResponder()}}return YES},mouseExited:function(a){if(this._isMouseDown){this.set("isActive",NO)}return YES},mouseEntered:function(a){if(this._isMouseDown){this.set("isActive",YES)}return YES},mouseUp:function(b){if(this._isMouseDown){this.set("isActive",NO)}this._isMouseDown=false;if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){var a=this.$().within(b.target);if(a&&this.get("isEnabled")){this._action(b)}}return YES},touchStart:function(b){var a=this.get("buttonBehavior");if(!this.get("isEnabled")){return YES}this.set("isActive",YES);if(a===SC.HOLD_BEHAVIOR){this._action(b)}else{if(!this._isFocused&&(a!==SC.PUSH_BEHAVIOR)){this._isFocused=YES;this.becomeFirstResponder()}}b.preventDefault();return YES},touchesDragged:function(a,b){if(!this.touchIsInBoundary(a)){if(!this._touch_exited){this.set("isActive",NO)}this._touch_exited=YES}else{if(this._touch_exited){this.set("isActive",YES)}this._touch_exited=NO}a.preventDefault();return YES},touchEnd:function(a){this._touch_exited=NO;this.set("isActive",NO);if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){if(this.touchIsInBoundary(a)&&this.get("isEnabled")){this._action()}}a.preventDefault();return YES},keyDown:function(b){if(!this.get("isEnabled")){return YES}if(b.which===9||b.keyCode===9){var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES}if(b.which===13||b.which===32){this.triggerActionAfterDelay(b);return YES}b.allowDefault();return NO},_action:function(a,c){switch(this.get("buttonBehavior")){case SC.TOGGLE_BEHAVIOR:var b=this.get("isSelected");if(b){this.set("value",this.get("toggleOffValue"))}else{this.set("value",this.get("toggleOnValue"))}break;case SC.TOGGLE_ON_BEHAVIOR:this.set("value",this.get("toggleOnValue"));break;case SC.TOGGLE_OFF_BEHAVIOR:this.set("value",this.get("toggleOffValue"));break;case SC.HOLD_BEHAVIOR:this._runHoldAction(a,c);break;default:this._runAction(a)}},_runAction:function(a){var c=this.get("action"),d=this.get("target")||null,b;if(c){if(c&&(SC.typeOf(c)===SC.T_FUNCTION)){this.action(a);return}else{b=this.getPath("pane.rootResponder");if(b){b.sendAction(c,d,this,this.get("pane"),null,this)}}}},_runHoldAction:function(a,b){if(this.get("isActive")){this._runAction();if(!b){SC.RunLoop.begin();this.invokeLater("_runHoldAction",this.get("holdInterval"),a);SC.RunLoop.end()}}},didBecomeKeyResponderFrom:function(a){if(!this._isFocused){this._isFocused=YES;this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$().focus()}}},willLoseKeyResponderTo:function(a){if(this._isFocused){this._isFocused=NO}},didAppendToDocument:function(){if(SC.browser.isIE&&SC.browser.compare(SC.browser.engineVersion,"7")===0&&this.get("useStaticLayout")){var e=this.get("layout"),d=this.$(),a=0;if(d&&d[0]&&(a=d[0].clientWidth)&&a!==0&&this._labelMinWidthIE7===0){var c=this.$(".sc-button-label"),h=parseInt(c.css("paddingRight"),0),b=parseInt(c.css("paddingLeft"),0),g=parseInt(c.css("marginRight"),0),f=parseInt(c.css("marginLeft"),0);if(g=="auto"){SC.Logger.log(g+","+f+","+h+","+b)}if(!h&&isNaN(h)){h=0}if(!b&&isNaN(b)){b=0}if(!g&&isNaN(g)){g=0}if(!f&&isNaN(f)){f=0}this._labelMinWidthIE7=a-(h+b)-(g+f);c.css("minWidth",this._labelMinWidthIE7+"px")}else{this.invokeLater(this.didAppendToDocument,1)}}}});SC.ButtonView.CLICK_AND_HOLD_DELAY=SC.browser.isIE?600:300;SC.REGULAR_BUTTON_HEIGHT=24;sc_require("panes/panel");sc_require("views/button");SC.BUTTON1_STATUS="button1";SC.BUTTON2_STATUS="button2";SC.BUTTON3_STATUS="button3";SC.AlertPane=SC.PanelPane.extend({classNames:["sc-alert"],ariaRole:"alertdialog",delegate:null,icon:"sc-icon-alert-48",message:"",ariaLabel:function(){return this.get("message")}.property("message").cacheable(),description:"",displayDescription:function(){var a=this.get("description");if(!a||a.length===0){return a}a=SC.RenderContext.escapeHTML(a);return'<p class="description">'+a.split("\n").join('</p><p class="description">')+"</p>"}.property("description").cacheable(),caption:"",displayCaption:function(){var a=this.get("caption");if(!a||a.length===0){return a}a=SC.RenderContext.escapeHTML(a);return'<p class="caption">'+a.split("\n").join('</p><p class="caption">')+"</p>"}.property("caption").cacheable(),button1:SC.outlet("contentView.childViews.1.childViews.1"),button2:SC.outlet("contentView.childViews.1.childViews.0"),button3:SC.outlet("contentView.childViews.2.childViews.0"),buttonThreeWrapper:SC.outlet("contentView.childViews.2"),layout:{top:0.3,centerX:0,width:500},contentView:SC.View.extend({useStaticLayout:YES,layout:{left:0,right:0,top:0,height:"auto"},childViews:[SC.View.extend(SC.StaticLayout,{classNames:["info"],render:function(a,c){var b=this.get("pane");if(b.get("icon")=="blank"){a.addClass("plain")}a.push('<img src="'+SC.BLANK_IMAGE_URL+'" class="icon '+b.get("icon")+'" />');a.begin("h1").attr("class","header").text(b.get("message")||"").end();a.push(b.get("displayDescription")||"");a.push(b.get("displayCaption")||"");a.push('<div class="separator"></div>')}}),SC.View.extend({layout:{bottom:13,height:24,right:18,width:466},childViews:["cancelButton","okButton"],classNames:["text-align-right"],cancelButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON2_STATUS,localize:YES,layout:{right:5,height:"auto",width:"auto",bottom:0},isCancel:YES,action:"dismiss",isVisible:NO}),okButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON1_STATUS,localize:YES,layout:{left:0,height:"auto",width:"auto",bottom:0},isDefault:YES,action:"dismiss",isVisible:NO})}),SC.View.extend({layout:{bottom:13,height:24,left:18,width:150},childViews:[SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON3_STATUS,localize:YES,layout:{left:0,height:"auto",width:"auto",bottom:0},action:"dismiss",isVisible:NO})]})]}),dismiss:function(b){var a=this.delegate,c,d,e;if(a&&a.alertPaneDidDismiss){a.alertPaneDidDismiss(this,b.get("actionKey"))}if(d=(b&&b.get("customAction"))){if(SC.typeOf(d)===SC.T_FUNCTION){d.call(d)}else{c=this.getPath("pane.rootResponder");if(c){e=b.get("customTarget");c.sendAction(d,e||a,this,this,null,this)}}}this.remove()},alertInfoDidChange:function(){var a=this.getPath("contentView.childViews.0");if(a){a.displayDidChange()}}.observes("icon","message","displayDescription","displayCaption")});SC.AlertPane.mixin({show:function(f){f=SC.AlertPane._argumentsCall.apply(this,arguments);var a=this.create(f),j=0,g=f.buttons,e,h,b,d,c;if(g){g.forEach(function(k){j++;if(!k){return}e=a.get("button%@".fmt(j));h=k.title;b=k.action;d=k.target;c=f.themeName||"capsule";e.set("title".fmt(j),h);if(b){e.set("customAction".fmt(j),b)}if(d){e.set("customTarget".fmt(j),d)}e.set("isVisible",!!h);e.set("themeName",c)})}else{e=a.get("button1");e.set("title","OK");e.set("isVisible",YES)}var i=a.append();a.adjust("height",a.childViews[0].$().height());a.updateLayout();return i},warn:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="sc-icon-alert-48";return this.show(a)},info:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="sc-icon-info-48";return this.show(a)},error:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="sc-icon-error-48";return this.show(a)},plain:function(a){a=SC.AlertPane._argumentsCall.apply(this,arguments);a.icon="blank";return this.show(a)},_argumentsCall:function(b){var a=b;if(SC.typeOf(b)!==SC.T_HASH){var c=this._normalizeArguments(arguments);a={message:c[0],description:c[1],caption:c[2],delegate:c[7],icon:(c[6]||"sc-icon-alert-48"),themeName:"capsule"};if(SC.typeOf(c[3])===SC.T_STRING||SC.typeOf(c[4])===SC.T_STRING||SC.typeOf(c[5])===SC.T_STRING){a.buttons=[{title:c[3]},{title:c[4]},{title:c[5]}]}}return a},_normalizeArguments:function(b){b=SC.A(b);var a=b.length,c=b[a-1];if(SC.typeOf(c)!==SC.T_STRING){b[a-1]=null}else{c=null}b[7]=c;return b}});sc_require("panes/panel");SC.PalettePane=SC.PanelPane.extend({classNames:["sc-palette"],isModal:NO,modalPane:SC.ModalPane,isAnchored:NO,_mouseOffsetX:null,_mouseOffsetY:null,mouseDown:function(a){var b=this.get("frame");this._mouseOffsetX=b?(b.x-a.pageX):0;this._mouseOffsetY=b?(b.y-a.pageY):0;return YES},mouseDragged:function(a){if(!this.isAnchored){this.set("layout",{width:this.layout.width,height:this.layout.height,left:this._mouseOffsetX+a.pageX,top:this._mouseOffsetY+a.pageY});this.updateLayout()}return YES},touchStart:function(a){return this.mouseDown(a)},touchesDragged:function(a){return this.mouseDragged(a)}});sc_require("panes/palette");SC.PICKER_MENU="menu";SC.PICKER_FIXED="fixed";SC.PICKER_POINTER="pointer";SC.PICKER_MENU_POINTER="menu-pointer";SC.POINTER_LAYOUT=["perfectRight","perfectLeft","perfectTop","perfectBottom"];SC.PickerPane=SC.PalettePane.extend({classNames:["sc-picker"],isAnchored:YES,isModal:YES,pointerPos:"perfectRight",pointerPosX:0,pointerPosY:0,anchorElement:null,anchorCached:null,preferType:null,preferMatrix:null,pointerOffset:null,extraRightOffset:0,removeTarget:null,removeAction:null,repositionOnWindowResize:YES,_anchorView:null,_anchorHTMLElement:null,popup:function(c,b,d,a){if(c){if(c.isView){this._anchorView=c;this._setupScrollObservers(c)}else{this._anchorHTMLElement=c}}this.beginPropertyChanges();if(b){this.set("preferType",b)}if(d){this.set("preferMatrix",d)}if(a){this.set("pointerOffset",a)}this.endPropertyChanges();this.positionPane();this._hideOverflow();return this.append()},positionPane:function(f){f=f&&this.get("anchorCached");var b=f?this.get("anchorCached"):this.get("anchorElement"),c=this.get("preferType"),d=this.get("preferMatrix"),e=this.get("layout"),a;if(b){if(!f){b=this.computeAnchorRect(b);this.set("anchorCached",b)}if(b.x===0&&b.y===0){return}a=SC.cloneRect(b);if(c){switch(c){case SC.PICKER_MENU:case SC.PICKER_FIXED:if(!d||d.length!==3){this.set("preferMatrix",[1,4,3])}a.x+=((this.preferMatrix[2]===0)?a.width:0)+this.preferMatrix[0];a.y+=((this.preferMatrix[2]===3)?a.height:0)+this.preferMatrix[1];break;default:a.y+=a.height;break}}else{a.y+=a.height}a=this.fitPositionToScreen(a,this.get("frame"),b);this.adjust({width:a.width,height:a.height,left:a.x,top:a.y})}else{this.adjust({width:e.width,height:e.height,centerX:0,centerY:0})}this.updateLayout();return this},computeAnchorRect:function(c){var e,b,d,a=SC.RootResponder.responder.computeWindowSize();if(c.getBoundingClientRect){e=c.getBoundingClientRect();b={x:e.left,y:e.top,width:e.width,height:e.height};if(b.width===undefined||b.height===undefined){d=SC.$(c);b.width=d.outerWidth();b.height=d.outerHeight()}}else{b=SC.offset(c);d=SC.$(c);b.width=d.outerWidth();b.height=d.outerHeight()}b.height=(a.height-b.y)<b.height?(a.height-b.y):b.height;if(!SC.browser.isIE&&window.scrollX>0||window.scrollY>0){b.x+=window.scrollX;b.y+=window.scrollY}else{if(SC.browser.isIE&&(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)){b.x+=document.documentElement.scrollLeft;b.y+=document.documentElement.scrollTop}}return b},fitPositionToScreen:function(h,c,b){var a=SC.RootResponder.responder.computeWindowSize(),g={x:0,y:0,width:a.width,height:a.height};var d=SC.RootResponder.responder.mainPane;if(d){var e=d.layout.minWidth,f=d.layout.minHeight;if(e&&g.width<e){g.width=d.layout.minWidth}if(f&&g.height<f){g.height=d.layout.minHeight}}c.x=h.x;c.y=h.y;if(this.preferType){switch(this.preferType){case SC.PICKER_MENU:c=this.fitPositionToScreenMenu(g,c,this.get("isSubMenu"));break;case SC.PICKER_MENU_POINTER:this.setupPointer(b);c=this.fitPositionToScreenMenuPointer(g,c,b);break;case SC.PICKER_POINTER:this.setupPointer(b);c=this.fitPositionToScreenPointer(g,c,b);break;case SC.PICKER_FIXED:break;default:break}}else{c=this.fitPositionToScreenDefault(g,c,b)}this.displayDidChange();return c},fitPositionToScreenDefault:function(c,d,b){if(SC.maxX(d)>c.width){var e=Math.max(SC.maxX(b),d.width);d.x=Math.min(e,c.width)-d.width}if(SC.minX(d)<0){d.x=SC.minX(Math.max(b,0));if(SC.maxX(d)>c.width){d.x=Math.max(0,c.width-d.width)}}if(SC.maxY(d)>c.height){e=Math.max((b.y-d.height),0);if(e>c.height){d.y=Math.max(0,c.height-d.height)}else{d.y=e}}if(SC.minY(d)<0){e=Math.min(SC.maxY(b),(c.height-b.height));d.y=Math.max(e,0)}return d},fitPositionToScreenMenu:function(c,b,a){if(a){b.x-=this.get("submenuOffsetX");b.y-=Math.floor(this.get("menuHeightPadding")/2)}if((b.x+b.width)>(c.width-20)){if(a){b.x=b.x-(b.width*2)}else{b.x=c.width-b.width-20}}if(b.x<7){b.x=7}if(b.y<7){b.height+=b.y;b.y=7}if(b.height+b.y+35>=c.height){if(b.height+50>=c.height){b.y=SC.MenuPane.VERTICAL_OFFSET;b.height=c.height-(SC.MenuPane.VERTICAL_OFFSET*2)}else{b.y+=(c.height-(b.height+b.y+35))}}return b},fitPositionToScreenMenuPointer:function(c,d,b){d=this.fitPositionToScreenPointer(c,d,b);if(d.height+d.y+35>=c.height){d.height=c.height-d.y-(SC.MenuPane.VERTICAL_OFFSET*2)}return d},fitPositionToScreenPointer:function(o,l,n){var h=[this.pointerOffset[0],this.pointerOffset[1],this.pointerOffset[2],this.pointerOffset[3]];var e=[[n.x+n.width+h[0],n.y+parseInt(n.height/2,0)-40],[n.x-l.width+h[1],n.y+parseInt(n.height/2,0)-40],[n.x+parseInt((n.width/2)-(l.width/2),0),n.y-l.height+h[2]],[n.x+parseInt((n.width/2)-(l.width/2),0),n.y+n.height+h[3]]];var c=[[n.x+n.width+l.width+h[0],n.y+parseInt(n.height/2,0)+l.height-24],[n.x+h[1],n.y+parseInt(n.height/2,0)+l.height-24],[n.x+parseInt((n.width/2)-(l.width/2),0)+l.width,n.y+h[2]],[n.x+parseInt((n.width/2)-(l.width/2),0)+l.width,n.y+n.height+l.height+h[3]]];var g=[[e[0][1]>0?0:0-e[0][1],c[0][0]<o.width?0:c[0][0]-o.width,c[0][1]<o.height?0:c[0][1]-o.height,e[0][0]>0?0:0-e[0][0]],[e[1][1]>0?0:0-e[1][1],c[1][0]<o.width?0:c[1][0]-o.width,c[1][1]<o.height?0:c[1][1]-o.height,e[1][0]>0?0:0-e[1][0]],[e[2][1]>0?0:0-e[2][1],c[2][0]<o.width?0:c[2][0]-o.width,c[2][1]<o.height?0:c[2][1]-o.height,e[2][0]>0?0:0-e[2][0]],[e[3][1]>0?0:0-e[3][1],c[3][0]<o.width?0:c[3][0]-o.width,c[3][1]<o.height?0:c[3][1]-o.height,e[3][0]>0?0:0-e[3][0]]];var d=this.preferMatrix;if(d[4]===-1){l.x=n.x+parseInt(n.width/2,0);l.y=n.y+parseInt(n.height/2,0)-parseInt(l.height/2,0);this.set("pointerPos",SC.POINTER_LAYOUT[0]+" fallback");this.set("pointerPosY",parseInt(l.height/2,0)-40)}else{l.x=e[d[4]][0];l.y=e[d[4]][1];this.set("pointerPos",SC.POINTER_LAYOUT[d[4]]);this.set("pointerPosY",0)}this.set("pointerPosX",0);for(var j=0,b,k=SC.POINTER_LAYOUT.length;j<k;j++){b=d[j];if(g[b][0]===0&&g[b][1]===0&&g[b][2]===0&&g[b][3]===0){if(d[4]!==b){l.x=e[b][0];l.y=e[b][1];this.set("pointerPosY",0);this.set("pointerPos",SC.POINTER_LAYOUT[b])}j=SC.POINTER_LAYOUT.length}else{if((b===0||b===1)&&g[b][0]===0&&g[b][1]===0&&g[b][2]<l.height-91&&g[b][3]===0){if(d[4]!==b){l.x=e[b][0];this.set("pointerPos",SC.POINTER_LAYOUT[b])}l.y=e[b][1]-g[b][2];this.set("pointerPosY",g[b][2]);j=SC.POINTER_LAYOUT.length}else{if((b===0||b===1)&&g[b][0]===0&&g[b][1]===0&&g[b][2]<=l.height-51&&g[b][3]===0){if(d[4]!==b){l.x=e[b][0]}l.y=e[b][1]-(l.height-51);this.set("pointerPosY",(l.height-53));this.set("pointerPos",SC.POINTER_LAYOUT[b]+" extra-low");j=SC.POINTER_LAYOUT.length}else{if((b===2||b===3)&&g[b][0]===0&&g[b][1]<=parseInt(l.width/2,0)-this.get("extraRightOffset")&&g[b][2]===0&&g[b][3]===0){if(d[4]!==b){l.y=e[b][1]}l.x=e[b][0]-(parseInt(l.width/2,0)-this.get("extraRightOffset"));this.set("pointerPos",SC.POINTER_LAYOUT[b]+" extra-right");j=SC.POINTER_LAYOUT.length}else{if((b===2||b===3)&&g[b][0]===0&&g[b][1]===0&&g[b][2]===0&&g[b][3]<=parseInt(l.width/2,0)-this.get("extraRightOffset")){if(d[4]!==b){l.y=e[b][1]}l.x=e[b][0]+(parseInt(l.width/2,0)-this.get("extraRightOffset"));this.set("pointerPos",SC.POINTER_LAYOUT[b]+" extra-left");j=SC.POINTER_LAYOUT.length}}}}}}return l},setupPointer:function(f){var g=this.pointerOffset,e=SC.PickerPane;if(!g||g.length!==4){if(this.get("preferType")==SC.PICKER_MENU_POINTER){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("pointerOffset",e.TINY_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",e.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.SMALL_CONTROL_SIZE:this.set("pointerOffset",e.SMALL_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",e.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.REGULAR_CONTROL_SIZE:this.set("pointerOffset",e.REGULAR_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",e.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.LARGE_CONTROL_SIZE:this.set("pointerOffset",e.LARGE_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",e.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.HUGE_CONTROL_SIZE:this.set("pointerOffset",e.HUGE_PICKER_MENU_POINTER_OFFSET);this.set("extraRightOffset",e.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET);break}}else{var d=(f.width<16)?((f.width<4)?9:6):0,b=(f.height<16)?((f.height<4)?9:6):0,c=e.PICKER_POINTER_OFFSET;var h=[c[0]+d,c[1]-d,c[2]-b,c[3]+b];this.set("pointerOffset",h);this.set("extraRightOffset",e.PICKER_EXTRA_RIGHT_OFFSET)}}if(!this.preferMatrix||this.preferMatrix.length!==5){this.set("preferMatrix",this.get("preferType")===SC.PICKER_MENU_POINTER?[3,2,1,0,3]:[0,1,2,3,2])}},displayProperties:["preferType","pointerPos","pointerPosY"],renderDelegateName:"pickerRenderDelegate",modalPaneDidClick:function(a){var d=this.get("frame"),e=this.get("removeTarget")||null,c=this.get("removeAction"),b=this.get("rootResponder");if(!this.clickInside(d,a)){if(c){b.sendAction(c,e,this,this,null,this)}else{this.remove()}return YES}return NO},mouseDown:function(a){return this.modalPaneDidClick(a)},clickInside:function(b,a){return SC.pointInRect({x:a.pageX,y:a.pageY},b)},windowSizeDidChange:function(b,a){if(this.repositionOnWindowResize){this.positionPane()}},remove:function(){if(this.get("isVisibleInWindow")&&this.get("isPaneAttached")){this._withdrawOverflowRequest()}this._removeScrollObservers();return arguments.callee.base.apply(this,arguments)},anchorElement:function(a,b){var c;if(b===undefined){c=this._anchorView;return c?c.get("layer"):this._anchorHTMLElement}else{if(!b){throw"You must set 'anchorElement' to either a view or a DOM element"}else{if(b.isView){this._anchorView=b;this._anchorHTMLElement=null}else{this._anchorView=null;this._anchorHTMLElement=b}}}}.property("layer").cacheable(),_hideOverflow:function(){var b=SC.$(document.body),a=SC.$(".sc-main"),d=parseInt(a.css("minWidth"),0),e=parseInt(a.css("minHeight"),0),c=SC.RootResponder.responder.get("currentWindowSize");if(c.width>=d&&c.height>=e){SC.bodyOverflowArbitrator.requestHidden(this)}},_withdrawOverflowRequest:function(){SC.bodyOverflowArbitrator.withdrawRequest(this)},_getScrollViewOfView:function(b){var a=b;while(YES){if(!a){return null}if(a.isScrollable){return a}a=a.get("parentView")}},_setupScrollObservers:function(b){var a=this._getScrollViewOfView(b);if(a){a.addObserver("horizontalScrollOffset",this,this._scrollOffsetDidChange);a.addObserver("verticalScrollOffset",this,this._scrollOffsetDidChange);this._scrollView=a}},_removeScrollObservers:function(){var a=this._scrollView;if(a){a.removeObserver("horizontalScrollOffset",this,this._scrollOffsetDidChange);a.removeObserver("verticalScrollOffset",this,this._scrollOffsetDidChange)}},_scrollOffsetDidChange:function(){this.positionPane()}});SC.PickerPane.PICKER_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.PICKER_EXTRA_RIGHT_OFFSET=20;SC.PickerPane.TINY_PICKER_MENU_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;SC.PickerPane.SMALL_PICKER_MENU_POINTER_OFFSET=[9,-9,-8,8];SC.PickerPane.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET=11;SC.PickerPane.REGULAR_PICKER_MENU_POINTER_OFFSET=[9,-9,-12,12];SC.PickerPane.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;SC.PickerPane.LARGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-16,16];SC.PickerPane.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=17;SC.PickerPane.HUGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-18,18];SC.PickerPane.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=12;SC.SeparatorView=SC.View.extend({classNames:["sc-separator-view"],tagName:"span",layoutDirection:SC.LAYOUT_HORIZONTAL,render:function(a,b){if(b){a.push("<span></span>")}a.addClass(this.get("layoutDirection"))}});sc_require("views/button");sc_require("views/separator");SC.MenuItemView=SC.View.extend(SC.ContentDisplay,{classNames:["sc-menu-item"],displayProperties:["title","isEnabled","isSeparator","isChecked"],ariaRole:"menuitem",escapeHTML:YES,acceptsFirstResponder:YES,blocksIEDeactivate:YES,isContextMenuEnabled:NO,content:null,isSeparator:function(){return this.getContentProperty("itemSeparatorKey")===YES}.property("content").cacheable(),isEnabled:function(){return this.getContentProperty("itemIsEnabledKey")!==NO&&this.getContentProperty("itemSeparatorKey")!==YES}.property("content.isEnabled").cacheable(),isChecked:function(){return this.getContentProperty("itemCheckboxKey")}.property(),subMenu:function(){var c=this.get("content"),b,a;if(!c){return null}a=this.get("parentMenu");b=c.get(a.itemSubMenuKey);if(b){if(SC.kindOf(b,SC.MenuPane)){b.set("isModal",NO);b.set("isSubMenu",YES);b.set("parentMenu",a);return b}else{return SC.MenuPane.create({layout:{width:200},items:b,isModal:NO,isSubMenu:YES,parentMenu:a,controlSize:a.get("controlSize"),exampleView:a.get("exampleView")})}}return null}.property("content").cacheable(),hasSubMenu:function(){return !!this.get("subMenu")}.property("subMenu").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);this.contentDidChange()},render:function(b,h){var c=this.get("content"),a,f,e=this.get("parentMenu"),d=this.get("itemWidth")||e.layout.width,g=this.get("itemHeight")||SC.DEFAULT_MENU_ITEM_HEIGHT;this.set("itemWidth",d);this.set("itemHeight",g);if(this.get("isSeparator")){b.attr("role","separator")}else{if(this.get("isChecked")){b.attr("role","menuitemcheckbox");b.attr("aria-checked",true)}}b=b.begin("a").addClass("menu-item");if(this.get("isSeparator")){b.push('<span class="separator"></span>');b.addClass("disabled")}else{f=c.get(e.itemIconKey);if(f){this.renderImage(b,f);b.addClass("has-icon")}f=this.get("title");if(SC.typeOf(f)!==SC.T_STRING){f=f.toString()}this.renderLabel(b,f);if(this.get("isChecked")){b.push('<div class="checkbox"></div>')}if(this.get("hasSubMenu")){this.renderBranch(b)}f=this.getContentProperty("itemShortCutKey");if(f){this.renderShortcut(b,f)}}b=b.end()},renderImage:function(b,d){var a,c;if(d&&SC.ImageView.valueIsUrl(d)){a=d;c=""}else{c=d;a=SC.BLANK_IMAGE_URL}b.begin("img").addClass("image").addClass(c).attr("src",a).end()},renderLabel:function(b,a){if(this.get("escapeHTML")){a=SC.RenderContext.escapeHTML(a)}b.push("<span class='value ellipsis'>"+a+"</span>")},renderBranch:function(a){a.push('<span class="has-branch"></span>')},renderShortcut:function(b,a){b.push('<span class = "shortcut">'+a+"</span>")},showSubMenu:function(){var a=this.get("subMenu");if(a){a.set("mouseHasEntered",NO);a.popup(this,[0,0,0])}this._subMenuTimer=null},title:function(){var b=this.getContentProperty("itemTitleKey"),a=this.getPath("parentMenu.localize");if(a&&b){b=SC.String.loc(b)}return b||""}.property("content.title").cacheable(),getContentProperty:function(b){var a=this.get("content"),c=this.get("parentMenu");if(a){return a.get(c.get(b))}},mouseUp:function(b){var a;a=this.getPath("parentMenu.rootMenu.targetMenuItem");if(a){a.performAction()}return YES},performAction:function(){if(!this.get("isEnabled")){this.getPath("parentMenu.rootMenu").remove();return YES}if(this.get("hasSubMenu")){return NO}var b=this.getContentProperty("itemDisableMenuFlashKey"),a;if(b){this.sendAction()}else{this._flashCounter=0;a=this.getPath("parentMenu.rootMenu");a._isFlashing=YES;this.invokeLater(this.flashHighlight,25);this.invokeLater(this.sendAction,150)}return YES},sendAction:function(){var c=this.getContentProperty("itemActionKey"),d=this.getContentProperty("itemTargetKey"),b=this.getPath("parentMenu.rootMenu"),a;this.getPath("parentMenu.rootMenu").remove();b._isFlashing=NO;c=(c===undefined)?b.get("action"):c;d=(d===undefined)?b.get("target"):d;b.set("selectedItem",this.get("content"));if(SC.typeOf(c)===SC.T_FUNCTION){c.apply(d,[b])}else{a=this.getPath("pane.rootResponder")||SC.RootResponder.responder;if(a){a.sendAction(c,d,b)}}},flashHighlight:function(){var a=this._flashCounter,b=this.$();if(a%2===0){b.addClass("focus")}else{b.removeClass("focus")}if(a<=2){this.invokeLater(this.flashHighlight,50);this._flashCounter++}},mouseDown:function(a){return YES},mouseEntered:function(a){var c=this.get("parentMenu"),b=c.get("rootMenu");if(b._isFlashing){return}c.set("mouseHasEntered",YES);this.set("mouseHasEntered",YES);c.set("currentMenuItem",this);if(this.get("isEnabled")){this.becomeFirstResponder()}if(this.get("hasSubMenu")){this._subMenuTimer=this.invokeLater(this.showSubMenu,100)}return YES},mouseExited:function(a){var b,c;if(this.get("hasSubMenu")){c=this._subMenuTimer;if(c){c.invalidate()}else{this.invokeLater(this.checkMouseLocation,100)}}else{b=this.get("parentMenu");if(b.get("currentMenuItem")===this){b.set("currentMenuItem",null)}}return YES},touchStart:function(a){this.mouseEntered(a);return YES},touchEnd:function(a){return this.mouseUp(a)},touchEntered:function(a){return this.mouseEntered(a)},touchExited:function(a){return this.mouseExited(a)},checkMouseLocation:function(){var b=this.get("subMenu"),c=this.get("parentMenu"),a,d;if(!b.get("mouseHasEntered")){a=c.get("currentMenuItem");if(a===this||a===null){d=c.get("previousMenuItem");if(d){d.resignFirstResponder()}this.resignFirstResponder();b.remove()}}},moveUp:function(b,a){var c=this.get("parentMenu");if(c){c.moveUp(this)}return YES},moveDown:function(b,a){var c=this.get("parentMenu");if(c){c.moveDown(this)}return YES},moveRight:function(b,a){this.showSubMenu();return YES},insertText:function(b,a){var c=this.get("parentMenu");if(c){c.insertText(b,a)}},keyDown:function(a){return this.interpretKeyEvents(a)},keyUp:function(a){return YES},cancel:function(a){this.getPath("parentMenu.rootMenu").remove();return YES},didBecomeFirstResponder:function(a){if(a!==this){return}var b=this.get("parentMenu");if(b){b.set("currentSelectedMenuItem",this)}},willLoseFirstResponder:function(a){if(a!==this){return}var b=this.get("parentMenu");if(b){b.set("currentSelectedMenuItem",null);b.set("previousSelectedMenuItem",this)}},insertNewline:function(b,a){this.mouseUp(a)},closeParent:function(){this.$().removeClass("focus");var a=this.get("parentMenu");if(a){a.remove()}},clickInside:function(b,a){return SC.pointInRect({x:a.pageX,y:a.pageY},b)},contentDidChange:function(){var b=this.get("content"),a=this._content;if(b===a){return}var c=this.contentPropertyDidChange;if(a&&a.removeObserver){a.removeObserver("*",this,c)}this._content=b;if(b&&b.addObserver){b.addObserver("*",this,c)}this.contentPropertyDidChange(b,"*")}.observes("content"),contentPropertyDidChange:function(g,j){var b=this.get("parentMenu");if(!b){return}var a=SC.MenuItemView._contentPropertyToMenuItemPropertyMapping,h=SC.keys(a),e,f,d,c;if(j==="*"){for(e=0,f=h.length;e<f;++e){d=h[e];c=a[d];this.notifyPropertyChange(c)}}else{for(e=0,f=h.length;e<f;++e){d=h[e];if(b.get(d)===j){c=a[d];this.notifyPropertyChange(c)}}}}});SC.MenuItemView._contentPropertyToMenuItemPropertyMapping={itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemSeparatorKey:"isSeparator",itemSubMenuKey:"subMenu"};sc_require("panes/picker");sc_require("views/menu_item");SC.MenuPane=SC.PickerPane.extend({classNames:["sc-menu"],ariaRole:"menu",items:[],controlSize:SC.REGULAR_CONTROL_SIZE,itemHeight:SC.propertyFromRenderDelegate("itemHeight",20),itemSeparatorHeight:SC.propertyFromRenderDelegate("itemSeparatorHeight",9),menuHeight:0,menuHeightPadding:SC.propertyFromRenderDelegate("menuHeightPadding",6),submenuOffsetX:SC.propertyFromRenderDelegate("submenuOffsetX",2),selectedItem:null,exampleView:SC.MenuItemView,anchor:null,isSubMenu:NO,localize:YES,acceptsMenuPane:YES,isContextMenuEnabled:NO,popup:function(b,c){var a;this.beginPropertyChanges();if(b){if(b.isView){this._anchorView=b;this._setupScrollObservers(b)}else{this._anchorHTMLElement=b}}if(c){this.set("preferMatrix",c)}this.adjust("height",this.get("menuHeight"));this.positionPane();this.set("defaultResponder",this);this.endPropertyChanges();this._hideOverflow();this.append()},remove:function(){var a=this.get("parentMenu");this.set("currentMenuItem",null);this.closeOpenMenus();this.resignMenuPane();if(a){a.becomeMenuPane()}return arguments.callee.base.apply(this,arguments)},itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemValueKey:"value",itemIconKey:"icon",itemHeightKey:"height",itemSubMenuKey:"subMenu",itemSeparatorKey:"isSeparator",itemTargetKey:"target",itemActionKey:"action",itemCheckboxKey:"checkbox",itemShortCutKey:"shortcut",itemKeyEquivalentKey:"keyEquivalent",itemDisableMenuFlashKey:"disableMenuFlash",itemLayerIdKey:"layerId",itemExampleViewKey:"exampleView",menuItemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemSeparatorKey","itemActionKey","itemCheckboxKey","itemShortCutKey","itemHeightKey","itemSubMenuKey","itemKeyEquivalentKey","itemTargetKey","itemLayerIdKey"],preferType:SC.PICKER_MENU,isModal:YES,_menuView:null,init:function(){return arguments.callee.base.apply(this,arguments)},displayProperties:["controlSize"],renderDelegateName:"menuRenderDelegate",createChildViews:function(){var b,a,c;b=this._menuScrollView=this.createChildView(SC.MenuScrollView,{borderStyle:SC.BORDER_NONE,controlSize:this.get("controlSize")});a=this._menuView=SC.View.create({parentViewDidResize:function(){this.notifyPropertyChange("frame")},viewDidResize:function(){}});c=this.get("menuItemViews");a.set("layout",{top:0,left:0,height:this.get("menuHeight")});a.replaceAllChildren(c);b.set("contentView",a);this.childViews=[b];return this},paneDidAttach:function(){var a=(this.rootResponder=SC.RootResponder.responder);a.panes.add(this);this.set("currentWindowSize",a.computeWindowSize());this.set("isPaneAttached",YES);this.parentViewDidChange();this._notifyDidAppendToDocument();this.becomeMenuPane();return this},becomeMenuPane:function(){if(this.rootResponder){this.rootResponder.makeMenuPane(this)}return this},resignMenuPane:function(){if(this.rootResponder){this.rootResponder.makeMenuPane(null)}return this},menuItemViews:function(){return this.createMenuItemViews()}.property("displayItems").cacheable(),createMenuItemViews:function(){var i=[],q=this.get("displayItems"),a=this.get("exampleView"),t,d,l,k,e,p,n,g,b,j,r,c,f,m,h,o,v,u,s;if(!q){return i}n=this.get("itemHeightKey");g=this.get("itemSeparatorKey");k=this.get("itemExampleViewKey");b=this.get("itemHeight");f=this.get("itemKeyEquivalentKey");j=this.get("itemSeparatorHeight");v=this.get("itemLayerIdKey");c=Math.floor(this.get("menuHeightPadding")/2);r=c;h=this.menuItemKeys.map(SC._menu_fetchKeys,this);s=q.get("length");for(o=0;o<s;o++){t=q[o];p=t.get(n);if(!p){p=t.get(g)?j:b}u={layout:{height:p,top:r},contentDisplayProperties:h,content:t,parentMenu:this};if(t.get(v)){u.layerId=t.get(v)}e=t.get(k);if(e){d=e}else{d=a}l=this._menuView.createChildView(d,u);i[o]=l;r+=p;m=t.get(f);if(m){if(SC.typeOf(m)===SC.T_ARRAY){m.forEach(function(w){this._keyEquivalents[w]=l},this)}else{this._keyEquivalents[m]=l}}}this.set("menuHeight",r+c);return i},menuItemViewForContentIndex:function(a){var b=this.get("menuItemViews");if(!b){return undefined}return b.objectAt(a)},_keyEquivalents:{},rootMenu:function(){if(this.get("isSubMenu")){return this.getPath("parentMenu.rootMenu")}return this}.property("isSubMenu").cacheable(),windowSizeDidChange:function(b,a){this.remove();return arguments.callee.base.apply(this,arguments)},displayItems:function(){var d=this.get("items"),c=this.get("localize"),h=this.get("itemHeight"),b,e=[],a,f,g;if(!d){return null}b=d.get("length");for(a=0;a<b;a++){f=d.objectAt(a);if(!f){continue}g=SC.typeOf(f);if(g===SC.T_STRING){f=SC.Object.create({title:f,value:f,isEnabled:YES})}else{if(g===SC.T_HASH){f=SC.Object.create(f)}else{if(g===SC.T_ARRAY){f=this.convertArrayMenuItemToObject(f)}}}f.contentIndex=a;e.push(f)}return e}.property("items").cacheable(),_sc_menu_itemsDidChange:function(){var a=this.get("menuItemViews");this._menuView.replaceAllChildren(a);this._menuView.adjust("height",this.get("menuHeight"))}.observes("items"),convertArrayMenuItemToObject:function(f){SC.Logger.warn("Support for Array-based menu items has been deprecated.  Please update your menus to use a hash.");var e,c=SC._menu_fetchKeys,b=SC._menu_fetchItem,h,d=SC.Object.create(),a,g;e=this.menuItemKeys.map(c,this);d[e[0]]=f[0];d[e[1]]=f[1];d[e[2]]=f[2];d[e[3]]=f[3];d[e[4]]=f[4];d[e[5]]=f[5];d[e[6]]=f[6];d[e[7]]=f[7];d[e[8]]=f[8];d[e[9]]=f[9];d[e[10]]=f[10];d[e[11]]=f[11];d[e[12]]=f[12];return d},currentMenuItem:function(a,b){if(b!==undefined){if(this._currentMenuItem!==null){this.set("previousMenuItem",this._currentMenuItem)}this._currentMenuItem=b;this.setPath("rootMenu.targetMenuItem",b);return b}return this._currentMenuItem}.property().cacheable(),_sc_menu_currentMenuItemDidChange:function(){var a=this.get("currentMenuItem"),b=this.get("previousMenuItem");if(b){if(b.get("hasSubMenu")&&a===null){}else{b.resignFirstResponder();this.closeOpenMenusFor(b)}}if(a&&a.get("isEnabled")){a.scrollToVisible()}}.observes("currentMenuItem"),closeOpenMenusFor:function(a){if(!a){return}var b=a.get("parentMenu");while(b&&a){b=a.get("subMenu");if(b){b.remove();a.resignFirstResponder();a=b.get("previousMenuItem")}}},closeOpenMenus:function(){this.closeOpenMenusFor(this.get("previousMenuItem"))},mouseDown:function(a){this.modalPaneDidClick(a);return YES},mouseEntered:function(a){this.set("mouseHasEntered",YES)},keyUp:function(a){var b=this.interpretKeyEvents(a);return !b?NO:b},moveUp:function(){var c=this.get("currentMenuItem"),d=this.get("menuItemViews"),b,e,a;if(!c){a=d.get("length")-1}else{b=c.getPath("content.contentIndex");if(b===0){return YES}a=b-1}while(a>=0){if(d[a].get("isEnabled")){this.set("currentMenuItem",d[a]);d[a].becomeFirstResponder();break}a--}return YES},moveDown:function(){var d=this.get("currentMenuItem"),e=this.get("menuItemViews"),b=e.get("length"),c,f,a;if(!d){a=0}else{c=d.getPath("content.contentIndex");if(c===b){return YES}a=c+1}while(a<b){if(e[a].get("isEnabled")){this.set("currentMenuItem",e[a]);e[a].becomeFirstResponder();break}a++}return YES},moveToBeginningOfDocument:function(){var c=this.get("menuItemViews"),b=c.get("length"),a=0;while(a<b){if(c[a].get("isEnabled")){this.set("currentMenuItem",c[a]);c[a].becomeFirstResponder();break}++a}return YES},moveToEndOfDocument:function(){var c=this.get("menuItemViews"),b=c.get("length"),a=b-1;while(a>=0){if(c[a].get("isEnabled")){this.set("currentMenuItem",c[a]);c[a].becomeFirstResponder();break}--a}return YES},pageDown:function(){var c=this.get("currentMenuItem"),h,e=this.get("menuItemViews"),b=e.get("length"),a=0,g,d=0,f;if(this._menuScrollView&&this._menuScrollView.verticalScrollerView2){if(c){a=c.getPath("content.contentIndex")}g=a;f=this._menuScrollView.get("verticalPageScroll");for(a;a<b;a++){h=e[a];d+=h.get("layout").height;if(d>f){break}else{if(h.get("isEnabled")){g=a}}}h=e[g];this.set("currentMenuItem",h);h.becomeFirstResponder()}else{this.moveToEndOfDocument()}return YES},pageUp:function(){var c=this.get("currentMenuItem"),h,e=this.get("menuItemViews"),b=e.get("length"),a=b-1,g,d=0,f;if(this._menuScrollView&&this._menuScrollView.verticalScrollerView){if(c){a=c.getPath("content.contentIndex")}g=a;f=this._menuScrollView.get("verticalPageScroll");for(a;a>=0;a--){h=e[a];d+=h.get("layout").height;if(d>f){break}else{if(h.get("isEnabled")){g=a}}}h=e[g];this.set("currentMenuItem",h);h.becomeFirstResponder()}else{this.moveToBeginningOfDocument()}return YES},insertText:function(b,a){var d=this._timer,c=this._keyBuffer;if(d){d.invalidate()}d=this._timer=SC.Timer.schedule({target:this,action:"clearKeyBuffer",interval:500,isPooled:NO});c=c||"";c+=b.toUpperCase();this.selectMenuItemForString(c);this._keyBuffer=c;return YES},performKeyEquivalent:function(d,a,b){if(!b&&!this.get("isVisibleInWindow")){return NO}var c=this._keyEquivalents[d];if(c){c.performAction(YES);return YES}if(d==="escape"||d==="return"){this.remove();return YES}return NO},selectMenuItemForString:function(c){var d=this.get("menuItemViews"),f,g,b,a,e;if(!d){return}e=c.length;a=d.get("length");for(b=0;b<a;b++){f=d.objectAt(b);g=f.get("title");if(!g){continue}g=g.replace(/ /g,"").substr(0,e).toUpperCase();if(g===c){this.set("currentMenuItem",f);f.becomeFirstResponder();break}}},clearKeyBuffer:function(){this._keyBuffer=""},modalPaneDidClick:function(a){this.remove();return YES}});SC._menu_fetchKeys=function(a){return this.get(a)};SC._menu_fetchItem=function(a){if(!a){return null}return this.get?this.get(a):this[a]};SC.MenuPane.VERTICAL_OFFSET=23;sc_require("panes/panel");SC.SheetPane=SC.PanelPane.extend({classNames:["sc-sheet"],modalPane:SC.ModalPane,transitionDuration:200,_state:"NO_VIEW",init:function(){arguments.callee.base.apply(this,arguments);if(SC.Animatable){SC.SheetPane.ANIMATABLE_AVAILABLE=YES;this.mixin(SC.Animatable);if(!this.transitions){this.transitions={}}if(!this.transitions.top){this.transitions.top={duration:this.transitionDuration===200?0.3:this.transitionDuration/1000,action:"_complete",target:this}}}},append:function(){var a=this.get("layout");if(!a.height||!a.top){a=SC.View.convertLayoutToAnchoredLayout(a,this.computeParentDimensions())}a.top=-1*a.height;if(this.disableAnimation){this.disableAnimation()}this.adjust(a);this.updateLayout();if(this.enableAnimation){this.enableAnimation()}return arguments.callee.base.apply(this,arguments)},remove:function(){var b=this,a=arguments;this.invokeLater(function(){a.callee.base.apply(b,a)},this.transitionDuration);this.slideUp();return this},paneDidAttach:function(){var a=arguments.callee.base.apply(this,arguments);this.slideDown();return a},slideDown:function(){this._state=SC.SheetPane.ANIMATING;this._direction=SC.SheetPane.SLIDE_DOWN;if(SC.SheetPane.ANIMATABLE_AVAILABLE){this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_OUT;this.adjust("top",0)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");this.tick()}},slideUp:function(){this._state=SC.SheetPane.ANIMATING;this._direction=SC.SheetPane.SLIDE_UP;if(SC.SheetPane.ANIMATABLE_AVAILABLE){var a=this.get("layout");this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_IN;this.adjust("top",-1*a.height)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");this.tick()}},_complete:function(){var a=this._direction;if(a===SC.SheetPane.SLIDE_DOWN){if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",0)}this.adjust({centerX:0,left:null});if(SC.browser.isMozilla){this.parentViewDidChange()}}else{var b=this.get("layout");if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",-1*b.height)}}this._state=SC.SheetPane.READY;this.updateLayout()},blurTo:function(a){this.setFirstResponder("")},tick:function(){this._timer=null;var b=Date.now();var e=(b-this._start)/(this._end-this._start),g=this,a=this._direction,c=this.get("layout"),d,f;if(e<0){e=0}if(e>=1){this._complete();return this}f=Math.floor(c.height*e);if(a==SC.SheetPane.SLIDE_DOWN){g.adjust("top",0-(c.height-f))}else{if(a==SC.SheetPane.SLIDE_UP){g.adjust("top",0-f)}}this._timer=this.invokeLater(this.tick,20);g.updateLayout();return this}});SC.SheetPane.mixin({ANIMATABLE_AVAILABLE:NO,NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",SLIDE_DOWN:"SLIDEDOWN",SLIDE_UP:"SLIDEUP"});SC.BaseTheme.buttonRenderDelegate=SC.RenderDelegate.create({className:"button","sc-small-size":{height:18,autoResizePadding:{width:15,height:0}},"sc-regular-size":{height:24,autoResizePadding:{width:20,height:0}},"sc-huge-size":{height:30,autoResizePadding:{width:30,height:0}},"sc-jumbo-size":{height:44,autoResizePadding:{width:50,height:0}},render:function(a,f){this.addSizeClassName(a,f);var e,b=a.get("toolTip"),g=a.get("isSelected")||NO,j=a.get("isActive")||NO,h=a.get("isDefault")||NO,i=a.get("isCancel")||NO,d=(a.get("buttonBehavior")===SC.TOGGLE_BEHAVIOR),c=SC.guidFor(a)+"-label";f.setClass({icon:!!a.get("icon"),def:h,cancel:i&&!h,active:j,sel:g});if(b){f.attr("title",b);f.attr("alt",b)}this.includeSlices(a,f,SC.THREE_SLICE);if(a.get("isSegment")){f.attr("aria-selected",g.toString())}else{if(d){f.attr("aria-pressed",j.toString())}}f.attr("aria-labelledby",c);f=f.begin("label").addClass("sc-button-label").id(c);a.get("theme").labelRenderDelegate.render(a,f);f=f.end();if(a.get("supportFocusRing")){f=f.begin("div").addClass("focus-ring");this.includeSlices(a,f,SC.THREE_SLICE);f=f.end()}},update:function(e,a){var d=(e.get("buttonBehavior")===SC.TOGGLE_BEHAVIOR);this.updateSizeClassName(e,a);if(e.get("isActive")){a.addClass("active")}var c=e.get("isDefault"),b=e.get("isCancel");if(e.get("isSegment")){a.attr("aria-selected",e.get("isSelected").toString())}else{if(d){a.attr("aria-pressed",e.get("isActive").toString())}}a.attr("title",e.get("toolTip"));a.setClass("icon",!!e.get("icon"));a.setClass("def",!!c);a.setClass("cancel",!!b&&!c);e.get("theme").labelRenderDelegate.update(e,a.find("label"))},getRenderedAutoResizeLayer:function(a,b){return b.find(".sc-button-label")[0]}});SC.BaseTheme.checkboxRenderDelegate=SC.RenderDelegate.create({className:"checkbox",render:function(a,c){this.addSizeClassName(a,c);var e=a.get("theme"),f,b;b=SC.guidFor(a)+"-label";var d=a.get("isSelected")||NO;var i=a.get("isActive");var h=!a.get("isEnabled");var g;if(d===SC.MIXED_STATE){g="mixed"}else{if(d){g="true"}else{g="false"}}c.attr("role","checkbox");c.attr("aria-checked",g);c.attr("aria-labelledby",b);c.setClass({sel:d,active:i,disabled:h});c.push('<span class = "button"></span>');c=c.begin("span").addClass("label").id(b);e.labelRenderDelegate.render(a,c);c=c.end()},update:function(g,c){this.updateSizeClassName(g,c);var f=g.get("theme");var d=g.get("isSelected");var e=g.get("isActive");var b=!g.get("isEnabled");var a;if(d===SC.MIXED_STATE){a="mixed"}else{if(d){a="true"}else{a="false"}}c.attr("aria-checked",a);f.labelRenderDelegate.update(g,c.find("span.label"));c.setClass({sel:d,active:e,disabled:b})}});SC.BaseTheme.collectionRenderDelegate=SC.RenderDelegate.create({className:"collection",render:function(b,a){a.setClass("focus",b.get("hasFirstResponder"));a.setClass("disabled",!b.get("isEnabled"));a.setClass("active",b.get("isActive"))},update:function(b,a){a.setClass("focus",b.get("hasFirstResponder"));a.setClass("disabled",!b.get("isEnabled"));a.setClass("active",b.get("isActive"))}});SC.BaseTheme.disclosureRenderDelegate=SC.RenderDelegate.create({className:"disclosure",render:function(g,a){this.addSizeClassName(g,a);var f=g.get("theme"),d=g.get("value"),b=["sc-button-label","sc-disclosure-label"];var e=SC.guidFor(g)+"-label";a.attr("aria-expanded",d);a.attr("aria-labelledby",e);if(g.get("isSelected")){a.addClass("sel")}var c="";c+=g.get("isSelected")?"open":"closed";if(g.get("isActive")){c+=" active"}a.push('<img src = "'+SC.BLANK_IMAGE_URL+'" class = "disclosure button '+c+'" />');a=a.begin("span").addClass(b).id(e);f.labelRenderDelegate.render(g,a);a=a.end()},update:function(d,a){this.updateSizeClassName(d,a);var c=d.get("theme"),b=d.get("value");a.attr("aria-expanded",b);if(d.get("isSelected")){a.addClass("sel")}a.find("img").setClass({open:d.get("isSelected"),closed:!d.get("isSelected"),active:d.get("isActive")});c.labelRenderDelegate.update(d,a.find("span.sc-disclosure-label"))}});SC.THREE_SLICE=["left","middle","right"];SC.NINE_SLICE=["top-left","top","top-right","left","middle","right","bottom-left","bottom","bottom-right"];SC.RenderDelegate.reopen({includeSlices:function(e,c,d){for(var b=0,a=d.length;b<a;b++){c.push('<div class="'+d[b]+'"></div>')}}});SC.BaseTheme.imageButtonRenderDelegate=SC.RenderDelegate.create({className:"image-button",render:function(d,b){var c=d.get("image"),a=d.get("toolTip");this.addSizeClassName(d,b);b.addClass("no-min-width");if(a){b.attr("title",a);b.attr("alt",a)}if(c){b.push("<div class='img "+c+"'></div>")}else{b.push("<div class='img'></div>")}},update:function(d,b){var c,a;this.updateSizeClassName(d,b);if(d.didChangeFor("imageButtonRenderDelegate","toolTip")){a=d.get("toolTip");b.attr("title",a);b.attr("alt",a)}c=d.get("image");if(c&&d.didChangeFor("imageButtonRenderDelegate","image")){b.children()[0].className="img "+c}}});SC.BaseTheme.MASTER_DETAIL_DIVIDER_WIDTH=1;SC.BaseTheme.masterDetailRenderDelegate=SC.RenderDelegate.create({className:"master-detail",dividerWidth:1,render:function(b,a){a.setClass("round-toolbars",SC.platform.touch)},update:function(b,a){a.setClass("round-toolbars",SC.platform.touch)}});SC.BaseTheme.panelRenderDelegate=SC.RenderDelegate.create({className:"panel",render:function(e,b){b=b.begin("div").addClass("panel-background");this.includeSlices(e,b,SC.NINE_SLICE);b=b.end();var a=e.get("ariaLabel"),c=e.get("ariaLabelledBy"),d=e.get("ariaDescribedBy");if(a){b.attr("aria-label",a)}if(c){b.attr("aria-labelledby",c)}if(d){b.attr("aria-describedby",d)}},update:function(e,c){var a=e.get("ariaLabel"),b=e.get("ariaLabelledBy"),d=e.get("ariaDescribedBy");if(a){c.attr("aria-label",a)}if(b){c.attr("aria-labelledby",b)}if(d){c.attr("aria-describedby",d)}}});sc_require("render_delegates/panel");SC.BaseTheme.pickerRenderDelegate=SC.RenderDelegate.create({className:"picker",render:function(f,c){var a=f.get("theme").panelRenderDelegate;a.render(f,c);var b=f.get("preferType");var e=f.get("pointerPos");var d=f.get("pointerPosY");if(b==SC.PICKER_POINTER||b==SC.PICKER_MENU_POINTER){c.push('<div class="sc-pointer '+e+'" style="margin-top: '+d+'px"></div>');c.addClass(e)}},update:function(g,f){var a=g.get("theme").panelRenderDelegate;a.update(g,f);var b=g.get("preferType");var e=g.get("pointerPos");var d=g.get("pointerPosY");if(b==SC.PICKER_POINTER||b==SC.PICKER_MENU_POINTER){var c=f.find(".sc-pointer");c.attr("class","sc-pointer "+e);c.attr("style","margin-top: "+d+"px");f.addClass(e)}}});sc_require("render_delegates/picker");SC.BaseTheme.menuRenderDelegate=SC.BaseTheme.pickerRenderDelegate.create({className:"menu",render:function(c,b,a){this.addSizeClassName(b,a);c(b,a)}.enhance(),update:function(c,b,a){this.updateSizeClassName(b,a);c(b,a)}.enhance(),itemHeight:20,itemSeparatorHeight:9,menuHeightPadding:6,menuWidthPadding:50,minimumMenuWidth:50,submenuOffsetX:2,verticalOffset:23,"sc-tiny-size":{itemHeight:10,itemSeparatorHeight:2,menuHeightPadding:2,submenuOffsetX:0},"sc-small-size":{itemHeight:16,itemSeparatorHeight:7,menuHeightPadding:4,submenuOffsetX:2},"sc-large-size":{itemHeight:60,itemSeparatorHeight:20,menuHeightPadding:0,submenuOffsetX:4},"sc-huge-size":{itemHeight:20,itemSeparatorHeight:9,menuHeightPadding:0,submenuOffsetX:0}});SC.BaseTheme.popupButtonRenderDelegate=SC.BaseTheme.buttonRenderDelegate.create({render:function(b,a){a.attr("aria-haspopup","true");arguments.callee.base.apply(this,arguments)},update:function(b,a){arguments.callee.base.apply(this,arguments)}});SC.BaseTheme.PROGRESS_OFFSET=0.5;SC.BaseTheme.PROGRESS_OFFSET_RANGE=42;SC.BaseTheme.progressRenderDelegate=SC.RenderDelegate.create({className:"progress",render:function(h,c){this.addSizeClassName(h,c);var a=h.get("isIndeterminate"),g=h.get("theme"),b=h.get("maximum"),e=h.get("minimum"),d=h.get("ariaValue");var f;if(a){f=1}else{f=h.get("value")}c.attr("aria-valuemax",b);c.attr("aria-valuemin",e);c.attr("aria-valuenow",d);c.attr("aria-valuetext",d);c.setClass({indeterminate:a,running:h.get("isRunning")&&a,disabled:!h.get("isEnabled"),"sc-empty":(f<=0),"sc-complete":(f>=1&&!a)});c=c.begin("div").addClass("track");this.includeSlices(h,c,SC.THREE_SLICE);c=c.end();c=c.begin("div").addClass("content");c.css("width",(f*100)+"%");this.includeSlices(h,c,SC.THREE_SLICE);c=c.end()},update:function(a,b){this.updateSizeClassName(a,b);var e=a.get("theme"),i,j=a.get("maximum"),f=a.get("minimum"),c=a.get("ariaValue"),d=a.get("isIndeterminate"),k=a.get("isRunning"),h=a.get("isEnabled"),g=a.get("isVisibleInWindow");b.attr("aria-valuemax",j);b.attr("aria-valuemin",f);b.attr("aria-valuenow",c);b.attr("aria-valuetext",c);if(d){i=1}else{i=a.get("value")}b.setClass({indeterminate:d,running:k&&d,disabled:!h,"sc-empty":(i<=0),"sc-complete":(i>=1&&!d)});b.find(".content").css("width",(i*100)+"%");if(!SC.platform.supportsCSSTransitions){if(!this._queue[b[0].id]){this._queue[b[0].id]={offset:0,element:SC.$(b).find(".content .middle"),shouldAnimate:false}}if(d&&k&&g){this._queue[b[0].id].shouldAnimate=true;this.animate(a)}else{if(!d){this._queue[b[0].id].element.css("background-position","")}else{this._queue[b[0].id].shouldAnimate=false}}}},_queue:{},_animating:false,animate:function(b){var a=this;if(this._animating){return}function c(){var h,e,f,d=a._queue,j=0,g;var i;for(i in d){if(d.hasOwnProperty(i)){g=d[i];if(g.shouldAnimate){a._animating=true;j++;e=g.offset||0;h=(e+SC.BaseTheme.PROGRESS_OFFSET)%SC.BaseTheme.PROGRESS_OFFSET_RANGE;f=Math.round(h);if(f>Math.round(e)){g.element.css("background-position",f+"px 0px")}g.offset=h}}}if(j===0){a._animating=false}else{window.requestAnimationFrame(c)}}c()}});SC.BaseTheme.radioRenderDelegate=SC.RenderDelegate.create({className:"radio",render:function(f,b){this.addSizeClassName(f,b);var e=f.get("theme");var a=f.get("isSelected"),c=f.get("width"),d=SC.guidFor(f)+"-label";b.setClass({active:f.get("isActive"),mixed:f.get("isMixed"),sel:f.get("isSelected"),disabled:!f.get("isEnabled")});b.attr("role","radio");b.attr("aria-checked",a);b.attr("aria-labelledby",d);b.attr("aria-disabled",f.get("isEnabled")?"false":"true");if(c){b.css("width",c)}b.push('<span class = "button"></span>');b=b.begin("span").addClass("sc-button-label").id(d);e.labelRenderDelegate.render(f,b);b=b.end()},update:function(f,a){this.updateSizeClassName(f,a);var e=f.get("theme");var b=f.get("isSelected"),c=f.get("width"),d=f.get("value");a.setClass({active:f.get("isActive"),mixed:f.get("isMixed"),sel:f.get("isSelected"),disabled:!f.get("isEnabled")});a.attr("aria-disabled",f.get("isEnabled")?"false":"true");a.attr("aria-checked",b);a.css("width",c?c:null);e.labelRenderDelegate.update(f,a.find(".sc-button-label"))}});SC.BaseTheme.radioGroupRenderDelegate=SC.RenderDelegate.create({className:"radio-group",render:function(h,e){this.addSizeClassName(h,e);var g=h.get("theme"),d=SC.guidFor(this),c=h.get("items"),b,a=c.length,f;e.addClass(h.get("layoutDirection"));e.attr("role","radiogroup");e.attr("aria-disabled",h.get("isEnabled")?"false":"true");for(b=0;b<a;b++){f=c[b];e=e.begin("div").addClass("radio-"+b).attr("index",b).addClass(g.classNames).addClass(g.radioRenderDelegate.className).addClass("sc-radio-button");g.radioRenderDelegate.render(f,e);e=e.end()}h.get("renderState").radioCount=b},update:function(a,d){this.updateSizeClassName(a,d);var e=a.get("theme"),b=SC.guidFor(this),g=a.get("items"),h,f=g.length,i;d.addClass(a.get("layoutDirection"));d.attr("aria-disabled",a.get("isEnabled")?"false":"true");if(a.get("renderState").radioCount!==f){var c=SC.RenderContext(d[0]);this.render(a,c);c.update();return}for(h=0;h<f;h++){i=g[h];e.radioRenderDelegate.update(i,d.find(".radio-"+h))}},updateRadioAtIndex:function(d,a,b){var c=d.get("items")[b];d.get("theme").radioRenderDelegate.update(c,a.find(".radio-"+b))},indexForEvent:function(d,b,a){var c=$(a.target).closest(".sc-radio-button").attr("index");if(isNaN(c)){return undefined}return parseInt(c,0)}});SC.BaseTheme.segmentRenderDelegate=SC.RenderDelegate.create({className:"segment",render:function(e,b){var c=e.get("theme"),d,a;a={"sc-first-segment":e.get("isFirstSegment"),"sc-middle-segment":e.get("isMiddleSegment"),"sc-last-segment":e.get("isLastSegment"),"sc-overflow-segment":e.get("isOverflowSegment"),vertical:e.get("layoutDirection")!==SC.LAYOUT_HORIZONTAL};if(!SC.none(e.get("index"))){a["sc-segment-"+e.get("index")]=YES}b.setClass(a);d=c.buttonRenderDelegate;d.render(e,b)},update:function(e,a){var c=e.get("theme"),d,b={};b={"sc-first-segment":e.get("isFirstSegment"),"sc-middle-segment":e.get("isMiddleSegment"),"sc-last-segment":e.get("isLastSegment"),"sc-overflow-segment":e.get("isOverflowSegment")||NO,vertical:e.get("layoutDirection")!==SC.LAYOUT_HORIZONTAL};if(!SC.none(e.get("index"))){b["sc-segment-"+e.get("index")]=YES}a.setClass(b);d=c.buttonRenderDelegate;d.update(e,a)}});SC.BaseTheme.segmentedRenderDelegate=SC.RenderDelegate.create({className:"segmented",render:function(b,a){this.addSizeClassName(b,a);a.addStyle("text-align",b.get("align"))},update:function(b,a){this.updateSizeClassName(b,a);a.css("text-align",b.get("align"))}});SC.BaseTheme.sliderRenderDelegate=SC.RenderDelegate.create({className:"slider",render:function(f,c){this.addSizeClassName(f,c);var b=SC.BLANK_IMAGE_URL,a=f.get("maximum"),e=f.get("minimum"),d=f.get("ariaValue");c.attr("aria-valuemax",a);c.attr("aria-valuemin",e);c.attr("aria-valuenow",d);if(e!==0||a!==100){c.attr("aria-valuetext",d)}c.attr("aria-orientation","horizontal");c=c.begin("span").addClass("track");this.includeSlices(f,c,SC.THREE_SLICE);c.push('<img src="'+b+'" class="sc-handle" style="left: '+f.get("value")+'%" /></span>');c=c.end();f.get("renderState")._cachedHandle=null},update:function(h,b){this.updateSizeClassName(h,b);var a=h.get("maximum"),d=h.get("minimum"),c=h.get("ariaValue");b.attr("aria-valuemax",a);b.attr("aria-valuemin",d);b.attr("aria-valuenow",c);if(d!==0||a!==100){b.attr("aria-valuetext",c)}b.attr("aria-orientation","horizontal");if(h.didChangeFor("sliderRenderDelegate","value")){var f=h.get("renderState")._cachedHandle;if(!f){f=h.get("renderState")._cachedHandle=b.find(".sc-handle")}var g=h.get("frame"),e=h.get("value");f.css("left",e+"%")}}});SC.BaseTheme.SourceList=SC.BaseTheme.subtheme("source-list");SC.BaseTheme.toolbarRenderDelegate=SC.RenderDelegate.create({className:"toolbar",render:function(b,a){},update:function(){}});SC.BaseTheme.wellRenderDelegate=SC.RenderDelegate.create({className:"well",render:function(b,a){this.includeSlices(b,a,SC.NINE_SLICE)},update:function(){}});SC.BaseTheme.workspaceRenderDelegate=SC.RenderDelegate.create({className:"workspace",render:function(){},update:function(){}});SC.DRAG_LINK=4;SC.DRAG_COPY=1;SC.DRAG_MOVE=2;SC.DRAG_NONE=0;SC.DRAG_ANY=15;SC.DRAG_DATA=8;SC.DRAG_AUTOSCROLL_ZONE_THICKNESS=20;SC.View.reopen({init:function(a){a();if(this.get("isDropTarget")){SC.Drag.addDropTarget(this)}if(this.get("isScrollable")){SC.Drag.addScrollableView(this)}}.enhance(),destroy:function(a){if(this.get("isDropTarget")){SC.Drag.removeDropTarget(this)}if(this.get("isScrollable")){SC.Drag.removeScrollableView(this)}return a()}.enhance()});SC.Drag=SC.Object.extend({source:null,ghostView:null,ghostActsLikeCursor:NO,dragView:null,ghost:YES,sourceIsDraggable:YES,slideBack:YES,ghostOffset:{x:0,y:0},location:{},dataTypes:function(){if(this.dataSource){return this.dataSource.get("dragDataTypes")||[]}var d=this.data;if(d){var a=[];for(var b in d){if(d.hasOwnProperty(b)){a.push(b)}}return a}var c=this.get("source");if(c&&c.dragDataTypes){return c.get("dragDataTypes")||[]}return[]}.property().cacheable(),hasDataType:function(a){return(this.get("dataTypes").indexOf(a)>=0)},dataForType:function(a){if(this.dataSource){return this.dataSource.dragDataForType(this,a)}else{if(this.data){return this.data[a]}else{var b=this.get("source");if(b&&SC.typeOf(b.dragDataForType)===SC.T_FUNCTION){return b.dragDataForType(this,a)}else{return null}}}},dataSource:null,data:null,allowedDragOperations:SC.DRAG_ANY,_dragInProgress:YES,_dragViewWasVisible:null,startDrag:function(){if(this.get("sourceIsDraggable")){this._createGhostView()}var h=this.event;var e={x:h.pageX,y:h.pageY};this.set("location",e);if(this.get("sourceIsDraggable")){var b=this._getDragView();var i=b.get("parentView");var g=i?i.convertFrameToView(b.get("frame"),null):b.get("frame");if(this.get("ghost")){this._dragViewWasVisible=b.get("isVisible");b.set("isVisible",NO)}if(this.ghostActsLikeCursor){this.ghostOffset={x:14,y:14}}else{this.ghostOffset={x:(e.x-g.x),y:(e.y-g.y)}}if(!this._ghostViewHidden){this._positionGhostView(h)}if(h.makeTouchResponder){var j=this;SC.Timer.schedule({target:h,action:function(){if(!h.hasEnded){h.makeTouchResponder(j,YES)}},interval:1})}else{this.ghostView.rootResponder.dragDidStart(this,h)}}var a=this.source;if(a&&a.dragDidBegin){a.dragDidBegin(this,e)}var c=this._dropTargets();for(var f=0,d=c.length;f<d;f++){c[f].tryToPerform("dragStarted",this,h)}},cancelDrag:function(){var b=this._lastTarget,c=this.get("location");if(b&&b.dragExited){b.dragExited(this,this._lastMouseDraggedEvent)}if(this.get("sourceIsDraggable")){this._destroyGhostView();if(this.get("ghost")){if(this._dragViewWasVisible){this._getDragView().set("isVisible",YES)}this._dragViewWasVisible=null}}var a=this.source;if(a&&a.dragDidEnd){a.dragDidEnd(this,c,SC.DRAG_NONE)}this._lastTarget=null;this._dragInProgress=NO},touchStart:function(a){return YES},mouseDragged:function(a){var b=this._autoscroll(a);var f=this.get("location");if(!b&&(a.pageX===f.x)&&(a.pageY===f.y)){return}f={x:a.pageX,y:a.pageY};this.set("location",f);this._lastMouseDraggedEvent=a;var d=this.source;var c=this._lastTarget;var e=this._findDropTarget(a);var g=SC.DRAG_NONE;while(e&&(e!==c)&&(g===SC.DRAG_NONE)){if(e&&d&&d.dragSourceOperationMaskFor){g=d.dragSourceOperationMaskFor(this,e)}else{g=SC.DRAG_ANY}if((g!==SC.DRAG_NONE)&&e&&e.computeDragOperations){g=g&e.computeDragOperations(this,a,g)}else{g=SC.DRAG_NONE}this.allowedDragOperations=g;if(g===SC.DRAG_NONE){e=this._findNextDropTarget(e)}}if(e!==c){if(c&&c.dragExited){c.dragExited(this,a)}if(e){if(e.dragEntered){e.dragEntered(this,a)}if(e.dragUpdated){e.dragUpdated(this,a)}}this._lastTarget=e}else{if(e&&e.dragUpdated){e.dragUpdated(this,a)}}if(d&&d.dragDidMove){d.dragDidMove(this,f)}if(this.get("sourceIsDraggable")&&!this._ghostViewHidden){this._positionGhostView(a)}},touchesDragged:function(a){this.mouseDragged(a)},mouseUp:function(l){var g={x:l.pageX,y:l.pageY},h=this._lastTarget,d=this.allowedDragOperations;this.set("location",g);try{if(h&&h.acceptDragOperation&&h.acceptDragOperation(this,d)){d=h.performDragOperation?h.performDragOperation(this,d):SC.DRAG_NONE}else{d=SC.DRAG_NONE}}catch(i){SC.Logger.error("Exception in SC.Drag.mouseUp(acceptDragOperation|performDragOperation): %@".fmt(i))}try{if(h&&h.dragExited){h.dragExited(this,l)}}catch(j){SC.Logger.error("Exception in SC.Drag.mouseUp(target.dragExited): %@".fmt(j))}var c=this._dropTargets();for(var k=0,f=c.length;k<f;k++){try{c[k].tryToPerform("dragEnded",this,l)}catch(b){SC.Logger.error("Exception in SC.Drag.mouseUp(dragEnded on %@): %@".fmt(c[k],b))}}if(this.get("sourceIsDraggable")){this._destroyGhostView();if(this.get("ghost")){if(this._dragViewWasVisible){this._getDragView().set("isVisible",YES)}this._dragViewWasVisible=null}}var a=this.source;if(a&&a.dragDidEnd){a.dragDidEnd(this,g,d)}this._lastTarget=null;this._dragInProgress=NO},touchEnd:function(a){this.mouseUp(a)},_getDragView:function(){if(!this.dragView){if(!this.source||!this.source.isView){throw"Source can't be used as dragView, because it's not a view."}this.dragView=this.source}return this.dragView},_createGhostView:function(){var c=this,b=this._getDragView(),d=b.get("frame"),a;a=this.ghostView=SC.Pane.create({classNames:["sc-ghost-view"],layout:{top:d.y,left:d.x,width:d.width,height:d.height},owner:this,didCreateLayer:function(){if(b){var e=b.get("layer");if(e){e=e.cloneNode(true);e.style.top="0px";e.style.left="0px";this.get("layer").appendChild(e)}}}});a.append()},_positionGhostView:function(a){var c=this.get("location");c.x-=this.ghostOffset.x;c.y-=this.ghostOffset.y;var b=this.ghostView;if(b){b.adjust({top:c.y,left:c.x});b.invokeOnce("updateLayout")}},_ghostViewHidden:NO,hideGhostView:function(){if(this.ghostView&&!this._ghostViewHidden){this.ghostView.remove();this._ghostViewHidden=YES}},unhideGhostView:function(){if(this._ghostViewHidden){this._ghostViewHidden=NO;this._createGhostView()}},_destroyGhostView:function(){if(this.ghostView){this.ghostView.remove();this.ghostView=null;this._ghostViewHidden=NO}},_dropTargets:function(){if(this._cachedDropTargets){return this._cachedDropTargets}var b=[];var d=SC.Drag._dropTargets;for(var c in d){if(d.hasOwnProperty(c)){b.push(d[c])}}var f={};var e=SC.Drag._dropTargets;var a=function(g){if(!g){return 0}var i=SC.guidFor(g);var h=f[i];if(!h){h=1;while(g=g.get("parentView")){if(e[SC.guidFor(g)]!==undefined){h=h+1}if(g.isPane&&g.isMainPane){h=h+10000}}f[i]=h}return h};b.sort(function(h,g){if(h===g){return 0}h=a(h);g=a(g);return(h>g)?-1:1});this._cachedDropTargets=b;return b},_findDropTarget:function(c){var g={x:c.pageX,y:c.pageY};var e,f;var d=this._dropTargets();for(var b=0,a=d.length;b<a;b++){e=d[b];if(!e.get("isVisibleInWindow")){continue}f=e.convertFrameToView(e.get("clippingFrame"),null);if(SC.pointInRect(g,f)){return e}}return null},_findNextDropTarget:function(a){var b=SC.Drag._dropTargets;while(a=a.get("parentView")){if(b[SC.guidFor(a)]){return a}}return null},_autoscroll:function(l){if(!l){l=this._lastAutoscrollEvent}if(!this._dragInProgress){return NO}var g=l?{x:l.pageX,y:l.pageY}:this.get("location"),h=this._findScrollableView(g),m=null,k,c,d,i,b,a,e;while(h&&!m){k=h.get("canScrollVertical")?1:0;c=h.get("canScrollHorizontal")?1:0;if(k||c){a=h.get("containerView");if(a){e=h.convertFrameToView(a.get("frame"),null)}else{k=c=0}}if(k){i=SC.maxY(e);d=i-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(g.y>=d&&g.y<=i){k=1}else{d=SC.minY(e);i=d+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(g.y>=d&&g.y<=i){k=-1}else{k=0}}}if(c){i=SC.maxX(e);d=i-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(g.x>=d&&g.x<=i){c=1}else{d=SC.minX(e);i=d+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(g.x>=d&&g.x<=i){c=-1}else{c=0}}}if(k||c){m=h}else{h=this._findNextScrollableView(h)}}if(m&&(this._lastScrollableView===m)){if((Date.now()-this._hotzoneStartTime)>100){this._horizontalScrollAmount*=1.05;this._verticalScrollAmount*=1.05}}else{this._lastScrollableView=m;this._horizontalScrollAmount=15;this._verticalScrollAmount=15;this._hotzoneStartTime=(m)?Date.now():null;c=k=0}if(m&&(c||k)){var j={x:c*this._horizontalScrollAmount,y:k*this._verticalScrollAmount};m.scrollBy(j)}if(m){if(l){this._lastAutoscrollEvent={pageX:l.pageX,pageY:l.pageY}}this.invokeLater(this._autoscroll,100,null);return YES}else{this._lastAutoscrollEvent=null;return NO}},_scrollableViews:function(){if(this._cachedScrollableView){return this._cachedScrollableView}var a=[];var c=SC.Drag._scrollableViews;for(var b in c){if(c.hasOwnProperty(b)){a.push(c[b])}}a=a.sort(function(f,d){var e=f;while(e=e.get("parentView")){if(d===e){return -1}}return 1});this._cachedScrollableView=a;return a},_findScrollableView:function(f){var c=this._scrollableViews(),b=c?c.length:0,d,e,a;for(a=0;a<b;a++){d=c[a];if(!d.get("isVisibleInWindow")){continue}e=d.convertFrameToView(d.get("clippingFrame"),null);if(SC.pointInRect(f,e)){return d}}return null},_findNextScrollableView:function(a){var b=SC.Drag._scrollableViews;while(a=a.get("parentView")){if(b[SC.guidFor(a)]){return a}}return null}});SC.Drag.mixin({start:function(b){var a=this.create(b);a.startDrag();return a},_dropTargets:{},_scrollableViews:{},addDropTarget:function(a){this._dropTargets[SC.guidFor(a)]=a},removeDropTarget:function(a){delete this._dropTargets[SC.guidFor(a)]},addScrollableView:function(a){this._scrollableViews[SC.guidFor(a)]=a},removeScrollableView:function(a){delete this._scrollableViews[SC.guidFor(a)]}});SC.UndoManager=SC.Object.extend({undoActionName:function(){return this.undoStack?this.undoStack.name:null}.property("undoStack"),redoActionName:function(){return this.redoStack?this.redoStack.name:null}.property("redoStack"),canUndo:function(){return this.undoStack!=null}.property("undoStack"),canRedo:function(){return this.redoStack!=null}.property("redoStack"),undo:function(){this._undoOrRedo("undoStack","isUndoing")},redo:function(){this._undoOrRedo("redoStack","isRedoing")},isUndoing:NO,isRedoing:NO,groupingLevel:0,registerUndo:function(b,a){this.beginUndoGroup(a);this._activeGroup.actions.push(b);this.endUndoGroup(a)},beginUndoGroup:function(b){if(this._activeGroup){this.groupingLevel++}else{var a=this.isUndoing?"redoStack":"undoStack";this._activeGroup={name:b,actions:[],prev:this.get(a)};this.set(a,this._activeGroup);this.groupingLevel=1}},endUndoGroup:function(a){if(!this._activeGroup){raise("endUndoGroup() called outside group.")}if(this.groupingLevel>1){this.groupingLevel--}else{this._activeGroup=null;this.groupingLevel=0}this.propertyDidChange(this.isUndoing?"redoStack":"undoStack")},setActionName:function(a){if(!this._activeGroup){raise("setActionName() called outside group.")}this._activeGroup.name=a},_activeGroup:null,undoStack:null,redoStack:null,_undoOrRedo:function(a,c){if(this._activeGroup){return false}if(this.get(a)==null){return true}this.set(c,true);var e=this.get(a);this.set(a,e.prev);var b;var d=e.actions.length>1;if(d){this.beginUndoGroup(e.name)}while(b=e.actions.pop()){b()}if(d){this.endUndoGroup(e.name)}this.set(c,false)}});SC.CheckboxView=SC.ButtonView.extend(SC.StaticLayout,{classNames:["sc-checkbox-view","sc-checkbox-control"],ariaRole:"checkbox",themeName:null,renderDelegateName:"checkboxRenderDelegate",needsEllipsis:NO,acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),_toggleValue:function(){var a=this.get("value")===this.get("toggleOnValue");this.set("value",a?this.get("toggleOffValue"):this.get("toggleOnValue"))},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;if(a&&this.get("acceptsFirstResponder")){a.allowDefault()}return YES},mouseUp:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",NO);this._isMouseDown=NO;if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){if(this.$().within(a.target)){this._toggleValue();this._action(a)}}return YES},keyDown:function(b){if(!this.get("isEnabled")){return YES}if(b.which===9||b.keyCode===9){var a=b.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES}if(b.which===13||b.which===32){this._toggleValue();if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){if(this.$().within(b.target)){this._action(b)}}return YES}b.allowDefault();return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)}});SC.LIST_ITEM_ACTION_CANCEL="sc-list-item-cancel-action";SC.LIST_ITEM_ACTION_REFRESH="sc-list-item-cancel-refresh";SC.LIST_ITEM_ACTION_EJECT="sc-list-item-cancel-eject";SC.ListItemView=SC.View.extend(SC.InlineEditable,SC.Control,{classNames:["sc-list-item-view"],displayProperties:["disclosureState","escapeHTML","isDropTarget"],content:null,contentIndex:null,hasContentIcon:NO,hasContentRightIcon:NO,hasContentBranch:NO,contentCheckboxKey:null,icon:null,isDropTarget:NO,contentIconKey:null,rightIcon:null,contentRightIconKey:null,contentValueKey:null,escapeHTML:YES,contentUnreadCountKey:null,contentIsBranchKey:null,outlineIndent:16,outlineLevel:0,disclosureState:SC.LEAF_NODE,validator:null,contentKeys:{contentValueKey:"title",contentCheckboxKey:"checkbox",contentIconKey:"icon",contentRightIconKey:"rightIcon",contentUnreadCountKey:"count",contentIsBranchKey:"branch"},contentPropertyDidChange:function(){if(this.get("contentIsEditable")!==this.contentIsEditable()){this.notifyPropertyChange("contentIsEditable")}this.displayDidChange()},contentIsEditable:function(){var a=this.get("content");return a&&(a.get?a.get("isEditable")!==NO:NO)}.property("content").cacheable(),inlineEditorDelegate:SC.InlineTextFieldDelegate,$label:function(){return this.$("label")},_isInsideElementWithClassName:function(e,a){var c=this.get("layer");if(!c){return NO}var d=SC.$(a.target);var b=NO;while(!b&&d.length>0&&(d[0]!==c)){if(d.hasClass(e)){b=YES}d=d.parent()}d=c=null;return b},_isInsideCheckbox:function(b){var a=this.displayDelegate;var c=this.getDelegateProperty("contentCheckboxKey",a);return c&&this._isInsideElementWithClassName("sc-checkbox-view",b)},_isInsideDisclosure:function(a){if(this.get("disclosureState")===SC.LEAF_NODE){return NO}return this._isInsideElementWithClassName("sc-disclosure-view",a)},_isInsideRightIcon:function(c){var b=this.displayDelegate;var a=this.getDelegateProperty("hasContentRightIcon",b)||!SC.none(this.rightIcon);return a&&this._isInsideElementWithClassName("right-icon",c)},mouseDown:function(a){if(!this.get("contentIsEditable")){return NO}if(this._isInsideCheckbox(a)){this._addCheckboxActiveState();this._isMouseDownOnCheckbox=YES;this._isMouseInsideCheckbox=YES;return YES}else{if(this._isInsideDisclosure(a)){this._addDisclosureActiveState();this._isMouseDownOnDisclosure=YES;this._isMouseInsideDisclosure=YES;return YES}else{if(this._isInsideRightIcon(a)){this._addRightIconActiveState();this._isMouseDownOnRightIcon=YES;this._isMouseInsideRightIcon=YES;return YES}}}return NO},mouseUp:function(h){var c=NO,i,d,b,a,g,f;if(this._isMouseDownOnCheckbox){if(this._isInsideCheckbox(h)){i=this.displayDelegate;d=this.getDelegateProperty("contentCheckboxKey",i);b=this.get("content");if(b&&b.get){var e=b.get(d);e=(e===SC.MIXED_STATE)?YES:!e;b.set(d,e);this.displayDidChange()}}this._removeCheckboxActiveState();c=YES}else{if(this._isMouseDownOnDisclosure){if(this._isInsideDisclosure(h)){a=this.get("disclosureState");g=this.get("contentIndex");f=(!SC.none(g))?SC.IndexSet.create(g):null;i=this.get("displayDelegate");if(a===SC.BRANCH_OPEN){if(f&&i&&i.collapse){i.collapse(f)}else{this.set("disclosureState",SC.BRANCH_CLOSED)}this.displayDidChange()}else{if(a===SC.BRANCH_CLOSED){if(f&&i&&i.expand){i.expand(f)}else{this.set("disclosureState",SC.BRANCH_OPEN)}this.displayDidChange()}}}this._removeDisclosureActiveState();c=YES}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();c=YES}}}this._isMouseInsideCheckbox=this._isMouseDownOnCheckbox=NO;this._isMouseDownOnDisclosure=this._isMouseInsideDisclosure=NO;this._isMouseInsideRightIcon=this._isMouseDownOnRightIcon=NO;return c},mouseMoved:function(a){if(this._isMouseDownOnCheckbox&&this._isInsideCheckbox(a)){this._addCheckboxActiveState();this._isMouseInsideCheckbox=YES}else{if(this._isMouseDownOnCheckbox){this._removeCheckboxActiveState();this._isMouseInsideCheckbox=NO}else{if(this._isMouseDownOnDisclosure&&this._isInsideDisclosure(a)){this._addDisclosureActiveState();this._isMouseInsideDisclosure=YES}else{if(this._isMouseDownOnDisclosure){this._removeDisclosureActiveState();this._isMouseInsideDisclosure=NO}else{if(this._isMouseDownOnRightIcon&&this._isInsideRightIcon(a)){this._addRightIconActiveState();this._isMouseInsideRightIcon=YES}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();this._isMouseInsideRightIcon=NO}}}}}}return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},touchEntered:function(a){return this.mouseEntered(a)},touchExited:function(a){return this.mouseExited(a)},_addCheckboxActiveState:function(){if(this.get("isEnabled")){if(this._checkboxRenderDelegate){var a=this._checkboxRenderSource;a.set("isActive",YES);this._checkboxRenderDelegate.update(a,this.$(".sc-checkbox-view"))}else{this.$(".sc-checkbox-view").addClass("active")}}},_removeCheckboxActiveState:function(){if(this._checkboxRenderer){var a=this._checkboxRenderSource;a.set("isActive",NO);this._checkboxRenderDelegate.update(a,this.$(".sc-checkbox-view"))}else{this.$(".sc-checkbox-view").removeClass("active")}},_addDisclosureActiveState:function(){if(this.get("isEnabled")){if(this._disclosureRenderDelegate){var a=this._disclosureRenderSource;a.set("isActive",YES);this._disclosureRenderDelegate.update(a,this.$(".sc-disclosure-view"))}else{this.$(".sc-disclosure-view").addClass("active")}}},_removeDisclosureActiveState:function(){if(this._disclosureRenderer){var a=this._disclosureRenderSource;a.set("isActive",NO);this._disclosureRenderDelegate.update(a,this.$(".sc-disclosure-view"))}else{this.$(".sc-disclosure-view").addClass("active")}},_addRightIconActiveState:function(){this.$("img.right-icon").setClass("active",YES)},_removeRightIconActiveState:function(){this.$("img.right-icon").removeClass("active")},contentHitTest:function(b){var a=this.displayDelegate;var c=this.getDelegateProperty("contentValueKey",a);if(!c){return NO}var e=this.$label()[0];if(!e){return NO}var f=b.target,d=this.get("layer");while(f&&(f!==d)&&(f!==window)){if(f===e){return YES}f=f.parentNode}return NO},beginEditing:function(d,c){var f=this.$label(),e=this.get("parentView");if(c&&this.scrollToVisible()){var b=this.get("owner"),a=this.get("contentIndex");this.invokeLast(function(){var g=b.itemViewForContentIndex(a);if(g&&g.beginEditing){g.beginEditing(NO)}});return YES}else{if(!e||!f||f.get("length")===0){return NO}else{return d()}}}.enhance(),inlineEditorWillBeginEditing:function(d,o,n){var p=this.get("content"),i=this.get("displayDelegate"),h=this.getDelegateProperty("contentValueKey",i),j=this.get("parentView"),a=this.$label(),e=this.get("validator"),r,k,g,b,l,c,m,s,q,t;k=(h&&p)?(p.get?p.get(h):p[h]):p;r=this.computeFrameWithParentFrame(null);c=this._oldLineHeight=a.css("lineHeight");b=a.css("fontSize");l=this.$().css("top");if(l){l=parseInt(l.substring(0,l.length-2),0)}else{l=0}s=0;if(b&&c){q=b*1.5;if(q<c){a.css({lineHeight:"1.5"});s=(c-q)/2}else{oldLineHeight=null}}a=a[0];g=SC.offset(a);r.x=g.x;r.y=g.y+l+s;r.height=a.offsetHeight;r.width=a.offsetWidth;m=this.get("escapeHTML");d.set({value:k,exampleFrame:r,exampleElement:a,multiline:NO,isCollection:YES,validator:e,escapeHTML:m})},inlineEditorShouldBeginEditing:function(a){return YES},inlineEditorDidBeginEditing:function(b,d,e,a){b(d,e,a);var c=this.$label();this._oldOpacity=c.css("opacity");c.css("opacity",0);if(this._oldLineHeight){c.css({lineHeight:this._oldLineHeight})}}.enhance(),inlineEditorDidCommitEditing:function(d,f,c){var e=this.get("content");var a=this.displayDelegate;var b=this.getDelegateProperty("contentValueKey",a);if(b&&e){if(e.set){e.set(b,f)}else{e[b]=f}}else{this.set("content",f)}this.displayDidChange();this._endEditing()},_endEditing:function(a){this.$label().css("opacity",this._oldOpacity);a()}.enhance(),render:function(c,a){var f=this.get("content"),m=this.displayDelegate,b=this.get("outlineLevel"),e=this.get("outlineIndent"),l,j,i,n=[];n.push((this.get("contentIndex")%2===0)?"even":"odd");c.setClass("disabled",!this.get("isEnabled"));c.setClass("drop-target",this.get("isDropTarget"));i=c.begin("div").addClass("sc-outline");if(b>=0&&e>0){i.addStyle("left",e*(b+1))}j=this.get("disclosureState");if(j!==SC.LEAF_NODE){this.renderDisclosure(i,j);n.push("has-disclosure")}l=this.getDelegateProperty("contentCheckboxKey",m);if(l){j=f?(f.get?f.get(l):f[l]):NO;if(j!==null){this.renderCheckbox(i,j);n.push("has-checkbox")}}if(this.getDelegateProperty("hasContentIcon",m)){l=this.getDelegateProperty("contentIconKey",m);j=(l&&f)?(f.get?f.get(l):f[l]):null;if(j){this.renderIcon(i,j);n.push("has-icon")}}else{if(this.get("icon")){j=this.get("icon");this.renderIcon(i,j);n.push("has-icon")}}l=this.getDelegateProperty("contentValueKey",m);j=(l&&f)?(f.get?f.get(l):f[l]):f;if(j&&SC.typeOf(j)!==SC.T_STRING){j=j.toString()}if(this.get("escapeHTML")){j=SC.RenderContext.escapeHTML(j)}this.renderLabel(i,j);if(this.getDelegateProperty("hasContentRightIcon",m)){l=this.getDelegateProperty("contentRightIconKey",m);j=(l&&f)?(f.get?f.get(l):f[l]):null;this.renderRightIcon(i,j);n.push("has-right-icon")}l=this.getDelegateProperty("contentUnreadCountKey",m);j=(l&&f)?(f.get?f.get(l):f[l]):null;if(!SC.none(j)&&(j!==0)){this.renderCount(i,j);var d=["zero","one","two","three","four","five"];var k=j.toString().length;var h=d.length;var g=(k<h)?d[k]:d[h-1];n.push("has-count "+g+"-digit")}l=this.getDelegateProperty("listItemActionProperty",m);j=(l&&f)?(f.get?f.get(l):f[l]):null;if(j){this.renderAction(i,j);n.push("has-action")}if(this.getDelegateProperty("hasContentBranch",m)){l=this.getDelegateProperty("contentIsBranchKey",m);j=(l&&f)?(f.get?f.get(l):f[l]):NO;this.renderBranch(i,j);n.push("has-branch")}c.addClass(n);c=i.end()},renderDisclosure:function(a,d){var c=this.get("theme").disclosureRenderDelegate;a=a.begin("div").addClass("sc-disclosure-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(c.get("className"));var b=this._disclosureRenderSource;if(!b){this._disclosureRenderSource=b=SC.Object.create({renderState:{},theme:this.get("theme")})}b.set("isSelected",d===SC.BRANCH_OPEN).set("isEnabled",this.get("isEnabled")).set("title","");c.render(b,a);a=a.end();this._disclosureRenderDelegate=c},renderCheckbox:function(a,d){var c=this.get("theme").checkboxRenderDelegate;a=a.begin("div").addClass("sc-checkbox-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(c.get("className"));var b=this._checkboxRenderSource;if(!b){b=this._checkboxRenderSource=SC.Object.create({renderState:{},theme:this.get("theme")})}b.set("isSelected",d&&(d!==SC.MIXED_STATE)).set("isEnabled",this.get("isEnabled")&&this.get("contentIsEditable")).set("isActive",this._checkboxIsActive).set("title","");c.render(b,a);a=a.end();this._checkboxRenderDelegate=c},renderIcon:function(c,e){var b=null,d=null,a=[];if(e&&SC.ImageView.valueIsUrl(e)){b=e;d=""}else{d=e;b=SC.BLANK_IMAGE_URL}a.push(d,"icon");c.begin("img").addClass(a).attr("src",b).end()},renderLabel:function(b,a){b.push("<label>",a||"","</label>")},renderRightIcon:function(c,e){var b=null,d=null,a=[];if(e&&SC.ImageView.valueIsUrl(e)){b=e;d=""}else{d=e;b=SC.BLANK_IMAGE_URL}a.push("right-icon",d);c.begin("img").addClass(a).attr("src",b).end()},renderCount:function(a,b){a.push('<span class="count"><span class="inner">',b.toString(),"</span></span>")},renderAction:function(a,b){a.push('<img src="',SC.BLANK_IMAGE_URL,'" class="action" />')},renderBranch:function(c,b){var a=[];a.push("branch",b?"branch-visible":"branch-hidden");c.begin("span").addClass(a).push("&nbsp;").end()}});SC.ListItemView._deprecatedRenderWarningHasBeenIssued=false;sc_require("mixins/collection_view_delegate");sc_require("views/list_item");SC.DRAG_REORDER=16;SC.BENCHMARK_RELOAD=NO;SC.CollectionView=SC.View.extend(SC.CollectionViewDelegate,SC.CollectionContent,{classNames:["sc-collection-view"],displayProperties:["hasFirstResponder","isEnabled","isActive"],renderDelegateName:"collectionRenderDelegate",ACTION_DELAY:200,useFastPath:NO,content:null,contentBindingDefault:SC.Binding.multiple(),length:0,nowShowing:function(){return this.computeNowShowing()}.property("length","clippingFrame").cacheable(),selection:null,isSelectable:YES,isSelectableBindingDefault:SC.Binding.bool(),isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),isEditable:YES,isEditableBindingDefault:SC.Binding.bool(),canReorderContent:NO,canReorderContentBindingDefault:SC.Binding.bool(),canDeleteContent:NO,canDeleteContentBindingDefault:SC.Binding.bool(),canEditContent:NO,canEditContentBindingDefault:SC.Binding.bool(),isDropTarget:NO,useToggleSelection:NO,actOnSelect:NO,selectOnMouseDown:YES,exampleView:SC.ListItemView,contentExampleViewKey:null,groupExampleView:null,contentGroupExampleViewKey:null,action:null,target:null,contentValueKey:null,acceptsFirstResponder:NO,isActive:NO,calculatedHeight:0,calculatedWidth:0,computeLayout:function(){return null},layoutForContentIndex:function(a){return null},allContentIndexes:function(){return SC.IndexSet.create(0,this.get("length")).freeze()}.property("length").cacheable(),contentIndexesInRect:function(a){return null},computeNowShowing:function(){var c=this.contentIndexesInRect(this.get("clippingFrame"));if(!c){c=this.get("allContentIndexes")}else{var b=this.get("length"),a=c.get("max");if(a>b){c=c.copy().remove(b,a-b).freeze()}}return c},showInsertionPoint:function(a,b){},hideInsertionPoint:function(){},delegate:null,selectionDelegate:function(){var a=this.get("delegate"),b=this.get("content");return this.delegateFor("isCollectionViewDelegate",a,b)}.property("delegate","content").cacheable(),contentDelegate:function(){var a=this.get("delegate"),b=this.get("content");return this.delegateFor("isCollectionContent",a,b)}.property("delegate","content").cacheable(),_contentGroupIndexes:function(){return this.get("contentDelegate").contentGroupIndexes(this,this.get("content"))}.property("contentDelegate","content").cacheable(),contentRangeDidChange:function(d,b,c,a){if(!b&&(c==="[]")){this.notifyPropertyChange("_contentGroupIndexes");this.reload(a)}else{this.contentPropertyDidChange(b,c,a)}},contentPropertyDidChange:function(c,b,a){},updateContentRangeObserver:function(){var d=this.get("nowShowing"),a=this._cv_contentRangeObserver,c=this.get("content");if(!c){return}if(a){c.updateRangeObserver(a,d)}else{var b=this.contentRangeDidChange;a=c.addRangeObserver(d,this,b,null);this._cv_contentRangeObserver=a}},removeContentRangeObserver:function(){var b=this.get("content"),a=this._cv_contentRangeObserver;if(a){if(b){b.removeRangeObserver(a)}this._cv_contentRangeObserver=null}},contentLengthDidChange:function(){var a=this.get("content");this.set("length",a?a.get("length"):0);this.computeLayout()},_cv_contentDidChange:function(){var b=this.get("content"),a=this.contentLengthDidChange;if(b===this._content){return}this.removeContentRangeObserver();if(this._content){this._content.removeObserver("length",this,a)}this._content=b;if(b){b.addObserver("length",this,a)}this.contentLengthDidChange();this.contentRangeDidChange(b,null,"[]",null)}.observes("content"),_invalidIndexes:NO,reload:function(a){var b=this._invalidIndexes;if(a&&b!==YES){if(b){b.add(a)}else{b=this._invalidIndexes=a.clone()}}else{this._invalidIndexes=YES}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadIfNeeded)}return this},reloadIfNeeded:function(){var x=this._invalidIndexes;if(!x||!this.get("isVisibleInWindow")){return this}this._invalidIndexes=NO;var u=this.get("content"),v,w,n,z=this.computeLayout(),y=SC.BENCHMARK_RELOAD,c=this.get("nowShowing"),A=this._sc_itemViews,o=this.get("containerView")||this,a,r,t,s,l,p,h,q,e,m,k,B,d,b,g,j,f;if(x.isIndexSet&&x.contains(c)){x=YES}if(this.willReload){this.willReload(x===YES?null:x)}a=this.get("exampleView");t=a?a.isReusableInCollections:NO;r=this.get("groupExampleView");s=r?r.isReusableInCollections:NO;if(x.isIndexSet){if(y){SC.Benchmark.start(y="%@#reloadIfNeeded (Partial)".fmt(this),YES)}p=[];h=[];q=[];x.forEach(function(i){n=A?A[i]:null;if(c.contains(i)){if(n&&n.parentView===o){h.push(i)}else{q.push(i)}}else{if(n&&n.parentView===o){p.push(i)}}},this);for(v=0,w=p.length;v<w;++v){m=p[v];n=A?A[m]:null;delete A[m];g=this.get("contentDelegate");j=this.get("_contentGroupIndexes");f=j&&j.contains(m);if(f){f=g.contentIndexIsGroup(this,u,m)}l=f?s:t;if(l){b=f?this._GROUP_VIEW_POOL:this._VIEW_POOL;b.push(n);n.destroyLayer()}B=n.get("layer");if(B&&B.parentNode){B.parentNode.removeChild(B)}o.removeChild(n);if(!l){n.destroy()}}for(v=0,w=h.length;v<w;++v){m=h[v];n=A?A[m]:null;k=this.itemViewForContentIndex(m,YES);n.destroyLayer();o.replaceChild(k,n)}for(v=0,w=q.length;v<w;++v){m=q[v];k=this.itemViewForContentIndex(m,YES);o.insertBefore(k,null)}if(y){SC.Benchmark.end(y)}}else{if(y){SC.Benchmark.start(y="%@#reloadIfNeeded (Full)".fmt(this),YES)}if(A){A.length=0}e=o.get("childViews");if(e){e=e.copy()}o.beginPropertyChanges();if(this.willRemoveAllChildren){this.willRemoveAllChildren()}o.destroyLayer().removeAllChildren();if(e){for(v=0,w=e.length;v<w;++v){k=e[v];f=k.get("isGroupView");l=f?s:t;if(l){b=f?this._GROUP_VIEW_POOL:this._VIEW_POOL;b.push(k);k.destroyLayer()}else{k.destroy()}}}e=[];c.forEach(function(i){e.push(this.itemViewForContentIndex(i,YES))},this);o.set("childViews",e);o.replaceLayer();o.endPropertyChanges();if(y){SC.Benchmark.end(y)}}if(z){this.adjust(z)}if(this.didReload){this.didReload(x===YES?null:x)}return this},_TMP_ATTRS:{},_COLLECTION_CLASS_NAMES:["sc-collection-item"],_GROUP_COLLECTION_CLASS_NAMES:["sc-collection-item","sc-group-item"],_VIEW_POOL:null,_GROUP_VIEW_POOL:null,itemViewForContentIndex:function(l,a){var v;var u=this._sc_itemViews;if(!u){u=this._sc_itemViews=[]}else{if(!a&&(v=u[l])){return v}}var n=this.get("content"),p=n.objectAt(l),h=this.get("contentDelegate"),j=this.get("_contentGroupIndexes"),i=NO,w,k,q,f,r,d,b,c,t,g,e,o,s;i=j&&j.contains(l);if(i){i=h.contentIndexIsGroup(this,n,l)}if(i){w=this.get("contentGroupExampleViewKey");if(w&&p){k=p.get(w)}if(!k){k=this.get("groupExampleView")||this.get("exampleView")}r="_GROUP_VIEW_POOL"}else{w=this.get("contentExampleViewKey");if(w&&p){k=p.get(w)}if(!k){k=this.get("exampleView")}r="_VIEW_POOL"}c=this.get("containerView")||this;f=this.layerIdFor(l);t=h.contentIndexIsEnabled(this,n,l);g=h.contentIndexIsSelected(this,n,l);e=h.contentIndexOutlineLevel(this,n,l);o=h.contentIndexDisclosureState(this,n,l);s=this.isVisibleInWindow;q=this.layoutForContentIndex(l);if(k&&k.isReusableInCollections){d=this[r];if(!d){d=this[r]=[]}if(d.length>0){v=d.pop();b=v.prepareForReuse;if(b){b.call(v)}v.beginPropertyChanges();v.set("contentIndex",l);v.set("layerId",f);v.set("isEnabled",t);v.set("isSelected",g);v.set("outlineLevel",e);v.set("disclosureState",o);v.set("isVisibleInWindow",s);v.set("parentView",c);SC.View.views[f]=v;if(q){v.set("layout",q)}else{v.set("layout",k.prototype.layout)}v.set("content",p);v.endPropertyChanges()}}if(!v){var m=this._TMP_ATTRS;m.contentIndex=l;m.content=p;m.owner=m.displayDelegate=this;m.parentView=c;m.page=this.page;m.layerId=f;m.isEnabled=t;m.isSelected=g;m.outlineLevel=e;m.disclosureState=o;m.isGroupView=i;m.isVisibleInWindow=s;if(i){m.classNames=this._GROUP_COLLECTION_CLASS_NAMES}else{m.classNames=this._COLLECTION_CLASS_NAMES}if(q){m.layout=q}else{delete m.layout}v=this.createItemView(k,l,m)}u[l]=v;return v},itemViewForContentObject:function(a){return this.itemViewForContentIndex(this.get("content").indexOf(a))},_TMP_LAYERID:[],createItemView:function(c,a,b){return c.create(b)},layerIdFor:function(a){var b=this._TMP_LAYERID;b[0]=SC.guidFor(this);b[1]=a;return b.join("-")},contentIndexForLayerId:function(c){if(!c||!(c=c.toString())){return null}var b=this._baseLayerId;if(!b){b=this._baseLayerId=SC.guidFor(this)+"-"}if((c.length<=b.length)||(c.indexOf(b)!==0)){return null}var a=Number(c.slice(c.lastIndexOf("-")+1));return isNaN(a)?null:a},itemViewForEvent:function(j){var d=this.getPath("pane.rootResponder");if(!d){return null}var c=SC.guidFor(this)+"-",a=c.length,e=j.target,g=this.get("layer"),f=null,b,i,h;while(e&&e!==document&&e!==g){b=e?SC.$(e).attr("id"):null;if(b&&(f=this.contentIndexForLayerId(b))!==null){break}e=e.parentNode}if(f===null||(e===g)){e=g=null;return null}if(f>=this.get("length")){throw"layout for item view %@ was found when item view does not exist (%@)".fmt(b,this)}return this.itemViewForContentIndex(f)},expand:function(b){if(!b){return this}var a=this.get("contentDelegate"),c=this.get("content");b.forEach(function(d){var e=a.contentIndexDisclosureState(this,c,d);if(e===SC.BRANCH_CLOSED){a.contentIndexExpand(this,c,d)}},this);return this},collapse:function(b){if(!b){return this}var a=this.get("contentDelegate"),c=this.get("content");b.forEach(function(d){var e=a.contentIndexDisclosureState(this,c,d);if(e===SC.BRANCH_OPEN){a.contentIndexCollapse(this,c,d)}},this);return this},_cv_selectionDidChange:function(){var c=this.get("selection"),b=this._cv_selection,a=this._cv_selectionContentDidChange;if(c===b){return}if(b){b.removeObserver("[]",this,a)}if(c){c.addObserver("[]",this,a)}this._cv_selection=c;this._cv_selectionContentDidChange()}.observes("selection"),_cv_selectionContentDidChange:function(){var c=this.get("selection"),b=this._cv_selindexes,a=this.get("content"),d;this._cv_selindexes=c?c.frozenCopy():null;if(b){b=b.indexSetForSource(a)}if(c){c=c.indexSetForSource(a)}if(c&&b){d=c.without(b).add(b.without(c))}else{d=c||b}if(d&&d.get("length")>0){this.reloadSelectionIndexes(d)}},_invalidSelection:NO,reloadSelectionIndexes:function(a){var b=this._invalidSelection;if(a&&(b!==YES)){if(b){b.add(a)}else{b=this._invalidSelection=a.copy()}}else{this._invalidSelection=YES}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)}return this},reloadSelectionIndexesIfNeeded:function(){var e=this._invalidSelection;if(!e||!this.get("isVisibleInWindow")){return this}var d=this.get("nowShowing"),b=this._invalidIndexes,a=this.get("content"),c=this.get("selection");this._invalidSelection=NO;if(b===YES||!d){return this}if(e===YES){e=d}if(b&&b.isIndexSet){e=e.without(b)}e.forEach(function(f){if(!d.contains(f)){return}var g=this.itemViewForContentIndex(f,NO);if(g){g.set("isSelected",c?c.contains(a,f):NO)}},this);return this},select:function(c,f){var d=this.get("content"),a=this.get("selectionDelegate"),b=this.get("_contentGroupIndexes"),e;if(!this.get("isSelectable")||!this.get("isEnabled")){return this}if(SC.typeOf(c)===SC.T_NUMBER){c=SC.IndexSet.create(c,1)}if(c&&c.get("length")>0){if(b&&b.get("length")>0){c=c.copy().remove(b)}c=a.collectionViewShouldSelectIndexes(this,c,f);if(!c||c.get("length")===0){return this}}else{c=null}if(f&&(e=this.get("selection"))){e=e.copy()}else{e=SC.SelectionSet.create()}if(c&&c.get("length")>0){if(c.get("length")===1){e.addObject(d.objectAt(c.get("firstObject")))}else{e.add(d,c)}}e=a.collectionViewSelectionForProposedSelection(this,e);if(!e){e=SC.SelectionSet.create()}this._selectionAnchor=null;this.set("selection",e.freeze());return this},deselect:function(b){var d=this.get("selection"),c=this.get("content"),a=this.get("selectionDelegate");if(!this.get("isSelectable")||!this.get("isEnabled")){return this}if(!d||d.get("length")===0){return this}if(SC.typeOf(b)===SC.T_NUMBER){b=SC.IndexSet.create(b,1)}b=a.collectionViewShouldDeselectIndexes(this,b);if(!b||b.get("length")===0){return this}d=d.copy().remove(c,b);d=a.collectionViewSelectionForProposedSelection(this,d);if(!d){d=SC.SelectionSet.create()}this.set("selection",d.freeze());return this},_findNextSelectableItemFromIndex:function(h,a){var c=this.get("length"),d=SC.IndexSet.create(),e=this.get("content"),i=this.get("selectionDelegate"),g=this.get("_contentGroupIndexes"),f,b;if(!g&&(i.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return h}while(h<c){if(!g||!g.contains(h)){d.add(h);f=i.collectionViewShouldSelectIndexes(this,d);if(f&&f.get("length")>=1){return h}d.remove(h)}h++}if(a===undefined){b=this.get("selection");a=b?b.get("max"):-1}return a},_findPreviousSelectableItemFromIndex:function(b,h){var c=SC.IndexSet.create(),f=this.get("content"),a=this.get("selectionDelegate"),e=this.get("_contentGroupIndexes"),d;if(SC.none(b)){b=-1}if(!e&&(a.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return b}while(b>=0){if(!e||!e.contains(b)){c.add(b);d=a.collectionViewShouldSelectIndexes(this,c);if(d&&d.get("length")>=1){return b}c.remove(b)}b--}if(h===undefined){var g=this.get("selection");h=g?g.get("min"):-1}if(SC.none(h)){h=-1}return h},selectPreviousItem:function(h,b){if(SC.none(b)){b=1}if(SC.none(h)){h=false}var f=this.get("selection"),e=this.get("content");if(f){f=f.indexSetForSource(e)}var g=f?f.get("min"):-1,a=f?f.get("max")-1:-1,d=this._selectionAnchor;if(SC.none(d)){d=g}if(h){if(a>d){a=a-b}else{g=this._findPreviousSelectableItemFromIndex(g-b)}if(SC.none(g)||(g<0)){g=0}if(!e.objectAt(g)){g=f?f.get("min"):-1}if(a<g){a=g}}else{g=this._findPreviousSelectableItemFromIndex(g-b);if(SC.none(g)||(g<0)){g=0}if(!e.objectAt(g)){g=f?f.get("min"):-1}a=g;d=null}var c=g;f=SC.IndexSet.create(g,a+1-g);this.scrollToContentIndex(c);this.select(f);this._selectionAnchor=d;return this},selectNextItem:function(h,i){if(SC.none(i)){i=1}if(SC.none(h)){h=false}var b=this.get("selection"),g=this.get("content");if(b){b=b.indexSetForSource(g)}var a=b?b.get("min"):-1,d=b?b.get("max")-1:-1,e=this._selectionAnchor,c=this.get("length");if(SC.none(e)){e=a}if(h){if(a<e){a=a+i}else{d=this._findNextSelectableItemFromIndex(d+i,d)}if(d>=c){d=c-1}if(!g.objectAt(d)){d=b?b.get("max")-1:-1}if(a>d){a=d}}else{d=this._findNextSelectableItemFromIndex(d+i,d);if(d>=c){d=c-1}if(!g.objectAt(d)){d=b?b.get("max")-1:-1}a=d;e=null}var f=d;b=SC.IndexSet.create(a,d-a+1);this.scrollToContentIndex(f);this.select(b);this._selectionAnchor=e;return this},deleteSelection:function(){if(!this.get("canDeleteContent")){return NO}var d=this.get("selection"),c=this.get("content"),a=this.get("selectionDelegate"),b=d&&c?d.indexSetForSource(c):null;if(!c||!b||b.get("length")===0){return NO}b=a.collectionViewShouldDeleteIndexes(this,b);if(!b||b.get("length")===0){return NO}a.collectionViewDeleteContent(this,this.get("content"),b);return YES},scrollToContentIndex:function(b){var a=this.itemViewForContentIndex(b);if(a){this.scrollToItemView(a)}return this},scrollToItemView:function(a){if(a){a.scrollToVisible()}return this},keyDown:function(a){var b=this.interpretKeyEvents(a);return !b?NO:b},keyUp:function(){return true},insertText:function(b,a){if(b===" "){var c=this.get("selection");if(c&&c.get("length")>0){this.invokeLater(this._cv_action,0,null,a)}return YES}else{return NO}},selectAll:function(a){var b=this.get("content"),c=b?SC.IndexSet.create(0,b.get("length")):null;this.select(c,NO);return YES},deselectAll:function(){var a=this.get("content"),b=a?SC.IndexSet.create(0,a.get("length")):null;this.deselect(b,NO);return YES},deleteBackward:function(a){return this.deleteSelection()},deleteForward:function(a){return this.deleteSelection()},moveDown:function(b,a){this.selectNextItem(false,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveUp:function(b,a){this.selectPreviousItem(false,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveLeft:function(k){if(k.ctrlKey||k.metaKey){return NO}if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(false,1);this._cv_performSelectAction(null,k,this.ACTION_DELAY)}else{var c=this.get("selection"),i=this.get("content"),g=c?c.indexSetForSource(i):null;if(g){var l=undefined,f=false,h=undefined;if(g.get("length")===1){h=g.get("firstObject");l=this.get("contentDelegate");var b=l.contentIndexDisclosureState(this,i,h);if(b!==SC.BRANCH_OPEN){f=true}}if(f){var a=l.contentIndexOutlineLevel(this,i,h)-1;if(a>=0){var e=-1;while(e<0){var d=this._findPreviousSelectableItemFromIndex(h-1);if(d<0){return false}h=d;var j=l.contentIndexOutlineLevel(this,i,h);if(j===a){e=d}}if(e!==-1){this.select(h)}}}else{this.collapse(g)}}}return true},moveRight:function(a){if(a.ctrlKey||a.metaKey){return NO}if((this.get("itemsPerRow")||1)>1){this.selectNextItem(false,1);this._cv_performSelectAction(null,a,this.ACTION_DELAY)}else{var d=this.get("selection"),c=this.get("content"),b=d?d.indexSetForSource(c):null;if(b){this.expand(b)}}return true},moveDownAndModifySelection:function(b,a){this.selectNextItem(true,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveUpAndModifySelection:function(b,a){this.selectPreviousItem(true,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,a,this.ACTION_DELAY);return true},moveLeftAndModifySelection:function(b,a){if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(true,1);this._cv_performSelectAction(null,a,this.ACTION_DELAY)}return true},moveRightAndModifySelection:function(b,a){if((this.get("itemsPerRow")||1)>1){this.selectNextItem(true,1);this._cv_performSelectAction(null,a,this.ACTION_DELAY)}return true},insertNewline:function(d,c){var b=this.get("isEditable")&&this.get("canEditContent"),g,f,h,a,e;if(b){g=this.get("selection");f=this.get("content");if(g&&g.get("length")===1){h=g.indexSetForSource(f);a=h?h.get("min"):-1;b=a>=0}}if(b){e=this.itemViewForContentIndex(a);b=e&&SC.typeOf(e.beginEditing)===SC.T_FUNCTION}if(b){this.scrollToContentIndex(a);e=this.itemViewForContentIndex(a);e.beginEditing()}else{this.invokeLater(this._cv_action,0,e,null)}return YES},insertTab:function(b){var a=this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},insertBacktab:function(b){var a=this.get("previousValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},mouseDown:function(j){var g=this.get("content");if(!g){return this.get("isSelectable")}var h=this.itemViewForEvent(j),e=h?h.get("contentIndex"):-1,c,d,b,a,k,f=NO,i=g.get("allowsMultipleSelection");if(!this.get("isEnabled")){return e>-1}if(!this.get("isSelectable")){return NO}this.becomeFirstResponder();if(this.get("useToggleSelection")){if(this.get("selectOnMouseDown")){if(!h){return}b=this.get("selection");a=b&&b.containsObject(h.get("content"));if(a){this.deselect(e)}else{if(!i){this.select(e,NO);f=YES}else{this.select(e,YES);f=YES}}if(f&&this.get("actOnSelect")){this._cv_performSelectAction(h,j)}}return YES}if(!h){if(this.get("allowDeselectAll")){this.select(null,false)}return YES}b=this.get("selection");if(b){b=b.indexSetForSource(g)}c=this.mouseDownInfo={event:j,itemView:h,contentIndex:e,at:Date.now()};a=b?b.contains(e):NO;c.modifierKeyPressed=k=j.ctrlKey||j.metaKey;if(k&&a){c.shouldDeselect=e>=0}else{if(j.shiftKey&&b&&b.get("length")>0&&i){b=this._findSelectionExtendedByShift(b,e);d=this._selectionAnchor;this.select(b);this._selectionAnchor=d}else{if(!k&&a){c.shouldReselect=e>=0}else{if((j.shiftKey||k)&&!i){this.select(null,false)}if(this.get("selectOnMouseDown")){this.select(e,k)}else{c.shouldSelect=e>=0}}}}c.previousContentIndex=e;return YES},mouseUp:function(i){var j=this.itemViewForEvent(i),d=this.mouseDownInfo,f=this.get("content"),e=j?j.get("contentIndex"):-1,c,a,b,g,k,h=f.get("allowsMultipleSelection");if(!this.get("isEnabled")){return e>-1}if(!this.get("isSelectable")){return NO}if(this.get("useToggleSelection")){if(!j||this.get("selectOnMouseDown")){return NO}c=this.get("selection");a=c&&c.containsObject(j.get("content"));if(a){this.deselect(e)}else{if(!h){this.select(e,NO)}else{this.select(e,YES)}}}else{if(d){k=d.contentIndex;e=(j)?j.get("contentIndex"):-1;if(d.shouldSelect){this.select(k,d.modifierKeyPressed)}if(d.shouldDeselect){this.deselect(k)}if(d.shouldReselect){b=this.get("isEditable")&&this.get("canEditContent");if(b){c=this.get("selection");b=c&&(c.get("length")===1)}if(b){g=this.itemViewForContentIndex(k);b=g&&(!g.contentHitTest||g.contentHitTest(i));b=(b&&g.beginEditing)?g.beginEditing():NO}if(!b){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()}this._cv_reselectTimer=this.invokeLater(this.select,300,k,false)}}this._cleanupMouseDown()}}this._cv_performSelectAction(j,i,0,i.clickCount);return NO},_cleanupMouseDown:function(){var b=this.mouseDownInfo,a;if(b){for(a in b){if(!b.hasOwnProperty(a)){continue}delete b[a]}}this.mouseDownInfo=null},mouseMoved:function(c){var a=this.itemViewForEvent(c),b=this._lastHoveredItem;if(a!==b){if(b&&b.mouseExited){b.mouseExited(c)}if(a&&a.mouseEntered){a.mouseEntered(c)}}this._lastHoveredItem=a;if(a&&a.mouseMoved){a.mouseMoved(c)}return YES},mouseExited:function(b){var a=this._lastHoveredItem;this._lastHoveredItem=null;if(a&&a.mouseExited){a.mouseExited(b)}return YES},touchStart:function(d,a){var b=this.itemViewForEvent(d),c=b?b.get("contentIndex"):-1;if(!this.get("isEnabled")){return c>-1}this.becomeFirstResponder();this._touchSelectedView=b;if(!this.get("useToggleSelection")){if(b&&!b.get("isSelected")){b.set("isSelected",YES)}}return YES},touchesDragged:function(a,b){b.forEach(function(c){if(Math.abs(c.pageX-c.startX)>5||Math.abs(c.pageY-c.startY)>5){c.makeTouchResponder(c.nextTouchResponder)}},this)},touchEnd:function(e){var b=this._touchSelectedView,d=b?b.get("contentIndex"):-1,a=NO,c;if(!this.get("isEnabled")){return d>-1}if(b){b.set("isSelected",NO)}if(d>-1){if(this.get("useToggleSelection")){c=this.get("selection");a=c&&c.containsObject(b.get("content"))}if(a){this.deselect(d)}else{this.select(d,NO);this._cv_performSelectAction(b,e,0)}}this._touchSelectedView=null},touchCancelled:function(a){if(this._touchSelectedView){this._touchSelectedView.set("isSelected",NO);this._touchSelectedView=null}},_findSelectionExtendedByShift:function(e,h){if(!e||e.get("length")===0){return SC.IndexSet.create(h)}var d=this.get("content"),g=d.get("length")-1,c=e.get("min"),a=e.get("max")-1,f=this.mouseDownInfo,b=this._selectionAnchor;if(SC.none(b)){b=-1}if(h<c){c=h;if(b<0){this._selectionAnchor=b=a}}else{if(h>a){a=h;if(b<0){this._selectionAnchor=b=c}}else{if(h>=c&&h<=a){if(b<0){this._selectionAnchor=b=c}if(h===b){c=a=h}else{if(h>b){c=b;a=h}else{if(h<b){c=h;a=b}}}}}}return SC.IndexSet.create(c,a-c+1)},reorderDataType:function(){return"SC.CollectionView.Reorder."+SC.guidFor(this)}.property().cacheable(),dragContent:null,proposedInsertionIndex:null,proposedDropOperation:null,mouseDragged:function(h){var i=this.get("selectionDelegate"),e=this.get("content"),a=this.get("selection"),c=this.mouseDownInfo,f=this.get("_contentGroupIndexes"),d,b,g;if(!c||c.contentIndex<0){return YES}if((Date.now()-c.at)<123){return YES}if(i.collectionViewShouldBeginDrag(this)){if(!this.get("selectOnMouseDown")){d=SC.IndexSet.create(c.contentIndex)}else{d=a?a.indexSetForSource(e):null}if(d&&f&&f.get("length")>0){d=d.copy().remove(f);if(d.get("length")===0){d=null}else{d.freeze()}}if(!d){return YES}else{d=d.frozenCopy()}d={content:e,indexes:d};this.set("dragContent",d);b=this.get("dragDataTypes");if(b&&b.get("length")>0){g=i.collectionViewDragViewFor(this,d.indexes);if(!g){g=this._cv_dragViewFor(d.indexes)}g.createLayer();SC.Drag.start({event:c.event,source:this,dragView:g,ghost:NO,ghostActsLikeCursor:i.ghostActsLikeCursor,slideBack:YES,dataSource:this});this._cleanupMouseDown();this._lastInsertionIndex=null}else{this.set("dragContent",null)}return YES}},_cv_dragViewFor:function(f){var c=this.get("nowShowing").without(f),d=this.get("layer").cloneNode(false),b=SC.View.create({layer:d,parentView:this}),a=0,e;c=this.get("nowShowing").without(c);SC.$(d).css("backgroundColor","transparent").css("border","none").css("top",0).css("left",0);c.forEach(function(j){var k=this.itemViewForContentIndex(j),g,h;if(k){g=k.get("isSelected");k.set("isSelected",NO);k.updateLayerIfNeeded();h=k.get("layer");if(h){h=h.cloneNode(true)}k.set("isSelected",g);k.updateLayerIfNeeded()}if(h){d.appendChild(h);e=k.get("layout");if(e.height+e.top>a){a=e.height+e.top}}h=null},this);b.set("layout",{height:a});d=null;return b},dragDataTypes:function(){var a=this.get("selectionDelegate"),b=a.collectionViewDragDataTypes(this),c;if(this.get("canReorderContent")){b=b?b.copy():[];c=this.get("reorderDataType");if(b.indexOf(c)<0){b.push(c)}}return b?b:[]}.property(),dragDataForType:function(c,b){if(this.get("canReorderContent")){if(b===this.get("reorderDataType")){return this.get("dragContent")}}var a=this.get("selectionDelegate");return a.collectionViewDragDataForType(this,c,b)},computeDragOperations:function(c,b){var d=SC.DRAG_NONE,a=this.get("selectionDelegate");if(this.get("canReorderContent")){if(c.get("dataTypes").indexOf(this.get("reorderDataType"))>=0){d=SC.DRAG_REORDER}}d=a.collectionViewComputeDragOperations(this,c,d);if(d&SC.DRAG_REORDER){d=SC.DRAG_MOVE}return d},_computeDropOperationState:function(c,l,e){var g=this.convertFrameFromView(c.get("location"),null),k=SC.DROP_BEFORE,m=this.get("selectionDelegate"),d=this.get("canReorderContent"),n,h,a,i,f,b;var j=this.insertionIndexForLocation(g,SC.DROP_ON);if(SC.typeOf(j)===SC.T_ARRAY){k=j[1];j=j[0]}if(k===SC.DROP_ON){this.set("proposedInsertionIndex",j);this.set("proposedDropOperation",k);b=m.collectionViewValidateDragOperation(this,c,e,j,k);j=this.get("proposedInsertionIndex");k=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;if(b!==SC.DRAG_NONE){return[j,k,b]}else{k=SC.DROP_BEFORE;j=this.insertionIndexForLocation(g,SC.DROP_BEFORE);if(SC.typeOf(j)===SC.T_ARRAY){k=j[1];j=j[0]}}}if((j>=0)&&d&&(k!==SC.DROP_ON)){n=c.dataForType(this.get("reorderDataType"));if(n){h=this.get("content");if(k===SC.DROP_BEFORE){a=n.indexes.contains(j-1);i=n.indexes.contains(j)}else{a=n.indexes.contains(j);i=n.indexes.contains(j-1)}if(a&&i){if(SC.none(this._lastInsertionIndex)){if(k===SC.DROP_BEFORE){while((j>=0)&&n.indexes.contains(j)){j--}}else{f=h?h.get("length"):0;while((j<f)&&n.indexes.contains(j)){j++}}}else{j=this._lastInsertionIndex}}if(j>=0){e=SC.DRAG_REORDER}}}this.set("proposedInsertionIndex",j);this.set("proposedDropOperation",k);e=m.collectionViewValidateDragOperation(this,c,e,j,k);j=this.get("proposedInsertionIndex");k=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;return[j,k,e]},dragUpdated:function(f,b){var h=f.get("allowedDragOperations"),g=this._computeDropOperationState(f,b,h),a=g[0],c=g[1],e=g[2];if(e!==SC.DRAG_NONE){if((this._lastInsertionIndex!==a)||(this._lastDropOperation!==c)){var d=this.itemViewForContentIndex(a);this.showInsertionPoint(d,c)}this._lastInsertionIndex=a;this._lastDropOperation=c}else{this.hideInsertionPoint();this._lastInsertionIndex=this._lastDropOperation=null}return(e&SC.DRAG_REORDER)?SC.DRAG_MOVE:e},dragExited:function(){this.hideInsertionPoint();this._lastInsertionIndex=this._lastDropOperation=null},acceptDragOperation:function(a,b){return YES},performDragOperation:function(e,g){var a=this._computeDropOperationState(e,null,g),k=a[0],j=a[1],h=a[2],l=this.get("selectionDelegate"),c,m,d,i,b,f;if(h&SC.DRAG_REORDER){g=(g&SC.DRAG_MOVE)?SC.DRAG_REORDER:SC.DRAG_NONE}else{g=g&h}if(g===SC.DRAG_NONE){return g}c=l.collectionViewPerformDragOperation(this,e,g,k,j);if((c===SC.DRAG_NONE)&&(g&SC.DRAG_REORDER)){d=e.dataForType(this.get("reorderDataType"));if(!d){return SC.DRAG_NONE}i=this.get("content");f=d.indexes;if(f.get("length")===1){if(((j===SC.DROP_BEFORE)||(j===SC.DROP_AFTER))&&(f.get("min")===k)){return SC.DRAG_MOVE}}i.beginPropertyChanges();m=[];b=0;d.indexes.forEach(function(n){m.push(i.objectAt(n-b));i.removeAt(n-b);b++;if(n<k){k--}},this);if(j===SC.DROP_AFTER){k++}i.replace(k,0,m,j);this.select(SC.IndexSet.create(k,m.length));i.endPropertyChanges();g=SC.DRAG_MOVE}return g},collectionViewShouldBeginDrag:function(a){return this.get("canReorderContent")},insertionIndexForLocation:function(a,b){return -1},_cv_isVisibleInWindowDidChange:function(){if(this.get("isVisibleInWindow")){if(this._invalidIndexes){this.invokeOnce(this.reloadIfNeeded)}if(this._invalidSelection){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)}}}.observes("isVisibleInWindow"),collectionViewShouldSelectItem:function(a,b){return this.get("isSelectable")},_TMP_DIFF1:SC.IndexSet.create(),_TMP_DIFF2:SC.IndexSet.create(),_cv_nowShowingDidChange:function(){var b=this.get("nowShowing"),a=this._sccv_lastNowShowing,d,e,c;if(a!==b){if(a&&b){e=this._TMP_DIFF1.add(a).remove(b);c=this._TMP_DIFF2.add(b).remove(a);d=e.add(c)}else{d=a||b}}if(d&&d.get("length")>0){this._sccv_lastNowShowing=b?b.frozenCopy():null;this.updateContentRangeObserver();this.reload(d)}if(e){e.clear()}if(c){c.clear()}}.observes("nowShowing"),init:function(){arguments.callee.base.apply(this,arguments);if(this.useFastPath){this.mixin(SC.CollectionFastPath)}if(this.get("canReorderContent")){this._cv_canReorderContentDidChange()}this._sccv_lastNowShowing=this.get("nowShowing").clone();if(this.content){this._cv_contentDidChange()}if(this.selection){this._cv_selectionDidChange()}},_cv_canReorderContentDidChange:function(){if(this.get("canReorderContent")){if(!this.get("isDropTarget")){this.set("isDropTarget",YES)}SC.Drag.addDropTarget(this)}}.observes("canReorderContent"),_cv_performSelectAction:function(b,d,c,a){var e;if(c===undefined){c=0}if(a===undefined){a=1}if((a>1)||this.get("actOnSelect")){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()}e=this.get("selection");e=e?e.toArray():[];if(this._cv_actionTimer){this._cv_actionTimer.invalidate()}this._cv_actionTimer=this.invokeLater(this._cv_action,c,b,d,e)}},_cv_action:function(b,a,c){var d=this.get("action");var e=this.get("target")||null;this._cv_actionTimer=null;if(d){if(SC.typeOf(d)===SC.T_FUNCTION){return this.action(b,a)}var f=this.get("pane");if(f){f.rootResponder.sendAction(d,e,this,f,c)}}else{if(!b){return}else{if(SC.typeOf(b._action)==SC.T_FUNCTION){return b._action(a)}else{if(SC.typeOf(b.action)==SC.T_FUNCTION){return b.action(a)}}}}}});SC.DateFieldView=SC.TextFieldView.extend({value:null,showDate:YES,showTime:NO,formatTime:"%I:%M %p",formatDate:"%d/%m/%Y",formatDateTime:"%d/%m/%Y %I:%M %p",_dtConstants:["%a","%b","%d","%H","%I","%j","%m","%M","%p","%S","%U","%W","%y","%Y"],_wtConstants:[3,3,2,2,2,3,2,2,2,2,2,2,2,4],activeSelection:0,format:function(){var a=this.get("showTime");var b=this.get("showDate");if(a===YES&&b===YES){return this.get("formatDateTime")}if(a===YES){return this.get("formatTime")}return this.get("formatDate")}.property("showTime","showDate").cacheable(),validator:function(){return SC.Validator.DateTime.extend({format:this.get("format")})}.property("format").cacheable(),tabsSelections:function(){var f=[];var d=this.get("format");var i=this.get("_dtConstants");var b=this.get("_wtConstants");if(SC.empty(d)){throw"The format string is empty, and must be a valid string."}var g,j,c,e=0,a=0,h=0;while(e<d.length&&d.indexOf("%",e)!==-1){g=d.indexOf("%",e);j=d.substring(g,g+2);e=g+2;c=i.indexOf(j);if(c===-1){throw"SC.DateFieldView: The format's key '%@' is not supported.".fmt(j)}a=a+g-h;f.push(SC.Object.create({key:j,textSelection:SC.TextSelection.create({start:a,end:a+b[c]})}));a=a+b[c];h=e}g=j=c=null;return f}.property("format").cacheable(),updateTextSelectionObserver:function(){var a=this.get("activeSelection");var b=this.get("tabsSelections");if(this.get("isEditing")){this.selection(null,b[a].get("textSelection"))}}.observes("activeSelection","value"),updateValue:function(b,c){var e=(c===0)?-1:1;var d=this.get("value"),a;switch(b){case"%a":case"%d":case"%j":this.set("value",d.advance({day:e}));break;case"%b":case"%m":this.set("value",d.advance({month:e}));break;case"%H":case"%I":this.set("value",d.advance({hour:e}));break;case"%M":this.set("value",d.advance({minute:e}));break;case"%p":a=d.get("hour")>=12?-12:12;this.set("value",d.advance({hour:a}));break;case"%S":this.set("value",d.advance({second:e}));break;case"%U":this.set("value",d.advance({week1:e}));break;case"%W":this.set("value",d.advance({week0:e}));break;case"%y":case"%Y":this.set("value",d.advance({year:e}));break}},_selectRootElement:function(){},keyDown:function(a){if(this.interpretKeyEvents(a)){a.stop();return YES}return arguments.callee.base.apply(this,arguments)},ctrl_a:function(){return YES},moveUp:function(b){var a=this.get("activeSelection");var c=this.get("tabsSelections");this.updateValue(c[a].get("key"),1);return YES},moveDown:function(b){var a=this.get("activeSelection");var c=this.get("tabsSelections");this.updateValue(c[a].get("key"),0);return YES},insertText:function(a){return YES},moveRight:function(a){var c=this.get("tabsSelections");var b=this.get("activeSelection")+1;if(b===c.length){b=0}this.set("activeSelection",b);return YES},moveLeft:function(a){var c=this.get("tabsSelections");var b=this.get("activeSelection")-1;if(b===-1){b=c.length-1}this.set("activeSelection",b);return YES},insertTab:function(a){var c=this.get("tabsSelections");var b=this.get("activeSelection")+1;if(b<c.length){this.set("activeSelection",b);return YES}return NO},insertBacktab:function(a){var b=this.get("activeSelection")-1;if(b!==-1){this.set("activeSelection",b);return YES}return NO},mouseUp:function(b){var c=arguments.callee.base.apply(this,arguments);var e=this.get("selection");if(SC.none(e)){this.set("activeSelection",0)}else{var h=e.get("start");var g=this.get("tabsSelections");var a=g.length,f;for(var d=0;d<a;d++){f=g[d].get("textSelection");if(h>=f.get("start")&&h<=f.get("end")){this.set("activeSelection",d)}}}return c},deleteBackward:function(a){return YES},deleteForward:function(a){return YES}});SC.DisclosureView=SC.ButtonView.extend({classNames:["sc-disclosure-view"],renderDelegateName:"disclosureRenderDelegate",buttonBehavior:SC.TOGGLE_BEHAVIOR,toggleOnValue:YES,toggleOffValue:NO,valueBindingDefault:SC.Binding.bool(),keyDown:function(a){if(a.which===37||a.which===38){this.set("value",this.get("toggleOffValue"));return YES}if(a.which===39||a.which===40){this.set("value",this.get("toggleOnValue"));return YES}arguments.callee.base.apply(this,arguments)}});sc_require("views/collection");sc_require("mixins/collection_row_delegate");SC.ListView=SC.CollectionView.extend(SC.CollectionRowDelegate,{classNames:["sc-list-view"],acceptsFirstResponder:YES,showAlternatingRows:NO,render:function(a,b){a.setClass("alternating",this.get("showAlternatingRows"));return arguments.callee.base.apply(this,arguments)},rowDelegate:function(){var a=this.delegate,b=this.get("content");return this.delegateFor("isCollectionRowDelegate",a,b)}.property("delegate","content").cacheable(),_sclv_rowDelegateDidChange:function(){var d=this._sclv_rowDelegate,b=this.get("rowDelegate"),c=this._sclv_rowHeightDidChange,a=this._sclv_customRowHeightIndexesDidChange;if(d===b){return this}this._sclv_rowDelegate=b;if(d){d.removeObserver("rowHeight",this,c);d.removeObserver("customRowHeightIndexes",this,a)}if(!b){throw"Internal Inconsistancy: ListView must always have CollectionRowDelegate"}b.addObserver("rowHeight",this,c);b.addObserver("customRowHeightIndexes",this,a);this._sclv_rowHeightDidChange()._sclv_customRowHeightIndexesDidChange();return this}.observes("rowDelegate"),_sclv_rowHeightDidChange:function(){var b=this.get("rowDelegate"),a=b.get("rowHeight"),c;if(a===this._sclv_rowHeight){return this}this._sclv_rowHeight=a;c=SC.IndexSet.create(0,this.get("length"));this.rowHeightDidChangeForIndexes(c);return this},_sclv_customRowHeightIndexesDidChange:function(){var a=this.get("rowDelegate"),b=a.get("customRowHeightIndexes"),d=this._sclv_customRowHeightIndexes,c=this._sclv_customRowHeightIndexesContentDidChange;if((b===d)||(d&&d.isEqual(b))){return this}if(d&&this._sclv_isObservingCustomRowHeightIndexes){d.removeObserver("[]",this,c)}if(this._sclv_isObservingCustomRowHeightIndexes=b&&!b.get("isFrozen")){b.addObserver("[]",this,c)}this._sclv_customRowHeightIndexesContentDidChange();return this},_sclv_customRowHeightIndexesContentDidChange:function(){var a=this.get("rowDelegate"),b=a.get("customRowHeightIndexes"),c=this._sclv_customRowHeightIndexes,d;if(b&&c){d=b.copy().add(c)}else{d=b||c}this._sclv_customRowHeightIndexes=b?b.frozenCopy():null;this.rowHeightDidChangeForIndexes(d);return this},rowOffsetForContentIndex:function(h){if(h===0){return 0}var j=this.get("rowDelegate"),a=j.get("rowHeight"),f,e,c,b,i,g,d;e=h*a;f=this.get("rowSpacing");if(f){e+=h*f}if(j.customRowHeightIndexes&&(c=j.get("customRowHeightIndexes"))){b=this._sclv_offsetCache;if(!b){b=[];i=g=0;c.forEach(function(k){i+=this.rowHeightForContentIndex(k)-a;b[k+1]=i;g=k},this);this._sclv_max=g+1;this._sclv_offsetCache=b}i=b[h];if(i===undefined){i=b[h]=b[h-1];if(i===undefined){g=this._sclv_max;if(h<g){g=c.indexBefore(h)+1}i=b[h]=b[g]||0}}e+=i}return e},rowHeightForContentIndex:function(a){var b=this.get("rowDelegate"),e,c,f,d;if(b.customRowHeightIndexes&&(d=b.get("customRowHeightIndexes"))){c=this._sclv_heightCache;if(!c){c=[];f=this.get("content");d.forEach(function(g){c[g]=b.contentIndexRowHeight(this,f,g)},this);this._sclv_heightCache=c}e=c[a];if(e===undefined){e=b.get("rowHeight")}}else{e=b.get("rowHeight")}return e},rowHeightDidChangeForIndexes:function(b){var a=this.get("length");this._sclv_heightCache=this._sclv_offsetCache=null;if(b&&b.isIndexSet){b=b.get("min")}this.reload(SC.IndexSet.create(b,a-b));return this},_sclv_lengthDidChange:function(){this.adjust(this.computeLayout())}.observes("length"),computeLayout:function(){var a=this._sclv_layout;if(!a){a=this._sclv_layout={}}a.minHeight=this.rowOffsetForContentIndex(this.get("length"));this.set("calculatedHeight",a.minHeight);return a},layoutForContentIndex:function(b){var a=this.get("rowDelegate");return{top:this.rowOffsetForContentIndex(b),height:this.rowHeightForContentIndex(b)-a.get("rowPadding")*2,left:0,right:0}},contentIndexesInRect:function(h){var a=this.get("rowDelegate").get("rowHeight"),g=SC.minY(h),b=SC.maxY(h),i=h.height||0,f=this.get("length"),e,c,d;c=(g-(g%a))/a;e=this.rowOffsetForContentIndex(c);while(c>0&&e>g){c--;e-=this.rowHeightForContentIndex(c)}e+=this.rowHeightForContentIndex(c);while(c<f&&e<=g){c++;e+=this.rowHeightForContentIndex(c)}if(c<0){c=0}if(c>=f){c=f}d=c+((i-(i%a))/a);if(d>f){d=f}e=this.rowOffsetForContentIndex(d);while(d>=c&&e>=b){d--;e-=this.rowHeightForContentIndex(d)}e+=this.rowHeightForContentIndex(d);while(d<f&&e<b){d++;e+=this.rowHeightForContentIndex(d)}d++;if(d<c){d=c}if(d>f){d=f}return SC.IndexSet.create(c,d-c)},insertionPointView:SC.View.extend({classNames:"sc-list-insertion-point",render:function(a,b){if(b){a.push('<div class="anchor"></div>')}}}),showInsertionPoint:function(g,f){var h=this._insertionPointView;if(!h){h=this._insertionPointView=this.get("insertionPointView").create()}var d=g.get("contentIndex"),e=this.get("length"),c=SC.clone(g.get("layout")),a=g.get("outlineLevel"),b=g.get("outlineIndent")||0,i;if((d>=e)&&d>0){i=this.itemViewForContentIndex(e-1);if(i.get("isGroupView")){a=1;b=i.get("outlineIndent")}}if(SC.none(a)){a=-1}if(f&SC.DROP_ON){if(g!==this._lastDropOnView){this.hideInsertionPoint();g.set("isDropTarget",YES);this._lastDropOnView=g}}else{if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}if(f&SC.DROP_AFTER){c.top+=c.height}c.height=2;c.right=0;c.left=((a+1)*b)+12;delete c.width;h.set("layout",c);this.appendChild(h)}},hideInsertionPoint:function(){if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}var a=this._insertionPointView;if(a){a.removeFromParent().destroy()}this._insertionPointView=null},insertionIndexForLocation:function(g,k){var b={x:g.x,y:g.y,width:1,height:1},f=this.contentIndexesInRect(b),h=f.get("min"),i=this.get("length"),c,l,m,e,o,d,n,j,a;if(SC.none(h)||h<0){if((i===0)||(g.y<=this.rowOffsetForContentIndex(0))){h=0}else{if(g.y>=this.rowOffsetForContentIndex(i)){h=i}}}c=this.rowOffsetForContentIndex(h);l=c+this.rowHeightForContentIndex(h);if(k==SC.DROP_ON){if(this.get("isEditable")){m=Math.min(Math.floor((l-c)*0.2),5)}else{m=0}if(g.y>=(c+m)||g.y<=(l+m)){return[h,SC.DROP_ON]}}if(h>0){j=this.itemViewForContentIndex(h-1);n=(j?j.get("outlineIndent"):0)||0;d=j?j.get("outlineLevel"):0;if(h<i){j=this.itemViewForContentIndex(h);e=j?j.get("outlineLevel"):0;o=(j?j.get("outlineIndent"):0)||0;o*=e}else{e=j.get("isGroupView")?1:0;o=n*e}n*=d;if((e!==d)&&(o!==n)){if(n>o){h--;k=SC.DROP_AFTER}}}if(k===SC.DROP_BEFORE){j=(h<i)?this.itemViewForContentIndex(h):null;if(!j||j.get("isGroupView")){if(h>0){j=this.itemViewForContentIndex(h-1);if(!j.get("isGroupView")||(j.get("disclosureState")===SC.BRANCH_OPEN)){h=h-1;k=SC.DROP_AFTER}else{h=-1}}else{h=-1}}if(h<0){k=SC.DRAG_NONE}}return[h,k]},mouseWheel:function(a){var b=SC.InlineTextFieldView.editor;if(b&&b.get("isEditing")){if(b.get("delegate").get("displayDelegate")===this){SC.InlineTextFieldView.commitEditing()}}return NO},init:function(){arguments.callee.base.apply(this,arguments);this._sclv_rowDelegateDidChange()}});sc_require("views/list");SC.GridView=SC.ListView.extend({classNames:["sc-grid-view"],layout:{left:0,right:0,top:0,bottom:0},rowHeight:48,columnWidth:64,exampleView:SC.LabelView,insertionOrientation:SC.HORIZONTAL_ORIENTATION,itemsPerRow:function(){var b=this.get("frame"),a=this.get("columnWidth")||0;return(a<=0)?1:Math.floor(b.width/a)}.property("frame","columnWidth").cacheable(),contentIndexesInRect:function(e){var d=this.get("rowHeight")||48,b=this.get("itemsPerRow"),c=Math.floor(SC.minY(e)/d)*b,a=Math.ceil(SC.maxY(e)/d)*b;return SC.IndexSet.create(c,a-c)},layoutForContentIndex:function(g){var d=this.get("rowHeight")||48,a=this.get("frame").width,b=this.get("itemsPerRow"),e=Math.floor(a/b),f=Math.floor(g/b),c=g-(b*f);return{left:c*e,top:f*d,height:d,width:e}},computeLayout:function(){var e=this.get("content"),d=(e)?e.get("length"):0,c=this.get("rowHeight")||48,a=this.get("itemsPerRow"),f=Math.ceil(d/a);var b=this._cachedLayoutHash;if(!b){b=this._cachedLayoutHash={}}b.minHeight=f*c;this.calculatedHeight=b.minHeight;return b},insertionPointClass:SC.View.extend({classNames:["grid-insertion-point"],render:function(a,b){if(b){a.push('<span class="anchor"></span>')}}}),showInsertionPoint:function(c,e){if(!c){return}if(e&SC.DROP_ON){if(c!==this._lastDropOnView){this.hideInsertionPoint();c.set("isDropTarget",YES);this._lastDropOnView=c}}else{if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}if(!this._insertionPointView){this._insertionPointView=this.insertionPointClass.create()}var b=this._insertionPointView;var a=c.get("frame");var d={height:a.height-6,x:a.x,y:a.y+6,width:0};if(!SC.rectsEqual(b.get("frame"),d)){b.set("frame",d)}if(b.parentNode!==c.parentNode){c.parentNode.appendChild(b)}}},hideInsertionPoint:function(){if(this._lastDropOnView){this._lastDropOnView.set("isDropTarget",NO);this._lastDropOnView=null}var a=this._insertionPointView;if(a){a.removeFromParent().destroy()}this._insertionPointView=null},insertionIndexForLocation:function(d,j){var e=this.get("frame"),g=this.get("clippingFrame"),k=this.get("itemsPerRow"),a=Math.floor(e.width/k),m=Math.floor((d.y-e.y-g.y)/this.get("rowHeight"));var i=SC.DROP_BEFORE,c=(d.x-e.x-g.x),b=Math.floor(c/a),l=(c/a)-b;if(j===SC.DROP_ON){if(l>0.8){b++}if((l>=0.2)&&(l<=0.8)){i=SC.DROP_ON}}else{if(l>0.45){b++}}var h=(m*k)+b;return[h,i]},_gv_frameDidChange:function(){var e=this.get("frame"),c;c=e.width;if(this._lastFrameWidth&&c!==this._lastFrameWidth){this.notifyPropertyChange("itemsPerRow");var a,b,d=this.get("nowShowing");d.forEach(function(f){b=this.itemViewForContentIndex(f);b.adjust(this.layoutForContentIndex(f))},this)}this._lastFrameWidth=c}.observes("frame")});SC.ImageButtonView=SC.ButtonView.extend({classNames:["sc-image-button-view"],themeName:null,renderDelegateName:"imageButtonRenderDelegate",displayProperties:["image"],image:null});SC.ANCHOR_TOP={top:0};SC.ANCHOR_LEFT={left:0};SC.ANCHOR_TOP_LEFT={top:0,left:0};SC.ANCHOR_BOTTOM={bottom:0};SC.ANCHOR_RIGHT={right:0};SC.ANCHOR_BOTTOM_RIGHT={bottom:0,right:0};SC.ToolbarView=SC.View.extend({classNames:["sc-toolbar-view"],ariaRole:"toolbar",renderDelegateName:"toolbarRenderDelegate",anchorLocation:null,layout:{left:0,height:32,right:0},init:function(){if(this.anchorLocation){this.layout=SC.merge(this.layout,this.anchorLocation)}arguments.callee.base.apply(this,arguments)}});sc_require("views/toolbar");SC.WorkspaceView=SC.View.extend({classNames:["sc-workspace-view"],displayProperties:["hasTopToolbar","hasBottomToolbar"],renderDelegateName:"workspaceRenderDelegate",topToolbar:SC.ToolbarView.extend(),bottomToolbar:null,contentView:SC.View.extend(),autoResizeToolbars:NO,defaultToolbarSize:44,largeToolbarSize:44,smallToolbarSize:30,toolbarSize:function(){if(!this.get("autoResizeToolbars")){return this.get("defaultToolbarSize")}if(this.get("orientation")===SC.HORIZONTAL_ORIENTATION){return this.get("smallToolbarSize")}return this.get("largeToolbarSize")}.property("autoHideMaster","orientation"),orientation:function(){var a=this.get("frame");if(a.width>a.height){return SC.HORIZONTAL_ORIENTATION}else{return SC.VERTICAL_ORIENTATION}}.property("frame").cacheable(),masterIsHidden:NO,masterIsHiddenDidChange:function(){var a,b=this.get("masterIsHidden");if(a=this.get("topToolbar")){a.set("masterIsHidden",b)}if(a=this.get("bottomToolbar")){a.set("masterIsHidden",b)}}.observes("masterIsHidden"),_scmd_tilePropertyDidChange:function(){this.invokeOnce("_scws_tile")}.observes("toolbarSize"),createChildViews:function(){arguments.callee.base.apply(this,arguments);var a=this.get("topToolbar");if(a){a=this.topToolbar=this.activeTopToolbar=this.createChildView(a);this.appendChild(a)}var c=this.get("bottomToolbar");if(c){c=this.bottomToolbar=this.activeBottomToolbar=this.createChildView(c);this.appendChild(c)}var b=this.get("contentView");b=this.contentView=this.activeContentView=this.createChildView(b);this.appendChild(b);this.invokeOnce("_scws_tile")},_scws_tile:function(){var b=0,e=0,a=this.get("topToolbar"),f=this.get("bottomToolbar"),d=this.get("contentView"),c=this.get("toolbarSize");if(a){a.set("layout",{left:0,right:0,top:0,height:c});b+=c}if(f){f.set("layout",{left:0,right:0,bottom:0,height:c});e+=c}this.contentView.set("layout",{left:0,right:0,top:b,bottom:e})},hasTopToolbar:function(){if(this.get("topToolbar")){return YES}return NO}.property("topToolbar").cacheable(),hasBottomToolbar:function(){if(this.get("bottomToolbar")){return YES}return NO}.property("bottomToolbar").cacheable(),childDidChange:function(){this._scws_tile()},activeTopToolbar:null,activeBottomToolbar:null,activeContentView:null,topToolbarDidChange:function(){var b=this.activeTopToolbar,a=this.get("topToolbar");if(b){this.removeChild(b)}if(a){this.appendChild(a)}this.activeTopToolbar=a;this.invokeLast("childDidChange")}.observes("topToolbar"),bottomToolbarDidChange:function(){var b=this.activeBottomToolbar,a=this.get("bottomToolbar");if(b){this.removeChild(b)}if(a){this.appendChild(a)}this.activeBottomToolbar=a;this.invokeLast("childDidChange")}.observes("bottomToolbar"),contentViewDidChange:function(){var b=this.activeContentView,a=this.get("contentView");if(b){this.removeChild(b)}if(a){this.appendChild(a)}this.activeContentView=a;this.invokeLast("childDidChange")}.observes("contentView")});sc_require("views/workspace");sc_require("views/toolbar");SC.MasterDetailView=SC.View.extend({classNames:["sc-master-detail-view"],renderDelegateName:"masterDetailRenderDelegate",masterView:SC.WorkspaceView.extend({topToolbar:SC.ToolbarView.extend({}),contentView:SC.View.extend({backgroundColor:"white"})}),detailView:SC.WorkspaceView.extend({topToolbar:SC.ToolbarView.extend({childViews:["showHidePicker"],showHidePicker:SC.ButtonView.extend({layout:{left:7,centerY:0,height:30,width:100},controlSize:SC.AUTO_CONTROL_SIZE,title:"Picker",action:"toggleMasterPicker",isVisible:NO,isVisibleBinding:".parentView.masterIsHidden"})})}),autoHideMaster:function(){if(SC.platform.touch){return YES}return NO}.property().cacheable(),masterWidth:250,dividerWidth:SC.propertyFromRenderDelegate("dividerWidth",1),masterIsHidden:function(){if(!this.get("autoHideMaster")){return NO}if(this.get("orientation")===SC.HORIZONTAL_ORIENTATION){return NO}return YES}.property("autoHideMaster","orientation"),orientation:SC.VERTICAL_ORIENTATION,_scmd_frameDidChange:function(){var b=this.get("frame"),a;if(b.width>b.height){a=SC.HORIZONTAL_ORIENTATION}else{a=SC.VERTICAL_ORIENTATION}this.setIfChanged("orientation",a)}.observes("frame"),init:function(){arguments.callee.base.apply(this,arguments);this._scmd_frameDidChange();this._scmd_masterIsHiddenDidChange()},toggleMasterPicker:function(a){if(!this.get("masterIsHidden")){return}if(this._picker&&this._picker.get("isVisibleInWindow")){this.hideMasterPicker()}else{this.showMasterPicker(a)}},showMasterPicker:function(b){if(this._picker&&this._picker.get("isVisibleInWindow")){return}if(!this._picker){var a=this.get("pickerPane");this._picker=a.create({})}this._picker.set("contentView",this.get("masterView"));this._picker.set("extraRightOffset",this.get("pointerDistanceFromEdge"));this.showPicker(this._picker,b)},hideMasterPicker:function(){if(this._picker&&this._picker.get("isVisibleInWindow")){this.hidePicker(this._picker)}},showPicker:function(b,a){b.popup(a,SC.PICKER_POINTER,[3,0,1,2,3],[9,-9,-18,18])},hidePicker:function(a){a.remove()},pickerPane:SC.PickerPane.extend({layout:{width:250,height:480},themeName:"popover"}),_picker:null,pointerDistanceFromEdge:46,_scmd_masterIsHiddenDidChange:function(){var a=this.get("masterIsHidden");this.get("masterView").set("masterIsHidden",a);this.get("detailView").set("masterIsHidden",a)}.observes("masterIsHidden"),_scmd_orientationDidChange:function(){this.invokeOnce("_scmd_tile")}.observes("orientation"),_scmd_retileProperties:function(){this.invokeOnce("_scmd_tile")}.observes("masterIsHidden","masterWidth"),createChildViews:function(){var b=this.get("masterView");b=this.masterView=this.createChildView(b);var a=this.get("detailView");a=this.detailView=this.createChildView(a);this.appendChild(a);this.invokeOnce("_scmd_tile")},_masterIsDrawn:NO,_scmd_tile:function(){var b=!this.get("masterIsHidden");var e=this.get("masterWidth"),d=this.get("masterView"),c=this.get("detailView");if(b){this.hideMasterPicker();if(!this._masterIsDrawn){if(this._picker){this._picker.set("contentView",null)}this.appendChild(d);this._masterIsDrawn=YES}d.set("layout",{left:0,top:0,bottom:0,width:e});var a=this.get("dividerWidth");c.set("layout",{left:e+a,right:0,top:0,bottom:0})}else{if(this._masterIsDrawn){this.removeChild(d);this._masterIsDrawn=NO}c.set("layout",{left:0,right:0,top:0,bottom:0})}}});SC.ScrollerView=SC.View.extend({classNames:["sc-scroller-view"],displayProperties:["thumbPosition","thumbLength","isEnabled","controlsHidden"],ariaRole:"scrollbar",shouldScrollToClick:NO,_touchScrollValue:NO,value:function(a,c){var b=this.get("minimum");if(c!==undefined){this._scs_value=c}c=this._scs_value||b;return Math.max(Math.min(c,this.get("maximum")),b)}.property("maximum","minimum").cacheable(),displayValue:function(){var a;if(this.get("_touchScrollValue")){a=this.get("_touchScrollValue")}else{a=this.get("value")}return a}.property("value","_touchScrollValue").cacheable(),proportion:0,maximum:100,minimum:0,isEnabled:function(a,b){if(b!==undefined){this._scsv_isEnabled=b}if(this._scsv_isEnabled!==undefined){return this._scsv_isEnabled}return this.get("proportion")<1}.property("proportion").cacheable(),_scsv_isEnabled:undefined,layoutDirection:SC.LAYOUT_VERTICAL,hasButtons:YES,scrollbarThickness:14,capLength:18,capOverlap:14,buttonLength:41,buttonOverlap:11,minimumThumbLength:20,render:function(c,a){var i="vertical",b={},k="",p=this.get("parentView"),h=this.get("layoutDirection"),e,m,g,f,n,l,j,d,o;switch(h){case SC.LAYOUT_VERTICAL:b["sc-vertical"]=YES;break;case SC.LAYOUT_HORIZONTAL:b["sc-horizontal"]=YES;i="horizontal";break}b.disabled=!this.get("isEnabled");b["controls-hidden"]=this.get("controlsHidden");c.setClass(b);m=this.get("thumbLength");e=this.get("thumbPosition");if(a){c.push('<div class="track"></div>','<div class="cap"></div>');this.renderButtons(c,this.get("hasButtons"));this.renderThumb(c,h,m,e);c.attr("aria-orientation",i);c.attr("aria-valuemax",this.get("maximum"));c.attr("aria-valuemin",this.get("minimum"));c.attr("aria-valuenow",this.get("value"));c.attr("aria-controls",p.getPath("contentView.layerId"))}else{if(this.get("controlsHidden")){return}f=this.$(".thumb");this.adjustThumb(f,e,m);c.attr("aria-valuenow",this.get("value"))}},renderThumb:function(d,e,b,c){var a;if(e===SC.LAYOUT_HORIZONTAL){a="width: "+b+"px; left: "+c+"px;"}else{a="height: "+b+"px; top: "+c+"px;"}d.push('<div class="thumb" style="%@">'.fmt(a),'<div class="thumb-center"></div>','<div class="thumb-top"></div>','<div class="thumb-bottom"></div></div>')},renderButtons:function(b,a){if(a){b.push('<div class="button-bottom"></div><div class="button-top"></div>')}else{b.push('<div class="endcap"></div>')}},touchScrollDidStart:function(a){this.set("_touchScrollValue",a)},touchScrollDidEnd:function(a){this.set("_touchScrollValue",NO)},touchScrollDidChange:function(a){this.set("_touchScrollValue",a)},adjustThumb:function(b,a,c){this.adjustThumbPosition(b,a);this.adjustThumbSize(b,c)},adjustThumbPosition:function(b,a){if(this._thumbPosition===a){return}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:b.css("top",a);break;case SC.LAYOUT_HORIZONTAL:b.css("left",a);break}this._thumbPosition=a},adjustThumbSize:function(a,b){if(this._thumbSize===b){return}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:a.css("height",Math.max(b,this.get("minimumThumbLength")));break;case SC.LAYOUT_HORIZONTAL:a.css("width",Math.max(b,this.get("minimumThumbLength")));break}this._thumbSize=b},trackLength:function(){var a=this.get("scrollerLength");a-=this.capLength-this.capOverlap;a-=this.buttonLength-this.buttonOverlap;return a}.property("scrollerLength").cacheable(),scrollerLength:function(){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:return this.get("frame").height;case SC.LAYOUT_HORIZONTAL:return this.get("frame").width}return 0}.property("frame").cacheable(),thumbLength:function(){var a;a=Math.floor(this.get("trackLength")*this.get("proportion"));a=isNaN(a)?0:a;return Math.max(a,this.get("minimumThumbLength"))}.property("trackLength","proportion").cacheable(),thumbPosition:function(){var g=this.get("displayValue"),c=this.get("maximum"),b=this.get("trackLength"),d=this.get("thumbLength"),f=this.get("capLength"),e=this.get("capOverlap"),a;a=(g/c)*(b-d);a+=f-e;return Math.floor(isNaN(a)?0:a)}.property("displayValue","maximum","trackLength","thumbLength").cacheable(),controlsHidden:function(){return this.get("proportion")>=1}.property("proportion").cacheable(),valueForPosition:function(g){var b=this.get("maximum"),a=this.get("trackLength"),c=this.get("thumbLength"),f=this.get("capLength"),d=this.get("capOverlap"),e;e=g-(f-d);e=e/(a-c);e=e*b;return e},mouseDown:function(j){if(!this.get("isEnabled")){return NO}this._altIsDown=j.altKey;this._shiftIsDown=j.shiftKey;var e=j.target,c=this.get("thumbPosition"),i,d,g,f=this.get("scrollerLength");if(e.className.indexOf("thumb")>=0){d=this.convertFrameFromView({x:j.pageX,y:j.pageY});d.x-=c;d.y-=c;this._thumbDragging=YES;this._thumbOffset=d;this._mouseDownLocation={x:j.pageX,y:j.pageY};this._thumbPositionAtDragStart=this.get("thumbPosition");this._valueAtDragStart=this.get("value")}else{if(e.className.indexOf("button-top")>=0){this.decrementProperty("value",(this._altIsDown?f:30));this.makeButtonActive(".button-top");this.startMouseDownTimer("scrollUp");this._isScrollingUp=YES}else{if(e.className.indexOf("button-bottom")>=0){this.incrementProperty("value",(this._altIsDown?f:30));this.makeButtonActive(".button-bottom");this.startMouseDownTimer("scrollDown");this._isScrollingDown=YES}else{var l=this.get("shouldScrollToClick");if(j.altKey){l=!l}var a=this.get("trackLength"),h=this.get("thumbLength"),b=this.convertFrameFromView({x:j.pageX,y:j.pageY}),k;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:this._mouseDownLocation=k=b.y;break;case SC.LAYOUT_HORIZONTAL:this._mouseDownLocation=k=b.x;break}if(l){this.set("value",this.valueForPosition(k-(h/2)));c=this.get("thumbPosition");this._thumbDragging=YES;this._thumbOffset={x:b.x-c,y:b.y-c};this._mouseDownLocation={x:j.pageX,y:j.pageY};this._thumbPositionAtDragStart=c;this._valueAtDragStart=this.get("value")}else{if(k<c){this.decrementProperty("value",f);this.startMouseDownTimer("page")}else{this.incrementProperty("value",f);this.startMouseDownTimer("page")}}}}}return YES},mouseUp:function(a){var c=this._scs_buttonActive,b=NO,d;if(c){c.removeClass("active");b=YES}d=this._mouseDownTimer;if(d){d.invalidate();this._mouseDownTimer=null}this._thumbDragging=NO;this._isScrollingDown=NO;this._isScrollingUp=NO;return b},mouseDragged:function(m){var k,b,l,c,i=m.target,e=this._thumbPositionAtDragStart,g=this._isScrollingUp,o=this._isScrollingDown,d=this._scs_buttonActive,a;if(this._thumbDragging){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:l=(m.pageY-this._mouseDownLocation.y);break;case SC.LAYOUT_HORIZONTAL:l=(m.pageX-this._mouseDownLocation.x);break}if(m.altKey){if(!this._altIsDown||(this._shiftIsDown!==m.shiftKey)){e=this._thumbPositionAtDragStart=e+l;l=0;this._mouseDownLocation={x:m.pageX,y:m.pageY};this._valueAtDragStart=this.get("value")}if(m.shiftKey){l=-l}this.set("value",Math.round(this._valueAtDragStart+l*2))}else{c=e+l;b=this.get("trackLength")-this.get("thumbLength");this.set("value",Math.round((c/b)*this.get("maximum")))}}else{if(g||o){var n=NO,f=NO;var j=this.$(".button-top")[0].getBoundingClientRect();var h=this.$(".button-bottom")[0].getBoundingClientRect();switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:if(m.clientY<j.bottom){n=YES}else{f=YES}break;case SC.LAYOUT_HORIZONTAL:if(m.clientX<j.right){n=YES}else{f=YES}break}if((n||f)&&n!==g){if(d){d.removeClass("active")}this._mouseDownTimerAction=n?"scrollUp":"scrollDown";if(n){this.makeButtonActive(".button-top")}else{if(f){this.makeButtonActive(".button-bottom")}}this._isScrollingUp=n;this._isScrollingDown=f}}}this._altIsDown=m.altKey;this._shiftIsDown=m.shiftKey;return YES},startMouseDownTimer:function(b,a){var c;this._mouseDownTimerAction=b;this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:a?0:300})},mouseDownTimerDidFire:function(){var d=this.get("scrollerLength"),a=SC.device.get("mouseLocation"),c=this.get("thumbPosition"),b=this.get("thumbLength"),e=50;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:a=this.convertFrameFromView(a).y;break;case SC.LAYOUT_HORIZONTAL:a=this.convertFrameFromView(a).x;break}switch(this._mouseDownTimerAction){case"scrollDown":this.incrementProperty("value",this._altIsDown?d:30);break;case"scrollUp":this.decrementProperty("value",this._altIsDown?d:30);break;case"page":e=150;if(a<c){this.decrementProperty("value",d)}else{if(a>c+b){this.incrementProperty("value",d)}}}this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:e})},makeButtonActive:function(a){this._scs_buttonActive=this.$(a).addClass("active")}});SC.TouchScrollerView=SC.ScrollerView.extend({classNames:["sc-touch-scroller-view"],scrollbarThickness:12,capLength:5,capOverlap:0,hasButtons:NO,buttonOverlap:36,adjustThumb:function(d,b,f){var c=this.$(".thumb-inner");var a=this.get("scrollerLength")-this.capLength,e=this.get("minimum")+this.capLength;if(b+f>a){b=Math.min(a-20,b);f=a-b}if(b<e){f-=e-b;b=e}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:if(this._thumbPosition!==b){d.css("-webkit-transform","translate3d(0px,"+b+"px,0px)")}if(this._thumbSize!==f){c.css("-webkit-transform","translate3d(0px,"+Math.round(f-1044)+"px,0px)")}break;case SC.LAYOUT_HORIZONTAL:if(this._thumbPosition!==b){d.css("-webkit-transform","translate3d("+b+"px,0px,0px)")}if(this._thumbSize!==f){c.css("-webkit-transform","translate3d("+Math.round(f-1044)+"px,0px,0px)")}break}this._thumbPosition=b;this._thumbSize=f},render:function(c,a){var b=[],e,j,g,f,k,i,h,d,l;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:b.push("sc-vertical");break;case SC.LAYOUT_HORIZONTAL:b.push("sc-horizontal");break}if(!this.get("isEnabled")){b.push("disabled")}if(this.get("controlsHidden")){b.push("controls-hidden")}c.addClass(b);j=this.get("thumbLength");e=this.get("thumbPosition");if(a){c.push('<div class="track"></div><div class="cap"></div>');this.renderButtons(c,this.get("hasButtons"));this.renderThumb(c,this.get("layoutDirection"),j)}else{if(this.get("controlsHidden")){return}f=this.$(".thumb");this.adjustThumb(f,e,j)}},renderThumb:function(b,c,a){a-=1044;c=(c===SC.LAYOUT_HORIZONTAL?"X":"Y");b.push('<div class="thumb"><div class="thumb-top"></div><div class="thumb-clip">'+'<div class="thumb-inner" style="-webkit-transform: translate%@(%@px);">'.fmt(c,a)+'<div class="thumb-center"></div><div class="thumb-bottom"></div></div></div></div>')}});sc_require("views/scroller");SC.NORMAL_SCROLL_DECELERATION=0.95;SC.FAST_SCROLL_DECELERATION=0.85;SC.ScrollView=SC.View.extend({classNames:["sc-scroll-view"],isScrollable:YES,contentView:null,horizontalAlign:SC.ALIGN_LEFT,verticalAlign:SC.ALIGN_TOP,horizontalScrollOffset:function(b,d){if(d!==undefined){var c=this.minimumHorizontalScrollOffset(),a=this.get("maximumHorizontalScrollOffset");this._scroll_horizontalScrollOffset=Math.max(c,Math.min(a,d))}return this._scroll_horizontalScrollOffset||0}.property().cacheable(),verticalScrollOffset:function(b,d){if(d!==undefined){var c=this.get("minimumVerticalScrollOffset"),a=this.get("maximumVerticalScrollOffset");this._scroll_verticalScrollOffset=Math.max(c,Math.min(a,d))}return this._scroll_verticalScrollOffset||0}.property().cacheable(),maximumScrollOffset:function(b,a,c){if(b>=a){return b-a}if(c===SC.ALIGN_LEFT||c===SC.ALIGN_TOP){return 0}else{if(c===SC.ALIGN_MIDDLE||c===SC.ALIGN_CENTER){return 0-Math.round((a-b)/2)}else{return 0-(a-b)}}},minimumScrollOffset:function(b,a,c){if(b>a){return 0}if(c===SC.ALIGN_LEFT||c===SC.ALIGN_TOP){return 0}else{if(c===SC.ALIGN_MIDDLE||c===SC.ALIGN_CENTER){return 0-Math.round((a-b)/2)}else{return 0-(a-b)}}},maximumHorizontalScrollOffset:function(){var c=this.get("contentView");var b=c?c.get("frame").width:0,a=c?c.get("calculatedWidth"):0;if(a){b=c.calculatedWidth}b*=this._scale;var d=this.get("containerView").get("frame").width;if(!this.get("canScrollHorizontal")){b=Math.min(b,d)}return this.maximumScrollOffset(b,d,this.get("horizontalAlign"))}.property(),maximumVerticalScrollOffset:function(){var a=this.get("contentView"),c=(a&&a.get("frame"))?a.get("frame").height:0,b=a?a.get("calculatedHeight"):0;if(b){c=b}c*=this._scale;var d=this.get("containerView").get("frame").height;if(!this.get("canScrollVertical")){c=Math.min(c,d)}return this.maximumScrollOffset(c,d,this.get("verticalAlign"))}.property(),minimumHorizontalScrollOffset:function(){var c=this.get("contentView");var b=c?c.get("frame").width:0,a=c?c.get("calculatedWidth"):0;if(a){b=a}b*=this._scale;var d=this.get("containerView").get("frame").width;if(!this.get("canScrollHorizontal")){b=Math.min(b,d)}return this.minimumScrollOffset(b,d,this.get("horizontalAlign"))}.property(),minimumVerticalScrollOffset:function(){var a=this.get("contentView");var c=(a&&a.get("frame"))?a.get("frame").height:0,b=a?a.get("calculatedHeight"):0;if(b){c=a.calculatedHeight}c*=this._scale;var d=this.get("containerView").get("frame").height;if(!this.get("canScrollVertical")){c=Math.min(c,d)}return this.minimumScrollOffset(c,d,this.get("verticalAlign"))}.property(),verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("frame").height}.property("frame"),horizontalPageScroll:function(){return this.get("frame").width}.property("frame"),hasHorizontalScroller:YES,horizontalScrollerView:SC.ScrollerView,horizontalTouchScrollerView:SC.TouchScrollerView,isHorizontalScrollerVisible:YES,canScrollHorizontal:function(){return !!(this.get("hasHorizontalScroller")&&this.get("horizontalScrollerView")&&this.get("isHorizontalScrollerVisible"))}.property("isHorizontalScrollerVisible").cacheable(),autohidesHorizontalScroller:YES,hasVerticalScroller:YES,verticalScrollerView:SC.ScrollerView,verticalTouchScrollerView:SC.TouchScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:function(){return !!(this.get("hasVerticalScroller")&&this.get("verticalScrollerView")&&this.get("isVerticalScrollerVisible"))}.property("isVerticalScrollerVisible").cacheable(),autohidesVerticalScroller:YES,verticalScrollerBottom:0,verticalOverlay:function(){if(SC.platform.touch){return YES}return NO}.property().cacheable(),horizontalOverlay:function(){if(SC.platform.touch){return YES}return NO}.property().cacheable(),verticalScrollerLayout:null,horizontalScrollerLayout:null,containerView:SC.ContainerView.extend({}),scrollTo:function(a,b){if(b===undefined&&SC.typeOf(a)===SC.T_HASH){b=a.y;a=a.x}if(!SC.none(a)){this.set("horizontalScrollOffset",a)}if(!SC.none(b)){this.set("verticalScrollOffset",b)}return this},scrollBy:function(a,b){if(b===undefined&&SC.typeOf(a)===SC.T_HASH){b=a.y;a=a.x}a=(a)?this.get("horizontalScrollOffset")+a:null;b=(b)?this.get("verticalScrollOffset")+b:null;return this.scrollTo(a,b)},scrollToVisible:function(b){if(arguments.length===0){return arguments.callee.base.apply(this,arguments)}var c=this.get("contentView");if(!c){return NO}var a=b.get("frame");if(!a){return NO}a=c.convertFrameFromView(a,b.get("parentView"));return this.scrollToRect(a)},scrollToRect:function(b){var a=SC.cloneRect(this.get("containerView").get("frame"));a.x=this.get("horizontalScrollOffset");a.y=this.get("verticalScrollOffset");var d=a.x,c=a.y;a.y-=Math.max(0,SC.minY(a)-SC.minY(b));a.x-=Math.max(0,SC.minX(a)-SC.minX(b));a.y+=Math.max(0,SC.maxY(b)-SC.maxY(a));a.x+=Math.max(0,SC.maxX(b)-SC.maxX(a));if((d!==a.x)||(c!==a.y)){this.scrollTo(a.x,a.y);return YES}else{return NO}},scrollDownLine:function(a){if(a===undefined){a=1}return this.scrollBy(null,this.get("verticalLineScroll")*a)},scrollUpLine:function(a){if(a===undefined){a=1}return this.scrollBy(null,0-this.get("verticalLineScroll")*a)},scrollRightLine:function(a){if(a===undefined){a=1}return this.scrollTo(this.get("horizontalLineScroll")*a,null)},scrollLeftLine:function(a){if(a===undefined){a=1}return this.scrollTo(0-this.get("horizontalLineScroll")*a,null)},scrollDownPage:function(a){if(a===undefined){a=1}return this.scrollBy(null,this.get("verticalPageScroll")*a)},scrollUpPage:function(a){if(a===undefined){a=1}return this.scrollBy(null,0-(this.get("verticalPageScroll")*a))},scrollRightPage:function(a){if(a===undefined){a=1}return this.scrollBy(this.get("horizontalPageScroll")*a,null)},scrollLeftPage:function(a){if(a===undefined){a=1}return this.scrollBy(0-(this.get("horizontalPageScroll")*a),null)},tile:function(){var c=this.get("hasHorizontalScroller")?this.get("horizontalScrollerView"):null;var h=c&&this.get("isHorizontalScrollerVisible");var j=this.get("hasVerticalScroller")?this.get("verticalScrollerView"):null;var f=j&&this.get("isVerticalScrollerVisible");var e=this.get("containerView");var m={left:0,top:0};var l,g,b,n,d,a;var i=((h)?c.get("scrollbarThickness"):0);var k=(f)?j.get("scrollbarThickness"):0;if(h){a=this.get("horizontalScrollerLayout");g={left:(a?a.left:0),bottom:(a?a.bottom:0),right:(a?a.right+k-1:k-1),height:i};c.set("layout",g);n=this.get("horizontalOverlay");m.bottom=n?0:(g.bottom+i)}else{m.bottom=0}if(c){c.set("isVisible",h)}if(f){i=i+this.get("verticalScrollerBottom");d=this.get("verticalScrollerLayout");g={top:(d?d.top:0),bottom:(d?d.bottom+i:i),right:(d?d.right:0),width:k};j.set("layout",g);b=this.get("verticalOverlay");m.right=b?0:(g.right+k)}else{m.right=0}if(j){j.set("isVisible",f)}e.adjust(m)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible"),_scroll_wheelDeltaX:0,_scroll_wheelDeltaY:0,mouseWheel:function(a){var c=this.get("horizontalScrollOffset"),f=this.get("maximumHorizontalScrollOffset"),e=this.get("maximumVerticalScrollOffset"),b=NO,d=this.get("verticalScrollOffset");b=((this.get("canScrollHorizontal")&&(a.wheelDeltaX<0&&c>0)||(a.wheelDeltaX>0&&c<f))||(this.get("canScrollVertical")&&(a.wheelDeltaY<0&&d>0)||(a.wheelDeltaY>0&&d<e)));if(b){this._scroll_wheelDeltaX+=a.wheelDeltaX;this._scroll_wheelDeltaY+=a.wheelDeltaY;this.invokeLater(this._scroll_mouseWheel,10)}return b},_scroll_mouseWheel:function(){this.scrollBy(this._scroll_wheelDeltaX,this._scroll_wheelDeltaY);if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY>0){this._scroll_wheelDeltaY=Math.floor(this._scroll_wheelDeltaY*0.95);this._scroll_wheelDeltaY=Math.max(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)}else{if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY<0){this._scroll_wheelDeltaY=Math.ceil(this._scroll_wheelDeltaY*0.95);this._scroll_wheelDeltaY=Math.min(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)}else{this._scroll_wheelDeltaY=0;this._scroll_wheelDeltaX=0}}},canScale:NO,_scale:1,scale:function(a,b){if(b!==undefined){this._scale=Math.min(Math.max(this.get("minimumScale"),b),this.get("maximumScale"))}return this._scale}.property().cacheable(),minimumScale:0.25,maximumScale:2,autoScaleRange:NO,_scale_css:"",updateScale:function(b){var a=this.get("contentView");if(!a){return}if(a.isScalable){this.get("contentView").applyScale(b);this._scale_css=""}else{this._scale_css="scale3d("+b+", "+b+", 1)"}},acceptsMultitouch:YES,decelerationRate:SC.NORMAL_SCROLL_DECELERATION,alwaysBounceHorizontal:NO,alwaysBounceVertical:YES,delaysContentTouches:YES,_touchScrollDidChange:function(){if(this.get("contentView").touchScrollDidChange){this.get("contentView").touchScrollDidChange(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset)}if(this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidChange){this.verticalScrollerView.touchScrollDidChange(this._scroll_verticalScrollOffset)}if(this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidChange){this.horizontalScrollerView.touchScrollDidChange(this._scroll_horizontalScrollOffset)}},_touchScrollDidStart:function(){if(this.get("contentView").touchScrollDidStart){this.get("contentView").touchScrollDidStart(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset)}if(this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidStart){this.verticalScrollerView.touchScrollDidStart(this._touch_verticalScrollOffset)}if(this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidStart){this.horizontalScrollerView.touchScrollDidStart(this._touch_horizontalScrollOffset)}},_touchScrollDidEnd:function(){if(this.get("contentView").touchScrollDidEnd){this.get("contentView").touchScrollDidEnd(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset)}if(this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidEnd){this.verticalScrollerView.touchScrollDidEnd(this._touch_verticalScrollOffset)}if(this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidEnd){this.horizontalScrollerView.touchScrollDidEnd(this._touch_horizontalScrollOffset)}},_applyCSSTransforms:function(b){var a="";this.updateScale(this._scale);a+="translate3d("+-this._scroll_horizontalScrollOffset+"px, "+-Math.round(this._scroll_verticalScrollOffset)+"px,0) ";a+=this._scale_css;if(b){var c=b.style;c.webkitTransform=a;c.webkitTransformOrigin="top left"}},captureTouch:function(a){return YES},touchGeneration:0,touchStart:function(b){var a=++this.touchGeneration;if(!this.tracking&&this.get("delaysContentTouches")){this.invokeLater(this.beginTouchesInContent,150,a)}else{if(!this.tracking){this.invokeLater(this.beginTouchesInContent,1,a)}}this.beginTouchTracking(b,YES);return YES},beginTouchesInContent:function(b){if(b!==this.touchGeneration){return}var c=this.touch,a;if(c&&this.tracking&&!this.dragging&&!c.touch.scrollHasEnded&&!c.touch.hasEnded){c.touch.captureTouch(this,YES);if(!c.touch.touchResponder){c.touch.makeTouchResponder(this)}else{if(c.needsScrollEnd){this._touchScrollDidEnd()}}}},beginTouchTracking:function(f,q){var p=f.averagedTouchesForView(this,q);var j=this._scroll_verticalScrollOffset||0,a=this._scroll_horizontalScrollOffset||0,l=a,k=j,e=NO,o=0,r=0,n,i;if(this.touch&&this.touch.timeout){clearTimeout(this.touch.timeout);this.touch.timeout=null;l=this.touch.startClipOffset.x;k=this.touch.startClipOffset.y;e=YES}i=this.get("contentView");if(i){n=i.get("frame");o=n.width;r=n.height}if(i.calculatedWidth&&i.calculatedWidth!==0){o=i.calculatedWidth}if(i.calculatedHeight&&i.calculatedHeight!==0){r=i.calculatedHeight}var g=this.get("containerView").get("frame"),h=g.width,m=g.height;var b=this.convertFrameToView(this.get("frame"),null),d=(a+(p.x-b.x))/this._scale,c=(j+(p.y-b.y))/this._scale;this.touch={startTime:f.timeStamp,notCalculated:YES,enableScrolling:{x:o*this._scale>h||this.get("alwaysBounceHorizontal"),y:r*this._scale>m||this.get("alwaysBounceVertical")},scrolling:{x:NO,y:NO},enableBouncing:SC.platform.bounceOnScroll,startClipOffset:{x:l,y:k},lastScrollOffset:{x:a,y:j},startTouchOffset:{x:p.x,y:p.y},scrollVelocity:{x:0,y:0},startTouchOffsetInContent:{x:d,y:c},containerSize:{width:h,height:m},contentSize:{width:o,height:r},startScale:this._scale,startDistance:p.d,canScale:this.get("canScale")&&SC.platform.pinchToZoom,minimumScale:this.get("minimumScale"),maximumScale:this.get("maximumScale"),globalFrame:b,layer:i.get("layer"),resistanceCoefficient:0.998,resistanceAsymptote:320,decelerationFromEdge:0.05,accelerationToEdge:0.1,scrollTolerance:{x:15,y:15},scaleTolerance:5,secondaryScrollTolerance:30,scrollLock:500,decelerationRate:this.get("decelerationRate"),lastEventTime:f.timeStamp,touch:(q?f:(this.touch?this.touch.touch:null)),needsScrollEnd:e};if(!this.tracking){this.tracking=YES;this.dragging=NO}},_adjustForEdgeResistance:function(f,d,b,c,a){var e;if(f<d){e=f-d}else{if(f>b){e=b-f}else{return f}}e=Math.pow(c,Math.abs(e))*a;if(f<d){e=e-a}else{e=-e+a}return Math.min(Math.max(d,f),b)+e},touchesDragged:function(a,c){var b=a.averagedTouchesForView(this);this.updateTouchScroll(b.x,b.y,b.d,a.timeStamp)},updateTouchScroll:function(k,j,e,h){var g=this.touch,a=k-g.globalFrame.x,m=j-g.globalFrame.y,v,n,w,o,C,A,c=g.scrolling,r=this.get("horizontalAlign"),l=this.get("verticalAlign");var d=((this._scroll_horizontalScrollOffset||0)+a)/this._scale,b=((this._scroll_verticalScrollOffset||0)+m)/this._scale;var z=d-g.startTouchOffsetInContent.x,y=b-g.startTouchOffsetInContent.y;var i=g.dragging;if(!c.x&&Math.abs(z)>g.scrollTolerance.x&&g.enableScrolling.x){i=YES;c.x=YES;g.scrollTolerance.y=g.secondaryScrollTolerance;g.startTouchOffset.x=k;z=0}if(!c.y&&Math.abs(y)>g.scrollTolerance.y&&g.enableScrolling.y){i=YES;c.y=YES;g.scrollTolerance.x=g.secondaryScrollTolerance;g.startTouchOffset.y=j;y=0}if(i&&!g.dragging){g.dragging=YES;this.dragging=YES;this._touchScrollDidStart()}if(!c.x&&!c.y&&!g.canScale){return}if(c.x&&!c.y){if(z>g.scrollLock&&!c.y){g.enableScrolling.y=NO}}if(c.y&&!c.x){if(y>g.scrollLock&&!c.x){g.enableScrolling.x=NO}}if(g.canScale){var q=g.startDistance,x=e-q;if(Math.abs(x)>g.scaleTolerance){c.y=YES;c.x=YES;var B=g.startScale*(e/Math.max(q,50));var s=this._adjustForEdgeResistance(B,g.minimumScale,g.maximumScale,g.resistanceCoefficient,g.resistanceAsymptote);this.dragging=YES;this._scale=s;var u=d*this._scale,t=b*this._scale}}C=this.minimumScrollOffset(g.contentSize.width*this._scale,g.containerSize.width,r);A=this.minimumScrollOffset(g.contentSize.height*this._scale,g.containerSize.height,l);o=this.maximumScrollOffset(g.contentSize.width*this._scale,g.containerSize.width,r);n=this.maximumScrollOffset(g.contentSize.height*this._scale,g.containerSize.height,l);w=g.startTouchOffsetInContent.x*this._scale-a;v=g.startTouchOffsetInContent.y*this._scale-m;if(g.enableBouncing){w=this._adjustForEdgeResistance(w,C,o,g.resistanceCoefficient,g.resistanceAsymptote);v=this._adjustForEdgeResistance(v,A,n,g.resistanceCoefficient,g.resistanceAsymptote)}else{w=Math.max(C,Math.min(o,w));v=Math.max(A,Math.min(n,v))}if(c.x){this._scroll_horizontalScrollOffset=w}if(c.y){this._scroll_verticalScrollOffset=v}this._applyCSSTransforms(g.layer);this._touchScrollDidChange();if(h-g.lastEventTime>=1||g.notCalculated){g.notCalculated=NO;var f=this._scroll_horizontalScrollOffset;var p=this._scroll_verticalScrollOffset;g.scrollVelocity.x=((f-g.lastScrollOffset.x)/Math.max(1,h-g.lastEventTime));g.scrollVelocity.y=((p-g.lastScrollOffset.y)/Math.max(1,h-g.lastEventTime));g.lastScrollOffset.x=f;g.lastScrollOffset.y=p;g.lastEventTime=h}},touchEnd:function(c){var a=this.touch,b=c.averagedTouchesForView(this);c.scrollHasEnded=YES;if(b.touchCount>0){this.beginTouchTracking(c,NO)}else{if(this.dragging){a.dragging=NO;a.lastEventTime=c.timeStamp;this.startDecelerationAnimation()}else{if(a.needsScrollEnd){this._touchScrollDidEnd()}c.captureTouch(this,YES);if(c.touchResponder&&c.touchResponder!==this){c.end()}else{if(!c.touchResponder||c.touchResponder===this){if(c.nextTouchResponder){c.makeTouchResponder(c.nextTouchResponder)}}else{}}this.touch=null}this.tracking=NO;this.dragging=NO}},touchCancelled:function(c){var a=this.touch,b=c.averagedTouchesForView(this);if(!this.touch||!this.touch.timeout){this.beginPropertyChanges();this.set("scale",this._scale);this.set("verticalScrollOffset",this._scroll_verticalScrollOffset);this.set("horizontalScrollOffset",this._scroll_horizontalScrollOffset);this.endPropertyChanges();this.tracking=NO;if(this.dragging){this._touchScrollDidEnd()}this.dragging=NO;this.touch=null}},startDecelerationAnimation:function(a){var b=this.touch;b.decelerationVelocity={x:b.scrollVelocity.x*10,y:b.scrollVelocity.y*10};this.decelerateAnimation()},bouncyBounce:function(c,e,d,f,g,b,a){if(e<d){if(c<0){c=c+((d-e)*g)}else{c=Math.min((d-e)*b+a,d-e-0.01)}}else{if(e>f){if(c>0){c=c-((e-f)*g)}else{c=-Math.min((e-f)*b+a,e-f-0.01)}}}return c},decelerateAnimation:function(){var c=this.touch,y=this._scale,n=c.contentSize,o=c.containerSize,m=this.get("horizontalAlign"),e=this.get("verticalAlign"),x=this.minimumScrollOffset(n.width*this._scale,o.width,m),w=this.minimumScrollOffset(n.height*this._scale,o.height,e),i=this.maximumScrollOffset(n.width*this._scale,o.width,m),h=this.maximumScrollOffset(n.height*this._scale,o.height,e),a=Date.now(),f=Math.max(a-c.lastEventTime,1),s=this._scroll_horizontalScrollOffset+c.decelerationVelocity.x*(f/10),q=this._scroll_verticalScrollOffset+c.decelerationVelocity.y*(f/10);var r=c.decelerationFromEdge,u=c.accelerationToEdge;var l=!c.enableBouncing,k=!c.enableBouncing;if(s>=x&&s<=i){l=YES}if(q>=w&&q<=h){k=YES}s/=this._scale;q/=this._scale;var j=0;j=this.bouncyBounce(j,y,c.minimumScale,c.maximumScale,r,u,0);this._scale=y=y+j;s*=this._scale;q*=this._scale;x=this.minimumScrollOffset(n.width*this._scale,o.width,m);w=this.minimumScrollOffset(n.height*this._scale,o.height,e);i=this.maximumScrollOffset(n.width*this._scale,o.width,m);h=this.maximumScrollOffset(n.height*this._scale,o.height,e);if(l&&(s<x||s>i)){s=Math.max(x,Math.min(s,i));c.decelerationVelocity.x=0}if(k&&(q<w||q>h)){q=Math.max(w,Math.min(q,h));c.decelerationVelocity.y=0}this._scroll_horizontalScrollOffset=s;this._scroll_verticalScrollOffset=q;this._applyCSSTransforms(c.layer);this._touchScrollDidChange();var v=c.decelerationRate,b=Math.pow(v,(f/10));c.decelerationVelocity.y*=b;c.decelerationVelocity.x*=b;c.decelerationVelocity.x=this.bouncyBounce(c.decelerationVelocity.x,s,x,i,r,u,0.3);c.decelerationVelocity.y=this.bouncyBounce(c.decelerationVelocity.y,q,w,h,r,u,0.3);var p=Math.abs(c.decelerationVelocity.x),d=Math.abs(c.decelerationVelocity.y);if(d<0.05&&p<0.05&&Math.abs(j)<0.05){c.timeout=null;this.touch=null;this._touchScrollDidEnd();this.beginPropertyChanges();this.set("scale",this._scale);this.set("verticalScrollOffset",this._scroll_verticalScrollOffset);this.set("horizontalScrollOffset",this._scroll_horizontalScrollOffset);this.endPropertyChanges();return}var g=this;c.lastEventTime=Date.now();this.touch.timeout=setTimeout(function(){SC.run(g.decelerateAnimation(),g)},30)},createChildViews:function(){var b=[],a;if(SC.none(a=this.containerView)){a=SC.ContainerView}b.push(this.containerView=this.createChildView(a,{contentView:this.contentView,isScrollContainer:YES}));this.contentView=this.containerView.get("contentView");a=SC.platform.touch?this.get("horizontalTouchScrollerView"):this.get("horizontalScrollerView");if(a){if(this.get("hasHorizontalScroller")){a=this.horizontalScrollerView=this.createChildView(a,{layoutDirection:SC.LAYOUT_HORIZONTAL,valueBinding:"*owner.horizontalScrollOffset"});b.push(a)}else{this.horizontalScrollerView=null}}a=SC.platform.touch?this.get("verticalTouchScrollerView"):this.get("verticalScrollerView");if(a){if(this.get("hasVerticalScroller")){a=this.verticalScrollerView=this.createChildView(a,{layoutDirection:SC.LAYOUT_VERTICAL,valueBinding:"*owner.verticalScrollOffset"});b.push(a)}else{this.verticalScrollerView=null}}this.childViews=b;this.contentViewDidChange();this.tile()},init:function(){arguments.callee.base.apply(this,arguments);this._scroll_contentView=this.get("contentView");var a=this._scroll_contentView;if(a){a.addObserver("frame",this,this.contentViewFrameDidChange);a.addObserver("calculatedWidth",this,this.contentViewFrameDidChange);a.addObserver("calculatedHeight",this,this.contentViewFrameDidChange)}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewDidChange:function(){var d=this.get("contentView"),a=this._scroll_contentView,b=this.contentViewFrameDidChange,c=this.contentViewLayerDidChange;if(d!==a){if(a){a.removeObserver("calculatedWidth",this,this.contentViewFrameDidChange);a.removeObserver("calculatedHeight",this,this.contentViewFrameDidChange);a.removeObserver("frame",this,b);a.removeObserver("layer",this,c)}this._scroll_contentView=d;if(d){d.addObserver("frame",this,b);d.addObserver("calculatedWidth",this,this.contentViewFrameDidChange);d.addObserver("calculatedHeight",this,this.contentViewFrameDidChange);d.addObserver("layer",this,c)}this.containerView.set("contentView",d);this.contentViewFrameDidChange()}}.observes("contentView"),render:function(a,b){this.invokeLast(this.adjustElementScroll);if(b){a.push('<div class="corner"></div>')}return arguments.callee.base.apply(this,arguments)},oldMaxHOffset:0,oldMaxVOffset:0,contentViewFrameDidChange:function(b){var o=this.get("contentView"),l=(o)?o.get("frame"):null,h=this._scale,c=0,q=0,j,i,m,r,n;if(!o||!l){return}c=o.get("calculatedWidth")||l.width||0;q=o.get("calculatedHeight")||l.height||0;c*=h;q*=h;if(!b&&(c===this._scroll_contentWidth)&&(q===this._scroll_contentHeight)){return}this._scroll_contentWidth=c;this._scroll_contentHeight=q;j=this.getPath("containerView.frame");i=j.width;m=j.height;if(this.get("hasHorizontalScroller")&&(o=this.get("horizontalScrollerView"))){if(this.get("autohidesHorizontalScroller")){this.set("isHorizontalScrollerVisible",c>i)}o.setIfChanged("maximum",c-i);o.setIfChanged("proportion",i/c)}if(this.get("hasVerticalScroller")&&(o=this.get("verticalScrollerView"))){if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",q>m)}o.setIfChanged("maximum",q-m);o.setIfChanged("proportion",m/q)}if(!this.get("isVerticalScrollerVisible")&&(this.get("verticalScrollOffset")!==0)&&this.get("autohidesVerticalScroller")){this.set("verticalScrollOffset",0)}if(!this.get("isHorizontalScrollerVisible")&&(this.get("horizontalScrollOffset")!==0)&&this.get("autohidesHorizontalScroller")){this.set("horizontalScrollOffset",0)}var p=this.get("maximumVerticalScrollOffset"),k=this.get("verticalScrollOffset"),g=this.get("maximumHorizontalScrollOffset"),a=this.get("horizontalScrollOffset"),e=p<k,d=g<a;if(e||d){this.forceDimensionsRecalculation(d,e,k,a)}this.notifyPropertyChange("maximumVerticalScrollOffset");this.notifyPropertyChange("maximumHorizontalScrollOffset")},frameDidChange:function(){this.contentViewFrameDidChange(YES)}.observes("frame"),contentViewLayerDidChange:function(){if(this._verticalScrollOffset!==0){this._verticalScrollOffset=-1}if(this._horizontalScrollOffset!==0){this._horizontalScrollOffset=-1}this.invokeLast(this.adjustElementScroll)},_scroll_horizontalScrollOffsetDidChange:function(){this._sc_view_clippingFrameDidChange();this.invokeLast(this.adjustElementScroll)}.observes("horizontalScrollOffset"),_scroll_verticalScrollOffsetDidChange:function(){this._sc_view_clippingFrameDidChange();this.invokeLast(this.adjustElementScroll)}.observes("verticalScrollOffset"),adjustElementScroll:function(){var a=this.get("containerView"),d=this.get("contentView"),c=this.get("verticalScrollOffset"),b=this.get("horizontalScrollOffset");if(d){if(SC.platform.touch){this._applyCSSTransforms(d.get("layer"))}if(d._viewFrameDidChange){d._viewFrameDidChange()}}if(a&&!SC.platform.touch){a=a.$()[0];if(a){if(c!==this._verticalScrollOffset){a.scrollTop=c;this._verticalScrollOffset=c}if(b!==this._horizontalScrollOffset){a.scrollLeft=b;this._horizontalScrollOffset=b}}}},forceDimensionsRecalculation:function(b,c,e,a){var f=a;var d=e;this.scrollTo(0,0);if(b&&c){this.scrollTo(this.get("maximumHorizontalScrollOffset"),this.get("maximumVerticalScrollOffset"))}if(b&&!c){this.scrollTo(this.get("maximumHorizontalScrollOffset"),d)}if(!b&&c){this.scrollTo(f,this.get("maximumVerticalScrollOffset"))}},_scroll_verticalScrollOffset:0,_scroll_horizontalScrollOffset:0});sc_require("views/scroll");SC.MenuScrollerView=SC.ScrollerView.extend({classNames:["sc-menu-scroller-view"],scrollDown:NO,value:function(a,c){if(c!==undefined){this._value=c}else{var b=this._value||0;return Math.min(b,this.get("maximum"))}}.property("maximum").cacheable(),maximum:0,isEnabled:YES,layoutDirection:SC.LAYOUT_VERTICAL,verticalLineScroll:20,ownerScrollValueKey:function(){return"verticalScrollOffset"}.property("layoutDirection").cacheable(),init:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.TINY_SCROLLER_THICKNESS);break;case SC.SMALL_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS);break;case SC.REGULAR_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS);break;case SC.LARGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS);break;case SC.HUGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS);break}return arguments.callee.base.apply(this,arguments)},render:function(a,c){a.addClass("sc-vertical");a.addClass(this.get("controlSize"));if(c){var b=this.get("scrollDown")?"arrowDown":"arrowUp";a.push('<span class="scrollArrow '+b+'">&nbsp;</span>')}a.setClass("disabled",!this.get("isEnabled"))},didCreateLayer:function(){},willDestroyLayer:function(){var a=this._sc_scroller_scrollDidChange;SC.Event.remove(this.$(),"scroll",this,a)},mouseEntered:function(a){this.set("isMouseOver",YES);this._invokeScrollOnMouseOver()},mouseExited:function(a){this.set("isMouseOver",NO)},_sc_scroller_valueDidChange:function(){}.observes("value"),_sc_scroller_armScrollTimer:function(){if(!this._sc_scrollTimer){SC.RunLoop.begin();var a=this._sc_scroller_scrollDidChange;this._sc_scrollTimer=this.invokeLater(a,50);SC.RunLoop.end()}},_sc_scroller_scrollDidChange:function(){var b=Date.now(),d=this._sc_lastScroll,c=this.get("layer"),a=0;if(d&&(b-d)<50){return this._sc_scroller_armScrollTimer()}this._sc_scrollTimer=null;this._sc_lastScroll=b;SC.RunLoop.begin();if(!this.get("isEnabled")){return}this._sc_scrollValue=a=c.scrollTop;this.set("value",a);SC.RunLoop.end()},_scrollMenu:function(){var b=this.get("value"),a;if(this.get("scrollDown")){a=b+this.verticalLineScroll;if(a<=this.get("maximum")){this.set("value",a)}}else{a=b-this.verticalLineScroll;if(a>=0){this.set("value",a)}else{if(b<=this.verticalLineScroll&&b>0){this.set("value",0)}}}return YES},_invokeScrollOnMouseOver:function(){this._scrollMenu();if(this.get("isMouseOver")){this.invokeLater(this._invokeScrollOnMouseOver,50)}}});SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS=18;SC.MenuScrollerView.TINY_SCROLLER_THICKNESS=10;SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS=14;SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS=23;SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS=26;SC.MenuScrollView=SC.ScrollView.extend({classNames:["sc-menu-scroll-view"],maximumHorizontalScrollOffset:0,hasHorizontalScroller:NO,horizontalScrollerView:SC.MenuScrollerView,isHorizontalScrollerVisible:NO,canScrollHorizontal:NO,autohidesHorizontalScroller:NO,hasVerticalScroller:YES,verticalScrollerView:SC.MenuScrollerView,verticalScrollerView2:SC.MenuScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:YES,autohidesVerticalScroller:YES,verticalScrollerBottom:0,controlSize:SC.REGULAR_CONTROL_SIZE,containerView:SC.ContainerView,scrollToVisible:function(b){if(arguments.length===0){return arguments.callee.base.apply(this,arguments)}var e=this.get("contentView");if(!e){return NO}var a=b.get("frame");if(!a){return NO}a=e.convertFrameFromView(a,b.get("parentView"));var c=this.get("verticalScrollerView2");if(c&&c.get("isVisible")){a.height+=c.get("frame").height}var d=this.get("verticalScrollerView");if(d&&d.get("isVisible")){a.top-=d.get("frame").height}return this.scrollToRect(a)},tile:function(){var g,s,h,b,q,i,c;g=this.get("hasVerticalScroller");s=g?this.get("verticalScrollerView"):null;h=g?this.get("verticalScrollerView2"):null;b=s&&this.get("isVerticalScrollerVisible");q=this.get("containerView");i={left:0,top:0};if(b){c=0;var a=s.get("scrollerThickness")||h.get("scrollerThickness");var j=this.get("contentView"),o,p=(j)?j.get("frame"):null,k=(p)?p.height:0,r=this.containerView.$()[0],l=this.get("verticalScrollOffset"),e={height:0,top:0,right:0,left:0},n={height:a,top:0,right:0,left:0},d={height:a,bottom:0,right:0,left:0},m={height:0,bottom:0,right:0,left:0};if(r){c=r.offsetHeight}if(l===0){i.top=0;i.bottom=a;s.set("layout",e);h.set("layout",d)}else{if(l>=(k-c-a)){i.top=a;i.bottom=0;s.set("layout",n);h.set("layout",m)}else{i.top=a;i.bottom=a;s.set("layout",n);h.set("layout",d)}}}if(s){s.set("isVisible",b);h.set("isVisible",b)}q.set("layout",i)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible","verticalScrollOffset"),createChildViews:function(){var c=[],b,a,d=this.get("controlSize");if(SC.none(b=this.containerView)){b=SC.ContainerView}c.push(this.containerView=this.createChildView(b,{contentView:this.contentView}));this.contentView=this.containerView.get("contentView");if((b=this.verticalScrollerView)&&(a=this.verticalScrollerView2)){if(this.get("hasVerticalScroller")){b=this.verticalScrollerView=this.createChildView(b,{layout:{top:0,left:0,right:0},controlSize:d,valueBinding:"*owner.verticalScrollOffset"});c.push(b);a=this.verticalScrollerView2=this.createChildView(a,{scrollDown:YES,layout:{bottom:0,left:0,right:0},controlSize:d,valueBinding:"*owner.verticalScrollOffset"});c.push(a)}else{this.verticalScrollerView=null;this.verticalScrollerView2=null}}this.childViews=c;this.contentViewFrameDidChange();this.tile()},init:function(){arguments.callee.base.apply(this,arguments);this._scroll_contentView=this.get("contentView");var a=this._scroll_contentView;if(a){a.addObserver("frame",this,this.contentViewFrameDidChange)}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewFrameDidChange:function(){var c=this.get("contentView"),b,h=(c)?c.get("frame"):null,e=(h)?h.width:0,a=(h)?h.height:0,i=this.get("frame"),d,g;this._scroll_contentWidth=e;this._scroll_contentHeight=a;if(this.get("hasVerticalScroller")&&(c=this.get("verticalScrollerView"))&&(b=this.get("verticalScrollerView2"))){a-=1;if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",a>i.height)}a-=this.get("verticalScrollerBottom");d=0;g=this.containerView.$()[0];if(g){d=g.offsetHeight}a=a-d;c.setIfChanged("maximum",a);b.setIfChanged("maximum",a)}},_scroll_horizontalScrollOffsetDidChange:function(){},_scroll_verticalScrollOffsetDidChange:function(){var b=this.get("verticalScrollOffset");var a=this.get("contentView");if(a){a.$().css("top",(0-b)+"px")}}.observes("verticalScrollOffset")});sc_require("views/workspace");SC.TO_LEFT="TOLEFT";SC.TO_RIGHT="TORIGHT";SC.NavigationView=SC.WorkspaceView.extend({_views:null,_current:null,navigationContentView:SC.View,init:function(){arguments.callee.base.apply(this,arguments);this._views=[]},createChildViews:function(){arguments.callee.base.apply(this,arguments);var a=this.get("navigationContentView");if(a.isClass){a=this.createChildView(a)}this._defaultContent=this.navigationContentView=a;this.contentView.appendChild(a)},changeNavigationContent:function(a){var c=null,b=null;if(a){c=a.get("topToolbar");b=a.get("bottomToolbar")}if(c&&c.isClass){a.set("topToolbar",c=c.create())}if(b&&b.isClass){a.set("bottomToolbar",b=b.create())}this.beginPropertyChanges();this._current=a;this.set("navigationContentView",a?a:this._defaultContent);this.set("topToolbar",c);this.set("bottomToolbar",b);this.endPropertyChanges()},push:function(a){this._currentDirection=this._current?SC.TO_LEFT:null;if(this._current){this._views.push(this._current)}this.changeNavigationContent(a)},pop:function(){this._currentDirection=SC.TO_RIGHT;var a=this._views.pop();this.changeNavigationContent(a)},popToView:function(b){this._currentDirection=SC.TO_RIGHT;var d=this._views,a=d.length-1,c=d[a];while(c&&c!==b){this._views.pop();a--;c=d[a]}this.changeNavigationContent(c)},topToolbarDidChange:function(){var b=this.activeTopToolbar,a=this.get("topToolbar");if(b){if(this._currentDirection!==null){b.set("buildDirection",this._currentDirection);this.buildOutChild(b)}else{this.removeChild(b)}}if(a){if(this._currentDirection!==null){a.set("buildDirection",this._currentDirection);this.buildInChild(a)}else{this.appendChild(a)}}this.activeTopToolbar=a;this.invokeOnce("childDidChange")}.observes("topToolbar"),bottomToolbarDidChange:function(){var b=this.activeBottomToolbar,a=this.get("bottomToolbar");if(b){if(this._currentDirection!==null){b.set("buildDirection",this._currentDirection);this.buildOutChild(b)}else{this.removeChild(b)}}if(a){if(this._currentDirection!==null){a.set("buildDirection",this._currentDirection);this.buildInChild(a)}else{this.appendChild(a)}}this.activeBottomToolbar=a;this.invokeOnce("childDidChange")}.observes("topToolbar"),contentViewDidChange:function(){var b=this.activeNavigationContentView,a=this.get("navigationContentView");if(!a.isNavigationBuilder){a.mixin(SC.NavigationBuilder)}this._pendingBuildOut=b;this._pendingBuildIn=a;this.activeNavigationContentView=a;this.invokeOnce("childDidChange")}.observes("navigationContentView"),childDidChange:function(){var a=this._pendingBuildIn,b=this._pendingBuildOut;if(b){if(this._currentDirection!==null){b.set("buildDirection",this._currentDirection);this.contentView.buildOutChild(b)}else{this.contentView.removeChild(b)}}this._scws_tile();if(a){if(this._currentDirection!==null){a.set("buildDirection",this._currentDirection);this.contentView.buildInChild(a)}else{this.contentView.appendChild(a)}}}});sc_require("views/toolbar");SC.NavigationBarView=SC.ToolbarView.extend(SC.Gesturable,{init:function(){arguments.callee.base.apply(this,arguments);if(!SC.Animatable){SC.Logger.error("NavigationBarView requires SC.Animatable. Please make your app or framework require the animation framework. CRASH.")}},mixinAnimatable:function(){this.mixin(SC.Animatable);this.transitions=this.navigationTransitions},navigationTransitions:{opacity:{duration:0.25,action:"didFinishTransition"}},style:{opacity:1},gestures:["swipeGesture"],swipeGesture:SC.SwipeGesture,swipe:function(d,h,f){var e=(f===SC.SWIPE_LEFT)?"isSwipeLeft":"isSwipeRight",c=this.get("childViews"),g,b,a=c.get("length");for(b=0;b<a;b++){g=c[b];if(g.get(e)){h.makeTouchResponder(g);h.end();return}}},resetBuild:function(){if(!this.isAnimatable){this.mixinAnimatable()}},didFinishTransition:function(){if(this.isBuildingIn){this.buildInDidFinish()}else{if(this.isBuildingOut){this.buildOutDidFinish()}}},preBuildIn:function(){this.disableAnimation();this.adjust("opacity",0).updateLayout();this.enableAnimation();var c=this.get("childViews"),d,b,a=c.get("length");for(b=0;b<a;b++){d=c[b];if(d.disableNavigationTransition){continue}if(!d._nv_mixedIn){this.mixinNavigationChild(d)}d.disableAnimation();d.transform(this.buildDirection===SC.TO_LEFT?100:-100);d.enableAnimation()}},buildIn:function(){this.preBuildIn();this.invokeLater("startBuildIn",10)},startBuildIn:function(){this.adjust("opacity",1);var c=this.get("childViews"),d,b,a=c.get("length");for(b=0;b<a;b++){d=c[b];if(d.disableNavigationTransition){continue}d.transform(0)}},buildOut:function(){this.adjust("opacity",0);var c=this.get("childViews"),d,b,a=c.get("length");for(b=0;b<a;b++){d=c[b];if(d.disableNavigationTransition){continue}if(!d._nv_mixedIn){this.mixinNavigationChild(d)}d.transform(this.buildDirection===SC.TO_LEFT?-100:100)}},mixinNavigationChild:function(a){if(a.isAnimatable){return}a.mixin(SC.Animatable);a.mixin({transitions:{transform:{timing:SC.Animatable.TRANSITION_EASE_IN_OUT,duration:0.25}},naturalLayout:a.get("layout"),transform:function(b){if(SC.platform.supportsCSS3DTransforms){this.adjust("transform","translate3d("+b+"px,0px,0px)")}else{this.adjust("transform","translate("+b+"px,0px)")}}});a._nv_mixedIn=YES}});sc_require("views/button");SC.PopupButtonView=SC.ButtonView.extend({classNames:["sc-popup-button"],renderDelegateName:"popupButtonRenderDelegate",preferMatrix:null,menu:null,shouldLoadInBackground:NO,init:function(){arguments.callee.base.apply(this,arguments);this._setupMenu();if(this.get("shouldLoadInBackground")){SC.backgroundTaskQueue.push(SC.PopupButtonMenuLoader.create({popupButton:this}))}},_setupMenu:function(){var a=this.get("instantiatedMenu");if(this.isActiveBinding){this.isActiveBinding.disconnect()}this.isActiveBinding=null;if(a&&!a.isClass){this.isActiveBinding=this.bind("isActive",a,"isVisibleInWindow")}},_popup_menuDidChange:function(){this._setupMenu()}.observes("menu"),isActive:NO,_instantiateMenu:function(){var a=this.get("menu");if(!a||!a.isClass){return}this.menu=a.create();this._setupMenu()},instantiatedMenu:function(){var a=this.get("menu");if(a&&a.isClass){this._instantiateMenu();a=this.get("menu")}return a}.property("menu").cacheable(),action:function(a){var b=this.get("instantiatedMenu");if(!b){return NO}b.popup(this,this.get("preferMatrix"));return YES},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this._isMouseDown=YES;this._action();this._menuRenderedTimestamp=0;var b=this;setTimeout(function(){SC.run(function(){b._menuRenderedTimestamp=Date.now()})},1);this.becomeFirstResponder();return YES},mouseUp:function(b){var d=new Date().getTime(),c=this._menuRenderedTimestamp,e=this.get("instantiatedMenu"),f=SC.platform.touch,a;if(c===0){c=Date.now()}if(e){a=e.getPath("rootMenu.targetMenuItem");if(a){if(!a.performAction()){e.remove()}}else{if(!f&&(d-c>SC.ButtonView.CLICK_AND_HOLD_DELAY)){e.remove()}}}this._isMouseDown=NO;arguments.callee.base.apply(this,arguments);return YES},mouseExited:function(a){return YES},performKeyEquivalent:function(b,a){if(!this.get("isEnabled")){return NO}var c=this.get("instantiatedMenu");return(!!c&&c.performKeyEquivalent(b,a,YES))}});SC.PopupButtonMenuLoader=SC.Task.extend({popupButton:null,run:function(){if(this.popupButton){this.popupButton._instantiateMenu()}}});SC.ProgressView=SC.View.extend(SC.Control,{classNames:["sc-progress-view"],displayProperties:["displayValue","ariaValue","minimum","maximum","isEnabled","isIndeterminate","isRunning","isVisibleInWindow"],renderDelegateName:"progressRenderDelegate",value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),displayValue:function(){var b=this.get("minimum")||0,c=this.get("maximum")||1,a=this.get("value")||0;a=(a-b)/(c-b);if(a>1){a=1}if(isNaN(a)){a=0}if(a<b){a=0}if(a>c){a=1}return a}.property("value","maximum","minimum").cacheable(),ariaRole:"progressbar",ariaValue:function(){return this.get("value")}.property("value").cacheable(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),contentMaximumKey:null,isIndeterminate:NO,isIndeterminateBindingDefault:SC.Binding.bool(),isRunning:NO,isRunningBindingDefault:SC.Binding.bool(),contentIsIndeterminateKey:null,contentPropertyDidChange:function(c,a){var b=this.get("content");this.beginPropertyChanges().updatePropertyFromContent("value",a,"contentValueKey",b).updatePropertyFromContent("minimum",a,"contentMinimumKey",b).updatePropertyFromContent("maximum",a,"contentMaximumKey",b).updatePropertyFromContent("isIndeterminate",a,"contentIsIndeterminateKey",b).endPropertyChanges()},didCreateLayer:function(){if(this.get("isIndeterminate")&&this.get("isRunning")&&this.get("isVisibleInWindow")){this.displayDidChange()}}});SC.RadioView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),classNames:["sc-radio-view"],ariaRole:"radiogroup",displayProperties:["displayItems","isEnabled","layoutDirection"],renderDelegateName:"radioGroupRenderDelegate",itemAriaLabeledByKey:null,itemAriaLabelKey:null,value:null,layoutDirection:SC.LAYOUT_VERTICAL,escapeHTML:YES,items:[],itemTitleKey:null,itemWidthKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemsDidChange:function(){if(this._items){this._items.removeObserver("[]",this,this.itemContentDidChange)}this._items=this.get("items");if(this._items){this._items.addObserver("[]",this,this.itemContentDidChange)}this.itemContentDidChange()}.observes("items"),itemContentDidChange:function(){this._renderAsFirstTime=YES;this.notifyPropertyChange("displayItems")},displayItems:function(){var k=this.get("items"),p=this.get("value"),h=SC.isArray(p),f=this.get("localize"),d=this.get("itemTitleKey"),e=this.get("itemValueKey"),o=this.get("itemWidthKey"),c=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL,j=this.get("itemIsEnabledKey"),w=this.get("itemIconKey"),g=this.get("itemAriaLabeledByKey"),y=this.get("itemAriaLabelKey"),v=this._displayItems||[],q=(k)?k.get("length"):0,t,x,l,m,i,u,s,n,b,a,r;for(i=0;i<q;i++){t=k.objectAt(i);if(SC.typeOf(t)===SC.T_ARRAY){x=t[0];m=t[1]}else{if(t){if(d){x=t.get?t.get(d):t[d]}else{x=(t.toString)?t.toString():null}if(o&&c){l=t.get?t.get(o):t[o]}if(e){m=t.get?t.get(e):t[e]}else{m=t}if(j){u=t.get?t.get(j):t[j]}else{u=YES}if(w){s=t.get?t.get(w):t[w]}else{s=null}if(g){a=t.get?t.get(g):t[g]}else{a=null}if(y){r=t.get?t.get(y):t[y]}else{r=null}}else{x=m=s=null;u=NO}}u=u&&this.get("isEnabled");if(t){n=(h)?(p.indexOf(m)>=0):(p===m)}else{n=NO}if(f){x=SC.String.loc(x)}v.push(SC.Object.create({title:x,icon:s,width:l,value:m,isEnabled:u,isSelected:(h&&p.indexOf(m)>=0&&p.length===1)||(p===m),isMixed:(h&&p.indexOf(m)>=0),isActive:this._activeRadioButton===i,theme:this.get("theme"),renderState:{}}))}return v}.property("isEnabled","value","items","itemTitleKey","itemWidthKey","itemValueKey","itemIsEnabledKey","localize","itemIconKey","itemAriaLabeledByKey","itemAriaLabelKey").cacheable(),mouseDown:function(a){if(!this.get("isEnabled")){return YES}var d=this.get("renderDelegate"),c=this.get("renderDelegateProxy"),f=this.$(),b=d.indexForEvent(c,f,a);this._activeRadioButton=b;if(b!==undefined){var e=this.get("displayItems")[b];if(e.get("isEnabled")){e.set("isActive",YES);d.updateRadioAtIndex(c,f,b)}}a.allowDefault();return YES},mouseUp:function(a){if(!this.get("isEnabled")){return YES}var d=this.get("renderDelegate"),c=this.get("renderDelegateProxy"),f=this.$(),g=this.get("displayItems"),b=d.indexForEvent(c,f,a);if(this._activeRadioButton!==undefined&&b!==this._activeRadioButton){g[this._activeRadioButton].set("isActive",NO);d.updateRadioAtIndex(c,f,this._activeRadioButton)}this._activeRadioButton=undefined;if(b!==undefined){var e=this.get("displayItems")[b];if(e.get("isEnabled")){e.set("isActive",NO);d.updateRadioAtIndex(c,f,b);this.set("value",e.value)}}a.allowDefault();return YES},keyDown:function(j){if(!this.get("isEnabled")){return YES}if(j.which===9||j.keyCode===9){var h=j.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(h){h.becomeFirstResponder()}else{j.allowDefault()}return YES}if(j.which>=37&&j.which<=40){var g=this.get("renderDelegate"),f=this.get("renderDelegateProxy"),c=this.$(),e=this.get("displayItems"),b=this.get("value");for(var d=0,a=e.length;d<a;d++){if(b===e[d].value){break}}if(j.which===37||j.which===38){if(d<=0){d=e.length-1}else{d--}}if(j.which===39||j.which===40){if(d>=e.length-1){d=0}else{d++}}g.updateRadioAtIndex(f,c,d);this.set("value",e[d].value)}j.allowDefault();return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)}});SC.SceneView=SC.ContainerView.extend({scenes:["master","detail"],nowShowing:null,transitionDuration:200,_state:"NO_VIEW",replaceContent:function(a){if(a&&this._state===this.READY){this.animateScene(a)}else{this.replaceScene(a)}return this},replaceScene:function(c){var d=this._targetView,e=this.STANDARD_LAYOUT,b=this.get("scenes"),a=b?b.indexOf(this.get("nowShowing")):-1;this._targetView=c;this._targetIndex=a;if(this._timer){this._timer.invalidate()}this._leftView=this._rightView=this._start=this._end=null;this._timer=null;this.removeAllChildren();if(d){d.set("layout",e)}if(c){c.set("layout",e)}if(c){this.appendChild(c)}this._state=c?this.READY:this.NO_VIEW},animateScene:function(b){var c=this._targetView,f=this._targetIndex,a=this.get("scenes"),e=a?a.indexOf(this.get("nowShowing")):-1,d;if(f<0||e<0||f===e){return this.replaceScene(b)}this._targetView=b;this._targetIndex=e;if(e>f){this._leftView=c;this._rightView=b;this._target=-1}else{this._leftView=b;this._rightView=c;this._target=1}this.removeAllChildren();if(c){this.appendChild(c)}if(b){this.appendChild(b)}this._start=Date.now();this._end=this._start+this.get("transitionDuration");this._state=this.ANIMATING;this.tick()},tick:function(){this._timer=null;var a=Date.now(),d=(a-this._start)/(this._end-this._start),g=this._target,f=this._leftView,b=this._rightView,c,e;if(d<0){d=0}if(!this.get("isVisibleInWindow")||(d>=1)){return this.replaceScene(this._targetView)}c=SC.clone(this.get("frame"));e=Math.floor(c.width*d);if(g>0){c.left=0-(c.width-e);f.set("layout",c);c=SC.clone(c);c.left=e;b.set("layout",c)}else{c.left=0-e;f.set("layout",c);c=SC.clone(c);c.left=c.width-e;b.set("layout",c)}this._timer=this.invokeLater(this.tick,20);return this},NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",STANDARD_LAYOUT:{top:0,left:0,bottom:0,right:0}});SC.SegmentView=SC.View.extend(SC.Control,{ariaRole:"button",isSegment:YES,classNames:["sc-segment-view"],toolTip:null,isEnabled:YES,isActive:NO,isSelected:NO,layoutDirection:SC.LAYOUT_HORIZONTAL,controlSize:null,supportFocusRing:NO,displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","width","isSegment","isFirstSegment","isMiddleSegment","isLastSegment","isOverflowSegment","index","layoutDirection"],renderDelegateName:"segmentRenderDelegate",useStaticLayout:YES,title:"",value:null,icon:null,localize:NO,keyEquivalent:null,escapeHTML:YES,needsEllipsis:YES,displayTitle:function(){var a=this.get("title");if(this.get("localize")){a=SC.String.loc(a)}return a}.property("title","localize").cacheable(),width:null,localItem:null,widthDidChange:function(){this.adjust("width",this.get("width"))}.observes("width"),updateItem:function(d,c){var g=d.get("itemKeys"),f,a=d.get("viewKeys"),e,b;for(b=g.get("length")-1;b>=0;b--){f=d.get(g.objectAt(b));e=a.objectAt(b);if(!SC.none(c.get(f))){this.set(e,c.get(f))}}this.set("localItem",c)}});sc_require("views/segment");SC.SegmentedView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled").cacheable(),ariaRole:"group",classNames:["sc-segmented-view"],theme:"square",value:null,isEnabled:YES,allowsEmptySelection:NO,allowsMultipleSelection:NO,selectSegmentWhenTriggeringAction:NO,localize:YES,align:SC.ALIGN_CENTER,layoutDirection:SC.LAYOUT_HORIZONTAL,items:null,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemActionKey:null,itemTargetKey:null,itemLayerIdKey:null,itemKeyEquivalentKey:null,shouldHandleOverflow:YES,overflowTitle:"&raquo;",overflowToolTip:"More&hellip;",overflowIcon:null,segmentViewClass:SC.SegmentView,itemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemWidthKey","itemToolTipKey","itemKeyEquivalentKey","itemLayerIdKey"],viewKeys:["title","value","isEnabled","icon","width","toolTip","keyEquivalent","layerId"],init:function(){arguments.callee.base.apply(this,arguments);var d=this.get("overflowTitle"),a=this.get("overflowToolTip"),b=this.get("overflowIcon"),c;c=this.get("segmentViewClass").create({controlSize:this.get("controlSize"),localize:this.get("localize"),title:d,toolTip:a,icon:b,isLastSegment:YES,isOverflowSegment:YES,layoutDirection:this.get("layoutDirection"),isVisible:this.get("shouldHandleOverflow")});this.set("overflowView",c);this.appendChild(c);this.itemsDidChange()},shouldHandleOverflowDidChange:function(){if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}else{this.get("overflowView").set("isVisible",NO)}}.observes("shouldHandleOverflow"),itemsDidChange:function(){var m=this.get("items")||[],r,c,h,o=this.get("childViews"),k,d=o.lastObject(),p=this.get("value"),b,q=this.get("itemKeys"),a,n=this.get("viewKeys"),f,l=this.get("segmentViewClass"),g,e;if(o.get("length")-1>m.get("length")){for(g=o.get("length")-2;g>=m.get("length");g--){k=o.objectAt(g);c=k.get("localItem");if(c instanceof SC.Object){for(e=q.get("length")-1;e>=0;e--){a=this.get(q.objectAt(e));if(a){c.removeObserver(a,this,this.itemContentDidChange)}}}if(SC.isArray(p)){p.removeObject(c)}else{if(p===c){p=null}}this.removeChild(k)}this.set("value",p)}else{if(o.get("length")-1<m.get("length")){for(g=o.get("length")-1;g<m.get("length");g++){k=l.create({controlSize:this.get("controlSize"),localize:this.get("localize"),layoutDirection:this.get("layoutDirection")});this.insertBefore(k,d)}}}o=this.get("childViews");for(g=0;g<m.get("length");g++){c=m.objectAt(g);k=o.objectAt(g);h=k.get("localItem");if(h instanceof SC.Object&&!m.contains(h)){for(e=q.get("length")-1;e>=0;e--){a=this.get(q.objectAt(e));if(a){h.removeObserver(a,this,this.itemContentDidChange)}}}if(SC.none(c)){continue}if(SC.typeOf(c)===SC.T_STRING){c=SC.Object.create({title:c.humanize().titleize(),value:c});this.set("itemTitleKey","title");this.set("itemValueKey","value")}else{if(SC.typeOf(c)===SC.T_HASH){c=SC.Object.create(c)}else{if(c instanceof SC.Object){for(e=q.get("length")-1;e>=0;e--){a=this.get(q.objectAt(e));if(a){c.removeObserver(a,this,this.itemContentDidChange);c.addObserver(a,this,this.itemContentDidChange,g)}}}else{SC.Logger.error("SC.SegmentedView items may be Strings, Objects (ie. Hashes) or SC.Objects only")}}}b=NO;if(SC.isArray(p)?p.indexOf(c.get(this.get("itemValueKey")))>=0:p===c.get(this.get("itemValueKey"))){b=YES}k.set("isSelected",b);k.set("index",g);k.set("isFirstSegment",g===0);k.set("isMiddleSegment",g<m.get("length")-1&&g>0);k.set("isLastSegment",g===m.get("length")-1);k.updateItem(this,c)}if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}}.observes("*items.[]"),itemContentDidChange:function(e,d,b,c){var a=this.get("items"),f=this.get("childViews"),g;g=f.objectAt(c);if(g){g.updateItem(this,e)}else{SC.Logger.warn("Item content change was observed on item without matching segment child view.")}if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}},viewDidResize:function(){var b=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL,a=b?this.$().width():this.$().height();if(this.get("shouldHandleOverflow")&&(this.isOverflowing||a<=this.cachedMinimumDim)){this.adjustOverflow()}},isVisibleInWindowDidChange:function(){if(this.get("shouldHandleOverflow")){this.invokeLast(this.remeasure)}}.observes("isVisibleInWindow"),remeasure:function(){if(!this.get("shouldHandleOverflow")){return}var a=this.get("renderDelegate"),d=this.get("childViews"),c;if(this.get("isVisibleInWindow")){c=d.lastObject();c.set("isVisible",YES);for(var b=d.get("length")-1;b>=0;b--){d.objectAt(b).set("isVisible",YES)}this.cachedDims=this.segmentDimensions();this.cachedOverflowDim=this.overflowSegmentDim();this.adjustOverflow()}},adjustOverflow:function(){if(!this.get("shouldHandleOverflow")){return}var f=this.get("childViews"),e,h=this.get("value"),b=f.lastObject(),g=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL,k=g?this.$().width():this.$().height(),d=0,j,a,c;this.isOverflowing=NO;b.set("isSelected",NO);this.overflowItems=[];a=this.cachedDims.length;for(c=0;c<a;c++){e=f.objectAt(c);d+=this.cachedDims[c];j=(c===a-1)?d:d+this.cachedOverflowDim;if(j>k){this.overflowItems.pushObject(e.get("localItem"));this.isOverflowing=YES;e.set("isVisible",NO);if(c===0){b.set("isFirstSegment",YES)}if(SC.isArray(h)?h.indexOf(e.get("value"))>=0:h===e.get("value")){b.set("isSelected",YES)}}else{e.set("isVisible",YES);if(c===0){b.set("isFirstSegment",NO)}}}if(this.isOverflowing){b.set("isVisible",YES)}else{b.set("isVisible",NO)}this.cachedMinimumDim=d+this.cachedOverflowDim},segmentDimensions:function(){var b=this.get("childViews"),a,e,h=[],g=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL;for(var c=0,d=b.length;c<d-1;c++){a=b[c];e=a.get("frame");h[c]=g?e.width:e.height}return h},overflowSegmentDim:function(){var b=this.get("childViews"),a,c,d=this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL;a=b.length&&b[b.length-1];if(a){c=a.get("frame");return d?c.width:c.height}return 0},indexForClientPosition:function(b,h){var d=this.get("childViews"),g,e,c,f,a;a={x:b,y:h};for(e=0,g=d.length;e<g;e++){c=d[e];f=c.get("layer").getBoundingClientRect();f={x:f.left,y:f.top,width:(f.right-f.left),height:(f.bottom-f.top)};if(SC.pointInRect(a,f)){return e}}return -1},displayProperties:["align"],renderDelegateName:"segmentedRenderDelegate",displayItemIndexForEvent:function(b){var c=this.get("renderDelegate");var a=b.clientX;var f=b.clientY;if(a===0&&f===0){var d=b.target;if(d){var e=SC.offset(d);a=e.x+Math.round(d.offsetWidth/2);f=e.y+Math.round(d.offsetHeight/2)}}if(c&&c.indexForClientPosition){return c.indexForClientPosition(this,a,f)}return this.indexForClientPosition(b.clientX,b.clientY)},keyDown:function(c){var g,h,d,e,f,b;if(c.which===9||c.keyCode===9){var a=c.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{c.allowDefault()}return YES}if(!this.get("allowsMultipleSelection")){g=this.get("childViews");e=g.get("length");f=this.get("value");b=SC.isArray(f);if(c.which===39||c.which===40){if(f){for(d=0;d<e-2;d++){h=g.objectAt(d);if(b?(f.indexOf(h.get("value"))>=0):(h.get("value")===f)){this.triggerItemAtIndex(d+1)}}}else{this.triggerItemAtIndex(0)}return YES}else{if(c.which===37||c.which===38){if(f){for(d=1;d<e-1;d++){h=g.objectAt(d);if(b?(f.indexOf(h.get("value"))>=0):(h.get("value")===f)){this.triggerItemAtIndex(d-1)}}}else{this.triggerItemAtIndex(e-2)}return YES}}}return NO},mouseDown:function(a){var c=this.get("childViews"),e,d=c.get("length")-1,b;if(!this.get("isEnabled")){return YES}b=this.displayItemIndexForEvent(a);if(b>=0){e=c.objectAt(b);if(e.get("isEnabled")){e.set("isActive",YES)}this.activeChildView=e;if(b===d){this.showOverflowMenu()}else{this._isMouseDown=YES}}return YES},mouseUp:function(a){var c,b;b=this.displayItemIndexForEvent(a);if(this._isMouseDown&&(b>=0)){this.triggerItemAtIndex(b);c=this.activeChildView;if(c){c.set("isActive",NO);this.activeChildView=null}}this._isMouseDown=NO;return YES},mouseMoved:function(a){var d=this.get("childViews"),e=d.get("length")-1,c,f,b;if(this._isMouseDown){b=this.displayItemIndexForEvent(a);c=this.activeChildView;f=d.objectAt(b);if(f&&f!==c){if(c){c.set("isActive",NO)}if(f.get("isEnabled")){f.set("isActive",YES)}this.activeChildView=f;if(b===e){this.showOverflowMenu();this._isMouseDown=NO}}}return YES},mouseEntered:function(a){var c=this.get("childViews"),e,d=c.get("length")-1,b;if(this._isMouseDown){b=this.displayItemIndexForEvent(a);if(b===d){this.showOverflowMenu();this._isMouseDown=NO}else{if(b>=0){e=c.objectAt(b);if(e.get("isEnabled")){e.set("isActive",YES)}this.activeChildView=e}}}return YES},mouseExited:function(a){var b;if(this._isMouseDown){b=this.activeChildView;if(b){b.set("isActive",NO)}this.activeChildView=null}return YES},touchStart:function(e){var b=this.get("childViews"),d,c=b.get("length")-1,a;if(!this.get("isEnabled")){return YES}a=this.displayItemIndexForEvent(e);if(a>=0){d=b.objectAt(a);d.set("isActive",YES);this.activeChildView=d;if(a===c){this.showOverflowMenu()}else{this._isTouching=YES}}return YES},touchEnd:function(c){var b,a;a=this.displayItemIndexForEvent(c);if(this._isTouching&&(a>=0)){this.triggerItemAtIndex(a);b=this.activeChildView;b.set("isActive",NO);this.activeChildView=null;this._isTouching=NO}return YES},touchesDragged:function(a,e){var h=this.touchIsInBoundary(a),d=this.get("childViews"),f=d.get("length")-1,c,g,b;if(h){if(!this._isTouching){this._touchDidEnter(a)}b=this.displayItemIndexForEvent(a);c=this.activeChildView;g=d[b];if(g&&g!==c){if(c){c.set("isActive",NO)}g.set("isActive",YES);this.activeChildView=g;if(b===f){this.showOverflowMenu();this._isMouseDown=NO}}}else{if(this._isTouching){this._touchDidExit(a)}}this._isTouching=h;return YES},_touchDidExit:function(a){var b;if(this.isTouching){b=this.activeChildView;b.set("isActive",NO);this.activeChildView=null}return YES},_touchDidEnter:function(a){var c=this.get("childViews"),e,d=c.get("length")-1,b;b=this.displayItemIndexForEvent(a);if(b===d){this.showOverflowMenu();this._isTouching=NO}else{if(b>=0){e=c.objectAt(b);e.set("isActive",YES);this.activeChildView=e}}return YES},triggerItemAtIndex:function(i){var k=this.get("childViews"),g,b,l,c,h,f;g=k.objectAt(i);if(!g.get("isEnabled")){return this}h=this.get("allowsEmptySelection");f=this.get("allowsMultipleSelection");b=g.get("value");l=c=this.get("value");if(SC.empty(l)){l=[]}else{if(!SC.isArray(l)){l=[l]}}if(!f){if(h&&(l.get("length")===1)&&(l.objectAt(0)===b)){l=[]}else{l=[b]}}else{if(l.indexOf(b)>=0){if(l.get("length")>1||(l.objectAt(0)!==b)||h){l=l.without(b)}}else{l=l.concat([b])}}switch(l.get("length")){case 0:l=null;break;case 1:l=l.objectAt(0);break;default:break}var n=this.get("itemActionKey"),a=this.get("itemTargetKey"),e,j=null,d=this.getPath("pane.rootResponder"),m;if(n&&(m=this.get("items").objectAt(i))){e=m.get?m.get(n):m[n];if(a){j=m.get?m.get(a):m[a]}if(d){d.sendAction(e,j,this,this.get("pane"),l)}}if(c!==undefined&&(!e||this.get("selectSegmentWhenTriggeringAction"))){this.set("value",l)}e=this.get("action");if(e&&d){d.sendAction(e,this.get("target"),this,this.get("pane"),l)}},selectOverflowItem:function(b){var a=b.get("selectedItem");this.triggerItemAtIndex(a.get("index"));b.removeObserver("selectedItem",this,"selectOverflowItem");this.activeChildView.set("isActive",NO);this.activeChildView=null},showOverflowMenu:function(){var f=this.get("childViews"),b=f.get("length")-1,o=this.overflowItems,k,j,e,h;k=o.get("length");j=f.get("length")-1-k;h=this.get("value");e=SC.isArray(h);for(var c=0;c<k;c++){var n=o.objectAt(c),l=this.get("itemValueKey");if(e?h.indexOf(n.get(l))>=0:h===n.get(l)){n.set("isChecked",YES)}else{n.set("isChecked",NO)}n.set("index",j+c)}var m=this;var a=SC.MenuPane.create({layout:{width:200},items:o,itemTitleKey:this.get("itemTitleKey"),itemIconKey:this.get("itemIconKey"),itemIsEnabledKey:this.get("itemIsEnabledKey"),itemKeyEquivalentKey:this.get("itemKeyEquivalentKey"),itemCheckboxKey:"isChecked",modalPaneDidClick:function(){arguments.callee.base.apply(this,arguments);this.removeObserver("selectedItem",m,"selectOverflowItem");m.activeChildView.set("isActive",NO);m.activeChildView=null}});var d=this.get("layer");var g=d.childNodes[d.childNodes.length-1];a.popup(g);a.addObserver("selectedItem",this,"selectOverflowItem")},valueDidChange:function(){var d=this.get("value"),c,f=this.get("childViews"),g=Infinity,e=f.lastObject(),h,a;if(this.overflowItems){c=this.overflowItems.get("length");g=f.get("length")-1-c;e.set("isSelected",NO)}for(var b=f.get("length")-2;b>=0;b--){h=f.objectAt(b);if(SC.isArray(d)?d.indexOf(h.get("value"))>=0:d===h.get("value")){h.set("isSelected",YES);if(b>=g){e.set("isSelected",YES)}}else{h.set("isSelected",NO)}}}.observes("value")});sc_require("views/button");SC.SelectView=SC.ButtonView.extend({acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),escapeHTML:YES,escapeHTMLBindingDefault:SC.Binding.oneWay().bool(),items:[],itemsBindingDefault:SC.Binding.multiple(),itemTitleKey:null,itemSortKey:null,itemValueKey:null,itemIconKey:null,itemSeparatorKey:"separator",itemIsEnabledKey:"isEnabled",localize:YES,disableSort:YES,classNames:["sc-select-view"],menu:null,_itemList:[],_itemIdx:null,value:null,checkboxEnabled:YES,showCheckbox:YES,emptyName:null,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","items","escapeHTML","emptyName"],preferMatrix:null,CUSTOM_MENU_ITEM_HEIGHT:20,isActiveBinding:"*menu.isVisibleInWindow",isDefaultPosition:NO,lastMenuWidth:null,exampleView:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,menuItemPadding:35,isContextMenuEnabled:NO,supportFocusRing:YES,leftAlign:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:return SC.SelectView.TINY_OFFSET_X;case SC.SMALL_CONTROL_SIZE:return SC.SelectView.SMALL_OFFSET_X;case SC.REGULAR_CONTROL_SIZE:return SC.SelectView.REGULAR_OFFSET_X;case SC.LARGE_CONTROL_SIZE:return SC.SelectView.LARGE_OFFSET_X;case SC.HUGE_CONTROL_SIZE:return SC.SelectView.HUGE_OFFSET_X}return 0}.property("controlSize"),sortObjects:function(b){if(!this.get("disableSort")){var a=this.get("itemSortKey")||this.get("itemTitleKey");b=b.sort(function(d,c){if(a){d=d.get?d.get(a):d[a];c=c.get?c.get(a):c[a]}return(d<c)?-1:((d>c)?1:0)})}return b},render:function(b,g){arguments.callee.base.apply(this,arguments);var q,d,l,r,t,y,h,f,w,i,o,a,n,e,k,x,s,p,u,m,j,v,c;l=this.get("items")||[];l=this.sortObjects(l);r=l.length;t=this.get("itemTitleKey");y=this.get("itemIconKey");h=this.get("itemValueKey");f=this.get("itemSeparatorKey");w=this.get("showCheckbox");j=this.get("itemIsEnabledKey");q=this.get("escapeHTML");i=this.get("value");o=this.get("localize");n=[];e=YES;k=0;v=this.get("emptyName");if(!SC.none(v)){v=o?SC.String.loc(v):v;v=q?SC.RenderContext.escapeHTML(v):v;u=SC.Object.create({separator:NO,title:v,icon:null,value:null,isEnabled:YES,checkbox:NO,target:this,action:"displaySelectedItem"});if(SC.none(i)){this.set("title",v)}n.push(u)}l.forEach(function(z){if(z||z===0){a=f?(z.get?z.get(f):z[f]):NO;if(!a){x=t?(z.get?z.get(t):z[t]):z.toString();x=o?SC.String.loc(x):x;x=q?SC.RenderContext.escapeHTML(x):x;s=y?(z.get?z.get(y):z[y]):null;if(SC.none(z[y])){s=null}p=h?(z.get?z.get(h):z[h]):z;if(!SC.none(i)&&!SC.none(p)){c=false;if(SC.kindOf(i,SC.Record)&&SC.kindOf(p,SC.Record)){c=i.get("storeKey")===p.get("storeKey")}if(i===p||c){this.set("title",x);this.set("icon",s)}}if(p===this.get("value")){this.set("_itemIdx",k);e=!w?NO:YES}else{e=NO}m=(z.get?z.get(j):z[j]);if(NO!==m){m=YES}if(SC.none(this._defaultVal)&&m){this._defaultVal=p;this._defaultTitle=x;this._defaultIcon=s}}u=SC.Object.create({separator:a,title:x,icon:s,value:p,isEnabled:m,checkbox:e,target:this,action:"displaySelectedItem"});n.push(u)}k+=1;this.set("_itemList",n)},this);if(g){this.invokeLast(function(){var z=this.get("value");if(SC.none(z)){if(SC.none(v)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);this.set("icon",this._defaultIcon)}else{this.set("title",v)}}})}this.changeSelectPreferMatrix(this.get("_itemIdx"))},_action:function(l){var i,a,j,k,q,n,y,e,x,c,m,s,o,v,f,g,b,w,h,r;i=this.$(".sc-button-label")[0];var z=SC.SelectView.MENU_WIDTH_OFFSET;if(!this.get("isDefaultPosition")){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:z+=SC.SelectView.TINY_POPUP_MENU_WIDTH_OFFSET;break;case SC.SMALL_CONTROL_SIZE:z+=SC.SelectView.SMALL_POPUP_MENU_WIDTH_OFFSET;break;case SC.REGULAR_CONTROL_SIZE:z+=SC.SelectView.REGULAR_POPUP_MENU_WIDTH_OFFSET;break;case SC.LARGE_CONTROL_SIZE:z+=SC.SelectView.LARGE_POPUP_MENU_WIDTH_OFFSET;break;case SC.HUGE_CONTROL_SIZE:z+=SC.SelectView.HUGE_POPUP_MENU_WIDTH_OFFSET;break}}a=this.get("layer").offsetWidth+z;a=this.get("layer").offsetWidth;j=i.scrollWidth;k=this.get("lastMenuWidth");if(j){q=i.offsetWidth;if(j&&q){a=a+j-q}}if(!k||(a>k)){k=a}n=this.get("_itemList");var t=this.get("customViewClassName");var p=this.get("customViewMenuOffsetWidth");var d="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button sc-scroll-view sc-menu-scroll-view sc-container-view menuContainer sc-button-view sc-menu-item sc-regular-size";d=t?(d+" "+t):d;SC.prepareStringMeasurement("",d);for(m=0,w=n.length;m<w;++m){x=n.objectAt(m);y=SC.measureString(x.title).width;if(!e||(y>e)){e=y}}SC.teardownStringMeasurement();k=(e+this.menuItemPadding>k)?e+this.menuItemPadding:k;var u=SC.RootResponder.responder.get("currentWindowSize").width;if(k>u){k=(u-25)}this.set("lastMenuWidth",k);s=this.get("value");o=this.get("_itemList");v=this.get("controlSize");f=this.get("menuPaneHeightPadding");r=this.get("escapeHTML");g=this.get("exampleView")||SC.MenuItemView.extend({escapeHTML:r});b=SC.MenuPane.create({classNames:["select-button"],items:o,exampleView:g,isEnabled:YES,menuHeightPadding:f,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:k},controlSize:v,itemWidth:k});if(!b){return NO}b.popup(this,this.preferMatrix);this.set("menu",b);h=this._itemIdx;if(!SC.empty(h)&&h>-1){g=b.menuItemViewForContentIndex(h);if(g){g.becomeFirstResponder()}}this.set("isActive",YES);return YES},displaySelectedItem:function(a){var b=a.get("selectedItem");this.set("value",b.get("value"));this.set("title",b.get("title"));this.set("_itemIdx",b.get("contentIndex"))},changeSelectPreferMatrix:function(){var c=0,g=0;switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:c=SC.SelectView.TINY_OFFSET_Y;g=SC.MenuPane.TINY_MENU_ITEM_HEIGHT;break;case SC.SMALL_CONTROL_SIZE:c=SC.SelectView.SMALL_OFFSET_Y;g=SC.MenuPane.SMALL_MENU_ITEM_HEIGHT;break;case SC.REGULAR_CONTROL_SIZE:c=SC.SelectView.REGULAR_OFFSET_Y;g=SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT;break;case SC.LARGE_CONTROL_SIZE:c=SC.SelectView.LARGE_OFFSET_Y;g=SC.MenuPane.LARGE_MENU_ITEM_HEIGHT;break;case SC.HUGE_CONTROL_SIZE:c=SC.SelectView.HUGE_OFFSET_Y;g=SC.MenuPane.HUGE_MENU_ITEM_HEIGHT;break}var e=c,b=this.get("_itemIdx"),a=this.get("leftAlign"),f,d;if(this.get("isDefaultPosition")){f=[1,0,3];this.set("preferMatrix",f)}else{if(b){e=b*g+c}d=[a,-e,2];this.set("preferMatrix",d)}},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;this.becomeFirstResponder();this._action();return YES},mouseUp:function(b){var d=this.get("menu"),a,c;if(d){a=d.getPath("rootMenu.targetMenuItem");if(a&&d.get("mouseHasEntered")){if(!a.performAction()){d.remove()}}else{if(b.timeStamp-this._mouseDownTimestamp>400){d.remove()}}}this._isMouseDown=NO;this.set("isActive",NO);return YES},mouseExited:function(){return YES},keyDown:function(a){if(this.interpretKeyEvents(a)){return YES}else{return arguments.callee.base.apply(this,arguments)}},interpretKeyEvents:function(a){if(a){if((a.keyCode===38||a.keyCode===40)){this._action()}else{if(a.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)},_button_isSelectedDidChange:function(){}.observes("isSelected")});SC.SelectView.TINY_OFFSET_X=0;SC.SelectView.TINY_OFFSET_Y=0;SC.SelectView.TINY_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectView.SMALL_OFFSET_X=-18;SC.SelectView.SMALL_OFFSET_Y=3;SC.SelectView.SMALL_POPUP_MENU_WIDTH_OFFSET=7;SC.SelectView.REGULAR_OFFSET_X=-17;SC.SelectView.REGULAR_OFFSET_Y=0;SC.SelectView.REGULAR_POPUP_MENU_WIDTH_OFFSET=4;SC.SelectView.LARGE_OFFSET_X=-17;SC.SelectView.LARGE_OFFSET_Y=6;SC.SelectView.LARGE_POPUP_MENU_WIDTH_OFFSET=3;SC.SelectView.HUGE_OFFSET_X=0;SC.SelectView.HUGE_OFFSET_Y=0;SC.SelectView.HUGE_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectView.MENU_WIDTH_OFFSET=-2;sc_require("views/button");SC.SelectButtonView=SC.ButtonView.extend({init:function(){arguments.callee.base.apply(this,arguments)},escapeHTML:YES,objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,iconKey:null,isEnabledKey:"isEnabled",localize:YES,disableSort:YES,classNames:["select-button"],menu:null,itemList:[],itemIdx:null,value:null,checkboxEnabled:YES,separatorPosition:null,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","objects","objects.[]"],preferMatrix:null,SELECT_BUTTON_SPRITE_WIDTH:28,isActiveBinding:"*menu.isVisibleInWindow",isDefaultPosition:NO,lastMenuWidth:null,customView:null,customViewClassName:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,supportFocusRing:YES,isContextMenuEnabled:NO,leftAlign:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:return SC.SelectButtonView.TINY_OFFSET_X;case SC.SMALL_CONTROL_SIZE:return SC.SelectButtonView.SMALL_OFFSET_X;case SC.REGULAR_CONTROL_SIZE:return SC.SelectButtonView.REGULAR_OFFSET_X;case SC.LARGE_CONTROL_SIZE:return SC.SelectButtonView.LARGE_OFFSET_X;case SC.HUGE_CONTROL_SIZE:return SC.SelectButtonView.HUGE_OFFSET_X}return 0}.property("controlSize"),sortObjects:function(b){if(!this.get("disableSort")){var a=this.get("sortKey")||this.get("nameKey");b=b.sort(function(d,c){if(a){d=d.get?d.get(a):d[a];c=c.get?c.get(a):c[a]}return(d<c)?-1:((d>c)?1:0)})}return b},render:function(b,e){arguments.callee.base.apply(this,arguments);var c,a,n,p,t,f,r,g,l,s,k,d,i,u,o,m,q,j,h;c=this.layout.width;if(e&&c){this.adjust({width:c-this.SELECT_BUTTON_SPRITE_WIDTH})}a=this.get("objects");a=this.sortObjects(a);n=a.length;p=this.get("nameKey");t=this.get("iconKey");f=this.get("valueKey");h=this.get("isEnabledKey");r=this.get("checkboxEnabled");g=this.get("value");l=this.get("localize");s=this.get("separatorPosition");k=[];d=YES;i=0;a.forEach(function(v){if(v){u=p?(v.get?v.get(p):v[p]):v.toString();u=l?SC.String.loc(u):u;o=t?(v.get?v.get(t):v[t]):null;if(SC.none(v[t])){o=null}m=(f)?(v.get?v.get(f):v[f]):v;if(!SC.none(g)&&!SC.none(m)){if(this._equals(g,m)){this.set("title",u);this.set("icon",o)}}if(this._equals(m,this.get("value"))){if(s>0&&s<n&&i>=n-s){i++}this.set("itemIdx",i);d=!r?NO:YES}else{d=NO}j=(h)?(v.get?v.get(h):v[h]):v;if(NO!==j){j=YES}if(i===0){this._defaultVal=m;this._defaultTitle=u;this._defaultIcon=o}var w=SC.Object.create({title:u,icon:o,value:m,isEnabled:j,checkbox:d,target:this,action:"displaySelectedItem"});k.push(w)}i+=1;if(s&&i===(n-s)){var x=SC.Object.create({separator:YES});k.push(x)}this.set("itemList",k)},this);if(e){b.attr("aria-haspopup","true");this.invokeLast(function(){var v=this.get("value");if(SC.none(v)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);this.set("icon",this._defaultIcon)}})}this.changeSelectButtonPreferMatrix(this.itemIdx)},_equals:function(b,a){var c=YES;if(b&&SC.typeOf(b)===SC.T_HASH&&a&&SC.typeOf(a)===SC.T_HASH){for(var d in b){if(b[d]!==a[d]){c=NO}}}else{c=(b===a)}return c},_action:function(o){var i,a,l,m,t,q,A,e,z,c,p,u,r,x,f,g,n,b,y,h,k,B,j;i=this.$(".sc-button-label")[0];B=SC.SelectButtonView.MENU_WIDTH_OFFSET;if(!this.get("isDefaultPosition")){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:B+=SC.SelectButtonView.TINY_POPUP_MENU_WIDTH_OFFSET;break;case SC.SMALL_CONTROL_SIZE:B+=SC.SelectButtonView.SMALL_POPUP_MENU_WIDTH_OFFSET;break;case SC.REGULAR_CONTROL_SIZE:B+=SC.SelectButtonView.REGULAR_POPUP_MENU_WIDTH_OFFSET;break;case SC.LARGE_CONTROL_SIZE:B+=SC.SelectButtonView.LARGE_POPUP_MENU_WIDTH_OFFSET;break;case SC.HUGE_CONTROL_SIZE:B+=SC.SelectButtonView.HUGE_POPUP_MENU_WIDTH_OFFSET;break}}a=this.get("layer").offsetWidth+B;l=i.scrollWidth;m=this.get("lastMenuWidth");if(l){t=i.offsetWidth;if(l&&t){a=a+l-t}}if(!m||(a>m)){m=a}q=this.get("itemList");var v=this.get("customViewClassName"),s=this.get("customViewMenuOffsetWidth"),d="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button menu sc-scroll-view sc-menu-scroll-view sc-container-view sc-menu-item menu-item value sc-regular-size";d=v?(d+" "+v):d;h=(this.get("customView")||SC.MenuItemView).create();k=h.get("escapeHTML");j=document.body;for(p=0,y=q.length;p<y;++p){z=q.objectAt(p);c=document.createElement("div");c.style.cssText="top:-10000px; left: -10000px;  position: absolute;";c.className=d;c.innerHTML=k?SC.RenderContext.escapeHTML(z.title):z.title;j.appendChild(c);A=c.offsetWidth+s;if(!e||(A>e)){e=A}j.removeChild(c)}e=(e>m)?e:m;var w=SC.RootResponder.responder.get("currentWindowSize").width;if(e>w){e=(w-25)}this.set("lastMenuWidth",m);u=this.get("value");r=this.get("itemList");x=this.get("controlSize");g=this.get("customView");n=g?g:SC.MenuItemView;b=SC.MenuPane.create({classNames:["select-button"],items:r,exampleView:n,isEnabled:YES,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:e},controlSize:x,itemWidth:m,performKeyEquivalent:function(D,C){switch(D){case"tab":case"shift_tab":return YES;default:return arguments.callee.base.apply(this,arguments)}}});if(!b){return NO}b.popup(this,this.preferMatrix);this.set("menu",b);g=b.menuItemViewForContentIndex(this.get("itemIdx"));b.set("currentMenuItem",g);if(g){g.becomeFirstResponder()}this.set("isActive",YES);return YES},displaySelectedItem:function(a){var b=this.getPath("menu.selectedItem");if(!b){return NO}this.set("value",b.get("value"));this.set("title",b.get("title"));this.set("itemIdx",b.get("contentIndex"));return YES},changeSelectButtonPreferMatrix:function(){var b=0,h=0,d=0,e=0,i,f;switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:b=SC.SelectButtonView.TINY_OFFSET_Y;h=SC.MenuPane.TINY_MENU_ITEM_HEIGHT;d=SC.MenuPane.TINY_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.SMALL_CONTROL_SIZE:b=SC.SelectButtonView.SMALL_OFFSET_Y;h=SC.MenuPane.SMALL_MENU_ITEM_HEIGHT;d=SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.REGULAR_CONTROL_SIZE:b=SC.SelectButtonView.REGULAR_OFFSET_Y;h=SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT;d=SC.MenuPane.REGULAR_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.LARGE_CONTROL_SIZE:b=SC.SelectButtonView.LARGE_OFFSET_Y;h=SC.MenuPane.LARGE_MENU_ITEM_HEIGHT;d=SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT;break;case SC.HUGE_CONTROL_SIZE:b=SC.SelectButtonView.HUGE_OFFSET_Y;h=SC.MenuPane.HUGE_MENU_ITEM_HEIGHT;d=SC.MenuPane.HUGE_MENU_ITEM_SEPARATOR_HEIGHT;break}var g=b,a=this.get("itemIdx"),k=this.get("leftAlign"),j,c;if(this.get("isDefaultPosition")){j=[1,0,3];this.set("preferMatrix",j)}else{if(a){g=a*h+b;i=this.get("separatorPosition");f=this.get("objects").length;if(i>0&&i<f&&a>=f-i){e=h-d;g-=e}}c=[k,-g,2];this.set("preferMatrix",c)}},mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;this.becomeFirstResponder();this._action();this._menuRenderedTimestamp=0;var b=this;setTimeout(function(){SC.run(function(){b._menuRenderedTimestamp=Date.now()})},1);return YES},_recordMouseDownTimestamp:function(){this._menuRenderedTimestamp=new Date().getTime()},mouseUp:function(b){var d=new Date().getTime(),c=this._menuRenderedTimestamp,e=this.get("menu"),f=SC.platform.touch,a;if(c===0){c=Date.now()}if(e){a=e.getPath("rootMenu.targetMenuItem");if(a&&a.get("mouseHasEntered")){if(!a.performAction()){e.remove()}}else{if(!f&&(d-c>SC.ButtonView.CLICK_AND_HOLD_DELAY)){if(!e.get("mouseHasEntered")&&!this.get("isDefaultPosition")){a=e.get("currentMenuItem");if(a&&!a.performAction()){e.remove()}}else{e.remove()}}}}this._isMouseDown=NO;this.set("isActive",NO);return YES},mouseExited:function(){return YES},keyDown:function(a){if(this.interpretKeyEvents(a)){return YES}else{return arguments.callee.base.apply(this,arguments)}},interpretKeyEvents:function(a){if(a){if((a.keyCode===38||a.keyCode===40)){this._action()}else{if(a.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),insertTab:function(b){var a=this.get("nextValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},insertBacktab:function(b){var a=this.get("previousValidKeyView");if(a){a.becomeFirstResponder()}else{b.allowDefault()}return YES},_button_isSelectedDidChange:function(){}.observes("isSelected"),didAppendToDocument:function(){}});SC.SelectButtonView.TINY_OFFSET_X=0;SC.SelectButtonView.TINY_OFFSET_Y=0;SC.SelectButtonView.TINY_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectButtonView.SMALL_OFFSET_X=-18;SC.SelectButtonView.SMALL_OFFSET_Y=3;SC.SelectButtonView.SMALL_POPUP_MENU_WIDTH_OFFSET=7;SC.SelectButtonView.REGULAR_OFFSET_X=-17;SC.SelectButtonView.REGULAR_OFFSET_Y=3;SC.SelectButtonView.REGULAR_POPUP_MENU_WIDTH_OFFSET=4;SC.SelectButtonView.LARGE_OFFSET_X=-17;SC.SelectButtonView.LARGE_OFFSET_Y=6;SC.SelectButtonView.LARGE_POPUP_MENU_WIDTH_OFFSET=3;SC.SelectButtonView.HUGE_OFFSET_X=0;SC.SelectButtonView.HUGE_OFFSET_Y=0;SC.SelectButtonView.HUGE_POPUP_MENU_WIDTH_OFFSET=0;SC.SelectButtonView.MENU_WIDTH_OFFSET=-2;SC.MenuPane.TINY_MENU_ITEM_HEIGHT=10;SC.MenuPane.TINY_MENU_ITEM_SEPARATOR_HEIGHT=2;SC.MenuPane.TINY_MENU_HEIGHT_PADDING=2;SC.MenuPane.TINY_SUBMENU_OFFSET_X=0;SC.MenuPane.SMALL_MENU_ITEM_HEIGHT=16;SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT=7;SC.MenuPane.SMALL_MENU_HEIGHT_PADDING=4;SC.MenuPane.SMALL_SUBMENU_OFFSET_X=2;SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT=22;SC.MenuPane.REGULAR_MENU_ITEM_SEPARATOR_HEIGHT=9;SC.MenuPane.REGULAR_MENU_HEIGHT_PADDING=6;SC.MenuPane.REGULAR_SUBMENU_OFFSET_X=2;SC.MenuPane.LARGE_MENU_ITEM_HEIGHT=31;SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT=20;SC.MenuPane.LARGE_MENU_HEIGHT_PADDING=0;SC.MenuPane.LARGE_SUBMENU_OFFSET_X=4;SC.MenuPane.HUGE_MENU_ITEM_HEIGHT=20;SC.MenuPane.HUGE_MENU_ITEM_SEPARATOR_HEIGHT=9;SC.MenuPane.HUGE_MENU_HEIGHT_PADDING=0;SC.MenuPane.HUGE_SUBMENU_OFFSET_X=0;SC.SelectFieldView=SC.FieldView.extend({displayProperties:["objects","nameKey","valueKey","isEnabled"],acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),tagName:"select",classNames:["sc-select-field-view"],objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,emptyName:null,localize:NO,cpDidChange:YES,disableSort:NO,validateMenuItem:function(b,a){return YES},sortObjects:function(b){if(!this.get("disableSort")){var a=this.get("sortKey")||this.get("nameKey");if(a){b=b.sortProperty(a)}else{b=b.sort(function(d,c){if(a){d=d.get?d.get(a):d[a];c=c.get?c.get(a):c[a]}return(d<c)?-1:((d>c)?1:0)})}}return b},render:function(c,a){if(a||this.get("cpDidChange")){this.set("cpDidChange",NO);var f=this.get("nameKey");var j=this.get("valueKey");var i=this.get("objects");var b=this.get("value");var d,g;if(!this.get("isEnabled")){c.attr("disabled","disabled")}var h=this.get("localize");if(!j&&b){b=SC.guidFor(b)}if((b===null)||(b==="")){b="***"}if(i){i=this.sortObjects(i);if(!a){g=this.$input()[0];if(!g){return}g.innerHTML=""}var e=this.get("emptyName");if(e){if(h){e=SC.String.loc(e)}if(a){c.push('<option value="***">'+e+"</option>",'<option disabled="disabled"></option>')}else{d=document.createElement("option");d.value="***";d.innerHTML=e;g.appendChild(d);d=document.createElement("option");d.disabled="disabled";g.appendChild(d)}}i.forEach(function(n,m){if(n){var l=f?(n.get?n.get(f):n[f]):n.toString();if(h){l=SC.String.loc(l)}var o=(j)?(n.get?n.get(j):n[j]):n;if(!e&&m===0&&b==="***"){this.set("value",o)}if(o!==null&&o!==undefined){o=(SC.guidFor(o))?SC.guidFor(o):o.toString()}var k=(this.validateMenuItem&&this.validateMenuItem(o,l))?"":'disabled="disabled" ';if(a){c.push("<option "+k+'value="'+o+'">'+l+"</option>")}else{d=document.createElement("option");d.value=o;d.innerHTML=l;if(k.length>0){d.disable="disabled"}g.appendChild(d)}}else{if(a){c.push('<option disabled="disabled"></option>')}else{d=document.createElement("option");d.disabled="disabled";g.appendChild(d)}}},this);this.setFieldValue(b)}else{this.set("value",null)}}else{this.$().prop("disabled",!this.get("isEnabled"))}},_objectsObserver:function(){this.set("cpDidChange",YES)}.observes("objects"),_objectArrayObserver:function(){this.set("cpDidChange",YES);this.propertyDidChange("objects")}.observes("*objects.[]"),_nameKeyObserver:function(){this.set("cpDidChange",YES)}.observes("nameKey"),_valueKeyObserver:function(){this.set("cpDidChange",YES)}.observes("valueKey"),_isEnabledObserver:function(){this.set("cpDidChange",YES)}.observes("isEnabled"),$input:function(){return this.$()},mouseDown:function(a){if(!this.get("isEnabled")){a.stop();return YES}else{return arguments.callee.base.apply(this,arguments)}},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},keyDown:function(a){if((a.which===SC.Event.KEY_RETURN)||(a.which===SC.Event.KEY_ESC)){return NO}this.invokeLater("_field_fieldValueDidChange");return arguments.callee.base.apply(this,arguments)},getFieldValue:function(){var f=arguments.callee.base.apply(this,arguments);var c=this.get("valueKey");var e=this.get("objects");var d=null;var a;if(f=="***"){f=null}else{if(f&&e){var g=(SC.typeOf(e.length)===SC.T_FUNCTION)?e.length():e.length;while(!d&&(--g>=0)){a=e.objectAt?e.objectAt(g):e[g];if(a===null||a===undefined){continue}if(c){a=(a.get)?a.get(c):a[c]}var b=(a!==null&&a!==undefined)?(SC.guidFor(a)?SC.guidFor(a):a.toString()):null;if(f==b){d=a}}}}return(c||d)?d:f},setFieldValue:function(a){if(SC.none(a)){a="***"}else{a=((a!==null&&a!==undefined)?(SC.guidFor(a)?SC.guidFor(a):a.toString()):null)}this.$input().val(a);return this},fieldDidFocus:function(){var a=this.get("isFocused");if(!a){this.set("isFocused",true)}},fieldDidBlur:function(){var a=this.get("isFocused");if(a){this.set("isFocused",false)}},_isFocusedObserver:function(){this.$().setClass("focus",this.get("isFocused"))}.observes("isFocused"),didCreateLayer:function(){var a=this.$input();if(this.get("isEnabled")===false){this.$()[0].disabled=true}SC.Event.add(a,"blur",this,this.fieldDidBlur);SC.Event.add(a,"focus",this,this.fieldDidFocus);SC.Event.add(a,"change",this,this._field_fieldValueDidChange)},willDestroyLayer:function(){var a=this.$input();SC.Event.remove(a,"focus",this,this.fieldDidFocus);SC.Event.remove(a,"blur",this,this.fieldDidBlur);SC.Event.remove(a,"change",this,this._field_fieldValueDidChange)}});SC.SliderView=SC.View.extend(SC.Control,{classNames:"sc-slider-view",ariaRole:"slider",value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),contentMaximumKey:null,step:0.1,displayProperties:["displayValue","ariaValue","minimum","maximum","step","frame"],ariaValue:function(){return this.get("value")}.property("value").cacheable(),renderDelegateName:"sliderRenderDelegate",displayValue:function(){var b=this.get("minimum"),a=this.get("maximum"),d=this.get("value"),c=this.get("step");d=Math.min(Math.max(d,b),a);if(!SC.none(c)&&c!==0){d=Math.round(d/c)*c}if(d!==0){d=Math.floor((d-b)/(a-b)*100)}return d}.property("value","minimum","maximum","step").cacheable(),_isMouseDown:NO,mouseDown:function(a){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;return this._triggerHandle(a,YES)},mouseDragged:function(a){return this._isMouseDown?this._triggerHandle(a):YES},mouseUp:function(a){if(this._isMouseDown){this.set("isActive",NO)}var b=this._isMouseDown?this._triggerHandle(a):YES;this._isMouseDown=NO;return b},mouseWheel:function(b){if(!this.get("isEnabled")){return YES}var d=this.get("minimum"),a=this.get("maximum"),e=this.get("step"),c=this.get("value")+((b.wheelDeltaX+b.wheelDeltaY)*e),f=Math.round(c/e)*e;if(c<d){this.setIfChanged("value",d)}else{if(c>a){this.setIfChanged("value",a)}else{this.setIfChanged("value",c)}}return YES},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},touchesDragged:function(a){return this.mouseDragged(a)},_triggerHandle:function(i,e){var a=this.get("frame").width,c=this.get("minimum"),f=this.get("maximum"),b=this.get("step"),h=this.get("value"),d;if(e){d=this.convertFrameFromView({x:i.pageX}).x;this._evtDiff=i.pageX-d}else{d=i.pageX-this._evtDiff}d=Math.max(0,Math.min(d/a,1));if(e){var g=this.get("value");g=(g-c)/(f-c);if(Math.abs(g*a-d*a)<16){this._offset=g-d}else{this._offset=0}}d=Math.max(0,Math.min(d+this._offset,1));d=c+((f-c)*d);if(b!==0){d=Math.round(d/b)*b}if(Math.abs(h-d)>=0.01){this.set("value",d)}return YES},acceptsFirstResponder:function(){if(SC.FOCUS_ALL_CONTROLS){return this.get("isEnabled")}return NO}.property("isEnabled"),keyDown:function(h){if(h.which===9||h.keyCode===9){var f=h.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(f){f.becomeFirstResponder()}else{h.allowDefault()}return YES}if(h.which>=33&&h.which<=40){var d=this.get("minimum"),g=this.get("maximum"),b=this.get("step"),i=g-d,a=0,c,e=this.get("value");if(h.which===37||h.which===38||h.which===34){if(b===0){if(i<100){a=e-1}else{c=Math.abs(i/100);if(c<2){c=2}a=e-c}}else{a=e-b}}if(h.which===39||h.which===40||h.which===33){if(b===0){if(i<100){a=e+2}else{c=Math.abs(i/100);if(c<2){c=2}a=e+c}}else{a=e+b}}if(h.which===36){a=g}if(h.which===35){a=d}if(a>=d&&a<=g){this.set("value",a)}}else{h.allowDefault();return NO}return YES},contentKeys:{contentValueKey:"value",contentMinimumKey:"minimum",contentMaximumKey:"maximum",contentIsIndeterminateKey:"isIndeterminate"}});sc_require("mixins/collection_group");sc_require("views/disclosure");SC.SourceListGroupView=SC.View.extend(SC.Control,SC.CollectionGroup,{classNames:["sc-source-list-group"],content:null,isGroupVisible:YES,hasGroupTitle:YES,groupTitleKey:null,groupVisibleKey:null,render:function(a,b){a.push('<div role="button" class="sc-source-list-label sc-disclosure-view sc-button-view button disclosure no-disclosure">','<img src="'+SC.BLANK_IMAGE_URL+'" class="button" />','<span class="label"></span></div>')},createChildViews:function(){},contentPropertyDidChange:function(f,c){var e=this.get("content");var h=this.outlet("labelView");if(e===null){h.setIfChanged("isVisible",NO);this.setIfChanged("hasGroupTitle",NO);return}else{h.setIfChanged("isVisible",YES);this.setIfChanged("hasGroupTitle",YES)}var b=this.getDelegateProperty("groupTitleKey",this.displayDelegate);if((c=="*")||(b&&(c==b))){var g=(e&&e.get&&b)?e.get(b):e;if(g!=this._title){this._title=g;if(g){g=g.capitalize()}h.set("title",g)}}var d=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);if((c=="*")||(d&&(c==d))){if(d){h.removeClassName("no-disclosure");var a=(e&&e.get)?!!e.get(d):YES;if(a!=this.get("isGroupVisible")){this.set("isGroupVisible",a);h.set("value",a)}}else{h.addClassName("no-disclosure")}}},disclosureValueDidChange:function(c){if(c==this.get("isGroupVisible")){return}var b=this.get("content");var a=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);if(b&&b.set&&a){b.set(a,c)}this.set("isGroupVisible",c);if(this.owner&&this.owner.updateChildren){this.owner.updateChildren(true)}},labelView:SC.DisclosureView.extend({value:YES,_valueObserver:function(){if(this.owner){this.owner.disclosureValueDidChange(this.get("value"))}}.observes("value")})});sc_require("views/list");sc_require("views/source_list_group");SC.SourceListView=SC.ListView.extend({theme:"source-list",classNames:["sc-source-list"],rowHeight:32,selectOnMouseDown:NO,actOnSelect:YES});SC.SplitDividerView=SC.View.extend({classNames:["sc-split-divider-view"],mouseDown:function(a){var b=this.get("splitView");return(b)?b.mouseDownInThumbView(a,this):arguments.callee.base.apply(this,arguments)},doubleClick:function(a){var b=this.get("splitView");return(b)?b.doubleClickInThumbView(a,this):arguments.callee.base.apply(this,arguments)},touchStart:function(a){return this.mouseDown(a)}});sc_require("views/split_divider");SC.RESIZE_BOTH="resize-both";SC.RESIZE_TOP_LEFT="resize-top-left";SC.RESIZE_BOTTOM_RIGHT="resize-bottom-right";SC.SplitView=SC.View.extend({classNames:["sc-split-view"],displayProperties:["layoutDirection"],delegate:null,layoutDirection:SC.LAYOUT_HORIZONTAL,canCollapseViews:YES,autoresizeBehavior:SC.RESIZE_BOTTOM_RIGHT,defaultThickness:0.5,topLeftMinThickness:null,topLeftMaxThickness:null,bottomRightMinThickness:null,bottomRightMaxThickness:null,dividerThickness:null,isSplitView:YES,topLeftView:SC.View,dividerView:SC.SplitDividerView,bottomRightView:SC.View,topLeftThickness:function(){var a=this.get("topLeftView");return a?this.thicknessForView(a):0}.property("topLeftView").cacheable(),bottomRightThickness:function(){var a=this.get("bottomRightView");return a?this.thicknessForView(a):0}.property("bottomRightView").cacheable(),thumbViewCursor:null,canCollapseView:function(a){return this.invokeDelegateMethod(this.delegate,"splitViewCanCollapse",this,a)},thicknessForView:function(a){var c=this.get("layoutDirection"),b=a.get("frame");return(c===SC.LAYOUT_HORIZONTAL)?b.width:b.height},createChildViews:function(){var e=[],c=["topLeftView","dividerView","bottomRightView"],b=c.length,a,d;for(d=0;d<b;++d){if(a=this.get(c[d])){a=this[c[d]]=this.createChildView(a,{layoutView:this,rootElementPath:[d]});e.push(a)}}this.set("childViews",e);return this},updateChildLayout:function(){var b=this.get("topLeftView"),c=this.get("bottomRightView"),i=this.get("dividerView"),e=this.get("autoresizeBehavior"),j=this.get("layoutDirection"),a=this.get("frame"),d=this._desiredTopLeftThickness,k=this.get("dividerThickness"),h=(j===SC.LAYOUT_HORIZONTAL)?a.width:a.height,l=h-k-d,g,f;k=(!SC.none(k))?k:7;f=b.get("isCollapsed")||NO;b.setIfChanged("isVisible",!f);g=SC.clone(b.get("layout"));if(j===SC.LAYOUT_HORIZONTAL){g.top=0;g.left=0;g.bottom=0;switch(e){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:g.right=l+k;delete g.width;break;case SC.RESIZE_BOTTOM_RIGHT:delete g.right;delete g.height;g.width=d;break}}else{g.top=0;g.left=0;g.right=0;switch(e){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:g.bottom=l+k;delete g.height;break;case SC.RESIZE_BOTTOM_RIGHT:g.height=d;delete g.bottom;delete g.width;break}}b.set("layout",g);if(i){g=SC.clone(i.get("layout"));if(j===SC.LAYOUT_HORIZONTAL){g.width=k;g.top=0;g.bottom=0;delete g.height;switch(e){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:g.right=l;delete g.left;delete g.centerX;delete g.centerY;break;case SC.RESIZE_BOTTOM_RIGHT:g.left=d;delete g.right;delete g.centerX;delete g.centerY;break}}else{g.height=k;g.left=0;g.right=0;delete g.width;switch(e){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:g.bottom=l;delete g.top;delete g.centerX;delete g.centerY;break;case SC.RESIZE_BOTTOM_RIGHT:g.top=d;delete g.bottom;delete g.centerX;delete g.centerY;break}}i.set("layout",g)}f=c.get("isCollapsed")||NO;c.setIfChanged("isVisible",!f);g=SC.clone(c.get("layout"));if(j===SC.LAYOUT_HORIZONTAL){g.top=0;g.bottom=0;g.right=0;switch(e){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_BOTTOM_RIGHT:g.left=d+k;delete g.width;break;case SC.RESIZE_TOP_LEFT:g.width=l;delete g.left;break}}else{g.left=0;g.right=0;g.bottom=0;switch(e){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_BOTTOM_RIGHT:g.top=d+k;delete g.height;break;case SC.RESIZE_TOP_LEFT:delete g.top;g.height=l;break}}c.set("layout",g);this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")},renderLayout:function(b,a){if(a||this._recalculateDivider){var f=this.get("layoutDirection"),c=this.get("frame"),e=this.$(),i=this.get("defaultThickness"),d=this.get("autoresizeBehavior"),h=this.get("dividerThickness"),g;if(!this.get("thumbViewCursor")){this.set("thumbViewCursor",SC.Cursor.create())}h=!SC.none(h)?h:7;if(this._recalculateDivider===undefined&&i<1){this._recalculateDivider=YES}else{if(this._recalculateDivider){this._recalculateDivider=NO}}if(e[0]){g=(f===SC.LAYOUT_HORIZONTAL)?e[0].offsetWidth:e[0].offsetHeight}else{g=(f===SC.LAYOUT_HORIZONTAL)?c.width:c.height}if(SC.none(i)||(i>0&&i<1)){i=Math.floor((g-(h))*(i||0.5))}if(d===SC.RESIZE_BOTTOM_RIGHT){this._desiredTopLeftThickness=i}else{this._desiredTopLeftThickness=g-h-i}this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");this._updateTopLeftThickness(0);this._setCursorStyle();this.updateChildLayout()}arguments.callee.base.apply(this,arguments)},render:function(a,b){arguments.callee.base.apply(this,arguments);if(this._inLiveResize){this._setCursorStyle()}if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){a.addClass("sc-horizontal")}else{a.addClass("sc-vertical")}},mouseDownInThumbView:function(a,c){var b=this.getPath("pane.rootResponder");if(!b){return NO}b.dragDidStart(this);this._mouseDownX=a.pageX;this._mouseDownY=a.pageY;this._thumbView=c;this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");this.beginLiveResize();this._inLiveResize=YES;return YES},mouseDragged:function(a){var b=(this._layoutDirection===SC.LAYOUT_HORIZONTAL)?a.pageX-this._mouseDownX:a.pageY-this._mouseDownY;this._updateTopLeftThickness(b);return YES},mouseUp:function(a){if(this._inLiveResize===YES){this._thumbView=null;this._inLiveResize=NO;this.endLiveResize();return YES}this._setCursorStyle();return NO},touchesDragged:function(a){return this.mouseDragged(a)},touchEnd:function(a){return this.mouseUp(a)},doubleClickInThumbView:function(b,d){var a=this._topLeftView,c=a.get("isCollapsed")||NO;if(!c&&!this.canCollapseView(a)){a=this._bottomRightView;c=a.get("isCollapsed")||NO;if(!c&&!this.canCollapseView(a)){return NO}}if(!c){this._uncollapsedThickness=this.thicknessForView(a);if(a===this._topLeftView){this._updateTopLeftThickness(this.topLeftThickness()*-1)}else{this._updateBottomRightThickness(this.bottomRightThickness()*-1)}if(!a.get("isCollapsed")){this._uncollapsedThickness=null}}else{if(a===this._topLeftView){this._updateTopLeftThickness(this._uncollapsedThickness)}else{this._updateBottomRightThickness(this._uncollapsedThickness)}a._uncollapsedThickness=null}this._setCursorStyle();return true},_updateTopLeftThickness:function(e){var a=this._topLeftView,c=this._bottomRightView,f=this.thicknessForView(a),g=this.thicknessForView(c),j=this._dividerThickness,i=0,b=this._topLeftViewThickness+e,m=this._layoutDirection,o=this.canCollapseView(c),l=b,k=this.get("topLeftMaxThickness"),d=this.get("topLeftMinThickness"),n,h,p;if(!a.get("isCollapsed")){i+=f}if(!c.get("isCollapsed")){i+=g}if(!SC.none(k)){l=Math.min(k,l)}if(!SC.none(d)){l=Math.max(d,l)}k=this.get("bottomRightMaxThickness");d=this.get("bottomRightMinThickness");n=i-l;if(!SC.none(k)){n=Math.min(k,n)}if(!SC.none(d)){n=Math.max(d,n)}l=i-n;l=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,a,l);l=Math.min(l,i);l=Math.max(0,l);h=a.get("collapseAtThickness");if(!h){h=0}p=c.get("collapseAtThickness");p=SC.none(p)?i:(i-p);if((b<=h)&&this.canCollapseView(a)){k=c.get("maxThickness");if(!k||(j+i)<=k){l=0}}else{if(b>=p&&this.canCollapseView(c)){k=a.get("maxThickness");if(!k||(j+i)<=k){l=i}}}if(l!=this.thicknessForView(a)){this._desiredTopLeftThickness=l;a.set("isCollapsed",l===0);c.set("isCollapsed",l>=i);this.updateChildLayout();this.displayDidChange()}},_updateBottomRightThickness:function(e){var a=this._topLeftView,c=this._bottomRightView,f=this.thicknessForView(a),g=this.thicknessForView(c),j=this._dividerThickness,i=0,b=this._topLeftViewThickness+e,m=this._layoutDirection,o=this.canCollapseView(c),l=b,k=this.get("topLeftMaxThickness"),d=this.get("topLeftMinThickness"),n,h,p;if(!a.get("isCollapsed")){i+=f}if(!c.get("isCollapsed")){i+=g}if(!SC.none(k)){l=Math.min(k,l)}if(!SC.none(d)){l=Math.max(d,l)}k=this.get("bottomRightMaxThickness");d=this.get("bottomRightMinThickness");n=i-l;if(!SC.none(k)){n=Math.min(k,n)}if(!SC.none(d)){n=Math.max(d,n)}l=i-n;l=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,a,l);l=Math.min(l,i);l=Math.max(0,l);h=a.get("collapseAtThickness");if(!h){h=0}p=c.get("collapseAtThickness");p=SC.none(p)?i:(i-p);if((b<=h)&&this.canCollapseView(a)){k=c.get("maxThickness");if(!k||(j+i)<=k){l=0}}else{if(b>=p&&this.canCollapseView(c)){k=a.get("maxThickness");if(!k||(j+i)<=k){l=i}}}if(l!=this.thicknessForView(a)){this._desiredTopLeftThickness=l;a.set("isCollapsed",l===0);c.set("isCollapsed",l>=i);this.updateChildLayout();this.displayDidChange()}},_setCursorStyle:function(){var e=this._topLeftView,f=this._bottomRightView,b=this.get("thumbViewCursor"),c=this.thicknessForView(e),d=this.thicknessForView(f),a=this.get("dividerView");this._layoutDirection=this.get("layoutDirection");if(e.get("isCollapsed")||c===this.get("topLeftMinThickness")||d==this.get("bottomRightMaxThickness")){b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"s-resize")}else{if(f.get("isCollapsed")||c===this.get("topLeftMaxThickness")||d==this.get("bottomRightMinThickness")){b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"w-resize":"n-resize")}else{if(SC.browser.isIE){b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"n-resize")}else{b.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"ew-resize":"ns-resize")}}}a.set("cursor",b);if(this._inLiveResize){this.set("cursor",b)}}.observes("layoutDirection"),splitViewCanCollapse:function(b,a){if(b.get("canCollapseViews")===NO){return NO}if(a.get("canCollapse")===NO){return NO}return YES},splitViewConstrainThickness:function(c,a,b){return b},_forceSplitCalculation:function(){this.updateLayout()}.observes("*pane.isPaneAttached"),viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")}.observes("layout")});SC.mixin(SC.View.prototype,{splitView:function(){var a=this;while(a&&!a.isSplitView){a=a.get("parentView")}return a}.property("parentView").cacheable()});sc_require("views/collection");SC.StackedView=SC.CollectionView.extend({classNames:["sc-stacked-view"],layout:{top:0,left:0,right:0,height:1},computeNowShowing:function(a){return this.get("allContentIndexes")},updateHeight:function(a){if(a){this._updateHeight()}else{this.invokeLast(this._updateHeight)}return this},_updateHeight:function(){var e=this.get("childViews"),b=e.get("length"),c,d,a;if(b===0){a=1}else{c=e.objectAt(b-1);d=c?c.get("layer"):null;a=d?(d.offsetTop+d.offsetHeight):1;d=null}this.adjust("height",a)},didReload:function(a){return this.updateHeight()},didCreateLayer:function(){return this.updateHeight()}});SC.StaticContentView=SC.View.extend(SC.StaticLayout,{classNames:["sc-static-content-view"],displayProperties:["content"],content:null,contentLayoutDidChange:function(){this._viewFrameDidChange()},useStaticLayout:YES,frame:function(){var a=this.get("layer"),b;if(!a){return{x:0,y:0,width:0,height:0}}if(a.getBoundingClientRect&&!SC.browser.isIE8OrLower){b=a.getBoundingClientRect();return{x:0,y:0,width:b.width,height:b.height}}else{return{x:0,y:0,width:a.clientWidth,height:a.clientHeight}}}.property("content").cacheable(),parentViewDidResize:function(){this.contentLayoutDidChange()},didUpdateLayer:function(){this.contentLayoutDidChange()},render:function(a,c){var b=this.get("content");a.push(b||"")},touchStart:function(a){a.allowDefault();return YES},touchEnd:function(a){a.allowDefault();return YES}});sc_require("views/segmented");SC.TOP_LOCATION="top";SC.TOP_TOOLBAR_LOCATION="top-toolbar";SC.BOTTOM_LOCATION="bottom";SC.TabView=SC.View.extend({classNames:["sc-tab-view"],displayProperties:["nowShowing"],nowShowing:null,items:[],isEnabled:YES,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemToolTipKey:null,tabHeight:SC.REGULAR_BUTTON_HEIGHT,tabLocation:SC.TOP_LOCATION,userDefaultKey:null,_tab_nowShowingDidChange:function(){var a=this.get("nowShowing");this.get("containerView").set("nowShowing",a);this.get("segmentedView").set("value",a);return this}.observes("nowShowing"),_tab_saveUserDefault:function(){var a=this.get("nowShowing");var b=this.get("userDefaultKey");if(b){SC.userDefaults.set([b,"nowShowing"].join(":"),a)}}.observes("nowShowing"),_tab_itemsDidChange:function(){this.get("segmentedView").set("items",this.get("items"));return this}.observes("items"),init:function(){arguments.callee.base.apply(this,arguments);this._tab_nowShowingDidChange()._tab_itemsDidChange()},awake:function(){arguments.callee.base.apply(this,arguments);var a=this.get("userDefaultKey");if(a){a=[a,"nowShowing"].join(":");var b=SC.userDefaults.get(a);if(!SC.none(b)){this.set("nowShowing",b)}}},createChildViews:function(){var e=[],d,c,b=this.get("tabLocation"),a=this.get("tabHeight"),f=this.get("controlSize");if(b===SC.TOP_LOCATION){c={top:a/2+1,left:0,right:0,bottom:0,border:1}}else{if(b===SC.TOP_TOOLBAR_LOCATION){c={top:a+1,left:0,right:0,bottom:0,border:1}}else{c={top:0,left:0,right:0,bottom:(a/2)-1,border:1}}}d=this.containerView.extend({layout:c,ariaRole:"tabpanel"});this.containerView=this.createChildView(d);c=(b===SC.TOP_LOCATION||b===SC.TOP_TOOLBAR_LOCATION)?{height:a,left:0,right:0,top:0}:{height:a,left:0,right:0,bottom:0};this.segmentedView=this.get("segmentedView").extend({layout:c,controlSize:f,_sc_tab_segmented_valueDidChange:function(){var g=this.get("parentView");if(g){g.set("nowShowing",this.get("value"))}}.observes("value"),init:function(){var g=this.get("parentView");if(g){SC._TAB_ITEM_KEYS.forEach(function(h){this[h]=g.get(h)},this)}return arguments.callee.base.apply(this,arguments)}});this.segmentedView=this.createChildView(this.segmentedView);e.push(this.segmentedView);e.push(this.containerView);this.set("childViews",e);return this},containerView:SC.ContainerView.extend({renderDelegateName:"wellRenderDelegate"}),segmentedView:SC.SegmentedView});SC._TAB_ITEM_KEYS=["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemWidthKey","itemToolTipKey","itemActionKey","itemTargetKey"];SC.ThumbView=SC.View.extend({classNames:["sc-thumb-view"],isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),prepareContext:function(a,c){var b=this.get("splitView");if(b){this.set("cursor",b.get("thumbViewCursor"))}return arguments.callee.base.apply(this,arguments)},mouseDown:function(a){if(!this.get("isEnabled")){return NO}var b=this.get("splitView");return(b)?b.mouseDownInThumbView(a,this):arguments.callee.base.apply(this,arguments)},touchStart:function(a){return this.mouseDown(a)}});SC.WebView=SC.View.extend(SC.Control,{classNames:"sc-web-view",displayProperties:["value","shouldAutoResize"],shouldAutoResize:NO,render:function(a,d){var c=this.get("value")||"",b;if(d){a.push('<iframe src="'+c+'" style="position: absolute; width: 100%; height: 100%; border: 0px; margin: 0px; padding: 0px;"></iframe>')}else{if(c!==this._lastSrc){b=this.$("iframe");b.attr("src","javascript:;");b.attr("src",c)}}this._lastSrc=c},didCreateLayer:function(){var a=this.$("iframe");SC.Event.add(a,"load",this,this.iframeDidLoad)},willDestroyLayer:function(){var a=this.$("iframe");SC.Event.remove(a,"load",this,this.iframeDidLoad)},iframeDidLoad:function(){if(this.get("shouldAutoResize")===YES){var a;var c=this.$("iframe")[0];if(c&&c.contentWindow){a=c.contentWindow;if(a&&a.document&&a.document.documentElement){var b=a.document.documentElement;if(!SC.browser.isIE){this.$().width(b.scrollWidth);this.$().height(b.scrollHeight)}else{this.$().width(b.scrollWidth+12);this.$().height(b.scrollHeight+5)}}}}}});SC.WELL_CONTAINER_PADDING=15;SC.WellView=SC.ContainerView.extend({classNames:"sc-well-view",contentLayout:{top:SC.WELL_CONTAINER_PADDING,bottom:SC.WELL_CONTAINER_PADDING,left:SC.WELL_CONTAINER_PADDING,right:SC.WELL_CONTAINER_PADDING},renderDelegateName:"wellRenderDelegate",createChildViews:function(){var a=this.get("contentView");if(a){a=this.contentView=this.createChildView(a);a.set("layout",this.contentLayout);this.childViews=[a]}},contentViewDidChange:function(){var a=this.get("contentView");a.set("layout",this.contentLayout);this.replaceContent(a)}.observes("contentView")});SC.MIXED_STATE="__MIXED__";SC.DataSource=SC.Object.extend({fetch:function(a,b){return NO},retrieveRecords:function(a,c,b){return this._handleEach(a,c,this.retrieveRecord,b)},commitRecords:function(c,b,g,f,h){var e,a,d;if(b.length>0){d=this.createRecords.call(this,c,b,h)}if(g.length>0){e=this.updateRecords.call(this,c,g,h);d=SC.none(d)?e:(d===e)?d:SC.MIXED_STATE}if(f.length>0){a=this.destroyRecords.call(this,c,f,h);d=SC.none(d)?a:(d===a)?d:SC.MIXED_STATE}return d||NO},cancel:function(a,b){return NO},updateRecords:function(a,b,c){return this._handleEach(a,b,this.updateRecord,null,c)},createRecords:function(a,b,c){return this._handleEach(a,b,this.createRecord,null,c)},destroyRecords:function(a,b,c){return this._handleEach(a,b,this.destroyRecord,null,c)},_handleEach:function(h,e,c,a,b){var f=e.length,i,g,j,d;for(i=0;i<f;i++){d=a?a[i]:b;j=c.call(this,h,e[i],d);if(g===undefined){g=j}else{if(g===YES){g=(j===YES)?YES:SC.MIXED_STATE}else{if(g===NO){g=(j===NO)?NO:SC.MIXED_STATE}}}}return !SC.none(g)?g:null},updateRecord:function(a,b,c){return NO},retrieveRecord:function(a,b,c){return NO},createRecord:function(a,b,c){return NO},destroyRecord:function(a,b,c){return NO}});sc_require("data_sources/data_source");SC.CascadeDataSource=SC.DataSource.extend({dataSources:null,from:function(a){var b=this.get("dataSources");if(!b){this.set("dataSources",b=[])}b.push(a);return this},fetch:function(c,g){var e=this.get("dataSources"),b=e?e.length:0,d=NO,h,f,a;for(a=0;(d!==YES)&&a<b;a++){f=e.objectAt(a);h=f.fetch?f.fetch.apply(f,arguments):NO;d=this._handleResponse(d,h)}return d},retrieveRecords:function(h,d,b){var c=this.get("dataSources"),e=c?c.length:0,f=NO,i,a,g;for(g=0;(f!==YES)&&g<e;g++){a=c.objectAt(g);i=a.retrieveRecords.apply(a,arguments);f=this._handleResponse(f,i)}return f},commitRecords:function(j,c,h,e,d){var b=this.get("dataSources"),f=b?b.length:0,g=NO,k,a,i;for(i=0;(g!==YES)&&i<f;i++){a=b.objectAt(i);k=a.commitRecords.apply(a,arguments);g=this._handleResponse(g,k)}return g},cancel:function(c,f){var e=this.get("dataSources"),b=e?e.length:0,d=NO,h,g,a;for(a=0;(d!==YES)&&a<b;a++){g=e.objectAt(a);h=g.cancel.apply(g,arguments);d=this._handleResponse(d,h)}return d},init:function(){arguments.callee.base.apply(this,arguments);var b=this.get("dataSources"),a=b?b.get("length"):0,c;while(--a>=0){c=b[a];if(SC.typeOf(c)===SC.T_STRING){b[a]=this.get(c)}}},_handleResponse:function(b,a){if(a===YES){return YES}else{if(b===NO){return(a===NO)?NO:SC.MIXED_STATE}else{return SC.MIXED_STATE}}}});sc_require("core");sc_require("models/record");SC.Query=SC.Object.extend(SC.Copyable,SC.Freezable,{isQuery:YES,conditions:null,orderBy:null,recordType:null,recordTypes:null,expandedRecordTypes:function(){var b=SC.CoreSet.create(),a,c;if(a=this.get("recordType")){this._scq_expandRecordType(a,b)}else{if(a=this.get("recordTypes")){a.forEach(function(d){this._scq_expandRecordType(d,b)},this)}else{this._scq_expandRecordType(SC.Record,b)}}c=SC.Query._scq_queriesWithExpandedRecordTypes;if(!c){c=SC.Query._scq_queriesWithExpandedRecordTypes=SC.CoreSet.create()}c.add(this);return b.freeze()}.property("recordType","recordTypes").cacheable(),_scq_expandRecordType:function(b,a){if(a.contains(b)){return}a.add(b);if(SC.typeOf(b)===SC.T_STRING){b=SC.objectForPropertyPath(b)}b.subclasses.forEach(function(c){this._scq_expandRecordType(c,a)},this)},parameters:null,location:"local",scope:null,isRemote:function(){return this.get("location")===SC.Query.REMOTE}.property("location").cacheable(),isLocal:function(){return this.get("location")===SC.Query.LOCAL}.property("location").cacheable(),isEditable:NO,contains:function(a,d){var e,b=YES;if(e=this.get("recordTypes")){b=e.find(function(f){return SC.kindOf(a,f)})}else{if(e=this.get("recordType")){b=SC.kindOf(a,e)}}if(!b){return NO}var c=this.get("scope");if(c&&!c.contains(a)){return NO}if(!this._isReady){this.parse()}if(!this._isReady){return NO}if(d===undefined){d=this.parameters||this}return this._tokenTree.evaluate(a,d)},containsRecordTypes:function(a){var b=this.get("recordType");if(b){return !!a.find(function(c){return SC.kindOf(c,b)})}else{if(b=this.get("recordTypes")){return !!b.find(function(c){return !!a.find(function(d){return SC.kindOf(d,c)})})}else{return YES}}},compare:function(b,a){var j=0,e,c,f,d,g;if(b===a){return 0}function h(m,l){var k=m.get("storeKey"),i=l.get("storeKey");if(k<i){return -1}if(k>i){return 1}return 0}if(!this._isReady){this.parse()}if(!this._isReady){return h(b,a)}c=this._order;if((typeof c==="function")&&!c.isClass){j=c.call(null,b,a)}else{f=c?c.length:0;for(d=0;j===0&&(d<f);d++){e=c[d].propertyName;g=/\./.test(e)?"getPath":"get";if(SC.Query.comparisons[e]){j=SC.Query.comparisons[e](b[g](e),a[g](e))}else{j=SC.compare(b[g](e),a[g](e))}if((j!==0)&&c[d].descending){j=(-1)*j}}}if(j!==0){return j}return h(b,a)},_isReady:NO,parse:function(){var c=this.get("conditions"),d=this.get("queryLanguage"),b,a;b=this._tokenList=this.tokenizeString(c,d);a=this._tokenTree=this.buildTokenTree(b,d);this._order=this.buildOrder(this.get("orderBy"));this._isReady=!!a&&!a.error;if(a&&a.error){throw a.error}return this._isReady},queryWithScope:function(c){var b=SC.keyFor("__query__",SC.guidFor(this)),a=c[b];if(!a){c[b]=a=this.copy();a.set("scope",c);a.freeze()}return a},copyKeys:["conditions","orderBy","recordType","recordTypes","parameters","location","scope"],concatenatedProperties:["copyKeys"],copy:function(){var d={},c=this.get("copyKeys"),f=c?c.length:0,b,e,a;while(--f>=0){b=c[f];e=this.get(b);if(e!==undefined){d[b]=e}}a=this.constructor.create(d);d=null;return a},queryLanguage:{UNKNOWN:{firstCharacter:/[^\s'"\w\d\(\)\{\}]/,notAllowed:/[\-\s'"\w\d\(\)\{\}]/},PROPERTY:{firstCharacter:/[a-zA-Z_]/,notAllowed:/[^a-zA-Z_0-9\.]/,evalType:"PRIMITIVE",evaluate:function(e,b){var f=this.tokenValue.split(".");var a=f.length;if(a<2){return e.get(this.tokenValue)}var c=e;for(var d=0;d<a;d++){if(!c){return}if(c.get){c=c.get(f[d])}else{c=c[f[d]]}}return c}},NUMBER:{firstCharacter:/[\d\-]/,notAllowed:/[^\d\-\.]/,format:/^-?\d+$|^-?\d+\.\d+$/,evalType:"PRIMITIVE",evaluate:function(b,a){return parseFloat(this.tokenValue)}},STRING:{firstCharacter:/['"]/,delimited:true,evalType:"PRIMITIVE",evaluate:function(b,a){return this.tokenValue}},PARAMETER:{firstCharacter:/\{/,lastCharacter:"}",delimited:true,evalType:"PRIMITIVE",evaluate:function(b,a){return a[this.tokenValue]}},"%@":{rememberCount:true,reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return a[this.tokenValue]}},OPEN_PAREN:{firstCharacter:/\(/,singleCharacter:true},CLOSE_PAREN:{firstCharacter:/\)/,singleCharacter:true},AND:{reservedWord:true,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return d&&b}},OR:{reservedWord:true,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return d||b}},NOT:{reservedWord:true,rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(c,a){var b=this.rightSide.evaluate(c,a);return !b}},"=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.isEqual(d,b)}},"!=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return !SC.isEqual(d,b)}},"<":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)==-1}},"<=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)!=1}},">":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)==1}},">=":{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return SC.compare(d,b)!=-1}},BEGINS_WITH:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var b=this.leftSide.evaluate(c,a);var d=this.rightSide.evaluate(c,a);return(b&&b.indexOf(d)===0)}},ENDS_WITH:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(d,b){var c=this.leftSide.evaluate(d,b);var a=this.rightSide.evaluate(d,b);return(c&&c.length>=a.length&&c.lastIndexOf(a)===(c.length-a.length))}},CONTAINS:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,a){var d=this.leftSide.evaluate(e,a)||[];var g=this.rightSide.evaluate(e,a);var c=SC.typeOf(d);if(c===SC.T_STRING){return(d.indexOf(g)!==-1)}else{if(c===SC.T_ARRAY||d.toArray){if(c!==SC.T_ARRAY){d=d.toArray()}var f=false;var b=0;while(f===false&&b<d.length){if(g==d[b]){f=true}b++}return f}}}},ANY:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(d,a){var f=this.leftSide.evaluate(d,a);var b=this.rightSide.evaluate(d,a);var e=false;var c=0;while(e===false&&c<b.length){if(f==b[c]){e=true}c++}return e}},MATCHES:{reservedWord:true,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(c,a){var d=this.leftSide.evaluate(c,a);var b=this.rightSide.evaluate(c,a);return b.test(d)}},TYPE_IS:{reservedWord:true,rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(d,a){var c=SC.Store.recordTypeFor(d.storeKey);var b=this.rightSide.evaluate(d,a);var e=SC.objectForPropertyPath(b);return c==e}},"null":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return null}},"undefined":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return undefined}},"false":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return false}},"true":{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return true}},YES:{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return true}},NO:{reservedWord:true,evalType:"PRIMITIVE",evaluate:function(b,a){return false}}},tokenizeString:function(u,p){var j=[],r=null,g=null,f=null,s=null,a=null,h=null,d=null,v=null,q=false,b=false,l=false,m=false,n={};function e(t,c){g=p[t];if(g.format&&!g.format.test(c)){t="UNKNOWN"}if(g.delimited){m=true}if(!g.delimited){for(var i in p){if(p[i].reservedWord&&i==c){t=i}}}g=p[t];if(g&&g.rememberCount){if(!n[t]){n[t]=0}c=n[t];n[t]+=1}j.push({tokenType:t,tokenValue:c});a=null;h=null;d=null}if(!u){return[]}var k=u.length;for(var o=0;o<k;o++){q=(o===k-1);r=u.charAt(o);m=false;if(a){g=p[a];b=g.delimited?r===v:g.notAllowed.test(r);if(!b){d+=r}if(b||q){e(a,d)}if(q&&!b){m=true}}if(!a&&!m){for(f in p){g=p[f];if(g.firstCharacter&&g.firstCharacter.test(r)){a=f}}if(a){g=p[a];d=r;if(g.delimited){d="";if(g.lastCharacter){v=g.lastCharacter}else{v=r}}if(g.singleCharacter||q){e(a,d)}}}}return j},buildTokenTree:function(k,a){var o=k.slice();var q=0;var s=[];var c=false;var p=[];if(!k||k.length===0){return{evaluate:function(){return true}}}function r(i){var v=i;if(v<0){return false}var l=a[o[v].tokenType];if(!l){p.push("logic for token '"+o[v].tokenType+"' is not defined");return false}o[v].evaluate=l.evaluate;return l}function b(v,i){var w=i;var l=r(w);if(!l){return false}if(v=="left"){return l.leftType}if(v=="right"){return l.rightType}}function n(i){var v=i;var l=r(v);if(!l){return false}else{return l.evalType}}function f(i){o.splice(i,1);if(i<=q){q--}}function t(i){var l=i||q;if(l>0){return true}else{return false}}function j(i){var l=i;if(l<0){return true}return(b("left",l)&&!o[l].leftSide)||(b("right",l)&&!o[l].rightSide)}function h(l,v){var i=(v<l)?"left":"right";if(l<0||v<0){return false}if(!b(i,l)){return false}if(!n(v)){return false}if(b(i,l)==n(v)){return true}else{return false}}function m(i){var l=i;if(!j(l)){return false}if(!t(l)){return false}if(h(l,l-1)){return true}else{return false}}function d(i){var l=i;if(j(l)){return false}if(!t(l)){return false}if(!j(l-1)){return false}if(h(l-1,l)){return true}else{return false}}function g(i){var l=i;if(l<1){return false}o[l].leftSide=o[l-1];f(l-1)}function u(i){var l=i;if(l<1){return false}o[l-1].rightSide=o[l];f(l)}function e(i){f(i);f(s.pop())}for(q=0;q<o.length;q++){c=false;if(o[q].tokenType=="UNKNOWN"){p.push("found unknown token: "+o[q].tokenValue)}if(o[q].tokenType=="OPEN_PAREN"){s.push(q)}if(o[q].tokenType=="CLOSE_PAREN"){e(q)}if(m(q)){g(q)}if(d(q)){u(q);c=true}if(c){q--}}if(o.length==1){o=o[0]}else{p.push("string did not resolve to a single tree")}if(p.length>0){return{error:p.join(",\n"),tree:o}}else{return o}},buildOrder:function(a){if(!a){return[]}else{if(SC.typeOf(a)===SC.T_FUNCTION){return a}else{var d=a.split(",");for(var b=0;b<d.length;b++){var c=d[b];c=c.replace(/^\s+|\s+$/,"");c=c.replace(/\s+/,",");c=c.split(",");d[b]={propertyName:c[0]};if(c[1]&&c[1]=="DESC"){d[b].descending=true}}return d}}}});SC.Query.mixin({LOCAL:"local",REMOTE:"remote",storeKeyFor:function(a){return a?a.get("storeKey"):null},containsRecords:function(g,e,d){var f=[];for(var b=0,a=e.get("length");b<a;b++){var c=e.objectAt(b);if(c&&g.contains(c)){f.push(c.get("storeKey"))}}f=SC.Query.orderStoreKeys(f,g,d);return f},orderStoreKeys:function(c,d,a){if(c){var b=c.sort(function(f,e){return SC.Query.compareStoreKeys(d,a,f,e)})}return c},compareStoreKeys:function(f,c,e,d){var b=c.materializeRecord(e),a=c.materializeRecord(d);return f.compare(b,a)},build:function(h,c,g,d){var a=null,f,b,i,e;if(c&&c.isQuery){if(c.get("location")===h){return c}else{return c.copy().set("location",h).freeze()}}if(typeof c===SC.T_STRING){f=SC.objectForPropertyPath(c);if(!f){throw"%@ did not resolve to a class".fmt(c)}c=f}else{if(c&&c.isEnumerable){f=[];c.forEach(function(j){if(typeof j===SC.T_STRING){j=SC.objectForPropertyPath(j)}if(!j){throw"cannot resolve record types: %@".fmt(c)}f.push(j)},this);c=f}else{if(!c){c=SC.Record}}}if(d===undefined){d=null}if(g===undefined){g=null}if(!d&&(typeof g!==SC.T_STRING)){a=g;g=null}if(!d&&!a){e=SC.Query._scq_recordTypeCache;if(!e){e=SC.Query._scq_recordTypeCache={}}b=e[h];if(!b){b=e[h]={}}if(c.isEnumerable){i=c.map(function(j){return SC.guidFor(j)});i=i.sort().join(":")}else{i=SC.guidFor(c)}if(g){i=[i,g].join("::")}f=b[i];if(!f){if(c.isEnumerable){a={recordTypes:c.copy()}}else{a={recordType:c}}a.location=h;a.conditions=g;f=b[i]=SC.Query.create(a).freeze()}}else{if(!a){a={}}if(!a.location){a.location=h}if(c&&c.isEnumerable){a.recordTypes=c}else{a.recordType=c}if(g){a.conditions=g}if(d){a.parameters=d}f=SC.Query.create(a).freeze()}return f},local:function(c,a,b){return this.build(SC.Query.LOCAL,c,a,b)},remote:function(c,a,b){return this.build(SC.Query.REMOTE,c,a,b)},_scq_didDefineRecordType:function(){var a=SC.Query._scq_queriesWithExpandedRecordTypes;if(a){a.forEach(function(b){b.notifyPropertyChange("expandedRecordTypes")},this);a.clear()}}});SC.Query.comparisons={};SC.Query.registerComparison=function(a,b){SC.Query.comparisons[a]=b};SC.Query.registerQueryExtension=function(b,a){SC.Query.prototype.queryLanguage[b]=a};SC.Q=SC.Query.from;sc_require("system/query");SC.Record=SC.Object.extend({isRecord:YES,isParentRecord:NO,primaryKey:"guid",id:function(a,b){if(b!==undefined){this.writeAttribute(this.get("primaryKey"),b);return b}else{return SC.Store.idFor(this.storeKey)}}.property("storeKey").cacheable(),status:function(){return this.store.readStatus(this.storeKey)}.property("storeKey").cacheable(),store:null,storeKey:null,isDestroyed:function(){return !!(this.get("status")&SC.Record.DESTROYED)}.property("status").cacheable(),isEditable:function(a,b){if(b!==undefined){this._screc_isEditable=b}if(this.get("status")&SC.Record.READY){return this._screc_isEditable}else{return NO}}.property("status").cacheable(),_screc_isEditable:YES,isLoaded:function(){var b=SC.Record,a=this.get("status");return !((a===b.EMPTY)||(a===b.BUSY_LOADING)||(a===b.ERROR))}.property("status").cacheable(),relationships:null,attributes:function(){var a=this.get("store"),b=this.storeKey;return a.readEditableDataHash(b)}.property(),readOnlyAttributes:function(){var a=this.get("store"),c=this.storeKey,b=a.readDataHash(c);if(b){b=SC.clone(b,YES)}return b}.property(),nestedRecordNamespace:null,isNestedRecord:function(){var c=this.get("store"),d,b=this.get("storeKey"),a=c.parentStoreKeyExists(b);d=a?YES:NO;return d}.property().cacheable(),parentRecord:function(){var a=this.storeKey,b=this.get("store");return b.materializeParentRecord(a)}.property(),refresh:function(e,g){var c=this.get("store"),f,d,b=this.get("storeKey"),a=c.parentStoreKeyExists();d=e||(SC.none(e)&&SC.none(a));if(d){c.refreshRecord(null,null,b,g)}else{if(a){f=c.materializeRecord(a);f.refresh(e,g)}}return this},destroy:function(e){var c=this.get("store"),f,d,b=this.get("storeKey"),a=c.parentStoreKeyExists();d=e||(SC.none(e)&&SC.none(a));if(d){c.destroyRecord(null,null,b);this.notifyPropertyChange("status");this.propagateToAggregates()}else{if(a){f=c.materializeRecord(a);f.destroy(e)}}return this},recordDidChange:function(a){var b=this.get("parentRecord");if(b){b.recordDidChange()}this.get("store").recordDidChange(null,null,this.get("storeKey"),a);this.notifyPropertyChange("status");this.propagateToAggregates();return this},toJSON:function(){return this.get("attributes")},_editLevel:0,beginEditing:function(){this._editLevel++;return this},endEditing:function(a){if(--this._editLevel<=0){this._editLevel=0;this.recordDidChange(a)}return this},readAttribute:function(c){var a=this.get("store"),d=this.storeKey;var b=a.readDataHash(d);return b?b[c]:undefined},writeAttribute:function(c,f,e){var a=this.get("store"),d=this.storeKey,b;b=a.readEditableDataHash(d);if(!b){throw SC.Record.BAD_STATE_ERROR}if(f!==b[c]){if(!e){this.beginEditing()}b[c]=f;if(c===this.get("primaryKey")){SC.Store.replaceIdFor(d,f);this.propertyDidChange("id")}if(!e){this.endEditing(c)}else{a.dataHashDidChange(d,null,undefined,c)}}return this},propagateToAggregates:function(){var m=this.get("storeKey"),d=SC.Store.recordTypeFor(m),f=d.__sc_aggregate_keys,k,g,l,b,c,j;if(!f){f=[];for(l in this){b=this[l];if(b&&b.isRecordAttribute&&b.aggregate===YES){f.push(l)}}d.__sc_aggregate_keys=f}var i=SC.Record,a=i.DIRTY,e=i.READY_NEW,n=i.DESTROYED,o=i.READY_CLEAN,h;h=function(t){var p,q,r,s;if(t){p=this.get("status");if((p&a)||(p&e)||(p&n)){q=t.get("store");r=t.get("storeKey");s=q.peekStatus(r);if(s===o){t.get("store").recordDidChange(t.constructor,null,t.get("storeKey"),null,YES)}}}};for(k=0,g=f.length;k<g;++k){l=f[k];c=this.get(l);j=SC.kindOf(c,SC.ManyArray)?c:[c];j.forEach(h,this)}},storeDidChangeProperties:function(a,b){if(a){this.notifyPropertyChange("status")}else{if(b){this.beginPropertyChanges();b.forEach(function(e){this.notifyPropertyChange(e)},this);this.notifyPropertyChange("status");this.endPropertyChanges()}else{this.allPropertiesDidChange()}var d=this.relationships,c=d?d.length:0;while(--c>=0){d[c].recordPropertyDidChange(b)}}},normalize:function(a){var c=this.primaryKey,b=this.get("id"),f=this.get("store"),e=this.get("storeKey"),i={},r,o,d,q,j,p,l,g,n,h,m;var k=f.readEditableDataHash(e)||{};k[c]=b;q=f.readDataHash(e);for(r in this){o=this[r];if(o){d=o.typeClass;if(d){h=o.get("key")||r;i[h]=YES;l=SC.typeOf(d.call(o))===SC.T_CLASS;g=o.isNestedRecordTransform;if(!l&&!g){j=this.get(r);if(j!==undefined&&(j!==null||a)){m=this[r];if(SC.instanceOf(m,SC.RecordAttribute)){j=m.fromType(this,r,j)}k[h]=j}else{if(!a){i[h]=NO}}}else{if(g){j=this.get(r);if(j&&j.normalize){j.normalize()}}else{if(l){j=q[h];if(j!==undefined){k[h]=j}else{n=o.get("defaultValue");if(SC.typeOf(n)===SC.T_FUNCTION){k[h]=n(this,r,n)}else{k[h]=n}}}}}}}}for(r in k){if(!i[r]){SC.debug("%@:  Deleting key from underlying data hash due to normalization:  %@",this,r);delete k[r]}}return this},unknownProperty:function(b,d){if(d!==undefined){var c=this.get("storeKey"),e=SC.Store.recordTypeFor(c);if(e.ignoreUnknownProperties===YES){this[b]=d;return d}var a=this.get("primaryKey");this.writeAttribute(b,d);if(b===a){SC.Store.replaceIdFor(c,d)}}return this.readAttribute(b)},commitRecord:function(g,e,h){var c=this.get("store"),f,d,b=this.get("storeKey"),a=c.parentStoreKeyExists();d=e||(SC.none(e)&&SC.none(a));if(d){c.commitRecord(undefined,undefined,this.get("storeKey"),g,h)}else{if(a){f=c.materializeRecord(a);f.commitRecord(g,e,h)}}return this},isError:function(){return !!(this.get("status")&SC.Record.ERROR)}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var a=this.get("store");return a.readError(this.get("storeKey"))||SC.Record.GENERIC_ERROR}else{return null}}.property("isError").cacheable(),set:function(a,c){var b=this[a];if(b&&b.isProperty&&b.get&&!b.get("isEditable")){return this}return arguments.callee.base.apply(this,arguments)},toString:function(){var a=this.get("store").readDataHash(this.get("storeKey"));return"%@(%@) %@".fmt(this.constructor.toString(),SC.inspect(a),this.statusString())},statusString:function(){var b=[],a=this.get("status");for(var c in SC.Record){if(c.match(/[A-Z_]$/)&&SC.Record[c]===a){b.push(c)}}return b.join(" ")},registerNestedRecord:function(f,e,g){var c,d=this.get("storeKey"),b,a,h;if(SC.none(g)){g=e}if(f&&f.get&&f.get("isRecord")){a=f}else{h=this._materializeNestedRecordType(f,e);a=this.createNestedRecord(h,f,d,g)}if(a){this.isParentRecord=YES;c=this.get("store");b=a.get("storeKey");c.registerChildToParent(d,b,g)}return a},unregisterNestedRecord:function(d){var b,a,c;c=this.get("store");b=this.getPath(d);a=b.get("storeKey");c.unregisterChildFromParent(a)},_materializeNestedRecordType:function(d,c){var a,e,b;if(SC.typeOf(d)===SC.T_HASH){a=this.get("nestedRecordNamespace");if(d.type&&!SC.none(a)){e=a[d.type]}}if(!e&&c&&this[c]){e=this[c].get("typeClass")}if(!e||!SC.kindOf(e,SC.Record)){throw"SC.Child: Error during transform: Invalid record type."}return e},createNestedRecord:function(b,e,g,i){var h=this.get("store"),a,c,d,f=null;e=e||{};if(SC.none(h)){throw"Error: during the creation of a child record: NO STORE ON PARENT!"}a=e[b.prototype.primaryKey];if(!a){this.generateIdForChild(f)}if(!a){a=g+"."+i}c=h.storeKeyExists(b,a);if(c){h.writeDataHash(c,e);f=h.materializeRecord(c)}else{f=h.createRecord(b,e,a)}return f},_nestedRecordKey:0,generateIdForChild:function(a){}});SC.Record.mixin({ignoreUnknownProperties:NO,CLEAN:1,DIRTY:2,EMPTY:256,ERROR:4096,READY:512,READY_CLEAN:513,READY_DIRTY:514,READY_NEW:515,DESTROYED:1024,DESTROYED_CLEAN:1025,DESTROYED_DIRTY:1026,BUSY:2048,BUSY_LOADING:2052,BUSY_CREATING:2056,BUSY_COMMITTING:2064,BUSY_REFRESH:2080,BUSY_REFRESH_CLEAN:2081,BUSY_REFRESH_DIRTY:2082,BUSY_DESTROYING:2112,BAD_STATE_ERROR:SC.$error("Internal Inconsistency"),RECORD_EXISTS_ERROR:SC.$error("Record Exists"),NOT_FOUND_ERROR:SC.$error("Not found "),BUSY_ERROR:SC.$error("Busy"),GENERIC_ERROR:SC.$error("Generic Error"),_nextChildKey:0,attr:function(a,b){return SC.RecordAttribute.attr(a,b)},fetch:function(b,a){return SC.FetchedAttribute.attr(b,a)},toMany:function(d,b){b=b||{};var c=b.nested||b.isNested;var a;this._throwUnlessRecordTypeDefined(d,"toMany");if(c){a=SC.ChildrenAttribute.attr(d,b)}else{a=SC.ManyAttribute.attr(d,b)}return a},toOne:function(d,b){b=b||{};var c=b.nested||b.isNested;var a;this._throwUnlessRecordTypeDefined(d,"toOne");if(c){a=SC.ChildAttribute.attr(d,b)}else{a=SC.SingleAttribute.attr(d,b)}return a},_throwUnlessRecordTypeDefined:function(b,a){if(!b){throw"Attempted to create "+a+" attribute with undefined recordType. Did you forget to sc_require a dependency?"}},storeKeysById:function(){var b=SC.keyFor("storeKey",SC.guidFor(this)),a=this[b];if(!a){a=this[b]={}}return a},storeKeyFor:function(c){var b=this.storeKeysById(),a=b[c];if(!a){a=SC.Store.generateStoreKey();SC.Store.idsByStoreKey[a]=c;SC.Store.recordTypesByStoreKey[a]=this;b[c]=a}return a},storeKeyExists:function(c){var b=this.storeKeysById(),a=b[c];return a},find:function(a,b){return a.find(this,b)},extend:function(){var a=SC.Object.extend.apply(this,arguments);if(SC.Query){SC.Query._scq_didDefineRecordType(a)}return a}});sc_require("data_sources/data_source");sc_require("models/record");SC.FixturesDataSource=SC.DataSource.extend({simulateRemoteResponse:NO,latency:50,cancel:function(a,b){return NO},fetch:function(a,b){if(b.get("location")!==SC.Query.LOCAL){throw SC.$error("SC.Fixture data source can only fetch local queries")}if(!b.get("recordType")&&!b.get("recordTypes")){throw SC.$error("SC.Fixture data source can only fetch queries with one or more record types")}if(this.get("simulateRemoteResponse")){this.invokeLater(this._fetch,this.get("latency"),a,b)}else{this._fetch(a,b)}},_fetch:function(a,c){var d=c.get("recordType"),b=c.get("recordTypes")||[d];b.forEach(function(e){if(SC.typeOf(e)===SC.T_STRING){e=SC.objectForPropertyPath(e)}if(e){this.loadFixturesFor(a,e)}},this);a.dataSourceDidFetchQuery(c)},retrieveRecords:function(a,c){var d=this.get("latency"),b=this.hasFixturesFor(c);if(!b){return b}if(this.get("simulateRemoteResponse")){this.invokeLater(this._retrieveRecords,d,a,c)}else{this._retrieveRecords(a,c)}return b},_retrieveRecords:function(a,b){b.forEach(function(d){var c=[],g=SC.Store.recordTypeFor(d),f=a.idFor(d),e=this.fixtureForStoreKey(a,d);c.push(d);a.dataSourceDidComplete(d,e,f)},this)},updateRecords:function(a,c,e){var d=this.get("latency"),b=this.hasFixturesFor(c);if(!b){return b}if(this.get("simulateRemoteResponse")){this.invokeLater(this._updateRecords,d,a,c)}else{this._updateRecords(a,c)}return b},_updateRecords:function(a,b){b.forEach(function(c){var d=a.readDataHash(c);this.setFixtureForStoreKey(a,c,d);a.dataSourceDidComplete(c)},this)},createRecords:function(a,b,d){var c=this.get("latency");if(this.get("simulateRemoteResponse")){this.invokeLater(this._createRecords,c,a,b)}else{this._createRecords(a,b)}return YES},_createRecords:function(a,b){b.forEach(function(e){var g=a.idFor(e),f=a.recordTypeFor(e),d=a.readDataHash(e),c=this.fixturesFor(f);if(!g){g=this.generateIdFor(f,d,a,e)}this._invalidateCachesFor(f,e,g);c[g]=d;a.dataSourceDidComplete(e,null,g)},this)},destroyRecords:function(a,c,e){var d=this.get("latency"),b=this.hasFixturesFor(c);if(!b){return b}if(this.get("simulateRemoteResponse")){this.invokeLater(this._destroyRecords,d,a,c)}else{this._destroyRecords(a,c)}return b},_destroyRecords:function(a,b){b.forEach(function(d){var f=a.idFor(d),e=a.recordTypeFor(d),c=this.fixturesFor(e);this._invalidateCachesFor(e,d,f);if(f){delete c[f]}a.dataSourceDidDestroy(d)},this)},loadFixturesFor:function(a,g,c){var b=[],e,d,f;e=this.fixturesFor(g);for(d in e){f=g.storeKeyFor(d);if(a.peekStatus(f)===SC.Record.EMPTY){b.push(e[d])}if(c){c.push(f)}}if(b&&b.length>0){a.loadRecords(g,b)}return this},generateIdFor:function(d,b,a,c){return"@id%@".fmt(SC.Store.generateStoreKey())},fixtureForStoreKey:function(a,c){var e=a.idFor(c),d=a.recordTypeFor(c),b=this.fixturesFor(d);return b?b[e]:null},setFixtureForStoreKey:function(a,d,c){var f=a.idFor(d),e=a.recordTypeFor(d),b=this.fixturesFor(e);this._invalidateCachesFor(e,d,f);b[f]=c;return this},fixturesFor:function(h){if(!this._fixtures){this._fixtures={}}var f=this._fixtures[SC.guidFor(h)];if(f){return f}var e=h?h.FIXTURES:null,b=e?e.length:0,c=h?h.prototype.primaryKey:"guid",a,d,g;this._fixtures[SC.guidFor(h)]=f={};for(a=0;a<b;a++){d=e[a];g=d[c];if(!g){g=this.generateIdFor(h,d)}f[g]=d}return f},fixturesLoadedFor:function(c){if(!this._fixtures){return NO}var a=[],b=this._fixtures[SC.guidFor(c)];return b?YES:NO},reset:function(){this._fixtures=null;return this},hasFixturesFor:function(b){var a=NO;b.forEach(function(d){if(a!==SC.MIXED_STATE){var e=SC.Store.recordTypeFor(d),c=e?e.FIXTURES:null;if(c&&c.length&&c.length>0){if(a===NO){a=YES}}else{if(a===YES){a=SC.MIXED_STATE}}}},this);return a},_invalidateCachesFor:function(d,b,c){var a=this._storeKeyCache;if(a){delete a[SC.guidFor(d)]}return this}});SC.Record.fixtures=SC.FixturesDataSource.create();SC.RelationshipSupport={_srs_inverseDidRelinquishRelationships:function(d,c,a,b){c.forEach(function(e){this._srs_inverseDidRelinquishRelationship(d,e,a,b)},this)},_srs_inverseDidRelinquishRelationship:function(h,g,f,b){var e=h.storeKeyFor(g),c=this.readDataHash(e),a=f.inverse,d=h.prototype;if(!c||!a){return}if(SC.instanceOf(d[a],SC.SingleAttribute)){delete c[a]}else{if(SC.instanceOf(d[a],SC.ManyAttribute)&&SC.typeOf(c[a])===SC.T_ARRAY){c[a].removeObject(b)}}this.pushRetrieve(h,g,c,undefined,true)},_srs_inverseDidAddRelationships:function(d,c,a,b){c.forEach(function(e){this._srs_inverseDidAddRelationship(d,e,a,b)},this)},_srs_inverseDidAddRelationship:function(b,a,i,k){var j=b.storeKeyFor(a),g=this.readDataHash(j),d=this.peekStatus(j),f=b.prototype,h=i.inverse,l=f[h],c=f[f.primaryKey],e=false;l=(l&&l.get&&l.get("key")||l.key)||h;if((d===SC.Record.EMPTY)&&(SC.typeOf(i.lazilyInstantiate)===SC.T_FUNCTION&&i.lazilyInstantiate()||SC.typeOf(i.lazilyInstantiate)!==SC.T_FUNCTION&&i.lazilyInstantiate)){if(!SC.none(c)&&c.typeClass&&SC.typeOf(c.typeClass())===SC.T_CLASS){e=true}g={};g[f.primaryKey]=a}if(!g||!h){return}if(SC.instanceOf(f[h],SC.SingleAttribute)){g[l]=k}else{if(SC.instanceOf(f[h],SC.ManyAttribute)){g[l]=g[l]||[];if(g[l].indexOf(k)<0){g[l].push(k)}}}this.pushRetrieve(b,a,g,undefined,!e)},_srs_pushIterator:function(d,b,i,f){var e=d.prototype,g,c,h,a;if(typeof i==="undefined"){i=d.storeKeyFor(b)}c=this.readDataHash(i)||{};for(h in e){g=e[h];if(g&&g.typeClass&&g.inverse&&g.isMaster){a=g.typeClass();if(SC.typeOf(a)!==SC.T_CLASS){continue}f.apply(this,[a,c,g,g.get&&g.get("key")||h])}}},pushDestroy:function(a,e,d,c){var b;this._srs_pushIterator(e,d,c,function(f,g,i,h){b=[g[h]||null].flatten().compact().uniq();this._srs_inverseDidRelinquishRelationships(f,b,i,d)});return a(e,d,c)}.enhance(),pushRetrieve:function(b,h,g,c,e,f){if(!f){var d,a;this._srs_pushIterator(h,g,e,function(i,j,l,k){d=[j[k]||null].flatten().compact().uniq();a=[c[k]||null].flatten().compact().uniq();this._srs_inverseDidRelinquishRelationships(i,d.filter(function(m){return a.indexOf(m)===-1}),l,g);this._srs_inverseDidAddRelationships(i,a,l,g)})}e=e||h.storeKeyFor(g);return b(h,g,c,e)}.enhance()};sc_require("models/record");SC.RecordAttribute=SC.Object.extend({isRecordAttribute:YES,defaultValue:null,type:String,key:null,isRequired:NO,isEditable:YES,useIsoDate:YES,aggregate:NO,lazilyInstantiate:NO,typeClass:function(){var a=this.get("type");if(SC.typeOf(a)===SC.T_STRING){a=SC.requiredObjectForPropertyPath(a)}return a}.property("type").cacheable(),transform:function(){var a=this.get("typeClass")||String,c=SC.RecordAttribute.transforms,b;while(a&&!(b=c[SC.guidFor(a)])){if(a.superclass.hasOwnProperty("create")){a=a.superclass}else{a=SC.T_FUNCTION}}return b}.property("typeClass").cacheable(),toType:function(e,j,h){var c=this.get("transform"),g=this.get("typeClass"),b;if(c&&c.to){h=c.to(h,this,g,e,j);if(!SC.none(h)&&(b=c.observesChildren)){var d,f=b.length,a={record:e,key:j};for(d=0;d<f;d++){h.addObserver(b[d],this,this._SCRA_childObserver,a)}}}return h},_SCRA_childObserver:function(d,b,c,a){this.call(a.record,a.key,d);a.record.notifyPropertyChange(a.key)},fromType:function(a,c,e){var b=this.get("transform"),d=this.get("typeClass");if(b&&b.from){e=b.from(e,this,d,a,c)}return e},call:function(a,b,c){var d=this.get("key")||b,e;if((c!==undefined)&&this.get("isEditable")){e=this.fromType(a,b,c);a.writeAttribute(d,e)}c=a.readAttribute(d);if(SC.none(c)&&(c=this.get("defaultValue"))){if(typeof c===SC.T_FUNCTION){c=c(a,b,this)}}c=this.toType(a,b,c);return c},apply:function(b,a){return this.call.apply(b,a)},isProperty:YES,isCacheable:YES,dependentKeys:[],init:function(){arguments.callee.base.apply(this,arguments);this.cacheKey="__cache__recattr__"+SC.guidFor(this);this.lastSetValueKey="__lastValue__recattr__"+SC.guidFor(this)}});SC.RecordAttribute.mixin({attr:function(a,b){if(!b){b={}}if(!b.type){b.type=a||String}return this.create(b)},transforms:{},registerTransform:function(a,b){SC.RecordAttribute.transforms[SC.guidFor(a)]=b}});SC.RecordAttribute.registerTransform(Boolean,{to:function(a){return SC.none(a)?null:!!a}});SC.RecordAttribute.registerTransform(Number,{to:function(a){return SC.none(a)?null:Number(a)}});SC.RecordAttribute.registerTransform(String,{to:function(a){if(!(typeof a===SC.T_STRING)&&!SC.none(a)&&a.toString){a=a.toString()}return a}});SC.RecordAttribute.registerTransform(Array,{to:function(a){if(!SC.isArray(a)&&!SC.none(a)){a=[]}return a},observesChildren:["[]"]});SC.RecordAttribute.registerTransform(Object,{to:function(a){if(!(typeof a==="object")&&!SC.none(a)){a={}}return a}});SC.RecordAttribute.registerTransform(SC.Record,{to:function(e,a,d,c){var b=c.get("store");if(SC.none(e)||(e==="")){return null}else{return b.find(d,e)}},from:function(a){return a?a.get("id"):null}});SC.RecordAttribute.registerTransform(SC.T_FUNCTION,{to:function(e,a,d,c){d=d.apply(c);var b=c.get("store");return b.find(d,e)},from:function(a){return a.get("id")}});SC.RecordAttribute.registerTransform(Date,{to:function(i,a){if(SC.none(i)){return i}var c;i=i.toString()||"";if(a.get("useIsoDate")){var e="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",h=i.match(new RegExp(e)),g=0,b=new Date(h[1],0,1),f;if(h[3]){b.setMonth(h[3]-1)}if(h[5]){b.setDate(h[5])}if(h[7]){b.setHours(h[7])}if(h[8]){b.setMinutes(h[8])}if(h[10]){b.setSeconds(h[10])}if(h[12]){b.setMilliseconds(Number("0."+h[12])*1000)}if(h[14]){g=(Number(h[16])*60)+Number(h[17]);g*=((h[15]==="-")?1:-1)}g-=b.getTimezoneOffset();f=(Number(b)+(g*60*1000));c=new Date();c.setTime(Number(f))}else{c=new Date(Date.parse(i))}return c},_dates:{},_zeropad:function(a){return((a<0)?"-":"")+((a<10)?"0":"")+Math.abs(a)},from:function(b){if(SC.none(b)){return null}var a=this._dates[b.getTime()];if(a){return a}var d=this._zeropad,c=0-b.getTimezoneOffset()/60;c=(c===0)?"Z":"%@:00".fmt(d(c));this._dates[b.getTime()]=a="%@-%@-%@T%@:%@:%@%@".fmt(d(b.getFullYear()),d(b.getMonth()+1),d(b.getDate()),d(b.getHours()),d(b.getMinutes()),d(b.getSeconds()),c);return a}});if(SC.DateTime&&!SC.RecordAttribute.transforms[SC.guidFor(SC.DateTime)]){SC.RecordAttribute.registerTransform(SC.DateTime,{to:function(c,a){if(a.get("useUnixTime")){if(SC.typeOf(c)===SC.T_STRING){c=parseInt(c)}if(isNaN(c)||SC.typeOf(c)!==SC.T_NUMBER){c=0}return SC.DateTime.create({milliseconds:c*1000,timezone:0})}if(SC.none(c)||SC.instanceOf(c,SC.DateTime)){return c}if(SC.none(c)||SC.instanceOf(c,Date)){return SC.DateTime.create(c.getTime())}var b=a.get("format");return SC.DateTime.parse(c,b?b:SC.DateTime.recordFormat)},from:function(b,a){if(SC.none(b)){return b}if(a.get("useUnixTime")){return b.get("milliseconds")/1000}var c=a.get("format");return b.toFormattedString(c?c:SC.DateTime.recordFormat)}})}SC.RecordAttribute.registerTransform(SC.Set,{to:function(e,a,d,b,c){return SC.Set.create(e)},from:function(e,a,d,b,c){return e.toArray()},observesChildren:["[]"]});sc_require("models/record");sc_require("models/record_attribute");SC.ChildAttribute=SC.RecordAttribute.extend({isNestedRecordTransform:YES,toType:function(b,d,e){var c=null,a,f=this.get("typeClass");if(!b){throw"SC.Child: Error during transform: Unable to retrieve parent record."}if(!SC.none(e)){c=b.registerNestedRecord(e,d)}return c},fromType:function(b,e,f){var a,c,d;if(b){if(b.readAttribute(e)){b.unregisterNestedRecord(e)}if(SC.none(f)){b.writeAttribute(e,f);d=f}else{d=b.registerNestedRecord(f,e);if(d){a=d.get("storeKey");c=d.get("store");b.writeAttribute(e,c.readDataHash(a))}else{if(f){b.writeAttribute(e,f)}}}}return d},call:function(a,b,c){var d=this.get("key")||b;if(c!==undefined){c=this.fromType(a,b,c)}else{c=a.readAttribute(d);if(SC.none(c)&&(c=this.get("defaultValue"))){if(typeof c===SC.T_FUNCTION){c=this.defaultValue(a,b,this);if(a.attributes()){a.writeAttribute(d,c,true)}}}else{c=this.toType(a,b,c)}}return c}});sc_require("models/record");SC.ChildRecord=SC.Record.extend({});SC.ChildRecord.extend=function(){return SC.Record.extend.apply(this,arguments)};SC.ChildArray=SC.Object.extend(SC.Enumerable,SC.Array,{defaultRecordType:null,record:null,propertyName:null,children:null,store:function(){return this.getPath("record.store")}.property("record").cacheable(),storeKey:function(){return this.getPath("record.storeKey")}.property("record").cacheable(),readOnlyChildren:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableChildren:function(){var a=this.get("store"),d=this.get("storeKey"),c=this.get("propertyName"),b,e;b=a.readEditableProperty(d,c);if(!b){e=a.readEditableDataHash(d);b=e[c]=[]}return b}.property(),length:function(){var a=this.get("readOnlyChildren");return a?a.length:0}.property("readOnlyChildren"),objectAt:function(b){var g=this._records,e=this.get("readOnlyChildren"),h,c,d=this.get("propertyName"),f=this.get("record");var a=e?e.length:0;if(!e){return undefined}if(g&&(c=g[b])){return c}if(!g){this._records=g=[]}if(b>=a){return undefined}h=e.objectAt(b);if(!h){return undefined}g[b]=c=f.registerNestedRecord(h,d,d+"."+b);return c},replace:function(j,a,i){var b=this.get("editableChildren"),g=i?(i.get?i.get("length"):i.length):0,f=this.get("record"),d,e=this.get("propertyName"),h,c;d=this._processRecordsToHashes(i);if(d!==this._prevChildren){this._performRecordPropertyChange(null,false)}b.replace(j,a,d);f.recordDidChange(e);return this},_processRecordsToHashes:function(c){var b,a;c=c||[];c.forEach(function(e,d){if(e.isNestedRecord){b=e.get("store");a=e.storeKey;c[d]=b.readDataHash(a)}});return c},normalize:function(){this.forEach(function(b,a){if(b.normalize){b.normalize()}})},recordPropertyDidChange:function(a){this._performRecordPropertyChange(a,true);return this},_performRecordPropertyChange:function(e,h){if(e&&!e.contains(this.get("propertyName"))){return this}var b=this.get("readOnlyChildren"),a=0,c=0;var d=this._prevChildren,g=this._childrenContentDidChange;h=SC.none(h)?true:h;if(b===d){return this}if(d){d.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:g});a=d.get("length")}if(b){b.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:g});c=b.get("length")}this._prevChildren=b;if(h){this.arrayContentWillChange(0,a,c);this._childrenContentDidChange(0,a,c)}return this},_childrenContentDidChange:function(c,a,b){this._records=null;this.arrayContentDidChange(c,a,b)},init:function(){arguments.callee.base.apply(this,arguments);this.recordPropertyDidChange()}});sc_require("models/record");sc_require("models/record_attribute");sc_require("models/child_attribute");sc_require("system/child_array");SC.ChildrenAttribute=SC.ChildAttribute.extend({toType:function(b,d,e){var g=this.get("key")||d,f=SC.keyFor("__kidsArray__",SC.guidFor(this)),c=b[f],h=this.get("typeClass"),a;if(!c){c=SC.ChildArray.create({record:b,propertyName:g,defaultRecordType:h});b[f]=c;a=b.get("relationships");if(!a){b.set("relationships",a=[])}a.push(c)}return c},fromType:function(b,e,f){var a,c,g=SC.keyFor("__kidsArray__",SC.guidFor(this)),d=b[g];if(b){b.writeAttribute(e,f);if(d){d=d.recordPropertyDidChange()}}return d},call:function(a,c,d){var e=this.get("key")||c,b,f=SC.keyFor("__kid__",SC.guidFor(this));if(d!==undefined){d=this.fromType(a,c,d)}else{d=a.readAttribute(e);if(SC.none(d)&&(d=this.get("defaultValue"))){if(typeof d===SC.T_FUNCTION){d=this.defaultValue(a,c,this);if(a.attributes()){if(d instanceof Array){d=this.toType(a,c,d).replace(0,d.length,d)}else{a.writeAttribute(e,d,true)}}}}else{d=this.toType(a,c,d)}}return d}});sc_require("models/record");sc_require("models/record_attribute");SC.FetchedAttribute=SC.RecordAttribute.extend({paramValueKey:"link",paramOwnerKey:"owner",paramRelKey:"rel",queryKey:null,isEditable:NO,toType:function(d,i,g){var h=d.get("store");if(!h){return null}var b=this.get("paramValueKey"),a=this.get("paramOwnerKey"),f=this.get("paramRelKey"),e=this.get("queryKey")||this.get("typeClass"),c={};if(b){c[b]=g}if(a){c[a]=d}if(f){c[f]=this.get("key")||i}return h.findAll(e,c)},fromType:function(a,b,c){return c}});SC.ManyArray=SC.Object.extend(SC.Enumerable,SC.Array,{recordType:null,record:null,propertyName:null,manyAttribute:null,store:function(){return this.get("record").get("store")}.property("record").cacheable(),storeKey:function(){return this.get("record").get("storeKey")}.property("record").cacheable(),readOnlyStoreIds:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableStoreIds:function(){var a=this.get("store"),d=this.get("storeKey"),c=this.get("propertyName"),b,e;b=a.readEditableProperty(d,c);if(!b){e=a.readEditableDataHash(d);b=e[c]=[]}if(b!==this._prevStoreIds){this.recordPropertyDidChange()}return b}.property(),isEditable:function(){var a=this.manyAttribute;return a?a.get("isEditable"):NO}.property("manyAttribute").cacheable(),inverse:function(){var a=this.manyAttribute;return a?a.get("inverse"):null}.property("manyAttribute").cacheable(),isMaster:function(){var a=this.manyAttribute;return a?a.get("isMaster"):null}.property("manyAttribute").cacheable(),orderBy:function(){var a=this.manyAttribute;return a?a.get("orderBy"):null}.property("manyAttribute").cacheable(),length:function(){var a=this.get("readOnlyStoreIds");return a?a.get("length"):0}.property("readOnlyStoreIds"),objectAt:function(a){var g=this._records,f=this.get("readOnlyStoreIds"),c=this.get("store"),h=this.get("recordType"),e,d,b;if(!f||!c){return undefined}if(g&&(d=g[a])){return d}if(!g){this._records=g=[]}b=f.objectAt(a);if(b){e=c.storeKeyFor(h,b);if(c.readStatus(e)===SC.Record.EMPTY){c.retrieveRecord(h,null,e)}g[a]=d=c.materializeRecord(e)}return d},replace:function(n,d,m){if(!this.get("isEditable")){throw"%@.%@[] is not editable".fmt(this.get("record"),this.get("propertyName"))}var c=this.get("editableStoreIds"),k=m?(m.get?m.get("length"):m.length):0,h=this.get("record"),e=this.get("propertyName"),g,o,a,b,f,l,j;a=[];for(g=0;g<k;g++){a[g]=m.objectAt(g).get("id")}f=this.get("inverse");if(f&&d>0){b=SC.ManyArray._toRemove;if(b){SC.ManyArray._toRemove=null}else{b=[]}for(g=0;g<d;g++){b[g]=this.objectAt(n+g)}}c.replace(n,d,a);if(f){for(g=0;g<d;g++){j=b[g];l=j?j[f]:null;if(l&&l.inverseDidRemoveRecord){l.inverseDidRemoveRecord(j,f,h,e)}}if(b){b.length=0;if(!SC.ManyArray._toRemove){SC.ManyArray._toRemove=b}}for(g=0;g<k;g++){j=m.objectAt(g);l=j?j[f]:null;if(l&&l.inverseDidAddRecord){l.inverseDidAddRecord(j,f,h,e)}}}if(h&&(!f||this.get("isMaster"))){h.recordDidChange(e)}this.enumerableContentDidChange(n,d,k-d);return this},removeInverseRecord:function(c){if(!c){return this}var e=c.get("id"),d=this.get("editableStoreIds"),a=(d&&e)?d.indexOf(e):-1,b;if(a>=0){d.removeAt(a);if(this.get("isMaster")&&(b=this.get("record"))){b.recordDidChange(this.get("propertyName"))}}return this},addInverseRecord:function(d){if(!d){return this}var g=d.get("id"),e=this.get("editableStoreIds"),f=this.get("orderBy"),b=e.get("length"),a,c;if(f){a=this._findInsertionLocation(d,0,b,f)}else{a=b}e.insertAt(a,d.get("id"));if(this.get("isMaster")&&(c=this.get("record"))){c.recordDidChange(this.get("propertyName"))}return this},_findInsertionLocation:function(g,d,c,f){var b=d+Math.floor((c-d)/2),e=this.objectAt(b),a=this._compare(g,e,f);if(a<0){if(b===0){return b}else{return this._findInsertionLocation(g,0,b,f)}}else{if(a>0){if(b>=c){return b}else{return this._findInsertionLocation(g,b,c,f)}}else{return b}}},_compare:function(f,e,i){var h=SC.typeOf(i),g,d,c;if(h===SC.T_FUNCTION){g=i(f,e)}else{if(h===SC.T_STRING){g=SC.compare(f,e)}else{c=i.get("length");g=0;for(d=0;(g===0)&&(d<c);d++){g=SC.compare(f,e)}}}return g},recordPropertyDidChange:function(d){if(d&&!d.contains(this.get("propertyName"))){return this}var g=this.get("readOnlyStoreIds"),a,b;var c=this._prevStoreIds,e=this._storeIdsContentDidChange;if(g===c){return this}if(c){c.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:e});a=c.get("length")}else{a=0}if(g){g.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:e});b=g.get("length")}else{b=0}this.arrayContentWillChange(0,a,b);this._prevStoreIds=g;this._storeIdsContentDidChange(0,a,b)},_storeIdsContentDidChange:function(c,a,b){this._records=null;this.arrayContentDidChange(c,a,b)},unknownProperty:function(b,c){var a;if(SC.typeOf(b)===SC.T_STRING){a=this.reducedProperty(b,c)}return a===undefined?arguments.callee.base.apply(this,arguments):a},init:function(){arguments.callee.base.apply(this,arguments);this.recordPropertyDidChange()}});sc_require("models/record");sc_require("models/record_attribute");sc_require("system/many_array");SC.ManyAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,orderBy:null,toType:function(b,d,f){var e=this.get("typeClass"),h=this.get("key")||d,g=SC.keyFor("__manyArray__",SC.guidFor(this)),c=b[g],a;if(!c){c=SC.ManyArray.create({recordType:e,record:b,propertyName:h,manyAttribute:this});b[g]=c;a=b.get("relationships");if(!a){b.set("relationships",a=[])}a.push(c)}return c},fromType:function(b,e,f){var c=[];if(!SC.isArray(f)){throw"Expects toMany attribute to be an array"}var a=f.get("length");for(var d=0;d<a;d++){c[d]=f.objectAt(d).get("id")}return c},inverseDidRemoveRecord:function(a,b,c,d){var e=a.get(b);if(e){e.removeInverseRecord(c)}},inverseDidAddRecord:function(a,b,c,d){var e=a.get(b);if(e){e.addInverseRecord(c)}}});sc_require("models/record");sc_require("models/record_attribute");SC.SingleAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,call:function(c,i,b){var a=this.get("key")||i,h,g,j,f,e,d;if(b!==undefined&&this.get("isEditable")){if(b&&!SC.kindOf(b,SC.Record)){throw"%@ is not an instance of SC.Record".fmt(b)}h=this.get("inverse");if(h){j=this._scsa_call(c,i)}d=this.fromType(c,i,b);c.writeAttribute(a,d,!this.get("isMaster"));e=b;if(h&&(j!==b)){if(j&&(f=j[h])){f.inverseDidRemoveRecord(j,h,c,i)}if(b&&(f=b[h])){f.inverseDidAddRecord(b,h,c,i)}}}else{e=this._scsa_call(c,i,b)}return e},_scsa_call:SC.RecordAttribute.prototype.call,inverseDidRemoveRecord:function(c,f,g,h){var b=this.get("inverse"),e=this._scsa_call(c,f),d=this.get("isMaster"),a;c.writeAttribute(this.get("key")||f,null,!d);c.notifyPropertyChange(f);if((e!==g)||(h!==b)){if(e&&(a=e[b])){a.inverseDidRemoveRecord(e,b,c,f)}}},inverseDidAddRecord:function(a,h,c,g){var e=this.get("inverse"),i=this._scsa_call(a,h),f=this.get("isMaster"),d,b;b=this.fromType(a,h,c);a.writeAttribute(this.get("key")||h,b,!f);a.notifyPropertyChange(h);if((i!==c)||(g!==e)){if(i&&(d=i[e])){d.inverseDidRemoveRecord(i,e,a,h)}}}});sc_require("models/record");SC.Store=SC.Object.extend({name:null,nestedStores:null,dataSource:null,isNested:NO,commitRecordsAutomatically:NO,from:function(a){this.set("dataSource",a);return this},_getDataSource:function(){var a=this.get("dataSource");if(typeof a===SC.T_STRING){a=SC.requiredObjectForPropertyPath(a);if(a.isClass){a=a.create()}this.set("dataSource",a)}return a},cascade:function(a){var b=SC.A(arguments);a=SC.CascadeDataSource.create({dataSources:b});return this.from(a)},chain:function(b,c){if(!b){b={}}b.parentStore=this;if(c){if(SC.typeOf(c)!=="class"){throw new Error("%@ is not a valid class".fmt(c))}if(!SC.kindOf(c,SC.NestedStore)){throw new Error("%@ is not a type of SC.NestedStore".fmt(c))}}else{c=SC.NestedStore}b.childRecords=this.childRecords?SC.clone(this.childRecords):{};b.parentRecords=this.parentRecords?SC.clone(this.parentRecords):{};var a=c.create(b),d=this.nestedStores;if(!d){d=this.nestedStores=[]}d.push(a);return a},willDestroyNestedStore:function(a){if(this.nestedStores){this.nestedStores.removeObject(a)}return this},hasNestedStore:function(a){while(a&&(a!==this)){a=a.get("parentStore")}return a===this},dataHashes:null,statuses:null,revisions:null,editables:null,changelog:null,recordErrors:null,queryErrors:null,childRecords:null,parentRecords:null,storeKeyEditState:function(b){var c=this.editables,a=this.locks;return(c&&c[b])?SC.Store.EDITABLE:SC.Store.LOCKED},readDataHash:function(a){return this.dataHashes[a]},readEditableDataHash:function(b){var a=this.dataHashes[b];if(!a){return a}var c=this.editables;if(!c){c=this.editables=[]}if(!c[b]){c[b]=1;a=this.dataHashes[b]=SC.clone(a,YES)}return a},readEditableProperty:function(c,a){var e=this.readEditableDataHash(c),d=this.editables[c],b=e[a];if(d===1){d=this.editables[c]={}}if(!d[a]){b=e[a];if(b&&b.isCopyable){b=e[a]=b.copy(YES)}d[a]=YES}return b},writeDataHash:function(c,e,a){if(e){this.dataHashes[c]=e}if(a){this.statuses[c]=a}var d=this.editables;if(!d){d=this.editables=[]}d[c]=1;var b=this;this._propagateToChildren(c,function(f){b.writeDataHash(f,null,a)});return this},removeDataHash:function(b,a){this.dataHashes[b]=null;this.statuses[b]=a||SC.Record.EMPTY;var c=this.editables;if(c){c[b]=0}return this},readStatus:function(a){this.readDataHash(a);return this.statuses[a]||SC.Record.EMPTY},peekStatus:function(a){return this.statuses[a]||SC.Record.EMPTY},writeStatus:function(b,a){return this.writeDataHash(b,null,a)},dataHashDidChange:function(e,b,a,h){if(!b){b=SC.Store.generateStoreKey()}var c,f,g,i;c=SC.typeOf(e)===SC.T_ARRAY;if(c){f=e.length}else{f=1;i=e}var d=this;for(g=0;g<f;g++){if(c){i=e[g]}this.revisions[i]=b;this._notifyRecordPropertyChange(i,a,h);this._propagateToChildren(i,function(j){d.dataHashDidChange(j,null,a,h)})}return this},_notifyRecordPropertyChange:function(m,e,l){var a=this.records,g=this.get("nestedStores"),h=SC.Store,c,b,f,k,j,d,n;f=g?g.length:0;for(k=0;k<f;k++){j=g[k];d=j.peekStatus(m);b=j.storeKeyEditState(m);if(b===h.INHERITED){j._notifyRecordPropertyChange(m,e,l)}else{if(d&SC.Record.BUSY){if(j.get("hasChanges")){throw h.CHAIN_CONFLICT_ERROR}j.reset()}}}var i=this.recordPropertyChanges;if(!i){i=this.recordPropertyChanges={storeKeys:SC.CoreSet.create(),records:SC.CoreSet.create(),hasDataChanges:SC.CoreSet.create(),propertyForStoreKeys:{}}}i.storeKeys.add(m);if(a&&(c=a[m])){i.records.push(m);if(!e){i.hasDataChanges.push(m)}if(l){if(!(n=i.propertyForStoreKeys[m])){n=i.propertyForStoreKeys[m]=SC.CoreSet.create()}if(n!=="*"){n.add(l)}}else{i.propertyForStoreKeys[m]="*"}}this.invokeOnce(this.flush);return this},flush:function(){if(!this.recordPropertyChanges){return this}var i=this.recordPropertyChanges,h=i.storeKeys,l=i.hasDataChanges,a=i.records,f=i.propertyForStoreKeys,d=SC.CoreSet.create(),c,b,e,j,g,k,m;h.forEach(function(n){if(a.contains(n)){e=l.contains(n)?NO:YES;c=this.records[n];m=f?f[n]:null;if(m==="*"){m=null}a.remove(n);if(c){c.storeDidChangeProperties(e,m)}}b=SC.Store.recordTypeFor(n);d.add(b)},this);if(h.get("length")>0){this._notifyRecordArrays(h,d)}h.clear();l.clear();a.clear();this.recordPropertyChanges.propertyForStoreKeys={};return this},reset:function(){this.dataHashes={};this.revisions={};this.statuses={};this.chainedChanges=this.locks=this.editables=null;this.changelog=null;this.recordErrors=null;this.queryErrors=null;var c=this.get("dataSource");if(c&&c.reset){c.reset()}var a=this.records,b;if(a){for(b in a){if(!a.hasOwnProperty(b)){continue}this._notifyRecordPropertyChange(parseInt(b,10),NO)}}this.set("hasChanges",NO)},commitChangesFromNestedStore:function(j,t,d){if(!d){this._verifyLockRevisions(t,j.locks)}var p=t.length,o,f,c,l,e,b,h,a,q,r,g,m,k;b=this.revisions;c=this.dataHashes;l=this.statuses;e=this.editables;h=this.parentRecords?this.parentRecords:this.parentRecords={};a=this.childRecords?this.childRecords:this.childRecords={};if(!e){e=this.editables=[]}q=j.dataHashes;g=j.revisions;r=j.statuses;m=j.parentRecords||{};k=j.childRecords||{};for(o=0;o<p;o++){f=t[o];c[f]=q[f];l[f]=r[f];b[f]=g[f];h[f]=m[f];a[f]=k[f];e[f]=0;this._notifyRecordPropertyChange(f,NO)}var n=this.changelog,s=j.changelog;if(s){if(!n){n=this.changelog=SC.CoreSet.create()}n.addEach(s)}this.changelog=n;if(!this.get("parentStore")){this.flush()}return this},_verifyLockRevisions:function(f,h){var a=f.length,c=this.revisions,e,g,d,b;if(h&&c){for(e=0;e<a;e++){g=f[e];d=h[g]||1;b=c[g]||1;if(d<b){throw SC.Store.CHAIN_CONFLICT_ERROR}}}return this},find:function(b,a){if(SC.typeOf(b)===SC.T_STRING){b=SC.objectForPropertyPath(b)}if((arguments.length===1)&&!(b&&b.get&&b.get("isRecord"))){if(!b){throw new Error("SC.Store#find() must pass recordType or query")}if(!b.isQuery){b=SC.Query.local(b)}return this._findQuery(b,YES,YES)}else{return this._findRecord(b,a)}},findAll:function(c,a,b){SC.Logger.warn("SC.Store#findAll() will be removed in a future version of SproutCore.  Use SC.Store#find() instead");if(!c||!c.isQuery){c=SC.Query.local(c,a,b)}return this._findQuery(c,YES,YES)},_findQuery:function(f,a,e){var b=this._scst_recordArraysByQuery,d=SC.guidFor(f),c,g;if(!b){b=this._scst_recordArraysByQuery={}}c=b[d];if(!c&&a){b[d]=c=SC.RecordArray.create({store:this,query:f});g=this.get("recordArrays");if(!g){this.set("recordArrays",g=SC.Set.create())}g.add(c);if(e){this.refreshQuery(f)}}this.flush();return c},_findRecord:function(c,b){var a;if(c&&c.get&&c.get("isRecord")){a=c.get("storeKey")}else{a=b?c.storeKeyFor(b):null}if(a&&(this.readStatus(a)===SC.Record.EMPTY)){a=this.retrieveRecord(c,b)}return a?this.materializeRecord(a):null},recordArrayWillDestroy:function(b){var a=this._scst_recordArraysByQuery,c=this.get("recordArrays");if(a){delete a[SC.guidFor(b.get("query"))]}if(c){c.remove(b)}return this},refreshQuery:function(d){if(!d){throw new Error("refreshQuery() requires a query")}var a=this._scst_recordArraysByQuery,c=a?a[SC.guidFor(d)]:null,b=this._getDataSource();if(b&&b.fetch){if(c){c.storeWillFetchQuery(d)}b.fetch.call(b,this,d)}return this},_notifyRecordArrays:function(b,a){var c=this.get("recordArrays");if(!c){return this}c.forEach(function(d){if(d){d.storeDidChangeStoreKeys(b,a)}},this);return this},recordsFor:function(f){var d=[],a=f.storeKeysById(),e,c,b;for(e in a){c=a[e];if(this.readStatus(c)!==SC.RECORD_EMPTY){d.push(c)}}if(d.length>0){b=SC.RecordArray.create({store:this,storeKeys:d})}else{b=d}return b},_TMP_REC_ATTRS:{},materializeRecord:function(d){var a=this.records,c,e,b;if(!a){a=this.records={}}c=a[d];if(c){return c}e=SC.Store.recordTypeFor(d);if(!e){return null}b=this._TMP_REC_ATTRS;b.storeKey=d;b.store=this;c=a[d]=e.create(b);return c},createRecord:function(d,f,b){var m,l,n,e,k=SC.Record,h,j,i;f=(f?f:{});if(!b&&(m=d.prototype.primaryKey)){b=f[m];j=d.prototype[m]?d.prototype[m].defaultValue:null;if(!b&&SC.typeOf(j)===SC.T_FUNCTION){b=f[m]=j()}}n=b?d.storeKeyFor(b):SC.Store.generateStoreKey();e=this.readStatus(n);if((e&k.BUSY)||(e&k.READY)||(e===k.DESTROYED_DIRTY)){throw b?k.RECORD_EXISTS_ERROR:k.BAD_STATE_ERROR}else{if(!b&&(e===SC.DESTROYED_CLEAN||e===SC.ERROR)){throw k.BAD_STATE_ERROR}}this.writeDataHash(n,f,k.READY_NEW);SC.Store.replaceRecordTypeFor(n,d);this.dataHashDidChange(n);i=this.materializeRecord(n);l=d.prototype;for(var a in l){var g=l[a];if(g&&g.isRecordAttribute){var c=g.key||a;if(!f.hasOwnProperty(c)){if(f.hasOwnProperty(a)){f[c]=f[a];delete f[a]}else{j=g.defaultValue;if(j){if(SC.typeOf(j)===SC.T_FUNCTION){f[c]=SC.copy(j(i,c),YES)}else{f[c]=SC.copy(j,YES)}}}}else{if(c!==a&&f.hasOwnProperty(a)){delete f[a]}}}}h=this.changelog;if(!h){h=SC.Set.create()}h.add(n);this.changelog=h;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)}if(i){i.propagateToAggregates()}return i},createRecords:function(d,i,a){var g=[],c,b,e,f=i.length,h;e=SC.typeOf(d)===SC.T_ARRAY;if(!e){c=d}for(h=0;h<f;h++){if(e){c=d[h]||SC.Record}b=a?a[h]:undefined;g.push(this.createRecord(c,i[h],b))}return g},unloadRecord:function(g,f,e,c){if(e===undefined){e=g.storeKeyFor(f)}var b=this.readStatus(e),a=SC.Record;c=c||a.EMPTY;if((b===a.BUSY_DESTROYING)||(b&a.DESTROYED)){return this}else{if(b&a.BUSY){throw a.BUSY_ERROR}else{b=c}}this.removeDataHash(e,b);this.dataHashDidChange(e);var d=this;this._propagateToChildren(e,function(h){d.unloadRecord(null,null,h,c)});return this},unloadRecords:function(d,a,g,e){var h,f,i,b,c,j;if(g===undefined){f=SC.typeOf(d)===SC.T_ARRAY;if(!f){c=d}if(a===undefined){h=f?d.length:1;for(i=0;i<h;i++){if(f){c=d[i]}g=this.storeKeysFor(c);this.unloadRecords(undefined,undefined,g,e)}}else{h=a.length;for(i=0;i<h;i++){if(f){c=d[i]||SC.Record}b=a?a[i]:undefined;this.unloadRecord(c,b,undefined,e)}}}else{h=g.length;for(i=0;i<h;i++){j=g?g[i]:undefined;this.unloadRecord(undefined,undefined,j,e)}}return this},destroyRecord:function(g,f,e){if(e===undefined){e=g.storeKeyFor(f)}var b=this.readStatus(e),c,a=SC.Record;if((b===a.BUSY_DESTROYING)||(b&a.DESTROYED)){return this}else{if(b===a.EMPTY){throw a.NOT_FOUND_ERROR}else{if(b&a.BUSY){throw a.BUSY_ERROR}else{if(b===a.READY_NEW){b=a.DESTROYED_CLEAN}else{b=a.DESTROYED_DIRTY}}}}this.writeStatus(e,b);this.dataHashDidChange(e);c=this.changelog;if(!c){c=this.changelog=SC.Set.create()}((b&a.DIRTY)?c.add(e):c.remove(e));this.changelog=c;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)}var d=this;this._propagateToChildren(e,function(h){d.destroyRecord(null,null,h)});return this},destroyRecords:function(d,a,f){var g,e,h,b,c,i;if(f===undefined){g=a.length;e=SC.typeOf(d)===SC.T_ARRAY;if(!e){c=d}for(h=0;h<g;h++){if(e){c=d[h]||SC.Record}b=a?a[h]:undefined;this.destroyRecord(c,b,undefined)}}else{g=f.length;for(h=0;h<g;h++){i=f?f[h]:undefined;this.destroyRecord(undefined,undefined,i)}}return this},registerChildToParent:function(c,g,f){var e,b,d,h,a;b=this.childRecords||{};e=this.parentRecords||{};d=b[g];if(d){h=e[d];delete h[g]}a=e[c]||{};a[g]=f||YES;e[c]=a;b[g]=c;this.writeStatus(g,this.statuses[c]);this.childRecords=b;this.parentRecords=e},unregisterChildFromParent:function(c){var a,b;a=this.childRecords;b=a[c];if(b){delete this.parentRecords[b][c]}this.removeDataHash(c);delete this.records[c];delete a[c]},materializeParentRecord:function(c){var b,a;if(SC.none(c)){return null}a=this.childRecords;b=a?this.childRecords[c]:null;if(SC.none(b)){return null}return this.materializeRecord(b)},parentStoreKeyExists:function(b){if(SC.none(b)){return}var a=this.childRecords||{};return a[b]},_propagateToChildren:function(d,c){if(SC.none(this.parentRecords)){return}var b=this.parentRecords[d]||{};if(SC.none(c)){return}for(var a in b){if(b.hasOwnProperty(a)){c(parseInt(a,10))}}},recordDidChange:function(h,g,f,d,c){if(f===undefined){f=h.storeKeyFor(g)}var b=this.readStatus(f),e,a=SC.Record;if(b&a.BUSY){throw a.BUSY_ERROR}else{if(!(b&a.READY)){throw a.NOT_FOUND_ERROR}else{if(b!=a.READY_NEW){this.writeStatus(f,a.READY_DIRTY)}}}this.dataHashDidChange(f,null,c,d);e=this.changelog;if(!e){e=this.changelog=SC.Set.create()}e.add(f);this.changelog=e;if(this.get("commitRecordsAutomatically")){this.invokeLast(this.commitRecords)}return this},recordsDidChange:function(d,a,f){var g,e,h,b,c,i;if(f===undefined){g=a.length;e=SC.typeOf(d)===SC.T_ARRAY;if(!e){c=d}for(h=0;h<g;h++){if(e){c=d[h]||SC.Record}b=a?a[h]:undefined;i=f?f[h]:undefined;this.recordDidChange(c,b,i)}}else{g=f.length;for(h=0;h<g;h++){i=f?f[h]:undefined;this.recordDidChange(undefined,undefined,i)}}return this},retrieveRecords:function(f,m,b,c,q){var l=this._getDataSource(),h=SC.typeOf(f)===SC.T_ARRAY,k=SC.typeOf(q)===SC.T_ARRAY,o=(!b)?m.length:b.length,r=[],p=SC.Store.generateStoreKey(),g=SC.Record,a,j,e,n,i,d;if(!h){a=f}for(j=0;j<o;j++){if(b){e=b[j]}else{if(h){a=f[j]}e=a.storeKeyFor(m[j])}d=k?q[j]:q;n=this.readStatus(e);if((n==g.EMPTY)||(n==g.ERROR)||(n==g.DESTROYED_CLEAN)){this.writeStatus(e,g.BUSY_LOADING);this.dataHashDidChange(e,p,YES);r.push(e);this._setCallbackForStoreKey(e,d,k,b)}else{if(c){if(n&g.READY){this.writeStatus(e,g.BUSY_REFRESH|(n&3));this.dataHashDidChange(e,p,YES);r.push(e);this._setCallbackForStoreKey(e,d,k,b)}else{if((n==g.BUSY_DESTROYING)||(n==g.BUSY_CREATING)||(n==g.BUSY_COMMITTING)){throw g.BUSY_ERROR}else{if(n==g.DESTROYED_DIRTY){throw g.BAD_STATE_ERROR}}}}}}i=NO;if(l){i=l.retrieveRecords.call(l,this,r,m)}if(!i){o=r.length;p=SC.Store.generateStoreKey();for(j=0;j<o;j++){e=r[j];n=this.readStatus(e);if(n===g.BUSY_LOADING){this.writeStatus(e,g.ERROR);this.dataHashDidChange(e,p,YES)}else{if(n&g.BUSY_REFRESH){this.writeStatus(e,g.READY|(n&3));this.dataHashDidChange(e,p,YES)}}}r.length=0}return r},_TMP_RETRIEVE_ARRAY:[],_callback_queue:{},_setCallbackForStoreKey:function(d,e,b,c){var a=this._callback_queue;if(b){a[d]={callback:e,otherKeys:c}}else{a[d]=e}},_retreiveCallbackForStoreKey:function(c){var a=this._callback_queue,e=a[c],d,b;if(e){if(SC.typeOf(e)===SC.T_FUNCTION){e.call();delete a[c]}else{if(SC.typeOf(e)==SC.T_HASH){e.completed=YES;b=e.storeKeys;b.forEach(function(f){if(!a[f].completed){d=YES}});if(d){e.callback.call();b.forEach(function(f){delete a[f]})}}}}},_cancelCallback:function(b){var a=this._callback_queue;if(a[b]){delete a[b]}},retrieveRecord:function(g,f,b,c,e){var d=this._TMP_RETRIEVE_ARRAY,a;if(b){d[0]=b;b=d;f=null}else{d[0]=f;f=d}a=this.retrieveRecords(g,f,b,c,e);d.length=0;return a[0]},refreshRecord:function(d,c,a,b){return !!this.retrieveRecord(d,c,a,YES,b)},refreshRecords:function(b,c,d,e){var a=this.retrieveRecords(b,c,d,YES,e);return a&&a.length>0},commitRecords:function(f,n,b,q,t){var m=this._getDataSource(),h=SC.typeOf(f)===SC.T_ARRAY,k=SC.typeOf(t)===SC.T_ARRAY,c=[],j=[],l=[],r=SC.Store.generateStoreKey(),g=SC.Record,a,i,e,o,u,s,p,d;if(!f&&!n&&!b){b=this.changelog}p=b?b.get("length"):(n?n.get("length"):0);for(i=0;i<p;i++){if(b){e=b[i]}else{if(h){a=f[i]||SC.Record}else{a=f}e=a.storeKeyFor(n[i])}d=k?t[i]:t;o=this.readStatus(e);if(o==g.ERROR){throw g.NOT_FOUND_ERROR}else{if(o==g.READY_NEW){this.writeStatus(e,g.BUSY_CREATING);this.dataHashDidChange(e,r,YES);c.push(e);this._setCallbackForStoreKey(e,d,k,b)}else{if(o==g.READY_DIRTY){this.writeStatus(e,g.BUSY_COMMITTING);this.dataHashDidChange(e,r,YES);j.push(e);this._setCallbackForStoreKey(e,d,k,b)}else{if(o==g.DESTROYED_DIRTY){this.writeStatus(e,g.BUSY_DESTROYING);this.dataHashDidChange(e,r,YES);l.push(e);this._setCallbackForStoreKey(e,d,k,b)}else{if(o==g.DESTROYED_CLEAN){this.dataHashDidChange(e,r,YES)}}}}}}if(m&&(p>0||q)){s=m.commitRecords.call(m,this,c,j,l,q)}if(s&&!f&&!n){if(b===this.changelog){this.changelog=null}else{this.changelog.removeEach(b)}}return s},commitRecord:function(g,f,b,c,e){var d=this._TMP_RETRIEVE_ARRAY,a;if(f===undefined&&b===undefined){return NO}if(b!==undefined){d[0]=b;b=d;f=null}else{d[0]=f;f=d}a=this.commitRecords(g,f,b,c,e);d.length=0;return a},cancelRecords:function(e,b,i){var a=this._getDataSource(),g=SC.typeOf(e)===SC.T_ARRAY,k=SC.Record,j=[],f,h,l,c,d,m;h=(i===undefined)?b.length:i.length;for(l=0;l<h;l++){if(g){d=e[l]||SC.Record}else{d=e||SC.Record}c=b?b[l]:undefined;if(i===undefined){m=d.storeKeyFor(c)}else{m=i?i[l]:undefined}if(m){f=this.readStatus(m);if((f==k.EMPTY)||(f==k.ERROR)){throw k.NOT_FOUND_ERROR}j.push(m);this._cancelCallback(m)}}if(a){a.cancel.call(a,this,j)}return this},cancelRecord:function(e,d,b){var c=this._TMP_RETRIEVE_ARRAY,a;if(b!==undefined){c[0]=b;b=c;d=null}else{c[0]=d;d=c}a=this.cancelRecords(e,d,b);c.length=0;return this},loadRecord:function(g,d,f){var a=SC.Record,c,b,e;g=g||SC.Record;b=g.prototype.primaryKey;f=f||d[b];c=e=g.storeKeyFor(f);if(this.readStatus(e)&a.BUSY){this.dataSourceDidComplete(e,d,f)}else{this.pushRetrieve(g,f,d,e)}return c},loadRecords:function(d,m,a){var f=SC.typeOf(d)===SC.T_ARRAY,g=m.get("length"),h=[],i=SC.Record,c,b,k,j,e,l;if(!f){c=d||SC.Record;k=c.prototype.primaryKey}for(j=0;j<g;j++){e=m.objectAt(j);if(f){c=d.objectAt(j)||SC.Record;k=c.prototype.primaryKey}b=(a)?a.objectAt(j):e[k];h[j]=this.loadRecord(c,e,b)}return h},readError:function(a){var b=this.recordErrors;return b?b[a]:undefined},readQueryError:function(a){var b=this.queryErrors;return b?b[SC.guidFor(a)]:undefined},dataSourceDidCancel:function(c){var b=this.readStatus(c),a=SC.Record;if(!(b&a.BUSY)){throw a.BAD_STATE_ERROR}switch(b){case a.BUSY_LOADING:b=a.EMPTY;break;case a.BUSY_CREATING:b=a.READY_NEW;break;case a.BUSY_COMMITTING:b=a.READY_DIRTY;break;case a.BUSY_REFRESH_CLEAN:b=a.READY_CLEAN;break;case a.BUSY_REFRESH_DIRTY:b=a.READY_DIRTY;break;case a.BUSY_DESTROYING:b=a.DESTROYED_DIRTY;break;default:throw a.BAD_STATE_ERROR}this.writeStatus(c,b);this.dataHashDidChange(c,null,YES);this._cancelCallback(c);return this},dataSourceDidComplete:function(g,f,e){var c=this.readStatus(g),b=SC.Record,d;if(!(c&b.BUSY)){throw b.BAD_STATE_ERROR}if(c===b.BUSY_DESTROYING){throw b.BAD_STATE_ERROR}else{c=b.READY_CLEAN}this.writeStatus(g,c);if(f){this.writeDataHash(g,f,c)}if(e){SC.Store.replaceIdFor(g,e)}d=f||e?NO:YES;this.dataHashDidChange(g,null,d);var a=this.materializeRecord(g);if(a!=null){a.notifyPropertyChange("status")}this._retreiveCallbackForStoreKey(g);return this},dataSourceDidDestroy:function(d){var c=this.readStatus(d),b=SC.Record;if(!(c&b.BUSY)){throw b.BAD_STATE_ERROR}else{c=b.DESTROYED_CLEAN}this.removeDataHash(d,c);this.dataHashDidChange(d);var a=this.materializeRecord(d);if(a!=null){a.notifyPropertyChange("status")}this._retreiveCallbackForStoreKey(d);return this},dataSourceDidError:function(e,d){var c=this.readStatus(e),f=this.recordErrors,b=SC.Record;if(!(c&b.BUSY)){throw b.BAD_STATE_ERROR}else{c=b.ERROR}if(d&&d.isError){if(!f){f=this.recordErrors=[]}f[e]=d}this.writeStatus(e,c);this.dataHashDidChange(e,null,YES);var a=this.materializeRecord(e);if(a!=null){a.notifyPropertyChange("status")}this._retreiveCallbackForStoreKey(e);return this},pushRetrieve:function(f,e,c,d){var b=SC.Record,a;if(d===undefined){d=f.storeKeyFor(e)}a=this.readStatus(d);if(a==b.EMPTY||a==b.ERROR||a==b.READY_CLEAN||a==b.DESTROYED_CLEAN){a=b.READY_CLEAN;if(c===undefined){this.writeStatus(d,a)}else{this.writeDataHash(d,c,a)}if(e&&this.idFor(d)!==e){SC.Store.replaceIdFor(d,e)}this.dataHashDidChange(d);return d}return NO},pushDestroy:function(e,d,c){var b=SC.Record,a;if(c===undefined){c=e.storeKeyFor(d)}a=this.readStatus(c);if(a==b.EMPTY||a==b.ERROR||a==b.READY_CLEAN||a==b.DESTROYED_CLEAN){a=b.DESTROYED_CLEAN;this.removeDataHash(c,a);this.dataHashDidChange(c);return c}return NO},pushError:function(g,f,c,d){var b=SC.Record,a,e=this.recordErrors;if(d===undefined){d=g.storeKeyFor(f)}a=this.readStatus(d);if(a==b.EMPTY||a==b.ERROR||a==b.READY_CLEAN||a==b.DESTROYED_CLEAN){a=b.ERROR;if(c&&c.isError){if(!e){e=this.recordErrors=[]}e[d]=c}this.writeStatus(d,a);this.dataHashDidChange(d,null,YES);return d}return NO},loadQueryResults:function(c,a){if(c.get("location")===SC.Query.LOCAL){throw new Error("Cannot load query results for a local query")}var b=this._findQuery(c,YES,NO);if(b){b.set("storeKeys",a)}this.dataSourceDidFetchQuery(c);return this},dataSourceDidFetchQuery:function(a){return this._scstore_dataSourceDidFetchQuery(a,YES)},_scstore_dataSourceDidFetchQuery:function(d,a){var c=this._findQuery(d,a,NO),b=this.get("nestedStores"),e=b?b.get("length"):0;if(c){c.storeDidFetchQuery(d)}while(--e>=0){b[e]._scstore_dataSourceDidFetchQuery(d,NO)}return this},dataSourceDidCancelQuery:function(a){return this._scstore_dataSourceDidCancelQuery(a,YES)},_scstore_dataSourceDidCancelQuery:function(d,a){var c=this._findQuery(d,a,NO),b=this.get("nestedStores"),e=b?b.get("length"):0;if(c){c.storeDidCancelQuery(d)}while(--e>=0){b[e]._scstore_dataSourceDidCancelQuery(d,NO)}return this},dataSourceDidErrorQuery:function(b,a){var c=this.queryErrors;if(a&&a.isError){if(!c){c=this.queryErrors={}}c[SC.guidFor(b)]=a}return this._scstore_dataSourceDidErrorQuery(b,YES)},_scstore_dataSourceDidErrorQuery:function(d,a){var c=this._findQuery(d,a,NO),b=this.get("nestedStores"),e=b?b.get("length"):0;if(c){c.storeDidErrorQuery(d)}while(--e>=0){b[e]._scstore_dataSourceDidErrorQuery(d,NO)}return this},init:function(){arguments.callee.base.apply(this,arguments);this.reset()},toString:function(){var b=this.get("name");if(!b){return arguments.callee.base.apply(this,arguments)}else{var a=arguments.callee.base.apply(this,arguments);return"%@ (%@)".fmt(b,a)}},idFor:function(a){return SC.Store.idFor(a)},recordTypeFor:function(a){return SC.Store.recordTypeFor(a)},storeKeyFor:function(b,a){return b.storeKeyFor(a)},storeKeyExists:function(b,a){return b.storeKeyExists(a)},storeKeysFor:function(f){var a=[],e=f&&f.isEnumerable,c,d,b;if(!this.statuses){return a}for(d in SC.Store.recordTypesByStoreKey){c=SC.Store.recordTypesByStoreKey[d];if(e){b=f.contains(c)}else{b=c===f}if(b&&this.statuses[d]){a.push(parseInt(d,10))}}return a},storeKeys:function(){var a=[],b;if(!this.statuses){return a}for(b in this.statuses){if(this.statuses[b]!=SC.Record.EMPTY){a.push(parseInt(b,10))}}return a},statusString:function(a){var b=this.materializeRecord(a);return b.statusString()}});SC.Store.mixin({CHAIN_CONFLICT_ERROR:new Error("Nested Store Conflict"),NO_PARENT_STORE_ERROR:new Error("Parent Store Required"),NESTED_STORE_UNSUPPORTED_ERROR:new Error("Unsupported In Nested Store"),NESTED_STORE_RETRIEVE_DIRTY_ERROR:new Error("Cannot Retrieve Dirty Record in Nested Store"),EDITABLE:"editable",LOCKED:"locked",INHERITED:"inherited",idsByStoreKey:[],recordTypesByStoreKey:{},queriesByStoreKey:[],nextStoreKey:1,generateStoreKey:function(){return this.nextStoreKey++},idFor:function(a){return this.idsByStoreKey[a]},queryFor:function(a){return this.queriesByStoreKey[a]},recordTypeFor:function(a){return this.recordTypesByStoreKey[a]},replaceIdFor:function(c,a){var d=this.idsByStoreKey[c],e,b;if(d!==a){e=this.recordTypeFor(c);if(!e){throw new Error("replaceIdFor: storeKey %@ does not exist".fmt(c))}this.idsByStoreKey[c]=a;b=e.storeKeysById();delete b[d];b[a]=c}return this},replaceRecordTypeFor:function(a,b){this.recordTypesByStoreKey[a]=b;return this}});SC.Store.prototype.nextStoreIndex=1;SC.Store._getDefaultStore=function(){var a=this._store;if(!a){this._store=a=SC.Store.create()}return a};SC.Store.updateRecords=function(f,g,h,c){SC.Logger.warn("SC.Store.updateRecords() is deprecated.  Use loadRecords() instead");var d=this._getDefaultStore(),b=f.length,a,e;if(!h){h=[];for(a=0;a<b;a++){h[a]=f[a].recordType}}e=d.loadRecords(h,f);b=e.length;for(a=0;a<b;a++){e[a]=d.materializeRecord(e[a])}return e};SC.Store.find=function(a,b){return this._getDefaultStore().find(b,a)};SC.Store.findAll=function(a,b){return this._getDefaultStore().findAll(a,b)};sc_require("system/store");SC.NestedStore=SC.Store.extend({hasChanges:NO,parentStore:null,isNested:YES,lockOnRead:YES,locks:null,chainedChanges:null,find:function(a){if(a&&a.isQuery&&a.get("location")!==SC.Query.LOCAL){throw"SC.Store#find() can only accept LOCAL queries in nested stores"}return arguments.callee.base.apply(this,arguments)},commitChanges:function(b){if(this.get("hasChanges")){var a=this.get("parentStore");a.commitChangesFromNestedStore(this,this.chainedChanges,b)}this.reset();return this},discardChanges:function(){var c,f;if((c=this.records)&&(f=this.locks)){var b=this.get("parentStore"),h=b.revisions;var g=this.revisions,e,d,a;for(e in c){if(!c.hasOwnProperty(e)){continue}if(!(d=f[e])){continue}a=h[e];if((a!==d)||(g[e]>a)){this._notifyRecordPropertyChange(parseInt(e,10))}}}this.reset();this.flush();return this},destroy:function(){this.discardChanges();var a=this.get("parentStore");if(a){a.willDestroyNestedStore(this)}arguments.callee.base.apply(this,arguments);return this},reset:function(){var c,d,a;var b=this.get("parentStore");if(!b){throw SC.Store.NO_PARENT_STORE_ERROR}this.dataHashes=SC.beget(b.dataHashes);this.revisions=SC.beget(b.revisions);this.statuses=SC.beget(b.statuses);this.childRecords=b.childRecords?SC.beget(b.childRecords):{};this.parentRecords=b.parentRecords?SC.beget(b.parentRecords):{};this.chainedChanges=this.locks=this.editables=null;this.changelog=null;this.set("hasChanges",NO)},refreshQuery:function(b){var a=this.get("parentStore");if(a){a.refreshQuery(b)}return this},readError:function(b){var a=this.get("parentStore");return a?a.readError(b):null},readQueryError:function(b){var a=this.get("parentStore");return a?a.readQueryError(b):null},storeKeyEditState:function(b){var c=this.editables,a=this.locks;return(c&&c[b])?SC.Store.EDITABLE:(a&&a[b])?SC.Store.LOCKED:SC.Store.INHERITED},_lock:function(j){var k=this.locks,f,h,d,a,l,g,e,i;if(k&&k[j]){return this}if(!k){k=this.locks=[]}h=this.editables;if(h){h[j]=0}var b=this.get("parentStore"),c;while(b&&(c=b.storeKeyEditState(j))===SC.Store.INHERITED){b=b.get("parentStore")}if(b&&c===SC.Store.EDITABLE){d=this.childRecords[j];if(d){this._lock(d);a=this.parentRecords[d];if(a){l=a[j];g=l?SC.tupleForPropertyPath(l,this.dataHashes[d]):null;if(g){e=g[0];i=g[1]}this.dataHashes[j]=e&&i?e[i]:null}}else{this.dataHashes[j]=SC.clone(b.dataHashes[j],YES)}if(!h){h=this.editables=[]}h[j]=1}else{this.dataHashes[j]=b.dataHashes[j]}this.statuses[j]=this.statuses[j];f=this.revisions[j]=this.revisions[j];k[j]=f||1;return this},readDataHash:function(a){if(this.get("lockOnRead")){this._lock(a)}return this.dataHashes[a]},readEditableDataHash:function(a){this._lock(a);return arguments.callee.base.apply(this,arguments)},writeDataHash:function(d,f,b){var c=this.locks,g=NO,a;if(f){this.dataHashes[d]=f}else{this._lock(d);g=YES}if(b){this.statuses[d]=b}else{if(!g){this.statuses[d]=(this.statuses[d]||SC.Record.READY_NEW)}}if(!g){a=this.revisions[d]=this.revisions[d];if(!c){c=this.locks=[]}if(!c[d]){c[d]=a||1}}var e=this.editables;if(!e){e=this.editables=[]}e[d]=1;return this},removeDataHash:function(c,a){var b=this.locks;if(!b){b=this.locks=[]}if(!b[c]){b[c]=this.revisions[c]||1}return arguments.callee.base.apply(this,arguments)},dataHashDidChange:function(d,b,a,h){if(!b){b=SC.Store.generateStoreKey()}var c,e,g,i;c=SC.typeOf(d)===SC.T_ARRAY;if(c){e=d.length}else{e=1;i=d}var f=this.chainedChanges;if(!f){f=this.chainedChanges=SC.Set.create()}for(g=0;g<e;g++){if(c){i=d[g]}this._lock(i);this.revisions[i]=b;f.add(i);this._notifyRecordPropertyChange(i,a,h)}this.setIfChanged("hasChanges",YES);return this},commitChangesFromNestedStore:function(e,f,a){arguments.callee.base.apply(this,arguments);var b=this.get("parentStore"),h=b.revisions,c;var k=this.locks,g=this.chainedChanges,d,j;if(!k){k=this.locks=[]}if(!g){g=this.chainedChanges=SC.Set.create()}d=f.length;for(c=0;c<d;c++){j=f[c];if(!k[j]){k[j]=h[j]||1}g.add(j)}this.setIfChanged("hasChanges",g.get("length")>0);this.flush();return this},queryFor:function(c,a,b){return this.get("parentStore").queryFor(c,a,b)},findAll:function(e,b,d,c,a){if(!a){a=this}return this.get("parentStore").findAll(e,b,d,c,a)},retrieveRecords:function(f,m,b,c){var a=this.get("parentStore"),k,d,p,o=(!b)?m.length:b.length,i=SC.Record,n;if(c){for(k=0;k<o;k++){d=!b?a.storeKeyFor(f,m[k]):b[k];n=this.peekStatus(d);if(n&i.DIRTY){throw SC.Store.NESTED_STORE_RETRIEVE_DIRTY_ERROR}else{var g=this.dataHashes,j=this.revisions,h=this.statuses,l=this.editables,r=this.locks;var e=NO;var q=NO;if(g&&g.hasOwnProperty(d)){delete g[d];e=YES}if(j&&j.hasOwnProperty(d)){delete j[d];e=YES}if(l){delete l[d]}if(r){delete r[d]}if(h&&h.hasOwnProperty(d)){delete h[d];if(!e){q=YES}e=YES}if(e){this._notifyRecordPropertyChange(d,q)}}}}return a.retrieveRecords(f,m,b,c)},commitRecords:function(a,b,c){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},commitRecord:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecords:function(a,b,c){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecord:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidCancel:function(a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidComplete:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidDestroy:function(a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidError:function(b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushRetrieve:function(d,c,a,b){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushDestroy:function(c,b,a){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushError:function(d,c,a,b){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR}});sc_require("models/record");SC.RecordArray=SC.Object.extend(SC.Enumerable,SC.Array,{store:null,query:null,storeKeys:null,status:SC.Record.EMPTY,isEditable:function(){var a=this.get("query");return a?a.get("isEditable"):YES}.property("query").cacheable(),length:function(){this.flush();var a=this.get("storeKeys");return a?a.get("length"):0}.property("storeKeys").cacheable(),_scra_records:null,objectAt:function(a){this.flush();var f=this._scra_records,e=this.get("storeKeys"),b=this.get("store"),d,c;if(!e||!b){return undefined}if(f&&(c=f[a])){return c}if(!f){this._scra_records=f=[]}d=e.objectAt(a);if(d){if(b.peekStatus(d)===SC.Record.EMPTY){b.retrieveRecord(null,null,d)}f[a]=c=b.materializeRecord(d)}return c},forEach:function(h,d){this.flush();var e=this._scra_records,b=this.get("storeKeys"),f=this.get("store"),c=b?b.get("length"):0,g,i,a;if(!b||!f){return this}if(!e){e=this._scra_records=[]}if(!d){d=this}for(g=0;g<c;g++){a=e[g];if(!a){a=e[g]=f.materializeRecord(b.objectAt(g))}h.call(d,a,g,this)}return this},replace:function(b,g,f){this.flush();var e=this.get("storeKeys"),a=f?(f.get?f.get("length"):f.length):0,c,d;if(!e){throw"Unable to edit an SC.RecordArray that does not have its storeKeys property set."}if(!this.get("isEditable")){throw SC.RecordArray.NOT_EDITABLE}d=[];for(c=0;c<a;c++){d[c]=f.objectAt(c).get("storeKey")}e.replace(b,g,d);return this},contains:function(a){return this.indexOf(a)>=0},indexOf:function(b,a){if(!SC.kindOf(b,SC.Record)){SC.Logger.warn("Using indexOf on %@ with an object that is not an SC.Record".fmt(b));return -1}this.flush();var d=b.get("storeKey"),c=this.get("storeKeys");return c?c.indexOf(d,a):-1},lastIndexOf:function(b,a){if(!SC.kindOf(b,SC.Record)){SC.Logger.warn("Using lastIndexOf on %@ with an object that is not an SC.Record".fmt(b));return -1}this.flush();var d=b.get("storeKey"),c=this.get("storeKeys");return c?c.lastIndexOf(d,a):-1},add:function(a){if(!SC.kindOf(a,SC.Record)){return this}if(this.indexOf(a)<0){this.pushObject(a)}return this},remove:function(a){if(!SC.kindOf(a,SC.Record)){return this}this.removeObject(a);return this},find:function(a,b,c){if(b&&b.isQuery){return this.get("store").find(b.queryWithScope(this))}else{return a.apply(this,SC.$A(arguments).slice(1))}}.enhance(),refresh:function(){this.get("store").refreshQuery(this.get("query"));return this},reload:function(){this.flush(YES);return this},destroy:function(){if(!this.get("isDestroyed")){this.get("store").recordArrayWillDestroy(this)}arguments.callee.base.apply(this,arguments)},storeWillFetchQuery:function(c){var b=this.get("status"),a=SC.Record;if((b===a.EMPTY)||(b===a.ERROR)){b=a.BUSY_LOADING}if(b&a.READY){b=a.BUSY_REFRESH}this.setIfChanged("status",b);return this},storeDidFetchQuery:function(a){this.setIfChanged("status",SC.Record.READY_CLEAN);return this},storeDidCancelQuery:function(c){var b=this.get("status"),a=SC.Record;if(b===a.BUSY_LOADING){b=a.EMPTY}else{if(b===a.BUSY_REFRESH){b=a.READY_CLEAN}}this.setIfChanged("status",b);return this},storeDidErrorQuery:function(a){this.setIfChanged("status",SC.Record.ERROR);return this},storeDidChangeStoreKeys:function(b,a){var c=this.get("query");if(c.get("location")!==SC.Query.LOCAL){return this}if(!c.containsRecordTypes(a)){return this}var d=this._scq_changedStoreKeys;if(!d){d=this._scq_changedStoreKeys=SC.IndexSet.create()}d.addEach(b);this.set("needsFlush",YES);if(this.get("storeKeys")){this.flush()}return this},scheduledFlushCount:0,flush:function(a){if(this._insideFlush){this.set("needsFlush",YES);return this}if(!this.get("needsFlush")&&!a){return this}this.set("needsFlush",NO);var j=this.get("query"),m=this.get("store");if(!m||!j||j.get("location")!==SC.Query.LOCAL){return this}this._insideFlush=YES;var h=this.get("storeKeys"),f=this._scq_changedStoreKeys,g=NO,k=SC.Record,p=[],b=new Date(),d,e,c,q,o,i;var l=h;if(h&&!a){if(f){f.forEach(function(r){if(p.length>0||new Date()-b>SC.RecordArray.QUERY_MATCHING_THRESHOLD){p.push(r);return}e=m.peekStatus(r);if(!(e&k.EMPTY)&&!((e&k.DESTROYED)||(e===k.BUSY_DESTROYING))){d=m.materializeRecord(r);i=!!(d&&j.contains(d))}else{i=NO}if(i){if(h.indexOf(r)<0){if(!g){h=h.copy()}h.pushObject(r)}}else{if(h.indexOf(r)>=0){if(!g){h=h.copy()}h.removeObject(r)}}},this);g=YES}}else{if(o=j.get("scope")){q=o.flush().get("storeKeys")}else{if(c=j.get("expandedRecordTypes")){q=SC.IndexSet.create();c.forEach(function(r){q.addEach(m.storeKeysFor(r))})}}h=[];q.forEach(function(r){if(p.length>0||new Date()-b>SC.RecordArray.QUERY_MATCHING_THRESHOLD){p.push(r);return}e=m.peekStatus(r);if(!(e&k.EMPTY)&&!((e&k.DESTROYED)||(e===k.BUSY_DESTROYING))){d=m.materializeRecord(r);if(d&&j.contains(d)){h.push(r)}}});g=YES}if(p.length>0){var n=this;this.incrementProperty("scheduledFlushCount");window.setTimeout(function(){SC.run(function(){if(!n||n.get("isDestroyed")){return}n.set("needsFlush",YES);n._scq_changedStoreKeys=SC.IndexSet.create().addEach(p);n.flush();n.decrementProperty("scheduledFlushCount")})},1)}if(f){f.clear()}if(g){if(h&&(h===l)){h=h.copy()}h=SC.Query.orderStoreKeys(h,j,m);if(SC.compare(l,h)!==0){this.set("storeKeys",SC.clone(h))}}this._insideFlush=NO;return this},needsFlush:YES,isError:function(){return !!(this.get("status")&SC.Record.ERROR)}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var a=this.get("store");return a.readQueryError(this.get("query"))||SC.Record.GENERIC_ERROR}else{return null}}.property("isError").cacheable(),propertyWillChange:function(b){if(b==="storeKeys"){var c=this.get("storeKeys");var a=c?c.get("length"):0;this.arrayContentWillChange(0,a,0)}return arguments.callee.base.apply(this,arguments)},_storeKeysDidChange:function(){var e=this.get("storeKeys");var d=this._prevStoreKeys,b,c,g=this._storeKeysContentDidChange,a=this._storeKeysStateDidChange;if(e===d){return}if(d){d.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange});b=d.get("length")}else{b=0}this._prevStoreKeys=e;if(e){e.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange});c=e.get("length")}else{c=0}this._storeKeysContentDidChange(0,b,c)}.observes("storeKeys"),addArrayObservers:function(){this.flush();return SC.Array.addArrayObservers.apply(this,arguments)},_storeKeysContentDidChange:function(c,a,b){if(this._scra_records){this._scra_records.length=0}this.arrayContentDidChange(c,a,b)},init:function(){arguments.callee.base.apply(this,arguments);this._storeKeysDidChange()}});SC.RecordArray.mixin({NOT_EDITABLE:SC.Error.desc("SC.RecordArray is not editable"),QUERY_MATCHING_THRESHOLD:100});Function.prototype.handleEvents=function(){this.isEventHandler=YES;this.events=arguments;return this};Function.prototype.stateObserves=function(){this.isStateObserveHandler=YES;this.args=SC.A(arguments);return this};SC.StatechartDelegate={isStatechartDelegate:YES,statechartUpdateLocationForState:function(b,a,c){SC.routes.set("location",a)},statechartAcquireLocationForState:function(a,b){return SC.routes.get("location")},statechartBindStateToRoute:function(b,d,a,c){SC.routes.add(a,d,c)},statechartShouldStateHandleTriggeredRoute:function(a,c,b){return YES},statechartStateCancelledHandlingTriggeredRoute:function(a,c,b){}};SC.StatePathMatcher=SC.Object.extend({state:null,expression:null,tokens:null,init:function(){arguments.callee.base.apply(this,arguments);this._parseExpression()},_parseExpression:function(){var h=this.expression?this.expression.split("."):[],b=h.length,f=0,c,e=null,d,g=[];for(;f<b;f+=1){c=h[f];if(c.indexOf("~")>=0){c=c.split("~");if(c.length>2){throw"Invalid use of '~' at part %@".fmt(f)}d=SC.StatePathMatcher._ExpandToken.create({start:c[0],end:c[1]})}else{if(c==="this"){if(g.length>0){throw"Invalid use of 'this' at part %@".fmt(f)}d=SC.StatePathMatcher._ThisToken.create()}else{d=SC.StatePathMatcher._BasicToken.create({value:c})}}d.owner=this;g.push(d)}this.set("tokens",g);var a=SC.clone(g);this._chain=e=a.pop();while(d=a.pop()){e.nextToken=d;e=d}},lastPart:function(){var c=this.get("tokens"),a=c?c.length:0,b=a>0?c[a-1]:null;return b.get("lastPart")}.property("tokens").cacheable(),match:function(a){this._stack=a.split(".");if(SC.empty(a)||SC.typeOf(a)!==SC.T_STRING){return NO}return this._chain.match()},_pop:function(){this._lastPopped=this._stack.pop();return this._lastPopped}});SC.StatePathMatcher._Token=SC.Object.extend({type:null,owner:null,nextToken:null,lastPart:null,match:function(){return NO}});SC.StatePathMatcher._BasicToken=SC.StatePathMatcher._Token.extend({type:"basic",value:null,lastPart:function(){return this.value}.property("value").cacheable(),match:function(){var a=this.owner._pop(),b=this.nextToken;if(this.value!==a){return NO}return b?b.match():YES}});SC.StatePathMatcher._ExpandToken=SC.StatePathMatcher._Token.extend({type:"expand",start:null,end:null,lastPart:function(){return this.end}.property("end").cacheable(),match:function(){var d=this.start,a=this.end,b,c=this.nextToken;b=this.owner._pop();if(b!==a){return NO}while(b=this.owner._pop()){if(b===d){return c?c.match():YES}}return NO}});SC.StatePathMatcher._ThisToken=SC.StatePathMatcher._Token.extend({type:"this",lastPart:"this",match:function(){var e=this.owner.state,c=e.get("substates"),a=c.length,d=0,b;b=this.owner._lastPopped;if(!b||this.owner._stack.length!==0){return NO}for(;d<a;d+=1){if(c[d].get("name")===b){return YES}}return NO}});SC.Async=SC.Object.extend({func:null,arg1:null,arg2:null,tryToPerform:function(d){var c=this.get("func"),b=this.get("arg1"),a=this.get("arg2"),e=SC.typeOf(c);if(e===SC.T_STRING){d.tryToPerform(c,b,a)}else{if(e===SC.T_FUNCTION){c.apply(d,[b,a])}}}});SC.Async.mixin({perform:function(c,b,a){return SC.Async.create({func:c,arg1:b,arg2:a})}});SC.State=SC.Object.extend({name:null,parentState:null,historyState:null,initialSubstate:null,substatesAreConcurrent:NO,substates:null,statechart:null,stateIsInitialized:NO,currentSubstates:null,enteredSubstates:null,representRoute:null,trace:function(){var a=this.getPath("statechart.statechartTraceKey");return this.getPath("statechart.%@".fmt(a))}.property().cacheable(),owner:function(){var c=this.get("statechart"),b=c?c.get("statechartOwnerKey"):null,a=c?c.get(b):null;return a?a:c}.property().cacheable(),statechartDelegate:function(){return this.getPath("statechart.statechartDelegate")}.property().cacheable(),location:function(b,c){var d=this.get("statechart"),a=this.get("statechartDelegate");if(c!==undefined){a.statechartUpdateLocationForState(d,c,this)}return a.statechartAcquireLocationForState(d,this)}.property().idempotent(),init:function(){arguments.callee.base.apply(this,arguments);this._registeredEventHandlers={};this._registeredStringEventHandlers={};this._registeredRegExpEventHandlers=[];this._registeredStateObserveHandlers={};this._registeredSubstatePaths={};this._registeredSubstates=[];this._isEnteringState=NO;this._isExitingState=NO;var b=this.get("statechart"),c=b?b.get("statechartOwnerKey"):null,a=b?b.get("statechartTraceKey"):null;if(b){b.addObserver(c,this,"_statechartOwnerDidChange");b.addObserver(a,this,"_statechartTraceDidChange")}},destroy:function(){var c=this.get("statechart"),d=c?c.get("statechartOwnerKey"):null,a=c?c.get("statechartTraceKey"):null;if(c){c.removeObserver(d,this,"_statechartOwnerDidChange");c.removeObserver(a,this,"_statechartTraceDidChange")}var b=this.get("substates");if(b){b.forEach(function(e){e.destroy()})}this._teardownAllStateObserveHandlers();this.set("substates",null);this.set("currentSubstates",null);this.set("enteredSubstates",null);this.set("parentState",null);this.set("historyState",null);this.set("initialSubstate",null);this.set("statechart",null);this.notifyPropertyChange("trace");this.notifyPropertyChange("owner");this._registeredEventHandlers=null;this._registeredStringEventHandlers=null;this._registeredRegExpEventHandlers=null;this._registeredStateObserveHandlers=null;this._registeredSubstatePaths=null;this._registeredSubstates=null;arguments.callee.base.apply(this,arguments)},initState:function(){if(this.get("stateIsInitialized")){return}this._registerWithParentStates();this._setupRouteHandling();var l=null,k=null,b=null,m=[],j=NO,h=this.get("initialSubstate"),f=this.get("substatesAreConcurrent"),d=this.get("statechart"),c=0,g=0,e=NO,a=null;this.set("substates",m);if(SC.kindOf(h,SC.HistoryState)&&h.isClass){a=this.createSubstate(h);this.set("initialSubstate",a);if(SC.none(a.get("defaultState"))){this.stateLogError("Initial substate is invalid. History state requires the name of a default state to be set");this.set("initialSubstate",null);a=null}}for(l in this){k=this[l];e=SC.typeOf(k)===SC.T_FUNCTION;if(e&&k.isEventHandler){this._registerEventHandler(l,k);continue}if(e&&k.isStateObserveHandler){this._registerStateObserveHandler(l,k);continue}if(e&&k.statePlugin){k=k.apply(this)}if(SC.kindOf(k,SC.State)&&k.isClass&&this[l]!==this.constructor){b=this._addSubstate(l,k);if(l===h){this.set("initialSubstate",b);j=YES}else{if(a&&a.get("defaultState")===l){a.set("defaultState",b);j=YES}}}}if(!SC.none(h)&&!j){this.stateLogError("Unable to set initial substate %@ since it did not match any of state's %@ substates".fmt(h,this))}if(m.length===0){if(!SC.none(h)){this.stateLogWarning("Unable to make %@ an initial substate since state %@ has no substates".fmt(h,this))}}else{if(m.length>0){b=this._addEmptyInitialSubstateIfNeeded();if(!b&&h&&f){this.set("initialSubstate",null);this.stateLogWarning("Can not use %@ as initial substate since substates are all concurrent for state %@".fmt(h,this))}}}this.notifyPropertyChange("substates");this.set("currentSubstates",[]);this.set("enteredSubstates",[]);this.set("stateIsInitialized",YES)},_setupRouteHandling:function(){var b=this.get("representRoute"),c=this.get("statechart"),a=this.get("statechartDelegate");if(!b){return}if(this.get("isConcurrentState")){this.stateLogError("State %@ cannot handle route '%@' since state is concurrent".fmt(this,b));return}a.statechartBindStateToRoute(c,this,b,this.routeTriggered)},routeTriggered:function(f){if(this._isEnteringState){return}var e=this.get("statechart"),b=this.get("statechartDelegate"),d=this.get("location");var a={state:this,location:d,params:f,handler:this.routeTriggered};var c=this.createStateRouteHandlerContext(a);if(b.statechartShouldStateHandleTriggeredRoute(e,this,c)){if(this.get("trace")&&d){this.stateLogTrace("will handle route '%@'".fmt(d))}this.handleTriggeredRoute(c)}else{b.statechartStateCancelledHandlingTriggeredRoute(e,this,c)}},createStateRouteHandlerContext:function(a){return SC.StateRouteHandlerContext.create(a)},handleTriggeredRoute:function(a){this.gotoState(this,a)},_addEmptyInitialSubstateIfNeeded:function(){var c=this.get("initialSubstate"),b=this.get("substatesAreConcurrent");if(c||b){return null}var a=this.createSubstate(SC.EmptyState);this.set("initialSubstate",a);this.get("substates").push(a);this[a.get("name")]=a;a.initState();this.stateLogWarning("state %@ has no initial substate defined. Will default to using an empty state as initial substate".fmt(this));return a},_addSubstate:function(c,d,a){var b=this.get("substates");a=SC.clone(a)||{};a.name=c;d=this.createSubstate(d,a);b.push(d);this[c]=d;d.initState();return d},addSubstate:function(c,e,b){if(SC.empty(c)){this.stateLogError("Can not add substate. name required");return null}if(this[c]!==undefined){this.stateLogError("Can not add substate '%@'. Already a defined property".fmt(c));return null}if(!this.get("stateIsInitialized")){this.stateLogError("Can not add substate '%@'. this state is not yet initialized".fmt(c));return null}var a=arguments.length;if(a===1){e=SC.State}else{if(a===2&&SC.typeOf(e)===SC.T_HASH){b=e;e=SC.State}}var d=SC.kindOf(e,SC.State)&&e.isClass;if(!d){this.stateLogError("Can not add substate '%@'. must provide a state class".fmt(c));return null}e=this._addSubstate(c,e,b);this._addEmptyInitialSubstateIfNeeded();this.notifyPropertyChange("substates");return e},createSubstate:function(b,a){a=a||{};return b.create({parentState:this,statechart:this.get("statechart")},a)},_registerEventHandler:function(b,e){var d=e.events,f=null,a=d.length,c=0;this._registeredEventHandlers[b]=e;for(;c<a;c+=1){f=d[c];if(SC.typeOf(f)===SC.T_STRING){this._registeredStringEventHandlers[f]={name:b,handler:e};continue}if(f instanceof RegExp){this._registeredRegExpEventHandlers.push({name:b,handler:e,regexp:f});continue}this.stateLogError("Invalid event %@ for event handler %@ in state %@".fmt(f,b,this))}},_registerStateObserveHandler:function(d,f){var e=0,c=f.args,b=c.length,a,g=YES;for(;e<b;e+=1){a=c[e];if(SC.typeOf(a)!==SC.T_STRING||SC.empty(a)){this.stateLogError("Invalid argument %@ for state observe handler %@ in state %@".fmt(a,d,this));g=NO}}if(!g){return}this._registeredStateObserveHandlers[d]=f.args},_registerWithParentStates:function(){var a=this.get("parentState");while(!SC.none(a)){a._registerSubstate(this);a=a.get("parentState")}},_registerSubstate:function(b){var c=b.pathRelativeTo(this);if(SC.none(c)){return}this._registeredSubstates.push(b);var a=this._registeredSubstatePaths;if(a[b.get("name")]===undefined){a[b.get("name")]={}}var d=a[b.get("name")];d[c]=b},pathRelativeTo:function(b){var c=this.get("name"),a=this.get("parentState");while(!SC.none(a)&&a!==b){c="%@.%@".fmt(a.get("name"),c);a=a.get("parentState")}if(a!==b&&b!==this){this.stateLogError("Can not generate relative path from %@ since it not a parent state of %@".fmt(b,this));return null}return c},getSubstate:function(f,h,e){if(!f){return null}var b=SC.typeOf(f);if(b===SC.T_OBJECT){return this._registeredSubstates.indexOf(f)>-1?f:null}if(b!==SC.T_STRING){this.stateLogError("Can not find matching subtype. value must be an object or string: %@".fmt(f));return null}var d=SC.StatePathMatcher.create({state:this,expression:f}),c=[],g;if(d.get("tokens").length===0){return null}var j=this._registeredSubstatePaths[d.get("lastPart")];if(!j){return this._notifySubstateNotFound(h,e,f)}for(g in j){if(d.match(g)){c.push(j[g])}}if(c.length===1){return c[0]}if(c.length>1){var i=[];for(g in j){i.push(g)}if(h){return this._notifySubstateNotFound(h,e,f,i)}var a="Can not find substate matching '%@' in state %@. Ambiguous with the following: %@";this.stateLogError(a.fmt(f,this.get("fullPath"),i.join(", ")))}return this._notifySubstateNotFound(h,e,f)},_notifySubstateNotFound:function(d,c,b,a){return d?d.call(c||this,this,b,a):null},getState:function(a){if(a===this.get("name")){return this}if(SC.kindOf(a,SC.State)){return a}return this.getSubstate(a,this._handleSubstateNotFound)},_handleSubstateNotFound:function(d,c,a){var b=this.get("parentState");if(b){return b.getState(c)}if(a){var e="Can not find state matching '%@'. Ambiguous with the following: %@";this.stateLogError(e.fmt(c,a.join(", ")))}return null},gotoState:function(c,a){var b=this.getState(c);if(!b){var d="can not go to state %@ from state %@. Invalid value.";this.stateLogError(d.fmt(c,this));return}var e=this.findFirstRelativeCurrentState(b);this.get("statechart").gotoState(b,e,false,a)},gotoHistoryState:function(d,a,b){var c=this.getState(d);if(!c){var e="can not go to history state %@ from state %@. Invalid value.";this.stateLogError(e.fmt(d,this));return}var f=this.findFirstRelativeCurrentState(c);this.get("statechart").gotoHistoryState(c,f,a,b)},resumeGotoState:function(){this.get("statechart").resumeGotoState()},stateIsCurrentSubstate:function(a){if(SC.typeOf(a)===SC.T_STRING){a=this.get("statechart").getState(a)}var b=this.get("currentSubstates");return !!b&&b.indexOf(a)>=0},stateIsEnteredSubstate:function(b){if(SC.typeOf(b)===SC.T_STRING){b=this.get("statechart").getState(b)}var a=this.get("enteredSubstates");return !!a&&a.indexOf(b)>=0},isRootState:function(){return this.getPath("statechart.rootState")===this}.property(),isCurrentState:function(){return this.stateIsCurrentSubstate(this)}.property("currentSubstates").cacheable(),isConcurrentState:function(){return this.getPath("parentState.substatesAreConcurrent")}.property(),isEnteredState:function(){return this.stateIsEnteredSubstate(this)}.property("enteredSubstates").cacheable(),hasSubstates:function(){return this.getPath("substates.length")>0}.property("substates"),hasCurrentSubstates:function(){var a=this.get("currentSubstates");return !!a&&a.get("length")>0}.property("currentSubstates").cacheable(),hasEnteredSubstates:function(){var a=this.get("enteredSubstates");return !!a&&a.get("length")>0}.property("enteredSubstates").cacheable(),findFirstRelativeCurrentState:function(b){if(this.get("isCurrentState")){return this}var a=this.get("currentSubstates")||[],d=a.get("length"),c=this.get("parentState");if(d===0){return c?c.findFirstRelativeCurrentState():null}if(d>1){b=this.getSubstate(b);if(b){return b.findFirstRelativeCurrentState()}}return a[0]},reenter:function(){if(this.get("isEnteredState")){this.gotoState(this)}else{SC.Logger.error("Can not re-enter state %@ since it is not an entered state in the statechart".fmt(this))}},tryToHandleEvent:function(a,e,d){var c=this.get("trace"),h=this.get("statechart"),g;if(this._registeredEventHandlers[a]){this.stateLogWarning("state %@ can not handle event '%@' since it is a registered event handler".fmt(this,a));return NO}if(this._registeredStateObserveHandlers[a]){this.stateLogWarning("state %@ can not handle event '%@' since it is a registered state observe handler".fmt(this,a));return NO}if(SC.typeOf(this[a])===SC.T_FUNCTION){if(c){this.stateLogTrace("will handle event '%@'".fmt(a))}h.stateWillTryToHandleEvent(this,a,a);g=(this[a](e,d)!==NO);h.stateDidTryToHandleEvent(this,a,a,g);return g}var j=this._registeredStringEventHandlers[a];if(j){if(c){this.stateLogTrace("%@ will handle event '%@'".fmt(j.name,a))}h.stateWillTryToHandleEvent(this,a,j.name);g=(j.handler.call(this,a,e,d)!==NO);h.stateDidTryToHandleEvent(this,a,j.name,g);return g}var f=this._registeredRegExpEventHandlers.length,b=0;for(;b<f;b+=1){j=this._registeredRegExpEventHandlers[b];if(a.match(j.regexp)){if(c){this.stateLogTrace("%@ will handle event '%@'".fmt(j.name,a))}h.stateWillTryToHandleEvent(this,a,j.name);g=(j.handler.call(this,a,e,d)!==NO);h.stateDidTryToHandleEvent(this,a,j.name,g);return g}}if(SC.typeOf(this["unknownEvent"])===SC.T_FUNCTION){if(c){this.stateLogTrace("unknownEvent will handle event '%@'".fmt(a))}h.stateWillTryToHandleEvent(this,a,"unknownEvent");g=(this.unknownEvent(a,e,d)!==NO);h.stateDidTryToHandleEvent(this,a,"unknownEvent",g);return g}return NO},enterState:function(a){},stateWillBecomeEntered:function(a){this._isEnteringState=YES},stateDidBecomeEntered:function(a){this._setupAllStateObserveHandlers();this._isEnteringState=NO},exitState:function(a){},stateWillBecomeExited:function(a){this._isExitingState=YES;this._teardownAllStateObserveHandlers()},stateDidBecomeExited:function(a){this._isExitingState=NO},_setupAllStateObserveHandlers:function(){this._configureAllStateObserveHandlers("addObserver")},_teardownAllStateObserveHandlers:function(){this._configureAllStateObserveHandlers("removeObserver")},_configureAllStateObserveHandlers:function(b){var g,h,f,a,j,d,c,e;for(g in this._registeredStateObserveHandlers){h=this._registeredStateObserveHandlers[g];for(c=0;c<h.length;c+=1){j=h[c];d=g;a=j.indexOf(".");if(a<0){this[b](j,this,d)}else{if(j.indexOf("*")===0){this[b](j.slice(1),this,d)}else{e=null;if(a===0){e=this;j=j.slice(1)}else{if(a===4&&j.slice(0,5)==="this."){e=this;j=j.slice(5)}else{if(a<0&&j.length===4&&j==="this"){e=this;j=""}}}SC.Observers[b](j,this,d,e)}}}}},performAsync:function(c,b,a){return SC.Async.perform(c,b,a)},respondsToEvent:function(d){if(this._registeredEventHandlers[d]){return false}if(SC.typeOf(this[d])===SC.T_FUNCTION){return true}if(this._registeredStringEventHandlers[d]){return true}if(this._registeredStateObserveHandlers[d]){return false}var a=this._registeredRegExpEventHandlers.length,b=0,c;for(;b<a;b+=1){c=this._registeredRegExpEventHandlers[b];if(d.match(c.regexp)){return true}}return SC.typeOf(this["unknownEvent"])===SC.T_FUNCTION},fullPath:function(){var a=this.getPath("statechart.rootState");if(!a){return this.get("name")}return this.pathRelativeTo(a)}.property("name","parentState").cacheable(),toString:function(){return this.get("fullPath")},_enteredSubstatesDidChange:function(){this.notifyPropertyChange("enteredSubstates")}.observes("*enteredSubstates.[]"),_currentSubstatesDidChange:function(){this.notifyPropertyChange("currentSubstates")}.observes("*currentSubstates.[]"),_statechartTraceDidChange:function(){this.notifyPropertyChange("trace")},_statechartOwnerDidChange:function(){this.notifyPropertyChange("owner")},stateLogTrace:function(b){var a=this.get("statechart");a.statechartLogTrace("%@: %@".fmt(this,b))},stateLogWarning:function(b){var a=this.get("statechart");a.statechartLogWarning(b)},stateLogError:function(b){var a=this.get("statechart");a.statechartLogError(b)}});SC.State.plugin=function(c){var a=SC.A(arguments);a.shift();var b=function(){var d=SC.objectForPropertyPath(c);if(!d){console.error("SC.State.plugin: Unable to determine path %@".fmt(c));return undefined}if(!d.isClass||!d.kindOf(SC.State)){console.error("SC.State.plugin: Unable to extend. %@ must be a class extending from SC.State".fmt(c));return undefined}return d.extend.apply(d,a)};b.statePlugin=YES;return b};SC.State.design=SC.State.extend;sc_require("system/state");SC.EMPTY_STATE_NAME="__EMPTY_STATE__";SC.EmptyState=SC.State.extend({name:SC.EMPTY_STATE_NAME,enterState:function(){var a="No initial substate was defined for state %@. Entering default empty state";this.stateLogWarning(a.fmt(this.get("parentState")))}});sc_require("system/state");SC.HistoryState=SC.Object.extend({isRecursive:NO,defaultState:null,statechart:null,parentState:null,state:function(){var b=this.get("defaultState"),a=this.getPath("parentState.historyState");return !!a?a:b}.property().cacheable(),parentHistoryStateDidChange:function(){this.notifyPropertyChange("state")}.observes("*parentState.historyState")});SC.StateRouteHandlerContext=SC.Object.extend({state:null,location:null,params:null,handler:null,retry:function(){var b=this.get("state"),c=this.get("params"),a=this.get("handler");if(SC.typeOf(a)===SC.T_STRING){a=b[a]}if(SC.typeOf(a)===SC.T_FUNCTION){a.apply(b,[c])}}});sc_require("system/state");sc_require("mixins/statechart_delegate");SC.StatechartManager={isResponderContext:YES,isStatechart:YES,statechartIsInitialized:NO,name:null,rootState:null,rootStateExample:SC.State,initialState:null,statesAreConcurrent:NO,monitorIsActive:NO,monitor:null,statechartTraceKey:"trace",trace:NO,statechartOwnerKey:"owner",owner:null,autoInitStatechart:YES,suppressStatechartWarnings:NO,delegate:null,statechartDelegate:function(){var a=this.get("delegate");return this.delegateFor("isStatechartDelegate",a)}.property("delegate"),initMixin:function(){if(this.get("autoInitStatechart")){this.initStatechart()}},destroyMixin:function(){var b=this.get("rootState"),a=this.get("statechartTraceKey");this.removeObserver(a,this,"_statechartTraceDidChange");b.destroy();this.set("rootState",null)},initStatechart:function(){if(this.get("statechartIsInitialized")){return}this._gotoStateLocked=NO;this._sendEventLocked=NO;this._pendingStateTransitions=[];this._pendingSentEvents=[];this.sendAction=this.sendEvent;if(this.get("monitorIsActive")){this.set("monitor",SC.StatechartMonitor.create({statechart:this}))}var a=this.get("statechartTraceKey");this.addObserver(a,this,"_statechartTraceDidChange");this._statechartTraceDidChange();var d=this.get("allowStatechartTracing"),c=this.get("rootState"),e;if(d){this.statechartLogTrace("BEGIN initialize statechart")}if(!c){c=this._constructRootStateClass()}else{if(SC.typeOf(c)===SC.T_FUNCTION&&c.statePlugin){c=c.apply(this)}}if(!(SC.kindOf(c,SC.State)&&c.isClass)){e="Unable to initialize statechart. Root state must be a state class";this.statechartLogError(e);throw e}c=this.createRootState(c,{statechart:this,name:SC.ROOT_STATE_NAME});this.set("rootState",c);c.initState();if(SC.kindOf(c.get("initialSubstate"),SC.EmptyState)){e="Unable to initialize statechart. Root state must have an initial substate explicilty defined";this.statechartLogError(e);throw e}if(!SC.empty(this.get("initialState"))){var b="initialState";this.set(b,c.get(this.get(b)))}this.set("statechartIsInitialized",YES);this.gotoState(c);if(d){this.statechartLogTrace("END initialize statechart")}},createRootState:function(b,a){if(!a){a={}}b=b.create(a);return b},currentStates:function(){return this.getPath("rootState.currentSubstates")}.property().cacheable(),firstCurrentState:function(){var a=this.get("currentStates");return a?a.objectAt(0):null}.property("currentStates").cacheable(),currentStateCount:function(){return this.getPath("currentStates.length")}.property("currentStates").cacheable(),stateIsCurrentState:function(a){return this.get("rootState").stateIsCurrentSubstate(a)},enteredStates:function(){return this.getPath("rootState.enteredSubstates")}.property().cacheable(),stateIsEntered:function(a){return this.get("rootState").stateIsEnteredSubstate(a)},doesContainState:function(a){return !SC.none(this.getState(a))},getState:function(b){var a=this.get("rootState");return a===b?a:a.getSubstate(b)},gotoState:function(b,k,l,c){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@. statechart has not yet been initialized".fmt(b));return}if(this.get("isDestroyed")){this.statechartLogError("can not go to state %@. statechart is destroyed".fmt(this));return}var i=this._processGotoStateArgs(arguments);b=i.state;k=i.fromCurrentState;l=i.useHistory;c=i.context;var n=null,j=[],m=[],f=this.get("allowStatechartTracing"),a=this.get("rootState"),h=b,e=k,d;b=this.getState(b);if(SC.none(b)){this.statechartLogError("Can not to goto state %@. Not a recognized state in statechart".fmt(h));return}if(this._gotoStateLocked){this._pendingStateTransitions.push({state:b,fromCurrentState:k,useHistory:l,context:c});return}this._gotoStateLocked=YES;if(k){k=this.getState(k);if(SC.none(k)||!k.get("isCurrentState")){d="Can not to goto state %@. %@ is not a recognized current state in statechart";this.statechartLogError(d.fmt(h,e));this._gotoStateLocked=NO;return}}else{k=b.findFirstRelativeCurrentState();if(!k){k=this.get("firstCurrentState")}}if(f){this.statechartLogTrace("BEGIN gotoState: %@".fmt(b));d="starting from current state: %@";d=d.fmt(k?k:"---");this.statechartLogTrace(d);d="current states before: %@";d=d.fmt(this.getPath("currentStates.length")>0?this.get("currentStates"):"---");this.statechartLogTrace(d)}if(!SC.none(k)){j=this._createStateChain(k)}m=this._createStateChain(b);n=this._findPivotState(j,m);if(n){if(f){this.statechartLogTrace("pivot state = %@".fmt(n))}if(n.get("substatesAreConcurrent")&&n!==b){this.statechartLogError("Can not go to state %@ from %@. Pivot state %@ has concurrent substates.".fmt(b,k,n));this._gotoStateLocked=NO;return}}var g=[];this._traverseStatesToExit(j.shift(),j,n,g);if(n!==b){this._traverseStatesToEnter(m.pop(),m,n,l,g)}else{this._traverseStatesToExit(n,[],null,g);this._traverseStatesToEnter(n,null,null,l,g)}this._gotoStateActions=g;this._executeGotoStateActions(b,g,null,c)},gotoStateActive:function(){return this._gotoStateLocked}.property(),gotoStateSuspended:function(){return this._gotoStateLocked&&!!this._gotoStateSuspendedPoint}.property(),resumeGotoState:function(){if(!this.get("gotoStateSuspended")){this.statechartLogError("Can not resume goto state since it has not been suspended");return}var a=this._gotoStateSuspendedPoint;this._executeGotoStateActions(a.gotoState,a.actions,a.marker,a.context)},_executeGotoStateActions:function(g,f,b,c){var e=null,a=f.length,d=null;b=SC.none(b)?0:b;for(;b<a;b+=1){this._currentGotoStateAction=e=f[b];switch(e.action){case SC.EXIT_STATE:d=this._exitState(e.state,c);break;case SC.ENTER_STATE:d=this._enterState(e.state,e.currentState,c);break}if(SC.kindOf(d,SC.Async)){this._gotoStateSuspendedPoint={gotoState:g,actions:f,marker:b+1,context:c};d.tryToPerform(e.state);return}}this.beginPropertyChanges();this.notifyPropertyChange("currentStates");this.notifyPropertyChange("enteredStates");this.endPropertyChanges();if(this.get("allowStatechartTracing")){this.statechartLogTrace("current states after: %@".fmt(this.get("currentStates")));this.statechartLogTrace("END gotoState: %@".fmt(g))}this._cleanupStateTransition()},_cleanupStateTransition:function(){this._currentGotoStateAction=null;this._gotoStateSuspendedPoint=null;this._gotoStateActions=null;this._gotoStateLocked=NO;this._flushPendingStateTransition()},_exitState:function(d,b){var c;if(d.get("currentSubstates").indexOf(d)>=0){c=d.get("parentState");while(c){c.get("currentSubstates").removeObject(d);c=c.get("parentState")}}c=d;while(c){c.get("enteredSubstates").removeObject(d);c=c.get("parentState")}if(this.get("allowStatechartTracing")){this.statechartLogTrace("<-- exiting state: %@".fmt(d))}d.set("currentSubstates",[]);d.stateWillBecomeExited(b);var a=this.exitState(d,b);d.stateDidBecomeExited(b);if(this.get("monitorIsActive")){this.get("monitor").pushExitedState(d)}d._traverseStatesToExit_skipState=NO;return a},exitState:function(b,a){return b.exitState(a)},_enterState:function(d,e,b){var c=d.get("parentState");if(c&&!d.get("isConcurrentState")){c.set("historyState",d)}if(e){c=d;while(c){c.get("currentSubstates").pushObject(d);c=c.get("parentState")}}c=d;while(c){c.get("enteredSubstates").pushObject(d);c=c.get("parentState")}if(this.get("allowStatechartTracing")){this.statechartLogTrace("--> entering state: %@".fmt(d))}d.stateWillBecomeEntered(b);var a=this.enterState(d,b);d.stateDidBecomeEntered(b);if(this.get("monitorIsActive")){this.get("monitor").pushEnteredState(d)}return a},enterState:function(b,a){if(b.enterStateByRoute&&SC.kindOf(a,SC.StateRouteHandlerContext)){return b.enterStateByRoute(a)}else{return b.enterState(a)}},gotoHistoryState:function(f,e,c,d){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@'s history state. Statechart has not yet been initialized".fmt(f));return}var b=this._processGotoStateArgs(arguments);f=b.state;e=b.fromCurrentState;c=b.useHistory;d=b.context;f=this.getState(f);if(!f){this.statechartLogError("Can not to goto state %@'s history state. Not a recognized state in statechart".fmt(f));return}var a=f.get("historyState");if(!c){if(a){this.gotoState(a,e,d)}else{this.gotoState(f,e,d)}}else{this.gotoState(f,e,YES,d)}},sendEvent:function(b,g,f){if(this.get("isDestroyed")){this.statechartLogError("can send event %@. statechart is destroyed".fmt(b));return}var c=NO,l=NO,h=this.get("currentStates").slice(),k={},j=0,e=0,a=null,d=this.get("allowStatechartTracing");if(this._sendEventLocked||this._goStateLocked){this._pendingSentEvents.push({event:b,arg1:g,arg2:f});return}this._sendEventLocked=YES;if(d){this.statechartLogTrace("BEGIN sendEvent: '%@'".fmt(b))}j=h.get("length");for(;e<j;e+=1){l=NO;a=h[e];if(!a.get("isCurrentState")){continue}while(!l&&a){if(!k[a.get("fullPath")]){l=a.tryToHandleEvent(b,g,f);k[a.get("fullPath")]=YES}if(!l){a=a.get("parentState")}else{c=YES}}}this._sendEventLocked=NO;if(d){if(!c){this.statechartLogTrace("No state was able handle event %@".fmt(b))}this.statechartLogTrace("END sendEvent: '%@'".fmt(b))}var m=this._flushPendingSentEvents();return c?this:(m?this:null)},stateWillTryToHandleEvent:function(c,b,a){this._stateHandleEventInfo={state:c,event:b,handler:a}},stateDidTryToHandleEvent:function(c,b,a,d){this._stateHandleEventInfo=null},_createStateChain:function(b){var a=[];while(b){a.push(b);b=b.get("parentState")}return a},_findPivotState:function(c,b){if(c.length===0||b.length===0){return null}var a=c.find(function(e,d){if(b.indexOf(e)>=0){return YES}});return a},_traverseStatesToExit:function(b,k,d,h){if(!b||b===d){return}var e=this.get("allowStatechartTracing");if(b.get("substatesAreConcurrent")){var f=0,g=b.get("currentSubstates"),j=g.length,c=null;for(;f<j;f+=1){c=g[f];if(c._traverseStatesToExit_skipState===YES){continue}var a=this._createStateChain(c);this._traverseStatesToExit(a.shift(),a,b,h)}}h.push({action:SC.EXIT_STATE,state:b});if(b.get("isCurrentState")){b._traverseStatesToExit_skipState=YES}this._traverseStatesToExit(k.shift(),k,d,h)},_traverseStatesToEnter:function(b,e,i,g,d){if(!b){return}var c=this.get("allowStatechartTracing");if(i){if(b!==i){this._traverseStatesToEnter(e.pop(),e,i,g,d)}else{this._traverseStatesToEnter(e.pop(),e,null,g,d)}}else{if(!e||e.length===0){var h={action:SC.ENTER_STATE,state:b,currentState:NO};d.push(h);var f=b.get("initialSubstate"),a=b.get("historyState");if(b.get("substatesAreConcurrent")){this._traverseConcurrentStatesToEnter(b.get("substates"),null,g,d)}else{if(b.get("hasSubstates")&&a&&g){this._traverseStatesToEnter(a,null,null,g,d)}else{if(f){if(SC.kindOf(f,SC.HistoryState)){if(!g){g=f.get("isRecursive")}f=f.get("state")}this._traverseStatesToEnter(f,null,null,g,d)}else{h.currentState=YES}}}}else{if(e.length>0){d.push({action:SC.ENTER_STATE,state:b});var j=e.pop();this._traverseStatesToEnter(j,e,null,g,d);if(b.get("substatesAreConcurrent")){this._traverseConcurrentStatesToEnter(b.get("substates"),j,g,d)}}}}},respondsTo:function(d){var b=this.get("currentStates"),a=b.get("length"),c=0,e=null;for(;c<a;c+=1){e=b.objectAt(c);while(e){if(e.respondsToEvent(d)){return true}e=e.get("parentState")}}return SC.typeOf(this[d])===SC.T_FUNCTION},tryToPerform:function(d,c,b){if(!this.respondsTo(d)){return NO}if(SC.typeOf(this[d])===SC.T_FUNCTION){var a=this[d](c,b);if(a!==NO){return YES}}return !!this.sendEvent(d,c,b)},invokeStateMethod:function(k,j,c){if(k==="unknownEvent"){this.statechartLogError("can not invoke method unkownEvent");return}j=SC.A(arguments);j.shift();var f=j.length,m=f>0?j[f-1]:null,l=SC.typeOf(m)===SC.T_FUNCTION?j.pop():null,e=this.get("currentStates"),d=0,b=null,h={},a,n=undefined,g=0;f=e.get("length");for(;d<f;d+=1){b=e.objectAt(d);while(b){if(h[b.get("fullPath")]){break}h[b.get("fullPath")]=YES;a=b[k];if(SC.typeOf(a)===SC.T_FUNCTION&&!a.isEventHandler){n=a.apply(b,j);if(l){l.call(this,b,n)}g+=1;break}b=b.get("parentState")}}return g===1?n:undefined},_traverseConcurrentStatesToEnter:function(d,c,f,b){var e=0,a=d.length,g=null;for(;e<a;e+=1){g=d[e];if(g!==c){this._traverseStatesToEnter(g,null,null,f,b)}}},_flushPendingStateTransition:function(){if(!this._pendingStateTransitions){this.statechartLogError("Unable to flush pending state transition. _pendingStateTransitions is invalid");return}var a=this._pendingStateTransitions.shift();if(!a){return}this.gotoState(a.state,a.fromCurrentState,a.useHistory,a.context)},_flushPendingSentEvents:function(){var a=this._pendingSentEvents.shift();if(!a){return null}return this.sendEvent(a.event,a.arg1,a.arg2)},_monitorIsActiveDidChange:function(){if(this.get("monitorIsActive")&&SC.none(this.get("monitor"))){this.set("monitor",SC.StatechartMonitor.create())}}.observes("monitorIsActive"),_processGotoStateArgs:function(b){var d={state:null,fromCurrentState:null,useHistory:false,context:null},a=null,c=null;b=SC.$A(b);b=b.filter(function(e){return !(e===undefined)});a=b.length;if(a<1){return d}d.state=b[0];if(a===2){c=b[1];switch(SC.typeOf(c)){case SC.T_BOOL:d.useHistory=c;break;case SC.T_HASH:case SC.T_OBJECT:if(!SC.kindOf(c,SC.State)){d.context=c}break;default:d.fromCurrentState=c}}else{if(a===3){c=b[1];if(SC.typeOf(c)===SC.T_BOOL){d.useHistory=c;d.context=b[2]}else{d.fromCurrentState=c;c=b[2];if(SC.typeOf(c)===SC.T_BOOL){d.useHistory=c}else{d.context=c}}}else{d.fromCurrentState=b[1];d.useHistory=b[2];d.context=b[3]}}return d},_constructRootStateClass:function(){var d="rootStateExample",e=this.get(d),b=this.get("initialState"),c=this.get("statesAreConcurrent"),a=0,i,g,f,h={};if(SC.typeOf(e)===SC.T_FUNCTION&&e.statePlugin){e=e.apply(this)}if(!(SC.kindOf(e,SC.State)&&e.isClass)){this._logStatechartCreationError("Invalid root state example");return null}if(c&&!SC.empty(b)){this._logStatechartCreationError("Can not assign an initial state when states are concurrent")}else{if(c){h.substatesAreConcurrent=YES}else{if(SC.typeOf(b)===SC.T_STRING){h.initialSubstate=b}else{this._logStatechartCreationError("Must either define initial state or assign states as concurrent");return null}}}for(i in this){if(i===d){continue}g=this[i];f=SC.typeOf(g)===SC.T_FUNCTION;if(f&&g.statePlugin){g=g.apply(this)}if(SC.kindOf(g,SC.State)&&g.isClass&&this[i]!==this.constructor){h[i]=g;a+=1}}if(a===0){this._logStatechartCreationError("Must define one or more states");return null}return e.extend(h)},_logStatechartCreationError:function(a){SC.Logger.error("Unable to create statechart for %@: %@.".fmt(this,a))},statechartLogTrace:function(a){SC.Logger.info("%@: %@".fmt(this.get("statechartLogPrefix"),a))},statechartLogError:function(a){SC.Logger.error("ERROR %@: %@".fmt(this.get("statechartLogPrefix"),a))},statechartLogWarning:function(a){if(this.get("suppressStatechartWarnings")){return}SC.Logger.warn("WARN %@: %@".fmt(this.get("statechartLogPrefix"),a))},statechartLogPrefix:function(){var b=SC._object_className(this.constructor),a=this.get("name"),c;if(SC.empty(a)){c="%@<%@>".fmt(b,SC.guidFor(this))}else{c="%@<%@, %@>".fmt(b,a,SC.guidFor(this))}return c}.property().cacheable(),allowStatechartTracing:function(){var a=this.get("statechartTraceKey");return this.get(a)}.property().cacheable(),_statechartTraceDidChange:function(){this.notifyPropertyChange("allowStatechartTracing")},details:function(){var b={initialized:this.get("statechartIsInitialized")};if(this.get("name")){b.name=this.get("name")}if(!this.get("statechartIsInitialized")){return b}b["current-states"]=[];this.get("currentStates").forEach(function(f){b["current-states"].push(f.get("fullPath"))});var a={active:this.get("gotoStateActive"),suspended:this.get("gotoStateSuspended")};if(this._gotoStateActions){a["transition-sequence"]=[];var e=this._gotoStateActions,c=function(g){var f=g.action===SC.ENTER_STATE?"enter":"exit";return"%@ %@".fmt(f,g.state.get("fullPath"))};e.forEach(function(f){a["transition-sequence"].push(c(f))});a["current-transition"]=c(this._currentGotoStateAction)}b["state-transition"]=a;if(this._stateHandleEventInfo){var d=this._stateHandleEventInfo;b["handling-event"]={state:d.state.get("fullPath"),event:d.event,handler:d.handler}}else{b["handling-event"]=false}return b}.property(),toStringWithDetails:function(){var b="",c=this.toString(),a=this.get("details");b+=c+"\n";b+=this._hashToString(a,2);return b},_hashToString:function(d,a){var e="";for(var b in d){var c=d[b];if(c instanceof Array){e+=this._arrayToString(b,c,a)+"\n"}else{if(c instanceof Object){e+="%@%@:\n".fmt(" ".mult(a),b);e+=this._hashToString(c,a+2)}else{e+="%@%@: %@\n".fmt(" ".mult(a),b,c)}}}return e},_arrayToString:function(b,d,a){if(d.length===0){return"%@%@: []".fmt(" ".mult(a),b)}var c="%@%@: [\n".fmt(" ".mult(a),b);d.forEach(function(f,e){c+="%@%@\n".fmt(" ".mult(a+2),f)},this);c+=" ".mult(a)+"]";return c}};SC.mixin(SC.StatechartManager,SC.StatechartDelegate,SC.DelegateSupport);SC.ROOT_STATE_NAME="__ROOT_STATE__";SC.EXIT_STATE=0;SC.ENTER_STATE=1;SC.Statechart=SC.Object.extend(SC.StatechartManager,{autoInitStatechart:NO});SC.Statechart.design=SC.Statechart.extend;var Handlebars={};Handlebars.VERSION="1.0.beta.2";Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(b,c,a){if(a){c.not=a}this.helpers[b]=c};Handlebars.registerPartial=function(a,b){this.partials[a]=b};Handlebars.registerHelper("helperMissing",function(a){if(arguments.length===2){return undefined}else{throw new Error("Could not find property '"+a+"'")}});Handlebars.registerHelper("blockHelperMissing",function(f,d){var a=d.inverse||function(){},h=d.fn;var c="";var g=Object.prototype.toString.call(f);if(g==="[object Function]"){f=f()}if(f===true){return h(this)}else{if(f===false||f==null){return a(this)}else{if(g==="[object Array]"){if(f.length>0){for(var e=0,b=f.length;e<b;e++){c=c+h(f[e])}}else{c=a(this)}return c}else{return h(f)}}}});Handlebars.registerHelper("each",function(f,d){var g=d.fn,a=d.inverse;var c="";if(f&&f.length>0){for(var e=0,b=f.length;e<b;e++){c=c+g(f[e])}}else{c=a(this)}return c});Handlebars.registerHelper("if",function(b,a){if(!b||Handlebars.Utils.isEmpty(b)){return a.inverse(this)}else{return a.fn(this)}});Handlebars.registerHelper("unless",function(c,b){var d=b.fn,a=b.inverse;b.fn=a;b.inverse=d;return Handlebars.helpers["if"].call(this,c,b)});Handlebars.registerHelper("with",function(b,a){return a.fn(b)});Handlebars.registerHelper("log",function(a){Handlebars.log(a)});var handlebars=(function(){var f={trace:function c(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function b(g,j,k,n,m,i,l){var h=i.length-1;switch(m){case 1:return i[h-1];break;case 2:this.$=new n.ProgramNode(i[h-2],i[h]);break;case 3:this.$=new n.ProgramNode(i[h]);break;case 4:this.$=new n.ProgramNode([]);break;case 5:this.$=[i[h]];break;case 6:i[h-1].push(i[h]);this.$=i[h-1];break;case 7:this.$=new n.InverseNode(i[h-2],i[h-1],i[h]);break;case 8:this.$=new n.BlockNode(i[h-2],i[h-1],i[h]);break;case 9:this.$=i[h];break;case 10:this.$=i[h];break;case 11:this.$=new n.ContentNode(i[h]);break;case 12:this.$=new n.CommentNode(i[h]);break;case 13:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1]);break;case 14:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1]);break;case 15:this.$=i[h-1];break;case 16:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1]);break;case 17:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1],true);break;case 18:this.$=new n.PartialNode(i[h-1]);break;case 19:this.$=new n.PartialNode(i[h-2],i[h-1]);break;case 20:break;case 21:this.$=[[i[h-2]].concat(i[h-1]),i[h]];break;case 22:this.$=[[i[h-1]].concat(i[h]),null];break;case 23:this.$=[[i[h-1]],i[h]];break;case 24:this.$=[[i[h]],null];break;case 25:i[h-1].push(i[h]);this.$=i[h-1];break;case 26:this.$=[i[h]];break;case 27:this.$=i[h];break;case 28:this.$=new n.StringNode(i[h]);break;case 29:this.$=new n.IntegerNode(i[h]);break;case 30:this.$=new n.BooleanNode(i[h]);break;case 31:this.$=new n.HashNode(i[h]);break;case 32:i[h-1].push(i[h]);this.$=i[h-1];break;case 33:this.$=[i[h]];break;case 34:this.$=[i[h-2],i[h]];break;case 35:this.$=[i[h-2],new n.StringNode(i[h])];break;case 36:this.$=[i[h-2],new n.IntegerNode(i[h])];break;case 37:this.$=[i[h-2],new n.BooleanNode(i[h])];break;case 38:this.$=new n.IdNode(i[h]);break;case 39:i[h-2].push(i[h]);this.$=i[h-2];break;case 40:this.$=[i[h]];break}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function d(h,g){throw new Error(h)},parse:function e(o){var x=this,l=[0],G=[null],s=[],H=this.table,h="",q=0,E=0,j=0,n=2,u=1;this.lexer.setInput(o);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined"){this.lexer.yylloc={}}var i=this.lexer.yylloc;s.push(i);if(typeof this.yy.parseError==="function"){this.parseError=this.yy.parseError}function w(p){l.length=l.length-2*p;G.length=G.length-p;s.length=s.length-p}function v(){var p;p=x.lexer.lex()||1;if(typeof p!=="number"){p=x.symbols_[p]||p}return p}var D,z,k,C,I,t,B={},y,F,g,m;while(true){k=l[l.length-1];if(this.defaultActions[k]){C=this.defaultActions[k]}else{if(D==null){D=v()}C=H[k]&&H[k][D]}if(typeof C==="undefined"||!C.length||!C[0]){if(!j){m=[];for(y in H[k]){if(this.terminals_[y]&&y>2){m.push("'"+this.terminals_[y]+"'")}}var A="";if(this.lexer.showPosition){A="Parse error on line "+(q+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+m.join(", ")}else{A="Parse error on line "+(q+1)+": Unexpected "+(D==1?"end of input":("'"+(this.terminals_[D]||D)+"'"))}this.parseError(A,{text:this.lexer.match,token:this.terminals_[D]||D,line:this.lexer.yylineno,loc:i,expected:m})}if(j==3){if(D==u){throw new Error(A||"Parsing halted.")}E=this.lexer.yyleng;h=this.lexer.yytext;q=this.lexer.yylineno;i=this.lexer.yylloc;D=v()}while(1){if((n.toString()) in H[k]){break}if(k==0){throw new Error(A||"Parsing halted.")}w(1);k=l[l.length-1]}z=D;D=n;k=l[l.length-1];C=H[k]&&H[k][n];j=3}if(C[0] instanceof Array&&C.length>1){throw new Error("Parse Error: multiple actions possible at state: "+k+", token: "+D)}switch(C[0]){case 1:l.push(D);G.push(this.lexer.yytext);s.push(this.lexer.yylloc);l.push(C[1]);D=null;if(!z){E=this.lexer.yyleng;h=this.lexer.yytext;q=this.lexer.yylineno;i=this.lexer.yylloc;if(j>0){j--}}else{D=z;z=null}break;case 2:F=this.productions_[C[1]][1];B.$=G[G.length-F];B._$={first_line:s[s.length-(F||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(F||1)].first_column,last_column:s[s.length-1].last_column};t=this.performAction.call(B,h,E,q,this.yy,C[1],G,s);if(typeof t!=="undefined"){return t}if(F){l=l.slice(0,-1*F*2);G=G.slice(0,-1*F);s=s.slice(0,-1*F)}l.push(this.productions_[C[1]][0]);G.push(B.$);s.push(B._$);g=H[l[l.length-2]][l[l.length-1]];l.push(g);break;case 3:return true}}return true}};var a=(function(){var j=({EOF:1,parseError:function l(o,n){if(this.yy.parseError){this.yy.parseError(o,n)}else{throw new Error(o)}},setInput:function(n){this._input=n;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var o=this._input[0];this.yytext+=o;this.yyleng++;this.match+=o;this.matched+=o;var n=o.match(/\n/);if(n){this.yylineno++}this._input=this._input.slice(1);return o},unput:function(n){this._input=n+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var n=this.matched.substr(0,this.matched.length-this.match.length);return(n.length>20?"...":"")+n.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var n=this.match;if(n.length<20){n+=this._input.substr(0,20-n.length)}return(n.substr(0,20)+(n.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var n=this.pastInput();var o=new Array(n.length+1).join("-");return n+this.upcomingInput()+"\n"+o+"^"},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var r,p,o,n;if(!this._more){this.yytext="";this.match=""}var s=this._currentRules();for(var q=0;q<s.length;q++){p=this._input.match(this.rules[s[q]]);if(p){n=p[0].match(/\n.*/g);if(n){this.yylineno+=n.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-1:this.yylloc.last_column+p[0].length};this.yytext+=p[0];this.match+=p[0];this.matches=p;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(p[0].length);this.matched+=p[0];r=this.performAction.call(this,this.yy,this,s[q],this.conditionStack[this.conditionStack.length-1]);if(r){return r}else{return}}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function g(){var n=this.next();if(typeof n!=="undefined"){return n}else{return this.lex()}},begin:function h(n){this.conditionStack.push(n)},popState:function m(){return this.conditionStack.pop()},_currentRules:function k(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}});j.performAction=function i(r,o,q,n){var p=n;switch(q){case 0:this.begin("mu");if(o.yytext){return 14}break;case 1:return 14;break;case 2:return 24;break;case 3:return 16;break;case 4:return 20;break;case 5:return 19;break;case 6:return 19;break;case 7:return 23;break;case 8:return 23;break;case 9:o.yytext=o.yytext.substr(3,o.yyleng-5);this.begin("INITIAL");return 15;break;case 10:return 22;break;case 11:return 34;break;case 12:return 33;break;case 13:return 33;break;case 14:return 36;break;case 15:break;case 16:this.begin("INITIAL");return 18;break;case 17:this.begin("INITIAL");return 18;break;case 18:o.yytext=o.yytext.substr(1,o.yyleng-2).replace(/\\"/g,'"');return 28;break;case 19:return 30;break;case 20:return 30;break;case 21:return 29;break;case 22:return 33;break;case 23:o.yytext=o.yytext.substr(1,o.yyleng-2);return 33;break;case 24:return"INVALID";break;case 25:return 5;break}};j.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s/.])/,/^\[.*\]/,/^./,/^$/];j.conditions={mu:{rules:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:false},INITIAL:{rules:[0,1,25],inclusive:true}};return j})();f.lexer=a;return f})();Handlebars.Parser=handlebars;Handlebars.parse=function(a){Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(a)};Handlebars.print=function(a){return new Handlebars.PrintVisitor().accept(a)};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(b,a){}};Handlebars.log=function(b,a){Handlebars.logger.log(b,a)};(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(c,b){this.type="program";this.statements=c;if(b){this.inverse=new Handlebars.AST.ProgramNode(b)}};Handlebars.AST.MustacheNode=function(d,c,b){this.type="mustache";this.id=d[0];this.params=d.slice(1);this.hash=c;this.escaped=!b};Handlebars.AST.PartialNode=function(c,b){this.type="partial";this.id=c;this.context=b};var a=function(b,c){if(b.original!==c.original){throw new Handlebars.Exception(b.original+" doesn't match "+c.original)}};Handlebars.AST.BlockNode=function(c,b,d){a(c.id,d);this.type="block";this.mustache=c;this.program=b};Handlebars.AST.InverseNode=function(c,b,d){a(c.id,d);this.type="inverse";this.mustache=c;this.program=b};Handlebars.AST.ContentNode=function(b){this.type="content";this.string=b};Handlebars.AST.HashNode=function(b){this.type="hash";this.pairs=b};Handlebars.AST.IdNode=function(f){this.type="ID";this.original=f.join(".");var d=[],g=0;for(var e=0,b=f.length;e<b;e++){var c=f[e];if(c===".."){g++}else{if(c==="."||c==="this"){this.isScoped=true}else{d.push(c)}}}this.parts=d;this.string=d.join(".");this.depth=g;this.isSimple=(d.length===1)&&(g===0)};Handlebars.AST.StringNode=function(b){this.type="STRING";this.string=b};Handlebars.AST.IntegerNode=function(b){this.type="INTEGER";this.integer=b};Handlebars.AST.BooleanNode=function(b){this.type="BOOLEAN";this.bool=b};Handlebars.AST.CommentNode=function(b){this.type="comment";this.comment=b}})();Handlebars.Exception=function(b){var a=Error.prototype.constructor.apply(this,arguments);for(var c in a){if(a.hasOwnProperty(c)){this[c]=a[c]}}};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(a){this.string=a};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};(function(){var c={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var d=/&(?!\w+;)|[<>"'`]/g;var b=/[&<>"'`]/;var a=function(e){return c[e]||"&amp;"};Handlebars.Utils={escapeExpression:function(e){if(e instanceof Handlebars.SafeString){return e.toString()}else{if(e==null||e===false){return""}}if(!b.test(e)){return e}return e.replace(d,a)},isEmpty:function(e){if(typeof e==="undefined"){return true}else{if(e===null){return true}else{if(e===false){return true}else{if(Object.prototype.toString.call(e)==="[object Array]"&&e.length===0){return true}else{return false}}}}}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};(function(f,e){f.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16};f.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1};f.DISASSEMBLE_MAP={};for(var h in f.OPCODE_MAP){var g=f.OPCODE_MAP[h];f.DISASSEMBLE_MAP[g]=h}f.multiParamSize=function(i){return f.MULTI_PARAM_OPCODES[f.DISASSEMBLE_MAP[i]]};f.prototype={compiler:f,disassemble:function(){var t=this.opcodes,r,n;var q=[],v,m,w;for(var s=0,o=t.length;s<o;s++){r=t[s];if(r==="DECLARE"){m=t[++s];w=t[++s];q.push("DECLARE "+m+" = "+w)}else{v=f.DISASSEMBLE_MAP[r];var u=f.multiParamSize(r);var k=[];for(var p=0;p<u;p++){n=t[++s];if(typeof n==="string"){n='"'+n.replace("\n","\\n")+'"'}k.push(n)}v=v+" "+k.join(" ");q.push(v)}}return q.join("\n")},guid:0,compile:function(i,k){this.children=[];this.depths={list:[]};this.options=k;var l=this.options.knownHelpers;this.options.knownHelpers={helperMissing:true,blockHelperMissing:true,each:true,"if":true,unless:true,"with":true,log:true};if(l){for(var j in l){this.options.knownHelpers[j]=l[j]}}return this.program(i)},accept:function(i){return this[i.type](i)},program:function(m){var k=m.statements,o;this.opcodes=[];for(var n=0,j=k.length;n<j;n++){o=k[n];this[o.type](o)}this.isSimple=j===1;this.depths.list=this.depths.list.sort(function(l,i){return l-i});return this},compileProgram:function(m){var j=new this.compiler().compile(m,this.options);var n=this.guid++;this.usePartial=this.usePartial||j.usePartial;this.children[n]=j;for(var o=0,k=j.depths.list.length;o<k;o++){depth=j.depths.list[o];if(depth<2){continue}else{this.addDepth(depth-1)}}return n},block:function(o){var l=o.mustache;var n,p,j,k;var m=this.setupStackForMustache(l);var i=this.compileProgram(o.program);if(o.program.inverse){k=this.compileProgram(o.program.inverse);this.declare("inverse",k)}this.opcode("invokeProgram",i,m.length,!!l.hash);this.declare("inverse",null);this.opcode("append")},inverse:function(k){var j=this.setupStackForMustache(k.mustache);var i=this.compileProgram(k.program);this.declare("inverse",i);this.opcode("invokeProgram",null,j.length,!!k.mustache.hash);this.opcode("append")},hash:function(n){var m=n.pairs,p,o;this.opcode("push","{}");for(var k=0,j=m.length;k<j;k++){p=m[k];o=p[1];this.accept(o);this.opcode("assignToHash",p[0])}},partial:function(i){var j=i.id;this.usePartial=true;if(i.context){this.ID(i.context)}else{this.opcode("push","depth0")}this.opcode("invokePartial",j.original);this.opcode("append")},content:function(i){this.opcode("appendContent",i.string)},mustache:function(i){var j=this.setupStackForMustache(i);this.opcode("invokeMustache",j.length,i.id.original,!!i.hash);if(i.escaped){this.opcode("appendEscaped")}else{this.opcode("append")}},ID:function(m){this.addDepth(m.depth);this.opcode("getContext",m.depth);this.opcode("lookupWithHelpers",m.parts[0]||null,m.isScoped||false);for(var k=1,j=m.parts.length;k<j;k++){this.opcode("lookup",m.parts[k])}},STRING:function(i){this.opcode("pushString",i.string)},INTEGER:function(i){this.opcode("push",i.integer)},BOOLEAN:function(i){this.opcode("push",i.bool)},comment:function(){},pushParams:function(l){var j=l.length,k;while(j--){k=l[j];if(this.options.stringParams){if(k.depth){this.addDepth(k.depth)}this.opcode("getContext",k.depth||0);this.opcode("pushStringParam",k.string)}else{this[k.type](k)}}},opcode:function(i,l,k,j){this.opcodes.push(f.OPCODE_MAP[i]);if(l!==undefined){this.opcodes.push(l)}if(k!==undefined){this.opcodes.push(k)}if(j!==undefined){this.opcodes.push(j)}},declare:function(i,j){this.opcodes.push("DECLARE");this.opcodes.push(i);this.opcodes.push(j)},addDepth:function(i){if(i===0){return}if(!this.depths[i]){this.depths[i]=true;this.depths.list.push(i)}},setupStackForMustache:function(i){var j=i.params;this.pushParams(j);if(i.hash){this.hash(i.hash)}this.ID(i.id);return j}};e.prototype={nameLookup:function(k,i,j){if(/^[0-9]+$/.test(i)){return k+"["+i+"]"}else{if(e.isValidJavaScriptVariableName(i)){return k+"."+i}else{return k+"['"+i+"']"}}},appendToBuffer:function(i){if(this.environment.isSimple){return"return "+i+";"}else{return"buffer += "+i+";"}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(i,j,l,k){this.environment=i;this.options=j||{};this.name=this.environment.name;this.isChild=!!l;this.context=l||{programs:[],aliases:{self:"this"},registers:{list:[]}};this.preamble();this.stackSlot=0;this.stackVars=[];this.compileChildren(i,j);var n=i.opcodes,m;this.i=0;for(b=n.length;this.i<b;this.i++){m=this.nextOpcode(0);if(m[0]==="DECLARE"){this.i=this.i+2;this[m[1]]=m[2]}else{this.i=this.i+m[1].length;this[m[0]].apply(this,m[1])}}return this.createFunctionContext(k)},nextOpcode:function(r){var o=this.environment.opcodes,m=o[this.i+r],l,p;var q,i;if(m==="DECLARE"){l=o[this.i+1];p=o[this.i+2];return["DECLARE",l,p]}else{l=f.DISASSEMBLE_MAP[m];q=f.multiParamSize(m);i=[];for(var k=0;k<q;k++){i.push(o[this.i+k+1+r])}return[l,i]}},eat:function(i){this.i=this.i+i.length},preamble:function(){var i=[];if(!this.isChild){var j=this.namespace;var k="helpers = helpers || "+j+".helpers;";if(this.environment.usePartial){k=k+" partials = partials || "+j+".partials;"}i.push(k)}else{i.push("")}if(!this.environment.isSimple){i.push(", buffer = "+this.initializeBuffer())}else{i.push("")}this.lastContext=0;this.source=i},createFunctionContext:function(p){var q=this.stackVars;if(!this.isChild){q=q.concat(this.context.registers.list)}if(q.length>0){this.source[1]=this.source[1]+", "+q.join(", ")}if(!this.isChild){var k=[];for(var o in this.context.aliases){this.source[1]=this.source[1]+", "+o+"="+this.context.aliases[o]}}if(this.source[1]){this.source[1]="var "+this.source[1].substring(2)+";"}if(!this.isChild){this.source[1]+="\n"+this.context.programs.join("\n")+"\n"}if(!this.environment.isSimple){this.source.push("return buffer;")}var r=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var n=0,j=this.environment.depths.list.length;n<j;n++){r.push("depth"+this.environment.depths.list[n])}if(p){r.push(this.source.join("\n  "));return Function.apply(this,r)}else{var m="function "+(this.name||"")+"("+r.join(",")+") {\n  "+this.source.join("\n  ")+"}";Handlebars.log(Handlebars.logger.DEBUG,m+"\n\n");return m}},appendContent:function(i){this.source.push(this.appendToBuffer(this.quotedString(i)))},append:function(){var i=this.popStack();this.source.push("if("+i+" || "+i+" === 0) { "+this.appendToBuffer(i)+" }");if(this.environment.isSimple){this.source.push("else { "+this.appendToBuffer("''")+" }")}},appendEscaped:function(){var j=this.nextOpcode(1),i="";this.context.aliases.escapeExpression="this.escapeExpression";if(j[0]==="appendContent"){i=" + "+this.quotedString(j[1][0]);this.eat(j)}this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+i))},getContext:function(i){if(this.lastContext!==i){this.lastContext=i}},lookupWithHelpers:function(k,l){if(k){var i=this.nextStack();this.usingKnownHelper=false;var j;if(!l&&this.options.knownHelpers[k]){j=i+" = "+this.nameLookup("helpers",k,"helper");this.usingKnownHelper=true}else{if(l||this.options.knownHelpersOnly){j=i+" = "+this.nameLookup("depth"+this.lastContext,k,"context")}else{j=i+" = "+this.nameLookup("helpers",k,"helper")+" || "+this.nameLookup("depth"+this.lastContext,k,"context")}}j+=";";this.source.push(j)}else{this.pushStack("depth"+this.lastContext)}},lookup:function(j){var i=this.topStack();this.source.push(i+" = ("+i+" === null || "+i+" === undefined || "+i+" === false ? "+i+" : "+this.nameLookup(i,j,"context")+");")},pushStringParam:function(i){this.pushStack("depth"+this.lastContext);this.pushString(i)},pushString:function(i){this.pushStack(this.quotedString(i))},push:function(i){this.pushStack(i)},invokeMustache:function(k,j,i){this.populateParams(k,this.quotedString(j),"{}",null,i,function(l,n,m){if(!this.usingKnownHelper){this.context.aliases.helperMissing="helpers.helperMissing";this.context.aliases.undef="void 0";this.source.push("else if("+m+"=== undef) { "+l+" = helperMissing.call("+n+"); }");if(l!==m){this.source.push("else { "+l+" = "+m+"; }")}}})},invokeProgram:function(k,l,j){var i=this.programExpression(this.inverse);var m=this.programExpression(k);this.populateParams(l,null,m,i,j,function(n,p,o){if(!this.usingKnownHelper){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";this.source.push("else { "+n+" = blockHelperMissing.call("+p+"); }")}})},populateParams:function(p,k,t,q,x,w){var l=x||this.options.stringParams||q||this.options.data;var j=this.popStack(),v;var n=[],m,o,u;if(l){this.register("tmp1",t);u="tmp1"}else{u="{ hash: {} }"}if(l){var s=(x?this.popStack():"{}");this.source.push("tmp1.hash = "+s+";")}if(this.options.stringParams){this.source.push("tmp1.contexts = [];")}for(var r=0;r<p;r++){m=this.popStack();n.push(m);if(this.options.stringParams){this.source.push("tmp1.contexts.push("+this.popStack()+");")}}if(q){this.source.push("tmp1.fn = tmp1;");this.source.push("tmp1.inverse = "+q+";")}if(this.options.data){this.source.push("tmp1.data = data;")}n.push(u);this.populateCall(n,j,k||j,w)},populateCall:function(l,o,n,i){var k=["depth0"].concat(l).join(", ");var m=["depth0"].concat(n).concat(l).join(", ");var j=this.nextStack();if(this.usingKnownHelper){this.source.push(j+" = "+o+".call("+k+");")}else{this.context.aliases.functionType='"function"';this.source.push("if(typeof "+o+" === functionType) { "+j+" = "+o+".call("+k+"); }")}i.call(this,j,m,o);this.usingKnownHelper=false},invokePartial:function(i){this.pushStack("self.invokePartial("+this.nameLookup("partials",i,"partial")+", '"+i+"', "+this.popStack()+", helpers, partials);")},assignToHash:function(i){var j=this.popStack();var k=this.topStack();this.source.push(k+"['"+i+"'] = "+j+";")},compiler:e,compileChildren:function(j,n){var p=j.children,r,q;for(var o=0,k=p.length;o<k;o++){r=p[o];q=new this.compiler();this.context.programs.push("");var m=this.context.programs.length;r.index=m;r.name="program"+m;this.context.programs[m]=q.compile(r,n,this.context)}},programExpression:function(k){if(k==null){return"self.noop"}var p=this.environment.children[k],o=p.depths.list;var n=[p.index,p.name,"data"];for(var m=0,j=o.length;m<j;m++){depth=o[m];if(depth===1){n.push("depth0")}else{n.push("depth"+(depth-1))}}if(o.length===0){return"self.program("+n.join(", ")+")"}else{n.shift();return"self.programWithDepth("+n.join(", ")+")"}},register:function(i,j){this.useRegister(i);this.source.push(i+" = "+j+";")},useRegister:function(i){if(!this.context.registers[i]){this.context.registers[i]=true;this.context.registers.list.push(i)}},pushStack:function(i){this.source.push(this.nextStack()+" = "+i+";");return"stack"+this.stackSlot},nextStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot)}return"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(i){return'"'+i.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var a=("break case catch continue default delete do else finally for function if in instanceof new return switch this throw try typeof var void while with null true false").split(" ");var d=e.RESERVED_WORDS={};for(var c=0,b=a.length;c<b;c++){d[a[c]]=true}e.isValidJavaScriptVariableName=function(i){if(!e.RESERVED_WORDS[i]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(i)){return true}return false}})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);Handlebars.precompile=function(d,c){c=c||{};var b=Handlebars.parse(d);var a=new Handlebars.Compiler().compile(b,c);return new Handlebars.JavaScriptCompiler().compile(a,c)};Handlebars.compile=function(b,a){a=a||{};var d;function c(){var g=Handlebars.parse(b);var f=new Handlebars.Compiler().compile(g,a);var e=new Handlebars.JavaScriptCompiler().compile(f,a,undefined,true);return Handlebars.template(e)}return function(f,e){if(!d){d=c()}return d.call(this,f,e)}};Handlebars.VM={template:function(a){var b={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(d,e,f){var c=this.programs[d];if(f){return Handlebars.VM.program(e,f)}else{if(c){return c}else{c=this.programs[d]=Handlebars.VM.program(e);return c}}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(d,c){c=c||{};return a.call(b,Handlebars,d,c.helpers,c.partials,c.data)}},programWithDepth:function(b,d,c){var a=Array.prototype.slice.call(arguments,2);return function(f,e){e=e||{};return b.apply(this,[f,e.data||d].concat(a))}},program:function(a,b){return function(d,c){c=c||{};return a(d,c.data||b)}},noop:function(){return""},invokePartial:function(a,b,d,e,c){if(a===undefined){throw new Handlebars.Exception("The partial "+b+" could not be found")}else{if(a instanceof Function){return a(d,{helpers:e,partials:c})}else{if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+b+" could not be compiled when running in vm mode")}else{c[b]=Handlebars.compile(a);return c[b](d,{helpers:e,partials:c})}}}}};Handlebars.template=Handlebars.VM.template;sc_require("handlebars");SC.Handlebars={};SC.Handlebars.Compiler=function(){};SC.Handlebars.Compiler.prototype=SC.beget(Handlebars.Compiler.prototype);SC.Handlebars.Compiler.prototype.compiler=SC.Handlebars.Compiler;SC.Handlebars.JavaScriptCompiler=function(){};SC.Handlebars.JavaScriptCompiler.prototype=SC.beget(Handlebars.JavaScriptCompiler.prototype);SC.Handlebars.JavaScriptCompiler.prototype.compiler=SC.Handlebars.JavaScriptCompiler;SC.Handlebars.JavaScriptCompiler.prototype.nameLookup=function(c,a,b){if(b==="context"){return"SC.get("+c+", "+this.quotedString(a)+")"}else{return Handlebars.JavaScriptCompiler.prototype.nameLookup.call(this,c,a,b)}};SC.Handlebars.Compiler.prototype.mustache=function(a){if(a.params.length||a.hash){return Handlebars.Compiler.prototype.mustache.call(this,a)}else{var b=new Handlebars.AST.IdNode(["bind"]);if(a.escaped){a.hash=a.hash||new Handlebars.AST.HashNode([]);a.hash.pairs.push(["escaped",new Handlebars.AST.StringNode("true")])}a=new Handlebars.AST.MustacheNode([b].concat([a.id]),a.hash,!a.escaped);return Handlebars.Compiler.prototype.mustache.call(this,a)}};SC.Handlebars.compile=function(e){var c=Handlebars.parse(e);var d={data:true,stringParams:true};var b=new SC.Handlebars.Compiler().compile(c,d);var a=new SC.Handlebars.JavaScriptCompiler().compile(b,d,undefined,true);return Handlebars.template(a)};Handlebars.registerHelper("helperMissing",function(c,b){var a;a="%@ Handlebars error: Could not find property '%@' on object %@.";throw a.fmt(b.data.view,c,this)});sc_require("ext/handlebars");(function(){var a=function(l,m,i,b){var e=m.data,j=m.fn,d=m.inverse,k=e.view;if(this.isObservable){var f=k.createChildView(SC._BindableSpan,{preserveContext:i,shouldDisplayFunc:b,displayTemplate:j,inverseTemplate:d,property:l,previousContext:this,tagName:(m.hash.tagName||"span"),isEscaped:m.hash.escaped});var h,g;k.get("childViews").push(f);h=function(){if(f.get("layer")){f.rerender()}else{this.removeObserver(l,g)}};g=function(){this.invokeOnce(h)};this.addObserver(l,g);var c=f.renderContext(f.get("tagName"));f.renderToContext(c);return new Handlebars.SafeString(c.join())}else{return SC.getPath(this,l)}};Handlebars.registerHelper("bind",function(c,b){return a.call(this,c,b,false,function(d){return !SC.none(d)})});Handlebars.registerHelper("boundIf",function(c,b){if(b){return a.call(this,c,b,true,function(d){if(SC.typeOf(d)===SC.T_ARRAY){if(d.length!==0){return true}return false}else{return !!d}})}else{throw"Cannot use boundIf helper without a block."}})})();Handlebars.registerHelper("with",function(b,a){return Handlebars.helpers.bind.call(a.contexts[0],b,a)});Handlebars.registerHelper("if",function(b,a){return Handlebars.helpers.boundIf.call(a.contexts[0],b,a)});Handlebars.registerHelper("unless",function(c,b){var d=b.fn,a=b.inverse;b.fn=a;b.inverse=d;return Handlebars.helpers.boundIf.call(b.contexts[0],c,b)});Handlebars.registerHelper("bindAttr",function(f){var e=f.hash;var b=f.data.view;var d=[];var c=jQuery.uuid++;var h=e["class"];if(h!=null){var a=SC.Handlebars.bindClasses(this,h,b,c);d.push('class="'+a.join(" ")+'"');delete e["class"]}var g=SC.keys(e);g.forEach(function(i){var m=e[i];var l=this.getPath(m);var k,j;k=function k(){var n=this.getPath(m);var p=b.$("[data-handlebars-id='"+c+"']");if(p.length===0){this.removeObserver(m,j);return}var o=p.attr(i);if(n===NO&&o){p.removeAttr(i)}else{if(n===YES&&o!==i){p.attr(i,i)}else{if(o!==n){p.attr(i,n)}}}};j=function(){this.invokeOnce(k)};this.addObserver(m,j);if(l===YES){l=i}if(l!==NO){if(SC.typeOf(l)===SC.T_STRING){l=l.replace(/"/g,"&quot;")}d.push(i+'="'+l+'"')}},this);d.push('data-handlebars-id="'+c+'"');return new Handlebars.SafeString(d.join(" "))});SC.Handlebars.bindClasses=function(b,h,g,a){var f=[],e,i,c;var d=function(j){var k=b.getPath(j);if(k===YES){return SC.String.dasherize(j.split(".").get("lastObject"))}else{if(k!==NO&&k!==undefined&&k!==null){return k}else{return null}}};h.split(" ").forEach(function(m){var l;var k,j;k=function(){e=d(m);c=a?g.$("[data-handlebars-id='"+a+"']"):g.$();if(c.length===0){b.removeObserver(m,j)}else{if(l){c.removeClass(l)}if(e){c.addClass(e);l=e}else{l=null}}};j=function(){this.invokeOnce(k)};b.addObserver(m,j);i=d(m);if(i){f.push(i);l=i}});return f};sc_require("ext/handlebars");Handlebars.registerHelper("collection",function(k,l){var j=l.fn;var f=l.data;var d=l.inverse;var e=l.hash;var g,a;g=k?SC.getPath(this,k)||SC.getPath(k):SC.TemplateCollectionView;var i={};if(e){var c={},h;for(var b in e){if(e.hasOwnProperty(b)){h=b.match(/^item(.)(.*)$/);if(h){c[h[1].toLowerCase()+h[2]]=e[b];delete e[b]}}}i=SC.clone(e);i.itemViewOptions=c}if(j){i.itemViewTemplate=j}if(d){i.inverseTemplate=d}if(g.isClass){a=g.extend(i)}else{a=SC.mixin(g,i)}l.fn=function(){return""};return Handlebars.helpers.view.call(this,a,l)});Handlebars.registerHelper("each",function(b,a){a.hash.contentBinding=SC.Binding.from("*"+b,this).oneWay();a.hash.itemContextProperty="content";return Handlebars.helpers.collection.call(this,null,a)});sc_require("ext/handlebars");Handlebars.registerHelper("loc",function(a){return SC.String.loc(a)});sc_require("ext/handlebars");SC.Handlebars.ViewHelper=SC.Object.create({helper:function(l,m,n){var c=n.inverse;var e=n.data;var j=e.view;var i=n.fn;var d=n.hash;var b;if(m.isClass||m.isObject){b=m;if(!b){throw"Null or undefined object was passed to the #view helper. Did you mean to pass a property path string?"}}else{if(m.charAt(0)==="."){b=SC.objectForPropertyPath(m.slice(1),j)}else{b=SC.getPath(l,m);if(!b){b=SC.getPath(m)}}if(!b){throw"Unable to find view at path '"+m+"'"}}if(d.id){d.layerId=d.id}var k={id:d.id,"class":d["class"],classBinding:d.classBinding};delete d.id;delete d["class"];delete d.classBinding;if(b.isClass){b=b.extend(d)}else{SC.mixin(b,d)}var g=e.view;var h=g.get("childViews");var f=g.createChildView(b);if(i){f.template=i}h.pushObject(f);var a=SC.RenderContext(f.get("tagName"));this.applyAttributes(k,f,a);f.applyAttributesToContext(a);f.render(a,YES);return new Handlebars.SafeString(a.join())},applyAttributes:function(a,f,b){var e=a.id;var d=a["class"];if(d){b.addClass(d.split(" "))}if(e){f.set("layerId",e);b.id(e)}var c=a.classBinding;if(c){SC.Handlebars.bindClasses(f,c,f).forEach(function(g){b.setClass(g,YES)})}}});Handlebars.registerHelper("view",function(b,a){return SC.Handlebars.ViewHelper.helper(this,b,a)});sc_require("handlebars");sc_require("ext/handlebars");sc_require("ext/handlebars/bind");sc_require("ext/handlebars/collection");sc_require("ext/handlebars/localization");sc_require("ext/handlebars/view");SC.TEMPLATES=SC.Object.create();SC.TemplateView=SC.CoreView.extend({acceptsFirstResponder:YES,templateName:null,templates:SC.TEMPLATES,template:function(b,d){if(d!==undefined){return d}var a=this.get("templateName"),c=this.get("templates").get(a);if(!c){return function(){return""}}return c}.property("templateName").cacheable(),context:function(a,b){if(b!==undefined){return b}return this}.property().cacheable(),render:function(b){var e,a,c=this.get("template"),d=this.get("context");this._didRenderChildViews=YES;e={view:this,isRenderData:true};a=c(d,{data:e});b.push(a)},update:function(){},mouseDown:function(){if(this.mouseUp){return YES}return NO}});sc_require("views/template");SC.Button=SC.TemplateView.extend(SC.ActionSupport,{classNames:["sc-button"],mouseDown:function(){this.set("isActive",true);this._isMouseDown=YES},mouseExited:function(){this.set("isActive",false)},mouseEntered:function(){if(this._isMouseDown){this.set("isActive",true)}},rootResponder:function(){var a=this.get("pane");return a.get("rootResponder")}.property("pane").cacheable(),mouseUp:function(a){if(this.get("isActive")){this.fireAction();this.set("isActive",false)}this._isMouseDown=NO},touchStart:function(a){this.mouseDown(a)},touchEnd:function(a){this.mouseUp(a)}});sc_require("views/template");SC.Checkbox=SC.TemplateView.extend({title:null,value:null,displayTitle:function(){var a=this.get("title");return a?SC.String.loc(a):null}.property("title").cacheable(),classNames:["sc-checkbox"],template:SC.Handlebars.compile('<label><input type="checkbox">{{displayTitle}}</label>'),didCreateLayer:function(){var a=this;this.$("input").bind("change",function(){a.domValueDidChange(this)})},domValueDidChange:function(a){this.set("value",$(a).prop("checked"))},value:function(a,b){if(b!==undefined){this.$("input").prop("checked",b)}else{b=this.$("input").prop("checked")}return b}.property()});SC.CheckboxSupport={didCreateLayer:function(){this.$("input").change(jQuery.proxy(function(){SC.RunLoop.begin();this.notifyPropertyChange("value");SC.RunLoop.end()},this))},value:function(a,b){if(b!==undefined){this.$("input").prop("checked",b)}else{b=this.$("input").prop("checked")}return b}.property().idempotent()};sc_require("views/template");SC.TextFieldSupport={$input:function(){return this.$("input")},_value:null,value:function(b,c){var a=this.$input();if(c!==undefined){if(this._value!==c){this._value=c}if(a.val()!==c){a.val(c)}}else{if(a.length>0){c=this._value=a.val()}else{c=this._value}}return c}.property().idempotent(),didCreateLayer:function(){var b=this.$input(),a=this;b.val(this._value);if(SC.browser.isIE){SC.Event.add(b,"focusin",this,this.focusIn);SC.Event.add(b,"focusout",this,this.focusOut)}else{SC.Event.add(b,"focus",this,this.focusIn);SC.Event.add(b,"blur",this,this.focusOut)}},willDestroyLayerMixin:function(){var a=this.$input();if(SC.browser.isIE){SC.Event.remove(a,"focusin",this,this.focusIn);SC.Event.remove(a,"focusout",this,this.focusOut)}else{SC.Event.remove(a,"focus",this,this.focusIn);SC.Event.remove(a,"blur",this,this.focusOut)}},focusIn:function(a){this.becomeFirstResponder();this.tryToPerform("focus",a)},focusOut:function(a){this.resignFirstResponder();this.tryToPerform("blur",a)},touchStart:function(a){a.allowDefault();return YES},touchEnd:function(a){a.allowDefault();return YES},willLoseFirstResponder:function(){this.notifyPropertyChange("value")},domValueDidChange:function(a){this.set("value",a.val())},keyUp:function(a){this.domValueDidChange(this.$input());if(a.keyCode===SC.Event.KEY_RETURN){return this.tryToPerform("insertNewline",a)}else{if(a.keyCode===SC.Event.KEY_ESC){return this.tryToPerform("cancel",a)}}},selectStart:function(){return true}};SC.TextField=SC.TemplateView.extend(SC.TextFieldSupport,{classNames:["sc-text-field"],isMultiline:NO,template:function(){return SC.Handlebars.compile(this.get("isMultiline")?"<textarea></textarea>":'<input type="text">')}.property("isMultiline").cacheable(),$input:function(){var a=this.get("isMultiline")?"textarea":"input";return this.$(a)}});SC.TemplatePane=SC.Object.extend({});SC.TemplatePane.mixin({append:function(a){var b=SC.MainPane.extend({childViews:["contentView"],contentView:SC.TemplateView.design(a),touchStart:function(c){c.allowDefault()},touchesDragged:function(c,d){c.allowDefault()},touchEnd:function(c){c.allowDefault()}});b=b.create().append();b.awake();return b}});sc_require("views/template");SC._BindableSpan=SC.TemplateView.extend({tagName:"span",shouldDisplayFunc:null,preserveContext:NO,displayTemplate:null,inverseTemplate:null,property:null,render:function(d){var h=this.get("isEscaped");var a=this.get("shouldDisplayFunc"),f=this.get("property"),e=this.get("preserveContext"),b=this.get("previousContext");var c=this.get("inverseTemplate"),g=this.get("displayTemplate");var i;if(f===""){i=b}else{i=b.getPath(f)}if(a(i)){this.set("template",g);if(e){this.set("context",b)}else{if(g){this.set("context",i)}else{if(i==null){i=""}else{i=String(i)}if(h){i=Handlebars.Utils.escapeExpression(i)}d.push(i);return}}}else{if(c){this.set("template",c);if(e){this.set("context",b)}else{this.set("context",i)}}else{this.set("template",function(){return""})}}return arguments.callee.base.apply(this,arguments)},rerender:function(){var b,a,e,f;e=this.get("childViews");a=e.get("length");for(b=a-1;b>=0;b--){f=e[b];f.$().remove();f.removeFromParent();f.destroy()}var c=this.renderContext(this.get("tagName"));var d;this.renderToContext(c);d=c.element();this.$().replaceWith(d);this.set("layer",d);this._notifyDidCreateLayer()}});sc_require("views/template");SC.TemplateCollectionView=SC.TemplateView.extend({tagName:"ul",content:null,template:SC.Handlebars.compile(""),emptyView:null,init:function(){var a=arguments.callee.base.apply(this,arguments);this._sctcv_contentDidChange();return a},didCreateLayer:function(){if(this._sctcv_layerCreated){return}this._sctcv_layerCreated=true;var a=this.get("content");if(a){this.arrayContentDidChange(0,0,a.get("length"))}},itemView:"SC.TemplateView",itemViewTemplate:null,itemViewTemplateName:null,inverseTemplate:function(b,d){if(d!==undefined){return d}var a=this.get("inverseTemplateName"),c=this.get("templates").get(a);if(!c){return function(){return""}}return c}.property("inverseTemplateName").cacheable(),inverseTemplateName:null,itemContext:null,itemViewClass:function(){var c=this.get("itemView");var a=this.get("itemViewTemplate");var d=this.get("itemViewTemplateName");var b={};if(SC.typeOf(c)===SC.T_STRING){c=SC.objectForPropertyPath(c)}if(!a&&d){a=this.get("templates").get(d)}if(a){b.template=a}if(c.prototype.tagName===SC.TemplateView.prototype.tagName){b.tagName=this.get("itemTagName")}return c.extend(b)}.property("itemView").cacheable(),_sctcv_contentDidChange:function(){this.$().empty();var c=this._content,a=0;var d=this.get("content"),b=0;if(c){c.removeArrayObservers({target:this,willChange:"arrayContentWillChange",didChange:"arrayContentDidChange"});a=c.get("length")}if(d){d.addArrayObservers({target:this,willChange:"arrayContentWillChange",didChange:"arrayContentDidChange"});b=d.get("length")}this.arrayContentWillChange(0,a,b);this._content=this.get("content");this.arrayContentDidChange(0,a,b)}.observes("content"),arrayContentWillChange:function(h,d,f){var c=this.get("emptyView");if(c){c.$().remove();c.removeFromParent()}var e=this.get("childViews"),g,b,a;a=e.get("length");for(b=h+d-1;b>=h;b--){g=e[b];if(g){g.$().remove();g.removeFromParent();g.destroy()}}},arrayContentDidChange:function(e,l,t){if(!this.get("layer")){return}var m=this.get("content"),f=this.get("itemViewClass"),o=this.get("childViews"),a=[],r,s,h,p,g,q,k,j,n;if(m){var i=m.slice(e,e+t);h=this.get("itemViewOptions")||{};p=this.$();g=p.find("li")[e-1]||null;n=i.get("length");var d={id:h.id,"class":h["class"],classBinding:h.classBinding};r=function(u){arguments.callee.base.apply(this,arguments);SC.Handlebars.ViewHelper.applyAttributes(d,this,u)};h=SC.clone(h);delete h.id;delete h["class"];delete h.classBinding;for(j=0;j<n;j++){q=i.objectAt(j);s=this.createChildView(f.extend(h,{content:q,render:r,tagName:h.tagName||f.prototype.tagName}));var c=s.get("contextProperty");if(c){s.set("context",s.get(c))}k=s.createLayer().$();if(!g){p.append(k)}else{k.insertAfter(g)}g=k;a.push(s)}o.replace(e,0,a)}var b=this.get("inverseTemplate");if(o.get("length")===0&&b){s=this.createChildView(SC.TemplateView.extend({template:b,content:this}));this.set("emptyView",s);s.createLayer().$().appendTo(p);this.childViews=[s]}this.invokeLast("invalidateFrame")},itemTagName:function(){switch(this.get("tagName")){case"dl":return"dt";case"ul":case"ol":return"li";case"table":case"thead":case"tbody":case"tfoot":return"tr";case"select":return"option";default:return SC.TemplateView.prototype.tagName}}.property("tagName"),invalidateFrame:function(){this.notifyPropertyChange("frame")}});
/*!
 * ==========================================================================
 * SproutCore -- JavaScript Application Framework
 * Copyright ©2008-2011 Apple Inc. All rights reserved.
 * Copyright 2006-2011, Strobe Inc. and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a 
 * copy of this software and associated documentation files (the "Software"), 
 * to deal in the Software without restriction, including without limitation 
 * the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 * and/or sell copies of the Software, and to permit persons to whom the 
 * Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in 
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
 * DEALINGS IN THE SOFTWARE.
 * 
 * SproutCore and the SproutCore logo are trademarks of Strobe Inc.
 * 
 * For more information about SproutCore, visit http://www.sproutcore.com
 * 
 * ==========================================================================
 */
SC.EmptyTheme=SC.BaseTheme.create({name:"sc-empty"});SC.Theme.addTheme(SC.EmptyTheme);SC.AceTheme=SC.BaseTheme.create({name:"ace",description:"A SproutCore built-in theme by Alex Iskander and contributors. Only supports browsers that implement CSS3."});SC.Theme.addTheme(SC.AceTheme);SC.AceTheme.PointLeft=SC.AceTheme.subtheme("point-left","point-left");SC.AceTheme.PointRight=SC.AceTheme.subtheme("point-right","point-right");SC.AceTheme.Capsule=SC.AceTheme.subtheme("capsule","capsule");SC.AceTheme.Dark=SC.AceTheme.subtheme("dark");SC.defaultTheme="ace";sc_require("theme");SC.AceTheme.Dark.PointLeft=SC.AceTheme.Dark.subtheme("point-left","point-left");SC.AceTheme.Dark.PointRight=SC.AceTheme.Dark.subtheme("point-right","point-right");SC.AceTheme.Dark.PointRight=SC.AceTheme.Dark.subtheme("capsule","capsule");SC.AceTheme.SourceList=SC.AceTheme.subtheme("source-list");sc_require("theme");SC.AceTheme.Popover=SC.AceTheme.Dark.subtheme("popover");SC.AceTheme.addTheme(SC.AceTheme.Popover);SC.AceTheme.SolidPopover=SC.AceTheme.Popover.subtheme("solid");SC.AceTheme.addTheme(SC.AceTheme.SolidPopover.create({name:"solid-popover"}));sc_require("resources/picker/popover/popover");SC.AceTheme.Popover.pickerRenderDelegate=SC.RenderDelegate.create({className:"picker",render:function(e,b){var a=e.get("preferType");var d=e.get("pointerPos");var c=e.get("pointerPosY");if(a==SC.PICKER_POINTER||a==SC.PICKER_MENU_POINTER){b.addClass(d)}},update:function(e,d){var a=e.get("preferType");var c=e.get("pointerPos");var b=e.get("pointerPosY");if(a==SC.PICKER_POINTER||a==SC.PICKER_MENU_POINTER){d.addClass(c)}}});SC.AceTheme.Popover.workspaceRenderDelegate=SC.RenderDelegate.create({className:"workspace",render:function(b,a){a.setClass({"top-toolbar":b.get("hasTopToolbar"),"bottom-toolbar":b.get("hasBottomToolbar")});a=a.begin("div").addClass("popover-background");this.includeSlices(b,a,SC.NINE_SLICE);a.push("<div class = 'sc-pointer'></div>");a=a.end()},update:function(b,a){a.setClass({"top-toolbar":b.get("hasTopToolbar"),"bottom-toolbar":b.get("hasBottomToolbar")})}});SC.SplitChild={isSplitDivider:NO,minimumSize:100,maximumSize:undefined,size:undefined,position:0,positionOffset:SC.propertyFromRenderDelegate("splitPositionOffset",0),sizeOffset:SC.propertyFromRenderDelegate("splitSizeOffset",0),canCollapse:NO,collapseAtSize:undefined,autoResizeStyle:undefined,compensatesForMovement:YES,allowsIndirectAdjustments:YES,_scsvc_positionOrSizeDidChange:function(){this.invokeOnce("splitChildLayoutDidChange")}.observes("position","size"),splitChildLayoutDidChange:function(){var c=this.get("splitView");if(!c){return}var a=this.get("position")+this.get("positionOffset"),b=this.get("size")+this.get("sizeOffset");if(c.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){this.set("layout",{left:a,width:b,top:0,bottom:0})}else{this.set("layout",{top:a,height:b,right:0,left:0})}},splitView:function(){var a=this.get("parentView");while(a&&!a.isSplitView){a=a.get("parentView")}return a}.property("parentView").cacheable(),splitViewLayoutDirection:null,splitViewLayoutDirectionBinding:SC.Binding.oneWay("*splitView.layoutDirection"),splitViewLayoutDirectionDidChange:function(){this.invokeOnce("splitChildLayoutDidChange")}.observes("splitViewLayoutDirection")};SC.MOVES_AUTOMATIC_CHILD="moves-automatic-child";SC.MOVES_CHILD="moves-child";SC.MOVES_PREVIOUS_CHILD="moves-previous-child";SC.MOVES_NEXT_CHILD="moves-next-child";SC.SplitThumb={movesChild:function(){var a=this,d,c=this.get("splitView"),b=this.get("movesSibling");while(a&&a!==c){d=a;a=a.get("parentView")}if(b===SC.MOVES_NEXT_CHILD){return d.nextView}if(b===SC.MOVES_PREVIOUS_CHILD){return d.previousView}if(b===SC.MOVES_AUTOMATIC_CHILD){if(!d.nextView){return d.previousView}if(!d.previousView){return d.nextView}}return d}.property("splitView","movesSibling").cacheable(),movesSibling:SC.MOVES_AUTOMATIC_CHILD,splitView:function(){var a=this;while(a&&!a.isSplitView){a=a.get("parentView")}return a}.property("parentView").cacheable(),splitViewLayoutDirection:null,splitViewLayoutDirectionBinding:SC.Binding.oneWay("*splitView.layoutDirection"),splitCursorStyle:function(){if(this.get("splitViewLayoutDirection")===SC.LAYOUT_HORIZONTAL){return"ew-resize"}else{return"ns-resize"}}.property("splitViewLayoutDirection").cacheable(),splitCursorStyleDidChange:function(){if(this._isDragging){this.get("splitView").set("splitChildCursorStyle",this.get("splitCursorStyle"))}this.$().css("cursor",this.get("splitCursorStyle"))}.observes("splitCursorStyle"),renderMixin:function(a){a.css("cursor",this.get("splitCursorStyle"))},touchStart:function(b){this._isDragging=YES;var a=this.get("splitView");a.beginLiveResize();this._scst_mouseStartPosition=a.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?b.pageX:b.pageY;this._scst_childStartPosition=a.getPositionForChild(this.get("movesChild"));return YES},touchesDragged:function(a){var b=this.get("splitView");var e=b.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?a.pageX:a.pageY;var c=e-this._scst_mouseStartPosition,d=this._scst_childStartPosition;b.adjustPositionForChild(this.get("movesChild"),d+c);return YES},touchEnd:function(e){this._isDragging=NO;var a=this.get("splitView");var d=a.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?e.pageX:e.pageY;var b=d-this._scst_mouseStartPosition,c=this._scst_childStartPosition;a.adjustPositionForChild(this.get("movesChild"),c+b);a.set("splitChildCursorStyle",null);a.endLiveResize();return YES},mouseDown:function(a){var b=this.get("splitView");b.set("splitChildCursorStyle",this.get("splitCursorStyle"));return this.touchStart(a)},mouseDragged:function(a){return this.touchesDragged(a)},mouseUp:function(a){this.get("splitView").set("splitChildCursorStyle",null);return this.touchEnd(a)}};SC.BaseTheme.splitRenderDelegate=SC.RenderDelegate.create({className:"split",render:function(b,a){a.addClass(b.get("layoutDirection"))},update:function(b,a){a.addClass(b.get("layoutDirection"))}});SC.BaseTheme.splitDividerRenderDelegate=SC.RenderDelegate.create({className:"split-divider",dividerSize:1,splitPositionOffset:-5,splitSizeOffset:10,render:function(b,a){this.addSizeClassName(b,a);a.push("<div class='line'></div>")},update:function(b,a){this.updateSizeClassName(b,a)}});sc_require("mixins/split_child");sc_require("mixins/split_thumb");SC.SplitDividerView=SC.View.extend(SC.SplitChild,SC.SplitThumb,{classNames:["sc-split-divider-view"],isSplitDivider:YES,autoResizeStyle:"sc-fixed-size",movesSibling:SC.MOVES_CHILD,size:SC.propertyFromRenderDelegate("dividerSize",10),renderDelegateName:"splitDividerRenderDelegate"});sc_require("views/split_divider");SC.FIXED_SIZE="sc-fixed-size";SC.RESIZE_MANUAL="sc-manual-size";SC.RESIZE_AUTOMATIC="sc-automatic-resize";SC.SplitView=SC.View.extend({classNames:["sc-split-view"],childViews:["topLeftView","bottomRightView"],isSplitView:YES,splitDividerView:SC.SplitDividerView,layoutDirection:SC.LAYOUT_HORIZONTAL,shouldResizeChildrenToFit:YES,splitChildCursorStyle:null,_scsv_splitChildCursorDidChange:function(){this.get("cursor").set("cursorStyle",this.get("splitChildCursorStyle"))}.observes("splitChildCursorStyle"),init:function(){this.cursor=SC.Cursor.create();arguments.callee.base.apply(this,arguments)},displayProperties:["layoutDirection"],renderDelegateName:"splitRenderDelegate",_frameSize:function(){if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){return this.get("frame").width}else{return this.get("frame").height}}.property("frame","layoutDirection").cacheable(),viewDidResize:function(a){this.scheduleTiling();a()}.enhance(),layoutDirectionDidChange:function(){this.scheduleTiling()}.observes("layoutDirection"),adjustPositionForChild:function(b,a){return this.invokeDelegateMethod(this.get("delegate"),"splitViewAdjustPositionForChild",this,b,a)},getPositionForChild:function(a){return this.invokeDelegateMethod(this.get("delegate"),"splitViewGetPositionForChild",this,a)},didAddChild:function(){if(this._scsv_settingUpChildViews){return}this._scsv_settingUpChildViews=YES;this.invokeOnce("_scsv_setupChildViews");this._scsv_settingUpChildViews=NO},didRemoveChild:function(){if(this._scsv_settingUpChildViews){return}this._scsv_settingUpChildViews=YES;this.invokeOnce("_scsv_setupChildViews");this._scsv_settingUpChildViews=NO},createChildViews:function(){arguments.callee.base.apply(this,arguments);if(this._scsv_settingUpChildViews){return}this._scsv_settingUpChildViews=YES;this.invokeOnce("_scsv_setupChildViews");this._scsv_settingUpChildViews=NO},_scsv_setupChildViews:function(){var k=this.get("delegate"),d=this.get("childViews").copy(),g=d.length,j,c,a,e,i=this._scsv_dividers||{},b={},f,h;for(j=0;j<g;j++){c=d[j];if(!c.get("autoResizeStyle")){if(c.get("size")!==undefined){c.set("autoResizeStyle",SC.RESIZE_MANUAL)}else{c.set("autoResizeStyle",SC.RESIZE_AUTOMATIC)}}var l=this.invokeDelegateMethod(k,"splitViewGetSizeForChild",this,c);l=this.invokeDelegateMethod(k,"splitViewConstrainSizeForChild",this,c,l);this.invokeDelegateMethod(k,"splitViewSetSizeForChild",this,c,l);c.previousView=a;c.nextView=undefined;c.viewIndex=j;if(a){a.nextView=c}if(e&&!c.isSplitDivider){h=SC.guidFor(e)+"-"+SC.guidFor(c);f=i[h];if(!f&&!a.isSplitDivider){f=this.invokeDelegateMethod(k,"splitViewDividerBetween",this,e,c)}if(f){f.isSplitDivider=YES;b[h]=f;if(i[h]){delete i[h]}else{this.insertBefore(f,c)}}}a=c;if(!c.isSplitDivider){e=c}}for(h in i){i[h].destroy()}this._scsv_dividers=b;this._scsv_tile()},needsTiling:YES,scheduleTiling:function(){this.set("needsTiling",YES);this.invokeOnce("_scsv_tile")},tileIfNeeded:function(){if(!this.get("needsTiling")){return}this._scsv_tile()},_scsv_tile:function(){var a=this.get("delegate");var c,b=this.get("_frameSize");c=this.invokeDelegateMethod(a,"splitViewLayoutChildren",this);if(this.get("shouldResizeChildrenToFit")&&c!==b){this.invokeDelegateMethod(a,"splitViewResizeChildrenToFit",this,c);c=this.invokeDelegateMethod(a,"splitViewLayoutChildren",this)}if(!this.get("shouldResizeChildrenToFit")){if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){this.adjust("width",c)}else{this.adjust("height",c)}}this.set("needsTiling",NO)},splitViewLayoutChildren:function(e){var c=this.get("delegate");var d=this.get("childViews"),b=d.length,a,g,f=0;for(a=0;a<b;a++){g=d[a];this.invokeDelegateMethod(c,"splitViewSetPositionForChild",this,d[a],f);f+=this.invokeDelegateMethod(c,"splitViewGetSizeForChild",this,d[a])}return f},splitViewResizeChildrenToFit:function(h,d){var l=this.get("delegate");var g=this.get("_frameSize");var e=this.get("childViews"),i=e.length,k,c,a=0,f=0,j;for(k=0;k<i;k++){c=e[k];j=this.invokeDelegateMethod(l,"splitViewGetSizeForChild",this,c);if(this.invokeDelegateMethod(l,"splitViewShouldResizeChildToFit",this,c)){a+=j}else{f+=j}}var b=d;b=this._resizeChildrenForSize(b,g,YES,a);b=this._resizeChildrenForSize(b,g,YES,-1);b=this._resizeChildrenForSize(b,g,NO,f);b=this._resizeChildrenForSize(b,g,NO,-1)},_resizeChildrenForSize:function(d,e,f,h){var l=this.get("delegate");var c=this.get("childViews"),j,g=c.length,b;var i=e-d;for(j=0;j<g;j++){b=c[j];var k=this.invokeDelegateMethod(l,"splitViewGetSizeForChild",this,b),m=k;var a=this.invokeDelegateMethod(l,"splitViewShouldResizeChildToFit",this,b);if(a===f){if(h===-1){m+=i}else{m+=(m/h)*i}m=Math.round(m);m=this.invokeDelegateMethod(l,"splitViewConstrainSizeForChild",this,b,m);this.invokeDelegateMethod(l,"splitViewSetSizeForChild",this,b,m);if(h!==-1){h-=k}}d-=k;d+=m;i=e-d}return d},splitViewShouldResizeChildToFit:function(a,b){return(this.get("shouldResizeChildrenToFit")&&b.get("autoResizeStyle")===SC.RESIZE_AUTOMATIC)},splitViewAdjustPositionForChild:function(d,f,a){var b=this.get("delegate");var e=this._scsv_createPlan();var c=this._scsv_adjustPositionForChildInPlan(e,f,a,f);this._scsv_commitPlan(e);return c},_scsv_createPlan:function(){var c=this.get("delegate"),g=[],f=this.get("childViews"),b,a=f.length,h,e,d;for(b=0;b<a;b++){h=f[b];e=this.invokeDelegateMethod(c,"splitViewGetPositionForChild",this,h);d=this.invokeDelegateMethod(c,"splitViewGetSizeForChild",this,h);g[b]={child:h,originalPosition:e,position:e,originalSize:d,size:d}}return g},_scsv_resetPlanRange:function(c,d,b){for(var a=d;a<=b;a++){c[a].position=c[a].originalPosition;c[a].size=c[a].originalSize}},_scsv_commitPlan:function(f){var d=this.get("delegate"),b=f.length,a,e,c=0;for(a=0;a<b;a++){e=f[a];if(e.size!==e.originalSize){this.invokeDelegateMethod(d,"splitViewSetSizeForChild",this,e.child,e.size)}if(e.position!==e.originalPosition){this.invokeDelegateMethod(d,"splitViewSetPositionForChild",this,e.child,e.position)}c=e.position+e.size}if(!this.get("shouldResizeChildrenToFit")){if(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL){this.adjust("width",c)}else{this.adjust("height",c)}}},_scsv_adjustPositionForChildInPlan:function(i,d,f,a){var j=this.get("delegate");if(!d.get("allowsIndirectAdjustments")&&a!==d&&a!==d.previousView){return i[d.viewIndex].position}if(d._splitViewIsAdjusting){return i[d.viewIndex].position}d._splitViewIsAdjusting=YES;var g=d.previousView,b=d.nextView,c,k,h,e,l=i[d.viewIndex].size;if(g&&!g._splitViewIsAdjusting){c=i[g.viewIndex].position;k=f-c;k=this._scsv_adjustSizeForChildInPlan(i,g,k,a);f=c+k}else{if(!g){f=0}}if(b&&b._splitViewIsAdjusting){d._splitViewIsAdjusting=NO;i[d.viewIndex].position=f;return f}if(d.get("compensatesForMovement")&&b){h=i[b.viewIndex].position;l=this._scsv_adjustSizeForChildInPlan(i,d,h-f)}else{if(!b&&this.get("shouldResizeChildrenToFit")){h=this.get("_frameSize");l=this._scsv_adjustSizeForChildInPlan(i,d,h-f);f=h-l}}if(b){h=f+l;h=this._scsv_adjustPositionForChildInPlan(i,b,h,a)}if(h&&f!==h-l){f=h-l;if(g&&!g._splitViewIsAdjusting){this._scsv_resetPlanRange(i,0,g.viewIndex);k=f-i[g.viewIndex].position;this._scsv_adjustSizeForChildInPlan(i,g,k,d)}}i[d.viewIndex].position=f;d._splitViewIsAdjusting=NO;return f},_scsv_adjustSizeForChildInPlan:function(f,b,i,a){var g=this.get("delegate");if(a&&!b.get("allowsIndirectAdjustments")&&a!==b&&a!==b.nextView&&a!==b.previousView){return f[b.viewIndex].size}var h=this.invokeDelegateMethod(g,"splitViewConstrainSizeForChild",this,b,i);f[b.viewIndex].size=h;if(i===h){return i}var c=f[b.viewIndex].position,d=c+i-h;var e=this._scsv_adjustPositionForChildInPlan(f,b,d,a);return e+h-c},splitViewDividerBetween:function(c,b,a){if(!this.get("splitDividerView")){return null}return this.get("splitDividerView").create()},splitViewGetPositionForChild:function(a,b){return b.get("position")},splitViewSetPositionForChild:function(b,c,a){c.set("position",a)},splitViewGetSizeForChild:function(b,c){var a=c.get("size");if(SC.none(a)){return 100}return a},splitViewSetSizeForChild:function(b,c,a){c.set("size",a)},splitViewConstrainSizeForChild:function(c,f,a){if(f.get("autoResizeStyle")===SC.FIXED_SIZE){return this.invokeDelegateMethod(this.get("delegate"),"splitViewGetSizeForChild",this,f)}if(f.get("canCollapse")){var b=f.get("collapseAtSize");if(b&&a<b){return 0}}var d=f.get("minimumSize")||0;if(d!==undefined&&d!==null){a=Math.max(d,a)}var e=f.get("maximumSize");if(e!==undefined&&e!==null){a=Math.min(e,a)}return a}});SC.ThumbView=SC.View.extend(SC.SplitThumb,{classNames:["sc-thumb-view"],init:function(){arguments.callee.base.apply(this,arguments);console.warn("SC.ThumbView is deprecated. Please use a normal view and mix in SC.SplitThumb instead.")}});if(!Object.keys){Object.keys=function(c){var a=[],b;for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){a.push(b)}}return a}}if(!Function.prototype.bind){Function.prototype.bind=function(b){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var a=Array.prototype.slice,f=a.call(arguments,1),e=this,c=function(){},d=function(){return e.apply(this instanceof c?this:b||window,f.concat(a.call(arguments)))};c.prototype=this.prototype;d.prototype=new c();return d}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}SC.Record.ignoreUnknownProperties=true;SC.RecordArray.QUERY_MATCHING_THRESHOLD=10000;DG=SC.Application.create((function(){var a=null;var e=false;var c="DG.MemoryDataSource",f=c;var j=function(k,n){k=k.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");n=n||"";var l="[\\?&]"+k+"=([^&]*)";var o=new RegExp(l);var m=o.exec(window.location.href);if(SC.none(m)){return n}else{return decodeURIComponent(m[1])}};var b=function(){var k=j("app");return !SC.empty(k)?k==="dg":window.location.href.indexOf("/dg")>=0};var h=function(){var k=j("app");return !SC.empty(k)?k==="is":window.location.href.indexOf("/is")>=0};var i=function(){var k=j("app");return !SC.empty(k)?k==="srri":window.location.href.indexOf("srri")>=0};var d=function(){return(window.location.href.indexOf("-dev.codap.concord.org")>=0)||(window.location.href.indexOf("localhost:4020")>=0)};var g=function(){return(window.location.href.indexOf("-test.")>=0)};e=j("fix");if(e){a=SC.Store.create().from(SC.Record.fixtures)}else{a=SC.Store.create({commitRecordsAutomatically:YES}).from(f)}a._originalCreateRecord=a.createRecord;a.createRecord=function(n,l,m){var k=this._originalCreateRecord(n,l,m);k.normalize();return k};return{NAMESPACE:"DG",APPNAME:"DG",VERSION:"1.1",BUILD_NUM:"0252",DRUPAL_SUBDOMAIN:"play",IS_DG_BUILD:b(),IS_INQUIRY_SPACE_BUILD:h(),IS_SRRI_BUILD:i(),getVariantString:function(l){var k=l;if(DG.IS_INQUIRY_SPACE_BUILD){k+=".IS_BUILD"}else{if(DG.IS_SRRI_BUILD){k+=".SRRI_BUILD"}}return k},getDrupalSubdomain:function(){var k=DG.DRUPAL_SUBDOMAIN;if(DG.IS_SRRI_BUILD){k+="-srri"}if(g()){k+="-test"}return k+"."},IS_DEV_BUILD:d(),appStore:a,store:null,urlParamGames:j("moreGames"),defaultGameName:j("game"),startingDocName:j("doc"),startingDocOwner:j("owner"),componentMode:j("componentMode","no"),toType:function(k){return({}).toString.call(k).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},copy:function(k){return SC.copy(k,NO)},clone:function(k){return SC.clone(k,YES)},iUser:j("username"),iPassword:j("password"),iSessionID:j("sessionid")}}()));DG.ArchiveUtils={_addLinkSpec:function(a,d,c){if(a&&!SC.empty(d)&&c){if(!a._links_){a._links_={}}var b=a._links_;if(b[d]){if(!SC.isArray(b[d])){b[d]=[b[d]]}b[d].push(c)}else{b[d]=c}}},addLinkID:function(a,c,b,d){var e={type:b,id:d};DG.ArchiveUtils._addLinkSpec(a,c,e)},addLink:function(b,c,a){var d=a&&a.toLink&&a.toLink();DG.ArchiveUtils._addLinkSpec(b,c,d)},getLinkCount:function(a,c){var b=a&&a._links_;if(!b){return 0}if(SC.empty(c)){return DG.ObjectMap.length(b)}var d=b[c];return SC.isArray(d)?d.length:(SC.empty(d)?0:1)},getLinkID:function(a,d,c){var b=a&&a._links_,f=b&&b[d],e=SC.isArray(f)?f[c||0]:f;return e&&e.id}};DG.Browser={init:function(){if((SC.browser.name===SC.BROWSER.firefox)&&(SC.browser.compare(SC.browser.version,"13")<0)){var b;b=function(c){var d=false;try{if((SC.$("embed",c).length>0)||(SC.$("object",c).length>0)){d=true}if(SC.$("iframe",c)>0){d=true}}catch(f){d=true}return d};var a=SC.PickerPane.prototype._hideOverflow;SC.PickerPane.prototype._hideOverflow=function(){if(!b(SC.$(document))){a.call(this,arguments)}}}},isCompatibleBrowser:function(){function a(e,c){var f=e.split("."),d=f.length,h=c.split(".");for(var g=0;g<d;++g){var b=Number(h[g])||0,j=Number(f[g]);if(b>j){return true}if(b<j){return false}}return true}if(DG.IS_DEV_BUILD){return true}switch(SC.browser.name){case SC.BROWSER.ie:return a("9.0",SC.browser.version);case SC.BROWSER.firefox:return a("3.6",SC.browser.version)||a("1.9.2",SC.browser.engineVersion);case SC.BROWSER.chrome:return a("10",SC.browser.version);case SC.BROWSER.safari:return a("4.0",SC.browser.version)||a("530.17",SC.browser.engineVersion)}return true},customCursorStr:function(a,d,c,b){b=b||"auto";return(SC.browser.name===SC.BROWSER.ie?"url("+a+"), "+b:"url("+a+") "+d+" "+c+", "+b)}};DG.Core={classFromClassName:function(b){var d=b.split("."),a,e=d.length,c=window;for(a=0;a<e;++a){c=c&&c[d[a]]}return c||null},isExtendingFromEvent:function(c){var a=(SC.browser.os===SC.OS.mac)||(SC.browser.os===SC.OS.ios),b=a&&c.metaKey&&!c.ctrlKey,d=!a&&c.ctrlKey;return c.shiftKey||b||d}};DG.LOGGER_LEVEL_USER="user";DG.debugForceReload=function(){window.location.reload()};DG.debugLaunchDebugger=function(){eval("debugger")};SC.Logger.logOutputLevel=SC.LOGGER_LEVEL_WARN;DG.Debug=SC.Object.create((function(){return{logServerLevel:SC.LOGGER_LEVEL_INFO,_prevHandleLogMessage:null,_prevExceptionHandler:null,_debugStartTime:0,init:function(){this._debugStartTime=Date.now();this._prevHandleLogMessage=SC.Logger._handleMessage;SC.Logger._handleMessage=this._prevHandleLogMessage;this._prevExceptionHandler=SC.ExceptionHandler.handleException;SC.ExceptionHandler.handleException=this._prevExceptionHandler},logIfNotFinite:function(a,b){if(!isFinite(a)){this.logWarn("DG.Debug.logIfNotFinite: String: %@, Value: %@",b,a)}},logDebug:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_DEBUG,YES,a,arguments)},logDebugRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_DEBUG,NO,null,arguments)},logDebugTimer:function(c,b,d){var a=Date.now();if(c){DG.Debug._debugStartTime=a;a=0}else{a-=DG.Debug._debugStartTime}DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_DEBUG,YES,"[TIME="+(a/1000)+"] "+b,arguments)},logDebugGroupBegin:function(a,b){SC.Logger._handleGroup(SC.LOGGER_LEVEL_DEBUG,a,arguments)},logDebugGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_DEBUG)},logInfo:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_INFO,YES,a,arguments)},logInfoRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_INFO,NO,null,arguments)},logUser:function(a,b){DG.Debug._handleLogMessage(DG.LOGGER_LEVEL_USER,YES,a,arguments)},logUserRaw:function(a){DG.Debug._handleLogMessage(DG.LOGGER_LEVEL_USER,NO,null,arguments)},logWarn:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_WARN,YES,a,arguments)},logWarnRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_WARN,NO,null,arguments)},logError:function(a,b){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_ERROR,YES,a,arguments)},logErrorRaw:function(a){DG.Debug._handleLogMessage(SC.LOGGER_LEVEL_ERROR,NO,null,arguments)},assert:function(d,e,b){if(!d){var c=true,a=true;DG.Debug.logErrorRaw("Assertion Failed: "+e+": "+b);if(a){}if(c){SC.AlertPane.error({message:e||"",description:b||"",buttons:[{title:"Reload",action:DG.debugForceReload},{title:"Ignore"}]})}}return d},check:function(a,c,b){return this.assert(!SC.none(a),c,b)},_shouldLogTypeToServer:function(a){var c=SC.Logger._LOG_LEVEL_MAPPING,d=c[a]||0,b=c[this.get("logServerLevel")]||0;return(d<=b)},_handleLogMessage:function(b,a,f,c){var g=(b===DG.LOGGER_LEVEL_USER?SC.LOGGER_LEVEL_INFO:b);this._prevHandleLogMessage.call(SC.Logger,g,a,f,c);if(DG.Debug._shouldLogTypeToServer(g)){var e=(c&&(c.length>0))?c[c.length-1]:undefined,d=typeof e==="object"?e:{};DG.logToServer(DG.Debug._currentMessage,{type:b},d)}},_handleException:function(a){var b=!SC.none(this._prevExceptionHandler);DG.Debug.logErrorRaw("Exception: "+a.message);if(b){this._prevExceptionHandler.call(SC.ExceptionHandler,a)}}}}()));DG.Debug._prevShouldOutputType=SC.Logger._shouldOutputType;SC.Logger._shouldOutputType=function(a){return true};DG.Debug._prevOutputMessage=SC.Logger._outputMessage;SC.Logger._outputMessage=function(b,d,a,c,e){DG.Debug._currentMessage=c;if(DG.Debug._prevShouldOutputType.call(SC.Logger,b)){DG.Debug._prevOutputMessage.call(SC.Logger,b,d,a,c,e)}};DG.Debug.scObjectID=function(a){var c,b="";DG.ObjectMap.findKey(a,function(d,e){if(d.substr(0,10)==="SproutCore"){c=d;b=e;return true}return false});return !SC.empty(b)?b:"{none}"};DG.log=DG.Debug.logDebug;DG.logRaw=DG.Debug.logDebugRaw;DG.logTimer=DG.Debug.logDebugTimer;DG.logGroupBegin=DG.Debug.logDebugGroupBegin;DG.logGroupEnd=DG.Debug.logDebugGroupEnd;DG.logInfo=DG.Debug.logInfo;DG.logInfoRaw=DG.Debug.logInfoRaw;DG.logUser=DG.Debug.logUser;DG.logUserRaw=DG.Debug.logUserRaw;DG.logWarn=DG.Debug.logWarn;DG.logWarnRaw=DG.Debug.logWarnRaw;DG.logError=DG.Debug.logError;DG.logErrorRaw=DG.Debug.logErrorRaw;DG.assert=DG.Debug.assert;DG.check=DG.Debug.check;DG.Destroyable={concatenatedProperties:["autoDestroyProperties"],destroyMixin:function(){var a=this.get("autoDestroyProperties");if(a){a.forEach(function(b){this.destroyProperty(b)}.bind(this))}},destroyProperty:function destroyProperty(b){var a=this.get(b);if(DG.Destroyable.destroyObject(a)){if(b.charAt(0)==="_"){this[b]=null}else{this.set(b,null)}}}};DG.Destroyable.destroyObject=function(a){if(a&&(a instanceof SC.Object)){if(a.willDestroy){a.willDestroy()}a.destroy();return true}return false};DG.Format={};DG.Format.re=function(a){return a.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};DG.Format.pad=function(e,d,b){var a=d-String(b).length;return(a<1)?b:new Array(a+1).join(e)+b};DG.Format.date=function(a){var c=DG.Format.pad;function b(e){return a.replace(/%[a-zA-Z0-9]/g,function(g){switch(g){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()];case"%c":return e.toLocaleString();case"%C":return c("0",2,Math.floor(e.getFullYear()/100)%100);case"%d":return c("0",2,e.getDate());case"%x":case"%D":return c("0",2,e.getMonth()+1)+"/"+c("0",2,e.getDate())+"/"+c("0",2,e.getFullYear()%100);case"%e":return c(" ",2,e.getDate());case"%H":return c("0",2,e.getHours());case"%I":var f=e.getHours()%12;return f?c("0",2,f):12;case"%m":return c("0",2,e.getMonth()+1);case"%M":return c("0",2,e.getMinutes());case"%n":return"\n";case"%p":return e.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var f=e.getHours()%12;return(f?c("0",2,f):12)+":"+c("0",2,e.getMinutes())+":"+c("0",2,e.getSeconds())+" "+(e.getHours()<12?"AM":"PM");case"%R":return c("0",2,e.getHours())+":"+c("0",2,e.getMinutes());case"%S":return c("0",2,e.getSeconds());case"%Q":return c("0",3,e.getMilliseconds());case"%t":return"\t";case"%u":var d=e.getDay();return d?d:1;case"%w":return e.getDay();case"%y":return c("0",2,e.getFullYear()%100);case"%Y":return e.getFullYear();case"%%":return"%"}return g})}b.format=b;b.parse=function(m){var k=1970,j=0,e=1,g=0,f=0,d=0;var i=[function(){}];var l=DG.Format.re(a).replace(/%[a-zA-Z0-9]/g,function(n){switch(n){case"%b":i.push(function(o){j={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[o]});return"([A-Za-z]+)";case"%h":case"%B":i.push(function(o){j={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[o]});return"([A-Za-z]+)";case"%e":case"%d":i.push(function(o){e=o});return"([0-9]+)";case"%I":case"%H":i.push(function(o){g=o});return"([0-9]+)";case"%m":i.push(function(o){j=o-1});return"([0-9]+)";case"%M":i.push(function(o){f=o});return"([0-9]+)";case"%p":i.push(function(o){if(g==12){if(o=="am"){g=0}}else{if(o=="pm"){g=Number(g)+12}}});return"(am|pm)";case"%S":i.push(function(o){d=o});return"([0-9]+)";case"%y":i.push(function(o){o=Number(o);k=o+(((0<=o)&&(o<69))?2000:(((o>=69)&&(o<100)?1900:0)))});return"([0-9]+)";case"%Y":i.push(function(o){k=o});return"([0-9]+)";case"%%":i.push(function(){});return"%"}return n});var h=m.match(l);if(h){h.forEach(function(n,o){i[o](n)})}return new Date(k,j,e,g,f,d)};return b};DG.Format.time=function(a){var c=DG.Format.pad;function b(f){f=Number(f);switch(a){case"short":if(f>=31536000000){return(f/31536000000).toFixed(1)+" years"}else{if(f>=604800000){return(f/604800000).toFixed(1)+" weeks"}else{if(f>=86400000){return(f/86400000).toFixed(1)+" days"}else{if(f>=3600000){return(f/3600000).toFixed(1)+" hours"}else{if(f>=60000){return(f/60000).toFixed(1)+" minutes"}}}}}return(f/1000).toFixed(1)+" seconds";case"long":var e=[],i=((f%60000)/1000)>>0,d=((f%3600000)/60000)>>0;e.push(c("0",2,i));if(f>=3600000){var g=((f%86400000)/3600000)>>0;e.push(c("0",2,d));if(f>=86400000){e.push(c("0",2,g));e.push(Math.floor(f/86400000).toFixed())}else{e.push(g.toFixed())}}else{e.push(d.toFixed())}return e.reverse().join(":")}}b.format=b;b.parse=function(i){switch(a){case"short":var h=/([0-9,.]+)\s*([a-z]+)/g,d,g=0;while(d=h.exec(i)){var j=parseFloat(d[0].replace(",","")),e=0;switch(d[2].toLowerCase()){case"year":case"years":e=31536000000;break;case"week":case"weeks":e=604800000;break;case"day":case"days":e=86400000;break;case"hour":case"hours":e=3600000;break;case"minute":case"minutes":e=60000;break;case"second":case"seconds":e=1000;break}g+=j*e}return g;case"long":var d=i.replace(",","").split(":").reverse(),g=0;if(d.length){g+=parseFloat(d[0])*1000}if(d.length>1){g+=parseFloat(d[1])*60000}if(d.length>2){g+=parseFloat(d[2])*3600000}if(d.length>3){g+=parseFloat(d[3])*86400000}return g}};return b};DG.Format.number=function(){var g=0,c=Infinity,a=0,j=0,e=0,b=1,f="0",i="0",h=true,d=".",n=",",m="\u2212",k="";function l(o){if(Infinity>e){o=Math.round(o*b)/b}var q=String(Math.abs(o)).split(".");var p=q[0];if(p.length>c){p=p.substring(p.length-c)}if(h&&(p.length<g)){p=new Array(g-p.length+1).join(f)+p}if(p.length>3){p=p.replace(/\B(?=(?:\d{3})+(?!\d))/g,n)}if(!h&&(p.length<a)){p=new Array(a-p.length+1).join(f)+p}q[0]=o<0?m+p+k:p;var r=q[1]||"";if(r.length<j){q[1]=r+new Array(j-r.length+1).join(i)}return q.join(d)}l.format=l;l.parse=function(o){var r=DG.Format.re;var q=String(o).replace(new RegExp("^("+r(f)+")*"),"").replace(new RegExp("("+r(i)+")*$"),"").split(d);var p=q[0].replace(new RegExp(r(n),"g"),"");if(p.length>c){p=p.substring(p.length-c)}var t=q[1]?Number("0."+q[1]):0;if(Infinity>e){t=Math.round(t*b)/b}return Math.round(p)+t};l.integerDigits=function(p,o){if(arguments.length){g=Number(p);c=(arguments.length>1)?Number(o):g;a=g+Math.floor(g/3)*n.length;return this}return[g,c]};l.fractionDigits=function(p,o){if(arguments.length){j=Number(p);e=(arguments.length>1)?Number(o):j;b=Math.pow(10,e);return this}return[j,e]};l.integerPad=function(o){if(arguments.length){f=String(o);h=/\d/.test(f);return this}return f};l.fractionPad=function(o){if(arguments.length){i=String(o);return this}return i};l.decimal=function(o){if(arguments.length){d=String(o);return this}return d};l.group=function(o){if(arguments.length){n=o?String(o):"";a=g+Math.floor(g/3)*n.length;return this}return n};l.negativeAffix=function(o,p){if(arguments.length){m=String(o||"");k=String(p||"");return this}return[m,k]};return l};sc_require("utilities/formatter");DG.Calculator=SC.View.extend((function(){var i=30,h=24,e=3,d=10,j=2,g=2*i+j,b=i+j,a=h+j,f=4,c=5;return{classNames:["calculator"],backgroundColor:"#333333",_justEvaled:NO,viewFormat:DG.Format.number().fractionDigits(0,9).group(""),exportFormat:DG.Format.number().fractionDigits(0,9).group("").negativeAffix("-",""),formatForView:function(k){if(typeof k!=="number"){return String(k)}return this.viewFormat(k)},formatForExport:function(k){if(typeof k!=="number"){return k}return this.exportFormat(k)},clearValue:function(){this.editView.set("value","");this._justEvaled=NO},insert:function(k){if(this._justEvaled&&!isNaN(parseInt(k,10))){this.clearValue()}this.editView.replaceSelectionWithString(k);if(!this.editView.get("isFirstResponder")){this.editView.becomeFirstResponder()}this._justEvaled=NO},insertSymbol:function(k){if(this._justEvaled){this.clearValue()}this.insert(k)},calculate:function(){var l=this.editView.get("formulaExpression"),m=DG.Formula.create({source:l}),n="";if(!SC.empty(l)&&(l.charAt(0)==="#")){return}try{n=m.evaluateDirect()}catch(k){n=!SC.empty(k.message)?k.message:String(k);n="#"+n}this.editView.set("value",this.formatForView(n));this._justEvaled=YES;DG.logUser("Calculation done: %@ = %@",l,this.formatForExport(n))},init:function(){arguments.callee.base.apply(this,arguments);this.setupSubViews()},setupSubViews:function(){var o=this;this.editView=DG.FormulaTextEditView.create({layout:{top:5,left:5,right:5,height:20},value:"",continuouslyUpdatesValue:false,borderStyle:SC.BORDER_BEZEL,keyDown:function(p){if(o.handleKeyDown(p)){return arguments.callee.base.apply(this,arguments)}else{return true}}});this.appendChild(this.editView);this.set("defaultFirstResponder",this.editView);this.equals=SC.ButtonView.create({layout:{bottom:e,left:e+2*b,width:g,height:h},title:"=",titleMinWidth:0});this.appendChild(this.equals);this.equals.action=function(){o.calculate()};var k=d+e+this.editView.layout.height;this.set("layout",{top:0,left:0,width:4*e+f*b,height:k+c*a+e});var l=[["C",function(){o.clearValue()}],["(",function(){o.insertSymbol("(")}],[")",function(){o.insertSymbol(")")}],["/",function(){o.insert(" / ")}],["7",function(){o.insert("7")}],["8",function(){o.insert("8")}],["9",function(){o.insert("9")}],["X",function(){o.insert(" * ")}],["4",function(){o.insert("4")}],["5",function(){o.insert("5")}],["6",function(){o.insert("6")}],[DG.UNICODE.MINUS_SIGN,function(){o.insert(" "+DG.UNICODE.MINUS_SIGN+" ")}],["1",function(){o.insert("1")}],["2",function(){o.insert("2")}],["3",function(){o.insert("3")}],["+",function(){o.insert(" + ")}],["0",function(){o.insert("0")}],[".",function(){o.insertSymbol(".")}]];var n=0,m=5;l.forEach(function(q){var r=Math.floor(n/f);var p=n%f;var s=SC.ButtonView.create({layout:{bottom:e+(m-r-1)*a,left:e+p*b,width:i,height:h},title:q[0],action:q[1],titleMinWidth:0});o.appendChild(s);n++})},handleKeyDown:function(k){if(!this){return NO}if((k.which===SC.Event.KEY_RETURN)&&!k.isIMEInput){if(k.type==="keydown"){this.calculate()}}else{if(k.which===SC.Event.KEY_ESC){this.clearValue()}else{var l=String.fromCharCode(k.which);if(this._justEvaled&&("/*-+\t".indexOf(l)===-1)){this.clearValue()}else{if(l==="="){this.calculate();return false}else{this._justEvaled=NO}}}}return true}}}()));DG.CaseTableAdapter=SC.Object.extend((function(){var f=60,c=18,a=function(h){var i=h.get("parent");return i&&i.get("id").toString()},e=function(h){var i={theCase:h,id:h.get("id").toString(),parentID:a(h)};return i},g=function(j){var i=j.get("name"),l=j.get("formula"),k=j.get("description"),h="";if(l){h="%@ = %@".fmt(i,l)}else{if(!SC.empty(k)){h=k}else{if(!SC.empty(i)){h=i}}}return h},d=function(i){var h=i.get("name"),j=i.get("unit");return h+(!SC.empty(j)?" ("+j+")":"")},b=function(o,h,k,n,j){if(SC.none(k)){k=""}else{if(SC.typeOf(k)===SC.T_NUMBER){var i=n.attribute.get("precision"),l=!SC.none(i)?i:2,m=!SC.none(l)?Math.pow(10,l):1;k=Math.round(m*k)/m}}return k.toString()};return{rowHeight:c,dataContext:null,collection:null,hasAggregates:function(){return this.getPath("collection.hasAggregates")}.property(),showExpandedGroupRows:false,gridDataView:null,gridData:null,gridColumns:null,gridOptions:null,parentIDGroups:null,init:function(){arguments.callee.base.apply(this,arguments);this.parentIDGroups={};this.gridDataView=new Slick.Data.DataView({groupItemMetadataProvider:new Slick.Data.GroupItemMetadataProvider({groupSelectable:true}),inlineFilters:true,showExpandedGroupRows:this.showExpandedGroupRows});if(this.get("dataContext")){this.dataContextDidChange()}},hasParentCollection:function(){var i=this.get("dataContext"),k=this.getPath("collection.id"),j=i&&i.getCollectionAtIndex(0),h=j&&j.get("id");return k!==h},visibleRowCount:function(){return this.gridDataView.getLength()}.property(),totalRowCount:function(){return this.gridDataView.getItems().length}.property(),getIndexForID:function(i){var h=this.get("gridDataView");return h&&h.getRowById(i)},updateColumnInfo:function(){var j=this.get("dataContext"),l=this.get("collection"),k={},m=[];if(!l){return m}if(this.gridColumns){this.gridColumns.forEach(function(n){k[n.id]=n})}function i(o,n){if(o.get("editable")&&!o.get("hasFormula")){n.editor=DG.CaseTableCellEditor}else{delete n.editor}}function h(o){var q=o.get("id").toString(),n=k[q];if(n){i(o,n);m.push(n);return}var s=o.get("collection"),p=o.get("name"),r={context:j,collection:s,collectionID:s.get("id").toString(),attribute:o,id:o.get("id").toString(),name:d(o),field:p,toolTip:g(o),formatter:b,width:f,header:{menu:{items:[{title:"DG.TableController.headerMenuItems.editAttribute".loc(),command:"cmdEditFormula",updater:function(t,v,u){u.disabled=!t.attribute.get("editable")}},{title:"DG.TableController.headerMenuItems.renameAttribute".loc(),command:"cmdRenameAttribute",updater:function(t,v,u){u.disabled=!t.attribute.get("editable")}},{title:"DG.TableController.headerMenuItems.deleteAttribute".loc(),command:"cmdDeleteAttribute",updater:function(t,v,u){u.disabled=!t.attribute.get("editable")}}]}}};i(o,r);m.push(r)}l.forEachAttribute(h);this.gridColumns=m;return m},updateColumnForAttribute:function(h){var i=DG.ArrayUtils.firstMatch(this.gridColumns,function(j){return h.get("id").toString()===j.id});if(i){i.name=d(h);i.field=h.get("name");i.toolTip=g(h);this.gridDataView.refresh();return true}return false},buildRowData:function(){var h=this.get("dataContext"),m=this.get("collection"),o=(m&&m.getPath("collection.collectionRecord.collapseChildren"))||false,j=[],n={},k=[],l=this;if(!m){return k}function i(r){var s=e(r),t=s.parentID;if(!n[t]){j.push(t);n[t]=[s]}else{n[t].push(s)}}m.forEachCase(i);this.parentIDGroups={};j.forEach(function(s){var r=n[s],t={};r.forEach(function(u){k.push(u);if(SC.none(t.firstChildID)){t.firstChildID=u.id;t.isCollapsed=o}t.lastChildID=u.id});l.parentIDGroups[s]=t});this.gridData=k;this.gridDataView.setItems(k);function p(){return h&&h.getLabelForSetOfCases(m)}function q(r){return h&&h.getCaseCountString(m,r)}if(this.hasParentCollection()){this.gridDataView.setGrouping({getter:"parentID",formatter:function(r){return"%@ (%@)".loc(p(),q(r.count))},comparer:function(s,r){return s.value-r.value}});DG.ObjectMap.forEach(this.parentIDGroups,function(r,s){if(s.isCollapsed){this.gridDataView.collapseGroup(r)}}.bind(this))}return k},buildGridOptions:function(){this.gridOptions={rowHeight:c,enableColumnReorder:false,syncColumnCellResize:true,leaveSpaceForNewRows:false,editable:true,enableAddRow:false,asyncEditorLoading:false,autoEdit:true,editCommandHandler:function(i,h,j){j.execute()},dataItemColumnValueExtractor:function(j,h){var i=j.theCase;return i&&i.getValue(h.id)}};return this.gridOptions},rebuild:function(){this.updateColumnInfo();this.buildRowData();this.buildGridOptions()},expandCollapseCounts:function(){var i=0,h=0;DG.ObjectMap.forEach(this.parentIDGroups,function(k,j){if(j){if(j.isCollapsed){++i}else{++h}}});return{collapsed:i,expanded:h}}.property(),expandCollapseAll:function(h){var i=this.get("gridDataView");DG.assert(i);DG.ObjectMap.forEach(this.parentIDGroups,function(k,j){j.isCollapsed=!h;if(h){i.expandGroup(k)}else{i.collapseGroup(k)}})},dataContextDidChange:function(){this.rebuild()}.observes("dataContext"),attributeFormulaDidChange:function(h,i){if(i==="attrFormulaChanges"){this.updateColumnInfo()}this.markCasesChanged();this.gridDataView.refresh()}.observes(".collection.attrFormulaChanges",".collection.attrFormulaDependentChanges"),refresh:function(){var h=this.get("gridDataView");if(h){h.refresh()}},appendRow:function(j){var k=e(j),m=k.parentID,n=this.parentIDGroups[m],h=n&&n.lastChildID,l=this.gridDataView;if(!n){n=this.parentIDGroups[m]={};n.isCollapsed=this.getPath("collection.collection.collectionRecord.collapseChildren")||false}if(SC.none(n.firstChildID)){n.firstChildID=k.id}n.lastChildID=k.id;if(h){var i=l.getIdxById(h);l.setRefreshHints({isFilterExpanding:true});l.insertItem(i+1,k)}else{l.setRefreshHints({isFilterExpanding:true});l.addItem(k);if(m&&n.isCollapsed){l.collapseGroup(m)}}n.lastChildID=k.id;this.parentIDGroups[m]=n},updateRowCount:function(){var h=false,n=this.get("collection"),k=(n&&n.getCaseCount())||0,j=this.get("totalRowCount");if(k>=j){for(var m=j;m<k;++m){var l=n.casesController.objectAt(m);if(DG.assert(l)){this.appendRow(l)}}h=true}return h},getSelectedRows:function(){var k=this.get("dataContext"),n=this.get("collection"),q=this.get("gridDataView"),r=this.getPath("collection.casesController.selection"),l=[];if(r){r.forEach(function(s){var i=q.getRowById(s.get("id").toString());if(i>=0){l.push(i)}})}var m,p=this.get("visibleRowCount"),o=k&&k.getParentCollection(n);if(o&&q&&(p>0)){for(m=0;m<p;++m){var h=q.getItem(m);if(h&&h.__group){var j=DG.store.find(DG.Case,h.value);if(o.isCaseSelected(j)){l.push(m)}}}}return l},handleCellClick:function(n,j){var o=this.get("gridDataView"),p=j&&(j.row>=0)&&o&&o.getItem(j.row),k=p&&p.theCase,i=p&&p.__group&&p.value,q=this.get("dataContext"),h=this.get("collection"),l=h&&k&&h.isCaseSelected(k);if(!SC.none(i)){k=DG.store.find(DG.Case,i);h=q.getCollectionForCase(k)}var m={operation:"selectCases",collection:h,cases:[k],select:n?!l:true,extend:n};if(k){q.applyChange(m)}else{if(!n){DG.globalEditorLock.commitCurrentEdit();m.cases=null;m.select=false;q.applyChange(m)}}},selectRowsInRange:function(o,p){var q=this.get("gridDataView"),s=this.get("dataContext"),h=this.get("collection"),l=[];for(var m=o;m<=p;++m){var r=q.getItem(m),j=r&&r.theCase,k=r&&r.__group&&r.value;if(!SC.empty(k)){j=DG.store.find(DG.Case,k)}if(j){l.push(j)}}if(l.length){var n={operation:"selectCases",collection:h,cases:l,select:true,extend:false};s.applyChange(n)}},markCasesChanged:function(i){var j=this.gridDataView,h=i||this.getPath("collection.casesController");j.beginUpdate();h.forEach(function(l){var k=l.get("id").toString(),m=j.getItemById(k);if(m){j.updateItem(k,m)}});j.endUpdate()}}}()));DG.CaseTableCellEditor=function CaseTableCellEditor(b){var c;var a;this.init=function(){var e=37,d=39;c=SC.$("<INPUT type=text class='editor-text' />").appendTo(b.container).bind("keydown.nav",function(f){if(f.keyCode===e||f.keyCode===d){f.stopImmediatePropagation()}}).bind("blur",function(f){DG.globalEditorLock.commitCurrentEdit()}).focus().select()};this.destroy=function(){c.remove()};this.focus=function(){c.focus()};this.getValue=function(){return c.val()};this.setValue=function(d){c.val(d)};this.loadValue=function(e){var d=Number(b.column.id),f=e.theCase&&e.theCase.getValue(d);a=SC.none(f)?"":f.toString();c.val(a);c[0].defaultValue=a;c.select()};this.serializeValue=function(){return c.val()};this.applyValue=function(g,j){var i=Number(b.column.id),h=j,e=b.column.context,f={operation:"updateCases",cases:[g.theCase],attributeIDs:[i],values:[[h]]};e.applyChange(f);var d=g.theCase.getPath("collection.name")||"",k=b.grid.getData().getIdxById(g.id)+1;DG.logUser("editValue: { collection: %@, case: %@, attribute: '%@', value: '%@' }",d,k,b.column.name,h)};this.isValueChanged=function(){return(!(c.val()===""&&SC.none(a)))&&(c.val()!==a)};this.validate=function(){if(b.column.validator){var d=b.column.validator(c.val());if(!d.valid){return d}}return{valid:true,msg:null}};this.init()};DG.ComponentController=SC.Object.extend((function(){return{model:null,view:null,shouldDestroyOnComponentDestroy:true,willDestroy:function(){},addLink:function(b,c,a){DG.ArchiveUtils.addLink(b,c,a)},getLinkID:function(a,b){return DG.ArchiveUtils.getLinkID(a,b)},createComponentStorage:function(){return null},restoreComponentStorage:function(a,b){},willSaveComponent:function(){if(this.model){var a=this.createComponentStorage();if(a){this.model.set("componentStorage",a)}var b=this.getPath("view.layout");if(b){this.model.set("layout",b)}}},didRestoreComponent:function(b){var a=this.getPath("model.componentStorage");if(a){this.restoreComponentStorage(a,b)}}}}()));sc_require("controllers/component_controller");DG.CaseTableController=DG.ComponentController.extend((function(){return{_currentGameContext:null,_currentGameContextBinding:SC.Binding.oneWay("DG.gameSelectionController.currentContext"),currentGameContextDidChange:function(a,b){if(!this.restoredDataContext){this.notifyPropertyChange("dataContext")}else{if(b==="gameIsReady"){var c=this.getPath("view.contentView");if(c){c.refresh()}}}}.observes("_currentGameContext","DG.currGameController.gameIsReady"),restoredDataContext:null,dataContext:function(){return this.get("restoredDataContext")||this.get("_currentGameContext")}.property("restoredDataContext"),_prevDataContext:null,caseTableAdapters:null,contentView:null,newAttributeDialog:null,init:function(){arguments.callee.base.apply(this,arguments);this.caseTableAdapters=[];if(this.get("dataContext")){this.dataContextDidChange()}},destroy:function(){var a=this.get("dataContext");if(a){a.removeObserver("changeCount",this,"contextDataDidChange")}this.caseTableAdapters=null;arguments.callee.base.apply(this,arguments)},updateTableAdapters:function(){var b=this.get("dataContext"),f=this.getPath("dataContext.collections")||[],d=this.caseTableAdapters,a=[];this.caseTableAdapters=a;function c(j){var g,h=d.length;for(g=0;g<h;++g){if(d[g]&&(d[g].getPath("collection.id")===j)){return d[g]}}return null}function e(i){var h=i.get("id"),j=b.getCollectionByID(h),g=c(h);if(!g){g=DG.CaseTableAdapter.create({dataContext:b,collection:j})}a.push(g)}f.forEach(e)},dataContextDidChange:function(){var a=this.get("dataContext");this.updateTableAdapters();var c=this.getPath("view.contentView");if(c){c.setCaseTableAdapters(this.get("caseTableAdapters"))}if(a!==this._prevDataContext){if(this._prevDataContext){this._prevDataContext.removeObserver("changeCount",this,"contextDataDidChange")}if(a){a.addObserver("changeCount",this,"contextDataDidChange")}this._prevDataContext=a}var b=this.getPath("dataContext.childCollection");if(b){var d=this;b.casesController.addObserver("[]",this,"caseCountDidChange");a.forEachCollection(function(e){e.attrsController.addObserver("[]",d,"attributeCountDidChange")})}}.observes("dataContext"),createComponentStorage:function(){var b={},a=this.get("dataContext");if(a){this.addLink(b,"context",a)}return b},restoreComponentStorage:function(c,d){var b=this.getLinkID(c,"context"),a=b&&DG.DataContext.retrieveContextFromMap(d,b);if(a){this.set("restoredDataContext",a)}},doCommand:function(a){var b=Number(a.column.id);switch(a.command){case"cmdEditFormula":this.editAttributeFormula(b);break;case"cmdRenameAttribute":this.renameAttribute(b);break;case"cmdDeleteAttribute":this.deleteAttribute(b);break}},contextDataDidChange:function(){var b=this.getPath("dataContext.newChanges"),a=true;var d=function(f){var e=f&&f.operation;switch(e){case"createCollection":this.dataContextDidChange();break;case"createCase":case"createCases":this.caseCountDidChange(f);break;case"updateCases":this.doChangeCaseValues(f);break;case"deleteCases":this.caseCountDidChange(f);case"selectCases":this.doSelectCases(f);if(e==="selectCases"){a=false}break;case"createAttributes":case"deleteAttributes":this.attributeCountDidChange(f);break;case"updateAttributes":this.doUpdateAttributes(f);break}}.bind(this);if(b){b.forEach(function(e){d(e)})}if(a){var c=this.get("caseTableAdapters");if(c){c.forEach(function(e){if(e.get("hasAggregates")){e.markCasesChanged()}})}}},doSelectCases:function(a){var b=this.getPath("view.contentView");if(b){b.updateSelectedRows()}},doChangeCaseValues:function(b){var a=this.get("caseTableAdapters");if(a){a.forEach(function(c){c.markCasesChanged(b.cases)})}},doUpdateAttributes:function(e){var f=this.getPath("view.contentView"),c=this.get("caseTableAdapters"),b=[],a=e&&e.result&&e.result.attrs;function d(g){if(a){a.forEach(function(h){if(g.updateColumnForAttribute(h)){b.push(g)}})}}if(c){c.forEach(d);if(f){f.get("childTableViews").forEach(function(g){var h=g.get("gridAdapter");if(b.indexOf(h)>=0){g.setColumns(h.get("gridColumns"))}})}}},caseCountDidChange:function(a){var b=this.getPath("view.contentView");if(b){b.updateRowCount()}},attributeCountDidChange:function(){var a=this.getPath("view.contentView");if(a){a.updateColumnInfo()}},gearMenuItems:function(){var b=this.get("dataContext"),a=b&&b.get("childCollection"),h=a&&a.get("name"),e=b&&b.get("parentCollection"),d=e&&e.get("name"),g=b&&b.getSelectedCases(),f=g&&g.get("length"),c="DG.TableController.gearMenuItems.newAttribute",i=[];if(!SC.empty(h)){i.push({title:c.loc(h),target:this,itemAction:this.newChildAttribute})}if(!SC.empty(d)){i.push({title:c.loc(d),target:this,itemAction:this.newParentAttribute})}i.push({title:"DG.TableController.gearMenuItems.deleteCases",localize:true,target:this,itemAction:this.deleteSelectedCases,isEnabled:f});return i}.property(),modelDidChange:function(){}.observes("model"),viewDidChange:function(){var b=this.get("view"),a=b.get("contentView");this.set("contentView",a);if(!this.getPath("caseTableAdapters.length")){this.updateTableAdapters()}if(a){a.bind("dataContext",this,"dataContext");a.setCaseTableAdapters(this.get("caseTableAdapters")||[])}var c=this.getPath("view.containerView.titlebar.gearView");if(c){c.set("contentView",b)}}.observes("view"),deleteSelectedCases:function(){var a=this.get("dataContext"),b={operation:"deleteCases",cases:a.getSelectedCases()};a.applyChange(b)},newChildAttribute:function(){var b=this.get("dataContext"),a=b&&b.get("childCollection");this.newAttribute({collection:a})},newParentAttribute:function(){var b=this.get("dataContext"),a=b&&b.get("parentCollection");this.newAttribute({collection:a})},newAttribute:function(l,h,g){var f=this.getPath("dataContext.parentCollection"),j=f&&f.collection.getAttributeNames(),a=this.getPath("dataContext.childCollection"),d=a&&a.collection.getAttributeNames(),b=DG.globalsController.getGlobalValueNames(),c=[],k=h||"",e=g||"";function i(m){if(!m||!m.length){return}if(c.length){c.push("--")}c=c.concat(m.sort())}i(j);i(d);i(b);i(["e","π"]);this.newAttributeDialog=DG.CreateAttributeFormulaView(SC.mixin({applyTarget:this,applyAction:"applyNewAttribute",applyTooltip:"DG.TableController.newAttrDlg.applyTooltip",attrNameHint:"DG.TableController.newAttrDlg.attrNameHint",attrNameValue:k,attrNameIsEnabled:SC.empty(h),formulaValue:e,formulaOperands:c,formulaHint:"DG.TableController.newAttrDlg.formulaHint"},l))},applyNewAttribute:function(){var a=this.get("dataContext"),f=this.newAttributeDialog.get("attributeName");if(!SC.empty(f)){var c=this.newAttributeDialog.get("collection"),e=this.newAttributeDialog.get("formula"),b={operation:"createAttributes",collection:c,attrPropsArray:[{name:f,formula:e}]},d=a&&a.applyChange(b);if(d.success){DG.logUser("attributeCreate: { name: '%@', collection: '%@', formula: '%@' }",f,c.get("name"),e)}}else{DG.AlertPane.show({localize:true,message:"DG.TableController.newAttrDlg.mustEnterAttrNameMsg"});return}this.newAttributeDialog.close();this.newAttributeDialog=null},willDestroy:function(){if(this.newAttributeDialog){this.newAttributeDialog.close();this.newAttributeDialog=null}arguments.callee.base.apply(this,arguments)},renameAttribute:function(i){var a=this.get("dataContext"),b=a&&a.getAttrRefByID(i),g=b&&b.collection,f=a&&b&&a.getCollectionForAttribute(b.attribute),d=b&&b.attribute.get("name"),e;if(!DG.assert(b,"renameAttribute() is missing the attribute reference")){return}function c(j,k){var l={operation:"updateAttributes",collection:g,attrPropsArray:[{id:j,name:k}]};a.applyChange(l)}function h(){var j=e.get("value"),k=f&&j&&f.getAttributeByName(j);if(j===d){e.close();return}if(j&&!k){e.close();c(i,j)}else{if(k){DG.AlertPane.info({message:"DG.TableController.renameAttributeDuplicateMsg",description:"DG.TableController.renameAttributeDuplicateDesc",localize:true})}}}e=DG.CreateSingleTextDialog({prompt:"DG.TableController.renameAttributePrompt",textValue:d,okTarget:null,okAction:h,okTooltip:"DG.TableController.renameAttributeOKTip"})},deleteAttribute:function(c){var f=this.get("dataContext"),e=f&&f.getAttrRefByID(c),a=e&&e.collection,b=e&&e.attribute.get("name");function d(){var g={operation:"deleteAttributes",collection:a,attrs:[{id:c,attribute:e.attribute}]};f.applyChange(g)}DG.AlertPane.warn({message:"DG.TableController.deleteAttribute.confirmMessage".loc(b),description:"DG.TableController.deleteAttribute.confirmDescription".loc(),buttons:[{title:"DG.TableController.deleteAttribute.okButtonTitle",action:d,localize:YES},{title:"DG.TableController.deleteAttribute.cancelButtonTitle",localize:YES}],localize:false})},editAttributeFormula:function(c){var e=this.get("dataContext"),d=e&&e.getAttrRefByID(c),a=d&&d.attribute.get("name"),b=d&&d.attribute.get("formula");DG.assert(d&&a,"editAttributeFormula() is missing the attribute reference or attribute name");this.newAttribute({collection:d.collection},a,b||"")}}}()));DG.CaseTableView=SC.View.extend((function(){var a=29,b=200;return{classNames:["dg-case-table"],layout:{left:0,right:0,top:0,bottom:0},backgroundColor:"white",childViews:"_hiddenDragView".w(),_hiddenDragView:SC.LabelView.design({classNames:"drag-label".w(),layout:{width:100,height:20,top:-50,left:0},value:""}),gridAdapter:null,gridDataView:null,gridView:undefined,_slickGrid:null,_gridEventHandler:null,_gridWidth:0,_prevGridWidth:0,gridWidth:function(c,d){if(!SC.none(d)){this._prevGridWidth=this._gridWidth;this._gridWidth=d;return this}return this._gridWidth}.property(),gridWidthChange:function(){return this._gridWidth-this._prevGridWidth}.property(),rowCount:0,scrollPos:null,expandCollapseCount:0,displayProperties:["gridAdapter","gridDataView","_slickGrid"],viewDidResize:function(){if(this._slickGrid){this.invokeLast(function(){this._slickGrid.resizeCanvas();this.setIfChanged("gridWidth",this._slickGrid.getContentSize().width)}.bind(this))}},initGridView:function(){var e="#"+this.get("layerId"),d=this.get("gridAdapter"),f=d&&d.gridDataView;this._slickGrid=new Slick.Grid(e,d.gridDataView,d.gridColumns,d.gridOptions);this._slickGrid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:false}));if(DG.supports("caseTableHeaderMenus")){var c=new Slick.Plugins.HeaderMenu({buttonIsCell:true,buttonImage:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/slickgrid/images/down.gif"});this._slickGrid.registerPlugin(c);c.onBeforeMenuShow.subscribe(function(i,h){var g=0;if(h.menu&&h.menu.items&&h.menu.items.length){h.menu.items.forEach(function(j){if(j.updater){j.updater(h.column,h.menu,j)}if(!j.disabled){++g}})}return(g>0)});c.onCommand.subscribe(function(j,i){var h;for(var g=this;g&&!h;g=g.get("parentView")){h=g.get("controller")}if(h){h.doCommand(i)}}.bind(this))}this._gridEventHandler=new Slick.EventHandler();this.subscribe("onScroll",this.handleScroll);this.subscribe("onHeaderClick",this.handleHeaderClick);this.subscribe("onHeaderDragInit",function(h,g){DG.globalEditorLock.commitCurrentEdit();h.stopImmediatePropagation()});this.subscribe("onHeaderDragStart",this.handleHeaderDragStart);this.subscribe("onCanvasWidthChanged",function(h,g){SC.run(function(){this.setIfChanged("gridWidth",this._slickGrid.getContentSize().width)}.bind(this))}.bind(this));f.onRowCountChanged.subscribe(function(h,g){SC.run(function(){this._slickGrid.updateRowCount();this._slickGrid.render();this.set("rowCount",g.current)}.bind(this))}.bind(this));f.onRowsChanged.subscribe(function(h,g){if(this._slickGrid){this._slickGrid.invalidateRows(g.rows);this._slickGrid.render()}}.bind(this));$(e).show();this.notifyPropertyChange("gridView")},destroySlickGrid:function(){if(this._slickGrid){this._slickGrid.destroy()}this._slickGrid=null;this.gridDataView=null},_destroy:function(){this.destroySlickGrid();if(this.gridAdapter){this.gridAdapter.destroy()}this.gridAdapter=null},willDestroy:function(){this._destroy()},destroy:function(){this._destroy();arguments.callee.base.apply(this,arguments)},subscribe:function(f,d){var c,e=function(g){return function(){if(!c){c=true;g.apply(this,arguments);c=false}}.bind(this)}.bind(this);this._gridEventHandler.subscribe(this._slickGrid[f],e(d))},getRowBounds:function(f){var d=this._slickGrid&&this._slickGrid.getCellNodeBox(f,0),e=this._slickGrid&&this._slickGrid.getColumns(),g=e&&e.length;if(d&&g){var c=this._slickGrid.getCellNodeBox(f,g-1);d.right=c.right}return d},gridAdapterDidChange:function(){if(this._slickGrid){this.destroySlickGrid();this.displayDidChange();this.notifyPropertyChange("gridView")}}.observes("gridAdapter"),refresh:function(){var c=this.get("gridAdapter");if(c){c.refresh()}if(this._slickGrid){this._slickGrid.invalidate()}},render:function(d,e){arguments.callee.base.apply(this,arguments);if(e){this.displayDidChange()}else{if(!this._slickGrid&&this.get("gridAdapter")){this.initGridView();this.set("gridWidth",this._slickGrid.getContentSize().width)}else{if(this._slickGrid){var c=this.get("gridAdapter");if(this._rowDataDidChange){c.buildRowData();c.refresh()}this._slickGrid.render();this._rowDataDidChange=false;this._renderRequired=false}}}if(this._slickGrid){d.classNames(this.$().attr("class"),YES)}},mouseDown:function(c){return this.touchStart(c)},mouseDragged:function(c){this.touchesDragged(c)},mouseUp:function(c){this.touchEnd(c)},touchPosInView:function(c){return this.convertFrameFromView({x:c.pageX,y:c.pageY},null,true)},touchPosInBodyContent:function(c){var d=this.touchPosInView(c),e=this.get("scrollPos");d.y-=a;if(e){d.x+=e.scrollLeft;d.y+=e.scrollTop}return d},cellFromTouch:function(d){var c={},e=this.touchPosInView(d);if(e.y<a){c=this._slickGrid.getCellFromPoint(e.x,0);c.row=-1}else{c=this.bodyCellFromTouch(d)}return c},bodyCellFromTouch:function(c){var d=this.touchPosInBodyContent(c);return this._slickGrid.getCellFromPoint(d.x,d.y)},_touchStartTouch:null,_touchStartCell:null,_touchDragCell:null,captureTouch:function(c){return YES},touchStart:function(f){var c=this.touchPosInView(f),d=this._slickGrid&&this._slickGrid.getVisibleSize();if(!d||(c.x>d.width)||(c.y-a>d.height)){return NO}this._touchStartTouch=f;this._touchStartCell=this.cellFromTouch(f);if(this._touchStartCell&&(this._touchStartCell.row>=0)){var e=DG.Core.isExtendingFromEvent(f);this.get("gridAdapter").handleCellClick(e,this._touchStartCell)}return YES},_autoScrollRow:null,_autoScrollIncrement:0,_autoScrollTimer:null,_autoScrollTimerFunc:function(){var d=this.get("gridAdapter"),e=d&&d.get("visibleRowCount"),f=this._autoScrollRow+this._autoScrollIncrement;if(this._slickGrid&&d){if((f>=0)&&(f<e)){var c=Math.min(this._touchStartCell.row,f),g=Math.max(this._touchStartCell.row,f);this._autoScrollRow=f;d.selectRowsInRange(c,g);this._slickGrid.scrollRowIntoView(this._autoScrollRow)}}else{if(this._autoScrollTimer){this._autoScrollTimer.invalidate();this._autoScrollTimer=null}}},touchesDragged:function(e,f){var c=this._touchStartCell&&this._touchStartCell.row;if(!SC.none(c)){if(c<0){if(SC.none(this._touchDragCell)){this._touchDragCell=this._touchStartCell;var d=this.get("gridAdapter").gridColumns[this._touchDragCell.cell];this.handleHeaderDragStart(e,{column:d})}}else{if(this._touchStartCell.row>=0){if(!f){f=[e]}f.forEach(function(i){var j=this.touchPosInView(i),k=this._slickGrid.getVisibleSize(),h=this.bodyCellFromTouch(i),g=Math.min(this._touchStartCell.row,h.row),l=Math.max(this._touchStartCell.row,h.row);this.get("gridAdapter").selectRowsInRange(g,l);this._autoScrollRow=h.row>=0?h.row:Math.max(0,g-1);this._slickGrid.scrollRowIntoView(this._autoScrollRow);if(j.y<a){this._autoScrollIncrement=-1}else{if(j.y>k.height){this._autoScrollIncrement=1}else{this._autoScrollIncrement=0}}if(this._autoScrollIncrement!==0){if(!this._autoScrollTimer){this._autoScrollTimer=SC.Timer.schedule({target:this,action:"_autoScrollTimerFunc",interval:b,repeats:YES})}else{this._autoScrollTimer.set("lastFireTime",Date.now());this._autoScrollTimer.schedule()}}else{if(this._autoScrollTimer){this._autoScrollTimer.invalidate();this._autoScrollTimer=null}}}.bind(this))}}}},touchEnd:function(c){if(this._autoScrollTimer){this._autoScrollTimer.invalidate();this._autoScrollTimer=null}this._touchStartTouch=this._touchStartCell=this._touchDragCell=null},handleScroll:function(d,c){this.set("scrollPos",c)},handleHeaderDragStart:function(g,d){var e=d.column;if(g.stopImmediatePropagation){g.stopImmediatePropagation()}var c=this._hiddenDragView,f=e.attribute.get("name"),h=this;SC.run(function(){c.set("value",f);h.removeChild(c);h.appendChild(c)});DG.Drag.start({event:g,source:this,dragView:c,ghost:YES,ghostActsLikeCursor:YES,slideBack:YES,origin:{x:g.clientX,y:g.clientY},data:{collection:e.collection,attribute:e.attribute,text:f}})},handleHeaderClick:function(c){DG.globalEditorLock.commitCurrentEdit()},updateColumnInfo:function(){if(this._slickGrid){this.setColumns(this.get("gridAdapter").updateColumnInfo())}},setColumns:function(c){if(this._slickGrid){this._slickGrid.setColumns(c);this._slickGrid.render()}},expandCollapseAll:function(d){var c=this.get("gridAdapter");if(c){c.expandCollapseAll(d);this.updateSelectedRows();this.incrementProperty("expandCollapseCount")}},updateRowData:function(){this._rowDataDidChange=true;this._renderRequired=true;this.displayDidChange()},updateRowCount:function(){var c=this.get("gridAdapter"),d=false;if(!this._slickGrid){return}if(c){d=c.updateRowCount()}if(d){this._slickGrid.updateRowCount();this._slickGrid.scrollRowIntoView(this._slickGrid.getDataLength())}else{this.updateRowData();this.updateSelectedRows()}this._slickGrid.render()},setSelectedRows:function(c){if(this._slickGrid){this._slickGrid.setSelectedRows(c);this._slickGrid.render()}},updateSelectedRows:function(){var c=this.get("gridAdapter"),d=c&&c.getSelectedRows();if(d){this.setSelectedRows(d)}}}}()));(function(i){var e="0.3.0",j="hasOwnProperty",b=/[\.\/]/,a="*",g=function(){},f=function(m,l){return m-l},d,h,k={n:{}},c=function(m,A){var t=k,u=Array.prototype.slice.call(arguments,2),w=c.listeners(m),v=0,s=false,o,n=[],r={},p=[],x=[];d=m;h=0;for(var q=0,y=w.length;q<y;q++){if("zIndex" in w[q]){n.push(w[q].zIndex);if(w[q].zIndex<0){r[w[q].zIndex]=w[q]}}}n.sort(f);while(n[v]<0){o=r[n[v++]];p.push(o.apply(A,u));if(h){return p}}for(q=0;q<y;q++){o=w[q];if("zIndex" in o){if(o.zIndex==n[v]){p.push(o.apply(A,u));if(h){return p}do{v++;o=r[n[v]];o&&p.push(o.apply(A,u));if(h){return p}}while(o)}else{r[o.zIndex]=o}}else{p.push(o.apply(A,u));if(h){return p}}}return p.length?p:null};c.listeners=function(l){var t=l.split(b),r=k,x,s,m,p,w,o,q,u,v=[r],n=[];for(p=0,w=t.length;p<w;p++){u=[];for(o=0,q=v.length;o<q;o++){r=v[o].n;s=[r[t[p]],r[a]];m=2;while(m--){x=s[m];if(x){u.push(x);n=n.concat(x.f||[])}}}v=u}return n};c.on=function(l,o){var q=l.split(b),p=k;for(var m=0,n=q.length;m<n;m++){p=p.n;!p[q[m]]&&(p[q[m]]={n:{}});p=p[q[m]]}p.f=p.f||[];for(m=0,n=p.f.length;m<n;m++){if(p.f[m]==o){return g}}p.f.push(o);return function(r){if(+r==+r){o.zIndex=+r}}};c.stop=function(){h=1};c.nt=function(l){if(l){return new RegExp("(?:\\.|\\/|^)"+l+"(?:\\.|\\/|$)").test(d)}return d};c.unbind=function(m,q){var s=m.split(b),r,u,n,t=[k];for(var p=0,v=s.length;p<v;p++){for(var o=0;o<t.length;o+=n.length-2){n=[o,1];r=t[o].n;if(s[p]!=a){if(r[s[p]]){n.push(r[s[p]])}}else{for(u in r){if(r[j](u)){n.push(r[u])}}}t.splice.apply(t,n)}}for(p=0,v=t.length;p<v;p++){r=t[p];while(r.n){if(q){if(r.f){for(p=0,v=r.f.length;p<v;p++){if(r.f[p]==q){r.f.splice(p,1);break}}!r.f.length&&delete r.f}for(u in r.n){if(r.n[j](u)&&r.n[u].f){var l=r.n[u].f;for(p=0,v=l.length;p<v;p++){if(l[p]==q){l.splice(p,1);break}}!l.length&&delete r.n[u].f}}}else{delete r.f;for(u in r.n){if(r.n[j](u)&&r.n[u].f){delete r.n[u].f}}}r=r.n}}};c.version=e;c.toString=function(){return"You are running Eve "+e};(typeof module!="undefined"&&module.exports)?(module.exports=c):(i.eve=c)})(this);(function(){function aH(E){if(aH.is(E,"function")){return af?E():eve.on("DOMload",E)}else{if(aH.is(E,a3)){var bz=E,b=aH._engine.create[bt](aH,bz.splice(0,3+aH.is(bz[0],aB))),S=b.set(),g=0,bA=bz.length,d;for(;g<bA;g++){d=bz[g]||{};bj[ab](d.type)&&S.push(b[d.type]().attr(d))}return S}else{var by=Array.prototype.slice.call(arguments,0);if(aH.is(by[by.length-1],"function")){var R=by.pop();return af?R.call(aH._engine.create[bt](aH,by)):eve.on("DOMload",function(){R.call(aH._engine.create[bt](aH,by))})}else{return aH._engine.create[bt](aH,arguments)}}}}aH.version="2.0.0";aH.eve=eve;var af,a=/[, ]+/,bj={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},bf=/\{(\d+)\}/g,bw="prototype",ab="hasOwnProperty",ap={doc:document,win:window},r={was:Object.prototype[ab].call(ap.win,"Raphael"),is:ap.win.Raphael},bs=function(){this.customAttributes={}},aU,bc="appendChild",bt="apply",br="concat",T="createTouch" in ap.doc,aN="",aG=" ",bu=String,B="split",N="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel".split(aG),bk={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},bx=bu.prototype.toLowerCase,ak=Math,m=ak.max,ba=ak.min,am=ak.abs,bd=ak.pow,aL=ak.PI,aB="number",aa="string",a3="array",aV="toString",aZ="fill",aR=Object.prototype.toString,bm={},j="push",f=aH._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,z=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,al={"NaN":1,"Infinity":1,"-Infinity":1},c=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Y=ak.round,y="setAttribute",ae=parseFloat,O=parseInt,bh=bu.prototype.toUpperCase,q=aH._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ai=aH._availableAnimAttrs={blur:aB,"clip-rect":"csv",cx:aB,cy:aB,fill:"colour","fill-opacity":aB,"font-size":aB,height:aB,opacity:aB,path:"path",r:aB,rx:aB,ry:aB,stroke:"colour","stroke-opacity":aB,"stroke-width":aB,transform:"transform",width:aB,x:aB,y:aB},a8=/\s*,\s*/,n={hs:1,rg:1},a6=/,?([achlmqrstvxz]),?/gi,aQ=/([achlmrqstvz])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,Z=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,aF=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)\s*,?\s*/ig,aM=aH._radial_gradient=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,aK={},be=function(g,d){return g.key-d.key},s=function(g,d){return ae(g)-ae(d)},F=function(){},bo=function(b){return b},ao=aH._rectPath=function(b,E,d,g,i){if(i){return[["M",b+i,E],["l",d-i*2,0],["a",i,i,0,0,1,i,i],["l",0,g-i*2],["a",i,i,0,0,1,-i,i],["l",i*2-d,0],["a",i,i,0,0,1,-i,-i],["l",0,i*2-g],["a",i,i,0,0,1,i,-i],["z"]]}return[["M",b,E],["l",d,0],["l",0,g],["l",-d,0],["z"]]},H=function(b,i,g,d){if(d==null){d=g}return[["M",b,i],["m",0,-d],["a",g,d,0,1,1,0,2*d],["a",g,d,0,1,1,0,-2*d],["z"]]},K=aH._getPath={path:function(b){return b.attr("path")},circle:function(d){var b=d.attrs;return H(b.cx,b.cy,b.r)},ellipse:function(d){var b=d.attrs;return H(b.cx,b.cy,b.rx,b.ry)},rect:function(d){var b=d.attrs;return ao(b.x,b.y,b.width,b.height,b.r)},image:function(d){var b=d.attrs;return ao(b.x,b.y,b.width,b.height)},text:function(b){var d=b._getBBox();return ao(d.x,d.y,d.width,d.height)}},I=function(S,d){if(!d){return S}var b,by,E,g,R;S=Q(S);for(E=0,ii=S.length;E<ii;E++){R=S[E];for(g=1,jj=R.length;g<jj;g+=2){b=d.x(R[g],R[g+1]);by=d.y(R[g],R[g+1]);R[g]=b;R[g+1]=by}}return S};aH._g=ap;aH.type=(ap.win.SVGAngle||ap.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(aH.type=="VML"){var au=ap.doc.createElement("div"),ax;au.innerHTML='<v:shape adj="1"/>';ax=au.firstChild;ax.style.behavior="url(#default#VML)";if(!(ax&&typeof ax.adj=="object")){return(aH.type=aN)}au=null}aH.svg=!(aH.vml=aH.type=="VML");aH._Paper=bs;aH.fn=aU=bs.prototype=aH.prototype;aH._id=0;aH._oid=0;aH.is=function(d,b){b=bx.call(b);if(b=="finite"){return !al[ab](+d)}if(b=="array"){return d instanceof Array}return(b=="null"&&d===null)||(b==typeof d)||(b=="object"&&d===Object(d))||(b=="array"&&Array.isArray&&Array.isArray(d))||aR.call(d).slice(8,-1).toLowerCase()==b};aH.angle=function(E,S,g,R,d,i){if(d==null){var b=E-g,by=S-R;if(!b&&!by){return 0}return(180+ak.atan2(-by,-b)*180/aL+360)%360}else{return aH.angle(E,S,d,i)-aH.angle(g,R,d,i)}};aH.rad=function(b){return b%360*aL/180};aH.deg=function(b){return b*180/aL%360};aH.snapTo=function(d,E,b){b=aH.is(b,"finite")?b:10;if(aH.is(d,a3)){var g=d.length;while(g--){if(am(d[g]-E)<=b){return d[g]}}}else{d=+d;var R=E%d;if(R<b){return E-R}if(R>d-b){return E-R+d}}return E};var h=aH._createUUID=(function(b,d){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(b,d).toUpperCase()}})(/[xy]/g,function(g){var d=ak.random()*16|0,b=g=="x"?d:(d&3|8);return b.toString(16)});aH.setWindow=function(b){eve("setWindow",aH,ap.win,b);ap.win=b;ap.doc=ap.win.document;if(initWin){initWin(ap.win)}};var a5=function(g){if(aH.vml){var b=/^\s+|\s+$/g;var R;try{var S=new ActiveXObject("htmlfile");S.write("<body>");S.close();R=S.body}catch(by){R=createPopup().document.body}var d=R.createTextRange();a5=aw(function(i){try{R.style.color=bu(i).replace(b,aN);var bz=d.queryCommandValue("ForeColor");bz=((bz&255)<<16)|(bz&65280)|((bz&16711680)>>>16);return"#"+("000000"+bz.toString(16)).slice(-6)}catch(bA){return"none"}})}else{var E=ap.doc.createElement("i");E.title="Rapha\xebl Colour Picker";E.style.display="none";ap.doc.body.appendChild(E);a5=aw(function(i){E.style.color=i;return ap.doc.defaultView.getComputedStyle(E,aN).getPropertyValue("color")})}return a5(g)},ay=function(){return"hsb("+[this.h,this.s,this.b]+")"},J=function(){return"hsl("+[this.h,this.s,this.l]+")"},w=function(){return this.hex},aO=function(R,E,d){if(E==null&&aH.is(R,"object")&&"r" in R&&"g" in R&&"b" in R){d=R.b;E=R.g;R=R.r}if(E==null&&aH.is(R,aa)){var i=aH.getRGB(R);R=i.r;E=i.g;d=i.b}if(R>1||E>1||d>1){R/=255;E/=255;d/=255}return[R,E,d]},aS=function(R,E,d,S){R*=255;E*=255;d*=255;var i={r:R,g:E,b:d,hex:aH.rgb(R,E,d),toString:w};aH.is(S,"finite")&&(i.opacity=S);return i};aH.color=function(b){var d;if(aH.is(b,"object")&&"h" in b&&"s" in b&&"b" in b){d=aH.hsb2rgb(b);b.r=d.r;b.g=d.g;b.b=d.b;b.hex=d.hex}else{if(aH.is(b,"object")&&"h" in b&&"s" in b&&"l" in b){d=aH.hsl2rgb(b);b.r=d.r;b.g=d.g;b.b=d.b;b.hex=d.hex}else{if(aH.is(b,"string")){b=aH.getRGB(b)}if(aH.is(b,"object")&&"r" in b&&"g" in b&&"b" in b){d=aH.rgb2hsl(b);b.h=d.h;b.s=d.s;b.l=d.l;d=aH.rgb2hsb(b);b.v=d.b}else{b={hex:"none"};crl.r=b.g=b.b=b.h=b.s=b.v=b.l=-1}}}b.toString=w;return b};aH.hsb2rgb=function(S,bA,by,i){if(this.is(S,"object")&&"h" in S&&"s" in S&&"b" in S){by=S.b;bA=S.s;S=S.h;i=S.o}S*=360;var E,bz,d,g,b;S=(S%360)/60;b=by*bA;g=b*(1-am(S%2-1));E=bz=d=by-b;S=~~S;E+=[b,g,0,0,g,b][S];bz+=[g,b,b,g,0,0][S];d+=[0,0,g,b,b,g][S];return aS(E,bz,d,i)};aH.hsl2rgb=function(by,bA,E,i){if(this.is(by,"object")&&"h" in by&&"s" in by&&"l" in by){E=by.l;bA=by.s;by=by.h}if(by>1||bA>1||E>1){by/=360;bA/=100;E/=100}by*=360;var S,bz,d,g,b;by=(by%360)/60;b=2*bA*(E<0.5?E:1-E);g=b*(1-am(by%2-1));S=bz=d=E-b/2;by=~~by;S+=[b,g,0,0,g,b][by];bz+=[g,b,b,g,0,0][by];d+=[0,0,g,b,b,g][by];return aS(S,bz,d,i)};aH.rgb2hsb=function(bz,by,d){d=aO(bz,by,d);bz=d[0];by=d[1];d=d[2];var R,E,i,bA;i=m(bz,by,d);bA=i-ba(bz,by,d);R=(bA==0?null:i==bz?(by-d)/bA:i==by?(d-bz)/bA+2:(bz-by)/bA+4);R=((R+360)%6)*60/360;E=bA==0?0:bA/i;return{h:R,s:E,b:i,toString:ay}};aH.rgb2hsl=function(d,by,bB){bB=aO(d,by,bB);d=bB[0];by=bB[1];bB=bB[2];var bC,R,bA,bz,E,i;bz=m(d,by,bB);E=ba(d,by,bB);i=bz-E;bC=(i==0?null:bz==d?(by-bB)/i:bz==by?(bB-d)/i+2:(d-by)/i+4);bC=((bC+360)%6)*60/360;bA=(bz+E)/2;R=(i==0?0:bA<0.5?i/(2*bA):i/(2-2*bA));return{h:bC,s:R,l:bA,toString:J}};aH._path2string=function(){return this.join(",").replace(a6,"$1")};function a9(E,g){for(var b=0,d=E.length;b<d;b++){if(E[b]===g){return E.push(E.splice(b,1)[0])}}}function aw(i,d,b){function g(){var E=Array.prototype.slice.call(arguments,0),S=E.join("\u2400"),R=g.cache=g.cache||{},by=g.count=g.count||[];if(R[ab](S)){a9(by,S);return b?b(R[S]):R[S]}by.length>=1000&&delete R[by.shift()];by.push(S);R[S]=i[bt](d,E);return b?b(R[S]):R[S]}return g}var bi=aH._preload=function(g,d){var b=ap.doc.createElement("img");b.style.cssText="position:absolute;left:-9999em;top-9999em";b.onload=function(){d.call(this);this.onload=null;ap.doc.body.removeChild(this)};b.onerror=function(){ap.doc.body.removeChild(this)};ap.doc.body.appendChild(b);b.src=g};function ah(){return this.hex}aH.getRGB=aw(function(b){if(!b||!!((b=bu(b)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ah}}if(b=="none"){return{r:-1,g:-1,b:-1,hex:"none",toString:ah}}!(n[ab](b.toLowerCase().substring(0,2))||b.charAt()=="#")&&(b=a5(b));var E,d,g,S,i,bz,by,R=b.match(z);if(R){if(R[2]){S=O(R[2].substring(5),16);g=O(R[2].substring(3,5),16);d=O(R[2].substring(1,3),16)}if(R[3]){S=O((bz=R[3].charAt(3))+bz,16);g=O((bz=R[3].charAt(2))+bz,16);d=O((bz=R[3].charAt(1))+bz,16)}if(R[4]){by=R[4].split(a8);d=ae(by[0]);by[0].slice(-1)=="%"&&(d*=2.55);g=ae(by[1]);by[1].slice(-1)=="%"&&(g*=2.55);S=ae(by[2]);by[2].slice(-1)=="%"&&(S*=2.55);R[1].toLowerCase().slice(0,4)=="rgba"&&(i=ae(by[3]));by[3]&&by[3].slice(-1)=="%"&&(i/=100)}if(R[5]){by=R[5].split(a8);d=ae(by[0]);by[0].slice(-1)=="%"&&(d*=2.55);g=ae(by[1]);by[1].slice(-1)=="%"&&(g*=2.55);S=ae(by[2]);by[2].slice(-1)=="%"&&(S*=2.55);(by[0].slice(-3)=="deg"||by[0].slice(-1)=="\xb0")&&(d/=360);R[1].toLowerCase().slice(0,4)=="hsba"&&(i=ae(by[3]));by[3]&&by[3].slice(-1)=="%"&&(i/=100);return aH.hsb2rgb(d,g,S,i)}if(R[6]){by=R[6].split(a8);d=ae(by[0]);by[0].slice(-1)=="%"&&(d*=2.55);g=ae(by[1]);by[1].slice(-1)=="%"&&(g*=2.55);S=ae(by[2]);by[2].slice(-1)=="%"&&(S*=2.55);(by[0].slice(-3)=="deg"||by[0].slice(-1)=="\xb0")&&(d/=360);R[1].toLowerCase().slice(0,4)=="hsla"&&(i=ae(by[3]));by[3]&&by[3].slice(-1)=="%"&&(i/=100);return aH.hsl2rgb(d,g,S,i)}R={r:d,g:g,b:S,toString:ah};R.hex="#"+(16777216|S|(g<<8)|(d<<16)).toString(16).slice(1);aH.is(i,"finite")&&(R.opacity=i);return R}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ah}},aH);aH.hsb=aw(function(i,g,d){return aH.hsb2rgb(i,g,d).hex});aH.hsl=aw(function(g,d,b){return aH.hsl2rgb(g,d,b).hex});aH.rgb=aw(function(E,i,d){return"#"+(16777216|d|(i<<8)|(E<<16)).toString(16).slice(1)});aH.getColor=function(d){var g=this.getColor.start=this.getColor.start||{h:0,s:1,b:d||0.75},b=this.hsb2rgb(g.h,g.s,g.b);g.h+=0.075;if(g.h>1){g.h=0;g.s-=0.2;g.s<=0&&(this.getColor.start={h:0,s:1,b:g.b})}return b.hex};aH.getColor.reset=function(){delete this.start};function a1(E){var S=[];for(var g=0,b=E.length;b-2>g;g+=2){var R=[{x:+E[g],y:+E[g+1]},{x:+E[g],y:+E[g+1]},{x:+E[g+2],y:+E[g+3]},{x:+E[g+4],y:+E[g+5]}];if(b-4==g){R[0]={x:+E[g-2],y:+E[g-1]};R[3]=R[2]}else{if(g){R[0]={x:+E[g-2],y:+E[g-1]}}}S.push(["C",(-R[0].x+6*R[1].x+R[2].x)/6,(-R[0].y+6*R[1].y+R[2].y)/6,(R[1].x+6*R[2].x-R[3].x)/6,(R[1].y+6*R[2].y-R[3].y)/6,R[2].x,R[2].y])}return S}aH.parsePathString=aw(function(b){if(!b){return null}var g={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},d=[];if(aH.is(b,a3)&&aH.is(b[0],a3)){d=aP(b)}if(!d.length){bu(b).replace(aQ,function(E,i,by){var S=[],R=i.toLowerCase();by.replace(aF,function(bA,bz){bz&&S.push(+bz)});if(R=="m"&&S.length>2){d.push([i][br](S.splice(0,2)));R="l";i=i=="m"?"l":"L"}if(R=="r"){d.push([i][br](S))}else{while(S.length>=g[R]){d.push([i][br](S.splice(0,g[R])));if(!g[R]){break}}}})}d.toString=aH._path2string;return d});aH.parseTransformString=aw(function(d){if(!d){return null}var g={r:3,s:4,t:2,m:6},b=[];if(aH.is(d,a3)&&aH.is(d[0],a3)){b=aP(d)}if(!b.length){bu(d).replace(Z,function(E,i,by){var S=[],R=bx.call(i);by.replace(aF,function(bA,bz){bz&&S.push(+bz)});b.push([R][br](S))})}b.toString=aH._path2string;return b});aH.findDotsAtSegment=function(d,b,bP,bN,S,E,bA,by,bI){var bF=1-bI,bK=bd(bF,3),bL=bd(bF,2),bC=bI*bI,bz=bC*bI,bE=bK*d+bL*3*bI*bP+bF*3*bI*bI*S+bz*bA,bB=bK*b+bL*3*bI*bN+bF*3*bI*bI*E+bz*by,bJ=d+2*bI*(bP-d)+bC*(S-2*bP+d),bH=b+2*bI*(bN-b)+bC*(E-2*bN+b),bO=bP+2*bI*(S-bP)+bC*(bA-2*S+bP),bM=bN+2*bI*(E-bN)+bC*(by-2*E+bN),bG=bF*d+bI*bP,bD=bF*b+bI*bN,i=bF*S+bI*bA,g=bF*E+bI*by,R=(90-ak.atan2(bJ-bO,bH-bM)*180/aL);(bJ>bO||bH<bM)&&(R+=180);return{x:bE,y:bB,m:{x:bJ,y:bH},n:{x:bO,y:bM},start:{x:bG,y:bD},end:{x:i,y:g},alpha:R}};var ad=aw(function(bC){if(!bC){return{x:0,y:0,width:0,height:0}}bC=Q(bC);var bz=0,by=0,E=[],d=[],g;for(var R=0,bB=bC.length;R<bB;R++){g=bC[R];if(g[0]=="M"){bz=g[1];by=g[2];E.push(bz);d.push(by)}else{var S=a0(bz,by,g[1],g[2],g[3],g[4],g[5],g[6]);E=E[br](S.min.x,S.max.x);d=d[br](S.min.y,S.max.y);bz=g[5];by=g[6]}}var b=ba[bt](0,E),bA=ba[bt](0,d);return{x:b,y:bA,width:m[bt](0,E)-b,height:m[bt](0,d)-bA}},null,function(b){return{x:b.x,y:b.y,width:b.width,height:b.height}}),aP=function(S){var g=[];if(!aH.is(S,a3)||!aH.is(S&&S[0],a3)){S=aH.parsePathString(S)}for(var d=0,E=S.length;d<E;d++){g[d]=[];for(var b=0,R=S[d].length;b<R;b++){g[d][b]=S[d][b]}}g.toString=aH._path2string;return g},ar=aH._pathToRelative=aw(function(E){if(!aH.is(E,a3)||!aH.is(E&&E[0],a3)){E=aH.parsePathString(E)}var bB=[],bD=0,bC=0,bG=0,bF=0,g=0;if(E[0][0]=="M"){bD=E[0][1];bC=E[0][2];bG=bD;bF=bC;g++;bB.push(["M",bD,bC])}for(var by=g,bH=E.length;by<bH;by++){var b=bB[by]=[],bE=E[by];if(bE[0]!=bx.call(bE[0])){b[0]=bx.call(bE[0]);switch(b[0]){case"a":b[1]=bE[1];b[2]=bE[2];b[3]=bE[3];b[4]=bE[4];b[5]=bE[5];b[6]=+(bE[6]-bD).toFixed(3);b[7]=+(bE[7]-bC).toFixed(3);break;case"v":b[1]=+(bE[1]-bC).toFixed(3);break;case"m":bG=bE[1];bF=bE[2];default:for(var S=1,bz=bE.length;S<bz;S++){b[S]=+(bE[S]-((S%2)?bD:bC)).toFixed(3)}}}else{b=bB[by]=[];if(bE[0]=="m"){bG=bE[1]+bD;bF=bE[2]+bC}for(var R=0,d=bE.length;R<d;R++){bB[by][R]=bE[R]}}var bA=bB[by].length;switch(bB[by][0]){case"z":bD=bG;bC=bF;break;case"h":bD+=+bB[by][bA-1];break;case"v":bC+=+bB[by][bA-1];break;default:bD+=+bB[by][bA-2];bC+=+bB[by][bA-1]}}bB.toString=aH._path2string;return bB},0,aP),u=aH._pathToAbsolute=aw(function(E){if(!aH.is(E,a3)||!aH.is(E&&E[0],a3)){E=aH.parsePathString(E)}if(!E||!E.length){return[["M",0,0]]}var bA=[],bD=0,bC=0,bG=0,bF=0,g=0;if(E[0][0]=="M"){bD=+E[0][1];bC=+E[0][2];bG=bD;bF=bC;g++;bA[0]=["M",bD,bC]}for(var b,bE,by=g,bH=E.length;by<bH;by++){bA.push(b=[]);bE=E[by];if(bE[0]!=bh.call(bE[0])){b[0]=bh.call(bE[0]);switch(b[0]){case"A":b[1]=bE[1];b[2]=bE[2];b[3]=bE[3];b[4]=bE[4];b[5]=bE[5];b[6]=+(bE[6]+bD);b[7]=+(bE[7]+bC);break;case"V":b[1]=+bE[1]+bC;break;case"H":b[1]=+bE[1]+bD;break;case"R":var bB=[bD,bC][br](bE.slice(1));for(var S=2,bz=bB.length;S<bz;S++){bB[S]=+bB[S]+bD;bB[++S]=+bB[S]+bC}bA.pop();bA=bA[br](a1(bB));break;case"M":bG=+bE[1]+bD;bF=+bE[2]+bC;default:for(S=1,bz=bE.length;S<bz;S++){b[S]=+bE[S]+((S%2)?bD:bC)}}}else{if(bE[0]=="R"){bB=[bD,bC][br](bE.slice(1));bA.pop();bA=bA[br](a1(bB));b=["R"][br](bE.slice(-2))}else{for(var R=0,d=bE.length;R<d;R++){b[R]=bE[R]}}}switch(b[0]){case"Z":bD=bG;bC=bF;break;case"H":bD=b[1];break;case"V":bC=b[1];break;case"M":bG=b[b.length-2];bF=b[b.length-1];default:bD=b[b.length-2];bC=b[b.length-1]}}bA.toString=aH._path2string;return bA},null,aP),bv=function(d,i,b,g){return[d,i,b,g,b,g]},bb=function(d,i,S,E,b,g){var R=1/3,by=2/3;return[R*d+by*S,R*i+by*E,R*b+by*S,R*g+by*E,b,g]},W=function(bF,ca,bO,bM,bG,bA,E,bE,b9,bH){var bL=aL*120/180,b=aL/180*(+bG||0),bS=[],bP,b6=aw(function(cb,ce,i){var cd=cb*ak.cos(i)-ce*ak.sin(i),cc=cb*ak.sin(i)+ce*ak.cos(i);return{x:cd,y:cc}});if(!bH){bP=b6(bF,ca,-b);bF=bP.x;ca=bP.y;bP=b6(bE,b9,-b);bE=bP.x;b9=bP.y;var d=ak.cos(aL/180*bG),bC=ak.sin(aL/180*bG),bU=(bF-bE)/2,bT=(ca-b9)/2;var b4=(bU*bU)/(bO*bO)+(bT*bT)/(bM*bM);if(b4>1){b4=ak.sqrt(b4);bO=b4*bO;bM=b4*bM}var g=bO*bO,bX=bM*bM,bZ=(bA==E?-1:1)*ak.sqrt(am((g*bX-g*bT*bT-bX*bU*bU)/(g*bT*bT+bX*bU*bU))),bJ=bZ*bO*bT/bM+(bF+bE)/2,bI=bZ*-bM*bU/bO+(ca+b9)/2,bz=ak.asin(((ca-bI)/bM).toFixed(9)),by=ak.asin(((b9-bI)/bM).toFixed(9));bz=bF<bJ?aL-bz:bz;by=bE<bJ?aL-by:by;bz<0&&(bz=aL*2+bz);by<0&&(by=aL*2+by);if(E&&bz>by){bz=bz-aL*2}if(!E&&by>bz){by=by-aL*2}}else{bz=bH[0];by=bH[1];bJ=bH[2];bI=bH[3]}var bD=by-bz;if(am(bD)>bL){var bK=by,bN=bE,bB=b9;by=bz+bL*(E&&by>bz?1:-1);bE=bJ+bO*ak.cos(by);b9=bI+bM*ak.sin(by);bS=W(bE,b9,bO,bM,bG,0,E,bN,bB,[by,bK,bJ,bI])}bD=by-bz;var S=ak.cos(bz),b8=ak.sin(bz),R=ak.cos(by),b7=ak.sin(by),bV=ak.tan(bD/4),bY=4/3*bO*bV,bW=4/3*bM*bV,b5=[bF,ca],b3=[bF+bY*b8,ca-bW*S],b2=[bE+bY*b7,b9-bW*R],b0=[bE,b9];b3[0]=2*b5[0]-b3[0];b3[1]=2*b5[1]-b3[1];if(bH){return[b3,b2,b0][br](bS)}else{bS=[b3,b2,b0][br](bS).join().split(",");var bQ=[];for(var b1=0,bR=bS.length;b1<bR;b1++){bQ[b1]=b1%2?b6(bS[b1-1],bS[b1],b).y:b6(bS[b1],bS[b1+1],b).x}return bQ}},X=function(d,b,i,g,bz,by,S,R,bA){var E=1-bA;return{x:bd(E,3)*d+bd(E,2)*3*bA*i+E*3*bA*bA*bz+bd(bA,3)*S,y:bd(E,3)*b+bd(E,2)*3*bA*g+E*3*bA*bA*by+bd(bA,3)*R}},a0=aw(function(i,d,R,E,bH,bG,bD,bA){var bF=(bH-2*R+i)-(bD-2*bH+R),bC=2*(R-i)-2*(bH-R),bz=i-R,by=(-bC+ak.sqrt(bC*bC-4*bF*bz))/2/bF,S=(-bC-ak.sqrt(bC*bC-4*bF*bz))/2/bF,bB=[d,bA],bE=[i,bD],g;am(by)>"1e12"&&(by=0.5);am(S)>"1e12"&&(S=0.5);if(by>0&&by<1){g=X(i,d,R,E,bH,bG,bD,bA,by);bE.push(g.x);bB.push(g.y)}if(S>0&&S<1){g=X(i,d,R,E,bH,bG,bD,bA,S);bE.push(g.x);bB.push(g.y)}bF=(bG-2*E+d)-(bA-2*bG+E);bC=2*(E-d)-2*(bG-E);bz=d-E;by=(-bC+ak.sqrt(bC*bC-4*bF*bz))/2/bF;S=(-bC-ak.sqrt(bC*bC-4*bF*bz))/2/bF;am(by)>"1e12"&&(by=0.5);am(S)>"1e12"&&(S=0.5);if(by>0&&by<1){g=X(i,d,R,E,bH,bG,bD,bA,by);bE.push(g.x);bB.push(g.y)}if(S>0&&S<1){g=X(i,d,R,E,bH,bG,bD,bA,S);bE.push(g.x);bB.push(g.y)}return{min:{x:ba[bt](0,bE),y:ba[bt](0,bB)},max:{x:m[bt](0,bE),y:m[bt](0,bB)}}}),Q=aH._path2curve=aw(function(bG,bB){var E=u(bG),bC=bB&&u(bB),bD={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},b={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},S=function(bH,bI){var i,bJ;if(!bH){return["C",bI.x,bI.y,bI.x,bI.y,bI.x,bI.y]}!(bH[0] in {T:1,Q:1})&&(bI.qx=bI.qy=null);switch(bH[0]){case"M":bI.X=bH[1];bI.Y=bH[2];break;case"A":bH=["C"][br](W[bt](0,[bI.x,bI.y][br](bH.slice(1))));break;case"S":i=bI.x+(bI.x-(bI.bx||bI.x));bJ=bI.y+(bI.y-(bI.by||bI.y));bH=["C",i,bJ][br](bH.slice(1));break;case"T":bI.qx=bI.x+(bI.x-(bI.qx||bI.x));bI.qy=bI.y+(bI.y-(bI.qy||bI.y));bH=["C"][br](bb(bI.x,bI.y,bI.qx,bI.qy,bH[1],bH[2]));break;case"Q":bI.qx=bH[1];bI.qy=bH[2];bH=["C"][br](bb(bI.x,bI.y,bH[1],bH[2],bH[3],bH[4]));break;case"L":bH=["C"][br](bv(bI.x,bI.y,bH[1],bH[2]));break;case"H":bH=["C"][br](bv(bI.x,bI.y,bH[1],bI.y));break;case"V":bH=["C"][br](bv(bI.x,bI.y,bI.x,bH[1]));break;case"Z":bH=["C"][br](bv(bI.x,bI.y,bI.X,bI.Y));break}return bH},d=function(bH,bI){if(bH[bI].length>7){bH[bI].shift();var bJ=bH[bI];while(bJ.length){bH.splice(bI++,0,["C"][br](bJ.splice(0,6)))}bH.splice(bI,1);bE=m(E.length,bC&&bC.length||0)}},g=function(bL,bK,bI,bH,bJ){if(bL&&bK&&bL[bJ][0]=="M"&&bK[bJ][0]!="M"){bK.splice(bJ,0,["M",bH.x,bH.y]);bI.bx=0;bI.by=0;bI.x=bL[bJ][1];bI.y=bL[bJ][2];bE=m(E.length,bC&&bC.length||0)}};for(var bz=0,bE=m(E.length,bC&&bC.length||0);bz<bE;bz++){E[bz]=S(E[bz],bD);d(E,bz);bC&&(bC[bz]=S(bC[bz],b));bC&&d(bC,bz);g(E,bC,bD,b,bz);g(bC,E,b,bD,bz);var by=E[bz],bF=bC&&bC[bz],R=by.length,bA=bC&&bF.length;bD.x=by[R-2];bD.y=by[R-1];bD.bx=ae(by[R-4])||bD.x;bD.by=ae(by[R-3])||bD.y;b.bx=bC&&(ae(bF[bA-4])||b.x);b.by=bC&&(ae(bF[bA-3])||b.y);b.x=bC&&bF[bA-2];b.y=bC&&bF[bA-1]}return bC?[E,bC]:E},null,aP),t=aH._parseDots=aw(function(bB){var bA=[];for(var S=0,bC=bB.length;S<bC;S++){var b={},bz=bB[S].match(/^([^:]*):?([\d\.]*)/);b.color=aH.getRGB(bz[1]);if(b.color.error){return null}b.color=b.color.hex;bz[2]&&(b.offset=bz[2]+"%");bA.push(b)}for(S=1,bC=bA.length-1;S<bC;S++){if(!bA[S].offset){var g=ae(bA[S-1].offset||0),E=0;for(var R=S+1;R<bC;R++){if(bA[R].offset){E=bA[R].offset;break}}if(!E){E=100;R=bC}E=ae(E);var by=(E-g)/(R-S+1);for(;S<R;S++){g+=by;bA[S].offset=g+"%"}}}return bA}),aA=aH._tear=function(b,d){b==d.top&&(d.top=b.prev);b==d.bottom&&(d.bottom=b.next);b.next&&(b.next.prev=b.prev);b.prev&&(b.prev.next=b.next)},ag=aH._tofront=function(b,d){if(d.top===b){return}aA(b,d);b.next=null;b.prev=d.top;d.top.next=b;d.top=b},p=aH._toback=function(b,d){if(d.bottom===b){return}aA(b,d);b.next=d.bottom;b.prev=null;d.bottom.prev=b;d.bottom=b},C=aH._insertafter=function(d,b,g){aA(d,g);b==g.top&&(g.top=d);b.next&&(b.next.prev=d);d.next=b.next;d.prev=b;b.next=d},aJ=aH._insertbefore=function(d,b,g){aA(d,g);b==g.bottom&&(g.bottom=d);b.prev&&(b.prev.next=d);d.prev=b.prev;b.prev=d;d.next=b},v=function(b){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+b+"\u201d of removed object")}},aE=aH._extractTransform=function(d,by){if(by==null){return d._.transform}by=bu(by).replace(/\.{3}|\u2026/g,d._.transform||aN);var R=aH.parseTransformString(by),b=0,bG=0,bF=0,bB=1,bA=1,bC=d._,g=new av;bC.transform=R||[];if(R){for(var S=0,bD=R.length;S<bD;S++){var bE=R[S],E=bE.length,bz;bE[0]=bu(bE[0]).toLowerCase();if(bE[0]=="t"&&E==3){g.translate(bE[1],bE[2])}else{if(bE[0]=="r"){if(E==2){bz=bz||d.getBBox(1);g.rotate(bE[1],bz.x+bz.width/2,bz.y+bz.height/2);b+=bE[1]}else{if(E==4){g.rotate(bE[1],bE[2],bE[3]);b+=bE[1]}}}else{if(bE[0]=="s"){if(E==2||E==3){bz=bz||d.getBBox(1);g.scale(bE[1],bE[E-1],bz.x+bz.width/2,bz.y+bz.height/2);bB*=bE[1];bA*=bE[E-1]}else{if(E==5){g.scale(bE[1],bE[2],bE[3],bE[4]);bB*=bE[1];bA*=bE[2]}}}else{if(bE[0]=="m"&&E==7){g.add(bE[1],bE[2],bE[3],bE[4],bE[5],bE[6])}}}}bC.dirtyT=1;d.matrix=g}}d.matrix=g;bC.sx=bB;bC.sy=bA;bC.deg=b;bC.dx=bG=g.e;bC.dy=bF=g.f;if(bB==1&&bA==1&&!b&&bC.bbox){bC.bbox.x+=+bG;bC.bbox.y+=+bF}else{bC.dirtyT=1}},l=function(b){switch(b[0]){case"t":return["t",0,0];case"m":return["m",1,0,0,1,0,0];case"r":if(b.length==4){return["r",0,b[2],b[3]]}else{return["r",0]}case"s":if(b.length==5){return["s",1,1,b[3],b[4]]}else{if(b.length==3){return["s",1,1]}else{return["s",1]}}}},aq=aH._equaliseTransform=function(R,E){E=bu(E).replace(/\.{3}|\u2026/g,R);R=aH.parseTransformString(R)||[];E=aH.parseTransformString(E)||[];var b=m(R.length,E.length),bA=[],bB=[],g=0,d,S,bz,by;for(;g<b;g++){bz=R[g]||l(E[g]);by=E[g]||l(bz);if((bz[0]!=by[0])||(bz[0]=="r"&&(bz[2]!=by[2]||bz[3]!=by[3]))||(bz[0]=="s"&&(bz[3]!=by[3]||bz[4]!=by[4]))){return}bA[g]=[];bB[g]=[];for(d=0,S=m(bz.length,by.length);d<S;d++){d in bz&&(bA[g][d]=bz[d]);d in by&&(bB[g][d]=by[d])}}return{from:bA,to:bB}};aH._getContainer=function(b,E,g,i){var d;d=i==null&&!aH.is(b,"object")?ap.doc.getElementById(b):b;if(d==null){return}if(d.tagName){if(E==null){return{container:d,width:d.style.pixelWidth||d.offsetWidth,height:d.style.pixelHeight||d.offsetHeight}}else{return{container:d,width:E,height:g}}}return{container:1,x:b,y:E,width:g,height:i}};aH.pathToRelative=ar;aH._engine={};aH.path2curve=Q;aH.matrix=function(i,g,by,S,R,E){return new av(i,g,by,S,R,E)};function av(i,g,by,S,R,E){if(i!=null){this.a=+i;this.b=+g;this.c=+by;this.d=+S;this.e=+R;this.f=+E}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0}}(function(g){g.add=function(bG,bD,bB,bz,S,R){var E=[[],[],[]],i=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],bF=[[bG,bB,S],[bD,bz,R],[0,0,1]],bE,bC,bA,by;if(bG&&bG instanceof av){bF=[[bG.a,bG.c,bG.e],[bG.b,bG.d,bG.f],[0,0,1]]}for(bE=0;bE<3;bE++){for(bC=0;bC<3;bC++){by=0;for(bA=0;bA<3;bA++){by+=i[bE][bA]*bF[bA][bC]}E[bE][bC]=by}}this.a=E[0][0];this.b=E[1][0];this.c=E[0][1];this.d=E[1][1];this.e=E[0][2];this.f=E[1][2]};g.invert=function(){var E=this,i=E.a*E.d-E.b*E.c;return new av(E.d/i,-E.b/i,-E.c/i,E.a/i,(E.c*E.f-E.d*E.e)/i,(E.b*E.e-E.a*E.f)/i)};g.clone=function(){return new av(this.a,this.b,this.c,this.d,this.e,this.f)};g.translate=function(i,E){this.add(1,0,0,1,i,E)};g.scale=function(E,S,i,R){S==null&&(S=E);(i||R)&&this.add(1,0,0,1,i,R);this.add(E,0,0,S,0,0);(i||R)&&this.add(1,0,0,1,-i,-R)};g.rotate=function(E,i,by){E=aH.rad(E);i=i||0;by=by||0;var S=+ak.cos(E).toFixed(9),R=+ak.sin(E).toFixed(9);this.add(S,R,-R,S,i,by);this.add(1,0,0,1,-i,-by)};g.x=function(i,E){return i*this.a+E*this.c+this.e};g.y=function(i,E){return i*this.b+E*this.d+this.f};g.get=function(E){return +this[bu.fromCharCode(97+E)].toFixed(4)};g.toString=function(){return aH.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};g.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};g.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};function d(i){return i[0]*i[0]+i[1]*i[1]}function b(i){var E=ak.sqrt(d(i));i[0]&&(i[0]/=E);i[1]&&(i[1]/=E)}g.split=function(){var E={};E.dx=this.e;E.dy=this.f;var S=[[this.a,this.c],[this.b,this.d]];E.scalex=ak.sqrt(d(S[0]));b(S[0]);E.shear=S[0][0]*S[1][0]+S[0][1]*S[1][1];S[1]=[S[1][0]-S[0][0]*E.shear,S[1][1]-S[0][1]*E.shear];E.scaley=ak.sqrt(d(S[1]));b(S[1]);E.shear/=E.scaley;var i=-S[0][1],R=S[1][1];if(R<0){E.rotate=aH.deg(ak.acos(R));if(i<0){E.rotate=360-E.rotate}}else{E.rotate=aH.deg(ak.asin(i))}E.isSimple=!+E.shear.toFixed(9)&&(E.scalex.toFixed(9)==E.scaley.toFixed(9)||!E.rotate);E.isSuperSimple=!+E.shear.toFixed(9)&&E.scalex.toFixed(9)==E.scaley.toFixed(9)&&!E.rotate;E.noRotation=!+E.shear.toFixed(9)&&!E.rotate;return E};g.toTransformString=function(){var i=this.split();if(i.isSimple){return"t"+[i.dx,i.dy]+"s"+[i.scalex,i.scaley,0,0]+"r"+[i.rotate,0,0]}else{return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}})(av.prototype);var P=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);if((navigator.vendor=="Apple Computer, Inc.")&&(P&&P[1]<4||navigator.platform.slice(0,2)=="iP")||(navigator.vendor=="Google Inc."&&P&&P[1]<8)){aU.safari=function(){var b=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){b.remove()})}}else{aU.safari=F}var M=function(){this.returnValue=false},bq=function(){return this.originalEvent.preventDefault()},aY=function(){this.cancelBubble=true},az=function(){return this.originalEvent.stopPropagation()},at=(function(){if(ap.doc.addEventListener){return function(R,i,g,d){var b=T&&bk[i]?bk[i]:i,E=function(bC){var bB=ap.doc.documentElement.scrollTop||ap.doc.body.scrollTop,bD=ap.doc.documentElement.scrollLeft||ap.doc.body.scrollLeft,S=bC.clientX+bD,bE=bC.clientY+bB;if(T&&bk[ab](i)){for(var bz=0,bA=bC.targetTouches&&bC.targetTouches.length;bz<bA;bz++){if(bC.targetTouches[bz].target==R){var by=bC;bC=bC.targetTouches[bz];bC.originalEvent=by;bC.preventDefault=bq;bC.stopPropagation=az;break}}}return g.call(d,bC,S,bE)};R.addEventListener(b,E,false);return function(){R.removeEventListener(b,E,false);return true}}}else{if(ap.doc.attachEvent){return function(R,i,g,d){var E=function(bz){bz=bz||ap.win.event;var by=ap.doc.documentElement.scrollTop||ap.doc.body.scrollTop,bA=ap.doc.documentElement.scrollLeft||ap.doc.body.scrollLeft,S=bz.clientX+bA,bB=bz.clientY+by;bz.preventDefault=bz.preventDefault||M;bz.stopPropagation=bz.stopPropagation||aY;return g.call(d,bz,S,bB)};R.attachEvent("on"+i,E);var b=function(){R.detachEvent("on"+i,E);return true};return b}}}})(),a4=[],bl=function(bz){var bC=bz.clientX,bB=bz.clientY,bE=ap.doc.documentElement.scrollTop||ap.doc.body.scrollTop,bF=ap.doc.documentElement.scrollLeft||ap.doc.body.scrollLeft,g,E=a4.length;while(E--){g=a4[E];if(T){var S=bz.touches.length,R;while(S--){R=bz.touches[S];if(R.identifier==g.el._drag.id){bC=R.clientX;bB=R.clientY;(bz.originalEvent?bz.originalEvent:bz).preventDefault();break}}}else{bz.preventDefault()}var d=g.el.node,b,by=d.nextSibling,bD=d.parentNode,bA=d.style.display;ap.win.opera&&bD.removeChild(d);d.style.display="none";b=g.el.paper.getElementByPoint(bC,bB);d.style.display=bA;ap.win.opera&&(by?bD.insertBefore(d,by):bD.appendChild(d));b&&eve("drag.over."+g.el.id,g.el,b);bC+=bF;bB+=bE;eve("drag.move."+g.el.id,g.move_scope||g.el,bC-g.el._drag.x,bB-g.el._drag.y,bC,bB,bz)}},e=function(g){aH.unmousemove(bl).unmouseup(e);var d=a4.length,b;while(d--){b=a4[d];b.el._drag={};eve("drag.end."+b.el.id,b.end_scope||b.start_scope||b.move_scope||b.el,g)}a4=[]},a7=aH.el={};for(var an=N.length;an--;){(function(b){aH[b]=a7[b]=function(g,d){if(aH.is(g,"function")){this.events=this.events||[];this.events.push({name:b,f:g,unbind:at(this.shape||this.node||ap.doc,b,g,d||this)})}return this};aH["un"+b]=a7["un"+b]=function(i){var g=this.events,d=g.length;while(d--){if(g[d].name==b&&g[d].f==i){g[d].unbind();g.splice(d,1);!g.length&&delete this.events;return this}}return this}})(N[an])}a7.data=function(d,E){var g=aK[this.id]=aK[this.id]||{};if(arguments.length==1){if(aH.is(d,"object")){for(var b in d){if(d[ab](b)){this.data(b,d[b])}}return this}eve("data.get."+this.id,this,g[d],d);return g[d]}g[d]=E;eve("data.set."+this.id,this,E,d);return this};a7.removeData=function(b){if(b==null){aK[this.id]={}}else{aK[this.id]&&delete aK[this.id][b]}return this};a7.hover=function(i,b,g,d){return this.mouseover(i,g).mouseout(b,d||g)};a7.unhover=function(d,b){return this.unmouseover(d).unmouseout(b)};a7.drag=function(d,R,E,b,g,i){function S(bz){(bz.originalEvent||bz).preventDefault();var by=ap.doc.documentElement.scrollTop||ap.doc.body.scrollTop,bA=ap.doc.documentElement.scrollLeft||ap.doc.body.scrollLeft;this._drag.x=bz.clientX+bA;this._drag.y=bz.clientY+by;this._drag.id=bz.identifier;!a4.length&&aH.mousemove(bl).mouseup(e);a4.push({el:this,move_scope:b,start_scope:g,end_scope:i});R&&eve.on("drag.start."+this.id,R);d&&eve.on("drag.move."+this.id,d);E&&eve.on("drag.end."+this.id,E);eve("drag.start."+this.id,g||b||this,bz.clientX+bA,bz.clientY+by,bz)}this._drag={};this.mousedown(S);return this};a7.onDragOver=function(b){b?eve.on("drag.over."+this.id,b):eve.unbind("drag.over."+this.id)};a7.undrag=function(){var b=a4.length;while(b--){if(a4[b].el==this){aH.unmousedown(a4[b].start);a4.splice(b++,1);eve.unbind("drag.*."+this.id)}}!a4.length&&aH.unmousemove(bl).unmouseup(e)};aU.circle=function(b,i,g){var d=aH._engine.circle(this,b||0,i||0,g||0);this.__set__&&this.__set__.push(d);return d};aU.rect=function(b,R,d,i,E){var g=aH._engine.rect(this,b||0,R||0,d||0,i||0,E||0);this.__set__&&this.__set__.push(g);return g};aU.ellipse=function(b,E,i,g){var d=aH._engine.ellipse(this,b||0,E||0,i||0,g||0);this.__set__&&this.__set__.push(d);return d};aU.path=function(b){b&&!aH.is(b,aa)&&!aH.is(b[0],a3)&&(b+=aN);var d=aH._engine.path(aH.format[bt](aH,arguments),this);this.__set__&&this.__set__.push(d);return d};aU.image=function(E,b,R,d,i){var g=aH._engine.image(this,E||"about:blank",b||0,R||0,d||0,i||0);this.__set__&&this.__set__.push(g);return g};aU.text=function(b,i,g){var d=aH._engine.text(this,b||0,i||0,bu(g));this.__set__&&this.__set__.push(d);return d};aU.set=function(d){!aH.is(d,"array")&&(d=Array.prototype.splice.call(arguments,0,arguments.length));var b=new ac(d);this.__set__&&this.__set__.push(b);return b};aU.setStart=function(b){this.__set__=b||this.set()};aU.setFinish=function(d){var b=this.__set__;delete this.__set__;return b};aU.setSize=function(d,b){return aH._engine.setSize.call(this,d,b)};aU.setViewBox=function(b,E,d,i,g){return aH._engine.setViewBox.call(this,b,E,d,i,g)};aU.top=aU.bottom=null;aU.raphael=aH;var bg=function(g){var E=g.getBoundingClientRect(),bz=g.ownerDocument,R=bz.body,b=bz.documentElement,i=b.clientTop||R.clientTop||0,S=b.clientLeft||R.clientLeft||0,by=E.top+(ap.win.pageYOffset||b.scrollTop||R.scrollTop)-i,d=E.left+(ap.win.pageXOffset||b.scrollLeft||R.scrollLeft)-S;return{y:by,x:d}};aU.getElementByPoint=function(d,by){var S=this,g=S.canvas,R=ap.doc.elementFromPoint(d,by);if(ap.win.opera&&R.tagName=="svg"){var E=bg(g),i=g.createSVGRect();i.x=d-E.x;i.y=by-E.y;i.width=i.height=1;var b=g.getIntersectionList(i,null);if(b.length){R=b[b.length-1]}}if(!R){return null}while(R.parentNode&&R!=g.parentNode&&!R.raphael){R=R.parentNode}R==S.canvas.parentNode&&(R=g);R=R&&R.raphael?S.getById(R.raphaelid):null;return R};aU.getById=function(d){var b=this.bottom;while(b){if(b.id==d){return b}b=b.next}return null};aU.forEach=function(g,b){var d=this.bottom;while(d){if(g.call(b,d)===false){return this}d=d.next}return this};function x(){return this.x+aG+this.y}function aj(){return this.x+aG+this.y+aG+this.width+" \xd7 "+this.height}a7.getBBox=function(d){if(this.removed){return{}}var b=this._;if(d){if(b.dirty||!b.bboxwt){this.realPath=K[this.type](this);b.bboxwt=ad(this.realPath);b.bboxwt.toString=aj;b.dirty=0}return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath){b.bboxwt=0;this.realPath=K[this.type](this)}b.bbox=ad(I(this.realPath,this.matrix));b.bbox.toString=aj;b.dirty=b.dirtyT=0}return b.bbox};a7.clone=function(){if(this.removed){return null}return this.paper[this.type]().attr(this.attr())};a7.glow=function(by){if(this.type=="text"){return null}by=by||{};var g={width:(by.width||10)+(+this.attr("stroke-width")||1),fill:by.fill||false,opacity:by.opacity||0.5,offsetx:by.offsetx||0,offsety:by.offsety||0,color:by.color||"#000"},S=g.width/2,E=this.paper,b=E.set(),R=this.realPath||K[this.type](this);R=this.matrix?I(R,this.matrix):R;for(var d=1;d<S+1;d++){b.push(E.path(R).attr({stroke:g.color,fill:g.fill?g.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(g.width/S*d).toFixed(3),opacity:+(g.opacity/S).toFixed(3)}))}return b.insertBefore(this).translate(g.offsetx,g.offsety)};var aX={},k=function(R,d,bA,bz,bI,bH,bG,bE,S){var bD=0,bC=100,E=[R,d,bA,bz,bI,bH,bG,bE].join(),b=aX[E],by,g;!b&&(aX[E]=b={data:[]});b.timer&&clearTimeout(b.timer);b.timer=setTimeout(function(){delete aX[E]},2000);if(S!=null&&!b.precision){var bF=k(R,d,bA,bz,bI,bH,bG,bE);b.precision=~~bF*10;b.data=[]}bC=b.precision||bC;for(var bB=0;bB<bC+1;bB++){if(b.data[bB*bC]){g=b.data[bB*bC]}else{g=aH.findDotsAtSegment(R,d,bA,bz,bI,bH,bG,bE,bB/bC);b.data[bB*bC]=g}bB&&(bD+=bd(bd(by.x-g.x,2)+bd(by.y-g.y,2),0.5));if(S!=null&&bD>=S){return g}by=g}if(S==null){return bD}},aW=function(b,d){return function(bG,R,S){bG=Q(bG);var bC,bB,g,by,E="",bF={},bD,bA=0;for(var bz=0,bE=bG.length;bz<bE;bz++){g=bG[bz];if(g[0]=="M"){bC=+g[1];bB=+g[2]}else{by=k(bC,bB,g[1],g[2],g[3],g[4],g[5],g[6]);if(bA+by>R){if(d&&!bF.start){bD=k(bC,bB,g[1],g[2],g[3],g[4],g[5],g[6],R-bA);E+=["C"+bD.start.x,bD.start.y,bD.m.x,bD.m.y,bD.x,bD.y];if(S){return E}bF.start=E;E=["M"+bD.x,bD.y+"C"+bD.n.x,bD.n.y,bD.end.x,bD.end.y,g[5],g[6]].join();bA+=by;bC=+g[5];bB=+g[6];continue}if(!b&&!d){bD=k(bC,bB,g[1],g[2],g[3],g[4],g[5],g[6],R-bA);return{x:bD.x,y:bD.y,alpha:bD.alpha}}}bA+=by;bC=+g[5];bB=+g[6]}E+=g.shift()+g}bF.end=E;bD=b?bA:d?bF:aH.findDotsAtSegment(bC,bB,g[0],g[1],g[2],g[3],g[4],g[5],1);bD.alpha&&(bD={x:bD.x,y:bD.y,alpha:bD.alpha});return bD}};var aI=aW(1),G=aW(),V=aW(0,1);aH.getTotalLength=aI;aH.getPointAtLength=G;aH.getSubpath=function(d,i,g){if(this.getTotalLength(d)-g<0.000001){return V(d,i).end}var b=V(d,g,1);return i?V(b,i).end:b};a7.getTotalLength=function(){if(this.type!="path"){return}if(this.node.getTotalLength){return this.node.getTotalLength()}return aI(this.attrs.path)};a7.getPointAtLength=function(b){if(this.type!="path"){return}return G(this.attrs.path,b)};a7.getSubpath=function(d,b){if(this.type!="path"){return}return aH.getSubpath(this.attrs.path,d,b)};var o=aH.easing_formulas={linear:function(b){return b},"<":function(b){return bd(b,1.7)},">":function(b){return bd(b,0.48)},"<>":function(by){var i=0.48-by/1.04,g=ak.sqrt(0.1734+i*i),b=g-i,S=bd(am(b),1/3)*(b<0?-1:1),R=-g-i,E=bd(am(R),1/3)*(R<0?-1:1),d=S+E+0.5;return(1-d)*3*d*d+d*d*d},backIn:function(d){var b=1.70158;return d*d*((b+1)*d-b)},backOut:function(d){d=d-1;var b=1.70158;return d*d*((b+1)*d+b)+1},elastic:function(b){if(b==!!b){return b}return bd(2,-10*b)*ak.sin((b-0.075)*(2*aL)/0.3)+1},bounce:function(i){var d=7.5625,g=2.75,b;if(i<(1/g)){b=d*i*i}else{if(i<(2/g)){i-=(1.5/g);b=d*i*i+0.75}else{if(i<(2.5/g)){i-=(2.25/g);b=d*i*i+0.9375}else{i-=(2.625/g);b=d*i*i+0.984375}}}return b}};o.easeIn=o["ease-in"]=o["<"];o.easeOut=o["ease-out"]=o[">"];o.easeInOut=o["ease-in-out"]=o["<>"];o["back-in"]=o.backIn;o["back-out"]=o.backOut;var U=[],aD=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(b,16)},bp=function(){var by=+new Date,bG=0;for(;bG<U.length;bG++){var bL=U[bG];if(bL.el.removed||bL.paused){continue}var E=by-bL.start,bE=bL.ms,bD=bL.easing,bH=bL.from,bB=bL.diff,d=bL.to,bA=bL.t,S=bL.el,bC={},b;if(bL.initstatus){E=(bL.initstatus*bL.anim.top-bL.prev)/(bL.percent-bL.prev)*bE;bL.status=bL.initstatus;delete bL.initstatus;bL.stop&&U.splice(bG--,1)}else{bL.status=(bL.prev+(bL.percent-bL.prev)*(E/bE))/bL.anim.top}if(E<0){continue}if(E<bE){var g=bD(E/bE);for(var bF in bH){if(bH[ab](bF)){switch(ai[bF]){case aB:b=+bH[bF]+g*bE*bB[bF];break;case"colour":b="rgb("+[D(Y(bH[bF].r+g*bE*bB[bF].r)),D(Y(bH[bF].g+g*bE*bB[bF].g)),D(Y(bH[bF].b+g*bE*bB[bF].b))].join(",")+")";break;case"path":b=[];for(var bJ=0,bz=bH[bF].length;bJ<bz;bJ++){b[bJ]=[bH[bF][bJ][0]];for(var bI=1,bK=bH[bF][bJ].length;bI<bK;bI++){b[bJ][bI]=+bH[bF][bJ][bI]+g*bE*bB[bF][bJ][bI]}b[bJ]=b[bJ].join(aG)}b=b.join(aG);break;case"transform":if(bB[bF].real){b=[];for(bJ=0,bz=bH[bF].length;bJ<bz;bJ++){b[bJ]=[bH[bF][bJ][0]];for(bI=1,bK=bH[bF][bJ].length;bI<bK;bI++){b[bJ][bI]=bH[bF][bJ][bI]+g*bE*bB[bF][bJ][bI]}}}else{var bM=function(bN){return +bH[bF][bN]+g*bE*bB[bF][bN]};b=[["m",bM(0),bM(1),bM(2),bM(3),bM(4),bM(5)]]}break;case"csv":if(bF=="clip-rect"){b=[];bJ=4;while(bJ--){b[bJ]=+bH[bF][bJ]+g*bE*bB[bF][bJ]}}break;default:var R=[].concat(bH[bF]);b=[];bJ=S.paper.customAttributes[bF].length;while(bJ--){b[bJ]=+R[bJ]+g*bE*bB[bF][bJ]}break}bC[bF]=b}}S.attr(bC);(function(bO,i,bN){setTimeout(function(){eve("anim.frame."+bO,i,bN)})})(S.id,S,bL.anim)}else{(function(bO,bN,i){setTimeout(function(){eve("anim.frame."+bN.id,bN,i);eve("anim.finish."+bN.id,bN,i);aH.is(bO,"function")&&bO.call(bN)})})(bL.callback,S,bL.anim);S.attr(d);U.splice(bG--,1);if(bL.repeat>1&&!bL.next){aC(bL.anim,bL.el,bL.anim.percents[0],null,bL.totalOrigin,bL.repeat-1)}if(bL.next&&!bL.stop){aC(bL.anim,bL.el,bL.next,null,bL.totalOrigin,bL.repeat)}}}aH.svg&&S&&S.paper&&S.paper.safari();U.length&&aD(bp)},D=function(b){return b>255?255:b<0?0:b};a7.animateWith=function(g,i,E,d,S,R){var b=E?aH.animation(E,d,S,R):i;status=g.status(i);return this.animate(b).status(b,status*i.ms/b.ms)};function aT(bF,i,d,bE,bD,bz){var bA=3*i,bC=3*(bE-i)-bA,b=1-bA-bC,S=3*d,bB=3*(bD-d)-S,bG=1-S-bB;function R(by){return((b*by+bC)*by+bA)*by}function g(by,bI){var bH=E(by,bI);return((bG*bH+bB)*bH+S)*bH}function E(by,bN){var bM,bL,bJ,bH,bK,bI;for(bJ=by,bI=0;bI<8;bI++){bH=R(bJ)-by;if(am(bH)<bN){return bJ}bK=(3*b*bJ+2*bC)*bJ+bA;if(am(bK)<0.000001){break}bJ=bJ-bH/bK}bM=0;bL=1;bJ=by;if(bJ<bM){return bM}if(bJ>bL){return bL}while(bM<bL){bH=R(bJ);if(am(bH-by)<bN){return bJ}if(by>bH){bM=bJ}else{bL=bJ}bJ=(bL-bM)/2+bM}return bJ}return g(bF,1/(200*bz))}a7.onAnimation=function(b){b?eve.on("anim.frame."+this.id,b):eve.unbind("anim.frame."+this.id);return this};function bn(E,g){var d=[],i={};this.ms=g;this.times=1;if(E){for(var b in E){if(E[ab](b)){i[ae(b)]=E[b];d.push(ae(b))}}d.sort(s)}this.anim=i;this.top=d[d.length-1];this.percents=d}bn.prototype.delay=function(d){var b=new bn(this.anim,this.ms);b.times=this.times;b.del=+d||0;return b};bn.prototype.repeat=function(d){var b=new bn(this.anim,this.ms);b.del=this.del;b.times=ak.floor(m(d,0))||1;return b};function aC(bP,g,b,bN,by,bC){b=ae(b);var bW,S,bB,bX=[],bI,bH,R,bK=bP.ms,bO={},E={},bE={};if(bN){for(bS=0,bD=U.length;bS<bD;bS++){var bU=U[bS];if(bU.el.id==g.id&&bU.anim==bP){if(bU.percent!=b){U.splice(bS,1);bB=1}else{S=bU}g.attr(bU.totalOrigin);break}}}else{bN=+E}for(var bS=0,bD=bP.percents.length;bS<bD;bS++){if(bP.percents[bS]==b||bP.percents[bS]>bN*bP.top){b=bP.percents[bS];bH=bP.percents[bS-1]||0;bK=bK/bP.top*(b-bH);bI=bP.percents[bS+1];bW=bP.anim[b];break}else{if(bN){g.attr(bP.anim[bP.percents[bS]])}}}if(!bW){return}if(!S){for(attr in bW){if(bW[ab](attr)){if(ai[ab](attr)||g.paper.customAttributes[ab](attr)){bO[attr]=g.attr(attr);(bO[attr]==null)&&(bO[attr]=q[attr]);E[attr]=bW[attr];switch(ai[attr]){case aB:bE[attr]=(E[attr]-bO[attr])/bK;break;case"colour":bO[attr]=aH.getRGB(bO[attr]);var bM=aH.getRGB(E[attr]);bE[attr]={r:(bM.r-bO[attr].r)/bK,g:(bM.g-bO[attr].g)/bK,b:(bM.b-bO[attr].b)/bK};break;case"path":var bz=Q(bO[attr],E[attr]),bG=bz[1];bO[attr]=bz[0];bE[attr]=[];for(bS=0,bD=bO[attr].length;bS<bD;bS++){bE[attr][bS]=[0];for(var bR=1,bT=bO[attr][bS].length;bR<bT;bR++){bE[attr][bS][bR]=(bG[bS][bR]-bO[attr][bS][bR])/bK}}break;case"transform":var bZ=g._,bY=aq(bZ[attr],E[attr]);if(bY){bO[attr]=bY.from;E[attr]=bY.to;bE[attr]=[];bE[attr].real=true;for(bS=0,bD=bO[attr].length;bS<bD;bS++){bE[attr][bS]=[bO[attr][bS][0]];for(bR=1,bT=bO[attr][bS].length;bR<bT;bR++){bE[attr][bS][bR]=(E[attr][bS][bR]-bO[attr][bS][bR])/bK}}}else{var bL=(g.matrix||new av),bV={_:{transform:bZ.transform},getBBox:function(){return g.getBBox(1)}};bO[attr]=[bL.a,bL.b,bL.c,bL.d,bL.e,bL.f];aE(bV,E[attr]);E[attr]=bV._.transform;bE[attr]=[(bV.matrix.a-bL.a)/bK,(bV.matrix.b-bL.b)/bK,(bV.matrix.c-bL.c)/bK,(bV.matrix.d-bL.d)/bK,(bV.matrix.e-bL.e)/bK,(bV.matrix.e-bL.f)/bK]}break;case"csv":var d=bu(bW[attr]).split(a),bA=bu(bO[attr]).split(a);if(attr=="clip-rect"){bO[attr]=bA;bE[attr]=[];bS=bA.length;while(bS--){bE[attr][bS]=(d[bS]-bO[attr][bS])/bK}}E[attr]=d;break;default:d=[].concat(bW[attr]);bA=[].concat(bO[attr]);bE[attr]=[];bS=g.paper.customAttributes[attr].length;while(bS--){bE[attr][bS]=((d[bS]||0)-(bA[bS]||0))/bK}break}}}}var bJ=bW.easing,bQ=aH.easing_formulas[bJ];if(!bQ){bQ=bu(bJ).match(c);if(bQ&&bQ.length==5){var bF=bQ;bQ=function(i){return aT(i,+bF[1],+bF[2],+bF[3],+bF[4],bK)}}else{bQ=bo}}R=bW.start||bP.start||+new Date;bU={anim:bP,percent:b,timestamp:R,start:R+(bP.del||0),status:0,initstatus:bN||0,stop:false,ms:bK,easing:bQ,from:bO,diff:bE,to:E,el:g,callback:bW.callback,prev:bH,next:bI,repeat:bC||bP.times,origin:g.attr(),totalOrigin:by};U.push(bU);if(bN&&!S&&!bB){bU.stop=true;bU.start=new Date-bK*bN;if(U.length==1){return bp()}}if(bB){bU.start=new Date-bU.ms*bN}U.length==1&&aD(bp)}else{S.initstatus=bN;S.start=new Date-S.ms*bN}eve("anim.start."+g.id,g,bP)}aH.animation=function(E,d,S,R){if(E instanceof bn){return E}if(aH.is(S,"function")||!S){R=R||S||null;S=null}E=Object(E);d=+d||0;var i={},g,b;for(b in E){if(E[ab](b)&&ae(b)!=b&&ae(b)+"%"!=b){g=true;i[b]=E[b]}}if(!g){return new bn(E,d)}else{S&&(i.easing=S);R&&(i.callback=R);return new bn({100:i},d)}};a7.animate=function(i,b,R,E){var d=this;if(d.removed){E&&E.call(d);return d}var g=i instanceof bn?i:aH.animation(i,b,R,E);aC(g,d,g.percents[0],null,d.attr());return d};a7.setTime=function(d,b){if(d&&b!=null){this.status(d,ba(b,d.ms)/d.ms)}return this};a7.status=function(R,E){var d=[],g=0,b,S;if(E!=null){aC(R,this,-1,ba(E,1));return this}else{b=U.length;for(;g<b;g++){S=U[g];if(S.el.id==this.id&&(!R||S.anim==R)){if(R){return S.status}d.push({anim:S.anim,status:S.status})}}if(R){return 0}return d}};a7.pause=function(d){for(var b=0;b<U.length;b++){if(U[b].el.id==this.id&&(!d||U[b].anim==d)){if(eve("anim.pause."+this.id,this,U[b].anim)!==false){U[b].paused=true}}}return this};a7.resume=function(d){for(var b=0;b<U.length;b++){if(U[b].el.id==this.id&&(!d||U[b].anim==d)){var g=U[b];if(eve("anim.resume."+this.id,this,g.anim)!==false){delete g.paused;this.status(g.anim,g.status)}}}return this};a7.stop=function(d){for(var b=0;b<U.length;b++){if(U[b].el.id==this.id&&(!d||U[b].anim==d)){if(eve("anim.stop."+this.id,this,U[b].anim)!==false){U.splice(b--,1)}}}return this};a7.toString=function(){return"Rapha\xebl\u2019s object"};var ac=function(b){this.items=[];this.length=0;this.type="set";if(b){for(var d=0,g=b.length;d<g;d++){if(b[d]&&(b[d].constructor==a7.constructor||b[d].constructor==ac)){this[this.items.length]=this.items[this.items.length]=b[d];this.length++}}}},a2=ac.prototype;a2.push=function(){var E,b;for(var d=0,g=arguments.length;d<g;d++){E=arguments[d];if(E&&(E.constructor==a7.constructor||E.constructor==ac)){b=this.items.length;this[b]=this.items[b]=E;this.length++}}return this};a2.pop=function(){this.length&&delete this[this.length--];return this.items.pop()};a2.forEach=function(E,b){for(var d=0,g=this.items.length;d<g;d++){if(E.call(b,this.items[d])===false){return this}}return this};for(var A in a7){if(a7[ab](A)){a2[A]=(function(b){return function(){var d=arguments;return this.forEach(function(g){g[b][bt](g,d)})}})(A)}}a2.attr=function(d,S){if(d&&aH.is(d,a3)&&aH.is(d[0],"object")){for(var b=0,R=d.length;b<R;b++){this.items[b].attr(d[b])}}else{for(var g=0,E=this.items.length;g<E;g++){this.items[g].attr(d,S)}}return this};a2.clear=function(){while(this.length){this.pop()}};a2.splice=function(E,by,bz){E=E<0?m(this.length+E,0):E;by=m(0,ba(this.length-E,by));var g=[],b=[],d=[],R;for(R=2;R<arguments.length;R++){d.push(arguments[R])}for(R=0;R<by;R++){b.push(this[E+R])}for(;R<this.length-E;R++){g.push(this[E+R])}var S=d.length;for(R=0;R<S+g.length;R++){this.items[E+R]=this[E+R]=R<S?d[R]:g[R-S]}R=this.items.length=this.length-=by-S;while(this[R]){delete this[R++]}return new ac(b)};a2.exclude=function(g){for(var b=0,d=this.length,E;b<d;b++){if(E||this[b]==g){this[b]=this[b+1];E=1}}if(E){this.length--;delete this[b];return true}};a2.animate=function(g,b,by,bA){(aH.is(by,"function")||!by)&&(bA=by||null);var S=this.items.length,E=S,bB,bz=this,R;if(!S){return this}bA&&(R=function(){!--S&&bA.call(bz)});by=aH.is(by,aa)?by:R;var d=aH.animation(g,b,by,R);bB=this.items[--E].animate(d);while(E--){this.items[E]&&!this.items[E].removed&&this.items[E].animateWith(bB,d)}return this};a2.insertAfter=function(d){var b=this.items.length;while(b--){this.items[b].insertAfter(d)}return this};a2.getBBox=function(){var b=[],S=[],d=[],E=[];for(var g=this.items.length;g--;){if(!this.items[g].removed){var R=this.items[g].getBBox();b.push(R.x);S.push(R.y);d.push(R.x+R.width);E.push(R.y+R.height)}}b=ba[bt](0,b);S=ba[bt](0,S);return{x:b,y:S,width:m[bt](0,d)-b,height:m[bt](0,E)-S}};a2.clone=function(g){g=new ac;for(var b=0,d=this.items.length;b<d;b++){g.push(this.items[b].clone())}return g};a2.toString=function(){return"Rapha\xebl\u2018s set"};aH.registerFont=function(d){if(!d.face){return d}this.fonts=this.fonts||{};var i={w:d.w,face:{},glyphs:{}},g=d.face["font-family"];for(var S in d.face){if(d.face[ab](S)){i.face[S]=d.face[S]}}if(this.fonts[g]){this.fonts[g].push(i)}else{this.fonts[g]=[i]}if(!d.svg){i.face["units-per-em"]=O(d.face["units-per-em"],10);for(var E in d.glyphs){if(d.glyphs[ab](E)){var R=d.glyphs[E];i.glyphs[E]={w:R.w,k:{},d:R.d&&"M"+R.d.replace(/[mlcxtrv]/g,function(by){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[by]||"M"})+"z"};if(R.k){for(var b in R.k){if(R[ab](b)){i.glyphs[E].k[b]=R.k[b]}}}}}}return d};aU.getFont=function(bz,bA,d,E){E=E||"normal";d=d||"normal";bA=+bA||{normal:400,bold:700,lighter:300,bolder:800}[bA]||400;if(!aH.fonts){return}var R=aH.fonts[bz];if(!R){var g=new RegExp("(^|\\s)"+bz.replace(/[^\w\d\s+!~.:_-]/g,aN)+"(\\s|$)","i");for(var b in aH.fonts){if(aH.fonts[ab](b)){if(g.test(b)){R=aH.fonts[b];break}}}}var S;if(R){for(var by=0,bB=R.length;by<bB;by++){S=R[by];if(S.face["font-weight"]==bA&&(S.face["font-style"]==d||!S.face["font-style"])&&S.face["font-stretch"]==E){break}}}return S};aU.print=function(R,E,b,bz,bA,bJ,d){bJ=bJ||"middle";d=m(ba(d||0,1),-1);var bF=this.set(),bI=bu(b).split(aN),bG=0,bD=aN,bK;aH.is(bz,b)&&(bz=this.getFont(bz));if(bz){bK=(bA||16)/bz.face["units-per-em"];var g=bz.face.bbox.split(a),by=+g[0],bB=+g[1]+(bJ=="baseline"?g[3]-g[1]+(+bz.face.descent):(g[3]-g[1])/2);for(var bE=0,S=bI.length;bE<S;bE++){var bC=bE&&bz.glyphs[bI[bE-1]]||{},bH=bz.glyphs[bI[bE]];bG+=bE?(bC.w||bz.w)+(bC.k&&bC.k[bI[bE]]||0)+(bz.w*d):0;bH&&bH.d&&bF.push(this.path(bH.d).attr({fill:"#000",stroke:"none",transform:[["t",bG*bK,0]]}))}bF.transform(["...s",bK,bK,by,bB,"t",(R-by)/bK,(E-bB)/bK])}return bF};aH.format=function(d,g){var b=aH.is(g,a3)?[0][br](g):arguments;d&&aH.is(d,aa)&&b.length-1&&(d=d.replace(bf,function(R,E){return b[++E]==null?aN:b[E]}));return d||aN};aH.fullfill=(function(){var g=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,d=function(R,E,S){var i=S;E.replace(b,function(bA,bz,by,bC,bB){bz=bz||bC;if(i){if(bz in i){i=i[bz]}typeof i=="function"&&bB&&(i=i())}});i=(i==null||i==S?R:i)+"";return i};return function(E,i){return String(E).replace(g,function(S,R){return d(S,R,i)})}})();aH.ninja=function(){r.was?(ap.win.Raphael=r.is):delete Raphael;return aH};aH.st=a2;(function(i,d,g){if(i.readyState==null&&i.addEventListener){i.addEventListener(d,g=function(){i.removeEventListener(d,g,false);i.readyState="complete"},false);i.readyState="loading"}function b(){(/in/).test(i.readyState)?setTimeout(b,9):aH.eve("DOMload")}b()})(document,"DOMContentLoaded");r.was?(ap.win.Raphael=aH):(Raphael=aH);eve.on("DOMload",function(){af=true})})();window.Raphael.svg&&function(m){var e="hasOwnProperty",F=String,o=parseFloat,r=parseInt,g=Math,G=g.max,t=g.abs,i=g.pow,h=/[, ]+/,C=m.eve,s="",k=" ";var p="http://www.w3.org/1999/xlink",B={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},x={};m.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version};var j=function(I,E){if(E){if(typeof I=="string"){I=j(I)}for(var H in E){if(E[e](H)){if(H.substring(0,6)=="xlink:"){I.setAttributeNS(p,H.substring(6),F(E[H]))}else{I.setAttribute(H,F(E[H]))}}}}else{I=m._g.doc.createElementNS("http://www.w3.org/2000/svg",I);I.style&&(I.style.webkitTapHighlightColor="rgba(0,0,0,0)")}return I},v={},c=/^url\(#(.*)\)$/,u=function(H,I){var E=H.getAttribute("fill");E=E&&E.match(c);if(E&&!--v[E[1]]){delete v[E[1]];I.defs.removeChild(m._g.doc.getElementById(E[1]))}},a=function(Q,U){var S="linear",H=Q.id+U,O=0.5,M=0.5,J=Q.node,E=Q.paper,W=J.style,I=m._g.doc.getElementById(H);if(!I){U=F(U).replace(m._radial_gradient,function(Z,X,aa){S="radial";if(X&&aa){O=o(X);M=o(aa);var Y=((M>0.5)*2-1);i(O-0.5,2)+i(M-0.5,2)>0.25&&(M=g.sqrt(0.25-i(O-0.5,2))*Y+0.5)&&M!=0.5&&(M=M.toFixed(5)-0.00001*Y)}return s});U=U.split(/\s*\-\s*/);if(S=="linear"){var N=U.shift();N=-o(N);if(isNaN(N)){return null}var K=[0,0,g.cos(m.rad(N)),g.sin(m.rad(N))],T=1/(G(t(K[2]),t(K[3]))||1);K[2]*=T;K[3]*=T;if(K[2]<0){K[0]=-K[2];K[2]=0}if(K[3]<0){K[1]=-K[3];K[3]=0}}var R=m._parseDots(U);if(!R){return null}if(Q.gradient){E.defs.removeChild(Q.gradient);delete Q.gradient}H=H.replace(/[\(\)\s,\xb0#]/g,"-");I=j(S+"Gradient",{id:H});Q.gradient=I;j(I,S=="radial"?{fx:O,fy:M}:{x1:K[0],y1:K[1],x2:K[2],y2:K[3],gradientTransform:Q.matrix.invert()});E.defs.appendChild(I);for(var P=0,V=R.length;P<V;P++){I.appendChild(j("stop",{offset:R[P].offset?R[P].offset:P?"100%":"0%","stop-color":R[P].color||"#fff"}))}}j(J,{fill:"url(#"+H+")",opacity:1,"fill-opacity":1});W.fill=s;W.opacity=1;W.fillOpacity=1;return 1},b=function(H){var E=H.getBBox(1);j(H.pattern,{patternTransform:H.matrix.invert()+" translate("+E.x+","+E.y+")"})},d=function(S,U,N){if(S.type=="path"){var E=F(U).toLowerCase().split("-"),R=S.paper,af=N?"end":"start",W=S.node,T=S.attrs,M=T["stroke-width"],aa=E.length,J="classic",Z,I,P,X,V,O=3,ab=3,Q=5;while(aa--){switch(E[aa]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":J=E[aa];break;case"wide":ab=5;break;case"narrow":ab=2;break;case"long":O=5;break;case"short":O=2;break}}if(J=="open"){O+=2;ab+=2;Q+=2;P=1;X=N?4:1;V={fill:"none",stroke:T.stroke}}else{X=P=O/2;V={fill:T.stroke,stroke:"none"}}if(S._.arrows){if(N){S._.arrows.endPath&&x[S._.arrows.endPath]--;S._.arrows.endMarker&&x[S._.arrows.endMarker]--}else{S._.arrows.startPath&&x[S._.arrows.startPath]--;S._.arrows.startMarker&&x[S._.arrows.startMarker]--}}else{S._.arrows={}}if(J!="none"){var H="raphael-marker-"+J,ae="raphael-marker-"+af+J+O+ab;if(!m._g.doc.getElementById(H)){R.defs.appendChild(j(j("path"),{"stroke-linecap":"round",d:B[J],id:H}));x[H]=1}else{x[H]++}var K=m._g.doc.getElementById(ae),Y;if(!K){K=j(j("marker"),{id:ae,markerHeight:ab,markerWidth:O,orient:"auto",refX:X,refY:ab/2});Y=j(j("use"),{"xlink:href":"#"+H,transform:(N?" rotate(180 "+O/2+" "+ab/2+") ":k)+"scale("+O/Q+","+ab/Q+")","stroke-width":1/((O/Q+ab/Q)/2)});K.appendChild(Y);R.defs.appendChild(K);x[ae]=1}else{x[ae]++;Y=K.getElementsByTagName("use")[0]}j(Y,V);var ad=P*(J!="diamond"&&J!="oval");if(N){Z=S._.arrows.startdx*M||0;I=m.getTotalLength(T.path)-ad*M}else{Z=ad*M;I=m.getTotalLength(T.path)-(S._.arrows.enddx*M||0)}V={};V["marker-"+af]="url(#"+ae+")";if(I||Z){V.d=Raphael.getSubpath(T.path,Z,I)}j(W,V);S._.arrows[af+"Path"]=H;S._.arrows[af+"Marker"]=ae;S._.arrows[af+"dx"]=ad;S._.arrows[af+"Type"]=J;S._.arrows[af+"String"]=U}else{if(N){Z=S._.arrows.startdx*M||0;I=m.getTotalLength(T.path)-Z}else{Z=0;I=m.getTotalLength(T.path)-(S._.arrows.enddx*M||0)}S._.arrows[af+"Path"]&&j(W,{d:Raphael.getSubpath(T.path,Z,I)});delete S._.arrows[af+"Path"];delete S._.arrows[af+"Marker"];delete S._.arrows[af+"dx"];delete S._.arrows[af+"Type"];delete S._.arrows[af+"String"]}for(V in x){if(x[e](V)&&!x[V]){var ac=m._g.doc.getElementById(V);ac&&ac.parentNode.removeChild(ac)}}}},y={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},l=function(N,K,M){K=y[F(K).toLowerCase()];if(K){var I=N.attrs["stroke-width"]||"1",E={round:I,square:I,butt:0}[N.attrs["stroke-linecap"]||M["stroke-linecap"]]||0,J=[],H=K.length;while(H--){J[H]=K[H]*I+((H%2)?1:-1)*E}j(N.node,{"stroke-dasharray":J.join(",")})}},z=function(W,af){var ab=W.node,X=W.attrs,U=ab.style.visibility;ab.style.visibility="hidden";for(var Z in af){if(af[e](Z)){if(!m._availableAttrs[e](Z)){continue}var Y=af[Z];X[Z]=Y;switch(Z){case"blur":W.blur(Y);break;case"href":case"title":case"target":var ad=ab.parentNode,K=false;if(ad.tagName.toLowerCase()!="a"){var M=j("a");ad.insertBefore(M,ab);M.appendChild(ab);ad=M;if(Z==="title"){var S=document.createTextNode(Y),aa=j("title");aa.appendChild(S);ad.appendChild(aa);K=true}}if(Z=="target"&&Y=="blank"){ad.setAttributeNS(p,"show","new")}else{ad.setAttributeNS(p,Z,Y)}if(!K&&(Z==="title")){for(var O=ad.firstChild;O;O=O.nextSibling){if(O.tagName==="title"){var V=O.firstChild,Q=document.createTextNode(Y);if(V){O.replaceChild(Q,V)}else{O.appendChild(Q)}}}}break;case"cursor":ab.style.cursor=Y;break;case"transform":W.transform(Y);break;case"arrow-start":d(W,Y);break;case"arrow-end":d(W,Y,1);break;case"clip-rect":var H=F(Y).split(h);if(H.length==4){W.clip&&W.clip.parentNode.parentNode.removeChild(W.clip.parentNode);var I=j("clipPath"),ac=j("rect");I.id=m._createUUID();j(ac,{x:H[0],y:H[1],width:H[2],height:H[3]});I.appendChild(ac);W.paper.defs.appendChild(I);j(ab,{"clip-path":"url(#"+I.id+")"});W.clip=ac}if(!Y){var ae=m._g.doc.getElementById(ab.getAttribute("clip-path").replace(/(^url\(#|\)$)/g,s));ae&&ae.parentNode.removeChild(ae);j(ab,{"clip-path":s});delete W.clip}break;case"path":if(W.type=="path"){j(ab,{d:Y?X.path=m._pathToAbsolute(Y):"M0,0"});W._.dirty=1;if(W._.arrows){"startString" in W._.arrows&&d(W,W._.arrows.startString);"endString" in W._.arrows&&d(W,W._.arrows.endString,1)}}break;case"width":ab.setAttribute(Z,Y);W._.dirty=1;if(X.fx){Z="x";Y=X.x}else{break}case"x":if(X.fx){Y=-X.x-(X.width||0)}case"rx":if(Z=="rx"&&W.type=="rect"){break}case"cx":ab.setAttribute(Z,Y);W.pattern&&b(W);W._.dirty=1;break;case"height":ab.setAttribute(Z,Y);W._.dirty=1;if(X.fy){Z="y";Y=X.y}else{break}case"y":if(X.fy){Y=-X.y-(X.height||0)}case"ry":if(Z=="ry"&&W.type=="rect"){break}case"cy":ab.setAttribute(Z,Y);W.pattern&&b(W);W._.dirty=1;break;case"r":if(W.type=="rect"){j(ab,{rx:Y,ry:Y})}else{ab.setAttribute(Z,Y)}W._.dirty=1;break;case"src":if(W.type=="image"){ab.setAttributeNS(p,"href",Y)}break;case"stroke-width":if(W._.sx!=1||W._.sy!=1){Y/=G(t(W._.sx),t(W._.sy))||1}if(W.paper._vbSize){Y*=W.paper._vbSize}ab.setAttribute(Z,Y);if(X["stroke-dasharray"]){l(W,X["stroke-dasharray"],af)}if(W._.arrows){"startString" in W._.arrows&&d(W,W._.arrows.startString);"endString" in W._.arrows&&d(W,W._.arrows.endString,1)}break;case"stroke-dasharray":l(W,Y,af);break;case"fill":var N=F(Y).match(m._ISURL);if(N){I=j("pattern");var T=j("image");I.id=m._createUUID();j(I,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});j(T,{x:0,y:0,"xlink:href":N[1]});I.appendChild(T);(function(ag){m._preload(N[1],function(){var ah=this.offsetWidth,ai=this.offsetHeight;j(ag,{width:ah,height:ai});j(T,{width:ah,height:ai});W.paper.safari()})})(I);W.paper.defs.appendChild(I);ab.style.fill="url(#"+I.id+")";j(ab,{fill:"url(#"+I.id+")"});W.pattern=I;W.pattern&&b(W);break}var J=m.getRGB(Y);if(!J.error){delete af.gradient;delete X.gradient;!m.is(X.opacity,"undefined")&&m.is(af.opacity,"undefined")&&j(ab,{opacity:X.opacity});!m.is(X["fill-opacity"],"undefined")&&m.is(af["fill-opacity"],"undefined")&&j(ab,{"fill-opacity":X["fill-opacity"]})}else{if((W.type=="circle"||W.type=="ellipse"||F(Y).charAt()!="r")&&a(W,Y)){if("opacity" in X||"fill-opacity" in X){var E=m._g.doc.getElementById(ab.getAttribute("fill").replace(/^url\(#|\)$/g,s));if(E){var P=E.getElementsByTagName("stop");j(P[P.length-1],{"stop-opacity":("opacity" in X?X.opacity:1)*("fill-opacity" in X?X["fill-opacity"]:1)})}}X.gradient=Y;X.fill="none";break}}J[e]("opacity")&&j(ab,{"fill-opacity":J.opacity>1?J.opacity/100:J.opacity});case"stroke":J=m.getRGB(Y);ab.setAttribute(Z,J.hex);Z=="stroke"&&J[e]("opacity")&&j(ab,{"stroke-opacity":J.opacity>1?J.opacity/100:J.opacity});if(Z=="stroke"&&W._.arrows){"startString" in W._.arrows&&d(W,W._.arrows.startString);"endString" in W._.arrows&&d(W,W._.arrows.endString,1)}break;case"gradient":(W.type=="circle"||W.type=="ellipse"||F(Y).charAt()!="r")&&a(W,Y);break;case"opacity":if(X.gradient&&!X[e]("stroke-opacity")){j(ab,{"stroke-opacity":Y>1?Y/100:Y})}case"fill-opacity":if(X.gradient){E=m._g.doc.getElementById(ab.getAttribute("fill").replace(/^url\(#|\)$/g,s));if(E){P=E.getElementsByTagName("stop");j(P[P.length-1],{"stop-opacity":Y})}break}default:Z=="font-size"&&(Y=r(Y,10)+"px");var R=Z.replace(/(\-.)/g,function(ag){return ag.substring(1).toUpperCase()});ab.style[R]=Y;W._.dirty=1;ab.setAttribute(Z,Y);break}}}q(W,af);ab.style.visibility=U},D=1.2,q=function(E,K){if(E.type!="text"||!(K[e]("text")||K[e]("font")||K[e]("font-size")||K[e]("x")||K[e]("y"))){return}var Q=E.attrs,I=E.node,S=I.firstChild?r(m._g.doc.defaultView.getComputedStyle(I.firstChild,s).getPropertyValue("font-size"),10):10;if(K[e]("text")){Q.text=K.text;while(I.firstChild){I.removeChild(I.firstChild)}var J=F(K.text).split("\n"),H=[],O;for(var M=0,R=J.length;M<R;M++){O=j("tspan");M&&j(O,{dy:S*D,x:Q.x});O.appendChild(m._g.doc.createTextNode(J[M]));I.appendChild(O);H[M]=O}}else{H=I.getElementsByTagName("tspan");for(M=0,R=H.length;M<R;M++){if(M){j(H[M],{dy:S*D,x:Q.x})}else{j(H[0],{dy:0})}}}j(I,{x:Q.x,y:Q.y});E._.dirty=1;var N=E._getBBox(),P=Q.y-(N.y+N.height/2);P&&m.is(P,"finite")&&j(H[0],{dy:P})},w=function(H,E){var J=0,I=0;this[0]=this.node=H;H.raphael=true;this.id=m._oid++;H.raphaelid=this.id;this.matrix=m.matrix();this.realPath=null;this.paper=E;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!E.bottom&&(E.bottom=this);this.prev=E.top;E.top&&(E.top.next=this);E.top=this;this.next=null},n=m.el;w.prototype=n;n.constructor=w;m._engine.path=function(E,J){var H=j("path");J.canvas&&J.canvas.appendChild(H);var I=new w(H,J);I.type="path";z(I,{fill:"none",stroke:"#000",path:E});return I};n.rotate=function(H,E,J){if(this.removed){return this}H=F(H).split(h);if(H.length-1){E=o(H[1]);J=o(H[2])}H=o(H[0]);(J==null)&&(E=J);if(E==null||J==null){var I=this.getBBox(1);E=I.x+I.width/2;J=I.y+I.height/2}this.transform(this._.transform.concat([["r",H,E,J]]));return this};n.scale=function(K,I,E,J){if(this.removed){return this}K=F(K).split(h);if(K.length-1){I=o(K[1]);E=o(K[2]);J=o(K[3])}K=o(K[0]);(I==null)&&(I=K);(J==null)&&(E=J);if(E==null||J==null){var H=this.getBBox(1)}E=E==null?H.x+H.width/2:E;J=J==null?H.y+H.height/2:J;this.transform(this._.transform.concat([["s",K,I,E,J]]));return this};n.translate=function(H,E){if(this.removed){return this}H=F(H).split(h);if(H.length-1){E=o(H[1])}H=o(H[0])||0;E=+E||0;this.transform(this._.transform.concat([["t",H,E]]));return this};n.transform=function(H){var I=this._;if(H==null){return I.transform}m._extractTransform(this,H);this.clip&&j(this.clip,{transform:this.matrix.invert()});this.pattern&&b(this);this.node&&j(this.node,{transform:this.matrix});if(I.sx!=1||I.sy!=1){var E=this.attrs[e]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":E})}return this};n.hide=function(){!this.removed&&this.paper.safari(this.node.style.display="none");return this};n.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};n.remove=function(){if(this.removed){return}C.unbind("*.*."+this.id);m._tear(this,this.paper);this.node.parentNode.removeChild(this.node);for(var E in this){delete this[E]}this.removed=true};n._getBBox=function(){if(this.node.style.display=="none"){this.show();var E=true}var I={};try{I=this.node.getBBox()}catch(H){}finally{I=I||{}}E&&this.hide();return I};n.attr=function(E,Q){if(this.removed){return this}if(E==null){var N={};for(var P in this.attrs){if(this.attrs[e](P)){N[P]=this.attrs[P]}}N.gradient&&N.fill=="none"&&(N.fill=N.gradient)&&delete N.gradient;N.transform=this._.transform;return N}if(Q==null&&m.is(E,"string")){if(E=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient}if(E=="transform"){return this._.transform}var O=E.split(h),J={};for(var K=0,S=O.length;K<S;K++){E=O[K];if(E in this.attrs){J[E]=this.attrs[E]}else{if(m.is(this.paper.customAttributes[E],"function")){J[E]=this.paper.customAttributes[E].def}else{J[E]=m._availableAttrs[E]}}}return S-1?J:J[O[0]]}if(Q==null&&m.is(E,"array")){J={};for(K=0,S=E.length;K<S;K++){J[E[K]]=this.attr(E[K])}return J}if(Q!=null){var H={};H[E]=Q}else{if(E!=null&&m.is(E,"object")){H=E}}for(var R in this.paper.customAttributes){if(this.paper.customAttributes[e](R)&&H[e](R)&&m.is(this.paper.customAttributes[R],"function")){var M=this.paper.customAttributes[R].apply(this,[].concat(H[R]));this.attrs[R]=H[R];for(var I in M){if(M[e](I)){H[I]=M[I]}}}}z(this,H);return this};n.toFront=function(){if(this.removed){return this}this.node.parentNode.appendChild(this.node);var E=this.paper;E.top!=this&&m._tofront(this,E);return this};n.toBack=function(){if(this.removed){return this}if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);m._toback(this,this.paper);var E=this.paper}return this};n.insertAfter=function(E){if(this.removed){return this}var H=E.node||E[E.length-1].node;if(H.nextSibling){H.parentNode.insertBefore(this.node,H.nextSibling)}else{H.parentNode.appendChild(this.node)}m._insertafter(this,E,this.paper);return this};n.insertBefore=function(E){if(this.removed){return this}var H=E.node||E[0].node;H.parentNode.insertBefore(this.node,H);m._insertbefore(this,E,this.paper);return this};n.blur=function(H){var E=this;if(+H!==0){var I=j("filter"),J=j("feGaussianBlur");E.attrs.blur=H;I.id=m._createUUID();j(J,{stdDeviation:+H||1.5});I.appendChild(J);E.paper.defs.appendChild(I);E._blur=I;j(E.node,{filter:"url(#"+I.id+")"})}else{if(E._blur){E._blur.parentNode.removeChild(E._blur);delete E._blur;delete E.attrs.blur}E.node.removeAttribute("filter")}};m._engine.circle=function(H,E,M,K){var J=j("circle");H.canvas&&H.canvas.appendChild(J);var I=new w(J,H);I.attrs={cx:E,cy:M,r:K,fill:"none",stroke:"#000"};I.type="circle";j(J,I.attrs);return I};m._engine.rect=function(I,E,O,H,M,N){var K=j("rect");I.canvas&&I.canvas.appendChild(K);var J=new w(K,I);J.attrs={x:E,y:O,width:H,height:M,r:N||0,rx:N||0,ry:N||0,fill:"none",stroke:"#000"};J.type="rect";j(K,J.attrs);return J};m._engine.ellipse=function(H,E,N,M,K){var J=j("ellipse");H.canvas&&H.canvas.appendChild(J);var I=new w(J,H);I.attrs={cx:E,cy:N,rx:M,ry:K,fill:"none",stroke:"#000"};I.type="ellipse";j(J,I.attrs);return I};m._engine.image=function(I,N,E,O,H,M){var K=j("image");j(K,{x:E,y:O,width:H,height:M,preserveAspectRatio:"none"});K.setAttributeNS(p,"href",N);I.canvas&&I.canvas.appendChild(K);var J=new w(K,I);J.attrs={x:E,y:O,width:H,height:M,src:N};J.type="image";return J};m._engine.text=function(H,E,M,K){var J=j("text");H.canvas&&H.canvas.appendChild(J);var I=new w(J,H);I.attrs={x:E,y:M,"text-anchor":"middle",text:K,font:m._availableAttrs.font,stroke:"none",fill:"#000"};I.type="text";z(I,I.attrs);return I};m._engine.setSize=function(H,E){this.width=H||this.width;this.height=E||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);if(this._viewBox){this.setViewBox.apply(this,this._viewBox)}return this};m._engine.create=function(){var J=m._getContainer.apply(0,arguments),H=J&&J.container,O=J.x,N=J.y,I=J.width,P=J.height;if(!H){throw new Error("SVG container not found.")}var E=j("svg"),M="overflow:hidden;",K;O=O||0;N=N||0;I=I||512;P=P||342;j(E,{height:P,version:1.1,width:I,xmlns:"http://www.w3.org/2000/svg"});if(H==1){E.style.cssText=M+"position:absolute;left:"+O+"px;top:"+N+"px";m._g.doc.body.appendChild(E);K=1}else{E.style.cssText=M+"position:relative";if(H.firstChild){H.insertBefore(E,H.firstChild)}else{H.appendChild(E)}}H=new m._Paper;H.width=I;H.height=P;H.canvas=E;H.clear();H._left=H._top=0;K&&(H.renderfix=function(){});H.renderfix();return H};m._engine.setViewBox=function(M,J,O,E,H){C("setViewBox",this,this._viewBox,[M,J,O,E,H]);var Q=G(O/this.width,E/this.height),K=this.top,P=H?"meet":"xMinYMin",I,N;if(M==null){if(this._vbSize){Q=1}delete this._vbSize;I="0 0 "+this.width+k+this.height}else{this._vbSize=Q;I=M+k+J+k+O+k+E}j(this.canvas,{viewBox:I,preserveAspectRatio:P});while(Q&&K){N="stroke-width" in K.attrs?K.attrs["stroke-width"]:1;K.attr({"stroke-width":N});K._.dirty=1;K._.dirtyT=1;K=K.prev}this._viewBox=[M,J,O,E,!!H];return this};m.prototype.renderfix=function(){var K=this.canvas,E=K.style,J=K.getScreenCTM()||K.createSVGMatrix(),I=-J.e%1,H=-J.f%1;if(I||H){if(I){this._left=(this._left+I)%1;E.left=this._left+"px"}if(H){this._top=(this._top+H)%1;E.top=this._top+"px"}}};m.prototype.clear=function(){m.eve("clear",this);var E=this.canvas;while(E.firstChild){E.removeChild(E.firstChild)}this.bottom=this.top=null;(this.desc=j("desc")).appendChild(m._g.doc.createTextNode("Created with Rapha\xebl "+m.version));E.appendChild(this.desc);E.appendChild(this.defs=j("defs"))};m.prototype.remove=function(){C("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var E in this){this[E]=removed(E)}};var A=m.st;for(var f in n){if(n[e](f)&&!A[e](f)){A[f]=(function(E){return function(){var H=arguments;return this.forEach(function(I){I[E].apply(I,H)})}})(f)}}}(window.Raphael);window.Raphael.vml&&function(i){var c="hasOwnProperty",z=String,k=parseFloat,e=Math,w=e.round,C=e.max,x=e.min,p=e.abs,r="fill",f=/[, ]+/,v=i.eve,s=" progid:DXImageTransform.Microsoft",h=" ",n="",y={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},g=/([clmz]),?([^clmz]*)/gi,q=/ progid:\S+Blur\([^\)]+\)/g,B=/-?[^,\s-]+/g,b="position:absolute;left:0;top:0;width:1px;height:1px",a=21600,t={path:1,rect:1,image:1},o={circle:1,ellipse:1},d=function(O){var K=/[ahqstv]/ig,F=i._pathToAbsolute;z(O).match(K)&&(F=i._path2curve);K=/[clmz]/g;if(F==i._pathToAbsolute&&!z(O).match(K)){var J=z(O).replace(g,function(S,U,Q){var T=[],P=U.toLowerCase()=="m",R=y[U];Q.replace(B,function(V){if(P&&T.length==2){R+=T+y[U=="m"?"l":"L"];T=[]}T.push(w(V*a))});return R+T});return J}var M=F(O),E,D;J=[];for(var H=0,N=M.length;H<N;H++){E=M[H];D=M[H][0].toLowerCase();D=="z"&&(D="x");for(var G=1,I=E.length;G<I;G++){D+=w(E[G]*a)+(G!=I-1?",":n)}J.push(D)}return J.join(h)},l=function(G,F,E){var D=i.matrix();D.rotate(-G,0.5,0.5);return{dx:D.x(F,E),dy:D.y(F,E)}},m=function(N,M,K,H,G,I){var V=N._,P=N.matrix,D=V.fillpos,O=N.node,J=O.style,F=1,E="",R,T=a/M,S=a/K;J.visibility="hidden";if(!M||!K){return}O.coordsize=p(T)+h+p(S);J.rotation=I*(M*K<0?-1:1);if(I){var U=l(I,H,G);H=U.dx;G=U.dy}M<0&&(E+="x");K<0&&(E+=" y")&&(F=-1);J.flip=E;O.coordorigin=(H*-T)+h+(G*-S);if(D||V.fillsize){var Q=O.getElementsByTagName(r);Q=Q&&Q[0];O.removeChild(Q);if(D){U=l(I,P.x(D[0],D[1]),P.y(D[0],D[1]));Q.position=U.dx*F+h+U.dy*F}if(V.fillsize){Q.size=V.fillsize[0]*p(M)+h+V.fillsize[1]*p(K)}O.appendChild(Q)}J.visibility="visible"};i.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version};addArrow=function(D,J,E){var M=z(J).toLowerCase().split("-"),H=E?"end":"start",F=M.length,I="classic",K="medium",G="medium";while(F--){switch(M[F]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":I=M[F];break;case"wide":case"narrow":G=M[F];break;case"long":case"short":K=M[F];break}}var N=D.node.getElementsByTagName("stroke")[0];N[H+"arrow"]=I;N[H+"arrowlength"]=K;N[H+"arrowwidth"]=G};setFillAndStroke=function(ai,E){ai.attrs=ai.attrs||{};var ab=ai.node,an=ai.attrs,ah=ab.style,Z,ac=t[ai.type]&&(E.x!=an.x||E.y!=an.y||E.width!=an.width||E.height!=an.height||E.cx!=an.cx||E.cy!=an.cy||E.rx!=an.rx||E.ry!=an.ry||E.r!=an.r),af=o[ai.type]&&(an.cx!=E.cx||an.cy!=E.cy||an.r!=E.r||an.rx!=E.rx||an.ry!=E.ry),ad=ai;for(var I in E){if(E[c](I)){an[I]=E[I]}}if(ac){an.path=i._getPath[ai.type](ai);ai._.dirty=1}E.href&&(ab.href=E.href);E.title&&(ab.title=E.title);E.target&&(ab.target=E.target);E.cursor&&(ah.cursor=E.cursor);"blur" in E&&ai.blur(E.blur);if(E.path&&ai.type=="path"||ac){ab.path=d(~z(an.path).toLowerCase().indexOf("r")?i._pathToAbsolute(an.path):an.path);if(ai.type=="image"){ai._.fillpos=[an.x,an.y];ai._.fillsize=[an.width,an.height];m(ai,1,1,0,0,0)}}"transform" in E&&ai.transform(E.transform);if(af){var U=+an.cx,S=+an.cy,X=+an.rx||+an.r||0,W=+an.ry||+an.r||0;ab.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",w((U-X)*a),w((S-W)*a),w((U+X)*a),w((S+W)*a),w(U*a))}if("clip-rect" in E){var aa=z(E["clip-rect"]).split(f);if(aa.length==4){aa[2]=+aa[2]+(+aa[0]);aa[3]=+aa[3]+(+aa[1]);var al=ab.clipRect||i._g.doc.createElement("div"),V=al.style,Q=ab.parentNode;V.clip=i.format("rect({1}px {2}px {3}px {0}px)",aa);if(!ab.clipRect){V.position="absolute";V.top=0;V.left=0;V.width=ai.paper.width+"px";V.height=ai.paper.height+"px";Q.parentNode.insertBefore(al,Q);al.appendChild(Q);ab.clipRect=al}}if(!E["clip-rect"]){ab.clipRect&&(ab.clipRect.style.clip=n)}}if(ai.textpath){var G=ai.textpath.style;E.font&&(G.font=E.font);E["font-family"]&&(G.fontFamily='"'+E["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,n)+'"');E["font-size"]&&(G.fontSize=E["font-size"]);E["font-weight"]&&(G.fontWeight=E["font-weight"]);E["font-style"]&&(G.fontStyle=E["font-style"])}if("arrow-start" in E){addArrow(ad,E["arrow-start"])}if("arrow-end" in E){addArrow(ad,E["arrow-end"],1)}if(E.opacity!=null||E["stroke-width"]!=null||E.fill!=null||E.src!=null||E.stroke!=null||E["stroke-width"]!=null||E["stroke-opacity"]!=null||E["fill-opacity"]!=null||E["stroke-dasharray"]!=null||E["stroke-miterlimit"]!=null||E["stroke-linejoin"]!=null||E["stroke-linecap"]!=null){var N=ab.getElementsByTagName(r),H=false;N=N&&N[0];!N&&(H=N=A(r));if(ai.type=="image"&&E.src){N.src=E.src}E.fill&&(N.on=true);if(N.on==null||E.fill=="none"||E.fill===null){N.on=false}if(N.on&&E.fill){var F=z(E.fill).match(i._ISURL);if(F){N.parentNode==ab&&ab.removeChild(N);N.rotate=true;N.src=F[1];N.type="tile";var R=ai.getBBox(1);N.position=R.x+h+R.y;ai._.fillpos=[R.x,R.y];i._preload(F[1],function(){ai._.fillsize=[this.offsetWidth,this.offsetHeight]})}else{N.color=i.getRGB(E.fill).hex;N.src=n;N.type="solid";if(i.getRGB(E.fill).error&&(ad.type in {circle:1,ellipse:1}||z(E.fill).charAt()!="r")&&addGradientFill(ad,E.fill,N)){an.fill="none";an.gradient=E.fill;N.rotate=false}}}if("fill-opacity" in E||"opacity" in E){var ak=((+an["fill-opacity"]+1||2)-1)*((+an.opacity+1||2)-1)*((+i.getRGB(E.fill).o+1||2)-1);ak=x(C(ak,0),1);N.opacity=ak;if(N.src){N.color="none"}}ab.appendChild(N);var Y=(ab.getElementsByTagName("stroke")&&ab.getElementsByTagName("stroke")[0]),ae=false;!Y&&(ae=Y=A("stroke"));if((E.stroke&&E.stroke!="none")||E["stroke-width"]||E["stroke-opacity"]!=null||E["stroke-dasharray"]||E["stroke-miterlimit"]||E["stroke-linejoin"]||E["stroke-linecap"]){Y.on=true}(E.stroke=="none"||E.stroke===null||Y.on==null||E.stroke==0||E["stroke-width"]==0)&&(Y.on=false);var J=i.getRGB(E.stroke);Y.on&&E.stroke&&(Y.color=J.hex);ak=((+an["stroke-opacity"]+1||2)-1)*((+an.opacity+1||2)-1)*((+J.o+1||2)-1);var D=(k(E["stroke-width"])||1)*0.75;ak=x(C(ak,0),1);E["stroke-width"]==null&&(D=an["stroke-width"]);E["stroke-width"]&&(Y.weight=D);D&&D<1&&(ak*=D)&&(Y.weight=1);Y.opacity=ak;E["stroke-linejoin"]&&(Y.joinstyle=E["stroke-linejoin"]||"miter");Y.miterlimit=E["stroke-miterlimit"]||8;E["stroke-linecap"]&&(Y.endcap=E["stroke-linecap"]=="butt"?"flat":E["stroke-linecap"]=="square"?"square":"round");if(E["stroke-dasharray"]){var K={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Y.dashstyle=K[c](E["stroke-dasharray"])?K[E["stroke-dasharray"]]:n}ae&&ab.appendChild(Y)}if(ad.type=="text"){ad.paper.canvas.style.display=n;var T=ad.paper.span,aj=100,O=an.font&&an.font.match(/\d+(?:\.\d*)?(?=px)/);ah=T.style;an.font&&(ah.font=an.font);an["font-family"]&&(ah.fontFamily=an["font-family"]);an["font-weight"]&&(ah.fontWeight=an["font-weight"]);an["font-style"]&&(ah.fontStyle=an["font-style"]);O=k(O?O[0]:an["font-size"]);ah.fontSize=O*aj+"px";ad.textpath.string&&(T.innerHTML=z(ad.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var ag=T.getBoundingClientRect();ad.W=an.w=(ag.right-ag.left)/aj;ad.H=an.h=(ag.bottom-ag.top)/aj;ad.X=an.x;ad.Y=an.y+ad.H/2;("x" in E||"y" in E)&&(ad.path.v=i.format("m{0},{1}l{2},{1}",w(an.x*a),w(an.y*a),w(an.x*a)+1));var P=["x","y","text","font","font-family","font-weight","font-style","font-size"];for(var am=0,M=P.length;am<M;am++){if(P[am] in E){ad._.dirty=1;break}}switch(an["text-anchor"]){case"start":ad.textpath.style["v-text-align"]="left";ad.bbx=ad.W/2;break;case"end":ad.textpath.style["v-text-align"]="right";ad.bbx=-ad.W/2;break;default:ad.textpath.style["v-text-align"]="center";ad.bbx=0;break}ad.textpath.style["v-text-kern"]=true}};addGradientFill=function(D,M,P){D.attrs=D.attrs||{};var N=D.attrs,G,H,J="linear",K=".5 .5";D.attrs.gradient=M;M=z(M).replace(i._radial_gradient,function(S,T,R){J="radial";if(T&&R){T=k(T);R=k(R);pow(T-0.5,2)+pow(R-0.5,2)>0.25&&(R=e.sqrt(0.25-pow(T-0.5,2))*((R>0.5)*2-1)+0.5);K=T+h+R}return n});M=M.split(/\s*\-\s*/);if(J=="linear"){var E=M.shift();E=-k(E);if(isNaN(E)){return null}}var I=i._parseDots(M);if(!I){return null}D=D.shape||D.node;if(I.length){D.removeChild(P);P.on=true;P.method="none";P.color=I[0].color;P.color2=I[I.length-1].color;var Q=[];for(var F=0,O=I.length;F<O;F++){I[F].offset&&Q.push(I[F].offset+h+I[F].color)}P.colors=Q.length?Q.join():"0% "+P.color;if(J=="radial"){P.type="gradientTitle";P.focus="100%";P.focussize="0 0";P.focusposition=K;P.angle=0}else{P.type="gradient";P.angle=(270-E)%360}D.appendChild(P)}return 1};Element=function(E,D){this[0]=this.node=E;E.raphael=true;this.id=i._oid++;E.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=D;this.matrix=i.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!D.bottom&&(D.bottom=this);this.prev=D.top;D.top&&(D.top.next=this);D.top=this;this.next=null};var j=i.el;Element.prototype=j;j.constructor=Element;j.transform=function(H){if(H==null){return this._.transform}var J=this.paper._viewBoxShift,I=J?"s"+[J.scale,J.scale]+"-1-1t"+[J.dx,J.dy]:n,N;if(J){N=H=z(H).replace(/\.{3}|\u2026/g,this._.transform||n)}i._extractTransform(this,I+H);var O=this.matrix.clone(),Q=this.skew,F=this.node,M,G=~z(this.attrs.fill).indexOf("-"),D=!z(this.attrs.fill).indexOf("url(");O.translate(-0.5,-0.5);if(D||G||this.type=="image"){Q.matrix="1 0 0 1";Q.offset="0 0";M=O.split();if((G&&M.noRotation)||!M.isSimple){F.style.filter=O.toFilter();var K=this.getBBox(),E=this.getBBox(1),R=K.x-E.x,P=K.y-E.y;F.coordorigin=(R*-a)+h+(P*-a);m(this,1,1,R,P,0)}else{F.style.filter=n;m(this,M.scalex,M.scaley,M.dx,M.dy,M.rotate)}}else{F.style.filter=n;Q.matrix=z(O);Q.offset=O.offset()}N&&(this._.transform=N);return this};j.rotate=function(E,D,G){if(this.removed){return this}if(E==null){return}E=z(E).split(f);if(E.length-1){D=k(E[1]);G=k(E[2])}E=k(E[0]);(G==null)&&(D=G);if(D==null||G==null){var F=this.getBBox(1);D=F.x+F.width/2;G=F.y+F.height/2}this._.dirtyT=1;this.transform(this._.transform.concat([["r",E,D,G]]));return this};j.translate=function(E,D){if(this.removed){return this}E=z(E).split(f);if(E.length-1){D=k(E[1])}E=k(E[0])||0;D=+D||0;if(this._.bbox){this._.bbox.x+=E;this._.bbox.y+=D}this.transform(this._.transform.concat([["t",E,D]]));return this};j.scale=function(H,F,D,G){if(this.removed){return this}H=z(H).split(f);if(H.length-1){F=k(H[1]);D=k(H[2]);G=k(H[3]);isNaN(D)&&(D=null);isNaN(G)&&(G=null)}H=k(H[0]);(F==null)&&(F=H);(G==null)&&(D=G);if(D==null||G==null){var E=this.getBBox(1)}D=D==null?E.x+E.width/2:D;G=G==null?E.y+E.height/2:G;this.transform(this._.transform.concat([["s",H,F,D,G]]));this._.dirtyT=1;return this};j.hide=function(){!this.removed&&(this.node.style.display="none");return this};j.show=function(){!this.removed&&(this.node.style.display=n);return this};j._getBBox=function(){if(this.removed){return{}}if(this.type=="text"){return{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}}else{return pathDimensions(this.attrs.path)}};j.remove=function(){if(this.removed){return}i.eve.unbind("*.*."+this.id);i._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var D in this){delete this[D]}this.removed=true};j.attr=function(D,N){if(this.removed){return this}if(D==null){var J={};for(var M in this.attrs){if(this.attrs[c](M)){J[M]=this.attrs[M]}}J.gradient&&J.fill=="none"&&(J.fill=J.gradient)&&delete J.gradient;J.transform=this._.transform;return J}if(N==null&&i.is(D,"string")){if(D==r&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient}var K=D.split(f),G={};for(var H=0,P=K.length;H<P;H++){D=K[H];if(D in this.attrs){G[D]=this.attrs[D]}else{if(i.is(this.paper.customAttributes[D],"function")){G[D]=this.paper.customAttributes[D].def}else{G[D]=i._availableAttrs[D]}}}return P-1?G:G[K[0]]}if(this.attrs&&N==null&&i.is(D,"array")){G={};for(H=0,P=D.length;H<P;H++){G[D[H]]=this.attr(D[H])}return G}var E;if(N!=null){E={};E[D]=N}N==null&&i.is(D,"object")&&(E=D);for(var O in E){i.eve("attr."+O+"."+this.id,this,E[O])}if(E){for(O in this.paper.customAttributes){if(this.paper.customAttributes[c](O)&&E[c](O)&&i.is(this.paper.customAttributes[O],"function")){var I=this.paper.customAttributes[O].apply(this,[][concat](E[O]));this.attrs[O]=E[O];for(var F in I){if(I[c](F)){E[F]=I[F]}}}}if(E.text&&this.type=="text"){this.textpath.string=E.text}setFillAndStroke(this,E)}return this};j.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&i._tofront(this,this.paper);return this};j.toBack=function(){if(this.removed){return this}if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);i._toback(this,this.paper)}return this};j.insertAfter=function(D){if(this.removed){return this}if(D.constructor==i.st.constructor){D=D[D.length-1]}if(D.node.nextSibling){D.node.parentNode.insertBefore(this.node,D.node.nextSibling)}else{D.node.parentNode.appendChild(this.node)}i._insertafter(this,D,this.paper);return this};j.insertBefore=function(D){if(this.removed){return this}if(D.constructor==i.st.constructor){D=D[0]}D.node.parentNode.insertBefore(this.node,D.node);i._insertbefore(this,D,this.paper);return this};j.blur=function(D){var E=this.node.runtimeStyle,F=E.filter;F=F.replace(q,n);if(+D!==0){this.attrs.blur=D;E.filter=F+h+s+".Blur(pixelradius="+(+D||1.5)+")";E.margin=i.format("-{0}px 0 0 -{0}px",w(+D||1.5))}else{E.filter=F;E.margin=0;delete this.attrs.blur}};i._engine.path=function(G,E){var H=A("shape");H.style.cssText=b;H.coordsize=a+h+a;H.coordorigin=E.coordorigin;var I=new Element(H,E),D={fill:"none",stroke:"#000"};G&&(D.path=G);I.type="path";I.path=[];I.Path=n;setFillAndStroke(I,D);E.canvas.appendChild(H);var F=A("skew");F.on=true;H.appendChild(F);I.skew=F;I.transform(n);return I};i._engine.rect=function(E,J,H,K,F,D){var M=i._rectPath(J,H,K,F,D),G=E.path(M),I=G.attrs;G.X=I.x=J;G.Y=I.y=H;G.W=I.width=K;G.H=I.height=F;I.r=D;I.path=M;G.type="rect";return G};i._engine.ellipse=function(E,D,J,I,H){var G=E.path(),F=G.attrs;G.X=D-I;G.Y=J-H;G.W=I*2;G.H=H*2;G.type="ellipse";setFillAndStroke(G,{cx:D,cy:J,rx:I,ry:H});return G};i._engine.circle=function(E,D,I,H){var G=E.path(),F=G.attrs;G.X=D-H;G.Y=I-H;G.W=G.H=H*2;G.type="circle";setFillAndStroke(G,{cx:D,cy:I,r:H});return G};i._engine.image=function(E,D,K,I,M,G){var O=i._rectPath(K,I,M,G),H=E.path(O).attr({stroke:"none"}),J=H.attrs,F=H.node,N=F.getElementsByTagName(r)[0];J.src=D;H.X=J.x=K;H.Y=J.y=I;H.W=J.width=M;H.H=J.height=G;J.path=O;H.type="image";N.parentNode==F&&F.removeChild(N);N.rotate=true;N.src=D;N.type="tile";H._.fillpos=[K,I];H._.fillsize=[M,G];F.appendChild(N);m(H,1,1,0,0,0);return H};i._engine.text=function(D,J,I,K){var G=A("shape"),N=A("path"),F=A("textpath");J=J||0;I=I||0;K=K||"";N.v=i.format("m{0},{1}l{2},{1}",w(J*a),w(I*a),w(J*a)+1);N.textpathok=true;F.string=z(K);F.on=true;G.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";G.coordsize=a+h+a;G.coordorigin="0 0";var E=new Element(G,D),H={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:K};E.shape=G;E.path=N;E.textpath=F;E.type="text";E.attrs.text=z(K);E.attrs.x=J;E.attrs.y=I;E.attrs.w=1;E.attrs.h=1;setFillAndStroke(E,H);G.appendChild(F);G.appendChild(N);D.canvas.appendChild(G);var M=A("skew");M.on=true;G.appendChild(M);E.skew=M;E.transform(n);return E};i._engine.setSize=function(F,D){var E=this.canvas.style;this.width=F;this.height=D;F==+F&&(F+="px");D==+D&&(D+="px");E.width=F;E.height=D;E.clip="rect(0 "+F+" "+D+" 0)";if(this._viewBox){setViewBox.apply(this,this._viewBox)}return this};i._engine.setViewBox=function(J,I,K,F,G){i.eve("setViewBox",this,this._viewBox,[J,I,K,F,G]);var D=this.width,N=this.height,O=1/C(K/D,F/N),M,E;if(G){M=N/F;E=D/K;if(K*M<D){J-=(D-K*M)/2/M}if(F*E<N){I-=(N-F*E)/2/E}}this._viewBox=[J,I,K,F,!!G];this._viewBoxShift={dx:-J,dy:-I,scale:O};this.forEach(function(H){H.transform("...")});return this};var A,u=function(F){var E=F.document;E.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!E.namespaces.rvml&&E.namespaces.add("rvml","urn:schemas-microsoft-com:vml");A=function(G){return E.createElement("<rvml:"+G+' class="rvml">')}}catch(D){A=function(G){return E.createElement("<"+G+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};u(i._g.win);i._engine.create=function(){var F=i._getContainer.apply(0,arguments),D=F.container,M=F.height,N,E=F.width,K=F.x,J=F.y;if(!D){throw new Error("VML container not found.")}var H=new i._Paper,I=H.canvas=i._g.doc.createElement("div"),G=I.style;K=K||0;J=J||0;E=E||512;M=M||342;H.width=E;H.height=M;E==+E&&(E+="px");M==+M&&(M+="px");H.coordsize=a*1000+h+a*1000;H.coordorigin="0 0";H.span=i._g.doc.createElement("span");H.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";I.appendChild(H.span);G.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",E,M);if(D==1){i._g.doc.body.appendChild(I);G.left=K+"px";G.top=J+"px";G.position="absolute"}else{if(D.firstChild){D.insertBefore(I,D.firstChild)}else{D.appendChild(I)}}H.renderfix=function(){};return H};i.prototype.clear=function(){i.eve("clear",this);this.canvas.innerHTML=n;this.span=i._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};i.prototype.remove=function(){i.eve("remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var D in this){this[D]=removed(D)}return true}}(window.Raphael);DG.LayerManager=function(a){return{_firstLayer:null,_lastLayer:null,_paper:a,addNamedLayer:function(b,d){DG.assert(!SC.empty(b));if(this[b]){return this[b]}var c=DG.RaphaelLayer.create({_paper:this._paper,name:b});this[b]=c;if(d){c._prevLayer=d}else{if(this._lastLayer){c._prevLayer=this._lastLayer;this._lastLayer=c}else{this._firstLayer=this._lastLayer=c}}return this},forEach:function(d){var c,b;for(c=this._lastLayer;c;c=b){b=c._prevLayer;d(c)}},moveElementFromTo:function(d,c,b){if(c===b){return}if(typeof c==="string"){c=this[c]}if(typeof b==="string"){b=this[b]}if(c.contains(d)){c.prepareToMoveOrRemove(d);b.push(d)}this.testValidity()},removeElement:function(b){this.forEach(function(c){c.prepareToMoveOrRemove(b)});b.remove();this.testValidity()},testValidity:function(){}}};sc_require("libraries/raphael");sc_require("utilities/layer_manager");DG.RaphaelBaseView=SC.View.extend(DG.Destroyable,{drawWidth:function(){return this.get("frame").width}.property("frame"),drawHeight:function(){return this.get("frame").height}.property("frame"),_paper:null,paper:function(){return this._paper}.property("_paper"),_layerManager:null,layerManager:function(){if(!this._layerManager){this.initLayerManager()}return this._layerManager}.property(),_elementsToClear:null,_elementsInFront:null,_firstTimeToDraw:true,init:function(){arguments.callee.base.apply(this,arguments);this._elementsToClear=[];this._elementsInFront=[]},destroy:function(){this._elementsToClear=null;this._elementsInFront=null;this._paper=null;arguments.callee.base.apply(this,arguments)},createVisualization:function(){if(this.shouldDraw()){this.willDraw();this.doDraw();this.didDraw()}if(this._firstTimeToDraw){this._firstTimeToDraw=false;this.invokeLater("displayDidChange",1)}},shouldDraw:function shouldDraw(){return !SC.none(this._elementsToClear)},willDraw:function willDraw(){this._elementsToClear.forEach(function(a){a.remove()});this._elementsToClear=[]},doDraw:function doDraw(){},didDraw:function didDraw(){var b,a=this._elementsToClear.length;for(b=a-1;b>=0;b--){this._elementsToClear[b].toBack()}a=this._elementsInFront.length;for(b=0;b<a;b++){this._elementsInFront[b].toFront()}},updatePaper:function updatePaper(){if(this._paper){var b=this.get("drawWidth"),a=this.get("drawHeight");if((b<=0)||(a<=0)){return}if((this._paper.width!==b)||(this._paper.height!==a)){this._paper.setSize(b,a);this.notifyPropertyChange("paperSize");this.invokeLast(this.createVisualization)}}}.observes("frame"),render:function render(a,b){arguments.callee.base.apply(this,arguments);if(this._paper){this.createVisualization()}},initLayerManager:function(){if(!this._layerManager){DG.assert(this._paper);this._layerManager=new DG.LayerManager(this._paper)}},didCreateLayer:function didCreateLayer(){this._paper=Raphael(this.get("layer"),this.get("drawWidth"),this.get("drawHeight"));this.createVisualization()},touchStart:function(a){return YES},touchEnd:function(a){return YES},touchesDragged:function(a,b){return YES},captureTouch:function(a){return YES},touchPriority:YES});sc_require("views/raphael_base");DG.RDV_DIVIDER_WIDTH=48;DG.RelationDividerView=SC.View.extend((function(){var f=12,c=4,d="#808080",h="#EEEEEE",g="/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/slickgrid/images/expand.gif",e="/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/slickgrid/images/collapse.gif",b={width:9,height:9},i=5;function a(m,l){var n=l.width+2*i,k=l.height+2*i,j="M%@,%@ h%@ v%@ h%@ z".fmt(m.x-i,m.y-i,n,k,-n);return j}return{layout:{width:DG.RDV_DIVIDER_WIDTH},leftTable:function(j,k){if(k!==undefined){this.setPath("dividerView.leftTable",k);return this}return this.getPath("dividerView.leftTable")}.property(),rightTable:function(j,k){if(k!==undefined){this.setPath("headerView.rightTable",k);this.setPath("dividerView.rightTable",k);return this}return this.getPath("dividerView.rightTable")}.property(),displayDidChange:function(){arguments.callee.base.apply(this,arguments);var j=this.get("headerView"),k=this.get("dividerView");if(j){j.displayDidChange()}if(k){k.displayDidChange()}},childViews:["headerView","dividerView"],headerView:DG.RaphaelBaseView.extend({layout:{left:0,top:0,right:0,height:24},render:function(j,k){arguments.callee.base.apply(this,arguments);j.classNames(["slick-header","ui-state-default"],YES)},classNames:["slick-header-column"],backgroundColor:"#E6E6E6",doDraw:function(){function k(q){return q&&((q.expanded===0)&&(q.collapsed>0))}var n=this.get("rightTable"),j=this.getPath("rightTable.gridAdapter"),m=k(j&&j.get("expandCollapseCounts"))?g:e,p={x:3,y:8},o=b;function l(r){if(j&&n){var q=j.get("expandCollapseCounts");n.expandCollapseAll(k(q))}}this._paper.path(a(p,o)).attr({fill:"transparent",stroke:"transparent"}).touchstart(function(q){SC.run(l(q))});this._paper.image(m,p.x,p.y,o.width,o.height).click(function(q){SC.run(l(q))})}}),dividerView:DG.RaphaelBaseView.extend({layout:{left:0,top:24,right:0,bottom:0},backgroundColor:"white",leftTable:null,rightTable:null,_parentChildRelationsMap:null,displayProperties:["leftTable","rightTable"],doDraw:function(){var o=this.get("leftTable"),s=o&&o.get("gridAdapter"),z=(o&&o.getPath("scrollPos.scrollTop"))||0,q=this.get("rightTable"),D=q&&q.get("gridAdapter"),r=(q&&q.getPath("scrollPos.scrollTop"))||0,u=D&&D.get("parentIDGroups"),k=0,C=0,l=D&&D.get("rowHeight"),j=0,t=this;if(!s||!D){return}if(!this._parentChildRelationsMap){this._parentChildRelationsMap={}}function x(I,G){if(I===G){return"M0,%@ h%@".fmt(I,DG.RDV_DIVIDER_WIDTH)}var H={x:f,y:I},F={x:DG.RDV_DIVIDER_WIDTH-c,y:G},J={x:(H.x+F.x)/2,y:(H.y+F.y)/2},E={x:J.x,y:H.y};return"M0,%@ h%@ Q%@,%@ %@,%@ T%@,%@ h%@".fmt(H.y,f,E.x,E.y,J.x,J.y,F.x,F.y,c)}function n(K,I,J,G){var H={x:f,y:J},M={x:DG.RDV_DIVIDER_WIDTH-c,y:G},F={x:(H.x+M.x)/2,y:(H.y+M.y)/2},E={x:F.x,y:M.y};return"%@ V%@ h%@ Q%@,%@ %@,%@ T%@,%@ h%@ Z".fmt(x(K,I),M.y,-c,E.x,E.y,F.x,F.y,H.x,H.y,-f)}function A(I,H,J,F,G){var K=H.getIndexForID(J),E;if(SC.none(K)){E={left:0,top:F,right:0,bottom:F+G}}else{E=I.getRowBounds(K)}return E}function v(H){var F=this.dgChildIDRange,E=F&&F.isCollapsed,G=D&&D.gridDataView;F.isCollapsed=!E;if(G){if(F.isCollapsed){G.collapseGroup(this.dgParentID)}else{G.expandGroup(this.dgParentID)}q.updateSelectedRows();q.incrementProperty("expandCollapseCount")}}function y(E,G,H){var I=G&&G.get("showExpandedGroupRows");if(I){var J=G&&G.get("gridDataView"),F=J&&J.isGroupCollapsed(H);if(!F){E.top-=l}}}function w(F,E,G){if(F){if(E){F.attr({path:G})}else{F.remove()}}}var m=0;function p(H,I){var O=A(o,s,H,k,0),G=A(q,D,I.firstChildID,C,l),M=A(q,D,I.lastChildID,C,l),F=t._parentChildRelationsMap[H];if(!O||!G||!M){return}y(G,D,H);k=Math.max(k,O.bottom);C=Math.max(C,M.bottom);if(O&&G&&M){var S=true,E=H===j,U=m%2,K=S?x(O.top-z,G.top-r):"",J=E?x(O.bottom-z+1,M.bottom-r+1):"",Q=U?n(O.top-z,G.top-r,O.bottom-z+1,M.bottom-r+1):"",T=I.isCollapsed?g:e,P={x:3,y:O.top-z+5},R=b,N=a(P,R);if(!F){t._parentChildRelationsMap[H]=F={};F.area=U?t._paper.path(Q).attr({fill:h,stroke:"transparent"}):null;F.top=S?t._paper.path(K).attr({stroke:d}):null;if((SC.browser.os===SC.OS.ios)||(SC.browser.os===SC.OS.android)){F.touch=t._paper.path(N).attr({fill:"transparent",stroke:"transparent"}).touchstart(function(V){SC.run(v.call(F.icon,V))})}F.icon=t._paper.image(T,P.x,P.y,R.width,R.height).click(function(V){SC.run(v.call(this,V))});F.icon.dgParentID=H;F.icon.dgChildIDRange=I;if(E){F.bottom=t._paper.path(J).attr({stroke:d})}}else{w(F.top,S,K);w(F.area,U,Q);w(F.touch,true,N);if(F.icon){F.icon.attr({src:T,x:P.x,y:P.y})}w(F.bottom,E,J)}F.marked=false;++m}}DG.ObjectMap.forEach(t._parentChildRelationsMap,function(E,F){F.marked=true});DG.ObjectMap.forEach(u,function(E){if(j<E){j=E}});DG.ObjectMap.forEach(u,p);function B(E,F){if(F&&(typeof F.remove==="function")){F.remove()}}DG.ObjectMap.forEach(t._parentChildRelationsMap,function(F,E){if(E.marked){DG.ObjectMap.forEach(E,B);delete t._parentChildRelationsMap[F]}})}})}}()));sc_require("components/case_table/case_table_view");sc_require("components/case_table/relation_divider_view");DG.HierTableView=SC.SplitView.extend((function(){var d="#E6E6E6",b=60,a=b,c=7;return{dataContext:null,layout:{left:0,top:0,right:0,bottom:0},layoutDirection:SC.LAYOUT_HORIZONTAL,childViews:["parentTableView","relationDividerView","childTableView","slopView"],parentTableView:DG.CaseTableView.extend(SC.SplitChild,{name:"parentTableView",minimumSize:a,autoResizeStyle:SC.RESIZE_AUTOMATIC,compensatesForMovement:YES}),relationDividerView:DG.RelationDividerView.extend(SC.SplitChild,{name:"relationDividerView",minimumSize:DG.RDV_DIVIDER_WIDTH,maximumSize:DG.RDV_DIVIDER_WIDTH,size:DG.RDV_DIVIDER_WIDTH,autoResizeStyle:SC.FIXED_SIZE,compensatesForMovement:NO,allowsIndirectAdjustments:NO}),childTableView:DG.CaseTableView.extend(SC.SplitChild,{name:"childTableView",minimumSize:a,autoResizeStyle:SC.RESIZE_MANUAL,compensatesForMovement:function(){var e=this.getPath("parentView.slopView.size");return e<=c}.property()}),slopView:SC.View.extend(SC.SplitChild,{name:"slopView",minimumSize:c,size:c,autoResizeStyle:SC.RESIZE_MANUAL,compensatesForMovement:YES,backgroundColor:d}),childTableViews:function(){var f=this.get("childViews")||[],e=[];f.forEach(function(g){if(g.kindOf(DG.CaseTableView)){e.push(g)}});return e}.property(),willDestroy:function(){var e=this.get("childTableViews");e.forEach(function(f){if(f&&f.willDestroy){f.willDestroy()}})},splitViewDividerBetween:function(g,f,e){if(!this.get("splitDividerView")){return null}if(f===this.get("parentTableView")){return this.get("splitDividerView").create()}return DG.InertSplitDividerView.create()},refresh:function(){var e=this.get("childTableViews");e.forEach(function(f){f.refresh()})},mouseDown:function(){DG.globalEditorLock.commitCurrentEdit()},_klugeAdjust:false,gridViewDidChange:function(f){this.get("relationDividerView").displayDidChange();if(!this._klugeAdjust){this._klugeAdjust=true;var g=DG.ComponentView.findComponentViewParent(this),e=g&&g.get("frame"),h=e&&e.width;if(h){g.adjust("width",h+1)}}}.observes(".parentTableView.gridView",".childTableView.gridView"),gridWidthDidChange:function(f){var e=f&&f.get("maximumSize"),h=f&&f.get("gridWidth"),g=false;if(f&&(h!==e)){f.set("maximumSize",h);if(g){this.columnWidthDidChange(f)}else{f.set("size",h);this.invokeOnce("_scsv_tile")}}}.observes(".parentTableView.gridWidth",".childTableView.gridWidth"),childTableLayoutDidChange:function(f){var g=this.get("parentTableView"),h=this.get("relationDividerView"),e=this.get("childTableView");if(g){this.invokeLater(function(){g.displayDidChange()})}if(h){this.invokeLater(function(){h.displayDidChange()})}if(e){this.invokeLater(function(){e.displayDidChange()})}}.observes(".parentTableView.size",".childTableView.size"),columnWidthDidChange:function(e){var p=e.get("gridWidthChange"),l=this.get("parentTableView"),n=this.get("childTableView"),j=e,m=j&&j.get("size"),i=j&&j.get("gridWidth"),h=e===n?l:n,f=this.get("slopView"),k=f&&f.get("size"),r=k-c;if((p>0)&&(r>0)){var g=Math.max(0,Math.min(p,r));this.splitViewAdjustChildToFit(this,j,g);this.splitViewAdjustChildToFit(this,f,-g,k);this.splitViewLayoutChildren(this)}else{if((p<0)&&(i+p<=m)){var q,o;q=this.splitViewAdjustChildToFit(this,j,p);o=p-q;if(o!==0){o=this.splitViewAdjustChildToFit(this,h,-o)}if(o!==0){this.splitViewAdjustChildToFit(this,f,o,k+o)}this.splitViewLayoutChildren(this)}}},rowCountDidChange:function(){this.relationDividerView.displayDidChange()}.observes(".parentTableView.rowCount",".childTableView.rowCount"),tableDidScroll:function(){SC.run(function(){this.relationDividerView.displayDidChange()}.bind(this))}.observes(".parentTableView.scrollPos",".childTableView.scrollPos"),tableDidExpandCollapse:function(){SC.run(function(){this.relationDividerView.displayDidChange()}.bind(this))}.observes(".parentTableView.expandCollapseCount",".childTableView.expandCollapseCount"),setCaseTableAdapters:function(h){var g=this.get("childTableViews");g.forEach(function(l,k){var j=h.objectAt(k);l.setIfChanged("gridAdapter",j)});var i=this.get("parentTableView"),f=this.get("childTableView"),e=this.get("relationDividerView");if(e&&i&&f){e.set("leftTable",i);e.set("rightTable",f)}},updateColumnInfo:function(){var e=this.get("childTableViews")||[];e.forEach(function(f){f.updateColumnInfo()})},updateRowData:function(){var e=this.get("childTableViews")||[];e.forEach(function(f){f.updateRowData()})},updateRowCount:function(){var e=this.get("childTableViews")||[];e.forEach(function(f){f.updateRowCount()})},updateSelectedRows:function(){var e=this.get("childTableViews")||[];e.forEach(function(f){f.updateSelectedRows()})},splitViewAdjustChildToFit:function(f,j,g,h){var i=j&&j.get("minimumSize"),l=!SC.none(h)?h:Math.max(i,j&&j.get("gridWidth")),k=j&&j.get("size"),e=0;if(g>0){e=Math.min(g,l-k)}else{if(g<0){e=Math.max(g,i-k)}}if(e!==0){j.set("size",k+e)}return g-e},splitViewResizeChildrenToFit:function(k,g){var j=this.get("_frameSize"),n=this.get("parentTableView"),h=n&&n.get("size"),m=n&&n.get("gridWidth"),o=this.get("childTableView"),p=o&&o.get("size"),f=o&&o.get("gridWidth"),i=this.get("slopView"),l=i&&i.get("size"),q=(l-c)||0,r=j-g,e=0;if(q>0){if((r<0)&&(q>-r)){e=q+r}}if((r<0)&&(l>c)){r=this.splitViewAdjustChildToFit(this,i,r-e,j);r+=e}if((r!==0)&&(p<f)){r=this.splitViewAdjustChildToFit(this,o,r)}if((r!==0)&&(h<m)){r=this.splitViewAdjustChildToFit(this,n,r)}if(r>0){r=this.splitViewAdjustChildToFit(this,i,r,j)}if(r!==0){r=this.splitViewAdjustChildToFit(this,n,r)}if(r!==0){r=this.splitViewAdjustChildToFit(this,o,r)}}}}()));DG.InertSplitDividerView=SC.View.extend(SC.SplitChild,{classNames:["sc-split-divider-view"],isSplitDivider:YES,autoResizeStyle:"sc-fixed-size",movesSibling:SC.MOVES_CHILD,size:SC.propertyFromRenderDelegate("dividerSize",1),renderDelegateName:"inertSplitDividerRenderDelegate"});SC.BaseTheme.inertSplitDividerRenderDelegate=SC.RenderDelegate.create({className:"split-divider",dividerSize:1,splitPositionOffset:-5,splitSizeOffset:5,render:function(b,a){this.addSizeClassName(b,a);a.push("<div class='line'></div>")},update:function(b,a){this.updateSizeClassName(b,a)}});DG.TableView=DG.HierTableView;sc_require("controllers/component_controller");DG.GameController=DG.ComponentController.extend({openCaseIDs:null,shouldDestroyOnComponentDestroy:false,gameIsReady:true,changeCount:0,savedChangeCount:0,init:function(){arguments.callee.base.apply(this,arguments);this.openCaseIDs=[]},hasUnsavedChanges:function(){return this.get("changeCount")>this.get("savedChangeCount")}.property(),updateSavedChangeCount:function(){this.set("savedChangeCount",this.get("changeCount"))},getOpenCaseIDs:function(b){var d=[],a=(b?false:true);function c(f){d.push(f.get("id"));if(a){var e=f.get("children");e.forEach(function(g){c(g)})}}this.openCaseIDs.forEach(function(f){var e=DG.store.find(DG.Case,f);if(e){c(e)}});DG.ObjectMap.forEach(this._openParentCases,function(e,f){c(f)});return d},doCommand:function(b){var c=this,a;SC.run(function(){a=c.dispatchCommand(b)});return a},dispatchCommand:function(d){var g=null;var b={success:false};if(SC.typeOf(d)===SC.T_STRING){try{g=SC.json.decode(d)}catch(f){DG.logWarn("Invalid JSON in doCommand(), reported from DG.GameController.dispatchCommand()");DG.log("JSON: "+d)}}else{g=d}if(!g){return b}var a=true;switch(g.action){case"initGame":b=this.handleInitGame(g.args);this.set("changeCount",0);this.updateSavedChangeCount();a=false;break;case"createComponent":b=this.handleCreateComponent(g.args);break;case"createCollection":b=this.handleCreateCollection(g.args);break;case"openCase":b=this.handleOpenCase(g.args);break;case"updateCase":b=this.handleUpdateCase(g.args);break;case"closeCase":b=this.handleCloseCase(g.args);break;case"createCase":b=this.handleCreateCase(g.args);break;case"createCases":b=this.handleCreateCases(g.args);break;case"deleteAllCaseData":b=this.handleDeleteAllCaseData(g.args);break;case"logAction":b=this.handleLogAction(g.args);a=false;break;case"reset":b=this.handleReset(g.args);break;case"newCollection":DG.gameSelectionController.processNewCollectionArgs(g.args);var c=[];g.args.attrs.forEach(function(e){c.push(e.name)});this.newCollectionWithAttributes(g.args.name,c);b.success=true;break;case"newCase":this.addCaseToCollectionWithValues(g.args.collection,g.args.values);b.success=true;break;case"requestFormulaObject":b.success=DG.formulaObjectCoordinator.requestFormulaObject(g.args.title,g.args.description,g.args.output,g.args.inputs,g.args.descriptions,g.args.allow_user_variables);a=false;break;case"updateFormulaObject":b.success=DG.formulaObjectCoordinator.updateFormulaObject(g.args.description,g.args.output,g.args.inputs,g.args.descriptions,g.args.allow_user_variables);a=false;break;case"requestFormulaValue":b=DG.formulaObjectCoordinator.requestFormulaValue(g.args.output,g.args);a=false;break;case"requestAttributeValues":b=this.handleRequestAttributeValues(g.args);a=false;break;default:a=false;break}if(a){this.incrementProperty("changeCount")}return b},handleInitGame:function(n){var l=DG.gameSelectionController.get("currentGame"),b=l&&l.get("name"),j,h=[];if(l){DG.ObjectMap.copySome(l,n,function(p){return p!=="name"});j=DG.GameContext.getContextForGame(l);if(n.dimensions){var i=DG.gameSelectionController.get("currentDimensions"),m=i&&i.width,f=i&&i.height,k={width:n.dimensions.width,height:n.dimensions.height};if((m!==k.width)||(f!==k.height)){DG.gameSelectionController.set("currentDimensions",k)}}this.view.set("version",SC.none(l.version)?"":l.version)}function d(p){var q={name:p.name,areParentChildLinksConfigured:true};if(h.length>0){q.parent=h[h.length-1].get("id")}if(p.collapseChildren){q.collapseChildren=true}var r=j.guaranteeCollection(q);if(r){h.push(r);p.attrs.forEach(function(s){r.guaranteeAttribute(s)})}}if(n.collections){n.collections.forEach(d)}if(l){l.notifyPropertyChange("collections");var e=l.get("context"),g=e&&e.get("restoredGameState"),c={operation:"restoreState",args:{state:g}},a=l.get("doCommandFunc"),o=DG.gameSelectionController.findCurrentGameElement(l.get("gameEmbedID"));if(g){if(a){a(c)}else{if(o&&o.doCommandFunc){o.doCommandFunc(SC.json.encode(c))}}}}this.set("gameIsReady",true);if((n.log===undefined)||n.log){DG.logUser("initGame: '%@', Collections: [%@]",b,h.getEach("name").join(", "))}},handleCreateComponent:function(a){return SC.RootResponder.responder.sendAction("createComponentAndView",null,this,null,a)},doCreateCase:function(e,d){var a=DG.gameSelectionController.get("currentGame"),c=DG.GameContext.getContextForGame(a),g=c.getCollectionByName(d.collection),f={},b={success:false};if(!SC.none(d.parent)){f.parent=d.parent}if(!DG.assert(c)){return b}var h={operation:"createCase",properties:f,values:d.values};if(g){h.collection=g}else{DG.logWarn("DG.GameController.doCreateCase: Can't find collection '%@'",d.collection)}b=c.applyChange(h);if(b.success&&((d.log===undefined)||d.log)){DG.logUser("%@: %@ [%@]",e,d.collection,d.values.join(", "))}return b},doCreateCases:function(e,d){var a=DG.gameSelectionController.get("currentGame"),c=DG.GameContext.getContextForGame(a),g=c.getCollectionByName(d.collection),f={},b={success:false};if(!SC.none(d.parent)){f.parent=d.parent}if(!DG.assert(c)){return b}var h={operation:"createCases",properties:f,values:d.values};if(g){h.collection=g}else{DG.logWarn("DG.GameController.doCreateCase: Can't find collection '%@'",d.collection)}b=c.applyChange(h);if(b.success&&((d.log===undefined)||d.log)){DG.logUser("%@: %@ %@ cases created",e,d.collection,d.values.length)}return b},doUpdateCase:function(e,d){var a=DG.gameSelectionController.get("currentGame"),c=DG.GameContext.getContextForGame(a),g=c.getCollectionByName(d.collection),f=DG.store.find(DG.Case,d.caseID),b={success:false};if(g&&f&&d.values){var h={operation:"updateCases",collection:g,cases:[f],values:[d.values]};c.applyChange(h);b.success=true}if((d.log===undefined)||d.log){DG.logUser("%@: %@ [%@]",e,g.get("name"),d.values?d.values.join(", "):"")}return b},handleOpenCase:function(a){var b=this.doCreateCase("openCase",a);if(b.success&&!SC.none(b.caseID)){this.openCaseIDs.pushObject(b.caseID)}return b},handleUpdateCase:function(a){return this.doUpdateCase("updateCase",a)},handleCloseCase:function(a){var b=this.doUpdateCase("closeCase",a);if(!SC.none(a.caseID)){this.openCaseIDs.removeObject(a.caseID)}return b},handleCreateCase:function(a){return this.doCreateCase("createCase",a)},handleCreateCases:function(a){return this.doCreateCases("createCases",a)},handleDeleteAllCaseData:function(a){DG.logUser("deleteAllCaseData by Game");var b=a&&a.preserveAllGames,c=a&&a.preserveOpenEvents;return this.doDeleteAllCaseData(b,!c)},handleReset:function(a){DG.currDocumentController().closeDocument();DG.store=null;DG.currDocumentController().setDocument(DG.currDocumentController().createDocument())},doDeleteAllCaseData:function(c,g){c=c||false;g=g||false;var b=DG.gameSelectionController.get("currentContext"),f=this.getOpenCaseIDs(g),d=null,h=null;if(c){d=b&&b.getCollectionAtIndex(0);if(d){d.getCaseIDs().forEach(function(i){if(f.indexOf(i)===-1){f.push(i)}})}}h=DG.Record.destroyAllRecordsOfType(DG.Case,f);DG.store.commitRecords();var e={operation:"deleteCases",isComplete:true,ids:h},a={success:false};if(b){a=b.applyChange(e)}return a},handleCreateCollection:function(h){DG.gameSelectionController.addCollectionSpecToGameSpecIfNecessary(h.name,h.attrs);var g=DG.gameSelectionController.get("currentGame"),f=DG.GameContext.getContextForGame(g),e={name:h.name,collapseChildren:h.collapseChildren,areParentChildLinksConfigured:true},i=DG.gameSelectionController.getPath("currentGame.collections");if(i&&i.length>1){var b=i[i.length-2],d=b&&f&&f.getCollectionByName(b.name);if(d){e.parent=d.get("id")}}var c=f&&f.applyChange({operation:"createCollection",properties:e,attributes:h.attrs}),a=c&&c.success&&c.collection;if(a){if((h.log===undefined)||h.log){DG.logUser("newCollectionCreated: %@ with %@ attributes",h.name,h.attrs.length)}return{success:true,collectionID:a.get("id")}}else{return{success:false}}},handleLogAction:function(a){if(a.formatStr){var b=[a.formatStr];if(a.replaceArgs){b=b.concat(a.replaceArgs)}DG.logUser.apply(this,b);return{success:true}}return{success:false}},handleRequestAttributeValues:function(m){var l=DG.gameSelectionController.get("currentGame"),k=DG.GameContext.getContextForGame(l),f=k.getCollectionByName(m.collection),b=DG.store.find(DG.Case,m.caseID),h={success:false,values:[]};if(f&&b&&m.attributeNames){var g=f.getAttributeIDs(),a,e,d,c=m.attributeNames.length;for(d=0;d<c;++d){a=f.getAttributeIndexByName(m.attributeNames[d]);e=null;if(a>0&&a<g.length){e=b.getValue(g[a])}h.values.push(e)}h.success=true}return h},newCollectionWithAttributes:function(c,d){DG.logUser("newCollectionCreated: %@ [%@]",c,d.join(", "));var a=DG.gameSelectionController.get("currentGame"),b=DG.GameContext.getContextForGame(a),e=b&&b.guaranteeCollection({name:c});if(e){d.forEach(function(f){e.guaranteeAttribute({name:f})})}if(c==="Weasels"){this.newCollectionWithAttributes("Games",["game"])}if(a){a.notifyPropertyChange("collections")}this.set("gameIsReady",true)},queuedCases:[],addCasesTimer:null,startQueueTime:null,_openGameName:"",_openParentCollectionName:"",_openParentCases:{},openParentCase:function(c,b,d,a){this._openGameName=c;this._openParentCollectionName=d;this._openParentCases[b]=a},closeParentCases:function(){this._openGameName="";this._openParentCollectionName="";this._openParentCases={}},closeParentCase:function(a){this.closeParentCases()},getParentCaseFor:function(a){return this._openParentCases[Object.keys(this._openParentCases).pop()]},addCasesFromQueue:function(){var e=this,a=DG.gameSelectionController.get("currentGame"),c=DG.gameSelectionController.get("currentName"),b=a&&a.get("parentCollectionName"),d=DG.gameCollectionWithName(c,b);this.queuedCases.forEach(function(m){var o=m.collectionName,r=m.values,p=DG.gameCollectionWithName(c,o),n=p&&p.getAttributeIDs(),h=n?n.length:0;DG.logUser("caseCreated: %@ [%@]",o,r.join(", "));if(h>r.length){h=r.length}var q=(o===b);if(c!==e._openGameName){e.closeParentCases()}if(!q&&!SC.none(d)&&SC.none(e._openParentCases[o])){var f=d.createCase();e.openParentCase(c,o,b,f)}var l=null;if(o!==e._openParentCollectionName){var j={};if(!q&&!SC.none(e._openParentCases[o])){j.parent=e._openParentCases[o].get("id")}l=p.createCase(j)}else{l=e.getParentCaseFor(r);if(l){l.beginCaseValueChanges()}}if(l){for(var k=0;k<h;++k){var g=DG.DataUtilities.canonicalizeInputValue(r[k]);l.setValue(n[k],g)}}if((o===e._openParentCollectionName)){e.closeParentCase(r);if(l){l.endCaseValueChanges()}}})},addCaseToCollectionWithValues:function(b,a){var e=this,c;function d(){SC.run(function(){e.addCasesFromQueue();e.queuedCases.length=0})}if(!SC.none(this.addCasesTimer)){this.addCasesTimer.invalidate()}c=(new Date()).valueOf();if(this.queuedCases.length===0){this.startQueueTime=c}this.queuedCases.push({collectionName:b,values:a});this.addCasesTimer=SC.Timer.schedule({action:d,interval:20})},createComponentStorage:function(){var b=DG.gameSelectionController.get("currentGame"),c={};if(b){c.currentGameName=b.get("name");c.currentGameUrl=b.get("url");var a=b.get("context");if(a){this.addLink(c,"context",a)}c.currentGameFormulas=SC.clone(b.get("formulas"))}return c},restoreComponentStorage:function(a,i){var f=this.getPath("model.layout"),g=f?{width:f.width,height:f.height}:null,d=a.currentGameName,b=DG.gameSelectionController.findGameByName(d);if(!b){b=DG.GameSpec.create({name:d,url:a.currentGameUrl});DG.gameSelectionController.prependToGamesMenu([b])}if(b&&!b.get("context")){var h=this.getLinkID(a,"context"),c=h&&DG.DataContext.retrieveContextFromMap(i,h),e=null;if(!c){DG.DataContext.forEachContextInMap(i,function(j,k){if(!c&&k){var l=k.get("gameName");if(l===d){c=k}else{if(!e){e=k}}}});if(!c&&e){c=e}}if(c){b.set("context",c);if(c.get("type")==="DG.GameContext"){c.set("gameSpec",b)}}}if(b&&a.currentGameFormulas){b.set("formulas",a.currentGameFormulas)}DG.gameSelectionController.setCurrentGameByName(d,g);this.set("gameIsReady",true)},logUserAction:function(b,a){DG.logUser(b+(a&&a.length?": ["+a.join(", ")+"]":""))}});DG.currGameController=DG.GameController.create({});DG.doCommand=function(b){var a;SC.run(function(){a=DG.currGameController.dispatchCommand(b)});return a};DG.BaseGameSpec=SC.Object.extend({name:null,url:null,collections:null,dimensions:{width:0,height:0},context:null,collectionName:null,parentCollectionName:null,eventsAttributeName:null,xAttrName:null,xAttrIsNumeric:true,yAttrName:null,yAttrIsNumeric:true,init:function(){arguments.callee.base.apply(this,arguments);this.collections=[]},getCollectionSpecByName:function(b){var d=this.get("collections"),c,a=d&&d.length;for(c=0;c<a;++c){if(d[c].name===b){return d[c]}}return null}});sc_require("models/base_game_spec");DG.GameSpec=DG.BaseGameSpec.extend({childCollection:function(){var c=this.get("collections"),b=(c&&c.length)||0,a=b-1;return(a>=0)?c[a]:null}.property("collections").cacheable(),parentCollection:function(){var c=this.get("collections"),b=(c&&c.length)||0,a=b-2;return(a>=0)?c[a]:null}.property("collections").cacheable(),collectionName:function(){var b=this.get("childCollection"),a=b&&b.name;return !SC.empty(a)?a:null}.property("childCollection").cacheable(),parentCollectionName:function(){var b=this.get("parentCollection"),a=b&&b.name;return !SC.empty(a)?a:null}.property("parentCollection").cacheable(),eventsAttributeName:function(){var b=this.get("parentCollection"),a=b&&b.childAttrName;if(SC.empty(a)){var c=this.get("childCollection");a=c&&c.name}return !SC.empty(a)?a:null}.property("parentCollection","childCollection").cacheable(),getAttrType:function(b,e){var c,d=b.attrs.length;for(c=0;c<d;++c){var a=b.attrs[c];if(a&&(a.name===e)){return a.type}}return null},graphDefaults:function(){var a=this.get("childCollection");return a&&a.defaults}.property("childCollection").cacheable(),xAttrName:function(){var a=this.get("graphDefaults");return a&&a.xAttr}.property("graphDefaults").cacheable(),xAttrIsNumeric:function(){var c=this.get("childCollection"),a=this.get("xAttrName"),b=this.getAttrType(c,a);return b==="numeric"}.property("childCollection","xAttrName").cacheable(),yAttrName:function(){var a=this.get("graphDefaults");return a&&a.yAttr}.property("graphDefaults").cacheable(),yAttrIsNumeric:function(){var c=this.get("childCollection"),a=this.get("yAttrName"),b=this.getAttrType(c,a);return b==="numeric"}.property("childCollection","yAttrName").cacheable(),legendAttrName:function(){var a=this.get("graphDefaults");return a&&a.legendAttr}.property("graphDefaults").cacheable(),legendAttrIsNumeric:function(){var c=this.get("childCollection"),a=this.get("legendAttrName"),b=this.getAttrType(c,a);return b==="numeric"}.property("childCollection","legendAttrName").cacheable()});sc_require("models/game_spec");DG.gameSelectionController=SC.ObjectController.create((function(){var a=0;return{baseGames:[DG.GameSpec.create({name:"Please choose an activity",dimensions:{width:300,height:20},url:""}),DG.GameSpec.create({name:"DataInteractive",dimensions:{width:650,height:550},url:"data_interactive/index"}),DG.GameSpec.create({name:"Analytics",dimensions:{width:650,height:550},url:"analytics/index"})],currentGame:null,currentName:function(){return this.getPath("currentGame.name")}.property("currentGame").cacheable(),requestedDimensions:null,currentDimensions:function(){return this.getPath("currentGame.dimensions")}.property("currentGame").cacheable(),currentUrl:function(){return this.getPath("currentGame.url")}.property("currentGame").cacheable(),currentContext:function(){return this.getPath("currentGame.context")}.property("currentGame","currentGame.context"),menuPane:null,init:function(){arguments.callee.base.apply(this,arguments);this.buildGamesMenu(DG.IS_SRRI_BUILD,DG.IS_DEV_BUILD);this.menuPane=SC.MenuPane.create({items:this.games,itemTitleKey:"name",layout:{width:200}});this.setDefaultGame()},prependToGamesMenu:function(c){var b=c.concat([DG.BaseGameSpec.create({name:null,isSeparator:true})],this.games);this.games=b;this.menuPane.set("items",b)},buildGamesMenu:function(d,c){this.games=[];if(!SC.empty(DG.urlParamGames)){var b=SC.json.decode(DG.urlParamGames);if(SC.none(b.length)){b=[b]}b.forEach(function(f){if(!SC.empty(f.name)&&!SC.empty(f.url)){var e=DG.GameSpec.create(f);if(e){this.games.push(e)}}}.bind(this));if(this.games.length>0){this.games.push(DG.BaseGameSpec.create({name:null,isSeparator:true}))}}this.games=this.games.concat(this.get("baseGames"));if(d||c){this.games=this.games.concat(this.get("srriGames"))}if(c){this.games=this.games.concat(this.get("devGames"))}},loginDidChange:function(){var b=DG.authorizationController.get("isUserDeveloper");this.buildGamesMenu(DG.IS_SRRI_BUILD||b,DG.IS_DEV_BUILD||b);this.menuPane.set("items",this.games)}.observes("DG.authorizationController.isUserDeveloper"),setDefaultGame:function(b){var c=null;if(!SC.empty(b)){c=this.findGameByName(b)}if(!c&&!SC.empty(DG.defaultGameName)){c=this.findGameByName(DG.defaultGameName)}if(!c){c=this.games[a];if(c){DG.defaultGameName=c.get("name")}}if(c){this.beginPropertyChanges();this.set("requestedDimensions",null);this.set("currentGame",c);this.endPropertyChanges()}},currentGameDidChange:function(){if(DG.currGameController){DG.currGameController.set("gameIsReady",false)}}.observes("currentGame"),gameSelected:function(f,d,e){var c=f.get(d),b=c&&c.get("name");if(c&&!SC.empty(b)){this.set("requestedDimensions",null);if(this.get("currentGame")===c){this.notifyPropertyChange("currentGame");return}this.setPath("menuPane.selectedItem",null);DG.appController.closeDocumentWithConfirmation(b)}}.observes(".menuPane.selectedItem"),setCurrentGameByName:function(d,c){var b=this.findGameByName(d);if(b){this.beginPropertyChanges();this.set("requestedDimensions",c);this.set("currentGame",b);this.menuPane.set("selectedItem",null);this.endPropertyChanges()}},saveCurrentGameState:function(){var f=this.get("currentGame"),d=f&&f.get("context"),g=f&&f.get("doCommandFunc"),c=this.findCurrentGameElement(f&&f.get("gameEmbedID")),e={operation:"saveState"},b;if(d){if(g){b=g(e)}else{if(c&&c.doCommandFunc){b=c.doCommandFunc(SC.json.encode(e));b=this.safeJsonDecode(b,"Invalid JSON found in saveCurrentGameState()")}}if(b&&b.success){d.set("savedGameState",b.state)}}},findCurrentGameElement:function(b){var f=document.getElementsByTagName("iframe"),d=null;if(b){var e,c;for(e=0,c=f.length;e<c&&!d;++e){d=f[e].contentWindow.document.getElementById(b)}}return d},safeJsonDecode:function(f,c){var b;if(SC.typeOf(f)===SC.T_STRING){try{b=SC.json.decode(f)}catch(d){DG.logWarn(c+" [DG.GameSelection.safeJsonDecode]");DG.log("JSON: "+b);b=undefined}}return b},gameViewWillClose:function(){this.menuPane.set("selectedItem",null)},reset:function(){this.games.forEach(function(b){if(b){b.set("context",null);b.set("formulas",null)}});this.menuPane.set("selectedItem",null)},findGameByName:function(b){var d=this.games.length;for(var c=0;c<d;++c){if(this.games[c].name===b){return this.games[c]}}return null},addCollectionSpecToGameSpecIfNecessary:function(b,d){var e=this.get("currentGame"),c=e&&e.get("collections");if(!SC.none(c)){c.push({name:b,attrs:d})}},processNewCollectionArgs:function(d){var b=this.get("currentGame");if(!b){return}var c=d.name,e=d.children,g=d.defaultPlotX,f=d.defaultPlotY;if(!SC.empty(c)){if(b.collections.indexOf(c)<0){b.collections.push(c)}switch(b.collections.length){case 1:if(SC.empty(b.parentCollectionName)){b.parentCollectionName=c}break;case 2:if(SC.empty(b.collectionName)){b.collectionName=c}break;default:}}if(SC.empty(b.eventsAttributeName)&&!SC.empty(e)){b.eventsAttributeName=e}if(SC.empty(b.xAttrName)&&!SC.empty(g)){b.xAttrName=g}if(SC.empty(b.yAttrName)&&!SC.empty(f)){b.yAttrName=f}}}}()));sc_require("components/game/game_controller");sc_require("controllers/game_selection");DG.GameView=SC.WebView.extend({valueBinding:"DG.gameSelectionController.currentUrl",destroy:function(){DG.gameSelectionController.gameViewWillClose();arguments.callee.base.apply(this,arguments)},iframeDidLoad:function(){var b=this.$("iframe")[0];if(b&&b.contentWindow){var a=b.contentWindow,c=DG.currGameController;$(b).attr("allowfullscreen",true).attr("webkitallowfullscreen",true).attr("mozallowfullscreen",true);a.NewCollectionWithAttributes=function(d,e){SC.run(function(){c.newCollectionWithAttributes(d,e)})};a.AddCaseToCollectionWithValues=function(e,d){SC.run(function(){c.addCaseToCollectionWithValues(e,d)})};a.LogUserAction=function(e,d){SC.run(function(){c.logUserAction(e,d)})};a.DoCommand=function(e){var d;SC.run(function(){d=c.doCommand(e)});return SC.json.encode(d)}}else{DG.logWarn("DG.GameView:iframeDidLoad no contentWindow\n")}arguments.callee.base.apply(this,arguments)}});DG.PlotAdornment=SC.Object.extend({model:null,paperSource:null,paper:function(){return this.getPath("paperSource.paper")}.property("paperSource").cacheable(),xAxisView:null,yAxisView:null,parentView:null,myElements:null,layerName:null,layer:function(){var a=this.getPath("paperSource.layerManager");return(a&&this.layerName)?a[this.layerName]:null}.property("paperSource","layerName"),modelPropertiesToObserve:[["willDestroy","detachModel"],["isVisible","updateVisibility"]],concatenatedProperties:["modelPropertiesToObserve"],init:function(){arguments.callee.base.apply(this,arguments);this.myElements=[];this.modelDidChange();this.addObserver("model",this,"modelDidChange")},detachModel:function(){this.set("model",null);this.removeObserver("model",this,"modelDidChange")},destroy:function(){var a=this.getPath("paperSource.layerManager");this.detachModel();this.myElements.forEach(function(b){a.removeElement(b);b.remove()});this.myElements=null;arguments.callee.base.apply(this,arguments)},_observedModel:null,modelDidChange:function(){var a=this.get("modelPropertiesToObserve");if(this._observedModel){if(a){a.forEach(function(c){this._observedModel.removeObserver(c[0],this,c[1])}.bind(this))}this._observedModel=null}var b=this.get("model");if(b){if(a){a.forEach(function(c){b.addObserver(c[0],this,c[1])}.bind(this))}this._observedModel=b}},updateVisibility:function(){if(this.getPath("model.isVisible")){this.updateToModel();this.myElements.forEach(function(a){a.show();if(a.animatable){a.animate({"stroke-opacity":1,opacity:1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}})}else{if(!SC.none(this.myElements)){this.myElements.forEach(function(a){if(a.animatable){a.animate({"stroke-opacity":0,opacity:0},DG.PlotUtilities.kDefaultAnimationTime,"<>",function(){a.hide()})}else{a.hide()}})}}}});sc_require("components/graph/adornments/plot_adornment");DG.ConnectingLineAdornment=DG.PlotAdornment.extend({_dataTip:null,init:function(){arguments.callee.base.apply(this,arguments);this.myElements=[];var a=this.get("parentView");DG.assert(a);this._dataTip=DG.LineDataTip.create({paperSource:this.get("paperSource"),plotView:a,layerName:DG.LayerNames.kDataTip})},wantVisible:function(){return this.getPath("model.isVisible")},invalidateModel:function(){var a=this.get("model");if(a){a.setComputingNeeded()}},updateToModel:function(a){var b=this.get("model");if(SC.none(b)){return}if(b.get("isVisible")){b.recomputeValueIfNeeded();this.updateLine(a)}else{this.hideLines()}},updateVisibility:function(){this.updateToModel(true)},hideLines:function(){var c=this.myElements.length,b=this.get("layer");for(var a=0;a<c;a++){this.myElements[a].animate({"stroke-opacity":0},DG.PlotUtilities.kDefaultAnimationTime,"<>",function(){b.prepareToMoveOrRemove(this);this.remove()})}this.myElements.length=0},updateLine:function(g){var c=this,d=this.getPath("parentView.xAxisView"),i=this.getPath("parentView.yAxisView"),h=this.getPath("model.values"),b=10,e=this.get("paper"),f=this.get("layer");if(!e){this.invokeOnceLater(function(){this.updateLine(g)}.bind(this));return}DG.assert(d&&i);if(!h){return}h.forEach(function(r,l){var n=r?r.length:0,k="M0,0",o=DG.ColorUtilities.calcAttributeColorFromIndex(l%b,b).colorString,m,q,p,j;for(m=0;m<n;++m){q=d.dataToCoordinate(r[m].x);p=i.dataToCoordinate(r[m].y);if(m===0){k="M%@,%@".fmt(q,p)}else{k+=" L%@,%@".fmt(q,p)}}DG.assert(k);j=c.myElements[l];if(!j){j=e.path("");c.myElements.push(j);f.push(j)}j.attr({path:k,"stroke-opacity":0,stroke:o,cursor:"pointer"}).mousedown(function(s){c.get("model").selectParent(l,s.shiftKey)}).hover(function(s){c.showDataTip(s,l)},function(){c.hideDataTip()});if(g){j.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}else{j.attr({"stroke-opacity":1})}});while(this.myElements.length>h.length){var a=this.myElements.pop();f.prepareToMoveOrRemove(a);a.remove()}this.updateSelection()},updateSelection:function(){if(!this.get("paper")){return}var b=this.getPath("model.values")||[],a=this.getPath("model.plotModel.selection");b.forEach(function(f,e){var j=3,d=6,k=f?f.length:0,c=true,g=this.myElements[e],h;if(g){for(h=0;h<k;++h){c=c&&a.indexOf(f[h].theCase)>=0;if(!c){break}}g.attr({"stroke-width":(c?d:j)})}}.bind(this))},showDataTip:function(h,a){if(this._dataTip){var b=this.getPath("model.parents"),c=SC.isArray(b)&&(a<b.length)?b[a]:null,f=c.getPath("collection.name"),d=c.get("children").flatten(),g=SC.isArray(d)?d.get("length"):0,e=(g>0)?d[0].getPath("collection.name"):"";this._dataTip.show({lineIndex:a+1,parentName:f,numChildren:g,childrenName:e},{x:h.offsetX,y:h.offsetY})}},hideDataTip:function(){if(this._dataTip){this._dataTip.hide()}}});DG.PlotAdornmentModel=SC.Object.extend({plotModel:null,isVisible:true,destroy:function(){this.notifyPropertyChange("willDestroy");arguments.callee.base.apply(this,arguments)},createStorage:function(){var a={};a.isVisible=this.get("isVisible")||false;return a},restoreStorage:function(a){this.set("isVisible",a.isVisible||false)}});DG.PlotAdornmentModel.registry={};sc_require("components/graph/adornments/plot_adornment_model");DG.ConnectingLineModel=DG.PlotAdornmentModel.extend({parents:null,_values:null,values:function(b,a){if(a){this._values=a}else{this.recomputeValueIfNeeded()}return this._values}.property(),isComputingNeeded:function(){return this._needsComputing&&this.isVisible},setComputingNeeded:function(){this._needsComputing=true},recomputeValueIfNeeded:function(){if(this.isComputingNeeded()){this.recomputeValue()}},recomputeValue:function(){var c=this.getPath("plotModel.cases"),b=[],a=this.getPath("plotModel.xVarID"),e=this.getPath("plotModel.yVarID");if(!(a&&e)){return}var d={};c.forEach(function(g,i){var k=g.getNumValue(a),h=g.getNumValue(e),f=g.get("parent"),j=f?f.get("id"):"top";if(isFinite(k)&&isFinite(h)){if(!d[j]){d[j]=[];b.push(f)}d[j].push({x:k,y:h,theCase:g})}});DG.ObjectMap.forEach(d,function(g,f){f.sort(function(i,h){return(i.x>h.x)?1:((h.x>i.x)?-1:((i.y>h.y)?1:((h.y>i.y)?-1:0)))})});this.set("parents",b);this._needsComputing=false;this.set("values",DG.ObjectMap.values(d))},_needsComputing:true,selectParent:function(d,e){var a=this.get("parents");if(SC.isArray(a)&&d<a.length){var b=a[d],c={operation:"selectCases",collection:b.get("collection"),cases:[b],select:true,extend:e};this.getPath("plotModel.dataContext").applyChange(c);if(c.select){DG.logUser("lineSelected: %@",d)}else{DG.logUser("lineDeselected: %@",d)}}}});DG.PlotAdornmentModel.registry.connectingLine=DG.ConnectingLineModel;DG.ToolTip=SC.Object.extend({paperSource:null,paper:function(){return this.getPath("paperSource.paper")}.property("paperSource").cacheable(),layerName:null,layer:function(){var a=this.getPath("paperSource.layerManager");return(a&&this.layerName)?a[this.layerName]:null}.property("paperSource","layerName"),text:null,tipOrigin:null,_tipTextElement:null,_tipRectElement:null,_tipShadowElement:null,updateTip:function(){var e=this.get("paper"),l=10,g=5,d=2,m,h,f=15,b,j,i,k,a,c;j=this.tipOrigin.x;i=this.tipOrigin.y;this._tipTextElement.attr({text:this.get("text")});k=DG.RenderingUtilities.getExtentForTextElement(this._tipTextElement,12);a=k.width+10;c=k.height+10;b=c/2+5;m=l+a+d;h=g+d;if(j+m>e.width){j-=(j+m)-e.width}if(i+h+c>e.height){i-=h+c}this._tipTextElement.attr({x:j+f,y:i+b});this._tipShadowElement.attr({path:"M"+(j+m)+" "+(i+h)+" v"+c+" h-"+a});this._tipRectElement.attr({x:j+l,y:i+g,width:a,height:c})},show:function(){var a=this.get("paper"),b=this.get("layer");this.hide();this._tipTextElement=a.text(0,0,"").attr({"text-anchor":"start",opacity:0}).addClass(DG.PlotUtilities.kToolTipTextClassName);this._tipShadowElement=a.path("").addClass(DG.PlotUtilities.kToolTipShadowClassName).attr("stroke-opacity",0);this._tipRectElement=a.rect(0,0,0,0).addClass(DG.PlotUtilities.kToolTipClassName).attr("opacity",0);this.updateTip();b.push(this._tipShadowElement);b.push(this._tipRectElement);b.push(this._tipTextElement);this._tipRectElement.animate({opacity:0.7},DG.PlotUtilities.kToolTipShowTime,"<>");this._tipTextElement.animate({opacity:1},DG.PlotUtilities.kToolTipShowTime,"<>");this._tipShadowElement.animate({"stroke-opacity":0.7},DG.PlotUtilities.kToolTipShowTime,"<>")},hide:function(){var a=this.get("layer");[this._tipShadowElement,this._tipRectElement,this._tipTextElement].forEach(function(b){if(b){a.prepareToMoveOrRemove(b);b.remove()}})}});sc_require("utilities/tool_tip");DG.DataTip=DG.ToolTip.extend({plotLayer:null,plotBinding:".plotLayer.model",caseIndex:null,text:function(){return this.getDataTipText()}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.set("paperSource",this.get("plotLayer"))},show:function(a,c,b){this.set("caseIndex",b);arguments.callee.base.apply(this,arguments)},getDataTipText:function(){return""},handleChanges:function(b){var a=(SC.typeOf(b)===SC.T_NUMBER?SC.IndexSet.create(b):b);if(SC.none(this._myElements)||(this._myElements.length===0)||!(a.contains(this.get("caseIndex")))){return}this.updateTip()}});sc_require("components/graph/adornments/data_tip");DG.LineDataTip=DG.DataTip.extend({info:null,getDataTipText:function(){var a="";if(this.info){a="DG.DataTip.connectingLine".loc(this.info.parentName,this.info.lineIndex,this.info.numChildren,this.info.childrenName)}return a},show:function(b,a){this.info={};this.tipOrigin={};DG.ObjectMap.copy(this.info,b);DG.ObjectMap.copy(this.tipOrigin,a);arguments.callee.base.apply(this,arguments)}});DG.LineLabelMixin={textElement:null,createTextElement:function(){this.textElement=this.get("paper").text(0,0,"").attr({font:"caption","text-anchor":"start",opacity:0});return this.textElement},updateTextToModel:function(h){if(this.myElements===null){this.createElements()}var d=5,k=this.get("valueAxisView"),a=this.get("value"),b=k.dataToCoordinate(a),f=this.get("paper"),e=this.get("valueString"),c=this.get("textElement"),g,j,i={};c.attr({text:e});g=c.getBBox();if(k.get("orientation")==="horizontal"){j=c.attr("text-anchor");i.y=h*f.height;switch(j){case"start":if(g.width+d<f.width-b){i.x=b+d}else{if(g.width+d<b){i.x=b-d;j="end"}else{i.x=d}}break;case"end":if(g.width+d<b){i.x=b-d}else{if(g.width+d<f.width-b){i.x=b+d;j="start"}else{i.x=f.width-d}}break}}else{i.y=b;i.x=f.width/2;j="middle";if(g.height>b){i.y+=g.height/2}else{i.y-=g.height/2}}c.attr({x:i.x,y:i.y,"text-anchor":j})}};sc_require("components/graph/adornments/plot_adornment");DG.MovableLineAdornment=DG.PlotAdornment.extend({kLineSlideCur:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LineSlide.cur",8,8),kLineBotLeft:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LinePivotBotLeft.cur",5,12),kLineBotRight:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LinePivotBotRight.cur",12,12),kLineTopLeft:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LinePivotTopLeft.cur",5,5),kLineTopRight:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LinePivotTopRight.cur",12,5),lineSeg:null,firstSegHit:null,secondSegHit:null,thirdSegHit:null,equation:null,pivot1:null,pivot2:null,modelPropertiesToObserve:[["slope","updateToModel"],["intercept","updateToModel"],["isVertical","updateToModel"],["xIntercept","updateToModel"]],equationString:function(){var c=this;function a(){var h=c.getPath("model.intercept"),n=c.getPath("model.slope"),e=DG.PlotUtilities.findNeededFractionDigits(n,h,c.get("xAxisView"),c.get("yAxisView")),j=DG.Format.number().fractionDigits(0,e.interceptDigits),d=j(h),f=DG.Format.number().fractionDigits(0,e.slopeDigits),l=f(n)+" ",g=(h<0)?" ":" + ",i=c.getPath("yAxisView.model.firstAttributeName"),m=c.getPath("xAxisView.model.firstAttributeName"),k;if(d==="0"){d=g=""}if(l==="1 "){l=""}if(l==="0 "){k="";g=""}else{k=l+m}return i+" = "+k+g+d}function b(){var e=DG.PlotUtilities.findFractionDigitsForAxis(c.get("xAxisView")),f=c.getPath("model.xIntercept"),d=c.getPath("xAxisView.model.label");return d+" = "+DG.Format.number().fractionDigits(0,e)(f)}if(this.getPath("model.isVertical")){return b()}else{return a()}}.property("model.intercept","model.slope","model.isVertical","model.xIntercept","xAxisView.model.firstAttributeName","yAxisView.model.firstAttributeName").cacheable(),createElements:function(){var e=this,k=this.get("xAxisView"),a=this.get("yAxisView"),o,f,q=false;function g(){var t=e.get("equationString");t=t.replace(/\u2212/g,"-");DG.logUser("dragMovableLine: '%@'",t)}function m(){var t={stroke:DG.PlotUtilities.kLineHighlightColor};e.firstSegHit.stop();e.secondSegHit.stop();e.thirdSegHit.stop();e.firstSegHit.animate(t,DG.PlotUtilities.kHighlightShowTime);e.secondSegHit.animate(t,DG.PlotUtilities.kHighlightShowTime);e.thirdSegHit.animate(t,DG.PlotUtilities.kHighlightShowTime)}function i(){var t={stroke:DG.RenderingUtilities.kSeeThrough};if(!q){e.firstSegHit.stop();e.secondSegHit.stop();e.thirdSegHit.stop();e.firstSegHit.animate(t,DG.PlotUtilities.kHighlightHideTime);e.secondSegHit.animate(t,DG.PlotUtilities.kHighlightHideTime);e.thirdSegHit.animate(t,DG.PlotUtilities.kHighlightHideTime)}}function d(v,u){var t={slope:e.getPath("model.slope"),intercept:e.getPath("model.intercept")};o=DG.ViewUtilities.windowToViewCoordinates({x:v,y:u},e.parentView);if(e.getPath("model.isVertical")){o.x=k.dataToCoordinate(e.getPath("model.xIntercept"))}else{o=DG.PlotUtilities.closestScreenPtGivenScreenPtAndWorldLine(o,t,k,a)}f=e.getPath("model.isInterceptLocked");m();q=true}function h(u,t){e.get("model").forceThroughPoint({x:k.coordinateToData(o.x+u),y:a.coordinateToData(o.y+t)})}function s(u,t){e.pivot1=e.pivot2=null;e.updateToModel();g();q=false;i()}function l(u,t){d(u,t)}function p(x,v,t,w){var u=2;if(Math.abs(t.x-w.x)<u){x.x=v.x}else{if(Math.abs(t.y-w.y)<u){x.y=v.y}}e.get("model").forceThroughPoints(e.pivot1,e.pivot2)}function c(w,u){var v={x:o.x+w,y:o.y+u},t={x:k.dataToCoordinate(e.pivot2.x),y:a.dataToCoordinate(e.pivot2.y)};e.pivot1.x=k.coordinateToData(v.x);e.pivot1.y=a.coordinateToData(v.y);if(f){e.get("model").forceThroughOriginAndPoint(e.pivot1)}else{p(e.pivot1,e.pivot2,v,t)}}function b(w,u){var v={x:o.x+w,y:o.y+u},t={x:k.dataToCoordinate(e.pivot1.x),y:a.dataToCoordinate(e.pivot1.y)};e.pivot2.x=k.coordinateToData(v.x);e.pivot2.y=a.coordinateToData(v.y);if(f){e.get("model").forceThroughOriginAndPoint(e.pivot2)}else{p(e.pivot2,e.pivot1,v,t)}}function n(v,u){if(e.pivot1.x>e.pivot2.x){var t=e.pivot1;e.pivot1=e.pivot2;e.pivot2=t}g();q=false;i()}if(this.myElements&&(this.myElements.length>0)){return}var r=this.get("paper"),j=this.get("layer");this.lineSeg=r.line(0,0,0,0).attr({stroke:DG.PlotUtilities.kDefaultMovableLineColor,"stroke-opacity":0});this.lineSeg.animatable=true;this.equation=r.text(0,0,"").attr({font:"caption",opacity:0});this.equation.animatable=true;this.firstSegHit=this.lineSeg.clone().attr({"stroke-width":12,stroke:DG.RenderingUtilities.kSeeThrough}).hover(m,i).drag(c,l,n);this.secondSegHit=this.firstSegHit.clone().attr({cursor:this.kLineSlideCur}).hover(m,i).drag(h,d,s);this.thirdSegHit=this.firstSegHit.clone().hover(m,i).drag(b,l,n);this.lineSeg.node.setAttribute("shape-rendering","geometric-precision");this.myElements=[this.lineSeg,this.equation,this.firstSegHit,this.secondSegHit,this.thirdSegHit];this.myElements.forEach(function(t){j.push(t)});return this.myElements},updateToModel:function(){if(this.myElements===null){this.createElements()}var j=this.get("xAxisView"),a=this.get("yAxisView"),m=this.get("model"),s=m.get("slope"),f=m.get("isInterceptLocked"),t=m.get("intercept"),k=j.getPath("model.lowerBound"),o=j.getPath("model.upperBound"),p=a.getPath("model.lowerBound"),u=a.getPath("model.upperBound"),i=(m.get("isVertical"))?{pt1:{x:m.get("xIntercept"),y:p},pt2:{x:m.get("xIntercept"),y:u}}:DG.PlotUtilities.lineToAxisIntercepts(s,t,j.get("model"),a.get("model"));function b(v){return{x:j.dataToCoordinate(v.x),y:a.dataToCoordinate(v.y)}}function g(){var v=i.pt1;i.pt1=i.pt2;i.pt2=v}if(i.pt2.x<i.pt1.x){g()}var q=b({x:(i.pt1.x+i.pt2.x)/2,y:(i.pt1.y+i.pt2.y)/2}),r=this.get("paper").width,c=this.get("paper").height,n,l,h,d,e;if(f){if((k<=0)&&(o>=0)&&(p<=0)&&(u>=0)){n={x:0,y:0};l=n}else{if(s>=0){if((u<0)||(o<0)){n=l=i.pt2}else{n=l=i.pt1}}else{if((p>0)||(o<0)){n=l=i.pt2}else{n=l=i.pt1}}}}else{n={x:i.pt1.x+(3/8)*(i.pt2.x-i.pt1.x),y:i.pt1.y+(3/8)*(i.pt2.y-i.pt1.y)};l={x:i.pt1.x+(5/8)*(i.pt2.x-i.pt1.x),y:i.pt1.y+(5/8)*(i.pt2.y-i.pt1.y)}}if(SC.none(this.pivot1)||!DG.MathUtilities.isInRange(this.pivot1.x,k,o)||!DG.MathUtilities.isInRange(this.pivot1.y,p,u)){this.pivot1=i.pt1}if(SC.none(this.pivot2)||!DG.MathUtilities.isInRange(this.pivot2.x,k,o)||!DG.MathUtilities.isInRange(this.pivot2.y,p,u)){this.pivot2=i.pt2}DG.RenderingUtilities.updateLine(this.lineSeg,b(i.pt1),b(i.pt2));DG.RenderingUtilities.updateLine(this.firstSegHit,b(i.pt1),b(n));DG.RenderingUtilities.updateLine(this.secondSegHit,b(n),b(l));DG.RenderingUtilities.updateLine(this.thirdSegHit,b(l),b(i.pt2));if(s>0){this.firstSegHit.attr({cursor:this.kLineBotLeft});this.thirdSegHit.attr({cursor:this.kLineTopRight})}else{this.firstSegHit.attr({cursor:this.kLineTopLeft});this.thirdSegHit.attr({cursor:this.kLineBotRight})}h=this.equation.attr({text:this.get("equationString")}).getBBox();d=h.width;d+=10;if(q.x<r/2){e="start";q.x=Math.min(q.x,r-d)}else{e="end";q.x=Math.max(q.x,d)}q.y+=h.height/2;q.y=Math.min(Math.max(q.y,h.height/2),c-h.height/2);this.equation.attr({x:q.x,y:q.y,"text-anchor":e,text:this.get("equationString")})},updateVisibility:function(){if(this.getPath("model.isVisible")){this.pivot1=this.pivot2=null}arguments.callee.base.apply(this,arguments)}});sc_require("components/graph/adornments/plot_adornment_model");DG.MovableLineModel=DG.PlotAdornmentModel.extend({slope:null,intercept:null,isVertical:false,xIntercept:null,isInterceptLocked:function(b,a){if(a!==undefined){this._interceptLocked=a;if(a){this.set("intercept",0)}}return this._interceptLocked}.property(),isComputingNeeded:function(b,a){if(this._needsComputing){return true}if(this.isVertical){this._needsComputing=(this.xIntercept<b.get("lowerBound"))||(this.xIntercept>b.get("upperBound"))}else{this._needsComputing=!DG.PlotUtilities.lineIntersectsPlotArea(this.slope,this.intercept,b,a)}return this._needsComputing},recomputeSlopeAndIntercept:function(f,c){var b=f.get("lowerBound"),e=f.get("upperBound"),a=c.get("lowerBound"),d=c.get("upperBound");e=b+(e-b)/2;if(!this.get("isInterceptLocked")){this.beginPropertyChanges();this.set("slope",(d-a)/(e-b));this.set("intercept",a-this.slope*b);this.set("isVertical",false);this.set("xIntercept",null);this.endPropertyChanges()}else{this.forceThroughOriginAndPoint({x:e,y:(d+a)/2})}this._needsComputing=false},recomputeSlopeAndInterceptIfNeeded:function(b,a){if(this.isComputingNeeded(b,a)){this.recomputeSlopeAndIntercept(b,a)}},toggleInterceptLocked:function(){this.set("isInterceptLocked",!this._interceptLocked)},forceThroughPoint:function(b){if(this.isVertical){this.set("xIntercept",b.x)}else{var a=this.get("slope"),c=b.y-a*b.x;this.set("intercept",c)}},forceThroughPoints:function(c,b){if(c.x===b.x){this.beginPropertyChanges();this.set("isVertical",true);this.set("xIntercept",c.x);this.set("slope",null);this.set("intercept",null);this.endPropertyChanges()}else{var a=(b.y-c.y)/(b.x-c.x);this.beginPropertyChanges();this.set("slope",a);this.set("intercept",c.y-a*c.x);this.set("isVertical",false);this.set("xIntercept",null);this.endPropertyChanges()}},forceThroughOriginAndPoint:function(a){this.forceThroughPoints(a,{x:0,y:0})},_needsComputing:null,_interceptLocked:null,init:function(){arguments.callee.base.apply(this,arguments);this.slope=1;this.intercept=0;this.isVertical=false;this.xIntercept=null;this._interceptLocked=false;this._needsComputing=true},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);DG.ObjectMap.copy(a,{intercept:this.get("intercept"),slope:this.get("slope"),isInterceptLocked:this.get("isInterceptLocked"),isVertical:this.get("isVertical"),xIntercept:this.get("xIntercept")});return a},restoreStorage:function(a){arguments.callee.base.apply(this,arguments);this.set("intercept",a.intercept);this.set("slope",a.slope);this.set("isInterceptLocked",a.isInterceptLocked);this.set("isVertical",a.isVertical);this.set("xIntercept",a.xIntercept)}});DG.ValueAxisViewMixin={valueAxisView:null,_observedAxisModel:null,_observedAxisView:null,initMixin:function(){this.axisViewDidChange();this.addObserver("valueAxisView",this,"axisViewDidChange")},destroyMixin:function(){this.set("valueAxisView",null);this.removeObserver("valueAxisView",this,"axisViewDidChange")},axisModelDidChange:function(){if(this._observedAxisModel){this._observedAxisModel.removeObserver("lowerBound",this,"updateToModel");this._observedAxisModel.removeObserver("upperBound",this,"updateToModel");this._observedAxisModel=null}var a=this.getPath("valueAxisView.model");if(a){a.addObserver("lowerBound",this,"updateToModel");a.addObserver("upperBound",this,"updateToModel");this._observedAxisModel=a}},axisViewDidChange:function(){if(this._observedAxisView){this._observedAxisView.removeObserver("model",this,"axisModelDidChange");this._observedAxisView.removeObserver("pixelMin",this,"updateToModel");this._observedAxisView.removeObserver("pixelMax",this,"updateToModel");this._observedAxisView=null}this.axisModelDidChange();var a=this.get("valueAxisView");if(a){a.addObserver("model",this,"axisModelDidChange");a.addObserver("pixelMin",this,"updateToModel");a.addObserver("pixelMax",this,"updateToModel");this._observedAxisView=a}},updateToModel:function(){}};sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/line_label_mixin");sc_require("components/graph/adornments/value_axis_view_mixin");DG.MovableValueAdornment=DG.PlotAdornment.extend(DG.LineLabelMixin,DG.ValueAxisViewMixin,{kLineSlideHCur:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LineSlideH.cur",8,8),kLineSlideVCur:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LineSlide.cur",8,8),lineSeg:null,coverSeg:null,value:function(){return this.getPath("model.value")}.property("model.value"),valueString:function(){var d=this.get("value"),a=DG.PlotUtilities.findFractionDigitsForAxis(this.get("valueAxisView")),c=DG.Format.number().fractionDigits(0,a),b=this.getPath("valueAxisView.model.firstAttributeName");return b+" = "+c(d)}.property("model.value","valueAxisView.model.firstAttributeName").cacheable(),modelPropertiesToObserve:[["value","updateToModel"]],createElements:function(){var d=this,i=this.get("layer"),b;function f(l,k){var m=DG.ViewUtilities.windowToViewCoordinates({x:l,y:k},d.parentView);b=(d.getPath("valueAxisView.orientation")==="horizontal")?m.x:m.y}function h(o,n){var l=d.get("valueAxisView"),k=(l.get("orientation")==="horizontal")?o:n,m=l.coordinateToData(b+k);d.setPath("model.value",m)}function a(l,k){DG.logUser("dragMovableValue: '%@'",d.get("valueString"))}function c(){var k={stroke:DG.PlotUtilities.kLineHighlightColor};d.coverSeg.stop();d.coverSeg.animate(k,DG.PlotUtilities.kHighlightShowTime)}function j(){var k={stroke:DG.RenderingUtilities.kSeeThrough};d.coverSeg.stop();d.coverSeg.animate(k,DG.PlotUtilities.kHighlightHideTime)}if(this.myElements&&(this.myElements.length>0)){return}var e=this.get("paper"),g=(this.getPath("valueAxisView.orientation")==="horizontal")?this.kLineSlideHCur:this.kLineSlideVCur;this.lineSeg=e.line(0,0,0,0).attr({stroke:DG.PlotUtilities.kDefaultMovableLineColor,"stroke-opacity":0});this.coverSeg=this.lineSeg.clone().attr({"stroke-width":5,stroke:DG.RenderingUtilities.kSeeThrough,cursor:g,title:"Drag the value"}).hover(c,j).drag(h,f,a);this.myElements=[this.lineSeg,this.coverSeg];this.myElements.push(this.createTextElement());this.lineSeg.animatable=true;this.textElement.animatable=true;this.lineSeg.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>");this.textElement.animate({opacity:1},DG.PlotUtilities.kDefaultAnimationTime,"<>");this.myElements.forEach(function(k){i.push(k)})},updateToModel:function(){if(this.myElements===null){this.createElements()}var c=this.get("valueAxisView"),f=this.getPath("model.value"),b=c&&c.dataToCoordinate(f),a=this.get("paper"),e,d;if(!c){return}if(this.getPath("model.isVisible")){if(c.get("orientation")==="horizontal"){e={x:b,y:a.height};d={x:b,y:0}}else{e={x:0,y:b};d={x:a.width,y:b}}DG.RenderingUtilities.updateLine(this.lineSeg,e,d);DG.RenderingUtilities.updateLine(this.coverSeg,e,d);this.updateTextToModel(1/3)}}});sc_require("components/graph/adornments/plot_adornment_model");DG.MovableValueModel=DG.PlotAdornmentModel.extend({value:1,_needsComputing:true,isComputingNeeded:function(a){if(this._needsComputing){return true}this._needsComputing=(this.value<a.get("lowerBound"))||(this.value>a.get("upperBound"));return this._needsComputing},setComputingNeeded:function(){this._needsComputing=true},recomputeValue:function(b){var a=b.get("lowerBound"),c=b.get("upperBound");this.set("value",a+(c-a)/3);this._needsComputing=false},recomputeValueIfNeeded:function(a){if(this.isComputingNeeded(a)){this.recomputeValue(a)}},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);if(this.get("isVisible")){a.value=this.get("value")}return a},restoreStorage:function(a){arguments.callee.base.apply(this,arguments);if(a&&a.value){this.set("value",a.value)}}});DG.PlotAdornmentModel.registry.movableValue=DG.MovableValueModel;sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/line_label_mixin");DG.PlottedAverageLogString="";DG.PlottedAverageAdornment=DG.PlotAdornment.extend(DG.LineLabelMixin,{cellGap:2,hoverWidth:5,hoverDelay:10,symSize:3,symStrokeWidth:1,bgStroke:"black",bgFill:"gray",bgStrokeWidth:0.5,titlePrecision:2,titleFraction:1/5,shadingLayerName:"",shadingLayer:function(){var a=this.getPath("paperSource.layerManager");return(a&&this.layerName)?a[this.shadingLayerName]:null}.property("paperSource","shadingLayerName"),wantVisible:function(){return this.getPath("model.isVisible")},updateToModel:function(b){var a=this.get("model");if(a&&a.get("isVisible")){if(!this.textElement){this.createTextElement();this.textElement.attr("opacity",1)}a.recomputeValueIfNeeded();this.updateSymbols(b)}},updateTextElement:function(b,d,c,e,a){DG.assert(this.textElement);if(b&&DG.isFinite(d)){this.value=c;this.valueString=this.titleString(d);this.valueAxisView=this.getPath("parentView.primaryAxisView");this.updateTextToModel(e);this.textElement.show();this.textShowingForID=a}else{this.valueString="";this.valueAxisView=null;this.textElement.hide();this.textShowingForID=undefined}},updateHoverLog:function(a){if(a!==DG.PlottedAverageLogString){DG.PlottedAverageLogString=a;DG.logUser("%@: %@","hoverOverGraphLine",DG.PlottedAverageLogString)}},getTextPositionOnAxis:function(a,b){return a},updateSymbols:function(d){var y=this,l=this.get("layer"),x=this.get("shadingLayer"),m=this.getPath("parentView.primaryAxisView"),b=this.getPath("parentView.secondaryAxisView"),n=m&&(m.get("orientation")==="horizontal"),u=this.getPath("model.values"),j=u&&u.length,z=this.myElements.length;DG.assert(j>0);var A=this.get("paper"),c=(j?(Math.abs(b.get("pixelMax")-b.get("pixelMin"))/j):0),o={x:0,y:0,symSize:this.symSize,cellHeight:c-this.cellGap},v=-3*this.symSize;var f,t,s,h,r;var a,g,w,e=3;function q(){var i={stroke:y.hoverColor};this.stop();this.animate(i,y.hoverDelay);if(this.textStatValue!==y.value){y.updateHoverLog(y.statisticKey+"="+this.textStatValue)}y.updateTextElement(true,this.textStatValue,this.textAxisPosition,this.textCrossPosition,this.id)}function k(){var i={stroke:DG.RenderingUtilities.kTransparent};this.stop();this.animate(i,DG.PlotUtilities.kHighlightHideTime);y.updateTextElement(false)}for(s=0;s<j;++s){r=u[s][this.statisticKey];f=u[s][this.centerKey];h=u[s][this.spreadKey];t=(isFinite(f)?m.dataToCoordinate(f):v);o.width=(isFinite(h)?Math.abs(m.dataToCoordinate(f+h)-t):0);o.x=(n?t:s*c);o.y=(n?(s+1)*c:t);if(s*e>=z){w=A.path("M0,0").attr({stroke:this.bgStroke,"stroke-width":this.bgStrokeWidth,fill:this.bgFill,"fill-opacity":0.5});a=A.path("M0,0").attr({stroke:this.symStroke,"stroke-width":this.symStrokeWidth,"stroke-opacity":0});g=A.path("M0,0").attr({"stroke-width":this.hoverWidth,stroke:DG.RenderingUtilities.kTransparent}).hover(q,k);w.animatable=a.animatable=true;w.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>");a.animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>");this.myElements.push(w);this.myElements.push(a);this.myElements.push(g);x.push(w);l.push(a);l.push(g)}w=this.myElements[s*e];a=this.myElements[s*e+1];g=this.myElements[s*e+2];if(d){w.animate({path:this.backgroundPath(o,n)},DG.PlotUtilities.kDefaultAnimationTime,"<>");a.animate({path:this.symbolPath(o,n)},DG.PlotUtilities.kDefaultAnimationTime,"<>")}else{w.attr({path:this.backgroundPath(o,n)});a.attr({path:this.symbolPath(o,n)})}g.attr("path",this.coverPath(o,n));g.textStatValue=r;g.textAxisPosition=this.getTextPositionOnAxis(f,h);g.textCrossPosition=((1/j)*(s+this.titleFraction));a.toFront();g.toFront();if(this.textElement){this.textElement.toFront()}if(this.textShowingForID===g.id){this.updateTextElement(true,g.textStatValue,g.textAxisPosition,g.textCrossPosition,g.id)}}if(this.myElements.length>(e*j)){this.removeExtraSymbols(e*j)}DG.assert(this.myElements.length===e*u.length)},removeExtraSymbols:function(d){var e=this.get("layer"),f=this.get("shadingLayer"),c,b,a;for(c=d,b=this.myElements.length;c<b;++c){a=this.myElements[c];e.prepareToMoveOrRemove(a);f.prepareToMoveOrRemove(a);a.remove()}this.myElements.length=d},symbolPath:function(b,a){if(a){return"M%@,%@ v%@".fmt(b.x,b.y,-(b.cellHeight))}else{return"M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight)}},coverPath:function(b,a){if(a){return"M%@,%@ v%@".fmt(b.x,b.y,-(b.cellHeight))}else{return"M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight)}},backgroundPath:function(b,a){return"M0,0"},titleString:function(b){DG.assert(isFinite(b));var a=this.titlePrecision+(this.get("model.precision")||0);return this.titleResource.loc(b.toFixed(a))}});DG.PlottedMeanAdornment=DG.PlottedAverageAdornment.extend({statisticKey:"mean",centerKey:"mean",titleResource:"DG.PlottedAverageAdornment.meanValueTitle",hoverColor:"rgba(0, 0, 255, 0.3)",symStroke:"#00F",symStrokeWidth:1.5});DG.PlottedMedianAdornment=DG.PlottedAverageAdornment.extend({statisticKey:"median",centerKey:"median",titleResource:"DG.PlottedAverageAdornment.medianValueTitle",hoverColor:"rgba(255, 0, 0, 0.3)",symStroke:"#F00",symStrokeWidth:1.5});DG.PlottedStDevAdornment=DG.PlottedAverageAdornment.extend({bgFill:"#9980FF",bgStroke:"#9980FF",bgStrokeWidth:0.5,symStrokeWidth:1,symStroke:"#30F",statisticKey:"stdev",centerKey:"stDevMinus1",spreadKey:"stdev",titleResource:"DG.PlottedAverageAdornment.stDevValueTitle",symHeight:0.6,hoverColor:"rgba(48, 0, 255, 0.3)",symbolPath:function(b,a){if(a){return"M%@,%@ v%@ M%@,%@ v%@".fmt(b.x,b.y,-b.cellHeight,b.x+2*b.width,b.y,-b.cellHeight)}else{return"M%@,%@ h%@ M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight,b.x,b.y-2*b.width,b.cellHeight)}},backgroundPath:function(e,c){var a=e.x,f=e.y,b=e.width,d=e.cellHeight;if(c){return"M%@,%@ v%@ h%@ v%@ z M%@,%@ v%@".fmt(a,f,-d,2*b,d,a+b,f,-d)}else{return"M%@,%@ h%@ v%@ h%@ z M%@,%@ h%@".fmt(a,f,d,-2*b,-d,a,f-b,d)}},coverPath:function(b,a){return this.symbolPath(b,a)},getTextPositionOnAxis:function(a,b){return a+2*b}});DG.PlottedIQRAdornment=DG.PlottedAverageAdornment.extend({statisticKey:"IQR",centerKey:"Q1",spreadKey:"IQR",titleResource:"DG.PlottedAverageAdornment.iqrValueTitle",hoverColor:"rgba(255, 48, 0, 0.3)",bgStroke:"#FFb280",bgStrokeWidth:0.5,bgFill:"#FFb280",symStroke:"#F30",symStrokeWidth:1,symbolPath:function(b,a){if(a){return"M%@,%@ v%@ M%@,%@ v%@".fmt(b.x,b.y,-b.cellHeight,b.x+b.width,b.y,-b.cellHeight)}else{return"M%@,%@ h%@ M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight,b.x,b.y-b.width,b.cellHeight)}},coverPath:function(b,a){if(a){return"M%@,%@ v%@ M%@,%@ v%@".fmt(b.x,b.y,-b.cellHeight,b.x+b.width,b.y,-b.cellHeight)}else{return"M%@,%@ h%@ M%@,%@ h%@".fmt(b.x,b.y,b.cellHeight,b.x,b.y-b.width,b.cellHeight)}},backgroundPath:function(b,a){if(a){return"M%@,%@ v%@ h%@ v%@ z".fmt(b.x,b.y,-b.cellHeight,b.width,b.cellHeight)}else{return"M%@,%@ h%@ v%@ h%@ z".fmt(b.x,b.y,b.cellHeight,-b.width,-b.cellHeight)}},getTextPositionOnAxis:function(a,b){return a+b}});sc_require("components/graph/adornments/plot_adornment_model");DG.PlottedAverageModel=DG.PlotAdornmentModel.extend({values:null,precision:0,isComputingNeeded:function(){return this._needsComputing&&this.isVisible},setComputingNeeded:function(){this._needsComputing=true},recomputeValueIfNeeded:function(){if(this.isComputingNeeded()){this.recomputeValue()}},recomputeValue:function(){},_needsComputing:true});DG.PlottedMeanStDevModel=DG.PlottedAverageModel.extend({computeSumCountMean:function(){var b=this.getPath("plotModel.cases"),h=this.getPath("plotModel.primaryVarID"),e=this.getPath("plotModel.primaryAxisModel"),f=this.getPath("plotModel.secondaryVarID"),g=this.getPath("plotModel.secondaryAxisModel");if(!(g&&e)){return null}var k=g.get("numberOfCells");var a=[];var d,c;for(d=0,c=k;d<c;++d){a.push({sum:0,sumOfSquares:0,count:0,mean:undefined,stdev:undefined})}b.forEach(function(l,m){var o=l.getNumValue(h),j=l.getStrValue(f),i=g.cellNameToCellNumber(j);if(i!==null&&DG.MathUtilities.isInIntegerRange(i,0,a.length)){var n=a[i];if(isFinite(o)){n.sum+=o;n.sumOfSquares+=(o*o);n.count+=1}}});a.forEach(function(i){if(i.count>0){i.mean=i.sum/i.count}});return a}});DG.PlottedMeanModel=DG.PlottedMeanStDevModel.extend({recomputeValue:function(){var b=this.computeSumCountMean();if(b){var a=this.getPath("plotModel.primaryAxisModel");this.set("precision",a.getPath("attributeDescription.attribute.precision"));this.set("values",b);this._needsComputing=false}}});DG.PlotAdornmentModel.registry.plottedMean=DG.PlottedMeanModel;DG.PlottedStDevModel=DG.PlottedMeanStDevModel.extend({recomputeValue:function(){var b=this.computeSumCountMean();b.forEach(function(c){if(c.count>0){c.stdev=Math.sqrt((c.sumOfSquares/c.count)-(c.mean*c.mean));c.stDevMinus1=c.mean-c.stdev}});if(b){var a=this.getPath("plotModel.primaryAxisModel");this.set("precision",a.getPath("attributeDescription.attribute.precision"));this.set("values",b);this._needsComputing=false}}});DG.PlotAdornmentModel.registry.plottedStDev=DG.PlottedStDevModel;DG.PlottedQuantileModel=DG.PlottedAverageModel.extend({collectCellValsAndMedian:function(){var g=this.getPath("plotModel.cases"),e=this.getPath("plotModel.primaryVarID"),f=this.getPath("plotModel.secondaryVarID"),d=this.getPath("plotModel.secondaryAxisModel");if(!d){return}var b=d.get("numberOfCells"),h=[],c,a;for(c=0,a=b;c<a;++c){h.push({vals:[],median:undefined})}g.forEach(function(k,l){var n=k.getNumValue(e),j=k.getStrValue(f),i=d.cellNameToCellNumber(j);if(i!==null&&DG.MathUtilities.isInIntegerRange(i,0,h.length)){var m=h[i];if(isFinite(n)){m.vals.push(n)}}});h.forEach(function(i){if(i.vals.length>0){i.median=DG.MathUtilities.medianOfNumericArray(i.vals)}});return h}});DG.PlottedMedianModel=DG.PlottedQuantileModel.extend({recomputeValue:function(){var a=this.collectCellValsAndMedian();this.set("values",a);this._needsComputing=false}});DG.PlotAdornmentModel.registry.plottedMedian=DG.PlottedMedianModel;DG.PlottedIQRModel=DG.PlottedQuantileModel.extend({recomputeValue:function(){var a=this.collectCellValsAndMedian();a.forEach(function(b){if(b.vals.length>0){b.Q1=DG.MathUtilities.quantileOfSortedArray(b.vals,0.25);b.Q3=DG.MathUtilities.quantileOfSortedArray(b.vals,0.75);b.IQR=(b.Q3-b.Q1)}});this.set("values",a);this._needsComputing=false}});DG.PlotAdornmentModel.registry.plottedIQR=DG.PlottedIQRModel;sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/value_axis_view_mixin");DG.PlottedCountAdornment=DG.PlotAdornment.extend(DG.ValueAxisViewMixin,{marginX:10,marginY:15,textColor:"#315B7D",numCellsOnX:1,numCellsOnY:1,numCellsOnSecondary:1,xIsPrimaryAxis:true,modelPropertiesToObserve:[["values","updateToModel"]],wantVisible:function(){return this.getPath("model.isVisible")},updateToModel:function(a){var b=this.get("model");if(b&&b.get("isVisible")){b.recomputeValueIfNeeded();this.updateSymbols(a)}},updateSymbols:function(r){var f=this.getPath("model.values"),m=f.length,l=this.myElements.length;this.updateNumCells();if(m!==(this.numCellsOnX*this.numCellsOnY)){if(m>0){DG.logWarn("DG.PlottedCountAdornment.updateSymbols has mismatch of %@ values and %@ cells",m,(this.numCellsOnX*this.numCellsOnY))}this.removeExtraSymbols(0);return}var n=this.get("paper"),p=this.get("layer"),e=(this.numCellsOnY?n.height/this.numCellsOnY:n.height),h=(this.numCellsOnX?n.width/this.numCellsOnX:n.width);var c,d,a,b,k;for(k=0;k<m;++k){var j=Math.floor(k/this.numCellsOnSecondary),g=k%this.numCellsOnSecondary,q=(this.xIsPrimaryAxis?j:g),o=(this.xIsPrimaryAxis?g:j);b=(k>=l);c=f[k];DG.assert(c.primaryCell===j&&c.secondaryCell===g,"unexpected cell arrangement");d={x:((q+1)*h)-this.marginX,y:this.marginY+(o*e),text:c.count.toString(),title:this.getTitle(c.count,c.percent)};if(b){a=n.text(d.x,d.y,d.text);a.attr({title:d.title,"text-anchor":"end",fill:this.textColor});this.myElements.push(a);p.push(a);a.attr({opacity:0}).animate({opacity:1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}else{a=this.myElements[k];a.attr(d)}}if(m<this.myElements.length){this.removeExtraSymbols(m)}DG.assert(this.myElements.length===f.length)},removeExtraSymbols:function(d){var e=this.get("layer"),c,b,a;for(c=d,b=this.myElements.length;c<b;++c){a=this.myElements[c];e.prepareToMoveOrRemove(a);a.remove();a=null}this.myElements.length=d},getTitle:function(b,a){var c=(b===1?"DG.DataContext.singleCaseName".loc():"DG.DataContext.pluralCaseName".loc());return"DG.PlottedCountAdornment.title".loc(b,c,a.toFixed(0))},updateNumCells:function(){var b=this.get("parentView"),d=b.get("primaryAxisView"),c=b.get("secondaryAxisView"),a=b.get("xAxisView"),e=b.get("yAxisView");this.xIsPrimaryAxis=(d?(d.get("orientation")==="horizontal"):true);if(d){if(this.xIsPrimaryAxis){a=d}else{e=d}}if(c){if(this.xIsPrimaryAxis){e=c}else{a=c}}this.numCellsOnX=a.get("numberOfCells")||1;this.numCellsOnY=e.get("numberOfCells")||1;this.numCellsOnSecondary=this.xIsPrimaryAxis?this.numCellsOnY:this.numCellsOnX;DG.assert(this.numCellsOnX>0,"expecting 1+ cells in X");DG.assert(this.numCellsOnY>0,"expecting 1+ cells in Y")}});sc_require("components/graph/adornments/plot_adornment_model");DG.PlottedCountModel=DG.PlotAdornmentModel.extend({values:null,plotModel:null,isComputingNeeded:function(){return this._needsComputing&&this.get("isVisible")},setComputingNeeded:function(){this._needsComputing=true},recomputeValueIfNeeded:function(){if(this.isComputingNeeded()){this.recomputeValue()}},recomputeValue:function(){DG.assert(this.plotModel&&this.plotModel.getCellCaseCounts);var b=0,a=this.plotModel.getCellCaseCounts();a.forEach(function(c){b+=c.count});a.forEach(function(c){if(b>0&&c.count>0){c.percent=100*c.count/b}else{c.percent=0}});this.set("values",a);this._needsComputing=false},_needsComputing:true});DG.PlotAdornmentModel.registry.plottedCount=DG.PlottedCountModel;sc_require("components/graph/adornments/plot_adornment");DG.PlottedFunctionAdornment=DG.PlotAdornment.extend({modelPropertiesToObserve:[["expression","updateToModel"],["dependentChange","updateToModel"]],curve:null,createElements:function(){if(this.myElements&&(this.myElements.length>0)){return}this.curve=this.get("paper").path("").attr({stroke:"red"});this.curve.animatable=true;this.myElements.push(this.curve);this.get("layer").push(this.curve)},updateToModel:function(){if(!this.getPath("model.isVisible")){return}this.createElements();var g=this.get("xAxisView"),m=this.get("yAxisView"),b=g.get("pixelMin"),e=g.get("pixelMax"),f=1,i,l=this.get("model"),c="",k,j,h,a=[];if(l){try{for(i=b;i<=e;i+=f){k=g.coordinateToData(i);j=l.evaluate(k);if(DG.isFinite(j)){h=m.dataToCoordinate(j);a.push({top:h,left:i})}}}catch(d){}if(a.length>0){c="M"+a[0].left+","+a[0].top+DG.SvgScene.curveBasis(a)}}this.curve.attr({path:c})}});DG.PlottedFunctionAdornment.createFormulaEditView=function(a){return DG.FormulaTextEditView.create({layout:{height:20},borderStyle:SC.BORDER_BEZEL,isVisible:false,hint:"Type an expression e.g. x*x/30 - 50",leftAccessoryView:SC.LabelView.create({layout:{left:0,width:25,height:20,centerY:0},value:"y =",backgroundColor:"gray"}),keyDown:function(b){var c=b.which;if(c===SC.Event.KEY_RETURN){this.completeEditing();return YES}if(c===SC.Event.KEY_ESC){this.discardEditing();return YES}return arguments.callee.base.apply(this,arguments)},commitEditing:function(){var b=arguments.callee.base.apply(this,arguments);if(b){a.set("expression",this.get("formulaExpression"));DG.logUser("plotFunction: '%@'",this.get("formulaExpression"))}this.parentView.displayDidChange();return b}})};DG.UNICODE={PLUS_SIGN:"+",MINUS_SIGN:"\u2212",MULTIPLICATION_SIGN:"\u00D7",DIVISION_SIGN:"\u00F7",EQUALS_SIGN:"=",NOT_EQUAL_TO:"\u2260",LESS_THAN_OR_EQUAL_TO:"\u2264",GREATER_THAN_OR_EQUAL_TO:"\u2265",GREEK_SMALL_LETTER_ALPHA:"\u03B1",GREEK_SMALL_LETTER_BETA:"\u03B2",GREEK_SMALL_LETTER_GAMMA:"\u03B3",GREEK_SMALL_LETTER_DELTA:"\u03B4",GREEK_SMALL_LETTER_EPSILON:"\u03B5",GREEK_SMALL_LETTER_ZETA:"\u03B6",GREEK_SMALL_LETTER_ETA:"\u03B7",GREEK_SMALL_LETTER_THETA:"\u03B8",GREEK_SMALL_LETTER_IOTA:"\u03B9",GREEK_SMALL_LETTER_KAPPA:"\u03BA",GREEK_SMALL_LETTER_LAMDA:"\u03BB",GREEK_SMALL_LETTER_MU:"\u03BC",GREEK_SMALL_LETTER_NU:"\u03BD",GREEK_SMALL_LETTER_XI:"\u03BE",GREEK_SMALL_LETTER_OMICRON:"\u03BF",GREEK_SMALL_LETTER_PI:"\u03C0",GREEK_SMALL_LETTER_RHO:"\u03C1",GREEK_SMALL_LETTER_FINAL_SIGMA:"\u03C2",GREEK_SMALL_LETTER_SIGMA:"\u03C3",GREEK_SMALL_LETTER_TAU:"\u03C4",GREEK_SMALL_LETTER_UPSILON:"\u03C5",GREEK_SMALL_LETTER_PHI:"\u03C6",GREEK_SMALL_LETTER_CHI:"\u03C7",GREEK_SMALL_LETTER_PSI:"\u03C8",GREEK_SMALL_LETTER_OMEGA:"\u03C9",INFINITY:"\u221E"};DG.VarReferenceError=function(a){this.name="VarReferenceError";this.message="DG.Formula.VarReferenceError.message".loc(a);this.description="DG.Formula.VarReferenceError.description".loc(a);this.reference=a};DG.VarReferenceError.prototype=new Error();DG.VarReferenceError.prototype.constructor=DG.VarReferenceError;DG.FuncReferenceError=function(a){this.name="FuncReferenceError";this.message="DG.Formula.FuncReferenceError.message".loc(a);this.description="DG.Formula.FuncReferenceError.description".loc(a);this.reference=a};DG.FuncReferenceError.prototype=new Error();DG.FuncReferenceError.prototype.constructor=DG.FuncReferenceError;DG.FuncArgsError=function(a,c){var b=c&&c.min,d=c&&c.max;this.name="FuncArgsError";if((b===1)&&(b===d)){this.message="DG.Formula.FuncArgsErrorSingle.message".loc(a,b);this.description="DG.Formula.FuncArgsErrorSingle.description".loc(a,b)}else{if((b>=0)&&!SC.none(d)&&(b!==d)){this.message="DG.Formula.FuncArgsErrorRange.message".loc(a,b,d);this.description="DG.Formula.FuncArgsErrorRange.description".loc(a,b,d)}else{this.message="DG.Formula.FuncArgsErrorPlural.message".loc(a,b);this.description="DG.Formula.FuncArgsErrorPlural.description".loc(a,b)}}this.reference=a};DG.FuncArgsError.prototype=new Error();DG.FuncArgsError.prototype.constructor=DG.FuncArgsError;DG.ObjectMap={length:function(a){return Object.keys(a||{}).length},keys:function(a){return Object.keys(a||{})},values:function(a){var b=[];DG.ObjectMap.forEach(a,function(c,d){b.push(d)});return b},copy:function(b,a){DG.ObjectMap.forEach(a,function(c,d){b[c]=d})},copySome:function(c,b,a){DG.ObjectMap.forEach(b,function(d,e){if(a(d,e)){c[d]=e}})},forEach:function(a,c){if(!a){return}for(var b in a){if(a.hasOwnProperty(b)){c(b,a[b])}}},firstKey:function(a){return DG.ObjectMap.findKey(a,function(b,c){return true})},findKey:function(b,e){if(!b||!e){return undefined}var c,a=e;if(SC.typeOf(e)!==SC.T_FUNCTION){c=String(e);a=function(f,g){return f===c}}for(var d in b){if(b.hasOwnProperty(d)&&a(d,b[d])){return d}}return undefined},findValue:function(a,c){var b=c;return DG.ObjectMap.findKey(a,function(d,e){return e===b})},insert:function(a,b,c){a[b]=c},remove:function(a,b){var c=b?a[b]:undefined;delete a[b];return c}};sc_require("formula/formula_common");sc_require("utilities/object_map");DG.FormulaContext=SC.Object.extend((function(){var a=function(c,b,e){var d=e&&e[c];if(d&&(b.length<d.min)){throw new DG.FuncArgsError(c,d)}};return{clearCaches:function(){},compileVariable:function(b){switch(b){case"pi":case"π":return"Math.PI";case"e":return"Math.E";default:var c=this.get("eVars");if(c&&(c[b]!==undefined)){return"e."+b}var d=this.get("vars");if(d&&(d[b]!==undefined)){return"c.vars."+b}}return"(function(){throw new DG.VarReferenceError("+b+");})()"},evaluateVariable:function(c,d){switch(c){case"pi":case"π":return Math.PI;case"e":return Math.E;default:var b=d&&d[c];if(b!==undefined){return b}var e=this.get("vars");if(e&&(e[c]!==undefined)){return e[c]}}throw new DG.VarReferenceError(c)},hasAggregates:false,fnNames:[],_fns:{"boolean":function(b){return Boolean(b)},frac:function(b){return b-this.trunc(b)},ln:function(b){return Math.log(b)},log:function(b){return Math.log(b)/Math.LN10},number:function(b){return Number(b)},random:function(c,b){if(SC.none(c)){return Math.random()}if(SC.none(b)){return c*Math.random()}return c+(b-c)*Math.random()},round:function(b,d){if(SC.none(d)){return Math.round(b)}var c=Math.pow(10,this.trunc(d));return Math.round(c*b)/c},string:function(b){return String(b)},trunc:function(b){return b<0?Math.ceil(b):Math.floor(b)}},_fnsArgs:{"boolean":{min:1,max:1},frac:{min:1,max:1},ln:{min:1,max:1},log:{min:1,max:1},number:{min:1,max:1},random:{min:0,max:2},round:{min:1,max:2},string:{min:1,max:1},trunc:{min:1,max:1}},_MathArgs:{abs:{min:1,max:1},acos:{min:1,max:1},asin:{min:1,max:1},atan:{min:1,max:1},atan2:{min:2,max:2},ceil:{min:1,max:1},cos:{min:1,max:1},exp:{min:1,max:1},floor:{min:1,max:1},pow:{min:2,max:2},sin:{min:1,max:1},sqrt:{min:1,max:1},tan:{min:1,max:1}},compileFunction:function(c,b){var e=this.get("_fns");if(e&&typeof e[c]==="function"){a(c,b,this.get("_fnsArgs"));return"c._fns."+c+"("+b+")"}if(typeof Math[c]==="function"){a(c,b,this._MathArgs);return"Math."+c+"("+b+")"}var d=this.get("fns");if(d&&typeof d[c]==="function"){a(c,b,this.get("fnsArgs"));return"c.fns."+c+"("+b+")"}return"(function(){throw new DG.FuncReferenceError("+c+");})()"},evaluateFunction:function(c,b){var e=this.get("_fns");if(e&&typeof e[c]==="function"){a(c,b,this.get("_fnsArgs"));return e[c].apply(e,b)}if(typeof Math[c]==="function"){a(c,b,this._MathArgs);return Math[c].apply(Math,b)}var d=this.get("fns");if(d&&typeof d[c]==="function"){a(c,b,this.get("fnsArgs"));return d[c].apply(d,b)}throw new DG.FuncReferenceError(c)}}}()));DG.FormulaContext.createContextFunction=function(a){return new Function("c","e","return "+a)};DG.FormulaContext.registerFnModule=function(a){var b=DG.FormulaContext.prototype.fnNames;b.push.apply(b,DG.ObjectMap.keys(a));b.sort()};DG.FormulaContext.registerFnModule(DG.FormulaContext.prototype._fns);DG.FormulaContext.registerFnModule(DG.FormulaContext.prototype._MathArgs);DG.FormulaContext.getFunctionNamesWithParentheses=function(){var a=DG.FormulaContext.prototype.fnNames;return a.map(function(b){return b+"()"})};sc_require("formula/formula_context");DG.GlobalFormulaContext=DG.FormulaContext.extend({init:function(){arguments.callee.base.apply(this,arguments);DG.globalsController.addObserver("globalNameChanges",this,"globalNamesDidChange");DG.globalsController.addObserver("globalValueChanges",this,"globalValuesDidChange")},destroy:function(){DG.globalsController.removeObserver("globalNameChanges",this,"globalNamesDidChange");DG.globalsController.removeObserver("globalValueChanges",this,"globalValuesDidChange");arguments.callee.base.apply(this,arguments)},compileVariable:function(a){var b=DG.globalsController.getGlobalValueByName(a);if(b){if(!this.g){this.g={}}this.g[a]=function(){return b.get("value")};return'c.g["'+a+'"]()'}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,b){var c=DG.globalsController.findGlobalByName(a);if(c){this.g[a]=true;return c.get("value")}return arguments.callee.base.apply(this,arguments)},globalNamesDidChange:function(){this.notifyPropertyChange("namespaceChange")},globalValuesDidChange:function(){var c=DG.globalsController.get("globalValueChanges"),a,b=c&&c.length;for(a=0;a<b;++a){if(this.g&&this.g[c[a]]){this.notifyPropertyChange("dependentChange");return}}}});sc_require("formula/global_formula_context");sc_require("components/graph/adornments/plot_adornment_model");DG.PlottedFunctionContext=DG.GlobalFormulaContext.extend({isXAxisName:function(a){var b=this.getPath("dataConfiguration.xAttributeDescription.attribute.name");return !SC.empty(b)&&(a===b)},compileVariable:function(a){if((a==="x")||this.isXAxisName(a)){return"e.x"}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,b){if((a==="x")||this.isXAxisName(a)){return b&&b.x}return arguments.callee.base.apply(this,arguments)}});DG.PlottedFunctionModel=DG.PlotAdornmentModel.extend({_expression:null,expression:function(a,b){if(b!==undefined){if(SC.empty(b)){this._expression=null}else{if(SC.none(this._expression)){this.createDGFormula(b)}else{this._expression.set("source",b)}}return this}return(this._expression&&this._expression.get("source"))||""}.property(),destroy:function(){if(this._expression){this.destroyDGFormula()}arguments.callee.base.apply(this,arguments)},createDGFormula:function(a){this._expression=DG.Formula.create({context:DG.PlottedFunctionContext.create(),source:a});this._expression.setPath("context.dataConfiguration",this.get("dataConfiguration"));this._expression.addObserver("dependentChange",this,"dependentDidChange")},destroyDGFormula:function(){this._expression.removeObserver("dependentChange",this,"dependentDidChange");this._expression.destroy();this._expression=null},dependentDidChange:function(a,b){this.notifyPropertyChange(b)},globalNamesDidChange:function(){if(this._expression){this._expression.invalidate()}}.observes("DG.globalsController.globalNameChanges"),evaluate:function(a){if(!this._expression){return}return this._expression.evaluate({x:a})},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);a.expression=this.get("expression");return a},restoreStorage:function(a){arguments.callee.base.apply(this,arguments);this.set("expression",a.expression)}});DG.PlotAdornmentModel.registry.plottedValue=DG.PlottedFunctionModel;DG.PlotAdornmentModel.registry.plottedFunction=DG.PlottedFunctionModel;sc_require("components/graph/adornments/plot_adornment");sc_require("components/graph/adornments/line_label_mixin");DG.PlottedValueAdornment=DG.PlotAdornment.extend(DG.LineLabelMixin,{valueSegment:null,valueAxisView:null,value:function(){return this.getValueToPlot()}.property(),valueString:function(){var c=this.get("value");if(c instanceof Error){return c.message}var a=DG.PlotUtilities.findFractionDigitsForAxis(this.get("valueAxisView")),b=DG.Format.number().fractionDigits(0,a);return DG.isFinite(c)?b(c):(c&&c.toString())}.property(),modelPropertiesToObserve:[["expression","updateToModel"],["dependentChange","updateToModel"]],createElements:function(){if(this.myElements&&(this.myElements.length>0)){return}var a=this.get("layer");this.myElements=[];this.valueSegment=this.get("paper").path("").attr({stroke:"red"});this.myElements.push(this.valueSegment);this.myElements.push(this.createTextElement());this.myElements.forEach(function(b){a.push(b)})},updateToModel:function(){if(!this.myElements||(this.myElements.length===0)){this.createElements()}var c=this.get("valueAxisView"),a=this.get("paper"),f,b,e,d;f=this.getValueToPlot();if(isFinite(f)){b=c.dataToCoordinate(f);if(c.get("orientation")==="horizontal"){e={x:b,y:a.height};d={x:b,y:0}}else{e={x:0,y:b};d={x:a.width,y:b}}DG.RenderingUtilities.updateLine(this.valueSegment,e,d)}else{this.valueSegment.attr({path:""})}this.updateTextToModel(1/4)}.observes("DG.globalsController.globalNameChanges"),getValueToPlot:function(){var a=this.get("model"),c=NaN;try{if(a){c=a.evaluate()}}catch(b){c=b}return c}});DG.PlottedValueAdornment.createFormulaEditView=function(a){return DG.FormulaTextEditView.create({layout:{height:20},borderStyle:SC.BORDER_BEZEL,isVisible:false,value:a.get("expression"),leftAccessoryView:SC.LabelView.create({layout:{left:0,width:45,height:20,centerY:0},value:"value =",backgroundColor:"gray"}),keyDown:function(b){var c=b.which;if(c===SC.Event.KEY_RETURN){this.parentView.displayDidChange();return this.commitEditing()}return arguments.callee.base.apply(this,arguments)},commitEditing:function(){var b=arguments.callee.base.apply(this,arguments);if(b){var c=this.get("formulaExpression");DG.logUser("plotValue: '%@'",c);a.set("expression",c)}return b}})};sc_require("components/graph/adornments/data_tip");DG.PointDataTip=DG.DataTip.extend({caseIndex:null,getDataTipText:function(){var h=this,g=this.getPath("plot.cases"),e=g?g[this.get("caseIndex")]:null;function a(n){var r=h.get("plot").getPath("dataConfiguration."+n+"AttributeDescription"),q=r.get("attributes"),j=h.getPath("plotLayer.plotIndex");j=(j<q.length)?j:0;var p=q[j],o=(typeof(p)==="object")?p.get("id"):null,l,k,i,m;if(!SC.none(o)){l=p.get("name");k=e&&e.getValue(o);if(SC.none(k)){return null}if(r.get("isNumeric")){i=(n==="legend")?DG.PlotUtilities.findFractionDigitsForRange(r.getPath("attributeStats.minMax")):DG.PlotUtilities.findFractionDigitsForAxis(h.getPath("plotLayer."+n+"AxisView"));m=DG.Format.number().fractionDigits(0,i);k=m(e.getNumValue(o))}else{k=e.getStrValue(o)}return l+": "+k}return null}if(SC.none(e)){return""}var d=a("x"),f=a("y"),b=a("legend"),c;c=SC.none(d)?"":d;if(!SC.none(f)){if(c.length>0){c+="\n"}c+=f}if(!SC.none(b)){if(c.length>0){c+="\n"}c+=b}return c},show:function(a,c,b){this.set("tipOrigin",{x:a,y:c});this.set("caseIndex",b);arguments.callee.base.apply(this,arguments)},handleChanges:function(b){var a=(SC.typeOf(b)===SC.T_NUMBER?SC.IndexSet.create(b):b);if(!a.contains(this.get("caseIndex"))){return}this.updateTip()}});DG.AxisModel=SC.Object.extend({attributeDescription:null,labels:function(){var b=this.attributeDescription,a=[];if(b){b.get("attributes").forEach(function(d){if(d!==DG.Analysis.kNullAttribute){var c=d.get("name"),f=d.get("unit"),e=c+(!SC.empty(f)?" ("+f+")":"");a.push(e)}})}return a}.property("attributeDescription.attribute"),labelDescription:function(){return this.getPath("attributeDescription.attribute.description")||""}.property("attributeDescription.attribute"),getLabelDescription:function(a){var b=this.getPath("attributeDescription.attributes");return(a<b.length)?b[a].get("description"):""},firstAttributeName:function(){var a=this.getPath("attributeDescription.attributes");if(SC.isArray(a)&&(a.length>0)){return a[0].get("name")}return""}.property("attributeDescription.attributes"),numberOfCells:function(){return 1}.property().cacheable(),axisAnimator:null,cellNameToCellNumber:function(a){return 0},isNumeric:null,setLowerAndUpperBounds:function(){},stopAnimation:function(){var a=this.get("axisAnimator");if(!SC.none(a)){a.endAnimation()}}});DG.GraphDropTarget={kDropFrameClass:"graph-drop-frame",kDropHintClass:"graph-drop-hint",kDropBoxClass:"graph-drop-box",blankDropHint:"",isDropTarget:true,dragData:null,computeDragOperations:function(a){if(this.isValidAttribute(a)){return SC.DRAG_LINK}else{return SC.DRAG_NONE}},dragEntered:function(a,b){this.borderFrame.addClass("graph-drop-frame-fill");this.showDropHint()},dragExited:function(a,b){this.borderFrame.removeClass("graph-drop-frame-fill");this.hideDropHint()},acceptDragOperation:function(){return YES},isValidAttribute:function(c){var a=c.data.attribute,b=this.get("plottedAttribute");return SC.none(b)||(b!==a)},dragStarted:function(f){var e=3,c=this.get("paper"),b;function g(i){return SC.empty(i)||i==="undefined"}if(this.isValidAttribute(f)){b={x:e,y:e,width:c.width-2*e,height:c.height-2*e};if(this.get("isVertical")){b.y+=18+2*e;b.height-=18+2*e}if(SC.none(this.borderFrame)){this.borderFrame=c.path("").addClass(this.kDropFrameClass)}this.borderFrame.attr({path:DG.RenderingUtilities.pathForFrame(b)}).show();var h=f.data.attribute.get("name"),d=this.getPath("plottedAttribute.name"),a=g(d)?this.get("blankDropHint").loc(h):"DG.GraphView.replaceAttribute".loc(d,h);this.set("dropHintString",a)}},dragEnded:function(){if(this.borderFrame){this.borderFrame.hide()}},borderFrame:null,dropHintString:null,dropHintElement:null,dropHintBox:null,isVertical:function(){return this.get("orientation")==="vertical"}.property(),showDropHint:function(){if(SC.empty(this.dropHintString)){return}var b=this.get("paper"),e=3,a=b.width/2,d=b.height/2;if(!this.dropHintElement){this.dropHintBox=b.rect(0,0,0,0,3).addClass(this.kDropBoxClass).attr("stroke-width",0);this.dropHintElement=b.text(a,d,this.dropHintString).addClass(this.kDropHintClass)}this.dropHintBox.transform("");this.dropHintElement.transform("");this.dropHintElement.attr({text:this.dropHintString,x:a,y:d});var c=this.dropHintElement.getBBox();this.dropHintBox.attr({x:c.x-e,y:c.y-e,width:c.width+2*e,height:c.height+2*e});if(this.isVertical()){this.dropHintBox.transform("R-90");this.dropHintElement.transform("R-90")}this.dropHintBox.toFront().show();this.dropHintElement.toFront().show()},hideDropHint:function(){if(this.dropHintElement){this.dropHintElement.hide();this.dropHintBox.hide()}},performDragOperation:function(a,b){this.set("dragData",a.data);return SC.DRAG_LINK}};sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.AxisMultiTarget=DG.RaphaelBaseView.extend(DG.GraphDropTarget,{attributeDescription:null,otherAttributeDescription:null,plottedAttribute:function(){return this.getPath("attributeDescription.attribute")}.property(),otherPlottedAttribute:function(){return this.getPath("otherAttributeDescription.attribute")}.property(),plusArea:null,desiredExtent:function(){return{width:this.getPath("parentView.layout.width"),height:24}}.property(),dragEntered:function(a,b){this.plusArea.addClass("graph-drop-plus-fill");this.set("backgroundColor",Raphael.color("rgba(100%,100%,0%,50%)"));this.showDropHint()},dragExited:function(a,b){this.plusArea.removeClass("graph-drop-plus-fill");this.set("backgroundColor",null);this.hideDropHint()},isValidAttribute:function(d){var a=d.data.attribute,b=this.get("plottedAttribute"),c=this.get("otherPlottedAttribute");return(c!==DG.Analysis.kNullAttribute)&&(b!==DG.Analysis.kNullAttribute)&&(b!==a)},dragStarted:function(e){var h=3,c=24;function d(){return"M-6,-18 h6 v6 h6 v6 h-6 v6 h-6 v-6 h-6 v-6 h6 v-6Z"}if(this.isValidAttribute(e)){this.set("isVisible",true);var b=c/2+h,g=b+2*h;if(SC.none(this.plusArea)){this.plusArea=this._paper.path(d()).addClass(this.kDropFrameClass)}this.plusArea.transform("").transform("T"+b+","+g).show();var f=e.data.attribute.get("name"),a="DG.GraphView.addAttribute".loc(f);this.set("dropHintString",a)}},dragEnded:function(){if(this.plusArea){this.plusArea.hide()}this.set("isVisible",false)}});sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.AxisView=DG.RaphaelBaseView.extend(DG.GraphDropTarget,{displayProperties:["model.attributeDescription.attribute","model.attributeDescription.attributeStats.categoricalStats.numberOfCells"],model:null,orientation:null,plottedAttribute:function(){return this.getPath("model.attributeDescription.attribute")}.property(),blankDropHint:"DG.GraphView.addToEmptyPlace",desiredExtent:function(){var a=this.get("labelExtent"),b=(Raphael.version<"2.0")?"y":((this.get("orientation")==="horizontal")?"y":"x");return a[b]}.property("labelNode"),pixelMin:function(){return(this.get("orientation")==="vertical")?this.get("drawHeight"):0}.property("drawHeight"),pixelMax:function(){return(this.get("orientation")==="vertical")?0:this.get("drawWidth")}.property("drawWidth"),labelExtent:function(){var d=DG.RenderingUtilities.kCaptionFontHeight,b=this.get("labelNode"),a={x:d,y:d};if(!SC.none(b)){var c=b.getBBox();a={x:isNaN(c.width)?d:Math.max(d,c.width),y:isNaN(c.height)?d:Math.max(d,Math.ceil(c.height/2)*2)}}return a}.property("labelNode").cacheable(),isNumeric:null,labelNodes:function(){var g=this,f=false,e=0,b=this.get("orientation")==="vertical"?-90:0,c,a,d;if(SC.none(this._paper)){return[]}c=this.getPath("model.labels");c.forEach(function(j,i){var h="blue";if(i>0){j=": "+j;h=DG.ColorUtilities.calcAttributeColorFromIndex(i,c.length).colorString}if(e>=g._labelNodes.length){d=g._paper.text(0,0,"").addClass("axis-label");DG.RenderingUtilities.rotateText(d,b,0,0);g._labelNodes.push(d);f=true}else{d=g._labelNodes[e]}d.attr("fill",h);if(j!==d.attr("text")){a=g.get("model").getLabelDescription(i);a+="—Click to change "+g.orientation+" axis attribute";d.attr({text:j,title:a});f=true}e++});while(g._labelNodes.length>e){g._labelNodes.pop().remove();f=true}if(f){this.notifyPropertyChange("labelNode",this._labelNodes)}return this._labelNodes}.property("model.labels"),labelNode:function(){var a=this.get("labelNodes");return(a.length>0)?a[0]:null}.property("labelNodes"),_labelNodes:null,init:function(){arguments.callee.base.apply(this,arguments);this._labelNodes=[]},renderLabel:function(){var d=this.get("labelNodes"),h=this.get("drawWidth"),b=this.get("drawHeight"),e=this.get("orientation")==="vertical",c=e?-90:0,f=0,a=d.map(function(j){var i=j.getBBox();f+=e?i.height:i.width;return{node:j,box:i}}),g=e?((b+f)/2):((h-f)/2);a.forEach(function(j){var l=j.node,k=j.box,i={x:k.width,y:k.height},m={};if(e){m.x=i.x/4+2;m.y=g-i.y/2;g-=i.y}else{m.x=g+i.x/2;m.y=b-i.y/2-2;g+=i.x}l.attr({x:m.x,y:m.y});DG.RenderingUtilities.rotateText(l,c,m.x,m.y)})},dragData:null,performDragOperation:function(a,b){this.set("dragData",a.data);return SC.DRAG_LINK},drawWidth:function(){var a=this.get("frame").width;if(this.get("orientation")==="horizontal"){a-=2*DG.ViewUtilities.kBorderWidth}return a}.property("frame"),drawHeight:function(){var a=this.get("frame").height;if(this.get("orientation")==="vertical"){a-=2*DG.ViewUtilities.kBorderWidth}return a}.property("frame"),numberOfCells:function(){return this.getPath("model.numberOfCells")}.property("model.numberOfCells"),fullCellWidth:function(){var a=this.get("numberOfCells");return Math.abs(this.get("pixelMax")-this.get("pixelMin"))/a}.property("numberOfCells","pixelMax","pixelMin"),cellWidth:function(){var c=this.get("numberOfCells"),b=this.get("pixelMin"),f=this.get("pixelMax"),h=0.9,g=c+0.5,e=0,a=g-e,d=Math.abs((f-b)/a);return d*h}.property("numberOfCells","pixelMax","pixelMin"),cellToCoordinate:function(a){var b=this.get("numberOfCells"),c=Math.abs((a+0.5)/b*(this.get("pixelMax")-this.get("pixelMin")));return c},cellNameToCoordinate:function(a){return this.cellToCoordinate(this.model.cellNameToCellNumber(a))},forEachTickDo:function(){},dataToCoordinate:function(c){var a=this.get("pixelMin"),b=this.get("pixelMax");return a+c*(b-a)},coordinateToData:function(b){var a=this.get("pixelMin"),c=this.get("pixelMax");return(b-a)/(c-a)}});sc_require("components/graph/axes/axis_model");DG.CellAxisModel=DG.AxisModel.extend({numberOfCells:function(){return Math.max(1,this.getPath("attributeDescription.attributeStats.numberOfCells"))}.property("attributeDescription.attributeStats.numberOfCells"),maxCellNameLength:function(){var a=0;this.forEachCellDo(function(c,b){a=Math.max(a,b.length)});return a}.property("attributeDescription.attributeStats.cellMap"),isNumeric:false,cellNameToCellNumber:function(b){var a=this.getPath("attributeDescription.attributeStats");return a?a.cellNameToCellNumber(b):0},forEachCellDo:function(d){var a=this.getPath("attributeDescription.attributeStats.cellMap"),c=DG.ObjectMap.keys(a),b=0;if(c.length===0){d(0,"",0,0)}else{c.forEach(function(e){var h=a[e],g=h.length,f=0;d(b++,e,g,f)})}}});sc_require("components/graph/axes/axis_view");DG.CellAxisView=DG.AxisView.extend((function(){var b=4,c=2;return{desiredExtent:function(){var d=arguments.callee.base.apply(this,arguments);if(!this.get("isNumeric")){d+=b+c+this.get("maxLabelExtent")}return d}.property("maxLabelExtent"),isNumeric:false,axisLineCoordinate:function(){return(this.get("orientation")==="vertical")?this.get("drawWidth"):0}.property("drawWidth"),maxLabelExtent:0,renderAxisLine:function(){var f=this.get("axisLineCoordinate"),d=this.get("pixelMin"),h=this.get("pixelMax"),e,g;switch(this.get("orientation")){case"vertical":e={x:f-1,y:d};g={x:f-1,y:h};break;case"horizontal":e={x:d,y:f+1};g={x:h,y:f+1};break}return this._paper.line(e.x,e.y,g.x,g.y).attr({stroke:DG.PlotUtilities.kAxisColor,strokeWidth:2})},whichCell:function(f){var g=this.getPath("model.numberOfCells"),e=0;if(g>1){var d=this.get("pixelMin"),h=this.get("pixelMax");if(this.get("orientation")==="vertical"){f=Math.min(Math.max(h+1,f),d-1);e=Math.floor((f-h)*g/(d-h))}else{f=Math.max(Math.min(h-d-1,f),1);e=Math.floor(f*g/(h-d))}}return e},doDraw:function a(){var k=this,o=this.get("model"),j=k.get("axisLineCoordinate"),f=this.get("orientation"),d=(f==="horizontal")?0:-90,l=DG.RenderingUtilities.kDefaultFontHeight,m=l,h=[],n=false,i;function g(r,t){var s=k.cellToCoordinate(r),q=k._paper.text(0,0,t),p=DG.RenderingUtilities.getExtentForTextElement(q,DG.RenderingUtilities.kDefaultFontHeight);if(!isFinite(s)){q.remove();return}h.push({element:q,coord:s,height:p.height,width:p.width});l=Math.max(l,p.height);m=Math.max(m,p.width);k._elementsToClear.push(q);if(SC.none(i)){n=p.width>k.get("fullCellWidth")}else{n=n||(s-p.width/2<i)}i=(s+p.width/2)}function e(r){var p=r.coord,s,q;switch(k.get("orientation")){case"vertical":k._elementsToClear.push(k._paper.line(j,p,j-b,p).attr({stroke:DG.PlotUtilities.kAxisColor}));s=j-b-c-r.height/3;q=p;if(d===0){s-=r.width/2}break;case"horizontal":k._elementsToClear.push(k._paper.line(p,j,p,j+b).attr({stroke:DG.PlotUtilities.kAxisColor}));s=p+1;q=j+b+c+r.height/3;if(d===-90){q+=r.width/2}break}r.element.attr({x:s,y:q});DG.RenderingUtilities.rotateText(r.element,d,s,q)}if(this.getPath("model.maxCellNameLength")<=3){d=0}this._elementsToClear.push(this.renderAxisLine());o.forEachCellDo(g);if(n){d=(f==="horizontal")?-90:0}h.forEach(e);this.renderLabel();this.setIfChanged("maxLabelExtent",(f==="horizontal")?((d===0)?l:m):((d===0)?m:l))}}}()));sc_require("components/graph/axes/cell_axis_model");DG.CellLinearAxisModel=DG.CellAxisModel.extend({tickGap:null,lowerBound:null,upperBound:null,lockZero:function(b,a){if(a!==undefined){this.beginPropertyChanges();this.set("_lockZero",a);if(a){this.set("lowerBound",0)}else{this.setDataMinAndMax(this._lowerBound,this._upperBound)}this.endPropertyChanges()}return this._lockZero}.property("_lockZero").cacheable(),displayOnlyIntegers:false,isNumeric:true,_lowerBound:null,_upperBound:null,numberOfCells:function(){return 1}.property(),_lockZero:false,setLowerAndUpperBounds:function(a,b){this.beginPropertyChanges();this._lowerBound=a;this._upperBound=b;this.setIfChanged("lowerBound",a);this.setIfChanged("upperBound",b);this.setIfChanged("tickGap",this._computeTickGap(a,b));this.endPropertyChanges()},translate:function(a){if((a===0)||this._lockZero){return}this.beginPropertyChanges();this._lowerBound+=a;this._upperBound+=a;this._setBoundsFromInternalBounds();this.endPropertyChanges()},computeBoundsForDilation:function(c,a){var b=(!this._lockZero||(this._lowerBound!==0))?c+(this._lowerBound-c)*a:this._lowerBound,d=(!this._lockZero||(this._upperBound!==0))?c+(this._upperBound-c)*a:this._upperBound;return{lower:b,upper:d}},dilate:function(d,b,c){var a=this.computeBoundsForDilation(d,b);c=c||false;if(c){if(SC.none(this.axisAnimator)){this.axisAnimator=DG.GraphAnimator.create()}this.axisAnimator.set("axisInfoArray",[{axis:this,newBounds:a}]).animate()}else{this._lowerBound=a.lower;this._upperBound=a.upper;if(this._setBoundsFromInternalBounds()){this.beginPropertyChanges();this._resetTickGap(this.get("lowerBound"),this.get("upperBound"));this._handleAxisChange();this.endPropertyChanges()}}},setDataMinAndMax:function(b,e,d){if(!d&&(SC.none(b)||SC.none(e))){return}if(!d&&(b>=this.get("lowerBound"))&&(e<=this.get("upperBound"))){return}this._resetScale(b,e);var a=this._setBoundsFromInternalBounds(),c=this._resetTickGap(this.get("lowerBound"),this.get("upperBound"));if(a||c){this._handleAxisChange()}},_resetScale:function(a,c){var b=this._computeBoundsAndTickGap(a,c);this.set("tickGap",b.gap);this._lowerBound=b.lower;this._upperBound=b.upper},_computeBoundsAndTickGap:function(a,d){var e=2.5,c;if(!DG.isFinite(d)||!DG.isFinite(a)||(d<a)){var b=this.getPath("attributeDescription.attribute.defaultMin"),f=this.getPath("attributeDescription.attribute.defaultMax");a=SC.none(b)?0:b;d=SC.none(f)?10:f}else{if((a===d)&&(a===0)){a=-10;d=10}else{if((a===d)&&(Math.floor(a)===a)){d+=5;a-=5}else{if(a===d){d=a+0.1*Math.abs(a);a=a-0.1*Math.abs(a)}else{if((a>0)&&(d>0)&&(a<=d/e)){a=0}else{if((a<0)&&(d<0)&&(d>=a/e)){d=0}}}}}}c=this._computeTickGap(a,d);return{lower:this._findLow(a,c),upper:this._findHigh(d,c),gap:c}},_computeTickGap:function(a,d){var b=(a>=d)?Math.abs(a):d-a,c=this._goodTickValue(b/5);if(this.displayOnlyIntegers&&(c<1)){c=1}return c},_resetTickGap:function(a,d){var c=this.tickGap,b=this._computeTickGap(a,d);this.set("tickGap",b);return c!==b},_setBoundsFromInternalBounds:function(){var d=0.05,a=this.get("lowerBound"),c=this.get("upperBound"),b=(this._upperBound-this._lowerBound)*d;this.beginPropertyChanges();if((this.get("lockZero")||((this._lowerBound>0)&&(this._lowerBound-b<0)))){this.set("lowerBound",0)}else{this.set("lowerBound",this._lowerBound)}if((this._upperBound<0)&&(this._upperBound+b>0)){this.set("upperBound",0)}else{this.set("upperBound",this._upperBound)}this.endPropertyChanges();return(a!==this.get("lowerBound"))||(c!==this.get("upperBound"))},_handleAxisChange:function(){},_findLow:function(b,a){if(a!==0){return(Math.floor(b/a)-0.5)*a}else{return b-1}},_findHigh:function(b,a){if(a!==0){return(Math.floor(b/a)+1.5)*a}else{return b+1}},_goodTickValue:function(e){if(e===0){return 1}var d=Math.log(e)/Math.LN10,c=Math.floor(d),b=Math.pow(10,c),a=Math.pow(10,d-c);if(a<2){a=1}else{if(a<5){a=2}else{a=5}}return Math.max(b*a,Number.MIN_VALUE)}});sc_require("components/graph/axes/cell_axis_view");DG.CellLinearAxisView=DG.CellAxisView.extend((function(){var c=1,b=4;return{displayProperties:"model.lowerBound model.upperBound model.tickGap".w(),isNumeric:true,zeroPixel:function(){if((0>=this.getPath("model.lowerBound"))&&(0<=this.getPath("model.upperBound"))){return this.dataToCoordinate(0)}else{return null}}.property("model.lowerBound","model.upperBound","pixelMin","pixelMax").cacheable(),maxNumberExtent:0,coordToString:function(g){var f=this.coordinateToData(g),e=this.getPath("model.tickGap"),h=(e<1)?1+Math.ceil(Math.abs(Math.log(e)/Math.LN10)):0,d;if((h===0)&&(e<10)){h++}d=DG.Format.number().group("").fractionDigits(0,h);return d(f)},prepareVisualization:function(){this.displayDidChange()},doDraw:function a(){var l=this,q=this.get("model"),p=q.get("lowerBound"),f=q.get("upperBound"),k=this.get("axisLineCoordinate"),h=this.get("orientation"),i=l.getPath("model.tickGap"),m=Math.ceil(p/i)*i,d=Math.floor(Math.abs((f-m)/i)),e,r=DG.RenderingUtilities.kDefaultFontHeight,j=(i<1)?Math.ceil(Math.abs(Math.log(i)/Math.LN10)):0,o=DG.Format.number().group("").fractionDigits(0,j);function n(){function x(C,G){var M=false,H=1,I=false,E,D;while(!I){var B=0,z=true,N=H*i,A;d=Math.floor(Math.abs((f-C)/N));I=true;for(A=0;(A<=d)&&I;A++){var K=C+A*N,J=l.dataToCoordinate(K+G),F;e=o(K);F=DG.RenderingUtilities.textExtentOnCanvas(l._paper,e);switch(h){case"vertical":D=F.y/2;if(z||(Math.abs(B-J)>D)){z=false;B=J+(M?D:-D)}else{I=false;H++}break;case"horizontal":E=5*F.x/8;if(z||(Math.abs(J-B)>E)){z=false;B=J+(M?-E:E)}else{I=false;H++}break}}}return H}var u=0,w=x(m,u),s=0,y=s,v=l.get("pixelMax"),t=0;l.forEachTickDo(function(B,E){var A,z,D,C;e=o(B);A=l._paper.text(0,0,e);l._elementsToClear.push(A);z=DG.RenderingUtilities.getExtentForTextElement(A,DG.RenderingUtilities.kDefaultFontHeight);D=z.width;C=z.height;switch(h){case"vertical":E+=v;if((E<l.get("pixelMin"))&&(t>=0)){l._elementsToClear.push(l._paper.line(k,E,k-b,E).attr({stroke:DG.PlotUtilities.kAxisColor}))}if(y===0){if((E<l.get("pixelMin"))&&(t>=0)){A.attr({x:k-b-c,y:E,"text-anchor":"end"});r=Math.max(r,D)}}else{A.hide()}break;case"horizontal":E+=l.get("pixelMin");if((E>=l.get("pixelMin"))&&(t>=0)){l._elementsToClear.push(l._paper.line(E,k,E,k+b).attr({stroke:DG.PlotUtilities.kAxisColor}))}if(y===0){if((E>=l.get("pixelMin"))&&(t>=0)){A.attr({x:E+1,y:k+b+c+C/3});r=Math.max(r,C)}}else{A.hide()}break}if(t>=0){y=(y+1)%w}t++})}function g(){var y=l.get("frame"),t=false;function A(){l._dragPanel.show();l._isDragging=true;DG.logUser("dragStart: { lower: %@, upper: %@ }",l.getPath("model.lowerBound"),l.getPath("model.upperBound"))}function C(){l._dragPanel.hide();l._isDragging=false;DG.logUser("dragEnd: { lower: %@, upper: %@ }",l.getPath("model.lowerBound"),l.getPath("model.upperBound"))}function z(H,G){if(!t){A();l._lowerBoundAtDragStart=l.getPath("model.lowerBound");l._upperBoundAtDragStart=l.getPath("model.upperBound")}}function E(M,K){if(!t&&l._isDragging){var G=(l.get("orientation")==="vertical")?K:M,I=l.getPath("model.lowerBound"),J=l.coordinateToDataGivenCell(0,0)-l.coordinateToDataGivenCell(0,G),H=J-(I-l._lowerBoundAtDragStart);l.get("model").translate(H)}}function B(I,H){if(!t){var G=DG.ViewUtilities.windowToViewCoordinates({x:I,y:H},l);l._dilationAnchorCoord=(l.get("orientation")==="vertical")?G.y:G.x;l._lowerBoundAtDragStart=l.getPath("model.lowerBound");A()}}function w(O,M){if(!t&&l._isDragging){var I=l.get("_lowerBoundAtDragStart"),J=l.getPath("model.upperBound"),G=(l.get("orientation")==="vertical")?M:O,K=l.get("pixelMax"),H=K-l._dilationAnchorCoord,N=H/(H-G);if((N>0)&&(N<10)){l.setPath("model._lowerBound",I);l.get("model").dilate(J,N)}}}function D(I,H){if(!t){var G=DG.ViewUtilities.windowToViewCoordinates({x:I,y:H},l);l._dilationAnchorCoord=(l.get("orientation")==="vertical")?G.y:G.x;l._upperBoundAtDragStart=l.getPath("model.upperBound");A()}}function v(O,M){if(!t&&l._isDragging){var J=l.get("_upperBoundAtDragStart"),I=l.getPath("model.lowerBound"),G=(l.get("orientation")==="vertical")?M:O,K=l.get("pixelMin"),H=K-l._dilationAnchorCoord,N=H/(H-G);if((N>0)&&(N<10)){l.setPath("model._upperBound",J);l.get("model").dilate(I,N)}}}function u(H,G,K,I,J){H.attr({x:G,y:K,width:I,height:J})}function s(G){t=G.altKey}function x(J){var G;if(J.altKey){var H="/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/MagnifyPlus.cur",K="/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/MagnifyMinus.cur",I=J.shiftKey?K:H;G=J.shiftKey?"out":"in";this.attr({cursor:DG.Browser.customCursorStr(I,8,8),title:"Click to zoom "+G})}else{this.attr({cursor:this.defaultCursor,title:this.defaultTitle})}}function F(I){var J,H,G;if(I.altKey){J=I.shiftKey?2:0.5;H=DG.ViewUtilities.windowToViewCoordinates({x:I.clientX,y:I.clientY},l);G=(l.get("orientation")==="vertical")?H.y:H.x;l.get("model").dilate(l.coordinateToData(G),J,true);t=false}}if(SC.none(l._midPanel)){l._midPanel=l._paper.rect(0,0,0,0).attr({stroke:DG.RenderingUtilities.kTransparent,fill:DG.RenderingUtilities.kSeeThrough});l._lowerPanel=l._midPanel.clone();l._upperPanel=l._midPanel.clone();l._dragPanel=l._midPanel.clone();l._midPanel.defaultTitle="DG.CellLinearAxisView.midPanelTooltip".loc();l._midPanel.attr({title:l._midPanel.defaultTitle});l._midPanel.mousedown(s);l._midPanel.mouseup(F);l._midPanel.drag(E,z,C);l._midPanel.mousemove(x);l._lowerPanel.defaultTitle="DG.CellLinearAxisView.lowerPanelTooltip".loc();l._lowerPanel.attr({title:l._lowerPanel.defaultTitle});l._lowerPanel.mousedown(s);l._lowerPanel.mouseup(F);l._lowerPanel.drag(w,B,C);l._lowerPanel.mousemove(x);l._upperPanel.defaultTitle="DG.CellLinearAxisView.upperPanelTooltip".loc();l._upperPanel.attr({title:l._upperPanel.defaultTitle});l._upperPanel.mousedown(s);l._upperPanel.mouseup(F);l._upperPanel.drag(v,D,C);l._upperPanel.mousemove(x);l._dragPanel.attr({cursor:DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/ClosedHandXY.cur",8,8)})}if(l.get("orientation")==="vertical"){u(l._lowerPanel,y.x,(5/8)*y.height,y.width,(3/8)*y.height);l._lowerPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/DownDilate.cur",8,8);l._lowerPanel.attr({cursor:l._lowerPanel.defaultCursor});u(l._midPanel,y.x,(3/8)*y.height,y.width,(3/8)*y.height);l._midPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/TranslateY.cur",8,8);l._midPanel.attr({cursor:l._midPanel.defaultCursor});u(l._upperPanel,y.x,0,y.width,(3/8)*y.height);l._upperPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/UpDilate.cur",8,8);l._upperPanel.attr({cursor:l._upperPanel.defaultCursor});u(l._dragPanel,y.x,0,y.width,y.height)}else{u(l._lowerPanel,0,0,(3/8)*y.width,y.height);l._lowerPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/LeftDilate.cur",8,8);l._lowerPanel.attr({cursor:l._lowerPanel.defaultCursor});u(l._midPanel,(3/8)*y.width,0,(3/8)*y.width,y.height);l._midPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/TranslateX.cur",8,8);l._midPanel.attr({cursor:l._midPanel.defaultCursor});u(l._upperPanel,(5/8)*y.width,0,(3/8)*y.width,y.height);l._upperPanel.defaultCursor=DG.Browser.customCursorStr("/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/RightDilate.cur",8,8);l._upperPanel.attr({cursor:l._upperPanel.defaultCursor});u(l._dragPanel,0,0,y.width,y.height)}if(!l._isDragging){l._dragPanel.hide()}}this._elementsToClear.push(this.renderAxisLine());n();g();this.renderLabel();this.setIfChanged("maxNumberExtent",r)},info:function(){var d={lowerBound:this.getPath("model.lowerBound"),upperBound:this.getPath("model.upperBound"),range:null,cellWidth:this.get("fullCellWidth"),pixelMax:this.get("pixelMax")};d.range=d.upperBound-d.lowerBound;return d}.property("model.lowerBound","model.upperBound","fullCellWidth","pixelMax").cacheable(),cellDataToCoordinateUsingCache:function(d,g,e){if(!isFinite(g)){return null}var f=SC.none(g)?null:(g-e.lowerBound)*e.cellWidth/e.range;if(!SC.none(f)){switch(this.get("orientation")){case"vertical":f=e.pixelMax+(d+1)*e.cellWidth-f;break;case"horizontal":f=d*e.cellWidth+f;break}}return f},cellDataToCoordinate:function(d,e){return this.cellDataToCoordinateUsingCache(d,e,this.get("info"))},dataToCoordinate:function(d){return this.cellDataToCoordinate(0,d)},dataToCoordinateUsingCache:function(e,d){return this.cellDataToCoordinateUsingCache(0,e,d)},coordinateToDataGivenCell:function(d,j){var k=0,f=this.get("fullCellWidth"),g,l,e,h,i;if(f!==0){g=this.getPath("model.lowerBound");l=this.getPath("model.upperBound");if(this.get("orientation")==="vertical"){e=this.get("pixelMax")+f*(d+1);h=e-f;j+=this.get("pixelMax")}else{e=this.get("pixelMin")+f*d;h=e+f;j+=this.get("pixelMin")}i=j-e;k=g+i*(l-g)/(h-e)}return k},coordinateToData:function(d){return this.coordinateToDataGivenCell(this.whichCell(d),d)},increment:function(){return this.coordinateToData(1)-this.coordinateToData(0)}.property("model.lowerBound","model.upperBound","frame").cacheable(),desiredExtent:function(){var d=arguments.callee.base.apply(this,arguments)+c+b+this.get("maxNumberExtent");return d}.property("maxNumberExtent"),forEachTickDo:function(e){var h,g=this.getPath("model.lowerBound"),j=this.getPath("model.upperBound"),i=this.getPath("model.tickGap"),d=Math.ceil(g/i)*i,k=Math.abs((j-d)/i),f;for(h=0;h<=k;h++){f=d+h*i;e(f,this.dataToCoordinate(f))}},_isDragging:false,_lowerBoundAtDragStart:null,_upperBoundAtDragStart:null,_dilationAnchorCoord:null,_dragPanel:null,_lowerPanel:null,_midPanel:null,_upperPanel:null}}()));DG.Analysis={EAttributeType:{eNone:0,eNumeric:1,eCategorical:2},EAnalysisRole:{eInvalid:-1,eNone:0,ePrimaryNumeric:1,eSecondaryNumeric:2,ePrimaryCategorical:3,eSecondaryCategorical:4,eLegendNumeric:5,eLegendCategorical:6},kNullAttribute:-1};DG.AttributePlacementDescription=SC.Object.extend({attribute:function(a,b){if(!SC.none(b)){this._attributes=[b];this.setupStats()}return(this._attributes.length>0)?this._attributes[0]:DG.Analysis.kNullAttribute}.property(),attributes:function(){return this._attributes}.property(),attributeAt:function(a){if((a>=0)&&(a<this._attributes.length)){return this._attributes[a]}else{return DG.Analysis.kNullAttribute}},attributeIDAt:function(b){var a=this.attributeAt(b);return(a!==DG.Analysis.kNullAttribute)?a.get("id"):null},addAttribute:function(a){if(!this._attributes.contains(a)){this._attributes.push(a)}this.setupStats();this.invalidateCaches();this.notifyPropertyChange("attribute")},removeAttributeAtIndex:function(a){DG.assert(a<this._attributes.length);this._attributes.splice(a,1);this.invalidateCaches();this.notifyPropertyChange("attribute")},removeAttribute:function(a){this._attributes.removeObject(a);this.invalidateCaches();this.notifyPropertyChange("attribute")},removeAllAttributes:function(){this._attributes=[];this.setPath("attributeStats.attributes",[]);this.invalidateCaches();this.notifyPropertyChange("attribute")},attributeStats:null,_attributes:null,init:function(){arguments.callee.base.apply(this,arguments);this._attributes=[];this.attributeStats=DG.AttributeStats.create()},setupStats:function(){this.attributeStats.beginPropertyChanges();this.attributeStats.set("collectionClient",this.get("collectionClient"));this.attributeStats.set("attributes",this.get("attributes"));this.attributeStats.endPropertyChanges()},attributeID:function(){var a=this.get("attribute");return(a!==DG.Analysis.kNullAttribute)?a.get("id"):null}.property("attribute"),isNumeric:function(){var a=this.get("attributeType");return a===DG.Analysis.EAttributeType.eNumeric}.property("attributeType"),hasFormula:function(){var a=this.getPath("attribute.formula");return !SC.empty(a)}.property(),attributeType:function(){var a=this.get("attributeStats");if(SC.none(a)){return DG.Analysis.EAttributeType.eNone}else{return a.get("attributeType")}}.property("attributeStats.attributeType"),role:DG.Analysis.EAnalysisRole.eNone,collectionClient:null,collectionClientDidChange:function(){this.setPath("attributeStats.collectionClient",this.get("collectionClient"))}.observes("collectionClient"),invalidateCaches:function(c,b){var a=this.get("attributeStats");if(a){a.invalidateCaches(c,b)}},casesForCategory:function(b){var a=this.getPath("attributeStats.cellMap");return a?a[b]:[]}});DG.AttributeStats=SC.Object.extend({attributes:null,numericStats:null,categoricalStats:null,_cases:null,_numericCacheIsValid:null,_categoricalCacheIsValid:null,_attributeType:DG.Analysis.EAttributeType.eNone,init:function(){arguments.callee.base.apply(this,arguments);this.attributes=[];this.numericStats=DG.UnivariateStats.create();this._numericCacheIsValid=true;this.categoricalStats=DG.CategoricalStats.create();this._categoricalCacheIsValid=true},attributeDidChange:function(){this.invalidateCaches();this.set("attributeType",null)}.observes("attributes"),invalidateCaches:function(k,f){function e(n,m){return SC.none(m)||(n<m)}function j(n,m){return SC.none(m)||(n>m)}var h=function(m,n){var o={},p=m.getNumValue(n,o);if(isFinite(p)){this.numericStats.incrementProperty("count");this.numericStats.set("sum",this.numericStats.sum+p);if(e(p,this.numericStats.rangeMin)){this.numericStats.set("rangeMin",p)}if(j(p,this.numericStats.rangeMax)){this.numericStats.set("rangeMax",p)}if(p>0){if(e(p,this.numericStats.positiveMin)){this.numericStats.set("positiveMin",p)}if(j(p,this.numericStats.positiveMax)){this.numericStats.set("positiveMax",p)}}this.numericStats.setIfChanged("squaredDeviations",null)}else{if(o.isNominal){this.numericStats.setIfChanged("attributeType",DG.Analysis.EAttributeType.eCategorical)}}}.bind(this),b=function(n,o){var p=n.getStrValue(o);if(!SC.empty(p)){var m=this.getPath("categoricalStats.cellMap");if(SC.none(m[p])){m[p]=[]}m[p].push(n);this.categoricalStats.incrementProperty("count");this.setPath("categoricalStats.cellMap",m)}}.bind(this);this._cases=k||this._cases;if(f&&((f.operation==="createCase")||(f.operation==="createCases"))){var d=f.result.caseIDs||[f.result.caseID],c=this.getPath("attribute.id"),i=this.get("attributeType"),g=this.get("attributes"),a=this._numericCacheIsValid,l=this._categoricalCacheIsValid&&(i===DG.Analysis.EAttributeType.eCategorical);if(a){this.numericStats.beginPropertyChanges()}if(l){this.categoricalStats.beginPropertyChanges()}d.forEach(function(n){var m=DG.store.find(DG.Case,n);if(m){g.forEach(function(o){c=o.get("id");if(a){h(m,c)}if(l){b(m,c)}else{this.setIfChanged("_categoricalCacheIsValid",false)}}.bind(this))}}.bind(this));if(a){this.numericStats.endPropertyChanges()}if(l){this.categoricalStats.endPropertyChanges()}return}this.setIfChanged("_numericCacheIsValid",false);this.setIfChanged("_categoricalCacheIsValid",false)},minMax:function(){if(!this._numericCacheIsValid){this._computeNumericStats()}var a=this.numericStats.get("numericRange");return{min:a.min,max:a.max,isDataInteger:this.numericStats.get("dataIsInteger")}}.property(),attributeType:function(a,b){if(b!==undefined){this._attributeType=b}if(!SC.none(this._attributeType)){return this._attributeType}var c=this.get("attributes");if(c.length===0){return DG.Analysis.EAttributeType.eNone}switch(c[0].get("type")){case"nominal":return DG.Analysis.EAttributeType.eCategorical;case"numeric":return DG.Analysis.EAttributeType.eNumeric;default:}if(!this._numericCacheIsValid){this._computeNumericStats()}return this.getPath("numericStats.attributeType")}.property("attributes","numericStats.attributeType"),_computeNumericStats:function(){var e=this._cases,n=this.get("attributes"),o=0,l,h=true,b=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,c=Number.MAX_VALUE,g=-Number.MAX_VALUE,f=0,j=0,k=0,d,a=[];function m(p){var q=Number(p);if(!SC.empty(p)&&isFinite(q)){o++;if(q<b){b=q}if(q>i){i=q}f+=q;a.push(q);if(q>0){c=Math.min(q,c);g=Math.max(q,g)}}else{if((typeof p!=="number")&&!SC.empty(p)){q=String(p);if(h&&!SC.empty(q)){h=false}}}}this.numericStats.reset();this.numericStats.beginPropertyChanges();if(SC.isArray(e)){n.forEach(function(p){var q=p.get("id");e.forEach(function(r){m(r.getValue(q))})})}if(o>0){this.numericStats.set("count",o);this.numericStats.set("sum",f);this.numericStats.set("rangeMin",b);this.numericStats.set("rangeMax",i);d=f/o;a.forEach(function(q){var p=q-d;j+=p;k+=p*p});k-=j*j/o;this.numericStats.set("squaredDeviations",k);if(c<=g){this.numericStats.set("positiveMin",c);this.numericStats.set("positiveMax",g)}}l=h?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical;this.numericStats.set("attributeType",l);this._numericCacheIsValid=true;this.numericStats.endPropertyChanges()},numberOfCells:function(){if(!this._categoricalCacheIsValid){this._computeCategoricalStats()}return this.getPath("categoricalStats.numberOfCells")}.property("categoricalStats.numberOfCells"),numericRange:function(){if(!this._numericCacheIsValid){this._computeNumericStats()}return this.getPath("numericStats.numericRange")}.property("numericStats.numericRange"),numericRangeDidChange:function(){this.notifyPropertyChange("numericRange")}.observes("numericStats.numericRange"),dataDidChange:function(){if((this.get("attributeType")===DG.Analysis.EAttributeType.eCategorical)&&!this._categoricalCacheIsValid){var a=this.categoricalStats.get("numberOfCells"),b;this._computeCategoricalStats();b=this.categoricalStats.get("numberOfCells");if(b!==a){this.notifyPropertyChange("numberOfCells")}}}.observes("_categoricalCacheIsValid"),cellMap:function(){if(!this._categoricalCacheIsValid){this._computeCategoricalStats()}return this.categoricalStats.get("cellMap")}.property("categoricalStats.cellMap"),cellNameToCellNumber:function(a){if(!this._categoricalCacheIsValid){this._computeCategoricalStats()}return this.categoricalStats.cellNameToCellNumber(a)},_computeCategoricalStats:function(){var d=this._cases,e=this.get("attributes"),c=0,a={};function b(g,f){var h=String(f);if(!SC.none(f)&&!SC.empty(h)){if(SC.none(a[h])){a[h]=[]}a[h].push(g);c++}}this.categoricalStats.reset();if(SC.isArray(d)){e.forEach(function(g){var f=g.get("colormap");if(f){DG.ObjectMap.forEach(f,function(i){a[i]=[]})}var h=g.get("id");d.forEach(function(i){b(i,i.getValue(h))})});this.categoricalStats.beginPropertyChanges();this.categoricalStats.set("cellMap",a);this.categoricalStats.set("count",c);this.categoricalStats.endPropertyChanges()}this._categoricalCacheIsValid=true}});DG.CategoricalStats=SC.Object.extend({count:null,cellMap:null,_prevNumberOfCells:0,init:function(){arguments.callee.base.apply(this,arguments);this.cellMap=[]},numberOfCells:function(){return DG.ObjectMap.length(this.cellMap)}.property("cellMap"),countDidChange:function(){var a=this.get("numberOfCells");if(a!==this._prevNumberOfCells){this.notifyPropertyChange("numberOfCells")}this._prevNumberOfCells=a}.observes("count"),cellNameToCellNumber:function(a){return SC.empty(a)?null:DG.ObjectMap.keys(this.cellMap).indexOf(a.toString())},reset:function(){this.set("count",0);this.set("cellMap",[])}});DG.PlotDataConfiguration=SC.Object.extend({dataContext:null,attributesByPlace:null,collectionClient:function(){return this.chooseChildCollection(this.get("xCollectionClient"),this.get("yCollectionClient"))||DG.currDocumentController().collectionDefaults().collectionClient}.property("xCollectionClient","yCollectionClient"),xCollectionClient:function(){return this.getPath("xAttributeDescription.collectionClient")}.property("xAttributeDescription.collectionClient"),yCollectionClient:function(){return this.getPath("yAttributeDescription.collectionClient")}.property("yAttributeDescription.collectionClient"),legendCollectionClient:function(){return this.getPath("legendAttributeDescription.collectionClient")}.property("legendAttributeDescription.collectionClient"),xCollectionDidChange:function(){this.notifyPropertyChange("xCollectionClient")},yCollectionDidChange:function(){this.notifyPropertyChange("yCollectionClient")},legendCollectionDidChange:function(){this.notifyPropertyChange("legendCollectionClient")},xAttributeDescription:function(a,b){return this.attributeDescriptionForPlace(a,b,DG.GraphTypes.EPlace.eX)}.property(),yAttributeDescription:function(a,b){return this.attributeDescriptionForPlace(a,b,DG.GraphTypes.EPlace.eY)}.property(),legendAttributeDescription:function(a,b){return this.attributeDescriptionForPlace(a,b,DG.GraphTypes.EPlace.eLegend)}.property(),attributeDescriptionForPlace:function(b,c,a){if(c){DG.assert(c instanceof DG.AttributePlacementDescription);this.attributesByPlace[a][0]=c}return !SC.none(this.attributesByPlace)?this.attributesByPlace[a][0]:null}.property(),firstAttributeDescriptionForRole:function(a){return this.firstPlaceAndAttributeDescriptionForRole(a).attributeDescription},firstAttributeIDForRole:function(b){var a=this.firstPlaceAndAttributeDescriptionForRole(b);return a.attributeDescription.get("attributeID")},getPlaceForRole:function(a){return this.firstPlaceAndAttributeDescriptionForRole(a).place},xAttributeID:function(){return this.getPath("xAttributeDescription.attributeID")}.property("xAttributeDescription.attributeID"),yAttributeID:function(){return this.getPath("yAttributeDescription.attributeID")}.property("yAttributeDescription.attributeID"),legendAttributeID:function(){return this.getPath("legendAttributeDescription.attributeID")}.property("legendAttributeDescription.attributeID"),xIsNumeric:function(){return this.getPath("xAttributeDescription.isNumeric")}.property("xAttributeDescription.isNumeric"),yIsNumeric:function(){return this.getPath("yAttributeDescription.isNumeric")}.property("yAttributeDescription.isNumeric"),xType:function(){return this.getPath("xAttributeDescription.attributeType")}.property("xAttributeDescription.attributeType"),yType:function(){return this.getPath("yAttributeDescription.attributeType")}.property("yAttributeDescription.attributeType"),attributeAssignment:null,hasAggregates:function(){var b={},c,a=function(d){var f=this.getPath(d+"AttributeDescription.collectionClient"),e=f&&f.get("id");if(!SC.none(e)){b[e]=f}}.bind(this);a("x");a("y");a("legend");c=DG.ObjectMap.findKey(b,function(e,d){return d&&d.get("hasAggregates")});return !SC.none(c)}.property(),yAttributeIDAt:function(a){return this.get("yAttributeDescription").attributeIDAt(a)},_hiddenCases:null,hiddenCases:function(a,b){if(b){this._hiddenCases=b;this.invalidateCaches()}return this._hiddenCases}.property(),init:function(){arguments.callee.base.apply(this,arguments);this._hiddenCases=[]},destroy:function(){var a=this.get("xAttributeDescription"),c=this.get("yAttributeDescription"),b=this.get("legendAttributeDescription");if(a){a.removeObserver("collectionClient",this,"xCollectionDidChange")}if(c){c.removeObserver("collectionClient",this,"yCollectionDidChange")}if(b){b.removeObserver("collectionClient",this,"legendCollectionDidChange")}this._hiddenCases=[];arguments.callee.base.apply(this,arguments)},setAttributeAndCollectionClient:function(b,e,f,d){var a=this.get(b);a.removeAllAttributes();a.beginPropertyChanges();a.set("collectionClient",(e&&e.collection)||null);if(!SC.none(e)){e.attributes.forEach(function(g){a.addAttribute(g)})}if(!SC.none(f)){a.set("role",f)}if(!SC.none(d)){a.setPath("attributeStats.attributeType",d)}else{var c=a.get("isNumeric")?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical;a.setPath("attributeStats.attributeType",c)}this._casesCache=null;a.invalidateCaches(this.get("cases"));a.endPropertyChanges()},setAttributeType:function(e,f){DG.assert(typeof e==="string");DG.assert(typeof f==="boolean");var b=this.get(e),c=(f?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical),a=b&&b.get("attribute"),d=b&&b.get("attributeStats");DG.assert(a!==DG.Analysis.kNullAttribute);b.invalidateCaches(this.get("cases"));if(d){d.set("attributeType",c)}},chooseChildCollection:function(d,c){var b=d&&!d.get("areParentChildLinksConfigured"),a=c&&!c.get("areParentChildLinksConfigured");if(b||a){if(!SC.none(d)&&(d.getCaseCount()>0)&&!SC.none(d.getCaseAt(0).get("parent"))){return d}else{if(SC.none(c)){return d}else{return c}}}if(!SC.none(d)&&!SC.none(c)){if(d.isDescendantOf(c)){return d}if(c.isDescendantOf(d)){return c}}return d||c||null},plottedCollectionIDs:function(){var d=[],a=this.get("collectionClient"),b=a&&a.get("id"),c=["xCollectionClient","yCollectionClient","legendCollectionClient"];if(a&&!SC.none(b)){d.push(b)}c.forEach(function(e){var g=this.get(e),f=g&&g.get("id");if(!SC.none(f)){if(d.indexOf(f)<0){d.push(f)}}}.bind(this));return d}.property("collectionClient","xCollectionClient","yCollectionClient","legendCollectionClient").cacheable(),_casesCache:null,allCases:function(){var a=this.get("collectionClient")||DG.currDocumentController().collectionDefaults().collectionClient;return a?a.getPath("casesController.arrangedObjects"):null}.property(),cases:function(){if(SC.none(this._casesCache)){var f=this.get("allCases"),c=this.get("hiddenCases"),b,e=[],d=[],a=this.get("attributesByPlace");if(f){b=DG.ArrayUtils.subtract(f,c,function(g){return g.get("id")});[DG.GraphTypes.EPlace.eX,DG.GraphTypes.EPlace.eY].forEach(function(g){a[g].forEach(function(i){var h=i.get("attributeID");if(!SC.none(h)){d.push(h)}})});b.forEach(function(g){var h=true;d.forEach(function(i){if(!g.hasValue(i)){h=false}});if(h){e.push(g)}})}this._casesCache=e}return this._casesCache}.property("xCollectionClient","yCollectionClient","legendCollectionClient"),getCaseCount:function(){return this.getPath("cases.length")},selection:function(){var a=this.getPath("collectionClient.casesController.selection");a=a?a.toArray():[];return DG.ArrayUtils.subtract(a,this.get("hiddenCases"),function(b){return b.get("id")})}.property("xCollectionClient","yCollectionClient","legendCollectionClient","hiddenCases"),attributeAssignmentDidChange:function(){this.notifyPropertyChange("attributeAssignment")}.observes(".xAttributeDescription.attribute",".yAttributeDescription.attribute",".legendAttributeDescription.attribute"),forEachAttribute:function(a){this.get("attributesByPlace").forEach(function(b){b.forEach(a)})},firstAttributeDescriptionSuchThat:function(f){var c=this.get("attributesByPlace"),g=c.length,d;for(d=0;d<g;d++){var b=c[d],a=!SC.none(b)?b.length:0,e;for(e=0;e<a;e++){if(f(b[e])){return{attributeDescription:b[e],place:d}}}}return{attributeDescription:null,place:DG.GraphTypes.EPlace.eUndefined}},firstPlaceAndAttributeDescriptionForRole:function(a){return this.firstAttributeDescriptionSuchThat(function(b){return b.get("role")===a})},invalidateAxisDescriptionCaches:function(b,a){this.get("xAttributeDescription").invalidateCaches(b,a);this.get("yAttributeDescription").invalidateCaches(b,a);this.get("legendAttributeDescription").invalidateCaches(b,a)},invalidateCaches:function(d,c){var b;if(!d&&c&&this._casesCache&&((c.operation==="createCase")||(c.operation==="createCases"))){var e=c.collection&&c.collection.get("id");if(e&&(this.get("plottedCollectionIDs").indexOf(e)<0)){return}var a=c.result.caseIDs||[c.result.caseID];a.forEach(function(g){var f=DG.store.find(DG.Case,g);if(f){this._casesCache.push(f)}}.bind(this));b=this._casesCache}else{this._casesCache=null;b=d||this.get("cases")}this.invalidateAxisDescriptionCaches(b,c)},hiddenCasesDidChange:function(){this._casesCache=null;this.invalidateAxisDescriptionCaches()}.observes("hiddenCases"),arrangedObjectArrays:function(){var b=this.get("xCollectionClient"),e=this.get("yCollectionClient"),a=this.get("legendCollectionClient"),c=!SC.none(b)?[b.casesController.arrangedObjects()]:[];if((b!==e)&&!SC.none(e)){c.push(e.casesController.arrangedObjects())}else{if(!SC.none(a)&&(a!==b)&&(a!==e)){c.push(a.casesController.arrangedObjects())}}if(c.length===0){var d=DG.currDocumentController().collectionDefaults().collectionClient;if(d){c.push(d.casesController.arrangedObjects())}}return c}.property("xCollectionClient","yCollectionClient","legendCollectionClient"),getDataMinAndMaxForDimension:function(a){var b;switch(a){case DG.GraphTypes.EPlace.eX:b=this.get("xAttributeDescription");break;case DG.GraphTypes.EPlace.eY:b=this.get("yAttributeDescription");break;case DG.GraphTypes.EPlace.eLegend:b=this.get("legendAttributeDescription");break}return b.getPath("attributeStats.minMax")},hideCases:function(a){this.set("hiddenCases",this.get("hiddenCases").concat(a).uniq())},showCases:function(a){this.set("hiddenCases",DG.ArrayUtils.subtract(this.get("hiddenCases"),a,function(b){return b.get("id")}))},showAllCases:function(){this.set("hiddenCases",[])},restoreHiddenCases:function(a){if(SC.none(a)){return}this.set("hiddenCases",a.map(function(b){return DG.store.find(DG.Case,b)}))}});sc_require("components/graph_map_common/plot_data_configuration");DG.GraphDataConfiguration=DG.PlotDataConfiguration.extend({init:function(){var d={x:DG.AttributePlacementDescription.create(),y:DG.AttributePlacementDescription.create(),legend:DG.AttributePlacementDescription.create()},b,c=DG.currDocumentController().collectionDefaults();arguments.callee.base.apply(this,arguments);var a=function(f,h,e,j){var k=d[f],g=c["plot"+h+"Attr"],i=c["plot"+h+"AttrIsNumeric"];DG.assert(k);if(g){k.set("collectionClient",c.collectionClient);k.set("attribute",g);k.setPath("attributeStats.attributeType",SC.none(g)?DG.Analysis.EAttributeType.eNone:i?DG.Analysis.EAttributeType.eNumeric:DG.Analysis.EAttributeType.eCategorical);k.set("role",SC.none(g)?DG.Analysis.EAnalysisRole.eNone:i?e:j)}else{k.set("collectionClient",null);k.removeAllAttributes()}k.addObserver("collectionClient",this,f+"CollectionDidChange")}.bind(this);a("x","X",DG.Analysis.EAnalysisRole.ePrimaryNumeric,DG.Analysis.EAnalysisRole.ePrimaryCategorical);a("y","Y",DG.Analysis.EAnalysisRole.eSecondaryNumeric,DG.Analysis.EAnalysisRole.eSecondaryCategorical);a("legend","Legend",DG.Analysis.EAnalysisRole.eLegendNumeric,DG.Analysis.EAnalysisRole.eLegendCategorical);this.attributesByPlace=[];for(b=0;b<DG.GraphTypes.EPlace.eNumPlaces;b++){this.attributesByPlace[b]=[]}this.attributesByPlace[DG.GraphTypes.EPlace.eX][0]=d.x;this.attributesByPlace[DG.GraphTypes.EPlace.eY][0]=d.y;this.attributesByPlace[DG.GraphTypes.EPlace.eLegend][0]=d.legend}});DG.UnivariateStats=SC.Object.extend({count:0,attributeType:null,dataIsInteger:null,sum:null,squaredDeviations:null,rangeMin:null,rangeMax:null,numericRange:function(){return{min:this.get("rangeMin"),max:this.get("rangeMax")}}.property("rangeMin","rangeMax"),positiveMin:null,positiveMax:null,isEmpty:function(){return !this.count}.property("count"),mean:function(){return !this.isEmpty()?this.sum/this.count:NaN}.property("count","sum").cacheable(),hasRange:function(){return DG.isFinite(this.rangeMin)&&DG.isFinite(this.rangeMax)}.property("rangeMin","rangeMax").cacheable(),reset:function(){this.beginPropertyChanges();this.set("count",0);this.set("attributeType",null);this.set("dataIsInteger",null);this.set("sum",null);this.set("squaredDeviations",null);this.set("rangeMin",null);this.set("rangeMax",null);this.set("positiveMin",null);this.set("positiveMax",null);this.endPropertyChanges()}});sc_require("controllers/component_controller");DG.GraphController=DG.ComponentController.extend((function(){function a(d,b){var c=b.collection&&b.collection.get("id");return d&&!SC.none(c)&&d.getCollectionByID(c)}return{dataContext:null,graphModel:null,xAxisView:null,yAxisView:null,plotView:null,legendView:null,axisMultiTarget:null,attributeMenu:null,menuAnchorView:null,createComponentStorage:function(){var h={_links_:{}},b=this.get("dataContext"),f=this.getPath("graphModel.dataConfiguration"),g=f&&f.get("hiddenCases"),d=this.getPath("graphModel.plots");var c=function(m){var k=f&&f.get(m+"CollectionClient"),l=f&&f.get(m+"AttributeDescription"),j=(l&&l.get("attributes"))||[];if(k&&(j.length>0)){h._links_[m+"Coll"]=k.toLink();var i=m+"Attr";j.forEach(function(n){DG.ArchiveUtils.addLink(h,i,n)})}h[m+"Role"]=l.get("role");h[m+"AttributeType"]=l.get("attributeType")};var e=function(j){var i=this.getPath("graphModel."+j+"Axis");if(i){h[j+"AxisClass"]=String(i.constructor)}if(i&&i.get("isNumeric")){h[j+"LowerBound"]=i.get("lowerBound");h[j+"UpperBound"]=i.get("upperBound")}}.bind(this);if(b){h._links_.context=b.toLink()}c("x");c("y");c("legend");e("x");e("y");if(d){h.plotModels=[];d.forEach(function(i){h.plotModels.push({plotModelStorage:i.createStorage(),plotClass:String(i.constructor)})})}if(g){h.hiddenCases=g.map(function(i){return i.get("id")})}return h},restoreComponentStorage:function(h,j){var g=this.get("graphModel"),i=this.getLinkID(h,"context"),d=null;if(!SC.none(i)){d=DG.DataContext.retrieveContextFromMap(j,i);if(d){this.set("dataContext",d);this.setPath("graphModel.dataConfiguration.dataContext",d)}}if(SC.none(h._links_)){return}g.restoreStorage(h);g.stopAnimation();if(h.plotModelStorage){var b=g.get("plot");if(b){b.restoreStorage(h.plotModelStorage)}}else{if(h.plotModels){var f=g.get("plots");f.forEach(function(l,k){l.restoreStorage(h.plotModels[k].plotModelStorage)})}}var e=g.get("xAxis"),c=g.get("yAxis");if(e&&e.get("isNumeric")&&isFinite(h.xLowerBound)&&isFinite(h.xUpperBound)){e.setLowerAndUpperBounds(h.xLowerBound,h.xUpperBound)}if(c&&c.get("isNumeric")&&isFinite(h.yLowerBound)&&isFinite(h.yUpperBound)){c.setLowerAndUpperBounds(h.yLowerBound,h.yUpperBound)}},dataContextDidChange:function(){var b=this.get("graphModel");if(b){b.set("dataContext",this.get("dataContext"))}}.observes("dataContext"),modelDidChange:function(){var b=this.getPath("model.content");this.set("graphModel",b);if(b){b.set("dataContext",this.get("dataContext"))}}.observes("model"),viewDidChange:function(){var c=this.get("view"),b=c&&c.get("contentView");if(b){this.set("xAxisView",b.get("xAxisView"));this.set("yAxisView",b.get("yAxisView"));this.set("plotView",b.get("plotBackgroundView"));this.set("legendView",b.get("legendView"));this.set("axisMultiTarget",b.get("yAxisMultiTarget"));b.set("controller",this)}}.observes("view"),gearMenuItems:function(){var b=this.getPath("graphModel");return SC.none(b)?[]:b.getGearMenuItems()}.property("graphModel"),rescaleAxes:function(){this.graphModel.rescaleAxes()},plotFunction:function(){this.graphModel.get("plot").togglePlotFunction()},init:function(){arguments.callee.base.apply(this,arguments);this.attributeMenu=SC.MenuPane.create({layout:{width:200,height:150}});this.attributeMenu.selectedAxis=null;this.attributeMenu.addObserver("selectedItem",this,this.attributeMenuItemChanged);this.menuAnchorView=SC.View.create({layout:{left:0,width:20,top:0,height:20},backgroundColor:"transparent",isVisible:false})},addAxisHandler:function(b){var d=this,c=b.get("labelNodes");if(SC.isArray(c)){c.forEach(function(g,f){function e(h){d.setupAttributeMenu(h,b,f)}if(!SC.none(g.events)){g.unmousedown(e)}g.mousedown(e)})}},axisViewChanged:function(c,d){var e=this,b=this.get(d);if(!SC.none(b)){b.addObserver("labelNode",this,function(){e.addAxisHandler(b)})}}.observes("xAxisView","yAxisView","legendView"),setupAttributeMenu:function(b,c,i){var g=this.get("graphModel"),e={left:b.layerX,top:b.layerY,height:20,width:20},d=c.get("orientation"),h=(d==="horizontal")?[0,2,1,3,0]:[0,1,3,2,0],k=((c.instanceOf(DG.LegendView))?"legend":((d==="horizontal")?"x":"y")),j;j=this.getAttributeMenuItems();j.push({isSeparator:YES});var f=false;j.push(g.createRemoveAttributeMenuItem(k,f,i));j.push(g.createChangeAttributeTypeMenuItem(k,f,i));this.attributeMenu.set("items",j);this.attributeMenu.selectedAxis=d;this.attributeMenu.isLegend=c.instanceOf(DG.LegendView);SC.RunLoop.begin();this.menuAnchorView.removeFromParent();c.appendChild(this.menuAnchorView);this.menuAnchorView.set("layout",e);this.menuAnchorView.set("isVisible",true);SC.RunLoop.end();this.attributeMenu.popup(this.menuAnchorView,h)},getAttributeMenuItems:function(){var e=this.getPath("dataContext.childCollection"),c=e&&e.get("name"),d=e?e.getAttributeNames():[],g=d.map(function(j){return{title:j,collection:e}}),h=this.getPath("dataContext.parentCollection"),i=h&&h.get("name"),f=h?h.getAttributeNames():[],b=f.map(function(j){return{title:j,collection:h}});if(b.length===0){return g}else{if(g.length===0){return b}else{return[{title:c,subMenu:g},{title:i,subMenu:b}]}}},attributeMenuItemChanged:function(){var e=this.attributeMenu.selectedItem,b=e&&e.collection,g=this.attributeMenu.selectedAxis,c,d=this.get("graphModel"),f=this.get("dataContext");if(!e){return}if(b){c={collection:b,attributes:[b.attrsController.objectAt(e.contentIndex)]};if(this.attributeMenu.isLegend){d.changeAttributeForLegend(f,c)}else{d.changeAttributeForAxis(f,c,g)}}else{if(e.target===d){e.itemAction.apply(e.target,e.args)}}this.menuAnchorView.set("isVisible",false)},axisViewDidAcceptDrop:function(e,d,c){if(SC.none(c)){return}var f=this.get("dataContext"),b=a(f,c);e.dragData=null;this.get("graphModel").changeAttributeForAxis(f,{collection:b,attributes:[c.attribute]},e.get("orientation"))}.observes("*xAxisView.dragData","*yAxisView.dragData"),multiTargetDidAcceptDrop:function(e,d,c){if(SC.none(c)){return}var f=this.get("dataContext"),b=a(f,c);e.dragData=null;this.get("graphModel").addAttributeToAxis(f,{collection:b,attribute:c.attribute})}.observes("*axisMultiTarget.dragData"),plotOrLegendViewDidAcceptDrop:function(c,e,d){if(SC.none(d)){return}var f=this.get("dataContext"),b=a(f,d);c.dragData=null;this.get("graphModel").changeAttributeForLegend(f,{collection:b,attributes:[d.attribute]})}.observes("*plotView.dragData","*legendView.dragData")}}()));sc_require("alpha/destroyable");DG.DataDisplayModel=SC.Object.extend(DG.Destroyable,{autoDestroyProperties:["dataConfiguration"],dataConfiguration:null,collectionClient:null,collectionClientBinding:"*dataConfiguration.collectionClient",casesController:null,casesControllerBinding:"*dataConfiguration.collectionClient.casesController",cases:null,casesBinding:"*dataConfiguration.cases",selection:function(){return this.getPath("dataConfiguration.selection")}.property("dataConfiguration.selection"),_oldNumberOfCases:0,init:function(){arguments.callee.base.apply(this,arguments)},destroy:function(){if(this._dataContext){this._dataContext.removeObserver("changeCount",this,"handleDataContextNotification")}arguments.callee.base.apply(this,arguments)},_dataContext:null,dataContext:function(a,b){if(b){if(b!==this._dataContext){if(this._dataContext){this._dataContext.removeObserver("changeCount",this,"handleDataContextNotification")}this._dataContext=b;if(this._dataContext){this._dataContext.addObserver("changeCount",this,"handleDataContextNotification")}}return this}return this._dataContext}.property(),dataContextDidChange:function(){var a=this.get("dataConfiguration");if(a){a.set("dataContext",this.get("dataContext"))}}.observes("dataContext"),deleteSelectedCases:function(){var a={operation:"deleteCases",cases:DG.copy(this.get("selection"))};this.get("dataContext").applyChange(a)},deleteUnselectedCases:function(){var c=this.getPath("dataConfiguration.cases");var a=DG.ArrayUtils.subtract(c,this.get("selection"),function(d){return d.get("id")});var b={operation:"deleteCases",cases:DG.copy(a)};this.get("dataContext").applyChange(b)},selectAll:function(d){var c=SC.none(d)?true:!!d,b=c?this.get("cases"):null,a={operation:"selectCases",collection:this.get("collectionClient"),cases:b,select:c};this.get("dataContext").applyChange(a);DG.logUser(d?"selectAll":"deselectAll")},instantiateAttributeRefFromStorage:function(e,k,g){var b={collection:null,attributes:[]},d=this.getPath("dataConfiguration.dataContext");if(SC.empty(k)||SC.empty(g)||!e||!e._links_){return b}var c=e._links_[k],a=c&&c.id&&d.getCollectionByID(c.id),i=[],f=DG.ArchiveUtils.getLinkCount(e,g),j;if(!a){return b}for(j=0;j<f;j++){var h=a.getAttributeByID(DG.ArchiveUtils.getLinkID(e,g,j));if(h){i.push(h)}}return{collection:a,attributes:i}},restoreStorage:function(a){this.get("dataConfiguration").restoreHiddenCases(a.hiddenCases)},handleOneDataContextChange:function(a,b){},buildIndices:function(b){var a=this.getPath("dataConfiguration.cases");if((b.operation==="updateCases")&&a&&!SC.none(b.cases)&&!this.getPath("dataConfiguration.hasAggregates")){var d={},c=SC.IndexSet.create();b.cases.forEach(function(e){d[e.get("id")]=e});a.forEach(function(f,g){var e=f.get("id");if(d[e]){c.add(g)}});return c}return SC.IndexSet.create(0,this.getPath("dataConfiguration.cases.length"))},handleDataContextNotification:function(c){var b=c.get("newChanges"),a=b.length,d;for(d=0;d<a;d++){this.handleOneDataContextChange(c,b[d])}},dataRangeDidChange:function(d,c,b,a){this.invalidate()},invalidate:function(b,a){this.get("dataConfiguration").invalidateCaches(null,b)}});sc_require("components/graph_map_common/data_display_model");DG.GraphModel=DG.DataDisplayModel.extend({autoDestroyProperties:["plot","xAxis","yAxis","legend"],numberToggle:null,xAxis:null,yAxis:null,legend:null,plot:function(a,b){if(!SC.none(b)){this._plots.forEach(function(c){c.removeObserver("connectingLine",this,this.connectingLineChanged);c.destroy()});this._plots=[b];b.addObserver("connectingLine",this,this.connectingLineChanged)}return(this._plots.length<1)?null:this._plots[0]}.property(),_plots:null,plots:function(){return this._plots}.property(),lastPlot:function(){var a=this._plots.length;return(a>0)?this._plots[a-1]:null}.property(),getPlotAtIndex:function(a){if(a<this._plots.length){return this._plots[a]}return null},addPlot:function(b){if(!this._plots.contains(b)){var a=this.get("plot");if(a.isAdornmentVisible("connectingLine")){b.toggleAdornmentVisibility("connectingLine")}this._plots.push(b)}},removePlotAtIndex:function(a){DG.assert(a<this._plots.length);var b=this._plots[a];this._plots.splice(a,1);b.destroy();this._plots.forEach(function(d,c){d.setIfChanged("yAttributeIndex",c)})},aboutToChangeConfiguration:false,xAxisChanged:function(){var a=this.get("plot");if(!SC.none(a)){a.set("xAxis",this.get("xAxis"))}}.observes("xAxis"),yAxisChanged:function(){var a=this.get("plot");if(!SC.none(a)){a.set("yAxis",this.get("yAxis"))}}.observes("yAxis"),connectingLineChanged:function(){var a=this.get("plots"),b=(a.length>0)?a[0].getAdornmentModel("connectingLine").get("isVisible"):false;this.get("plots").forEach(function(d,c){if(c>0){d.setAdornmentVisibility("connectingLine",b)}})},init:function(){var d,a,b;arguments.callee.base.apply(this,arguments);function c(e){if(e===DG.Analysis.EAttributeType.eNumeric){return DG.CellLinearAxisModel}else{if(e===DG.Analysis.EAttributeType.eCategorical){return DG.CellAxisModel}else{return DG.AxisModel}}}this.set("dataConfiguration",DG.GraphDataConfiguration.create());this._plots=[];if(DG.IS_INQUIRY_SPACE_BUILD){this.set("numberToggle",DG.NumberToggleModel.create({dataConfiguration:this.get("dataConfiguration")}))}d=this.dataConfiguration.get("xAttributeDescription");a=this.dataConfiguration.get("yAttributeDescription");b=this.dataConfiguration.get("legendAttributeDescription");this.set("xAxis",c(d.get("attributeType")).create());this.setPath("xAxis.attributeDescription",d);this.set("yAxis",c(a.get("attributeType")).create());this.setPath("yAxis.attributeDescription",a);this.set("legend",DG.LegendModel.create());this.setPath("legend.attributeDescription",b);this.synchPlotWithAttributes();this.invalidate();this.rescaleAxesFromData(true,true)},destroy:function(){arguments.callee.base.apply(this,arguments)},changeAttributeForAxis:function(c,d,e){var a=(e==="horizontal")?"xAttributeDescription":"yAttributeDescription",f=(e==="horizontal")?"xAxis":"yAxis";DG.logUser("plotAxisAttributeChange: { orientation: %@, attribute: %@ }",e,d.attributes[0].get("name"));this.set("aboutToChangeConfiguration",true);var b=this.get("dataConfiguration");b.set("dataContext",c);b.setAttributeAndCollectionClient(a,d);this.privSyncAxisWithAttribute(a,f);this.invalidate();this.set("aboutToChangeConfiguration",false)},changeAttributeForLegend:function(c,d){var a=d&&d.attributes[0];if(a){DG.logUser("legendAttributeChange: { to attribute %@ }",a.get("name"))}else{DG.logUser("legendAttributeRemoved:")}this.set("aboutToChangeConfiguration",true);var b=this.get("dataConfiguration");if(c){b.set("dataContext",c)}b.setAttributeAndCollectionClient("legendAttributeDescription",d);this.invalidate();this.set("aboutToChangeConfiguration",false)},addAttributeToAxis:function(d,c){DG.logUser("addAxisAttribute: { attribute: %@ }",c.attribute.get("name"));var a=this.getPath("dataConfiguration.yAttributeDescription"),b=a.get("attributes").length;a.addAttribute(c.attribute);var e=DG.ScatterPlotModel.create();e.beginPropertyChanges();e.setIfChanged("dataConfiguration",this.get("dataConfiguration"));e.setIfChanged("xAxis",this.get("xAxis"));e.setIfChanged("yAxis",this.get("yAxis"));e.set("yAttributeIndex",b);e.endPropertyChanges();this.addPlot(e);this.notifyPropertyChange("attributeAdded")},hasNumericAxis:function(){return this.getPath("xAxis.isNumeric")||this.getPath("yAxis.isNumeric")}.property(),rescaleAxesFromData:function(a,b){var c=this.get("plot");if(c){c.rescaleAxesFromData(a,b)}},removeLegendAttribute:function(){this.changeAttributeForLegend(null,null)},changeAttributeType:function(b,a,c){var d=this.get("dataConfiguration");DG.logUser("plotAxisAttributeChangeType: { axis: %@, attribute: %@ }",a,d.getPath(b+".attribute.name"));this.set("aboutToChangeConfiguration",true);d.setAttributeType(b,c);if(b==="xAttributeDescription"||b==="yAttributeDescription"){this.privSyncAxisWithAttribute(b,a)}this.invalidate(null,true);this.set("aboutToChangeConfiguration",false)},privSyncAxisWithAttribute:function(e,c){var g=this.get("dataConfiguration"),d=g.getPath(e+".isNumeric"),f=this.getPath(c+".isNumeric");if(f!==d){var b=this.get(c),a=d?DG.CellLinearAxisModel.create():DG.CellAxisModel.create();a.set("attributeDescription",g.get(e));this.set(c,a);b.destroy();this.synchPlotWithAttributes()}},synchPlotWithAttributes:function(){var b=this.get("dataConfiguration"),i=b.get("xType"),h=b.get("yType"),e=this.get("plot"),a,j,g,d,c={};d=[[DG.CasePlotModel,DG.DotPlotModel,DG.DotChartModel],[DG.DotPlotModel,DG.ScatterPlotModel,DG.DotPlotModel],[DG.DotChartModel,DG.DotPlotModel,DG.DotChartModel]];a=d[i][h];if(SC.none(a)){a=DG.PlotModel}a.configureRoles(b);if(SC.none(e)||(a!==e.constructor)){j=g=a.create()}else{g=e}if(e&&g!==e){c=e.copyAdornmentModels(g)}g.beginPropertyChanges();g.setIfChanged("dataConfiguration",b);g.setIfChanged("xAxis",this.get("xAxis"));g.setIfChanged("yAxis",this.get("yAxis"));for(var f in c){if(c.hasOwnProperty(f)){g.setIfChanged(f,c[f])}}g.endPropertyChanges();this.setIfChanged("plot",g);if(!SC.none(j)&&!SC.none(e)){e.destroy()}},removeAttribute:function(c,b,a){var e=function(){var l=f.getPath(c+".attribute.name"),j=this.get(b),h=DG.AxisModel.create(),i=(c==="xAttributeDescription")?"yAttributeDescription":"xAttributeDescription",m,k;DG.logUser("attributeRemoved: %@",l);this.set("aboutToChangeConfiguration",true);h.set("attributeDescription",f.get(c));this.set(b,h);j.destroy();f.setAttributeAndCollectionClient(c,null);switch(this.getPath("dataConfiguration."+i+".attributeType")){case DG.Analysis.EAttributeType.eNumeric:m=DG.Analysis.EAnalysisRole.eSecondaryNumeric;k=DG.Analysis.EAnalysisRole.ePrimaryNumeric;break;case DG.Analysis.EAttributeType.eCategorical:m=DG.Analysis.EAnalysisRole.eSecondaryCategorical;k=DG.Analysis.EAnalysisRole.ePrimaryCategorical;break;default:m=DG.Analysis.EAnalysisRole.eNone;k=DG.Analysis.EAnalysisRole.eNone}f.get(c).set("role",m);f.get(i).set("role",k);this.synchPlotWithAttributes();this.invalidate();this.set("aboutToChangeConfiguration",false)}.bind(this),d=function(){var h=f.get(c);h.removeAttributeAtIndex(a);this.removePlotAtIndex(a);this.notifyPropertyChange("attributeRemoved")}.bind(this);a=a||0;var f=this.get("dataConfiguration"),g=f.getPath(c+".attributes");if(g.length===1){e()}else{d()}},restoreStorage:function(d){var c=this.getPath("dataConfiguration.dataContext"),j,f,i,l=DG.Core.classFromClassName(d.xAxisClass),k=this.get("xAxis"),b=DG.Core.classFromClassName(d.yAxisClass),h=this.get("yAxis"),n=k.constructor,o=h.constructor,m=this.get("dataConfiguration");var a=function(p){p.forEach(function(q,r){if(!q.plotClass){return}var s=DG.Core.classFromClassName(q.plotClass).create({_isBeingRestored:true});s.beginPropertyChanges();s.setIfChanged("dataConfiguration",m);s.setIfChanged("xAxis",this.get("xAxis"));s.setIfChanged("yAxis",this.get("yAxis"));s.setIfChanged("yAttributeIndex",r);s.endPropertyChanges();if(r===0){this.set("plot",s)}else{this.addPlot(s)}}.bind(this))}.bind(this);arguments.callee.base.apply(this,arguments);j=this.instantiateAttributeRefFromStorage(d,"xColl","xAttr");f=this.instantiateAttributeRefFromStorage(d,"yColl","yAttr");i=this.instantiateAttributeRefFromStorage(d,"legendColl","legendAttr");this.set("aboutToChangeConfiguration",true);m.setAttributeAndCollectionClient("xAttributeDescription",j,d.xRole,d.xAttributeType);m.setAttributeAndCollectionClient("yAttributeDescription",f,d.yRole,d.yAttributeType);m.setAttributeAndCollectionClient("legendAttributeDescription",i,d.legendRole,d.legendAttributeType);this.set("aboutToChangeConfiguration",false);if(l&&l!==n){var g=l.create();g.set("attributeDescription",m.get("xAttributeDescription"));this.set("xAxis",g);k.destroy()}if(b&&b!==o){var e=b.create();e.set("attributeDescription",m.get("yAttributeDescription"));this.set("yAxis",e);h.destroy()}a((d.plotClass?[{plotClass:d.plotClass}]:null)||d.plotModels||[]);this.get("plots").forEach(function(p){p._isBeingRestored=null})},getGearMenuItems:function(){var c=this,b=this.get("plot");if(SC.none(b)){return[]}var a=function(){var d=c.get("selection"),e=d&&d.get("length")!==0;return[{title:"Select All",target:c,itemAction:c.selectAll,isEnabled:true},{title:"Delete Selected Cases",target:c,itemAction:c.deleteSelectedCases,isEnabled:e},{title:"Delete Unselected Cases (Beta)",target:c,itemAction:c.deleteUnselectedCases,isEnabled:e}]};return b.getGearMenuItems().concat(a()).concat([{isSeparator:YES}]).concat(this.createHideShowAttributeSubMenuItems())},createHideShowAttributeSubMenuItems:function(){var e=this.getPath("dataConfiguration.selection").toArray(),f=e&&e.get("length")!==0,b=this.getPath("dataConfiguration.cases"),c=e&&b&&(e.get("length")<b.length),g=this.getPath("dataConfiguration.hiddenCases").length>0,a=(e&&e.length>1)?"Plural":"Sing",h=(e&&b&&(b.length-e.length>1))?"Plural":"Sing";function j(){DG.logUser("Hide %@ selected cases",e.length);this.get("dataConfiguration").hideCases(e)}function i(){var k=DG.ArrayUtils.subtract(b,e,function(l){return l.get("id")});DG.logUser("Hide %n selected cases",k.length);this.get("dataConfiguration").hideCases(k)}function d(){DG.logUser("Show all cases");this.get("dataConfiguration").showAllCases()}return[{title:("DG.GraphMenu.hideSelected"+a),isEnabled:f,target:this,itemAction:j},{title:("DG.GraphMenu.hideUnselected"+h),isEnabled:c,target:this,itemAction:i},{title:"DG.GraphMenu.showAll",isEnabled:g,target:this,itemAction:d}]},createRemoveAttributeMenuItem:function(a,f,h){h=h||0;var b=a+"AttributeDescription",k=a+"Axis",i=this.getPath("dataConfiguration."+b+".attributes"),j=(SC.isArray(i)&&h<i.length)?i[h]:DG.Analysis.kNullAttribute,e=(j===DG.Analysis.kNullAttribute)?"":j.get("name"),g=f?"attribute_":"removeAttribute_",c=("DG.GraphMenu."+g+a).loc(e),d=((a==="x"||a==="y")?this.removeAttribute:this.removeLegendAttribute);return{title:c,target:this,itemAction:d,isEnabled:(j!==DG.Analysis.kNullAttribute),args:[b,k,h]}},createChangeAttributeTypeMenuItem:function(f){var d=f+"AttributeDescription",g=f+"Axis",c=this.getPath("dataConfiguration."+d),b=c&&c.get("attribute"),e=c&&c.get("isNumeric"),a=(e?"DG.GraphMenu.treatAsCategorical":"DG.GraphMenu.treatAsNumeric").loc();return{title:a,target:this,itemAction:this.changeAttributeType,isEnabled:(b!==DG.Analysis.kNullAttribute),args:[d,g,!e]}},stopAnimation:function(){this.get("plot").stopAnimation();this.get("xAxis").stopAnimation();this.get("yAxis").stopAnimation()},isParentCase:function(a){var b=a.get("parent");return SC.none(b)},handleOneDataContextChange:function(b,d){var c=this.get("plot"),a=d&&d.operation;if(c&&!c.isAffectedByChange(d)){return}switch(a){case"createCase":case"createCases":case"deleteCases":this.dataDidChange(null,null,d);break;case"updateCases":case"createAttributes":case"updateAttributes":this.get("dataConfiguration").invalidateCaches(null,d);d.indices=this.buildIndices(d);this.dataRangeDidChange(this,"revision",this,d.indices);break;case"selectCases":break}this.get("plots").forEach(function(e){e.handleDataContextNotification(b,d)})},handleDataContextNotification:function(a){arguments.callee.base.apply(this,arguments);if(this.get("numberToggle")){this.get("numberToggle").handleDataContextNotification(a)}},dataDidChange:function(a,d,g){var h=this.get("plot");if(h&&h.isAffectedByChange(g)){this.invalidate(g);var b=this.get("dataConfiguration"),i=b&&b.get("cases"),f=i?i.length:0;if(f!==this._oldNumberOfCases){var e=(f>this._oldNumberOfCases);if(h&&e){var c=i[f-1];if(this.isParentCase(c)){h.set("openParentCaseID",c.get("id"))}h.rescaleAxesFromData(false,false)}this._oldNumberOfCases=f}}if(this.getPath("dataConfiguration.hasAggregates")){this.invalidate()}},invalidate:function(c,a){var b=this.get("plot");arguments.callee.base.apply(this,arguments);if(a&&!SC.none(b)){b.invalidateCaches()}}});DG.GraphTypes={EPlace:{eUndefined:-1,eX:0,eY:1,eLegend:2,eNumPlaces:3}};DG.GraphView=SC.View.extend({displayProperties:["model.dataConfiguration.attributeAssignment"],classNames:"graph-view".w(),model:null,controller:null,xAxisView:null,yAxisView:null,yAxisMultiTarget:null,legendView:null,plotBackgroundView:null,numberToggleView:null,rescaleButton:null,plotView:function(a,b){if(!SC.none(b)){this._plotViews.forEach(function(c){c.destroy()});this._plotViews=[b]}return(this._plotViews.length<1)?null:this._plotViews[0]}.property(),_plotViews:null,plotViews:function(){return this._plotViews}.property(),addPlotView:function(a){if(!this._plotViews.contains(a)){this._plotViews.push(a)}},setPlotViewProperties:function(c,a,b){c.beginPropertyChanges();c.setIfChanged("paperSource",this.get("plotBackgroundView"));c.setIfChanged("model",a);c.setIfChanged("xAxisView",this.xAxisView);c.setIfChanged("yAxisView",this.yAxisView);c.setIfChanged("parentView",this);if(!SC.none(b)){c.set("cachedPointCoordinates",b)}c.addObserver("plotDisplayDidChange",this,function(){this.invokeLast(this.drawPlots)});c.endPropertyChanges()},init:function(){function c(n){switch(n.constructor){case DG.AxisModel:return DG.AxisView;case DG.CellLinearAxisModel:return DG.CellLinearAxisView;case DG.CellAxisModel:return DG.CellAxisView}return null}var g=function(){this.get("model").rescaleAxesFromData(true,true)}.bind(this);var f=this.getPath("model.xAxis"),e=this.getPath("model.yAxis"),a={orientation:"horizontal"},d={orientation:"vertical"},h=c(f).create(a),m=c(e).create(d),j=DG.PlotBackgroundView.create({xAxisView:h,yAxisView:m,graphModel:this.get("model")}),b=this.getPath("model.plots"),k=DG.LegendView.create();arguments.callee.base.apply(this,arguments);this.createMultiTarget();this._plotViews=[];this.set("xAxisView",h);this.appendChild(h);this.set("yAxisView",m);this.appendChild(m);this.set("plotBackgroundView",j);this.appendChild(j);this.set("legendView",k);this.appendChild(k);if(DG.IS_INQUIRY_SPACE_BUILD){var l=DG.NumberToggleView.create({model:this.getPath("model.numberToggle")});this.set("numberToggleView",l);this.appendChild(l);var i=SC.ImageButtonView.create({classNames:["rescale-button"],layout:{width:16,height:16,right:2,top:1},toolTip:"DG.GraphView.rescale".loc(),action:g});this.set("rescaleButton",i);this.appendChild(i)}h.set("model",f);m.set("model",e);b.forEach(function(o){var n=this.mapPlotModelToPlotView(o).create();this.addPlotView(n);this.setPlotViewProperties(n,o)}.bind(this));k.set("model",this.getPath("model.legend"));DG.globalsController.addObserver("globalValueChanges",this,"globalValueDidChange")},destroy:function(){DG.globalsController.removeObserver("globalValueChanges",this,"globalValueDidChange");this.model.destroy();arguments.callee.base.apply(this,arguments)},drawPlots:function(){var b=this.get("plotViews"),a=b.length;this.get("plotViews").forEach(function(d,c){if(d.readyToDraw()){d.doDraw(c,a)}})},selectPointsInRect:function(d,f){var a=[];f=f||[];var e=this.getPath("model.dataContext"),c=this.getPath("model.collectionClient");if(SC.none(e)){return}this.get("plotViews").forEach(function(g){var h=g.getCasesForPointsInRect(d);a=a.concat(h)});var b={operation:"selectCases",collection:c,cases:f.concat(a),select:true};if(b.cases.length===0){b.cases=null;b.select=false}e.applyChange(b)},handleBackgroundClick:function(a){this.get("plotView").handleBackgroundClick(a)},handleBackgroundDblClick:function(a){this.get("plotView").handleBackgroundDblClick(a)},renderLayout:function(b,a){if(this._isRenderLayoutInProgress){return}this._isRenderLayoutInProgress=true;arguments.callee.base.apply(this,arguments);var g=this.get("xAxisView"),m=this.get("yAxisView"),h=this.get("plotBackgroundView"),e=this.get("plotViews"),k=this.get("legendView"),n=this.get("numberToggleView"),j=this.get("rescaleButton"),f=!SC.none(n)&&n.shouldShow(),l=SC.none(g)?0:g.get("desiredExtent"),d=SC.none(m)?0:m.get("desiredExtent"),i=SC.none(k)?0:k.get("desiredExtent"),c=f?n.get("desiredExtent"):0;if(!SC.none(g)&&!SC.none(m)&&(e.length>0)){if(a){g.set("layout",{left:d,bottom:i,height:l});m.set("layout",{left:0,top:c,bottom:l+i,width:d});h.set("layout",{left:d,top:c,bottom:l+i});k.set("layout",{bottom:0,height:i});if(n){n.set("layout",{left:d,height:c})}}else{g.adjust("left",d);g.adjust("bottom",i);g.adjust("height",l);m.adjust("bottom",l+i);m.adjust("width",d);m.adjust("top",c);h.adjust("left",d);h.adjust("top",c);h.adjust("bottom",l+i);k.adjust("height",i);if(n){n.adjust("height",c)}}if(n){n.set("isVisible",f)}if(j){j.set("isVisible",this.getPath("model.hasNumericAxis"))}}this._isRenderLayoutInProgress=false},viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.renderLayout(this.renderContext(this.get("tagName")));this.invokeOnce(this.drawPlots)},_isRenderLayoutInProgress:false,handleAxisModelChange:function(){var d=this,b=false,c=this.get("plotBackgroundView");function a(m,l){var k=d.getPath(m),f=k&&k.constructor,n=d.get(l),g=n&&n.constructor,i,e,h=d.get("plotView"),j=(l==="xAxisView")?{orientation:"horizontal"}:{orientation:"vertical"};switch(f){case DG.AxisModel:i=DG.AxisView;break;case DG.CellAxisModel:i=DG.CellAxisView;break;case DG.CellLinearAxisModel:i=DG.CellLinearAxisView;break;default:i=null}if(i&&(g!==i)){e=i.create(j);e.set("model",k);d.removeChild(n);d.appendChild(e);d.set(l,e);c.set(l,e);if(!SC.none(h)){h.set(l,e)}n.destroy();d.controller.set(l,e);b=true}}a("model.xAxis","xAxisView");a("model.yAxis","yAxisView");this.renderLayout(this.renderContext(this.get("tagName")),b)}.observes(".model.xAxis",".model.yAxis"),handlePlotModelChange:function(){var f=this.getPath("model.plot"),e=this.get("plotView"),c=e.constructor,g,a,d,b=false;a=this.mapPlotModelToPlotView(f);if(a&&(c!==a)){d=a.create();b=true}if(!SC.none(d)){if(!SC.none(e)){g=e.get("cachedPointCoordinates")}this.setPlotViewProperties(d,f,g);if(d.readyToDraw()){d.doDraw()}this.set("plotView",d);if(b){this.renderLayout(this.renderContext(this.get("tagName")),b)}}}.observes(".model.plot"),handleAttributeAdded:function(){var b=this.getPath("model.lastPlot"),a;if(!SC.none(b)){a=DG.ScatterPlotView.create();this.addPlotView(a);this.renderLayout(this.renderContext(this.get("tagName")),false);this.setPlotViewProperties(a,b)}}.observes("model.attributeAdded"),handleAttributeRemoved:function(){var a=this.getPath("model.plots"),c=this.get("plotViews"),b;c.forEach(function(e,d){if(a.indexOf(e.get("model"))<0){b=d;e.removePlottedElements(true);e.destroy()}});c.splice(b,1)}.observes("model.attributeRemoved"),configurationIsAboutToChange:function(){var a=this.get("plotView");if(this.getPath("model.aboutToChangeConfiguration")){a.prepareForConfigurationChange()}else{a.handleConfigurationChange()}}.observes(".model.aboutToChangeConfiguration"),handleAxisOrLegendLayoutChange:function(){this.renderLayout(this.renderContext(this.get("tagName")))}.observes("*xAxisView.desiredExtent","*yAxisView.desiredExtent","*legendView.desiredExtent"),handleNumberToggleCaseCountChange:function(){this.renderLayout(this.renderContext(this.get("tagName")))}.observes("model.numberToggle.caseCount"),globalValueDidChange:function(){var a=this.get("plotView");if(a){a.refreshCoordinates()}},mapPlotModelToPlotView:function(b){var c=b&&b.constructor,a=null;switch(c){case DG.PlotModel:a=DG.PlotView;break;case DG.CasePlotModel:a=DG.CasePlotView;break;case DG.DotPlotModel:a=DG.DotPlotView;break;case DG.ScatterPlotModel:a=DG.ScatterPlotView;break;case DG.DotChartModel:a=DG.DotChartView;break}return a},createMultiTarget:function(){var b=DG.AxisMultiTarget.create(),a=b.get("desiredExtent");this.appendChild(b);b.set("attributeDescription",this.getPath("model.yAxis.attributeDescription"));b.set("otherAttributeDescription",this.getPath("model.xAxis.attributeDescription"));b.set("layout",{left:0,top:0,width:a.width,height:a.height});this.set("yAxisMultiTarget",b)}});sc_require("alpha/destroyable");DG.PlotModel=SC.Object.extend(DG.Destroyable,{dataConfiguration:null,dataContext:function(){return this.getPath("dataConfiguration.dataContext")}.property("dataConfiguration.dataContext"),collectionClient:function(){return this.getPath("dataConfiguration.collectionClient")}.property("dataConfiguration.collectionClient"),cases:function(){return this.getPath("dataConfiguration.cases")}.property("dataConfiguration.cases"),casesController:null,casesControllerBinding:"*dataConfiguration.collectionClient.casesController",selection:function(){return this.getPath("dataConfiguration.selection")}.property("dataConfiguration.selection"),xVarID:function(){return this.getPath("dataConfiguration.xAttributeID")}.property("dataConfiguration.xAttributeID"),yAttributeIndex:0,yVarID:function(){var a=this.get("dataConfiguration");return a?a.yAttributeIDAt(this.yAttributeIndex):null}.property("dataConfiguration.yAttributeID"),legendVarID:function(){return this.getPath("dataConfiguration.legendAttributeID")}.property("dataConfiguration.legendAttributeID"),primaryVarID:function(){switch(this.get("primaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xVarID");case DG.GraphTypes.EPlace.eY:return this.get("yVarID");default:return null}}.property("xVarID","yVarID"),secondaryVarID:function(){switch(this.get("secondaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xVarID");case DG.GraphTypes.EPlace.eY:return this.get("yVarID");default:return null}}.property("xVarID","yVarID"),xAxis:null,yAxis:null,autoDestroyProperties:["plotAnimator","caseValueAnimator"],plotAnimator:null,caseValueAnimator:null,_adornmentModels:null,plottedCount:null,isPlottedCountVisible:function(){return !SC.none(this.plottedCount)&&this.plottedCount.get("isVisible")}.property("plottedCount"),togglePlottedCount:function(){if(SC.none(this.plottedCount)){this.beginPropertyChanges();this.set("plottedCount",DG.PlottedCountModel.create({plotModel:this}));this.setAdornmentModel("plottedCount",this.get("plottedCount"));this.plottedCount.recomputeValue();this.endPropertyChanges()}else{var a=!this.plottedCount.get("isVisible");this.plottedCount.set("isVisible",a)}DG.logUser("togglePlottedCount: %@",this.plottedCount.get("isVisible")?"show":"hide")},init:function(){arguments.callee.base.apply(this,arguments);this._adornmentModels={};this.addObserver("dataConfiguration",this,"dataConfigurationDidChange");this.addObserver("xAxis",this,"xAxisDidChange");this.addObserver("yAxis",this,"yAxisDidChange")},destroy:function(){this.set("xAxis",null);this.set("yAxis",null);this.removeObserver("xAxis",this,"xAxisDidChange");this.removeObserver("yAxis",this,"yAxisDidChange");this.set("dataConfiguration",null);this.removeObserver("dataConfiguration",this,"dataConfigurationDidChange");DG.ObjectMap.forEach(this._adornmentModels,function(a,b){if(b&&b.destroy){b.destroy()}});this._adornmentModels=null;arguments.callee.base.apply(this,arguments)},_observedXAxis:null,_observedYAxis:null,xAxisDidChange:function(){if(this._observedXAxis){this._observedXAxis.removeObserver("lowerBound",this,"axisBoundsDidChange");this._observedXAxis.removeObserver("upperBound",this,"axisBoundsDidChange");this._observedXAxis=null}var a=this.get("xAxis");if(a){a.addObserver("lowerBound",this,"axisBoundsDidChange");a.addObserver("upperBound",this,"axisBoundsDidChange");this._observedXAxis=a}},yAxisDidChange:function(){if(this._observedYAxis){this._observedYAxis.removeObserver("lowerBound",this,"axisBoundsDidChange");this._observedYAxis.removeObserver("upperBound",this,"axisBoundsDidChange");this._observedYAxis=null}var a=this.get("yAxis");if(a){a.addObserver("lowerBound",this,"axisBoundsDidChange");a.addObserver("upperBound",this,"axisBoundsDidChange");this._observedYAxis=a}},dataArrays:function(){return this.getPath("dataConfiguration.arrangedObjectArrays")}.property("dataConfiguration"),isAnimating:false,getAdornmentModel:function(a){DG.assert(this._adornmentModels);DG.assert(a);return a&&this._adornmentModels[a]},setAdornmentModel:function(a,b){DG.assert(this._adornmentModels);DG.assert(a);this._adornmentModels[a]=b;this.notifyPropertyChange(a)},isAdornmentVisible:function(b){var a=this.getAdornmentModel(b);return a?a.get("isVisible"):false},setAdornmentVisibility:function(d,c){var b=this.getAdornmentModel(d);if(!b){var a=DG.PlotAdornmentModel.registry[d];DG.assert(a,"No model class registered for '%@'".fmt(d));b=a&&a.create({plotModel:this});if(b){this.setAdornmentModel(d,b)}}if(b&&(this.isAdornmentVisible(d)!==c)){b.set("isVisible",c);this.notifyPropertyChange(d)}},toggleAdornmentVisibility:function(b,a){DG.assert(!SC.empty(b));var c=this.getAdornmentModel(b),d=c&&c.get("isVisible");this.setAdornmentVisibility(b,!d);DG.logUser("%@: %@",a||"toggle"+b,!d?"show":"hide");return c},getAxisForPlace:function(a){switch(a){case DG.GraphTypes.EPlace.eX:return this.get("xAxis");case DG.GraphTypes.EPlace.eY:return this.get("yAxis");default:return null}},invalidateCaches:function(){this.notifyPropertyChange("plotConfiguration")},handleDataConfigurationChange:function(){},rescaleAxesFromData:function(c,b,a){},axisBoundsDidChange:function(){this.notifyPropertyChange("axisBounds")},animateSelectionBackToStart:function(a,b){if(SC.none(this.caseValueAnimator)){this.caseValueAnimator=DG.CaseValueAnimator.create()}else{this.caseValueAnimator.endAnimation()}this.caseValueAnimator.set("dataContext",this.get("dataContext"));this.caseValueAnimator.set("cases",DG.copy(this.get("selection")));this.caseValueAnimator.set("attributeIDs",a);this.caseValueAnimator.set("deltas",b);this.caseValueAnimator.animate()},getGearMenuItems:function(){var a=(this.get("isPlottedCountVisible")?"DG.PlotModel.hideCount":"DG.PlotModel.showCount").loc();return[{title:a,target:this,itemAction:this.togglePlottedCount}]},forEachCaseDo:function(a){var b=this.get("cases");if(!SC.none(b)){b.forEach(a)}},getPlottedCollectionIDs:function(){return this.getPath("dataConfiguration.plottedCollectionIDs")||[]},getPlottedAttributeIDs:function(){var c=[],b=this.get("dataConfiguration"),a=["xAttributeID","yAttributeID","legendAttributeID"];if(!b){return c}a.forEach(function(d){var e=b.get(d);if(!SC.none(e)&&(e!==DG.Analysis.kNullAttribute)){if(c.indexOf(e)<0){c.push(e)}}});return c},getPlottedAttributesIncludeIDs:function(b){var c=this.getPlottedAttributeIDs(),a=false;b.forEach(function(d){if(c.indexOf(d)>=0){a=true}});return a},getPlottedAttributesContainFormulas:function(){var c=false,b=this.get("dataConfiguration"),a=["xAttributeDescription","yAttributeDescription","legendAttributeDescription"];if(!b){return false}a.forEach(function(d){var e=b.get(d);if(e&&e.get("hasFormula")){c=true}});return c},isAffectedByChange:function(d){var a=false;if(!d||!d.operation){return false}switch(d.operation){case"updateCases":var c=d.attributeIDs;if(c){a=this.getPlottedAttributesIncludeIDs(c);return a||this.getPlottedAttributesContainFormulas()}case"createCase":case"createCases":var b=d.collection&&d.collection.get("id"),e=this.getPlottedCollectionIDs();return !b||(e.indexOf(b)>=0);case"deleteCases":case"selectCases":return true;case"createAttributes":case"updateAttributes":if(d.result&&d.result.attrIDs){a=this.getPlottedAttributesIncludeIDs(d.result.attrIDs)}return a||this.getPlottedAttributesContainFormulas()}return true},handleDataContextNotification:function(a,b){this.set("lastChange",b)},_observedDataConfiguration:null,dataConfigurationDidChange:function(c,a){if(this._observedDataConfiguration&&(a==="dataConfiguration")){this._observedDataConfiguration.removeObserver("cases",this,"dataConfigurationDidChange");this._observedDataConfiguration.removeObserver("attributeAssignment",this,"dataConfigurationDidChange");this._observedDataConfiguration.removeObserver("arrangedObjectArrays",this,"sourceArraysDidChange");this._observedDataConfiguration.removeObserver("hiddenCases",this,"hiddenCasesDidChange");this._observedDataConfiguration=null}var b=this.get("dataConfiguration");if(b){this.invalidateCaches();this.handleDataConfigurationChange();if(a==="dataConfiguration"){b.addObserver("cases",this,"dataConfigurationDidChange");b.addObserver("attributeAssignment",this,"dataConfigurationDidChange");b.addObserver("arrangedObjectArrays",this,"sourceArraysDidChange");b.addObserver("hiddenCases",this,"hiddenCasesDidChange");this._observedDataConfiguration=b}}},sourceArraysDidChange:function(b,a){this.invalidateCaches();this.notifyPropertyChange("dataArrays")},selectCaseByIndex:function(d,f){var e=this.get("cases"),b=e[d],a=this.get("selection"),c={operation:"selectCases",collection:this.get("collectionClient"),cases:[b],select:true,extend:f};if(a.get("length")!==0){if(a.contains(b)){if(f){c.select=false}else{return}}else{c.select=true}}this.get("dataContext").applyChange(c);if(c.select){DG.logUser("caseSelected: %@",d)}else{DG.logUser("caseDeselected: %@",d)}},stopAnimation:function(){var a=this.get("plotAnimator"),b=this.get("caseValueAnimator");if(!SC.none(a)){a.endAnimation()}if(!SC.none(b)){b.endAnimation()}},hiddenCasesDidChange:function(){if(!this._isBeingRestored){this.invalidateCaches();this.rescaleAxesFromData(false,true)}},createStorage:function(){var a={};if(DG.ObjectMap.length(this._adornmentModels)>0){a.adornments={};DG.ObjectMap.forEach(this._adornmentModels,function(b,d){var c=d.createStorage&&d.createStorage();if(DG.ObjectMap.length(c)){a.adornments[b]=c}})}return a},moveAdornmentStorage:function(c,b,a){if(a){if(!c.adornments){c.adornments={}}c.adornments[b]=a}},restoreStorage:function(a){DG.ObjectMap.forEach(a.adornments,function(d,c){var b=DG.PlotAdornmentModel.registry[d],e=b&&b.create({plotModel:this});if(e){e.restoreStorage(c);this.setAdornmentModel(d,e);this.set(d,e)}}.bind(this))},copyAdornmentModels:function(a){DG.assert((typeof a==="object")&&(a instanceof DG.PlotModel));var b={};if(this.get("isPlottedCountVisible")){DG.log("transferring Show Count to new plot of type %@",a.constructor);b.plottedCount=DG.PlottedCountModel.create({plotModel:a})}return b},getCellCaseCounts:function(){DG.assert(false,"derived classes must override getCellCaseCounts()");return[]}});DG.PlotModel.configureRoles=function(a){};sc_require("components/graph/plots/plot_model");DG.CasePlotModel=DG.PlotModel.extend({worldValues:null,getWorldCoords:function(b){if(SC.none(this.worldValues)){this.worldValues=[]}var a=this.worldValues;if((b>=a.length)||SC.none(a[b])){a[b]={x:Math.random(),y:Math.random()}}return a[b]},setWorldCoords:function(a,b){if(SC.none(this.worldValues)){this.worldValues=[]}this.worldValues[a]=b},mixUp:function(){this.set("worldValues",[])},getGearMenuItems:function(){var a=this;return[{title:"DG.PlotModel.mixup",target:a,itemAction:a.mixUp,localize:true}].concat(arguments.callee.base.apply(this,arguments))},getCellCaseCounts:function(){var a=[];var c=this.get("cases");var b=c.length;a.push({count:b,primaryCell:0,secondaryCell:0});return a}});DG.PlotUtilities={kAxisColor:"#ccc",kRuleColor:"#ddd",kRuleWidth:1,kZeroLineColor:"#555",kZeroLineWidth:1,kDefaultMovableLineColor:"steelblue",kLineHighlightColor:"rgba(255, 0, 0, 0.3)",kPlotCellFill:"rgba(128, 128, 128, 0)",kPlotCellStroke:"#eee",kStrokeDarkerFactor:3,kPointRadiusLogBase:2,kPointRadiusMax:10,kPointRadiusMin:5,kDefaultPointOpacity:0.85,kDefaultStripWidth:4,kMarqueeColor:"rgba(128, 128, 128, 0.3)",kDotClassName:"data-dot",kSelectedDotClassName:"data-dot-selected",kColoredDotClassName:"data-dot-colored",kSelectedColoredDotClassName:"data-dot-colored-selected",kDotClassPattern:/data-dot[a-z\-]*/g,kToolTipClassName:"data-tip",kToolTipShadowClassName:"data-tip-shadow",kToolTipTextClassName:"data-tip-text",kStripClassName:"data-strip",kSelectedStripClassName:"data-strip-selected",kColoredStripClassName:"data-strip-colored",kSelectedColoredStripClassName:"data-strip-colored-selected",kLegendKey:"legend-key",kLegendKeyName:"legend-key-name",kDefaultAnimationTime:1000,kDataTipShowTime:500,kHighlightShowTime:100,kHighlightHideTime:250,kDataHoverTransform:"s1.5",kDataCreateTransform:"s2",lineToAxisIntercepts:function(i,b,e,c){function j(){return{left:e.get("lowerBound"),top:c.get("upperBound"),right:e.get("upperBound"),bottom:c.get("lowerBound")}}var h,d,g,a,k=j();if(Math.abs(i)>1){d=k.bottom;h=(d-b)/i;if(h<k.left){h=k.left;d=i*h+b}else{if(h>k.right){h=k.right;d=i*h+b}}a=k.top;g=(a-b)/i;if(g>k.right){g=k.right;a=i*g+b}else{if(g<k.left){g=k.left;a=i*g+b}}}else{h=k.left;d=i*h+b;if(d<k.bottom){d=k.bottom;h=(d-b)/i}else{if(d>k.top){d=k.top;h=(d-b)/i}}g=k.right;a=i*g+b;if(a>k.top){a=k.top;g=(a-b)/i}else{if(a<k.bottom){a=k.bottom;g=(a-b)/i}}}if(h>g){var f=h;h=g;g=f;f=d;d=a;a=f}return{pt1:{x:h,y:d},pt2:{x:g,y:a}}},closestScreenPtGivenScreenPtAndWorldLine:function(g,a,h,f){var e=h.coordinateToData(g.x),d=f.coordinateToData(g.y),c=(a.slope===0)?e:(d-a.intercept+(e/a.slope))/(a.slope+(1/a.slope)),b=a.slope*c+a.intercept;return{x:h.dataToCoordinate(c),y:f.dataToCoordinate(b)}},lineIntersectsPlotArea:function(b,f,g,d){DG.assert(isFinite(b));var h=g.get("lowerBound"),a=g.get("upperBound"),c=d.get("lowerBound"),e=d.get("upperBound");return DG.MathUtilities.isInRange(b*h+f,c,e)||DG.MathUtilities.isInRange(b*a+f,c,e)||DG.MathUtilities.isInRange((c-f)/b,h,a)||DG.MathUtilities.isInRange((e-f)/b,h,a)},isPointInPlotArea:function(b,c,a){return DG.MathUtilities.isInRange(b.x,c.get("lowerBound"),c.get("upperBound"))&&DG.MathUtilities.isInRange(b.y,a.get("lowerBound"),a.get("upperBound"))},findFractionDigitsForAxis:function(d){var b=(d.get("pixelMin")+d.get("pixelMax"))/2,c=d.coordinateToData(b)-d.coordinateToData(b+1),a=Math.floor(Math.log(Math.abs(c))/Math.LN10);return Math.max(-a,0)},findFractionDigitsForRange:function(a){return(a.max-a.min===0)?2:Math.max(-Math.floor(Math.log((a.max-a.min)/1000)/Math.LN10),0)},findNeededFractionDigits:function(m,b,a,j){var g=12,n=a.get("model"),h=j.get("model"),p,d,c,l,f,i=2,o=3;function k(q){q.pt1.x=a.dataToCoordinate(q.pt1.x);q.pt1.y=j.dataToCoordinate(q.pt1.y);q.pt2.x=a.dataToCoordinate(q.pt2.x);q.pt2.y=j.dataToCoordinate(q.pt2.y);return q}function e(){var q;q=Math.max(Math.abs(d.pt1.x-p.pt1.x),Math.abs(d.pt1.y-p.pt1.y));q=Math.max(q,Math.abs(d.pt2.x-p.pt2.x));q=Math.max(q,Math.abs(d.pt2.y-p.pt2.y));return q}DG.assert(isFinite(m));if(isNaN(m)||isNaN(b)){return{slopeDigits:0,interceptDigits:0}}p=k(DG.PlotUtilities.lineToAxisIntercepts(m,b,n,h));do{l=DG.MathUtilities.roundToSignificantDigits(b,i);d=k(DG.PlotUtilities.lineToAxisIntercepts(m,l.roundedValue,n,h));c=e();if(c>1){i+=1}}while((c>1)&&(i<g));do{f=DG.MathUtilities.roundToSignificantDigits(m,o);d=k(DG.PlotUtilities.lineToAxisIntercepts(f.roundedValue,b,n,h));c=e();if(c>1){o+=1}}while((c>1)&&(o<g));if(Math.abs(m)>1){o=Math.max(0,o-Math.floor(Math.log(Math.abs(m))/Math.LN10)-1)}if(Math.abs(b)>1){i=Math.max(0,i-Math.floor(Math.log(Math.abs(b))/Math.LN10)-1)}return{slopeDigits:o,interceptDigits:i}},doCreateCircleAnimation:function(a){a.attr({"fill-opacity":0,"stroke-opacity":0});a.animate({"fill-opacity":this.kDefaultPointOpacity,"stroke-opacity":1},this.kDefaultAnimationTime,"<>")},doHideRemoveAnimation:function(a,b){a.animate({"fill-opacity":0,"stroke-opacity":0},this.kDefaultAnimationTime,"<>",function(){if(b){b.removeElement(this)}else{this.remove()}})}};sc_require("alpha/destroyable");sc_require("components/graph/utilities/plot_utilities");DG.PlotLayer=SC.Object.extend(DG.Destroyable,{autoDestroyProperties:["_dataTip"],paperSource:null,paper:function(){return this.getPath("paperSource.paper")}.property("paperSource.paper"),layerManager:function(){return this.getPath("paperSource.layerManager")}.property("paperSource.layerManager"),frame:function(){return this.getPath("paperSource.frame")}.property("paperSource.frame"),elementsToClear:function(){return this.getPath("paperSource._elementsToClear")}.property("paperSource._elementsToClear"),_dataTip:null,dataTip:function(){if(!this._dataTip){this._dataTip=DG.PointDataTip.create({plotLayer:this,layerName:DG.LayerNames.kDataTip})}return this._dataTip}.property(),displayDidChange:function(){this.notifyPropertyChange("plotDisplayDidChange")},model:null,dataContext:function(){return this.getPath("model.dataContext")}.property("model.dataContext"),selection:null,selectionBinding:"*model.casesController.selection",cleanupFunc:null,cleanupDelay:300,cleanupInterval:300,waitingForCleanup:false,timeOfLastCleanupCall:null,cleanupTimer:null,installCleanup:function(){if(!this.cleanupFunc){return}var a=function(){var b=Date.now();if(b-this.timeOfLastCleanupCall>this.cleanupDelay){this.cleanupFunc();this.waitingForCleanup=false;this.cleanupTimer=null}else{this.cleanupTimer=SC.Timer.schedule({target:this,action:a,interval:this.cleanupInterval})}};this.timeOfLastCleanupCall=Date.now();if(!this.waitingForCleanup){this.waitingForCleanup=true;this.cleanupTimer=SC.Timer.schedule({target:this,action:a,interval:this.cleanupInterval})}},changeKey:"dataDidChange",_pointRadius:DG.PlotUtilities.kPointRadiusMax,_isRenderingValid:false,blankDropHint:"DG.GraphView.dropInPlot",plottedAttribute:function(){return this.getPath("model.dataConfiguration.legendAttributeDescription.attribute")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this._plottedElements=[]},modelDidChange:function(b,a){this.dataConfigurationDidChange(b,a);this.addObserver("model.dataConfiguration.cases",this,"dataDidChange");this.addObserver("model.dataConfiguration.hiddenCases",this,"dataDidChange");this.addObserver("model.dataConfiguration.dataContext.selectionChangeCount",this,"selectionChangeCount");this._isRenderingValid=false}.observes("model"),dataConfigurationDidChange:function(b,a){this._pointRadius=this.calcPointRadius();this._isRenderingValid=false},destroy:function(){this.removePlottedElements();this.removeObserver("model.dataConfiguration.cases",this,"dataDidChange");this.removeObserver("model.dataConfiguration.hiddenCases",this,"dataDidChange");this.removeObserver("model.dataConfiguration.dataContext.selectionChangeCount",this,"selectionChangeCount");if(this.cleanupTimer){this.cleanupTimer.invalidate()}this.model=null;arguments.callee.base.apply(this,arguments)},handleDataContextNotification:function(f,c){var e=this.get("model"),g=e&&e.get("lastChange"),b=g&&g.operation;if(!e||!e.isAffectedByChange(g)){return}switch(b){case"createCase":case"createCases":case"deleteCases":var a=this.get("changeKey");if(!SC.empty(a)){var d=this[a];if(d){d.call(this,c)}}break;case"updateCases":case"createAttributes":case"updateAttributes":this.dataRangeDidChange(this,"revision",this,g.indices);break;case"selectCases":this.selectionDidChange();break}}.observes(".model.lastChange"),plotConfigurationDidChange:function(){this._isRenderingValid=false;this.displayDidChange()}.observes(".model.plotConfiguration"),paperSizeDidChange:function(){this._isRenderingValid=false;this.displayDidChange()}.observes("paperSize"),selectionChangeCount:function(){this._elementOrderIsValid=false},prepareToResetCoordinates:function(){},refreshCoordinates:function(){if(this.get("paper")){this.drawData()}},callCreateCircle:function(c,d,b){var a=this.createCircle(c,d,b);if(a){this._plottedElements.push(a);this.getPath("layerManager."+DG.LayerNames.kPoints).push(a)}return a},dataDidChange:function(){if(!this.readyToDraw()){return}var h=this,g=this.getPath("model.cases"),e=this.createRenderContext(),c=g&&g.length,a=this._plottedElements.length,d=(this._pointRadius!==this.calcPointRadius()),f=this.get("layerManager"),b;this._elementOrderIsValid=false;if(d){this._pointRadius=this.calcPointRadius();this._isRenderingValid=false;this.displayDidChange()}this.updateAdornments();if(c>a){if(d){this.prepareToResetCoordinates();for(b=0;b<a;b++){this.setCircleCoordinate(e,g[b],b)}}for(b=a;b<c;b++){this.callCreateCircle(g[b],b,this.animationIsAllowable());this.setCircleCoordinate(e,g[b],b)}this._isRenderingValid=false}if(c<a){for(b=c;b<a;b++){if(!SC.none(this._plottedElements[b])){this._plottedElements[b].stop();f.removeElement(this._plottedElements[b]);DG.PlotUtilities.doHideRemoveAnimation(this._plottedElements[b])}}this._plottedElements.length=c;this.prepareToResetCoordinates();g.forEach(function(i,j){h.setCircleCoordinate(e,g[j],j)});this._isRenderingValid=false;this.displayDidChange()}this.installCleanup()},dataRangeDidChange:function(b,d,a,c){this.updateAdornments();this.get("dataTip").handleChanges(c)},updateAdornments:function(){},animationIsAllowable:function(){var b=Date.now(),a=b-this._timeLastCreate;if(a<DG.PlotUtilities.kDefaultAnimationTime){this._createAnimationOn=false}else{if(b-this._timeLastCreate>this._kAllowableInterval){this._createAnimationOn=true}}this._timeLastCreate=b;return this._createAnimationOn},readyToDraw:function(){return !SC.none(this.get("paper"))},_timeLastCreate:null,_createAnimationOn:true,_kAllowableInterval:1000,animationStateDidChange:function(){if(this.getPath("model.isAnimating")){this.enterAnimationState()}else{this.leaveAnimationState()}}.observes(".model.isAnimating"),enterAnimationState:function(){},leaveAnimationState:function(){},_plottedElements:null,_mustCreatePlottedElements:true,_elementOrderIsValid:false,shouldDraw:function(){return !this._isRenderingValid},drawData:function drawData(){if(!this.get("paper")){return}var f=this,e=this.getPath("model.cases"),c=this.createRenderContext(),d=this.get("layerManager"),a=this._plottedElements.length,b;if(SC.none(e)){return}if(this._mustCreatePlottedElements){this._plottedElements.forEach(function(g){d.removeElement(g)});a=this._plottedElements.length=0;this._mustCreatePlottedElements=false;c.casesAdded=true}if(c.casesRemoved){for(b=e.length;b<a;b++){DG.PlotUtilities.doHideRemoveAnimation(this._plottedElements[b],d)}if(e.length<a){a=this._plottedElements.length=e.length}}if(c.casesAdded){this._pointRadius=this.calcPointRadius()}if(a<e.length){f._elementOrderIsValid=false}if(c.updatedPositions||c.updatedColors||c.casesAdded){this.prepareToResetCoordinates();e.forEach(function(g,h){if(h>=a){f.callCreateCircle(e[h],h,true)}f.setCircleCoordinate(c,e[h],h)})}DG.assert(this._plottedElements.length===e.length)},didDraw:function(){arguments.callee.base.apply(this,arguments);this._isRenderingValid=true},selectionDidChange:function(){this.updateSelection();this._isRenderingValid=false}.observes("selection"),getPlottedElementClass:function(b,a){return(a?(b?DG.PlotUtilities.kSelectedColoredDotClassName:DG.PlotUtilities.kColoredDotClassName):(b?DG.PlotUtilities.kSelectedDotClassName:DG.PlotUtilities.kDotClassName))},updateSelection:function(){if(!this.get("model")){return}if(this._elementOrderIsValid){return}var f=this,b=this._plottedElements,a=this.getPath("model.dataConfiguration.collectionClient.casesController.selection"),e=(this.getPath("model.dataConfiguration.legendAttributeDescription.attribute")!==DG.Analysis.kNullAttribute)||(this.get("numPlots")>1),d=this.get("layerManager"),c=this.getPath("model.cases");if(!c){return}this.getPath("model.cases").forEach(function(i,j){var g,h,l,k;if((j<b.length)&&b[j]){h=b[j];g=a.containsObject(i);l=g?DG.LayerNames.kPoints:DG.LayerNames.kSelectedPoints;k=g?DG.LayerNames.kSelectedPoints:DG.LayerNames.kPoints;h.removeClass(DG.PlotUtilities.kDotClassPattern);h.addClass(f.getPlottedElementClass(g,e));d.moveElementFromTo(h,l,k)}});this._elementOrderIsValid=true},getCasesForPointsInRect:function(b){var c=this.getPath("model.cases"),a=[];this._plottedElements.forEach(function(e,d){if(DG.ViewUtilities.ptInRect({x:e.attrs.cx,y:e.attrs.cy},b)){a.push(c[d])}});return a},removePlottedElements:function(a){var b=this.get("layerManager");this._plottedElements.forEach(function(c){c.stop();if(a){DG.PlotUtilities.doHideRemoveAnimation(c,b)}else{b.removeElement(c)}});this._plottedElements.length=0},drawWidth:function(){return this.get("frame").width-2*DG.ViewUtilities.kBorderWidth}.property("frame"),drawHeight:function(){return this.get("frame").height-2*DG.ViewUtilities.kBorderWidth}.property("frame"),dragData:null,performDragOperation:function(a,b){this.set("dragData",a.data);return SC.DRAG_LINK},showDataTip:function(b,a){this.get("dataTip").show(b.attr("cx"),b.attr("cy"),a)},hideDataTip:function(){var a=this.get("dataTip");if(a){a.hide()}},calcPointRadius:function(){var f=this.getPath("model.dataConfiguration"),b=f?f.getCaseCount():0,e=DG.PlotUtilities.kPointRadiusMax,c=DG.PlotUtilities.kPointRadiusMin,d=DG.PlotUtilities.kPointRadiusLogBase;for(var a=d;a<=b;a=a*d){--e;if(e<=c){break}}DG.assert(e>0&&Math.round(e)===e);return e},createRenderContext:function(){return{}},showHidePlottedElement:function(a,c){var b=a.isHidden();if(c){if(!b){a.stop();a.hide();a.attr({cx:0,cy:0,r:1,fill:DG.ColorUtilities.kMissingValueCaseColor.colorString})}}else{if(b){a.show();a.animate({"fill-opacity":DG.PlotUtilities.kDefaultPointOpacity,"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}}return !c},updatePlottedElement:function(i,c,a,k,h,m,e){var g={cx:c,cy:a,r:k},j=DG.color(h),d;if(j.rgb){d=j.darker(DG.PlotUtilities.kStrokeDarkerFactor).color}else{d=DG.color("#"+h).darker(DG.PlotUtilities.kStrokeDarkerFactor).color}if(i.posAnimation){i.stop(i.posAnimation);i.posAnimation=null}function b(){this.posAnimation=null;if(e){e()}}if(m){i.attr({fill:h,stroke:d});if(i.hoverAnimation){i.stop(i.hoverAnimation);i.hoverAnimation=null;i.transform("")}i.posAnimation=Raphael.animation(g,DG.PlotUtilities.kDefaultAnimationTime,"<>",b);i.animate(i.posAnimation)}else{var l=i.transform(),f=SC.empty(l)||(l.toString()==="s1");if(!f){i.transform("")}g.fill=h;g.stroke=d;i.attr(g);if(!f){i.transform(l)}}},vanishPlottedElement:function(c,a){function d(){this.hide()}var b=this.get("paper").circle(-100,-100,this._pointRadius).toBack().addClass(DG.PlotUtilities.kColoredDotClassName).attr(c).animate(a,DG.PlotUtilities.kDefaultAnimationTime,"<>",d);this.get("elementsToClear").push(b)},updatePointSize:function(){this._pointRadius=this.calcPointRadius();var a={r:this._pointRadius};this._plottedElements.forEach(function(b){b.animate(a,DG.PlotUtilities.kDefaultAnimationTime,"<>")})},didCreateLayer:function(){}});sc_require("components/graph_map_common/plot_layer");DG.PlotView=DG.PlotLayer.extend({autoDestroyProperties:["plottedCountAdorn"],plotIndex:0,numPlots:1,xAxisView:null,yAxisView:null,cachedPointCoordinates:null,transferredPointCoordinates:null,allowTransferAnimation:true,_areAdornmentsInitialized:false,plottedCountAdorn:null,init:function(){arguments.callee.base.apply(this,arguments)},destroy:function(){arguments.callee.base.apply(this,arguments)},axisBoundsDidChange:function(){this._isRenderingValid=false;this.displayDidChange()}.observes(".model.axisBounds"),updateAdornments:function(){if(this.plottedCountAdorn){this.plottedCountAdorn.get("model").setComputingNeeded();this.plottedCountAdorn.updateToModel()}},rescaleOnParentCaseCompletion:function(f){var a=f&&f.length,b=a&&f[a-1],c=b&&b.get("id"),e=this.getPath("model.openParentCaseID");if(!SC.none(c)&&(c===e)){var d=this.get("model");if(d&&d.rescaleAxesFromData){d.rescaleAxesFromData(false,false)}this.setPath("model.openParentCaseID",null)}},initializeAdornments:function(){if(this.plottedCountAdorn&&this.plottedCountAdorn.wantVisible()){this.plottedCountAdorn.updateToModel()}var a=this.get("model"),b=a&&a._adornmentModels;DG.ObjectMap.forEach(b,function(c,d){a.notifyPropertyChange(c)});this._areAdornmentsInitialized=true},_plottedElements:null,_mustCreatePlottedElements:true,_elementOrderIsValid:false,shouldDraw:function(){return !this._isRenderingValid},doDraw:function doDraw(b,a){this.set("plotIndex",b);this.set("numPlots",a);if(!this._areAdornmentsInitialized){this.initializeAdornments()}},getPointPositionsInParentFrame:function(){var a=this.get("frame");return this._plottedElements.map(function(c){var b=(c.isHidden()?0:c.attr("r"));return{cx:c.attr("cx")+a.x,cy:c.attr("cy")+a.y,r:b,fill:c.attr("fill")}})},animateFromTransferredPoints:function(){var g=this,d=this._plottedElements,e=this.getPath("model.cases"),m=this.createRenderContext(),i=this.get("frame"),a=this.get("transferredPointCoordinates"),h=[],l=[],n=[];function c(p){return a[p]}function o(p){return a[l[p]]}this._getTransferredPointsToCasesMap(l,n);var b=l.length>0,f=n.length>0,k=(b?o:c),j=false;this._elementOrderIsValid=false;DG.sounds.playMixup();this.setPath("model.isAnimating",true);this.prepareToResetCoordinates();this.removePlottedElements();a.forEach(function(p,q){p.cx-=i.x;p.cy-=i.y});e.forEach(function(q,r){var t=k(r),p=false,s;g.callCreateCircle(q,r,false);if(!SC.none(t)){d[r].attr(t);p=true;if(!j){s=function(){g.setPath("model.isAnimating",false);g.drawData()}}}t=g.setCircleCoordinate(m,q,r,p,s);if(t&&s){j=true}if(f){h.push(t)}});if(!j){this.setPath("model.isAnimating",false)}if(f){a.forEach(function(r,s){var q=n[s],p=h[q];if(SC.none(q)||SC.none(p)||(r.r===0)){return}g.vanishPlottedElement(r,p)})}this._mustCreatePlottedElements=false;this.set("transferredPointCoordinates",null)},_getTransferredPointsToCasesMap:function(m,c){var p=this.get("transferredPointCoordinates"),f=this.getPath("model.cases"),j=this.getPath("model.collectionClient"),h=this.getPath("model.dataContext.childCollection"),d=this.getPath("model.dataContext.parentCollection"),l=d?d.getCaseCount():0,e=h?h.getCaseCount():0,o=f.length,b=p.length;function g(){return(d&&(l===b)&&(j&&j.isDescendantOf(d)))}function k(){return(h&&(e===b)&&(j&&j.isAncestorOf(h)))}function i(r){var q=d.getCaseAt(r),s=q&&q.get("children");return(s?s.length():0)}function n(s,q){var u,r,t;for(u=0;u<b;++u){t=i(u);for(r=0;r<t;++r){s.push(u)}}if(!DG.assert(s.length===o,"Parent/Child case mismatch")){s.length=0}DG.assert(q.length===0,"another parent/child case mismatch")}function a(u,s){var w,t,v,r,q;w=0;for(t=0;t<o;++t){v=i(t);u.push((v>0)?w:undefined);for(r=0;r<v;++r){q=((r===0)?undefined:u.length-1);s.push(q);++w}}}if(g()){n(m,c)}else{if(k()){a(m,c)}}},prepareForConfigurationChange:function(){this.set("cachedPointCoordinates",this.getPointPositionsInParentFrame())},handleConfigurationChange:function(){if(this.get("allowTransferAnimation")){this.set("transferredPointCoordinates",this.get("cachedPointCoordinates"))}},handleBackgroundClick:function(a){},handleBackgroundDblClick:function(a){},createRenderContext:function(){var c=this.get("model"),b=c.getPath("dataConfiguration.legendAttributeDescription"),a=this.get("plotIndex");return{casesAdded:true,casesRemoved:true,updatedColors:true,updatedPositions:true,xAxisView:this.get("xAxisView"),yAxisView:this.get("yAxisView"),xVarID:c.get("xVarID"),yVarID:c.get("yVarID"),legendDesc:b,legendVarID:b&&b.get("attributeID"),attrColor:SC.none(a)||(a===0)?null:DG.ColorUtilities.calcAttributeColorFromIndex(this.get("plotIndex"),this.get("numPlots")),calcCaseColorString:function(f){DG.assert(f);var d=f.getValue(this.legendVarID),e=DG.ColorUtilities.calcCaseColor(d,this.legendDesc,this.attrColor);return e.colorString}}},plottedCountChanged:function(){var a=this.getPath("model.plottedCount");if(this.plottedCountAdorn){this.plottedCountAdorn.destroy();this.plottedCountAdorn=null}if(a&&this.get("paper")){this.plottedCountAdorn=DG.PlottedCountAdornment.create({parentView:this,valueAxisView:this.get("primaryAxisView"),model:a,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments});this.plottedCountAdorn.updateToModel()}}.observes(".model.plottedCount"),didCreateLayer:function(){this.plottedCountChanged()}});sc_require("components/graph/plots/plot_view");DG.CasePlotView=DG.PlotView.extend({dataRangeDidChange:function(a,g,d,e){var c=this,i=this._plottedElements.length,b=this.getPath("model.cases"),h=this.createRenderContext();var f=(SC.typeOf(e)===SC.T_NUMBER?[e]:e);f.forEach(function(j){if(j>=i){c.callCreateCircle(b[j],j,c._createAnimationOn)}c.setCircleCoordinate(h,b[j],j)});arguments.callee.base.apply(this,arguments)},setCircleCoordinate:function setCircleCoordinate(d,b,f,j,c){DG.assert(d&&d.xAxisView);DG.assert(b);DG.assert(DG.MathUtilities.isInIntegerRange(f,0,this._plottedElements.length));function l(n,q,o){var m=n.get("pixelMin"),p=n.get("pixelMax");if(m<p){return m+o+q*(p-m-2*o)}else{return m-o+q*(p-m+2*o)}}var a=this._plottedElements[f],g=this._pointRadius,e=this.get("model").getWorldCoords(f),i=l(d.xAxisView,e.x,g),h=l(d.yAxisView,e.y,g),k=SC.none(i)||SC.none(h);if(this.showHidePlottedElement(a,k)){this.updatePlottedElement(a,i,h,g,d.calcCaseColorString(b),j,c);return{cx:i,cy:h,r:g}}return null},createCircle:function(f,d,i){var c=this;function h(j,k){c.get("model").setWorldCoords(j,k)}var b=false,e=1,g=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(j){if(!b&&SC.none(g)){g=this.transform();this.animate({opacity:e,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime)}},function(j){if(!b){this.stop();this.animate({transform:g},DG.PlotUtilities.kHighlightHideTime);g=null}}).mousedown(function(j){c.get("model").selectCaseByIndex(d,j.shiftKey)}).drag(function(m,k){var o=c.get("xAxisView").coordinateToData(this.ox+m),n=c.get("yAxisView").coordinateToData(this.oy+k),l={x:o,y:n},p=c.createRenderContext(),j=this.transform();if(isFinite(l.x)&&isFinite(l.y)){this.transform(g);h(this.index,l);this.transform(j)}c.setCircleCoordinate(p,c.getPath("model.cases")[this.index],this.index)},function(j,k){b=true;this.ox=this.attr("cx");this.oy=this.attr("cy");this.animate({opacity:e},DG.PlotUtilities.kDataTipShowTime,"bounce");this.toFront()},function(){this.animate({transform:g},DG.PlotUtilities.kHighlightHideTime);b=false});a.index=d;a.node.setAttribute("shape-rendering","geometric-precision");if(i){DG.PlotUtilities.doCreateCircleAnimation(a)}return a},drawData:function(){if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}var d=this,c=this.getPath("model.cases"),b=this.createRenderContext(),a;if(this._mustCreatePlottedElements){this._plottedElements.forEach(function(e){e.remove()});this._plottedElements.length=0;this._pointRadius=this.calcPointRadius();c.forEach(this.callCreateCircle,this);this._mustCreatePlottedElements=false}c.forEach(function(e,f){d.setCircleCoordinate(b,e,f)});for(a=c.length;a<this._plottedElements.length;a++){this._plottedElements[a].remove()}this._plottedElements.length=c.length},doDraw:function doDraw(){arguments.callee.base.apply(this,arguments);this.drawData();this.updateSelection()},worldValuesChanged:function(){this.prepareForConfigurationChange();this.set("transferredPointCoordinates",this.get("cachedPointCoordinates"));this._isRenderingValid=false;this.displayDidChange()}.observes(".model.worldValues")});sc_require("components/graph/plots/plot_model");DG.DotChartModel=DG.PlotModel.extend({primaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.ePrimaryCategorical)}.property("xVarID","yVarID"),secondaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.eSecondaryCategorical)}.property("xVarID","yVarID"),primaryAxisModel:function(){return this.getAxisForPlace(this.get("primaryAxisPlace"))}.property("primaryAxisPlace","xAxis","yAxis"),secondaryAxisModel:function(){return this.getAxisForPlace(this.get("secondaryAxisPlace"))}.property("secondaryAxisPlace","xAxis","yAxis"),orientation:function(){return(this.get("primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?"vertical":"horizontal"}.property(),cachedCells:null,cachedIndex:null,maxInCell:function(){if(!this._cacheIsValid){this._buildCache()}return this._maxInCell}.property(),handleDataContextNotification:function(c,e){if(!this.isAffectedByChange(e)){return}var a=function(k,m,i,n){var j;if(SC.none(i)||SC.none(n)){return}var h=this.get("cachedCells"),g=this.get("cachedIndex"),l=this.get("_maxInCell");if(SC.none(h[i])){h[i]=[]}if(SC.none(h[i][n])){h[i][n]=[]}h[i][n].push({theCase:k,caseIndex:m});j=h[i][n].length;g[m]={primaryCell:i,secondaryCell:n,indexInCell:j-1};this.beginPropertyChanges();this.set("cachedCells",h);this.set("cachedIndex",g);this.set("_maxInCell",Math.max(l,j));this.endPropertyChanges()}.bind(this);if((e.operation==="createCase")||(e.operation==="createCases")){var b=e.result.caseIDs||[e.result.caseID],d=this.getPath("dataConfiguration.cases.length")-1,f=this.get("computationContext");b.forEach(function(h){var g=DG.store.find(DG.Case,h);this.doForOneCase(g,d++,f,a)}.bind(this))}else{this.invalidateCaches()}arguments.callee.base.apply(this,arguments)},lookupCellForCaseIndex:function(a){if(!this._cacheIsValid){this._buildCache()}return this.get("cachedIndex")[a]},_cachedComputationContext:null,computationContext:function(){if(!this._cachedComputationContext){this._cachedComputationContext={primaryAxis:this.get("primaryAxisModel"),secondaryAxis:this.get("secondaryAxisModel"),primaryVarID:this.get("primaryVarID"),secondaryVarID:this.get("secondaryVarID"),legendVarID:this.get("legendVarID")}}return this._cachedComputationContext}.property("primaryAxisModel","secondaryAxisModel","primaryVarID","secondaryVarID","legendVarID"),doForOneCase:function(a,e,g,j){var i=a.getValue(g.primaryVarID),b=SC.none(g.primaryVarID)||!SC.none(i),c=a.getValue(g.secondaryVarID),f=SC.none(g.secondaryVarID)||!SC.none(c),l=a.getValue(g.legendVarID),h=SC.none(g.legendVarID)||!SC.none(l),k,d;if(b&&f&&h){k=g.primaryAxis.cellNameToCellNumber(i);d=g.secondaryAxis.cellNameToCellNumber(c);j(a,e,k,d)}},forEachBivariateCaseDo:function(a){var b=this.get("cases"),c=this.get("computationContext");if(!c.primaryAxis||!b){return}b.forEach(function(d,e){this.doForOneCase(d,e,c,a)}.bind(this))},invalidateCaches:function(){arguments.callee.base.apply(this,arguments);this.set("_cacheIsValid",false);this._cachedComputationContext=null},getCellCaseCounts:function(){var g=this.get("primaryAxisModel"),f=this.get("secondaryAxisModel"),b=[];if(!(g&&f)){return b}var e=g.get("numberOfCells")||1,d=f.get("numberOfCells")||1;var h=e*d;var c,a;for(c=0;c<h;++c){b.push({count:0,primaryCell:Math.floor(c/d),secondaryCell:c%d})}this.forEachBivariateCaseDo(function(j,k,i,l){a=i*d+l;if(DG.MathUtilities.isInIntegerRange(a,0,h)){var m=b[a];m.count+=1;DG.assert(m.primaryCell===(i||0),"primary cell index error in DG.DotChartModel.getCellCaseCounts()");DG.assert(m.secondaryCell===(l||0),"secondary cell index error in DG.DotChartModel.getCellCaseCounts()")}});return b},_buildCache:function(){var b=[],a=[],c=0;this.forEachBivariateCaseDo(function(f,g,d,h){var e;if(SC.none(d)||SC.none(h)){return}if(SC.none(b[d])){b[d]=[]}if(SC.none(b[d][h])){b[d][h]=[]}b[d][h].push({theCase:f,caseIndex:g});e=b[d][h].length;a[g]={primaryCell:d,secondaryCell:h,indexInCell:e-1};c=Math.max(c,e)});this._cacheIsValid=true;this.beginPropertyChanges();this.set("cachedCells",b);this.set("cachedIndex",a);this.set("_maxInCell",c);this.endPropertyChanges()},_cacheIsValid:false,_maxInCell:0});DG.DotChartModel.configureRoles=function(b){var c=b.get("xType"),d=(c===DG.Analysis.EAttributeType.eCategorical)?"x":"y",a=(d==="x")?"y":"x";b.setPath(d+"AttributeDescription.role",DG.Analysis.EAnalysisRole.ePrimaryCategorical);b.setPath(a+"AttributeDescription.role",DG.Analysis.EAnalysisRole.eSecondaryCategorical)};sc_require("components/graph/plots/plot_view");DG.DotChartView=DG.PlotView.extend({displayProperties:["numPointsInRow","overlap","xAxisView.model.numberOfCells","yAxisView.model.numberOfCells"],numPointsInRow:1,overlap:0,cleanupFunc:function(){this.computeCellParams();this.displayDidChange()},primaryAxisView:function(){return(this.getPath("model.orientation")==="vertical")?this.get("xAxisView"):this.get("yAxisView")}.property("orientation","yAxisView","xAxisView"),secondaryAxisView:function(){return(this.getPath("model.orientation")==="vertical")?this.get("yAxisView"):this.get("xAxisView")}.property("orientation","yAxisView","xAxisView"),dataDidChange:function(){this.updatePoints();this.installCleanup()},updatePoints:function(){if(!this.get("paper")){return}var c=this,h=this.get("model"),b=this.getPath("model.cases"),g=this.createRenderContext(),e=b&&b.length,j=this._plottedElements.length,d=(this._pointRadius!==this.calcPointRadius()),a=this.get("layerManager"),i,f;if(d){this._pointRadius=this.calcPointRadius()}this.updateAdornments();if(e>j){if(d){for(i=0;i<j;i++){f=h.lookupCellForCaseIndex(i);this.privSetCircleCoords(g,b[i],i,f)}}for(i=j;i<e;i++){this.callCreateCircle(b[i],i,this.animationIsAllowable());f=h.lookupCellForCaseIndex(i);this.privSetCircleCoords(g,b[i],i,f)}}if(e<j){for(i=e;i<j;i++){if(!SC.none(this._plottedElements[i])){this._plottedElements[i].stop();a.removeElement(this._plottedElements[i]);DG.PlotUtilities.doHideRemoveAnimation(this._plottedElements[i])}}this._plottedElements.length=e;b.forEach(function(k,l){f=h.lookupCellForCaseIndex(l);c.privSetCircleCoords(g,k,l,f)})}this._isRenderingValid=false;this.displayDidChange()},dataRangeDidChange:function(c,g,b,e){var h=this,f=this.getPath("model.cases"),d=this.createRenderContext(),a=(SC.typeOf(e)===SC.T_NUMBER?[e]:e);this.model.invalidateCaches();this.computeCellParams();a.forEach(function(i){if(!h._plottedElements[i]){h.callCreateCircle(f[i],i,h._createAnimationOn)}var j=h.get("model").lookupCellForCaseIndex(i);h.privSetCircleCoords(d,f[i],i,j)});arguments.callee.base.apply(this,arguments)},createRenderContext:function(){var a=arguments.callee.base.apply(this,arguments);a.primaryAxisView=this.get("primaryAxisView");a.secondaryAxisView=this.get("secondaryAxisView");a.isVerticalOrientation=this.getPath("model.orientation")==="vertical";return a},setCircleCoordinate:function setCircleCoordinate(f,b,c,a,e){var d=this.get("model").lookupCellForCaseIndex(c);return this.privSetCircleCoords(f,b,c,d,a,e)},privSetCircleCoords:function(l,i,h,f,c,d){DG.assert(l&&l.xAxisView);DG.assert(i);DG.assert(DG.MathUtilities.isInIntegerRange(h,0,this._plottedElements.length));var b=this._plottedElements[h],k=SC.none(f);if(this.showHidePlottedElement(b,k)){var s=l.secondaryAxisView.get("fullCellWidth")/2,m=this.get("numPointsInRow"),j=this.get("overlap"),r=Math.floor(f.indexInCell/m),q=f.indexInCell-r*m,n=this._pointRadius,t=2*n,a=l.primaryAxisView.cellToCoordinate(f.primaryCell)-(m-1)*t/2+q*t,p=l.secondaryAxisView.cellToCoordinate(f.secondaryCell),o=((r+0.5)*(t-j)+1+j/2),g,e;DG.assert(DG.isFinite(a)&&DG.isFinite(p),"tPrimaryCoord & tSecondaryCoord");if(l.isVerticalOrientation){g=a;e=p+s-o}else{g=p-s+o;e=a}DG.assert(isFinite(g)&&isFinite(e));this.updatePlottedElement(b,g,e,n,l.calcCaseColorString(i),c,d);return{cx:g,cy:e,r:n}}return null},createCircle:function(e,f,d){var g=this,c=null,a=1;if(!this.get("paper")){return}var b=this.get("paper").circle(0,0,this._pointRadius).attr({cursor:"pointer",cx:-1000,cy:-1000}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(h){if(SC.none(c)){c="";this.animate({opacity:a,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime);g.showDataTip(this,f)}},function(h){this.stop();this.animate({opacity:DG.PlotUtilities.kDefaultPointOpacity,transform:c},DG.PlotUtilities.kHighlightHideTime);c=null;g.hideDataTip()}).mousedown(function(h){g.get("model").selectCaseByIndex(f,h.shiftKey)});b.index=f;b.node.setAttribute("shape-rendering","geometric-precision");if(d){DG.PlotUtilities.doCreateCircleAnimation(b)}return b},drawData:function drawData(){if(SC.none(this.get("paper"))){return}if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}var d=this,a=this.get("model"),c=a.get("cases"),b=this.createRenderContext();if(!c){return}if(this._mustCreatePlottedElements){this.removePlottedElements();this._pointRadius=this.calcPointRadius();c.forEach(this.callCreateCircle,this);this._mustCreatePlottedElements=false}this.computeCellParams();c.forEach(function(e,f){var g=a.lookupCellForCaseIndex(f);d.privSetCircleCoords(b,e,f,g)});this.updateSelection()},doDraw:function doDraw(){arguments.callee.base.apply(this,arguments);if(!this.getPath("model._cacheIsValid")){this.updatePoints()}this.drawData()},animateFromTransferredPoints:function(){var g=this,m=this.get("model"),d=m.get("cases"),l=this.createRenderContext(),i=this.get("frame"),a=this.get("transferredPointCoordinates"),h=[],k=[],n=[];function e(){m.set("isAnimating",false)}function c(p){return a[p]}function o(p){return a[k[p]]}DG.sounds.playMixup();this._getTransferredPointsToCasesMap(k,n);var b=k.length>0,f=n.length>0,j=(b?o:c);this.prepareToResetCoordinates();this.removePlottedElements();this.computeCellParams();a.forEach(function(p,q){p.cx-=i.x;p.cy-=i.y});d.forEach(function(p,q){var s=j(q),r=m.lookupCellForCaseIndex(q);g.callCreateCircle(p,q,false);if(!SC.none(s)){g._plottedElements[q].attr(s)}s=g.privSetCircleCoords(l,p,q,r,true);if(f){h.push(s)}});if(f){a.forEach(function(r,s){var q=n[s],p=h[q];if(SC.none(q)||SC.none(p)||(r.r===0)){return}g.vanishPlottedElement(r,p)})}this._mustCreatePlottedElements=false;this.set("transferredPointCoordinates",null);m.set("isAnimating",true);SC.Timer.schedule({action:e,interval:DG.PlotUtilities.kDefaultAnimationTime})},computeCellParams:function(){var b=this.getPath("primaryAxisView.cellWidth"),a=this.getPath("secondaryAxisView.fullCellWidth")-5,f=this.getPath("model.maxInCell"),e=2*this._pointRadius,c=Math.max(1,Math.floor(a/e)),h=Math.max(1,Math.floor(b/e)),d=Math.max(1,Math.min(h,Math.ceil(f/c))),i=Math.ceil(f/d),g=Math.max(0,((i+1)*e-a)/i);if(!isFinite(d)){d=0}if(!isFinite(g)){g=0}this.beginPropertyChanges();this.setIfChanged("numPointsInRow",d);this.setIfChanged("overlap",g);this.endPropertyChanges()}});DG.NumericPlotModelMixin={doDilation:function(a,e,b){var f=this,d=[];function c(h,i){if(SC.none(h)){return}var g=h.computeBoundsForDilation(i,b);d.push({axis:h,newBounds:g})}a.forEach(function(h){var g=(h===DG.GraphTypes.EPlace.eX)?e.x:e.y;c(f.getAxisForPlace(h),g)});if(SC.none(this.plotAnimator)){this.plotAnimator=DG.GraphAnimator.create({plot:this})}this.plotAnimator.set("axisInfoArray",d).animate()},doRescaleAxesFromData:function(c,d,a){var g=this,b=[],i=[];function f(l,n){var r=n&&n.getPath("attributeDescription.attribute");if(!n||!n.setDataMinAndMax||(r===DG.Analysis.kNullAttribute)){return}var j=g.get("dataConfiguration"),o=j&&j.getDataMinAndMaxForDimension(l),m=n.get("lowerBound"),q=n.get("upperBound"),p,k;i.push({lower:m,upper:q});n.setDataMinAndMax(o.min,o.max,d||false);p=n.get("lowerBound");k=n.get("upperBound");b.push({axis:n,newBounds:{lower:p,upper:k}})}function e(k,j){if(!SC.none(k)){k.setLowerAndUpperBounds(j.lower,j.upper)}}function h(l,k){var j;for(j=0;j<l.length;j++){if(!SC.none(k[j].lower)&&!SC.none(k[j].upper)&&((l[j].newBounds.lower!==k[j].lower)||(l[j].newBounds.upper!==k[j].upper))){return true}}return false}if(SC.none(a)){a=true}c.forEach(function(j){f(j,g.getAxisForPlace(j))});if(h(b,i)){if(a){DG.sounds.playMixup()}this.set("isAnimating",true);while((c.length>0)&&(i.length>0)){e(g.getAxisForPlace(c.pop()),i.pop())}if(SC.none(this.plotAnimator)){this.plotAnimator=DG.GraphAnimator.create({plot:this})}this.plotAnimator.set("axisInfoArray",b).animate(this,this.onRescaleIsComplete)}},onRescaleIsComplete:function(){}};sc_require("components/graph/plots/plot_model");sc_require("components/graph/plots/numeric_plot_model_mixin");DG.DotPlotModel=DG.PlotModel.extend(DG.NumericPlotModelMixin,{primaryVarID:function(){return(this.get("primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?this.get("xVarID"):this.get("yVarID")}.property("primaryAxisPlace","xVarID","yVarID"),primaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.ePrimaryNumeric)}.property("xVarID","yVarID"),secondaryAxisPlace:function(){var a=this.get("dataConfiguration");return a&&a.getPlaceForRole(DG.Analysis.EAnalysisRole.eSecondaryCategorical)}.property("xVarID","yVarID"),primaryAxisModel:function(){return this.getAxisForPlace(this.get("primaryAxisPlace"))}.property("primaryAxisPlace","xAxis","yAxis"),secondaryAxisModel:function(){return this.getAxisForPlace(this.get("secondaryAxisPlace"))}.property("secondaryAxisPlace","xAxis","yAxis"),orientation:function(){return(this.get("primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?"vertical":"horizontal"}.property("primaryAxisPlace"),toggleMovableValue:function(){var a=this.toggleAdornmentVisibility("movableValue","toggleMovableValue");if(a&&a.get("isVisible")){a.recomputeValue(this.get("primaryAxisModel"))}},toggleAverage:function(b,a){var c=this.toggleAdornmentVisibility(b,a);if(c){if(c.get("isVisible")){c.recomputeValue()}else{c.setComputingNeeded()}}},togglePlottedMean:function(){this.toggleAverage("plottedMean","togglePlottedMean")},togglePlottedMedian:function(){this.toggleAverage("plottedMedian","togglePlottedMedian")},togglePlottedStDev:function(){this.toggleAverage("plottedStDev","togglePlottedStDev")},togglePlottedIQR:function(){this.toggleAverage("plottedIQR","togglePlottedIQR")},togglePlotValue:function(){this.toggleAdornmentVisibility("plottedValue","togglePlotValue")},handleDataConfigurationChange:function(){if(!DG.assert(!this.get("isDestroyed"),"DG.DotPlotModel.handleDataConfiguration() shouldn't be triggered after destroy()!")){return}arguments.callee.base.apply(this,arguments);var a=true,c=true,b=false;this.rescaleAxesFromData(a,c,b);["movableValue","plottedMean","plottedMedian","plottedStDev","plottedIQR","plottedCount"].forEach(function(d){var e=this.getAdornmentModel(d);if(e){if(e.setComputingNeeded){e.setComputingNeeded()}if(d==="movableValue"){e.recomputeValueIfNeeded(this.get("primaryAxisModel"))}else{e.recomputeValueIfNeeded()}}}.bind(this))},rescaleAxesFromData:function(c,b,a){if(b===undefined){b=true}this.doRescaleAxesFromData([this.get("primaryAxisPlace")],c,b);if(a){DG.logUser("rescaleDotPlot")}},dilate:function(b,a){this.doDilation([this.get("primaryAxisPlace")],b,a)},getCellCaseCounts:function(){var h=this.get("cases"),f=this.get("primaryVarID"),b=this.get("primaryAxisModel"),g=this.get("secondaryVarID"),e=this.get("secondaryAxisModel"),a=[];if(!(e&&b)){return a}var c=e.get("numberOfCells");for(var d=0;d<c;++d){a.push({count:0,primaryCell:0,secondaryCell:d})}h.forEach(function(k,l){var m=k.getNumValue(f),j=k.getStrValue(g),i=e.cellNameToCellNumber(j);if(i!==null&&DG.MathUtilities.isInIntegerRange(i,0,a.length)&&isFinite(m)){a[i].count+=1}});return a},getGearMenuItems:function(){var a="DG.DotPlotModel.rescaleToData".loc(),g=(this.isAdornmentVisible("movableValue")?"DG.DotPlotModel.hideMovableValue":"DG.DotPlotModel.showMovableValue").loc(),c=(this.isAdornmentVisible("plottedMean")?"DG.DotPlotModel.hideMean":"DG.DotPlotModel.showMean").loc(),d=(this.isAdornmentVisible("plottedMedian")?"DG.DotPlotModel.hideMedian":"DG.DotPlotModel.showMedian").loc(),i=(this.isAdornmentVisible("plottedStDev")?"DG.DotPlotModel.hideStDev":"DG.DotPlotModel.showStDev").loc(),h=(this.isAdornmentVisible("plottedIQR")?"DG.DotPlotModel.hideIQR":"DG.DotPlotModel.showIQR").loc(),b=(this.isAdornmentVisible("plottedValue")?"DG.DotPlotModel.hidePlottedValue":"DG.DotPlotModel.plotValue").loc(),f=[{title:a,target:this,itemAction:this.rescaleAxesFromData,args:[true,false,true]},{title:g,target:this,itemAction:this.toggleMovableValue},{title:b,target:this,itemAction:this.togglePlotValue}],e=[{isSeparator:YES},{title:c,target:this,itemAction:this.togglePlottedMean},{title:d,target:this,itemAction:this.togglePlottedMedian},{title:i,target:this,itemAction:this.togglePlottedStDev},{title:h,target:this,itemAction:this.togglePlottedIQR},{isSeparator:YES}];return f.concat(arguments.callee.base.apply(this,arguments)).concat(e)}});DG.DotPlotModel.configureRoles=function(b){var c=b.get("xType"),d=(c===DG.Analysis.EAttributeType.eNumeric)?"x":"y",a=(d==="x")?"y":"x";b.setPath(d+"AttributeDescription.role",DG.Analysis.EAnalysisRole.ePrimaryNumeric);b.setPath(a+"AttributeDescription.role",DG.Analysis.EAnalysisRole.eSecondaryCategorical)};sc_require("components/graph/plots/plot_view");DG.DotPlotView=DG.PlotView.extend({displayProperties:["primaryAxisView.model.lowerBound","primaryAxisView.model.upperBound","secondaryAxisView.model.numberOfCells","overlap"],autoDestroyProperties:["movableValueAdorn","plottedValueAdorn","plottedMeanAdorn","plottedMedianAdorn","plottedStDevAdorn","plottedIQRAdorn"],primaryAxisView:function(){switch(this.getPath("model.primaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xAxisView");case DG.GraphTypes.EPlace.eY:return this.get("yAxisView");default:return null}}.property("model.primaryAxisPlace","xAxisView","yAxisView"),secondaryAxisView:function(){switch(this.getPath("model.secondaryAxisPlace")){case DG.GraphTypes.EPlace.eX:return this.get("xAxisView");case DG.GraphTypes.EPlace.eY:return this.get("yAxisView");default:return null}}.property("model.secondaryAxisPlace","xAxisView","yAxisView"),movableValueAdorn:null,plottedMeanAdorn:null,plottedMedianAdorn:null,plottedStDevAdorn:null,plottedIQRAdorn:null,binArrays:null,overlap:0,functionEditView:null,plottedValueAdorn:null,prepareToResetCoordinates:function(){this.zeroBinArray()},dataDidChange:function(){arguments.callee.base.apply(this,arguments);if(SC.none(this.get("paper"))){return}this.updateAverages()},dataRangeDidChange:function(c,g,b,e){var h=this,a=this._plottedElements.length,f=this.getPath("model.cases"),d=this.createRenderContext();this.prepareToResetCoordinates();f.forEach(function(i,j){if(j>=a){h.callCreateCircle(f[j],j,h._createAnimationOn)}h.setCircleCoordinate(d,f[j],j)});this.updateAverages();this.rescaleOnParentCaseCompletion(f);arguments.callee.base.apply(this,arguments)},numberOfCellsDidChange:function(){if(this.plottedMeanAdorn){this.plottedMeanAdorn.get("model").setComputingNeeded()}if(this.plottedMedianAdorn){this.plottedMedianAdorn.get("model").setComputingNeeded()}if(this.plottedStDevAdorn){this.plottedStDevAdorn.get("model").setComputingNeeded()}if(this.plottedIQRAdorn){this.plottedIQRAdorn.get("model").setComputingNeeded()}}.observes("*secondaryAxisView.model.numberOfCells"),updateAverages:function(a){function b(d){if(d){var c=d.get("model");if(c){c.setComputingNeeded();d.updateToModel(a)}}}if(!this.getPath("model.dataConfiguration")){return}b(this.plottedMeanAdorn);b(this.plottedMedianAdorn);b(this.plottedStDevAdorn);b(this.plottedIQRAdorn)},createRenderContext:function(){var b=arguments.callee.base.apply(this,arguments),a=this.get("model");b.categoryAxisView=this.get("secondaryAxisView");b.categoryAxisModel=b.categoryAxisView&&b.categoryAxisView.get("model");b.categoryVarID=a&&a.get("secondaryVarID");b.primaryVarID=a&&a.get("primaryVarID");b.primaryAxisPlace=a&&a.get("primaryAxisPlace");b.primaryAxisView=this.get("primaryAxisView");return b},setCircleCoordinate:function setCircleCoordinate(q,m,l,f,h){DG.assert(q&&q.categoryAxisView);DG.assert(m);DG.assert(DG.MathUtilities.isInIntegerRange(l,0,this._plottedElements.length));var e=this._plottedElements[l],b=m.getNumValue(q.primaryVarID),g=q.primaryAxisView.dataToCoordinate(b),o=(!DG.isFinite(g)||q.primaryAxisPlace===DG.GraphTypes.EPlace.eUndefined);if(this.showHidePlottedElement(e,o)){var t=q.categoryAxisModel.cellNameToCellNumber(m.getStrValue(q.categoryVarID)),k=SC.none(t)?0:q.categoryAxisView.cellToCoordinate(t),v=q.categoryAxisView.get("fullCellWidth")/2,s=this._pointRadius,p=this.get("binArrays"),r=p&&(t<p.length)&&p[t],j,i;var d=Math.round(g/(2*s)),c=(r&&r.length)||0,u=(r&&d>=0&&d<c)?r[d].counter++:0,n=this.get("overlap"),a=s+(2*s-n)*u+1;switch(q.primaryAxisPlace){case DG.GraphTypes.EPlace.eX:j=g;i=k-a+v;break;case DG.GraphTypes.EPlace.eY:j=k+a-v;i=g;break}this.updatePlottedElement(e,j,i,s,q.calcCaseColorString(m),f,h);return{cx:j,cy:i,r:s}}return null},createCircle:function(i,f,k){var e=this,d=this.getPath("model.primaryAxisPlace");function j(l){var n=e.getPath("model.primaryVarID"),m={operation:"updateCases",cases:[],attributeIDs:[n],values:[[]]},o=e.get("dataContext");if(!o){return}e.getPath("model.casesController.selection").forEach(function(p){m.cases.push(p);m.values[0].push(p.getNumValue(n)+l)});o.applyChange(m)}function b(o,p){var m=e.getPath("model.cases")[o],n=e.getPath("model.primaryVarID"),l=m.getNumValue(n)-p;e.get("model").animateSelectionBackToStart([n],[l])}var c=false,g=1,h=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(l){if(!c&&SC.none(h)){h="";this.animate({opacity:g,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime);e.showDataTip(this,f)}},function(l){if(!c){this.stop();this.animate({opacity:DG.PlotUtilities.kDefaultPointOpacity,transform:h},DG.PlotUtilities.kHighlightHideTime);h=null;e.hideDataTip()}}).mousedown(function(l){e.get("model").selectCaseByIndex(f,l.shiftKey)}).drag(function(p,o){var l=(d===DG.GraphTypes.EPlace.eX)?this.ox+p:this.oy+o,q=e.get("primaryAxisView").coordinateToData(l),n=e.getPath("model.cases")[this.index].getNumValue(e.getPath("model.primaryVarID")),m=this.transform();if(isFinite(q)){this.transform(h);j(q-n);this.transform(m)}},function(l,m){c=true;this.ox=this.attr("cx");this.oy=this.attr("cy");this.w=e.getPath("model.cases")[this.index].getNumValue(e.getPath("model.primaryVarID"));this.attr({opacity:g})},function(){this.animate({transform:h},DG.PlotUtilities.kHighlightHideTime);b(this.index,this.w);c=false;this.ox=this.oy=this.w=undefined});a.index=f;a.node.setAttribute("shape-rendering","geometric-precision");if(k){DG.PlotUtilities.doCreateCircleAnimation(a)}return a},drawData:function drawData(){if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}arguments.callee.base.apply(this,arguments)},doDraw:function doDraw(){function a(b){if(!SC.none(b)&&b.wantVisible()){b.updateToModel()}}arguments.callee.base.apply(this,arguments);this.drawData();this.updateSelection();if(!SC.none(this.movableValueAdorn)&&this.getPath("movableValueAdorn.plotModel.isVisible")){this.movableValueAdorn.updateToModel()}a(this.plottedMeanAdorn);a(this.plottedMedianAdorn);a(this.plottedStDevAdorn);a(this.plottedIQRAdorn);if(!SC.none(this.plottedValueAdorn)){this.plottedValueAdorn.updateToModel()}},zeroBinArray:function(){this._zeroBinArray(2*this._pointRadius)},_zeroBinArray:function(f){var h=this,d=this.get("primaryAxisView"),e=this.get("secondaryAxisView");if(!d||!e){return}var g=e.get("model"),c=g.get("numberOfCells"),b=Math.round(Math.abs(d.get("pixelMax")-d.get("pixelMin"))/f)+1;function a(){var j=h.getPath("model.cases"),t=h.getPath("model.primaryVarID"),p=h.getPath("model.secondaryVarID"),s=f/2,k=h.get("binArrays"),m=e.get("fullCellWidth"),i=Math.round(m/(2*s))-2,o=0,l=h.getPath("model.dataConfiguration.legendAttributeDescription"),q=l.get("attributeID"),r,n;if(i<=0){return 0}j.forEach(function(y){var u=!SC.none(q)?y.getValue(q):null,v=d.dataToCoordinate(y.getNumValue(t)),x=Math.round(v/(2*s)),w=g.cellNameToCellNumber(y.getStrValue(p));if((SC.none(q)||!SC.none(u))&&(x>=0)&&!SC.none(w)&&(w>=0)&&(w<k.length)&&(x<k[w].length)){k[w][x].total++}});r=DG.MathUtilities.max(k.map(function(u){return DG.MathUtilities.max(u.map(function(v){return v.total}))}));if(r>i){n=(r-i)*2*s;o=n/(r-1)}return o}this.set("binArrays",DG.MathUtilities.range(c).map(function(){return DG.MathUtilities.range(b).map(function(){return{total:0,counter:0}})}));this.set("overlap",a())},enterAnimationState:function(){var d=this,a=this._plottedElements.length,c=this.getPath("model.cases"),b=this.createRenderContext();this.zeroBinArray();c.forEach(function(e,f){var g=true;if(f>=a){d.callCreateCircle(e,f,false);g=false}d.setCircleCoordinate(b,c[f],f,g)})},movableValueChanged:function(){var a=this.get("model"),b=a&&a.getAdornmentModel("movableValue");if(b){if(!this.movableValueAdorn){this.movableValueAdorn=DG.MovableValueAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,valueAxisView:this.get("primaryAxisView")});this.movableValueAdorn.createElements()}if(b.get("isVisible")){this.movableValueAdorn.updateToModel()}}}.observes(".model.movableValue"),plottedMeanChanged:function(){this.adornmentDidChange("plottedMean","plottedMeanAdorn",DG.PlottedMeanAdornment)}.observes(".model.plottedMean"),plottedMedianChanged:function(){this.adornmentDidChange("plottedMedian","plottedMedianAdorn",DG.PlottedMedianAdornment)}.observes(".model.plottedMedian"),plottedStDevChanged:function(){this.adornmentDidChange("plottedStDev","plottedStDevAdorn",DG.PlottedStDevAdornment)}.observes(".model.plottedStDev"),plottedIQRChanged:function(){this.adornmentDidChange("plottedIQR","plottedIQRAdorn",DG.PlottedIQRAdornment)}.observes(".model.plottedIQR"),adornmentDidChange:function(e,f,c){var a=this.get("model"),b=a&&a.getAdornmentModel(e),d=this[f];if(b){if(!d){d=c.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,shadingLayerName:DG.LayerNames.kIntervalShading});this[f]=d}d.updateToModel()}},plottedValueChanged:function(){var a=this.get("model"),b=a&&a.getAdornmentModel("plottedValue");if(SC.none(this.functionEditView)){this.functionEditView=DG.PlottedValueAdornment.createFormulaEditView(b);this.get("parentView").appendChild(this.functionEditView)}this.functionEditView.set("isVisible",b.get("isVisible"));if(SC.none(this.plottedValueAdorn)){this.plottedValueAdorn=DG.PlottedValueAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,valueAxisView:this.get("primaryAxisView")})}}.observes(".model.plottedValue"),cleanupFunc:function(){this.prepareToResetCoordinates();this.displayDidChange()},zoom:function(d){var f=(this.getPath("model.primaryAxisPlace")===DG.GraphTypes.EPlace.eX)?"x":"y",b=this.get("primaryAxisView"),a={},e=d.shiftKey?2:0.5,c=DG.ViewUtilities.windowToViewCoordinates({x:d.clientX,y:d.clientY},this);a[f]=b.coordinateToData(c[f]);this.get("model").dilate(a,e)},handleBackgroundClick:function(a){if(a.altKey){this.zoom(a)}},handleBackgroundDblClick:function(a){this.zoom(a)}});DG.LegendModel=SC.Object.extend({attributeDescription:null,label:function(){var b=this.get("attributeDescription"),a=SC.none(b)?null:b.get("attribute");return(a===DG.Analysis.kNullAttribute)?"":a.get("name")}.property("attributeDescription.attribute"),numberOfCells:function(){return Math.max(1,this.getPath("attributeDescription.attributeStats.numberOfCells"))}.property("attributeDescription.attributeStats.numberOfCells"),numericRange:function(){return this.getPath("attributeDescription.attributeStats.numericRange")}.property("attributeDescription.attributeStats.numericRange"),cellNames:function(){var a=this.getPath("attributeDescription.attributeStats.cellMap");return DG.ObjectMap.keys(a)}.property("attributeDescription.attributeStats.cellMap"),selectCasesInCell:function(c,f){var d=this.getPath("attributeDescription.collectionClient"),a=d&&DG.DataContext.getContextFromCollection(d),e=this.get("attributeDescription").casesForCategory(c),b={operation:"selectCases",collection:d,cases:e,select:true,extend:f};if(a&&e){a.applyChange(b)}}});sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.LegendView=DG.RaphaelBaseView.extend(DG.GraphDropTarget,(function(){var d=150,c=3,a=12;return{displayProperties:["model.attributeDescription.attribute","model.attributeDescription.attributeStats.categoricalStats.numberOfCells","model.numericRange"],model:null,orientation:"horizontal",plottedAttribute:function(){return this.getPath("model.attributeDescription.attribute")}.property(),desiredExtent:function(){var i=this.getPath("parentView.frame.width")||d,j=Math.max(2,Math.floor(i/d)),h=this.get("labelExtent").y,f=this.model?this.getPath("model.numberOfCells"):0,g=this.get("isNumeric")?3:(1+Math.ceil(f/j)),e=g*h;DG.assert(isFinite(e));return e}.property("labelNode","model.numberOfCells"),labelExtent:function(){var g=DG.RenderingUtilities.kCaptionFontHeight,e=this.get("labelNode"),f;if(!SC.none(e)){f=e.getBBox();return{x:isNaN(f.width)?g:Math.max(g,f.width),y:isNaN(f.height)?g:Math.max(g,Math.ceil(f.height/2)*2)}}return{x:0,y:0}}.property("labelNode").cacheable(),labelNode:function(){var f=false,e;if(SC.none(this._paper)){return}if(SC.none(this._labelNode)){this._labelNode=this._paper.text(0,0,"").attr({font:"caption",fill:"blue",cursor:"pointer",title:SC.String.loc("DG.LegendView.attributeTooltip"),"text-anchor":"start"});this._labelNode.node.setAttribute("text-decoration","underline");f=true}e=this.getPath("model.label");if(e!==this._labelNode.attr("text")){this._labelNode.attr({text:e});f=true}if(f){this.notifyPropertyChange("labelNode",this._labelNode)}if(SC.empty(e)){return null}else{return this._labelNode}}.property("model.label"),labelNodes:function(){var e=this.get("labelNode");if(e){return[e]}else{return[]}}.property("labelNode"),_labelNode:null,_gradientRect:null,doDraw:function b(){var l=this,k=this.getPath("model.attributeDescription"),f=k.get("attributeStats"),j=l._paper.width-2*a,i=l._paper.height-2*c;function g(){var m=l.get("labelNode"),n=l.get("labelExtent");if(SC.none(m)){return}m.attr({text:l.getPath("model.label"),x:a,y:n.y/2})}function e(){var m=DG.ColorUtilities.calcAttributeColor(k).colorString,t=f.get("minMax"),o=DG.Format.number().fractionDigits(0,2)(t.min),s=DG.Format.number().fractionDigits(0,2)(t.max),r=l.get("labelExtent").y,n=0.5,u=4,v=3,w,p=(SC.browser.isSafari),z={stroke:m,"stroke-width":n,width:j,height:i/3,fill:("0-#fff-"+m)};if(p){l._elementsToClear.push(l._paper.rect(a,c+r,0,0).attr(z))}else{if(SC.none(l._gradientRect)){l._gradientRect=l._paper.rect(a,c+r,0,0)}l._gradientRect.attr(z).show()}for(w=0;w<=u;w++){var y=a+n+w*(j-2*n)/4,q=c+r+i/3;l._elementsToClear.push(l._paper.line(y,q,y,q+v).attr({stroke:m}))}var x=c+r+i/3+v+DG.RenderingUtilities.kDefaultFontHeight/2;l._elementsToClear.push(l._paper.text(a+n,x,o));l._elementsToClear.push(l._paper.text(a+j-2*n,x,s))}function h(){var r=Math.max(2,Math.floor(j/d)),A=l.getPath("model.numberOfCells"),m=Math.ceil(A/r),x=i/(m+1),o=x-2*c,u,z=l.getPath("model.cellNames");function n(C){l.get("model").selectCasesInCell(this.cellName,C.shiftKey)}function q(C){l.get("model").selectCasesInCell(this.attr("text"),C.shiftKey)}for(u=0;u<A;u++){var p=z[u],t=DG.ColorUtilities.calcCaseColor(p,k).colorString,w=Math.floor(u/r),B=u%r,y=a+B*j/r,v=c+(w+1)*x,s=l._paper.rect(y,v,o,o).attr({fill:t}).addClass(DG.PlotUtilities.kLegendKey).mousedown(n);s.cellName=p;l._elementsToClear.push(s);l._elementsToClear.push(l._paper.text(y+x,v+DG.RenderingUtilities.kDefaultFontHeight/3,p).attr({"text-anchor":"start"}).addClass(DG.PlotUtilities.kLegendKeyName).mousedown(q))}}g();if(this.get("isNumeric")){e()}else{if(this._gradientRect){this._gradientRect.hide()}h()}},dragData:null,performDragOperation:function(e,f){this.set("dragData",e.data);return SC.DRAG_LINK},drawWidth:function(){return this.get("frame").width-2*DG.ViewUtilities.kBorderWidth}.property("frame"),drawHeight:function(){return this.get("frame").height}.property("frame"),isNumeric:function(){return this.getPath("model.attributeDescription.isNumeric")}.property("model.attributeDescription.isNumeric"),attributeTypeDidChange:function(){this.displayDidChange()}.observes(".model.attributeDescription.attributeStats.attributeType")}}()));DG.NumberToggleModel=SC.Object.extend({dataConfiguration:null,_cachedCaseCount:null,_cachedParentCases:null,parentCases:function(){var a=[],b=this.getPath("dataConfiguration.allCases");if(!b){return[]}b=b.flatten();if(b.length===this._cachedCaseCount){a=this._cachedParentCases}else{b.forEach(function(d){var c=d.get("parent");if(c&&a.indexOf(c)<0){a.push(c)}});this._cachedCaseCount=b.length;this._cachedParentCases=a}return a}.property("*dataConfiguration.cases"),numberOfParents:function(){return this.get("parentCases").length}.property("parentCases"),nameOfParentCollection:function(){var a="";if(this.get("numberOfParents")>0){a=this.get("parentCases")[0].getPath("collection.name")}return a}.property(),childrenOfParent:function(c){var a=this.get("parentCases"),b=(c<a.length)?a[c]:null;return b?b.get("children").flatten():[]},changeAllCaseVisibility:function(){var a=this.get("dataConfiguration");a.showAllCases()},toggleChildrenVisibility:function(c){var a=this.childrenOfParent(c),d=this.get("dataConfiguration"),b=d.get("cases");d.hideCases(b);d.showCases(a)},allChildrenAreHidden:function(d){var c=this.childrenOfParent(d),b=this.getPath("dataConfiguration.hiddenCases");function a(e){return b.indexOf(e)<0}return !c.some(a)},allCasesAreHidden:function(){return this.get("dataConfiguration").getCaseCount()===0},handleDataContextNotification:function(a){this.invokeOnceLater(this.propertyDidChange,300,"caseCount")}});sc_require("views/raphael_base");DG.NumberToggleView=DG.RaphaelBaseView.extend((function(){var b=33,a=SC.Object.extend({paper:null,url:null,depressedUrl:null,action:null,target:null,arrow:null,depressedArrow:null,_position:null,_state:null,kHeight:19,init:function(){arguments.callee.base.apply(this,arguments);var d=false,e=this;this._position={x:0,y:0};this.arrow=this.paper.image(this.url,0,0,b,this.kHeight).hide().attr({cursor:"pointer"}).mousedown(function(){d=true;e._state="depressed";e.show()});this.depressedArrow=this.paper.image(this.depressedUrl,0,0,b,this.kHeight).hide().mouseup(function(){if(d&&e.action){e.action.call(e.target)}d=false;e._state="normal";e.show()})},position:function(d,e){if(e){this._position=e;if(this.arrow){this.arrow.attr(this._position)}if(this.depressedArrow){this.depressedArrow.attr(this._position)}}return this._position}.property(),show:function(){if(!this._state){this._state="normal"}switch(this._state){case"normal":this.arrow.show();this.depressedArrow.hide();break;case"depressed":this.depressedArrow.show();this.arrow.hide();break}return this},hide:function(){this.arrow.hide();this.depressedArrow.hide();return this}});return{displayProperties:["firstDisplayedIndex","lastDisplayedIndex"],model:null,firstDisplayedIndex:0,lastDisplayedIndex:0,_leftArrow:null,_rightArrow:null,leftArrow:function(){if(this._paper&&!this._leftArrow){this._leftArrow=a.create({paper:this._paper,url:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/arrow_left.png",depressedUrl:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/arrow_left_depressed.png",action:this.scrollLeft,target:this})}return this._leftArrow}.property(),rightArrow:function(){if(this._paper&&!this._rightArrow){this._rightArrow=a.create({paper:this._paper,url:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/arrow_right.png",depressedUrl:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/arrow_right_depressed.png",action:this.scrollRight,target:this})}return this._rightArrow}.property(),desiredExtent:function(){return DG.RenderingUtilities.kCaptionFontHeight}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.lastDisplayedIndex=this.getPath("model.numberOfParents")-1},doDraw:function c(){var h=function(y){DG.logUser("Show parent: %@",y.toggleIndex+1);this.get("model").toggleChildrenVisibility(y.toggleIndex)}.bind(this),p=function(){this.get("model").changeAllCaseVisibility();DG.logUser("Show all parents:")}.bind(this),u=function(){var y=false;return this._paper.text(0,0,"DG.NumberToggleView.showAll".loc()+" -").attr({font:"caption",cursor:"pointer","text-anchor":"start",fill:o.allCasesAreHidden()?"lightGray":"black",title:SC.String.loc("DG.NumberToggleView.overallTooltip")}).mousedown(function(){y=true}).mouseup(function(){if(y){p()}y=false})}.bind(this),e=function(){var B,y=false;function A(E){y=true}function D(E){if(y){h(this)}y=false}for(B=0;B<g;B++){var C=o.allChildrenAreHidden(B)?"lightGray":"black",z=this._paper.text(-100,m,B+1).attr({font:"caption",cursor:"pointer","text-anchor":"start",fill:C}).mousedown(A).mouseup(D);z.width=z.getBBox().width;z.toggleIndex=B;w.push(z);d+=z.width+f;this._elementsToClear.push(z)}}.bind(this),r=function(){var y=k,z;if(t){x=this.get("leftArrow").show();x.set("position",{x:y,y:0});y+=b}else{this.get("leftArrow").hide()}for(z=this.firstDisplayedIndex;z<=this.lastDisplayedIndex;z++){w[z].attr({x:y});y+=w[z].width+f}if(j){n=this.get("rightArrow").show();n.set("position",{x:y-f,y:0})}else{this.get("rightArrow").hide()}}.bind(this);var f=5,o=this.get("model"),g=o.get("numberOfParents"),i=u(),q=i.getBBox(),m=q.height/2,k=q.x+q.width+f,l=this._paper.width-k,j,t,n,x,w=[],d=0,s,v;this._elementsToClear.push(i);if(!DG.isFinite(k)||!DG.isFinite(m)){return}if(m===0){this.invokeLast(this.displayDidChange);return}i.attr({y:m});e();if(d<=l){j=t=false;this.firstDisplayedIndex=0;this.lastDisplayedIndex=g-1}else{if(this.lastDisplayedIndex===g-1){j=false;t=true;v=b;s=g;while(v<l&&s>0){s--;v+=w[s].width+f}this.firstDisplayedIndex=s+1}else{j=true;v=b;s=this.lastDisplayedIndex+1;while(v<l&&s>0){s--;v+=w[s].width+f}this.firstDisplayedIndex=s;if(this.firstDisplayedIndex===0){t=false}else{t=true;v=2*b;s=this.lastDisplayedIndex+1;while(v<l&&s>0){s--;v+=w[s].width+f}this.firstDisplayedIndex=s+1}}}r()},scrollLeft:function(){var e=this.get("firstDisplayedIndex"),f=this.get("lastDisplayedIndex"),d=Math.min(e,f-e);this.decrementProperty("lastDisplayedIndex",d)},scrollRight:function(){var e=this.get("firstDisplayedIndex"),g=this.get("lastDisplayedIndex"),f=this.getPath("model.numberOfParents"),d=Math.min(f-g-1,g-e);this.incrementProperty("lastDisplayedIndex",d)},shouldShow:function(){return this.getPath("model.numberOfParents")>1},handleCaseCountChange:function(){this.set("lastDisplayedIndex",this.getPath("model.numberOfParents")-1);this.displayDidChange()}.observes("model.caseCount"),handleHiddenCasesChange:function(){SC.run(function(){this.displayDidChange()}.bind(this))}.observes("model.dataConfiguration.hiddenCases")}}()));sc_require("components/graph/utilities/graph_drop_target");sc_require("views/raphael_base");DG.PlotBackgroundView=DG.RaphaelBaseView.extend(DG.GraphDropTarget,{autoDestroyProperties:["_backgroundForClick"],displayProperties:["xAxisView.model.lowerBound","xAxisView.model.upperBound","yAxisView.model.lowerBound","yAxisView.model.upperBound","xAxisView.model.attributeDescription.attributeStats.categoricalStats.numberOfCells","yAxisView.model.attributeDescription.attributeStats.categoricalStats.numberOfCells"],graphModel:null,xAxisView:null,yAxisView:null,_backgroundForClick:null,didCreateLayer:function(){var a=this.get("parentView");arguments.callee.base.apply(this,arguments);a.get("plotViews").forEach(function(b){b.didCreateLayer()});a.drawPlots()},initLayerManager:function(){arguments.callee.base.apply(this,arguments);var a=DG.LayerNames;this.get("layerManager").addNamedLayer(a.kBackground).addNamedLayer(a.kGrid).addNamedLayer(a.kIntervalShading).addNamedLayer(a.kClick).addNamedLayer(a.kGhost).addNamedLayer(a.kConnectingLines).addNamedLayer(a.kPoints).addNamedLayer(a.kSelectedPoints).addNamedLayer(a.kAdornments).addNamedLayer(a.kDataTip)},doDraw:function doDraw(){var j=this,c=this.get("frame"),m=this.get("xAxisView"),a=this.get("yAxisView"),n=this.getPath("layerManager."+DG.LayerNames.kBackground),i=this.getPath("layerManager."+DG.LayerNames.kGrid),f=(m.get("isNumeric")&&a.get("isNumeric")),s,d,e=[],o=false,b;function g(){function v(z,A,B){i.push(j._paper.line(z,c.height,z,0).attr({stroke:A,"stroke-width":B}))}function w(B,z,A){i.push(j._paper.line(0,B,c.width,B).attr({stroke:z,"stroke-width":A}))}function x(A,z){v(z,DG.PlotUtilities.kRuleColor,DG.PlotUtilities.kRuleWidth)}function u(z,A){w(A,DG.PlotUtilities.kRuleColor,DG.PlotUtilities.kRuleWidth)}function y(){function z(A,C){var B=A.get("zeroPixel");if(B){C(B,DG.PlotUtilities.kZeroLineColor,DG.PlotUtilities.kZeroLineWidth)}}z(m,v);z(a,w)}if(f){m.forEachTickDo(x);a.forEachTickDo(u);y()}}function l(v,u,w){if(w.altKey){return}if(w.shiftKey){e=j.getPath("graphModel.selection").toArray()}else{j.get("graphModel").selectAll(false)}d=DG.ViewUtilities.windowToViewCoordinates({x:v,y:u},j);s=j._paper.rect(d.x,d.y,0,0).attr({fill:DG.PlotUtilities.kMarqueeColor,stroke:DG.RenderingUtilities.kTransparent});j.getPath("layerManager."+DG.LayerNames.kAdornments).push(s)}function r(A,y){if(SC.none(s)){return}var u=(A>0)?d.x:d.x+A,z=(y>0)?d.y:d.y+y,x=Math.abs(A),w=Math.abs(y),v={x:u,y:z,width:x,height:w};s.attr(v);j.get("parentView").selectPointsInRect(v,e)}function p(w,v){if(SC.none(s)){return}j.getPath("layerManager").removeElement(s);s=null;e=[];var u=j.getPath("graphModel.casesController.selection.length");if(u>0){DG.logUser("marqueeSelection: %@",u)}}function t(w){if(w.altKey){var u="/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/MagnifyPlus.cur",x="/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/cursors/MagnifyMinus.cur",v=w.shiftKey?x:u;this.attr({cursor:DG.Browser.customCursorStr(v,8,8)})}else{this.attr({cursor:"auto"})}}function k(){if(b){b.hide();b.destroy();b=null}}function h(v){if(!o){var u="DG.GraphView.zoomTip".loc();b=DG.ToolTip.create({paperSource:j,text:u,tipOrigin:{x:v.layerX,y:v.layerY},layerName:"dataTip"});b.show();o=true;j.invokeLater(k,5000)}}var q=function(){var D=this.get("paper"),J=this.get("xAxisView"),I=this.get("yAxisView"),y=J.getPath("model.numberOfCells"),u=I.getPath("model.numberOfCells"),E=J.get("fullCellWidth"),x=I.get("fullCellWidth"),v=this.getPath("model.orientation")==="vertical",H=v?E:x,A=v?x:E,G,z,w,F,C,B;if(SC.none(D)){return}for(z=0;z<u;z++){if(v){w=I.cellToCoordinate(z);C=w-x/2}else{F=I.cellToCoordinate(z);B=F-x/2}for(G=0;G<y;G++){if(v){F=J.cellToCoordinate(G);B=F-E/2}else{w=J.cellToCoordinate(G);C=w-E/2}if((z+G)/2!==Math.floor((z+G)/2)){n.push(D.rect(C,B,A,H).attr({fill:DG.PlotUtilities.kPlotCellFill,opacity:0.8,stroke:DG.RenderingUtilities.kTransparent}))}}}}.bind(this);i.clear();n.clear();g();q();if(SC.none(this._backgroundForClick)){this._backgroundForClick=this.getPath("layerManager."+DG.LayerNames.kClick).push(this._paper.rect(0,0,0,0).attr({fill:DG.RenderingUtilities.kSeeThrough,stroke:DG.RenderingUtilities.kTransparent}).click(function(u){j.get("parentView").handleBackgroundClick(u)}).dblclick(function(u){j.get("parentView").handleBackgroundDblClick(u)}).drag(r,l,p).mousemove(t))}this._backgroundForClick.attr({width:this.get("drawWidth"),height:this.get("drawHeight")})}});sc_require("components/graph/plots/plot_model");sc_require("components/graph/plots/numeric_plot_model_mixin");DG.ScatterPlotModel=DG.PlotModel.extend(DG.NumericPlotModelMixin,{movableLine:null,isMovableLineVisible:function(){return !SC.none(this.movableLine)&&this.movableLine.get("isVisible")}.property("movableLine.isVisible"),isInterceptLocked:function(){return !SC.none(this.movableLine)&&this.movableLine.get("isInterceptLocked")}.property("movableLine.isInterceptLocked"),areSquaresVisible:false,squares:null,lineDidChange:function(){this.notifyPropertyChange("squares")}.observes(".movableLine.slope",".movableLine.intercept"),createMovableLine:function(){if(SC.none(this.movableLine)){this.beginPropertyChanges();this.set("movableLine",DG.MovableLineModel.create());this.movableLine.recomputeSlopeAndIntercept(this.get("xAxis"),this.get("yAxis"));this.endPropertyChanges()}},toggleMovableLine:function(){if(SC.none(this.movableLine)){this.createMovableLine()}else{this.movableLine.recomputeSlopeAndInterceptIfNeeded(this.get("xAxis"),this.get("yAxis"));this.movableLine.set("isVisible",!this.movableLine.get("isVisible"))}DG.logUser("toggleMovableLine: %@",this.movableLine.get("isVisible")?"show":"hide")},toggleInterceptLocked:function(){if(SC.none(this.movableLine)){this.createMovableLine()}else{this.movableLine.toggleInterceptLocked();this.movableLine.recomputeSlopeAndInterceptIfNeeded(this.get("xAxis"),this.get("yAxis"))}DG.logUser("lockIntercept: %@",this.movableLine.get("isInterceptLocked"))},togglePlotFunction:function(){this.toggleAdornmentVisibility("plottedFunction","togglePlotFunction");if(this.isAdornmentVisible("plottedFunction")){var a=this.getAdornmentModel("plottedFunction");if(a){a.set("dataConfiguration",this.get("dataConfiguration"))}}},toggleConnectingLine:function(){var a=this.toggleAdornmentVisibility("connectingLine","toggleConnectingLine");if(a&&a.get("isVisible")){a.recomputeValue()}},toggleShowSquares:function(){this.set("areSquaresVisible",!this.get("areSquaresVisible"))},handleDataConfigurationChange:function(){arguments.callee.base.apply(this,arguments);this.rescaleAxesFromData(true,true);var a=this.getAdornmentModel("connectingLine");if(a){a.setComputingNeeded()}},rescaleAxesFromData:function(c,b,a){if(b===undefined){b=true}this.doRescaleAxesFromData([DG.GraphTypes.EPlace.eX,DG.GraphTypes.EPlace.eY],c,b);if(a){DG.logUser("rescaleScatterplot")}},dilate:function(b,a){this.doDilation([DG.GraphTypes.EPlace.eX,DG.GraphTypes.EPlace.eY],b,a)},getGearMenuItems:function(){var h=this,g=this.get("isMovableLineVisible"),c=this.isAdornmentVisible("plottedFunction"),b=g?"Hide Movable Line":"Show Movable Line",e=(this.isAdornmentVisible("connectingLine")?"DG.ScatterPlotModel.HideConnectingLine":"DG.ScatterPlotModel.ShowConnectingLine").loc(),a=(this.get("isInterceptLocked")?"DG.ScatterPlotModel.UnlockIntercept":"DG.ScatterPlotModel.LockIntercept").loc(),f=c?"Hide Plotted Function":"Plot Function",d=this.get("areSquaresVisible")?"Hide Squares":"Show Squares";return[{title:"Rescale to Data",target:h,itemAction:h.rescaleAxesFromData,args:[true,false,true]},{title:e,target:h,itemAction:this.toggleConnectingLine},{title:b,target:h,itemAction:this.toggleMovableLine},{title:a,target:h,itemAction:this.toggleInterceptLocked,isEnabled:g},{title:f,target:h,itemAction:this.togglePlotFunction},{title:d,target:h,itemAction:this.toggleShowSquares,isEnabled:g||c}].concat(arguments.callee.base.apply(this,arguments)).concat([{isSeparator:YES}])},createStorage:function(){var b=arguments.callee.base.apply(this,arguments),a=this.get("movableLine");if(!SC.none(a)){b.movableLineStorage=a.createStorage()}if(this.get("areSquaresVisible")){b.areSquaresVisible=true}return b},restoreStorage:function(a){this.moveAdornmentStorage(a,"movableLine",a.movableLineStorage);this.moveAdornmentStorage(a,"plottedFunction",a.plottedFunctionStorage);arguments.callee.base.apply(this,arguments);if(a.movableLineStorage){if(SC.none(this.movableLine)){this.createMovableLine()}this.get("movableLine").restoreStorage(a.movableLineStorage)}if(a.areSquaresVisible){this.toggleShowSquares()}if(a.plottedFunctionStorage){if(SC.none(this.plottedFunction)){this.set("plottedFunction",DG.PlottedFunctionModel.create())}this.get("plottedFunction").restoreStorage(a.plottedFunctionStorage)}},onRescaleIsComplete:function(){if(!SC.none(this.movableLine)){this.movableLine.recomputeSlopeAndInterceptIfNeeded(this.get("xAxis"),this.get("yAxis"))}},getCellCaseCounts:function(){var d=this.get("cases"),a=this.get("xVarID"),e=this.get("yVarID"),c=0,b=[];if(!(a&&e)){return b}d.forEach(function(f,h){var i=f.getNumValue(a),g=f.getNumValue(e);if(isFinite(i)&&isFinite(g)){++c}});b.push({count:c,primaryCell:0,secondaryCell:0});return b}});sc_require("components/graph/plots/plot_view");DG.ScatterPlotView=DG.PlotView.extend({displayProperties:["xAxisView.model.lowerBound","xAxisView.model.upperBound","yAxisView.model.lowerBound","yAxisView.model.upperBound","xAxisView.pixelMin","xAxisView.pixelMax","yAxisView.pixelMin","yAxisView.pixelMax","model.areSquaresVisible","model.squares"],autoDestroyProperties:["movableLineAdorn","functionAdorn","connectingLineAdorn"],connectingLineAdorn:null,primaryAxisView:function(){return this.get("xAxisView")}.property("xAxisView"),secondaryAxisView:function(){return this.get("yAxisView")}.property("yAxisView"),movableLineAdorn:null,functionEditView:null,functionAdorn:null,_squares:null,cleanupFunc:function(){var a=this.get("connectingLineAdorn");if(a){a.updateToModel()}},destroy:function(){var a=this.get("model");if(a){a.removeObserver("squares",this,"squaresDidChange")}if(a){a.removeObserver("areSquaresVisible",this,"squaresDidChange")}arguments.callee.base.apply(this,arguments)},modelDidChange:function(){arguments.callee.base.apply(this,arguments);var a=this.get("model");if(a){a.addObserver("squares",this,"squaresDidChange");a.addObserver("areSquaresVisible",this,"squaresDidChange");this.connectingLineChanged()}},dataDidChange:function(){arguments.callee.base.apply(this,arguments);if(this.connectingLineAdorn){this.connectingLineAdorn.invalidateModel()}},dataRangeDidChange:function(a,g,d,e){var c=this,i=this._plottedElements.length,b=this.getPath("model.cases"),h=this.createRenderContext(),f=(SC.typeOf(e)===SC.T_NUMBER?[e]:e);DG.assert(f);f.forEach(function(j){if(j>=i){c.callCreateCircle(b[j],j,c._createAnimationOn)}c.setCircleCoordinate(h,b[j],j)});if(this.getPath("model.areSquaresVisible")){this.squaresDidChange()}if(this.connectingLineAdorn){this.connectingLineAdorn.invalidateModel();this.connectingLineAdorn.updateToModel()}this.rescaleOnParentCaseCompletion(b);arguments.callee.base.apply(this,arguments)},calcPointRadius:function(){var b=2,a=arguments.callee.base.apply(this,arguments);if(this.connectingLineAdorn&&this.connectingLineAdorn.wantVisible()){a=Math.max(b,a-4)}return a},setCircleCoordinate:function setCircleCoordinate(d,b,e,h,c){DG.assert(d&&d.xAxisView);DG.assert(b);DG.assert(DG.MathUtilities.isInIntegerRange(e,0,this._plottedElements.length));var a=this._plottedElements[e],g=d.xAxisView.dataToCoordinate(b.getNumValue(d.xVarID)),f=d.yAxisView.dataToCoordinate(b.getNumValue(d.yVarID)),i=!DG.isFinite(g)||!DG.isFinite(f);if(this.showHidePlottedElement(a,i)){this.updatePlottedElement(a,g,f,this._pointRadius,d.calcCaseColorString(b),h,c);return{cx:g,cy:f,r:this._pointRadius}}return null},createCircle:function(i,e,k){var d=this;function j(n){var l=d.getPath("model.xVarID"),p=d.getPath("model.yVarID"),m={operation:"updateCases",cases:[],attributeIDs:[l,p],values:[[],[]]},o=d.get("dataContext");if(!o){return}d.getPath("model.casesController.selection").forEach(function(q){m.cases.push(q);m.values[0].push(q.getNumValue(l)+n.x);m.values[1].push(q.getNumValue(p)+n.y)});o.applyChange(m)}function b(q,m){var n=d.getPath("model.cases")[q],l=d.getPath("model.xVarID"),r=d.getPath("model.yVarID"),p=n.getNumValue(l)-m.x,o=n.getNumValue(r)-m.y;d.get("model").animateSelectionBackToStart([l,r],[p,o])}function f(){this.hoverAnimation=null}var c=false,g=1,h=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).hover(function(l){if(!c&&SC.none(h)){h="";if(this.hoverAnimation){this.stop(this.hoverAnimation)}this.hoverAnimation=Raphael.animation({opacity:g,transform:DG.PlotUtilities.kDataHoverTransform},DG.PlotUtilities.kDataTipShowTime,"<>",f);this.animate(this.hoverAnimation);d.showDataTip(this,e)}},function(l){if(!c){if(this.hoverAnimation){this.stop(this.hoverAnimation)}this.hoverAnimation=Raphael.animation({transform:h},DG.PlotUtilities.kHighlightHideTime,"<>",f);this.animate(this.hoverAnimation);h=null;d.hideDataTip()}}).mousedown(function(l){d.get("model").selectCaseByIndex(e,l.shiftKey||l.metaKey)}).drag(function(m,l){SC.run(function(){var s=d.get("xAxisView").coordinateToData(this.ox+m),r=d.get("yAxisView").coordinateToData(this.oy+l),o=d.getPath("model.cases")[this.index],q=o.getNumValue(d.getPath("model.xVarID")),p=o.getNumValue(d.getPath("model.yVarID")),n=this.transform();if(isFinite(s)&&isFinite(r)){this.transform(h);j({x:s-q,y:r-p});this.transform(n)}},this)},function(l,n){var m=d.getPath("model.cases")[this.index];c=true;this.ox=this.attr("cx");this.oy=this.attr("cy");this.wx=m.getNumValue(d.getPath("model.xVarID"));this.wy=m.getNumValue(d.getPath("model.yVarID"));this.animate({opacity:g},DG.PlotUtilities.kDataTipShowTime,"bounce")},function(){this.animate({transform:h},DG.PlotUtilities.kHighlightHideTime);h=null;b(this.index,{x:this.wx,y:this.wy});c=false;this.ox=this.oy=this.wx=this.wy=undefined;d.hideDataTip()});a.index=e;a.node.setAttribute("shape-rendering","geometric-precision");if(k){DG.PlotUtilities.doCreateCircleAnimation(a)}return a},drawData:function drawData(){if(this.getPath("model.isAnimating")){return}if(!SC.none(this.get("transferredPointCoordinates"))){this.animateFromTransferredPoints();return}arguments.callee.base.apply(this,arguments)},doDraw:function doDraw(){var b=this;function a(){var c=b.getPath("model.areSquaresVisible"),f=!c&&b._squares&&(b._squares.length>0),e=c&&(!b._squares||(b._squares.length===0));if(!b._squares){b._squares=[]}b._squares.forEach(function(n){if(f){n.animate({"stroke-opacity":0},DG.PlotUtilities.kDefaultAnimationTime,"<>",function(){n.remove()})}else{n.remove()}});b._squares=[];if(!c){return}var d=b.getPath("model.cases"),j=b.getPath("model.xVarID"),l=b.getPath("model.yVarID"),h=b.get("xAxisView"),m=b.get("yAxisView"),g=b.get("paper");if(b.getPath("model.isMovableLineVisible")){var k=b.getPath("model.movableLine.slope"),i=b.getPath("model.movableLine.intercept");d.forEach(function(n){var p=n.getNumValue(j),o=n.getNumValue(l),x=h.dataToCoordinate(p),w=m.dataToCoordinate(o),q=m.dataToCoordinate(k*p+i),r=x+w-q,u=Math.min(x,r),t=Math.min(w,q),v=Math.abs(q-w),s=DG.RenderingUtilities.pathForFrame({x:u,y:t,width:v,height:v}),y=g.path(s).attr({stroke:"red"});if(e){y.attr({"stroke-opacity":0}).animate({"stroke-opacity":1},DG.PlotUtilities.kDefaultAnimationTime,"<>")}b._squares.push(y)})}}arguments.callee.base.apply(this,arguments);this.drawData();this.updateSelection();if(!SC.none(this.connectingLineAdorn)&&this.connectingLineAdorn.wantVisible()){this.connectingLineAdorn.updateToModel()}if(!SC.none(this.movableLineAdorn)){this.movableLineAdorn.updateToModel()}if(!SC.none(this.functionAdorn)){this.functionAdorn.updateToModel()}a()},updateSelection:function(){arguments.callee.base.apply(this,arguments);if(this.connectingLineAdorn&&this.connectingLineAdorn.wantVisible()){this.connectingLineAdorn.updateSelection()}},enterAnimationState:function(){var e=this,a=this._plottedElements.length,d=this.getPath("model.cases"),c=this.createRenderContext(),b;d.forEach(function(f,g){var h=true;if(g>=a){e.callCreateCircle(f,g,false);h=false}e.setCircleCoordinate(c,d[g],g,h)});for(b=d.length;b<a;b++){this._plottedElements[b].animate({transform:"s0 0"},DG.PlotUtilities.kDefaultAnimationTime,"<>")}this.set("allowTransferAnimation",false)},movableLineChanged:function(){if(!this.readyToDraw()){return}var b=this.getPath("model.movableLine");if(b){if(!this.movableLineAdorn){var a=DG.MovableLineAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),xAxisView:this.get("xAxisView"),yAxisView:this.get("yAxisView"),layerName:DG.LayerNames.kAdornments});a.createElements();this.movableLineAdorn=a}this.movableLineAdorn.updateVisibility()}}.observes("*model.movableLine.isVisible"),connectingLineChanged:function(){var d=function(){if(b){b.updateToModel(true)}this.updatePointSize();this._elementOrderIsValid=false;this.updateSelection()}.bind(this);var a=this.get("model"),c=a&&a.getAdornmentModel("connectingLine"),b=this.get("connectingLineAdorn");if(c&&c.get("isVisible")&&!b){b=DG.ConnectingLineAdornment.create({parentView:this,model:c,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kConnectingLines});this.set("connectingLineAdorn",b)}this.invokeLast(d)}.observes(".model.connectingLine"),squaresDidChange:function(){this._isRenderingValid=false;this.displayDidChange()},plottedFunctionChanged:function(){var a=this.get("model"),b=a&&a.getAdornmentModel("plottedFunction");if(!b){return}if(!this.functionEditView){this.functionEditView=DG.PlottedFunctionAdornment.createFormulaEditView(b);this.get("parentView").appendChild(this.functionEditView)}this.functionEditView.set("isVisible",b.get("isVisible"));this.functionEditView.set("formulaExpression",b.get("expression"));if(SC.none(this.functionAdorn)){this.functionAdorn=DG.PlottedFunctionAdornment.create({parentView:this,model:b,paperSource:this.get("paperSource"),layerName:DG.LayerNames.kAdornments,xAxisView:this.get("xAxisView"),yAxisView:this.get("yAxisView")})}this.functionAdorn.updateVisibility()}.observes(".model.plottedFunction"),didCreateLayer:function(){arguments.callee.base.apply(this,arguments);this.movableLineChanged();this.plottedFunctionChanged()},zoom:function(c){var d=c.shiftKey?2:0.5,b=DG.ViewUtilities.windowToViewCoordinates({x:c.clientX,y:c.clientY},this),a={x:this.get("xAxisView").coordinateToData(b.x),y:this.get("yAxisView").coordinateToData(b.y)};this.get("model").dilate(a,d)},handleBackgroundClick:function(a){if(a.altKey){this.zoom(a)}},handleBackgroundDblClick:function(a){this.zoom(a)}});DG.Drag=SC.Drag.extend({_findDropTarget:function(b){var d=this._dropTargets(),c={x:b.pageX,y:b.pageY},a=null;d.forEach(function(f){if(f.constructor===DG.AxisMultiTarget){var e=f.convertFrameToView(f.get("frame"),null);if(SC.pointInRect(c,e)){a=f}}});if(!SC.none(a)){return a}else{return arguments.callee.base.apply(this,arguments)}}});DG.GraphAnimator=SC.Object.extend({isAnimating:false,startTime:null,plot:null,axisInfoArray:null,savedAxisInfoArray:null,destroy:function(){this.endAnimation();this.plot=null;this.axisInfoArray=null;this.savedAxisInfoArray=null;arguments.callee.base.apply(this,arguments)},animate:function(e,c){var g=this,f=50,d=DG.PlotUtilities.kDefaultAnimationTime;function b(){var h=(new Date()).valueOf(),i=(h-g.startTime)/d,k;function l(n){if(n>=1){return 1}else{return DG.AnimationMath.DefaultAnimationTween(n)}}function j(o,n,p){return o+p*(n-o)}function m(p){var n=j(p.oldBounds.lower,p.newBounds.lower,k),o=j(p.oldBounds.upper,p.newBounds.upper,k);p.axis.setLowerAndUpperBounds(n,o)}k=l(i);g.axisInfoArray.forEach(m);if(i<1){DG.assert(!g.animationTimer.get("isPaused"))}else{g.endAnimation(e,c)}}function a(h){h.oldBounds={lower:h.axis.get("lowerBound"),upper:h.axis.get("upperBound")}}if(this.isAnimating){this.endAnimation()}this.isAnimating=true;this.savedAxisInfoArray=this.axisInfoArray;this.axisInfoArray.forEach(a);this.startTime=(new Date()).valueOf();if(SC.none(this.animationTimer)){this.animationTimer=SC.Timer.schedule({action:b,interval:f,repeats:YES,until:false})}this.animationTimer.set("isPaused",NO);b()},endAnimation:function(b,a){this.animationTimer.set("isPaused",YES);if(!SC.none(this.plot)){this.setPath("plot.isAnimating",false)}this.savedAxisInfoArray.forEach(function(c){c.axis.setLowerAndUpperBounds(c.newBounds.lower,c.newBounds.upper)});this.isAnimating=false;if(!SC.none(a)){a.call(b)}}});DG.LayerNames={kBackground:"background",kGrid:"grid",kIntervalShading:"intervalShading",kClick:"click",kGhost:"ghost",kConnectingLines:"connectingLines",kPoints:"points",kSelectedPoints:"selectedPoints",kAdornments:"adornments",kDataTip:"dataTip"};DG.GuideConfigurationView=SC.PalettePane.extend({itemRow:SC.View.extend({blurAction:null,blurTarget:null,childViews:"itemTitle itemURL".w(),itemTitle:SC.TextFieldView.design({hint:"DG.GuideConfigView.itemTitleHint"}),itemURL:SC.TextFieldView.design({hint:"DG.GuideConfigView.itemURLHint"}),init:function(){arguments.callee.base.apply(this,arguments);var b=this.get("blurAction"),a=this.get("blurTarget");this.setPath("itemTitle.layout",{left:5,width:140});this.setPath("itemURL.layout",{left:150,right:5});this.get("childViews").forEach(function(c){c.set("fieldDidBlur",function(){if(b){b.call(a)}})})},rowObject:function(){var a=this.getPath("itemTitle.value"),b=this.getPath("itemURL.value");if(!SC.empty(a)||!SC.empty(b)){return{itemTitle:a,url:b}}return null}.property(),setItem:function(a){if(a){this.setPath("itemTitle.value",a.itemTitle);this.setPath("itemURL.value",a.url)}}}),model:null,isModal:YES,layout:{width:400,height:400,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"titleField menuItems okButton cancel".w(),titleField:SC.TextFieldView.design({layout:{top:5,left:5,right:25,height:24},value:"",spellCheckEnabled:true,hint:"DG.GuideConfigView.titleHint",leftAccessoryView:SC.LabelView.create({layout:{left:1,width:95,height:22,centerY:0},value:"DG.GuideConfigView.titlePrompt",backgroundColor:"lightgray",localize:true})}),menuItems:SC.View.design({layout:{left:5,right:5,top:34,bottom:34},backgroundColor:"white"}),okButton:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,title:"DG.GuideConfigView.okBtnTitle",toolTip:"DG.GuideConfigView.okBtnToolTip",target:null,action:null,toolTip:"",localize:true,isDefault:true}),cancel:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,title:"DG.GuideConfigView.cancelBtnTitle",target:null,action:null,toolTip:"DG.GuideConfigView.cancelBtnTooltip",localize:true,isCancel:true})}),title:function(){return this.getPath("contentView.titleField.value")}.property(),items:function(){return this.get("rowObjects")}.property(),addMenuItemRow:function(d){var a=this.getPath("contentView.menuItems"),b=this.get("rowViews").length,e=5+b*27,c=this.itemRow.create({layout:{border:1,left:5,right:5,top:e+5,height:22},blurAction:this.configureRows,blurTarget:this});c.setItem(d);a.appendChild(c)},rowViews:function(){return this.getPath("contentView.menuItems.childViews")}.property(),rowObjects:function(){return this.get("rowViews").map(function(a){return a.get("rowObject")}).filter(function(a){return a?true:false})}.property(),configureRows:function(){var b=this.get("rowViews").length,a=this.get("rowObjects").length;while(b<a+1){this.addMenuItemRow();b++}},setupFromModel:function(b){var a=this.get("model");this.setPath("contentView.titleField.value",a.get("title"));a.get("items").forEach(function(c){this.addMenuItemRow(c)}.bind(this))},init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancel.target",this);this.setPath("contentView.cancel.action","close");this.setupFromModel();this.configureRows()},close:function(){this.remove();this.destroy()}});DG.CreateGuideConfigurationView=function(b){var d=DG.GuideConfigurationView.create(b),a=d.get("contentView"),c=d.getPath("contentView.titleField");a.setPath("okButton.target",b.okTarget);a.setPath("okButton.action",b.okAction);d.append();c.becomeFirstResponder();return d};DG.StringUtilities={guaranteePrefix:function(a,b){return(a.indexOf(b)===0)?a:b+a}};sc_require("controllers/component_controller");sc_require("utilities/string_utilities");DG.GuideController=DG.ComponentController.extend({guideModel:null,guideButton:null,guideMenuPane:null,updateViewTitle:function(){var a=this.getPath("guideModel.title"),b=this.getPath("guideModel.currentItemTitle");this.setPath("view.title",a+(SC.empty(b)?"":" - "+b))}.observes("guideModel.title","guideModel.currentItemTitle"),modelContentsDidChange:function(){var a=this.getPath("guideModel.title"),j=this.getPath("guideModel.items"),h=this.get("iconMenuItems"),b=this.get("guideButton"),d=this.get("guideMenuPane"),g=!SC.empty(a)||(j.length>0),i=this.getPath("guideModel.currentURL");if(b){b.set("isVisible",g)}if(d){var e="DG.ToolButtonData.guideMenu.showGuide".loc(),f=[{title:e,isEnabled:true,target:this,action:"showGuide"},{isSeparator:true}];d.set("items",f.concat(h))}if((h.length>0)&&SC.empty(i)){var c=h[0];this.setPath("guideModel.currentURL",c.url);this.setPath("guideModel.currentItemTitle",c.title)}}.observes("guideModel.title","guideModel.items"),showGuide:function(){var a=this.get("view");a.setPath("isVisible",true);a.bringToFront();a.scrollToVisible()},guideNavigation:function(){var a=this.getPath("guideMenuPane.selectedItem.url"),b=this.getPath("guideMenuPane.selectedItem.title");this.setPath("guideModel.currentURL",a);this.setPath("guideModel.currentItemTitle",b);this.showGuide();DG.logUser("Guide icon navigation: { Title: %@, itemTitle: %@, url: %@ }",this.getPath("guideModel.title"),b,a)},gearMenuItems:function(){var b=this.getPath("guideModel.items"),c=[],a=function(d){this.setPath("guideModel.currentURL",d.url);this.setPath("guideModel.currentItemTitle",d.itemTitle);DG.logUser("Guide gear navigation: { Title: %@, itemTitle: %@, url: %@ }",this.getPath("guideModel.title"),d.itemTitle,d.url)}.bind(this);b.forEach(function(d){c.push({title:d.itemTitle,url:d.url,target:this,itemAction:a,args:[d]})}.bind(this));return c}.property("guideModel.items"),iconMenuItems:function(){var b=this.getPath("guideModel.items"),c=[],a="guideNavigation";b.forEach(function(d){c.push({title:d.itemTitle,url:d.url,target:this,action:a})}.bind(this));return c}.property(),viewDidChange:function(){if(!SC.none(this.tempIsVisible)){this.setPath("view.isVisible",this.tempIsVisible)}this.tempIsVisible=undefined}.observes("view"),createComponentStorage:function(){var a=this.get("guideModel").createComponentStorage();a.isVisible=this.getPath("view.isVisible");return a},restoreComponentStorage:function(a){this.get("guideModel").restoreComponentStorage(a);if(!SC.none(a.isVisible)){this.tempIsVisible=a.isVisible}}});DG.GuideModel=SC.Object.extend({title:"",items:null,currentURL:"",currentItemTitle:"",init:function(){arguments.callee.base.apply(this,arguments);this.reset()},reset:function(){this.beginPropertyChanges();this.set("title","");this.set("currentURL","");this.set("currentItemTitle","");this.set("items",[]);this.endPropertyChanges()},createComponentStorage:function(){return{title:this.title,items:this.items,currentURL:this.currentURL,currentItemTitle:this.currentItemTitle}},restoreComponentStorage:function(a){this.beginPropertyChanges();if(a.currentURL){this.set("currentURL",a.currentURL)}if(a.title){this.set("title",a.title)}if(a.title){this.set("currentItemTitle",a.currentItemTitle)}if(a.items){this.set("items",a.items)}this.endPropertyChanges()}});DG.GuideView=SC.WebView.extend((function(){return{guideModel:null,realURL:function(){return DG.StringUtilities.guaranteePrefix(this.getPath("guideModel.currentURL"),"http://")}.property("guideModel.currentURL"),init:function(){arguments.callee.base.apply(this,arguments);DG.assert(!SC.none(this.get("guideModel")));this.currentURLDidChange()},currentURLDidChange:function(){this.set("value",this.get("realURL"))}.observes("guideModel.currentURL")}}()));sc_require("components/graph_map_common/plot_data_configuration");DG.MapDataConfiguration=DG.PlotDataConfiguration.extend({init:function(){var f={x:DG.AttributePlacementDescription.create(),y:DG.AttributePlacementDescription.create(),legend:DG.AttributePlacementDescription.create()},i,a=DG.currDocumentController().collectionDefaults(),g=a&&a.collectionClient,c=g&&g.getAttributeNames(),d,l,k,e,b=["latitude","lat","Latitude","Lat"],j=["longitude","long","lng","Longitude","Long","Lng"];arguments.callee.base.apply(this,arguments);var h=function(n,m){var o=f[n];DG.assert(o);if(m){o.set("collectionClient",g);o.set("attribute",m);o.setPath("attributeStats.attributeType",DG.Analysis.EAttributeType.eNumeric)}else{o.set("collectionClient",null);o.removeAllAttributes()}o.addObserver("collectionClient",this,n+"CollectionDidChange")}.bind(this);if(c){b.forEach(function(m){if(c.indexOf(m)>=0){d=m}});k=d&&g.getAttributeByName(d);j.forEach(function(m){if(c.indexOf(m)>=0){l=m}});e=l&&g.getAttributeByName(l)}h("x",e);h("y",k);h("legend",null);this.attributesByPlace=[];for(i=0;i<DG.GraphTypes.EPlace.eNumPlaces;i++){this.attributesByPlace[i]=[]}this.attributesByPlace[DG.GraphTypes.EPlace.eX][0]=f.x;this.attributesByPlace[DG.GraphTypes.EPlace.eY][0]=f.y;this.attributesByPlace[DG.GraphTypes.EPlace.eLegend][0]=f.legend}});DG.MapLayer=SC.Object.extend({containerView:null,kSanFran:[37.84,-122.1],kDefaultZoom:5,_layerID:null,_map:null,map:function(){return this._map}.property("_map"),didCreateMap:function(a){},init:function(){arguments.callee.base.apply(this,arguments)},render:function(a,b){if(b){this._layerID=a.push("<div></div>").id()}},didCreateLayer:function(){this.invokeLast(this._createMap)},_createMap:function(){var a=function(d){this.containerView.addPointLayer()}.bind(this),c=function(d){this.getPath("containerView.mapPointView").doDraw()}.bind(this);if(this._map){}else{this._map=L.map(this._layerID).setView(this.kSanFran,this.kDefaultZoom);this._map.on("layeradd",a);var b=L.tileLayer.wms("http://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv",{layers:"gebco_08_grid",format:"image/jpeg",crs:L.CRS.EPSG4326});this._map.addLayer(b,true);this._map.on("drag",c);this._map.on("zoomend",c)}},viewDidResize:function(){var a=this.get("map");if(a){a.invalidateSize()}}});sc_require("components/graph_map_common/data_display_model");DG.MapModel=DG.DataDisplayModel.extend({handleOneDataContextChange:function(a,b){this.get("dataConfiguration").invalidateCaches(null,b);b.indices=this.buildIndices(b);this.dataRangeDidChange(this,"revision",this,b.indices);this.set("lastChange",b)},selectCaseByIndex:function(d,f){var e=this.get("cases"),b=e[d],a=this.get("selection"),c={operation:"selectCases",collection:this.get("collectionClient"),cases:[b],select:true,extend:f};if(a.get("length")!==0){if(a.contains(b)){if(f){c.select=false}else{return}}else{c.select=true}}this.get("dataContext").applyChange(c);if(c.select){DG.logUser("caseSelected: %@",d)}else{DG.logUser("caseDeselected: %@",d)}},getLatLngBounds:function(){var a=this.getPath("dataConfiguration.yAttributeDescription.attributeStats.minMax"),b=this.getPath("dataConfiguration.xAttributeDescription.attributeStats.minMax"),d=[a.min,b.min],c=[a.max,b.max];return[d,c]},isAffectedByChange:function(a){return true}});sc_require("components/graph_map_common/plot_layer");DG.MapPointLayer=DG.PlotLayer.extend({displayProperties:[],autoDestroyProperties:[],mapSource:null,map:function(){return this.getPath("mapSource.mapLayer.map")}.property(),readyToDraw:function(){var a=this.get("model");return arguments.callee.base.apply(this,arguments)&&a&&!SC.none(a.getPath("dataConfiguration.yAttributeDescription.attributeID"))&&!SC.none(a.getPath("dataConfiguration.xAttributeDescription.attributeID"))},createRenderContext:function(){var b=this.get("model");if(!b){return}var a=b.getPath("dataConfiguration.legendAttributeDescription");return{map:this.get("map"),latVarID:b.getPath("dataConfiguration.yAttributeDescription.attributeID"),lngVarID:b.getPath("dataConfiguration.xAttributeDescription.attributeID"),legendDesc:a,legendVarID:a&&a.get("attributeID"),updatedPositions:true,calcCaseColorString:function(e){if(!this.legendVarID){return"yellow"}DG.assert(e);var c=e.getValue(this.legendVarID),d=DG.ColorUtilities.calcCaseColor(c,this.legendDesc,this.attrColor);return d.colorString}}},dataRangeDidChange:function(a,g,d,e){if(!this.readyToDraw()){return}var c=this,i=this._plottedElements.length,b=this.getPath("model.cases"),h=this.createRenderContext(),f=(SC.typeOf(e)===SC.T_NUMBER?[e]:e);DG.assert(f);f.forEach(function(j){if(j>=i){c.callCreateCircle(b[j],j,c._createAnimationOn)}c.setCircleCoordinate(h,b[j],j)});arguments.callee.base.apply(this,arguments)},setCircleCoordinate:function(d,b,e,i,c){DG.assert(d&&d.map&&d.latVarID&&d.lngVarID);DG.assert(b);DG.assert(DG.MathUtilities.isInIntegerRange(e,0,this._plottedElements.length));var a=this._plottedElements[e],f=d.map.latLngToContainerPoint([b.getNumValue(d.latVarID),b.getNumValue(d.lngVarID)]),h=f.x,g=f.y,j=!DG.isFinite(h)||!DG.isFinite(g);if(this.showHidePlottedElement(a,j)){this.updatePlottedElement(a,h,g,this._pointRadius,d.calcCaseColorString(b),i,c);return{cx:h,cy:g,r:this._pointRadius}}return null},createCircle:function(i,e,k){var d=this;function j(n){var l=d.getPath("model.xVarID"),p=d.getPath("model.yVarID"),m={operation:"updateCases",cases:[],attributeIDs:[l,p],values:[[],[]]},o=d.get("dataContext");if(!o){return}d.getPath("model.casesController.selection").forEach(function(q){m.cases.push(q);m.values[0].push(q.getNumValue(l)+n.x);m.values[1].push(q.getNumValue(p)+n.y)});o.applyChange(m)}function b(q,m){var n=d.getPath("model.cases")[q],l=d.getPath("model.xVarID"),r=d.getPath("model.yVarID"),p=n.getNumValue(l)-m.x,o=n.getNumValue(r)-m.y;d.get("model").animateSelectionBackToStart([l,r],[p,o])}function f(){this.hoverAnimation=null}var c=false,g=1,h=null,a=this.get("paper").circle(-100,-100,this._pointRadius).attr({cursor:"pointer"}).addClass(DG.PlotUtilities.kColoredDotClassName).mousedown(function(l){d.get("model").selectCaseByIndex(e,l.shiftKey||l.metaKey)});a.index=e;a.node.setAttribute("shape-rendering","geometric-precision");return a},doDraw:function doDraw(){if(this.readyToDraw()){this.drawData();this.updateSelection()}},updateSelection:function(){if(SC.none(this.get("map"))){return}arguments.callee.base.apply(this,arguments)}});sc_require("views/raphael_base");DG.MapPointView=DG.RaphaelBaseView.extend({autoDestroyProperties:[],displayProperties:[],model:null,mapPointLayer:null,mapLayer:null,initLayerManager:function(){arguments.callee.base.apply(this,arguments);var a=DG.LayerNames;this.get("layerManager").addNamedLayer(a.kBackground).addNamedLayer(a.kPoints).addNamedLayer(a.kSelectedPoints).addNamedLayer(a.kDataTip)},init:function(){arguments.callee.base.apply(this,arguments);this.set("mapPointLayer",DG.MapPointLayer.create({paperSource:this,model:this.get("model"),mapSource:this}))},modelDidChange:function(){this.setPath("mapPointLayer.model",this.get("model"))}.observes("model"),shouldDraw:function(){return !SC.none(this.getPath("mapLayer.map"))},doDraw:function doDraw(){this.get("mapPointLayer").doDraw()}});DG.MapView=SC.View.extend({model:null,mapLayer:null,mapPointView:null,init:function(){arguments.callee.base.apply(this,arguments);this.set("mapLayer",DG.MapLayer.create({containerView:this}))},addPointLayer:function(){function b(d){return !SC.none(d[0][0],d[0][1],d[1][0],d[1][1])}var c=[10,10];this.set("mapPointView",DG.MapPointView.create({mapLayer:this.get("mapLayer")}));this.setPath("mapPointView.model",this.get("model"));this.appendChild(this.get("mapPointView"));var a=this.get("model").getLatLngBounds();if(b(a)){this.getPath("mapLayer.map").fitBounds(a,c)}},render:function(a,b){arguments.callee.base.apply(this,arguments);this.get("mapLayer").render(a,b)},didCreateLayer:function(){this.get("mapLayer").didCreateLayer()},viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.get("mapLayer").viewDidResize()}});sc_require("controllers/component_controller");DG.SliderController=DG.ComponentController.extend({sliderModel:null,axisModel:null,sliderView:null,axisView:null,valueAnimator:null,animationSign:1,isAnimating:function(){return !!this.getPath("valueAnimator.isAnimating")}.property("valueAnimator.isAnimating"),modelDidChange:function(){var a=this.getPath("model.content");this.set("sliderModel",a);if(a){this.set("axisModel",a.get("axis"))}}.observes("model"),viewDidChange:function(){var a=this.getPath("view.contentView");this.set("sliderView",a);this.set("axisView",a.get("axisView"));a.set("controller",this)}.observes("view","view.contentView"),toggleAnimation:function(){var a=this.get("valueAnimator");if(SC.none(a)){a=DG.ValueAnimator.create({valueHolder:this.get("sliderModel"),incrementProvider:this});this.set("valueAnimator",a)}if(a.get("isAnimating")){a.endAnimation();DG.logUser("sliderEndAnimation: %@",this.getPath("sliderModel.name"))}else{a.animate();DG.logUser("sliderBeginAnimation: %@",this.getPath("sliderModel.name"))}},stopAnimation:function(){var a=this.get("valueAnimator");if(a&&a.get("isAnimating")){a.endAnimation()}},increment:function(){var a=this.get("axisModel"),d=this.get("axisView"),e=d&&d.get("increment"),b=a&&a.get("lowerBound"),c=a&&a.get("upperBound"),f=this.getPath("sliderModel.value"),g=f+this.get("animationSign")*e;if(g>c){this.set("animationSign",-1);e=g-c}else{if(g<b){this.set("animationSign",1);e=b-g}}return this.animationSign*e}.property("axisView.increment","axisModel.lowerBound","axisModel.upperBound","sliderModel.value"),createComponentStorage:function(){var c={},b=this.get("sliderModel"),a=this.get("axisModel");if(b){this.addLink(c,"model",b);if(a){c.lowerBound=a.get("lowerBound");c.upperBound=a.get("upperBound")}}return c},restoreComponentStorage:function(a,e){var d=this.getPath("model.content");if(d){var f=this.getLinkID(a,"model");if(f){var c=DG.store.find(DG.GlobalValue,f);if(c){DG.globalsController.registerGlobalValue(c);d.set("content",c)}}var b=d.get("axis");if(b&&a.lowerBound&&a.upperBound){b.setLowerAndUpperBounds(a.lowerBound,a.upperBound)}}}});DG.SliderModel=SC.Object.extend({axis:null,content:null,id:null,idBinding:"*content.id",name:null,nameBinding:"*content.name",value:null,valueBinding:"*content.value",animator:null,init:function(){arguments.callee.base.apply(this,arguments);var a=DG.CellLinearAxisModel.create();a.setDataMinAndMax(0,10);this.set("axis",a)},destroy:function(){DG.globalsController.destroyGlobalValue(this.get("content"));arguments.callee.base.apply(this,arguments)},encompassValue:function(){var c=this.get("axis"),b=c.get("lowerBound"),f=c.get("upperBound"),g=this.get("value");if((g<b)||(g>f)){var a=b,e=f,d=[];if(g<b){a=g-(f-g)/10}else{e=g+(g-b)/10}if(SC.none(this.get("animator"))){this.set("animator",DG.GraphAnimator.create())}d.push({axis:c,newBounds:{lower:a,upper:e}});DG.sounds.playDrag();this.get("animator").set("axisInfoArray",d).animate()}},getGearMenuItems:function(){return[]},bringValueInBounds:function(){if(this.getPath("animator.isAnimating")){return}var b=this.get("axis"),a=b.get("lowerBound"),c=b.get("upperBound"),d=this.get("value");if(d<a){this.set("value",a)}else{if(d>c){this.set("value",c)}}}.observes(".axis.lowerBound",".axis.upperBound"),toLink:function(){var a=this.get("content");return a?a.toLink():null}});DG.SliderView=SC.View.extend((function(){var g=23,d=15,h=20,b=22,c=24,e=5,f,a=false;return{backgroundColor:"white",model:null,axisView:null,thumbView:null,startButton:null,valueView:null,userEdit:false,value:function(){return this.getPath("model.value")}.property("model.value").cacheable(),name:function(){return this.getPath("model.name")}.property("model.name").cacheable(),thumbCoord:function(){var j=this.get("value"),i=this.get("axisView");return(SC.none(j)||SC.none(i))?null:i.dataToCoordinate(j)}.property("value","axisView.model.lowerBound","axisView.model.upperBound"),init:function(){arguments.callee.base.apply(this,arguments);DG.assert(!SC.none(this.get("model")));this.set("axisView",DG.CellLinearAxisView.create({layout:{bottom:0,height:h},orientation:"horizontal",isDropTarget:false}));this.appendChild(this.axisView);this.setPath("axisView.model",this.getPath("model.axis"));this.set("thumbView",DG.ImageView.create({layout:{bottom:h,width:g,height:d},value:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/slider_thumb.png",classNames:"slider-thumb",toolTip:"DG.SliderView.thumbView.toolTip",localize:true,touchPriority:true}));this.appendChild(this.thumbView);this.set("startButton",DG.IconButton.create({layout:{top:0,width:c+2,height:b+2},iconExtent:{width:c,height:b},title:"",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/start.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/start_pushed.png",target:this,action:"toggleAnimation",toolTip:"DG.SliderView.startButton.toolTip",localize:true}));this.appendChild(this.startButton);this.set("valueView",SC.LabelView.create({layout:{left:c+e,top:3,bottom:h+d},classNames:"slider-label".w(),isEditable:true,inlineEditorWillBeginEditing:function(k,m,j){arguments.callee.base.apply(this,arguments);var i=this.get("frame"),o=4,l=5,n=DG.ViewUtilities.viewToWindowCoordinates({x:o,y:l-2},this);this.parentView.set("userEdit",true);k.set("exampleFrame",{x:n.x,y:n.y,width:i.width-2*o,height:i.height-2*l})}}));this.appendChild(this.valueView)},willDestroy:function(){var i=this.get("controller");if(i){i.stopAnimation()}},viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.positionThumb()},positionThumb:function(){var i=this.get("thumbCoord");if(DG.isFinite(i)){var j=this.get("thumbView");if(j){j.adjust("left",1+i-g/2)}}}.observes("thumbCoord"),updateValueView:function(){var n=this.get("axisView"),j=n.coordinateToData(1)-n.coordinateToData(0),i=Math.log(j)/Math.LN10,o=Math.ceil(-i),m=this.get("model"),l=SC.none(m)?"":m.get("name"),k=SC.none(m)?"":DG.Format.number().fractionDigits(0,o)(m.get("value"));this.setPath("valueView.value",l+" = "+k)}.observes("thumbCoord","name"),mouseDown:function(j){DG.globalEditorLock.commitCurrentEdit();var i=this.getPath("thumbView.frame");f={pagePoint:{x:j.pageX,y:j.pageY},viewPoint:DG.ViewUtilities.windowToViewCoordinates({x:j.pageX,y:j.pageY},this),thumbCoord:this.get("thumbCoord")};if(DG.ViewUtilities.ptInRect(f.viewPoint,i)){a=true;return YES}else{return NO}},mouseDragged:function(l){if(a){var j=l.pageX-f.pagePoint.x,i=f.thumbCoord+j,k=this.get("axisView").coordinateToData(i);this.setPath("model.value",k)}},mouseUp:function(){if(a){this.get("model").encompassValue();DG.logUser("sliderThumbDrag: { name: %@, newValue: %@ }",this.getPath("model.name"),this.getPath("model.value"))}a=false},touchStart:function(i){return this.mouseDown(i)},touchEnd:function(i){return this.mouseUp(i)},touchesDragged:function(i,j){return this.mouseDragged(i)},toggleAnimation:function(){var i=this.get("controller");if(i){i.toggleAnimation()}},isAnimatingDidChange:function(){var i=this.get("startButton");if(!this.getPath("controller.isAnimating")){i.set("iconName","/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/start.png");i.set("depressedIconName","/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/start_pushed.png")}else{i.set("iconName","/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/stop.png");i.set("depressedIconName","/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/stop_pushed.png")}}.observes("*controller.isAnimating"),valueViewWasEdited:function(){var j=/^\s*([a-zA-Z][\w]*)\s*=\s*([+\-]?[0-9.]+)/,l,k,m;if(this.get("userEdit")){var i=this.getPath("valueView.value");this.set("userEdit",false);l=j.exec(i);DG.logUser("sliderEdit: { expression: '%@', result: %@ }",i,!SC.none(l)?"success":"failure");if(!SC.none(l)){k=parseFloat(l[2]);m=l[1];this.setPathIfChanged("model.value",k);this.setPathIfChanged("model.name",m);this.get("model").encompassValue()}else{this.updateValueView()}}}.observes(".valueView.value")}}()));DG.FileImportView=SC.TextFieldView.extend({classNames:["dg-file-import-view"],applyImmediately:NO,type:"file",autoCorrect:NO,autoCapitalize:NO,hintOnFocus:NO,spellCheckEnabled:NO,shouldRenderBorder:NO,stateChangeAction:function(){if(this.action){this.action()}}.observes("isEditing"),files:function(){var a=this.$input().prop("files");console.log("files: "+a);return a}.property()});sc_require("controllers/component_controller");DG.TextComponentController=DG.ComponentController.extend({theText:"",createComponentStorage:function(){var a=this.get("theText"),b={};if(!SC.empty(a)){b.text=a}return b},restoreComponentStorage:function(b,c){var a=b.text||"";this.set("theText",a)},viewDidChange:function(){var a=this.getPath("view.containerView.contentView.editView");if(a){a.bind("value",this,"theText")}}.observes("view")});DG.TextFieldView=SC.TextFieldView.extend({beginEditing:function(){if(DG.globalEditorLock.isActive(this)){return arguments.callee.base.apply(this,arguments)}if(!DG.globalEditorLock.commitCurrentEdit()){return false}var b=this.get("value"),a=arguments.callee.base.apply(this,arguments);if(a){this._prevValue=b;DG.globalEditorLock.activate(this)}return a},commitEditing:function(){var a=arguments.callee.base.apply(this,arguments);if(a&&DG.globalEditorLock.isActive(this)){DG.globalEditorLock.deactivate(this)}return a},discardEditing:function(){this.set("value",this._prevValue||"");this.resignFirstResponder();if(DG.globalEditorLock.isActive(this)){DG.globalEditorLock.deactivate(this)}return true},completeEditing:function(){this.$input().blur()},commitCurrentEdit:function(){return this.commitEditing()},cancelCurrentEdit:function(){return this.discardEditing()},setSelection:function(c,b){if(SC.none(c)){return}var a=b||c;if(a<c){a=c}this.set("selection",SC.TextSelection.create({start:c,end:a}))},replaceSelectionWithString:function(c){var a=this.get("value"),i=this.get("selection"),e=i.get("start"),h=i.get("end"),d=a.substr(0,e),g=a.substr(h),f=d+c+g,b=e+c.length;this.set("value",f);if(!this.get("focused")){this._disableNextSelectRoot=true}this.setSelection(b)}});sc_require("views/text_field_view");DG.TextView=SC.View.extend({backgroundColor:"white",childViews:["editView"],editView:DG.TextFieldView.design({layout:{left:2,right:2,top:2,bottom:2},isEditable:true,isTextArea:true,commitEditing:function(){var a=arguments.callee.base.apply(this,arguments);DG.logUser("editTextObject: '%@'",this.get("value"));return a}}),defaultFirstResponder:function(){return this.get("editView")}.property()});DG.config=(function(){return{}}());DG.supportFuncs={caseTableHeaderMenus:function(){return true},docSavePermissions:function(){return DG.IS_INQUIRY_SPACE_BUILD}};DG.supports=function(b){var a=DG.supportFuncs[b];return a?a():false};DG.appController=SC.Object.create((function(){return{fileMenuPane:null,optionMenuPane:null,guideMenuPane:null,init:function(){arguments.callee.base.apply(this,arguments);this.fileMenuPane=SC.MenuPane.create({items:this.get("fileMenuItems"),layout:{width:165}});this.optionMenuPane=SC.MenuPane.create({items:this.get("optionMenuItems"),layout:{width:150}});this.guideMenuPane=SC.MenuPane.create({layout:{width:250}});window.onbeforeunload=function(a){if(DG.currDocumentController().get("hasUnsavedChanges")){return"DG.AppController.beforeUnload.confirmationMessage".loc()}}},_fileMenuIncludesDevItems:true,fileMenuItems:function(){var a=[{localize:true,title:"DG.AppController.fileMenuItems.openDocument",target:this,action:"openDocument",isEnabledBinding:"DG.authorizationController.isSaveEnabled"},{localize:true,title:"DG.AppController.fileMenuItems.saveDocument",target:this,action:"saveDocument",isEnabledBinding:"DG.authorizationController.isSaveEnabled"},{localize:true,title:"DG.AppController.fileMenuItems.closeDocument",target:this,action:"closeDocumentWithConfirmation"},{isSeparator:YES},{localize:true,title:"DG.AppController.fileMenuItems.documentManager",target:this,action:"loadManager",isEnabledBinding:"DG.authorizationController.isSaveEnabled"},{isSeparator:YES},{localize:true,title:"DG.AppController.fileMenuItems.exportCaseData",target:this,action:"exportCaseData"}],b=[{isSeparator:YES},{localize:true,title:"DG.AppController.fileMenuItems.importDocument",target:this,action:"importDocument"},{localize:true,title:"DG.AppController.fileMenuItems.exportDocument",target:this,action:"exportDocument"}];return this._fileMenuIncludesDevItems?a.concat(b):a}.property(),loginDidChange:function(){var a=DG.authorizationController.get("isUserDeveloper");this._fileMenuIncludesDevItems=this._fileMenuIncludesDevItems||a;this.fileMenuPane.set("items",this.get("fileMenuItems"))}.observes("DG.authorizationController.isUserDeveloper"),optionMenuItems:function(){return[{localize:true,title:"DG.AppController.optionMenuItems.help",target:this,action:"showHelp"},{localize:true,title:"DG.AppController.optionMenuItems.reportProblem",target:this,action:"reportProblem"},{localize:true,title:"DG.AppController.optionMenuItems.toWebSite",target:this,action:"showWebSite"},{isSeparator:YES},{localize:true,title:"DG.AppController.optionMenuItems.about",target:this,action:"showAbout"},{localize:true,title:"DG.AppController.optionMenuItems.releaseNotes",target:this,action:"showReleaseNotes"},{isSeparator:YES},{localize:true,title:"DG.AppController.optionMenuItems.configureGuide",target:this,action:"configureGuide"},{localize:true,title:"DG.AppController.optionMenuItems.viewWebPage",target:this,action:"viewWebPage"}]}.property(),openDocument:function(){this.openSaveDialog=DG.CreateOpenSaveDialog({dialogType:DG.OpenSaveDialog.kOpenDialog,prompt:"DG.AppController.openDocument.prompt",documentList:DG.DocumentListController.create(),okTitle:"DG.AppController.openDocument.okTitle",okTooltip:"DG.AppController.openDocument.okTooltip",okTarget:this,okAction:"openDocumentFromDialog"})},openDocumentFromDialog:function(){var d=this.openSaveDialog.get("documentName"),c=this.openSaveDialog.get("documentID");this.openSaveDialog.close();this.openSaveDialog=null;var b=function(){DG.authorizationController.openDocument(c,this);DG.logUser("openDocument: '%@'",d)}.bind(this);var a=function(){DG.logUser("cancelOpenDocument: '%@'",d)};if(!SC.empty(d)){if(DG.currDocumentController().get("hasUnsavedChanges")){DG.logUser("confirmOpenDocument?: '%@'",d);DG.AlertPane.warn({message:"DG.AppController.closeDocument.warnMessage",description:"DG.AppController.closeDocument.warnDescription",buttons:[{title:"DG.AppController.closeDocument.okButtonTitle",action:b,localize:YES},{title:"DG.AppController.closeDocument.cancelButtonTitle",action:a,localize:YES}],localize:YES})}else{b()}}},openDocumentNamed:function(b,a){if(b){DG.authorizationController.openDocumentByName(b,a,this);DG.logUser("openDocument: '%@'",b)}},receivedOpenDocumentResponse:function(c){var a=true,b=null;if(SC.ok(c)&&!c.get("isError")){if(this.openJsonDocument(c.get("body"))){a=false}}var d="DG.AppController.openDocument."+SC.json.decode(c.get("body")).message;if(d.loc()===d){d="DG.AppController.openDocument.error.general"}b=d;if(a){DG.AlertPane.error({localize:true,message:b,delegate:SC.Object.create({alertPaneDidDismiss:function(f,e){}})})}},isValidJsonDocument:function(a){return true},openJsonDocument:function(e){var f="DG.MemoryDataSource",b=f;if(!this.isValidJsonDocument(e)){return false}this.closeDocument();var a=SC.Store.create({}).from(b),c=DG.DocumentArchiver.create({}),d;DG.store=a;d=c.openDocument(a,e);if(d){a.document=d;DG.currDocumentController().setDocument(d)}return true},saveDocument:function(){this.openSaveDialog=DG.CreateOpenSaveDialog({dialogType:DG.OpenSaveDialog.kSaveDialog,prompt:"DG.AppController.saveDocument.prompt",documentNameValue:DG.currDocumentController().get("documentName"),documentPermissionValue:DG.currDocumentController().get("documentPermissions"),okTitle:"DG.AppController.saveDocument.okTitle",okTooltip:"DG.AppController.saveDocument.okTooltip",okTarget:this,okAction:"saveDocumentFromDialog"})},saveDocumentFromDialog:function(){var a=this.openSaveDialog.get("documentName"),b=this.openSaveDialog.get("documentPermissions");if(!SC.empty(a)){a=a.trim();DG.currDocumentController().set("documentName",a);DG.currDocumentController().saveDocument(a,b);DG.logUser("saveDocument: '%@'",a)}this.openSaveDialog.close();this.openSaveDialog=null},loadManager:function(){var a="http://"+DG.getDrupalSubdomain()+DG.authorizationController.getLoginCookieDomain()+("DG.AppController.manageDocumentsURL".loc());window.open(a,"document_manager")},logout:function(){var a=function(){this.closeDocument();DG.currDocumentController().setDocument(DG.currDocumentController().createDocument());DG.authorizationController.logout()}.bind(this);var b=function(){DG.logUser("cancelLogout:")};if(DG.currDocumentController().get("hasUnsavedChanges")){DG.logUser("confirmLogout?:");DG.AlertPane.warn({message:"DG.AppController.closeDocument.warnMessage",description:"DG.AppController.closeDocument.warnDescription",buttons:[{title:"DG.AppController.closeDocument.okButtonTitle",action:a,localize:YES},{title:"DG.AppController.closeDocument.cancelButtonTitle",action:b,localize:YES}],localize:YES})}else{a()}},closeDocument:function(){DG.mainPage.closeAllComponents();if(DG.store){DG.store.commitRecords()}DG.currDocumentController().closeDocument();DG.store=null},closeDocumentWithConfirmation:function(a){var c=DG.currDocumentController().get("documentName");var d=function(){this.closeAndNewDocument(a);DG.logUser("closeDocument: '%@'",c)}.bind(this);var b=function(){DG.logUser("cancelCloseDocument: '%@'",c)};if(DG.currDocumentController().get("hasUnsavedChanges")){DG.logUser("confirmCloseDocument?: '%@'",c);DG.AlertPane.warn({message:"DG.AppController.closeDocument.warnMessage",description:"DG.AppController.closeDocument.warnDescription",buttons:[{title:"DG.AppController.closeDocument.okButtonTitle",action:d,localize:YES},{title:"DG.AppController.closeDocument.cancelButtonTitle",action:b,localize:YES}],localize:YES})}else{d()}},closeAndNewDocument:function(a){this.closeDocument();DG.currDocumentController().setDocument(DG.currDocumentController().createDocument());DG.gameSelectionController.setDefaultGame(a);DG.mainPage.addGameIfNotPresent()},deleteAllCaseData:function(){function a(){DG.logUser("deleteAllCaseData by User");DG.currGameController.doDeleteAllCaseData()}DG.AlertPane.warn({message:"DG.AppController.resetData.warnMessage",description:"DG.AppController.resetData.warnDescription",buttons:[{title:"DG.AppController.resetData.okButtonTitle",action:a,localize:YES},{title:"DG.AppController.resetData.cancelButtonTitle",localize:YES}],localize:YES})},importDocument:function(){var c;var b=function(){function h(){console.log("Abort or error on file read.")}function f(){try{console.log("File read.");g.openJsonDocument(this.result);c.close()}catch(i){console.log(i);c.showAlert()}}var e=c.get("value");var d=new FileReader();var g=this;if(e[0]){d.onabort=h;d.onerror=h;d.onload=f;d.readAsText(e[0])}}.bind(this);var a=function(){c&&c.hideAlert()}.bind(this);c=DG.CreateFileImportDialog({prompt:"DG.AppController.importDocument.prompt",alert:"DG.AppController.importDocument.alert",textValue:"",textAction:a,okTarget:null,okAction:b,okTitle:"DG.AppController.importDocument.okTitle",okTooltip:"DG.AppController.importDocument.okTooltip"})},exportDocument:function(){var b=DG.currDocumentController().exportDocument(),c,d=null,a=function(){var f=d.value();var e=new Blob([c],{type:"application/json;charset=utf-8"});saveAs(e,f);d.close()};if(b){c=SC.json.encode(b);if(!SC.empty(c)){d=DG.CreateSingleTextDialog({prompt:"DG.AppController.exportDocument.prompt",textValue:b.name+".json",okTarget:null,okAction:a,okTitle:"DG.AppController.exportDocument.okTitle",okTooltip:"DG.AppController.exportDocument.okTooltip",cancelVisible:true})}}},exportCaseData:function(){var a=function(d){return DG.currDocumentController().exportCaseData(d)};var c=DG.currDocumentController().exportCaseData().split("\t"),b=c[0];DG.CreateExportCaseDataDialog({prompt:"DG.AppController.exportCaseData.prompt",textLimit:1000000,textValue:a(b),collectionMenuTitle:b,collectionMenuItems:c,collectionMenuItemAction:a,okTitle:"DG.AppController.exportDocument.okTitle",okTooltip:"DG.AppController.exportDocument.okTooltip"})},reportProblem:function(){var b=DG.authorizationController.getPath("currLogin.user");if(b==="guest"){b=""}var a="DataGames/WebPages/scripts/datagames.php"+"?device=%@&os=%@&os_version=%@&cf_browser=%@&cf_browser_version=%@&version=%@&name=%@".fmt(encodeURIComponent(SC.browser.device),encodeURIComponent(SC.browser.os),encodeURIComponent(SC.browser.osVersion),encodeURIComponent(SC.browser.name),encodeURIComponent(SC.browser.version),encodeURIComponent(DG.BUILD_NUM),encodeURIComponent(b));DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,a,"DG.AppController.reportProblem.dialogTitle".loc(),{centerX:0,centerY:0,width:600,height:400})},viewWebPage:function(){DG.currDocumentController().viewWebPage()},configureGuide:function(){DG.currDocumentController().configureGuide()},showReleaseNotes:function(){DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,"DG.AppController.showReleaseNotesURL".loc(),"DG.AppController.showReleaseNotesTitle".loc(),{centerX:0,centerY:0,width:600,height:400})},showAbout:function(){DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,"DG.AppController.showAboutURL".loc(),"DG.AppController.showAboutTitle".loc(),{centerX:0,centerY:0,width:770,height:400})},showHelp:function(){DG.currDocumentController().addWebView(DG.mainPage.get("docView"),null,"http://"+DG.getDrupalSubdomain()+DG.authorizationController.getLoginCookieDomain()+("DG.AppController.showHelpURL".loc()),"DG.AppController.showHelpTitle".loc(),{centerX:0,centerY:0,width:600,height:400})},showWebSite:function(){var a="http://"+DG.getDrupalSubdomain()+DG.authorizationController.getLoginCookieDomain()+("DG.AppController.showWebSiteURL".loc());window.open(a,"dg_website")}}}()));DG.Authorization=SC.Object.extend({user:"",passwd:"",status:0,failedLoginAttempt:false,statusMsg:function(){var b=!SC.empty(this.get("user"));var a=(this.get("status")!==0);if(b&&!a){return"<img src='/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/ajax-loader.gif'>"}if(this.failedLoginAttempt){var c=("DG.Authorization.loginPane."+this.get("errorCode"));if(c.loc()===c){c="DG.Authorization.loginPane.error.general"}return c.loc()}return""}.property("user","status"),isValid:function(){var b=!SC.empty(this.get("user"));var a=(this.get("status")!==0);return b&&a}.property("user","status"),sessionID:0,isSaveEnabled:false,isLoggingEnabled:false,logIndex:0,clear:function(){this.set("user","");this.set("passwd","");this.set("status",0);this.set("sessionID",0);this.set("isSaveEnabled",false);this.set("isLoggingEnabled",false);return this}});sc_require("models/authorization_model");DG.logToServer=function(a,c,b){DG.authorizationController.logToServer(a,c,b)};DG.authorizationController=SC.Controller.create((function(){var a=function(b){return"/api/"+b};return{currEdit:null,currLogin:null,isValid:function(){return this.getPath("currLogin.isValid")}.property("currLogin.isValid"),isSaveEnabled:function(){return this.getPath("currLogin.isSaveEnabled")}.property("currLogin.isSaveEnabled"),isUserDeveloper:function(){return true}.property("currLogin.privileges"),init:function(){arguments.callee.base.apply(this,arguments);this.set("currEdit",DG.Authorization.create({user:"",passwd:""}));this.set("currLogin",DG.Authorization.create({}));if(DG.Browser.isCompatibleBrowser()){this.loadLoginCookie()}},getServerUrl:function(b){return SC.Request.getUrl(a(b))},postServerUrl:function(b){return SC.Request.postUrl(a(b))},postServerUrlJSON:function(b){return this.postServerUrl(b).json()},sendLoginAsGuestRequest:function(){this.setPath("currLogin.user","guest");this.logIn({enableLogging:false,enableSave:false,privileges:0,sessiontoken:"guestSession",useCookie:false,valid:true},200)},sendLoginRequestFromDialog:function(){this.sendLoginRequest(this.getPath("currEdit.user"),this.getPath("currEdit.passwd"))},sendLoginRequest:function(c,e,d){if(!SC.empty(c)){this.setPath("currLogin.user",c);this.setPath("currLogin.failedLoginAttempt",false);var b={username:c,password:e,sessiontoken:d};if(d){this.get("currLogin").set("sessionID",d)}this.postServerUrlJSON("auth/login").notify(this,"receiveLoginResponse").send(b)}},sendTokenRequest:function(c,e,d){this.setPath("currLogin.user",c);var b={username:c,phrase:e,pass:d};this.postServerUrlJSON("auth/login").notify(this,"receiveLoginResponse").send(b)},sendLogoutRequest:function(c,d){if(!SC.empty(c)){var b={username:c,sessiontoken:d};this.postServerUrlJSON("auth/logout").send(b)}},cookie:null,saveLoginCookie:function(){this.cookie=this.findLoginCookie()||SC.Cookie.create({name:"login",value:"",domain:this.getLoginCookieDomain()});var b=this.get("currLogin"),d=[b.get("user"),b.get("status"),b.get("sessionID"),b.get("logIndex"),b.get("isLoggingEnabled")].join("\t");this.cookie.set("value",d);this.cookie.write()},loadLoginCookie:function(){var e=this.get("currLogin"),b=this.get("currEdit");this.cookie=this.findLoginCookie();if(this.cookie){var g=this.cookie.get("value").split("\t"),d=g[0],f=g[2];e.beginPropertyChanges();e.set("user",d);e.set("status",0);e.endPropertyChanges();if(b){b.beginPropertyChanges();b.set("user",d);b.set("sessionID",f);b.endPropertyChanges()}}},findLoginCookie:function(){if(!SC.empty(this.cookie)){return this.cookie}this.cookie=SC.Cookie.find("login");if(!SC.empty(this.cookie)){this.cookie.domain=this.getLoginCookieDomain()}return this.cookie},getLoginCookieDomain:function(){var c=document.domain.indexOf("."),b=c>=0?document.domain.slice(c+1):document.domain;if(b.indexOf("localhost")>=0){return""}return b},_documentPath:function(c){var b=c;if(!/^:/.test(b)){b=":"+this.getPath("currLogin.user")+":"+c}return b},_documentUrl:function(c){var b=a("document");b+="/"+encodeURIComponent(this.getPath("currLogin.sessionID"));b+="/"+encodeURIComponent(this._documentPath(c));return b},saveDocument:function(e,b,d){var c="document/save?username=%@&sessiontoken=%@&recordname=%@".fmt(this.getPath("currLogin.user"),this.getPath("currLogin.sessionID"),e);this.postServerUrlJSON(c).notify(d,"receivedSaveDocumentResponse").send(b)},documentList:function(c){var b="document/all";b+="?username="+this.getPath("currLogin.user");b+="&sessiontoken="+encodeURIComponent(this.getPath("currLogin.sessionID"));this.getServerUrl(b).notify(c,"receivedDocumentListResponse").send()},openDocument:function(d,c){var b="document/open";b+="?username="+this.getPath("currLogin.user");b+="&sessiontoken="+this.getPath("currLogin.sessionID");b+="&recordid="+d;this.getServerUrl(b).notify(c,"receivedOpenDocumentResponse").send()},openDocumentByName:function(b,e,d){var c="document/open";c+="?username="+this.getPath("currLogin.user");c+="&sessiontoken="+this.getPath("currLogin.sessionID");c+="&recordname="+b;c+="&owner="+e;this.getServerUrl(c).notify(d,"receivedOpenDocumentResponse").send()},logout:function(){this.sendLogoutRequest(this.getPath("currLogin.user"),this.getPath("currLogin.sessionID"));DG.logUser("Logout: %@",this.getPath("currLogin.user"),{force:true});this.get("currEdit").clear();this.get("currLogin").clear();this.saveLoginCookie();this.requireLogin()},logIn:function(b,c){var i=this.get("currLogin"),h=b.valid,g=b.sessiontoken,d=b.enableLogging,f=b.enableSave,e=b.privileges;if(h&&i){if(this.sheetPane){this.sheetPane.remove();this.sheetPane=null}i.beginPropertyChanges();i.set("status",c);if(g){i.set("sessionID",g)}i.set("isLoggingEnabled",d);i.set("isSaveEnabled",f);i.set("privileges",e);i.set("logIndex",0);i.endPropertyChanges();if(b.useCookie){this.saveLoginCookie()}DG.logUser("Login: %@",i.get("user"),{force:true});return}},receiveLoginResponse:function(f){var e=this.get("currLogin"),c,b;if(SC.ok(f)){c=f.get("status");b=f.get("body");return this.logIn(b,c)}else{var d=(b&&b.message)||"";e.clear().set("errorCode",d).set("failedLoginAttempt",true)}},logToServer:function(d,c,b){},requireLogin:function(){var d=2;var h=0;var i=0;var g=function(l){h+=(i+l);return h};var f=function(l){i=l;return i};var b=this.get("currLogin"),k=this.get("currEdit"),j=b&&b.get("isValid");if(j){return}if(!DG.Browser.isCompatibleBrowser()){return}if(this.sheetPane){return}var e=k&&k.get("user"),c=k&&k.get("sessionID");if(!SC.empty(e)&&c){this.sendLoginRequest(e,null,c)}this.sheetPane=SC.PanelPane.create({layout:{top:0,centerX:0,width:340,height:200},contentView:SC.View.extend({childViews:"labelView userLabel userText passwordLabel passwordText loginAsGuestButton loginButton statusLabel registerLink recoveryLink".w(),labelView:SC.LabelView.design({layout:{top:g(0),left:0,right:0,height:f(24)},controlSize:SC.LARGE_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,textAlign:SC.ALIGN_CENTER,value:"DG.Authorization.loginPane.dialogTitle",localize:YES}),userLabel:SC.LabelView.design({layout:{top:g(d),left:0,right:0,height:f(18)},textAlign:SC.ALIGN_CENTER,value:"DG.Authorization.loginPane.userLabel",localize:YES}),userText:SC.TextFieldView.design({layout:{top:g(d),centerX:0,width:200,height:f(20)},autoCorrect:false,autoCapitalize:false,valueBinding:"DG.authorizationController.currEdit.user"}),passwordLabel:SC.LabelView.design({layout:{top:g(d),left:0,right:0,height:f(18)},textAlign:SC.ALIGN_CENTER,value:"DG.Authorization.loginPane.passwordLabel",localize:YES}),passwordText:SC.TextFieldView.design({layout:{top:g(d),centerX:0,height:f(20),width:200},type:"password",autoCorrect:false,autoCapitalize:false,valueBinding:"DG.authorizationController.currEdit.passwd"}),loginAsGuestButton:SC.ButtonView.design({layout:{top:g(6*d),height:f(24),left:20,width:125},title:"DG.Authorization.loginPane.loginAsGuest",localize:YES,target:"DG.authorizationController",action:"sendLoginAsGuestRequest",isDefault:NO}),loginButton:SC.ButtonView.design({layout:{top:h,height:f(24),right:20,width:100},title:"DG.Authorization.loginPane.login",localize:YES,target:"DG.authorizationController",action:"sendLoginRequestFromDialog",isDefault:YES}),statusLabel:SC.LabelView.design({escapeHTML:NO,layout:{top:g(d),left:0,right:0,height:f(18)},textAlign:SC.ALIGN_CENTER,valueBinding:"DG.authorizationController.currLogin.statusMsg"}),registerLink:SC.StaticContentView.design({layout:{top:g(d),left:20,height:18},textAlign:SC.ALIGN_CENTER,content:DG.getVariantString("DG.Authorization.loginPane.registerLink").loc(DG.getDrupalSubdomain()+this.getLoginCookieDomain())}),recoveryLink:SC.StaticContentView.design({layout:{top:148,left:200,height:18},textAlign:SC.ALIGN_CENTER,content:DG.getVariantString("DG.Authorization.loginPane.recoveryLink").loc(DG.getDrupalSubdomain()+this.getLoginCookieDomain())})})});this.sheetPane.append();this.sheetPane.contentView.userText.becomeFirstResponder()},_loginSessionDidChange:function(){if(this.get("isValid")){this.invokeLater(this._setupGameOrDocument)}}.observes(".currLogin.status"),_setupGameOrDocument:function(){if(!SC.empty(DG.startingDocName)){var b=!SC.empty(DG.startingDocOwner)?DG.startingDocOwner:DG.iUser;DG.appController.openDocumentNamed(DG.startingDocName,b);DG.startingDocName=""}else{DG.gameSelectionController.setDefaultGame();DG.mainPage.addGameIfNotPresent()}if(SC.browser.name===SC.BROWSER.firefox){var c=DG.mainPage.mainPane.scrollView;if(c){this.invokeLater(function(){c.layoutDidChange()},10)}}}}})());DG.CollectionClient=SC.Object.extend({collection:null,id:function(){return this.getPath("collection.collectionRecord.id")}.property("collection").cacheable(),name:function(){return this.getPath("collection.collectionRecord.name")}.property("collection").cacheable(),attrsController:null,casesController:null,attrFormulaChanges:0,attrFormulaDependentChanges:0,hasAggregates:function(){var c=this.attrsController.get("length");for(var b=0;b<c;++b){var a=this.attrsController.objectAt(b);if(a&&a.getPath("_dgFormula.hasAggregates")){return true}}return false}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.attrsController=SC.ArrayController.create({});this.casesController=SC.ArrayController.create({})},destroy:function(){this.attrsController.forEach(function(a){if(a){this.willDestroyAttribute(a)}});arguments.callee.base.apply(this,arguments)},areParentChildLinksConfigured:function(){return this.getPath("collection.areParentChildLinksConfigured")}.property("collection.areParentChildLinksConfigured").cacheable(),setParentCollection:function(c){var a=this.getPath("collection.collectionRecord"),b=c.getPath("collection.collectionRecord");if(a&&b){a.set("parent",b);a.set("areParentChildLinksConfigured",true);b.set("areParentChildLinksConfigured",true);DG.store.commitRecords()}},isAncestorOf:function(a){var b=this.get("collection");return b&&b.isAncestorOf(a.get("collection"))},isDescendantOf:function(a){var b=this.get("collection");return b&&b.isDescendantOf(a.get("collection"))},setTargetCollection:function(a){this.collection=a;this.attrsController.set("content",a.attrsRecords);this.casesController.set("content",a.casesRecords);this.forEachAttribute(function(b){this.didCreateAttribute(b)}.bind(this))},getAttributeIDs:function(){return this.attrsController.getEach("id")},getAttributeNames:function(){return this.attrsController.getEach("name")},getAttributeCount:function(){return this.attrsController.get("length")},getAttributeAt:function(a){return this.attrsController.objectAt(a)},getAttributeByID:function(a){return !SC.none(a)?this.attrsController.findProperty("id",a):undefined},getAttributeByName:function(a){return !SC.empty(a)?this.attrsController.findProperty("name",a):undefined},getAttributeIndexByName:function(a){var b=this.getAttributeNames();return b.indexOf(a)},hasAttribute:function(a){return this.getAttributeIndexByName(a)>=0},createAttribute:function(b){var a=this.collection.createAttribute(b||{});if(a){this.didCreateAttribute(a)}return a},didCreateAttribute:function(a){a.addObserver("dependentChange",this,"attrFormulaDependentDidChange")},willDestroyAttribute:function(a){a.removeObserver("dependentChange",this,"attrFormulaDependentDidChange")},guaranteeAttribute:function(c){var a=null;function d(){var e=c.name||"",g=/\((.*)\)/,f=g.exec(e);if(f&&f.length>1){c.unit=f[1];e=e.replace(g,"")}e=e.replace(/\W$/,"");e=e.replace(/\W/g,"_");c.name=e}c=c||{};d();if(!SC.empty(c.name)){a=this.getAttributeByName(c.name);if(a){if(c.formula!==undefined){if(a.get("editable")||a.get("hasFormula")){this.setAttributeFormula(a,c.formula)}else{var b=a.get("name");DG.AlertPane.error({message:"DG.CollectionClient.cantEditFormulaErrorMsg".loc(b),description:"DG.CollectionClient.cantEditFormulaErrorDesc".loc(),localize:false})}}if(!SC.none(c.colormap)){a.set("colormap",SC.clone(c.colormap))}if(!SC.none(c.editable)){a.set("colormap",c.editable)}}else{a=this.createAttribute(c)}}return a},setAttributeFormula:function(c,b){var f=c&&c.get("id"),e=c.get("hasFormula"),a=!SC.empty(b),g=e&&!a,d=[];if(g){this.forEachAttributeValue(f,function(h){d.push(h)})}c.set("formula",b);if(g){this.setAttributeValuesFromArray(f,d);if(!c.get("editable")){c.set("editable",true)}}this.attributeFormulaDidChange()},forEachAttribute:function(a){this.attrsController.forEach(a);return this},getCaseIDs:function(){return this.casesController.getEach("id")},getCaseCount:function(){return this.casesController.get("length")},getCaseAt:function(a){return this.casesController.objectAt(a)},isCaseSelected:function(b){var a=this.getPath("casesController.selection");return b&&a?a.contains(b):false},isCaseAtIndexSelected:function(c){var b=this.getCaseAt(c),a=this.getPath("casesController.selection");return b&&a?a.contains(b):false},createCase:function(a){return this.collection.createCase(a||{})},attributeFormulaDidChange:function(){this.incrementProperty("attrFormulaChanges")},attrFormulaDependentDidChange:function(){this.incrementProperty("attrFormulaDependentChanges")},forEachCase:function(a){this.casesController.forEach(a);return this},forEachAttributeValue:function(a,c){var b=this.getPath("casesController.arrangedObjects");b.forEach(function(e){var d=e.getValue(a);c(d)});return this},setCaseValuesFromArray:function(d,b){var a=this.getAttributeIDs(),f=a.length,h=b?b.length:0,c,e=f<h?f:h,g;d.beginCaseValueChanges();for(c=0;c<e;++c){g=DG.DataUtilities.canonicalizeInputValue(b[c]);if(g!==undefined){d.setValue(a[c],g)}}d.endCaseValueChanges()},setAttributeValuesFromArray:function(b,a){var c=this.getPath("casesController.arrangedObjects");c.forEach(function(d,e){if(e<a.length){d.setValue(b,a[e])}})},deleteCase:function(a){this.get("collection").deleteCase(a)},didDeleteCases:function(){DG.store.commitRecords();this.get("collection").updateCaseIDToIndexMap();this.getPath("casesController.content").refresh()},deleteSelectedCases:function(){var b=this.get("collection"),a=this.getPath("casesController.selection");DG.logUser("deleteSelectedCases: %@",a.length());a.forEach(function(c){b.deleteCase(c)});this.didDeleteCases()},deleteAllCases:function(){var a=this.get("collection"),b=this.get("casesController");b.forEach(function(c){a.deleteCase(c)});this.didDeleteCases()},toLink:function(){var a=this.getPath("collection.collectionRecord");return a&&a.toLink()},debugLog:function(a){this.get("collection").debugLog(a)}});DG.DataContext=SC.Object.extend((function(){return{type:"DG.DataContext",model:null,changeCount:0,selectionChangeCount:0,changes:null,id:function(){return this.getPath("model.id")}.property("model","model.id"),collections:function(){return this.getPath("model.collections")}.property("model","model.collections"),_collectionClients:null,init:function(){arguments.callee.base.apply(this,arguments);this._collectionClients={};this.changes=[]},destroy:function(){var b,a=this.get("collectionCount");for(b=0;b<a;++b){var c=this.getCollectionAtIndex(b);if(c){this.willRemoveCollection(c)}}arguments.callee.base.apply(this,arguments)},getSelectedCases:function(){var d,b=this.get("collectionCount"),e=[];function c(g){e.push(g)}for(d=0;d<b;++d){var f=this.getCollectionAtIndex(d),a=f&&f.getPath("casesController.selection");if(a){a.forEach(c)}}return e},_changeCount:0,_prevChangeCount:0,lastChange:function(){var a=this.changes.length;return a>0?this.changes[a-1]:null}.property(),newChanges:function(){var a=this.changes&&this.changes.length,b=this._changeCount-this._prevChangeCount;DG.assert(this._changeCount<=a);DG.assert(this._prevChangeCount<=this._changeCount);return this.changes.slice(a-b)}.property(),applyChange:function(a){a.result=this.performChange(a);this.changes.push(a);++this._changeCount;this.invokeLast(function(){this.set("changeCount",this._changeCount);this._prevChangeCount=this._changeCount}.bind(this));return a.result},performChange:function(b){if(b.isComplete){return{success:true}}var a={success:false};switch(b.operation){case"createCollection":a=this.doCreateCollection(b);break;case"createCase":b.values=[b.values||[]];a=this.doCreateCases(b);if(a.caseIDs&&a.caseIDs.length){a.caseID=a.caseIDs[0]}break;case"createCases":a=this.doCreateCases(b);break;case"updateCases":a=this.doUpdateCases(b);break;case"deleteCases":a=this.doDeleteCases(b);break;case"selectCases":a=this.doSelectCases(b);break;case"createAttributes":a=this.doCreateAttributes(b);break;case"updateAttributes":a=this.doUpdateAttributes(b);break;case"deleteAttributes":a=this.doDeleteAttributes(b);break}return a},doCreateCollection:function(b){var a=this.guaranteeCollection(b.properties);if(a){b.attributes.forEach(function(c){a.guaranteeAttribute(c)});DG.store.flush();return{success:true,collection:a}}return{success:false}},doCreateCases:function(d){if(!d.collection){d.collection=this.get("childCollection")}var e=d.collection,b={success:false,caseIDs:[]};if(e){var a=function(f){var g=e.createCase(d.properties);if(g){if(!SC.none(f)){e.setCaseValuesFromArray(g,f);DG.store.commitRecords()}b.success=true;b.caseIDs.push(g.get("id"))}}.bind(this);var c=d.values||[[]];c.forEach(a);if(b.caseIDs&&(b.caseIDs.length>0)){b.caseID=b.caseIDs[0]}}return b},doSelectCases:function(k){var a=k.collection||this.get("childCollection"),l=a&&a.get("casesController"),i=k.extend||false,c={},f=false,g=this;function e(m){var n=m.get("id").toString();if(c[n]===undefined){c[n]=true;return i}return true}function j(o){var n=o.get("children"),p=g.getCollectionForCase(o),q=p&&p.get("casesController");if(q){var m=q.get("selection");if(m&&!m.contains(o)){f=true}q.selectObject(o,e(p));n.forEach(j)}}function b(o){var n=o.get("children"),p=g.getCollectionForCase(o),q=p&&p.get("casesController");if(q){var m=q.get("selection");if(m&&m.contains(o)){f=true}q.deselectObject(o);n.forEach(b)}}var d=k.cases||l,h=k.select?j:b;if(d&&h){d.forEach(h)}if(f){this.forEachCollection(function(n){var m=n.get("id"),o=n.get("casesController");if(m&&o&&!e(n)){o.selectObject()}});this.incrementProperty("selectionChangeCount")}return{success:true}},doUpdateCases:function(j){var d=j.cases.get("length"),e=j.attributeIDs?j.attributeIDs.get("length"):0,h=j.values.get("length"),l=[],i,g;if((d>0)&&(e===0)&&(h>0)){j.cases.forEach(function(a,c){if(a&&!a.get("isDestroyed")){this.setCaseValuesFromArray(a,j.values[c],j.collection)}}.bind(this));return{success:true}}j.caseIDs=[];for(i=0;i<e;++i){var k=j.attributeIDs.objectAt(i),f=this.getAttrRefByID(k);f.attributeID=k;l.push(f)}for(g=0;g<d;++g){var b=j.cases.objectAt(g);j.caseIDs.push(b.get("id"));b.beginCaseValueChanges();for(i=0;i<e;++i){b.setValue(l[i].attributeID,j.values[i][g])}b.endCaseValueChanges()}return{success:true}},doDeleteCases:function(b){b.ids=[];b.collectionIDs={};var a=function(d){var c=d.get("children");if(c&&c.length){c.forEach(a)}b.ids.push(d.get("id"));var e=this.getCollectionForCase(d);e.deleteCase(d);b.collectionIDs[e.get("id")]=e}.bind(this);b.cases.forEach(a);DG.ObjectMap.forEach(b.collectionIDs,function(d,c){if(c){c.didDeleteCases()}});return{success:true}},doCreateAttributes:function(c){var d=typeof c.collection==="string"?this.getCollectionByName(c.collection):c.collection,b=false,a={success:false,attrs:[],attrIDs:[]};function e(g){var f=d.hasAttribute(g.name),i=DG.copy(g),h;if(!f){i.editable=true}h=d.guaranteeAttribute(i);if(h){if(!f){b=true}a.success=true;a.attrs.push(h);a.attrIDs.push(h.get("id"))}}if(d&&c.attrPropsArray){c.attrPropsArray.forEach(e)}if(!b){c.operation="updateAttributes"}return a},doUpdateAttributes:function(c){var d=typeof c.collection==="string"?this.getCollectionByName(c.collection):c.collection,a={success:false,attrs:[],attrIDs:[]};function b(e){var f=d&&!SC.none(e.id)?d.getAttributeByID(e.id):null;if(!f&&d&&e.name){f=d.getAttributeByName(e.name)}if(f){f.beginPropertyChanges();DG.ObjectMap.forEach(e,function(g,h){if(g!=="id"){f.set(g,h)}});f.endPropertyChanges();a.success=true;a.attrs.push(f);a.attrIDs.push(f.get("id"))}}if(d&&c.attrPropsArray){c.attrPropsArray.forEach(b)}return a},doDeleteAttributes:function(b){var c=typeof b.collection==="string"?this.getCollectionByName(b.collection):b.collection,a={success:false,attrIDs:[]};function d(e){var f=c&&!SC.none(e.id)?c.getAttributeByID(e.id):null;if(f){DG.Attribute.destroyAttribute(e.attribute);a.attrIDs.push(e.id)}}if(c&&b.attrs){b.attrs.forEach(d);DG.store.commitRecords()}return a},exportCaseData:function(d){var h=this.get("childCollection"),g=this.get("parentCollection"),l=h&&h.get("name"),a=g&&g.get("name"),c=(a+"+"+l),k="\t",m="\r\n";DG.assert(h&&g,"exportCaseData collections not found");if(!(h&&g)){return("")}if(SC.empty(d)){return a+k+l+k+(a+"+"+l)}var f=((d===a)?g:h),j=((d===c)?g:null),b=f&&f.getAttributeNames(),i=f&&f.getAttributeIDs(),e;if(j){b=j.getAttributeNames().concat(b);i=j.getAttributeIDs().concat(i)}e=b.join(k)+m;f.forEachCase(function(n,o){var p="";i.forEach(function(r){var q=n.getValue(r);if(p.length>0){p+=k}if(!SC.empty(q)){p+=q.toString()}});e+=p+m});return e},createContextModel:function(b){if(!b){b={}}if(SC.empty(b.type)){b.type=this.get("type")||"DG.DataContext"}var a=DG.DataContextRecord.create(b);this.set("model",a);return a},collectionCount:function(){return this.getPath("collections.length")||0}.property(),childCollection:function(){var a=this.get("collectionCount");return(a?this.getCollectionAtIndex(a-1):null)}.property("_collectionClients","_collectionClients.[]"),parentCollection:function(){var a=this.get("collectionCount");return(a?this.getCollectionAtIndex(a-2):null)}.property("_collectionClients","_collectionClients.[]"),getCollectionAtIndex:function(c){var d=this.get("collections"),b=this.get("collectionCount"),a=(d&&(b>c)&&d.objectAt(c))||null;return a&&this._collectionClients[a.get("id")]},getCollectionByName:function(c){var b=this.get("collectionCount"),e=this.get("collections"),a;for(var d=0;d<b;++d){a=e.objectAt(d);if(a&&(a.get("name")===c)){return this._collectionClients[a.get("id")]}}return null},getCollectionByID:function(a){return this._collectionClients[a]||null},getCollectionForCase:function(a){return this.getCollectionByID(a.getPath("collection.id"))},getCollectionForAttribute:function(a){return this.getCollectionByID(a.getPath("collection.id"))},getParentCollection:function(c){var e=c&&c.get("id"),d=this.get("collectionCount"),h=this.get("collections"),b,g,a=null;for(var f=0;f<d;++f){b=h.objectAt(f);g=b.get("id");if(b&&(g===e)){return this.getCollectionByID(a)}a=g}return null},getChildCollection:function(c){var e=c&&c.get("id"),d=this.get("collectionCount"),h=this.get("collections"),b,g,a=null;for(var f=d-1;f>=0;--f){b=h.objectAt(f);g=b.get("id");if(b&&(g===e)){return this.getCollectionByID(a)}a=g}return null},createCollection:function(c){var a=this.get("model").createCollection(c||{}),b=this.addCollection(a);DG.store.commitRecords();this.didCreateCollection(b);return b},didCreateCollection:function(a){},guaranteeCollection:function(b){var a=this.getCollectionByName(b.name);if(!a){a=this.createCollection(b)}return a},addCollection:function(b){var a=b&&b.get("id"),d=a&&DG.Collection.create({collectionRecord:b}),c=d&&DG.CollectionClient.create({});if(c&&d&&a){c.setTargetCollection(d);this._collectionClients[c.get("id")]=c;this.didAddCollection(c)}return c},didAddCollection:function(a){a.addObserver("attrFormulaChanges",this,"attrFormulaDidChange")},willRemoveCollection:function(a){a.removeObserver("attrFormulaChanges",this,"attrFormulaDidChange")},attrFormulaDidChange:function(a){var b={operation:"updateCases",collection:a,isComplete:true};this.applyChange(b)},forEachCollection:function(b){var c=this,a=this.get("collections");a.forEach(function(f){var e=f.get("id"),d=c.getCollectionByID(e);if(d){b(d)}});return this},getCaseNameForCount:function(a,b){return b===1?"DG.DataContext.singleCaseName".loc():"DG.DataContext.pluralCaseName".loc()},getCaseCountString:function(a,c){var b=this.getCaseNameForCount(a,c);return"DG.DataContext.caseCountString".loc(c,b)},getLabelForSetOfCases:function(a){return"DG.DataContext.setOfCasesLabel".loc()},getAttrRefByID:function(b){var d=this.get("collectionCount"),g=this.get("collections");for(var e=d-1;e>=0;--e){var c=g.objectAt(e),a=c&&this._collectionClients[c.get("id")],f=a&&a.getAttributeByID(b);if(f){return{collection:a,attribute:f}}}return null},getAttrRefByName:function(d){var c=this.get("collectionCount"),g=this.get("collections");for(var e=c-1;e>=0;--e){var b=g.objectAt(e),a=b&&this._collectionClients[b.get("id")],f=a&&a.getAttributeByName(d);if(f){return{collection:a,attribute:f}}}return null},getAttributeByName:function(a){var b=this.getAttrRefByName(a);return b?b.attribute:null},setCaseValuesFromArray:function(c,a,b){var d=b||this.getCollectionForCase(c);if(d){d.setCaseValuesFromArray(c,a)}},collectionDefaults:function(){var a={collectionClient:this.get("childCollection"),parentCollectionClient:this.get("parentCollection"),plotXAttr:null,plotXAttrIsNumeric:true,plotYAttr:null,plotYAttrIsNumeric:true};return a},willSaveContext:function(){var a=this.get("model");if(a){var b=this.createStorage()||{};a.set("contextStorage",b)}},toLink:function(){var a=this.get("model");return a&&a.toLink()},createStorage:function(){return{}},restoreFromStorage:function(b){var a=this.get("collections"),c=this;if(!SC.none(a)){a.forEach(function(d){c.addCollection(d)})}}}}()));DG.DataContext.registry={};DG.DataContext.registry["DG.DataContext"]=function(a){return DG.DataContext.create(a)};DG.DataContext._contextMap={};DG.DataContext.clearContextMap=function(a){DG.DataContext._contextMap={}};DG.DataContext.storeContextInMap=function(c,b){if(b){var a=b.get("id");if(!SC.none(a)){DG.DataContext._contextMap[a]=b}}};DG.DataContext.retrieveContextFromMap=function(b,a){return DG.DataContext._contextMap[a]};DG.DataContext.forEachContextInMap=function(b,a){DG.ObjectMap.forEach(DG.DataContext._contextMap,a)};DG.DataContext.getContextFromCollection=function(d){var b=d&&d.getPath("collection.collectionRecord"),a=b&&b.getPath("context.id"),c=a&&DG.DataContext.retrieveContextFromMap(null,a);return c};DG.DataContext.factory=function(d){var b=d&&d.type,c=b&&DG.DataContext.registry[b],a=c?c(d):DG.DataContext.create(d);if(a){DG.DataContext.storeContextInMap(a.getPath("model.document.id"),a)}return a};DG.DocumentArchiver=SC.Object.extend({addRecord:function(b,c,d){var f=DG.Record.recordTypeFromString(b),e=c.guid;if(!this._records){this._records=[]}if(!this._records[b]){this._records[b]={type:f,idMap:{},array:[]}}var a=this._records[b];a.idMap[e]=c;a.array.push(c);if(!SC.none(d)){if(!a.serverIDMap){a.serverIDMap={}}a.serverIDMap[d.toString()]=e}},getRecord:function(b,a){return this._records&&this._records[b]&&this._records[b].idMap[a]},loadRecordsIntoStore:function(a){var b=a._getDataSource();DG.ObjectMap.forEach(this._records,function(d,c){b.loadRecords(c.type,c.array);a.loadRecords(c.type,c.array)});a.find(DG.Attribute).forEach(function(c){c.didLoadRecord()});a.find(DG.Case).forEach(function(c){c.didLoadRecord()})},clientIDFromServerID:function(b,d){if(SC.empty(b)||SC.none(d)){return null}var a=this._records&&this._records[b],c=a&&a.serverIDMap,e=c&&c[d.toString()];return e},recordFromClientID:function(c,d){if(!c||!d){return null}var b=this._records&&this._records[c],a=b&&b.idMap&&b.idMap[d];return a},restoreObject:function(c,f,g){var b=!SC.none(g.guid)?g.guid:undefined,d=c.assignIDForNewRecord(f,g);this.addRecord(f,g,b);var a=function(i,m,l){if(m.isOwner){var o=g[i]||[],j=[];g[i]=j;o.forEach(function(q){this.restoreObject(c,m.type,q);q[m.inverse]=d;j.push(q.guid)}.bind(this))}else{if(m.isMaster){g[i]=SC.instanceOf(m,SC.ManyAttribute)?[]:null}else{if(l.isMaster&&!l.isOwner){var p=m.type,k=g[i],n=this.clientIDFromServerID(p,k);if(n){var h=this.recordFromClientID(p,n);g[i]=n;if(h){if(SC.instanceOf(l,SC.ManyAttribute)){if(!h[m.inverse]){h[m.inverse]=[]}h[m.inverse].push(g.guid)}else{h[m.inverse]=g.guid}}else{DG.logWarn("DG.DocumentArchiver.restoreObject.processRelation failed to find linked parent:");DG.logWarn("  Parent Type: %@, ID: %@, Property: %@",p,n,m.inverse);DG.logWarn("  Child Type:  %@, ID: %@, Property: %@",f,g.guid,i)}}}}}}.bind(this);DG.Record.forEachRelation(DG.Record.recordTypeFromString(f),a);var e=function(i,j){var h=7;if((i.lastIndexOf("Storage")===i.length-h)&&!SC.none(j)&&(typeof j==="object")&&!SC.none(j._links_)&&(typeof j._links_==="object")){this._storageProperties.push({record:g,key:i,value:j})}}.bind(this);DG.ObjectMap.forEach(g,e)},processStorageProperties:function(){var a=function(d){var b=false,e=d.value,c=function(h,g){var f=SC.isArray(g)?g:[g];f.forEach(function(i){i.id=this.clientIDFromServerID(i.type,i.id)}.bind(this));b=true}.bind(this);DG.ObjectMap.forEach(e._links_,c);if(b){d.record[d.key]=e}}.bind(this);if(this._storageProperties){this._storageProperties.forEach(a)}this._storageProperties=null},openDocument:function(d,g){var c=SC.json.decode(g),h=d._getDataSource(),b=null;this._storageProperties=[];this.restoreObject(h,"DG.Document",c);this.processStorageProperties();this.loadRecordsIntoStore(d);var f=this._records&&this._records["DG.Document"],e=f&&f.array[0],a=e&&e.guid;b=a&&d.find(DG.Document,a);this._records=null;return b},saveDocument:function(c){var b=DG.currDocumentController();DG.gameSelectionController.saveCurrentGameState();DG.DataContext.forEachContextInMap(c.get("id"),function(d,e){e.willSaveContext()});if(b){DG.ObjectMap.forEach(b.componentControllersMap,function(e,d){d.willSaveComponent()})}var a=c.toArchive();return a},exportCaseData:function(b,a){var c="";DG.DataContext.forEachContextInMap(b.get("id"),function(d,e){c+=e.exportCaseData(a)});return c}});DG.DocumentController=SC.Object.extend({content:null,contexts:function(){return this.getPath("content.contexts")}.property(),components:function(){return this.getPath("content.components")}.property(),componentControllersMap:null,_singletonViews:null,gameView:function(){return this._singletonViews.gameView||null}.property(),guideMenuPane:null,guideButton:null,_guideModel:null,guideModel:function(){if(!this._guideModel){this._guideModel=DG.GuideModel.create()}return this._guideModel}.property(),_guideController:null,guideController:function(){if(!this._guideController){this._guideController=DG.GuideController.create({guideModel:this.get("guideModel")})}return this._guideController}.property(),documentID:function(){return this.getPath("content.id")}.property("content.id"),documentName:function(a,c){var b=this.get("content");if(c!==undefined){b.set("name",c);DG.store.commitRecords()}return b.get("name")}.property("content.name"),documentPermissions:function(){return this.getPath("content._permissions")||0}.property("content._permissions"),changeCount:0,savedChangeCount:0,init:function(){arguments.callee.base.apply(this,arguments);this._singletonViews={};this.setDocument(this.get("content")||this.createDocument())},destroy:function(){this.closeDocument();arguments.callee.base.apply(this,arguments)},createDocument:function(a){return DG.Document.createDocument({name:a||SC.String.loc("DG.Document.defaultDocumentName")})},setDocument:function(a){this.set("content",a);DG.DataContext.clearContextMap();this.componentControllersMap={};this.restoreDataContexts();this.restoreComponentControllersAndViews();this.set("changeCount",0);this.updateSavedChangeCount()},hasUnsavedChanges:function(){return DG.authorizationController.get("isSaveEnabled")&&((this.get("changeCount")>this.get("savedChangeCount"))||DG.currGameController.get("hasUnsavedChanges"))}.property(),updateSavedChangeCount:function(){DG.currGameController.updateSavedChangeCount();this.set("savedChangeCount",this.get("changeCount"))},createDataContextForModel:function(b,c){if(SC.none(b)){b=DG.DataContextRecord.createContext({document:this.get("documentID")})}if(!c){c={}}c.type=b.get("type");c.model=b;var a=DG.DataContext.factory(c);return a},restoreDataContexts:function(){var b=this.get("contexts")||[],a=this;b.forEach(function(c){var d=a.createDataContextForModel(c);if(d){d.restoreFromStorage(c.get("contextStorage"))}})},createComponentAndView:function(a,b){var d=DG.mainPage.get("docView"),c=(a&&a.get("type"))||b,e=true;switch(c){case"DG.FlashView":if(a){a.set("type","DG.GameView")}case"DG.GameView":this.addGame(d,a);break;case"DG.TableView":this.addCaseTable(d,a);break;case"DG.GraphView":this.addGraph(d,a);break;case"DG.SliderView":this.addSlider(d,a);break;case"DG.Calculator":this.addCalculator(d,a);break;case"DG.TextView":this.addText(d,a);break;case"DG.MapView":this.addMap(d,a);break;case"SC.WebView":this.addWebView(d,a);break;case"DG.GuideView":this.addGuideView(d,a);break;default:e=false;break}if(a){a.didLoadRecord()}if(e){this.incrementProperty("changeCount")}},restoreComponentControllersAndViews:function(){var a=this.get("components");if(a){a.forEach(function(b){this.createComponentAndView(b)}.bind(this))}},gameCollectionWithName:function(c,b){var d=DG.gameSelectionController.findGameByName(c),a=d&&DG.GameContext.getContextForGame(d),e=a&&a.getCollectionByName(b);return e},collectionDefaults:function(){var c=DG.gameSelectionController.get("currentGame"),a=c&&DG.GameContext.getContextForGame(c),b=a&&a.collectionDefaults();return b},configureComponent:function(a,c){var e=!SC.none(a),b=this.get("documentID"),g=a,f=c.controller;if(!e){var d={type:c.componentClass.type};if(!SC.none(b)){d.document=b}g=DG.Component.createComponent(d)}if(c.contentProperties&&c.contentProperties.model){g.set("content",c.contentProperties.model)}f.set("model",g);this.componentControllersMap[g.get("id")]=f;if(e){f.didRestoreComponent(b)}return g},createComponentView:function(a,e){var b=e&&e.defaultLayout,f=!SC.none(a),g,d;DG.globalEditorLock.commitCurrentEdit();g=this.configureComponent(a,e);if(g&&g.get("layout")){b=g.get("layout")}if(f){d=DG.ComponentView.restoreComponent(e.parentView,b,e.componentClass.constructor,e.contentProperties,e.title,e.isResizable)}else{DG.sounds.playCreate();d=DG.ComponentView.addComponent(e.parentView,b,e.componentClass.constructor,e.contentProperties,e.title,e.isResizable,e.useLayout,e.isVisible);var c=d&&d.getPath("contentView.defaultFirstResponder");if(c){if(c.beginEditing){c.beginEditing()}else{if(c.becomeFirstResponder){c.becomeFirstResponder()}}}}if(e.controller){e.controller.set("view",d);d.set("controller",e.controller)}if(d){this.incrementProperty("changeCount")}return d},addGame:function(e,a){var c=DG.gameSelectionController.get("currentDimensions")||{width:0,height:0},d=DG.gameSelectionController.get("currentName")||"";var b=this.createComponentView(a,{parentView:e,controller:DG.currGameController,componentClass:{type:"DG.GameView",constructor:DG.GameView},contentProperties:{},defaultLayout:{width:c.width,height:c.height},title:d,isResizable:true});this._singletonViews.gameView=b;b.bringToFront=function(){};b.bind("title","DG.gameSelectionController.currentName");return b},addCaseTable:function(c,a){var b=this.createComponentView(a,{parentView:c,controller:DG.CaseTableController.create(),componentClass:{type:"DG.TableView",constructor:DG.HierTableView},contentProperties:{},defaultLayout:{width:500,height:200},title:"DG.DocumentController.caseTableTitle".loc(),isResizable:true});this._singletonViews.caseTableView=b;return b},addGraph:function(e,a){var c=DG.GraphModel.create(),d=DG.GraphController.create();d.set("dataContext",DG.gameSelectionController.get("currentContext"));var b=this.createComponentView(a,{parentView:e,controller:d,componentClass:{type:"DG.GraphView",constructor:DG.GraphView},contentProperties:{model:c},defaultLayout:{width:300,height:300},title:"DG.DocumentController.graphTitle".loc(),isResizable:true});return b},addText:function(c,a){var b=this.createComponentView(a,{parentView:c,controller:DG.TextComponentController.create(),componentClass:{type:"DG.TextView",constructor:DG.TextView},contentProperties:{hint:"Type some notes here…"},defaultLayout:{width:300,height:100},title:"DG.DocumentController.textTitle".loc(),isResizable:true});return b},addMap:function(e,a){var d=DG.MapModel.create(),c=DG.gameSelectionController.get("currentContext");d.set("dataContext",c);d.set("dataConfiguration",DG.MapDataConfiguration.create({dataContext:c}));var b=this.createComponentView(a,{parentView:e,controller:DG.ComponentController.create(),componentClass:{type:"DG.MapView",constructor:DG.MapView},contentProperties:{model:d},defaultLayout:{width:300,height:300},title:"DG.DocumentController.mapTitle".loc(),isResizable:true});return b},addSlider:function(e,b){var a={};if(!b||!b.get("componentStorage")){a.content=this.createGlobalValue()}var d=DG.SliderModel.create(a),c=this.createComponentView(b,{parentView:e,controller:DG.SliderController.create(),componentClass:{type:"DG.SliderView",constructor:DG.SliderView},contentProperties:{model:d},defaultLayout:{width:300,height:60},title:"DG.DocumentController.sliderTitle".loc(),isResizable:true});return c},addCalculator:function(c,a){var b=this.createComponentView(a,{parentView:c,controller:DG.ComponentController.create(),componentClass:{type:"DG.Calculator",constructor:DG.Calculator},contentProperties:{},defaultLayout:{},title:"DG.DocumentController.calculatorTitle".loc(),isResizable:false});this._singletonViews.calcView=b;return b},viewWebPage:function(){var c=this,b=null;function a(){var d=b.get("value");b.close();if(!/^https?:\/\//i.test(d)){d="http://"+d}c.addWebView(DG.mainPage.get("docView"),null,d,"Web Page",{width:600,height:400})}b=DG.CreateSingleTextDialog({prompt:"DG.DocumentController.enterURLPrompt",textValue:"",textHint:"URL",okTarget:null,okAction:a,okTooltip:"DG.DocumentController.enterViewWebPageOKTip"})},addWebView:function(e,b,d,a,c){d=d||"";a=a||"";c=c||{width:600,height:400};return this.createComponentView(b,{parentView:e,controller:DG.WebViewController.create(),componentClass:{type:"SC.WebView",constructor:SC.WebView},contentProperties:{value:d,backgroundColor:"white"},defaultLayout:c,title:a,isResizable:true,useLayout:!SC.none(c.centerX)||!SC.none(c.left)})},addGuideView:function(e,a){if(this._singletonViews.guideView){return}var c=this.get("guideModel"),d=this.get("guideController"),b=this.createComponentView(a,{parentView:e,controller:d,componentClass:{type:"DG.GuideView",constructor:DG.GuideView},contentProperties:{backgroundColor:"white",guideModel:c,controller:d,closeAction:{action:this.closeGuideView,target:this}},defaultLayout:{width:400,height:200},isResizable:true,useLayout:true,isVisible:false});this._singletonViews.guideView=b;return b},closeGuideView:function(){var a=this._singletonViews.guideView;if(a){a.set("isVisible",false)}},configureGuide:function(){var d=this,c=null,b=this.get("guideModel");var a=function(){this.addGuideView(DG.mainPage.docView);b.beginPropertyChanges();b.set("title",c.get("title"));b.set("items",c.get("items"));b.endPropertyChanges();c.close()}.bind(this);c=DG.CreateGuideConfigurationView({okTarget:null,okAction:a,model:b})},guideButtonOrMenuDidChange:function(){var c=this.get("guideButton"),b=this.get("guideMenuPane");if(c&&b){var a=this.get("guideController");a.set("guideButton",c);a.set("guideMenuPane",b)}}.observes("guideButton","guideMenuPane"),toggleComponent:function(b,a){var c=this._singletonViews[a];if(c){this.removeComponentAssociatedWithView(c);c.destroy()}else{switch(a){case"calcView":this.addCalculator(b);break;case"caseTableView":this.addCaseTable(b);break;case"mapView":this.addMap(b);break}}},closeDocument:function(){DG.ObjectMap.forEach(this.componentControllersMap,function(b,a){if(a&&a.willDestroy){a.willDestroy()}});DG.globalsController.stopAnimation();DG.gameSelectionController.reset();DG.DataContext.clearContextMap();DG.Record.destroyAllRecordsOfType(DG.GlobalValue);DG.Record.destroyAllRecordsOfType(DG.Case);DG.Record.destroyAllRecordsOfType(DG.Attribute);DG.Record.destroyAllRecordsOfType(DG.CollectionRecord);DG.Record.destroyAllRecordsOfType(DG.DataContextRecord);DG.Record.destroyAllRecordsOfType(DG.Component);DG.store.commitRecords();DG.gameSelectionController.reset();this.closeAllComponents()},closeAllComponents:function(){this._singletonViews={};this.componentControllersMap={};this.get("guideModel").reset()},removeComponentAssociatedWithView:function(e){var d=null,a=DG.ObjectMap.findKey(this.componentControllersMap,function(g,f){if(f.view===e){d=f;return true}return false});var c=DG.ObjectMap.findValue(this._singletonViews,e);if(c&&this._singletonViews[c]){this._singletonViews[c]=null}if(d){var b=d.get("model");if(b){DG.Component.destroyComponent(b)}delete this.componentControllersMap[a];if(d.get("shouldDestroyOnComponentDestroy")){d.destroy()}else{d.set("model",null);d.set("view",null)}this.incrementProperty("changeCount")}},addFormulaObject:function(c,h,f,a,b,d,e,g){var i=this.createComponentView(h,{parentView:c,controller:DG.ComponentController.create({}),componentClass:{type:"DG.FormulaObject",constructor:DG.FormulaObject},contentProperties:{description:a,outputSymbol:b,nameSpaceSymbols:d,variableDescriptions:e,allow_user_variables:g},defaultLayout:{},title:f,isResizable:true});return i},createGlobalValue:function(a){a=a||{};a.document=this.get("documentID");return DG.globalsController.createGlobalValue(a)},exportDocument:function(){var a=DG.DocumentArchiver.create({}),b=a.saveDocument(this.get("content"));return b},exportCaseData:function(a){var b=DG.DocumentArchiver.create({}),c=b.exportCaseData(this.get("content"),a);return c},saveDocument:function(c,b){var a=this.exportDocument();if(!SC.none(b)){a._permissions=b}if(DG.assert(!SC.none(a))){DG.authorizationController.saveDocument(c,a,this);this.updateSavedChangeCount()}},receivedSaveDocumentResponse:function(d){var a=d.get("body"),c=!SC.ok(d)||d.get("isError")||d.getPath("response.valid")===false;if(c){var b="DG.AppController.saveDocument."+a.message;if(b.loc()===b){b="DG.AppController.saveDocument.error.general"}if(c){DG.AlertPane.error({localize:true,message:b})}}}});DG.currDocumentController=function(){if(!DG._currDocumentController){DG._currDocumentController=DG.DocumentController.create();DG._currDocumentController.set("guideMenuPane",DG.appController.get("guideMenuPane"))}return DG._currDocumentController};DG.gameCollectionWithName=function(b,a){return DG.currDocumentController().gameCollectionWithName(b,a)};DG.DocumentListController=SC.ArrayController.extend({loadingMessage:"DG.OpenSaveDialog.loading",noDocumentsMessage:"DG.OpenSaveDialog.noDocuments",noResponseMessage:"DG.OpenSaveDialog.error.noResponse",init:function(){arguments.callee.base.apply(this,arguments);this.set("content",[]);var a=this.get("loadingMessage").loc();if(!SC.empty(a)){this.addObject({name:a,id:""})}DG.authorizationController.documentList(this)},receivedDocumentListResponse:function(h){this.set("content",[]);if(SC.ok(h)){var e=h.get("body"),a=[],b;try{b=e&&SC.json.decode(e)}catch(f){b={valid:false,message:"error.parseError"}}if(b.valid===false){var c=b.message;this.addObject({name:("DG.DocumentListController."+c).loc(),id:""})}else{if(b){b.forEach(function(i){if(i.id&&i.name){a.push({name:i.name,id:i.id})}});if(a.length===0){var g=this.get("noDocumentsMessage").loc();if(!SC.empty(g)){this.addObject({name:g,id:""})}}else{a.sort(function(l,k){var j=l.name.toLowerCase(),i=k.name.toLowerCase();return j.localeCompare(i)||l.name.localeCompare(k.name)});this.set("content",a)}}}}else{var d=this.get("noResponseMessage").loc();this.addObject({name:d,id:""})}}});sc_require("formula/formula_context");DG.FormulaObjectContext=DG.FormulaContext.extend({compileVariable:function(a){var b=this.get("locals");if(b&&!SC.none(b[a])){return"c.locals."+a+".evaluate(e)"}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,b){var c=this.get("locals");if(c&&!SC.none(c[a])){return c[a].evaluateDirect(b)}return arguments.callee.base.apply(this,arguments)}});DG.formulaObjectCoordinator=SC.Object.create({init:function(){arguments.callee.base.apply(this,arguments);this.formulaContext=DG.FormulaObjectContext.create()},findFormulaObject:function(a){var b=DG.mainPage.getComponentsOfType(DG.FormulaObject),c=null;b.forEach(function(d){if(d.get("outputSymbol")===a){c=d}});return c},requestFormulaObject:function(c,d,b,h,f,g){var a=this.findFormulaObject(b);if(SC.none(a)){var e=DG.currDocumentController().addFormulaObject(DG.mainPage.get("docView"),null,c,d,b,h,f,g);a=e&&e.get("contentView");if(a){a.addObserver("willDestroy",this,"_willDestroyFormulaObject")}}return true},updateFormulaObject:function(c,b,f,d,e){var a=this.findFormulaObject(b);if(!SC.none(a)){a.updateContents(c,b,f,d,e)}return true},requestFormulaValue:function(c,i){var b={error:"",formula:""},a=this.findFormulaObject(c),f=this.getFormulaForObject(c,a),d=this.getLocalsForObject(a);if(!SC.empty(f)){var j=this.get("formulaContext"),g={};DG.ObjectMap.forEach(d,function(e,k){g[e]=DG.Formula.create({source:k,context:j})});try{b[c]=this._evaluateFormula(f,g,i)}catch(h){b[c]=null;b.error=h}b.formula=f;if(a){this.stashFormulaForObject(a)}return b}else{return false}},getFormulaForObject:function(a,c){if(c){return c.get("formula")}var b=DG.gameSelectionController.getPath("currentGame.formulas");return b&&b[a]},getLocalsForObject:function(b){if(b){return b.get("locals")}var a=DG.gameSelectionController.getPath("currentGame.formulas");return a&&a.locals},stashFormulaForObject:function(a){if(a){var b=DG.gameSelectionController.get("currentGame");if(b){b.set("formulas",a.get("formulas"))}}},_evaluateFormula:function(a,d,c){var b=this.get("formulaContext");b.set("locals",d);b.set("eVars",c);var e=DG.Formula.create({source:a,context:b});return e.evaluate(c)},_willDestroyFormulaObject:function(a){this.stashFormulaForObject(a)}});sc_require("controllers/data_context");DG.GameContext=DG.DataContext.extend({type:"DG.GameContext",gameSpec:null,gameName:function(){return this.getPath("gameSpec.name")}.property("gameSpec","gameSpec.name").cacheable(),gameDimensions:function(){return this.getPath("gameSpec.dimensions")}.property("gameSpec","gameSpec.dimensions").cacheable(),gameUrl:function(){return this.getPath("gameSpec.url")}.property("gameSpec","gamespec.url").cacheable(),_collections:null,collections:function(){var e=this.getPath("model.collections"),c,a=e?e.get("length"):0;if(this._collections&&(this._collections.length===a)){return this._collections}this._collections=[];if(a>0){var d=e&&e.objectAt(0),b=d&&d.get("name"),f=this.getPath("gameSpec.collectionName");if(b===f){for(c=a-1;c>=0;--c){this._collections.push(e.objectAt(c))}}else{for(c=0;c<a;++c){this._collections.push(e.objectAt(c))}}}return this._collections}.property("model","model.collections"),didCreateCollection:function(c){var a=this.get("gameSpec");if(a){a.notifyPropertyChange("collections")}var b=a&&this.getCollectionByName(a.get("collectionName")),d=a&&this.getCollectionByName(a.get("parentCollectionName"));if(b&&d&&(b!==d)){b.setParentCollection(d);DG.assert(b.isDescendantOf(d));DG.assert(d.isAncestorOf(b))}},collectionDefaults:function(){var d={collectionClient:null,plotXAttr:null,plotXAttrIsNumeric:true,plotYAttr:null,plotYAttrIsNumeric:true},b=this.get("gameSpec"),c=b&&b.get("collectionName");if(!SC.empty(c)){d.collectionClient=this.getCollectionByName(c);d.parentCollectionClient=this.getCollectionByName(b.get("parentCollectionName"))}if(SC.none(d.collectionClient)){d.collectionClient=this.get("childCollection")}function a(e,f){var g=b&&b.get(e+"AttrName");if(d.collectionClient&&!SC.empty(g)){d["plot"+f+"Attr"]=d.collectionClient.getAttributeByName(g);var h=b.get(e+"AttrIsNumeric");if(!SC.none(h)){d["plot"+f+"AttrIsNumeric"]=h}}}a("x","X");a("y","Y");a("legend","Legend");return d},getLabelsForCollection:function(b){var d=this.get("gameSpec"),c=b.get("name"),a=d&&c&&d.getCollectionSpecByName(c),e=a&&a.labels;return e},getCaseNameForCount:function(a,b){var c=this.getLabelsForCollection(a);if(!c||!c.singleCase||!c.pluralCase){return arguments.callee.base.apply(this,arguments)}return b===1?c.singleCase:c.pluralCase},getLabelForSetOfCases:function(b){var d=this.getLabelsForCollection(b),a=d&&d.setOfCasesWithArticle;if(!SC.empty(a)){return a}var c=this.getPath("gameSpec.eventsAttributeName");if(!SC.empty(c)){return c}return arguments.callee.base.apply(this,arguments)},createStorage:function(){var a=arguments.callee.base.apply(this,arguments);a.gameName=this.get("gameName");a.gameUrl=this.get("gameUrl");var b=this.get("savedGameState");if(b){DG.ObjectMap.forEach(b._links_,function(c,d){DG.ArchiveUtils.addLinkID(a,"_game_"+c,"DG.Case",d)});a.gameState=b;this.set("savedGameState",null)}return a},restoreFromStorage:function(b){arguments.callee.base.apply(this,arguments);var a=DG.gameSelectionController.findGameByName(b.gameName);if(a){this.set("gameSpec",a);a.set("context",this)}if(b.gameState){if(b._links_){DG.ObjectMap.forEach(b._links_,function(e,d){if(e.slice(0,6)==="_game_"){var c=e.slice(6);if(!b.gameState._links_){b.gameState._links_={}}b.gameState._links_[c]=d.id}})}this.set("restoredGameState",b.gameState)}}});DG.DataContext.registry["DG.GameContext"]=function(a){return DG.GameContext.create(a)};DG.GameContext.getContextForGame=function(a){if(!a){return null}var d=a.get("context");if(!d){var e={type:a.get("contextType")||"DG.GameContext"};if(e.type==="DG.GameContext"){e.gameSpec=a}var c=DG.currDocumentController().getPath("content.id"),b=DG.DataContextRecord.createContext({type:e.type,document:c});if(b){e.model=b}d=DG.DataContext.factory(e);if(d){a.set("context",d)}}return d};DG.globalsController=SC.Controller.create((function(){return{globalNameChanges:null,globalValueChanges:0,_globalsMap:{},isNameInUse:function(a){return !SC.none(this.getGlobalValueByName(a))},getGlobalValueByName:function(b){var c=SC.Query.local(DG.GlobalValue,{conditions:"name = {name}",name:b}),a=DG.store.find(c);return a.get("length")>0?a.objectAt(0):null},getUniqueName:function(a){var c=0,b;a=a||"v";do{++c;b=a+c}while(this.isNameInUse(b));return b},createGlobalValue:function(c,b){c=c||{};if(SC.empty(c.name)){c.name=this.getUniqueName(b)}if(!c.value){c.value=0.5}var a=DG.GlobalValue.createGlobalValue(c);this.registerGlobalValue(a);return a},destroyGlobalValue:function(a){var b=a&&a.get("name");a.removeObserver("name",this,this.nameDidChange);a.removeObserver("value",this,this.valueDidChange);delete this._globalsMap[b];DG.GlobalValue.destroyGlobalValue(a);this.set("globalNameChanges",[{oldName:b}]);this.valueDidChange()},registerGlobalValue:function(a){var b=a&&a.get("name");this._globalsMap[b]=a;a.addObserver("name",this,this.nameDidChange);a.addObserver("value",this,this.valueDidChange);this.set("globalNameChanges",[{newName:b}])},nameDidChange:function(b){var a=DG.ObjectMap.findValue(this._globalsMap,b),c=b.get("name");if(a!==c){this._globalsMap[c]=b;DG.ObjectMap.remove(this._globalsMap,a);this.set("globalNameChanges",[{oldName:a,newName:c}])}},valueDidChange:function(a){var b=a&&a.get("name"),c=b?[b]:[];this.set("globalValueChanges",c)},stopAnimation:function(){DG.ObjectMap.forEach(this._globalsMap,function(a,b){if(b&&b.stopAnimation){b.stopAnimation()}})},getGlobalValueNames:function(){return DG.ObjectMap.keys(this._globalsMap)},addGlobalValuesToNamespace:function(a){DG.ObjectMap.forEach(this._globalsMap,function(b,c){a[b]=c.get("value")})}}}()));sc_require("controllers/component_controller");DG.WebViewController=DG.ComponentController.extend({theURL:"",gearMenuItems:function(){return[{title:"Edit URL",target:this,itemAction:this.editURL,isEnabled:true}]}.property(),editURL:function(){var c=this,b=null;function a(){var d=b.get("value");b.close();c.set("theURL",d)}b=DG.CreateSingleTextDialog({prompt:DG.DocumentController.enterURLPrompt,textValue:this.get("theURL"),textHint:"URL",okTarget:null,okAction:a,okTooltip:DG.DocumentController.enterViewWebPageOKTip})},createComponentStorage:function(){var a=this.get("theURL"),b={};if(!SC.empty(a)){b.URL=a}return b},restoreComponentStorage:function(a){var b=a.URL||"";this.set("theURL",b)},viewDidChange:function(){var a=this.getPath("view.containerView.contentView");if(a){if(SC.empty(this.theURL)){this.set("theURL",a.get("value"))}a.bind("value",this,"theURL");a.set("controller",this)}}.observes("view")});DG.MemoryDataSource=SC.DataSource.extend((function(){var n={},e={},k={},j={},s={},a={},l={},r={},i={};n["DG.Document"]=k;n["DG.Component"]=j;n["DG.DataContextRecord"]=s;n["DG.CollectionRecord"]=a;n["DG.Attribute"]=l;n["DG.Case"]=r;n["DG.GlobalValue"]=i;e["DG.Document"]=[];e["DG.Component"]=[];e["DG.DataContextRecord"]=[];e["DG.CollectionRecord"]=[];e["DG.Attribute"]=[];e["DG.Case"]=[];e["DG.GlobalValue"]=[];var c={};c["DG.Document"]=10;c["DG.Component"]=100;c["DG.DataContextRecord"]=400;c["DG.CollectionRecord"]=600;c["DG.Attribute"]=1000;c["DG.Case"]=2000;c["DG.GlobalValue"]=9000;function p(t){return SC.clone(t,YES)}function m(t){var v=[];for(var u=0;u<t.length;u++){v.push(p(t[u]))}return v}var d=function(u,t){if(SC.kindOf(u,DG.Document)){return"DG.Document"}if(SC.kindOf(u,DG.DataContextRecord)){return"DG.DataContextRecord"}if(SC.kindOf(u,DG.Component)){return"DG.Component"}if(SC.kindOf(u,DG.CollectionRecord)){return"DG.CollectionRecord"}if(SC.kindOf(u,DG.Attribute)){return"DG.Attribute"}if(SC.kindOf(u,DG.Case)){return"DG.Case"}if(SC.kindOf(u,DG.GlobalValue)){return"DG.GlobalValue"}};function f(w,x,y,v){var u=v.storeKeyFor(w,x.guid),t=v.readEditableDataHash(u);t[y]=SC.copy(x[y],true);v.dataHashDidChange(u,null,false,y)}function b(t,B,x,y,A){var w=t[B];if(!SC.none(w)){var v=d(x,A),u=v&&n[v][w];if(!u){return}var z=false;if(!u[y]){u[y]=[];z=true}if(u[y].indexOf(t.guid)<0){u[y].pushObject(t.guid);z=true}if(z){f(x,u,y,A)}}}function q(w,v,u){var t=v[u];if(t&&t.indexOf(w.guid)>=0){t.removeObject(w.guid);return true}return false}function o(t,C,y,A,B){var v=d(y,B),w=!SC.empty(C)&&t[C],u=n[v][w];if(u){if(q(t,u,A)){f(y,u,A,B)}return}var z=v&&e[v],D=z?z.length:0;for(var x=0;x<D;++x){u=z[x];if(q(t,u,A)){f(y,u,A,B);break}}}var g=function(v,u,t){if(!u){return}switch(v){case"DG.Document":break;case"DG.Component":o(u,"document",DG.Document,"components",t);break;case"DG.DataContextRecord":o(u,"document",DG.Document,"contexts",t);break;case"DG.CollectionRecord":o(u,"context",DG.DataContextRecord,"collections",t);o(u,"parent",DG.CollectionRecord,"children",t);break;case"DG.Attribute":o(u,"collection",DG.CollectionRecord,"attrs",t);break;case"DG.Case":o(u,"collection",DG.CollectionRecord,"cases",t);o(u,"parent",DG.Case,"children",t);break;case"DG.GlobalValue":o(u,"document",DG.Document,"globalValues",t);break;default:DG.logWarn("removeRelations: Unrecognized record type: "+v)}};var h=function(w,u,t,v){if(v){g(w,u,t)}switch(w){case"DG.Document":break;case"DG.Component":b(u,"document",DG.Document,"components",t);break;case"DG.DataContextRecord":b(u,"document",DG.Document,"contexts",t);break;case"DG.CollectionRecord":b(u,"context",DG.DataContextRecord,"collections",t);b(u,"parent",DG.CollectionRecord,"children",t);break;case"DG.Attribute":b(u,"collection",DG.CollectionRecord,"attrs",t);break;case"DG.Case":b(u,"collection",DG.CollectionRecord,"cases",t);b(u,"parent",DG.Case,"children",t);break;case"DG.GlobalValue":b(u,"document",DG.Document,"globalValues",t);break;default:DG.logWarn("configureRelations: Unrecognized record type: "+w)}};return{getDataHash:function(t,u){return n[t][u]},fetch:function(u,v){var w=v.get("recordType");var x=d(w,u);var t=null;t=m(e[x]);u.loadRecords(w,t);u.dataSourceDidFetchQuery(v);return YES},assignIDForNewRecord:function(t,u){u.guid=++c[t];return u.guid},loadRecords:function(u,v){var t=DG.Record.stringFromRecordType(u);v.forEach(function(y){var w=p(y),x=w.guid;if(c[t]<x){c[t]=x}n[t][x]=w;e[t].pushObject(w)})},retrieveRecord:function(u,w){var x=d(u.recordTypeFor(w),u);var v=u.idFor(w);var t=p(n[x][v]);u.dataSourceDidComplete(w,t);return YES},createRecord:function(u,v){var w=d(u.recordTypeFor(v),u);var t=p(u.readDataHash(v));t.guid=++c[w];n[w][t.guid]=t;e[w].pushObject(t);h(w,t,u);u.dataSourceDidComplete(v,p(t),t.guid);return YES},updateRecord:function(u,x){var y=d(u.recordTypeFor(x),u);var t=p(u.readDataHash(x));var v=u.idFor(x);var w=n[y][v];e[y].removeObject(w);delete n[y][v];n[y][v]=t;e[y].pushObject(t);h(y,t,u,true);u.dataSourceDidComplete(x);return YES},destroyRecord:function(t,w){var x=d(t.recordTypeFor(w),t);var u=t.idFor(w);var v=n[x][u];e[x].removeObject(v);delete n[x][u];g(x,v,t);t.dataSourceDidDestroy(w);return YES}}}()));DG.AggregateFunction=SC.Object.extend({requiredArgs:{min:0,max:999},queryCache:function(c,b,a){return undefined},evaluate:function(c,b,a){}});DG.IteratingAggregate=DG.AggregateFunction.extend({queryCache:function(c,b,a){return a.results?a.results[b._id_]:undefined},evaluate:function(k,h,j){var b=this.queryCache(k,h,j);if(b!==undefined){return b}var f=k&&k.getCollectionToIterate(),l=f&&f.get("cases"),c=l&&l.get("length");j.caches={};j.results={};for(var d=0;d<c;++d){var a=l.objectAt(d),g={_case_:a,_id_:a&&a.get("id")};this.evalCase(k,g,j)}return this.computeResults(k,h,j)},evalCase:function(c,b,a,d){},computeResults:function(c,b,a){return this.queryCache(c,b,a)}});DG.ParentCaseAggregate=DG.IteratingAggregate.extend({queryCache:function(c,b,a){if(a.results){if(a.results[b._id_]!==undefined){return a.results[b._id_]}var e=b._case_&&b._case_.getPath("parent.id"),d=e||null;if(a.results[d]!==undefined){return a.results[d]}}return undefined},evaluate:function(l,h,k){var b=this.queryCache(l,h,k);if(b!==undefined){return b}var f=l&&l.getCollectionToIterate(),m=f&&f.get("cases"),c=m&&m.get("length");k.caches={};k.results={};for(var d=0;d<c;++d){var a=m.objectAt(d),j=(a&&a.getPath("parent.id"))||null,g={_case_:a,_id_:a&&a.get("id")};this.evalCase(l,g,k,j)}return this.computeResults(l,h,k)}});DG.SortDataFunction=DG.ParentCaseAggregate.extend({evalCase:function(d,c,b,g){var f=b.argFns[0],e=f&&f(d,c);if(isFinite(e)){var a=b.caches[g];if(a){a.push(e)}else{b.caches[g]=[e]}}},extractResult:function(a){return null},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(d,e){if(e.length>0){e.sort(function(g,f){return g-f})}a.results[d]=this.extractResult(e)}.bind(this));return this.queryCache(c,b,a)}});sc_require("formula/aggregate_function");sc_require("formula/global_formula_context");DG.CollectionFormulaContext=DG.GlobalFormulaContext.extend({collection:null,attrFns:null,collectionAttrRefCounts:null,aggFnInstances:null,aggFnCount:0,init:function(){arguments.callee.base.apply(this,arguments);this.clearCaches()},clearCaches:function(){this.attrFns={};this.collectionAttrRefCounts={};this.aggFnInstances=[];this.aggFnCount=0},getCaseIndex:function(b){var a=this.collection.caseIDToIndexMap;return a&&(a[b]+1)},getAttrValue:function(b,a){var c=b&&a&&b.getValue(a);if(c instanceof Error){throw c}return c},compileVariable:function(f){if(f==="caseIndex"){return"c.getCaseIndex(e._id_)"}var k,b,j=this.get("collection"),c=j&&j.getAttributeByName(f);if(SC.none(c)){k=j&&j.get("parent");for(k;!SC.none(k)&&SC.none(c);k=k.get("parent")){c=k&&k.getAttributeByName(f);if(!SC.none(c)){j=k;break}}}if(SC.none(c)){var d=this.getPath("collection.children"),g=d&&d.get("length");for(var h=0;h<g;++h){b=d.objectAt(h);c=b&&b.getAttributeByName(f);if(!SC.none(c)){j=b;break}}}if(c){var a=c.get("id");this.attrFns[f]=function(n){var m=n._case_,i=(b&&n._childCase_)||(k&&m.get("parent"))||m,o=i&&i.getValue(a);if(o instanceof Error){throw o}return o};var e=j.get("id"),l=this.collectionAttrRefCounts[e]||0;this.collectionAttrRefCounts[e]=l+1;return'c.attrFns["'+f+'"](e)'}return arguments.callee.base.apply(this,arguments)},evaluateVariable:function(a,c){if(a==="caseIndex"){return this.getCaseIndex(c._id_)}var e=this.get("collection"),d=e&&e.getAttributeByName(a),b=d&&d.get("id");if(b){return this.getAttrValue(c._case_,b)}return arguments.callee.base.apply(this,arguments)},getCollectionToIterate:function(){var d=this.get("collection"),j=d&&d.get("children"),b=j&&j.get("length");for(var c=0;c<b;++c){var f=j.objectAt(c),g=f&&f.get("id");if(this.collectionAttrRefCounts[g]>0){return f}}var a=d&&d.get("id");if(this.collectionAttrRefCounts[a]>0){return d}var e=d&&d.get("parent"),h=e&&e.get("id");if(this.collectionAttrRefCounts[h]>0){return e}return d},aggFns:{},hasAggregates:function(){return this.aggFnCount>0}.property("aggFnCount"),isAggregate:function(a){return SC.kindOf(this.aggFns[a],DG.AggregateFunction)},evalAggregate:function(d,f){if(!d._case_||SC.none(d._id_)){return null}var b=this.aggFnInstances[f];b.results={};var e=this.aggFns[b.name],a=e&&e.queryCache(this,d,b),c,h=b.args.length;if(a!==undefined){return a}b.argFns=[];for(c=0;c<h;++c){b.argFns.push(DG.FormulaContext.createContextFunction(b.args[c]))}var g=e.get("requiredArgs");if((h<g.min)||(g.max<h)){throw new DG.FuncArgsError(b.name,g)}return e.evaluate(this,d,b)},compileFunction:function(c,b){if(this.isAggregate(c)){var a=this.aggFnCount++;this.aggFnInstances.push({name:c,args:b});return"c.evalAggregate(e,"+a+")"}return arguments.callee.base.apply(this,arguments)}});DG.CollectionFormulaContext.registerAggFnModule=function(a){DG.FormulaContext.registerFnModule(a);DG.ObjectMap.copy(DG.CollectionFormulaContext.prototype.aggFns,a)};sc_require("formula/formula_common");sc_require("formula/formula_context");DG.Formula=SC.Object.extend({context:null,source:null,init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("context");if(a){a.addObserver("namespaceChange",this,"namespaceDidChange")}if(a){a.addObserver("dependentChange",this,"dependentDidChange")}},destroy:function(){var a=this.get("context");if(a){a.removeObserver("namespaceChange",this,"namespaceDidChange");a.removeObserver("dependentChange",this,"dependentDidChange");a.destroy();this.context=null}arguments.callee.base.apply(this,arguments)},invalidate:function(){this.notifyPropertyChange("source")},invalidateContext:function(){this.notifyPropertyChange("context")},namespaceDidChange:function(a,b){this.notifyPropertyChange(b);this.notifyPropertyChange("dependentChange")},dependentDidChange:function(a,b){this.notifyPropertyChange(b)},parseCount:0,parsed:function(){++this.parseCount;var c=this.get("source"),a;try{a=c&&DG.formulaParser.parse(c)}catch(b){b.originalMessage=b.message;b.message=b.found?"DG.Formula.SyntaxErrorMiddle".loc(b.found):"DG.Formula.SyntaxErrorEnd".loc();throw b}return a}.property("source").cacheable(),compiled:function(){var b=this.get("parsed"),c=this.get("context"),d=null;if(!c){c=DG.FormulaContext.create({});this.context=c}if(b){c.clearCaches();var a=DG.Formula.compileToJavaScript(b,c);d=DG.FormulaContext.createContextFunction(a)}return d}.property("parsed","context","namespaceChange").cacheable(),hasAggregates:function(){var a=false;try{this.get("compiled");var b=this.get("context");if(b){a=b.get("hasAggregates")}}catch(c){}return a}.property("compiled","context").cacheable(),evaluate:function(b){var c=this.get("compiled"),a=this.get("context");return c&&c(a,b)},evaluateDirect:function(c){var a=this.get("parsed"),b=this.get("context");if(!b){b=DG.FormulaContext.create({});this.context=b}return DG.Formula.evaluateParseTree(a,b,c)}});DG.Formula.compileToJavaScript=function(a,k){var h;function j(n){var m=h[n.type];return m&&m(n)}function e(m){return m.value}function b(m){return'"'+m.value+'"'}function g(m){return k.compileVariable(m.name)}function l(p){var o,m=p.args&&p.args.length,n=[];for(o=0;o<m;++o){n.push(j(p.args[o]))}return k.compileFunction(p.name.name,n)}function f(n){var m=(n.type==="BinaryExpression"),o=j(n);if(m){o="("+o+")"}return o}function d(m){return m.operator+f(m.expression)}function c(n){var m=f(n.left),o=f(n.right);if(n.operator==="^"){return"Math.pow("+m+","+o+")"}return m+n.operator+o}function i(m){return"("+f(m.condition)+"?"+f(m.trueExpression)+":"+f(m.falseExpression)+")"}h={BooleanLiteral:e,NumericLiteral:e,StringLiteral:b,Variable:g,FunctionCall:l,UnaryExpression:d,BinaryExpression:c,ConditionalExpression:i};return j(a)};DG.Formula.evaluateParseTree=function(a,j,i){var f;function h(m){var l=f[m.type];return l&&l(m)}function d(l){return l.value}function e(l){return j.evaluateVariable(l.name,i)}function k(o){var n,l=o.args&&o.args.length,m=[];for(n=0;n<l;++n){m.push(h(o.args[n]))}return j.evaluateFunction(o.name.name,m)}function c(l){var m=h(l.expression);switch(l.operator){case"+":return +m;case"-":return -m;case"!":return !m}return undefined}function b(m){var n=h(m.left),l=h(m.right);switch(m.operator){case"^":return Math.pow(n,l);case"*":return n*l;case"/":return n/l;case"%":return n%l;case"+":return n+l;case"-":return n-l;case"<":return n<l;case">":return n>l;case"<=":return n<=l;case">=":return n>=l;case"===":return n===l;case"!==":return n!==l;case"&&":return n&&l;case"||":return n||l}return undefined}function g(l){return h(l.condition)?h(l.trueExpression):h(l.falseExpression)}f={BooleanLiteral:d,NumericLiteral:d,StringLiteral:d,Variable:e,FunctionCall:k,UnaryExpression:c,BinaryExpression:b,ConditionalExpression:g};return h(a)};DG.formulaParser=(function(){function b(c){return'"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var a={parse:function(aP,aQ){var T={start:ah,SourceCharacter:aq,WhiteSpace:C,LineTerminator:ak,LineTerminatorSequence:z,Identifier:ad,IdentifierName:R,IdentifierStart:N,IdentifierPart:am,UnicodeLetter:aJ,ReservedWord:Y,Keyword:n,Literal:ar,BooleanLiteral:B,NumericLiteral:d,DecimalLiteral:p,DecimalIntegerLiteral:aI,DecimalDigits:O,DecimalDigit:u,NonZeroDigit:m,ExponentPart:aD,ExponentIndicator:F,SignedInteger:ai,HexDigit:t,StringLiteral:ae,DoubleStringCharacters:q,SingleStringCharacters:h,DoubleStringCharacter:P,SingleStringCharacter:av,EscapeSequence:aF,CharacterEscapeSequence:c,SingleEscapeCharacter:I,NonEscapeCharacter:V,EscapeCharacter:H,HexEscapeSequence:E,UnicodeEscapeSequence:aA,AndToken:aL,OrToken:J,FalseToken:au,TrueToken:aR,Ll:aC,Lm:aB,Lo:ay,Lt:ax,Lu:aw,Mc:ao,Mn:af,Nd:Q,Nl:K,Pc:s,Zs:M,_:U,__:az,PrimaryExpression:x,MemberExpression:y,CallExpression:aj,Arguments:W,ArgumentList:S,LeftHandSideExpression:i,UnaryExpression:ag,UnaryOperator:aG,PowerExpression:o,PowerOperator:ab,MultiplicativeExpression:g,MultiplicativeOperator:w,AdditiveExpression:al,AdditiveOperator:ac,RelationalExpression:j,RelationalOperator:k,EqualityExpression:v,EqualityOperator:an,LogicalANDExpression:aH,LogicalANDOperator:aO,LogicalORExpression:at,LogicalOROperator:aa,ConditionalExpression:f};if(aQ!==undefined){if(T[aQ]===undefined){throw new Error("Invalid rule name: "+b(aQ)+".")}}else{aQ="start"}var aE=0;var ap=0;var X=0;var A=[];function aN(aT,aX,aV){var aS=aT;var aW=aV-aT.length;for(var aU=0;aU<aW;aU++){aS=aX+aS}return aS}function aK(aU){var aT=aU.charCodeAt(0);var aS;var aV;if(aT<=255){aS="x";aV=2}else{aS="u";aV=4}return"\\"+aS+aN(aT.toString(16).toUpperCase(),"0",aV)}function G(aS){if(aE<X){return}if(aE>X){X=aE;A=[]}A.push(aS)}function ah(){var aV,aT,aS;var aW,aU;aW=aE;aU=aE;aV=az();if(aV!==null){aT=f();if(aT!==null){aS=az();if(aS!==null){aV=[aV,aT,aS]}else{aV=null;aE=aU}}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX,aY){return aY})(aW,aV[1])}if(aV===null){aE=aW}return aV}function aq(){var aS;if(aP.length>aE){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("any character")}}return aS}function C(){var aS;ap++;if(/^[\t\x0B\f \xA0]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[\\t\\x0B\\f \\xA0]")}}if(aS===null){aS=M()}ap--;if(ap===0&&aS===null){G("whitespace")}return aS}function ak(){var aS;if(/^[\n\r]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[\\n\\r]")}}return aS}function z(){var aS;ap++;if(aP.charCodeAt(aE)===10){aS="\n";aE++}else{aS=null;if(ap===0){G('"\\n"')}}if(aS===null){if(aP.substr(aE,2)==="\r\n"){aS="\r\n";aE+=2}else{aS=null;if(ap===0){G('"\\r\\n"')}}if(aS===null){if(aP.charCodeAt(aE)===13){aS="\r";aE++}else{aS=null;if(ap===0){G('"\\r"')}}}}ap--;if(ap===0&&aS===null){G("end of line")}return aS}function ad(){var aV,aT;var aW,aU,aS;ap++;aW=aE;aU=aE;aS=aE;ap++;aV=Y();ap--;if(aV===null){aV=""}else{aV=null;aE=aS}if(aV!==null){aT=R();if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aY,aX){return aX})(aW,aV[1])}if(aV===null){aE=aW}ap--;if(ap===0&&aV===null){G("identifier")}return aV}function R(){var aV,aT,aS;var aW,aU;ap++;aW=aE;aU=aE;aV=N();if(aV!==null){aT=[];aS=am();while(aS!==null){aT.push(aS);aS=am()}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aY,aZ,aX){return aZ+aX.join("")})(aW,aV[0],aV[1])}if(aV===null){aE=aW}ap--;if(ap===0&&aV===null){G("identifier")}return aV}function N(){var aS;aS=aJ();if(aS===null){if(aP.charCodeAt(aE)===95){aS="_";aE++}else{aS=null;if(ap===0){G('"_"')}}}return aS}function am(){var aS;aS=N();if(aS===null){aS=Q();if(aS===null){aS=s()}}return aS}function aJ(){var aS;aS=aw();if(aS===null){aS=aC()}return aS}function Y(){var aS;aS=n();if(aS===null){aS=B()}return aS}function n(){var aU,aS;var aV,aT;aV=aE;if(aP.substr(aE,4)==="else"){aU="else";aE+=4}else{aU=null;if(ap===0){G('"else"')}}if(aU===null){if(aP.substr(aE,2)==="if"){aU="if";aE+=2}else{aU=null;if(ap===0){G('"if"')}}if(aU===null){if(aP.substr(aE,6)==="switch"){aU="switch";aE+=6}else{aU=null;if(ap===0){G('"switch"')}}if(aU===null){if(aP.substr(aE,4)==="then"){aU="then";aE+=4}else{aU=null;if(ap===0){G('"then"')}}}}}if(aU!==null){aT=aE;ap++;aS=am();ap--;if(aS===null){aS=""}else{aS=null;aE=aT}if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aV}}else{aU=null;aE=aV}return aU}function ar(){var aS;var aT;aS=B();if(aS===null){aT=aE;aS=d();if(aS!==null){aS=(function(aV,aU){return{type:"NumericLiteral",value:aU}})(aT,aS)}if(aS===null){aE=aT}if(aS===null){aT=aE;aS=ae();if(aS!==null){aS=(function(aV,aU){return{type:"StringLiteral",value:aU}})(aT,aS)}if(aS===null){aE=aT}}}return aS}function B(){var aS;var aT;aT=aE;aS=aR();if(aS!==null){aS=(function(aU){return{type:"BooleanLiteral",value:true}})(aT)}if(aS===null){aE=aT}if(aS===null){aT=aE;aS=au();if(aS!==null){aS=(function(aU){return{type:"BooleanLiteral",value:false}})(aT)}if(aS===null){aE=aT}}return aS}function d(){var aV,aT;var aW,aU,aS;ap++;aW=aE;aU=aE;aV=p();if(aV!==null){aS=aE;ap++;aT=N();ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aY,aX){return aX})(aW,aV[0])}if(aV===null){aE=aW}ap--;if(ap===0&&aV===null){G("number")}return aV}function p(){var aW,aU,aT,aS;var aX,aV;aX=aE;aV=aE;aW=aI();if(aW!==null){if(aP.charCodeAt(aE)===46){aU=".";aE++}else{aU=null;if(ap===0){G('"."')}}if(aU!==null){aT=O();aT=aT!==null?aT:"";if(aT!==null){aS=aD();aS=aS!==null?aS:"";if(aS!==null){aW=[aW,aU,aT,aS]}else{aW=null;aE=aV}}else{aW=null;aE=aV}}else{aW=null;aE=aV}}else{aW=null;aE=aV}if(aW!==null){aW=(function(a1,aZ,a0,aY){return parseFloat(aZ+"."+a0+aY)})(aX,aW[0],aW[2],aW[3])}if(aW===null){aE=aX}if(aW===null){aX=aE;aV=aE;if(aP.charCodeAt(aE)===46){aW=".";aE++}else{aW=null;if(ap===0){G('"."')}}if(aW!==null){aU=O();if(aU!==null){aT=aD();aT=aT!==null?aT:"";if(aT!==null){aW=[aW,aU,aT]}else{aW=null;aE=aV}}else{aW=null;aE=aV}}else{aW=null;aE=aV}if(aW!==null){aW=(function(a0,aZ,aY){return parseFloat("."+aZ+aY)})(aX,aW[1],aW[2])}if(aW===null){aE=aX}if(aW===null){aX=aE;aV=aE;aW=aI();if(aW!==null){aU=aD();aU=aU!==null?aU:"";if(aU!==null){aW=[aW,aU]}else{aW=null;aE=aV}}else{aW=null;aE=aV}if(aW!==null){aW=(function(a0,aZ,aY){return parseFloat(aZ+aY)})(aX,aW[0],aW[1])}if(aW===null){aE=aX}}}return aW}function aI(){var aU,aS;var aV,aT;if(aP.charCodeAt(aE)===48){aU="0";aE++}else{aU=null;if(ap===0){G('"0"')}}if(aU===null){aV=aE;aT=aE;aU=m();if(aU!==null){aS=O();aS=aS!==null?aS:"";if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aT}}else{aU=null;aE=aT}if(aU!==null){aU=(function(aX,aY,aW){return aY+aW})(aV,aU[0],aU[1])}if(aU===null){aE=aV}}return aU}function O(){var aT,aS;var aU;aU=aE;aS=u();if(aS!==null){aT=[];while(aS!==null){aT.push(aS);aS=u()}}else{aT=null}if(aT!==null){aT=(function(aW,aV){return aV.join("")})(aU,aT)}if(aT===null){aE=aU}return aT}function u(){var aS;if(/^[0-9]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[0-9]")}}return aS}function m(){var aS;if(/^[1-9]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[1-9]")}}return aS}function aD(){var aU,aS;var aV,aT;aV=aE;aT=aE;aU=F();if(aU!==null){aS=ai();if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aT}}else{aU=null;aE=aT}if(aU!==null){aU=(function(aY,aW,aX){return aW+aX})(aV,aU[0],aU[1])}if(aU===null){aE=aV}return aU}function F(){var aS;if(/^[eE]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[eE]")}}return aS}function ai(){var aU,aS;var aV,aT;aV=aE;aT=aE;if(/^[\-+]/.test(aP.charAt(aE))){aU=aP.charAt(aE);aE++}else{aU=null;if(ap===0){G("[\\-+]")}}aU=aU!==null?aU:"";if(aU!==null){aS=O();if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aT}}else{aU=null;aE=aT}if(aU!==null){aU=(function(aY,aW,aX){return aW+aX})(aV,aU[0],aU[1])}if(aU===null){aE=aV}return aU}function t(){var aS;if(/^[0-9a-fA-F]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[0-9a-fA-F]")}}return aS}function ae(){var aV,aT,aS;var aW,aU;ap++;aW=aE;aU=aE;if(aP.charCodeAt(aE)===34){aV='"';aE++}else{aV=null;if(ap===0){G('"\\""')}}if(aV!==null){aT=q();aT=aT!==null?aT:"";if(aT!==null){if(aP.charCodeAt(aE)===34){aS='"';aE++}else{aS=null;if(ap===0){G('"\\""')}}if(aS!==null){aV=[aV,aT,aS]}else{aV=null;aE=aU}}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV===null){aU=aE;if(aP.charCodeAt(aE)===39){aV="'";aE++}else{aV=null;if(ap===0){G('"\'"')}}if(aV!==null){aT=h();aT=aT!==null?aT:"";if(aT!==null){if(aP.charCodeAt(aE)===39){aS="'";aE++}else{aS=null;if(ap===0){G('"\'"')}}if(aS!==null){aV=[aV,aT,aS]}else{aV=null;aE=aU}}else{aV=null;aE=aU}}else{aV=null;aE=aU}}if(aV!==null){aV=(function(aY,aX){return aX[1]})(aW,aV)}if(aV===null){aE=aW}ap--;if(ap===0&&aV===null){G("string")}return aV}function q(){var aT,aS;var aU;aU=aE;aS=P();if(aS!==null){aT=[];while(aS!==null){aT.push(aS);aS=P()}}else{aT=null}if(aT!==null){aT=(function(aW,aV){return aV.join("")})(aU,aT)}if(aT===null){aE=aU}return aT}function h(){var aT,aS;var aU;aU=aE;aS=av();if(aS!==null){aT=[];while(aS!==null){aT.push(aS);aS=av()}}else{aT=null}if(aT!==null){aT=(function(aW,aV){return aV.join("")})(aU,aT)}if(aT===null){aE=aU}return aT}function P(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;aS=aE;ap++;if(aP.charCodeAt(aE)===34){aV='"';aE++}else{aV=null;if(ap===0){G('"\\""')}}if(aV===null){if(aP.charCodeAt(aE)===92){aV="\\";aE++}else{aV=null;if(ap===0){G('"\\\\"')}}if(aV===null){aV=ak()}}ap--;if(aV===null){aV=""}else{aV=null;aE=aS}if(aV!==null){aT=aq();if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aY,aX){return aX})(aW,aV[1])}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.charCodeAt(aE)===92){aV="\\";aE++}else{aV=null;if(ap===0){G('"\\\\"')}}if(aV!==null){aT=aF();if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX,aY){return aY})(aW,aV[1])}if(aV===null){aE=aW}}return aV}function av(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;aS=aE;ap++;if(aP.charCodeAt(aE)===39){aV="'";aE++}else{aV=null;if(ap===0){G('"\'"')}}if(aV===null){if(aP.charCodeAt(aE)===92){aV="\\";aE++}else{aV=null;if(ap===0){G('"\\\\"')}}if(aV===null){aV=ak()}}ap--;if(aV===null){aV=""}else{aV=null;aE=aS}if(aV!==null){aT=aq();if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aY,aX){return aX})(aW,aV[1])}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.charCodeAt(aE)===92){aV="\\";aE++}else{aV=null;if(ap===0){G('"\\\\"')}}if(aV!==null){aT=aF();if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX,aY){return aY})(aW,aV[1])}if(aV===null){aE=aW}}return aV}function aF(){var aS;aS=c();if(aS===null){aS=E();if(aS===null){aS=aA()}}return aS}function c(){var aS;aS=I();if(aS===null){aS=V()}return aS}function I(){var aS;var aT;aT=aE;if(/^['"\\bfnrtv]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("['\"\\\\bfnrtv]")}}if(aS!==null){aS=(function(aV,aU){return aU.replace("b","\b").replace("f","\f").replace("n","\n").replace("r","\r").replace("t","\t").replace("v","\x0B")})(aT,aS)}if(aS===null){aE=aT}return aS}function V(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;aS=aE;ap++;aV=H();ap--;if(aV===null){aV=""}else{aV=null;aE=aS}if(aV===null){aV=ak()}if(aV!==null){aT=aq();if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aY,aX){return aX})(aW,aV[1])}if(aV===null){aE=aW}return aV}function H(){var aS;aS=I();if(aS===null){aS=u();if(aS===null){if(aP.charCodeAt(aE)===120){aS="x";aE++}else{aS=null;if(ap===0){G('"x"')}}if(aS===null){if(aP.charCodeAt(aE)===117){aS="u";aE++}else{aS=null;if(ap===0){G('"u"')}}}}}return aS}function E(){var aV,aT,aS;var aW,aU;aW=aE;aU=aE;if(aP.charCodeAt(aE)===120){aV="x";aE++}else{aV=null;if(ap===0){G('"x"')}}if(aV!==null){aT=t();if(aT!==null){aS=t();if(aS!==null){aV=[aV,aT,aS]}else{aV=null;aE=aU}}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aZ,aY,aX){return String.fromCharCode(parseInt("0x"+aY+aX))})(aW,aV[1],aV[2])}if(aV===null){aE=aW}return aV}function aA(){var aX,aV,aU,aT,aS;var aY,aW;aY=aE;aW=aE;if(aP.charCodeAt(aE)===117){aX="u";aE++}else{aX=null;if(ap===0){G('"u"')}}if(aX!==null){aV=t();if(aV!==null){aU=t();if(aU!==null){aT=t();if(aT!==null){aS=t();if(aS!==null){aX=[aX,aV,aU,aT,aS]}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}if(aX!==null){aX=(function(a3,a2,a1,a0,aZ){return String.fromCharCode(parseInt("0x"+a2+a1+a0+aZ))})(aY,aX[1],aX[2],aX[3],aX[4])}if(aX===null){aE=aY}return aX}function aL(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;if(aP.substr(aE,3)==="and"){aV="and";aE+=3}else{aV=null;if(ap===0){G('"and"')}}if(aV!==null){aS=aE;ap++;aT=am();ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"&&"})(aW)}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.substr(aE,3)==="AND"){aV="AND";aE+=3}else{aV=null;if(ap===0){G('"AND"')}}if(aV!==null){aS=aE;ap++;aT=am();ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"&&"})(aW)}if(aV===null){aE=aW}}return aV}function J(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;if(aP.substr(aE,2)==="or"){aV="or";aE+=2}else{aV=null;if(ap===0){G('"or"')}}if(aV!==null){aS=aE;ap++;aT=am();ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"||"})(aW)}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.substr(aE,2)==="OR"){aV="OR";aE+=2}else{aV=null;if(ap===0){G('"OR"')}}if(aV!==null){aS=aE;ap++;aT=am();ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"||"})(aW)}if(aV===null){aE=aW}}return aV}function au(){var aU,aS;var aV,aT;aV=aE;if(aP.substr(aE,5)==="false"){aU="false";aE+=5}else{aU=null;if(ap===0){G('"false"')}}if(aU!==null){aT=aE;ap++;aS=am();ap--;if(aS===null){aS=""}else{aS=null;aE=aT}if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aV}}else{aU=null;aE=aV}return aU}function aR(){var aU,aS;var aV,aT;aV=aE;if(aP.substr(aE,4)==="true"){aU="true";aE+=4}else{aU=null;if(ap===0){G('"true"')}}if(aU!==null){aT=aE;ap++;aS=am();ap--;if(aS===null){aS=""}else{aS=null;aE=aT}if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aV}}else{aU=null;aE=aV}return aU}function aC(){var aS;if(/^[a-z|\u03B1-\u03C9]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[a-z|\\u03B1-\\u03C9]")}}return aS}function aB(){var aS;if(/^(?!)/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[]")}}return aS}function ay(){var aS;if(/^(?!)/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[]")}}return aS}function ax(){var aS;if(/^(?!)/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[]")}}return aS}function aw(){var aS;if(/^[A-Z|\u0391-\u03A9]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[A-Z|\\u0391-\\u03A9]")}}return aS}function ao(){var aS;if(/^(?!)/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[]")}}return aS}function af(){var aS;if(/^(?!)/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[]")}}return aS}function Q(){var aS;if(/^[0-9]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[0-9]")}}return aS}function K(){var aS;if(/^(?!)/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[]")}}return aS}function s(){var aS;if(/^[_]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[_]")}}return aS}function M(){var aS;if(/^[ \xA0]/.test(aP.charAt(aE))){aS=aP.charAt(aE);aE++}else{aS=null;if(ap===0){G("[ \\xA0]")}}return aS}function U(){var aT,aS;aT=[];aS=C();while(aS!==null){aT.push(aS);aS=C()}return aT}function az(){var aT,aS;aT=[];aS=C();if(aS===null){aS=z()}while(aS!==null){aT.push(aS);aS=C();if(aS===null){aS=z()}}return aT}function x(){var aX,aV,aU,aT,aS;var aY,aW;aY=aE;aX=ad();if(aX!==null){aX=(function(a0,aZ){return{type:"Variable",name:aZ}})(aY,aX)}if(aX===null){aE=aY}if(aX===null){aX=ar();if(aX===null){aY=aE;aW=aE;if(aP.charCodeAt(aE)===40){aX="(";aE++}else{aX=null;if(ap===0){G('"("')}}if(aX!==null){aV=az();if(aV!==null){aU=f();if(aU!==null){aT=az();if(aT!==null){if(aP.charCodeAt(aE)===41){aS=")";aE++}else{aS=null;if(ap===0){G('")"')}}if(aS!==null){aX=[aX,aV,aU,aT,aS]}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}if(aX!==null){aX=(function(a0,aZ){return aZ})(aY,aX[2])}if(aX===null){aE=aY}}}return aX}function y(){var aS;aS=x();return aS}function aj(){var aY,aW,aU,aS;var aZ,aX,aV,aT;aZ=aE;aX=aE;aV=aE;aT=aE;aY=y();if(aY!==null){aW=az();if(aW!==null){aU=W();if(aU!==null){aY=[aY,aW,aU]}else{aY=null;aE=aT}}else{aY=null;aE=aT}}else{aY=null;aE=aT}if(aY!==null){aY=(function(a2,a1,a0){return{type:"FunctionCall",name:a1,args:a0}})(aV,aY[0],aY[2])}if(aY===null){aE=aV}if(aY!==null){aW=[];aV=aE;aT=aE;aU=az();if(aU!==null){aS=W();if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aT}}else{aU=null;aE=aT}if(aU!==null){aU=(function(a1,a0){return{type:"FunctionCallArguments",args:a0}})(aV,aU[1])}if(aU===null){aE=aV}while(aU!==null){aW.push(aU);aV=aE;aT=aE;aU=az();if(aU!==null){aS=W();if(aS!==null){aU=[aU,aS]}else{aU=null;aE=aT}}else{aU=null;aE=aT}if(aU!==null){aU=(function(a1,a0){return{type:"FunctionCallArguments",args:a0}})(aV,aU[1])}if(aU===null){aE=aV}}if(aW!==null){aY=[aY,aW]}else{aY=null;aE=aX}}else{aY=null;aE=aX}if(aY!==null){aY=(function(a4,a3,a2){var a0=a3;for(var a1=0;a1<a2.length;a1++){switch(a2[a1].type){case"FunctionCallArguments":a0={type:"FunctionCall",name:a0,args:a2[a1].args};break;default:throw new Error("Invalid expression type: "+a2[a1].type)}}return a0})(aZ,aY[0],aY[1])}if(aY===null){aE=aZ}return aY}function W(){var aX,aV,aU,aT,aS;var aY,aW;aY=aE;aW=aE;if(aP.charCodeAt(aE)===40){aX="(";aE++}else{aX=null;if(ap===0){G('"("')}}if(aX!==null){aV=az();if(aV!==null){aU=S();aU=aU!==null?aU:"";if(aU!==null){aT=az();if(aT!==null){if(aP.charCodeAt(aE)===41){aS=")";aE++}else{aS=null;if(ap===0){G('")"')}}if(aS!==null){aX=[aX,aV,aU,aT,aS]}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}}else{aX=null;aE=aW}if(aX!==null){aX=(function(a0,aZ){return aZ!==""?aZ:[]})(aY,aX[2])}if(aX===null){aE=aY}return aX}function S(){var aX,aW,aV,aU,aT,aS;var a0,aZ,aY;a0=aE;aZ=aE;aX=f();if(aX!==null){aW=[];aY=aE;aV=az();if(aV!==null){if(aP.charCodeAt(aE)===44){aU=",";aE++}else{aU=null;if(ap===0){G('","')}}if(aU!==null){aT=az();if(aT!==null){aS=f();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}while(aV!==null){aW.push(aV);aY=aE;aV=az();if(aV!==null){if(aP.charCodeAt(aE)===44){aU=",";aE++}else{aU=null;if(ap===0){G('","')}}if(aU!==null){aT=az();if(aT!==null){aS=f();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}if(aW!==null){aX=[aX,aW]}else{aX=null;aE=aZ}}else{aX=null;aE=aZ}if(aX!==null){aX=(function(a5,a4,a2){var a1=[a4];for(var a3=0;a3<a2.length;a3++){a1.push(a2[a3][3])}return a1})(a0,aX[0],aX[1])}if(aX===null){aE=a0}return aX}function i(){var aS;aS=aj();if(aS===null){aS=y()}return aS}function ag(){var aV,aT,aS;var aW,aU;aV=i();if(aV===null){aW=aE;aU=aE;aV=aG();if(aV!==null){aT=az();if(aT!==null){aS=ag();if(aS!==null){aV=[aV,aT,aS]}else{aV=null;aE=aU}}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aZ,aX,aY){return{type:"UnaryExpression",operator:aX,expression:aY}})(aW,aV[0],aV[2])}if(aV===null){aE=aW}}return aV}function aG(){var aS;var aT;if(aP.charCodeAt(aE)===43){aS="+";aE++}else{aS=null;if(ap===0){G('"+"')}}if(aS===null){if(aP.charCodeAt(aE)===45){aS="-";aE++}else{aS=null;if(ap===0){G('"-"')}}if(aS===null){aT=aE;if(aP.charCodeAt(aE)===8722){aS="\u2212";aE++}else{aS=null;if(ap===0){G('"\\u2212"')}}if(aS!==null){aS=(function(aU){return"-"})(aT)}if(aS===null){aE=aT}if(aS===null){if(aP.charCodeAt(aE)===33){aS="!";aE++}else{aS=null;if(ap===0){G('"!"')}}}}}return aS}function o(){var aY,aW,aU,aT,aS;var aZ,aX,aV;aZ=aE;aX=aE;aY=[];aV=aE;aW=az();if(aW!==null){aU=ag();if(aU!==null){aT=az();if(aT!==null){aS=ab();if(aS!==null){aW=[aW,aU,aT,aS]}else{aW=null;aE=aV}}else{aW=null;aE=aV}}else{aW=null;aE=aV}}else{aW=null;aE=aV}while(aW!==null){aY.push(aW);aV=aE;aW=az();if(aW!==null){aU=ag();if(aU!==null){aT=az();if(aT!==null){aS=ab();if(aS!==null){aW=[aW,aU,aT,aS]}else{aW=null;aE=aV}}else{aW=null;aE=aV}}else{aW=null;aE=aV}}else{aW=null;aE=aV}}if(aY!==null){aW=ag();if(aW!==null){aY=[aY,aW]}else{aY=null;aE=aX}}else{aY=null;aE=aX}if(aY!==null){aY=(function(a4,a3,a1){var a0=a1;for(var a2=a3.length-1;a2>=0;a2--){a0={type:"BinaryExpression",operator:"^",left:a3[a2][1],right:a0}}return a0})(aZ,aY[0],aY[1])}if(aY===null){aE=aZ}return aY}function ab(){var aS;if(aP.charCodeAt(aE)===94){aS="^";aE++}else{aS=null;if(ap===0){G('"^"')}}return aS}function g(){var aX,aW,aV,aU,aT,aS;var a0,aZ,aY;a0=aE;aZ=aE;aX=o();if(aX!==null){aW=[];aY=aE;aV=az();if(aV!==null){aU=w();if(aU!==null){aT=az();if(aT!==null){aS=o();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}while(aV!==null){aW.push(aV);aY=aE;aV=az();if(aV!==null){aU=w();if(aU!==null){aT=az();if(aT!==null){aS=o();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}if(aW!==null){aX=[aX,aW]}else{aX=null;aE=aZ}}else{aX=null;aE=aZ}if(aX!==null){aX=(function(a5,a4,a2){var a1=a4;for(var a3=0;a3<a2.length;a3++){a1={type:"BinaryExpression",operator:a2[a3][1],left:a1,right:a2[a3][3]}}return a1})(a0,aX[0],aX[1])}if(aX===null){aE=a0}return aX}function w(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;if(aP.charCodeAt(aE)===42){aV="*";aE++}else{aV=null;if(ap===0){G('"*"')}}if(aV===null){if(aP.charCodeAt(aE)===47){aV="/";aE++}else{aV=null;if(ap===0){G('"/"')}}if(aV===null){if(aP.charCodeAt(aE)===37){aV="%";aE++}else{aV=null;if(ap===0){G('"%"')}}}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aY,aX){return aX})(aW,aV[0])}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.charCodeAt(aE)===215){aV="\xD7";aE++}else{aV=null;if(ap===0){G('"\\xD7"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"*"})(aW)}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.charCodeAt(aE)===247){aV="\xF7";aE++}else{aV=null;if(ap===0){G('"\\xF7"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"/"})(aW)}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.charCodeAt(aE)===8901){aV="\u22C5";aE++}else{aV=null;if(ap===0){G('"\\u22C5"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"*"})(aW)}if(aV===null){aE=aW}}}}return aV}function al(){var aX,aW,aV,aU,aT,aS;var a0,aZ,aY;a0=aE;aZ=aE;aX=g();if(aX!==null){aW=[];aY=aE;aV=az();if(aV!==null){aU=ac();if(aU!==null){aT=az();if(aT!==null){aS=g();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}while(aV!==null){aW.push(aV);aY=aE;aV=az();if(aV!==null){aU=ac();if(aU!==null){aT=az();if(aT!==null){aS=g();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}if(aW!==null){aX=[aX,aW]}else{aX=null;aE=aZ}}else{aX=null;aE=aZ}if(aX!==null){aX=(function(a5,a4,a2){var a1=a4;for(var a3=0;a3<a2.length;a3++){a1={type:"BinaryExpression",operator:a2[a3][1],left:a1,right:a2[a3][3]}}return a1})(a0,aX[0],aX[1])}if(aX===null){aE=a0}return aX}function ac(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;if(aP.charCodeAt(aE)===43){aV="+";aE++}else{aV=null;if(ap===0){G('"+"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===43){aT="+";aE++}else{aT=null;if(ap===0){G('"+"')}}if(aT===null){if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"+"})(aW)}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.charCodeAt(aE)===45){aV="-";aE++}else{aV=null;if(ap===0){G('"-"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===45){aT="-";aE++}else{aT=null;if(ap===0){G('"-"')}}if(aT===null){if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"-"})(aW)}if(aV===null){aE=aW}if(aV===null){aW=aE;aU=aE;if(aP.charCodeAt(aE)===8722){aV="\u2212";aE++}else{aV=null;if(ap===0){G('"\\u2212"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===8722){aT="\u2212";aE++}else{aT=null;if(ap===0){G('"\\u2212"')}}if(aT===null){if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"-"})(aW)}if(aV===null){aE=aW}}}return aV}function j(){var aX,aW,aV,aU,aT,aS;var a0,aZ,aY;a0=aE;aZ=aE;aX=al();if(aX!==null){aW=[];aY=aE;aV=az();if(aV!==null){aU=k();if(aU!==null){aT=az();if(aT!==null){aS=al();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}while(aV!==null){aW.push(aV);aY=aE;aV=az();if(aV!==null){aU=k();if(aU!==null){aT=az();if(aT!==null){aS=al();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}if(aW!==null){aX=[aX,aW]}else{aX=null;aE=aZ}}else{aX=null;aE=aZ}if(aX!==null){aX=(function(a5,a4,a2){var a1=a4;for(var a3=0;a3<a2.length;a3++){a1={type:"BinaryExpression",operator:a2[a3][1],left:a1,right:a2[a3][3]}}return a1})(a0,aX[0],aX[1])}if(aX===null){aE=a0}return aX}function k(){var aS;var aT;if(aP.substr(aE,2)==="<="){aS="<=";aE+=2}else{aS=null;if(ap===0){G('"<="')}}if(aS===null){if(aP.substr(aE,2)===">="){aS=">=";aE+=2}else{aS=null;if(ap===0){G('">="')}}if(aS===null){if(aP.charCodeAt(aE)===60){aS="<";aE++}else{aS=null;if(ap===0){G('"<"')}}if(aS===null){if(aP.charCodeAt(aE)===62){aS=">";aE++}else{aS=null;if(ap===0){G('">"')}}if(aS===null){aT=aE;if(aP.charCodeAt(aE)===8804){aS="\u2264";aE++}else{aS=null;if(ap===0){G('"\\u2264"')}}if(aS!==null){aS=(function(aU){return"<="})(aT)}if(aS===null){aE=aT}if(aS===null){aT=aE;if(aP.charCodeAt(aE)===8805){aS="\u2265";aE++}else{aS=null;if(ap===0){G('"\\u2265"')}}if(aS!==null){aS=(function(aU){return">="})(aT)}if(aS===null){aE=aT}}}}}}return aS}function v(){var aX,aW,aV,aU,aT,aS;var a0,aZ,aY;a0=aE;aZ=aE;aX=j();if(aX!==null){aW=[];aY=aE;aV=az();if(aV!==null){aU=an();if(aU!==null){aT=az();if(aT!==null){aS=j();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}while(aV!==null){aW.push(aV);aY=aE;aV=az();if(aV!==null){aU=an();if(aU!==null){aT=az();if(aT!==null){aS=j();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}if(aW!==null){aX=[aX,aW]}else{aX=null;aE=aZ}}else{aX=null;aE=aZ}if(aX!==null){aX=(function(a5,a4,a2){var a1=a4;for(var a3=0;a3<a2.length;a3++){a1={type:"BinaryExpression",operator:a2[a3][1],left:a1,right:a2[a3][3]}}return a1})(a0,aX[0],aX[1])}if(aX===null){aE=a0}return aX}function an(){var aS;var aT;aT=aE;if(aP.charCodeAt(aE)===61){aS="=";aE++}else{aS=null;if(ap===0){G('"="')}}if(aS!==null){aS=(function(aU){return"==="})(aT)}if(aS===null){aE=aT}if(aS===null){aT=aE;if(aP.substr(aE,2)==="!="){aS="!=";aE+=2}else{aS=null;if(ap===0){G('"!="')}}if(aS!==null){aS=(function(aU){return"!=="})(aT)}if(aS===null){aE=aT}if(aS===null){aT=aE;if(aP.charCodeAt(aE)===8800){aS="\u2260";aE++}else{aS=null;if(ap===0){G('"\\u2260"')}}if(aS!==null){aS=(function(aU){return"!=="})(aT)}if(aS===null){aE=aT}}}return aS}function aH(){var aX,aW,aV,aU,aT,aS;var a0,aZ,aY;a0=aE;aZ=aE;aX=v();if(aX!==null){aW=[];aY=aE;aV=az();if(aV!==null){aU=aO();if(aU!==null){aT=az();if(aT!==null){aS=v();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}while(aV!==null){aW.push(aV);aY=aE;aV=az();if(aV!==null){aU=aO();if(aU!==null){aT=az();if(aT!==null){aS=v();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}if(aW!==null){aX=[aX,aW]}else{aX=null;aE=aZ}}else{aX=null;aE=aZ}if(aX!==null){aX=(function(a5,a4,a2){var a1=a4;for(var a3=0;a3<a2.length;a3++){a1={type:"BinaryExpression",operator:a2[a3][1],left:a1,right:a2[a3][3]}}return a1})(a0,aX[0],aX[1])}if(aX===null){aE=a0}return aX}function aO(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;if(aP.charCodeAt(aE)===38){aV="&";aE++}else{aV=null;if(ap===0){G('"&"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"&&"})(aW)}if(aV===null){aE=aW}if(aV===null){aV=aL()}return aV}function at(){var aX,aW,aV,aU,aT,aS;var a0,aZ,aY;a0=aE;aZ=aE;aX=aH();if(aX!==null){aW=[];aY=aE;aV=az();if(aV!==null){aU=aa();if(aU!==null){aT=az();if(aT!==null){aS=aH();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}while(aV!==null){aW.push(aV);aY=aE;aV=az();if(aV!==null){aU=aa();if(aU!==null){aT=az();if(aT!==null){aS=aH();if(aS!==null){aV=[aV,aU,aT,aS]}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}else{aV=null;aE=aY}}if(aW!==null){aX=[aX,aW]}else{aX=null;aE=aZ}}else{aX=null;aE=aZ}if(aX!==null){aX=(function(a5,a4,a2){var a1=a4;for(var a3=0;a3<a2.length;a3++){a1={type:"BinaryExpression",operator:a2[a3][1],left:a1,right:a2[a3][3]}}return a1})(a0,aX[0],aX[1])}if(aX===null){aE=a0}return aX}function aa(){var aV,aT;var aW,aU,aS;aW=aE;aU=aE;if(aP.charCodeAt(aE)===124){aV="|";aE++}else{aV=null;if(ap===0){G('"|"')}}if(aV!==null){aS=aE;ap++;if(aP.charCodeAt(aE)===61){aT="=";aE++}else{aT=null;if(ap===0){G('"="')}}ap--;if(aT===null){aT=""}else{aT=null;aE=aS}if(aT!==null){aV=[aV,aT]}else{aV=null;aE=aU}}else{aV=null;aE=aU}if(aV!==null){aV=(function(aX){return"||"})(aW)}if(aV===null){aE=aW}if(aV===null){aV=J()}return aV}function f(){var aZ,aY,aX,aW,aV,aU,aT,aS,a2;var a1,a0;a1=aE;a0=aE;aZ=at();if(aZ!==null){aY=az();if(aY!==null){if(aP.charCodeAt(aE)===63){aX="?";aE++}else{aX=null;if(ap===0){G('"?"')}}if(aX!==null){aW=az();if(aW!==null){aV=f();if(aV!==null){aU=az();if(aU!==null){if(aP.charCodeAt(aE)===58){aT=":";aE++}else{aT=null;if(ap===0){G('":"')}}if(aT!==null){aS=az();if(aS!==null){a2=f();if(a2!==null){aZ=[aZ,aY,aX,aW,aV,aU,aT,aS,a2]}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}}else{aZ=null;aE=a0}if(aZ!==null){aZ=(function(a5,a6,a3,a4){return{type:"ConditionalExpression",condition:a6,trueExpression:a3,falseExpression:a4}})(a1,aZ[0],aZ[4],aZ[8])}if(aZ===null){aE=a1}if(aZ===null){aZ=at()}return aZ}function D(aU){aU.sort();var aV=null;var aT=[];for(var aS=0;aS<aU.length;aS++){if(aU[aS]!==aV){aT.push(aU[aS]);aV=aU[aS]}}return aT}function r(){var aS=1;var aV=1;var aW=false;for(var aT=0;aT<Math.max(aE,X);aT++){var aU=aP.charAt(aT);if(aU==="\n"){if(!aW){aS++}aV=1;aW=false}else{if(aU==="\r"||aU==="\u2028"||aU==="\u2029"){aS++;aV=1;aW=true}else{aV++;aW=false}}}return{line:aS,column:aV}}var aM=T[aQ]();if(aM===null||aE!==aP.length){var l=Math.max(aE,X);var Z=l<aP.length?aP.charAt(l):null;var e=r();throw new this.SyntaxError(D(A),Z,l,e.line,e.column)}return aM},toSource:function(){return this._source}};a.SyntaxError=function(f,g,h,d,e){function c(k,l){var i,j;switch(k.length){case 0:i="end of input";break;case 1:i=k[0];break;default:i=k.slice(0,k.length-1).join(", ")+" or "+k[k.length-1]}j=l?b(l):"end of input";return"Expected "+i+" but "+j+" found."}this.name="SyntaxError";this.expected=f;this.found=g;this.message=c(f,g);this.offset=h;this.line=d;this.column=e};a.SyntaxError.prototype=Error.prototype;return a})();sc_require("formula/aggregate_function");sc_require("formula/collection_formula_context");DG.LookupAggFns={first:DG.AggregateFunction.create({requiredArgs:{min:1,max:1},evaluate:function(c,b,a){var e=a.argFns[0];function d(k,i){var h=i._case_,n=h&&h.get("parent"),m=n?n.get("children"):k&&k.getPath("collection.cases"),g=h&&h.get("children"),j=m&&m.firstObject(),l=j?{_case_:j,_id_:j.get("id")}:null;if(g){l._childCase_=g.firstObject()}return l}var f=e&&d(c,b);return f?e(c,f):undefined}}),last:DG.AggregateFunction.create({requiredArgs:{min:1,max:1},evaluate:function(e,d,c){var f=c.argFns[0];function b(k,j){var i=j._case_,n=i&&i.get("parent"),m=n?n.get("children"):k&&k.getPath("collection.cases"),h=i&&i.get("children"),g=m&&m.lastObject(),l=g?{_case_:g,_id_:g.get("id")}:null;if(h){l._childCase_=h.lastObject()}return l}var a=f&&b(e,d);return a?f(e,a):undefined}}),next:DG.AggregateFunction.create({requiredArgs:{min:1,max:2},evaluate:function(e,b,a){var f=a.argFns[0],g=a.argFns[1];function d(l,k){var n=k._case_&&k._case_.get("parent"),j=n&&n.get("children"),i=j&&j.get("length"),h=l.getCaseIndex(k._id_),m=j&&(h<i)?j.objectAt(h):null;return m?{_case_:m,_id_:m.get("id")}:null}var c=f&&d(e,b);return c?f(e,c):g?g(e,b):undefined}}),prev:DG.AggregateFunction.create({requiredArgs:{min:1,max:2},evaluate:function(e,d,c){var f=c.argFns[0],g=c.argFns[1];function b(k,j){var l=j._case_&&j._case_.get("parent"),i=l&&l.get("children"),h=k.getCaseIndex(j._id_),m=i&&(h>=2)?i.objectAt(h-2):null;return m?{_case_:m,_id_:m.get("id")}:null}var a=f&&b(e,d);return a?f(e,a):g?g(e,d):undefined}})};DG.CollectionFormulaContext.registerAggFnModule(DG.LookupAggFns);sc_require("formula/aggregate_function");sc_require("formula/collection_formula_context");DG.UnivariateStatsFns={count:DG.ParentCaseAggregate.create({requiredArgs:{min:0,max:1},evalCase:function(c,b,a,f){var e=a.argFns[0],d=e&&e(c,b);if(!e||(!SC.none(d)&&(d!==false))){if(a.results[f]){++a.results[f]}else{a.results[f]=1}}}}),min:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(d,c,b,g){var f=b.argFns[0],e=f&&f(d,c);if(isFinite(e)){var a=b.caches[g];if(a){if(a.min>e){a.min=e}}else{b.caches[g]={min:e}}}},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(e,d){a.results[e]=d.min});return this.queryCache(c,b,a)}}),max:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(d,c,b,g){var f=b.argFns[0],e=f&&f(d,c);if(isFinite(e)){var a=b.caches[g];if(a){if(a.max<e){a.max=e}}else{b.caches[g]={max:e}}}},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(e,d){a.results[e]=d.max});return this.queryCache(c,b,a)}}),mean:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(d,c,b,g){var f=b.argFns[0],e=f&&f(d,c);if(isFinite(e)){var a=b.caches[g];if(a){a.count+=1;a.sum+=e}else{b.caches[g]={count:1,sum:e}}}},computeResults:function(c,b,a){DG.ObjectMap.forEach(a.caches,function(e,d){a.results[e]=d.count>0?d.sum/d.count:null});return this.queryCache(c,b,a)}}),median:DG.SortDataFunction.create({requiredArgs:{min:1,max:1},extractResult:function(a){return DG.MathUtilities.medianOfNumericArray(a)}}),sum:DG.ParentCaseAggregate.create({requiredArgs:{min:1,max:1},evalCase:function(c,b,a,f){var e=a.argFns[0],d=e&&e(c,b);if(isFinite(d)){if(a.results[f]){a.results[f]+=d}else{a.results[f]=d}}}})};DG.CollectionFormulaContext.registerAggFnModule(DG.UnivariateStatsFns);
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
(function(a){a.URL=a.URL||a.webkitURL;if(a.Blob&&a.URL){try{new Blob;return}catch(c){}}var b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||(function(o){var f=function(x){return Object.prototype.toString.call(x).match(/^\[object\s(.*)\]$/)[1]},w=function l(){this.data=[]},v=function h(z,x,y){this.data=z;this.size=z.length;this.type=x;this.encoding=y},p=w.prototype,u=v.prototype,r=o.FileReaderSync,d=function(x){this.code=this[this.name=x]},q=("NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR").split(" "),t=q.length,k=o.URL||o.webkitURL||o,s=k.createObjectURL,e=k.revokeObjectURL,j=k,n=o.btoa,i=o.atob,g=o.ArrayBuffer,m=o.Uint8Array;v.fake=u.fake=true;while(t--){d.prototype[q[t]]=t+1}if(!k.createObjectURL){j=o.URL={}}j.createObjectURL=function(y){var z=y.type,x;if(z===null){z="application/octet-stream"}if(y instanceof v){x="data:"+z;if(y.encoding==="base64"){return x+";base64,"+y.data}else{if(y.encoding==="URI"){return x+","+decodeURIComponent(y.data)}}if(n){return x+";base64,"+n(y.data)}else{return x+","+encodeURIComponent(y.data)}}else{if(s){return s.call(k,y)}}};j.revokeObjectURL=function(x){if(x.substring(0,5)!=="data:"&&e){e.call(k,x)}};p.append=function(B){var D=this.data;if(m&&(B instanceof g||B instanceof m)){var C="",y=new m(B),z=0,A=y.length;for(;z<A;z++){C+=String.fromCharCode(y[z])}D.push(C)}else{if(f(B)==="Blob"||f(B)==="File"){if(r){var x=new r;D.push(x.readAsBinaryString(B))}else{throw new d("NOT_READABLE_ERR")}}else{if(B instanceof v){if(B.encoding==="base64"&&i){D.push(i(B.data))}else{if(B.encoding==="URI"){D.push(decodeURIComponent(B.data))}else{if(B.encoding==="raw"){D.push(B.data)}}}}else{if(typeof B!=="string"){B+=""}D.push(unescape(encodeURIComponent(B)))}}}};p.getBlob=function(x){if(!arguments.length){x=null}return new v(this.data.join(""),x,"raw")};p.toString=function(){return"[object BlobBuilder]"};u.slice=function(A,x,z){var y=arguments.length;if(y<3){z=null}return new v(this.data.slice(A,y>1?x:this.data.length),z,this.encoding)};u.toString=function(){return"[object Blob]"};u.close=function(){this.size=0;delete this.data};return w}(a));a.Blob=function(g,f){var j=f?(f.type||""):"";var e=new b();if(g){for(var h=0,d=g.length;h<d;h++){e.append(g[h])}}return e.getBlob(j)}}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content||this));
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))||(function(m){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var n=m.document,j=function(){return m.URL||m.webkitURL||m},p=n.createElementNS("http://www.w3.org/1999/xhtml","a"),c=!m.externalHost&&"download" in p,q=function(s){var r=n.createEvent("MouseEvents");r.initMouseEvent("click",true,false,m,0,0,0,0,0,false,false,false,false,0,null);s.dispatchEvent(r)},g=m.webkitRequestFileSystem,o=m.requestFileSystem||g||m.mozRequestFileSystem,d=function(r){(m.setImmediate||m.setTimeout)(function(){throw r},0)},l="application/octet-stream",i=0,h=[],f=function(){var s=h.length;while(s--){var r=h[s];if(typeof r==="string"){j().revokeObjectURL(r)}else{r.remove()}}h.length=0},k=function(s,r,v){r=[].concat(r);var u=r.length;while(u--){var w=s["on"+r[u]];if(typeof w==="function"){try{w.call(s,v||s)}catch(t){d(t)}}}},b=function(s,t){var u=this,A=s.type,D=false,w,v,r=function(){var E=j().createObjectURL(s);h.push(E);return E},z=function(){k(u,"writestart progress write writeend".split(" "))},C=function(){if(D||!w){w=r(s)}if(v){v.location.href=w}else{window.open(w,"_blank")}u.readyState=u.DONE;z()},y=function(E){return function(){if(u.readyState!==u.DONE){return E.apply(this,arguments)}}},x={create:true,exclusive:false},B;u.readyState=u.INIT;if(!t){t="download"}if(c){w=r(s);p.href=w;p.download=t;q(p);u.readyState=u.DONE;z();return}if(m.chrome&&A&&A!==l){B=s.slice||s.webkitSlice;s=B.call(s,0,s.size,l);D=true}if(g&&t!=="download"){t+=".download"}if(A===l||g){v=m}if(!o){C();return}i+=s.size;o(m.TEMPORARY,i,y(function(E){E.root.getDirectory("saved",x,y(function(F){var G=function(){F.getFile(t,x,y(function(H){H.createWriter(y(function(I){I.onwriteend=function(J){v.location.href=H.toURL();h.push(H);u.readyState=u.DONE;k(u,"writeend",J)};I.onerror=function(){var J=I.error;if(J.code!==J.ABORT_ERR){C()}};"writestart progress write abort".split(" ").forEach(function(J){I["on"+J]=u["on"+J]});I.write(s);u.abort=function(){I.abort();u.readyState=u.DONE};u.readyState=u.WRITING}),C)}),C)};F.getFile(t,{create:false},y(function(H){H.remove();G()}),y(function(H){if(H.code===H.NOT_FOUND_ERR){G()}else{C()}}))}),C)}),C)},a=b.prototype,e=function(r,s){return new b(r,s)};a.abort=function(){var r=this;r.readyState=r.DONE;k(r,"abort")};a.readyState=a.INIT=0;a.WRITING=1;a.DONE=2;a.error=a.onwritestart=a.onprogress=a.onwrite=a.onabort=a.onerror=a.onwriteend=null;m.addEventListener("unload",f,false);e.unload=function(){f();m.removeEventListener("unload",f,false)};return e}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content));if(typeof module!=="undefined"&&module!==null){module.exports=saveAs}else{if((typeof define!=="undefined"&&define!==null)&&(define.amd!=null)){define([],function(){return saveAs});
/*! 
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
}}(function(d){d.fn.drag=function(c,f,i){var h=typeof c=="string"?c:"",g=d.isFunction(c)?c:d.isFunction(f)?f:null;if(h.indexOf("drag")!==0){h="drag"+h}i=(c==g?f:i)||{};return g?this.bind(h,i,g):this.trigger(h)};var a=d.event,b=a.special,e=b.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",livekey:"livedrag",add:function(c){var f=d.data(this,e.datakey),g=c.data||{};f.related+=1;if(!f.live&&c.selector){f.live=true;a.add(this,"draginit."+e.livekey,e.delegate)}d.each(e.defaults,function(h){if(g[h]!==undefined){f[h]=g[h]}})},remove:function(){d.data(this,e.datakey).related-=1},setup:function(){if(!d.data(this,e.datakey)){var c=d.extend({related:0},e.defaults);d.data(this,e.datakey,c);a.add(this,"mousedown",e.init,c);this.attachEvent&&this.attachEvent("ondragstart",e.dontstart)}},teardown:function(){if(!d.data(this,e.datakey).related){d.removeData(this,e.datakey);a.remove(this,"mousedown",e.init);a.remove(this,"draginit",e.delegate);e.textselect(true);this.detachEvent&&this.detachEvent("ondragstart",e.dontstart)}},init:function(c){var f=c.data,g;if(!(f.which>0&&c.which!=f.which)){if(!d(c.target).is(f.not)){if(!(f.handle&&!d(c.target).closest(f.handle,c.currentTarget).length)){f.propagates=1;f.interactions=[e.interaction(this,f)];f.target=c.target;f.pageX=c.pageX;f.pageY=c.pageY;f.dragging=null;g=e.hijack(c,"draginit",f);if(f.propagates){if((g=e.flatten(g))&&g.length){f.interactions=[];d.each(g,function(){f.interactions.push(e.interaction(this,f))})}f.propagates=f.interactions.length;f.drop!==false&&b.drop&&b.drop.handler(c,f);e.textselect(false);a.add(document,"mousemove mouseup",e.handler,f);return false}}}}},interaction:function(c,f){return{drag:c,callback:new e.callback,droppable:[],offset:d(c)[f.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(c){var f=c.data;switch(c.type){case !f.dragging&&"mousemove":if(Math.pow(c.pageX-f.pageX,2)+Math.pow(c.pageY-f.pageY,2)<Math.pow(f.distance,2)){break}c.target=f.target;e.hijack(c,"dragstart",f);if(f.propagates){f.dragging=true}case"mousemove":if(f.dragging){e.hijack(c,"drag",f);if(f.propagates){f.drop!==false&&b.drop&&b.drop.handler(c,f);break}c.type="mouseup"}case"mouseup":a.remove(document,"mousemove mouseup",e.handler);if(f.dragging){f.drop!==false&&b.drop&&b.drop.handler(c,f);e.hijack(c,"dragend",f)}e.textselect(true);if(f.click===false&&f.dragging){jQuery.event.triggered=true;setTimeout(function(){jQuery.event.triggered=false},20);f.dragging=false}break}},delegate:function(c){var f=[],h,g=d.data(this,"events")||{};d.each(g.live||[],function(i,l){if(l.preType.indexOf("drag")===0){if(h=d(c.target).closest(l.selector,c.currentTarget)[0]){a.add(h,l.origType+"."+e.livekey,l.origHandler,l.data);d.inArray(h,f)<0&&f.push(h)}}});if(!f.length){return false}return d(f).bind("dragend."+e.livekey,function(){a.remove(this,"."+e.livekey)})},hijack:function(u,v,t,s,p){if(t){var q={event:u.originalEvent,type:u.type},f=v.indexOf("drop")?"drag":"drop",i,c=s||0,r,h;s=!isNaN(s)?s:t.interactions.length;u.type=v;u.originalEvent=null;t.results=[];do{if(r=t.interactions[c]){if(!(v!=="dragend"&&r.cancelled)){h=e.properties(u,t,r);r.results=[];d(p||r[f]||t.droppable).each(function(g,j){i=(h.target=j)?a.handle.call(j,u,h):null;if(i===false){if(f=="drag"){r.cancelled=true;t.propagates-=1}if(v=="drop"){r[f][g]=null}}else{if(v=="dropinit"){r.droppable.push(e.element(i)||j)}}if(v=="dragstart"){r.proxy=d(e.element(i)||r.drag)[0]}r.results.push(i);delete u.result;if(v!=="dropinit"){return i}});t.results[c]=e.flatten(r.results);if(v=="dropinit"){r.droppable=e.flatten(r.droppable)}v=="dragstart"&&!r.cancelled&&h.update()}}}while(++c<s);u.type=q.type;u.originalEvent=q.event;return e.flatten(t.results)}},properties:function(c,f,h){var g=h.callback;g.drag=h.drag;g.proxy=h.proxy||h.drag;g.startX=f.pageX;g.startY=f.pageY;g.deltaX=c.pageX-f.pageX;g.deltaY=c.pageY-f.pageY;g.originalX=h.offset.left;g.originalY=h.offset.top;g.offsetX=c.pageX-(f.pageX-g.originalX);g.offsetY=c.pageY-(f.pageY-g.originalY);g.drop=e.flatten((h.drop||[]).slice());g.available=e.flatten((h.droppable||[]).slice());return g},element:function(c){if(c&&(c.jquery||c.nodeType==1)){return c}},flatten:function(c){return d.map(c,function(f){return f&&f.jquery?d.makeArray(f):f&&f.length?e.flatten(f):f})},textselect:function(c){d(document)[c?"unbind":"bind"]("selectstart",e.dontstart).attr("unselectable",c?"off":"on").css("MozUserSelect",c?"":"none")},dontstart:function(){return false},callback:function(){}};e.callback.prototype={update:function(){b.drop&&this.available.length&&d.each(this.available,function(c){b.drop.locate(this,c)})}};b.draginit=b.dragstart=b.dragend=e})(jQuery);(function(d,b,g){var e=d.L,a={};a.version="0.7.2";if(typeof module==="object"&&typeof module.exports==="object"){module.exports=a}else{if(typeof define==="function"&&define.amd){define(a)}}a.noConflict=function(){d.L=e;return this};d.L=a;a.Util={extend:function(m){var l=Array.prototype.slice.call(arguments,1),n,k,h,o;for(k=0,h=l.length;k<h;k++){o=l[k]||{};for(n in o){if(o.hasOwnProperty(n)){m[n]=o[n]}}}return m},bind:function(i,j){var h=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return i.apply(j,h||arguments)}},stamp:(function(){var i=0,h="_leaflet_id";return function(j){j[h]=j[h]||++i;return j[h]}}()),invokeEach:function(l,m,k){var j,h;if(typeof l==="object"){h=Array.prototype.slice.call(arguments,3);for(j in l){m.apply(k,[j,l[j]].concat(h))}return true}return false},limitExecByInterval:function(k,m,j){var i,l;return function h(){var n=arguments;if(i){l=true;return}i=true;setTimeout(function(){i=false;if(l){h.apply(j,n);l=false}},m);k.apply(j,n)}},falseFn:function(){return false},formatNum:function(h,j){var i=Math.pow(10,j||5);return Math.round(h*i)/i},trim:function(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")},splitWords:function(h){return a.Util.trim(h).split(/\s+/)},setOptions:function(i,h){i.options=a.extend({},i.options,h);return i.options},getParamString:function(l,h,j){var m=[];for(var k in l){m.push(encodeURIComponent(j?k.toUpperCase():k)+"="+encodeURIComponent(l[k]))}return((!h||h.indexOf("?")===-1)?"?":"&")+m.join("&")},template:function(i,h){return i.replace(/\{ *([\w_]+) *\}/g,function(l,j){var k=h[j];if(k===g){throw new Error("No value provided for variable "+l)}else{if(typeof k==="function"){k=k(h)}}return k})},isArray:Array.isArray||function(h){return(Object.prototype.toString.call(h)==="[object Array]")},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function k(m){var n,o,p=["webkit","moz","o","ms"];for(n=0;n<p.length&&!o;n++){o=d[p[n]+m]}return o}var l=0;function i(m){var o=+new Date(),n=Math.max(0,16-(o-l));l=o+n;return d.setTimeout(m,n)}var h=d.requestAnimationFrame||k("RequestAnimationFrame")||i;var j=d.cancelAnimationFrame||k("CancelAnimationFrame")||k("CancelRequestAnimationFrame")||function(m){d.clearTimeout(m)};a.Util.requestAnimFrame=function(p,o,m,n){p=a.bind(p,o);if(m&&h===i){p()}else{return h.call(d,p,n)}};a.Util.cancelAnimFrame=function(m){if(m){j.call(d,m)}}}());a.extend=a.Util.extend;a.bind=a.Util.bind;a.stamp=a.Util.stamp;a.setOptions=a.Util.setOptions;a.Class=function(){};a.Class.extend=function(k){var n=function(){if(this.initialize){this.initialize.apply(this,arguments)}if(this._initHooks){this.callInitHooks()}};var m=function(){};m.prototype=this.prototype;var l=new m();l.constructor=n;n.prototype=l;for(var h in this){if(this.hasOwnProperty(h)&&h!=="prototype"){n[h]=this[h]}}if(k.statics){a.extend(n,k.statics);delete k.statics}if(k.includes){a.Util.extend.apply(null,[l].concat(k.includes));delete k.includes}if(k.options&&l.options){k.options=a.extend({},l.options,k.options)}a.extend(l,k);l._initHooks=[];var j=this;n.__super__=j.prototype;l.callInitHooks=function(){if(this._initHooksCalled){return}if(j.prototype.callInitHooks){j.prototype.callInitHooks.call(this)}this._initHooksCalled=true;for(var p=0,o=l._initHooks.length;p<o;p++){l._initHooks[p].call(this)}};return n};a.Class.include=function(h){a.extend(this.prototype,h)};a.Class.mergeOptions=function(h){a.extend(this.prototype.options,h)};a.Class.addInitHook=function(i){var h=Array.prototype.slice.call(arguments,1);var j=typeof i==="function"?i:function(){this[i].apply(this,h)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(j)};var f="_leaflet_events";a.Mixin={};a.Mixin.Events={addEventListener:function(n,s,j){if(a.Util.invokeEach(n,this.addEventListener,this,s,j)){return this}var t=this[f]=this[f]||{},m=j&&j!==this&&a.stamp(j),l,o,h,r,k,q,p;n=a.Util.splitWords(n);for(l=0,o=n.length;l<o;l++){h={action:s,context:j||this};r=n[l];if(m){k=r+"_idx";q=k+"_len";p=t[k]=t[k]||{};if(!p[m]){p[m]=[];t[q]=(t[q]||0)+1}p[m].push(h)}else{t[r]=t[r]||[];t[r].push(h)}}return this},hasEventListeners:function(i){var h=this[f];return !!h&&((i in h&&h[i].length>0)||(i+"_idx" in h&&h[i+"_idx_len"]>0))},removeEventListener:function(p,v,h){if(!this[f]){return this}if(!p){return this.clearAllEventListeners()}if(a.Util.invokeEach(p,this.removeEventListener,this,v,h)){return this}var w=this[f],n=h&&h!==this&&a.stamp(h),m,q,u,t,k,l,s,r,o;p=a.Util.splitWords(p);for(m=0,q=p.length;m<q;m++){u=p[m];l=u+"_idx";s=l+"_len";r=w[l];if(!v){delete w[u];delete w[l];delete w[s]}else{t=n&&r?r[n]:w[u];if(t){for(k=t.length-1;k>=0;k--){if((t[k].action===v)&&(!h||(t[k].context===h))){o=t.splice(k,1);o[0].action=a.Util.falseFn}}if(h&&r&&(t.length===0)){delete r[n];w[s]--}}}}return this},clearAllEventListeners:function(){delete this[f];return this},fireEvent:function(o,j){if(!this.hasEventListeners(o)){return this}var h=a.Util.extend({},j,{type:o,target:this});var q=this[f],p,k,m,n,l;if(q[o]){p=q[o].slice();for(k=0,m=p.length;k<m;k++){p[k].action.call(p[k].context,h)}}n=q[o+"_idx"];for(l in n){p=n[l].slice();if(p){for(k=0,m=p.length;k<m;k++){p[k].action.call(p[k].context,h)}}}return this},addOneTimeEventListener:function(i,k,h){if(a.Util.invokeEach(i,this.addOneTimeEventListener,this,k,h)){return this}var j=a.bind(function(){this.removeEventListener(i,k,h).removeEventListener(i,j,h)},this);return this.addEventListener(i,k,h).addEventListener(i,j,h)}};a.Mixin.Events.on=a.Mixin.Events.addEventListener;a.Mixin.Events.off=a.Mixin.Events.removeEventListener;a.Mixin.Events.once=a.Mixin.Events.addOneTimeEventListener;a.Mixin.Events.fire=a.Mixin.Events.fireEvent;(function(){var t="ActiveXObject" in d,y=t&&!b.addEventListener,x=navigator.userAgent.toLowerCase(),h=x.indexOf("webkit")!==-1,s=x.indexOf("chrome")!==-1,j=x.indexOf("phantom")!==-1,z=x.indexOf("android")!==-1,r=x.search("android [23]")!==-1,p=x.indexOf("gecko")!==-1,l=typeof orientation!==g+"",k=d.navigator&&d.navigator.msPointerEnabled&&d.navigator.msMaxTouchPoints&&!d.PointerEvent,u=(d.PointerEvent&&d.navigator.pointerEnabled&&d.navigator.maxTouchPoints)||k,i=("devicePixelRatio" in d&&d.devicePixelRatio>1)||("matchMedia" in d&&d.matchMedia("(min-resolution:144dpi)")&&d.matchMedia("(min-resolution:144dpi)").matches),A=b.documentElement,v=t&&("transition" in A.style),q=("WebKitCSSMatrix" in d)&&("m11" in new d.WebKitCSSMatrix())&&!r,n="MozPerspective" in A.style,w="OTransition" in A.style,o=!d.L_DISABLE_3D&&(v||q||n||w)&&!j;var m=!d.L_NO_TOUCH&&!j&&(function(){var C="ontouchstart";if(u||(C in A)){return true}var D=b.createElement("div"),B=false;if(!D.setAttribute){return false}D.setAttribute(C,"return;");if(typeof D[C]==="function"){B=true}D.removeAttribute(C);D=null;return B}());a.Browser={ie:t,ielt9:y,webkit:h,gecko:p&&!h&&!d.opera&&!t,android:z,android23:r,chrome:s,ie3d:v,webkit3d:q,gecko3d:n,opera3d:w,any3d:o,mobile:l,mobileWebkit:l&&h,mobileWebkit3d:l&&q,mobileOpera:l&&d.opera,touch:m,msPointer:k,pointer:u,retina:i}}());a.Point=function(h,j,i){this.x=(i?Math.round(h):h);this.y=(i?Math.round(j):j)};a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},add:function(h){return this.clone()._add(a.point(h))},_add:function(h){this.x+=h.x;this.y+=h.y;return this},subtract:function(h){return this.clone()._subtract(a.point(h))},_subtract:function(h){this.x-=h.x;this.y-=h.y;return this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){this.x/=h;this.y/=h;return this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){this.x*=h;this.y*=h;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},distanceTo:function(i){i=a.point(i);var h=i.x-this.x,j=i.y-this.y;return Math.sqrt(h*h+j*j)},equals:function(h){h=a.point(h);return h.x===this.x&&h.y===this.y},contains:function(h){h=a.point(h);return Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+a.Util.formatNum(this.x)+", "+a.Util.formatNum(this.y)+")"}};a.point=function(h,j,i){if(h instanceof a.Point){return h}if(a.Util.isArray(h)){return new a.Point(h[0],h[1])}if(h===g||h===null){return h}return new a.Point(h,j,i)};a.Bounds=function(k,j){if(!k){return}var m=j?[k,j]:k;for(var l=0,h=m.length;l<h;l++){this.extend(m[l])}};a.Bounds.prototype={extend:function(h){h=a.point(h);if(!this.min&&!this.max){this.min=h.clone();this.max=h.clone()}else{this.min.x=Math.min(h.x,this.min.x);this.max.x=Math.max(h.x,this.max.x);this.min.y=Math.min(h.y,this.min.y);this.max.y=Math.max(h.y,this.max.y)}return this},getCenter:function(h){return new a.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return new a.Point(this.min.x,this.max.y)},getTopRight:function(){return new a.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(j){var i,h;if(typeof j[0]==="number"||j instanceof a.Point){j=a.point(j)}else{j=a.bounds(j)}if(j instanceof a.Bounds){i=j.min;h=j.max}else{i=h=j}return(i.x>=this.min.x)&&(h.x<=this.max.x)&&(i.y>=this.min.y)&&(h.y<=this.max.y)},intersects:function(m){m=a.bounds(m);var k=this.min,h=this.max,l=m.min,i=m.max,j=(i.x>=k.x)&&(l.x<=h.x),n=(i.y>=k.y)&&(l.y<=h.y);return j&&n},isValid:function(){return !!(this.min&&this.max)}};a.bounds=function(i,h){if(!i||i instanceof a.Bounds){return i}return new a.Bounds(i,h)};a.Transformation=function(i,h,k,j){this._a=i;this._b=h;this._c=k;this._d=j};a.Transformation.prototype={transform:function(h,i){return this._transform(h.clone(),i)},_transform:function(h,i){i=i||1;h.x=i*(this._a*h.x+this._b);h.y=i*(this._c*h.y+this._d);return h},untransform:function(h,i){i=i||1;return new a.Point((h.x/i-this._b)/this._a,(h.y/i-this._d)/this._c)}};a.DomUtil={get:function(h){return(typeof h==="string"?b.getElementById(h):h)},getStyle:function(j,i){var k=j.style[i];if(!k&&j.currentStyle){k=j.currentStyle[i]}if((!k||k==="auto")&&b.defaultView){var h=b.defaultView.getComputedStyle(j,null);k=h?h[i]:null}return k==="auto"?null:k},getViewportOffset:function(m){var p=0,l=0,k=m,n=b.body,j=b.documentElement,o;do{p+=k.offsetTop||0;l+=k.offsetLeft||0;p+=parseInt(a.DomUtil.getStyle(k,"borderTopWidth"),10)||0;l+=parseInt(a.DomUtil.getStyle(k,"borderLeftWidth"),10)||0;o=a.DomUtil.getStyle(k,"position");if(k.offsetParent===n&&o==="absolute"){break}if(o==="fixed"){p+=n.scrollTop||j.scrollTop||0;l+=n.scrollLeft||j.scrollLeft||0;break}if(o==="relative"&&!k.offsetLeft){var i=a.DomUtil.getStyle(k,"width"),q=a.DomUtil.getStyle(k,"max-width"),h=k.getBoundingClientRect();if(i!=="none"||q!=="none"){l+=h.left+k.clientLeft}p+=h.top+(n.scrollTop||j.scrollTop||0);break}k=k.offsetParent}while(k);k=m;do{if(k===n){break}p-=k.scrollTop||0;l-=k.scrollLeft||0;k=k.parentNode}while(k);return new a.Point(l,p)},documentIsLtr:function(){if(!a.DomUtil._docIsLtrCached){a.DomUtil._docIsLtrCached=true;a.DomUtil._docIsLtr=a.DomUtil.getStyle(b.body,"direction")==="ltr"}return a.DomUtil._docIsLtr},create:function(i,k,h){var j=b.createElement(i);j.className=k;if(h){h.appendChild(j)}return j},hasClass:function(j,h){if(j.classList!==g){return j.classList.contains(h)}var i=a.DomUtil._getClass(j);return i.length>0&&new RegExp("(^|\\s)"+h+"(\\s|$)").test(i)},addClass:function(n,j){if(n.classList!==g){var l=a.Util.splitWords(j);for(var k=0,h=l.length;k<h;k++){n.classList.add(l[k])}}else{if(!a.DomUtil.hasClass(n,j)){var m=a.DomUtil._getClass(n);a.DomUtil._setClass(n,(m?m+" ":"")+j)}}},removeClass:function(i,h){if(i.classList!==g){i.classList.remove(h)}else{a.DomUtil._setClass(i,a.Util.trim((" "+a.DomUtil._getClass(i)+" ").replace(" "+h+" "," ")))}},_setClass:function(i,h){if(i.className.baseVal===g){i.className=h}else{i.className.baseVal=h}},_getClass:function(h){return h.className.baseVal===g?h.className:h.className.baseVal},setOpacity:function(j,k){if("opacity" in j.style){j.style.opacity=k}else{if("filter" in j.style){var i=false,h="DXImageTransform.Microsoft.Alpha";try{i=j.filters.item(h)}catch(l){if(k===1){return}}k=Math.round(k*100);if(i){i.Enabled=(k!==100);i.Opacity=k}else{j.style.filter+=" progid:"+h+"(opacity="+k+")"}}}},testProp:function(k){var j=b.documentElement.style;for(var h=0;h<k.length;h++){if(k[h] in j){return k[h]}}return false},getTranslateString:function(h){var j=a.Browser.webkit3d,i="translate"+(j?"3d":"")+"(",k=(j?",0":"")+")";return i+h.x+"px,"+h.y+"px"+k},getScaleString:function(j,h){var k=a.DomUtil.getTranslateString(h.add(h.multiplyBy(-1*j))),i=" scale("+j+") ";return k+i},setPosition:function(j,h,i){j._leaflet_pos=h;if(!i&&a.Browser.any3d){j.style[a.DomUtil.TRANSFORM]=a.DomUtil.getTranslateString(h)}else{j.style.left=h.x+"px";j.style.top=h.y+"px"}},getPosition:function(h){return h._leaflet_pos}};a.DomUtil.TRANSFORM=a.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);a.DomUtil.TRANSITION=a.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);a.DomUtil.TRANSITION_END=a.DomUtil.TRANSITION==="webkitTransition"||a.DomUtil.TRANSITION==="OTransition"?a.DomUtil.TRANSITION+"End":"transitionend";(function(){if("onselectstart" in b){a.extend(a.DomUtil,{disableTextSelection:function(){a.DomEvent.on(d,"selectstart",a.DomEvent.preventDefault)},enableTextSelection:function(){a.DomEvent.off(d,"selectstart",a.DomEvent.preventDefault)}})}else{var h=a.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);a.extend(a.DomUtil,{disableTextSelection:function(){if(h){var i=b.documentElement.style;this._userSelect=i[h];i[h]="none"}},enableTextSelection:function(){if(h){b.documentElement.style[h]=this._userSelect;delete this._userSelect}}})}a.extend(a.DomUtil,{disableImageDrag:function(){a.DomEvent.on(d,"dragstart",a.DomEvent.preventDefault)},enableImageDrag:function(){a.DomEvent.off(d,"dragstart",a.DomEvent.preventDefault)}})})();a.LatLng=function(j,h,i){j=parseFloat(j);h=parseFloat(h);if(isNaN(j)||isNaN(h)){throw new Error("Invalid LatLng object: ("+j+", "+h+")")}this.lat=j;this.lng=h;if(i!==g){this.alt=parseFloat(i)}};a.extend(a.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9});a.LatLng.prototype={equals:function(i){if(!i){return false}i=a.latLng(i);var h=Math.max(Math.abs(this.lat-i.lat),Math.abs(this.lng-i.lng));return h<=a.LatLng.MAX_MARGIN},toString:function(h){return"LatLng("+a.Util.formatNum(this.lat,h)+", "+a.Util.formatNum(this.lng,h)+")"},distanceTo:function(o){o=a.latLng(o);var n=6378137,k=a.LatLng.DEG_TO_RAD,p=(o.lat-this.lat)*k,h=(o.lng-this.lng)*k,m=this.lat*k,j=o.lat*k,l=Math.sin(p/2),i=Math.sin(h/2);var q=l*l+i*i*Math.cos(m)*Math.cos(j);return n*2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q))},wrap:function(i,h){var j=this.lng;i=i||-180;h=h||180;j=(j+h)%(h-i)+(j<i||j===h?h:i);return new a.LatLng(this.lat,j)}};a.latLng=function(i,h){if(i instanceof a.LatLng){return i}if(a.Util.isArray(i)){if(typeof i[0]==="number"||typeof i[0]==="string"){return new a.LatLng(i[0],i[1],i[2])}else{return null}}if(i===g||i===null){return i}if(typeof i==="object"&&"lat" in i){return new a.LatLng(i.lat,"lng" in i?i.lng:i.lon)}if(h===g){return null}return new a.LatLng(i,h)};a.LatLngBounds=function(m,k){if(!m){return}var j=k?[m,k]:m;for(var l=0,h=j.length;l<h;l++){this.extend(j[l])}};a.LatLngBounds.prototype={extend:function(i){if(!i){return this}var h=a.latLng(i);if(h!==null){i=h}else{i=a.latLngBounds(i)}if(i instanceof a.LatLng){if(!this._southWest&&!this._northEast){this._southWest=new a.LatLng(i.lat,i.lng);this._northEast=new a.LatLng(i.lat,i.lng)}else{this._southWest.lat=Math.min(i.lat,this._southWest.lat);this._southWest.lng=Math.min(i.lng,this._southWest.lng);this._northEast.lat=Math.max(i.lat,this._northEast.lat);this._northEast.lng=Math.max(i.lng,this._northEast.lng)}}else{if(i instanceof a.LatLngBounds){this.extend(i._southWest);this.extend(i._northEast)}}return this},pad:function(k){var i=this._southWest,l=this._northEast,h=Math.abs(i.lat-l.lat)*k,j=Math.abs(i.lng-l.lng)*k;return new a.LatLngBounds(new a.LatLng(i.lat-h,i.lng-j),new a.LatLng(l.lat+h,l.lng+j))},getCenter:function(){return new a.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new a.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new a.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(l){if(typeof l[0]==="number"||l instanceof a.LatLng){l=a.latLng(l)}else{l=a.latLngBounds(l)}var h=this._southWest,k=this._northEast,i,j;if(l instanceof a.LatLngBounds){i=l.getSouthWest();j=l.getNorthEast()}else{i=j=l}return(i.lat>=h.lat)&&(j.lat<=k.lat)&&(i.lng>=h.lng)&&(j.lng<=k.lng)},intersects:function(k){k=a.latLngBounds(k);var h=this._southWest,n=this._northEast,i=k.getSouthWest(),m=k.getNorthEast(),l=(m.lat>=h.lat)&&(i.lat<=n.lat),j=(m.lng>=h.lng)&&(i.lng<=n.lng);return l&&j},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h){if(!h){return false}h=a.latLngBounds(h);return this._southWest.equals(h.getSouthWest())&&this._northEast.equals(h.getNorthEast())},isValid:function(){return !!(this._southWest&&this._northEast)}};a.latLngBounds=function(i,h){if(!i||i instanceof a.LatLngBounds){return i}return new a.LatLngBounds(i,h)};a.Projection={};a.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(m){var k=a.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,j=Math.max(Math.min(i,m.lat),-i),h=m.lng*k,l=j*k;l=Math.log(Math.tan((Math.PI/4)+(l/2)));return new a.Point(h,l)},unproject:function(h){var k=a.LatLng.RAD_TO_DEG,i=h.x*k,j=(2*Math.atan(Math.exp(h.y))-(Math.PI/2))*k;return new a.LatLng(j,i)}};a.Projection.LonLat={project:function(h){return new a.Point(h.lng,h.lat)},unproject:function(h){return new a.LatLng(h.y,h.x)}};a.CRS={latLngToPoint:function(k,i){var h=this.projection.project(k),j=this.scale(i);return this.transformation._transform(h,j)},pointToLatLng:function(h,j){var k=this.scale(j),i=this.transformation.untransform(h,k);return this.projection.unproject(i)},project:function(h){return this.projection.project(h)},scale:function(h){return 256*Math.pow(2,h)},getSize:function(i){var h=this.scale(i);return a.point(h,h)}};a.CRS.Simple=a.extend({},a.CRS,{projection:a.Projection.LonLat,transformation:new a.Transformation(1,0,-1,0),scale:function(h){return Math.pow(2,h)}});a.CRS.EPSG3857=a.extend({},a.CRS,{code:"EPSG:3857",projection:a.Projection.SphericalMercator,transformation:new a.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(j){var i=this.projection.project(j),h=6378137;return i.multiplyBy(h)}});a.CRS.EPSG900913=a.extend({},a.CRS.EPSG3857,{code:"EPSG:900913"});a.CRS.EPSG4326=a.extend({},a.CRS,{code:"EPSG:4326",projection:a.Projection.LonLat,transformation:new a.Transformation(1/360,0.5,-1/360,0.5)});a.Map=a.Class.extend({includes:a.Mixin.Events,options:{crs:a.CRS.EPSG3857,fadeAnimation:a.DomUtil.TRANSITION&&!a.Browser.android23,trackResize:true,markerZoomAnimation:a.DomUtil.TRANSITION&&a.Browser.any3d},initialize:function(i,h){h=a.setOptions(this,h);this._initContainer(i);this._initLayout();this._onResize=a.bind(this._onResize,this);this._initEvents();if(h.maxBounds){this.setMaxBounds(h.maxBounds)}if(h.center&&h.zoom!==g){this.setView(a.latLng(h.center),h.zoom,{reset:true})}this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(h.layers)},setView:function(h,i){i=i===g?this.getZoom():i;this._resetView(a.latLng(h),this._limitZoom(i));return this},setZoom:function(i,h){if(!this._loaded){this._zoom=this._limitZoom(i);return this}return this.setView(this.getCenter(),i,{zoom:h})},zoomIn:function(i,h){return this.setZoom(this._zoom+(i||1),h)},zoomOut:function(i,h){return this.setZoom(this._zoom-(i||1),h)},setZoomAround:function(o,m,l){var n=this.getZoomScale(m),k=this.getSize().divideBy(2),j=o instanceof a.Point?o:this.latLngToContainerPoint(o),h=j.subtract(k).multiplyBy(1-1/n),i=this.containerPointToLatLng(k.add(h));return this.setView(i,m,{zoom:l})},fitBounds:function(i,p){p=p||{};i=i.getBounds?i.getBounds():a.latLngBounds(i);var k=a.point(p.paddingTopLeft||p.padding||[0,0]),j=a.point(p.paddingBottomRight||p.padding||[0,0]),o=this.getBoundsZoom(i,false,k.add(j)),m=j.subtract(k).divideBy(2),n=this.project(i.getSouthWest(),o),l=this.project(i.getNorthEast(),o),h=this.unproject(n.add(l).divideBy(2).add(m),o);o=p&&p.maxZoom?Math.min(p.maxZoom,o):o;return this.setView(h,o,p)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,i){return this.setView(h,this._zoom,{pan:i})},panBy:function(h){this.fire("movestart");this._rawPanBy(a.point(h));this.fire("move");return this.fire("moveend")},setMaxBounds:function(h){h=a.latLngBounds(h);this.options.maxBounds=h;if(!h){return this.off("moveend",this._panInsideMaxBounds,this)}if(this._loaded){this._panInsideMaxBounds()}return this.on("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(k,j){var h=this.getCenter(),i=this._limitCenter(h,this._zoom,k);if(h.equals(i)){return this}return this.panTo(i,j)},addLayer:function(h){var i=a.stamp(h);if(this._layers[i]){return this}this._layers[i]=h;if(h.options&&(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))){this._zoomBoundLayers[i]=h;this._updateZoomLevels()}if(this.options.zoomAnimation&&a.TileLayer&&(h instanceof a.TileLayer)){this._tileLayersNum++;this._tileLayersToLoad++;h.on("load",this._onTileLayerLoad,this)}if(this._loaded){this._layerAdd(h)}return this},removeLayer:function(h){var i=a.stamp(h);if(!this._layers[i]){return this}if(this._loaded){h.onRemove(this)}delete this._layers[i];if(this._loaded){this.fire("layerremove",{layer:h})}if(this._zoomBoundLayers[i]){delete this._zoomBoundLayers[i];this._updateZoomLevels()}if(this.options.zoomAnimation&&a.TileLayer&&(h instanceof a.TileLayer)){this._tileLayersNum--;this._tileLayersToLoad--;h.off("load",this._onTileLayerLoad,this)}return this},hasLayer:function(h){if(!h){return false}return(a.stamp(h) in this._layers)},eachLayer:function(k,j){for(var h in this._layers){k.call(j,this._layers[h])}return this},invalidateSize:function(j){if(!this._loaded){return this}j=a.extend({animate:false,pan:true},j===true?{animate:true}:j);var k=this.getSize();this._sizeChanged=true;this._initialCenter=null;var i=this.getSize(),m=k.divideBy(2).round(),h=i.divideBy(2).round(),l=m.subtract(h);if(!l.x&&!l.y){return this}if(j.animate&&j.pan){this.panBy(l)}else{if(j.pan){this._rawPanBy(l)}this.fire("move");if(j.debounceMoveend){clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(a.bind(this.fire,this,"moveend"),200)}else{this.fire("moveend")}}return this.fire("resize",{oldSize:k,newSize:i})},addHandler:function(h,j){if(!j){return this}var i=this[h]=new j(this);this._handlers.push(i);if(this.options[h]){i.enable()}return this},remove:function(){if(this._loaded){this.fire("unload")}this._initEvents("off");try{delete this._container._leaflet}catch(h){this._container._leaflet=g}this._clearPanes();if(this._clearControlPos){this._clearControlPos()}this._clearHandlers();return this},getCenter:function(){this._checkIfLoaded();if(this._initialCenter&&!this._moved()){return this._initialCenter}return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var i=this.getPixelBounds(),h=this.unproject(i.getBottomLeft()),j=this.unproject(i.getTopRight());return new a.LatLngBounds(h,j)},getMinZoom:function(){return this.options.minZoom===g?(this._layersMinZoom===g?0:this._layersMinZoom):this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===g?(this._layersMaxZoom===g?Infinity:this._layersMaxZoom):this.options.maxZoom},getBoundsZoom:function(h,i,m){h=a.latLngBounds(h);var o=this.getMinZoom()-(i?1:0),n=this.getMaxZoom(),q=this.getSize(),k=h.getNorthWest(),l=h.getSouthEast(),j=true,p;m=a.point(m||[0,0]);do{o++;p=this.project(l,o).subtract(this.project(k,o)).add(m);j=!i?q.contains(p):p.x<q.x||p.y<q.y}while(j&&o<=n);if(j&&i){return null}return i?o:o-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new a.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=false}return this._size.clone()},getPixelBounds:function(){var h=this._getTopLeftPoint();return new a.Bounds(h,h.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(i){var h=this.options.crs;return h.scale(i)/h.scale(this._zoom)},getScaleZoom:function(h){return this._zoom+(Math.log(h)/Math.LN2)},project:function(i,h){h=h===g?this._zoom:h;return this.options.crs.latLngToPoint(a.latLng(i),h)},unproject:function(h,i){i=i===g?this._zoom:i;return this.options.crs.pointToLatLng(a.point(h),i)},layerPointToLatLng:function(h){var i=a.point(h).add(this.getPixelOrigin());return this.unproject(i)},latLngToLayerPoint:function(i){var h=this.project(a.latLng(i))._round();return h._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(h){return a.point(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return a.point(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var i=this.containerPointToLayerPoint(a.point(h));return this.layerPointToLatLng(i)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(a.latLng(h)))},mouseEventToContainerPoint:function(h){return a.DomEvent.getMousePosition(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(i){var h=this._container=a.DomUtil.get(i);if(!h){throw new Error("Map container not found.")}else{if(h._leaflet){throw new Error("Map container is already initialized.")}}h._leaflet=true},_initLayout:function(){var i=this._container;a.DomUtil.addClass(i,"leaflet-container"+(a.Browser.touch?" leaflet-touch":"")+(a.Browser.retina?" leaflet-retina":"")+(a.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var h=a.DomUtil.getStyle(i,"position");if(h!=="absolute"&&h!=="relative"&&h!=="fixed"){i.style.position="relative"}this._initPanes();if(this._initControlPos){this._initControlPos()}},_initPanes:function(){var i=this._panes={};this._mapPane=i.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=i.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);i.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);i.shadowPane=this._createPane("leaflet-shadow-pane");i.overlayPane=this._createPane("leaflet-overlay-pane");i.markerPane=this._createPane("leaflet-marker-pane");i.popupPane=this._createPane("leaflet-popup-pane");var h=" leaflet-zoom-hide";if(!this.options.markerZoomAnimation){a.DomUtil.addClass(i.markerPane,h);a.DomUtil.addClass(i.shadowPane,h);a.DomUtil.addClass(i.popupPane,h)}},_createPane:function(i,h){return a.DomUtil.create("div",i,h||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(k){k=k?(a.Util.isArray(k)?k:[k]):[];for(var j=0,h=k.length;j<h;j++){this.addLayer(k[j])}},_resetView:function(j,l,i,k){var h=(this._zoom!==l);if(!k){this.fire("movestart");if(h){this.fire("zoomstart")}}this._zoom=l;this._initialCenter=j;this._initialTopLeftPoint=this._getNewTopLeftPoint(j);if(!i){a.DomUtil.setPosition(this._mapPane,new a.Point(0,0))}else{this._initialTopLeftPoint._add(this._getMapPanePos())}this._tileLayersToLoad=this._tileLayersNum;var m=!this._loaded;this._loaded=true;if(m){this.fire("load");this.eachLayer(this._layerAdd,this)}this.fire("viewreset",{hard:!i});this.fire("move");if(h||k){this.fire("zoomend")}this.fire("moveend",{hard:!i})},_rawPanBy:function(h){a.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var k,m=Infinity,h=-Infinity,l=this._getZoomSpan();for(k in this._zoomBoundLayers){var j=this._zoomBoundLayers[k];if(!isNaN(j.options.minZoom)){m=Math.min(m,j.options.minZoom)}if(!isNaN(j.options.maxZoom)){h=Math.max(h,j.options.maxZoom)}}if(k===g){this._layersMaxZoom=this._layersMinZoom=g}else{this._layersMaxZoom=h;this._layersMinZoom=m}if(l!==this._getZoomSpan()){this.fire("zoomlevelschange")}},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.")}},_initEvents:function(j){if(!a.DomEvent){return}j=j||"on";a.DomEvent[j](this._container,"click",this._onMouseClick,this);var l=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"],k,h;for(k=0,h=l.length;k<h;k++){a.DomEvent[j](this._container,l[k],this._fireMouseEvent,this)}if(this.options.trackResize){a.DomEvent[j](d,"resize",this._onResize,this)}},_onResize:function(){a.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=a.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:true})},this,false,this._container)},_onMouseClick:function(h){if(!this._loaded||(!h._simulated&&((this.dragging&&this.dragging.moved())||(this.boxZoom&&this.boxZoom.moved())))||a.DomEvent._skipped(h)){return}this.fire("preclick");this._fireMouseEvent(h)},_fireMouseEvent:function(k){if(!this._loaded||a.DomEvent._skipped(k)){return}var j=k.type;j=(j==="mouseenter"?"mouseover":(j==="mouseleave"?"mouseout":j));if(!this.hasEventListeners(j)){return}if(j==="contextmenu"){a.DomEvent.preventDefault(k)}var i=this.mouseEventToContainerPoint(k),h=this.containerPointToLayerPoint(i),l=this.layerPointToLatLng(h);this.fire(j,{latlng:l,layerPoint:h,containerPoint:i,originalEvent:k})},_onTileLayerLoad:function(){this._tileLayersToLoad--;if(this._tileLayersNum&&!this._tileLayersToLoad){this.fire("tilelayersload")}},_clearHandlers:function(){for(var j=0,h=this._handlers.length;j<h;j++){this._handlers[j].disable()}},whenReady:function(i,h){if(this._loaded){i.call(h||this,this)}else{this.on("load",i,h)}return this},_layerAdd:function(h){h.onAdd(this);this.fire("layeradd",{layer:h})},_getMapPanePos:function(){return a.DomUtil.getPosition(this._mapPane)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(h,j){var i=this.getSize()._divideBy(2);return this.project(h,j)._subtract(i)._round()},_latLngToNewLayerPoint:function(k,i,h){var j=this._getNewTopLeftPoint(h,i).add(this._getMapPanePos());return this.project(k,i)._subtract(j)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,k,j){if(!j){return h}var n=this.project(h,k),i=this.getSize().divideBy(2),l=new a.Bounds(n.subtract(i),n.add(i)),m=this._getBoundsOffset(l,j,k);return this.unproject(n.add(m),k)},_limitOffset:function(k,h){if(!h){return k}var j=this.getPixelBounds(),i=new a.Bounds(j.min.add(k),j.max.add(k));return k.add(this._getBoundsOffset(i,h))},_getBoundsOffset:function(k,i,m){var l=this.project(i.getNorthWest(),m).subtract(k.min),n=this.project(i.getSouthEast(),m).subtract(k.max),j=this._rebound(l.x,-n.x),h=this._rebound(l.y,-n.y);return new a.Point(j,h)},_rebound:function(i,h){return i+h>0?Math.round(i-h)/2:Math.max(0,Math.ceil(i))-Math.max(0,Math.floor(h))},_limitZoom:function(j){var i=this.getMinZoom(),h=this.getMaxZoom();return Math.max(i,Math.min(h,j))}});a.map=function(i,h){return new a.Map(i,h)};a.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(j){var o=a.LatLng.DEG_TO_RAD,s=this.MAX_LATITUDE,p=Math.max(Math.min(s,j.lat),-s),h=this.R_MAJOR,k=this.R_MINOR,t=j.lng*o*h,q=p*o,m=k/h,l=Math.sqrt(1-m*m),i=l*Math.sin(q);i=Math.pow((1-i)/(1+i),l*0.5);var n=Math.tan(0.5*((Math.PI*0.5)-q))/i;q=-h*Math.log(n);return new a.Point(t,q)},unproject:function(v){var s=a.LatLng.RAD_TO_DEG,h=this.R_MAJOR,k=this.R_MINOR,u=v.x*s/h,o=k/h,l=Math.sqrt(1-(o*o)),t=Math.exp(-v.y/h),q=(Math.PI/2)-2*Math.atan(t),m=15,w=1e-7,n=m,p=0.1,j;while((Math.abs(p)>w)&&(--n>0)){j=l*Math.sin(q);p=(Math.PI/2)-2*Math.atan(t*Math.pow((1-j)/(1+j),0.5*l))-q;q+=p}return new a.LatLng(q*s,u)}};a.CRS.EPSG3395=a.extend({},a.CRS,{code:"EPSG:3395",projection:a.Projection.Mercator,transformation:(function(){var h=a.Projection.Mercator,i=h.R_MAJOR,j=0.5/(Math.PI*i);return new a.Transformation(j,0.5,-j,0.5)}())});a.TileLayer=a.Class.extend({includes:a.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:a.Browser.mobile,updateWhenIdle:a.Browser.mobile},initialize:function(j,i){i=a.setOptions(this,i);if(i.detectRetina&&a.Browser.retina&&i.maxZoom>0){i.tileSize=Math.floor(i.tileSize/2);i.zoomOffset++;if(i.minZoom>0){i.minZoom--}this.options.maxZoom--}if(i.bounds){i.bounds=a.latLngBounds(i.bounds)}this._url=j;var h=this.options.subdomains;if(typeof h==="string"){this.options.subdomains=h.split("")}},onAdd:function(h){this._map=h;this._animated=h._zoomAnimated;this._initContainer();h.on({viewreset:this._reset,moveend:this._update},this);if(this._animated){h.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){this._limitedUpdate=a.Util.limitExecByInterval(this._update,150,this);h.on("move",this._limitedUpdate,this)}this._reset();this._update()},addTo:function(h){h.addLayer(this);return this},onRemove:function(h){this._container.parentNode.removeChild(this._container);h.off({viewreset:this._reset,moveend:this._update},this);if(this._animated){h.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){h.off("move",this._limitedUpdate,this)}this._container=null;this._map=null},bringToFront:function(){var h=this._map._panes.tilePane;if(this._container){h.appendChild(this._container);this._setAutoZIndex(h,Math.max)}return this},bringToBack:function(){var h=this._map._panes.tilePane;if(this._container){h.insertBefore(this._container,h.firstChild);this._setAutoZIndex(h,Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(h){this.options.opacity=h;if(this._map){this._updateOpacity()}return this},setZIndex:function(h){this.options.zIndex=h;this._updateZIndex();return this},setUrl:function(h,i){this._url=h;if(!i){this.redraw()}return this},redraw:function(){if(this._map){this._reset({hard:true});this._update()}return this},_updateZIndex:function(){if(this._container&&this.options.zIndex!==g){this._container.style.zIndex=this.options.zIndex}},_setAutoZIndex:function(o,l){var m=o.children,k=-l(Infinity,-Infinity),n,j,h;for(j=0,h=m.length;j<h;j++){if(m[j]!==this._container){n=parseInt(m[j].style.zIndex,10);if(!isNaN(n)){k=l(k,n)}}}this.options.zIndex=this._container.style.zIndex=(isFinite(k)?k:0)+l(1,-1)},_updateOpacity:function(){var j,h=this._tiles;if(a.Browser.ielt9){for(j in h){a.DomUtil.setOpacity(h[j],this.options.opacity)}}else{a.DomUtil.setOpacity(this._container,this.options.opacity)}},_initContainer:function(){var h=this._map._panes.tilePane;if(!this._container){this._container=a.DomUtil.create("div","leaflet-layer");this._updateZIndex();if(this._animated){var i="leaflet-tile-container";this._bgBuffer=a.DomUtil.create("div",i,this._container);this._tileContainer=a.DomUtil.create("div",i,this._container)}else{this._tileContainer=this._container}h.appendChild(this._container);if(this.options.opacity<1){this._updateOpacity()}}},_reset:function(i){for(var h in this._tiles){this.fire("tileunload",{tile:this._tiles[h]})}this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles){this._unusedTiles=[]}this._tileContainer.innerHTML="";if(this._animated&&i&&i.hard){this._clearBgBuffer()}this._initContainer()},_getTileSize:function(){var k=this._map,i=k.getZoom()+this.options.zoomOffset,h=this.options.maxNativeZoom,j=this.options.tileSize;if(h&&i>h){j=Math.round(k.getZoomScale(i)/k.getZoomScale(h)*j)}return j},_update:function(){if(!this._map){return}var l=this._map,i=l.getPixelBounds(),h=l.getZoom(),j=this._getTileSize();if(h>this.options.maxZoom||h<this.options.minZoom){return}var k=a.bounds(i.min.divideBy(j)._floor(),i.max.divideBy(j)._floor());this._addTilesFromCenterOut(k);if(this.options.unloadInvisibleTiles||this.options.reuseTiles){this._removeOtherTiles(k)}},_addTilesFromCenterOut:function(p){var l=[],k=p.getCenter();var n,o,h;for(n=p.min.y;n<=p.max.y;n++){for(o=p.min.x;o<=p.max.x;o++){h=new a.Point(o,n);if(this._tileShouldBeLoaded(h)){l.push(h)}}}var q=l.length;if(q===0){return}l.sort(function(j,i){return j.distanceTo(k)-i.distanceTo(k)});var m=b.createDocumentFragment();if(!this._tilesToLoad){this.fire("loading")}this._tilesToLoad+=q;for(o=0;o<q;o++){this._addTile(l[o],m)}this._tileContainer.appendChild(m)},_tileShouldBeLoaded:function(m){if((m.x+":"+m.y) in this._tiles){return false}var l=this.options;if(!l.continuousWorld){var j=this._getWrapTileNum();if((l.noWrap&&(m.x<0||m.x>=j.x))||m.y<0||m.y>=j.y){return false}}if(l.bounds){var o=l.tileSize,k=m.multiplyBy(o),h=k.add([o,o]),i=this._map.unproject(k),n=this._map.unproject(h);if(!l.continuousWorld&&!l.noWrap){i=i.wrap();n=n.wrap()}if(!l.bounds.intersects([i,n])){return false}}return true},_removeOtherTiles:function(k){var j,h,l,i;for(i in this._tiles){j=i.split(":");h=parseInt(j[0],10);l=parseInt(j[1],10);if(h<k.min.x||h>k.max.x||l<k.min.y||l>k.max.y){this._removeTile(i)}}},_removeTile:function(h){var i=this._tiles[h];this.fire("tileunload",{tile:i,url:i.src});if(this.options.reuseTiles){a.DomUtil.removeClass(i,"leaflet-tile-loaded");this._unusedTiles.push(i)}else{if(i.parentNode===this._tileContainer){this._tileContainer.removeChild(i)}}if(!a.Browser.android){i.onload=null;i.src=a.Util.emptyImageUrl}delete this._tiles[h]},_addTile:function(j,h){var i=this._getTilePos(j);var k=this._getTile();a.DomUtil.setPosition(k,i,a.Browser.chrome);this._tiles[j.x+":"+j.y]=k;this._loadTile(k,j);if(k.parentNode!==this._tileContainer){h.appendChild(k)}},_getZoomForUrl:function(){var h=this.options,i=this._map.getZoom();if(h.zoomReverse){i=h.maxZoom-i}i+=h.zoomOffset;return h.maxNativeZoom?Math.min(i,h.maxNativeZoom):i},_getTilePos:function(i){var h=this._map.getPixelOrigin(),j=this._getTileSize();return i.multiplyBy(j).subtract(h)},getTileUrl:function(h){return a.Util.template(this._url,a.extend({s:this._getSubdomain(h),z:h.z,x:h.x,y:h.y},this.options))},_getWrapTileNum:function(){var h=this._map.options.crs,i=h.getSize(this._map.getZoom());return i.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(i){var h=this._getWrapTileNum();if(!this.options.continuousWorld&&!this.options.noWrap){i.x=((i.x%h.x)+h.x)%h.x}if(this.options.tms){i.y=h.y-i.y-1}i.z=this._getZoomForUrl()},_getSubdomain:function(i){var h=Math.abs(i.x+i.y)%this.options.subdomains.length;return this.options.subdomains[h]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var h=this._unusedTiles.pop();this._resetTile(h);return h}return this._createTile()},_resetTile:function(){},_createTile:function(){var h=a.DomUtil.create("img","leaflet-tile");h.style.width=h.style.height=this._getTileSize()+"px";h.galleryimg="no";h.onselectstart=h.onmousemove=a.Util.falseFn;if(a.Browser.ielt9&&this.options.opacity!==g){a.DomUtil.setOpacity(h,this.options.opacity)}if(a.Browser.mobileWebkit3d){h.style.WebkitBackfaceVisibility="hidden"}return h},_loadTile:function(i,h){i._layer=this;i.onload=this._tileOnLoad;i.onerror=this._tileOnError;this._adjustTilePoint(h);i.src=this.getTileUrl(h);this.fire("tileloadstart",{tile:i,url:i.src})},_tileLoaded:function(){this._tilesToLoad--;if(this._animated){a.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated")}if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(a.bind(this._clearBgBuffer,this),500)}}},_tileOnLoad:function(){var h=this._layer;if(this.src!==a.Util.emptyImageUrl){a.DomUtil.addClass(this,"leaflet-tile-loaded");h.fire("tileload",{tile:this,url:this.src})}h._tileLoaded()},_tileOnError:function(){var h=this._layer;h.fire("tileerror",{tile:this,url:this.src});var i=h.options.errorTileUrl;if(i){this.src=i}h._tileLoaded()}});a.tileLayer=function(i,h){return new a.TileLayer(i,h)};a.TileLayer.WMS=a.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false},initialize:function(k,j){this._url=k;var h=a.extend({},this.defaultWmsParams),m=j.tileSize||this.options.tileSize;if(j.detectRetina&&a.Browser.retina){h.width=h.height=m*2}else{h.width=h.height=m}for(var l in j){if(!this.options.hasOwnProperty(l)&&l!=="crs"){h[l]=j[l]}}this.wmsParams=h;a.setOptions(this,j)},onAdd:function(h){this._crs=this.options.crs||h.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var i=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[i]=this._crs.code;a.TileLayer.prototype.onAdd.call(this,h)},getTileUrl:function(j){var i=this._map,p=this.options.tileSize,o=j.multiplyBy(p),m=o.add([p,p]),k=this._crs.project(i.unproject(o,j.z)),l=this._crs.project(i.unproject(m,j.z)),n=this._wmsVersion>=1.3&&this._crs===a.CRS.EPSG4326?[l.y,k.x,k.y,l.x].join(","):[k.x,l.y,l.x,k.y].join(","),h=a.Util.template(this._url,{s:this._getSubdomain(j)});return h+a.Util.getParamString(this.wmsParams,h,true)+"&BBOX="+n},setParams:function(i,h){a.extend(this.wmsParams,i);if(!h){this.redraw()}return this}});a.tileLayer.wms=function(i,h){return new a.TileLayer.WMS(i,h)};a.TileLayer.Canvas=a.TileLayer.extend({options:{async:false},initialize:function(h){a.setOptions(this,h)},redraw:function(){if(this._map){this._reset({hard:true});this._update()}for(var h in this._tiles){this._redrawTile(this._tiles[h])}return this},_redrawTile:function(h){this.drawTile(h,h._tilePoint,this._map._zoom)},_createTile:function(){var h=a.DomUtil.create("canvas","leaflet-tile");h.width=h.height=this.options.tileSize;h.onselectstart=h.onmousemove=a.Util.falseFn;return h},_loadTile:function(i,h){i._layer=this;i._tilePoint=h;this._redrawTile(i);if(!this.options.async){this.tileDrawn(i)}},drawTile:function(){},tileDrawn:function(h){this._tileOnLoad.call(h)}});a.tileLayer.canvas=function(h){return new a.TileLayer.Canvas(h)};a.ImageOverlay=a.Class.extend({includes:a.Mixin.Events,options:{opacity:1},initialize:function(i,j,h){this._url=i;this._bounds=a.latLngBounds(j);a.setOptions(this,h)},onAdd:function(h){this._map=h;if(!this._image){this._initImage()}h._panes.overlayPane.appendChild(this._image);h.on("viewreset",this._reset,this);if(h.options.zoomAnimation&&a.Browser.any3d){h.on("zoomanim",this._animateZoom,this)}this._reset()},onRemove:function(h){h.getPanes().overlayPane.removeChild(this._image);h.off("viewreset",this._reset,this);if(h.options.zoomAnimation){h.off("zoomanim",this._animateZoom,this)}},addTo:function(h){h.addLayer(this);return this},setOpacity:function(h){this.options.opacity=h;this._updateOpacity();return this},bringToFront:function(){if(this._image){this._map._panes.overlayPane.appendChild(this._image)}return this},bringToBack:function(){var h=this._map._panes.overlayPane;if(this._image){h.insertBefore(this._image,h.firstChild)}return this},setUrl:function(h){this._url=h;this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=a.DomUtil.create("img","leaflet-image-layer");if(this._map.options.zoomAnimation&&a.Browser.any3d){a.DomUtil.addClass(this._image,"leaflet-zoom-animated")}else{a.DomUtil.addClass(this._image,"leaflet-zoom-hide")}this._updateOpacity();a.extend(this._image,{galleryimg:"no",onselectstart:a.Util.falseFn,onmousemove:a.Util.falseFn,onload:a.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(l){var h=this._map,j=this._image,i=h.getZoomScale(l.zoom),k=this._bounds.getNorthWest(),m=this._bounds.getSouthEast(),o=h._latLngToNewLayerPoint(k,l.zoom,l.center),p=h._latLngToNewLayerPoint(m,l.zoom,l.center)._subtract(o),n=o._add(p._multiplyBy((1/2)*(1-1/i)));j.style[a.DomUtil.TRANSFORM]=a.DomUtil.getTranslateString(n)+" scale("+i+") "},_reset:function(){var j=this._image,i=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),h=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(i);a.DomUtil.setPosition(j,i);j.style.width=h.x+"px";j.style.height=h.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){a.DomUtil.setOpacity(this._image,this.options.opacity)}});a.imageOverlay=function(i,j,h){return new a.ImageOverlay(i,j,h)};a.Icon=a.Class.extend({options:{className:""},initialize:function(h){a.setOptions(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(i,j){var k=this._getIconUrl(i);if(!k){if(i==="icon"){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var h;if(!j||j.tagName!=="IMG"){h=this._createImg(k)}else{h=this._createImg(k,j)}this._setIconStyles(h,i);return h},_setIconStyles:function(h,k){var j=this.options,l=a.point(j[k+"Size"]),i;if(k==="shadow"){i=a.point(j.shadowAnchor||j.iconAnchor)}else{i=a.point(j.iconAnchor)}if(!i&&l){i=l.divideBy(2,true)}h.className="leaflet-marker-"+k+" "+j.className;if(i){h.style.marginLeft=(-i.x)+"px";h.style.marginTop=(-i.y)+"px"}if(l){h.style.width=l.x+"px";h.style.height=l.y+"px"}},_createImg:function(i,h){h=h||b.createElement("img");h.src=i;return h},_getIconUrl:function(h){if(a.Browser.retina&&this.options[h+"RetinaUrl"]){return this.options[h+"RetinaUrl"]}return this.options[h+"Url"]}});a.icon=function(h){return new a.Icon(h)};a.Icon.Default=a.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(h){var i=h+"Url";if(this.options[i]){return this.options[i]}if(a.Browser.retina&&h==="icon"){h+="-2x"}var j=a.Icon.Default.imagePath;if(!j){throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.")}return j+"/marker-"+h+".png"}});a.Icon.Default.imagePath=(function(){var j=b.getElementsByTagName("script"),l=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;var k,h,o,m,n;for(k=0,h=j.length;k<h;k++){o=j[k].src;m=o.match(l);if(m){n=o.split(l)[0];return(n?n+"/":"")+"images"}}}());a.Marker=a.Class.extend({includes:a.Mixin.Events,options:{icon:new a.Icon.Default(),title:"",alt:"",clickable:true,draggable:false,keyboard:true,zIndexOffset:0,opacity:1,riseOnHover:false,riseOffset:250},initialize:function(i,h){a.setOptions(this,h);this._latlng=a.latLng(i)},onAdd:function(h){this._map=h;h.on("viewreset",this.update,this);this._initIcon();this.update();this.fire("add");if(h.options.zoomAnimation&&h.options.markerZoomAnimation){h.on("zoomanim",this._animateZoom,this)}},addTo:function(h){h.addLayer(this);return this},onRemove:function(h){if(this.dragging){this.dragging.disable()}this._removeIcon();this._removeShadow();this.fire("remove");h.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(h){this._latlng=a.latLng(h);this.update();return this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(h){this.options.zIndexOffset=h;this.update();return this},setIcon:function(h){this.options.icon=h;if(this._map){this._initIcon();this.update()}if(this._popup){this.bindPopup(this._popup)}return this},update:function(){if(this._icon){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var o=this.options,h=this._map,k=(h.options.zoomAnimation&&h.options.markerZoomAnimation),j=k?"leaflet-zoom-animated":"leaflet-zoom-hide";var n=o.icon.createIcon(this._icon),l=false;if(n!==this._icon){if(this._icon){this._removeIcon()}l=true;if(o.title){n.title=o.title}if(o.alt){n.alt=o.alt}}a.DomUtil.addClass(n,j);if(o.keyboard){n.tabIndex="0"}this._icon=n;this._initInteraction();if(o.riseOnHover){a.DomEvent.on(n,"mouseover",this._bringToFront,this).on(n,"mouseout",this._resetZIndex,this)}var p=o.icon.createShadow(this._shadow),i=false;if(p!==this._shadow){this._removeShadow();i=true}if(p){a.DomUtil.addClass(p,j)}this._shadow=p;if(o.opacity<1){this._updateOpacity()}var m=this._map._panes;if(l){m.markerPane.appendChild(this._icon)}if(p&&i){m.shadowPane.appendChild(this._shadow)}},_removeIcon:function(){if(this.options.riseOnHover){a.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex)}this._map._panes.markerPane.removeChild(this._icon);this._icon=null},_removeShadow:function(){if(this._shadow){this._map._panes.shadowPane.removeChild(this._shadow)}this._shadow=null},_setPos:function(h){a.DomUtil.setPosition(this._icon,h);if(this._shadow){a.DomUtil.setPosition(this._shadow,h)}this._zIndex=h.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(h){this._icon.style.zIndex=this._zIndex+h},_animateZoom:function(h){var i=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(i)},_initInteraction:function(){if(!this.options.clickable){return}var k=this._icon,j=["dblclick","mousedown","mouseover","mouseout","contextmenu"];a.DomUtil.addClass(k,"leaflet-clickable");a.DomEvent.on(k,"click",this._onMouseClick,this);a.DomEvent.on(k,"keypress",this._onKeyPress,this);for(var h=0;h<j.length;h++){a.DomEvent.on(k,j[h],this._fireMouseEvent,this)}if(a.Handler.MarkerDrag){this.dragging=new a.Handler.MarkerDrag(this);if(this.options.draggable){this.dragging.enable()}}},_onMouseClick:function(i){var h=this.dragging&&this.dragging.moved();if(this.hasEventListeners(i.type)||h){a.DomEvent.stopPropagation(i)}if(h){return}if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved()){return}this.fire(i.type,{originalEvent:i,latlng:this._latlng})},_onKeyPress:function(h){if(h.keyCode===13){this.fire("click",{originalEvent:h,latlng:this._latlng})}},_fireMouseEvent:function(h){this.fire(h.type,{originalEvent:h,latlng:this._latlng});if(h.type==="contextmenu"&&this.hasEventListeners(h.type)){a.DomEvent.preventDefault(h)}if(h.type!=="mousedown"){a.DomEvent.stopPropagation(h)}else{a.DomEvent.preventDefault(h)}},setOpacity:function(h){this.options.opacity=h;if(this._map){this._updateOpacity()}return this},_updateOpacity:function(){a.DomUtil.setOpacity(this._icon,this.options.opacity);if(this._shadow){a.DomUtil.setOpacity(this._shadow,this.options.opacity)}},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});a.marker=function(i,h){return new a.Marker(i,h)};a.DivIcon=a.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:false},createIcon:function(i){var j=(i&&i.tagName==="DIV")?i:b.createElement("div"),h=this.options;if(h.html!==false){j.innerHTML=h.html}else{j.innerHTML=""}if(h.bgPos){j.style.backgroundPosition=(-h.bgPos.x)+"px "+(-h.bgPos.y)+"px"}this._setIconStyles(j,"icon");return j},createShadow:function(){return null}});a.divIcon=function(h){return new a.DivIcon(h)};a.Map.mergeOptions({closePopupOnClick:true});a.Popup=a.Class.extend({includes:a.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:true,closeButton:true,offset:[0,7],autoPanPadding:[5,5],keepInView:false,className:"",zoomAnimation:true},initialize:function(h,i){a.setOptions(this,h);this._source=i;this._animated=a.Browser.any3d&&this.options.zoomAnimation;this._isOpen=false},onAdd:function(i){this._map=i;if(!this._container){this._initLayout()}var h=i.options.fadeAnimation;if(h){a.DomUtil.setOpacity(this._container,0)}i._panes.popupPane.appendChild(this._container);i.on(this._getEvents(),this);this.update();if(h){a.DomUtil.setOpacity(this._container,1)}this.fire("open");i.fire("popupopen",{popup:this});if(this._source){this._source.fire("popupopen",{popup:this})}},addTo:function(h){h.addLayer(this);return this},openOn:function(h){h.openPopup(this);return this},onRemove:function(h){h._panes.popupPane.removeChild(this._container);a.Util.falseFn(this._container.offsetWidth);h.off(this._getEvents(),this);if(h.options.fadeAnimation){a.DomUtil.setOpacity(this._container,0)}this._map=null;this.fire("close");h.fire("popupclose",{popup:this});if(this._source){this._source.fire("popupclose",{popup:this})}},getLatLng:function(){return this._latlng},setLatLng:function(h){this._latlng=a.latLng(h);if(this._map){this._updatePosition();this._adjustPan()}return this},getContent:function(){return this._content},setContent:function(h){this._content=h;this.update();return this},update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},_getEvents:function(){var h={viewreset:this._updatePosition};if(this._animated){h.zoomanim=this._zoomAnimation}if("closeOnClick" in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick){h.preclick=this._close}if(this.options.keepInView){h.moveend=this._adjustPan}return h},_close:function(){if(this._map){this._map.closePopup(this)}},_initLayout:function(){var j="leaflet-popup",k=j+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),h=this._container=a.DomUtil.create("div",k),i;if(this.options.closeButton){i=this._closeButton=a.DomUtil.create("a",j+"-close-button",h);i.href="#close";i.innerHTML="&#215;";a.DomEvent.disableClickPropagation(i);a.DomEvent.on(i,"click",this._onCloseButtonClick,this)}var l=this._wrapper=a.DomUtil.create("div",j+"-content-wrapper",h);a.DomEvent.disableClickPropagation(l);this._contentNode=a.DomUtil.create("div",j+"-content",l);a.DomEvent.disableScrollPropagation(this._contentNode);a.DomEvent.on(l,"contextmenu",a.DomEvent.stopPropagation);this._tipContainer=a.DomUtil.create("div",j+"-tip-container",h);this._tip=a.DomUtil.create("div",j+"-tip",this._tipContainer)},_updateContent:function(){if(!this._content){return}if(typeof this._content==="string"){this._contentNode.innerHTML=this._content}else{while(this._contentNode.hasChildNodes()){this._contentNode.removeChild(this._contentNode.firstChild)}this._contentNode.appendChild(this._content)}this.fire("contentupdate")},_updateLayout:function(){var i=this._contentNode,k=i.style;k.width="";k.whiteSpace="nowrap";var j=i.offsetWidth;j=Math.min(j,this.options.maxWidth);j=Math.max(j,this.options.minWidth);k.width=(j+1)+"px";k.whiteSpace="";k.height="";var h=i.offsetHeight,l=this.options.maxHeight,m="leaflet-popup-scrolled";if(l&&h>l){k.height=l+"px";a.DomUtil.addClass(i,m)}else{a.DomUtil.removeClass(i,m)}this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map){return}var j=this._map.latLngToLayerPoint(this._latlng),h=this._animated,i=a.point(this.options.offset);if(h){a.DomUtil.setPosition(this._container,j)}this._containerBottom=-i.y-(h?0:j.y);this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(h?0:j.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(h){var i=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);a.DomUtil.setPosition(this._container,i)},_adjustPan:function(){if(!this.options.autoPan){return}var i=this._map,r=this._container.offsetHeight,n=this._containerWidth,l=new a.Point(this._containerLeft,-r-this._containerBottom);if(this._animated){l._add(a.DomUtil.getPosition(this._container))}var k=i.layerPointToContainerPoint(l),m=a.point(this.options.autoPanPadding),j=a.point(this.options.autoPanPaddingTopLeft||m),h=a.point(this.options.autoPanPaddingBottomRight||m),q=i.getSize(),p=0,o=0;if(k.x+n+h.x>q.x){p=k.x+n-q.x+h.x}if(k.x-p-j.x<0){p=k.x-j.x}if(k.y+r+h.y>q.y){o=k.y+r-q.y+h.y}if(k.y-o-j.y<0){o=k.y-j.y}if(p||o){i.fire("autopanstart").panBy([p,o])}},_onCloseButtonClick:function(h){this._close();a.DomEvent.stop(h)}});a.popup=function(h,i){return new a.Popup(h,i)};a.Map.include({openPopup:function(h,k,i){this.closePopup();if(!(h instanceof a.Popup)){var j=h;h=new a.Popup(i).setLatLng(k).setContent(j)}h._isOpen=true;this._popup=h;return this.addLayer(h)},closePopup:function(h){if(!h||h===this._popup){h=this._popup;this._popup=null}if(h){this.removeLayer(h);h._isOpen=false}return this}});a.Marker.include({openPopup:function(){if(this._popup&&this._map&&!this._map.hasLayer(this._popup)){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup)}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},togglePopup:function(){if(this._popup){if(this._popup._isOpen){this.closePopup()}else{this.openPopup()}}return this},bindPopup:function(j,i){var h=a.point(this.options.icon.options.popupAnchor||[0,0]);h=h.add(a.Popup.prototype.options.offset);if(i&&i.offset){h=h.add(i.offset)}i=a.extend({offset:h},i);if(!this._popupHandlersAdded){this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this);this._popupHandlersAdded=true}if(j instanceof a.Popup){a.setOptions(j,i);this._popup=j}else{this._popup=new a.Popup(i,this).setContent(j)}return this},setPopupContent:function(h){if(this._popup){this._popup.setContent(h)}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this);this._popupHandlersAdded=false}return this},getPopup:function(){return this._popup},_movePopup:function(h){this._popup.setLatLng(h.latlng)}});a.LayerGroup=a.Class.extend({initialize:function(k){this._layers={};var j,h;if(k){for(j=0,h=k.length;j<h;j++){this.addLayer(k[j])}}},addLayer:function(h){var i=this.getLayerId(h);this._layers[i]=h;if(this._map){this._map.addLayer(h)}return this},removeLayer:function(h){var i=h in this._layers?h:this.getLayerId(h);if(this._map&&this._layers[i]){this._map.removeLayer(this._layers[i])}delete this._layers[i];return this},hasLayer:function(h){if(!h){return false}return(h in this._layers||this.getLayerId(h) in this._layers)},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(h){var j=Array.prototype.slice.call(arguments,1),l,k;for(l in this._layers){k=this._layers[l];if(k[h]){k[h].apply(k,j)}}return this},onAdd:function(h){this._map=h;this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h);this._map=null},addTo:function(h){h.addLayer(this);return this},eachLayer:function(k,j){for(var h in this._layers){k.call(j,this._layers[h])}return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var j=[];for(var h in this._layers){j.push(this._layers[h])}return j},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return a.stamp(h)}});a.layerGroup=function(h){return new a.LayerGroup(h)};a.FeatureGroup=a.LayerGroup.extend({includes:a.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(h){if(this.hasLayer(h)){return this}if("on" in h){h.on(a.FeatureGroup.EVENTS,this._propagateEvent,this)}a.LayerGroup.prototype.addLayer.call(this,h);if(this._popupContent&&h.bindPopup){h.bindPopup(this._popupContent,this._popupOptions)}return this.fire("layeradd",{layer:h})},removeLayer:function(h){if(!this.hasLayer(h)){return this}if(h in this._layers){h=this._layers[h]}h.off(a.FeatureGroup.EVENTS,this._propagateEvent,this);a.LayerGroup.prototype.removeLayer.call(this,h);if(this._popupContent){this.invoke("unbindPopup")}return this.fire("layerremove",{layer:h})},bindPopup:function(i,h){this._popupContent=i;this._popupOptions=h;return this.invoke("bindPopup",i,h)},openPopup:function(i){for(var h in this._layers){this._layers[h].openPopup(i);break}return this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new a.LatLngBounds();this.eachLayer(function(i){h.extend(i instanceof a.Marker?i.getLatLng():i.getBounds())});return h},_propagateEvent:function(h){h=a.extend({layer:h.target,target:this},h);this.fire(h.type,h)}});a.featureGroup=function(h){return new a.FeatureGroup(h)};a.Path=a.Class.extend({includes:[a.Mixin.Events],statics:{CLIP_PADDING:(function(){var h=a.Browser.mobile?1280:2000,i=(h/Math.max(d.outerWidth,d.outerHeight)-1)/2;return Math.max(0,Math.min(0.5,i))})()},options:{stroke:true,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:0.5,fill:false,fillColor:null,fillOpacity:0.2,clickable:true},initialize:function(h){a.setOptions(this,h)},onAdd:function(h){this._map=h;if(!this._container){this._initElements();this._initEvents()}this.projectLatlngs();this._updatePath();if(this._container){this._map._pathRoot.appendChild(this._container)}this.fire("add");h.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(h){h.addLayer(this);return this},onRemove:function(h){h._pathRoot.removeChild(this._container);this.fire("remove");this._map=null;if(a.Browser.vml){this._container=null;this._stroke=null;this._fill=null}h.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(h){a.setOptions(this,h);if(this._container){this._updateStyle()}return this},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath()}return this}});a.Map.include({_updatePathViewport:function(){var l=a.Path.CLIP_PADDING,k=this.getSize(),i=a.DomUtil.getPosition(this._mapPane),j=i.multiplyBy(-1)._subtract(k.multiplyBy(l)._round()),h=j.add(k.multiplyBy(1+l*2)._round());this._pathViewport=new a.Bounds(j,h)}});a.Path.SVG_NS="http://www.w3.org/2000/svg";a.Browser.svg=!!(b.createElementNS&&b.createElementNS(a.Path.SVG_NS,"svg").createSVGRect);a.Path=a.Path.extend({statics:{SVG:a.Browser.svg},bringToFront:function(){var h=this._map._pathRoot,i=this._container;if(i&&h.lastChild!==i){h.appendChild(i)}return this},bringToBack:function(){var h=this._map._pathRoot,i=this._container,j=h.firstChild;if(i&&j!==i){h.insertBefore(i,j)}return this},getPathString:function(){},_createElement:function(h){return b.createElementNS(a.Path.SVG_NS,h)},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle()},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");if(this.options.className){a.DomUtil.addClass(this._path,this.options.className)}this._container.appendChild(this._path)},_initStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke-linejoin","round");this._path.setAttribute("stroke-linecap","round")}if(this.options.fill){this._path.setAttribute("fill-rule","evenodd")}if(this.options.pointerEvents){this._path.setAttribute("pointer-events",this.options.pointerEvents)}if(!this.options.clickable&&!this.options.pointerEvents){this._path.setAttribute("pointer-events","none")}this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke",this.options.color);this._path.setAttribute("stroke-opacity",this.options.opacity);this._path.setAttribute("stroke-width",this.options.weight);if(this.options.dashArray){this._path.setAttribute("stroke-dasharray",this.options.dashArray)}else{this._path.removeAttribute("stroke-dasharray")}if(this.options.lineCap){this._path.setAttribute("stroke-linecap",this.options.lineCap)}if(this.options.lineJoin){this._path.setAttribute("stroke-linejoin",this.options.lineJoin)}}else{this._path.setAttribute("stroke","none")}if(this.options.fill){this._path.setAttribute("fill",this.options.fillColor||this.options.color);this._path.setAttribute("fill-opacity",this.options.fillOpacity)}else{this._path.setAttribute("fill","none")}},_updatePath:function(){var h=this.getPathString();if(!h){h="M0 0"}this._path.setAttribute("d",h)},_initEvents:function(){if(this.options.clickable){if(a.Browser.svg||!a.Browser.vml){a.DomUtil.addClass(this._path,"leaflet-clickable")}a.DomEvent.on(this._container,"click",this._onMouseClick,this);var j=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"];for(var h=0;h<j.length;h++){a.DomEvent.on(this._container,j[h],this._fireMouseEvent,this)}}},_onMouseClick:function(h){if(this._map.dragging&&this._map.dragging.moved()){return}this._fireMouseEvent(h)},_fireMouseEvent:function(k){if(!this.hasEventListeners(k.type)){return}var j=this._map,i=j.mouseEventToContainerPoint(k),h=j.containerPointToLayerPoint(i),l=j.layerPointToLatLng(h);this.fire(k.type,{latlng:l,layerPoint:h,containerPoint:i,originalEvent:k});if(k.type==="contextmenu"){a.DomEvent.preventDefault(k)}if(k.type!=="mousemove"){a.DomEvent.stopPropagation(k)}}});a.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=a.Path.prototype._createElement("svg");this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&a.Browser.any3d){a.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated");this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})}else{a.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide")}this.on("moveend",this._updateSvgViewport);this._updateSvgViewport()}},_animatePathZoom:function(h){var j=this.getZoomScale(h.zoom),i=this._getCenterOffset(h.center)._multiplyBy(-j)._add(this._pathViewport.min);this._pathRoot.style[a.DomUtil.TRANSFORM]=a.DomUtil.getTranslateString(i)+" scale("+j+") ";this._pathZooming=true},_endPathZoom:function(){this._pathZooming=false},_updateSvgViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var k=this._pathViewport,l=k.min,i=k.max,m=i.x-l.x,h=i.y-l.y,j=this._pathRoot,n=this._panes.overlayPane;if(a.Browser.mobileWebkit){n.removeChild(j)}a.DomUtil.setPosition(j,l);j.setAttribute("width",m);j.setAttribute("height",h);j.setAttribute("viewBox",[l.x,l.y,m,h].join(" "));if(a.Browser.mobileWebkit){n.appendChild(j)}}});a.Path.include({bindPopup:function(i,h){if(i instanceof a.Popup){this._popup=i}else{if(!this._popup||h){this._popup=new a.Popup(h,this)}this._popup.setContent(i)}if(!this._popupHandlersAdded){this.on("click",this._openPopup,this).on("remove",this.closePopup,this);this._popupHandlersAdded=true}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this._openPopup).off("remove",this.closePopup);this._popupHandlersAdded=false}return this},openPopup:function(h){if(this._popup){h=h||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)];this._openPopup({latlng:h})}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},_openPopup:function(h){this._popup.setLatLng(h.latlng);this._map.openPopup(this._popup)}});a.Browser.vml=!a.Browser.svg&&(function(){try{var j=b.createElement("div");j.innerHTML='<v:shape adj="1"/>';var h=j.firstChild;h.style.behavior="url(#default#VML)";return h&&(typeof h.adj==="object")}catch(i){return false}}());a.Path=a.Browser.svg||!a.Browser.vml?a.Path:a.Path.extend({statics:{VML:true,CLIP_PADDING:0.02},_createElement:(function(){try{b.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(i){return b.createElement("<lvml:"+i+' class="lvml">')}}catch(h){return function(i){return b.createElement("<"+i+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),_initPath:function(){var h=this._container=this._createElement("shape");a.DomUtil.addClass(h,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:""));if(this.options.clickable){a.DomUtil.addClass(h,"leaflet-clickable")}h.coordsize="1 1";this._path=this._createElement("path");h.appendChild(this._path);this._map._pathRoot.appendChild(h)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var k=this._stroke,j=this._fill,i=this.options,h=this._container;h.stroked=i.stroke;h.filled=i.fill;if(i.stroke){if(!k){k=this._stroke=this._createElement("stroke");k.endcap="round";h.appendChild(k)}k.weight=i.weight+"px";k.color=i.color;k.opacity=i.opacity;if(i.dashArray){k.dashStyle=a.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," ")}else{k.dashStyle=""}if(i.lineCap){k.endcap=i.lineCap.replace("butt","flat")}if(i.lineJoin){k.joinstyle=i.lineJoin}}else{if(k){h.removeChild(k);this._stroke=null}}if(i.fill){if(!j){j=this._fill=this._createElement("fill");h.appendChild(j)}j.color=i.fillColor||i.color;j.opacity=i.fillOpacity}else{if(j){h.removeChild(j);this._fill=null}}},_updatePath:function(){var h=this._container.style;h.display="none";this._path.v=this.getPathString()+" ";h.display=""}});a.Map.include(a.Browser.svg||!a.Browser.vml?{}:{_initPathRoot:function(){if(this._pathRoot){return}var h=this._pathRoot=b.createElement("div");h.className="leaflet-vml-container";this._panes.overlayPane.appendChild(h);this.on("moveend",this._updatePathViewport);this._updatePathViewport()}});a.Browser.canvas=(function(){return !!b.createElement("canvas").getContext}());a.Path=(a.Path.SVG&&!d.L_PREFER_CANVAS)||!a.Browser.canvas?a.Path:a.Path.extend({statics:{CANVAS:true,SVG:false},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate()}return this},setStyle:function(h){a.setOptions(this,h);if(this._map){this._updateStyle();this._requestUpdate()}return this},onRemove:function(h){h.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);if(this.options.clickable){this._map.off("click",this._onClick,this);this._map.off("mousemove",this._onMouseMove,this)}this._requestUpdate();this._map=null},_requestUpdate:function(){if(this._map&&!a.Path._updateRequest){a.Path._updateRequest=a.Util.requestAnimFrame(this._fireMapMoveEnd,this._map)}},_fireMapMoveEnd:function(){a.Path._updateRequest=null;this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var h=this.options;if(h.stroke){this._ctx.lineWidth=h.weight;this._ctx.strokeStyle=h.color}if(h.fill){this._ctx.fillStyle=h.fillColor||h.color}},_drawPath:function(){var o,n,k,l,h,m;this._ctx.beginPath();for(o=0,k=this._parts.length;o<k;o++){for(n=0,l=this._parts[o].length;n<l;n++){h=this._parts[o][n];m=(n===0?"move":"line")+"To";this._ctx[m](h.x,h.y)}if(this instanceof a.Polygon){this._ctx.closePath()}}},_checkIfEmpty:function(){return !this._parts.length},_updatePath:function(){if(this._checkIfEmpty()){return}var h=this._ctx,i=this.options;this._drawPath();h.save();this._updateStyle();if(i.fill){h.globalAlpha=i.fillOpacity;h.fill()}if(i.stroke){h.globalAlpha=i.opacity;h.stroke()}h.restore()},_initEvents:function(){if(this.options.clickable){this._map.on("mousemove",this._onMouseMove,this);this._map.on("click",this._onClick,this)}},_onClick:function(h){if(this._containsPoint(h.layerPoint)){this.fire("click",h)}},_onMouseMove:function(h){if(!this._map||this._map._animatingZoom){return}if(this._containsPoint(h.layerPoint)){this._ctx.canvas.style.cursor="pointer";this._mouseInside=true;this.fire("mouseover",h)}else{if(this._mouseInside){this._ctx.canvas.style.cursor="";this._mouseInside=false;this.fire("mouseout",h)}}}});a.Map.include((a.Path.SVG&&!d.L_PREFER_CANVAS)||!a.Browser.canvas?{}:{_initPathRoot:function(){var i=this._pathRoot,h;if(!i){i=this._pathRoot=b.createElement("canvas");i.style.position="absolute";h=this._canvasCtx=i.getContext("2d");h.lineCap="round";h.lineJoin="round";this._panes.overlayPane.appendChild(i);if(this.options.zoomAnimation){this._pathRoot.className="leaflet-zoom-animated";this.on("zoomanim",this._animatePathZoom);this.on("zoomend",this._endPathZoom)}this.on("moveend",this._updateCanvasViewport);this._updateCanvasViewport()}},_updateCanvasViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var i=this._pathViewport,k=i.min,j=i.max.subtract(k),h=this._pathRoot;a.DomUtil.setPosition(h,k);h.width=j.x;h.height=j.y;h.getContext("2d").translate(-k.x,-k.y)}});a.LineUtil={simplify:function(j,h){if(!h||!j.length){return j.slice()}var i=h*h;j=this._reducePoints(j,i);j=this._simplifyDP(j,i);return j},pointToSegmentDistance:function(i,j,h){return Math.sqrt(this._sqClosestPointOnSegment(i,j,h,true))},closestPointOnSegment:function(i,j,h){return this._sqClosestPointOnSegment(i,j,h)},_simplifyDP:function(m,j){var h=m.length,l=typeof Uint8Array!==g+""?Uint8Array:Array,o=new l(h);o[0]=o[h-1]=1;this._simplifyDPStep(m,o,j,0,h-1);var k,n=[];for(k=0;k<h;k++){if(o[k]){n.push(m[k])}}return n},_simplifyDPStep:function(q,j,h,n,p){var k=0,o,l,m;for(l=n+1;l<=p-1;l++){m=this._sqClosestPointOnSegment(q[l],q[n],q[p],true);if(m>k){o=l;k=m}}if(k>h){j[o]=1;this._simplifyDPStep(q,j,h,n,o);this._simplifyDPStep(q,j,h,o,p)}},_reducePoints:function(l,j){var n=[l[0]];for(var k=1,m=0,h=l.length;k<h;k++){if(this._sqDist(l[k],l[m])>j){n.push(l[k]);m=k}}if(m<h-1){n.push(l[h-1])}return n},clipSegment:function(o,n,h,q){var l=q?this._lastCode:this._getBitCode(o,h),j=this._getBitCode(n,h),k,i,m;this._lastCode=j;while(true){if(!(l|j)){return[o,n]}else{if(l&j){return false}else{k=l||j;i=this._getEdgeIntersection(o,n,k,h);m=this._getBitCode(i,h);if(k===l){o=i;l=m}else{n=i;j=m}}}}},_getEdgeIntersection:function(k,i,o,n){var l=i.x-k.x,j=i.y-k.y,m=n.min,h=n.max;if(o&8){return new a.Point(k.x+l*(h.y-k.y)/j,h.y)}else{if(o&4){return new a.Point(k.x+l*(m.y-k.y)/j,m.y)}else{if(o&2){return new a.Point(h.x,k.y+j*(h.x-k.x)/l)}else{if(o&1){return new a.Point(m.x,k.y+j*(m.x-k.x)/l)}}}}},_getBitCode:function(j,i){var h=0;if(j.x<i.min.x){h|=1}else{if(j.x>i.max.x){h|=2}}if(j.y<i.min.y){h|=4}else{if(j.y>i.max.y){h|=8}}return h},_sqDist:function(k,j){var i=j.x-k.x,h=j.y-k.y;return i*i+h*h},_sqClosestPointOnSegment:function(i,n,m,j){var l=n.x,k=n.y,r=m.x-l,q=m.y-k,h=r*r+q*q,o;if(h>0){o=((i.x-l)*r+(i.y-k)*q)/h;if(o>1){l=m.x;k=m.y}else{if(o>0){l+=r*o;k+=q*o}}}r=i.x-l;q=i.y-k;return j?r*r+q*q:new a.Point(l,k)}};a.Polyline=a.Path.extend({initialize:function(h,i){a.Path.prototype.initialize.call(this,i);this._latlngs=this._convertLatLngs(h)},options:{smoothFactor:1,noClip:false},projectLatlngs:function(){this._originalPoints=[];for(var j=0,h=this._latlngs.length;j<h;j++){this._originalPoints[j]=this._map.latLngToLayerPoint(this._latlngs[j])}},getPathString:function(){for(var j=0,h=this._parts.length,k="";j<h;j++){k+=this._getPathPartStr(this._parts[j])}return k},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){this._latlngs=this._convertLatLngs(h);return this.redraw()},addLatLng:function(h){this._latlngs.push(a.latLng(h));return this.redraw()},spliceLatLngs:function(){var h=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,true);this.redraw();return h},closestLayerPoint:function(h){var s=Infinity,k=this._parts,u,t,q=null;for(var l=0,v=k.length;l<v;l++){var r=k[l];for(var m=1,o=r.length;m<o;m++){u=r[m-1];t=r[m];var n=a.LineUtil._sqClosestPointOnSegment(h,u,t,true);if(n<s){s=n;q=a.LineUtil._sqClosestPointOnSegment(h,u,t)}}}if(q){q.distance=Math.sqrt(s)}return q},getBounds:function(){return new a.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(j,k){var l,h,m=k?j:[];for(l=0,h=j.length;l<h;l++){if(a.Util.isArray(j[l])&&typeof j[l][0]!=="number"){return}m[l]=a.latLng(j[l])}return m},_initEvents:function(){a.Path.prototype._initEvents.call(this)},_getPathPartStr:function(l){var i=a.Path.VML;for(var k=0,h=l.length,n="",m;k<h;k++){m=l[k];if(i){m._round()}n+=(k?"L":"M")+m.x+" "+m.y}return n},_clipPoints:function(){var n=this._originalPoints,h=n.length,m,l,o;if(this.options.noClip){this._parts=[n];return}this._parts=[];var p=this._parts,j=this._map._pathViewport,q=a.LineUtil;for(m=0,l=0;m<h-1;m++){o=q.clipSegment(n[m],n[m+1],j,m);if(!o){continue}p[l]=p[l]||[];p[l].push(o[0]);if((o[1]!==n[m+1])||(m===h-2)){p[l].push(o[1]);l++}}},_simplifyPoints:function(){var k=this._parts,l=a.LineUtil;for(var j=0,h=k.length;j<h;j++){k[j]=l.simplify(k[j],this.options.smoothFactor)}},_updatePath:function(){if(!this._map){return}this._clipPoints();this._simplifyPoints();a.Path.prototype._updatePath.call(this)}});a.polyline=function(h,i){return new a.Polyline(h,i)};a.PolyUtil={};a.PolyUtil.clipPolygon=function(x,h){var u,r=[1,4,2,8],s,q,o,w,v,t,m,l,n=a.LineUtil;for(s=0,t=x.length;s<t;s++){x[s]._code=n._getBitCode(x[s],h)}for(o=0;o<4;o++){m=r[o];u=[];for(s=0,t=x.length,q=t-1;s<t;q=s++){w=x[s];v=x[q];if(!(w._code&m)){if(v._code&m){l=n._getEdgeIntersection(v,w,m,h);l._code=n._getBitCode(l,h);u.push(l)}u.push(w)}else{if(!(v._code&m)){l=n._getEdgeIntersection(v,w,m,h);l._code=n._getBitCode(l,h);u.push(l)}}}x=u}return x};a.Polygon=a.Polyline.extend({options:{fill:true},initialize:function(h,i){a.Polyline.prototype.initialize.call(this,h,i);this._initWithHoles(h)},_initWithHoles:function(j){var k,h,l;if(j&&a.Util.isArray(j[0])&&(typeof j[0][0]!=="number")){this._latlngs=this._convertLatLngs(j[0]);this._holes=j.slice(1);for(k=0,h=this._holes.length;k<h;k++){l=this._holes[k]=this._convertLatLngs(this._holes[k]);if(l[0].equals(l[l.length-1])){l.pop()}}}j=this._latlngs;if(j.length>=2&&j[0].equals(j[j.length-1])){j.pop()}},projectLatlngs:function(){a.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes){return}var m,l,h,k;for(m=0,h=this._holes.length;m<h;m++){this._holePoints[m]=[];for(l=0,k=this._holes[m].length;l<k;l++){this._holePoints[m][l]=this._map.latLngToLayerPoint(this._holes[m][l])}}},setLatLngs:function(h){if(h&&a.Util.isArray(h[0])&&(typeof h[0][0]!=="number")){this._initWithHoles(h);return this.redraw()}else{return a.Polyline.prototype.setLatLngs.call(this,h)}},_clipPoints:function(){var l=this._originalPoints,m=[];this._parts=[l].concat(this._holePoints);if(this.options.noClip){return}for(var k=0,j=this._parts.length;k<j;k++){var h=a.PolyUtil.clipPolygon(this._parts[k],this._map._pathViewport);if(h.length){m.push(h)}}this._parts=m},_getPathPartStr:function(h){var i=a.Polyline.prototype._getPathPartStr.call(this,h);return i+(a.Browser.svg?"z":"x")}});a.polygon=function(h,i){return new a.Polygon(h,i)};(function(){function h(i){return a.FeatureGroup.extend({initialize:function(j,k){this._layers={};this._options=k;this.setLatLngs(j)},setLatLngs:function(k){var l=0,j=k.length;this.eachLayer(function(m){if(l<j){m.setLatLngs(k[l++])}else{this.removeLayer(m)}},this);while(l<j){this.addLayer(new i(k[l++],this._options))}return this},getLatLngs:function(){var j=[];this.eachLayer(function(k){j.push(k.getLatLngs())});return j}})}a.MultiPolyline=h(a.Polyline);a.MultiPolygon=h(a.Polygon);a.multiPolyline=function(i,j){return new a.MultiPolyline(i,j)};a.multiPolygon=function(i,j){return new a.MultiPolygon(i,j)}}());a.Rectangle=a.Polygon.extend({initialize:function(i,h){a.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(i),h)},setBounds:function(h){this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){h=a.latLngBounds(h);return[h.getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});a.rectangle=function(i,h){return new a.Rectangle(i,h)};a.Circle=a.Path.extend({initialize:function(j,h,i){a.Path.prototype.initialize.call(this,i);this._latlng=a.latLng(j);this._mRadius=h},options:{fill:true},setLatLng:function(h){this._latlng=a.latLng(h);return this.redraw()},setRadius:function(h){this._mRadius=h;return this.redraw()},projectLatlngs:function(){var j=this._getLngRadius(),i=this._latlng,h=this._map.latLngToLayerPoint([i.lat,i.lng-j]);this._point=this._map.latLngToLayerPoint(i);this._radius=Math.max(this._point.x-h.x,1)},getBounds:function(){var j=this._getLngRadius(),h=(this._mRadius/40075017)*360,i=this._latlng;return new a.LatLngBounds([i.lat-h,i.lng-j],[i.lat+h,i.lng+j])},getLatLng:function(){return this._latlng},getPathString:function(){var i=this._point,h=this._radius;if(this._checkIfEmpty()){return""}if(a.Browser.svg){return"M"+i.x+","+(i.y-h)+"A"+h+","+h+",0,1,1,"+(i.x-0.1)+","+(i.y-h)+" z"}else{i._round();h=Math.round(h);return"AL "+i.x+","+i.y+" "+h+","+h+" 0,"+(65535*360)}},getRadius:function(){return this._mRadius},_getLatRadius:function(){return(this._mRadius/40075017)*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(a.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map){return false}var h=this._map._pathViewport,i=this._radius,j=this._point;return j.x-i>h.max.x||j.y-i>h.max.y||j.x+i<h.min.x||j.y+i<h.min.y}});a.circle=function(j,h,i){return new a.Circle(j,h,i)};a.CircleMarker=a.Circle.extend({options:{radius:10,weight:2},initialize:function(i,h){a.Circle.prototype.initialize.call(this,i,null,h);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){a.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius)},setLatLng:function(h){a.Circle.prototype.setLatLng.call(this,h);if(this._popup&&this._popup._isOpen){this._popup.setLatLng(h)}return this},setRadius:function(h){this.options.radius=this._radius=h;return this.redraw()},getRadius:function(){return this._radius}});a.circleMarker=function(i,h){return new a.CircleMarker(i,h)};a.Polyline.include(!a.Path.CANVAS?{}:{_containsPoint:function(h,r){var q,o,m,s,n,t,l,u=this.options.weight/2;if(a.Browser.touch){u+=10}for(q=0,s=this._parts.length;q<s;q++){l=this._parts[q];for(o=0,n=l.length,m=n-1;o<n;m=o++){if(!r&&(o===0)){continue}t=a.LineUtil.pointToSegmentDistance(h,l[m],l[o]);if(t<=u){return true}}}return false}});a.Polygon.include(!a.Path.CANVAS?{}:{_containsPoint:function(h){var m=false,l,u,t,r,q,o,s,n;if(a.Polyline.prototype._containsPoint.call(this,h,true)){return true}for(r=0,s=this._parts.length;r<s;r++){l=this._parts[r];for(q=0,n=l.length,o=n-1;q<n;o=q++){u=l[q];t=l[o];if(((u.y>h.y)!==(t.y>h.y))&&(h.x<(t.x-u.x)*(h.y-u.y)/(t.y-u.y)+u.x)){m=!m}}}return m}});a.Circle.include(!a.Path.CANVAS?{}:{_drawPath:function(){var h=this._point;this._ctx.beginPath();this._ctx.arc(h.x,h.y,this._radius,0,Math.PI*2,false)},_containsPoint:function(j){var i=this._point,h=this.options.stroke?this.options.weight/2:0;return(j.distanceTo(i)<=this._radius+h)}});a.CircleMarker.include(!a.Path.CANVAS?{}:{_updateStyle:function(){a.Path.prototype._updateStyle.call(this)}});a.GeoJSON=a.FeatureGroup.extend({initialize:function(i,h){a.setOptions(this,h);this._layers={};if(i){this.addData(i)}},addData:function(k){var o=a.Util.isArray(k)?k:k.features,n,h,m;if(o){for(n=0,h=o.length;n<h;n++){m=o[n];if(m.geometries||m.geometry||m.features||m.coordinates){this.addData(o[n])}}return this}var j=this.options;if(j.filter&&!j.filter(k)){return}var l=a.GeoJSON.geometryToLayer(k,j.pointToLayer,j.coordsToLatLng,j);l.feature=a.GeoJSON.asFeature(k);l.defaultOptions=l.options;this.resetStyle(l);if(j.onEachFeature){j.onEachFeature(k,l)}return this.addLayer(l)},resetStyle:function(h){var i=this.options.style;if(i){a.Util.extend(h.options,h.defaultOptions);this._setLayerStyle(h,i)}},setStyle:function(h){this.eachLayer(function(i){this._setLayerStyle(i,h)},this)},_setLayerStyle:function(h,i){if(typeof i==="function"){i=i(h.feature)}if(h.setStyle){h.setStyle(i)}}});a.extend(a.GeoJSON,{geometryToLayer:function(j,k,l,p){var r=j.type==="Feature"?j.geometry:j,s=r.coordinates,o=[],m,h,n,q;l=l||this.coordsToLatLng;switch(r.type){case"Point":m=l(s);return k?k(j,m):new a.Marker(m);case"MultiPoint":for(n=0,q=s.length;n<q;n++){m=l(s[n]);o.push(k?k(j,m):new a.Marker(m))}return new a.FeatureGroup(o);case"LineString":h=this.coordsToLatLngs(s,0,l);return new a.Polyline(h,p);case"Polygon":if(s.length===2&&!s[1].length){throw new Error("Invalid GeoJSON object.")}h=this.coordsToLatLngs(s,1,l);return new a.Polygon(h,p);case"MultiLineString":h=this.coordsToLatLngs(s,1,l);return new a.MultiPolyline(h,p);case"MultiPolygon":h=this.coordsToLatLngs(s,2,l);return new a.MultiPolygon(h,p);case"GeometryCollection":for(n=0,q=r.geometries.length;n<q;n++){o.push(this.geometryToLayer({geometry:r.geometries[n],type:"Feature",properties:j.properties},k,l,p))}return new a.FeatureGroup(o);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(h){return new a.LatLng(h[1],h[0],h[2])},coordsToLatLngs:function(m,l,o){var n,k,j,h=[];for(k=0,j=m.length;k<j;k++){n=l?this.coordsToLatLngs(m[k],l-1,o):(o||this.coordsToLatLng)(m[k]);h.push(n)}return h},latLngToCoords:function(i){var h=[i.lng,i.lat];if(i.alt!==g){h.push(i.alt)}return h},latLngsToCoords:function(l){var k=[];for(var j=0,h=l.length;j<h;j++){k.push(a.GeoJSON.latLngToCoords(l[j]))}return k},getFeature:function(i,h){return i.feature?a.extend({},i.feature,{geometry:h}):a.GeoJSON.asFeature(h)},asFeature:function(h){if(h.type==="Feature"){return h}return{type:"Feature",properties:{},geometry:h}}});var c={toGeoJSON:function(){return a.GeoJSON.getFeature(this,{type:"Point",coordinates:a.GeoJSON.latLngToCoords(this.getLatLng())})}};a.Marker.include(c);a.Circle.include(c);a.CircleMarker.include(c);a.Polyline.include({toGeoJSON:function(){return a.GeoJSON.getFeature(this,{type:"LineString",coordinates:a.GeoJSON.latLngsToCoords(this.getLatLngs())})}});a.Polygon.include({toGeoJSON:function(){var l=[a.GeoJSON.latLngsToCoords(this.getLatLngs())],j,h,k;l[0].push(l[0][0]);if(this._holes){for(j=0,h=this._holes.length;j<h;j++){k=a.GeoJSON.latLngsToCoords(this._holes[j]);k.push(k[0]);l.push(k)}}return a.GeoJSON.getFeature(this,{type:"Polygon",coordinates:l})}});(function(){function h(i){return function(){var j=[];this.eachLayer(function(k){j.push(k.toGeoJSON().geometry.coordinates)});return a.GeoJSON.getFeature(this,{type:i,coordinates:j})}}a.MultiPolyline.include({toGeoJSON:h("MultiLineString")});a.MultiPolygon.include({toGeoJSON:h("MultiPolygon")});a.LayerGroup.include({toGeoJSON:function(){var l=this.feature&&this.feature.geometry,k=[],j;if(l&&l.type==="MultiPoint"){return h("MultiPoint").call(this)}var i=l&&l.type==="GeometryCollection";this.eachLayer(function(m){if(m.toGeoJSON){j=m.toGeoJSON();k.push(i?j.geometry:a.GeoJSON.asFeature(j))}});if(i){return a.GeoJSON.getFeature(this,{geometries:k,type:"GeometryCollection"})}return{type:"FeatureCollection",features:k}}})}());a.geoJson=function(i,h){return new a.GeoJSON(i,h)};a.DomEvent={addListener:function(k,m,n,i){var h=a.stamp(n),o="_leaflet_"+m+h,p,l,j;if(k[o]){return this}p=function(q){return n.call(i||k,q||a.DomEvent._getEvent())};if(a.Browser.pointer&&m.indexOf("touch")===0){return this.addPointerListener(k,m,p,h)}if(a.Browser.touch&&(m==="dblclick")&&this.addDoubleTapListener){this.addDoubleTapListener(k,p,h)}if("addEventListener" in k){if(m==="mousewheel"){k.addEventListener("DOMMouseScroll",p,false);k.addEventListener(m,p,false)}else{if((m==="mouseenter")||(m==="mouseleave")){l=p;j=(m==="mouseenter"?"mouseover":"mouseout");p=function(q){if(!a.DomEvent._checkMouse(k,q)){return}return l(q)};k.addEventListener(j,p,false)}else{if(m==="click"&&a.Browser.android){l=p;p=function(q){return a.DomEvent._filterClick(q,l)};k.addEventListener(m,p,false)}else{k.addEventListener(m,p,false)}}}}else{if("attachEvent" in k){k.attachEvent("on"+m,p)}}k[o]=p;return this},removeListener:function(l,k,j){var m=a.stamp(j),h="_leaflet_"+k+m,i=l[h];if(!i){return this}if(a.Browser.pointer&&k.indexOf("touch")===0){this.removePointerListener(l,k,m)}else{if(a.Browser.touch&&(k==="dblclick")&&this.removeDoubleTapListener){this.removeDoubleTapListener(l,m)}else{if("removeEventListener" in l){if(k==="mousewheel"){l.removeEventListener("DOMMouseScroll",i,false);l.removeEventListener(k,i,false)}else{if((k==="mouseenter")||(k==="mouseleave")){l.removeEventListener((k==="mouseenter"?"mouseover":"mouseout"),i,false)}else{l.removeEventListener(k,i,false)}}}else{if("detachEvent" in l){l.detachEvent("on"+k,i)}}}}l[h]=null;return this},stopPropagation:function(h){if(h.stopPropagation){h.stopPropagation()}else{h.cancelBubble=true}a.DomEvent._skipped(h);return this},disableScrollPropagation:function(i){var h=a.DomEvent.stopPropagation;return a.DomEvent.on(i,"mousewheel",h).on(i,"MozMousePixelScroll",h)},disableClickPropagation:function(k){var j=a.DomEvent.stopPropagation;for(var h=a.Draggable.START.length-1;h>=0;h--){a.DomEvent.on(k,a.Draggable.START[h],j)}return a.DomEvent.on(k,"click",a.DomEvent._fakeStop).on(k,"dblclick",j)},preventDefault:function(h){if(h.preventDefault){h.preventDefault()}else{h.returnValue=false}return this},stop:function(h){return a.DomEvent.preventDefault(h).stopPropagation(h)},getMousePosition:function(j,h){if(!h){return new a.Point(j.clientX,j.clientY)}var i=h.getBoundingClientRect();return new a.Point(j.clientX-i.left-h.clientLeft,j.clientY-i.top-h.clientTop)},getWheelDelta:function(h){var i=0;if(h.wheelDelta){i=h.wheelDelta/120}if(h.detail){i=-h.detail/3}return i},_skipEvents:{},_fakeStop:function(h){a.DomEvent._skipEvents[h.type]=true},_skipped:function(i){var h=this._skipEvents[i.type];this._skipEvents[i.type]=false;return h},_checkMouse:function(h,k){var j=k.relatedTarget;if(!j){return true}try{while(j&&(j!==h)){j=j.parentNode}}catch(i){return false}return(j!==h)},_getEvent:function(){var i=d.event;if(!i){var h=arguments.callee.caller;while(h){i=h["arguments"][0];if(i&&d.Event===i.constructor){break}h=h.caller}}return i},_filterClick:function(k,j){var i=(k.timeStamp||k.originalEvent.timeStamp),h=a.DomEvent._lastClick&&(i-a.DomEvent._lastClick);if((h&&h>100&&h<1000)||(k.target._simulatedClick&&!k._simulated)){a.DomEvent.stop(k);return}a.DomEvent._lastClick=i;return j(k)}};a.DomEvent.on=a.DomEvent.addListener;a.DomEvent.off=a.DomEvent.removeListener;a.Draggable=a.Class.extend({includes:a.Mixin.Events,statics:{START:a.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(h,i){this._element=h;this._dragStartTarget=i||h},enable:function(){if(this._enabled){return}for(var h=a.Draggable.START.length-1;h>=0;h--){a.DomEvent.on(this._dragStartTarget,a.Draggable.START[h],this._onDown,this)}this._enabled=true},disable:function(){if(!this._enabled){return}for(var h=a.Draggable.START.length-1;h>=0;h--){a.DomEvent.off(this._dragStartTarget,a.Draggable.START[h],this._onDown,this)}this._enabled=false;this._moved=false},_onDown:function(h){this._moved=false;if(h.shiftKey||((h.which!==1)&&(h.button!==1)&&!h.touches)){return}a.DomEvent.stopPropagation(h);if(a.Draggable._disabled){return}a.DomUtil.disableImageDrag();a.DomUtil.disableTextSelection();if(this._moving){return}var i=h.touches?h.touches[0]:h;this._startPoint=new a.Point(i.clientX,i.clientY);this._startPos=this._newPos=a.DomUtil.getPosition(this._element);a.DomEvent.on(b,a.Draggable.MOVE[h.type],this._onMove,this).on(b,a.Draggable.END[h.type],this._onUp,this)},_onMove:function(i){if(i.touches&&i.touches.length>1){this._moved=true;return}var k=(i.touches&&i.touches.length===1?i.touches[0]:i),h=new a.Point(k.clientX,k.clientY),j=h.subtract(this._startPoint);if(!j.x&&!j.y){return}a.DomEvent.preventDefault(i);if(!this._moved){this.fire("dragstart");this._moved=true;this._startPos=a.DomUtil.getPosition(this._element).subtract(j);a.DomUtil.addClass(b.body,"leaflet-dragging");a.DomUtil.addClass((i.target||i.srcElement),"leaflet-drag-target")}this._newPos=this._startPos.add(j);this._moving=true;a.Util.cancelAnimFrame(this._animRequest);this._animRequest=a.Util.requestAnimFrame(this._updatePosition,this,true,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag");a.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},_onUp:function(j){a.DomUtil.removeClass(b.body,"leaflet-dragging");a.DomUtil.removeClass((j.target||j.srcElement),"leaflet-drag-target");for(var h in a.Draggable.MOVE){a.DomEvent.off(b,a.Draggable.MOVE[h],this._onMove).off(b,a.Draggable.END[h],this._onUp)}a.DomUtil.enableImageDrag();a.DomUtil.enableTextSelection();if(this._moved&&this._moving){a.Util.cancelAnimFrame(this._animRequest);this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})}this._moving=false}});a.Handler=a.Class.extend({initialize:function(h){this._map=h},enable:function(){if(this._enabled){return}this._enabled=true;this.addHooks()},disable:function(){if(!this._enabled){return}this._enabled=false;this.removeHooks()},enabled:function(){return !!this._enabled}});a.Map.mergeOptions({dragging:true,inertia:!a.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:a.Browser.touch?32:18,easeLinearity:0.25,worldCopyJump:false});a.Map.Drag=a.Handler.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new a.Draggable(h._mapPane,h._container);this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);if(h.options.worldCopyJump){this._draggable.on("predrag",this._onPreDrag,this);h.on("viewreset",this._onViewReset,this);h.whenReady(this._onViewReset,this)}}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var h=this._map;if(h._panAnim){h._panAnim.stop()}h.fire("movestart").fire("dragstart");if(h.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(){if(this._map.options.inertia){var h=this._lastTime=+new Date(),i=this._lastPos=this._draggable._newPos;this._positions.push(i);this._times.push(h);if(h-this._times[0]>200){this._positions.shift();this._times.shift()}}this._map.fire("move").fire("drag")},_onViewReset:function(){var i=this._map.getSize()._divideBy(2),h=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=h.subtract(i).x;this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var n=this._worldWidth,m=Math.round(n/2),i=this._initialWorldOffset,h=this._draggable._newPos.x,k=(h-m+i)%n+m-i,j=(h+m+i)%n-m-i,l=Math.abs(k+i)<Math.abs(j+i)?k:j;this._draggable._newPos.x=l},_onDragEnd:function(q){var i=this._map,u=i.options,p=+new Date()-this._lastTime,h=!u.inertia||p>u.inertiaThreshold||!this._positions[0];i.fire("dragend",q);if(h){i.fire("moveend")}else{var r=this._lastPos.subtract(this._positions[0]),n=(this._lastTime+p-this._times[0])/1000,m=u.easeLinearity,l=r.multiplyBy(m/n),k=l.distanceTo([0,0]),t=Math.min(u.inertiaMaxSpeed,k),s=l.multiplyBy(t/k),j=t/(u.inertiaDeceleration*m),o=s.multiplyBy(-j/2).round();if(!o.x||!o.y){i.fire("moveend")}else{o=i._limitOffset(o,i.options.maxBounds);a.Util.requestAnimFrame(function(){i.panBy(o,{duration:j,easeLinearity:m,noMoveStart:true})})}}}});a.Map.addInitHook("addHandler","dragging",a.Map.Drag);a.Map.mergeOptions({doubleClickZoom:true});a.Map.DoubleClickZoom=a.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(j){var i=this._map,h=i.getZoom()+(j.originalEvent.shiftKey?-1:1);if(i.options.doubleClickZoom==="center"){i.setZoom(h)}else{i.setZoomAround(j.containerPoint,h)}}});a.Map.addInitHook("addHandler","doubleClickZoom",a.Map.DoubleClickZoom);a.Map.mergeOptions({scrollWheelZoom:true});a.Map.ScrollWheelZoom=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);a.DomEvent.on(this._map._container,"MozMousePixelScroll",a.DomEvent.preventDefault);this._delta=0},removeHooks:function(){a.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll);a.DomEvent.off(this._map._container,"MozMousePixelScroll",a.DomEvent.preventDefault)},_onWheelScroll:function(i){var j=a.DomEvent.getWheelDelta(i);this._delta+=j;this._lastMousePos=this._map.mouseEventToContainerPoint(i);if(!this._startTime){this._startTime=+new Date()}var h=Math.max(40-(+new Date()-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(a.bind(this._performZoom,this),h);a.DomEvent.preventDefault(i);a.DomEvent.stopPropagation(i)},_performZoom:function(){var i=this._map,j=this._delta,h=i.getZoom();j=j>0?Math.ceil(j):Math.floor(j);j=Math.max(Math.min(j,4),-4);j=i._limitZoom(h+j)-h;this._delta=0;this._startTime=null;if(!j){return}if(i.options.scrollWheelZoom==="center"){i.setZoom(h+j)}else{i.setZoomAround(this._lastMousePos,h+j)}}});a.Map.addInitHook("addHandler","scrollWheelZoom",a.Map.ScrollWheelZoom);a.extend(a.DomEvent,{_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",_touchend:a.Browser.msPointer?"MSPointerUp":a.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(m,u,h){var t,p=false,n=250,l,j="_leaflet_",o=this._touchstart,s=this._touchend,r=[];function k(x){var w;if(a.Browser.pointer){r.push(x.pointerId);w=r.length}else{w=x.touches.length}if(w>1){return}var v=Date.now(),y=v-(t||v);l=x.touches?x.touches[0]:x;p=(y>0&&y<=n);t=v}function q(y){if(a.Browser.pointer){var w=r.indexOf(y.pointerId);if(w===-1){return}r.splice(w,1)}if(p){if(a.Browser.pointer){var v={},z;for(var x in l){z=l[x];if(typeof z==="function"){v[x]=z.bind(l)}else{v[x]=z}}l=v}l.type="dblclick";u(l);t=null}}m[j+o+h]=k;m[j+s+h]=q;var i=a.Browser.pointer?b.documentElement:m;m.addEventListener(o,k,false);i.addEventListener(s,q,false);if(a.Browser.pointer){i.addEventListener(a.DomEvent.POINTER_CANCEL,q,false)}return this},removeDoubleTapListener:function(i,j){var h="_leaflet_";i.removeEventListener(this._touchstart,i[h+this._touchstart+j],false);(a.Browser.pointer?b.documentElement:i).removeEventListener(this._touchend,i[h+this._touchend+j],false);if(a.Browser.pointer){b.documentElement.removeEventListener(a.DomEvent.POINTER_CANCEL,i[h+this._touchend+j],false)}return this}});a.extend(a.DomEvent,{POINTER_DOWN:a.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:a.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:a.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:a.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:false,addPointerListener:function(j,i,h,k){switch(i){case"touchstart":return this.addPointerListenerStart(j,i,h,k);case"touchend":return this.addPointerListenerEnd(j,i,h,k);case"touchmove":return this.addPointerListenerMove(j,i,h,k);default:throw"Unknown touch event type"}},addPointerListenerStart:function(n,l,k,o){var m="_leaflet_",i=this._pointers;var h=function(r){a.DomEvent.preventDefault(r);var q=false;for(var p=0;p<i.length;p++){if(i[p].pointerId===r.pointerId){q=true;break}}if(!q){i.push(r)}r.touches=i.slice();r.changedTouches=[r];k(r)};n[m+"touchstart"+o]=h;n.addEventListener(this.POINTER_DOWN,h,false);if(!this._pointerDocumentListener){var j=function(q){for(var p=0;p<i.length;p++){if(i[p].pointerId===q.pointerId){i.splice(p,1);break}}};b.documentElement.addEventListener(this.POINTER_UP,j,false);b.documentElement.addEventListener(this.POINTER_CANCEL,j,false);this._pointerDocumentListener=true}return this},addPointerListenerMove:function(m,j,i,n){var l="_leaflet_",k=this._pointers;function h(p){if((p.pointerType===p.MSPOINTER_TYPE_MOUSE||p.pointerType==="mouse")&&p.buttons===0){return}for(var o=0;o<k.length;o++){if(k[o].pointerId===p.pointerId){k[o]=p;break}}p.touches=k.slice();p.changedTouches=[p];i(p)}m[l+"touchmove"+n]=h;m.addEventListener(this.POINTER_MOVE,h,false);return this},addPointerListenerEnd:function(m,j,i,n){var l="_leaflet_",k=this._pointers;var h=function(p){for(var o=0;o<k.length;o++){if(k[o].pointerId===p.pointerId){k.splice(o,1);break}}p.touches=k.slice();p.changedTouches=[p];i(p)};m[l+"touchend"+n]=h;m.addEventListener(this.POINTER_UP,h,false);m.addEventListener(this.POINTER_CANCEL,h,false);return this},removePointerListener:function(k,i,l){var j="_leaflet_",h=k[j+i+l];switch(i){case"touchstart":k.removeEventListener(this.POINTER_DOWN,h,false);break;case"touchmove":k.removeEventListener(this.POINTER_MOVE,h,false);break;case"touchend":k.removeEventListener(this.POINTER_UP,h,false);k.removeEventListener(this.POINTER_CANCEL,h,false);break}return this}});a.Map.mergeOptions({touchZoom:a.Browser.touch&&!a.Browser.android23,bounceAtZoomLimits:true});a.Map.TouchZoom=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){a.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(k){var j=this._map;if(!k.touches||k.touches.length!==2||j._animatingZoom||this._zooming){return}var l=j.mouseEventToLayerPoint(k.touches[0]),i=j.mouseEventToLayerPoint(k.touches[1]),h=j._getCenterLayerPoint();this._startCenter=l.add(i)._divideBy(2);this._startDist=l.distanceTo(i);this._moved=false;this._zooming=true;this._centerOffset=h.subtract(this._startCenter);if(j._panAnim){j._panAnim.stop()}a.DomEvent.on(b,"touchmove",this._onTouchMove,this).on(b,"touchend",this._onTouchEnd,this);a.DomEvent.preventDefault(k)},_onTouchMove:function(j){var i=this._map;if(!j.touches||j.touches.length!==2||!this._zooming){return}var k=i.mouseEventToLayerPoint(j.touches[0]),h=i.mouseEventToLayerPoint(j.touches[1]);this._scale=k.distanceTo(h)/this._startDist;this._delta=k._add(h)._divideBy(2)._subtract(this._startCenter);if(this._scale===1){return}if(!i.options.bounceAtZoomLimits){if((i.getZoom()===i.getMinZoom()&&this._scale<1)||(i.getZoom()===i.getMaxZoom()&&this._scale>1)){return}}if(!this._moved){a.DomUtil.addClass(i._mapPane,"leaflet-touching");i.fire("movestart").fire("zoomstart");this._moved=true}a.Util.cancelAnimFrame(this._animRequest);this._animRequest=a.Util.requestAnimFrame(this._updateOnMove,this,true,this._map._container);a.DomEvent.preventDefault(j)},_updateOnMove:function(){var k=this._map,i=this._getScaleOrigin(),h=k.layerPointToLatLng(i),j=k.getScaleZoom(this._scale);k._animateZoom(h,j,this._startCenter,this._scale,this._delta)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return}var n=this._map;this._zooming=false;a.DomUtil.removeClass(n._mapPane,"leaflet-touching");a.Util.cancelAnimFrame(this._animRequest);a.DomEvent.off(b,"touchmove",this._onTouchMove).off(b,"touchend",this._onTouchEnd);var j=this._getScaleOrigin(),i=n.layerPointToLatLng(j),m=n.getZoom(),h=n.getScaleZoom(this._scale)-m,k=(h>0?Math.ceil(h):Math.floor(h)),l=n._limitZoom(m+k),o=n.getZoomScale(l)/this._scale;n._animateZoom(i,l,j,o)},_getScaleOrigin:function(){var h=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(h)}});a.Map.addInitHook("addHandler","touchZoom",a.Map.TouchZoom);a.Map.mergeOptions({tap:true,tapTolerance:15});a.Map.Tap=a.Handler.extend({addHooks:function(){a.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){a.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(i){if(!i.touches){return}a.DomEvent.preventDefault(i);this._fireClick=true;if(i.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return}var j=i.touches[0],h=j.target;this._startPos=this._newPos=new a.Point(j.clientX,j.clientY);if(h.tagName&&h.tagName.toLowerCase()==="a"){a.DomUtil.addClass(h,"leaflet-active")}this._holdTimeout=setTimeout(a.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent("contextmenu",j)}},this),1000);a.DomEvent.on(b,"touchmove",this._onMove,this).on(b,"touchend",this._onUp,this)},_onUp:function(i){clearTimeout(this._holdTimeout);a.DomEvent.off(b,"touchmove",this._onMove,this).off(b,"touchend",this._onUp,this);if(this._fireClick&&i&&i.changedTouches){var j=i.changedTouches[0],h=j.target;if(h&&h.tagName&&h.tagName.toLowerCase()==="a"){a.DomUtil.removeClass(h,"leaflet-active")}if(this._isTapValid()){this._simulateEvent("click",j)}}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(h){var i=h.touches[0];this._newPos=new a.Point(i.clientX,i.clientY)},_simulateEvent:function(h,j){var i=b.createEvent("MouseEvents");i._simulated=true;j.target._simulatedClick=true;i.initMouseEvent(h,true,true,d,1,j.screenX,j.screenY,j.clientX,j.clientY,false,false,false,false,0,null);j.target.dispatchEvent(i)}});if(a.Browser.touch&&!a.Browser.pointer){a.Map.addInitHook("addHandler","tap",a.Map.Tap)}a.Map.mergeOptions({boxZoom:true});a.Map.BoxZoom=a.Handler.extend({initialize:function(h){this._map=h;this._container=h._container;this._pane=h._panes.overlayPane;this._moved=false},addHooks:function(){a.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){a.DomEvent.off(this._container,"mousedown",this._onMouseDown);this._moved=false},moved:function(){return this._moved},_onMouseDown:function(h){this._moved=false;if(!h.shiftKey||((h.which!==1)&&(h.button!==1))){return false}a.DomUtil.disableTextSelection();a.DomUtil.disableImageDrag();this._startLayerPoint=this._map.mouseEventToLayerPoint(h);a.DomEvent.on(b,"mousemove",this._onMouseMove,this).on(b,"mouseup",this._onMouseUp,this).on(b,"keydown",this._onKeyDown,this)},_onMouseMove:function(l){if(!this._moved){this._box=a.DomUtil.create("div","leaflet-zoom-box",this._pane);a.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";this._map.fire("boxzoomstart")}var k=this._startLayerPoint,j=this._box,h=this._map.mouseEventToLayerPoint(l),m=h.subtract(k),i=new a.Point(Math.min(h.x,k.x),Math.min(h.y,k.y));a.DomUtil.setPosition(j,i);this._moved=true;j.style.width=(Math.max(0,Math.abs(m.x)-4))+"px";j.style.height=(Math.max(0,Math.abs(m.y)-4))+"px"},_finish:function(){if(this._moved){this._pane.removeChild(this._box);this._container.style.cursor=""}a.DomUtil.enableTextSelection();a.DomUtil.enableImageDrag();a.DomEvent.off(b,"mousemove",this._onMouseMove).off(b,"mouseup",this._onMouseUp).off(b,"keydown",this._onKeyDown)},_onMouseUp:function(k){this._finish();var j=this._map,h=j.mouseEventToLayerPoint(k);if(this._startLayerPoint.equals(h)){return}var i=new a.LatLngBounds(j.layerPointToLatLng(this._startLayerPoint),j.layerPointToLatLng(h));j.fitBounds(i);j.fire("boxzoomend",{boxZoomBounds:i})},_onKeyDown:function(h){if(h.keyCode===27){this._finish()}}});a.Map.addInitHook("addHandler","boxZoom",a.Map.BoxZoom);a.Map.mergeOptions({keyboard:true,keyboardPanOffset:80,keyboardZoomOffset:1});a.Map.Keyboard=a.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(h){this._map=h;this._setPanOffset(h.options.keyboardPanOffset);this._setZoomOffset(h.options.keyboardZoomOffset)},addHooks:function(){var h=this._map._container;if(h.tabIndex===-1){h.tabIndex="0"}a.DomEvent.on(h,"focus",this._onFocus,this).on(h,"blur",this._onBlur,this).on(h,"mousedown",this._onMouseDown,this);this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var h=this._map._container;a.DomEvent.off(h,"focus",this._onFocus,this).off(h,"blur",this._onBlur,this).off(h,"mousedown",this._onMouseDown,this);this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(this._focused){return}var h=b.body,k=b.documentElement,j=h.scrollTop||k.scrollTop,i=h.scrollLeft||k.scrollLeft;this._map._container.focus();d.scrollTo(i,j)},_onFocus:function(){this._focused=true;this._map.fire("focus")},_onBlur:function(){this._focused=false;this._map.fire("blur")},_setPanOffset:function(m){var l=this._panKeys={},j=this.keyCodes,k,h;for(k=0,h=j.left.length;k<h;k++){l[j.left[k]]=[-1*m,0]}for(k=0,h=j.right.length;k<h;k++){l[j.right[k]]=[m,0]}for(k=0,h=j.down.length;k<h;k++){l[j.down[k]]=[0,m]}for(k=0,h=j.up.length;k<h;k++){l[j.up[k]]=[0,-1*m]}},_setZoomOffset:function(m){var l=this._zoomKeys={},j=this.keyCodes,k,h;for(k=0,h=j.zoomIn.length;k<h;k++){l[j.zoomIn[k]]=m}for(k=0,h=j.zoomOut.length;k<h;k++){l[j.zoomOut[k]]=-m}},_addHooks:function(){a.DomEvent.on(b,"keydown",this._onKeyDown,this)},_removeHooks:function(){a.DomEvent.off(b,"keydown",this._onKeyDown,this)},_onKeyDown:function(j){var h=j.keyCode,i=this._map;if(h in this._panKeys){if(i._panAnim&&i._panAnim._inProgress){return}i.panBy(this._panKeys[h]);if(i.options.maxBounds){i.panInsideBounds(i.options.maxBounds)}}else{if(h in this._zoomKeys){i.setZoom(i.getZoom()+this._zoomKeys[h])}else{return}}a.DomEvent.stop(j)}});a.Map.addInitHook("addHandler","keyboard",a.Map.Keyboard);a.Handler.MarkerDrag=a.Handler.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;if(!this._draggable){this._draggable=new a.Draggable(h,h)}this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this);this._draggable.enable();a.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this);this._draggable.disable();a.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var h=this._marker,k=h._shadow,i=a.DomUtil.getPosition(h._icon),j=h._map.layerPointToLatLng(i);if(k){a.DomUtil.setPosition(k,i)}h._latlng=j;h.fire("move",{latlng:j}).fire("drag")},_onDragEnd:function(h){this._marker.fire("moveend").fire("dragend",h)}});a.Control=a.Class.extend({options:{position:"topright"},initialize:function(h){a.setOptions(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var i=this._map;if(i){i.removeControl(this)}this.options.position=h;if(i){i.addControl(this)}return this},getContainer:function(){return this._container},addTo:function(j){this._map=j;var h=this._container=this.onAdd(j),k=this.getPosition(),i=j._controlCorners[k];a.DomUtil.addClass(h,"leaflet-control");if(k.indexOf("bottom")!==-1){i.insertBefore(h,i.firstChild)}else{i.appendChild(h)}return this},removeFrom:function(i){var j=this.getPosition(),h=i._controlCorners[j];h.removeChild(this._container);this._map=null;if(this.onRemove){this.onRemove(i)}return this},_refocusOnMap:function(){if(this._map){this._map.getContainer().focus()}}});a.control=function(h){return new a.Control(h)};a.Map.include({addControl:function(h){h.addTo(this);return this},removeControl:function(h){h.removeFrom(this);return this},_initControlPos:function(){var j=this._controlCorners={},i="leaflet-",h=this._controlContainer=a.DomUtil.create("div",i+"control-container",this._container);function k(m,n){var l=i+m+" "+i+n;j[m+n]=a.DomUtil.create("div",l,h)}k("top","left");k("top","right");k("bottom","left");k("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}});a.Control.Zoom=a.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(i){var j="leaflet-control-zoom",h=a.DomUtil.create("div",j+" leaflet-bar");this._map=i;this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,j+"-in",h,this._zoomIn,this);this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,j+"-out",h,this._zoomOut,this);this._updateDisabled();i.on("zoomend zoomlevelschange",this._updateDisabled,this);return h},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(h){this._map.zoomIn(h.shiftKey?3:1)},_zoomOut:function(h){this._map.zoomOut(h.shiftKey?3:1)},_createButton:function(k,o,m,h,l,j){var n=a.DomUtil.create("a",m,h);n.innerHTML=k;n.href="#";n.title=o;var i=a.DomEvent.stopPropagation;a.DomEvent.on(n,"click",i).on(n,"mousedown",i).on(n,"dblclick",i).on(n,"click",a.DomEvent.preventDefault).on(n,"click",l,j).on(n,"click",this._refocusOnMap,j);return n},_updateDisabled:function(){var i=this._map,h="leaflet-disabled";a.DomUtil.removeClass(this._zoomInButton,h);a.DomUtil.removeClass(this._zoomOutButton,h);if(i._zoom===i.getMinZoom()){a.DomUtil.addClass(this._zoomOutButton,h)}if(i._zoom===i.getMaxZoom()){a.DomUtil.addClass(this._zoomInButton,h)}}});a.Map.mergeOptions({zoomControl:true});a.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new a.Control.Zoom();this.addControl(this.zoomControl)}});a.control.zoom=function(h){return new a.Control.Zoom(h)};a.Control.Attribution=a.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(h){a.setOptions(this,h);this._attributions={}},onAdd:function(j){this._container=a.DomUtil.create("div","leaflet-control-attribution");a.DomEvent.disableClickPropagation(this._container);for(var h in j._layers){if(j._layers[h].getAttribution){this.addAttribution(j._layers[h].getAttribution())}}j.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(h){h.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(h){this.options.prefix=h;this._update();return this},addAttribution:function(h){if(!h){return}if(!this._attributions[h]){this._attributions[h]=0}this._attributions[h]++;this._update();return this},removeAttribution:function(h){if(!h){return}if(this._attributions[h]){this._attributions[h]--;this._update()}return this},_update:function(){if(!this._map){return}var k=[];for(var h in this._attributions){if(this._attributions[h]){k.push(h)}}var j=[];if(this.options.prefix){j.push(this.options.prefix)}if(k.length){j.push(k.join(", "))}this._container.innerHTML=j.join(" | ")},_onLayerAdd:function(h){if(h.layer.getAttribution){this.addAttribution(h.layer.getAttribution())}},_onLayerRemove:function(h){if(h.layer.getAttribution){this.removeAttribution(h.layer.getAttribution())}}});a.Map.mergeOptions({attributionControl:true});a.Map.addInitHook(function(){if(this.options.attributionControl){this.attributionControl=(new a.Control.Attribution()).addTo(this)}});a.control.attribution=function(h){return new a.Control.Attribution(h)};a.Control.Scale=a.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:true,imperial:true,updateWhenIdle:false},onAdd:function(k){this._map=k;var j="leaflet-control-scale",h=a.DomUtil.create("div",j),i=this.options;this._addScales(i,j,h);k.on(i.updateWhenIdle?"moveend":"move",this._update,this);k.whenReady(this._update,this);return h},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(i,j,h){if(i.metric){this._mScale=a.DomUtil.create("div",j+"-line",h)}if(i.imperial){this._iScale=a.DomUtil.create("div",j+"-line",h)}},_update:function(){var k=this._map.getBounds(),l=k.getCenter().lat,j=6378137*Math.PI*Math.cos(l*Math.PI/180),n=j*(k.getNorthEast().lng-k.getSouthWest().lng)/180,i=this._map.getSize(),h=this.options,m=0;if(i.x>0){m=n*(h.maxWidth/i.x)}this._updateScales(h,m)},_updateScales:function(h,i){if(h.metric&&i){this._updateMetric(i)}if(h.imperial&&i){this._updateImperial(i)}},_updateMetric:function(i){var h=this._getRoundNum(i);this._mScale.style.width=this._getScaleWidth(h/i)+"px";this._mScale.innerHTML=h<1000?h+" m":(h/1000)+" km"},_updateImperial:function(l){var k=l*3.2808399,m=this._iScale,j,i,h;if(k>5280){j=k/5280;i=this._getRoundNum(j);m.style.width=this._getScaleWidth(i/j)+"px";m.innerHTML=i+" mi"}else{h=this._getRoundNum(k);m.style.width=this._getScaleWidth(h/k)+"px";m.innerHTML=h+" ft"}},_getScaleWidth:function(h){return Math.round(this.options.maxWidth*h)-10},_getRoundNum:function(i){var h=Math.pow(10,(Math.floor(i)+"").length-1),j=i/h;j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:1;return h*j}});a.control.scale=function(h){return new a.Control.Scale(h)};a.Control.Layers=a.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true},initialize:function(l,k,h){a.setOptions(this,h);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(var j in l){this._addLayer(l[j],j)}for(j in k){this._addLayer(k[j],j,true)}},onAdd:function(h){this._initLayout();this._update();h.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this);return this._container},onRemove:function(h){h.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(i,h){this._addLayer(i,h);this._update();return this},addOverlay:function(i,h){this._addLayer(i,h,true);this._update();return this},removeLayer:function(h){var i=a.stamp(h);delete this._layers[i];this._update();return this},_initLayout:function(){var i="leaflet-control-layers",h=this._container=a.DomUtil.create("div",i);h.setAttribute("aria-haspopup",true);if(!a.Browser.touch){a.DomEvent.disableClickPropagation(h).disableScrollPropagation(h)}else{a.DomEvent.on(h,"click",a.DomEvent.stopPropagation)}var k=this._form=a.DomUtil.create("form",i+"-list");if(this.options.collapsed){if(!a.Browser.android){a.DomEvent.on(h,"mouseover",this._expand,this).on(h,"mouseout",this._collapse,this)}var j=this._layersLink=a.DomUtil.create("a",i+"-toggle",h);j.href="#";j.title="Layers";if(a.Browser.touch){a.DomEvent.on(j,"click",a.DomEvent.stop).on(j,"click",this._expand,this)}else{a.DomEvent.on(j,"focus",this._expand,this)}a.DomEvent.on(k,"click",function(){setTimeout(a.bind(this._onInputClick,this),0)},this);this._map.on("click",this._collapse,this)}else{this._expand()}this._baseLayersList=a.DomUtil.create("div",i+"-base",k);this._separator=a.DomUtil.create("div",i+"-separator",k);this._overlaysList=a.DomUtil.create("div",i+"-overlays",k);h.appendChild(k)},_addLayer:function(j,i,h){var k=a.stamp(j);this._layers[k]={layer:j,name:i,overlay:h};if(this.options.autoZIndex&&j.setZIndex){this._lastZIndex++;j.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container){return}this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";var h=false,k=false,j,l;for(j in this._layers){l=this._layers[j];this._addItem(l);k=k||l.overlay;h=h||!l.overlay}this._separator.style.display=k&&h?"":"none"},_onLayerChange:function(j){var i=this._layers[a.stamp(j.layer)];if(!i){return}if(!this._handlingClick){this._update()}var h=i.overlay?(j.type==="layeradd"?"overlayadd":"overlayremove"):(j.type==="layeradd"?"baselayerchange":null);if(h){this._map.fire(h,i)}},_createRadioElement:function(h,k){var j='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"';if(k){j+=' checked="checked"'}j+="/>";var i=b.createElement("div");i.innerHTML=j;return i.firstChild},_addItem:function(m){var k=b.createElement("label"),i,l=this._map.hasLayer(m.layer);if(m.overlay){i=b.createElement("input");i.type="checkbox";i.className="leaflet-control-layers-selector";i.defaultChecked=l}else{i=this._createRadioElement("leaflet-base-layers",l)}i.layerId=a.stamp(m.layer);a.DomEvent.on(i,"click",this._onInputClick,this);var j=b.createElement("span");j.innerHTML=" "+m.name;k.appendChild(i);k.appendChild(j);var h=m.overlay?this._overlaysList:this._baseLayersList;h.appendChild(k);return k},_onInputClick:function(){var k,j,m,h=this._form.getElementsByTagName("input"),l=h.length;this._handlingClick=true;for(k=0;k<l;k++){j=h[k];m=this._layers[j.layerId];if(j.checked&&!this._map.hasLayer(m.layer)){this._map.addLayer(m.layer)}else{if(!j.checked&&this._map.hasLayer(m.layer)){this._map.removeLayer(m.layer)}}}this._handlingClick=false;this._refocusOnMap()},_expand:function(){a.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}});a.control.layers=function(j,i,h){return new a.Control.Layers(j,i,h)};a.PosAnimation=a.Class.extend({includes:a.Mixin.Events,run:function(i,h,j,k){this.stop();this._el=i;this._inProgress=true;this._newPos=h;this.fire("start");i.style[a.DomUtil.TRANSITION]="all "+(j||0.25)+"s cubic-bezier(0,0,"+(k||0.5)+",1)";a.DomEvent.on(i,a.DomUtil.TRANSITION_END,this._onTransitionEnd,this);a.DomUtil.setPosition(i,h);a.Util.falseFn(i.offsetWidth);this._stepTimer=setInterval(a.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress){return}a.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();a.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var h=this._getPos();if(!h){this._onTransitionEnd();return}this._el._leaflet_pos=h;this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var l,k,j,i=this._el,h=d.getComputedStyle(i);if(a.Browser.any3d){j=h[a.DomUtil.TRANSFORM].match(this._transformRe);if(!j){return}l=parseFloat(j[1]);k=parseFloat(j[2])}else{l=parseFloat(h.left);k=parseFloat(h.top)}return new a.Point(l,k,true)},_onTransitionEnd:function(){a.DomEvent.off(this._el,a.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress){return}this._inProgress=false;this._el.style[a.DomUtil.TRANSITION]="";this._el._leaflet_pos=this._newPos;clearInterval(this._stepTimer);this.fire("step").fire("end")}});a.Map.include({setView:function(h,k,i){k=k===g?this._zoom:this._limitZoom(k);h=this._limitCenter(a.latLng(h),k,this.options.maxBounds);i=i||{};if(this._panAnim){this._panAnim.stop()}if(this._loaded&&!i.reset&&i!==true){if(i.animate!==g){i.zoom=a.extend({animate:i.animate},i.zoom);i.pan=a.extend({animate:i.animate},i.pan)}var j=(this._zoom!==k)?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,k,i.zoom):this._tryAnimatedPan(h,i.pan);if(j){clearTimeout(this._sizeTimer);return this}}this._resetView(h,k);return this},panBy:function(j,h){j=a.point(j).round();h=h||{};if(!j.x&&!j.y){return this}if(!this._panAnim){this._panAnim=new a.PosAnimation();this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}if(!h.noMoveStart){this.fire("movestart")}if(h.animate!==false){a.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(j);this._panAnim.run(this._mapPane,i,h.duration||0.25,h.easeLinearity)}else{this._rawPanBy(j);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){a.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(h,i){var j=this._getCenterOffset(h)._floor();if((i&&i.animate)!==true&&!this.getSize().contains(j)){return false}this.panBy(j,i);return true}});a.PosAnimation=a.DomUtil.TRANSITION?a.PosAnimation:a.PosAnimation.extend({run:function(i,h,j,k){this.stop();this._el=i;this._inProgress=true;this._duration=j||0.25;this._easeOutPower=1/Math.max(k||0.5,0.2);this._startPos=a.DomUtil.getPosition(i);this._offset=h.subtract(this._startPos);this._startTime=+new Date();this.fire("start");this._animate()},stop:function(){if(!this._inProgress){return}this._step();this._complete()},_animate:function(){this._animId=a.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(){var h=(+new Date())-this._startTime,i=this._duration*1000;if(h<i){this._runFrame(this._easeOut(h/i))}else{this._runFrame(1);this._complete()}},_runFrame:function(h){var i=this._startPos.add(this._offset.multiplyBy(h));a.DomUtil.setPosition(this._el,i);this.fire("step")},_complete:function(){a.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}});a.Map.mergeOptions({zoomAnimation:true,zoomAnimationThreshold:4});if(a.DomUtil.TRANSITION){a.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&a.DomUtil.TRANSITION&&a.Browser.any3d&&!a.Browser.android23&&!a.Browser.mobileOpera;if(this._zoomAnimated){a.DomEvent.on(this._mapPane,a.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}})}a.Map.include(!a.DomUtil.TRANSITION?{}:{_catchTransitionEnd:function(h){if(this._animatingZoom&&h.propertyName.indexOf("transform")>=0){this._onZoomTransitionEnd()}},_nothingToAnimate:function(){return !this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,k,j){if(this._animatingZoom){return true}j=j||{};if(!this._zoomAnimated||j.animate===false||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold){return false}var m=this.getZoomScale(k),l=this._getCenterOffset(h)._divideBy(1-1/m),i=this._getCenterLayerPoint()._add(l);if(j.animate!==true&&!this.getSize().contains(l)){return false}this.fire("movestart").fire("zoomstart");this._animateZoom(h,k,i,m,null,true);return true},_animateZoom:function(h,k,j,l,m,i){this._animatingZoom=true;a.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim");this._animateToCenter=h;this._animateToZoom=k;if(a.Draggable){a.Draggable._disabled=true}this.fire("zoomanim",{center:h,zoom:k,origin:j,scale:l,delta:m,backwards:i})},_onZoomTransitionEnd:function(){this._animatingZoom=false;a.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._resetView(this._animateToCenter,this._animateToZoom,true,true);if(a.Draggable){a.Draggable._disabled=false}}});a.TileLayer.include({_animateZoom:function(l){if(!this._animating){this._animating=true;this._prepareBgBuffer()}var j=this._bgBuffer,h=a.DomUtil.TRANSFORM,i=l.delta?a.DomUtil.getTranslateString(l.delta):j.style[h],k=a.DomUtil.getScaleString(l.scale,l.origin);j.style[h]=l.backwards?k+" "+i:i+" "+k},_endZoomAnim:function(){var i=this._tileContainer,h=this._bgBuffer;i.style.visibility="";i.parentNode.appendChild(i);a.Util.falseFn(h.offsetWidth);this._animating=false},_clearBgBuffer:function(){var h=this._map;if(h&&!h._animatingZoom&&!h.touchZoom._zooming){this._bgBuffer.innerHTML="";this._bgBuffer.style[a.DomUtil.TRANSFORM]=""}},_prepareBgBuffer:function(){var j=this._tileContainer,i=this._bgBuffer;var h=this._getLoadedTilesPercentage(i),k=this._getLoadedTilesPercentage(j);if(i&&h>0.5&&k<0.5){j.style.visibility="hidden";this._stopLoadingImages(j);return}i.style.visibility="hidden";i.style[a.DomUtil.TRANSFORM]="";this._tileContainer=i;i=this._bgBuffer=j;this._stopLoadingImages(i);clearTimeout(this._clearBgBufferTimer)},_getLoadedTilesPercentage:function(j){var k=j.getElementsByTagName("img"),l,h,m=0;for(l=0,h=k.length;l<h;l++){if(k[l].complete){m++}}return m/h},_stopLoadingImages:function(j){var k=Array.prototype.slice.call(j.getElementsByTagName("img")),l,h,m;for(l=0,h=k.length;l<h;l++){m=k[l];if(!m.complete){m.onload=a.Util.falseFn;m.onerror=a.Util.falseFn;m.src=a.Util.emptyImageUrl;m.parentNode.removeChild(m)}}}});a.Map.include({_defaultLocateOptions:{watch:false,setView:false,maxZoom:Infinity,timeout:10000,maximumAge:0,enableHighAccuracy:false},locate:function(h){h=this._locateOptions=a.extend(this._defaultLocateOptions,h);if(!navigator.geolocation){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var j=a.bind(this._handleGeolocationResponse,this),i=a.bind(this._handleGeolocationError,this);if(h.watch){this._locationWatchId=navigator.geolocation.watchPosition(j,i,h)}else{navigator.geolocation.getCurrentPosition(j,i,h)}return this},stopLocate:function(){if(navigator.geolocation){navigator.geolocation.clearWatch(this._locationWatchId)}if(this._locateOptions){this._locateOptions.setView=false}return this},_handleGeolocationError:function(h){var j=h.code,i=h.message||(j===1?"permission denied":(j===2?"position unavailable":"timeout"));if(this._locateOptions.setView&&!this._loaded){this.fitWorld()}this.fire("locationerror",{code:j,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(o){var n=o.coords.latitude,q=o.coords.longitude,j=new a.LatLng(n,q),p=180*o.coords.accuracy/40075017,k=p/Math.cos(a.LatLng.DEG_TO_RAD*n),h=a.latLngBounds([n-p,q-k],[n+p,q+k]),s=this._locateOptions;if(s.setView){var r=Math.min(this.getBoundsZoom(h),s.maxZoom);this.setView(j,r)}var m={latlng:j,bounds:h,timestamp:o.timestamp};for(var l in o.coords){if(typeof o.coords[l]==="number"){m[l]=o.coords[l]}}this.fire("locationfound",m)}})}(window,document));if(window.sc_require){sc_require("libraries/raphael")}if(!Raphael.fn.line){Raphael.fn.line=function(c,e,b,d){var a=this.path("M"+c+","+e+"L"+b+","+d);return a}}if(!Raphael.el.addClass){Raphael.el.addClass=function(c){var b=this.node.className;var a=b.baseVal;if(a.indexOf(c)<0){if(a.length>0){a+=" "}a+=c;b.baseVal=a}return this}}if(!Raphael.el.removeClass){Raphael.el.removeClass=function(b){var a=this.node.className.baseVal;a=a.replace(b,"").replace(/  +/," ").replace(/^ /,"").replace(/ $/,"");this.node.className.baseVal=a}}if(!Raphael.el.setId){Raphael.el.setId=function(a){this.node.id.baseVal=a;return this}}if(!Raphael.el.isHidden){Raphael.el.isHidden=function(){return(this.node.style.display==="none")}}(function(b){b.extend(true,window,{Slick:{Plugins:{HeaderMenu:a}}});function a(q){var l;var j=this;var n=new Slick.EventHandler();var d={buttonCssClass:null,buttonImage:"../images/down.gif"};var c;var e;function p(r){q=b.extend(true,{},d,q);l=r;n.subscribe(l.onHeaderCellRendered,h).subscribe(l.onBeforeHeaderCellDestroy,g);l.setColumns(l.getColumns());b(document.body).bind("mousedown",i)}function m(){n.unsubscribeAll();b(document.body).unbind("mousedown",i)}function i(r){if(c&&c[0]!=r.target&&!b.contains(c[0],r.target)){k()}}function k(){if(c){c.remove();c=null;e.removeClass("slick-header-column-active")}}function h(v,r){var u=r.column;var w=u.header&&u.header.menu;if(w){var t=q.buttonIsCell?'<div style="display:none"></div>':"<div></div>",s=b(t).addClass("slick-header-menubutton").data("column",u).data("menu",w);if(q.buttonCssClass){s.addClass(q.buttonCssClass)}if(q.buttonImage){s.css("background-image","url("+q.buttonImage+")")}if(w.tooltip){s.attr("title",w.tooltip)}s.appendTo(r.node);if(q.buttonIsCell){b(r.node).bind("click",o)}else{s.bind("click",o)}}}function g(t,r){var s=r.column;if(s.header&&s.header.menu){b(r.node).find(".slick-header-menubutton").remove()}}function o(w){var t=q.buttonIsCell?b(this).find(".slick-header-menubutton"):b(this);var x=t.data("menu");var s=t.data("column");if(j.onBeforeMenuShow.notify({grid:l,column:s,menu:x},w,j)==false){return}if(!c){c=b("<div class='slick-header-menu'></div>").appendTo(document.body)}c.empty();for(var u=0;u<x.items.length;u++){var v=x.items[u];var y=b("<div class='slick-header-menuitem'></div>").data("command",v.command||"").data("column",s).data("item",v).bind("click",f).appendTo(c);if(v.disabled){y.addClass("slick-header-menuitem-disabled")}if(v.tooltip){y.attr("title",v.tooltip)}var r=b("<div class='slick-header-menuicon'></div>").appendTo(y);if(v.iconCssClass){r.addClass(v.iconCssClass)}if(v.iconImage){r.css("background-image","url("+v.iconImage+")")}b("<span class='slick-header-menucontent'></span>").text(v.title).appendTo(y)}c.css("top",b(this).offset().top+b(this).height()).css("left",b(this).offset().left);e=t.closest(".slick-header-column");e.addClass("slick-header-column-active")}function f(t){var u=b(this).data("command");var r=b(this).data("column");var s=b(this).data("item");if(s.disabled){return}k();if(u!=null&&u!=""){j.onCommand.notify({grid:l,column:r,command:u,item:s},t,j)}t.preventDefault();t.stopPropagation()}b.extend(this,{init:p,destroy:m,onBeforeMenuShow:new Slick.Event(),onCommand:new Slick.Event()})}})(jQuery);(function(b){b.extend(true,window,{Slick:{RowSelectionModel:a}});function a(f){var r;var o=[];var i=this;var n=new Slick.EventHandler();var m;var q;var s={selectActiveRow:true};function t(x){q=b.extend(true,{},s,f);r=x;n.subscribe(r.onActiveCellChanged,e(v));n.subscribe(r.onKeyDown,e(l));n.subscribe(r.onClick,e(k))}function w(){n.unsubscribeAll()}function e(x){return function(){if(!m){m=true;x.apply(this,arguments);m=false}}}function g(x){var A=[];for(var z=0;z<x.length;z++){for(var y=x[z].fromRow;y<=x[z].toRow;y++){A.push(y)}}return A}function h(A){var y=[];var x=r.getColumns().length-1;for(var z=0;z<A.length;z++){y.push(new Slick.Range(A[z],0,A[z],x))}return y}function u(A,z){var x,y=[];for(x=A;x<=z;x++){y.push(x)}for(x=z;x<A;x++){y.push(x)}return y}function d(){return g(o)}function j(x){c(h(x))}function c(x){o=x;i.onSelectedRangesChanged.notify(o)}function p(){return o}function v(y,x){if(q.selectActiveRow&&x.row!=null){c([new Slick.Range(x.row,0,x.row,r.getColumns().length-1)])}}function l(C){var y=r.getActiveCell();if(y&&C.shiftKey&&!C.ctrlKey&&!C.altKey&&!C.metaKey&&(C.which==38||C.which==40)){var B=d();B.sort(function(D,E){return D-E});if(!B.length){B=[y.row]}var A=B[0];var x=B[B.length-1];var z;if(C.which==40){z=y.row<x||A==x?++x:++A}else{z=y.row<x?--x:--A}if(z>=0&&z<r.getDataLength()){r.scrollRowIntoView(z);o=h(u(A,x));c(o)}C.preventDefault();C.stopPropagation()}}function k(C){var y=r.getCellFromEvent(C);if(!y||!r.canCellBeActive(y.row,y.cell)){return false}var A=g(o);var x=b.inArray(y.row,A);if(!C.ctrlKey&&!C.shiftKey&&!C.metaKey){return false}else{if(r.getOptions().multiSelect){if(x===-1&&(C.ctrlKey||C.metaKey)){A.push(y.row);r.setActiveCell(y.row,y.cell)}else{if(x!==-1&&(C.ctrlKey||C.metaKey)){A=b.grep(A,function(G,F){return(G!==y.row)});r.setActiveCell(y.row,y.cell)}else{if(A.length&&C.shiftKey){var B=A.pop();var E=Math.min(y.row,B);var D=Math.max(y.row,B);A=[];for(var z=E;z<=D;z++){if(z!==B){A.push(z)}}A.push(B);r.setActiveCell(y.row,y.cell)}}}}}o=h(A);c(o);C.stopImmediatePropagation();return true}b.extend(this,{getSelectedRows:d,setSelectedRows:j,getSelectedRanges:p,setSelectedRanges:c,init:t,destroy:w,onSelectedRangesChanged:new Slick.Event()})}})(jQuery);(function(c){c.extend(true,window,{Slick:{Event:h,EventData:g,EventHandler:i,Range:b,NonDataRow:e,Group:f,GroupTotals:d,EditorLock:a,GlobalEditorLock:new a()}});function g(){var j=false;var k=false;this.stopPropagation=function(){j=true};this.isPropagationStopped=function(){return j};this.stopImmediatePropagation=function(){k=true};this.isImmediatePropagationStopped=function(){return k}}function h(){var j=[];this.subscribe=function(k){j.push(k)};this.unsubscribe=function(l){for(var k=j.length-1;k>=0;k--){if(j[k]===l){j.splice(k,1)}}};this.notify=function(k,o,n){o=o||new g();n=n||this;var m;for(var l=0;l<j.length&&!(o.isPropagationStopped()||o.isImmediatePropagationStopped());l++){m=j[l].call(n,o,k)}return m}}function i(){var j=[];this.subscribe=function(l,k){j.push({event:l,handler:k});l.subscribe(k);return this};this.unsubscribe=function(m,l){var k=j.length;while(k--){if(j[k].event===m&&j[k].handler===l){j.splice(k,1);m.unsubscribe(l);return}}return this};this.unsubscribeAll=function(){var k=j.length;while(k--){j[k].event.unsubscribe(j[k].handler)}j=[];return this}}function b(k,j,l,m){if(l===undefined&&m===undefined){l=k;m=j}this.fromRow=Math.min(k,l);this.fromCell=Math.min(j,m);this.toRow=Math.max(k,l);this.toCell=Math.max(j,m);this.isSingleRow=function(){return this.fromRow==this.toRow};this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell};this.contains=function(o,n){return o>=this.fromRow&&o<=this.toRow&&n>=this.fromCell&&n<=this.toCell};this.toString=function(){if(this.isSingleCell()){return"("+this.fromRow+":"+this.fromCell+")"}else{return"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}}function e(){this.__nonDataRow=true}function f(){this.__group=true;this.level=0;this.count=0;this.value=null;this.title=null;this.collapsed=false;this.totals=null;this.rows=null;this.groups=null;this.groupingKey=null}f.prototype=new e();f.prototype.equals=function(j){return this.value===j.value&&this.count===j.count&&this.collapsed===j.collapsed};function d(){this.__groupTotals=true;this.group=null}d.prototype=new e();function a(){var j=null;this.isActive=function(l){return(l?j===l:j!==null)};this.activate=function(l){if(l===j){return}if(j!==null){throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController"}if(!l.commitCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()"}if(!l.cancelCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()"}j=l};this.deactivate=function(l){if(j!==l){throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one"}j=null};this.commitCurrentEdit=function(){return(j?j.commitCurrentEdit():true)};this.cancelCurrentEdit=function k(){return(j?j.cancelCurrentEdit():true)}}})(jQuery);(function(d){d.extend(true,window,{Slick:{Data:{DataView:f,Aggregators:{Avg:c,Min:b,Max:a,Sum:e}}}});function f(aa){var av=this;var M={groupItemMetadataProvider:null,inlineFilters:false,showExpandedGroupRows:true};var q="id";var aw=[];var W=[];var aC={};var ax=null;var v=null;var au=null;var E=false;var k=true;var aP;var y;var ag={};var O={};var aI;var n=[];var G;var z;var al=[];var aE={getter:null,formatter:null,comparer:function(aU,aT){return aU.value-aT.value},aggregators:[],aggregateCollapsed:false,aggregateChildGroups:false,collapsed:false};var ar=[];var h=[];var j=[];var aL=":|:";var C=0;var D=0;var g=0;var aG=new Slick.Event();var N=new Slick.Event();var aQ=new Slick.Event();aa=d.extend(true,{},M,aa);function p(){E=true}function r(){E=false;ay()}function aA(aT){ag=aT}function P(aT){aI=aT}function aJ(aV){aV=aV||0;var aW;for(var aU=aV,aT=aw.length;aU<aT;aU++){aW=aw[aU][q];if(aW===undefined){throw"Each data element must implement a unique 'id' property"}aC[aW]=aU}}function F(){var aV;for(var aU=0,aT=aw.length;aU<aT;aU++){aV=aw[aU][q];if(aV===undefined||aC[aV]!==aU){throw"Each data element must implement a unique 'id' property"}}}function aR(){return aw}function U(aU,aT){if(aT!==undefined){q=aT}aw=n=aU;aC={};aJ();F();ay()}function A(aT){if(aT.pageSize!=undefined){C=aT.pageSize;D=C?Math.min(D,Math.max(0,Math.ceil(g/C)-1)):0}if(aT.pageNum!=undefined){D=Math.min(aT.pageNum,Math.max(0,Math.ceil(g/C)-1))}aQ.notify(am(),null,av);ay()}function am(){var aT=C?Math.max(1,Math.ceil(g/C)):1;return{pageSize:C,pageNum:D,totalRows:g,totalPages:aT}}function H(aU,aT){k=aT;y=aU;aP=null;if(aT===false){aw.reverse()}aw.sort(aU);if(aT===false){aw.reverse()}aC={};aJ();ay()}function aK(aV,aU){k=aU;aP=aV;y=null;var aT=Object.prototype.toString;Object.prototype.toString=(typeof aV=="function")?aV:function(){return this[aV]};if(aU===false){aw.reverse()}aw.sort();Object.prototype.toString=aT;if(aU===false){aw.reverse()}aC={};aJ();ay()}function x(){if(y){H(y,k)}else{if(aP){aK(aP,k)}}}function ac(aT){v=aT;if(aa.inlineFilters){G=ak();z=B()}ay()}function ah(){return ar}function J(aW){if(!aa.groupItemMetadataProvider){aa.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider()}h=[];j=[];aW=aW||[];ar=(aW instanceof Array)?aW:[aW];for(var aV=0;aV<ar.length;aV++){var aU=ar[aV]=d.extend(true,{},aE,ar[aV]);aU.getterIsAFn=typeof aU.getter==="function";aU.compiledAccumulators=[];var aT=aU.aggregators.length;while(aT--){aU.compiledAccumulators[aT]=ao(aU.aggregators[aT])}j[aV]={}}ay()}function ad(aT,aU,aV){if(aT==null){J([]);return}J({getter:aT,formatter:aU,comparer:aV})}function aN(aU,aT){if(!ar.length){throw new Error("At least must setGrouping must be specified before calling setAggregators().")}ar[0].aggregators=aU;ar[0].aggregateCollapsed=aT;J(ar)}function aB(aT){return aw[aT]}function I(aT){return aC[aT]}function u(){if(!ax){ax={};for(var aU=0,aT=W.length;aU<aT;aU++){ax[W[aU][q]]=aU}}}function ai(aT){u();return ax[aT]}function Y(aT){return aw[aC[aT]]}function aH(aU){var aV=[];u();for(var aT=0;aT<aU.length;aT++){var aW=ax[aU[aT]];if(aW!=null){aV[aV.length]=aW}}return aV}function T(aV){var aU=[];for(var aT=0;aT<aV.length;aT++){if(aV[aT]<W.length){aU[aU.length]=W[aV[aT]][q]}}return aU}function m(aU,aT){if(aC[aU]===undefined||aU!==aT[q]){throw"Invalid or non-matching id"}aw[aC[aU]]=aT;if(!au){au={}}au[aU]=true;ay()}function aM(aT,aU){aw.splice(aT,0,aU);aJ(aT);ay()}function ap(aT){aw.push(aT);aJ(aw.length-1);ay()}function aS(aU){var aT=aC[aU];if(aT===undefined){throw"Invalid id"}delete aC[aU];aw.splice(aT,1);aJ(aT);ay()}function az(){return W.length}function aF(aT){return W[aT]}function K(aT){var aU=W[aT];if(aU===undefined){return null}if(aU.__group){return aa.groupItemMetadataProvider.getGroupRowMetadata(aU)}if(aU.__groupTotals){return aa.groupItemMetadataProvider.getTotalsRowMetadata(aU)}return null}function aO(aV,aU){if(aV==null){for(var aT=0;aT<ar.length;aT++){j[aT]={};ar[aT].collapsed=aU}}else{j[aV]={};ar[aV].collapsed=aU}ay()}function Q(aT){aO(aT,true)}function aD(aT){aO(aT,false)}function X(aV,aT,aU){j[aV][aT]=ar[aV].collapsed^aU;ay()}function at(aW){var aU=Array.prototype.slice.call(arguments);var aV=aU[0];var aX;var aT;if(aU.length==1&&aV.indexOf(aL)!=-1){aX=aV.split(aL).length-1;aT=aV}else{aX=aU.length-1;aT=aU.join(aL)}return j[aX][aT]}function aj(aV){var aT=Array.prototype.slice.call(arguments);var aU=aT[0];if(aT.length==1&&aU.indexOf(aL)!=-1){X(aU.split(aL).length-1,aU,true)}else{X(aT.length-1,aT.join(aL),true)}}function ae(aV){var aT=Array.prototype.slice.call(arguments);var aU=aT[0];if(aT.length==1&&aU.indexOf(aL)!=-1){X(aU.split(aL).length-1,aU,false)}else{X(aT.length-1,aT.join(aL),false)}}function an(){return h}function Z(a3,a0){var a2;var aV;var aW=[];var a1=[];var aT;var aU=a0?a0.level+1:0;var aZ=ar[aU];for(var aY=0,aX=a3.length;aY<aX;aY++){aT=a3[aY];aV=aZ.getterIsAFn?aZ.getter(aT):aT[aZ.getter];aV=aV||0;a2=a1[aV];if(!a2){a2=new Slick.Group();a2.count=0;a2.value=aV;a2.level=aU;a2.groupingKey=(a0?a0.groupingKey+aL:"")+aV;a2.rows=[];aW[aW.length]=a2;a1[aV]=a2}a2.rows[a2.count++]=aT}if(aU<ar.length-1){for(var aY=0;aY<aW.length;aY++){a2=aW[aY];a2.groups=Z(a2.rows,a2)}}aW.sort(ar[aU].comparer);return aW}function aq(aY){var aV=ar[aY.level];var aX=(aY.level==ar.length);var aW=new Slick.GroupTotals();var aU,aT=aV.aggregators.length;while(aT--){aU=aV.aggregators[aT];aU.init();aV.compiledAccumulators[aT].call(aU,(!aX&&aV.aggregateChildGroups)?aY.groups:aY.rows);aU.storeResult(aW)}aW.group=aY;aY.totals=aW}function af(aU,aX){aX=aX||0;var aV=ar[aX];var aT=aU.length,aW;while(aT--){aW=aU[aT];if(aW.collapsed&&!aV.aggregateCollapsed){continue}if(aW.groups){af(aW.groups,aX+1)}if(aV.aggregators.length){aq(aW)}}}function t(aU,aZ){aZ=aZ||0;var aV=ar[aZ];var aW=aV.collapsed;var aY=j[aZ];var aT=aU.length,aX;while(aT--){aX=aU[aT];aX.collapsed=aW^aY[aX.groupingKey];aX.title=aV.formatter?aV.formatter(aX):aX.value;if(aX.groups){t(aX.groups,aZ+1);aX.rows=null}}}function i(aT){var aU=[],a1,aY=0,a0;for(var aX=0,aV=aT.length;aX<aV;aX++){a0=aT[aX];if(aa.showExpandedGroupRows||a0.collapsed){aU[aY++]=a0}if(!a0.collapsed){a1=a0.groups?i(a0.groups):a0.rows;for(var aW=0,aZ=a1.length;aW<aZ;aW++){aU[aY++]=a1[aW]}}if(a0.totals&&(!a0.collapsed||ar[a0.level].aggregateCollapsed)){aU[aY++]=a0.totals}}return aU}function S(aU){var aT=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/;var aV=aU.toString().match(aT);return{params:aV[1].split(","),body:aV[2]}}function ao(aV){var aU=S(aV.accumulate);var aT=new Function("_items","for (var "+aU.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+aU.params[0]+" = _items[_i]; "+aU.body+"}");aT.displayName=aT.name="compiledAccumulatorLoop";return aT}function ak(){var aW=S(v);var aT=aW.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }");var aU=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");aU=aU.replace(/\$filter\$/gi,aT);aU=aU.replace(/\$item\$/gi,aW.params[0]);aU=aU.replace(/\$args\$/gi,aW.params[1]);var aV=new Function("_items,_args",aU);aV.displayName=aV.name="compiledFilter";return aV}function B(){var aW=S(v);var aT=aW.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }");var aU=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");aU=aU.replace(/\$filter\$/gi,aT);aU=aU.replace(/\$item\$/gi,aW.params[0]);aU=aU.replace(/\$args\$/gi,aW.params[1]);var aV=new Function("_items,_args,_cache",aU);aV.displayName=aV.name="compiledFilterWithCaching";return aV}function o(aV,aW){var aU=[],aT=0;for(var aX=0,aY=aV.length;aX<aY;aX++){if(v(aV[aX],aW)){aU[aT++]=aV[aX]}}return aU}function R(aW,aX,aV){var aU=[],aT=0,a0;for(var aY=0,aZ=aW.length;aY<aZ;aY++){a0=aW[aY];if(aV[aY]){aU[aT++]=a0}else{if(v(a0,aX)){aU[aT++]=a0;aV[aY]=true}}}return aU}function w(aU){if(v){var aT=aa.inlineFilters?G:o;var aW=aa.inlineFilters?z:R;if(ag.isFilterNarrowing){n=aT(n,aI)}else{if(ag.isFilterExpanding){n=aW(aU,aI,al)}else{if(!ag.isFilterUnchanged){n=aT(aU,aI)}}}}else{n=C?aU:aU.concat()}var aV;if(C){if(n.length<D*C){D=Math.floor(n.length/C)}aV=n.slice(C*D,C*D+C)}else{aV=n}return{totalRows:n.length,rows:aV}}function l(a2,aW){var a1,aT,aU,a0=[];var aY=0,aZ=aW.length;if(ag&&ag.ignoreDiffsBefore){aY=Math.max(0,Math.min(aW.length,ag.ignoreDiffsBefore))}if(ag&&ag.ignoreDiffsAfter){aZ=Math.min(aW.length,Math.max(0,ag.ignoreDiffsAfter))}for(var aV=aY,aX=a2.length;aV<aZ;aV++){if(aV>=aX){a0[a0.length]=aV}else{a1=aW[aV];aT=a2[aV];if((ar.length&&(aU=(a1.__nonDataRow)||(aT.__nonDataRow))&&a1.__group!==aT.__group||a1.__group&&!a1.equals(aT))||(aU&&(a1.__groupTotals||aT.__groupTotals))||a1[q]!=aT[q]||(au&&au[a1[q]])){a0[a0.length]=aV}}}return a0}function s(aW){ax=null;if(ag.isFilterNarrowing!=O.isFilterNarrowing||ag.isFilterExpanding!=O.isFilterExpanding){al=[]}var aU=w(aW);g=aU.totalRows;var aT=aU.rows;h=[];if(ar.length){h=Z(aT);if(h.length){af(h);t(h);aT=i(h)}}var aV=l(W,aT);W=aT;return aV}function ay(){if(E){return}var aT=W.length;var aU=g;var aV=s(aw,v);if(C&&g<D*C){D=Math.max(0,Math.ceil(g/C)-1);aV=s(aw,v)}au=null;O=ag;ag={};if(aU!=g){aQ.notify(am(),null,av)}if(aT!=W.length){aG.notify({previous:aT,current:W.length},null,av)}if(aV.length>0){N.notify({rows:aV},null,av)}}function V(aW,aV){var aU=this;var aT=aU.mapRowsToIds(aW.getSelectedRows());var aX;function aY(){if(aT.length>0){aX=true;var aZ=aU.mapIdsToRows(aT);if(!aV){aT=aU.mapRowsToIds(aZ)}aW.setSelectedRows(aZ);aX=false}}aW.onSelectedRowsChanged.subscribe(function(a0,aZ){if(aX){return}aT=aU.mapRowsToIds(aW.getSelectedRows())});this.onRowsChanged.subscribe(aY);this.onRowCountChanged.subscribe(aY)}function ab(aV,aU){var aT;var aX;aW(aV.getCellCssStyles(aU));function aW(aZ){aT={};for(var a0 in aZ){var a1=W[a0][q];aT[a1]=aZ[a0]}}function aY(){if(aT){aX=true;u();var aZ={};for(var a1 in aT){var a0=ax[a1];if(a0!=undefined){aZ[a0]=aT[a1]}}aV.setCellCssStyles(aU,aZ);aX=false}}aV.onCellCssStylesChanged.subscribe(function(a0,aZ){if(aX){return}if(aU!=aZ.key){return}if(aZ.hash){aW(aZ.hash)}});this.onRowsChanged.subscribe(aY);this.onRowCountChanged.subscribe(aY)}return{beginUpdate:p,endUpdate:r,setPagingOptions:A,getPagingInfo:am,getItems:aR,setItems:U,setFilter:ac,sort:H,fastSort:aK,reSort:x,setGrouping:J,getGrouping:ah,groupBy:ad,setAggregators:aN,collapseAllGroups:Q,expandAllGroups:aD,isGroupCollapsed:at,collapseGroup:aj,expandGroup:ae,getGroups:an,getIdxById:I,getRowById:ai,getItemById:Y,getItemByIdx:aB,mapRowsToIds:T,mapIdsToRows:aH,setRefreshHints:aA,setFilterArgs:P,refresh:ay,updateItem:m,insertItem:aM,addItem:ap,deleteItem:aS,syncGridSelection:V,syncGridCellCssStyles:ab,getLength:az,getItem:aF,getItemMetadata:K,onRowCountChanged:aG,onRowsChanged:N,onPagingInfoChanged:aQ}}function c(g){this.field_=g;this.init=function(){this.count_=0;this.nonNullCount_=0;this.sum_=0};this.accumulate=function(h){var i=h[this.field_];this.count_++;if(i!=null&&i!==""&&i!==NaN){this.nonNullCount_++;this.sum_+=parseFloat(i)}};this.storeResult=function(h){if(!h.avg){h.avg={}}if(this.nonNullCount_!=0){h.avg[this.field_]=this.sum_/this.nonNullCount_}}}function b(g){this.field_=g;this.init=function(){this.min_=null};this.accumulate=function(h){var i=h[this.field_];if(i!=null&&i!==""&&i!==NaN){if(this.min_==null||i<this.min_){this.min_=i}}};this.storeResult=function(h){if(!h.min){h.min={}}h.min[this.field_]=this.min_}}function a(g){this.field_=g;this.init=function(){this.max_=null};this.accumulate=function(h){var i=h[this.field_];if(i!=null&&i!==""&&i!==NaN){if(this.max_==null||i>this.max_){this.max_=i}}};this.storeResult=function(h){if(!h.max){h.max={}}h.max[this.field_]=this.max_}}function e(g){this.field_=g;this.init=function(){this.sum_=null};this.accumulate=function(h){var i=h[this.field_];if(i!=null&&i!==""&&i!==NaN){this.sum_+=parseFloat(i)}};this.storeResult=function(h){if(!h.sum){h.sum={}}h.sum[this.field_]=this.sum_}}})(jQuery);(function(f){f.extend(true,window,{Slick:{Editors:{Text:h,Integer:b,Date:c,YesNoSelect:d,Checkbox:e,PercentComplete:a,LongText:g}}});function h(j){var l;var i;var k=this;this.init=function(){l=f("<INPUT type=text class='editor-text' />").appendTo(j.container).bind("keydown.nav",function(m){if(m.keyCode===f.ui.keyCode.LEFT||m.keyCode===f.ui.keyCode.RIGHT){m.stopImmediatePropagation()}}).focus().select()};this.destroy=function(){l.remove()};this.focus=function(){l.focus()};this.getValue=function(){return l.val()};this.setValue=function(m){l.val(m)};this.loadValue=function(m){i=m[j.column.field]||"";l.val(i);l[0].defaultValue=i;l.select()};this.serializeValue=function(){return l.val()};this.applyValue=function(m,n){m[j.column.field]=n};this.isValueChanged=function(){return(!(l.val()==""&&i==null))&&(l.val()!=i)};this.validate=function(){if(j.column.validator){var m=j.column.validator(l.val());if(!m.valid){return m}}return{valid:true,msg:null}};this.init()}function b(j){var l;var i;var k=this;this.init=function(){l=f("<INPUT type=text class='editor-text' />");l.bind("keydown.nav",function(m){if(m.keyCode===f.ui.keyCode.LEFT||m.keyCode===f.ui.keyCode.RIGHT){m.stopImmediatePropagation()}});l.appendTo(j.container);l.focus().select()};this.destroy=function(){l.remove()};this.focus=function(){l.focus()};this.loadValue=function(m){i=m[j.column.field];l.val(i);l[0].defaultValue=i;l.select()};this.serializeValue=function(){return parseInt(l.val(),10)||0};this.applyValue=function(m,n){m[j.column.field]=n};this.isValueChanged=function(){return(!(l.val()==""&&i==null))&&(l.val()!=i)};this.validate=function(){if(isNaN(l.val())){return{valid:false,msg:"Please enter a valid integer"}}return{valid:true,msg:null}};this.init()}function c(j){var m;var i;var k=this;var l=false;this.init=function(){m=f("<INPUT type=text class='editor-text' />");m.appendTo(j.container);m.focus().select();m.datepicker({showOn:"button",buttonImageOnly:true,buttonImage:"../images/calendar.gif",beforeShow:function(){l=true},onClose:function(){l=false}});m.width(m.width()-18)};this.destroy=function(){f.datepicker.dpDiv.stop(true,true);m.datepicker("hide");m.datepicker("destroy");m.remove()};this.show=function(){if(l){f.datepicker.dpDiv.stop(true,true).show()}};this.hide=function(){if(l){f.datepicker.dpDiv.stop(true,true).hide()}};this.position=function(n){if(!l){return}f.datepicker.dpDiv.css("top",n.top+30).css("left",n.left)};this.focus=function(){m.focus()};this.loadValue=function(n){i=n[j.column.field];m.val(i);m[0].defaultValue=i;m.select()};this.serializeValue=function(){return m.val()};this.applyValue=function(n,o){n[j.column.field]=o};this.isValueChanged=function(){return(!(m.val()==""&&i==null))&&(m.val()!=i)};this.validate=function(){return{valid:true,msg:null}};this.init()}function d(k){var j;var i;var l=this;this.init=function(){j=f("<SELECT tabIndex='0' class='editor-yesno'><OPTION value='yes'>Yes</OPTION><OPTION value='no'>No</OPTION></SELECT>");j.appendTo(k.container);j.focus()};this.destroy=function(){j.remove()};this.focus=function(){j.focus()};this.loadValue=function(m){j.val((i=m[k.column.field])?"yes":"no");j.select()};this.serializeValue=function(){return(j.val()=="yes")};this.applyValue=function(m,n){m[k.column.field]=n};this.isValueChanged=function(){return(j.val()!=i)};this.validate=function(){return{valid:true,msg:null}};this.init()}function e(k){var j;var i;var l=this;this.init=function(){j=f("<INPUT type=checkbox value='true' class='editor-checkbox' hideFocus>");j.appendTo(k.container);j.focus()};this.destroy=function(){j.remove()};this.focus=function(){j.focus()};this.loadValue=function(m){i=m[k.column.field];if(i){j.attr("checked","checked")}else{j.removeAttr("checked")}};this.serializeValue=function(){return j.attr("checked")};this.applyValue=function(m,n){m[k.column.field]=n};this.isValueChanged=function(){return(j.attr("checked")!=i)};this.validate=function(){return{valid:true,msg:null}};this.init()}function a(j){var m,l;var i;var k=this;this.init=function(){m=f("<INPUT type=text class='editor-percentcomplete' />");m.width(f(j.container).innerWidth()-25);m.appendTo(j.container);l=f("<div class='editor-percentcomplete-picker' />").appendTo(j.container);l.append("<div class='editor-percentcomplete-helper'><div class='editor-percentcomplete-wrapper'><div class='editor-percentcomplete-slider' /><div class='editor-percentcomplete-buttons' /></div></div>");l.find(".editor-percentcomplete-buttons").append("<button val=0>Not started</button><br/><button val=50>In Progress</button><br/><button val=100>Complete</button>");m.focus().select();l.find(".editor-percentcomplete-slider").slider({orientation:"vertical",range:"min",value:i,slide:function(n,o){m.val(o.value)}});l.find(".editor-percentcomplete-buttons button").bind("click",function(n){m.val(f(this).attr("val"));l.find(".editor-percentcomplete-slider").slider("value",f(this).attr("val"))})};this.destroy=function(){m.remove();l.remove()};this.focus=function(){m.focus()};this.loadValue=function(n){m.val(i=n[j.column.field]);m.select()};this.serializeValue=function(){return parseInt(m.val(),10)||0};this.applyValue=function(n,o){n[j.column.field]=o};this.isValueChanged=function(){return(!(m.val()==""&&i==null))&&((parseInt(m.val(),10)||0)!=i)};this.validate=function(){if(isNaN(parseInt(m.val(),10))){return{valid:false,msg:"Please enter a valid positive number"}}return{valid:true,msg:null}};this.init()}function g(j){var m,l;var i;var k=this;this.init=function(){var n=f("body");l=f("<DIV style='z-index:10000;position:absolute;background:white;padding:5px;border:3px solid gray; -moz-border-radius:10px; border-radius:10px;'/>").appendTo(n);m=f("<TEXTAREA hidefocus rows=5 style='backround:white;width:250px;height:80px;border:0;outline:0'>").appendTo(l);f("<DIV style='text-align:right'><BUTTON>Save</BUTTON><BUTTON>Cancel</BUTTON></DIV>").appendTo(l);l.find("button:first").bind("click",this.save);l.find("button:last").bind("click",this.cancel);m.bind("keydown",this.handleKeyDown);k.position(j.position);m.focus().select()};this.handleKeyDown=function(n){if(n.which==f.ui.keyCode.ENTER&&n.ctrlKey){k.save()}else{if(n.which==f.ui.keyCode.ESCAPE){n.preventDefault();k.cancel()}else{if(n.which==f.ui.keyCode.TAB&&n.shiftKey){n.preventDefault();j.grid.navigatePrev()}else{if(n.which==f.ui.keyCode.TAB){n.preventDefault();j.grid.navigateNext()}}}}};this.save=function(){j.commitChanges()};this.cancel=function(){m.val(i);j.cancelChanges()};this.hide=function(){l.hide()};this.show=function(){l.show()};this.position=function(n){l.css("top",n.top-5).css("left",n.left-5)};this.destroy=function(){l.remove()};this.focus=function(){m.focus()};this.loadValue=function(n){m.val(i=n[j.column.field]);m.select()};this.serializeValue=function(){return m.val()};this.applyValue=function(n,o){n[j.column.field]=o};this.isValueChanged=function(){return(!(m.val()==""&&i==null))&&(m.val()!=i)};this.validate=function(){return{valid:true,msg:null}};this.init()}})(jQuery);if(typeof jQuery==="undefined"){throw"SlickGrid requires jquery module to be loaded"}if(!jQuery.fn.drag){throw"SlickGrid requires jquery.event.drag module to be loaded"}if(typeof Slick==="undefined"){throw"slick.core.js not loaded"}(function($){$.extend(true,window,{Slick:{Grid:SlickGrid}});var scrollbarDimensions;var maxSupportedCssHeight;function SlickGrid(container,data,columns,options){var defaults={explicitInitialization:false,rowHeight:25,defaultColumnWidth:80,enableAddRow:false,leaveSpaceForNewRows:false,editable:false,autoEdit:true,enableCellNavigation:true,enableColumnReorder:true,asyncEditorLoading:false,asyncEditorLoadDelay:100,forceFitColumns:false,enableAsyncPostRender:false,asyncPostRenderDelay:50,autoHeight:false,editorLock:Slick.GlobalEditorLock,showHeaderRow:false,headerRowHeight:25,showTopPanel:false,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:true,enableTextSelectionOnCells:false,dataItemColumnValueExtractor:null,fullWidthRows:false,multiColumnSort:false,defaultFormatter:defaultFormatter,forceSyncScrolling:false};var columnDefaults={name:"",resizable:true,sortable:false,minWidth:30,rerenderOnResize:false,headerCssClass:null,defaultSortAsc:true,focusable:true,selectable:true};var th;var h;var ph;var n;var cj;var page=0;var offset=0;var vScrollDir=1;var initialized=false;var $container;var uid="slickgrid_"+Math.round(1000000*Math.random());var self=this;var $focusSink,$focusSink2;var $headerScroller;var $headers;var $headerRow,$headerRowScroller,$headerRowSpacer;var $topPanelScroller;var $topPanel;var $viewport;var $canvas;var $style;var $boundAncestors;var stylesheet,columnCssRulesL,columnCssRulesR;var viewportH,viewportW;var canvasWidth;var viewportHasHScroll,viewportHasVScroll;var headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0;var absoluteColumnMinWidth;var numberOfRows=0;var tabbingDirection=1;var activePosX;var activeRow,activeCell;var activeCellNode=null;var currentEditor=null;var serializedEditorValue;var editController;var rowsCache={};var renderedRows=0;var numVisibleRows;var prevScrollTop=0;var scrollTop=0;var lastRenderedScrollTop=0;var lastRenderedScrollLeft=0;var prevScrollLeft=0;var scrollLeft=0;var selectionModel;var selectedRows=[];var plugins=[];var cellCssClasses={};var columnsById={};var sortColumns=[];var columnPosLeft=[];var columnPosRight=[];var h_editorLoader=null;var h_render=null;var h_postrender=null;var postProcessedRows={};var postProcessToRow=null;var postProcessFromRow=null;var counter_rows_rendered=0;var counter_rows_removed=0;function init(){$container=$(container);if($container.length<1){throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.")}maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight();scrollbarDimensions=scrollbarDimensions||measureScrollbar();options=$.extend({},defaults,options);validateAndEnforceOptions();columnDefaults.width=options.defaultColumnWidth;columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;if(m.minWidth&&m.width<m.minWidth){m.width=m.minWidth}if(m.maxWidth&&m.width>m.maxWidth){m.width=m.maxWidth}}if(options.enableColumnReorder&&!$.fn.sortable){throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded")}editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit};$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget");if(!/relative|absolute|fixed/.test($container.css("position"))){$container.css("position","relative")}$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container);$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headers=$("<div class='slick-header-columns' style='left:-1000px' />").appendTo($headerScroller);$headers.width(getHeadersWidth());$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller);$headerRowSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($headerRowScroller);$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller);if(!options.showTopPanel){$topPanelScroller.hide()}if(!options.showHeaderRow){$headerRowScroller.hide()}$viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container);$viewport.css("overflow-y",options.autoHeight?"hidden":"auto");$canvas=$("<div class='grid-canvas' />").appendTo($viewport);$focusSink2=$focusSink.clone().appendTo($container);if(!options.explicitInitialization){finishInitialization()}}function finishInitialization(){if(!initialized){initialized=true;viewportW=parseFloat($.css($container[0],"width",true));measureCellPaddingAndBorder();disableSelection($headers);if(!options.enableTextSelectionOnCells){$viewport.bind("selectstart.ui",function(event){return $(event.target).is("input,textarea")})}updateColumnCaches();createColumnHeaders();setupColumnSort();createCssRules();resizeCanvas();bindAncestorScrollEvents();$container.bind("resize.slickgrid",resizeCanvas);$viewport.bind("scroll",handleScroll);$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave).bind("draginit",handleHeaderDragInit).bind("dragstart",handleHeaderDragStart).bind("drag",handleHeaderDrag).bind("dragend",handleHeaderDragEnd);$headerRowScroller.bind("scroll",handleHeaderRowScroll);$focusSink.add($focusSink2).bind("keydown",handleKeyDown);$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave)}}function registerPlugin(plugin){plugins.unshift(plugin);plugin.init(self)}function unregisterPlugin(plugin){for(var i=plugins.length;i>=0;i--){if(plugins[i]===plugin){if(plugins[i].destroy){plugins[i].destroy()}plugins.splice(i,1);break}}}function setSelectionModel(model){if(selectionModel){selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged);if(selectionModel.destroy){selectionModel.destroy()}}selectionModel=model;if(selectionModel){selectionModel.init(self);selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged)}}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var $c=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");var dim={width:$c.width()-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};$c.remove();return dim}function getHeadersWidth(){var headersWidth=0;for(var i=0,ii=columns.length;i<ii;i++){var width=columns[i].width;headersWidth+=width}headersWidth+=scrollbarDimensions.width;return Math.max(headersWidth,viewportW)+1000}function getCanvasWidth(){var availableWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;var rowWidth=0;var i=columns.length;while(i--){rowWidth+=columns[i].width}return options.fullWidthRows?Math.max(rowWidth,availableWidth):rowWidth}function updateCanvasWidth(forceColumnWidthsUpdate){var oldCanvasWidth=canvasWidth;canvasWidth=getCanvasWidth();viewportHasHScroll=(canvasWidth>viewportW-scrollbarDimensions.width);if(canvasWidth!=oldCanvasWidth){$canvas.width(canvasWidth);$headerRow.width(canvasWidth);$headers.width(getHeadersWidth());trigger(self.onCanvasWidthChanged,{width:canvasWidth})}$headerRowSpacer.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0));if(canvasWidth!=oldCanvasWidth||forceColumnWidthsUpdate){applyColumnWidths()}}function disableSelection($target){if($target&&$target.jquery){$target.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}}function getMaxSupportedCssHeight(){var supportedHeight=1000000;var testUpTo=navigator.userAgent.toLowerCase().match(/firefox/)?6000000:1000000000;var div=$("<div style='display:none' />").appendTo(document.body);while(true){var test=supportedHeight*2;div.css("height",test);if(test>testUpTo||div.height()!==test){break}else{supportedHeight=test}}div.remove();return supportedHeight}function bindAncestorScrollEvents(){var elem=$canvas[0];while((elem=elem.parentNode)!=document.body&&elem!=null){if(elem==$viewport[0]||elem.scrollWidth!=elem.clientWidth||elem.scrollHeight!=elem.clientHeight){var $elem=$(elem);if(!$boundAncestors){$boundAncestors=$elem}else{$boundAncestors=$boundAncestors.add($elem)}$elem.bind("scroll."+uid,handleActiveCellPositionChange)}}}function unbindAncestorScrollEvents(){if(!$boundAncestors){return}$boundAncestors.unbind("scroll."+uid);$boundAncestors=null}function updateColumnHeader(columnId,title,toolTip){if(!initialized){return}var idx=getColumnIndex(columnId);if(idx==null){return}var columnDef=columns[idx];var $header=$headers.children().eq(idx);if($header){if(title!==undefined){columns[idx].name=title}if(toolTip!==undefined){columns[idx].toolTip=toolTip}trigger(self.onBeforeHeaderCellDestroy,{node:$header[0],column:columnDef});$header.attr("title",toolTip||"").children().eq(0).html(title);trigger(self.onHeaderCellRendered,{node:$header[0],column:columnDef})}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(columnId){var idx=getColumnIndex(columnId);var $header=$headerRow.children().eq(idx);return $header&&$header[0]}function createColumnHeaders(){function onMouseEnter(){$(this).addClass("ui-state-hover")}function onMouseLeave(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var columnDef=$(this).data("column");if(columnDef){trigger(self.onBeforeHeaderCellDestroy,{node:this,column:columnDef})}});$headers.empty();$headers.width(getHeadersWidth());$headerRow.find(".slick-headerrow-column").each(function(){var columnDef=$(this).data("column");if(columnDef){trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:columnDef})}});$headerRow.empty();for(var i=0;i<columns.length;i++){var m=columns[i];var header=$("<div class='ui-state-default slick-header-column' id='"+uid+m.id+"' />").html("<span class='slick-column-name'>"+m.name+"</span>").width(m.width-headerColumnWidthDiff).attr("title",m.toolTip||"").data("column",m).addClass(m.headerCssClass||"").appendTo($headers);if(options.enableColumnReorder||m.sortable){header.on("mouseenter",onMouseEnter).on("mouseleave",onMouseLeave)}if(m.sortable){header.addClass("slick-header-sortable");header.append("<span class='slick-sort-indicator' />")}trigger(self.onHeaderCellRendered,{node:header[0],column:m});if(options.showHeaderRow){var headerRowCell=$("<div class='ui-state-default slick-headerrow-column l"+i+" r"+i+"'></div>").data("column",m).appendTo($headerRow);trigger(self.onHeaderRowCellRendered,{node:headerRowCell[0],column:m})}}setSortColumns(sortColumns);setupColumnResize();if(options.enableColumnReorder){setupColumnReorder()}}function setupColumnSort(){$headers.click(function(e){e.metaKey=e.metaKey||e.ctrlKey;if($(e.target).hasClass("slick-resizable-handle")){return}var $col=$(e.target).closest(".slick-header-column");if(!$col.length){return}var column=$col.data("column");if(column.sortable){if(!getEditorLock().commitCurrentEdit()){return}var sortOpts=null;var i=0;for(;i<sortColumns.length;i++){if(sortColumns[i].columnId==column.id){sortOpts=sortColumns[i];sortOpts.sortAsc=!sortOpts.sortAsc;break}}if(e.metaKey&&options.multiColumnSort){if(sortOpts){sortColumns.splice(i,1)}}else{if((!e.shiftKey&&!e.metaKey)||!options.multiColumnSort){sortColumns=[]}if(!sortOpts){sortOpts={columnId:column.id,sortAsc:column.defaultSortAsc};sortColumns.push(sortOpts)}else{if(sortColumns.length==0){sortColumns.push(sortOpts)}}}setSortColumns(sortColumns);if(!options.multiColumnSort){trigger(self.onSort,{multiColumnSort:false,sortCol:column,sortAsc:sortOpts.sortAsc},e)}else{trigger(self.onSort,{multiColumnSort:true,sortCols:$.map(sortColumns,function(col){return{sortCol:columns[getColumnIndex(col.columnId)],sortAsc:col.sortAsc}})},e)}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy");$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:true,start:function(e,ui){$(ui.helper).addClass("slick-header-column-active")},beforeStop:function(e,ui){$(ui.helper).removeClass("slick-header-column-active")},stop:function(e){if(!getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}var reorderedIds=$headers.sortable("toArray");var reorderedColumns=[];for(var i=0;i<reorderedIds.length;i++){reorderedColumns.push(columns[getColumnIndex(reorderedIds[i].replace(uid,""))])}setColumns(reorderedColumns);trigger(self.onColumnsReordered,{});e.stopPropagation();setupColumnResize()}})}function setupColumnResize(){var $col,j,c,pageX,columnElements,minPageX,maxPageX,firstResizable,lastResizable;columnElements=$headers.children();columnElements.find(".slick-resizable-handle").remove();columnElements.each(function(i,e){if(columns[i].resizable){if(firstResizable===undefined){firstResizable=i}lastResizable=i}});if(firstResizable===undefined){return}columnElements.each(function(i,e){if(i<firstResizable||(options.forceFitColumns&&i>=lastResizable)){return}$col=$(e);$("<div class='slick-resizable-handle' />").appendTo(e).css({width:"ontouchstart" in window?16:(i===lastResizable?8:4)}).bind("dragstart touchstart",function(e,dd){if(!getEditorLock().commitCurrentEdit()){return false}pageX=e.pageX;$(this).parent().addClass("slick-header-column-active");var shrinkLeewayOnRight=null,stretchLeewayOnRight=null;columnElements.each(function(i,e){columns[i].previousWidth=$(e).outerWidth()});if(options.forceFitColumns){shrinkLeewayOnRight=0;stretchLeewayOnRight=0;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnRight!==null){if(c.maxWidth){stretchLeewayOnRight+=c.maxWidth-c.previousWidth}else{stretchLeewayOnRight=null}}shrinkLeewayOnRight+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}}var shrinkLeewayOnLeft=0,stretchLeewayOnLeft=0;for(j=0;j<=i;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnLeft!==null){if(c.maxWidth){stretchLeewayOnLeft+=c.maxWidth-c.previousWidth}else{stretchLeewayOnLeft=null}}shrinkLeewayOnLeft+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}if(shrinkLeewayOnRight===null){shrinkLeewayOnRight=100000}if(shrinkLeewayOnLeft===null){shrinkLeewayOnLeft=100000}if(stretchLeewayOnRight===null){stretchLeewayOnRight=100000}if(stretchLeewayOnLeft===null){stretchLeewayOnLeft=100000}maxPageX=pageX+Math.min(shrinkLeewayOnRight,stretchLeewayOnLeft);minPageX=pageX-Math.min(shrinkLeewayOnLeft,stretchLeewayOnRight)}).bind("drag touchmove",function(e,dd){var actualMinWidth,d=Math.min(maxPageX,Math.max(minPageX,e.pageX))-pageX,x;if(d<0){x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}}}else{x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}}}applyColumnHeaderWidths();if(options.syncColumnCellResize){applyColumnWidths();updateCanvasWidth(true)}}).bind("dragend touchend",function(e,dd){var newWidth;$(this).parent().removeClass("slick-header-column-active");for(j=0;j<columnElements.length;j++){c=columns[j];newWidth=$(columnElements[j]).outerWidth();if(c.previousWidth!==newWidth&&c.rerenderOnResize){invalidateAllRows()}}updateCanvasWidth(true);render();trigger(self.onColumnsResized,{})}).bind("click",function(e){e.stopPropagation()})})}function getVBoxDelta($el){var p=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];var delta=0;$.each(p,function(n,val){delta+=parseFloat($el.css(val))||0});return delta}function measureCellPaddingAndBorder(){var el;var h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"];var v=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];el=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers);headerColumnWidthDiff=headerColumnHeightDiff=0;$.each(h,function(n,val){headerColumnWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){headerColumnHeightDiff+=parseFloat(el.css(val))||0});el.remove();var r=$("<div class='slick-row' />").appendTo($canvas);el=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(r);cellWidthDiff=cellHeightDiff=0;$.each(h,function(n,val){cellWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){cellHeightDiff+=parseFloat(el.css(val))||0});r.remove();absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));var rowHeight=(options.rowHeight-cellHeightDiff);var rules=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+rowHeight+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"];for(var i=0;i<columns.length;i++){rules.push("."+uid+" .l"+i+" { }");rules.push("."+uid+" .r"+i+" { }")}if($style[0].styleSheet){$style[0].styleSheet.cssText=rules.join(" ")}else{$style[0].appendChild(document.createTextNode(rules.join(" ")))}}function getColumnCssRules(idx){if(!stylesheet){var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){if((sheets[i].ownerNode||sheets[i].owningElement)==$style[0]){stylesheet=sheets[i];break}}if(!stylesheet){throw new Error("Cannot find stylesheet.")}columnCssRulesL=[];columnCssRulesR=[];var cssRules=(stylesheet.cssRules||stylesheet.rules);var matches,columnIdx;for(var i=0;i<cssRules.length;i++){var selector=cssRules[i].selectorText;if(matches=/\.l\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesL[columnIdx]=cssRules[i]}else{if(matches=/\.r\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesR[columnIdx]=cssRules[i]}}}}return{left:columnCssRulesL[idx],right:columnCssRulesR[idx]}}function removeCssRules(){$style.remove();stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit();trigger(self.onBeforeDestroy,{});var i=plugins.length;while(i--){unregisterPlugin(plugins[i])}if(options.enableColumnReorder&&$headers.sortable){$headers.sortable("destroy")}unbindAncestorScrollEvents();$container.unbind(".slickgrid");removeCssRules();$canvas.unbind("draginit dragstart dragend drag");$container.empty().removeClass(uid)}function trigger(evt,args,e){e=e||new Slick.EventData();args=args||{};args.grid=self;return evt.notify(args,e,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(id){return columnsById[id]}function autosizeColumns(){var i,c,widths=[],shrinkLeeway=0,total=0,prevTotal,availWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(i=0;i<columns.length;i++){c=columns[i];widths.push(c.width);total+=c.width;if(c.resizable){shrinkLeeway+=c.width-Math.max(c.minWidth,absoluteColumnMinWidth)}}prevTotal=total;while(total>availWidth&&shrinkLeeway){var shrinkProportion=(total-availWidth)/shrinkLeeway;for(i=0;i<columns.length&&total>availWidth;i++){c=columns[i];var width=widths[i];if(!c.resizable||width<=c.minWidth||width<=absoluteColumnMinWidth){continue}var absMinWidth=Math.max(c.minWidth,absoluteColumnMinWidth);var shrinkSize=Math.floor(shrinkProportion*(width-absMinWidth))||1;shrinkSize=Math.min(shrinkSize,width-absMinWidth);total-=shrinkSize;shrinkLeeway-=shrinkSize;widths[i]-=shrinkSize}if(prevTotal==total){break}prevTotal=total}prevTotal=total;while(total<availWidth){var growProportion=availWidth/total;for(i=0;i<columns.length&&total<availWidth;i++){c=columns[i];if(!c.resizable||c.maxWidth<=c.width){continue}var growSize=Math.min(Math.floor(growProportion*c.width)-c.width,(c.maxWidth-c.width)||1000000)||1;total+=growSize;widths[i]+=growSize}if(prevTotal==total){break}prevTotal=total}var reRender=false;for(i=0;i<columns.length;i++){if(columns[i].rerenderOnResize&&columns[i].width!=widths[i]){reRender=true}columns[i].width=widths[i]}applyColumnHeaderWidths();updateCanvasWidth(true);if(reRender){invalidateAllRows();render()}}function applyColumnHeaderWidths(){if(!initialized){return}var h;for(var i=0,headers=$headers.children(),ii=headers.length;i<ii;i++){h=$(headers[i]);if(h.width()!==columns[i].width-headerColumnWidthDiff){h.width(columns[i].width-headerColumnWidthDiff)}}updateColumnCaches()}function applyColumnWidths(){var x=0,w,rule;for(var i=0;i<columns.length;i++){w=columns[i].width;rule=getColumnCssRules(i);rule.left.style.left=x+"px";rule.right.style.right=(canvasWidth-x-w)+"px";x+=columns[i].width}}function setSortColumn(columnId,ascending){setSortColumns([{columnId:columnId,sortAsc:ascending}])}function setSortColumns(cols){sortColumns=cols;var headerColumnEls=$headers.children();headerColumnEls.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc");$.each(sortColumns,function(i,col){if(col.sortAsc==null){col.sortAsc=true}var columnIndex=getColumnIndex(col.columnId);if(columnIndex!=null){headerColumnEls.eq(columnIndex).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(col.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")}})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(e,ranges){selectedRows=[];var hash={};for(var i=0;i<ranges.length;i++){for(var j=ranges[i].fromRow;j<=ranges[i].toRow;j++){if(!hash[j]){selectedRows.push(j);hash[j]={}}for(var k=ranges[i].fromCell;k<=ranges[i].toCell;k++){if(canCellBeSelected(j,k)){hash[j][columns[k].id]=options.selectedCellCssClass}}}}setCellCssStyles(options.selectedCellCssClass,hash);trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},e)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[];columnPosRight=[];var x=0;for(var i=0,ii=columns.length;i<ii;i++){columnPosLeft[i]=x;columnPosRight[i]=x+columns[i].width;x+=columns[i].width}}function setColumns(columnDefinitions){columns=columnDefinitions;columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;if(m.minWidth&&m.width<m.minWidth){m.width=m.minWidth}if(m.maxWidth&&m.width>m.maxWidth){m.width=m.maxWidth}}updateColumnCaches();if(initialized){invalidateAllRows();createColumnHeaders();removeCssRules();createCssRules();resizeCanvas();applyColumnWidths();handleScroll()}}function getOptions(){return options}function setOptions(args){if(!getEditorLock().commitCurrentEdit()){return}makeActiveCellNormal();if(options.enableAddRow!==args.enableAddRow){invalidateRow(getDataLength())}options=$.extend(options,args);validateAndEnforceOptions();$viewport.css("overflow-y",options.autoHeight?"hidden":"auto");render()}function validateAndEnforceOptions(){if(options.autoHeight){options.leaveSpaceForNewRows=false}}function setData(newData,scrollToTop){data=newData;invalidateAllRows();updateRowCount();if(scrollToTop){scrollTo(0)}}function getData(){return data}function getDataLength(){if(data.getLength){return data.getLength()}else{return data.length}}function getDataItem(i){if(data.getItem){return data.getItem(i)}else{return data[i]}}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(visible){if(options.showTopPanel!=visible){options.showTopPanel=visible;if(visible){$topPanelScroller.slideDown("fast",resizeCanvas)}else{$topPanelScroller.slideUp("fast",resizeCanvas)}}}function setHeaderRowVisibility(visible){if(options.showHeaderRow!=visible){options.showHeaderRow=visible;if(visible){$headerRowScroller.slideDown("fast",resizeCanvas)}else{$headerRowScroller.slideUp("fast",resizeCanvas)}}}function scrollTo(y){y=Math.max(y,0);y=Math.min(y,th-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0));var oldOffset=offset;page=Math.min(n-1,Math.floor(y/ph));offset=Math.round(page*cj);var newScrollTop=y-offset;if(offset!=oldOffset){var range=getVisibleRange(newScrollTop);cleanupRows(range);updateRowPositions()}if(prevScrollTop!=newScrollTop){vScrollDir=(prevScrollTop+oldOffset<newScrollTop+offset)?1:-1;$viewport[0].scrollTop=(lastRenderedScrollTop=scrollTop=prevScrollTop=newScrollTop);trigger(self.onViewportChanged,{})}}function defaultFormatter(row,cell,value,columnDef,dataContext){if(value==null){return""}else{return value.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}function getFormatter(row,column){var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnOverrides=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[column.id]||rowMetadata.columns[getColumnIndex(column.id)]);return(columnOverrides&&columnOverrides.formatter)||(rowMetadata&&rowMetadata.formatter)||column.formatter||(options.formatterFactory&&options.formatterFactory.getFormatter(column))||options.defaultFormatter}function getEditor(row,cell){var column=columns[cell];var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[column.id]&&columnMetadata[column.id].editor!==undefined){return columnMetadata[column.id].editor}if(columnMetadata&&columnMetadata[cell]&&columnMetadata[cell].editor!==undefined){return columnMetadata[cell].editor}return column.editor||(options.editorFactory&&options.editorFactory.getEditor(column))}function getDataItemValueForColumn(item,columnDef){if(options.dataItemColumnValueExtractor){return options.dataItemColumnValueExtractor(item,columnDef)}return item[columnDef.field]}function appendRowHtml(stringArray,row,range){var d=getDataItem(row);var dataLoading=row<getDataLength()&&!d;var rowCss="slick-row"+(dataLoading?" loading":"")+(row===activeRow?" active":"")+(row%2==1?" odd":" even");var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(metadata&&metadata.cssClasses){rowCss+=" "+metadata.cssClasses}stringArray.push("<div class='ui-widget-content "+rowCss+"' style='top:"+(options.rowHeight*row-offset)+"px'>");var colspan,m;for(var i=0,ii=columns.length;i<ii;i++){m=columns[i];colspan=1;if(metadata&&metadata.columns){var columnData=metadata.columns[m.id]||metadata.columns[i];colspan=(columnData&&columnData.colspan)||1;if(colspan==="*"){colspan=ii-i}}if(columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx){if(columnPosLeft[i]>range.rightPx){break}appendCellHtml(stringArray,row,i,colspan)}if(colspan>1){i+=(colspan-1)}}stringArray.push("</div>")}function appendCellHtml(stringArray,row,cell,colspan){var m=columns[cell];var d=getDataItem(row);var cellCss="slick-cell l"+cell+" r"+Math.min(columns.length-1,cell+colspan-1)+(m.cssClass?" "+m.cssClass:"");if(row===activeRow&&cell===activeCell){cellCss+=(" active")}for(var key in cellCssClasses){if(cellCssClasses[key][row]&&cellCssClasses[key][row][m.id]){cellCss+=(" "+cellCssClasses[key][row][m.id])}}stringArray.push("<div class='"+cellCss+"'>");if(d){var value=getDataItemValueForColumn(d,m);stringArray.push(getFormatter(row,m)(row,cell,value,m,d))}stringArray.push("</div>");rowsCache[row].cellRenderQueue.push(cell);rowsCache[row].cellColSpans[cell]=colspan}function cleanupRows(rangeToKeep){for(var i in rowsCache){if(((i=parseInt(i,10))!==activeRow)&&(i<rangeToKeep.top||i>rangeToKeep.bottom)){removeRowFromCache(i)}}}function invalidate(){updateRowCount();invalidateAllRows();render()}function invalidateAllRows(){if(currentEditor){makeActiveCellNormal()}for(var row in rowsCache){removeRowFromCache(row)}}function removeRowFromCache(row){var cacheEntry=rowsCache[row];if(!cacheEntry){return}$canvas[0].removeChild(cacheEntry.rowNode);delete rowsCache[row];delete postProcessedRows[row];renderedRows--;counter_rows_removed++}function invalidateRows(rows){var i,rl;if(!rows||!rows.length){return}vScrollDir=0;for(i=0,rl=rows.length;i<rl;i++){if(currentEditor&&activeRow===rows[i]){makeActiveCellNormal()}if(rowsCache[rows[i]]){removeRowFromCache(rows[i])}}}function invalidateRow(row){invalidateRows([row])}function updateCell(row,cell){var cellNode=getCellNode(row,cell);if(!cellNode){return}var m=columns[cell],d=getDataItem(row);if(currentEditor&&activeRow===row&&activeCell===cell){currentEditor.loadValue(d)}else{cellNode.innerHTML=d?getFormatter(row,m)(row,cell,getDataItemValueForColumn(d,m),m,d):"";invalidatePostProcessingResults(row)}}function updateRow(row){var cacheEntry=rowsCache[row];if(!cacheEntry){return}ensureCellNodesInRowsCache(row);for(var columnIdx in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){continue}columnIdx=columnIdx|0;var m=columns[columnIdx],d=getDataItem(row),node=cacheEntry.cellNodesByColumnIdx[columnIdx];if(row===activeRow&&columnIdx===activeCell&&currentEditor){currentEditor.loadValue(d)}else{if(d){node.innerHTML=getFormatter(row,m)(row,columnIdx,getDataItemValueForColumn(d,m),m,d)}else{node.innerHTML=""}}}invalidatePostProcessingResults(row)}function getViewportHeight(){return parseFloat($.css($container[0],"height",true))-parseFloat($.css($container[0],"paddingTop",true))-parseFloat($.css($container[0],"paddingBottom",true))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function getContentSize(){var canvasWidth=$canvas.width(),canvasHeight=$canvas.height(),hasVScroll=canvasHeight>$viewport.height(),contentWidth=canvasWidth+(hasVScroll?scrollbarDimensions.width:0),hasHScroll=contentWidth>$viewport.width(),contentHeight=canvasHeight+(hasHScroll?scrollbarDimensions.height:0);return{width:contentWidth,height:contentHeight}}function getVisibleSize(){var width=$viewport.width(),height=$viewport.height(),hasHScroll=$canvas.width()>width-scrollbarDimensions.width,hasVScroll=$canvas.height()>height-scrollbarDimensions.height;width-=hasVScroll?scrollbarDimensions.width:0;height-=hasHScroll?scrollbarDimensions.height:0;return{width:width,height:height}}function resizeCanvas(){if(!initialized){return}if(options.autoHeight){viewportH=options.rowHeight*(getDataLength()+(options.enableAddRow?1:0))}else{viewportH=getViewportHeight()}numVisibleRows=Math.ceil(viewportH/options.rowHeight);viewportW=parseFloat($.css($container[0],"width",true));if(!options.autoHeight){$viewport.height(viewportH)}if(options.forceFitColumns){autosizeColumns()}cleanUpAndRenderCells(getRenderedRange());updateRowCount();handleScroll();render()}function updateRowCount(){if(!initialized){return}numberOfRows=getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var oldViewportHasVScroll=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&(numberOfRows*options.rowHeight>viewportH);var l=options.enableAddRow?getDataLength():getDataLength()-1;for(var i in rowsCache){if(i>=l){removeRowFromCache(i)}}if(activeCellNode&&activeRow>l){resetActiveCell()}var oldH=h;th=Math.max(options.rowHeight*numberOfRows,viewportH-scrollbarDimensions.height);if(th<maxSupportedCssHeight){h=ph=th;n=1;cj=0}else{h=maxSupportedCssHeight;ph=h/100;n=Math.floor(th/ph);cj=(th-h)/(n-1)}if(h!==oldH){$canvas.css("height",h);scrollTop=$viewport[0].scrollTop}var oldScrollTopInRange=(scrollTop+offset<=th-viewportH);if(th==0||scrollTop==0){page=offset=0}else{if(oldScrollTopInRange){scrollTo(scrollTop+offset)}else{scrollTo(th-viewportH)}}if(h!=oldH&&options.autoHeight){resizeCanvas()}if(options.forceFitColumns&&oldViewportHasVScroll!=viewportHasVScroll){autosizeColumns()}updateCanvasWidth(false)}function getVisibleRange(viewportTop,viewportLeft){if(viewportTop==null){viewportTop=scrollTop}if(viewportLeft==null){viewportLeft=scrollLeft}return{top:Math.floor((viewportTop+offset)/options.rowHeight),bottom:Math.ceil((viewportTop+offset+viewportH)/options.rowHeight),leftPx:viewportLeft,rightPx:viewportLeft+viewportW}}function getRenderedRange(viewportTop,viewportLeft){var range=getVisibleRange(viewportTop,viewportLeft);var buffer=Math.round(viewportH/options.rowHeight);var minBuffer=3;if(vScrollDir==-1){range.top-=buffer;range.bottom+=minBuffer}else{if(vScrollDir==1){range.top-=minBuffer;range.bottom+=buffer}else{range.top-=minBuffer;range.bottom+=minBuffer}}range.top=Math.max(0,range.top);range.bottom=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,range.bottom);range.leftPx-=viewportW;range.rightPx+=viewportW;range.leftPx=Math.max(0,range.leftPx);range.rightPx=Math.min(canvasWidth,range.rightPx);return range}function ensureCellNodesInRowsCache(row){var cacheEntry=rowsCache[row];if(cacheEntry){if(cacheEntry.cellRenderQueue.length){var lastChild=cacheEntry.rowNode.lastChild;while(cacheEntry.cellRenderQueue.length){var columnIdx=cacheEntry.cellRenderQueue.pop();cacheEntry.cellNodesByColumnIdx[columnIdx]=lastChild;lastChild=lastChild.previousSibling}}}}function cleanUpCells(range,row){var totalCellsRemoved=0;var cacheEntry=rowsCache[row];var cellsToRemove=[];for(var i in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(i)){continue}i=i|0;var colspan=cacheEntry.cellColSpans[i];if(columnPosLeft[i]>range.rightPx||columnPosRight[Math.min(columns.length-1,i+colspan-1)]<range.leftPx){if(!(row==activeRow&&i==activeCell)){cellsToRemove.push(i)}}}var cellToRemove;while((cellToRemove=cellsToRemove.pop())!=null){cacheEntry.rowNode.removeChild(cacheEntry.cellNodesByColumnIdx[cellToRemove]);delete cacheEntry.cellColSpans[cellToRemove];delete cacheEntry.cellNodesByColumnIdx[cellToRemove];if(postProcessedRows[row]){delete postProcessedRows[row][cellToRemove]}totalCellsRemoved++}}function cleanUpAndRenderCells(range){var cacheEntry;var stringArray=[];var processedRows=[];var cellsAdded;var totalCellsAdded=0;var colspan;for(var row=range.top;row<=range.bottom;row++){cacheEntry=rowsCache[row];if(!cacheEntry){continue}ensureCellNodesInRowsCache(row);cleanUpCells(range,row);cellsAdded=0;var metadata=data.getItemMetadata&&data.getItemMetadata(row);metadata=metadata&&metadata.columns;for(var i=0,ii=columns.length;i<ii;i++){if(columnPosLeft[i]>range.rightPx){break}if((colspan=cacheEntry.cellColSpans[i])!=null){i+=(colspan>1?colspan-1:0);continue}colspan=1;if(metadata){var columnData=metadata[columns[i].id]||metadata[i];colspan=(columnData&&columnData.colspan)||1;if(colspan==="*"){colspan=ii-i}}if(columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx){appendCellHtml(stringArray,row,i,colspan);cellsAdded++}i+=(colspan>1?colspan-1:0)}if(cellsAdded){totalCellsAdded+=cellsAdded;processedRows.push(row)}}if(!stringArray.length){return}var x=document.createElement("div");x.innerHTML=stringArray.join("");var processedRow;var node;while((processedRow=processedRows.pop())!=null){cacheEntry=rowsCache[processedRow];var columnIdx;while((columnIdx=cacheEntry.cellRenderQueue.pop())!=null){node=x.lastChild;cacheEntry.rowNode.appendChild(node);cacheEntry.cellNodesByColumnIdx[columnIdx]=node}}}function renderRows(range){var parentNode=$canvas[0],stringArray=[],rows=[],needToReselectCell=false;for(var i=range.top;i<=range.bottom;i++){if(rowsCache[i]){continue}renderedRows++;rows.push(i);rowsCache[i]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]};appendRowHtml(stringArray,i,range);if(activeCellNode&&activeRow===i){needToReselectCell=true}counter_rows_rendered++}if(!rows.length){return}var x=document.createElement("div");x.innerHTML=stringArray.join("");for(var i=0,ii=rows.length;i<ii;i++){rowsCache[rows[i]].rowNode=parentNode.appendChild(x.firstChild);rowsCache[rows[i]].rowNode.offsetWidth}if(needToReselectCell){activeCellNode=getCellNode(activeRow,activeCell)}}function startPostProcessing(){if(!options.enableAsyncPostRender){return}clearTimeout(h_postrender);h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay)}function invalidatePostProcessingResults(row){delete postProcessedRows[row];postProcessFromRow=Math.min(postProcessFromRow,row);postProcessToRow=Math.max(postProcessToRow,row);startPostProcessing()}function updateRowPositions(){for(var row in rowsCache){rowsCache[row].rowNode.style.top=(row*options.rowHeight-offset)+"px"}}function render(){if(!initialized){return}var visible=getVisibleRange();var rendered=getRenderedRange();cleanupRows(rendered);if(lastRenderedScrollLeft!=scrollLeft){cleanUpAndRenderCells(rendered)}renderRows(rendered);postProcessFromRow=visible.top;postProcessToRow=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,visible.bottom);startPostProcessing();lastRenderedScrollTop=scrollTop;lastRenderedScrollLeft=scrollLeft;h_render=null}function handleHeaderRowScroll(){var scrollLeft=$headerRowScroller[0].scrollLeft;if(scrollLeft!=$viewport[0].scrollLeft){$viewport[0].scrollLeft=scrollLeft}}function handleScroll(){scrollTop=$viewport[0].scrollTop;scrollLeft=$viewport[0].scrollLeft;var vScrollDist=Math.abs(scrollTop-prevScrollTop);var hScrollDist=Math.abs(scrollLeft-prevScrollLeft);if(hScrollDist){prevScrollLeft=scrollLeft;$headerScroller[0].scrollLeft=scrollLeft;$topPanelScroller[0].scrollLeft=scrollLeft;$headerRowScroller[0].scrollLeft=scrollLeft}if(vScrollDist){vScrollDir=prevScrollTop<scrollTop?1:-1;prevScrollTop=scrollTop;if(vScrollDist<viewportH){scrollTo(scrollTop+offset)}else{var oldOffset=offset;if(h==viewportH){page=n-1}else{page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph)))}offset=Math.round(page*cj);if(oldOffset!=offset){invalidateAllRows()}}}if(hScrollDist||vScrollDist){if(h_render){clearTimeout(h_render)}if(Math.abs(lastRenderedScrollTop-scrollTop)>20||Math.abs(lastRenderedScrollLeft-scrollLeft)>20){if(options.forceSyncScrolling||(Math.abs(lastRenderedScrollTop-scrollTop)<viewportH&&Math.abs(lastRenderedScrollLeft-scrollLeft)<viewportW)){render()}else{h_render=setTimeout(render,50)}trigger(self.onViewportChanged,{})}}trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){while(postProcessFromRow<=postProcessToRow){var row=(vScrollDir>=0)?postProcessFromRow++:postProcessToRow--;var cacheEntry=rowsCache[row];if(!cacheEntry||row>=getDataLength()){continue}if(!postProcessedRows[row]){postProcessedRows[row]={}}ensureCellNodesInRowsCache(row);for(var columnIdx in cacheEntry.cellNodesByColumnIdx){if(!cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){continue}columnIdx=columnIdx|0;var m=columns[columnIdx];if(m.asyncPostRender&&!postProcessedRows[row][columnIdx]){var node=cacheEntry.cellNodesByColumnIdx[columnIdx];if(node){m.asyncPostRender(node,row,getDataItem(row),m)}postProcessedRows[row][columnIdx]=true}}h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay);return}}function updateCellCssStylesOnRenderedRows(addedHash,removedHash){var node,columnId,addedRowHash,removedRowHash;for(var row in rowsCache){removedRowHash=removedHash&&removedHash[row];addedRowHash=addedHash&&addedHash[row];if(removedRowHash){for(columnId in removedRowHash){if(!addedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).removeClass(removedRowHash[columnId])}}}}if(addedRowHash){for(columnId in addedRowHash){if(!removedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).addClass(addedRowHash[columnId])}}}}}}function addCellCssStyles(key,hash){if(cellCssClasses[key]){throw"addCellCssStyles: cell CSS hash with key '"+key+"' already exists."}cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,null);trigger(self.onCellCssStylesChanged,{key:key,hash:hash})}function removeCellCssStyles(key){if(!cellCssClasses[key]){return}updateCellCssStylesOnRenderedRows(null,cellCssClasses[key]);delete cellCssClasses[key];trigger(self.onCellCssStylesChanged,{key:key,hash:null})}function setCellCssStyles(key,hash){var prevHash=cellCssClasses[key];cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,prevHash);trigger(self.onCellCssStylesChanged,{key:key,hash:hash})}function getCellCssStyles(key){return cellCssClasses[key]}function flashCell(row,cell,speed){speed=speed||100;if(rowsCache[row]){var $cell=$(getCellNode(row,cell));function toggleCellClass(times){if(!times){return}setTimeout(function(){$cell.queue(function(){$cell.toggleClass(options.cellFlashingCssClass).dequeue();toggleCellClass(times-1)})},speed)}toggleCellClass(4)}}function handleHeaderDragInit(e,dd){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");if(!column){return false}dd.column=column;retval=trigger(self.onHeaderDragInit,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleHeaderDragStart(e,dd){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");if(!column){return false}dd.column=column;var retval=trigger(self.onHeaderDragStart,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleHeaderDrag(e,dd){return trigger(self.onHeaderDrag,dd,e)}function handleHeaderDragEnd(e,dd){trigger(self.onHeaderDragEnd,dd,e)}function handleDragInit(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}retval=trigger(self.onDragInit,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDragStart(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}var retval=trigger(self.onDragStart,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDrag(e,dd){return trigger(self.onDrag,dd,e)}function handleDragEnd(e,dd){trigger(self.onDragEnd,dd,e)}function handleKeyDown(e){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},e);var handled=e.isImmediatePropagationStopped();if(!handled){if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){if(e.which==27){if(!getEditorLock().isActive()){return}cancelEditAndSetFocus()}else{if(e.which==37){handled=navigateLeft()}else{if(e.which==39){handled=navigateRight()}else{if(e.which==38){handled=navigateUp()}else{if(e.which==40){handled=navigateDown()}else{if(e.which==9){handled=navigateNext()}else{if(e.which==13){if(options.editable){if(currentEditor){if(activeRow===getDataLength()){navigateDown()}else{commitEditAndSetFocus()}}else{if(getEditorLock().commitCurrentEdit()){makeActiveCellEditable()}}}handled=true}}}}}}}}else{if(e.which==9&&e.shiftKey&&!e.ctrlKey&&!e.altKey){handled=navigatePrev()}}}if(handled){e.stopPropagation();e.preventDefault();try{e.originalEvent.keyCode=0}catch(error){}}}function handleClick(e){if(!currentEditor){if(e.target!=document.activeElement){setFocus()}}var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if((activeCell!=cell.cell||activeRow!=cell.row)&&canCellBeActive(cell.row,cell.cell)){if(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit()){scrollRowIntoView(cell.row,false);setActiveCellInternal(getCellNode(cell.row,cell.cell),(cell.row===getDataLength())||options.autoEdit)}}}function handleContextMenu(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if($cell.length===0){return}if(activeCellNode===$cell[0]&&currentEditor!==null){return}trigger(self.onContextMenu,{},e)}function handleDblClick(e){var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onDblClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if(options.editable){gotoCell(cell.row,cell.cell,true)}}function handleHeaderMouseEnter(e){trigger(self.onHeaderMouseEnter,{column:$(this).data("column")},e)}function handleHeaderMouseLeave(e){trigger(self.onHeaderMouseLeave,{column:$(this).data("column")},e)}function handleHeaderContextMenu(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");trigger(self.onHeaderContextMenu,{column:column},e)}function handleHeaderClick(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&$header.data("column");if(column){trigger(self.onHeaderClick,{column:column},e)}}function handleMouseEnter(e){trigger(self.onMouseEnter,{},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{},e)}function cellExists(row,cell){return !(row<0||row>=getDataLength()||cell<0||cell>=columns.length)}function getCellFromPoint(x,y){var row=Math.floor((y+offset)/options.rowHeight);var cell=0;var w=0;for(var i=0;i<columns.length&&w<x;i++){w+=columns[i].width;cell++}if(cell<0){cell=0}return{row:row,cell:cell-1}}function getCellFromNode(cellNode){var cls=/l\d+/.exec(cellNode.className);if(!cls){throw"getCellFromNode: cannot get cell - "+cellNode.className}return parseInt(cls[0].substr(1,cls[0].length-1),10)}function getRowFromNode(rowNode){for(var row in rowsCache){if(rowsCache[row].rowNode===rowNode){return row|0}}return null}function getCellFromEvent(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if(!$cell.length){return null}var row=getRowFromNode($cell[0].parentNode);var cell=getCellFromNode($cell[0]);if(row==null||cell==null){return null}else{return{row:row,cell:cell}}}function getCellNodeBox(row,cell){if(!cellExists(row,cell)){return null}var y1=row*options.rowHeight-offset;var y2=y1+options.rowHeight-1;var x1=0;for(var i=0;i<cell;i++){x1+=columns[i].width}var x2=x1+columns[cell].width;return{top:y1,left:x1,bottom:y2,right:x2}}function resetActiveCell(){setActiveCellInternal(null,false)}function setFocus(){if(tabbingDirection==-1){$focusSink[0].focus()}else{$focusSink2[0].focus()}}function scrollCellIntoView(row,cell){var colspan=getColspan(row,cell);var left=columnPosLeft[cell],right=columnPosRight[cell+(colspan>1?colspan-1:0)],scrollRight=scrollLeft+viewportW;if(left<scrollLeft){$viewport.scrollLeft(left);handleScroll();render()}else{if(right>scrollRight){$viewport.scrollLeft(Math.min(left,right-$viewport[0].clientWidth));handleScroll();render()}}}function setActiveCellInternal(newCell,editMode){if(activeCellNode!==null){makeActiveCellNormal();$(activeCellNode).removeClass("active");if(rowsCache[activeRow]){$(rowsCache[activeRow].rowNode).removeClass("active")}}var activeCellChanged=(activeCellNode!==newCell);activeCellNode=newCell;if(activeCellNode!=null){activeRow=getRowFromNode(activeCellNode.parentNode);activeCell=activePosX=getCellFromNode(activeCellNode);$(activeCellNode).addClass("active");$(rowsCache[activeRow].rowNode).addClass("active");if(options.editable&&editMode&&isCellPotentiallyEditable(activeRow,activeCell)){clearTimeout(h_editorLoader);if(options.asyncEditorLoading){h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay)}else{makeActiveCellEditable()}}}else{activeRow=activeCell=null}if(activeCellChanged){trigger(self.onActiveCellChanged,getActiveCell())}}function clearTextSelection(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var sel=window.getSelection();if(sel&&sel.removeAllRanges){sel.removeAllRanges()}}}}function isCellPotentiallyEditable(row,cell){if(row<getDataLength()&&!getDataItem(row)){return false}if(columns[cell].cannotTriggerInsert&&row>=getDataLength()){return false}if(!getEditor(row,cell)){return false}return true}function makeActiveCellNormal(){if(!currentEditor){return}trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor});currentEditor.destroy();currentEditor=null;if(activeCellNode){var d=getDataItem(activeRow);$(activeCellNode).removeClass("editable invalid");if(d){var column=columns[activeCell];var formatter=getFormatter(activeRow,column);activeCellNode.innerHTML=formatter(activeRow,activeCell,getDataItemValueForColumn(d,column),column,getDataItem(activeRow));invalidatePostProcessingResults(activeRow)}}if($.browser.msie){clearTextSelection()}getEditorLock().deactivate(editController)}function makeActiveCellEditable(editor){if(!activeCellNode){return}if(!options.editable){throw"Grid : makeActiveCellEditable : should never get called when options.editable is false"}clearTimeout(h_editorLoader);if(!isCellPotentiallyEditable(activeRow,activeCell)){return}var columnDef=columns[activeCell];var item=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:item,column:columnDef})===false){setFocus();return}getEditorLock().activate(editController);$(activeCellNode).addClass("editable");if(!editor){activeCellNode.innerHTML=""}currentEditor=new (editor||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:columnDef,item:item||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus});if(item){currentEditor.loadValue(item)}serializedEditorValue=currentEditor.serializeValue();if(currentEditor.position){handleActiveCellPositionChange()}}function commitEditAndSetFocus(){if(getEditorLock().commitCurrentEdit()){setFocus();if(options.autoEdit){navigateDown()}}}function cancelEditAndSetFocus(){if(getEditorLock().cancelCurrentEdit()){setFocus()}}function absBox(elem){var box={top:elem.offsetTop,left:elem.offsetLeft,bottom:0,right:0,width:$(elem).outerWidth(),height:$(elem).outerHeight(),visible:true};box.bottom=box.top+box.height;box.right=box.left+box.width;var offsetParent=elem.offsetParent;while((elem=elem.parentNode)!=document.body){if(box.visible&&elem.scrollHeight!=elem.offsetHeight&&$(elem).css("overflowY")!="visible"){box.visible=box.bottom>elem.scrollTop&&box.top<elem.scrollTop+elem.clientHeight}if(box.visible&&elem.scrollWidth!=elem.offsetWidth&&$(elem).css("overflowX")!="visible"){box.visible=box.right>elem.scrollLeft&&box.left<elem.scrollLeft+elem.clientWidth}box.left-=elem.scrollLeft;box.top-=elem.scrollTop;if(elem===offsetParent){box.left+=elem.offsetLeft;box.top+=elem.offsetTop;offsetParent=elem.offsetParent}box.bottom=box.top+box.height;box.right=box.left+box.width}return box}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(!activeCellNode){return}trigger(self.onActiveCellPositionChanged,{});if(currentEditor){var cellBox=getActiveCellPosition();if(currentEditor.show&&currentEditor.hide){if(!cellBox.visible){currentEditor.hide()}else{currentEditor.show()}}if(currentEditor.position){currentEditor.position(cellBox)}}}function getCellEditor(){return currentEditor}function getActiveCell(){if(!activeCellNode){return null}else{return{row:activeRow,cell:activeCell}}}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(row,doPaging){var rowAtTop=row*options.rowHeight;var rowAtBottom=(row+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);if((row+1)*options.rowHeight>scrollTop+viewportH+offset){scrollTo(doPaging?rowAtTop:rowAtBottom);render()}else{if(row*options.rowHeight<scrollTop+offset){scrollTo(doPaging?rowAtBottom:rowAtTop);render()}}}function scrollRowToTop(row){scrollTo(row*options.rowHeight);render()}function getColspan(row,cell){var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(!metadata||!metadata.columns){return 1}var columnData=metadata.columns[columns[cell].id]||metadata.columns[cell];var colspan=(columnData&&columnData.colspan);if(colspan==="*"){colspan=columns.length-cell}else{colspan=colspan||1}return colspan}function findFirstFocusableCell(row){var cell=0;while(cell<columns.length){if(canCellBeActive(row,cell)){return cell}cell+=getColspan(row,cell)}return null}function findLastFocusableCell(row){var cell=0;var lastFocusableCell=null;while(cell<columns.length){if(canCellBeActive(row,cell)){lastFocusableCell=cell}cell+=getColspan(row,cell)}return lastFocusableCell}function gotoRight(row,cell,posX){if(cell>=columns.length){return null}do{cell+=getColspan(row,cell)}while(cell<columns.length&&!canCellBeActive(row,cell));if(cell<columns.length){return{row:row,cell:cell,posX:cell}}return null}function gotoLeft(row,cell,posX){if(cell<=0){return null}var firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell===null||firstFocusableCell>=cell){return null}var prev={row:row,cell:firstFocusableCell,posX:firstFocusableCell};var pos;while(true){pos=gotoRight(prev.row,prev.cell,prev.posX);if(!pos){return null}if(pos.cell>=cell){return prev}prev=pos}}function gotoDown(row,cell,posX){var prevCell;while(true){if(++row>=getDataLength()+(options.enableAddRow?1:0)){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoUp(row,cell,posX){var prevCell;while(true){if(--row<0){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoNext(row,cell,posX){if(row==null&&cell==null){row=cell=posX=0;if(canCellBeActive(row,cell)){return{row:row,cell:cell,posX:cell}}}var pos=gotoRight(row,cell,posX);if(pos){return pos}var firstFocusableCell=null;while(++row<getDataLength()+(options.enableAddRow?1:0)){firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell!==null){return{row:row,cell:firstFocusableCell,posX:firstFocusableCell}}}return null}function gotoPrev(row,cell,posX){if(row==null&&cell==null){row=getDataLength()+(options.enableAddRow?1:0)-1;cell=posX=columns.length-1;if(canCellBeActive(row,cell)){return{row:row,cell:cell,posX:cell}}}var pos;var lastSelectableCell;while(!pos){pos=gotoLeft(row,cell,posX);if(pos){break}if(--row<0){return null}cell=0;lastSelectableCell=findLastFocusableCell(row);if(lastSelectableCell!==null){pos={row:row,cell:lastSelectableCell,posX:lastSelectableCell}}}return pos}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(dir){if(!options.enableCellNavigation){return false}if(!activeCellNode&&dir!="prev"&&dir!="next"){return false}if(!getEditorLock().commitCurrentEdit()){return true}setFocus();var tabbingDirections={up:-1,down:1,left:-1,right:1,prev:-1,next:1};tabbingDirection=tabbingDirections[dir];var stepFunctions={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext};var stepFn=stepFunctions[dir];var pos=stepFn(activeRow,activeCell,activePosX);if(pos){var isAddNewRow=(pos.row==getDataLength());scrollRowIntoView(pos.row,!isAddNewRow);scrollCellIntoView(pos.row,pos.cell);setActiveCellInternal(getCellNode(pos.row,pos.cell),isAddNewRow||options.autoEdit);activePosX=pos.posX;return true}else{setActiveCellInternal(getCellNode(activeRow,activeCell),(activeRow==getDataLength())||options.autoEdit);return false}}function getCellNode(row,cell){if(rowsCache[row]){ensureCellNodesInRowsCache(row);return rowsCache[row].cellNodesByColumnIdx[cell]}return null}function setActiveCell(row,cell){if(!initialized){return}if(row>getDataLength()||row<0||cell>=columns.length||cell<0){return}if(!options.enableCellNavigation){return}scrollRowIntoView(row,false);scrollCellIntoView(row,cell);setActiveCellInternal(getCellNode(row,cell),false)}function canCellBeActive(row,cell){if(!options.enableCellNavigation||row>=getDataLength()+(options.enableAddRow?1:0)||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.focusable==="boolean"){return rowMetadata.focusable}var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[columns[cell].id]&&typeof columnMetadata[columns[cell].id].focusable==="boolean"){return columnMetadata[columns[cell].id].focusable}if(columnMetadata&&columnMetadata[cell]&&typeof columnMetadata[cell].focusable==="boolean"){return columnMetadata[cell].focusable}return columns[cell].focusable}function canCellBeSelected(row,cell){if(row>=getDataLength()||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.selectable==="boolean"){return rowMetadata.selectable}var columnMetadata=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[columns[cell].id]||rowMetadata.columns[cell]);if(columnMetadata&&typeof columnMetadata.selectable==="boolean"){return columnMetadata.selectable}return columns[cell].selectable}function gotoCell(row,cell,forceEdit){if(!initialized){return}if(!canCellBeActive(row,cell)){return}if(!getEditorLock().commitCurrentEdit()){return}scrollRowIntoView(row,false);scrollCellIntoView(row,cell);var newCell=getCellNode(row,cell);setActiveCellInternal(newCell,forceEdit||(row===getDataLength())||options.autoEdit);if(!currentEditor){setFocus()}}function commitCurrentEdit(){var item=getDataItem(activeRow);var column=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var validationResults=currentEditor.validate();if(validationResults.valid){if(activeRow<getDataLength()){var editCommand={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(item,this.serializedValue);updateRow(this.row)},undo:function(){this.editor.applyValue(item,this.prevSerializedValue);updateRow(this.row)}};if(options.editCommandHandler){makeActiveCellNormal();options.editCommandHandler(item,column,editCommand)}else{editCommand.execute();makeActiveCellNormal()}trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:item})}else{var newItem={};currentEditor.applyValue(newItem,currentEditor.serializeValue());makeActiveCellNormal();trigger(self.onAddNewRow,{item:newItem,column:column})}return !getEditorLock().isActive()}else{$(activeCellNode).addClass("invalid");$(activeCellNode).stop(true,true).effect("highlight",{color:"red"},300);trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:validationResults,row:activeRow,cell:activeCell,column:column});currentEditor.focus();return false}}makeActiveCellNormal()}return true}function cancelCurrentEdit(){makeActiveCellNormal();return true}function rowsToRanges(rows){var ranges=[];var lastCell=columns.length-1;for(var i=0;i<rows.length;i++){ranges.push(new Slick.Range(rows[i],0,rows[i],lastCell))}return ranges}function getSelectedRows(){if(!selectionModel){throw"Selection model is not set"}return selectedRows}function setSelectedRows(rows){if(!selectionModel){throw"Selection model is not set"}selectionModel.setSelectedRanges(rowsToRanges(rows))}this.debug=function(){var s="";s+=("\ncounter_rows_rendered:  "+counter_rows_rendered);s+=("\ncounter_rows_removed:  "+counter_rows_removed);s+=("\nrenderedRows:  "+renderedRows);s+=("\nnumVisibleRows:  "+numVisibleRows);s+=("\nmaxSupportedCssHeight:  "+maxSupportedCssHeight);s+=("\nn(umber of pages):  "+n);s+=("\n(current) page:  "+page);s+=("\npage height (ph):  "+ph);s+=("\nvScrollDir:  "+vScrollDir);alert(s)};this.eval=function(expr){return eval(expr)};$.extend(this,{slickGridVersion:"2.1",onScroll:new Slick.Event(),onSort:new Slick.Event(),onHeaderMouseEnter:new Slick.Event(),onHeaderMouseLeave:new Slick.Event(),onHeaderContextMenu:new Slick.Event(),onHeaderClick:new Slick.Event(),onHeaderCellRendered:new Slick.Event(),onBeforeHeaderCellDestroy:new Slick.Event(),onHeaderRowCellRendered:new Slick.Event(),onBeforeHeaderRowCellDestroy:new Slick.Event(),onMouseEnter:new Slick.Event(),onMouseLeave:new Slick.Event(),onClick:new Slick.Event(),onDblClick:new Slick.Event(),onContextMenu:new Slick.Event(),onKeyDown:new Slick.Event(),onAddNewRow:new Slick.Event(),onValidationError:new Slick.Event(),onCanvasWidthChanged:new Slick.Event(),onViewportChanged:new Slick.Event(),onColumnsReordered:new Slick.Event(),onColumnsResized:new Slick.Event(),onCellChange:new Slick.Event(),onBeforeEditCell:new Slick.Event(),onBeforeCellEditorDestroy:new Slick.Event(),onBeforeDestroy:new Slick.Event(),onActiveCellChanged:new Slick.Event(),onActiveCellPositionChanged:new Slick.Event(),onHeaderDragInit:new Slick.Event(),onHeaderDragStart:new Slick.Event(),onHeaderDrag:new Slick.Event(),onHeaderDragEnd:new Slick.Event(),onDragInit:new Slick.Event(),onDragStart:new Slick.Event(),onDrag:new Slick.Event(),onDragEnd:new Slick.Event(),onSelectedRowsChanged:new Slick.Event(),onCellCssStylesChanged:new Slick.Event(),registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,getContentSize:getContentSize,getVisibleSize:getVisibleSize,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,scrollRowToTop:scrollRowToTop,scrollCellIntoView:scrollCellIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,gotoCell:gotoCell,getTopPanel:getTopPanel,setTopPanelVisibility:setTopPanelVisibility,setHeaderRowVisibility:setHeaderRowVisibility,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController});init()}}(jQuery));(function(b){b.extend(true,window,{Slick:{Data:{GroupItemMetadataProvider:a}}});function a(m){var i;var f={groupCssClass:"slick-group",groupTitleCssClass:"slick-group-title",totalsCssClass:"slick-group-totals",groupSelectable:false,groupFocusable:true,totalsFocusable:false,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:true};m=b.extend(true,{},f,m);function h(s,n,r,o,q){if(!m.enableExpandCollapse){return q.title}var p=q.level*15+"px";return"<span class='"+m.toggleCssClass+" "+(q.collapsed?m.toggleCollapsedCssClass:m.toggleExpandedCssClass)+"' style='margin-left:"+p+"'></span><span class='"+m.groupTitleCssClass+"' level='"+q.level+"'>"+q.title+"</span>"}function d(r,n,q,o,p){return(o.groupTotalsFormatter&&o.groupTotalsFormatter(p,o))||""}function l(n){i=n;i.onClick.subscribe(e);i.onKeyDown.subscribe(j)}function k(){if(i){i.onClick.unsubscribe(e);i.onKeyDown.unsubscribe(j)}}function e(p,n){var o=this.getDataItem(n.row);if(o&&o instanceof Slick.Group&&b(p.target).hasClass(m.toggleCssClass)){if(o.collapsed){this.getData().expandGroup(o.groupingKey)}else{this.getData().collapseGroup(o.groupingKey)}p.stopImmediatePropagation();p.preventDefault()}}function j(q,o){if(m.enableExpandCollapse&&(q.which==b.ui.keyCode.SPACE)){var n=this.getActiveCell();if(n){var p=this.getDataItem(n.row);if(p&&p instanceof Slick.Group){if(p.collapsed){this.getData().expandGroup(p.groupingKey)}else{this.getData().collapseGroup(p.groupingKey)}q.stopImmediatePropagation();q.preventDefault()}}}}function c(n){return{selectable:m.groupSelectable,focusable:m.groupFocusable,cssClasses:m.groupCssClass,columns:{0:{colspan:"*",formatter:h,editor:null}}}}function g(n){return{selectable:false,focusable:m.totalsFocusable,cssClasses:m.totalsCssClass,formatter:d,editor:null}}return{init:l,destroy:k,getGroupRowMetadata:c,getTotalsRowMetadata:g}}})(jQuery);DG._guid=-1;DG.Record=SC.Record.extend({ignoreUnknownProperties:YES,recordType:function(){return this.constructor}.property().cacheable(),guid:SC.Record.attr(String,{defaultValue:function(){return DG._guid--}}),willSaveRecord:function(){},didLoadRecord:function(){},toLink:function(){var b=this.get("recordType"),a=DG.Record.stringFromRecordType(b);return{type:a,id:this.get("id")}},toArchive:function(){var a=this.get("store"),g=this.get("id"),f=this.get("recordType"),d=a.storeKeyFor(f,g),c=null,e=this;function b(i,h){if(h.isOwner){var j=e.get(i)||[],k=[];c[i]=[];j.forEach(function(m){var l=m&&m.get("status");if(l&&!(l&SC.Record.DESTROYED)&&(l!==SC.Record.BUSY_DESTROYING)){k.push(m)}});k.sort(function(m,l){var o=m.get("id"),n=l.get("id");if(o<n){return -1}if(o>n){return 1}return 0});k.forEach(function(l){var m=l.toArchive();if(m){delete m[h.inverse];c[i].push(m)}})}else{if(h.isMaster){delete c[i]}}}this.willSaveRecord();c=SC.copy(a.readDataHash(d),false)||{};this.forEachRelation(b);return c},forEachRelation:function(a){DG.Record.forEachRelation(this.get("recordType"),a)}});DG.Record.stringFromRecordType=function(a){return SC._object_className(a)||""};DG.Record.recordTypeFromString=function(d){var c=d.indexOf("."),a=c>=0?c+1:0,b=d.substr(a);return DG[b]};DG.Record.forEachRelation=function(c,g){var f=c.prototype,d,b,e,h,a;for(d in f){if(f.hasOwnProperty(d)){b=f[d];if(b&&b.typeClass&&b.inverse){e=b.typeClass();h=e.prototype;a=h[b.inverse];if(SC.typeOf(e)===SC.T_CLASS){g(d,b,a)}}}}};DG.Record._destroyRecordArrayWithExclusions=function(b,e){var c=[];b.flush();if(b.get("scheduledFlushCount")>0){window.setTimeout(function(){SC.run(function(){DG.Record._destroyRecordArrayWithExclusions(b,e)})},1);return}if(e){e.sort(DG.ArrayUtils.numericComparator)}var d=b.get("storeKeys");function f(g){var i=DG.store.idFor(g),h=DG.ArrayUtils.binarySearch(e,i,DG.ArrayUtils.numericComparator);return h===-1}var a=d.filter(f);a.forEach(function(g){c.push(DG.store.idFor(g))});DG.store.destroyRecords(undefined,undefined,a);b.destroy();return c};DG.Record.destroyAllRecordsOfType=function(b,c){var a;a=DG.store.find(b);return DG.Record._destroyRecordArrayWithExclusions(a,c)};sc_require("models/dg_record");DG.Attribute=DG.Record.extend({name:SC.Record.attr(String,{defaultValue:""}),formula:SC.Record.attr(String,{defaultValue:""}),colormap:SC.Record.attr(Object,{defaultValue:null}),description:SC.Record.attr(String,{defaultValue:""}),collection:SC.Record.toOne("DG.CollectionRecord",{inverse:"attrs",isOwner:NO,isMaster:NO}),precision:SC.Record.attr(Number,{defaultValue:2}),editable:SC.Record.attr(Boolean,{defaultValue:false}),_dgFormula:null,init:function(){arguments.callee.base.apply(this,arguments);var a=this.get("formula");if(!SC.empty(a)&&!this._dgFormula){this.createDGFormula();this._dgFormula.set("source",a)}},destroy:function(){if(this._dgFormula){this.destroyDGFormula()}arguments.callee.base.apply(this,arguments)},createDGFormula:function(){this._dgFormula=DG.Formula.create({context:DG.CollectionFormulaContext.create({collection:this.get("collection")})});this._dgFormula.addObserver("dependentChange",this,"dependentDidChange")},destroyDGFormula:function(){this._dgFormula.removeObserver("dependentChange",this,"dependentDidChange");this._dgFormula.destroy();this._dgFormula=null},hasFormula:function(){return !SC.empty(this.get("formula"))}.property("formula").cacheable(),evalFormula:function(b){var d=this._dgFormula,a=NaN;try{a=d.evaluate({_case_:b,_id_:b&&b.get("id")})}catch(c){a=c}return a},formulaDidChange:function(){var a=this.get("formula");if(!SC.empty(a)){if(!this._dgFormula){this.createDGFormula()}this._dgFormula.set("source",a)}else{if(this._dgFormula){this.destroyDGFormula()}}}.observes("formula"),dependentDidChange:function(a,b){this.notifyPropertyChange(b)},didLoadRecord:function(){var a=this.get("id");DG.Attribute.idMap[a]=this}});DG.Attribute.idMap={};DG.Attribute.getAttributeByID=function(a){return DG.Attribute.idMap[a]};DG.Attribute.createAttribute=function(b){var a=DG.store.createRecord(DG.Attribute,b||{});DG.store.commitRecords();DG.Attribute.idMap[a.get("id")]=a;return a};DG.Attribute.destroyAttribute=function(a){var b=a&&a.get("id");if(!SC.none(b)){delete DG.Attribute.idMap[b]}a.destroy()};sc_require("models/dg_record");DG.Case=DG.Record.extend({revision:0,collection:SC.Record.toOne("DG.CollectionRecord",{inverse:"cases",isMaster:NO}),parent:SC.Record.toOne("DG.Case",{inverse:"children",isOwner:NO,isMaster:NO}),children:SC.Record.toMany("DG.Case",{inverse:"parent",isOwner:NO,isMaster:YES}),_id:null,_valuesMap:null,values:SC.Record.attr(Object,{defaultValue:{}}),init:function(){arguments.callee.base.apply(this,arguments);this._valuesMap={}},destroy:function(){this._valuesMap=null;arguments.callee.base.apply(this,arguments)},beginCaseValueChanges:function(){this.beginPropertyChanges()},endCaseValueChanges:function(){this.incrementProperty("revision");this.endPropertyChanges()},getValue:function(c){if(!SC.none(c)){var a=DG.Attribute.getAttributeByID(c);if(a&&a.get("hasFormula")&&(this.getPath("collection.id")===a.getPath("collection.id"))){return a.evalFormula(this)}if(this._valuesMap&&(this._valuesMap[c]!==undefined)){return this._valuesMap[c]}var b=this.get("parent");if(b){return b.getValue(c)}}},getNumValue:function(b,a){var c=this.getValue(b),d=typeof c;if(a){a.type=d;a.isNominal=(d==="boolean")||((d==="string")&&!SC.empty(String(c)))}switch(d){case"number":return c;case"string":return(c!==""?Number(c):NaN)}return NaN},getStrValue:function(b,a){var c=this.getValue(b),d=typeof c;if(a){a.type=d}switch(d){case"number":case"string":case"boolean":return String(c)}return""},hasValue:function(c){if(!SC.none(c)){var a=DG.Attribute.getAttributeByID(c);if(a&&a.get("hasFormula")){return true}if(this._valuesMap&&!SC.empty(this._valuesMap[c])){return true}var b=this.get("parent");return b&&b.hasValue(c)}},setValue:function(a,b){if(!this._valuesMap){return}this._valuesMap[a]=b},toArchive:function(){var a={};DG.ObjectMap.forEach(this._valuesMap,function(c,e){var b=DG.Attribute.getAttributeByID(c),d=b&&b.get("name");if(e!==undefined){a[d]=e}});this.set("values",a);return arguments.callee.base.apply(this,arguments)},didLoadRecord:function(){var b=this.get("collection"),a={};DG.ObjectMap.forEach(this.get("values"),function(d,f){if(f!==undefined){var c=b&&b.getAttributeByName(d),e=c&&c.get("id");if(!SC.none(e)){a[e]=f}}});this._valuesMap=a;this.set("values",null)},debugLog:function(a){DG.log("Case "+this.get("id"))}});DG.Case.createCase=function(b){var a=DG.store.createRecord(DG.Case,b||{});DG.store.commitRecords();a._id=a.get("id");return a};DG.Case.destroyCase=function(a){a.destroy()};DG.Collection=SC.Object.extend({collectionRecord:null,id:function(){return this.collectionRecord&&this.collectionRecord.get("id")}.property("collectionRecord").cacheable(),attrsQuery:null,attrsRecords:null,casesQuery:null,casesRecords:null,init:function(){arguments.callee.base.apply(this,arguments);function a(c,b){var e=c._id||c.get("id"),d=b._id||b.get("id");if(e<d){return -1}if(e>d){return 1}return 0}this.attrsQuery=SC.Query.local(DG.Attribute,{conditions:"collection = {collection}",collection:this.collectionRecord,orderBy:a});this.attrsRecords=DG.store.find(this.attrsQuery);this.casesQuery=SC.Query.local(DG.Case,{conditions:"collection = {collection}",collection:this.collectionRecord,orderBy:a});this.casesRecords=DG.store.find(this.casesQuery);this.updateCaseIDToIndexMap()},areParentChildLinksConfigured:function(){return this.getPath("collectionRecord.areParentChildLinksConfigured")}.property("collectionRecord.areParentChildLinksConfigured").cacheable(),isAncestorOf:function(a){var b=this.get("collectionRecord");return b&&b.isAncestorOf(a.get("collectionRecord"))},isDescendantOf:function(a){var b=this.get("collectionRecord");return b&&b.isDescendantOf(a.get("collectionRecord"))},createAttribute:function(a){a=a||{};a.collection=this.get("id");return DG.Attribute.createAttribute(a)},createCase:function(e){e=e||{};e.collection=this.get("id");var b=DG.Case.createCase(e),a=b.get("id"),f=b.getPath("parent.id"),d=this.collectionRecord.get("caseIDToIndexMap"),c=this.collectionRecord.get("caseCounts");if(c[f]==null){c[f]=0}d[a]=c[f]++;return b},deleteCase:function(a){DG.Case.destroyCase(a)},getAttributeIDs:function(){return this.attrsRecords.getEach("id")},getAttributeNames:function(){return this.attrsRecords.getEach("name")},getCaseIDs:function(){return this.casesRecords.getEach("id")},updateCaseIDToIndexMap:function(){var a={},b={};this.casesRecords.forEach(function(d){if(!d.get("isDestroyed")){var c=d.get("id"),e=d.getPath("parent.id");if(a[e]==null){a[e]=0}b[c]=a[e]++}});this.collectionRecord.set("caseIDToIndexMap",b);this.collectionRecord.set("caseCounts",a)},refresh:function(){this.attrsRecords.refresh();this.casesRecords.refresh()},debugLog:function(a){DG.log((a||"")+" Collection "+this.getPath("collectionRecord.id")+",  Attrs: ["+this.getAttributeIDs()+"],  Cases: ["+this.getCaseIDs()+"]")}});sc_require("models/dg_record");DG.CollectionRecord=DG.Record.extend((function(){return{name:SC.Record.attr(String,{defaultValue:""}),description:SC.Record.attr(String,{defaultValue:""}),context:SC.Record.toOne("DG.DataContextRecord",{inverse:"collections",isOwner:NO,isMaster:NO}),parent:SC.Record.toOne("DG.CollectionRecord",{inverse:"children",isOwner:NO,isMaster:NO}),children:SC.Record.toMany("DG.CollectionRecord",{inverse:"parent",isOwner:NO,isMaster:YES}),areParentChildLinksConfigured:false,attrs:SC.Record.toMany("DG.Attribute",{inverse:"collection",isOwner:YES,isMaster:YES}),cases:SC.Record.toMany("DG.Case",{inverse:"collection",isOwner:YES,isMaster:YES}),caseIDToIndexMap:null,caseCounts:null,destroy:function(){this.cases.forEach(function(a){DG.Case.destroyCase(a)});this.attrs.forEach(function(a){DG.Attribute.destroyAttribute(a)});arguments.callee.base.apply(this,arguments)},isAncestorOf:function(a){return a.isDescendantOf(this)},isDescendantOf:function(a){var b=this.get("parent");if(!b){return false}if(b===a){return true}return b.isDescendantOf(a)},getAttributeByName:function(c){var b=this.get("attrs"),d,e=b&&b.get("length");for(d=0;d<e;++d){var a=b.objectAt(d);if(a&&(a.get("name")===c)){return a}}return null}}}()));DG.CollectionRecord.createCollection=function(b){var a=DG.store.createRecord(DG.CollectionRecord,b||{});if(!SC.none(b.areParentChildLinksConfigured)){a.set("areParentChildLinksConfigured",b.areParentChildLinksConfigured)}DG.store.commitRecords();return a};DG.CollectionRecord.destroyCollection=function(a){a.destroy()};sc_require("models/dg_record");DG.Component=DG.Record.extend({document:SC.Record.toOne("DG.Document",{inverse:"components",isOwner:NO,isMaster:NO}),content:function(a,b){if(b!==undefined){DG.Component.setContent(this,b);return this}return DG.Component.getContent(this)}.property(),type:SC.Record.attr(String),layout:SC.Record.attr(Object,{defaultValue:null}),componentStorage:SC.Record.attr(Object,{defaultValue:null})});DG.Component.contentMap={};DG.Component.getContent=function(a){var b=a&&DG.store.idFor(a.get("storeKey"));return b?DG.Component.contentMap[b]:undefined};DG.Component.setContent=function(a,c){var b=a&&DG.store.idFor(a.get("storeKey"));if(!SC.none(b)){if(c===undefined){delete DG.Component.contentMap[b]}else{DG.Component.contentMap[b]=c}}};DG.Component.createComponent=function(a){var b=DG.store.createRecord(DG.Component,a||{});b.normalize();DG.store.commitRecords();return b};DG.Component.destroyComponent=function(a){a.destroy();DG.store.commitRecords()};sc_require("models/dg_record");DG.DataContextRecord=DG.Record.extend({type:SC.Record.attr(String,{defaultValue:"DG.DataContext"}),document:SC.Record.toOne("DG.Document",{inverse:"contexts",isOwner:NO,isMaster:NO}),collections:SC.Record.toMany("DG.CollectionRecord",{inverse:"context",isOwner:YES,isMaster:YES}),contextStorage:SC.Record.attr(Object,{defaultValue:null}),destroy:function(){this.collections.forEach(function(a){DG.CollectionRecord.destroy(a)});arguments.callee.base.apply(this,arguments)},createCollection:function(a){a=a||{};a.context=this.get("id");return DG.CollectionRecord.createCollection(a)}});DG.DataContextRecord.createContext=function(b){if(SC.none(b)){b={}}if(SC.none(b.type)){b.type="DG.DataContext"}var a=DG.store.createRecord(DG.DataContextRecord,b);DG.store.commitRecords();return a};DG.DataContextRecord.destroyContext=function(a){a.destroy()};SC.Query.orderStoreKeys=function(f,g,b){if(f){var e,a=f.get("length"),h=true,d=null;for(e=0;e<a;e++){var c=f.objectAt(e);if(d&&SC.Query.compareStoreKeys(g,b,d,c)>0){h=false;break}d=c}if(!h){f.sort(function(j,i){return SC.Query.compareStoreKeys(g,b,j,i)})}}return f};sc_require("models/dg_record");DG.Document=DG.Record.extend({name:SC.Record.attr(String,{defaultValue:""}),appName:SC.Record.attr(String,{defaultValue:""}),appVersion:SC.Record.attr(String,{defaultValue:""}),appBuildNum:SC.Record.attr(String,{defaultValue:""}),components:SC.Record.toMany("DG.Component",{inverse:"document",isOwner:YES,isMaster:YES}),contexts:SC.Record.toMany("DG.DataContextRecord",{inverse:"context",isOwner:YES,isMaster:YES}),globalValues:SC.Record.toMany("DG.GlobalValue",{inverse:"document",isOwner:YES,isMaster:YES}),contextRecords:null,init:function(){arguments.callee.base.apply(this,arguments);this.contextRecords=DG.store.find(DG.DataContextRecord)},destroy:function(){this.get("globalValues").forEach(function(a){DG.GlobalValue.destroy(a)});this.get("contexts").forEach(function(a){DG.DataContextRecord.destroy(a)});this.get("components").forEach(function(a){DG.Component.destroy(a)});arguments.callee.base.apply(this,arguments)},createContext:function(a){if(SC.none(a)){a={}}a.document=this.get("id");return DG.DataContextRecord.createContext(a)},willSaveRecord:function(){this.set("appName",DG.APPNAME);this.set("appVersion",DG.VERSION);this.set("appBuildNum",DG.BUILD_NUM)}});DG.Document.createDocument=function(d){var c="DG.MemoryDataSource",b=c;var a=SC.Store.create({document:this}).from(b);DG.assert(!DG.store,"Can't create another document without closing the first.");DG.store=a;var e=a.createRecord(DG.Document,d||{});DG.store.commitRecords();return e};DG.Document.destroyDocument=function(a){a.destroy();DG.store=null};sc_require("models/dg_record");DG.GlobalValue=DG.Record.extend({name:SC.Record.attr(String,{defaultValue:""}),value:SC.Record.attr(Number),document:SC.Record.toOne("DG.Document",{inverse:"globalValues",isOwner:NO,isMaster:NO})});DG.GlobalValue.createGlobalValue=function(b){var a=DG.store.createRecord(DG.GlobalValue,b||{});DG.store.commitRecords();return a};DG.GlobalValue.destroyGlobalValue=function(a){a.destroy()};SC.stringsFor("English",{"DG.mainPage.mainPane.logoutButton.title":"Logout","DG.mainPage.mainPane.logoutButton.toolTip":"Log out the current user","DG.mainPage.mainPane.versionString":"Version %@ (%@)","DG.mainPage.mainPane.messageView.value":"Unfortunately, DG is not currently supported on your browser. DG is supported on Internet Explorer 9+, Firefox 3.6+, Chrome 10+, and Safari 4+. DG is not actively supported on other browsers at this time.","DG.Authorization.guestUserName":"guest","DG.Authorization.guestPassword":"","DG.Authorization.loginPane.dialogTitle":"Data Games Login","DG.Authorization.loginPane.userLabel":"User","DG.Authorization.loginPane.passwordLabel":"Password","DG.Authorization.loginPane.loginAsGuest":"Login as guest","DG.Authorization.loginPane.login":"Login","DG.Authorization.loginPane.registerLink":"<a href='http://%@/user/register'>Create a new account</a>","DG.Authorization.loginPane.recoveryLink":"<a href='http://%@/user/password'>Forgot your password?</a>","DG.Authorization.loginPane.error.general":"Error occurred while logging in","DG.Authorization.loginPane.error.userDatabaseError":"Error connecting to the user database","DG.Authorization.loginPane.error.authFailed":"Invalid username or password","DG.Authorization.loginPane.error.noResponse":"Could not connect to login server","DG.Authorization.loginPane.error.sessionExpired":"Session expired, please login again","DG.Authorization.loginPane.error.invalidSession":"Session invalid, please login again","DG.mainPage.mainPane.versionString.IS_BUILD":"Version %@ (%@ IS)","DG.Authorization.loginPane.registerLink.IS_BUILD":"","DG.Authorization.loginPane.recoveryLink.IS_BUILD":"","DG.mainPage.mainPane.versionString.SRRI_BUILD":"Version %@ (%@.srri10)","DG.Authorization.loginPane.registerLink.SRRI_BUILD":"<a href='http://%@/user/register'>Create a new account</a>","DG.Authorization.loginPane.recoveryLink.SRRI_BUILD":"<a href='http://%@/user/password'>Forgot your password?</a>","DG.AppController.resetData.title":"Clear Data...","DG.AppController.resetData.toolTip":"Delete all data from completed games","DG.AppController.resetData.warnMessage":"Do you really want to delete all the completed game data?","DG.AppController.resetData.warnDescription":"This action is not undoable.","DG.AppController.resetData.okButtonTitle":"Yes, delete the data","DG.AppController.resetData.cancelButtonTitle":"No, keep the data","DG.AppController.fileMenuItems.openDocument":"Open Document...","DG.AppController.fileMenuItems.saveDocument":"Save Document...","DG.AppController.fileMenuItems.documentManager":"Manage Documents...","DG.AppController.fileMenuItems.closeDocument":"Close Document...","DG.AppController.fileMenuItems.importDocument":"Import CODAP Document...","DG.AppController.fileMenuItems.exportDocument":"Export CODAP Document...","DG.AppController.fileMenuItems.exportCaseData":"Export Case Data...","DG.AppController.closeDocument.warnMessage":"Close the current document without saving?","DG.AppController.closeDocument.warnDescription":"This action is not undoable.","DG.AppController.closeDocument.okButtonTitle":"Close","DG.AppController.closeDocument.cancelButtonTitle":"Cancel","DG.AppController.beforeUnload.confirmationMessage":"The document contains unsaved changes.","DG.AppController.optionMenuItems.reportProblem":"Report Problem...","DG.AppController.optionMenuItems.viewWebPage":"Display Web Page...","DG.AppController.optionMenuItems.configureGuide":"Configure Guide...","DG.AppController.optionMenuItems.about":"About Data Games...","DG.AppController.optionMenuItems.releaseNotes":"What's New?","DG.AppController.optionMenuItems.help":"Help...","DG.AppController.optionMenuItems.toWebSite":"Data Games website","DG.AppController.optionMenuItems.logout":"Logout","DG.AppController.openDocument.prompt":"Choose a document to open:","DG.AppController.openDocument.okTitle":"Open","DG.AppController.openDocument.okTooltip":"Open the specified document","DG.AppController.openDocument.error.unknown":"The document could not be opened because an unknown error occurred.","DG.AppController.openDocument.error.general":"The document could not be opened because an error occurred.","DG.AppController.openDocument.error.notFound":"The document could not be found.","DG.AppController.openDocument.error.documentDatabaseConnectFailed":"An error occurred while trying to connect to the database.","DG.AppController.openDocument.error.permissions":"The document could not be opened. Please have the owner make it a shared document in order to access it.","DG.AppController.saveDocument.error.writeFailed":"An error occurred when trying to save the document.","DG.AppController.saveDocument.error.documentDatabaseConnectFailed":"An error occurred while trying to connect to the database.","DG.AppController.saveDocument.error.general":"The document could not be saved because an error occurred.","DG.AppController.saveDocument.prompt":"Choose a name for the document:","DG.AppController.saveDocument.okTitle":"Save","DG.AppController.saveDocument.okTooltip":"Save the document with the specified name","DG.AppController.importDocument.prompt":"Select a CODAP document to import:","DG.AppController.importDocument.alert":"Alert: The specified file is not a CODAP document.","DG.AppController.importDocument.okTitle":"Import","DG.AppController.importDocument.okTooltip":"Import the specified CODAP document","DG.AppController.exportDocument.prompt":"Filename:","DG.AppController.exportCaseData.prompt":"Copy the case data, from:","DG.AppController.exportCaseData.okTitle":"Done","DG.AppController.exportCaseData.okTooltip":"Done with export","DG.AppController.exportDocument.okTitle":"Done","DG.AppController.exportDocument.okTooltip":"Done with CODAP export","DG.AppController.reportProblem.dialogTitle":"Report Data Games Problem","DG.AppController.manageDocumentsURL":"/datagames_documents_manager","DG.AppController.showWebSiteURL":"/","DG.AppController.showHelpURL":"/support","DG.AppController.showHelpTitle":"Help with Data Games","DG.AppController.showAboutURL":"DataGames/WebPages/about/aboutDG.html","DG.AppController.showAboutTitle":"About Data Games","DG.AppController.showReleaseNotesURL":"http://play.ccssgames.com/release_notes","DG.AppController.showReleaseNotesTitle":"Data Games Release Notes","DG.OpenSaveDialog.promptView.value":"Choose a document/name","DG.OpenSaveDialog.documentNameView.prompt":"Document Name:","DG.OpenSaveDialog.okButton.title":"Open/Save","DG.OpenSaveDialog.okButton.toolTip":"Open/Save the specified document","DG.OpenSaveDialog.cancelButton.title":"Cancel","DG.OpenSaveDialog.cancelButton.toolTip":"Dismiss the dialog without making any changes","DG.OpenSaveDialog.documentPermissions.title":"Shared","DG.OpenSaveDialog.documentPermissions.toolTip":"Allow other users to access this document?","DG.OpenSaveDialog.loading":"Loading document list...","DG.OpenSaveDialog.noDocuments":"No documents found","DG.OpenSaveDialog.error.noResponse":"Error retrieving document list","DG.SingleTextDialog.okButton.title":"OK","DG.SingleTextDialog.cancelButton.title":"Cancel","DG.SingleTextDialog.cancelButton.toolTip":"Dismiss the dialog without making any changes","DG.DocumentController.calculatorTitle":"Calculator","DG.DocumentController.caseTableTitle":"Case Table","DG.DocumentController.graphTitle":"Graph","DG.DocumentController.sliderTitle":"Slider","DG.DocumentController.textTitle":"Text","DG.DocumentController.mapTitle":"Map","DG.DocumentController.saveDocument.errorMsg":"The document could not be saved because an error occurred.","DG.DocumentController.enterURLPrompt":"Enter the URL of a web page to display","DG.DocumentController.enterViewWebPageOKTip":"Displays the web page given by the URL","DG.DocumentListController.error.general":"There was an error retrieving documents","DG.DocumentListController.error.parseError":"Unable to parse response from server","DG.DocumentListController.error.documentDatabaseConnectFailed":"Error connecting to database","DG.Document.defaultDocumentName":"Untitled Document","DG.SliderView.thumbView.toolTip":"Drag to change the slider's value","DG.SliderView.startButton.toolTip":"Start/stop animation","DG.ToolButtonData.fileMenu.title":"File","DG.ToolButtonData.fileMenu.toolTip":"Save and open document (ctrl-s and ctrl-o)","DG.ToolButtonData.gameMenu.title":"Game","DG.ToolButtonData.gameMenu.toolTip":"Choose the game to play (ctrl-alt-shift-g)","DG.ToolButtonData.tableButton.title":"Table","DG.ToolButtonData.tableButton.toolTip":"Open/close the case table (ctrl-alt-t)","DG.ToolButtonData.graphButton.title":"Graph","DG.ToolButtonData.graphButton.toolTip":"Make a graph (ctrl-alt-g)","DG.ToolButtonData.sliderButton.title":"Slider","DG.ToolButtonData.sliderButton.toolTip":"Make a slider (ctrl-alt-s)","DG.ToolButtonData.calcButton.title":"Calc","DG.ToolButtonData.calcButton.toolTip":"Open/close the calculator (ctrl-alt-c)","DG.ToolButtonData.textButton.title":"Text","DG.ToolButtonData.textButton.toolTip":"Make a text object (ctrl-alt-shift-t)","DG.ToolButtonData.mapButton.title":"Map","DG.ToolButtonData.mapButton.toolTip":"Make a map","DG.ToolButtonData.optionMenu.title":"Options","DG.ToolButtonData.optionMenu.toolTip":"Help, activities, learn about Data Games, ...","DG.ToolButtonData.guideMenu.title":"Guide","DG.ToolButtonData.guideMenu.toolTip":"Show the guide for this activity and navigate within it","DG.ToolButtonData.guideMenu.showGuide":"Show Guide","DG.DataContext.singleCaseName":"case","DG.DataContext.pluralCaseName":"cases","DG.DataContext.caseCountString":"%@1 %@2","DG.DataContext.setOfCasesLabel":"a collection","DG.CollectionClient.cantEditFormulaErrorMsg":'The formula for attribute "%@" is not editable.',"DG.CollectionClient.cantEditFormulaErrorDesc":"Create a new attribute to be able to specify a formula.","DG.Formula.SyntaxErrorMiddle":"Syntax error: '%@'","DG.Formula.SyntaxErrorEnd":"Incomplete expression","DG.Formula.VarReferenceError.message":"'%@': unknown variable","DG.Formula.VarReferenceError.description":"Variable '%@' is unrecognized","DG.Formula.FuncReferenceError.message":"'%@': unknown function","DG.Formula.FuncReferenceError.description":"Function '%@' is unrecognized","DG.Formula.FuncArgsErrorSingle.message":"'%@' expects 1 argument","DG.Formula.FuncArgsErrorSingle.description":"The '%@' function expects 1 argument","DG.Formula.FuncArgsErrorPlural.message":"'%@' expects %@ arguments","DG.Formula.FuncArgsErrorPlural.description":"The '%@' function expects %@ arguments","DG.Formula.FuncArgsErrorRange.message":"'%@' expects %@-%@ arguments","DG.Formula.FuncArgsErrorRange.description":"The '%@' function expects %@-%@ arguments","DG.TableController.headerMenuItems.editAttribute":"Edit Formula...","DG.TableController.headerMenuItems.renameAttribute":"Rename Attribute...","DG.TableController.headerMenuItems.deleteAttribute":"Delete Attribute...","DG.TableController.gearMenuItems.newAttribute":"New Attribute in %@...","DG.TableController.gearMenuItems.setScoreFormula":"Set Score Formula...","DG.TableController.gearMenuItems.deleteCases":"Delete Selected Cases","DG.TableController.newAttrDlg.defaultAttrName":"new_attr","DG.TableController.newAttrDlg.attrNameHint":"Enter a name for the new attribute","DG.TableController.newAttrDlg.formulaHint":"If desired, type a formula for computing values of this attribute","DG.TableController.newAttrDlg.applyTooltip":"Define the new attribute using the name and (optional) formula","DG.TableController.newAttrDlg.mustEnterAttrNameMsg":"Please enter a name for the new attribute","DG.TableController.renameAttributePrompt":"Enter a new name for the attribute:","DG.TableController.renameAttributeOKTip":"Accept the new attribute name","DG.TableController.renameAttributeInvalidMsg":"Attribute names may not be empty","DG.TableController.renameAttributeInvalidDesc":"Please enter a valid attribute name","DG.TableController.renameAttributeDuplicateMsg":"An attribute with that name already exists","DG.TableController.renameAttributeDuplicateDesc":"Please enter a unique attribute name","DG.TableController.deleteAttribute.confirmMessage":"Delete the attribute '%@'?","DG.TableController.deleteAttribute.confirmDescription":"This action cannot be undone.","DG.TableController.deleteAttribute.okButtonTitle":"Delete Attribute","DG.TableController.deleteAttribute.cancelButtonTitle":"Cancel","DG.TableController.scoreAttrName":"score","DG.TableController.setScoreDlg.applyTooltip":"Set the formula for the '%@' attribute","DG.TableController.setScoreDlg.formulaHint":"Type a formula for computing values of this attribute","DG.AttrFormView.attrNamePrompt":"Attribute Name:","DG.AttrFormView.formulaPrompt":"Formula:","DG.AttrFormView.operandMenuTitle":"--- Insert Value ---","DG.AttrFormView.functionMenuTitle":"--- Insert Function ---","DG.AttrFormView.applyBtnTitle":"Apply","DG.AttrFormView.cancelBtnTitle":"Cancel","DG.AttrFormView.cancelBtnTooltip":"Dismiss the dialog without making any changes","DG.GuideConfigView.titlePrompt":"Guide Title","DG.GuideConfigView.titleHint":"Activity Name","DG.GuideConfigView.itemTitleHint":"Section Name","DG.GuideConfigView.itemURLHint":"URL of section","DG.GuideConfigView.okBtnTitle":"OK","DG.GuideConfigView.okBtnToolTip":"Accept the Guide menu items","DG.GuideConfigView.cancelBtnTitle":"Cancel","DG.GuideConfigView.cancelBtnTooltip":"Dismiss the dialog without making any changes","DG.CellLinearAxisView.midPanelTooltip":"Drag to translate axis scale","DG.CellLinearAxisView.lowerPanelTooltip":"Drag to change axis lower bound","DG.CellLinearAxisView.upperPanelTooltip":"Drag to change axis upper bound","DG.PlotModel.mixup":"Mix Up the Plot","DG.PlotModel.showCount":"Show Count","DG.PlotModel.hideCount":"Hide Count","DG.DotPlotModel.rescaleToData":"Rescale to Data","DG.DotPlotModel.showMovableValue":"Show Movable Value","DG.DotPlotModel.hideMovableValue":"Hide Movable Value","DG.DotPlotModel.showMean":"Show Mean","DG.DotPlotModel.hideMean":"Hide Mean","DG.DotPlotModel.showMedian":"Show Median","DG.DotPlotModel.hideMedian":"Hide Median","DG.DotPlotModel.showStDev":"Show Standard Deviation","DG.DotPlotModel.hideStDev":"Hide Standard Deviation","DG.DotPlotModel.showIQR":"Show Inter-Quartile Range","DG.DotPlotModel.hideIQR":"Hide Inter-Quartile Range","DG.DotPlotModel.hidePlottedValue":"Hide Plotted Value","DG.DotPlotModel.plotValue":"Plot Value","DG.ScatterPlotModel.ShowConnectingLine":"Show Connecting Lines","DG.ScatterPlotModel.HideConnectingLine":"Hide Connecting Lines","DG.ScatterPlotModel.UnlockIntercept":"Unlock Intercept","DG.ScatterPlotModel.LockIntercept":"Lock Intercept at Zero","DG.LegendView.attributeTooltip":"Click to change legend attribute","DG.NumberToggleView.showAll":"Show All","DG.NumberToggleView.overallTooltip":"Click numbers to show one. Click label to show all.","DG.PlottedAverageAdornment.meanValueTitle":"mean=%@","DG.PlottedAverageAdornment.medianValueTitle":"median=%@","DG.PlottedAverageAdornment.stDevValueTitle":"\xB11 SD, %@","DG.PlottedAverageAdornment.iqrValueTitle":"IQR=%@","DG.PlottedCountAdornment.title":"%@ %@, %@%","DG.GraphMenu.attribute_x":"X: %@","DG.GraphMenu.attribute_y":"Y: %@","DG.GraphMenu.attribute_legend":"Legend: %@","DG.GraphMenu.remove":"Remove Attribute","DG.GraphMenu.removeAttribute_x":"Remove X: %@","DG.GraphMenu.removeAttribute_y":"Remove Y: %@","DG.GraphMenu.removeAttribute_legend":"Remove Legend: %@","DG.GraphMenu.treatAsCategorical":"Treat as Categorical","DG.GraphMenu.treatAsNumeric":"Treat as Numeric","DG.GraphMenu.hide":"Hide and Show","DG.GraphMenu.hideSelectedPlural":"Hide Selected Cases","DG.GraphMenu.hideUnselectedPlural":"Hide Unselected Cases","DG.GraphMenu.hideSelectedSing":"Hide Selected Case","DG.GraphMenu.hideUnselectedSing":"Hide Unselected Case","DG.GraphMenu.showAll":"Show All Cases","DG.GraphView.replaceAttribute":"Replace %@ with %@","DG.GraphView.addAttribute":"Add attribute %@","DG.GraphView.addToEmptyPlace":"Create axis with %@","DG.GraphView.dropInPlot":"Color points by values of %@","DG.GraphView.zoomTip":"Double-click to zoom in.\nShift-double-click to zoom out","DG.GraphView.rescale":"Rescale to data","DG.DataTip.connectingLine":"%@: %@\nwith %@ %@"});DG.ToolButtonData=[{name:"fileMenu",desc:{title:"DG.ToolButtonData.fileMenu.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/folder.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/folder_depressed.png",target:"DG.appController.fileMenuPane",action:"popup",toolTip:"DG.ToolButtonData.fileMenu.toolTip",localize:true}},{name:"gameMenu",desc:{title:"DG.ToolButtonData.gameMenu.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/dg_ball.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/dg_ball_depressed.png",target:"DG.gameSelectionController.menuPane",action:"popup",toolTip:"DG.ToolButtonData.gameMenu.toolTip",localize:true}},{name:"tableButton",desc:{title:"DG.ToolButtonData.tableButton.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/table.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/table_depressed.png",target:"DG.mainPage",action:"toggleCaseTable",toolTip:"DG.ToolButtonData.tableButton.toolTip",localize:true}},{name:"graphButton",desc:{title:"DG.ToolButtonData.graphButton.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/graph.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/graph_depressed.png",target:"DG.mainPage",action:"addGraph",toolTip:"DG.ToolButtonData.graphButton.toolTip",localize:true}},{name:"mapButton",desc:{title:"DG.ToolButtonData.mapButton.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/map.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/map_depressed.png",target:"DG.mainPage",action:"toggleMap",toolTip:"DG.ToolButtonData.mapButton.toolTip",localize:true}},{name:"sliderButton",desc:{title:"DG.ToolButtonData.sliderButton.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/slider.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/slider_depressed.png",target:"DG.mainPage",action:"addSlider",toolTip:"DG.ToolButtonData.sliderButton.toolTip",localize:true}},{name:"calcButton",desc:{title:"DG.ToolButtonData.calcButton.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/calc.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/calc_depressed.png",target:"DG.mainPage",action:"toggleCalculator",toolTip:"DG.ToolButtonData.calcButton.toolTip",localize:true}},{name:"textButton",desc:{title:"DG.ToolButtonData.textButton.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/texttool.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/texttool_depressed.png",target:"DG.mainPage",action:"addText",toolTip:"DG.ToolButtonData.textButton.toolTip",localize:true}},{name:"optionButton",desc:{title:"DG.ToolButtonData.optionMenu.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/options.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/options_depressed.png",target:"DG.appController.optionMenuPane",action:"popup",toolTip:"DG.ToolButtonData.optionMenu.toolTip",localize:true}},{name:"guideButton",desc:{title:"DG.ToolButtonData.guideMenu.title",iconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/guide.png",depressedIconName:"/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/guide_depressed.png",target:"DG.appController.guideMenuPane",action:"popup",toolTip:"DG.ToolButtonData.guideMenu.toolTip",localize:true,isVisible:false}}];DG.Theme=SC.AceTheme.create({name:"dg"});SC.Theme.addTheme(DG.Theme);SC.defaultTheme="dg";DG.AnimationMath={kAnimationBias:0.7,kAnimationGain:0.3,Bias:function(c,b){var d;if(!b){b=this.kAnimationBias}if(b<=0.000001){d=0}else{if(b>=0.999999){d=1}else{d=c/((1/b-2)*(1-c)+1)}}return d},Gain:function(c,b){var d;if(!b){b=this.kAnimationGain}if(b<=0.000001){d=0}else{if(b>=0.999999){d=1}else{d=(1/b-2)*(1-2*c);if(c<0.5){d=c/(d+1)}else{d=(d-c)/(d-1)}}}return d},DefaultAnimationTween:function(a){return this.Gain(this.Bias(a))}};DG.ArrayUtils={indexOfMatch:function(b,d){var c,a=b.length;for(c=0;c<a;++c){if(d(b[c])){return c}}return -1},firstMatch:function(b,e){var d,a=b.length;for(d=0;d<a;++d){var c=b[d];if(e(c)){return c}}return null},numericComparator:function(a,b){var c=isNaN(a),d=isNaN(b);if(c&&d){return 0}if(c){return -1}if(d){return 1}if(a<b){return -1}if(a>b){return 1}return 0},binarySearch:function(b,g,d){if(!b||!d){return -1}var a=0,f=b.length-1,c,e;while(a<=f){c=Math.floor((a+f)/2);e=d(b[c],g);if(e<0){a=c+1}else{if(e>0){f=c-1}else{return c}}}return -1},subtract:function(a,d,b){var c=[],e={};if(!d||d.length===0){return a}a.forEach(function(f){e[b(f)]=f});d.forEach(function(f){delete e[b(f)]});DG.ObjectMap.forEach(e,function(f){c.push(e[f])});return c}};DG.CASE_VALUE_ANIMATOR_DISABLE_ANIMATION=false;DG.CaseValueAnimator=SC.Object.extend({dataContext:null,attributeIDs:null,deltas:null,cases:null,startingValues:null,isAnimating:false,startTime:null,destroy:function(){this.endAnimation();arguments.callee.base.apply(this,arguments)},changeValues:function(b){var g=this,e=this.get("dataContext"),d=[],a=[];if(!e){return}function c(i,h,j){return i-j*h}this.attributeIDs.forEach(function(h){a.push(h)});this.cases.forEach(function(h){d.push(h)});var f={operation:"updateCases",attributeIDs:a,cases:d,values:[]};this.cases.forEach(function(i,h){var j=g.startingValues[h];g.attributeIDs.forEach(function(l,k){if(!f.values[k]){f.values[k]=[]}f.values[k].push(c(j[k],g.deltas[k],b))})});e.applyChange(f)},animate:function(){var e=this,c=50,b=DG.PlotUtilities.kDefaultAnimationTime;function d(){e.startingValues=[];if(SC.none(e.cases)){return}e.cases.forEach(function(f){var g=[];e.attributeIDs.forEach(function(h){g.push(f.getValue(h))});e.startingValues.push(g)})}function a(){var f=(new Date()).valueOf(),g=(f-e.startTime)/b,h;function i(j){if(j>=1){return 1}else{return DG.AnimationMath.DefaultAnimationTween(j)}}h=i(g);if(g<1){DG.assert(!e.animationTimer.get("isPaused"));e.changeValues(h)}else{e.endAnimation()}}if(this.isAnimating){this.endAnimation()}d();this.isAnimating=true;if(DG.CASE_VALUE_ANIMATOR_DISABLE_ANIMATION){this.endAnimation();return}this.startTime=(new Date()).valueOf();if(SC.none(this.animationTimer)){this.animationTimer=SC.Timer.schedule({action:a,interval:c,repeats:YES,until:false})}this.animationTimer.set("isPaused",NO)},endAnimation:function(){if(!SC.none(this.animationTimer)){this.animationTimer.set("isPaused",YES)}if(this.get("isAnimating")){this.changeValues(1);this.set("isAnimating",false)}}});DG.ColorUtilities={kStartingHue:(2/3),kCatHueSpread:0.8,kCatSaturation:(2/3),kCatBrightness:1,kBrightnessDampenFactor:1,kStandardMacGammaCorrection:(1/1.8),kStandardWinGammaCorrection:(1/2.5),kBrightnessTable:[0.54,0.05,0.2,0.15,0.75,0.46],kBrightnessTableMaxK:0.75,kNoAttribCaseColor:{colorString:"#A6CAF0"},kMissingValueCaseColor:{colorString:"#808080"},kDefaultBorderColor:{colorString:"black"}};DG.ColorUtilities.Color=function(){return{colorString:""}};DG.ColorUtilities.rgbColor=function(){return{colorString:"",r:1,g:1,b:1}};DG.ColorUtilities.hsbColor=function(){return{colorString:"",h:1,s:1,b:1}};DG.ColorUtilities.calcAttributeColorFromIndex=function(f,a){DG.assert(f>=0&&f<a);var b=f/a;b+=DG.ColorUtilities.kStartingHue;b-=Math.floor(b);var c=1;var d=DG.ColorUtilities.dampenBrightnessByHue(1,b,DG.ColorUtilities.kBrightnessDampenFactor);var e=DG.ColorUtilities.hsb_to_PlatformColor(b,c,d);return e};DG.ColorUtilities.calcAttributeColor=function(d){var a=d.get("collectionClient"),b=d.get("attribute"),c=b&&b.get("colormap"),e=DG.ColorUtilities.getAttributeColorFromColorMap(c);if(!e){DG.assert(b!==DG.Analysis.kNullAttribute);var g=b.get("name"),f=a.getAttributeIndexByName(g),h=a.getAttributeCount();e=DG.ColorUtilities.calcAttributeColorFromIndex(f,h)}return e};DG.ColorUtilities.calcCaseColor=function(g,c,e){var f=null,j=c.get("attribute");if(j===DG.Analysis.kNullAttribute){f=e||DG.ColorUtilities.kNoAttribCaseColor}else{if(SC.none(g)){f=DG.ColorUtilities.kMissingValueCaseColor}else{var a=c.get("isNumeric"),d=j.get("colormap");if(!a){f=DG.ColorUtilities.getCategoryColorFromColorMap(d,g)}if(f===null){var b=DG.ColorUtilities.calcAttributeColor(c),i=c.get("attributeStats"),h=a?DG.ColorUtilities.calcContinuousColor:DG.ColorUtilities.calcCategoryColor;f=h(i,b,g)}}}return f};DG.ColorUtilities.getCategoryColorFromColorMap=function(c,b){if(c){var a=c[b];if(typeof a==="string"){return{colorString:a}}}return null};DG.ColorUtilities.getAttributeColorFromColorMap=function(b){if(b){var a=b["attribute-color"];if(typeof a==="string"){return DG.ColorUtilities.rgbColorString_to_PlatformColor(a,true)}}return null};DG.ColorUtilities.calcContinuousColor=function(c,a,g){var h=DG.ColorUtilities.kMissingValueCaseColor,e=c.get("minMax"),i=e.max-e.min,d=a.h,j=a.s,b=a.b,f;if(DG.isFinite(i)&&DG.isFinite(g)){f=(i>0)?((g-e.min)/i):1;j*=f;b=DG.ColorUtilities.gammaCorrect(1-((1-b)*f));h=DG.ColorUtilities.hsb_to_PlatformColor(d,j,b)}return h};DG.ColorUtilities.calcCategoryColor=function(c,a,h){var i,d=a.h,j=a.s,b=a.b,f=d,e=c.cellNameToCellNumber(h),g=c.numberOfCells();if(e>=0&&e<g){if(g>1){d=e*DG.ColorUtilities.kCatHueSpread/g;d+=f;d-=Math.floor(d)}j=DG.ColorUtilities.kCatSaturation;b=DG.ColorUtilities.kCatBrightness;i=DG.ColorUtilities.hsb_to_PlatformColor(d,j,b)}else{i=DG.ColorUtilities.kMissingValueCaseColor}return i};DG.ColorUtilities.calcCaseColorFromData=function(a,c){var b,d;if(c){d=c.stats.isNumeric?DG.ColorUtilities.calcContinuousColorFromData:DG.ColorUtilities.calcCategoryColorFromData;b=d(c.stats,c.color,a)}else{b=DG.ColorUtilities.kNoAttribCaseColor}return b};DG.ColorUtilities.calcContinuousColorFromData=function(c,a,f){var g=DG.ColorUtilities.kMissingValueCaseColor;var h=c.max-c.min;var d=a.h,i=a.s,b=a.b,e;if(isFinite(h)&&isFinite(f)){e=(h>0)?((f-c.min)/h):1;i*=e;b=DG.ColorUtilities.gammaCorrect(1-((1-b)*e));g=DG.ColorUtilities.hsb_to_PlatformColor(d,i,b)}return g};DG.ColorUtilities.calcCategoryColorFromData=function(c,a,h){var f=c.categories.indexOf(h);var g=c.categories.length;var i;var d=a.h,j=a.s,b=a.b;var e=d;if(f>=0){if(g>1){d=f*DG.ColorUtilities.kCatHueSpread/g;d+=e;d-=Math.floor(d)}j=DG.ColorUtilities.kCatSaturation;b=DG.ColorUtilities.kCatBrightness;i=DG.ColorUtilities.hsb_to_PlatformColor(d,j,b)}else{i=DG.ColorUtilities.kMissingValueCaseColor}return i};DG.ColorUtilities.hsb_to_PlatformColor=function(a,b,c){return{h:a,s:b,b:c,colorString:DG.ColorUtilities.hsb_to_rgb(a,b,c)}};DG.ColorUtilities.rgb_to_PlatformColor=function(c,b,a){return("rgb("+(c*255).toFixed(4)+","+(b*255).toFixed(4)+","+(a*255).toFixed(4)+")")};DG.ColorUtilities.hsb_to_rgb=function(e,d,j){var c,g,b,a,k,h;if(d===0){h=DG.ColorUtilities.rgb_to_PlatformColor(j,j,j)}else{g=(e>=1)?0:(e*6);c=Math.floor(g);g=g-c;b=j*(1-d);a=j*(1-(d*g));k=j*(1-(d*(1-g)));switch(c){case 0:h=DG.ColorUtilities.rgb_to_PlatformColor(j,k,b);break;case 1:h=DG.ColorUtilities.rgb_to_PlatformColor(a,j,b);break;case 2:h=DG.ColorUtilities.rgb_to_PlatformColor(b,j,k);break;case 3:h=DG.ColorUtilities.rgb_to_PlatformColor(b,a,j);break;case 4:h=DG.ColorUtilities.rgb_to_PlatformColor(k,b,j);break;case 5:h=DG.ColorUtilities.rgb_to_PlatformColor(j,b,a);break}}return h};DG.ColorUtilities.gammaCorrect=function(a){return Math.pow(a,DG.ColorUtilities.kStandardMacGammaCorrection)};DG.ColorUtilities.dampenBrightnessByHue=function(f,g,l){var m=DG.ColorUtilities.kBrightnessTable,h=DG.ColorUtilities.kBrightnessTableMaxK,k=m.length,a=g*k,i=Math.floor(a),b=Math.ceil(a),j=(i<b)?b-a:1,e=a-i,d,c;i=i%k;b=b%k;d=m[i]*j+m[b]*e;c=1-((h-d)*l);return(f*c)};DG.ColorUtilities.darker=function(c,a){var b=DG.color(c).darker(a).color;return b};DG.ColorUtilities.rgbColorString_to_PlatformColor=function(e,d){var b,a=DG.ColorUtilities.colorNameToHexColor(e);if(b=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(a)){b=[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]}else{if(b=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(a)){b=[parseInt(b[1],16)*17,parseInt(b[2],16)*17,parseInt(b[3],16)*17]}else{if(b=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(a)){b=[+b[1],+b[2],+b[3],+b[4]]}else{if(b=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(a)){b=[+b[1],+b[2],+b[3]]}else{throw new Error(a+" is not supported by parseColor")}}}}var c={r:b[0]/255,g:b[1]/255,b:b[2]/255,colorString:e};if(d){var f=Raphael.rgb2hsb(c.r,c.g,c.b);c.h=f.h;c.s=f.s;c.b=f.b}return c};DG.ColorUtilities.colorNameToHexColor=function(a){if(a.charAt(0)==="#"){a=a.substr(1,6)}a=a.replace(/ /g,"");a=a.toLowerCase();if(DG.ColorUtilities.simpleColorNames.hasOwnProperty(a)){a=DG.ColorUtilities.simpleColorNames[a]}a="#"+a;return a};DG.ColorUtilities.simpleColorNames={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};DG.DataUtilities={};DG.DataUtilities.getMissingValue=function(){return null};DG.DataUtilities.isMissingValue=function(a){switch(typeof a){case"string":return a==="";case"number":return !isFinite(a);case"boolean":return false}return true};DG.DataUtilities.canonicalizeInputValue=function(b){var a=b;if(a==="undefined"){a=null}return a};DG.DataUtilities.isEqualIgnoreCase=function(f,e){var d=typeof f,c=typeof e,b,a;if(d===c&&d==="string"){b=f.toLowerCase();a=e.toLowerCase();return b===a}else{return f===e}};DG.EditorLock=SC.Object.extend({isActive:function(a){return window.Slick.GlobalEditorLock.isActive(a)},activate:function(a){try{window.Slick.GlobalEditorLock.activate(a)}catch(b){DG.logWarn(b.replace("SlickGrid","DG"))}},deactivate:function(a){try{window.Slick.GlobalEditorLock.deactivate(a)}catch(b){DG.logWarn(b.replace("SlickGrid","DG"))}},commitCurrentEdit:function(){return window.Slick.GlobalEditorLock.commitCurrentEdit()},cancelCurrentEdit:function(){return window.Slick.GlobalEditorLock.cancelCurrentEdit()}});DG.globalEditorLock=new DG.EditorLock();DG.MathUtilities={roundToSignificantDigits:function(h,c){var d=1,e=0,g,b,a,f,i;DG.assert(c>0);if(isNaN(h)){return{roundedValue:h,decPlaces:0}}if(h===0){return{roundedValue:0,decPlaces:0}}if(h<0){d=-1;h=-h}g=Math.pow(10,c-1);b=g*10;while(h>b){h/=10;e++}while(h<g){h*=10;e--}a=Math.floor(h);if(h-a>0.5){a++}a=a*Math.pow(10,e);f=d*a;if(e>0){e=0}i=-e;return{roundedValue:f,decPlaces:i}},clipToIntegerRange:function(c,b,a){DG.assert(c===Math.round(c));if(c<b){return b}else{if(c>=a){return a-1}}return c},isInIntegerRange:function(c,b,a){DG.assert(c===Math.round(c));return(b<=c&&c<a)},clipToRange:function(c,b,a){DG.assert(typeof c==="number"&&isFinite(c));if(c<b){return b}else{if(c>a){return a}}return c},isInRange:function(c,b,a){DG.assert(typeof c==="number"&&isFinite(c));return(b<=c&&c<=a)},distance:function(d,c){var b=d.x-c.x,a=d.y-c.y;return Math.sqrt(b*b+a*a)},medianOfNumericArray:function(c){function b(e,d){return e-d}function a(d){var e=(d.length-1)/2,g=Math.floor(e),f=Math.ceil(e);if(e<0){return undefined}else{if(e===g){return d[e]}else{return(d[g]+d[f])/2}}}c.sort(b);return a(c)},quantileOfSortedArray:function(a,f){var g=a.length-1,b=g*f,e=Math.floor(b),d=Math.ceil(b),c=b-e;if(b<0){return undefined}else{if(b>=g){return a[g]}else{if(b===e){return a[e]}else{return(a[e]*c+a[d]*(1-c))}}}},isFinite:function(a){return(!SC.empty(a))&&isFinite(a)},map:function(c,a){var b={};return a?c.map(function(f,e){b.index=e;return a.call(b,f)}):c.slice()},index:function(){return this.index},max:function(b,a){if(a==DG.MathUtilities.index){return b.length-1}return Math.max.apply(null,a?DG.MathUtilities.map(b,a):b)},range:function(f,c,d){if(arguments.length==1){c=f;f=0}if(d==undefined){d=1}if((c-f)/d==Infinity){throw new Error("range must be finite")}var e=[],b=0,a;c-=(c-f)*1e-10;if(d<0){while((a=f+d*b++)>c){e.push(a)}}else{while((a=f+d*b++)<c){e.push(a)}}return e}};DG.isFinite=DG.MathUtilities.isFinite;DG.color=function(m){if(m.rgb){return m.rgb()}var o=/([a-z]+)\((.*)\)/i.exec(m);if(o){var n=o[2].split(","),k=1;switch(o[1]){case"hsla":case"rgba":k=parseFloat(n[3]);if(!k){return DG.Color.transparent}break}switch(o[1]){case"hsla":case"hsl":var f=parseFloat(n[0]),p=parseFloat(n[1])/100,d=parseFloat(n[2])/100;return(new DG.Color.Hsl(f,p,d,k)).rgb();case"rgba":case"rgb":function e(b){var a=parseFloat(b);return(b[b.length-1]=="%")?Math.round(a*2.55):a}var c=e(n[0]),i=e(n[1]),j=e(n[2]);return DG.rgb(c,i,j,k)}}if(m.charAt(0)=="#"){var c,i,j;if(m.length==4){c=m.charAt(1);c+=c;i=m.charAt(2);i+=i;j=m.charAt(3);j+=j}else{if(m.length==7){c=m.substring(1,3);i=m.substring(3,5);j=m.substring(5,7)}}return DG.rgb(parseInt(c,16),parseInt(i,16),parseInt(j,16),1)}return new DG.Color(m,1)};DG.Color=function(a,b){this.color=a;this.opacity=b};DG.Color.prototype.brighter=function(a){return this.rgb().brighter(a)};DG.Color.prototype.darker=function(a){return this.rgb().darker(a)};DG.rgb=function(f,e,c,d){return new DG.Color.Rgb(f,e,c,(arguments.length==4)?d:1)};DG.Color.Rgb=function(f,e,c,d){DG.Color.call(this,d?("rgb("+f+","+e+","+c+")"):"none",d);this.r=f;this.g=e;this.b=c;this.a=d};DG.Color.Rgb.prototype=SC.extend(DG.Color);DG.Color.Rgb.prototype.red=function(a){return DG.rgb(a,this.g,this.b,this.a)};DG.Color.Rgb.prototype.green=function(a){return DG.rgb(this.r,a,this.b,this.a)};DG.Color.Rgb.prototype.blue=function(a){return DG.rgb(this.r,this.g,a,this.a)};DG.Color.Rgb.prototype.alpha=function(b){return DG.rgb(this.r,this.g,this.b,b)};DG.Color.Rgb.prototype.rgb=function(){return this};DG.Color.Rgb.prototype.brighter=function(c){c=Math.pow(0.7,arguments.length?c:1);var f=this.r,e=this.g,a=this.b,d=30;if(!f&&!e&&!a){return DG.rgb(d,d,d,this.a)}if(f&&(f<d)){f=d}if(e&&(e<d)){e=d}if(a&&(a<d)){a=d}return DG.rgb(Math.min(255,Math.floor(f/c)),Math.min(255,Math.floor(e/c)),Math.min(255,Math.floor(a/c)),this.a)};DG.Color.Rgb.prototype.darker=function(a){a=Math.pow(0.7,arguments.length?a:1);return DG.rgb(Math.max(0,Math.floor(a*this.r)),Math.max(0,Math.floor(a*this.g)),Math.max(0,Math.floor(a*this.b)),this.a)};sc_require("libraries/raphael");DG.RaphaelLayer=SC.Object.extend({_prevLayer:null,_firstElement:null,_lastElement:null,_paper:null,clear:function(){this.forEach(function(a){a.remove()});this._firstElement=this._lastElement=null},push:function(b){DG.assert(b);if(!this._lastElement){var a;for(a=this._prevLayer;a;a=a._prevLayer){if(a&&a._lastElement){break}}if(a){b.insertAfter(a._lastElement)}else{b.toBack()}}else{b.insertAfter(this._lastElement)}this._lastElement=b;if(!this._firstElement){this._firstElement=b}DG.assert(b.next||(b===this._lastElement));DG.assert(this.isValid());return b},prepareToMoveOrRemove:function(a){if(a===this._firstElement){if(this._firstElement===this._lastElement){this._firstElement=this._lastElement=null}else{this._firstElement=a.next}}else{if(a===this._lastElement){this._lastElement=a.prev}}},forEach:function(c){var b,a;for(b=this._firstElement;b;b=a){a=(b===this._lastElement)?null:b.next;c(b)}},contains:function(b){var a;for(a=this._firstElement;a&&a.prev!==this._lastElement;a=a.next){if(a===b){return true}}return false},isValid:function(){return(!this._firstElement&&!this._lastElement)||((this._firstElement&&this._lastElement)&&(!this._firstElement.removed&&!this._lastElement.removed))}});sc_require("libraries/raphael");DG.RenderingUtilities={_blankCanvas:Raphael(0,0,0,0),kTransparent:"rgba(255, 255, 255, 0)",kSeeThrough:"rgba(255, 255, 255, 0.001)",kCaptionFontHeight:18,kDefaultFontHeight:12,getExtentForTextElement:function(e,c){var d=e.getBBox(),b=d.height||c,a=d.width;if(!a){a=(b/2)*e.attr("text").length}return{width:a,height:b}},textExtentOnCanvas:function(a,b){return{x:6*b.length,y:12}},textExtent:function(a){return this.textExtentOnCanvas(this._blankCanvas,a)},updateLine:function(b,a,c){b.attr({path:"M"+a.x+" "+a.y+" L"+c.x+" "+c.y})},pathForFrame:function(a){return"M"+a.x+" "+a.y+" L"+(a.x+a.width)+" "+a.y+" L"+(a.x+a.width)+" "+(a.y+a.height)+" L"+a.x+" "+(a.y+a.height)+" L"+a.x+" "+a.y},rotateText:function(b,a,e,d){if(Raphael.version<"2.0"){b.rotate(a,e,d)}else{var c="r%@,%@,%@".fmt(a,e,d);b.attr({transform:c})}}};DG.sounds=SC.Object.extend({sounds:{create:{path:"/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/sounds/create.wav"},drag:{path:"/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/sounds/drag.wav"},mixup:{path:"/static/dg/en/2584017b245964100b66c98239169290235bc544/resources/sounds/mixup.wav"}},init:function(){arguments.callee.base.apply(this,arguments)},initAudio:function(){var a,b;for(a in this.sounds){if(this.sounds.hasOwnProperty(a)){b=this.sounds[a];if(b&&b.path&&!b.audio){b.audio=new Audio(b.path)}}}},playSound:function(a){var b=this.sounds[a];if(true){return}if(b&&b.path&&!b.audio){b.audio=new Audio(b.path)}if(b.audio){if(window.chrome){b.audio.load()}else{b.audio.currentTime=0}b.audio.play()}},playMixup:function(){this.playSound("mixup")},playCreate:function(){this.playSound("create")},playDrag:function(){this.playSound("drag")}}).create();DG.Scene=DG.SvgScene={};DG.SvgScene.create=function(a){return document.createElementNS(this.svg,a)};DG.SvgScene.pathBasis=(function(){var c=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];function a(d,h,g,f,e){return{x:d[0]*h.left+d[1]*g.left+d[2]*f.left+d[3]*e.left,y:d[0]*h.top+d[1]*g.top+d[2]*f.top+d[3]*e.top}}var b=function(j,i,h,g){var f=a(c[1],j,i,h,g),e=a(c[2],j,i,h,g),d=a(c[3],j,i,h,g);return"C"+f.x+","+f.y+","+e.x+","+e.y+","+d.x+","+d.y};b.segment=function(k,j,i,h){var g=a(c[0],k,j,i,h),f=a(c[1],k,j,i,h),e=a(c[2],k,j,i,h),d=a(c[3],k,j,i,h);return"M"+g.x+","+g.y+"C"+f.x+","+f.y+","+e.x+","+e.y+","+d.x+","+d.y};return b})();DG.SvgScene.curveBasis=function(b){if(b.length<=2){return""}var e="",g=b[0],f=g,d=g,c=b[1];e+=this.pathBasis(g,f,d,c);for(var a=2;a<b.length;a++){g=f;f=d;d=c;c=b[a];e+=this.pathBasis(g,f,d,c)}e+=this.pathBasis(f,d,c,c);e+=this.pathBasis(d,c,c,c);return e};DG.ValueAnimator=SC.Object.extend({valueHolder:null,incrementProvider:null,isAnimating:false,animate:function(){var d=this,c=50,a=this.get("valueHolder");function b(){var e=d.getPath("incrementProvider.increment");a.set("value",a.get("value")+e)}if(this.get("isAnimating")){this.endAnimation()}this.set("isAnimating",true);if(SC.none(this.animationTimer)){this.animationTimer=SC.Timer.schedule({action:b,interval:c,repeats:YES,until:false})}this.animationTimer.set("isPaused",NO)},endAnimation:function(){if(!SC.none(this.animationTimer)){this.animationTimer.set("isPaused",YES)}if(this.get("isAnimating")){this.set("isAnimating",false)}}});DG.ViewUtilities={kTitleBarHeight:20,kDragWidth:8,kBorderWidth:4,horizontalPadding:function(){return 2*DG.ViewUtilities.kDragWidth},verticalPadding:function(){return DG.ViewUtilities.kDragWidth+DG.ViewUtilities.kTitleBarHeight+DG.ViewUtilities.kBorderWidth},windowToViewCoordinates:function(c,b){var a;do{a=b.get("frame");c.x-=a.x;c.y-=a.y;c.x+=b.get("horizontalScrollOffset")||0;c.y+=b.get("verticalScrollOffset")||0;b=b.parentView}while(!SC.none(b));return c},viewToWindowCoordinates:function(c,b){var a;do{a=b.get("frame");c.x+=a.x;c.y+=a.y;c.x-=b.get("horizontalScrollOffset")||0;c.y-=b.get("verticalScrollOffset")||0;b=b.parentView}while(!SC.none(b));return c},convertViewLayoutToAbsolute:function(b){var a=b.get("layout");if(SC.none(a.left)||SC.none(a.top)||SC.none(a.width)||SC.none(a.height)){var c=b.get("layer");if(!SC.none(c)){b.set("layout",{left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight})}}},findEmptyLocationForRect:function(f,b,h){var g=5,a={x:g,y:g},d=false,i=h.map(function(j){return j.get("isVisible")?j.get("frame"):{x:0,y:0,width:0,height:0}});function e(k,j){var l=(!isNaN(k.x)&&!isNaN(k.y))&&!(j.x>k.x+k.width||j.x+j.width<k.x||j.y>k.y+k.height||j.y+j.height<k.y);return l}function c(j){return !i.every(function(k){return !e(k,{x:j.x,y:j.y,width:f.width,height:f.height})})}while(!d){a.x=g;while(!d){if(c(a)){a.x+=g;if(a.x+f.width>b.x+b.width){break}}else{d=true}}if(!d){a.y+=g}}return a},normalFormForRect:function(a){return{left:Math.min(a.left,a.right),top:Math.max(a.bottom,a.top),right:Math.max(a.left,a.right),bottom:Math.min(a.bottom,a.top)}},ptInRect:function(a,b){return(a.x>=b.x)&&(a.x<=b.x+b.width)&&(a.y>=b.y)&&(a.y<=b.y+b.height)}};DG.AlertPane={processArgs:function(a){if(a.localize){if(!SC.empty(a.message)){a.message=SC.String.loc(a.message)}if(!SC.empty(a.description)){a.description=SC.String.loc(a.description)}if(!SC.empty(a.caption)){a.caption=SC.String.loc(a.caption)}a.localize=false}return a},show:function(a){SC.AlertPane.show(DG.AlertPane.processArgs(a))},warn:function(a){SC.AlertPane.warn(DG.AlertPane.processArgs(a))},info:function(a){SC.AlertPane.info(DG.AlertPane.processArgs(a))},error:function(a){SC.AlertPane.error(DG.AlertPane.processArgs(a))},plain:function(a){SC.AlertPane.plain(DG.AlertPane.processArgs(a))}};sc_require("views/text_field_view");DG.FormulaTextEditView=DG.TextFieldView.extend({autoCorrect:false,autoCapitalize:false,names:[],_disableNextSelectRoot:false,_selectRootElement:function(){if(!this._disableNextSelectRoot){arguments.callee.base.apply(this,arguments)}this._disableNextSelectRoot=false},keyDown:function(b){var d=DG.UNICODE.MINUS_SIGN,c=this.get("value"),a=this.get("selection");if(b.getCharString()==="-"){if(!SC.none(c)){c=c.slice(0,a.get("start"))+d+c.slice(a.get("end"))}else{c=d}this.set("value",c);this.setSelection(a.start+1);return true}else{if((b.which===SC.Event.KEY_TAB)&&(a.start!==c.length)&&(a.end===c.length)){this.setSelection(c.length);return true}}return arguments.callee.base.apply(this,arguments)},keyUp:function(g){var i=this.get("selection"),e=this.get("value"),a=this.get("names"),k=/\b[a-zA-Z_][\w]*$/,f=typeof e==="string"&&!SC.empty(e)?e.match(k):null;if(!i){return NO}function b(l){return !(l<32||(l>=33&&l<=46)||(l>=112&&l<=123)||(l>=91&&l<=93))}function h(l){var o=l,m,n;for(m=0;m<a.length;m++){n=a[m];if(n.indexOf(l)===0){o=n;break}}return o}if((i.start>0)&&(i.end===e.length)&&b(g.keyCode)&&(a.length>0)&&!SC.none(f)){var j=f[0],c=h(j),d=e.replace(k,c);if(c!==j){this.set("value",d);this.setSelection(e.length,d.length)}}return arguments.callee.base.apply(this,arguments)},performValidateKeyDown:function(a){return(a.getCharString()!=="-")&&arguments.callee.base.apply(this,arguments)},formulaExpression:function(a,c){if(c===undefined){var b=this.get("value");return !SC.empty(b)?b.replace(/\u2212/g,"-"):b}else{this.set("value",!SC.empty(c)?c.replace(/-/g,DG.UNICODE.MINUS_SIGN):"")}}.property("value")});sc_require("formula/formula_context");sc_require("views/formula_text_edit_view");DG.AttributeFormulaView=SC.PalettePane.extend({isModal:YES,layout:{width:400,height:180,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"attrName equalsLabel formula operandPopup functionPopup apply cancel".w(),attrName:SC.TextFieldView.design({layout:{top:5,left:5,right:25,height:24},value:"",spellCheckEnabled:false,leftAccessoryView:SC.LabelView.create({layout:{left:1,width:95,height:22,centerY:0},value:"DG.AttrFormView.attrNamePrompt",backgroundColor:"lightgray",localize:true})}),equalsLabel:SC.LabelView.extend({layout:{top:5,right:5,width:12,height:24},value:"="}),formula:DG.FormulaTextEditView.design({layout:{top:34,left:5,right:5,height:72},value:"",isTextArea:true,spellCheckEnabled:false,hint:"",leftAccessoryView:SC.LabelView.create({layout:{left:1,width:55,height:70,top:1},value:"DG.AttrFormView.formulaPrompt",backgroundColor:"lightgray",localize:true})}),operandPopup:SC.PopupButtonView.extend({layout:{top:112,left:5,width:140,height:24},localize:true,title:"DG.AttrFormView.operandMenuTitle",menu:SC.MenuPane.extend({layout:{width:200},rawItems:function(b,a){var c=0;if(a!==undefined){var d=a.map(function(e){if(c<e.length){c=e.length}return{title:e,isSeparator:e==="--"}});this.set("items",d)}this.adjust("width",40+10*c)}.property()})}),functionPopup:SC.PopupButtonView.extend({layout:{top:112,left:150,width:140,height:24},localize:true,title:"DG.AttrFormView.functionMenuTitle",menu:SC.MenuPane.extend({layout:{width:100},items:null})}),apply:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,title:"DG.AttrFormView.applyBtnTitle",target:null,action:null,toolTip:"",localize:true,isDefault:true}),cancel:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,title:"DG.AttrFormView.cancelBtnTitle",target:null,action:null,toolTip:"DG.AttrFormView.cancelBtnTooltip",localize:true,isCancel:true})}),attributeName:function(a,b){return b===undefined?this.getPath("contentView.attrName.value"):this.setPath("contentView.attrName.value",b)}.property(),formula:function(a,b){return b===undefined?this.getPath("contentView.formula.formulaExpression"):this.setPath("contentView.formula.formulaExpression",b)}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancel.target",this);this.setPath("contentView.cancel.action","close");this.setPath("contentView.functionPopup.menu.items",DG.FormulaContext.getFunctionNamesWithParentheses())},userSelectedOperand:function(){var a=this.getPath("contentView.operandPopup.menu.selectedItem.title");if(!SC.empty(a)){var b=this.getPath("contentView.formula");if(b){b.replaceSelectionWithString(a)}}this.setPath("contentView.operandPopup.menu.selectedItem",null)}.observes(".contentView.operandPopup.menu.selectedItem"),userSelectedFunction:function(){var b=this.getPath("contentView.functionPopup.menu.selectedItem.title");if(!SC.empty(b)){var c=this.getPath("contentView.formula");if(c){var e=c.getPath("selection.start"),d=b.length,a=e+d-1;c.replaceSelectionWithString(b);c.setSelection(a)}}this.setPath("contentView.functionPopup.menu.selectedItem",null)}.observes(".contentView.functionPopup.menu.selectedItem"),close:function(){this.remove();this.destroy()}});DG.CreateAttributeFormulaView=function(e){var g=DG.AttributeFormulaView.create(e),f={attrNamePrompt:"attrName.leftAccessoryView.value",attrNameValue:"attrName.value",attrNameHint:"attrName.hint",attrNameIsEnabled:"attrName.isEnabled",formulaPrompt:"formula.leftAccessoryView.value",formulaValue:"formula.value",formulaExpression:"formula.formulaExpression",formulaNames:"formula.names",formulaHint:"formula.hint",formulaIsEnabled:"formula.isEnabled",formulaOperands:"operandPopup.menu.rawItems",applyTitle:"apply.title",applyTarget:"apply.target",applyAction:"apply.action",applyTooltip:"apply.toolTip",cancelTitle:"cancel.title",cancelTooltip:"cancel.toolTip"},d=g.get("contentView"),c=d.attrName,a=d.formula;DG.ObjectMap.forEach(e,function(h,i){var j=f[h];if(!SC.empty(j)){d.setPath(j,i)}});g.append();var b=c.get("isEnabled")?c:a;b.becomeFirstResponder();return g};DG.TitleBarButtonView=SC.ImageView.extend((function(){var a="/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/closeicon.png",b="/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/closeicon_cross.png",c="/static/dg/en/2584017b245964100b66c98239169290235bc544/source/resources/images/closeicon_cross_dark.png";SC.imageQueue.loadImage(b);SC.imageQueue.loadImage(c);return{value:function(){if(this.get("isMouseOver")){if(this.get("isActive")){return c}else{return b}}else{if(this.get("isMouseDown")){return b}else{return a}}}.property("isMouseDown","isActive","isMouseOver").cacheable(),preloadIcons:function(){},isMouseDown:NO,isMouseOver:NO,isActive:NO,mouseMoved:function(d){this.mouseOver(d);return YES},mouseOver:function(d){if(this.get("isMouseDown")){this.set("isActive",YES)}this.set("isMouseOver",YES);return YES},mouseExited:function(d){this.set("isActive",NO);this.set("isMouseOver",NO);return YES},mouseDown:function(d){if(!this.get("isMouseDown")){this.set("isMouseDown",YES);this.set("isActive",YES)}return YES},mouseUp:function(d){if(this.get("isActive")){this.set("isActive",NO);this.set("isMouseOver",NO);this.set("isMouseDown",NO);this.closeIt()}else{this.set("isMouseDown",NO);this.mouseExited(d)}return YES},touchStart:function(d){return YES},touchEnd:function(d){this.closeIt()},closeIt:function(){var e=this.parentView.viewToDrag(),d=e.parentView;d.removeComponentView(e)}}}()));DG.TitleBarGearView=SC.ImageView.extend((function(){return{contentView:null,value:"sc-icon-options-16",menu:null,init:function(){arguments.callee.base.apply(this,arguments);this.menu=SC.MenuPane.create({layout:{width:200,height:150}})},controller:function(){return !SC.none(this.contentView)?this.contentView.get("controller"):null}.property("contentView","contentView.controller"),controllerItems:function(){var a=this.get("controller");return !SC.none(a)?a.get("gearMenuItems"):[]}.property("controller","controller.gearMenuItems"),updateVisibility:function(){var a=this.get("controllerItems"),b=a?a.length:0;this.set("isVisible",b>0)}.observes("controllerItems"),getDesiredMenuWidth:function(b){var c=0,a=5,d=60;b.forEach(function(e){if(e&&e.title){c=Math.max(c,e.title.length)}});return c*a+d},mouseDown:function(a){var b=this.get("controllerItems");this.menu.layout.width=this.getDesiredMenuWidth(b);this.menu.set("items",b);this.menu.popup(this);return YES},mouseUp:function(a){return YES},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},selectedItemDidChange:function(){var b=this.menu.get("selectedItem"),a=b.get("args")||[];b.get("itemAction").apply(b.get("target"),a)}.observes(".menu.selectedItem")}}()));sc_require("views/titlebar_button_view");sc_require("views/titlebar_gear_view");DG.DragBorderView=SC.View.extend((function(){return{dragCursor:null,cursor:function(){if(this.parentView.get("isResizable")){return this.dragCursor}else{return null}}.property("dragCursor").cacheable(),mouseDown:function(b){DG.globalEditorLock.commitCurrentEdit();var a=this.viewToDrag();DG.ViewUtilities.convertViewLayoutToAbsolute(a);a.bringToFront();if(!this.canBeDragged()){return NO}a.get("parentView").coverUpComponentViews("cover");var c=this.viewToDrag().get("layout");this._mouseDownInfo={pageX:b.pageX,pageY:b.pageY,left:c.left,top:c.top,height:c.height,width:c.width};return YES},mouseUp:function(a){var b=this.viewToDrag().get("parentView");this.mouseDragged(a);this._mouseDownInfo=null;b.coverUpComponentViews("uncover");b.set("frameNeedsUpdate",true);return YES},mouseDragged:function(a){var b=this._mouseDownInfo;if(b){this.dragAdjust(a,b);return YES}else{return NO}},canBeDragged:function(){return NO},touchStart:function(a){return this.mouseDown(a)},touchEnd:function(a){return this.mouseUp(a)},touchesDragged:function(a,b){return this.mouseDragged(a)},dragAdjust:function(a,b){},viewToDrag:function(){return DG.ComponentView.findComponentViewParent(this)},getContainerWidth:function(){return window.innerWidth},getContainerHeight:function(){var a=this.viewToDrag();while(!SC.none(a.parentView.parentView)){a=a.parentView}return window.innerHeight-a.get("frame").y}}}()));DG.ComponentView=SC.View.extend((function(){var h=DG.ViewUtilities.kTitleBarHeight,g=50,e=DG.ViewUtilities.kDragWidth,f=DG.ViewUtilities.kBorderWidth,a=SC.Cursor.create({cursorStyle:SC.E_RESIZE_CURSOR}),d=SC.Cursor.create({cursorStyle:SC.S_RESIZE_CURSOR}),c=SC.Cursor.create({cursorStyle:SC.W_RESIZE_CURSOR}),b=SC.Cursor.create({cursorStyle:SC.SE_RESIZE_CURSOR});return{classNames:["component-view"],isResizable:YES,isClosable:YES,contentView:SC.outlet("containerView.contentView"),childViews:"containerView borderRight borderBottom borderLeft borderTop borderCorner".w(),containerView:SC.View.design({layout:{left:e/2,bottom:e/2,right:e/2},gearView:SC.outlet("titlebar.gearView"),childViews:"titlebar coverSheet".w(),titlebar:DG.DragBorderView.design({layout:{height:h},backgroundColor:"gray",childViews:"titleView versionView closeBox gearView".w(),titleView:SC.LabelView.design({textAlign:SC.ALIGN_CENTER,value:""}),versionView:SC.LabelView.design({textAlign:SC.ALIGN_RIGHT,layout:{right:15},value:""}),closeBox:DG.TitleBarButtonView.design({layout:{left:0,top:0,width:h,height:h},scale:SC.SCALE_NONE}),gearView:DG.TitleBarGearView.design({layout:{right:5,centerY:0,width:16,height:16}}),dragAdjust:function(k,n){var m=this.viewToDrag(),i=n.left+(k.pageX-n.pageX),o=n.top+(k.pageY-n.pageY),j=this.getContainerWidth(),l=this.getContainerHeight();i=Math.min(Math.max(i,-n.width+g),j-g);m.adjust("left",i);o=Math.min(Math.max(o,-h/2),l-h/2);m.adjust("top",o)},canBeDragged:function(){return YES}}),coverSheet:SC.View.design({backgroundColor:DG.RenderingUtilities.kSeeThrough,isVisible:false}),classNames:["component-border"],setContentView:function(i){this.set("contentView",i);this.get("gearView").set("contentView",i)}}),borderRight:DG.DragBorderView.design({layout:{right:0,width:e},dragCursor:a,dragAdjust:function(i,k){var l=Math.max(i.pageX,g),j=k.width+(l-k.pageX);j=Math.max(j,g);this.parentView.adjust("width",j)},canBeDragged:function(){return this.parentView.get("isResizable")}}),borderBottom:DG.DragBorderView.design({layout:{bottom:0,height:e},dragCursor:d,dragAdjust:function(i,k){var j=k.height+(i.pageY-k.pageY);j=Math.max(j,g);this.parentView.adjust("height",j)},canBeDragged:function(){return this.parentView.get("isResizable")}}),borderLeft:DG.DragBorderView.design({layout:{left:0,width:e},dragCursor:c,dragAdjust:function(j,l){var i=this.getContainerWidth(),k=l.width-(j.pageX-l.pageX),m;k=Math.max(k,g);m=l.left+l.width-k;if(m<i-g){this.parentView.adjust("width",k);this.parentView.adjust("left",m)}},canBeDragged:function(){return this.parentView.get("isResizable")}}),borderTop:DG.DragBorderView.design({layout:{top:0,height:0},dragAdjust:function(i,j){},canBeDragged:function(){return false}}),borderCorner:DG.DragBorderView.design({layout:{right:0,width:3*e,bottom:0,height:3*e},dragCursor:b,dragAdjust:function(i,l){var m=Math.max(i.pageX,g),j=l.width+(m-l.pageX),k=l.height+(i.pageY-l.pageY);j=Math.max(j,g);this.parentView.adjust("width",j);k=Math.max(k,g);this.parentView.adjust("height",k)},canBeDragged:function(){return this.parentView.get("isResizable")}}),title:null,titleBinding:".containerView.titlebar.titleView.value",version:null,versionBinding:".containerView.titlebar.versionView.value",destroy:function(){DG.logUser("closeComponent: %@",this.get("title"));if(this.containerView.contentView){this.containerView.contentView.destroy()}arguments.callee.base.apply(this,arguments)},closeAction:function(){return this.getPath("contentView.closeAction")}.property(),addContent:function(j){var i=j.get("frame");if(i.width>0){this.adjust("width",i.width+2*f)}if(i.height>0){this.adjust("height",i.height+2*f+h)}j.set("layout",{top:h});this.containerView.appendChild(j);this.containerView.setContentView(j)},bringToFront:function(){this.parentView.bringToFront(this)},contentIsInstanceOf:function(i){return this.get("contentView") instanceof i},cover:function(i){var j=this.get("containerView"),k=j.get("coverSheet");j.removeChild(k);j.appendChild(k);k.set("isVisible",i==="cover")}}}()));DG.ComponentView._createComponent=function(e,d,g,a,c,f){var b=DG.ComponentView.create({layout:e});b.addContent(d.create(g));b.invokeLast(function(){if(!SC.empty(a)){b.set("title",a)}DG.logUser("componentCreated: %@",a)});if(!SC.none(c)){b.set("isResizable",c)}if(!SC.none(f)){b.set("isVisible",f)}return b};DG.ComponentView.restoreComponent=function(e,f,d,h,a,c,g){var b=this._createComponent(f,d,h,a,c,g);e.appendChild(b);e.set("frameNeedsUpdate",true);return b};DG.ComponentView.addComponent=function(a,b,c,e,g,d,h,i){h=h||false;if(!SC.none(b.width)){b.width+=DG.ViewUtilities.horizontalPadding()}if(!SC.none(b.height)){b.height+=DG.ViewUtilities.verticalPadding()}var f=this._createComponent(b,c,e,g,d,i);if(!h){a.positionNewComponent(f)}a.appendChild(f);a.set("frameNeedsUpdate",true);f.scrollToVisible();return f};DG.ComponentView.findComponentViewParent=function(a){while(a&&!(a instanceof DG.ComponentView)){a=a.get("parentView")}return a};DG.ContainerView=SC.View.extend((function(){var a=16;return{isResizable:YES,frameNeedsUpdate:true,isFixedLayout:function(){return false}.property(),componentViews:function(){return this.get("childViews").filter(function(b){return b instanceof DG.ComponentView})}.property("childViews"),frame:function(){var d=0,b=0,c=this.parentView.get("frame");this.get("componentViews").forEach(function(f){var e=f.get("layout");d=Math.max(d,(e.left||0)+(e.width||0));b=Math.max(b,(e.top||0)+(e.height||0))});d+=a;b+=a;this.frameNeedsUpdate=false;if(b>c.height){this.adjust("bottom",null);this.adjust("height",b)}else{this.adjust("height",null);this.adjust("bottom",0)}if(d>c.width){this.adjust("right",null);this.adjust("width",d)}else{this.adjust("width",null);this.adjust("right",0)}return{x:0,y:0,width:d,height:b}}.property("frameNeedsUpdate").cacheable(),removeComponentView:function(c){var b=c.get("closeAction");if(b){b.action.apply(b.target,b.args)}else{DG.currDocumentController().removeComponentAssociatedWithView(c);c.destroy()}},destroyAllChildren:function(){var c=this.get("childViews"),b;c.forEach(function(d){if(d&&d.willDestroy){d.willDestroy()}});while(!SC.none(b=c.objectAt(c.get("length")-1))){b.destroy()}return this},bringToFront:function(c){var b=c.layoutDidChange;c.layoutDidChange=null;this.removeChild(c);this.appendChild(c);c.layoutDidChange=b},sendToBack:function(d){var b=this.get("childViews"),c=d.layoutDidChange;if(b.length===1){return}d.layoutDidChange=null;this.removeChild(d);this.insertBefore(d,b[0]);d.layoutDidChange=c},positionNewComponent:function(b){var e=b.get("frame"),d=this.parentView.get("clippingFrame");var c=DG.ViewUtilities.findEmptyLocationForRect(e,d,this.get("componentViews"));b.adjust("left",c.x);b.adjust("top",c.y)},coverUpComponentViews:function(b){this.get("componentViews").forEach(function(c){c.cover(b)})}}}()));DG.ExportCaseDataDialog=SC.PalettePane.extend({isModal:true,layout:{width:400,height:120,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"promptView collectionPopup editView okButton".w(),promptView:SC.LabelView.extend({layerId:"export_case_data_prompt",layout:{top:10,left:10,right:210,height:24},localize:true,value:""}),collectionPopup:SC.PopupButtonView.extend({layout:{top:10,left:200,right:10,height:24},title:"",menu:SC.MenuPane.extend({layout:{width:250},items:null})}),editView:SC.TextFieldView.design({layout:{top:40,left:10,right:10,height:44},value:"",isTextArea:true,spellCheckEnabled:false}),okButton:SC.ButtonView.design({layout:{bottom:5,right:10,height:24,width:90},titleMinWidth:0,localize:true,title:"",target:null,action:null,isDefault:true})}),value:function(){return this.getPath("contentView.editView.value")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.okButton.target",this);this.setPath("contentView.okButton.action","close")},collectionSelected:function(){var b=this.getPath("contentView.collectionPopup.menu.selectedItem.title"),d=this.getPath("contentView.collectionPopup.itemAction");if(!SC.empty(b)){var c=d(b),a=c.length,e=this.getPath("contentView.editView");this.setPath("contentView.collectionPopup.title",b);if(e){e.set("value",c);e.set("selection",SC.TextSelection.create({start:0,end:a}))}}}.observes(".contentView.collectionPopup.menu.selectedItem"),close:function(){this.remove();this.destroy()}});DG.CreateExportCaseDataDialog=function(b){var e=DG.ExportCaseDataDialog.create(b),d={prompt:"promptView.value",textValue:"editView.value",textHint:"editView.hint",textLimit:"editView.maxLength",textIsMultiLine:"editView.isTextArea",okTitle:"okButton.title",okTooltip:"okButton.toolTip",collectionMenuTitle:"collectionPopup.title",collectionMenuItems:"collectionPopup.menu.items",collectionMenuItemAction:"collectionPopup.itemAction"},a=e.get("contentView"),c=a.editView;DG.ObjectMap.forEach(b,function(f,g){var h=d[f];if(!SC.empty(h)){a.setPath(h,g)}});e.append();c.becomeFirstResponder();return e};DG.SingleTextDialog=SC.PalettePane.extend({isModal:true,layout:{width:400,height:120,centerX:0,centerY:0},contentView:SC.View.extend({childViews:"promptView editView okButton cancelButton".w(),promptView:SC.LabelView.extend({layout:{top:10,left:5,right:5,height:24},localize:true,value:""}),editView:SC.TextFieldView.design({layout:{top:40,left:5,right:5,height:24},value:"",isTextArea:false,spellCheckEnabled:false}),okButton:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.SingleTextDialog.okButton.title",target:null,action:null,isDefault:true,isEnabledBinding:".parentView.editView.value"}),cancelButton:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.SingleTextDialog.cancelButton.title",target:null,action:null,toolTip:"DG.SingleTextDialog.cancelButton.toolTip",isVisible:true,isCancel:true})}),value:function(){return this.getPath("contentView.editView.value")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancelButton.target",this);this.setPath("contentView.cancelButton.action","close")},close:function(){this.remove();this.destroy()}});DG.CreateSingleTextDialog=function(b){var e=DG.SingleTextDialog.create(b),d={prompt:"promptView.value",textValue:"editView.value",textHint:"editView.hint",textLimit:"editView.maxLength",textIsMultiLine:"editView.isTextArea",okTarget:"okButton.target",okAction:"okButton.action",okTooltip:"okButton.toolTip",cancelTitle:"cancelButton.title",cancelVisible:"cancelButton.isVisible",cancelTooltip:"cancelButton.toolTip"},a=e.get("contentView"),c=a.editView;DG.ObjectMap.forEach(b,function(f,g){var h=d[f];if(!SC.empty(h)){a.setPath(h,g)}});e.append();c.becomeFirstResponder();return e};sc_require("views/single_text_dialog");DG.FileImportDialog=DG.SingleTextDialog.extend({contentView:SC.View.extend({childViews:"promptView editView alertView okButton cancelButton".w(),promptView:SC.LabelView.extend({layout:{top:10,left:5,right:5,height:24},localize:true,value:""}),editView:DG.FileImportView.design({layout:{top:40,left:5,right:5,height:24},value:"",isTextArea:false,spellCheckEnabled:false}),alertView:SC.LabelView.extend({layout:{top:70,left:5,right:5,height:24},classNames:["dg-alert"],localize:true,isVisible:NO,value:""}),okButton:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.SingleTextDialog.okButton.title",target:null,action:null,isDefault:true}),cancelButton:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.SingleTextDialog.cancelButton.title",target:null,action:null,toolTip:"DG.SingleTextDialog.cancelButton.toolTip",isVisible:true,isCancel:true})}),showAlert:function(){this.contentView.alertView.set("isVisible",YES)},hideAlert:function(){this.contentView.alertView.set("isVisible",NO)},value:function(){return this.getPath("contentView.editView.files")}.property()});DG.CreateFileImportDialog=function(b){var e=DG.FileImportDialog.create(b),d={prompt:"promptView.value",textValue:"editView.value",textHint:"editView.hint",textLimit:"editView.maxLength",textIsMultiLine:"editView.isTextArea",textAction:"editView.action",alert:"alertView.value",okTarget:"okButton.target",okAction:"okButton.action",okTooltip:"okButton.toolTip",cancelTitle:"cancelButton.title",cancelVisible:"cancelButton.isVisible",cancelTooltip:"cancelButton.toolTip"},a=e.get("contentView"),c=a.editView;DG.ObjectMap.forEach(b,function(f,g){var h=d[f];if(!SC.empty(h)){a.setPath(h,g)}});e.append();c.becomeFirstResponder();return e};DG.FormulaObject=SC.View.extend((function(){var a="formula_object";return{destroy:function(){this.notifyPropertyChange("willDestroy");arguments.callee.base.apply(this,arguments)},descriptionView:null,formula:function(){var b=$('textarea[name|="'+this.get("outputSymbol")+'"]'),c=b&&b.val();return c}.property(),locals:function(){var b={},c=0;$("input").each(function(f,d){var e=d.value;c++;if(!SC.empty(e)){b[e]=$('[name="formula'+c+'"]').val()}});return b}.property(),formulas:function(){var c=this.get("locals"),d=this.get("outputSymbol"),b={};b[d]=this.get("formula");b.locals=c;return b}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.set("layout",{top:0,left:0,width:420,height:588});this.set("descriptionView",SC.StaticContentView.create({layerId:a,selectStart:function(){return true}}));this.appendChild(this.descriptionView);this.buildHTML();this.invokeLast(this.postProcessing)},buildHTML:function(){var c=this.get("nameSpaceSymbols"),i=this.get("outputSymbol"),d=this.get("variableDescriptions"),h='<table id="variables"><tr><th>Variable</th><th>Description</th></tr>',b=DG.gameSelectionController.getPath("currentGame.formulas"),g=(b&&b[i])?b[i]:"",e=(b&&b.locals)?b.locals:{},f=1;c.forEach(function(k,j){h+="<tr><td>"+k+"</td><td>"+d[j]+"</td></tr>"});h+="<tr><td>"+i+'</td><td><textarea autocapitalize="off" rows="2" cols="50" name="'+i+'" placeholder="Type your formula here">'+g+"</textarea></td></tr>";DG.ObjectMap.forEach(e,function(j,k){h+='<tr><td><input autocapitalize="off" type="text" name="local'+f+'" size="10" placeholder="Your variable" value ="'+j+'"/></td><td><textarea name="formula'+f+'" rows="2" cols="50" placeholder="Type your formula here">'+k+"</textarea></td></tr>";f++});if(this.get("allow_user_variables")){h+='<tr><td><input autocapitalize="off" type="text" name="local'+f+'" size="10" placeholder="Your variable"/></td><td><textarea name="formula'+f+'" rows="2" cols="50" placeholder="Type your formula here"></textarea></td></tr>'}h+="</table>";this.descriptionView.set("content",this.get("description")+h)},postProcessing:function(){var e=this;function d(){var f=e.getPath("parentView.parentView"),g=$("#"+a).height();f.adjust("height",g+DG.ViewUtilities.kTitleBarHeight+20)}function c(){var j=0,f=0,i=$("input");i.each(function(k){f++;if($(this).val()===""){j++}});if(j===0){f++;var h=!SC.browser.isIE,g=h?"Type your formula here":"";$("table").append('<tr><td><input autocapitalize="off" type="text" name="local'+f+'" size="10" placeholder="Your variable"/></td><td><textarea autocapitalize="off" name="formula'+f+'"rows="2" cols="50" placeholder="'+g+'"></textarea></td></tr>');e.invokeLast(e.postProcessing)}}var b=$("input");b.change(c);d()},updateContents:function(c,b,f,d,e){this.set("description",c);this.set("outputSymbol",b);this.set("nameSpaceSymbols",f);this.set("variableDescriptions",d);this.set("allow_user_variables",e);this.buildHTML();this.invokeLast(this.postProcessing)}}}()));DG.ImageView=SC.ImageView.extend({altText:null,localize:false,displayAltText:function(){var a=this.get("altText")||this.get("toolTip")||"";return !SC.empty(a)&&this.get("localize")?a.loc():a}.property("altText","toolTip","localize"),render:function(c){arguments.callee.base.apply(this,arguments);var a=this.get("displayAltText");if(!SC.empty(a)){c.attr("alt",a)}var b=this.get("displayToolTip");if(!SC.empty(b)){c.attr("title",b)}}});sc_require("views/image_view");DG.IconButton=SC.View.extend((function(){return{iconName:null,depressedIconName:null,title:null,iconExtent:{width:32,height:32},childViews:"iconView labelView".w(),iconView:DG.ImageView.design({classNames:"icon-button",textAlign:SC.ALIGN_CENTER,altTextBinding:".parentView.title",localizeBinding:".parentView.localize",value:function(){if(this.getPath("parentView.isMouseOver")&&this.getPath("parentView.isMouseDown")){return this.getPath("parentView.depressedIconName")}else{return this.getPath("parentView.iconName")}}.property("parentView.isMouseDown","parentView.isMouseOver","parentView.iconName","parentView.depressedIconName").cacheable()}),labelView:SC.LabelView.design({classNames:["icon-label"],layout:{bottom:0,height:15},textAlign:SC.ALIGN_CENTER,valueBinding:".parentView.title",localizeBinding:".parentView.localize"}),init:function(){arguments.callee.base.apply(this,arguments);this.iconView.set("layout",{top:0,centerX:0,height:this.iconExtent.width,width:this.iconExtent.height});this.labelView.set("isVisible",!SC.empty(this.get("title")));SC.imageQueue.loadImage(this.depressedIconName)},isEnabled:true,isMouseDown:NO,isMouseOver:NO,mouseMoved:function(a){this.mouseOver(a);return YES},mouseOver:function(a){this.set("isMouseOver",YES);return YES},mouseExited:function(a){this.set("isMouseOver",NO);return YES},mouseDown:function(a){if(this.get("isEnabled")){this.set("isMouseDown",YES);return YES}return NO},_lastMouseUpTime:0,mouseUp:function(b){var c=b.timeStamp;var a=this.$().within(b.target);if(a&&c-this._lastMouseUpTime>=500){this._action(b);this._lastMouseUpTime=b.timeStamp}this.set("isMouseDown",NO);return YES},_action:function(a){var c=this.get("action");var d=this.get("target")||null;var e=this.get("pane");var b=e?e.get("rootResponder"):null;if(b){b.sendAction(c,d,this,e)}},touchStart:function(a){this.beginPropertyChanges();this.set("isMouseOver",YES);this.set("isMouseDown",YES);this.endPropertyChanges();return YES},touchEnd:function(a){this._action(a);this.beginPropertyChanges();this.set("isMouseOver",NO);this.set("isMouseDown",NO);this.endPropertyChanges()},render:function(b){arguments.callee.base.apply(this,arguments);var a=this.get("displayToolTip");if(a){b.attr("title",a)}}}}()));DG.OpenSaveDialog=SC.PalettePane.extend({isModal:true,dialogType:null,layout:{width:400,height:120,centerX:0,centerY:0},contentView:SC.View.extend({dialogType:null,childViews:["promptView","documentListView","documentNameView","documentPermissionsView","okButton","cancelButton"],promptView:SC.LabelView.extend({layout:{top:10,left:5,right:5,height:24},localize:true,value:"DG.OpenSaveDialog.promptView.value"}),documentListView:SC.SelectFieldView.design({layout:{top:40,left:5,right:5,height:24},nameKey:"name",valueKey:"id",disableSort:true}),documentNameView:SC.TextFieldView.design({layout:{top:40,left:5,right:5,height:24},value:"",spellCheckEnabled:false,leftAccessoryView:SC.LabelView.create({layout:{left:1,width:105,height:22,centerY:0},localize:true,value:"DG.OpenSaveDialog.documentNameView.prompt",backgroundColor:"lightgray"})}),documentPermissionsView:SC.CheckboxView.design({value:0,toggleOnValue:1,toggleOffValue:0,localize:true,title:"DG.OpenSaveDialog.documentPermissions.title",toolTip:"DG.OpenSaveDialog.documentPermissions.toolTip",layout:{bottom:10,left:15,width:100,height:17}}),okButton:SC.ButtonView.design({layout:{bottom:5,right:5,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.OpenSaveDialog.okButton.title",target:null,action:null,toolTip:"DG.OpenSaveDialog.okButton.toolTip",isDefault:true}),cancelButton:SC.ButtonView.design({layout:{bottom:5,right:115,height:24,width:90},titleMinWidth:0,localize:true,title:"DG.OpenSaveDialog.cancelButton.title",target:null,action:null,toolTip:"DG.OpenSaveDialog.cancelButton.toolTip",isCancel:true})}),documentName:function(){switch(this.get("dialogType")){case DG.OpenSaveDialog.kOpenDialog:var a=this.getPath("contentView.documentListView.objects"),e,d=a&&a.get("length"),b=this.getPath("contentView.documentListView.fieldValue");for(e=0;e<d;++e){var c=a.objectAt(e);if(c.id===b){return c.name}}return null;case DG.OpenSaveDialog.kSaveDialog:return this.getPath("contentView.documentNameView.value");default:}return""}.property(),documentID:function(){switch(this.get("dialogType")){case DG.OpenSaveDialog.kOpenDialog:return this.getPath("contentView.documentListView.fieldValue");default:}return null}.property(),documentPermissions:function(){return this.getPath("contentView.documentPermissionsView.value")}.property(),init:function(){arguments.callee.base.apply(this,arguments);this.setPath("contentView.cancelButton.target",this);this.setPath("contentView.cancelButton.action","close")},close:function(){this.remove();this.destroy()}});DG.OpenSaveDialog.kOpenDialog=1;DG.OpenSaveDialog.kSaveDialog=2;DG.CreateOpenSaveDialog=function(f){var h=DG.OpenSaveDialog.create(f),g={dialogType:"dialogType",prompt:"promptView.value",documentList:"documentListView.objects",documentNamePrompt:"documentNameView.leftAccessoryView.value",documentNameValue:"documentNameView.value",documentNameHint:"documentNameView.hint",documentNameIsEnabled:"documentNameView.isEnabled",documentPermissionValue:"documentPermissionsView.value",okTitle:"okButton.title",okTarget:"okButton.target",okAction:"okButton.action",okTooltip:"okButton.toolTip",cancelTitle:"cancelButton.title",cancelTooltip:"cancelButton.toolTip"},c=h.get("contentView"),b=c.get("documentListView"),e=c.get("documentNameView"),a=c.get("documentPermissionsView"),d=DG.supports("docSavePermissions")&&(h.get("dialogType")===DG.OpenSaveDialog.kSaveDialog);DG.ObjectMap.forEach(f,function(i,j){var k=g[i];if(!SC.empty(k)){c.setPath(k,j)}});b.set("isVisible",h.get("dialogType")===DG.OpenSaveDialog.kOpenDialog);e.set("isVisible",h.get("dialogType")===DG.OpenSaveDialog.kSaveDialog);a.set("isVisible",d);h.append();switch(h.get("dialogType")){case DG.OpenSaveDialog.kOpenDialog:b.becomeFirstResponder();break;case DG.OpenSaveDialog.kSaveDialog:e.becomeFirstResponder();break;default:}return h};DG.ScrollView=SC.ScrollView.extend({horizontalScrollerView:SC.ScrollerView.extend({buttonOverlap:0}),horizontalScrollerLayout:function(){var a=this.get("isVerticalScrollerVisible")?0:this.getPath("horizontalScrollerView.scrollbarThickness");return{left:0,bottom:0,right:a}}.property(),verticalScrollerView:SC.ScrollerView.extend({buttonOverlap:0}),verticalScrollerLayout:function(){var a=this.get("isHorizontalScrollerVisible")?0:this.getPath("verticalScrollerView.scrollbarThickness");return{left:0,bottom:a,right:0}}.property(),scrollToBottom:function(){this.scrollTo(null,this.get("maximumVerticalScrollOffset"))}});DG.mainPage=SC.Page.design((function(){var a=44;return DG.Browser.isCompatibleBrowser()?{mainPane:SC.MainPane.design({childViews:"topView scrollView".w(),topView:SC.ToolbarView.design({classNames:"toolshelf-background".w(),layout:{top:0,height:a},childViews:"resetButton logoutButton versionLabel statusLabel".w(),anchorLocation:SC.ANCHOR_TOP,resetButton:SC.ButtonView.design({layout:{centerY:0,height:24,left:0,width:100},localize:true,title:"DG.AppController.resetData.title",target:"DG.appController",action:"deleteAllCaseData",toolTip:"DG.AppController.resetData.toolTip"}),logoutButton:SC.ButtonView.design({layout:{centerY:0,height:24,left:0,width:80},localize:true,title:"DG.mainPage.mainPane.logoutButton.title",target:"DG.appController",action:"logout",toolTip:"DG.mainPage.mainPane.logoutButton.toolTip"}),versionLabel:SC.LabelView.design({layout:{top:0,height:24,left:0,width:150},controlSize:SC.REGULAR_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,textAlign:SC.ALIGN_RIGHT,value:DG.getVariantString("DG.mainPage.mainPane.versionString").loc(DG.VERSION,DG.BUILD_NUM)}),statusLabel:SC.LabelView.design({layout:{bottom:5,left:0,width:150,height:18},textAlign:SC.ALIGN_RIGHT,valueBinding:"DG.authorizationController.currLogin.user"}),init:function(){arguments.callee.base.apply(this,arguments);function e(i,h){var f=i.get("layout"),g=h+f.width;f.left=h;i.set("layout",f);return g}var c=10,b=40,d=c;DG.ToolButtonData.forEach(function(f){this[f.name]=DG.IconButton.create(f.desc);this[f.name].set("layout",{left:d,width:b});this.appendChild(this[f.name]);d+=b+c}.bind(this));DG.currDocumentController().set("guideButton",this.guideButton);d+=c;d=c+e(this.resetButton,d);d=c+e(this.logoutButton,d);e(this.versionLabel,d);d=e(this.statusLabel,d)}}),scrollView:SC.ScrollView.design({layout:{top:a},classNames:"doc-background".w(),alwaysBounceVertical:false,contentView:DG.ContainerView.design({})}),flagsChanged:function(b){},init:function(){arguments.callee.base.apply(this,arguments);if(DG.componentMode==="yes"){var b=this.get("scrollView");this.setPath("topView.isVisible",false);b.adjust("top",0);b.set("hasHorizontalScroller",false);b.set("hasVerticalScroller",false)}},nextValidKeyView:function(){return this}.property(),performKeyEquivalent:function(c,b){var d=YES;switch(c){case"ctrl_o":if(DG.authorizationController.getPath("currLogin.isSaveEnabled")){DG.appController.openDocument()}break;case"ctrl_s":if(DG.authorizationController.getPath("currLogin.isSaveEnabled")){DG.appController.saveDocument()}break;case"alt_ctrl_shift_g":DG.gameSelectionController.menuPane.popup();break;case"alt_ctrl_c":DG.mainPage.toggleCalculator();break;case"alt_ctrl_t":DG.mainPage.toggleCaseTable();break;case"alt_ctrl_g":DG.mainPage.addGraph();break;case"alt_ctrl_s":DG.mainPage.addSlider();break;case"alt_ctrl_shift_t":DG.mainPage.addText();break;default:d=arguments.callee.base.apply(this,arguments)}return d},createComponentAndView:function(c,f){var d=f.type,e=d&&d.indexOf("."),h=e>=0?d.slice(e+1):null,g=h&&DG[h],b=g&&DG.mainPage.getComponentsOfType(g);if(!b||!b.length){DG.currDocumentController().createComponentAndView(null,f.type)}},addGame:function(){if(!DG.currDocumentController().get("gameView")){DG.currDocumentController().addGame(this.scrollView.contentView)}}}),docView:SC.outlet("mainPane.scrollView.contentView"),updateLayout:function(){var c=this.get("mainPane");if(!c){return}var e=DG.currDocumentController().get("gameView");if(e){var f=DG.gameSelectionController.get("requestedDimensions");if(!f){var g=DG.gameSelectionController.get("currentDimensions"),d=g.width+DG.ViewUtilities.horizontalPadding(),b=g.height+DG.ViewUtilities.verticalPadding();e.adjust("width",d);e.adjust("height",b)}}else{if(DG.gameSelectionController.getPath("menuPane.selectedItem")){this.addGameIfNotPresent()}}}.observes("DG.gameSelectionController.currentDimensions")}:{mainPane:SC.MainPane.design({childViews:"messageView".w(),messageView:SC.LabelView.design({layout:{centerX:0,centerY:0,width:400,height:300},controlSize:SC.LARGE_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,textAlign:SC.ALIGN_LEFT,localize:true,value:"DG.mainPage.mainPane.messageView.value"})})}}()));DG.mainPage.toggleCalculator=function(){DG.currDocumentController().toggleComponent(this.get("docView"),"calcView")};DG.mainPage.toggleCaseTable=function(){DG.currDocumentController().toggleComponent(this.get("docView"),"caseTableView")};DG.mainPage.toggleMap=function(){DG.currDocumentController().toggleComponent(this.get("docView"),"mapView")};DG.mainPage.addSlider=function(){return DG.currDocumentController().addSlider(this.get("docView"))};DG.mainPage.addGraph=function(){if(!DG.currGameController.get("gameIsReady")){DG.log("DocumentController:addGraph called before gameIsReady.");return}return DG.currDocumentController().addGraph(this.get("docView"))};DG.mainPage.addText=function(){return DG.currDocumentController().addText(this.get("docView"))};DG.mainPage.addMap=function(){return DG.currDocumentController().addMap(this.get("docView"))};DG.mainPage.getComponentsOfType=function(b){var c=this.get("docView"),a=c&&c.get("childViews"),d=a&&a.filter(function(e){return e.contentIsInstanceOf(b)});return d?d.getEach("contentView"):[]};DG.mainPage.closeAllComponents=function(){this.get("docView").destroyAllChildren()};DG.mainPage.addGameIfNotPresent=function(){if(DG.mainPage.mainPane.addGame&&(DG.mainPage.getComponentsOfType(DG.GameView).length===0)){DG.mainPage.mainPane.addGame()}DG.currDocumentController().updateSavedChangeCount()};DG.main=function main(){DG.Browser.init();SC.$("body").addClass("dg");DG.getPath("mainPage.mainPane").append();if(DG.componentMode!=="yes"){DG.authorizationController.requireLogin()}else{DG.currGameController.set("gameIsReady",false);DG.mainPage.addGameIfNotPresent();if(!SC.empty(DG.startingDocName)){var a=!SC.empty(DG.startingDocOwner)?DG.startingDocOwner:DG.iUser;DG.appController.openDocumentNamed(DG.startingDocName,a);DG.startingDocName=""}}};function main(){DG.main()};